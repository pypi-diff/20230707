# Comparing `tmp/dask-2023.6.0.tar.gz` & `tmp/dask-2023.6.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dask-2023.6.0.tar", last modified: Fri Jun  9 16:34:13 2023, max compression
+gzip compressed data, was "dask-2023.6.1.tar", last modified: Mon Jun 26 20:35:18 2023, max compression
```

## Comparing `dask-2023.6.0.tar` & `dask-2023.6.1.tar`

### file list

```diff
@@ -1,487 +1,487 @@
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.358937 dask-2023.6.0/
--rw-r--r--   0 james      (501) staff       (20)     1531 2022-10-24 20:44:15.000000 dask-2023.6.0/LICENSE.txt
--rw-r--r--   0 james      (501) staff       (20)      325 2022-11-09 22:20:24.000000 dask-2023.6.0/MANIFEST.in
--rw-r--r--   0 james      (501) staff       (20)     2532 2023-06-09 16:34:13.358263 dask-2023.6.0/PKG-INFO
--rw-r--r--   0 james      (501) staff       (20)     1291 2022-11-09 22:20:24.000000 dask-2023.6.0/README.rst
--rw-r--r--   0 james      (501) staff       (20)     2397 2023-05-31 15:34:32.000000 dask-2023.6.0/conftest.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.359490 dask-2023.6.0/dask/
--rw-r--r--   0 james      (501) staff       (20)      464 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      133 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/__main__.py
--rw-r--r--   0 james      (501) staff       (20)      643 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/_compatibility.py
--rw-r--r--   0 james      (501) staff       (20)      500 2023-06-09 16:34:13.359618 dask-2023.6.0/dask/_version.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.897849 dask-2023.6.0/dask/array/
--rw-r--r--   0 james      (501) staff       (20)     1543 2021-06-08 02:50:30.000000 dask-2023.6.0/dask/array/NUMPY_LICENSE.txt
--rw-r--r--   0 james      (501) staff       (20)     5413 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12600 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/backends.py
--rw-r--r--   0 james      (501) staff       (20)     9983 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/blockwise.py
--rw-r--r--   0 james      (501) staff       (20)    12304 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/chunk.py
--rw-r--r--   0 james      (501) staff       (20)     5066 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/chunk_types.py
--rw-r--r--   0 james      (501) staff       (20)   190916 2023-05-31 19:49:19.000000 dask-2023.6.0/dask/array/core.py
--rw-r--r--   0 james      (501) staff       (20)    40564 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/array/creation.py
--rw-r--r--   0 james      (501) staff       (20)     2114 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/cupy_entry_point.py
--rw-r--r--   0 james      (501) staff       (20)      526 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/dispatch.py
--rw-r--r--   0 james      (501) staff       (20)     9189 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/einsumfuncs.py
--rw-r--r--   0 james      (501) staff       (20)     7252 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/fft.py
--rw-r--r--   0 james      (501) staff       (20)    32656 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/gufunc.py
--rw-r--r--   0 james      (501) staff       (20)     1996 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/image.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.898543 dask-2023.6.0/dask/array/lib/
--rw-r--r--   0 james      (501) staff       (20)       77 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/lib/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      101 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/lib/stride_tricks.py
--rw-r--r--   0 james      (501) staff       (20)    53335 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/linalg.py
--rw-r--r--   0 james      (501) staff       (20)     6363 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/ma.py
--rw-r--r--   0 james      (501) staff       (20)     5699 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/numpy_compat.py
--rw-r--r--   0 james      (501) staff       (20)    12838 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/optimization.py
--rw-r--r--   0 james      (501) staff       (20)    28480 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/overlap.py
--rw-r--r--   0 james      (501) staff       (20)    10652 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/percentile.py
--rw-r--r--   0 james      (501) staff       (20)    40604 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/random.py
--rw-r--r--   0 james      (501) staff       (20)    28023 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/rechunk.py
--rw-r--r--   0 james      (501) staff       (20)    57287 2023-06-01 20:02:33.000000 dask-2023.6.0/dask/array/reductions.py
--rw-r--r--   0 james      (501) staff       (20)    10765 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/reshape.py
--rw-r--r--   0 james      (501) staff       (20)    81988 2023-05-19 15:53:47.000000 dask-2023.6.0/dask/array/routines.py
--rw-r--r--   0 james      (501) staff       (20)    72631 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/slicing.py
--rw-r--r--   0 james      (501) staff       (20)    14613 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/stats.py
--rw-r--r--   0 james      (501) staff       (20)     8048 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/svg.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.916697 dask-2023.6.0/dask/array/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/array/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)   161461 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_array_core.py
--rw-r--r--   0 james      (501) staff       (20)     6689 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_array_function.py
--rw-r--r--   0 james      (501) staff       (20)     3159 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_array_utils.py
--rw-r--r--   0 james      (501) staff       (20)    23222 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_atop.py
--rw-r--r--   0 james      (501) staff       (20)     3304 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_chunk.py
--rw-r--r--   0 james      (501) staff       (20)    31150 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_creation.py
--rw-r--r--   0 james      (501) staff       (20)    19888 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_core.py
--rw-r--r--   0 james      (501) staff       (20)     6456 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_creation.py
--rw-r--r--   0 james      (501) staff       (20)      594 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_gufunc.py
--rw-r--r--   0 james      (501) staff       (20)    13412 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_linalg.py
--rw-r--r--   0 james      (501) staff       (20)     4303 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_overlap.py
--rw-r--r--   0 james      (501) staff       (20)     2862 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_percentile.py
--rw-r--r--   0 james      (501) staff       (20)     9219 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_random.py
--rw-r--r--   0 james      (501) staff       (20)     2224 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_reductions.py
--rw-r--r--   0 james      (501) staff       (20)     7437 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_routines.py
--rw-r--r--   0 james      (501) staff       (20)     4877 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_slicing.py
--rw-r--r--   0 james      (501) staff       (20)     2982 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_cupy_sparse.py
--rw-r--r--   0 james      (501) staff       (20)     8865 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_dispatch.py
--rw-r--r--   0 james      (501) staff       (20)     8437 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_fft.py
--rw-r--r--   0 james      (501) staff       (20)    21013 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_gufunc.py
--rw-r--r--   0 james      (501) staff       (20)     1482 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_image.py
--rw-r--r--   0 james      (501) staff       (20)    36448 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_linalg.py
--rw-r--r--   0 james      (501) staff       (20)    15635 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_masked.py
--rw-r--r--   0 james      (501) staff       (20)     1087 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_numpy_compat.py
--rw-r--r--   0 james      (501) staff       (20)    17446 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_optimization.py
--rw-r--r--   0 james      (501) staff       (20)    26718 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_overlap.py
--rw-r--r--   0 james      (501) staff       (20)     3443 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_percentiles.py
--rw-r--r--   0 james      (501) staff       (20)    15353 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_random.py
--rw-r--r--   0 james      (501) staff       (20)    36341 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_rechunk.py
--rw-r--r--   0 james      (501) staff       (20)    32756 2023-06-01 20:02:33.000000 dask-2023.6.0/dask/array/tests/test_reductions.py
--rw-r--r--   0 james      (501) staff       (20)     7289 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_reshape.py
--rw-r--r--   0 james      (501) staff       (20)    83849 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_routines.py
--rw-r--r--   0 james      (501) staff       (20)    32302 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_slicing.py
--rw-r--r--   0 james      (501) staff       (20)     6592 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_sparse.py
--rw-r--r--   0 james      (501) staff       (20)     5489 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_stats.py
--rw-r--r--   0 james      (501) staff       (20)     2740 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_svg.py
--rw-r--r--   0 james      (501) staff       (20)      525 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_testing.py
--rw-r--r--   0 james      (501) staff       (20)    17390 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_ufunc.py
--rw-r--r--   0 james      (501) staff       (20)     2706 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_wrap.py
--rw-r--r--   0 james      (501) staff       (20)     1317 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tests/test_xarray.py
--rw-r--r--   0 james      (501) staff       (20)     4737 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/tiledb_io.py
--rw-r--r--   0 james      (501) staff       (20)     9943 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/ufunc.py
--rw-r--r--   0 james      (501) staff       (20)    18674 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/utils.py
--rw-r--r--   0 james      (501) staff       (20)     6906 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/array/wrap.py
--rw-r--r--   0 james      (501) staff       (20)     4936 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/backends.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.918953 dask-2023.6.0/dask/bag/
--rw-r--r--   0 james      (501) staff       (20)      903 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     9111 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/avro.py
--rw-r--r--   0 james      (501) staff       (20)      763 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/chunk.py
--rw-r--r--   0 james      (501) staff       (20)    84784 2023-05-24 15:39:04.000000 dask-2023.6.0/dask/bag/core.py
--rw-r--r--   0 james      (501) staff       (20)     5464 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/random.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.920979 dask-2023.6.0/dask/bag/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/bag/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     3808 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/tests/test_avro.py
--rw-r--r--   0 james      (501) staff       (20)    50747 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/tests/test_bag.py
--rw-r--r--   0 james      (501) staff       (20)     6528 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/tests/test_random.py
--rw-r--r--   0 james      (501) staff       (20)     5049 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/tests/test_text.py
--rw-r--r--   0 james      (501) staff       (20)     6765 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/text.py
--rw-r--r--   0 james      (501) staff       (20)      241 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bag/utils.py
--rw-r--r--   0 james      (501) staff       (20)    52086 2023-06-01 18:18:40.000000 dask-2023.6.0/dask/base.py
--rw-r--r--   0 james      (501) staff       (20)    53252 2023-05-19 15:53:47.000000 dask-2023.6.0/dask/blockwise.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.922026 dask-2023.6.0/dask/bytes/
--rw-r--r--   0 james      (501) staff       (20)       75 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     6933 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/core.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.924679 dask-2023.6.0/dask/bytes/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/bytes/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     5158 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/tests/test_bytes_utils.py
--rw-r--r--   0 james      (501) staff       (20)      530 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/tests/test_compression.py
--rw-r--r--   0 james      (501) staff       (20)     6657 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/bytes/tests/test_http.py
--rw-r--r--   0 james      (501) staff       (20)    11476 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/tests/test_local.py
--rw-r--r--   0 james      (501) staff       (20)    19667 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/tests/test_s3.py
--rw-r--r--   0 james      (501) staff       (20)      500 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/bytes/utils.py
--rw-r--r--   0 james      (501) staff       (20)     2001 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/cache.py
--rw-r--r--   0 james      (501) staff       (20)     4067 2022-10-24 20:44:15.000000 dask-2023.6.0/dask/callbacks.py
--rw-r--r--   0 james      (501) staff       (20)     3064 2023-06-09 16:12:58.000000 dask-2023.6.0/dask/cli.py
--rw-r--r--   0 james      (501) staff       (20)      523 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/compatibility.py
--rw-r--r--   0 james      (501) staff       (20)    21645 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/config.py
--rw-r--r--   0 james      (501) staff       (20)     1756 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/context.py
--rw-r--r--   0 james      (501) staff       (20)    14833 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/core.py
--rw-r--r--   0 james      (501) staff       (20)     6944 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/dask-schema.yaml
--rw-r--r--   0 james      (501) staff       (20)     1498 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/dask.yaml
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.936339 dask-2023.6.0/dask/dataframe/
--rw-r--r--   0 james      (501) staff       (20)     1812 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     7496 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/_compat.py
--rw-r--r--   0 james      (501) staff       (20)     2171 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/_dtypes.py
--rw-r--r--   0 james      (501) staff       (20)     3219 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/_pyarrow.py
--rw-r--r--   0 james      (501) staff       (20)     1936 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/_pyarrow_compat.py
--rw-r--r--   0 james      (501) staff       (20)    12101 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/dataframe/accessor.py
--rw-r--r--   0 james      (501) staff       (20)    24298 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/backends.py
--rw-r--r--   0 james      (501) staff       (20)     9507 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/categorical.py
--rw-r--r--   0 james      (501) staff       (20)   302228 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/core.py
--rw-r--r--   0 james      (501) staff       (20)     4473 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/dispatch.py
--rw-r--r--   0 james      (501) staff       (20)      552 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/extensions.py
--rw-r--r--   0 james      (501) staff       (20)   114809 2023-06-01 18:18:42.000000 dask-2023.6.0/dask/dataframe/groupby.py
--rw-r--r--   0 james      (501) staff       (20)     2463 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/hyperloglog.py
--rw-r--r--   0 james      (501) staff       (20)    13412 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/indexing.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.942878 dask-2023.6.0/dask/dataframe/io/
--rw-r--r--   0 james      (501) staff       (20)      706 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    33811 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/csv.py
--rw-r--r--   0 james      (501) staff       (20)     5781 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/demo.py
--rw-r--r--   0 james      (501) staff       (20)    18079 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/hdf.py
--rw-r--r--   0 james      (501) staff       (20)    38487 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/io.py
--rw-r--r--   0 james      (501) staff       (20)    11163 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/json.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.944402 dask-2023.6.0/dask/dataframe/io/orc/
--rw-r--r--   0 james      (501) staff       (20)       92 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/orc/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     4487 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/orc/arrow.py
--rw-r--r--   0 james      (501) staff       (20)     7098 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/orc/core.py
--rw-r--r--   0 james      (501) staff       (20)      510 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/orc/utils.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.947088 dask-2023.6.0/dask/dataframe/io/parquet/
--rw-r--r--   0 james      (501) staff       (20)      166 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/parquet/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    71237 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/parquet/arrow.py
--rw-r--r--   0 james      (501) staff       (20)    67219 2023-06-01 18:18:42.000000 dask-2023.6.0/dask/dataframe/io/parquet/core.py
--rw-r--r--   0 james      (501) staff       (20)    52426 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/parquet/fastparquet.py
--rw-r--r--   0 james      (501) staff       (20)    32896 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/parquet/utils.py
--rw-r--r--   0 james      (501) staff       (20)    21108 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/sql.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.952834 dask-2023.6.0/dask/dataframe/io/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-03-07 20:03:52.000000 dask-2023.6.0/dask/dataframe/io/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    59231 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_csv.py
--rw-r--r--   0 james      (501) staff       (20)     5036 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_demo.py
--rw-r--r--   0 james      (501) staff       (20)    27232 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_hdf.py
--rw-r--r--   0 james      (501) staff       (20)    34438 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_io.py
--rw-r--r--   0 james      (501) staff       (20)     8625 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_json.py
--rw-r--r--   0 james      (501) staff       (20)     5238 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_orc.py
--rw-r--r--   0 james      (501) staff       (20)   165615 2023-06-01 18:18:42.000000 dask-2023.6.0/dask/dataframe/io/tests/test_parquet.py
--rw-r--r--   0 james      (501) staff       (20)    17632 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/tests/test_sql.py
--rw-r--r--   0 james      (501) staff       (20)     7899 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/io/utils.py
--rw-r--r--   0 james      (501) staff       (20)    14019 2023-06-01 18:18:40.000000 dask-2023.6.0/dask/dataframe/methods.py
--rw-r--r--   0 james      (501) staff       (20)    53884 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/multi.py
--rw-r--r--   0 james      (501) staff       (20)     1600 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/numeric.py
--rw-r--r--   0 james      (501) staff       (20)     8778 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/optimize.py
--rw-r--r--   0 james      (501) staff       (20)    20044 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/partitionquantiles.py
--rw-r--r--   0 james      (501) staff       (20)    11825 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/reshape.py
--rw-r--r--   0 james      (501) staff       (20)    22185 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/rolling.py
--rw-r--r--   0 james      (501) staff       (20)    37975 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/shuffle.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.964979 dask-2023.6.0/dask/dataframe/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/dataframe/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    10633 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_accessors.py
--rw-r--r--   0 james      (501) staff       (20)    67628 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_arithmetics_reduction.py
--rw-r--r--   0 james      (501) staff       (20)      942 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_boolean.py
--rw-r--r--   0 james      (501) staff       (20)    16678 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_categorical.py
--rw-r--r--   0 james      (501) staff       (20)   192106 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_dataframe.py
--rw-r--r--   0 james      (501) staff       (20)     1456 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_extensions.py
--rw-r--r--   0 james      (501) staff       (20)    14743 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_format.py
--rw-r--r--   0 james      (501) staff       (20)   121269 2023-06-01 18:18:42.000000 dask-2023.6.0/dask/dataframe/tests/test_groupby.py
--rw-r--r--   0 james      (501) staff       (20)     2702 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_hashing.py
--rw-r--r--   0 james      (501) staff       (20)     2897 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_hyperloglog.py
--rw-r--r--   0 james      (501) staff       (20)    22382 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_indexing.py
--rw-r--r--   0 james      (501) staff       (20)     7034 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_merge_column_and_index.py
--rw-r--r--   0 james      (501) staff       (20)      463 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_methods.py
--rw-r--r--   0 james      (501) staff       (20)    91017 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_multi.py
--rw-r--r--   0 james      (501) staff       (20)     2120 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_numeric.py
--rw-r--r--   0 james      (501) staff       (20)     1067 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_optimize_dataframe.py
--rw-r--r--   0 james      (501) staff       (20)     6662 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_pyarrow.py
--rw-r--r--   0 james      (501) staff       (20)     4550 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_pyarrow_compat.py
--rw-r--r--   0 james      (501) staff       (20)    11571 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_reshape.py
--rw-r--r--   0 james      (501) staff       (20)    17524 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_rolling.py
--rw-r--r--   0 james      (501) staff       (20)    53386 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_shuffle.py
--rw-r--r--   0 james      (501) staff       (20)    16595 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_ufunc.py
--rw-r--r--   0 james      (501) staff       (20)    21288 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tests/test_utils_dataframe.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.965894 dask-2023.6.0/dask/dataframe/tseries/
--rw-r--r--   0 james      (501) staff       (20)        0 2021-06-08 02:50:30.000000 dask-2023.6.0/dask/dataframe/tseries/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     7664 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tseries/resample.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.966782 dask-2023.6.0/dask/dataframe/tseries/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/dataframe/tseries/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     6866 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/tseries/tests/test_resample.py
--rw-r--r--   0 james      (501) staff       (20)    27404 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/dataframe/utils.py
--rw-r--r--   0 james      (501) staff       (20)     5314 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/datasets.py
--rw-r--r--   0 james      (501) staff       (20)    24389 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/delayed.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.968757 dask-2023.6.0/dask/diagnostics/
--rw-r--r--   0 james      (501) staff       (20)      258 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12136 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/profile.py
--rw-r--r--   0 james      (501) staff       (20)    16332 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/profile_visualize.py
--rw-r--r--   0 james      (501) staff       (20)     5001 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/progress.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.970032 dask-2023.6.0/dask/diagnostics/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.0/dask/diagnostics/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12045 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/tests/test_profiler.py
--rw-r--r--   0 james      (501) staff       (20)     3388 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/diagnostics/tests/test_progress.py
--rw-r--r--   0 james      (501) staff       (20)      715 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/distributed.py
--rw-r--r--   0 james      (501) staff       (20)    16587 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/dot.py
--rw-r--r--   0 james      (501) staff       (20)    19595 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/graph_manipulation.py
--rw-r--r--   0 james      (501) staff       (20)     2492 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/hashing.py
--rw-r--r--   0 james      (501) staff       (20)    34771 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/highlevelgraph.py
--rw-r--r--   0 james      (501) staff       (20)    46007 2023-05-03 18:02:08.000000 dask-2023.6.0/dask/layers.py
--rw-r--r--   0 james      (501) staff       (20)    18888 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/local.py
--rw-r--r--   0 james      (501) staff       (20)      487 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/ml.py
--rw-r--r--   0 james      (501) staff       (20)     8466 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/multiprocessing.py
--rw-r--r--   0 james      (501) staff       (20)    35638 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/optimization.py
--rw-r--r--   0 james      (501) staff       (20)    45768 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/order.py
--rw-r--r--   0 james      (501) staff       (20)        0 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/py.typed
--rw-r--r--   0 james      (501) staff       (20)    12597 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/rewrite.py
--rw-r--r--   0 james      (501) staff       (20)     7298 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/sizeof.py
--rw-r--r--   0 james      (501) staff       (20)     1510 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/system.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.990899 dask-2023.6.0/dask/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-03-07 20:04:31.000000 dask-2023.6.0/dask/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      742 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_backends.py
--rw-r--r--   0 james      (501) staff       (20)    51124 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_base.py
--rw-r--r--   0 james      (501) staff       (20)     1613 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_cache.py
--rw-r--r--   0 james      (501) staff       (20)     2570 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_callbacks.py
--rw-r--r--   0 james      (501) staff       (20)     1199 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_ci.py
--rw-r--r--   0 james      (501) staff       (20)     3266 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_cli.py
--rw-r--r--   0 james      (501) staff       (20)      379 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_compatibility.py
--rw-r--r--   0 james      (501) staff       (20)    17846 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_config.py
--rw-r--r--   0 james      (501) staff       (20)     1137 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_context.py
--rw-r--r--   0 james      (501) staff       (20)     7422 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_core.py
--rw-r--r--   0 james      (501) staff       (20)     1112 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_datasets.py
--rw-r--r--   0 james      (501) staff       (20)    22989 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_delayed.py
--rw-r--r--   0 james      (501) staff       (20)    31293 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_distributed.py
--rw-r--r--   0 james      (501) staff       (20)      925 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_docs.py
--rw-r--r--   0 james      (501) staff       (20)    12271 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_dot.py
--rw-r--r--   0 james      (501) staff       (20)    15070 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_graph_manipulation.py
--rw-r--r--   0 james      (501) staff       (20)     1095 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_hashing.py
--rw-r--r--   0 james      (501) staff       (20)     8363 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_highgraph.py
--rw-r--r--   0 james      (501) staff       (20)     9341 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_layers.py
--rw-r--r--   0 james      (501) staff       (20)     5008 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_local.py
--rw-r--r--   0 james      (501) staff       (20)      419 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_ml.py
--rw-r--r--   0 james      (501) staff       (20)     8457 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_multiprocessing.py
--rw-r--r--   0 james      (501) staff       (20)    45227 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_optimization.py
--rw-r--r--   0 james      (501) staff       (20)    28229 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_order.py
--rw-r--r--   0 james      (501) staff       (20)     4684 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_rewrite.py
--rw-r--r--   0 james      (501) staff       (20)     7518 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_sizeof.py
--rw-r--r--   0 james      (501) staff       (20)     7154 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_spark_compat.py
--rw-r--r--   0 james      (501) staff       (20)     1397 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_system.py
--rw-r--r--   0 james      (501) staff       (20)     4749 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_threaded.py
--rw-r--r--   0 james      (501) staff       (20)     5670 2023-04-25 18:34:46.000000 dask-2023.6.0/dask/tests/test_typing.py
--rw-r--r--   0 james      (501) staff       (20)    22705 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_utils.py
--rw-r--r--   0 james      (501) staff       (20)     1598 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/test_utils_test.py
--rw-r--r--   0 james      (501) staff       (20)      211 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/tests/warning_aliases.py
--rw-r--r--   0 james      (501) staff       (20)     2993 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/threaded.py
--rw-r--r--   0 james      (501) staff       (20)    14538 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/typing.py
--rw-r--r--   0 james      (501) staff       (20)    56051 2023-05-24 15:39:04.000000 dask-2023.6.0/dask/utils.py
--rw-r--r--   0 james      (501) staff       (20)     4825 2023-04-11 17:13:14.000000 dask-2023.6.0/dask/utils_test.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.992306 dask-2023.6.0/dask/widgets/
--rw-r--r--   0 james      (501) staff       (20)      792 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/widgets/__init__.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.998932 dask-2023.6.0/dask/widgets/templates/
--rw-r--r--   0 james      (501) staff       (20)     1295 2023-03-13 17:40:25.000000 dask-2023.6.0/dask/widgets/templates/array.html.j2
--rw-r--r--   0 james      (501) staff       (20)      124 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/widgets/templates/dataframe.html.j2
--rw-r--r--   0 james      (501) staff       (20)     2579 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/widgets/templates/highlevelgraph.html.j2
--rw-r--r--   0 james      (501) staff       (20)     1981 2022-11-09 22:20:24.000000 dask-2023.6.0/dask/widgets/templates/highlevelgraph_layer.html.j2
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.000053 dask-2023.6.0/dask/widgets/tests/
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.008194 dask-2023.6.0/dask/widgets/tests/templates/
--rw-r--r--   0 james      (501) staff       (20)       38 2022-10-24 20:44:15.000000 dask-2023.6.0/dask/widgets/tests/templates/bytes.html.j2
--rw-r--r--   0 james      (501) staff       (20)       39 2022-10-24 20:44:15.000000 dask-2023.6.0/dask/widgets/tests/templates/custom_filter.html.j2
--rw-r--r--   0 james      (501) staff       (20)       30 2022-10-24 20:44:15.000000 dask-2023.6.0/dask/widgets/tests/templates/example.html.j2
--rw-r--r--   0 james      (501) staff       (20)     1401 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/widgets/tests/test_widgets.py
--rw-r--r--   0 james      (501) staff       (20)     1120 2023-05-31 15:34:32.000000 dask-2023.6.0/dask/widgets/widgets.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:12.879917 dask-2023.6.0/dask.egg-info/
--rw-r--r--   0 james      (501) staff       (20)     2532 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/PKG-INFO
--rw-r--r--   0 james      (501) staff       (20)    13939 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/SOURCES.txt
--rw-r--r--   0 james      (501) staff       (20)        1 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/dependency_links.txt
--rw-r--r--   0 james      (501) staff       (20)      124 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/entry_points.txt
--rw-r--r--   0 james      (501) staff       (20)        1 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/not-zip-safe
--rw-r--r--   0 james      (501) staff       (20)      454 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/requires.txt
--rw-r--r--   0 james      (501) staff       (20)        5 2023-06-09 16:34:12.000000 dask-2023.6.0/dask.egg-info/top_level.txt
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.013377 dask-2023.6.0/docs/
--rw-r--r--   0 james      (501) staff       (20)     5741 2023-03-22 19:03:53.000000 dask-2023.6.0/docs/Makefile
--rw-r--r--   0 james      (501) staff       (20)     5186 2022-08-08 20:45:08.000000 dask-2023.6.0/docs/make.bat
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.195237 dask-2023.6.0/docs/source/
--rw-r--r--   0 james      (501) staff       (20)    17598 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/10-minutes-to-dask.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.212434 dask-2023.6.0/docs/source/_static/
--rw-r--r--   0 james      (501) staff       (20)    10187 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/_static/config_converter.js
--rw-r--r--   0 james      (501) staff       (20)    11021 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/_static/dask-simple.png
--rw-r--r--   0 james      (501) staff       (20)     2375 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/_static/main-page.css
--rw-r--r--   0 james      (501) staff       (20)    15598 2022-08-08 20:45:08.000000 dask-2023.6.0/docs/source/_static/profile.html
--rw-r--r--   0 james      (501) staff       (20)    65304 2022-08-08 20:45:08.000000 dask-2023.6.0/docs/source/_static/stacked_profile.html
--rw-r--r--   0 james      (501) staff       (20)      523 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/_static/style.css
--rw-r--r--   0 james      (501) staff       (20)      365 2021-06-16 20:41:28.000000 dask-2023.6.0/docs/source/_static/theme_overrides.css
--rw-r--r--   0 james      (501) staff       (20)   292662 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/_static/transpose_cyto.html
--rw-r--r--   0 james      (501) staff       (20)    49423 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/_static/yaml.min.js
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.213730 dask-2023.6.0/docs/source/_templates/
--rw-r--r--   0 james      (501) staff       (20)      180 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/_templates/layout.html
--rw-r--r--   0 james      (501) staff       (20)     2235 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/api.rst
--rw-r--r--   0 james      (501) staff       (20)     6968 2023-05-24 15:39:04.000000 dask-2023.6.0/docs/source/array-api.rst
--rw-r--r--   0 james      (501) staff       (20)     2943 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/array-assignment.rst
--rw-r--r--   0 james      (501) staff       (20)     4740 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/array-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)    13035 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-chunks.rst
--rw-r--r--   0 james      (501) staff       (20)    18437 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-creation.rst
--rw-r--r--   0 james      (501) staff       (20)     5885 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-design.rst
--rw-r--r--   0 james      (501) staff       (20)     2857 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-gufunc.rst
--rw-r--r--   0 james      (501) staff       (20)     6069 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/array-overlap.rst
--rw-r--r--   0 james      (501) staff       (20)     3924 2023-05-19 15:53:47.000000 dask-2023.6.0/docs/source/array-random.rst
--rw-r--r--   0 james      (501) staff       (20)     4137 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/array-slicing.rst
--rw-r--r--   0 james      (501) staff       (20)     3291 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-sparse.rst
--rw-r--r--   0 james      (501) staff       (20)     2018 2022-10-07 21:37:36.000000 dask-2023.6.0/docs/source/array-stack.rst
--rw-r--r--   0 james      (501) staff       (20)     1140 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array-stats.rst
--rw-r--r--   0 james      (501) staff       (20)     4121 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/array.rst
--rw-r--r--   0 james      (501) staff       (20)     1574 2022-08-08 20:45:08.000000 dask-2023.6.0/docs/source/bag-api.rst
--rw-r--r--   0 james      (501) staff       (20)     4557 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/bag-creation.rst
--rw-r--r--   0 james      (501) staff       (20)     4068 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/bag.rst
--rw-r--r--   0 james      (501) staff       (20)    14050 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     5553 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/caching.rst
--rw-r--r--   0 james      (501) staff       (20)   305883 2023-06-09 16:25:33.000000 dask-2023.6.0/docs/source/changelog.rst
--rw-r--r--   0 james      (501) staff       (20)      211 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/cheatsheet.rst
--rw-r--r--   0 james      (501) staff       (20)     4047 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/cli.rst
--rw-r--r--   0 james      (501) staff       (20)    15465 2023-03-13 20:41:19.000000 dask-2023.6.0/docs/source/conf.py
--rw-r--r--   0 james      (501) staff       (20)    16654 2023-04-06 21:35:01.000000 dask-2023.6.0/docs/source/configuration.rst
--rw-r--r--   0 james      (501) staff       (20)    18651 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/custom-collections.rst
--rw-r--r--   0 james      (501) staff       (20)     3604 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/custom-graphs.rst
--rw-r--r--   0 james      (501) staff       (20)      932 2023-05-31 15:34:32.000000 dask-2023.6.0/docs/source/dashboard-progress-script.py
--rw-r--r--   0 james      (501) staff       (20)    15045 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/dashboard.rst
--rw-r--r--   0 james      (501) staff       (20)   203552 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/daskcheatsheet.pdf
--rw-r--r--   0 james      (501) staff       (20)    13693 2023-05-19 15:53:47.000000 dask-2023.6.0/docs/source/dataframe-api.rst
--rw-r--r--   0 james      (501) staff       (20)     9611 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/dataframe-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     3951 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/dataframe-categoricals.rst
--rw-r--r--   0 james      (501) staff       (20)     5967 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/dataframe-create.rst
--rw-r--r--   0 james      (501) staff       (20)     5002 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/dataframe-design.rst
--rw-r--r--   0 james      (501) staff       (20)     6224 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/dataframe-extend.rst
--rw-r--r--   0 james      (501) staff       (20)     8050 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/dataframe-groupby.rst
--rw-r--r--   0 james      (501) staff       (20)     6115 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/dataframe-indexing.rst
--rw-r--r--   0 james      (501) staff       (20)     3454 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/dataframe-joins.rst
--rw-r--r--   0 james      (501) staff       (20)    10952 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/dataframe-parquet.rst
--rw-r--r--   0 james      (501) staff       (20)    12661 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/dataframe-sql.rst
--rw-r--r--   0 james      (501) staff       (20)     7772 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/dataframe.rst
--rw-r--r--   0 james      (501) staff       (20)      363 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/debugging-performance.rst
--rw-r--r--   0 james      (501) staff       (20)     1696 2022-08-08 20:45:08.000000 dask-2023.6.0/docs/source/delayed-api.rst
--rw-r--r--   0 james      (501) staff       (20)    17616 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/delayed-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     1497 2022-10-07 21:37:36.000000 dask-2023.6.0/docs/source/delayed-collections.rst
--rw-r--r--   0 james      (501) staff       (20)     6357 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/delayed.rst
--rw-r--r--   0 james      (501) staff       (20)     3620 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/deploying-cli.rst
--rw-r--r--   0 james      (501) staff       (20)     3012 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/deploying-cloud.rst
--rw-r--r--   0 james      (501) staff       (20)     2868 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/deploying-docker.rst
--rw-r--r--   0 james      (501) staff       (20)     9939 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/deploying-hpc.rst
--rw-r--r--   0 james      (501) staff       (20)     4001 2023-05-19 15:53:47.000000 dask-2023.6.0/docs/source/deploying-kubernetes.rst
--rw-r--r--   0 james      (501) staff       (20)     5823 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/deploying-python-advanced.rst
--rw-r--r--   0 james      (501) staff       (20)     2839 2023-04-25 18:34:46.000000 dask-2023.6.0/docs/source/deploying-python.rst
--rw-r--r--   0 james      (501) staff       (20)     1619 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/deploying-ssh.rst
--rw-r--r--   0 james      (501) staff       (20)     7356 2023-06-06 17:26:06.000000 dask-2023.6.0/docs/source/deploying.rst
--rw-r--r--   0 james      (501) staff       (20)    10873 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/deployment-considerations.rst
--rw-r--r--   0 james      (501) staff       (20)    13144 2023-05-31 15:34:32.000000 dask-2023.6.0/docs/source/develop.rst
--rw-r--r--   0 james      (501) staff       (20)     4442 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/diagnostics-distributed.rst
--rw-r--r--   0 james      (501) staff       (20)    10407 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/diagnostics-local.rst
--rw-r--r--   0 james      (501) staff       (20)     4364 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/ecosystem.rst
--rw-r--r--   0 james      (501) staff       (20)    19999 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/faq.rst
--rw-r--r--   0 james      (501) staff       (20)    25569 2023-05-19 15:53:47.000000 dask-2023.6.0/docs/source/futures.rst
--rw-r--r--   0 james      (501) staff       (20)     5820 2022-10-07 21:37:14.000000 dask-2023.6.0/docs/source/gpu.rst
--rw-r--r--   0 james      (501) staff       (20)     2541 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/graph_manipulation.rst
--rw-r--r--   0 james      (501) staff       (20)     5433 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/graphs.rst
--rw-r--r--   0 james      (501) staff       (20)     5399 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/graphviz.rst
--rw-r--r--   0 james      (501) staff       (20)     6946 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/high-level-graphs.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.222336 dask-2023.6.0/docs/source/how-to/
--rw-r--r--   0 james      (501) staff       (20)     4364 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/how-to/adaptive.rst
--rw-r--r--   0 james      (501) staff       (20)    15360 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/how-to/connect-to-remote-data.rst
--rw-r--r--   0 james      (501) staff       (20)     4209 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/how-to/customize-initialization.rst
--rw-r--r--   0 james      (501) staff       (20)    10859 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/how-to/debug.rst
--rw-r--r--   0 james      (501) staff       (20)     1722 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/how-to/extend-sizeof.rst
--rw-r--r--   0 james      (501) staff       (20)      433 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/how-to/index.rst
--rw-r--r--   0 james      (501) staff       (20)     4562 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/how-to/manage-environments.rst
--rw-r--r--   0 james      (501) staff       (20)     6680 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/how-to/selecting-the-collection-backend.rst
--rw-r--r--   0 james      (501) staff       (20)      902 2023-04-25 18:34:46.000000 dask-2023.6.0/docs/source/how-to/setup-prometheus.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.356478 dask-2023.6.0/docs/source/images/
--rw-r--r--   0 james      (501) staff       (20)    99565 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/10_minutes_array_graph.png
--rw-r--r--   0 james      (501) staff       (20)    22442 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/10_minutes_bag_graph.png
--rw-r--r--   0 james      (501) staff       (20)    56229 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/10_minutes_dataframe_graph.png
--rw-r--r--   0 james      (501) staff       (20)     4059 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/HHMI_Janelia_Color.png
--rw-r--r--   0 james      (501) staff       (20)    18406 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/array.svg
--rw-r--r--   0 james      (501) staff       (20)  1620104 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/async-embarrassing.gif
--rw-r--r--   0 james      (501) staff       (20)    10752 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/concurrent-futures-threaded.webp
--rw-r--r--   0 james      (501) staff       (20)   135129 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/crosstalk.svg
--rw-r--r--   0 james      (501) staff       (20)  2367087 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dashboard_jupyterlab.png
--rw-r--r--   0 james      (501) staff       (20)    37971 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dashboard_link.png
--rw-r--r--   0 james      (501) staff       (20)    68712 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dashboard_memory.png
--rw-r--r--   0 james      (501) staff       (20)   281018 2023-04-25 18:34:46.000000 dask-2023.6.0/docs/source/images/dashboard_memory_new.gif
--rw-r--r--   0 james      (501) staff       (20)    25435 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/images/dashboard_progress.png
--rw-r--r--   0 james      (501) staff       (20)   276928 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/images/dashboard_status.png
--rw-r--r--   0 james      (501) staff       (20)    12009 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/images/dashboard_task_processing.png
--rw-r--r--   0 james      (501) staff       (20)    58238 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dashboard_task_stream_unhealthy.png
--rw-r--r--   0 james      (501) staff       (20)   103654 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dashboard_taskstream_healthy.png
--rw-r--r--   0 james      (501) staff       (20)   112822 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/dask-adaptive.svg
--rw-r--r--   0 james      (501) staff       (20)    14645 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/dask-array.svg
--rw-r--r--   0 james      (501) staff       (20)   222084 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/dask-cluster-manager.svg
--rw-r--r--   0 james      (501) staff       (20)    18782 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/dask-dataframe.svg
--rw-r--r--   0 james      (501) staff       (20)   381903 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask-overview-distributed-callout.svg
--rw-r--r--   0 james      (501) staff       (20)   357643 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask-overview-schedulers.svg
--rw-r--r--   0 james      (501) staff       (20)    97471 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/dask-overview.svg
--rw-r--r--   0 james      (501) staff       (20)     3022 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_horizontal.svg
--rw-r--r--   0 james      (501) staff       (20)     3651 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_horizontal_black.svg
--rw-r--r--   0 james      (501) staff       (20)     3767 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_horizontal_on_blue.svg
--rw-r--r--   0 james      (501) staff       (20)     3738 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_horizontal_on_pink.svg
--rw-r--r--   0 james      (501) staff       (20)     3738 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_horizontal_white.svg
--rw-r--r--   0 james      (501) staff       (20)     1607 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_icon.svg
--rw-r--r--   0 james      (501) staff       (20)     1571 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_icon_black.svg
--rw-r--r--   0 james      (501) staff       (20)     1607 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_icon_on_pink.svg
--rw-r--r--   0 james      (501) staff       (20)     1609 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/dask_icon_white.svg
--rw-r--r--   0 james      (501) staff       (20)    20216 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/delayed-inc-double-add.svg
--rw-r--r--   0 james      (501) staff       (20)   104628 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/distributed-overview.svg
--rw-r--r--   0 james      (501) staff       (20)    18297 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/frame-shuffle.svg
--rw-r--r--   0 james      (501) staff       (20)    22979 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/frame-sort.svg
--rw-r--r--   0 james      (501) staff       (20)    12181 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/frame.svg
--rw-r--r--   0 james      (501) staff       (20)    41828 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/gputester-msg.png
--rw-r--r--   0 james      (501) staff       (20)   210392 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/growth_of_languages.png
--rw-r--r--   0 james      (501) staff       (20)   167834 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/growth_of_libraries.png
--rw-r--r--   0 james      (501) staff       (20)     4097 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/inc-add.svg
--rw-r--r--   0 james      (501) staff       (20)   123010 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/map-reduce-task-scheduling.svg
--rw-r--r--   0 james      (501) staff       (20)   482302 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/map_blocks_drop_axis.png
--rw-r--r--   0 james      (501) staff       (20)   113067 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/merge_chunks.png
--rw-r--r--   0 james      (501) staff       (20)    63244 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/merge_chunks_false.png
--rw-r--r--   0 james      (501) staff       (20)    13024 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/optimize_dask1.svg
--rw-r--r--   0 james      (501) staff       (20)     8803 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/optimize_dask2.svg
--rw-r--r--   0 james      (501) staff       (20)     5198 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/optimize_dask3.svg
--rw-r--r--   0 james      (501) staff       (20)     4104 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/optimize_dask4.svg
--rw-r--r--   0 james      (501) staff       (20)     2738 2021-11-11 17:33:01.000000 dask-2023.6.0/docs/source/images/optimize_dask5.svg
--rw-r--r--   0 james      (501) staff       (20)   292827 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/order-failure.png
--rw-r--r--   0 james      (501) staff       (20)   239828 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/order-success.png
--rw-r--r--   0 james      (501) staff       (20)    40833 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/overlap.svg
--rw-r--r--   0 james      (501) staff       (20)    18785 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/overlapping-blocks.svg
--rw-r--r--   0 james      (501) staff       (20)     4537 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/overlapping-neighbors.svg
--rw-r--r--   0 james      (501) staff       (20)    20533 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/pipeline.svg
--rw-r--r--   0 james      (501) staff       (20)    31576 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/reshape.png
--rw-r--r--   0 james      (501) staff       (20)    31410 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/reshape_problem.png
--rw-r--r--   0 james      (501) staff       (20)    33288 2021-11-11 20:27:17.000000 dask-2023.6.0/docs/source/images/reshape_rechunked.png
--rw-r--r--   0 james      (501) staff       (20)    50209 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/scaling-edges.png
--rw-r--r--   0 james      (501) staff       (20)    68476 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/scaling-nodes.png
--rw-r--r--   0 james      (501) staff       (20)    21294 2021-06-08 02:50:31.000000 dask-2023.6.0/docs/source/images/simple-dask.png
--rw-r--r--   0 james      (501) staff       (20)    27572 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/transpose-hlg-hovertooltip.png
--rw-r--r--   0 james      (501) staff       (20)    84492 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/images/transpose-hlg-html-repr.png
--rw-r--r--   0 james      (501) staff       (20)    39365 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/transpose.svg
--rw-r--r--   0 james      (501) staff       (20)    22446 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/transpose_opt.svg
--rw-r--r--   0 james      (501) staff       (20)   115022 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/images/trivial.svg
--rw-r--r--   0 james      (501) staff       (20)     2451 2021-06-08 02:51:08.000000 dask-2023.6.0/docs/source/images/unoverlapping-neighbors.svg
--rw-r--r--   0 james      (501) staff       (20)     6237 2023-03-13 17:40:25.000000 dask-2023.6.0/docs/source/index.rst
--rw-r--r--   0 james      (501) staff       (20)    15235 2023-05-31 15:34:32.000000 dask-2023.6.0/docs/source/install.rst
--rw-r--r--   0 james      (501) staff       (20)      341 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/internals.rst
--rw-r--r--   0 james      (501) staff       (20)      868 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/logos.rst
--rw-r--r--   0 james      (501) staff       (20)     3573 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/maintainers.rst
--rw-r--r--   0 james      (501) staff       (20)    12200 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/optimize.rst
--rw-r--r--   0 james      (501) staff       (20)     7119 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/order.rst
--rw-r--r--   0 james      (501) staff       (20)     4810 2022-10-07 21:37:14.000000 dask-2023.6.0/docs/source/phases-of-computation.rst
--rw-r--r--   0 james      (501) staff       (20)     5089 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/presentations.rst
--rw-r--r--   0 james      (501) staff       (20)     6010 2022-10-07 21:37:14.000000 dask-2023.6.0/docs/source/scheduler-overview.rst
--rw-r--r--   0 james      (501) staff       (20)     4493 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/scheduling-policy.rst
--rw-r--r--   0 james      (501) staff       (20)    11015 2023-05-31 15:34:32.000000 dask-2023.6.0/docs/source/scheduling.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-09 16:34:13.357454 dask-2023.6.0/docs/source/scripts/
--rw-r--r--   0 james      (501) staff       (20)     3294 2023-05-31 15:34:32.000000 dask-2023.6.0/docs/source/scripts/scheduling.py
--rw-r--r--   0 james      (501) staff       (20)     6104 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/shared.rst
--rw-r--r--   0 james      (501) staff       (20)     9342 2022-11-09 22:20:24.000000 dask-2023.6.0/docs/source/spark.rst
--rw-r--r--   0 james      (501) staff       (20)     3966 2022-10-07 21:37:14.000000 dask-2023.6.0/docs/source/spec.rst
--rw-r--r--   0 james      (501) staff       (20)     4754 2023-05-22 17:52:26.000000 dask-2023.6.0/docs/source/support.rst
--rw-r--r--   0 james      (501) staff       (20)     1831 2021-06-16 20:41:28.000000 dask-2023.6.0/docs/source/understanding-performance.rst
--rw-r--r--   0 james      (501) staff       (20)    12205 2023-05-03 18:02:08.000000 dask-2023.6.0/docs/source/user-interfaces.rst
--rw-r--r--   0 james      (501) staff       (20)    11744 2022-10-24 20:44:15.000000 dask-2023.6.0/docs/source/why.rst
--rw-r--r--   0 james      (501) staff       (20)     5526 2023-06-09 16:15:33.000000 dask-2023.6.0/pyproject.toml
--rw-r--r--   0 james      (501) staff       (20)       38 2023-06-09 16:34:13.359097 dask-2023.6.0/setup.cfg
--rwxr-xr-x   0 james      (501) staff       (20)      194 2023-05-03 18:02:08.000000 dask-2023.6.0/setup.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.887422 dask-2023.6.1/
+-rw-r--r--   0 james      (501) staff       (20)     1531 2022-10-24 20:44:15.000000 dask-2023.6.1/LICENSE.txt
+-rw-r--r--   0 james      (501) staff       (20)      325 2022-11-09 22:20:24.000000 dask-2023.6.1/MANIFEST.in
+-rw-r--r--   0 james      (501) staff       (20)     2532 2023-06-26 20:35:18.886731 dask-2023.6.1/PKG-INFO
+-rw-r--r--   0 james      (501) staff       (20)     1291 2022-11-09 22:20:24.000000 dask-2023.6.1/README.rst
+-rw-r--r--   0 james      (501) staff       (20)     2397 2023-05-31 15:34:32.000000 dask-2023.6.1/conftest.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.888063 dask-2023.6.1/dask/
+-rw-r--r--   0 james      (501) staff       (20)      485 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      133 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/__main__.py
+-rw-r--r--   0 james      (501) staff       (20)      643 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/_compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)      500 2023-06-26 20:35:18.888173 dask-2023.6.1/dask/_version.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.898656 dask-2023.6.1/dask/array/
+-rw-r--r--   0 james      (501) staff       (20)     1543 2021-06-08 02:50:30.000000 dask-2023.6.1/dask/array/NUMPY_LICENSE.txt
+-rw-r--r--   0 james      (501) staff       (20)     5413 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12600 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/backends.py
+-rw-r--r--   0 james      (501) staff       (20)     9983 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/blockwise.py
+-rw-r--r--   0 james      (501) staff       (20)    12304 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/chunk.py
+-rw-r--r--   0 james      (501) staff       (20)     5066 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/chunk_types.py
+-rw-r--r--   0 james      (501) staff       (20)   190831 2023-06-26 19:07:05.000000 dask-2023.6.1/dask/array/core.py
+-rw-r--r--   0 james      (501) staff       (20)    40564 2023-05-03 18:02:08.000000 dask-2023.6.1/dask/array/creation.py
+-rw-r--r--   0 james      (501) staff       (20)     2114 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/cupy_entry_point.py
+-rw-r--r--   0 james      (501) staff       (20)      526 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)     9146 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/array/einsumfuncs.py
+-rw-r--r--   0 james      (501) staff       (20)     7252 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/fft.py
+-rw-r--r--   0 james      (501) staff       (20)    32656 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     1996 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/image.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.901445 dask-2023.6.1/dask/array/lib/
+-rw-r--r--   0 james      (501) staff       (20)       77 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/lib/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      101 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/lib/stride_tricks.py
+-rw-r--r--   0 james      (501) staff       (20)    53335 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/linalg.py
+-rw-r--r--   0 james      (501) staff       (20)     6363 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/ma.py
+-rw-r--r--   0 james      (501) staff       (20)     5699 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/numpy_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    12838 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    28480 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/overlap.py
+-rw-r--r--   0 james      (501) staff       (20)    10652 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/percentile.py
+-rw-r--r--   0 james      (501) staff       (20)    40604 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/random.py
+-rw-r--r--   0 james      (501) staff       (20)    28324 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/array/rechunk.py
+-rw-r--r--   0 james      (501) staff       (20)    57287 2023-06-01 20:02:33.000000 dask-2023.6.1/dask/array/reductions.py
+-rw-r--r--   0 james      (501) staff       (20)    10765 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    81977 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/array/routines.py
+-rw-r--r--   0 james      (501) staff       (20)    72631 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/slicing.py
+-rw-r--r--   0 james      (501) staff       (20)    14613 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/stats.py
+-rw-r--r--   0 james      (501) staff       (20)     8048 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/svg.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.957984 dask-2023.6.1/dask/array/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/array/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)   161461 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_array_core.py
+-rw-r--r--   0 james      (501) staff       (20)     6689 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_array_function.py
+-rw-r--r--   0 james      (501) staff       (20)     3159 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_array_utils.py
+-rw-r--r--   0 james      (501) staff       (20)    23222 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_atop.py
+-rw-r--r--   0 james      (501) staff       (20)     3304 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_chunk.py
+-rw-r--r--   0 james      (501) staff       (20)    31150 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_creation.py
+-rw-r--r--   0 james      (501) staff       (20)    19888 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_core.py
+-rw-r--r--   0 james      (501) staff       (20)     6456 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_creation.py
+-rw-r--r--   0 james      (501) staff       (20)      594 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    13412 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_linalg.py
+-rw-r--r--   0 james      (501) staff       (20)     4303 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_overlap.py
+-rw-r--r--   0 james      (501) staff       (20)     2862 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_percentile.py
+-rw-r--r--   0 james      (501) staff       (20)     9219 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_random.py
+-rw-r--r--   0 james      (501) staff       (20)     2224 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_reductions.py
+-rw-r--r--   0 james      (501) staff       (20)     7437 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_routines.py
+-rw-r--r--   0 james      (501) staff       (20)     4877 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_slicing.py
+-rw-r--r--   0 james      (501) staff       (20)     2982 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_cupy_sparse.py
+-rw-r--r--   0 james      (501) staff       (20)     8865 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)     8437 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_fft.py
+-rw-r--r--   0 james      (501) staff       (20)    21013 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     1482 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_image.py
+-rw-r--r--   0 james      (501) staff       (20)    36448 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_linalg.py
+-rw-r--r--   0 james      (501) staff       (20)    15635 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_masked.py
+-rw-r--r--   0 james      (501) staff       (20)     1087 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_numpy_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    17446 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    26718 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_overlap.py
+-rw-r--r--   0 james      (501) staff       (20)     3443 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_percentiles.py
+-rw-r--r--   0 james      (501) staff       (20)    15353 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_random.py
+-rw-r--r--   0 james      (501) staff       (20)    36262 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/array/tests/test_rechunk.py
+-rw-r--r--   0 james      (501) staff       (20)    32756 2023-06-01 20:02:33.000000 dask-2023.6.1/dask/array/tests/test_reductions.py
+-rw-r--r--   0 james      (501) staff       (20)     7289 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    83849 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_routines.py
+-rw-r--r--   0 james      (501) staff       (20)    32302 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_slicing.py
+-rw-r--r--   0 james      (501) staff       (20)     6592 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_sparse.py
+-rw-r--r--   0 james      (501) staff       (20)     5489 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_stats.py
+-rw-r--r--   0 james      (501) staff       (20)     2740 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_svg.py
+-rw-r--r--   0 james      (501) staff       (20)      525 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_testing.py
+-rw-r--r--   0 james      (501) staff       (20)    17390 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     2706 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_wrap.py
+-rw-r--r--   0 james      (501) staff       (20)     1317 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tests/test_xarray.py
+-rw-r--r--   0 james      (501) staff       (20)     4737 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/tiledb_io.py
+-rw-r--r--   0 james      (501) staff       (20)     9943 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    18674 2023-06-26 19:11:47.000000 dask-2023.6.1/dask/array/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     6906 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/array/wrap.py
+-rw-r--r--   0 james      (501) staff       (20)     4936 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/backends.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.970157 dask-2023.6.1/dask/bag/
+-rw-r--r--   0 james      (501) staff       (20)      903 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     9111 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/avro.py
+-rw-r--r--   0 james      (501) staff       (20)      763 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/chunk.py
+-rw-r--r--   0 james      (501) staff       (20)    84737 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/bag/core.py
+-rw-r--r--   0 james      (501) staff       (20)     5464 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/random.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.983016 dask-2023.6.1/dask/bag/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/bag/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     3808 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/tests/test_avro.py
+-rw-r--r--   0 james      (501) staff       (20)    51087 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/bag/tests/test_bag.py
+-rw-r--r--   0 james      (501) staff       (20)     6528 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/tests/test_random.py
+-rw-r--r--   0 james      (501) staff       (20)     5049 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/tests/test_text.py
+-rw-r--r--   0 james      (501) staff       (20)     6765 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/text.py
+-rw-r--r--   0 james      (501) staff       (20)      241 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bag/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    53615 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/base.py
+-rw-r--r--   0 james      (501) staff       (20)    53252 2023-05-19 15:53:47.000000 dask-2023.6.1/dask/blockwise.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.987409 dask-2023.6.1/dask/bytes/
+-rw-r--r--   0 james      (501) staff       (20)       75 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     6933 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/core.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.992293 dask-2023.6.1/dask/bytes/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/bytes/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     5158 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/tests/test_bytes_utils.py
+-rw-r--r--   0 james      (501) staff       (20)      530 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/tests/test_compression.py
+-rw-r--r--   0 james      (501) staff       (20)     6657 2023-05-03 18:02:08.000000 dask-2023.6.1/dask/bytes/tests/test_http.py
+-rw-r--r--   0 james      (501) staff       (20)    11476 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/tests/test_local.py
+-rw-r--r--   0 james      (501) staff       (20)    19667 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/tests/test_s3.py
+-rw-r--r--   0 james      (501) staff       (20)      500 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/bytes/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     2001 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/cache.py
+-rw-r--r--   0 james      (501) staff       (20)     4067 2022-10-24 20:44:15.000000 dask-2023.6.1/dask/callbacks.py
+-rw-r--r--   0 james      (501) staff       (20)     3064 2023-06-09 16:12:58.000000 dask-2023.6.1/dask/cli.py
+-rw-r--r--   0 james      (501) staff       (20)      523 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)    21703 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/config.py
+-rw-r--r--   0 james      (501) staff       (20)     1756 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/context.py
+-rw-r--r--   0 james      (501) staff       (20)    14833 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/core.py
+-rw-r--r--   0 james      (501) staff       (20)     8050 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/dask-schema.yaml
+-rw-r--r--   0 james      (501) staff       (20)     2123 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/dask.yaml
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.046841 dask-2023.6.1/dask/dataframe/
+-rw-r--r--   0 james      (501) staff       (20)     1812 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     7496 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/_compat.py
+-rw-r--r--   0 james      (501) staff       (20)     2171 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/_dtypes.py
+-rw-r--r--   0 james      (501) staff       (20)     3219 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/_pyarrow.py
+-rw-r--r--   0 james      (501) staff       (20)     1936 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/_pyarrow_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    12101 2023-05-03 18:02:08.000000 dask-2023.6.1/dask/dataframe/accessor.py
+-rw-r--r--   0 james      (501) staff       (20)    24817 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/backends.py
+-rw-r--r--   0 james      (501) staff       (20)     9507 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/categorical.py
+-rw-r--r--   0 james      (501) staff       (20)   302040 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/core.py
+-rw-r--r--   0 james      (501) staff       (20)     4609 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/dataframe/dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)      552 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/extensions.py
+-rw-r--r--   0 james      (501) staff       (20)   115648 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/groupby.py
+-rw-r--r--   0 james      (501) staff       (20)     2463 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/hyperloglog.py
+-rw-r--r--   0 james      (501) staff       (20)    13412 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/indexing.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.054445 dask-2023.6.1/dask/dataframe/io/
+-rw-r--r--   0 james      (501) staff       (20)      706 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    33854 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/io/csv.py
+-rw-r--r--   0 james      (501) staff       (20)     5781 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/demo.py
+-rw-r--r--   0 james      (501) staff       (20)    18275 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/dataframe/io/hdf.py
+-rw-r--r--   0 james      (501) staff       (20)    38487 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/io.py
+-rw-r--r--   0 james      (501) staff       (20)    11163 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/json.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.058095 dask-2023.6.1/dask/dataframe/io/orc/
+-rw-r--r--   0 james      (501) staff       (20)       92 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/orc/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     4487 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/orc/arrow.py
+-rw-r--r--   0 james      (501) staff       (20)     7098 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/orc/core.py
+-rw-r--r--   0 james      (501) staff       (20)      510 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/orc/utils.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.062579 dask-2023.6.1/dask/dataframe/io/parquet/
+-rw-r--r--   0 james      (501) staff       (20)      166 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/parquet/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    71237 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/parquet/arrow.py
+-rw-r--r--   0 james      (501) staff       (20)    67195 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/io/parquet/core.py
+-rw-r--r--   0 james      (501) staff       (20)    52426 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/parquet/fastparquet.py
+-rw-r--r--   0 james      (501) staff       (20)    32896 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/parquet/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    21108 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/sql.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.080047 dask-2023.6.1/dask/dataframe/io/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-03-07 20:03:52.000000 dask-2023.6.1/dask/dataframe/io/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    59293 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/io/tests/test_csv.py
+-rw-r--r--   0 james      (501) staff       (20)     5036 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_demo.py
+-rw-r--r--   0 james      (501) staff       (20)    27232 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_hdf.py
+-rw-r--r--   0 james      (501) staff       (20)    34438 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_io.py
+-rw-r--r--   0 james      (501) staff       (20)     8625 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_json.py
+-rw-r--r--   0 james      (501) staff       (20)     5238 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_orc.py
+-rw-r--r--   0 james      (501) staff       (20)   165615 2023-06-01 18:18:42.000000 dask-2023.6.1/dask/dataframe/io/tests/test_parquet.py
+-rw-r--r--   0 james      (501) staff       (20)    17632 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/io/tests/test_sql.py
+-rw-r--r--   0 james      (501) staff       (20)     8041 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/dataframe/io/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    14071 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/methods.py
+-rw-r--r--   0 james      (501) staff       (20)    53878 2023-06-20 19:59:21.000000 dask-2023.6.1/dask/dataframe/multi.py
+-rw-r--r--   0 james      (501) staff       (20)     1600 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/numeric.py
+-rw-r--r--   0 james      (501) staff       (20)     8778 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/optimize.py
+-rw-r--r--   0 james      (501) staff       (20)    20044 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/partitionquantiles.py
+-rw-r--r--   0 james      (501) staff       (20)    11825 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    22185 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/rolling.py
+-rw-r--r--   0 james      (501) staff       (20)    38085 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/shuffle.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.148111 dask-2023.6.1/dask/dataframe/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/dataframe/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    10633 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_accessors.py
+-rw-r--r--   0 james      (501) staff       (20)    67628 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_arithmetics_reduction.py
+-rw-r--r--   0 james      (501) staff       (20)      942 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_boolean.py
+-rw-r--r--   0 james      (501) staff       (20)    16678 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_categorical.py
+-rw-r--r--   0 james      (501) staff       (20)   194150 2023-06-26 20:12:39.000000 dask-2023.6.1/dask/dataframe/tests/test_dataframe.py
+-rw-r--r--   0 james      (501) staff       (20)     1456 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_extensions.py
+-rw-r--r--   0 james      (501) staff       (20)    14743 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_format.py
+-rw-r--r--   0 james      (501) staff       (20)   121785 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/tests/test_groupby.py
+-rw-r--r--   0 james      (501) staff       (20)     2702 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_hashing.py
+-rw-r--r--   0 james      (501) staff       (20)     2897 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_hyperloglog.py
+-rw-r--r--   0 james      (501) staff       (20)    22382 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_indexing.py
+-rw-r--r--   0 james      (501) staff       (20)     7034 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_merge_column_and_index.py
+-rw-r--r--   0 james      (501) staff       (20)      463 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_methods.py
+-rw-r--r--   0 james      (501) staff       (20)    91017 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_multi.py
+-rw-r--r--   0 james      (501) staff       (20)     2120 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_numeric.py
+-rw-r--r--   0 james      (501) staff       (20)     1067 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_optimize_dataframe.py
+-rw-r--r--   0 james      (501) staff       (20)     6662 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_pyarrow.py
+-rw-r--r--   0 james      (501) staff       (20)     4550 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_pyarrow_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    11571 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    17524 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_rolling.py
+-rw-r--r--   0 james      (501) staff       (20)    54512 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/dataframe/tests/test_shuffle.py
+-rw-r--r--   0 james      (501) staff       (20)    16595 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    21288 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tests/test_utils_dataframe.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.150003 dask-2023.6.1/dask/dataframe/tseries/
+-rw-r--r--   0 james      (501) staff       (20)        0 2021-06-08 02:50:30.000000 dask-2023.6.1/dask/dataframe/tseries/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     7664 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tseries/resample.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.152568 dask-2023.6.1/dask/dataframe/tseries/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/dataframe/tseries/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     6866 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/tseries/tests/test_resample.py
+-rw-r--r--   0 james      (501) staff       (20)    27404 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/dataframe/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     5314 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/datasets.py
+-rw-r--r--   0 james      (501) staff       (20)    24389 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/delayed.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.155412 dask-2023.6.1/dask/diagnostics/
+-rw-r--r--   0 james      (501) staff       (20)      258 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12136 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/profile.py
+-rw-r--r--   0 james      (501) staff       (20)    16332 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/profile_visualize.py
+-rw-r--r--   0 james      (501) staff       (20)     5001 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/progress.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.159897 dask-2023.6.1/dask/diagnostics/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-02-04 20:18:56.000000 dask-2023.6.1/dask/diagnostics/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12045 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/tests/test_profiler.py
+-rw-r--r--   0 james      (501) staff       (20)     3388 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/diagnostics/tests/test_progress.py
+-rw-r--r--   0 james      (501) staff       (20)      715 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/distributed.py
+-rw-r--r--   0 james      (501) staff       (20)    16587 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/dot.py
+-rw-r--r--   0 james      (501) staff       (20)    19595 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/graph_manipulation.py
+-rw-r--r--   0 james      (501) staff       (20)     2492 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/hashing.py
+-rw-r--r--   0 james      (501) staff       (20)    34778 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/highlevelgraph.py
+-rw-r--r--   0 james      (501) staff       (20)    46007 2023-05-03 18:02:08.000000 dask-2023.6.1/dask/layers.py
+-rw-r--r--   0 james      (501) staff       (20)    18888 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/local.py
+-rw-r--r--   0 james      (501) staff       (20)      487 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/ml.py
+-rw-r--r--   0 james      (501) staff       (20)     8466 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/multiprocessing.py
+-rw-r--r--   0 james      (501) staff       (20)    35638 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    45768 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/order.py
+-rw-r--r--   0 james      (501) staff       (20)        0 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/py.typed
+-rw-r--r--   0 james      (501) staff       (20)    12597 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/rewrite.py
+-rw-r--r--   0 james      (501) staff       (20)     7298 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/sizeof.py
+-rw-r--r--   0 james      (501) staff       (20)     1510 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/system.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.249336 dask-2023.6.1/dask/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-03-07 20:04:31.000000 dask-2023.6.1/dask/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      742 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_backends.py
+-rw-r--r--   0 james      (501) staff       (20)    51124 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_base.py
+-rw-r--r--   0 james      (501) staff       (20)     1613 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_cache.py
+-rw-r--r--   0 james      (501) staff       (20)     2570 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_callbacks.py
+-rw-r--r--   0 james      (501) staff       (20)     1199 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_ci.py
+-rw-r--r--   0 james      (501) staff       (20)     3257 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/tests/test_cli.py
+-rw-r--r--   0 james      (501) staff       (20)      379 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)    17846 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_config.py
+-rw-r--r--   0 james      (501) staff       (20)     1137 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_context.py
+-rw-r--r--   0 james      (501) staff       (20)     7422 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_core.py
+-rw-r--r--   0 james      (501) staff       (20)     1112 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_datasets.py
+-rw-r--r--   0 james      (501) staff       (20)    22989 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_delayed.py
+-rw-r--r--   0 james      (501) staff       (20)    35741 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/tests/test_distributed.py
+-rw-r--r--   0 james      (501) staff       (20)      925 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_docs.py
+-rw-r--r--   0 james      (501) staff       (20)    12271 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_dot.py
+-rw-r--r--   0 james      (501) staff       (20)    15070 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_graph_manipulation.py
+-rw-r--r--   0 james      (501) staff       (20)     1095 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_hashing.py
+-rw-r--r--   0 james      (501) staff       (20)     8860 2023-06-26 19:01:25.000000 dask-2023.6.1/dask/tests/test_highgraph.py
+-rw-r--r--   0 james      (501) staff       (20)     9341 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_layers.py
+-rw-r--r--   0 james      (501) staff       (20)     5008 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_local.py
+-rw-r--r--   0 james      (501) staff       (20)      419 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_ml.py
+-rw-r--r--   0 james      (501) staff       (20)     8457 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_multiprocessing.py
+-rw-r--r--   0 james      (501) staff       (20)    45227 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    28229 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_order.py
+-rw-r--r--   0 james      (501) staff       (20)     4684 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_rewrite.py
+-rw-r--r--   0 james      (501) staff       (20)     7518 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_sizeof.py
+-rw-r--r--   0 james      (501) staff       (20)     7154 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_spark_compat.py
+-rw-r--r--   0 james      (501) staff       (20)     1397 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_system.py
+-rw-r--r--   0 james      (501) staff       (20)     4749 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_threaded.py
+-rw-r--r--   0 james      (501) staff       (20)     5670 2023-04-25 18:34:46.000000 dask-2023.6.1/dask/tests/test_typing.py
+-rw-r--r--   0 james      (501) staff       (20)    23807 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/tests/test_utils.py
+-rw-r--r--   0 james      (501) staff       (20)     1598 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/test_utils_test.py
+-rw-r--r--   0 james      (501) staff       (20)      211 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/tests/warning_aliases.py
+-rw-r--r--   0 james      (501) staff       (20)     2993 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/threaded.py
+-rw-r--r--   0 james      (501) staff       (20)    14538 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/typing.py
+-rw-r--r--   0 james      (501) staff       (20)    57828 2023-06-20 20:00:03.000000 dask-2023.6.1/dask/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     4825 2023-04-11 17:13:14.000000 dask-2023.6.1/dask/utils_test.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.250978 dask-2023.6.1/dask/widgets/
+-rw-r--r--   0 james      (501) staff       (20)      792 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/widgets/__init__.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.260029 dask-2023.6.1/dask/widgets/templates/
+-rw-r--r--   0 james      (501) staff       (20)     1295 2023-03-13 17:40:25.000000 dask-2023.6.1/dask/widgets/templates/array.html.j2
+-rw-r--r--   0 james      (501) staff       (20)      124 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/widgets/templates/dataframe.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     2579 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/widgets/templates/highlevelgraph.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     1981 2022-11-09 22:20:24.000000 dask-2023.6.1/dask/widgets/templates/highlevelgraph_layer.html.j2
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.261190 dask-2023.6.1/dask/widgets/tests/
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.273922 dask-2023.6.1/dask/widgets/tests/templates/
+-rw-r--r--   0 james      (501) staff       (20)       38 2022-10-24 20:44:15.000000 dask-2023.6.1/dask/widgets/tests/templates/bytes.html.j2
+-rw-r--r--   0 james      (501) staff       (20)       39 2022-10-24 20:44:15.000000 dask-2023.6.1/dask/widgets/tests/templates/custom_filter.html.j2
+-rw-r--r--   0 james      (501) staff       (20)       30 2022-10-24 20:44:15.000000 dask-2023.6.1/dask/widgets/tests/templates/example.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     1401 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/widgets/tests/test_widgets.py
+-rw-r--r--   0 james      (501) staff       (20)     1120 2023-05-31 15:34:32.000000 dask-2023.6.1/dask/widgets/widgets.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:17.805063 dask-2023.6.1/dask.egg-info/
+-rw-r--r--   0 james      (501) staff       (20)     2532 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/PKG-INFO
+-rw-r--r--   0 james      (501) staff       (20)    13939 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/SOURCES.txt
+-rw-r--r--   0 james      (501) staff       (20)        1 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/dependency_links.txt
+-rw-r--r--   0 james      (501) staff       (20)      124 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/entry_points.txt
+-rw-r--r--   0 james      (501) staff       (20)        1 2023-06-26 20:35:15.000000 dask-2023.6.1/dask.egg-info/not-zip-safe
+-rw-r--r--   0 james      (501) staff       (20)      454 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/requires.txt
+-rw-r--r--   0 james      (501) staff       (20)        5 2023-06-26 20:35:17.000000 dask-2023.6.1/dask.egg-info/top_level.txt
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.281620 dask-2023.6.1/docs/
+-rw-r--r--   0 james      (501) staff       (20)     5741 2023-03-22 19:03:53.000000 dask-2023.6.1/docs/Makefile
+-rw-r--r--   0 james      (501) staff       (20)     5186 2022-08-08 20:45:08.000000 dask-2023.6.1/docs/make.bat
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.501026 dask-2023.6.1/docs/source/
+-rw-r--r--   0 james      (501) staff       (20)    17598 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/10-minutes-to-dask.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.516335 dask-2023.6.1/docs/source/_static/
+-rw-r--r--   0 james      (501) staff       (20)    10187 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/_static/config_converter.js
+-rw-r--r--   0 james      (501) staff       (20)    11021 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/_static/dask-simple.png
+-rw-r--r--   0 james      (501) staff       (20)     2375 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/_static/main-page.css
+-rw-r--r--   0 james      (501) staff       (20)    15598 2022-08-08 20:45:08.000000 dask-2023.6.1/docs/source/_static/profile.html
+-rw-r--r--   0 james      (501) staff       (20)    65304 2022-08-08 20:45:08.000000 dask-2023.6.1/docs/source/_static/stacked_profile.html
+-rw-r--r--   0 james      (501) staff       (20)      523 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/_static/style.css
+-rw-r--r--   0 james      (501) staff       (20)      365 2021-06-16 20:41:28.000000 dask-2023.6.1/docs/source/_static/theme_overrides.css
+-rw-r--r--   0 james      (501) staff       (20)   292662 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/_static/transpose_cyto.html
+-rw-r--r--   0 james      (501) staff       (20)    49423 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/_static/yaml.min.js
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.518987 dask-2023.6.1/docs/source/_templates/
+-rw-r--r--   0 james      (501) staff       (20)      180 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/_templates/layout.html
+-rw-r--r--   0 james      (501) staff       (20)     2269 2023-06-26 19:01:25.000000 dask-2023.6.1/docs/source/api.rst
+-rw-r--r--   0 james      (501) staff       (20)     6968 2023-05-24 15:39:04.000000 dask-2023.6.1/docs/source/array-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     2943 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/array-assignment.rst
+-rw-r--r--   0 james      (501) staff       (20)     4740 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/array-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)    13035 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-chunks.rst
+-rw-r--r--   0 james      (501) staff       (20)    18437 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-creation.rst
+-rw-r--r--   0 james      (501) staff       (20)     5885 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-design.rst
+-rw-r--r--   0 james      (501) staff       (20)     2857 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-gufunc.rst
+-rw-r--r--   0 james      (501) staff       (20)     6069 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/array-overlap.rst
+-rw-r--r--   0 james      (501) staff       (20)     3924 2023-05-19 15:53:47.000000 dask-2023.6.1/docs/source/array-random.rst
+-rw-r--r--   0 james      (501) staff       (20)     4137 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/array-slicing.rst
+-rw-r--r--   0 james      (501) staff       (20)     3291 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-sparse.rst
+-rw-r--r--   0 james      (501) staff       (20)     2018 2022-10-07 21:37:36.000000 dask-2023.6.1/docs/source/array-stack.rst
+-rw-r--r--   0 james      (501) staff       (20)     1140 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array-stats.rst
+-rw-r--r--   0 james      (501) staff       (20)     4121 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/array.rst
+-rw-r--r--   0 james      (501) staff       (20)     1574 2022-08-08 20:45:08.000000 dask-2023.6.1/docs/source/bag-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     4557 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/bag-creation.rst
+-rw-r--r--   0 james      (501) staff       (20)     4068 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/bag.rst
+-rw-r--r--   0 james      (501) staff       (20)    14050 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     5553 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/caching.rst
+-rw-r--r--   0 james      (501) staff       (20)   307786 2023-06-26 20:27:35.000000 dask-2023.6.1/docs/source/changelog.rst
+-rw-r--r--   0 james      (501) staff       (20)      211 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/cheatsheet.rst
+-rw-r--r--   0 james      (501) staff       (20)     4047 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/cli.rst
+-rw-r--r--   0 james      (501) staff       (20)    15465 2023-03-13 20:41:19.000000 dask-2023.6.1/docs/source/conf.py
+-rw-r--r--   0 james      (501) staff       (20)    16654 2023-04-06 21:35:01.000000 dask-2023.6.1/docs/source/configuration.rst
+-rw-r--r--   0 james      (501) staff       (20)    18651 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/custom-collections.rst
+-rw-r--r--   0 james      (501) staff       (20)     3604 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/custom-graphs.rst
+-rw-r--r--   0 james      (501) staff       (20)      932 2023-05-31 15:34:32.000000 dask-2023.6.1/docs/source/dashboard-progress-script.py
+-rw-r--r--   0 james      (501) staff       (20)    15045 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/dashboard.rst
+-rw-r--r--   0 james      (501) staff       (20)   203552 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/daskcheatsheet.pdf
+-rw-r--r--   0 james      (501) staff       (20)    13611 2023-06-26 19:01:25.000000 dask-2023.6.1/docs/source/dataframe-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     9611 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/dataframe-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     3951 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/dataframe-categoricals.rst
+-rw-r--r--   0 james      (501) staff       (20)     5967 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/dataframe-create.rst
+-rw-r--r--   0 james      (501) staff       (20)     5002 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/dataframe-design.rst
+-rw-r--r--   0 james      (501) staff       (20)     6224 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/dataframe-extend.rst
+-rw-r--r--   0 james      (501) staff       (20)     8050 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/dataframe-groupby.rst
+-rw-r--r--   0 james      (501) staff       (20)     6115 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/dataframe-indexing.rst
+-rw-r--r--   0 james      (501) staff       (20)     3454 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/dataframe-joins.rst
+-rw-r--r--   0 james      (501) staff       (20)    10952 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/dataframe-parquet.rst
+-rw-r--r--   0 james      (501) staff       (20)    12661 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/dataframe-sql.rst
+-rw-r--r--   0 james      (501) staff       (20)     7772 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/dataframe.rst
+-rw-r--r--   0 james      (501) staff       (20)      363 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/debugging-performance.rst
+-rw-r--r--   0 james      (501) staff       (20)     1696 2022-08-08 20:45:08.000000 dask-2023.6.1/docs/source/delayed-api.rst
+-rw-r--r--   0 james      (501) staff       (20)    17616 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/delayed-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     1497 2022-10-07 21:37:36.000000 dask-2023.6.1/docs/source/delayed-collections.rst
+-rw-r--r--   0 james      (501) staff       (20)     6357 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/delayed.rst
+-rw-r--r--   0 james      (501) staff       (20)     3620 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/deploying-cli.rst
+-rw-r--r--   0 james      (501) staff       (20)     3012 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/deploying-cloud.rst
+-rw-r--r--   0 james      (501) staff       (20)     2868 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/deploying-docker.rst
+-rw-r--r--   0 james      (501) staff       (20)     9939 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/deploying-hpc.rst
+-rw-r--r--   0 james      (501) staff       (20)     4001 2023-05-19 15:53:47.000000 dask-2023.6.1/docs/source/deploying-kubernetes.rst
+-rw-r--r--   0 james      (501) staff       (20)     5823 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/deploying-python-advanced.rst
+-rw-r--r--   0 james      (501) staff       (20)     2839 2023-04-25 18:34:46.000000 dask-2023.6.1/docs/source/deploying-python.rst
+-rw-r--r--   0 james      (501) staff       (20)     1619 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/deploying-ssh.rst
+-rw-r--r--   0 james      (501) staff       (20)     7356 2023-06-12 20:31:35.000000 dask-2023.6.1/docs/source/deploying.rst
+-rw-r--r--   0 james      (501) staff       (20)    10873 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/deployment-considerations.rst
+-rw-r--r--   0 james      (501) staff       (20)    13144 2023-05-31 15:34:32.000000 dask-2023.6.1/docs/source/develop.rst
+-rw-r--r--   0 james      (501) staff       (20)     4442 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/diagnostics-distributed.rst
+-rw-r--r--   0 james      (501) staff       (20)    10407 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/diagnostics-local.rst
+-rw-r--r--   0 james      (501) staff       (20)     4364 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/ecosystem.rst
+-rw-r--r--   0 james      (501) staff       (20)    19999 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/faq.rst
+-rw-r--r--   0 james      (501) staff       (20)    25569 2023-05-19 15:53:47.000000 dask-2023.6.1/docs/source/futures.rst
+-rw-r--r--   0 james      (501) staff       (20)     5820 2022-10-07 21:37:14.000000 dask-2023.6.1/docs/source/gpu.rst
+-rw-r--r--   0 james      (501) staff       (20)     2541 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/graph_manipulation.rst
+-rw-r--r--   0 james      (501) staff       (20)     5433 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/graphs.rst
+-rw-r--r--   0 james      (501) staff       (20)     5399 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/graphviz.rst
+-rw-r--r--   0 james      (501) staff       (20)     6946 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/high-level-graphs.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.545005 dask-2023.6.1/docs/source/how-to/
+-rw-r--r--   0 james      (501) staff       (20)     4364 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/how-to/adaptive.rst
+-rw-r--r--   0 james      (501) staff       (20)    15360 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/how-to/connect-to-remote-data.rst
+-rw-r--r--   0 james      (501) staff       (20)     4209 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/how-to/customize-initialization.rst
+-rw-r--r--   0 james      (501) staff       (20)    10859 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/how-to/debug.rst
+-rw-r--r--   0 james      (501) staff       (20)     1722 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/how-to/extend-sizeof.rst
+-rw-r--r--   0 james      (501) staff       (20)      433 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/how-to/index.rst
+-rw-r--r--   0 james      (501) staff       (20)     4562 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/how-to/manage-environments.rst
+-rw-r--r--   0 james      (501) staff       (20)     6680 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/how-to/selecting-the-collection-backend.rst
+-rw-r--r--   0 james      (501) staff       (20)      902 2023-04-25 18:34:46.000000 dask-2023.6.1/docs/source/how-to/setup-prometheus.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.882548 dask-2023.6.1/docs/source/images/
+-rw-r--r--   0 james      (501) staff       (20)    99565 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/10_minutes_array_graph.png
+-rw-r--r--   0 james      (501) staff       (20)    22442 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/10_minutes_bag_graph.png
+-rw-r--r--   0 james      (501) staff       (20)    56229 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/10_minutes_dataframe_graph.png
+-rw-r--r--   0 james      (501) staff       (20)     4059 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/HHMI_Janelia_Color.png
+-rw-r--r--   0 james      (501) staff       (20)    18406 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/array.svg
+-rw-r--r--   0 james      (501) staff       (20)  1620104 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/async-embarrassing.gif
+-rw-r--r--   0 james      (501) staff       (20)    10752 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/concurrent-futures-threaded.webp
+-rw-r--r--   0 james      (501) staff       (20)   135129 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/crosstalk.svg
+-rw-r--r--   0 james      (501) staff       (20)  2367087 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dashboard_jupyterlab.png
+-rw-r--r--   0 james      (501) staff       (20)    37971 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dashboard_link.png
+-rw-r--r--   0 james      (501) staff       (20)    68712 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dashboard_memory.png
+-rw-r--r--   0 james      (501) staff       (20)   281018 2023-04-25 18:34:46.000000 dask-2023.6.1/docs/source/images/dashboard_memory_new.gif
+-rw-r--r--   0 james      (501) staff       (20)    25435 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/images/dashboard_progress.png
+-rw-r--r--   0 james      (501) staff       (20)   276928 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/images/dashboard_status.png
+-rw-r--r--   0 james      (501) staff       (20)    12009 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/images/dashboard_task_processing.png
+-rw-r--r--   0 james      (501) staff       (20)    58238 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dashboard_task_stream_unhealthy.png
+-rw-r--r--   0 james      (501) staff       (20)   103654 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dashboard_taskstream_healthy.png
+-rw-r--r--   0 james      (501) staff       (20)   112822 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/dask-adaptive.svg
+-rw-r--r--   0 james      (501) staff       (20)    14645 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/dask-array.svg
+-rw-r--r--   0 james      (501) staff       (20)   222084 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/dask-cluster-manager.svg
+-rw-r--r--   0 james      (501) staff       (20)    18782 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/dask-dataframe.svg
+-rw-r--r--   0 james      (501) staff       (20)   381903 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask-overview-distributed-callout.svg
+-rw-r--r--   0 james      (501) staff       (20)   357643 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask-overview-schedulers.svg
+-rw-r--r--   0 james      (501) staff       (20)    97471 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/dask-overview.svg
+-rw-r--r--   0 james      (501) staff       (20)     3022 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_horizontal.svg
+-rw-r--r--   0 james      (501) staff       (20)     3651 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_horizontal_black.svg
+-rw-r--r--   0 james      (501) staff       (20)     3767 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_horizontal_on_blue.svg
+-rw-r--r--   0 james      (501) staff       (20)     3738 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_horizontal_on_pink.svg
+-rw-r--r--   0 james      (501) staff       (20)     3738 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_horizontal_white.svg
+-rw-r--r--   0 james      (501) staff       (20)     1607 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_icon.svg
+-rw-r--r--   0 james      (501) staff       (20)     1571 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_icon_black.svg
+-rw-r--r--   0 james      (501) staff       (20)     1607 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_icon_on_pink.svg
+-rw-r--r--   0 james      (501) staff       (20)     1609 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/dask_icon_white.svg
+-rw-r--r--   0 james      (501) staff       (20)    20216 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/delayed-inc-double-add.svg
+-rw-r--r--   0 james      (501) staff       (20)   104628 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/distributed-overview.svg
+-rw-r--r--   0 james      (501) staff       (20)    18297 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/frame-shuffle.svg
+-rw-r--r--   0 james      (501) staff       (20)    22979 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/frame-sort.svg
+-rw-r--r--   0 james      (501) staff       (20)    12181 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/frame.svg
+-rw-r--r--   0 james      (501) staff       (20)    41828 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/gputester-msg.png
+-rw-r--r--   0 james      (501) staff       (20)   210392 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/growth_of_languages.png
+-rw-r--r--   0 james      (501) staff       (20)   167834 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/growth_of_libraries.png
+-rw-r--r--   0 james      (501) staff       (20)     4097 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/inc-add.svg
+-rw-r--r--   0 james      (501) staff       (20)   123010 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/map-reduce-task-scheduling.svg
+-rw-r--r--   0 james      (501) staff       (20)   482302 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/map_blocks_drop_axis.png
+-rw-r--r--   0 james      (501) staff       (20)   113067 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/merge_chunks.png
+-rw-r--r--   0 james      (501) staff       (20)    63244 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/merge_chunks_false.png
+-rw-r--r--   0 james      (501) staff       (20)    13024 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/optimize_dask1.svg
+-rw-r--r--   0 james      (501) staff       (20)     8803 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/optimize_dask2.svg
+-rw-r--r--   0 james      (501) staff       (20)     5198 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/optimize_dask3.svg
+-rw-r--r--   0 james      (501) staff       (20)     4104 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/optimize_dask4.svg
+-rw-r--r--   0 james      (501) staff       (20)     2738 2021-11-11 17:33:01.000000 dask-2023.6.1/docs/source/images/optimize_dask5.svg
+-rw-r--r--   0 james      (501) staff       (20)   292827 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/order-failure.png
+-rw-r--r--   0 james      (501) staff       (20)   239828 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/order-success.png
+-rw-r--r--   0 james      (501) staff       (20)    40833 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/overlap.svg
+-rw-r--r--   0 james      (501) staff       (20)    18785 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/overlapping-blocks.svg
+-rw-r--r--   0 james      (501) staff       (20)     4537 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/overlapping-neighbors.svg
+-rw-r--r--   0 james      (501) staff       (20)    20533 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/pipeline.svg
+-rw-r--r--   0 james      (501) staff       (20)    31576 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/reshape.png
+-rw-r--r--   0 james      (501) staff       (20)    31410 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/reshape_problem.png
+-rw-r--r--   0 james      (501) staff       (20)    33288 2021-11-11 20:27:17.000000 dask-2023.6.1/docs/source/images/reshape_rechunked.png
+-rw-r--r--   0 james      (501) staff       (20)    50209 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/scaling-edges.png
+-rw-r--r--   0 james      (501) staff       (20)    68476 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/scaling-nodes.png
+-rw-r--r--   0 james      (501) staff       (20)    21294 2021-06-08 02:50:31.000000 dask-2023.6.1/docs/source/images/simple-dask.png
+-rw-r--r--   0 james      (501) staff       (20)    27572 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/transpose-hlg-hovertooltip.png
+-rw-r--r--   0 james      (501) staff       (20)    84492 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/images/transpose-hlg-html-repr.png
+-rw-r--r--   0 james      (501) staff       (20)    39365 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/transpose.svg
+-rw-r--r--   0 james      (501) staff       (20)    22446 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/transpose_opt.svg
+-rw-r--r--   0 james      (501) staff       (20)   115022 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/images/trivial.svg
+-rw-r--r--   0 james      (501) staff       (20)     2451 2021-06-08 02:51:08.000000 dask-2023.6.1/docs/source/images/unoverlapping-neighbors.svg
+-rw-r--r--   0 james      (501) staff       (20)     6237 2023-03-13 17:40:25.000000 dask-2023.6.1/docs/source/index.rst
+-rw-r--r--   0 james      (501) staff       (20)    15235 2023-05-31 15:34:32.000000 dask-2023.6.1/docs/source/install.rst
+-rw-r--r--   0 james      (501) staff       (20)      341 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/internals.rst
+-rw-r--r--   0 james      (501) staff       (20)      868 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/logos.rst
+-rw-r--r--   0 james      (501) staff       (20)     3573 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/maintainers.rst
+-rw-r--r--   0 james      (501) staff       (20)    12200 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/optimize.rst
+-rw-r--r--   0 james      (501) staff       (20)     7119 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/order.rst
+-rw-r--r--   0 james      (501) staff       (20)     4810 2022-10-07 21:37:14.000000 dask-2023.6.1/docs/source/phases-of-computation.rst
+-rw-r--r--   0 james      (501) staff       (20)     5089 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/presentations.rst
+-rw-r--r--   0 james      (501) staff       (20)     6010 2022-10-07 21:37:14.000000 dask-2023.6.1/docs/source/scheduler-overview.rst
+-rw-r--r--   0 james      (501) staff       (20)     4493 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/scheduling-policy.rst
+-rw-r--r--   0 james      (501) staff       (20)    11015 2023-05-31 15:34:32.000000 dask-2023.6.1/docs/source/scheduling.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2023-06-26 20:35:18.883600 dask-2023.6.1/docs/source/scripts/
+-rw-r--r--   0 james      (501) staff       (20)     3294 2023-05-31 15:34:32.000000 dask-2023.6.1/docs/source/scripts/scheduling.py
+-rw-r--r--   0 james      (501) staff       (20)     6104 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/shared.rst
+-rw-r--r--   0 james      (501) staff       (20)     9342 2022-11-09 22:20:24.000000 dask-2023.6.1/docs/source/spark.rst
+-rw-r--r--   0 james      (501) staff       (20)     3966 2022-10-07 21:37:14.000000 dask-2023.6.1/docs/source/spec.rst
+-rw-r--r--   0 james      (501) staff       (20)     4754 2023-05-22 17:52:26.000000 dask-2023.6.1/docs/source/support.rst
+-rw-r--r--   0 james      (501) staff       (20)     1831 2021-06-16 20:41:28.000000 dask-2023.6.1/docs/source/understanding-performance.rst
+-rw-r--r--   0 james      (501) staff       (20)    12205 2023-05-03 18:02:08.000000 dask-2023.6.1/docs/source/user-interfaces.rst
+-rw-r--r--   0 james      (501) staff       (20)    11744 2022-10-24 20:44:15.000000 dask-2023.6.1/docs/source/why.rst
+-rw-r--r--   0 james      (501) staff       (20)     5526 2023-06-26 20:30:33.000000 dask-2023.6.1/pyproject.toml
+-rw-r--r--   0 james      (501) staff       (20)       38 2023-06-26 20:35:18.887627 dask-2023.6.1/setup.cfg
+-rwxr-xr-x   0 james      (501) staff       (20)      194 2023-05-03 18:02:08.000000 dask-2023.6.1/setup.py
```

### Comparing `dask-2023.6.0/LICENSE.txt` & `dask-2023.6.1/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/PKG-INFO` & `dask-2023.6.1/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dask
-Version: 2023.6.0
+Version: 2023.6.1
 Summary: Parallel PyData with Task Scheduling
 Maintainer-email: Matthew Rocklin <mrocklin@gmail.com>
 License: BSD
 Project-URL: Homepage, https://github.com/dask/dask/
 Keywords: task-scheduling parallel numpy pandas pydata
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `dask-2023.6.0/README.rst` & `dask-2023.6.1/README.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/conftest.py` & `dask-2023.6.1/conftest.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/_compatibility.py` & `dask-2023.6.1/dask/_compatibility.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/NUMPY_LICENSE.txt` & `dask-2023.6.1/dask/array/NUMPY_LICENSE.txt`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/__init__.py` & `dask-2023.6.1/dask/array/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/backends.py` & `dask-2023.6.1/dask/array/backends.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/blockwise.py` & `dask-2023.6.1/dask/array/blockwise.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/chunk.py` & `dask-2023.6.1/dask/array/chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/chunk_types.py` & `dask-2023.6.1/dask/array/chunk_types.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/core.py` & `dask-2023.6.1/dask/array/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -136,11798 +136,11792 @@
 00000870: 2066 6c6f 6174 5d20 2023 2053 686f 756c   float]  # Shoul
 00000880: 6420 6265 2055 6e69 6f6e 5b69 6e74 2c20  d be Union[int, 
 00000890: 4c69 7465 7261 6c5b 6e70 2e6e 616e 5d5d  Literal[np.nan]]
 000008a0: 0a0a 4445 4641 554c 545f 4745 5420 3d20  ..DEFAULT_GET = 
 000008b0: 6e61 6d65 645f 7363 6865 6475 6c65 7273  named_schedulers
 000008c0: 2e67 6574 2822 7468 7265 6164 7322 2c20  .get("threads", 
 000008d0: 6e61 6d65 645f 7363 6865 6475 6c65 7273  named_schedulers
-000008e0: 5b22 7379 6e63 225d 290a 0a63 6f6e 6669  ["sync"])..confi
-000008f0: 672e 7570 6461 7465 5f64 6566 6175 6c74  g.update_default
-00000900: 7328 7b22 6172 7261 7922 3a20 7b22 6368  s({"array": {"ch
-00000910: 756e 6b2d 7369 7a65 223a 2022 3132 384d  unk-size": "128M
-00000920: 6942 222c 2022 7265 6368 756e 6b2d 7468  iB", "rechunk-th
-00000930: 7265 7368 6f6c 6422 3a20 347d 7d29 0a0a  reshold": 4}})..
-00000940: 756e 6b6e 6f77 6e5f 6368 756e 6b5f 6d65  unknown_chunk_me
-00000950: 7373 6167 6520 3d20 280a 2020 2020 225c  ssage = (.    "\
-00000960: 6e5c 6e22 0a20 2020 2022 4120 706f 7373  n\n".    "A poss
-00000970: 6962 6c65 2073 6f6c 7574 696f 6e3a 2022  ible solution: "
-00000980: 0a20 2020 2022 6874 7470 733a 2f2f 646f  .    "https://do
-00000990: 6373 2e64 6173 6b2e 6f72 672f 656e 2f6c  cs.dask.org/en/l
-000009a0: 6174 6573 742f 6172 7261 792d 6368 756e  atest/array-chun
-000009b0: 6b73 2e68 746d 6c23 756e 6b6e 6f77 6e2d  ks.html#unknown-
-000009c0: 6368 756e 6b73 5c6e 220a 2020 2020 2253  chunks\n".    "S
-000009d0: 756d 6d61 7279 3a20 746f 2063 6f6d 7075  ummary: to compu
-000009e0: 7465 2063 6875 6e6b 7320 7369 7a65 732c  te chunks sizes,
-000009f0: 2075 7365 5c6e 5c6e 220a 2020 2020 2220   use\n\n".    " 
-00000a00: 2020 782e 636f 6d70 7574 655f 6368 756e    x.compute_chun
-00000a10: 6b5f 7369 7a65 7328 2920 2023 2066 6f72  k_sizes()  # for
-00000a20: 2044 6173 6b20 4172 7261 7920 6078 605c   Dask Array `x`\
-00000a30: 6e22 0a20 2020 2022 2020 2064 6466 2e74  n".    "   ddf.t
-00000a40: 6f5f 6461 736b 5f61 7272 6179 286c 656e  o_dask_array(len
-00000a50: 6774 6873 3d54 7275 6529 2020 2320 666f  gths=True)  # fo
-00000a60: 7220 4461 736b 2044 6174 6146 7261 6d65  r Dask DataFrame
-00000a70: 2060 6464 6660 220a 290a 0a0a 636c 6173   `ddf`".)...clas
-00000a80: 7320 5065 7266 6f72 6d61 6e63 6557 6172  s PerformanceWar
-00000a90: 6e69 6e67 2857 6172 6e69 6e67 293a 0a20  ning(Warning):. 
-00000aa0: 2020 2022 2222 4120 7761 726e 696e 6720     """A warning 
-00000ab0: 6769 7665 6e20 7768 656e 2062 6164 2063  given when bad c
-00000ac0: 6875 6e6b 696e 6720 6d61 7920 6361 7573  hunking may caus
-00000ad0: 6520 706f 6f72 2070 6572 666f 726d 616e  e poor performan
-00000ae0: 6365 2222 220a 0a0a 6465 6620 6765 7474  ce"""...def gett
-00000af0: 6572 2861 2c20 622c 2061 7361 7272 6179  er(a, b, asarray
-00000b00: 3d54 7275 652c 206c 6f63 6b3d 4e6f 6e65  =True, lock=None
-00000b10: 293a 0a20 2020 2069 6620 6973 696e 7374  ):.    if isinst
-00000b20: 616e 6365 2862 2c20 7475 706c 6529 2061  ance(b, tuple) a
-00000b30: 6e64 2061 6e79 2878 2069 7320 4e6f 6e65  nd any(x is None
-00000b40: 2066 6f72 2078 2069 6e20 6229 3a0a 2020   for x in b):.  
-00000b50: 2020 2020 2020 6232 203d 2074 7570 6c65        b2 = tuple
-00000b60: 2878 2066 6f72 2078 2069 6e20 6220 6966  (x for x in b if
-00000b70: 2078 2069 7320 6e6f 7420 4e6f 6e65 290a   x is not None).
-00000b80: 2020 2020 2020 2020 6233 203d 2074 7570          b3 = tup
-00000b90: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-00000ba0: 4e6f 6e65 2069 6620 7820 6973 204e 6f6e  None if x is Non
-00000bb0: 6520 656c 7365 2073 6c69 6365 284e 6f6e  e else slice(Non
-00000bc0: 652c 204e 6f6e 6529 0a20 2020 2020 2020  e, None).       
-00000bd0: 2020 2020 2066 6f72 2078 2069 6e20 620a       for x in b.
-00000be0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00000bf0: 6f74 2069 7369 6e73 7461 6e63 6528 782c  ot isinstance(x,
-00000c00: 2049 6e74 6567 7261 6c29 0a20 2020 2020   Integral).     
-00000c10: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-00000c20: 7572 6e20 6765 7474 6572 2861 2c20 6232  urn getter(a, b2
-00000c30: 2c20 6173 6172 7261 793d 6173 6172 7261  , asarray=asarra
-00000c40: 792c 206c 6f63 6b3d 6c6f 636b 295b 6233  y, lock=lock)[b3
-00000c50: 5d0a 0a20 2020 2069 6620 6c6f 636b 3a0a  ]..    if lock:.
-00000c60: 2020 2020 2020 2020 6c6f 636b 2e61 6371          lock.acq
-00000c70: 7569 7265 2829 0a20 2020 2074 7279 3a0a  uire().    try:.
-00000c80: 2020 2020 2020 2020 6320 3d20 615b 625d          c = a[b]
-00000c90: 0a20 2020 2020 2020 2023 2042 656c 6f77  .        # Below
-00000ca0: 2077 6520 7370 6563 6961 6c2d 6361 7365   we special-case
-00000cb0: 2060 6e70 2e6d 6174 7269 7860 2074 6f20   `np.matrix` to 
-00000cc0: 666f 7263 6520 6120 636f 6e76 6572 7369  force a conversi
-00000cd0: 6f6e 2074 6f0a 2020 2020 2020 2020 2320  on to.        # 
-00000ce0: 606e 702e 6e64 6172 7261 7960 2061 6e64  `np.ndarray` and
-00000cf0: 2070 7265 7365 7276 6520 6f72 6967 696e   preserve origin
-00000d00: 616c 2044 6173 6b20 6265 6861 7669 6f72  al Dask behavior
-00000d10: 2066 6f72 2060 6765 7474 6572 602c 0a20   for `getter`,. 
-00000d20: 2020 2020 2020 2023 2061 7320 666f 7220         # as for 
-00000d30: 616c 6c20 7075 7270 6f73 6573 2060 6e70  all purposes `np
-00000d40: 2e6d 6174 7269 7860 2069 7320 6172 7261  .matrix` is arra
-00000d50: 792d 6c69 6b65 2061 6e64 2074 6875 730a  y-like and thus.
-00000d60: 2020 2020 2020 2020 2320 6069 735f 6172          # `is_ar
-00000d70: 7261 796c 696b 6560 2065 7661 6c75 6174  raylike` evaluat
-00000d80: 6573 2074 6f20 6054 7275 6560 2069 6e20  es to `True` in 
-00000d90: 7468 6174 2063 6173 652e 0a20 2020 2020  that case..     
-00000da0: 2020 2069 6620 6173 6172 7261 7920 616e     if asarray an
-00000db0: 6420 286e 6f74 2069 735f 6172 7261 796c  d (not is_arrayl
-00000dc0: 696b 6528 6329 206f 7220 6973 696e 7374  ike(c) or isinst
-00000dd0: 616e 6365 2863 2c20 6e70 2e6d 6174 7269  ance(c, np.matri
-00000de0: 7829 293a 0a20 2020 2020 2020 2020 2020  x)):.           
-00000df0: 2063 203d 206e 702e 6173 6172 7261 7928   c = np.asarray(
-00000e00: 6329 0a20 2020 2066 696e 616c 6c79 3a0a  c).    finally:.
-00000e10: 2020 2020 2020 2020 6966 206c 6f63 6b3a          if lock:
-00000e20: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-00000e30: 6b2e 7265 6c65 6173 6528 290a 2020 2020  k.release().    
-00000e40: 7265 7475 726e 2063 0a0a 0a64 6566 2067  return c...def g
-00000e50: 6574 7465 725f 6e6f 6661 6e63 7928 612c  etter_nofancy(a,
-00000e60: 2062 2c20 6173 6172 7261 793d 5472 7565   b, asarray=True
-00000e70: 2c20 6c6f 636b 3d4e 6f6e 6529 3a0a 2020  , lock=None):.  
-00000e80: 2020 2222 2241 2073 696d 706c 6520 7772    """A simple wr
-00000e90: 6170 7065 7220 6172 6f75 6e64 2060 6067  apper around ``g
-00000ea0: 6574 7465 7260 602e 0a0a 2020 2020 5573  etter``...    Us
-00000eb0: 6564 2074 6f20 696e 6469 6361 7465 2074  ed to indicate t
-00000ec0: 6f20 7468 6520 6f70 7469 6d69 7a61 7469  o the optimizati
-00000ed0: 6f6e 2070 6173 7365 7320 7468 6174 2074  on passes that t
-00000ee0: 6865 2062 6163 6b65 6e64 2064 6f65 736e  he backend doesn
-00000ef0: 2774 0a20 2020 2073 7570 706f 7274 2066  't.    support f
-00000f00: 616e 6379 2069 6e64 6578 696e 672e 0a20  ancy indexing.. 
-00000f10: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00000f20: 6e20 6765 7474 6572 2861 2c20 622c 2061  n getter(a, b, a
-00000f30: 7361 7272 6179 3d61 7361 7272 6179 2c20  sarray=asarray, 
-00000f40: 6c6f 636b 3d6c 6f63 6b29 0a0a 0a64 6566  lock=lock)...def
-00000f50: 2067 6574 7465 725f 696e 6c69 6e65 2861   getter_inline(a
-00000f60: 2c20 622c 2061 7361 7272 6179 3d54 7275  , b, asarray=Tru
-00000f70: 652c 206c 6f63 6b3d 4e6f 6e65 293a 0a20  e, lock=None):. 
-00000f80: 2020 2022 2222 4120 6765 7474 6572 2066     """A getter f
-00000f90: 756e 6374 696f 6e20 7468 6174 206f 7074  unction that opt
-00000fa0: 696d 697a 6174 696f 6e73 2066 6565 6c20  imizations feel 
-00000fb0: 636f 6d66 6f72 7461 626c 6520 696e 6c69  comfortable inli
-00000fc0: 6e69 6e67 0a0a 2020 2020 536c 6963 696e  ning..    Slicin
-00000fd0: 6720 6f70 6572 6174 696f 6e73 2077 6974  g operations wit
-00000fe0: 6820 7468 6973 2066 756e 6374 696f 6e20  h this function 
-00000ff0: 6d61 7920 6265 2069 6e6c 696e 6564 2069  may be inlined i
-00001000: 6e74 6f20 6120 6772 6170 682c 2073 7563  nto a graph, suc
-00001010: 6820 6173 0a20 2020 2069 6e20 7468 6520  h as.    in the 
-00001020: 666f 6c6c 6f77 696e 6720 7265 7772 6974  following rewrit
-00001030: 650a 0a20 2020 202a 2a42 6566 6f72 652a  e..    **Before*
-00001040: 2a0a 0a20 2020 203e 3e3e 2061 203d 2078  *..    >>> a = x
-00001050: 5b3a 3130 5d20 2023 2064 6f63 7465 7374  [:10]  # doctest
-00001060: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
-00001070: 6220 3d20 6120 2b20 3120 2023 2064 6f63  b = a + 1  # doc
-00001080: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-00001090: 3e3e 3e20 6320 3d20 6120 2a20 3220 2023  >>> c = a * 2  #
-000010a0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-000010b0: 0a20 2020 202a 2a41 6674 6572 2a2a 0a0a  .    **After**..
-000010c0: 2020 2020 3e3e 3e20 6220 3d20 785b 3a31      >>> b = x[:1
-000010d0: 305d 202b 2031 2020 2320 646f 6374 6573  0] + 1  # doctes
-000010e0: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
-000010f0: 2063 203d 2078 5b3a 3130 5d20 2a20 3220   c = x[:10] * 2 
-00001100: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
-00001110: 500a 0a20 2020 2054 6869 7320 696e 6c69  P..    This inli
-00001120: 6e69 6e67 2063 616e 2062 6520 7265 6c65  ning can be rele
-00001130: 7661 6e74 2074 6f20 6f70 6572 6174 696f  vant to operatio
-00001140: 6e73 2077 6865 6e20 7275 6e6e 696e 6720  ns when running 
-00001150: 6f66 6620 6f66 2064 6973 6b2e 0a20 2020  off of disk..   
-00001160: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-00001170: 6765 7474 6572 2861 2c20 622c 2061 7361  getter(a, b, asa
-00001180: 7272 6179 3d61 7361 7272 6179 2c20 6c6f  rray=asarray, lo
-00001190: 636b 3d6c 6f63 6b29 0a0a 0a66 726f 6d20  ck=lock)...from 
-000011a0: 6461 736b 2e61 7272 6179 2e6f 7074 696d  dask.array.optim
-000011b0: 697a 6174 696f 6e20 696d 706f 7274 2066  ization import f
-000011c0: 7573 655f 736c 6963 652c 206f 7074 696d  use_slice, optim
-000011d0: 697a 650a 0a23 205f 5f61 7272 6179 5f66  ize..# __array_f
-000011e0: 756e 6374 696f 6e5f 5f20 6469 6374 2066  unction__ dict f
-000011f0: 6f72 206d 6170 7069 6e67 2061 6c69 6173  or mapping alias
-00001200: 6573 2061 6e64 206d 6973 6d61 7463 6869  es and mismatchi
-00001210: 6e67 206e 616d 6573 0a5f 4841 4e44 4c45  ng names._HANDLE
-00001220: 445f 4655 4e43 5449 4f4e 5320 3d20 7b7d  D_FUNCTIONS = {}
-00001230: 0a0a 0a64 6566 2069 6d70 6c65 6d65 6e74  ...def implement
-00001240: 7328 2a6e 756d 7079 5f66 756e 6374 696f  s(*numpy_functio
-00001250: 6e73 293a 0a20 2020 2022 2222 5265 6769  ns):.    """Regi
-00001260: 7374 6572 2061 6e20 5f5f 6172 7261 795f  ster an __array_
-00001270: 6675 6e63 7469 6f6e 5f5f 2069 6d70 6c65  function__ imple
-00001280: 6d65 6e74 6174 696f 6e20 666f 7220 6461  mentation for da
-00001290: 736b 2e61 7272 6179 2e41 7272 6179 0a0a  sk.array.Array..
-000012a0: 2020 2020 5265 6769 7374 6572 2074 6861      Register tha
-000012b0: 7420 6120 6675 6e63 7469 6f6e 2069 6d70  t a function imp
-000012c0: 6c65 6d65 6e74 7320 7468 6520 4150 4920  lements the API 
-000012d0: 6f66 2061 204e 756d 5079 2066 756e 6374  of a NumPy funct
-000012e0: 696f 6e20 286f 7220 7365 7665 7261 6c0a  ion (or several.
-000012f0: 2020 2020 4e75 6d50 7920 6675 6e63 7469      NumPy functi
-00001300: 6f6e 7320 696e 2063 6173 6520 6f66 2061  ons in case of a
-00001310: 6c69 6173 6573 2920 7768 6963 6820 6973  liases) which is
-00001320: 2068 616e 646c 6564 2077 6974 680a 2020   handled with.  
-00001330: 2020 6060 5f5f 6172 7261 795f 6675 6e63    ``__array_func
-00001340: 7469 6f6e 5f5f 6060 2e0a 0a20 2020 2050  tion__``...    P
-00001350: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00001360: 2d2d 2d2d 2d2d 2d2d 0a20 2020 205c 5c2a  --------.    \\*
-00001370: 6e75 6d70 795f 6675 6e63 7469 6f6e 7320  numpy_functions 
-00001380: 3a20 6361 6c6c 6162 6c65 730a 2020 2020  : callables.    
-00001390: 2020 2020 4f6e 6520 6f72 206d 6f72 6520      One or more 
-000013a0: 4e75 6d50 7920 6675 6e63 7469 6f6e 7320  NumPy functions 
-000013b0: 7468 6174 2061 7265 2068 616e 646c 6564  that are handled
-000013c0: 2062 7920 6060 5f5f 6172 7261 795f 6675   by ``__array_fu
-000013d0: 6e63 7469 6f6e 5f5f 6060 0a20 2020 2020  nction__``.     
-000013e0: 2020 2061 6e64 2077 696c 6c20 6265 206d     and will be m
-000013f0: 6170 7065 6420 6279 2060 696d 706c 656d  apped by `implem
-00001400: 656e 7473 6020 746f 2061 2060 6461 736b  ents` to a `dask
-00001410: 2e61 7272 6179 6020 6675 6e63 7469 6f6e  .array` function
-00001420: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00001430: 6566 2064 6563 6f72 6174 6f72 2864 6173  ef decorator(das
-00001440: 6b5f 6675 6e63 293a 0a20 2020 2020 2020  k_func):.       
-00001450: 2066 6f72 206e 756d 7079 5f66 756e 6374   for numpy_funct
-00001460: 696f 6e20 696e 206e 756d 7079 5f66 756e  ion in numpy_fun
-00001470: 6374 696f 6e73 3a0a 2020 2020 2020 2020  ctions:.        
-00001480: 2020 2020 5f48 414e 444c 4544 5f46 554e      _HANDLED_FUN
-00001490: 4354 494f 4e53 5b6e 756d 7079 5f66 756e  CTIONS[numpy_fun
-000014a0: 6374 696f 6e5d 203d 2064 6173 6b5f 6675  ction] = dask_fu
-000014b0: 6e63 0a0a 2020 2020 2020 2020 7265 7475  nc..        retu
-000014c0: 726e 2064 6173 6b5f 6675 6e63 0a0a 2020  rn dask_func..  
-000014d0: 2020 7265 7475 726e 2064 6563 6f72 6174    return decorat
-000014e0: 6f72 0a0a 0a64 6566 205f 7368 6f75 6c64  or...def _should
-000014f0: 5f64 656c 6567 6174 6528 7365 6c66 2c20  _delegate(self, 
-00001500: 6f74 6865 7229 202d 3e20 626f 6f6c 3a0a  other) -> bool:.
-00001510: 2020 2020 2222 2243 6865 636b 2077 6865      """Check whe
-00001520: 7468 6572 2044 6173 6b20 7368 6f75 6c64  ther Dask should
-00001530: 2064 656c 6567 6174 6520 746f 2074 6865   delegate to the
-00001540: 206f 7468 6572 2e0a 2020 2020 5468 6973   other..    This
-00001550: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
-00001560: 666f 6c6c 6f77 7320 4e45 502d 3133 3a0a  follows NEP-13:.
-00001570: 2020 2020 6874 7470 733a 2f2f 6e75 6d70      https://nump
-00001580: 792e 6f72 672f 6e65 7073 2f6e 6570 2d30  y.org/neps/nep-0
-00001590: 3031 332d 7566 756e 632d 6f76 6572 7269  013-ufunc-overri
-000015a0: 6465 732e 6874 6d6c 2362 6568 6176 696f  des.html#behavio
-000015b0: 722d 696e 2d63 6f6d 6269 6e61 7469 6f6e  r-in-combination
-000015c0: 2d77 6974 682d 7079 7468 6f6e 2d73 2d62  -with-python-s-b
-000015d0: 696e 6172 792d 6f70 6572 6174 696f 6e73  inary-operations
-000015e0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-000015f0: 6861 7361 7474 7228 6f74 6865 722c 2022  hasattr(other, "
-00001600: 5f5f 6172 7261 795f 7566 756e 635f 5f22  __array_ufunc__"
-00001610: 2920 616e 6420 6f74 6865 722e 5f5f 6172  ) and other.__ar
-00001620: 7261 795f 7566 756e 635f 5f20 6973 204e  ray_ufunc__ is N
-00001630: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
-00001640: 7572 6e20 5472 7565 0a20 2020 2065 6c69  urn True.    eli
-00001650: 6620 280a 2020 2020 2020 2020 6861 7361  f (.        hasa
-00001660: 7474 7228 6f74 6865 722c 2022 5f5f 6172  ttr(other, "__ar
-00001670: 7261 795f 7566 756e 635f 5f22 290a 2020  ray_ufunc__").  
-00001680: 2020 2020 2020 616e 6420 6e6f 7420 6973        and not is
-00001690: 5f76 616c 6964 5f61 7272 6179 5f63 6875  _valid_array_chu
-000016a0: 6e6b 286f 7468 6572 290a 2020 2020 2020  nk(other).      
-000016b0: 2020 2320 646f 6e27 7420 6465 6c65 6761    # don't delega
-000016c0: 7465 2074 6f20 6f75 7220 6f77 6e20 7061  te to our own pa
-000016d0: 7265 6e74 2063 6c61 7373 6573 0a20 2020  rent classes.   
-000016e0: 2020 2020 2061 6e64 206e 6f74 2069 7369       and not isi
-000016f0: 6e73 7461 6e63 6528 7365 6c66 2c20 7479  nstance(self, ty
-00001700: 7065 286f 7468 6572 2929 0a20 2020 2020  pe(other)).     
-00001710: 2020 2061 6e64 2074 7970 6528 7365 6c66     and type(self
-00001720: 2920 6973 206e 6f74 2074 7970 6528 6f74  ) is not type(ot
-00001730: 6865 7229 0a20 2020 2029 3a0a 2020 2020  her).    ):.    
-00001740: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-00001750: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00001760: 0a0a 0a64 6566 2063 6865 636b 5f69 665f  ...def check_if_
-00001770: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
-00001780: 6865 7228 6629 3a0a 2020 2020 2222 2243  her(f):.    """C
-00001790: 6865 636b 2069 6620 6d65 7468 6f64 2069  heck if method i
-000017a0: 7320 6861 6e64 6c65 6420 6279 2044 6173  s handled by Das
-000017b0: 6b20 6769 7665 6e20 7479 7065 206f 6620  k given type of 
-000017c0: 6f74 6865 720a 0a20 2020 2045 6e73 7572  other..    Ensur
-000017d0: 6573 2070 726f 7065 7220 6465 6665 7272  es proper deferr
-000017e0: 616c 2074 6f20 7570 6361 7374 2074 7970  al to upcast typ
-000017f0: 6573 2069 6e20 6475 6e64 6572 206f 7065  es in dunder ope
-00001800: 7261 7469 6f6e 7320 7769 7468 6f75 740a  rations without.
-00001810: 2020 2020 6173 7375 6d69 6e67 2075 6e6b      assuming unk
-00001820: 6e6f 776e 2074 7970 6573 2061 7265 2061  nown types are a
-00001830: 7574 6f6d 6174 6963 616c 6c79 2064 6f77  utomatically dow
-00001840: 6e63 6173 7420 7479 7065 732e 0a20 2020  ncast types..   
-00001850: 2022 2222 0a0a 2020 2020 4077 7261 7073   """..    @wraps
-00001860: 2866 290a 2020 2020 6465 6620 7772 6170  (f).    def wrap
-00001870: 7065 7228 7365 6c66 2c20 6f74 6865 7229  per(self, other)
-00001880: 3a0a 2020 2020 2020 2020 6966 205f 7368  :.        if _sh
-00001890: 6f75 6c64 5f64 656c 6567 6174 6528 7365  ould_delegate(se
-000018a0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-000018b0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000018c0: 6f74 496d 706c 656d 656e 7465 640a 2020  otImplemented.  
-000018d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000018e0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000018f0: 2873 656c 662c 206f 7468 6572 290a 0a20  (self, other).. 
-00001900: 2020 2072 6574 7572 6e20 7772 6170 7065     return wrappe
-00001910: 720a 0a0a 6465 6620 736c 6963 6573 5f66  r...def slices_f
-00001920: 726f 6d5f 6368 756e 6b73 2863 6875 6e6b  rom_chunks(chunk
-00001930: 7329 3a0a 2020 2020 2222 2254 7261 6e73  s):.    """Trans
-00001940: 6c61 7465 2063 6875 6e6b 7320 7475 706c  late chunks tupl
-00001950: 6520 746f 2061 2073 6574 206f 6620 736c  e to a set of sl
-00001960: 6963 6573 2069 6e20 7072 6f64 7563 7420  ices in product 
-00001970: 6f72 6465 720a 0a20 2020 203e 3e3e 2073  order..    >>> s
-00001980: 6c69 6365 735f 6672 6f6d 5f63 6875 6e6b  lices_from_chunk
-00001990: 7328 2828 322c 2032 292c 2028 332c 2033  s(((2, 2), (3, 3
-000019a0: 2c20 3329 2929 2020 2320 646f 6374 6573  , 3)))  # doctes
-000019b0: 743a 202b 4e4f 524d 414c 495a 455f 5748  t: +NORMALIZE_WH
-000019c0: 4954 4553 5041 4345 0a20 2020 2020 5b28  ITESPACE.     [(
-000019d0: 736c 6963 6528 302c 2032 2c20 4e6f 6e65  slice(0, 2, None
-000019e0: 292c 2073 6c69 6365 2830 2c20 332c 204e  ), slice(0, 3, N
-000019f0: 6f6e 6529 292c 0a20 2020 2020 2028 736c  one)),.      (sl
-00001a00: 6963 6528 302c 2032 2c20 4e6f 6e65 292c  ice(0, 2, None),
-00001a10: 2073 6c69 6365 2833 2c20 362c 204e 6f6e   slice(3, 6, Non
-00001a20: 6529 292c 0a20 2020 2020 2028 736c 6963  e)),.      (slic
-00001a30: 6528 302c 2032 2c20 4e6f 6e65 292c 2073  e(0, 2, None), s
-00001a40: 6c69 6365 2836 2c20 392c 204e 6f6e 6529  lice(6, 9, None)
-00001a50: 292c 0a20 2020 2020 2028 736c 6963 6528  ),.      (slice(
-00001a60: 322c 2034 2c20 4e6f 6e65 292c 2073 6c69  2, 4, None), sli
-00001a70: 6365 2830 2c20 332c 204e 6f6e 6529 292c  ce(0, 3, None)),
-00001a80: 0a20 2020 2020 2028 736c 6963 6528 322c  .      (slice(2,
-00001a90: 2034 2c20 4e6f 6e65 292c 2073 6c69 6365   4, None), slice
-00001aa0: 2833 2c20 362c 204e 6f6e 6529 292c 0a20  (3, 6, None)),. 
-00001ab0: 2020 2020 2028 736c 6963 6528 322c 2034       (slice(2, 4
-00001ac0: 2c20 4e6f 6e65 292c 2073 6c69 6365 2836  , None), slice(6
-00001ad0: 2c20 392c 204e 6f6e 6529 295d 0a20 2020  , 9, None))].   
-00001ae0: 2022 2222 0a20 2020 2063 756d 6469 6d73   """.    cumdims
-00001af0: 203d 205b 6361 6368 6564 5f63 756d 7375   = [cached_cumsu
-00001b00: 6d28 6264 732c 2069 6e69 7469 616c 5f7a  m(bds, initial_z
-00001b10: 6572 6f3d 5472 7565 2920 666f 7220 6264  ero=True) for bd
-00001b20: 7320 696e 2063 6875 6e6b 735d 0a20 2020  s in chunks].   
-00001b30: 2073 6c69 6365 7320 3d20 5b0a 2020 2020   slices = [.    
-00001b40: 2020 2020 5b73 6c69 6365 2873 2c20 7320      [slice(s, s 
-00001b50: 2b20 6469 6d29 2066 6f72 2073 2c20 6469  + dim) for s, di
-00001b60: 6d20 696e 207a 6970 2873 7461 7274 732c  m in zip(starts,
-00001b70: 2073 6861 7065 7329 5d0a 2020 2020 2020   shapes)].      
-00001b80: 2020 666f 7220 7374 6172 7473 2c20 7368    for starts, sh
-00001b90: 6170 6573 2069 6e20 7a69 7028 6375 6d64  apes in zip(cumd
-00001ba0: 696d 732c 2063 6875 6e6b 7329 0a20 2020  ims, chunks).   
-00001bb0: 205d 0a20 2020 2072 6574 7572 6e20 6c69   ].    return li
-00001bc0: 7374 2870 726f 6475 6374 282a 736c 6963  st(product(*slic
-00001bd0: 6573 2929 0a0a 0a64 6566 2067 7261 7068  es))...def graph
-00001be0: 5f66 726f 6d5f 6172 7261 796c 696b 6528  _from_arraylike(
-00001bf0: 0a20 2020 2061 7272 2c20 2023 2041 6e79  .    arr,  # Any
-00001c00: 2061 7272 6179 2d6c 696b 6520 7768 6963   array-like whic
-00001c10: 6820 7375 7070 6f72 7473 2073 6c69 6369  h supports slici
-00001c20: 6e67 0a20 2020 2063 6875 6e6b 732c 0a20  ng.    chunks,. 
-00001c30: 2020 2073 6861 7065 2c0a 2020 2020 6e61     shape,.    na
-00001c40: 6d65 2c0a 2020 2020 6765 7469 7465 6d3d  me,.    getitem=
-00001c50: 6765 7474 6572 2c0a 2020 2020 6c6f 636b  getter,.    lock
-00001c60: 3d46 616c 7365 2c0a 2020 2020 6173 6172  =False,.    asar
-00001c70: 7261 793d 5472 7565 2c0a 2020 2020 6474  ray=True,.    dt
-00001c80: 7970 653d 4e6f 6e65 2c0a 2020 2020 696e  ype=None,.    in
-00001c90: 6c69 6e65 5f61 7272 6179 3d46 616c 7365  line_array=False
-00001ca0: 2c0a 2920 2d3e 2048 6967 684c 6576 656c  ,.) -> HighLevel
-00001cb0: 4772 6170 683a 0a20 2020 2022 2222 0a20  Graph:.    """. 
-00001cc0: 2020 2048 6967 684c 6576 656c 4772 6170     HighLevelGrap
-00001cd0: 6820 666f 7220 736c 6963 696e 6720 6368  h for slicing ch
-00001ce0: 756e 6b73 2066 726f 6d20 616e 2061 7272  unks from an arr
-00001cf0: 6179 2d6c 696b 6520 6163 636f 7264 696e  ay-like accordin
-00001d00: 6720 746f 2061 2063 6875 6e6b 2070 6174  g to a chunk pat
-00001d10: 7465 726e 2e0a 0a20 2020 2049 6620 6060  tern...    If ``
-00001d20: 696e 6c69 6e65 5f61 7272 6179 6060 2069  inline_array`` i
-00001d30: 7320 5472 7565 2c20 7468 6973 206d 616b  s True, this mak
-00001d40: 6520 6120 426c 6f63 6b77 6973 6520 6c61  e a Blockwise la
-00001d50: 7965 7220 6f66 2073 6c69 6369 6e67 2074  yer of slicing t
-00001d60: 6173 6b73 2077 6865 7265 2074 6865 0a20  asks where the. 
-00001d70: 2020 2061 7272 6179 2d6c 696b 6520 6973     array-like is
-00001d80: 2065 6d62 6564 6465 6420 696e 746f 2065   embedded into e
-00001d90: 7665 7279 2074 6173 6b2e 2c0a 0a20 2020  very task.,..   
-00001da0: 2049 6620 6060 696e 6c69 6e65 5f61 7272   If ``inline_arr
-00001db0: 6179 6060 2069 7320 4661 6c73 652c 2074  ay`` is False, t
-00001dc0: 6869 7320 696e 7365 7274 7320 7468 6520  his inserts the 
-00001dd0: 6172 7261 792d 6c69 6b65 2061 7320 6120  array-like as a 
-00001de0: 7374 616e 6461 6c6f 6e65 2076 616c 7565  standalone value
-00001df0: 2069 6e0a 2020 2020 6120 4d61 7465 7269   in.    a Materi
-00001e00: 616c 697a 6564 4c61 7965 722c 2074 6865  alizedLayer, the
-00001e10: 6e20 6765 6e65 7261 7465 7320 6120 426c  n generates a Bl
-00001e20: 6f63 6b77 6973 6520 6c61 7965 7220 6f66  ockwise layer of
-00001e30: 2073 6c69 6369 6e67 2074 6173 6b73 2074   slicing tasks t
-00001e40: 6861 7420 7265 6665 720a 2020 2020 746f  hat refer.    to
-00001e50: 2069 742e 0a0a 2020 2020 3e3e 3e20 6469   it...    >>> di
-00001e60: 6374 2867 7261 7068 5f66 726f 6d5f 6172  ct(graph_from_ar
-00001e70: 7261 796c 696b 6528 6172 722c 2063 6875  raylike(arr, chu
-00001e80: 6e6b 733d 2832 2c20 3329 2c20 7368 6170  nks=(2, 3), shap
-00001e90: 653d 2834 2c20 3629 2c20 6e61 6d65 3d22  e=(4, 6), name="
-00001ea0: 5822 2c20 696e 6c69 6e65 5f61 7272 6179  X", inline_array
-00001eb0: 3d54 7275 6529 2920 2023 2064 6f63 7465  =True))  # docte
-00001ec0: 7374 3a20 2b53 4b49 500a 2020 2020 7b28  st: +SKIP.    {(
-00001ed0: 6172 722c 2030 2c20 3029 3a20 2867 6574  arr, 0, 0): (get
-00001ee0: 7465 722c 2061 7272 2c20 2873 6c69 6365  ter, arr, (slice
-00001ef0: 2830 2c20 3229 2c20 736c 6963 6528 302c  (0, 2), slice(0,
-00001f00: 2033 2929 292c 0a20 2020 2020 2861 7272   3))),.     (arr
-00001f10: 2c20 312c 2030 293a 2028 6765 7474 6572  , 1, 0): (getter
-00001f20: 2c20 6172 722c 2028 736c 6963 6528 322c  , arr, (slice(2,
-00001f30: 2034 292c 2073 6c69 6365 2830 2c20 3329   4), slice(0, 3)
-00001f40: 2929 2c0a 2020 2020 2028 6172 722c 2031  )),.     (arr, 1
-00001f50: 2c20 3129 3a20 2867 6574 7465 722c 2061  , 1): (getter, a
-00001f60: 7272 2c20 2873 6c69 6365 2832 2c20 3429  rr, (slice(2, 4)
-00001f70: 2c20 736c 6963 6528 332c 2036 2929 292c  , slice(3, 6))),
-00001f80: 0a20 2020 2020 2861 7272 2c20 302c 2031  .     (arr, 0, 1
-00001f90: 293a 2028 6765 7474 6572 2c20 6172 722c  ): (getter, arr,
-00001fa0: 2028 736c 6963 6528 302c 2032 292c 2073   (slice(0, 2), s
-00001fb0: 6c69 6365 2833 2c20 3629 2929 7d0a 0a20  lice(3, 6)))}.. 
-00001fc0: 2020 203e 3e3e 2064 6963 7428 2020 2320     >>> dict(  # 
-00001fd0: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
-00001fe0: 2020 2020 2020 2020 2020 2067 7261 7068             graph
-00001ff0: 5f66 726f 6d5f 6172 7261 796c 696b 6528  _from_arraylike(
-00002000: 6172 722c 2063 6875 6e6b 733d 2828 322c  arr, chunks=((2,
-00002010: 2032 292c 2028 332c 2033 2929 2c20 7368   2), (3, 3)), sh
-00002020: 6170 653d 2834 2c36 292c 206e 616d 653d  ape=(4,6), name=
-00002030: 2258 222c 2069 6e6c 696e 655f 6172 7261  "X", inline_arra
-00002040: 793d 4661 6c73 6529 0a20 2020 2020 2020  y=False).       
-00002050: 2029 0a20 2020 207b 226f 7269 6769 6e61   ).    {"origina
-00002060: 6c2d 5822 3a20 6172 722c 0a20 2020 2020  l-X": arr,.     
-00002070: 2827 5827 2c20 302c 2030 293a 2028 6765  ('X', 0, 0): (ge
-00002080: 7474 6572 2c20 276f 7269 6769 6e61 6c2d  tter, 'original-
-00002090: 5827 2c20 2873 6c69 6365 2830 2c20 3229  X', (slice(0, 2)
-000020a0: 2c20 736c 6963 6528 302c 2033 2929 292c  , slice(0, 3))),
-000020b0: 0a20 2020 2020 2827 5827 2c20 312c 2030  .     ('X', 1, 0
-000020c0: 293a 2028 6765 7474 6572 2c20 276f 7269  ): (getter, 'ori
-000020d0: 6769 6e61 6c2d 5827 2c20 2873 6c69 6365  ginal-X', (slice
-000020e0: 2832 2c20 3429 2c20 736c 6963 6528 302c  (2, 4), slice(0,
-000020f0: 2033 2929 292c 0a20 2020 2020 2827 5827   3))),.     ('X'
-00002100: 2c20 312c 2031 293a 2028 6765 7474 6572  , 1, 1): (getter
-00002110: 2c20 276f 7269 6769 6e61 6c2d 5827 2c20  , 'original-X', 
-00002120: 2873 6c69 6365 2832 2c20 3429 2c20 736c  (slice(2, 4), sl
-00002130: 6963 6528 332c 2036 2929 292c 0a20 2020  ice(3, 6))),.   
-00002140: 2020 2827 5827 2c20 302c 2031 293a 2028    ('X', 0, 1): (
-00002150: 6765 7474 6572 2c20 276f 7269 6769 6e61  getter, 'origina
-00002160: 6c2d 5827 2c20 2873 6c69 6365 2830 2c20  l-X', (slice(0, 
-00002170: 3229 2c20 736c 6963 6528 332c 2036 2929  2), slice(3, 6))
-00002180: 297d 0a20 2020 2022 2222 0a20 2020 2063  )}.    """.    c
-00002190: 6875 6e6b 7320 3d20 6e6f 726d 616c 697a  hunks = normaliz
-000021a0: 655f 6368 756e 6b73 2863 6875 6e6b 732c  e_chunks(chunks,
-000021b0: 2073 6861 7065 2c20 6474 7970 653d 6474   shape, dtype=dt
-000021c0: 7970 6529 0a20 2020 206f 7574 5f69 6e64  ype).    out_ind
-000021d0: 203d 2074 7570 6c65 2872 616e 6765 286c   = tuple(range(l
-000021e0: 656e 2873 6861 7065 2929 290a 0a20 2020  en(shape)))..   
-000021f0: 2069 6620 280a 2020 2020 2020 2020 6861   if (.        ha
-00002200: 735f 6b65 7977 6f72 6428 6765 7469 7465  s_keyword(getite
-00002210: 6d2c 2022 6173 6172 7261 7922 290a 2020  m, "asarray").  
-00002220: 2020 2020 2020 616e 6420 6861 735f 6b65        and has_ke
-00002230: 7977 6f72 6428 6765 7469 7465 6d2c 2022  yword(getitem, "
-00002240: 6c6f 636b 2229 0a20 2020 2020 2020 2061  lock").        a
-00002250: 6e64 2028 6e6f 7420 6173 6172 7261 7920  nd (not asarray 
-00002260: 6f72 206c 6f63 6b29 0a20 2020 2029 3a0a  or lock).    ):.
-00002270: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-00002280: 207b 2261 7361 7272 6179 223a 2061 7361   {"asarray": asa
-00002290: 7272 6179 2c20 226c 6f63 6b22 3a20 6c6f  rray, "lock": lo
-000022a0: 636b 7d0a 2020 2020 656c 7365 3a0a 2020  ck}.    else:.  
-000022b0: 2020 2020 2020 2320 436f 6d6d 6f6e 2063        # Common c
-000022c0: 6173 652c 2064 726f 7020 6578 7472 6120  ase, drop extra 
-000022d0: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
-000022e0: 2020 206b 7761 7267 7320 3d20 7b7d 0a0a     kwargs = {}..
-000022f0: 2020 2020 6966 2069 6e6c 696e 655f 6172      if inline_ar
-00002300: 7261 793a 0a20 2020 2020 2020 206c 6179  ray:.        lay
-00002310: 6572 203d 2063 6f72 655f 626c 6f63 6b77  er = core_blockw
-00002320: 6973 6528 0a20 2020 2020 2020 2020 2020  ise(.           
-00002330: 2067 6574 6974 656d 2c0a 2020 2020 2020   getitem,.      
-00002340: 2020 2020 2020 6e61 6d65 2c0a 2020 2020        name,.    
-00002350: 2020 2020 2020 2020 6f75 745f 696e 642c          out_ind,
-00002360: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
-00002370: 2c0a 2020 2020 2020 2020 2020 2020 4e6f  ,.            No
-00002380: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00002390: 4172 7261 7953 6c69 6365 4465 7028 6368  ArraySliceDep(ch
-000023a0: 756e 6b73 292c 0a20 2020 2020 2020 2020  unks),.         
-000023b0: 2020 206f 7574 5f69 6e64 2c0a 2020 2020     out_ind,.    
-000023c0: 2020 2020 2020 2020 6e75 6d62 6c6f 636b          numblock
-000023d0: 733d 7b7d 2c0a 2020 2020 2020 2020 2020  s={},.          
-000023e0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-000023f0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00002400: 7475 726e 2048 6967 684c 6576 656c 4772  turn HighLevelGr
-00002410: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-00002420: 696f 6e73 286e 616d 652c 206c 6179 6572  ions(name, layer
-00002430: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00002440: 2020 2020 6f72 6967 696e 616c 5f6e 616d      original_nam
-00002450: 6520 3d20 226f 7269 6769 6e61 6c2d 2220  e = "original-" 
-00002460: 2b20 6e61 6d65 0a0a 2020 2020 2020 2020  + name..        
-00002470: 6c61 7965 7273 203d 207b 7d0a 2020 2020  layers = {}.    
-00002480: 2020 2020 6c61 7965 7273 5b6f 7269 6769      layers[origi
-00002490: 6e61 6c5f 6e61 6d65 5d20 3d20 4d61 7465  nal_name] = Mate
-000024a0: 7269 616c 697a 6564 4c61 7965 7228 7b6f  rializedLayer({o
-000024b0: 7269 6769 6e61 6c5f 6e61 6d65 3a20 6172  riginal_name: ar
-000024c0: 727d 290a 2020 2020 2020 2020 6c61 7965  r}).        laye
-000024d0: 7273 5b6e 616d 655d 203d 2063 6f72 655f  rs[name] = core_
-000024e0: 626c 6f63 6b77 6973 6528 0a20 2020 2020  blockwise(.     
-000024f0: 2020 2020 2020 2067 6574 6974 656d 2c0a         getitem,.
-00002500: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00002510: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
-00002520: 745f 696e 642c 0a20 2020 2020 2020 2020  t_ind,.         
-00002530: 2020 206f 7269 6769 6e61 6c5f 6e61 6d65     original_name
-00002540: 2c0a 2020 2020 2020 2020 2020 2020 4e6f  ,.            No
-00002550: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00002560: 4172 7261 7953 6c69 6365 4465 7028 6368  ArraySliceDep(ch
-00002570: 756e 6b73 292c 0a20 2020 2020 2020 2020  unks),.         
-00002580: 2020 206f 7574 5f69 6e64 2c0a 2020 2020     out_ind,.    
-00002590: 2020 2020 2020 2020 6e75 6d62 6c6f 636b          numblock
-000025a0: 733d 7b7d 2c0a 2020 2020 2020 2020 2020  s={},.          
-000025b0: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-000025c0: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
-000025d0: 6570 7320 3d20 7b0a 2020 2020 2020 2020  eps = {.        
-000025e0: 2020 2020 6f72 6967 696e 616c 5f6e 616d      original_nam
-000025f0: 653a 2073 6574 2829 2c0a 2020 2020 2020  e: set(),.      
-00002600: 2020 2020 2020 6e61 6d65 3a20 7b6f 7269        name: {ori
-00002610: 6769 6e61 6c5f 6e61 6d65 7d2c 0a20 2020  ginal_name},.   
-00002620: 2020 2020 207d 0a20 2020 2020 2020 2072       }.        r
-00002630: 6574 7572 6e20 4869 6768 4c65 7665 6c47  eturn HighLevelG
-00002640: 7261 7068 286c 6179 6572 732c 2064 6570  raph(layers, dep
-00002650: 7329 0a0a 0a64 6566 2064 6f74 6d61 6e79  s)...def dotmany
-00002660: 2841 2c20 422c 206c 6566 7466 756e 633d  (A, B, leftfunc=
-00002670: 4e6f 6e65 2c20 7269 6768 7466 756e 633d  None, rightfunc=
-00002680: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-00002690: 0a20 2020 2022 2222 446f 7420 7072 6f64  .    """Dot prod
-000026a0: 7563 7420 6f66 206d 616e 7920 616c 6967  uct of many alig
-000026b0: 6e65 6420 6368 756e 6b73 0a0a 2020 2020  ned chunks..    
-000026c0: 3e3e 3e20 7820 3d20 6e70 2e61 7272 6179  >>> x = np.array
-000026d0: 285b 5b31 2c20 325d 2c20 5b31 2c20 325d  ([[1, 2], [1, 2]
-000026e0: 5d29 0a20 2020 203e 3e3e 2079 203d 206e  ]).    >>> y = n
-000026f0: 702e 6172 7261 7928 5b5b 3130 2c20 3230  p.array([[10, 20
-00002700: 5d2c 205b 3130 2c20 3230 5d5d 290a 2020  ], [10, 20]]).  
-00002710: 2020 3e3e 3e20 646f 746d 616e 7928 5b78    >>> dotmany([x
-00002720: 2c20 782c 2078 5d2c 205b 792c 2079 2c20  , x, x], [y, y, 
-00002730: 795d 290a 2020 2020 6172 7261 7928 5b5b  y]).    array([[
-00002740: 2039 302c 2031 3830 5d2c 0a20 2020 2020   90, 180],.     
-00002750: 2020 2020 2020 5b20 3930 2c20 3138 305d        [ 90, 180]
-00002760: 5d29 0a0a 2020 2020 4f70 7469 6f6e 616c  ])..    Optional
-00002770: 6c79 2070 6173 7320 696e 2066 756e 6374  ly pass in funct
-00002780: 696f 6e73 2074 6f20 6170 706c 7920 746f  ions to apply to
-00002790: 2074 6865 206c 6566 7420 616e 6420 7269   the left and ri
-000027a0: 6768 7420 6368 756e 6b73 0a0a 2020 2020  ght chunks..    
-000027b0: 3e3e 3e20 646f 746d 616e 7928 5b78 2c20  >>> dotmany([x, 
-000027c0: 782c 2078 5d2c 205b 792c 2079 2c20 795d  x, x], [y, y, y]
-000027d0: 2c20 7269 6768 7466 756e 633d 6e70 2e74  , rightfunc=np.t
-000027e0: 7261 6e73 706f 7365 290a 2020 2020 6172  ranspose).    ar
-000027f0: 7261 7928 5b5b 3135 302c 2031 3530 5d2c  ray([[150, 150],
-00002800: 0a20 2020 2020 2020 2020 2020 5b31 3530  .           [150
-00002810: 2c20 3135 305d 5d29 0a20 2020 2022 2222  , 150]]).    """
-00002820: 0a20 2020 2069 6620 6c65 6674 6675 6e63  .    if leftfunc
-00002830: 3a0a 2020 2020 2020 2020 4120 3d20 6d61  :.        A = ma
-00002840: 7028 6c65 6674 6675 6e63 2c20 4129 0a20  p(leftfunc, A). 
-00002850: 2020 2069 6620 7269 6768 7466 756e 633a     if rightfunc:
-00002860: 0a20 2020 2020 2020 2042 203d 206d 6170  .        B = map
-00002870: 2872 6967 6874 6675 6e63 2c20 4229 0a20  (rightfunc, B). 
-00002880: 2020 2072 6574 7572 6e20 7375 6d28 6d61     return sum(ma
-00002890: 7028 7061 7274 6961 6c28 6e70 2e64 6f74  p(partial(np.dot
-000028a0: 2c20 2a2a 6b77 6172 6773 292c 2041 2c20  , **kwargs), A, 
-000028b0: 4229 290a 0a0a 6465 6620 5f63 6f6e 6361  B))...def _conca
-000028c0: 7465 6e61 7465 3228 6172 7261 7973 2c20  tenate2(arrays, 
-000028d0: 6178 6573 3d4e 6f6e 6529 3a0a 2020 2020  axes=None):.    
-000028e0: 2222 2252 6563 7572 7369 7665 6c79 2063  """Recursively c
-000028f0: 6f6e 6361 7465 6e61 7465 206e 6573 7465  oncatenate neste
-00002900: 6420 6c69 7374 7320 6f66 2061 7272 6179  d lists of array
-00002910: 7320 616c 6f6e 6720 6178 6573 0a0a 2020  s along axes..  
-00002920: 2020 4561 6368 2065 6e74 7279 2069 6e20    Each entry in 
-00002930: 6178 6573 2063 6f72 7265 7370 6f6e 6473  axes corresponds
-00002940: 2074 6f20 6561 6368 206c 6576 656c 206f   to each level o
-00002950: 6620 7468 6520 6e65 7374 6564 206c 6973  f the nested lis
-00002960: 742e 2020 5468 650a 2020 2020 6c65 6e67  t.  The.    leng
-00002970: 7468 206f 6620 6178 6573 2073 686f 756c  th of axes shoul
-00002980: 6420 636f 7272 6573 706f 6e64 2074 6f20  d correspond to 
-00002990: 7468 6520 6c65 7665 6c20 6f66 206e 6573  the level of nes
-000029a0: 7469 6e67 206f 6620 6172 7261 7973 2e0a  ting of arrays..
-000029b0: 2020 2020 4966 2061 7865 7320 6973 2061      If axes is a
-000029c0: 6e20 656d 7074 7920 6c69 7374 206f 7220  n empty list or 
-000029d0: 7475 706c 652c 2072 6574 7572 6e20 6172  tuple, return ar
-000029e0: 7261 7973 2c20 6f72 2061 7272 6179 735b  rays, or arrays[
-000029f0: 305d 2069 660a 2020 2020 6172 7261 7973  0] if.    arrays
-00002a00: 2069 7320 6120 6c69 7374 2e0a 0a20 2020   is a list...   
-00002a10: 203e 3e3e 2078 203d 206e 702e 6172 7261   >>> x = np.arra
-00002a20: 7928 5b5b 312c 2032 5d2c 205b 332c 2034  y([[1, 2], [3, 4
-00002a30: 5d5d 290a 2020 2020 3e3e 3e20 5f63 6f6e  ]]).    >>> _con
-00002a40: 6361 7465 6e61 7465 3228 5b78 2c20 785d  catenate2([x, x]
-00002a50: 2c20 6178 6573 3d5b 305d 290a 2020 2020  , axes=[0]).    
-00002a60: 6172 7261 7928 5b5b 312c 2032 5d2c 0a20  array([[1, 2],. 
-00002a70: 2020 2020 2020 2020 2020 5b33 2c20 345d            [3, 4]
-00002a80: 2c0a 2020 2020 2020 2020 2020 205b 312c  ,.           [1,
-00002a90: 2032 5d2c 0a20 2020 2020 2020 2020 2020   2],.           
-00002aa0: 5b33 2c20 345d 5d29 0a0a 2020 2020 3e3e  [3, 4]])..    >>
-00002ab0: 3e20 5f63 6f6e 6361 7465 6e61 7465 3228  > _concatenate2(
-00002ac0: 5b78 2c20 785d 2c20 6178 6573 3d5b 315d  [x, x], axes=[1]
-00002ad0: 290a 2020 2020 6172 7261 7928 5b5b 312c  ).    array([[1,
-00002ae0: 2032 2c20 312c 2032 5d2c 0a20 2020 2020   2, 1, 2],.     
-00002af0: 2020 2020 2020 5b33 2c20 342c 2033 2c20        [3, 4, 3, 
-00002b00: 345d 5d29 0a0a 2020 2020 3e3e 3e20 5f63  4]])..    >>> _c
-00002b10: 6f6e 6361 7465 6e61 7465 3228 5b5b 782c  oncatenate2([[x,
-00002b20: 2078 5d2c 205b 782c 2078 5d5d 2c20 6178   x], [x, x]], ax
-00002b30: 6573 3d5b 302c 2031 5d29 0a20 2020 2061  es=[0, 1]).    a
-00002b40: 7272 6179 285b 5b31 2c20 322c 2031 2c20  rray([[1, 2, 1, 
-00002b50: 325d 2c0a 2020 2020 2020 2020 2020 205b  2],.           [
-00002b60: 332c 2034 2c20 332c 2034 5d2c 0a20 2020  3, 4, 3, 4],.   
-00002b70: 2020 2020 2020 2020 5b31 2c20 322c 2031          [1, 2, 1
-00002b80: 2c20 325d 2c0a 2020 2020 2020 2020 2020  , 2],.          
-00002b90: 205b 332c 2034 2c20 332c 2034 5d5d 290a   [3, 4, 3, 4]]).
-00002ba0: 0a20 2020 2053 7570 706f 7274 7320 4974  .    Supports It
-00002bb0: 6572 6174 6f72 730a 2020 2020 3e3e 3e20  erators.    >>> 
-00002bc0: 5f63 6f6e 6361 7465 6e61 7465 3228 6974  _concatenate2(it
-00002bd0: 6572 285b 782c 2078 5d29 2c20 6178 6573  er([x, x]), axes
-00002be0: 3d5b 315d 290a 2020 2020 6172 7261 7928  =[1]).    array(
-00002bf0: 5b5b 312c 2032 2c20 312c 2032 5d2c 0a20  [[1, 2, 1, 2],. 
-00002c00: 2020 2020 2020 2020 2020 5b33 2c20 342c            [3, 4,
-00002c10: 2033 2c20 345d 5d29 0a0a 2020 2020 5370   3, 4]])..    Sp
-00002c20: 6563 6961 6c20 4361 7365 0a20 2020 203e  ecial Case.    >
-00002c30: 3e3e 205f 636f 6e63 6174 656e 6174 6532  >> _concatenate2
-00002c40: 285b 782c 2078 5d2c 2061 7865 733d 2829  ([x, x], axes=()
-00002c50: 290a 2020 2020 6172 7261 7928 5b5b 312c  ).    array([[1,
-00002c60: 2032 5d2c 0a20 2020 2020 2020 2020 2020   2],.           
-00002c70: 5b33 2c20 345d 5d29 0a20 2020 2022 2222  [3, 4]]).    """
-00002c80: 0a20 2020 2069 6620 6178 6573 2069 7320  .    if axes is 
-00002c90: 4e6f 6e65 3a0a 2020 2020 2020 2020 6178  None:.        ax
-00002ca0: 6573 203d 205b 5d0a 0a20 2020 2069 6620  es = []..    if 
-00002cb0: 6178 6573 203d 3d20 2829 3a0a 2020 2020  axes == ():.    
-00002cc0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00002cd0: 6528 6172 7261 7973 2c20 6c69 7374 293a  e(arrays, list):
-00002ce0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00002cf0: 7572 6e20 6172 7261 7973 5b30 5d0a 2020  urn arrays[0].  
-00002d00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00002d10: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00002d20: 7272 6179 730a 0a20 2020 2069 6620 6973  rrays..    if is
-00002d30: 696e 7374 616e 6365 2861 7272 6179 732c  instance(arrays,
-00002d40: 2049 7465 7261 746f 7229 3a0a 2020 2020   Iterator):.    
-00002d50: 2020 2020 6172 7261 7973 203d 206c 6973      arrays = lis
-00002d60: 7428 6172 7261 7973 290a 2020 2020 6966  t(arrays).    if
-00002d70: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00002d80: 6172 7261 7973 2c20 286c 6973 742c 2074  arrays, (list, t
-00002d90: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
-00002da0: 7265 7475 726e 2061 7272 6179 730a 2020  return arrays.  
-00002db0: 2020 6966 206c 656e 2861 7865 7329 203e    if len(axes) >
-00002dc0: 2031 3a0a 2020 2020 2020 2020 6172 7261   1:.        arra
-00002dd0: 7973 203d 205b 5f63 6f6e 6361 7465 6e61  ys = [_concatena
-00002de0: 7465 3228 612c 2061 7865 733d 6178 6573  te2(a, axes=axes
-00002df0: 5b31 3a5d 2920 666f 7220 6120 696e 2061  [1:]) for a in a
-00002e00: 7272 6179 735d 0a20 2020 2063 6f6e 6361  rrays].    conca
-00002e10: 7465 6e61 7465 203d 2063 6f6e 6361 7465  tenate = concate
-00002e20: 6e61 7465 5f6c 6f6f 6b75 702e 6469 7370  nate_lookup.disp
-00002e30: 6174 6368 280a 2020 2020 2020 2020 7479  atch(.        ty
-00002e40: 7065 286d 6178 2861 7272 6179 732c 206b  pe(max(arrays, k
-00002e50: 6579 3d6c 616d 6264 6120 783a 2067 6574  ey=lambda x: get
-00002e60: 6174 7472 2878 2c20 225f 5f61 7272 6179  attr(x, "__array
-00002e70: 5f70 7269 6f72 6974 795f 5f22 2c20 3029  _priority__", 0)
-00002e80: 2929 0a20 2020 2029 0a20 2020 2069 6620  )).    ).    if 
-00002e90: 6973 696e 7374 616e 6365 2861 7272 6179  isinstance(array
-00002ea0: 735b 305d 2c20 6469 6374 293a 0a20 2020  s[0], dict):.   
-00002eb0: 2020 2020 2023 2048 616e 646c 6520 636f       # Handle co
-00002ec0: 6e63 6174 656e 6174 696f 6e20 6f66 2060  ncatenation of `
-00002ed0: 6469 6374 6073 2c20 7573 6564 2061 7320  dict`s, used as 
-00002ee0: 6120 7265 706c 6163 656d 656e 7420 666f  a replacement fo
-00002ef0: 7220 7374 7275 6374 7572 6564 0a20 2020  r structured.   
-00002f00: 2020 2020 2023 2061 7272 6179 7320 7768       # arrays wh
-00002f10: 656e 2074 6861 7427 7320 6e6f 7420 7375  en that's not su
-00002f20: 7070 6f72 7465 6420 6279 2074 6865 2061  pported by the a
-00002f30: 7272 6179 206c 6962 7261 7279 2028 652e  rray library (e.
-00002f40: 672e 2c20 4375 5079 292e 0a20 2020 2020  g., CuPy)..     
-00002f50: 2020 206b 6579 7320 3d20 6c69 7374 2861     keys = list(a
-00002f60: 7272 6179 735b 305d 2e6b 6579 7328 2929  rrays[0].keys())
-00002f70: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00002f80: 616c 6c28 6c69 7374 2861 2e6b 6579 7328  all(list(a.keys(
-00002f90: 2929 203d 3d20 6b65 7973 2066 6f72 2061  )) == keys for a
-00002fa0: 2069 6e20 6172 7261 7973 290a 2020 2020   in arrays).    
-00002fb0: 2020 2020 7265 7420 3d20 6469 6374 2829      ret = dict()
-00002fc0: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
-00002fd0: 6e20 6b65 7973 3a0a 2020 2020 2020 2020  n keys:.        
-00002fe0: 2020 2020 7265 745b 6b5d 203d 2063 6f6e      ret[k] = con
-00002ff0: 6361 7465 6e61 7465 286c 6973 7428 615b  catenate(list(a[
-00003000: 6b5d 2066 6f72 2061 2069 6e20 6172 7261  k] for a in arra
-00003010: 7973 292c 2061 7869 733d 6178 6573 5b30  ys), axis=axes[0
-00003020: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-00003030: 6e20 7265 740a 2020 2020 656c 7365 3a0a  n ret.    else:.
-00003040: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00003050: 6f6e 6361 7465 6e61 7465 2861 7272 6179  oncatenate(array
-00003060: 732c 2061 7869 733d 6178 6573 5b30 5d29  s, axis=axes[0])
-00003070: 0a0a 0a64 6566 2061 7070 6c79 5f69 6e66  ...def apply_inf
-00003080: 6572 5f64 7479 7065 2866 756e 632c 2061  er_dtype(func, a
-00003090: 7267 732c 206b 7761 7267 732c 2066 756e  rgs, kwargs, fun
-000030a0: 636e 616d 652c 2073 7567 6765 7374 5f64  cname, suggest_d
-000030b0: 7479 7065 3d22 6474 7970 6522 2c20 6e6f  type="dtype", no
-000030c0: 7574 3d4e 6f6e 6529 3a0a 2020 2020 2222  ut=None):.    ""
-000030d0: 220a 2020 2020 5472 6965 7320 746f 2069  ".    Tries to i
-000030e0: 6e66 6572 206f 7574 7075 7420 6474 7970  nfer output dtyp
-000030f0: 6520 6f66 2060 6066 756e 6360 6020 666f  e of ``func`` fo
-00003100: 7220 6120 736d 616c 6c20 7365 7420 6f66  r a small set of
-00003110: 2069 6e70 7574 2061 7267 756d 656e 7473   input arguments
-00003120: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00003130: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00003140: 0a20 2020 2066 756e 633a 2043 616c 6c61  .    func: Calla
-00003150: 626c 650a 2020 2020 2020 2020 4675 6e63  ble.        Func
-00003160: 7469 6f6e 2066 6f72 2077 6869 6368 206f  tion for which o
-00003170: 7574 7075 7420 6474 7970 6520 6973 2074  utput dtype is t
-00003180: 6f20 6265 2064 6574 6572 6d69 6e65 640a  o be determined.
-00003190: 0a20 2020 2061 7267 733a 204c 6973 7420  .    args: List 
-000031a0: 6f66 2061 7272 6179 206c 696b 650a 2020  of array like.  
-000031b0: 2020 2020 2020 4172 6775 6d65 6e74 7320        Arguments 
-000031c0: 746f 2074 6865 2066 756e 6374 696f 6e2c  to the function,
-000031d0: 2077 6869 6368 2077 6f75 6c64 2075 7375   which would usu
-000031e0: 616c 6c79 2062 6520 7573 6564 2e20 4f6e  ally be used. On
-000031f0: 6c79 2061 7474 7269 6275 7465 730a 2020  ly attributes.  
-00003200: 2020 2020 2020 6060 6e64 696d 6060 2061        ``ndim`` a
-00003210: 6e64 2060 6064 7479 7065 6060 2061 7265  nd ``dtype`` are
-00003220: 2075 7365 642e 0a0a 2020 2020 6b77 6172   used...    kwar
-00003230: 6773 3a20 6469 6374 0a20 2020 2020 2020  gs: dict.       
-00003240: 2041 6464 6974 696f 6e61 6c20 6060 6b77   Additional ``kw
-00003250: 6172 6773 6060 2074 6f20 7468 6520 6060  args`` to the ``
-00003260: 6675 6e63 6060 0a0a 2020 2020 6675 6e63  func``..    func
-00003270: 6e61 6d65 3a20 5374 7269 6e67 0a20 2020  name: String.   
-00003280: 2020 2020 204e 616d 6520 6f66 2063 616c       Name of cal
-00003290: 6c69 6e67 2066 756e 6374 696f 6e20 746f  ling function to
-000032a0: 2069 6d70 726f 7665 2070 6f74 656e 7469   improve potenti
-000032b0: 616c 2065 7272 6f72 206d 6573 7361 6765  al error message
-000032c0: 730a 0a20 2020 2073 7567 6765 7374 5f64  s..    suggest_d
-000032d0: 7479 7065 3a20 4e6f 6e65 2f46 616c 7365  type: None/False
-000032e0: 206f 7220 5374 7269 6e67 0a20 2020 2020   or String.     
-000032f0: 2020 2049 6620 6e6f 7420 6060 4e6f 6e65     If not ``None
-00003300: 6060 2061 6464 7320 7375 6767 6573 7469  `` adds suggesti
-00003310: 6f6e 2074 6f20 706f 7465 6e74 6961 6c20  on to potential 
-00003320: 6572 726f 7220 6d65 7373 6167 6520 746f  error message to
-00003330: 2073 7065 6369 6679 2061 2064 7479 7065   specify a dtype
-00003340: 0a20 2020 2020 2020 2076 6961 2074 6865  .        via the
-00003350: 2073 7065 6369 6669 6564 206b 7761 7267   specified kwarg
-00003360: 2e20 4465 6661 756c 7473 2074 6f20 6060  . Defaults to ``
-00003370: 2764 7479 7065 2760 602e 0a0a 2020 2020  'dtype'``...    
-00003380: 6e6f 7574 3a20 4e6f 6e65 206f 7220 496e  nout: None or In
-00003390: 740a 2020 2020 2020 2020 6060 4e6f 6e65  t.        ``None
-000033a0: 6060 2069 6620 6675 6e63 7469 6f6e 2072  `` if function r
-000033b0: 6574 7572 6e73 2073 696e 676c 6520 6f75  eturns single ou
-000033c0: 7470 7574 2c20 696e 7465 6765 7220 6966  tput, integer if
-000033d0: 206d 616e 792e 0a20 2020 2020 2020 2044   many..        D
-000033e0: 6561 6675 6c74 7320 746f 2060 604e 6f6e  eafults to ``Non
-000033f0: 6560 602e 0a0a 2020 2020 5265 7475 726e  e``...    Return
-00003400: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-00003410: 2020 3a20 6474 7970 6520 6f72 204c 6973    : dtype or Lis
-00003420: 7420 6f66 2064 7479 7065 0a20 2020 2020  t of dtype.     
-00003430: 2020 204f 6e65 206f 7220 6d61 6e79 2064     One or many d
-00003440: 7479 7065 7320 2864 6570 656e 6469 6e67  types (depending
-00003450: 206f 6e20 6060 6e6f 7574 6060 290a 2020   on ``nout``).  
-00003460: 2020 2222 220a 2020 2020 6672 6f6d 2064    """.    from d
-00003470: 6173 6b2e 6172 7261 792e 7574 696c 7320  ask.array.utils 
-00003480: 696d 706f 7274 206d 6574 615f 6672 6f6d  import meta_from
-00003490: 5f61 7272 6179 0a0a 2020 2020 2320 6d61  _array..    # ma
-000034a0: 6b65 2073 7572 6520 7468 6174 2065 7665  ke sure that eve
-000034b0: 7279 2061 7267 2069 7320 616e 2065 7661  ry arg is an eva
-000034c0: 6c75 6174 6564 2061 7272 6179 0a20 2020  luated array.   
-000034d0: 2061 7267 7320 3d20 5b0a 2020 2020 2020   args = [.      
-000034e0: 2020 6e70 2e6f 6e65 735f 6c69 6b65 286d    np.ones_like(m
-000034f0: 6574 615f 6672 6f6d 5f61 7272 6179 2878  eta_from_array(x
-00003500: 292c 2073 6861 7065 3d28 2831 2c29 202a  ), shape=((1,) *
-00003510: 2078 2e6e 6469 6d29 2c20 6474 7970 653d   x.ndim), dtype=
-00003520: 782e 6474 7970 6529 0a20 2020 2020 2020  x.dtype).       
-00003530: 2069 6620 6973 5f61 7272 6179 6c69 6b65   if is_arraylike
-00003540: 2878 290a 2020 2020 2020 2020 656c 7365  (x).        else
-00003550: 2078 0a20 2020 2020 2020 2066 6f72 2078   x.        for x
-00003560: 2069 6e20 6172 6773 0a20 2020 205d 0a20   in args.    ]. 
-00003570: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00003580: 7769 7468 206e 702e 6572 7273 7461 7465  with np.errstate
-00003590: 2861 6c6c 3d22 6967 6e6f 7265 2229 3a0a  (all="ignore"):.
-000035a0: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
-000035b0: 6675 6e63 282a 6172 6773 2c20 2a2a 6b77  func(*args, **kw
-000035c0: 6172 6773 290a 2020 2020 6578 6365 7074  args).    except
-000035d0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-000035e0: 0a20 2020 2020 2020 2065 7863 5f74 7970  .        exc_typ
-000035f0: 652c 2065 7863 5f76 616c 7565 2c20 6578  e, exc_value, ex
-00003600: 635f 7472 6163 6562 6163 6b20 3d20 7379  c_traceback = sy
-00003610: 732e 6578 635f 696e 666f 2829 0a20 2020  s.exc_info().   
-00003620: 2020 2020 2074 6220 3d20 2222 2e6a 6f69       tb = "".joi
-00003630: 6e28 7472 6163 6562 6163 6b2e 666f 726d  n(traceback.form
-00003640: 6174 5f74 6228 6578 635f 7472 6163 6562  at_tb(exc_traceb
-00003650: 6163 6b29 290a 2020 2020 2020 2020 7375  ack)).        su
-00003660: 6767 6573 7420 3d20 280a 2020 2020 2020  ggest = (.      
-00003670: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-00003680: 2020 2020 2020 2020 2250 6c65 6173 6520          "Please 
-00003690: 7370 6563 6966 7920 7468 6520 6474 7970  specify the dtyp
-000036a0: 6520 6578 706c 6963 6974 6c79 2075 7369  e explicitly usi
-000036b0: 6e67 2074 6865 2022 0a20 2020 2020 2020  ng the ".       
-000036c0: 2020 2020 2020 2020 2022 607b 6474 7970           "`{dtyp
-000036d0: 657d 6020 6b77 6172 672e 5c6e 5c6e 222e  e}` kwarg.\n\n".
-000036e0: 666f 726d 6174 2864 7479 7065 3d73 7567  format(dtype=sug
-000036f0: 6765 7374 5f64 7479 7065 290a 2020 2020  gest_dtype).    
-00003700: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003710: 2020 2020 2020 6966 2073 7567 6765 7374        if suggest
-00003720: 5f64 7479 7065 0a20 2020 2020 2020 2020  _dtype.         
-00003730: 2020 2065 6c73 6520 2222 0a20 2020 2020     else "".     
-00003740: 2020 2029 0a20 2020 2020 2020 206d 7367     ).        msg
-00003750: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00003760: 2066 2260 6474 7970 6560 2069 6e66 6572   f"`dtype` infer
-00003770: 656e 6365 2066 6169 6c65 6420 696e 2060  ence failed in `
-00003780: 7b66 756e 636e 616d 657d 602e 5c6e 5c6e  {funcname}`.\n\n
-00003790: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
-000037a0: 7b73 7567 6765 7374 7d22 0a20 2020 2020  {suggest}".     
-000037b0: 2020 2020 2020 2022 4f72 6967 696e 616c         "Original
-000037c0: 2065 7272 6f72 2069 7320 6265 6c6f 773a   error is below:
-000037d0: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-000037e0: 222d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  "---------------
-000037f0: 2d2d 2d2d 2d2d 2d2d 2d5c 6e22 0a20 2020  ---------\n".   
-00003800: 2020 2020 2020 2020 2066 227b 6521 727d           f"{e!r}
-00003810: 5c6e 5c6e 220a 2020 2020 2020 2020 2020  \n\n".          
-00003820: 2020 2254 7261 6365 6261 636b 3a5c 6e22    "Traceback:\n"
-00003830: 0a20 2020 2020 2020 2020 2020 2022 2d2d  .            "--
-00003840: 2d2d 2d2d 2d2d 2d5c 6e22 0a20 2020 2020  -------\n".     
-00003850: 2020 2020 2020 2066 227b 7462 7d22 0a20         f"{tb}". 
-00003860: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-00003870: 653a 0a20 2020 2020 2020 206d 7367 203d  e:.        msg =
-00003880: 204e 6f6e 650a 2020 2020 6966 206d 7367   None.    if msg
-00003890: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000038a0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000038b0: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-000038c0: 7265 7475 726e 2067 6574 6174 7472 286f  return getattr(o
-000038d0: 2c20 2264 7479 7065 222c 2074 7970 6528  , "dtype", type(
-000038e0: 6f29 2920 6966 206e 6f75 7420 6973 204e  o)) if nout is N
-000038f0: 6f6e 6520 656c 7365 2074 7570 6c65 2865  one else tuple(e
-00003900: 2e64 7479 7065 2066 6f72 2065 2069 6e20  .dtype for e in 
-00003910: 6f29 0a0a 0a64 6566 206e 6f72 6d61 6c69  o)...def normali
-00003920: 7a65 5f61 7267 2878 293a 0a20 2020 2022  ze_arg(x):.    "
-00003930: 2222 4e6f 726d 616c 697a 6520 7573 6572  ""Normalize user
-00003940: 2070 726f 7669 6465 6420 6172 6775 6d65   provided argume
-00003950: 6e74 7320 746f 2062 6c6f 636b 7769 7365  nts to blockwise
-00003960: 206f 7220 6d61 705f 626c 6f63 6b73 0a0a   or map_blocks..
-00003970: 2020 2020 5765 2064 6f20 6120 6665 7720      We do a few 
-00003980: 7468 696e 6773 3a0a 0a20 2020 2031 2e20  things:..    1. 
-00003990: 2049 6620 7468 6579 2061 7265 2073 7472   If they are str
-000039a0: 696e 6720 6c69 7465 7261 6c73 2074 6861  ing literals tha
-000039b0: 7420 6d69 6768 7420 636f 6c6c 6964 6520  t might collide 
-000039c0: 7769 7468 2062 6c6f 636b 7769 7365 5f74  with blockwise_t
-000039d0: 6f6b 656e 2074 6865 6e20 7765 0a20 2020  oken then we.   
-000039e0: 2020 2020 2071 756f 7465 2074 6865 6d0a       quote them.
-000039f0: 2020 2020 322e 2020 4946 2074 6865 7920      2.  IF they 
-00003a00: 6172 6520 6c61 7267 6520 2861 7320 6465  are large (as de
-00003a10: 6669 6e65 6420 6279 2073 697a 656f 6629  fined by sizeof)
-00003a20: 2074 6865 6e20 7765 2070 7574 2074 6865   then we put the
-00003a30: 6d20 696e 746f 2074 6865 0a20 2020 2020  m into the.     
-00003a40: 2020 2067 7261 7068 206f 6e20 7468 6569     graph on thei
-00003a50: 7220 6f77 6e20 6279 2075 7369 6e67 2064  r own by using d
-00003a60: 6173 6b2e 6465 6c61 7965 640a 2020 2020  ask.delayed.    
-00003a70: 2222 220a 2020 2020 6966 2069 735f 6461  """.    if is_da
-00003a80: 736b 5f63 6f6c 6c65 6374 696f 6e28 7829  sk_collection(x)
-00003a90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00003aa0: 2078 0a20 2020 2065 6c69 6620 6973 696e   x.    elif isin
-00003ab0: 7374 616e 6365 2878 2c20 7374 7229 2061  stance(x, str) a
-00003ac0: 6e64 2072 652e 6d61 7463 6828 7222 5f5c  nd re.match(r"_\
-00003ad0: 642b 222c 2078 293a 0a20 2020 2020 2020  d+", x):.       
-00003ae0: 2072 6574 7572 6e20 6465 6c61 7965 6428   return delayed(
-00003af0: 7829 0a20 2020 2065 6c69 6620 6973 696e  x).    elif isin
-00003b00: 7374 616e 6365 2878 2c20 6c69 7374 2920  stance(x, list) 
-00003b10: 616e 6420 6c65 6e28 7829 203e 3d20 3130  and len(x) >= 10
-00003b20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00003b30: 2064 656c 6179 6564 2878 290a 2020 2020   delayed(x).    
-00003b40: 656c 6966 2073 697a 656f 6628 7829 203e  elif sizeof(x) >
-00003b50: 2031 6536 3a0a 2020 2020 2020 2020 7265   1e6:.        re
-00003b60: 7475 726e 2064 656c 6179 6564 2878 290a  turn delayed(x).
-00003b70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00003b80: 2020 7265 7475 726e 2078 0a0a 0a64 6566    return x...def
-00003b90: 205f 7061 7373 5f65 7874 7261 5f6b 7761   _pass_extra_kwa
-00003ba0: 7267 7328 6675 6e63 2c20 6b65 7973 2c20  rgs(func, keys, 
-00003bb0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00003bc0: 3a0a 2020 2020 2222 2248 656c 7065 7220  :.    """Helper 
-00003bd0: 666f 7220 3a66 756e 633a 6064 6173 6b2e  for :func:`dask.
-00003be0: 6172 7261 792e 6d61 705f 626c 6f63 6b73  array.map_blocks
-00003bf0: 6020 746f 2070 6173 7320 6062 6c6f 636b  ` to pass `block
-00003c00: 5f69 6e66 6f60 206f 7220 6062 6c6f 636b  _info` or `block
-00003c10: 5f69 6460 2e0a 0a20 2020 2046 6f72 2065  _id`...    For e
-00003c20: 6163 6820 656c 656d 656e 7420 6f66 2060  ach element of `
-00003c30: 6b65 7973 602c 2061 2063 6f72 7265 7370  keys`, a corresp
-00003c40: 6f6e 6469 6e67 2065 6c65 6d65 6e74 206f  onding element o
-00003c50: 6620 6172 6773 2069 7320 6368 616e 6765  f args is change
-00003c60: 640a 2020 2020 746f 2061 206b 6579 776f  d.    to a keywo
-00003c70: 7264 2061 7267 756d 656e 7420 7769 7468  rd argument with
-00003c80: 2074 6861 7420 6b65 792c 2062 6566 6f72   that key, befor
-00003c90: 6520 616c 6c20 6172 6775 6d65 6e74 7320  e all arguments 
-00003ca0: 7265 2070 6173 7365 6420 6f6e 0a20 2020  re passed on.   
-00003cb0: 2074 6f20 6066 756e 6360 2e0a 2020 2020   to `func`..    
-00003cc0: 2222 220a 2020 2020 6b77 6172 6773 2e75  """.    kwargs.u
-00003cd0: 7064 6174 6528 7a69 7028 6b65 7973 2c20  pdate(zip(keys, 
-00003ce0: 6172 6773 2929 0a20 2020 2072 6574 7572  args)).    retur
-00003cf0: 6e20 6675 6e63 282a 6172 6773 5b6c 656e  n func(*args[len
-00003d00: 286b 6579 7329 203a 5d2c 202a 2a6b 7761  (keys) :], **kwa
-00003d10: 7267 7329 0a0a 0a64 6566 206d 6170 5f62  rgs)...def map_b
-00003d20: 6c6f 636b 7328 0a20 2020 2066 756e 632c  locks(.    func,
-00003d30: 0a20 2020 202a 6172 6773 2c0a 2020 2020  .    *args,.    
-00003d40: 6e61 6d65 3d4e 6f6e 652c 0a20 2020 2074  name=None,.    t
-00003d50: 6f6b 656e 3d4e 6f6e 652c 0a20 2020 2064  oken=None,.    d
-00003d60: 7479 7065 3d4e 6f6e 652c 0a20 2020 2063  type=None,.    c
-00003d70: 6875 6e6b 733d 4e6f 6e65 2c0a 2020 2020  hunks=None,.    
-00003d80: 6472 6f70 5f61 7869 733d 4e6f 6e65 2c0a  drop_axis=None,.
-00003d90: 2020 2020 6e65 775f 6178 6973 3d4e 6f6e      new_axis=Non
-00003da0: 652c 0a20 2020 2065 6e66 6f72 6365 5f6e  e,.    enforce_n
-00003db0: 6469 6d3d 4661 6c73 652c 0a20 2020 206d  dim=False,.    m
-00003dc0: 6574 613d 4e6f 6e65 2c0a 2020 2020 2a2a  eta=None,.    **
-00003dd0: 6b77 6172 6773 2c0a 293a 0a20 2020 2022  kwargs,.):.    "
-00003de0: 2222 4d61 7020 6120 6675 6e63 7469 6f6e  ""Map a function
-00003df0: 2061 6372 6f73 7320 616c 6c20 626c 6f63   across all bloc
-00003e00: 6b73 206f 6620 6120 6461 736b 2061 7272  ks of a dask arr
-00003e10: 6179 2e0a 0a20 2020 204e 6f74 6520 7468  ay...    Note th
-00003e20: 6174 2060 606d 6170 5f62 6c6f 636b 7360  at ``map_blocks`
-00003e30: 6020 7769 6c6c 2061 7474 656d 7074 2074  ` will attempt t
-00003e40: 6f20 6175 746f 6d61 7469 6361 6c6c 7920  o automatically 
-00003e50: 6465 7465 726d 696e 6520 7468 6520 6f75  determine the ou
-00003e60: 7470 7574 0a20 2020 2061 7272 6179 2074  tput.    array t
-00003e70: 7970 6520 6279 2063 616c 6c69 6e67 2060  ype by calling `
-00003e80: 6066 756e 6360 6020 6f6e 2030 2d64 2076  `func`` on 0-d v
-00003e90: 6572 7369 6f6e 7320 6f66 2074 6865 2069  ersions of the i
-00003ea0: 6e70 7574 732e 2050 6c65 6173 6520 7265  nputs. Please re
-00003eb0: 6665 7220 746f 0a20 2020 2074 6865 2060  fer to.    the `
-00003ec0: 606d 6574 6160 6020 6b65 7977 6f72 6420  `meta`` keyword 
-00003ed0: 6172 6775 6d65 6e74 2062 656c 6f77 2069  argument below i
-00003ee0: 6620 796f 7520 6578 7065 6374 2074 6861  f you expect tha
-00003ef0: 7420 7468 6520 6675 6e63 7469 6f6e 2077  t the function w
-00003f00: 696c 6c20 6e6f 740a 2020 2020 7375 6363  ill not.    succ
-00003f10: 6565 6420 7768 656e 206f 7065 7261 7469  eed when operati
-00003f20: 6e67 206f 6e20 302d 6420 6172 7261 7973  ng on 0-d arrays
-00003f30: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00003f40: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00003f50: 0a20 2020 2066 756e 6320 3a20 6361 6c6c  .    func : call
-00003f60: 6162 6c65 0a20 2020 2020 2020 2046 756e  able.        Fun
-00003f70: 6374 696f 6e20 746f 2061 7070 6c79 2074  ction to apply t
-00003f80: 6f20 6576 6572 7920 626c 6f63 6b20 696e  o every block in
-00003f90: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
-00003fa0: 2020 2020 4966 2060 6066 756e 6360 6020      If ``func`` 
-00003fb0: 6163 6365 7074 7320 6060 626c 6f63 6b5f  accepts ``block_
-00003fc0: 696e 666f 3d60 6020 6f72 2060 6062 6c6f  info=`` or ``blo
-00003fd0: 636b 5f69 643d 6060 0a20 2020 2020 2020  ck_id=``.       
-00003fe0: 2061 7320 6b65 7977 6f72 6420 6172 6775   as keyword argu
-00003ff0: 6d65 6e74 732c 2074 6865 7365 2077 696c  ments, these wil
-00004000: 6c20 6265 2070 6173 7365 6420 6469 6374  l be passed dict
-00004010: 696f 6e61 7269 6573 0a20 2020 2020 2020  ionaries.       
-00004020: 2063 6f6e 7461 696e 696e 6720 696e 666f   containing info
-00004030: 726d 6174 696f 6e20 6162 6f75 7420 696e  rmation about in
-00004040: 7075 7420 616e 6420 6f75 7470 7574 2063  put and output c
-00004050: 6875 6e6b 732f 6172 7261 7973 0a20 2020  hunks/arrays.   
-00004060: 2020 2020 2064 7572 696e 6720 636f 6d70       during comp
-00004070: 7574 6174 696f 6e2e 2053 6565 2065 7861  utation. See exa
-00004080: 6d70 6c65 7320 666f 7220 6465 7461 696c  mples for detail
-00004090: 732e 0a20 2020 2061 7267 7320 3a20 6461  s..    args : da
-000040a0: 736b 2061 7272 6179 7320 6f72 206f 7468  sk arrays or oth
-000040b0: 6572 206f 626a 6563 7473 0a20 2020 2064  er objects.    d
-000040c0: 7479 7065 203a 206e 702e 6474 7970 652c  type : np.dtype,
-000040d0: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-000040e0: 2020 5468 6520 6060 6474 7970 6560 6020    The ``dtype`` 
-000040f0: 6f66 2074 6865 206f 7574 7075 7420 6172  of the output ar
-00004100: 7261 792e 2049 7420 6973 2072 6563 6f6d  ray. It is recom
-00004110: 6d65 6e64 6564 2074 6f20 7072 6f76 6964  mended to provid
-00004120: 6520 7468 6973 2e0a 2020 2020 2020 2020  e this..        
-00004130: 4966 206e 6f74 2070 726f 7669 6465 642c  If not provided,
-00004140: 2077 696c 6c20 6265 2069 6e66 6572 7265   will be inferre
-00004150: 6420 6279 2061 7070 6c79 696e 6720 7468  d by applying th
-00004160: 6520 6675 6e63 7469 6f6e 2074 6f20 6120  e function to a 
-00004170: 736d 616c 6c0a 2020 2020 2020 2020 7365  small.        se
-00004180: 7420 6f66 2066 616b 6520 6461 7461 2e0a  t of fake data..
-00004190: 2020 2020 6368 756e 6b73 203a 2074 7570      chunks : tup
-000041a0: 6c65 2c20 6f70 7469 6f6e 616c 0a20 2020  le, optional.   
-000041b0: 2020 2020 2043 6875 6e6b 2073 6861 7065       Chunk shape
-000041c0: 206f 6620 7265 7375 6c74 696e 6720 626c   of resulting bl
-000041d0: 6f63 6b73 2069 6620 7468 6520 6675 6e63  ocks if the func
-000041e0: 7469 6f6e 2064 6f65 7320 6e6f 7420 7072  tion does not pr
-000041f0: 6573 6572 7665 0a20 2020 2020 2020 2073  eserve.        s
-00004200: 6861 7065 2e20 4966 206e 6f74 2070 726f  hape. If not pro
-00004210: 7669 6465 642c 2074 6865 2072 6573 756c  vided, the resul
-00004220: 7469 6e67 2061 7272 6179 2069 7320 6173  ting array is as
-00004230: 7375 6d65 6420 746f 2068 6176 6520 7468  sumed to have th
-00004240: 6520 7361 6d65 0a20 2020 2020 2020 2062  e same.        b
-00004250: 6c6f 636b 2073 7472 7563 7475 7265 2061  lock structure a
-00004260: 7320 7468 6520 6669 7273 7420 696e 7075  s the first inpu
-00004270: 7420 6172 7261 792e 0a20 2020 2064 726f  t array..    dro
-00004280: 705f 6178 6973 203a 206e 756d 6265 7220  p_axis : number 
+000008e0: 5b22 7379 6e63 225d 290a 0a75 6e6b 6e6f  ["sync"])..unkno
+000008f0: 776e 5f63 6875 6e6b 5f6d 6573 7361 6765  wn_chunk_message
+00000900: 203d 2028 0a20 2020 2022 5c6e 5c6e 220a   = (.    "\n\n".
+00000910: 2020 2020 2241 2070 6f73 7369 626c 6520      "A possible 
+00000920: 736f 6c75 7469 6f6e 3a20 220a 2020 2020  solution: ".    
+00000930: 2268 7474 7073 3a2f 2f64 6f63 732e 6461  "https://docs.da
+00000940: 736b 2e6f 7267 2f65 6e2f 6c61 7465 7374  sk.org/en/latest
+00000950: 2f61 7272 6179 2d63 6875 6e6b 732e 6874  /array-chunks.ht
+00000960: 6d6c 2375 6e6b 6e6f 776e 2d63 6875 6e6b  ml#unknown-chunk
+00000970: 735c 6e22 0a20 2020 2022 5375 6d6d 6172  s\n".    "Summar
+00000980: 793a 2074 6f20 636f 6d70 7574 6520 6368  y: to compute ch
+00000990: 756e 6b73 2073 697a 6573 2c20 7573 655c  unks sizes, use\
+000009a0: 6e5c 6e22 0a20 2020 2022 2020 2078 2e63  n\n".    "   x.c
+000009b0: 6f6d 7075 7465 5f63 6875 6e6b 5f73 697a  ompute_chunk_siz
+000009c0: 6573 2829 2020 2320 666f 7220 4461 736b  es()  # for Dask
+000009d0: 2041 7272 6179 2060 7860 5c6e 220a 2020   Array `x`\n".  
+000009e0: 2020 2220 2020 6464 662e 746f 5f64 6173    "   ddf.to_das
+000009f0: 6b5f 6172 7261 7928 6c65 6e67 7468 733d  k_array(lengths=
+00000a00: 5472 7565 2920 2023 2066 6f72 2044 6173  True)  # for Das
+00000a10: 6b20 4461 7461 4672 616d 6520 6064 6466  k DataFrame `ddf
+00000a20: 6022 0a29 0a0a 0a63 6c61 7373 2050 6572  `".)...class Per
+00000a30: 666f 726d 616e 6365 5761 726e 696e 6728  formanceWarning(
+00000a40: 5761 726e 696e 6729 3a0a 2020 2020 2222  Warning):.    ""
+00000a50: 2241 2077 6172 6e69 6e67 2067 6976 656e  "A warning given
+00000a60: 2077 6865 6e20 6261 6420 6368 756e 6b69   when bad chunki
+00000a70: 6e67 206d 6179 2063 6175 7365 2070 6f6f  ng may cause poo
+00000a80: 7220 7065 7266 6f72 6d61 6e63 6522 2222  r performance"""
+00000a90: 0a0a 0a64 6566 2067 6574 7465 7228 612c  ...def getter(a,
+00000aa0: 2062 2c20 6173 6172 7261 793d 5472 7565   b, asarray=True
+00000ab0: 2c20 6c6f 636b 3d4e 6f6e 6529 3a0a 2020  , lock=None):.  
+00000ac0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00000ad0: 622c 2074 7570 6c65 2920 616e 6420 616e  b, tuple) and an
+00000ae0: 7928 7820 6973 204e 6f6e 6520 666f 7220  y(x is None for 
+00000af0: 7820 696e 2062 293a 0a20 2020 2020 2020  x in b):.       
+00000b00: 2062 3220 3d20 7475 706c 6528 7820 666f   b2 = tuple(x fo
+00000b10: 7220 7820 696e 2062 2069 6620 7820 6973  r x in b if x is
+00000b20: 206e 6f74 204e 6f6e 6529 0a20 2020 2020   not None).     
+00000b30: 2020 2062 3320 3d20 7475 706c 6528 0a20     b3 = tuple(. 
+00000b40: 2020 2020 2020 2020 2020 204e 6f6e 6520             None 
+00000b50: 6966 2078 2069 7320 4e6f 6e65 2065 6c73  if x is None els
+00000b60: 6520 736c 6963 6528 4e6f 6e65 2c20 4e6f  e slice(None, No
+00000b70: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+00000b80: 666f 7220 7820 696e 2062 0a20 2020 2020  for x in b.     
+00000b90: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00000ba0: 696e 7374 616e 6365 2878 2c20 496e 7465  instance(x, Inte
+00000bb0: 6772 616c 290a 2020 2020 2020 2020 290a  gral).        ).
+00000bc0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00000bd0: 6574 7465 7228 612c 2062 322c 2061 7361  etter(a, b2, asa
+00000be0: 7272 6179 3d61 7361 7272 6179 2c20 6c6f  rray=asarray, lo
+00000bf0: 636b 3d6c 6f63 6b29 5b62 335d 0a0a 2020  ck=lock)[b3]..  
+00000c00: 2020 6966 206c 6f63 6b3a 0a20 2020 2020    if lock:.     
+00000c10: 2020 206c 6f63 6b2e 6163 7175 6972 6528     lock.acquire(
+00000c20: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+00000c30: 2020 2063 203d 2061 5b62 5d0a 2020 2020     c = a[b].    
+00000c40: 2020 2020 2320 4265 6c6f 7720 7765 2073      # Below we s
+00000c50: 7065 6369 616c 2d63 6173 6520 606e 702e  pecial-case `np.
+00000c60: 6d61 7472 6978 6020 746f 2066 6f72 6365  matrix` to force
+00000c70: 2061 2063 6f6e 7665 7273 696f 6e20 746f   a conversion to
+00000c80: 0a20 2020 2020 2020 2023 2060 6e70 2e6e  .        # `np.n
+00000c90: 6461 7272 6179 6020 616e 6420 7072 6573  darray` and pres
+00000ca0: 6572 7665 206f 7269 6769 6e61 6c20 4461  erve original Da
+00000cb0: 736b 2062 6568 6176 696f 7220 666f 7220  sk behavior for 
+00000cc0: 6067 6574 7465 7260 2c0a 2020 2020 2020  `getter`,.      
+00000cd0: 2020 2320 6173 2066 6f72 2061 6c6c 2070    # as for all p
+00000ce0: 7572 706f 7365 7320 606e 702e 6d61 7472  urposes `np.matr
+00000cf0: 6978 6020 6973 2061 7272 6179 2d6c 696b  ix` is array-lik
+00000d00: 6520 616e 6420 7468 7573 0a20 2020 2020  e and thus.     
+00000d10: 2020 2023 2060 6973 5f61 7272 6179 6c69     # `is_arrayli
+00000d20: 6b65 6020 6576 616c 7561 7465 7320 746f  ke` evaluates to
+00000d30: 2060 5472 7565 6020 696e 2074 6861 7420   `True` in that 
+00000d40: 6361 7365 2e0a 2020 2020 2020 2020 6966  case..        if
+00000d50: 2061 7361 7272 6179 2061 6e64 2028 6e6f   asarray and (no
+00000d60: 7420 6973 5f61 7272 6179 6c69 6b65 2863  t is_arraylike(c
+00000d70: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+00000d80: 632c 206e 702e 6d61 7472 6978 2929 3a0a  c, np.matrix)):.
+00000d90: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+00000da0: 6e70 2e61 7361 7272 6179 2863 290a 2020  np.asarray(c).  
+00000db0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
+00000dc0: 2020 2069 6620 6c6f 636b 3a0a 2020 2020     if lock:.    
+00000dd0: 2020 2020 2020 2020 6c6f 636b 2e72 656c          lock.rel
+00000de0: 6561 7365 2829 0a20 2020 2072 6574 7572  ease().    retur
+00000df0: 6e20 630a 0a0a 6465 6620 6765 7474 6572  n c...def getter
+00000e00: 5f6e 6f66 616e 6379 2861 2c20 622c 2061  _nofancy(a, b, a
+00000e10: 7361 7272 6179 3d54 7275 652c 206c 6f63  sarray=True, loc
+00000e20: 6b3d 4e6f 6e65 293a 0a20 2020 2022 2222  k=None):.    """
+00000e30: 4120 7369 6d70 6c65 2077 7261 7070 6572  A simple wrapper
+00000e40: 2061 726f 756e 6420 6060 6765 7474 6572   around ``getter
+00000e50: 6060 2e0a 0a20 2020 2055 7365 6420 746f  ``...    Used to
+00000e60: 2069 6e64 6963 6174 6520 746f 2074 6865   indicate to the
+00000e70: 206f 7074 696d 697a 6174 696f 6e20 7061   optimization pa
+00000e80: 7373 6573 2074 6861 7420 7468 6520 6261  sses that the ba
+00000e90: 636b 656e 6420 646f 6573 6e27 740a 2020  ckend doesn't.  
+00000ea0: 2020 7375 7070 6f72 7420 6661 6e63 7920    support fancy 
+00000eb0: 696e 6465 7869 6e67 2e0a 2020 2020 2222  indexing..    ""
+00000ec0: 220a 2020 2020 7265 7475 726e 2067 6574  ".    return get
+00000ed0: 7465 7228 612c 2062 2c20 6173 6172 7261  ter(a, b, asarra
+00000ee0: 793d 6173 6172 7261 792c 206c 6f63 6b3d  y=asarray, lock=
+00000ef0: 6c6f 636b 290a 0a0a 6465 6620 6765 7474  lock)...def gett
+00000f00: 6572 5f69 6e6c 696e 6528 612c 2062 2c20  er_inline(a, b, 
+00000f10: 6173 6172 7261 793d 5472 7565 2c20 6c6f  asarray=True, lo
+00000f20: 636b 3d4e 6f6e 6529 3a0a 2020 2020 2222  ck=None):.    ""
+00000f30: 2241 2067 6574 7465 7220 6675 6e63 7469  "A getter functi
+00000f40: 6f6e 2074 6861 7420 6f70 7469 6d69 7a61  on that optimiza
+00000f50: 7469 6f6e 7320 6665 656c 2063 6f6d 666f  tions feel comfo
+00000f60: 7274 6162 6c65 2069 6e6c 696e 696e 670a  rtable inlining.
+00000f70: 0a20 2020 2053 6c69 6369 6e67 206f 7065  .    Slicing ope
+00000f80: 7261 7469 6f6e 7320 7769 7468 2074 6869  rations with thi
+00000f90: 7320 6675 6e63 7469 6f6e 206d 6179 2062  s function may b
+00000fa0: 6520 696e 6c69 6e65 6420 696e 746f 2061  e inlined into a
+00000fb0: 2067 7261 7068 2c20 7375 6368 2061 730a   graph, such as.
+00000fc0: 2020 2020 696e 2074 6865 2066 6f6c 6c6f      in the follo
+00000fd0: 7769 6e67 2072 6577 7269 7465 0a0a 2020  wing rewrite..  
+00000fe0: 2020 2a2a 4265 666f 7265 2a2a 0a0a 2020    **Before**..  
+00000ff0: 2020 3e3e 3e20 6120 3d20 785b 3a31 305d    >>> a = x[:10]
+00001000: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00001010: 4950 0a20 2020 203e 3e3e 2062 203d 2061  IP.    >>> b = a
+00001020: 202b 2031 2020 2320 646f 6374 6573 743a   + 1  # doctest:
+00001030: 202b 534b 4950 0a20 2020 203e 3e3e 2063   +SKIP.    >>> c
+00001040: 203d 2061 202a 2032 2020 2320 646f 6374   = a * 2  # doct
+00001050: 6573 743a 202b 534b 4950 0a0a 2020 2020  est: +SKIP..    
+00001060: 2a2a 4166 7465 722a 2a0a 0a20 2020 203e  **After**..    >
+00001070: 3e3e 2062 203d 2078 5b3a 3130 5d20 2b20  >> b = x[:10] + 
+00001080: 3120 2023 2064 6f63 7465 7374 3a20 2b53  1  # doctest: +S
+00001090: 4b49 500a 2020 2020 3e3e 3e20 6320 3d20  KIP.    >>> c = 
+000010a0: 785b 3a31 305d 202a 2032 2020 2320 646f  x[:10] * 2  # do
+000010b0: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
+000010c0: 2020 5468 6973 2069 6e6c 696e 696e 6720    This inlining 
+000010d0: 6361 6e20 6265 2072 656c 6576 616e 7420  can be relevant 
+000010e0: 746f 206f 7065 7261 7469 6f6e 7320 7768  to operations wh
+000010f0: 656e 2072 756e 6e69 6e67 206f 6666 206f  en running off o
+00001100: 6620 6469 736b 2e0a 2020 2020 2222 220a  f disk..    """.
+00001110: 2020 2020 7265 7475 726e 2067 6574 7465      return gette
+00001120: 7228 612c 2062 2c20 6173 6172 7261 793d  r(a, b, asarray=
+00001130: 6173 6172 7261 792c 206c 6f63 6b3d 6c6f  asarray, lock=lo
+00001140: 636b 290a 0a0a 6672 6f6d 2064 6173 6b2e  ck)...from dask.
+00001150: 6172 7261 792e 6f70 7469 6d69 7a61 7469  array.optimizati
+00001160: 6f6e 2069 6d70 6f72 7420 6675 7365 5f73  on import fuse_s
+00001170: 6c69 6365 2c20 6f70 7469 6d69 7a65 0a0a  lice, optimize..
+00001180: 2320 5f5f 6172 7261 795f 6675 6e63 7469  # __array_functi
+00001190: 6f6e 5f5f 2064 6963 7420 666f 7220 6d61  on__ dict for ma
+000011a0: 7070 696e 6720 616c 6961 7365 7320 616e  pping aliases an
+000011b0: 6420 6d69 736d 6174 6368 696e 6720 6e61  d mismatching na
+000011c0: 6d65 730a 5f48 414e 444c 4544 5f46 554e  mes._HANDLED_FUN
+000011d0: 4354 494f 4e53 203d 207b 7d0a 0a0a 6465  CTIONS = {}...de
+000011e0: 6620 696d 706c 656d 656e 7473 282a 6e75  f implements(*nu
+000011f0: 6d70 795f 6675 6e63 7469 6f6e 7329 3a0a  mpy_functions):.
+00001200: 2020 2020 2222 2252 6567 6973 7465 7220      """Register 
+00001210: 616e 205f 5f61 7272 6179 5f66 756e 6374  an __array_funct
+00001220: 696f 6e5f 5f20 696d 706c 656d 656e 7461  ion__ implementa
+00001230: 7469 6f6e 2066 6f72 2064 6173 6b2e 6172  tion for dask.ar
+00001240: 7261 792e 4172 7261 790a 0a20 2020 2052  ray.Array..    R
+00001250: 6567 6973 7465 7220 7468 6174 2061 2066  egister that a f
+00001260: 756e 6374 696f 6e20 696d 706c 656d 656e  unction implemen
+00001270: 7473 2074 6865 2041 5049 206f 6620 6120  ts the API of a 
+00001280: 4e75 6d50 7920 6675 6e63 7469 6f6e 2028  NumPy function (
+00001290: 6f72 2073 6576 6572 616c 0a20 2020 204e  or several.    N
+000012a0: 756d 5079 2066 756e 6374 696f 6e73 2069  umPy functions i
+000012b0: 6e20 6361 7365 206f 6620 616c 6961 7365  n case of aliase
+000012c0: 7329 2077 6869 6368 2069 7320 6861 6e64  s) which is hand
+000012d0: 6c65 6420 7769 7468 0a20 2020 2060 605f  led with.    ``_
+000012e0: 5f61 7272 6179 5f66 756e 6374 696f 6e5f  _array_function_
+000012f0: 5f60 602e 0a0a 2020 2020 5061 7261 6d65  _``...    Parame
+00001300: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00001310: 2d2d 2d0a 2020 2020 5c5c 2a6e 756d 7079  ---.    \\*numpy
+00001320: 5f66 756e 6374 696f 6e73 203a 2063 616c  _functions : cal
+00001330: 6c61 626c 6573 0a20 2020 2020 2020 204f  lables.        O
+00001340: 6e65 206f 7220 6d6f 7265 204e 756d 5079  ne or more NumPy
+00001350: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
+00001360: 6172 6520 6861 6e64 6c65 6420 6279 2060  are handled by `
+00001370: 605f 5f61 7272 6179 5f66 756e 6374 696f  `__array_functio
+00001380: 6e5f 5f60 600a 2020 2020 2020 2020 616e  n__``.        an
+00001390: 6420 7769 6c6c 2062 6520 6d61 7070 6564  d will be mapped
+000013a0: 2062 7920 6069 6d70 6c65 6d65 6e74 7360   by `implements`
+000013b0: 2074 6f20 6120 6064 6173 6b2e 6172 7261   to a `dask.arra
+000013c0: 7960 2066 756e 6374 696f 6e2e 0a20 2020  y` function..   
+000013d0: 2022 2222 0a0a 2020 2020 6465 6620 6465   """..    def de
+000013e0: 636f 7261 746f 7228 6461 736b 5f66 756e  corator(dask_fun
+000013f0: 6329 3a0a 2020 2020 2020 2020 666f 7220  c):.        for 
+00001400: 6e75 6d70 795f 6675 6e63 7469 6f6e 2069  numpy_function i
+00001410: 6e20 6e75 6d70 795f 6675 6e63 7469 6f6e  n numpy_function
+00001420: 733a 0a20 2020 2020 2020 2020 2020 205f  s:.            _
+00001430: 4841 4e44 4c45 445f 4655 4e43 5449 4f4e  HANDLED_FUNCTION
+00001440: 535b 6e75 6d70 795f 6675 6e63 7469 6f6e  S[numpy_function
+00001450: 5d20 3d20 6461 736b 5f66 756e 630a 0a20  ] = dask_func.. 
+00001460: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00001470: 736b 5f66 756e 630a 0a20 2020 2072 6574  sk_func..    ret
+00001480: 7572 6e20 6465 636f 7261 746f 720a 0a0a  urn decorator...
+00001490: 6465 6620 5f73 686f 756c 645f 6465 6c65  def _should_dele
+000014a0: 6761 7465 2873 656c 662c 206f 7468 6572  gate(self, other
+000014b0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2022  ) -> bool:.    "
+000014c0: 2222 4368 6563 6b20 7768 6574 6865 7220  ""Check whether 
+000014d0: 4461 736b 2073 686f 756c 6420 6465 6c65  Dask should dele
+000014e0: 6761 7465 2074 6f20 7468 6520 6f74 6865  gate to the othe
+000014f0: 722e 0a20 2020 2054 6869 7320 696d 706c  r..    This impl
+00001500: 656d 656e 7461 7469 6f6e 2066 6f6c 6c6f  ementation follo
+00001510: 7773 204e 4550 2d31 333a 0a20 2020 2068  ws NEP-13:.    h
+00001520: 7474 7073 3a2f 2f6e 756d 7079 2e6f 7267  ttps://numpy.org
+00001530: 2f6e 6570 732f 6e65 702d 3030 3133 2d75  /neps/nep-0013-u
+00001540: 6675 6e63 2d6f 7665 7272 6964 6573 2e68  func-overrides.h
+00001550: 746d 6c23 6265 6861 7669 6f72 2d69 6e2d  tml#behavior-in-
+00001560: 636f 6d62 696e 6174 696f 6e2d 7769 7468  combination-with
+00001570: 2d70 7974 686f 6e2d 732d 6269 6e61 7279  -python-s-binary
+00001580: 2d6f 7065 7261 7469 6f6e 730a 2020 2020  -operations.    
+00001590: 2222 220a 2020 2020 6966 2068 6173 6174  """.    if hasat
+000015a0: 7472 286f 7468 6572 2c20 225f 5f61 7272  tr(other, "__arr
+000015b0: 6179 5f75 6675 6e63 5f5f 2229 2061 6e64  ay_ufunc__") and
+000015c0: 206f 7468 6572 2e5f 5f61 7272 6179 5f75   other.__array_u
+000015d0: 6675 6e63 5f5f 2069 7320 4e6f 6e65 3a0a  func__ is None:.
+000015e0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+000015f0: 7275 650a 2020 2020 656c 6966 2028 0a20  rue.    elif (. 
+00001600: 2020 2020 2020 2068 6173 6174 7472 286f         hasattr(o
+00001610: 7468 6572 2c20 225f 5f61 7272 6179 5f75  ther, "__array_u
+00001620: 6675 6e63 5f5f 2229 0a20 2020 2020 2020  func__").       
+00001630: 2061 6e64 206e 6f74 2069 735f 7661 6c69   and not is_vali
+00001640: 645f 6172 7261 795f 6368 756e 6b28 6f74  d_array_chunk(ot
+00001650: 6865 7229 0a20 2020 2020 2020 2023 2064  her).        # d
+00001660: 6f6e 2774 2064 656c 6567 6174 6520 746f  on't delegate to
+00001670: 206f 7572 206f 776e 2070 6172 656e 7420   our own parent 
+00001680: 636c 6173 7365 730a 2020 2020 2020 2020  classes.        
+00001690: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
+000016a0: 6365 2873 656c 662c 2074 7970 6528 6f74  ce(self, type(ot
+000016b0: 6865 7229 290a 2020 2020 2020 2020 616e  her)).        an
+000016c0: 6420 7479 7065 2873 656c 6629 2069 7320  d type(self) is 
+000016d0: 6e6f 7420 7479 7065 286f 7468 6572 290a  not type(other).
+000016e0: 2020 2020 293a 0a20 2020 2020 2020 2072      ):.        r
+000016f0: 6574 7572 6e20 5472 7565 0a20 2020 2072  eturn True.    r
+00001700: 6574 7572 6e20 4661 6c73 650a 0a0a 6465  eturn False...de
+00001710: 6620 6368 6563 6b5f 6966 5f68 616e 646c  f check_if_handl
+00001720: 6564 5f67 6976 656e 5f6f 7468 6572 2866  ed_given_other(f
+00001730: 293a 0a20 2020 2022 2222 4368 6563 6b20  ):.    """Check 
+00001740: 6966 206d 6574 686f 6420 6973 2068 616e  if method is han
+00001750: 646c 6564 2062 7920 4461 736b 2067 6976  dled by Dask giv
+00001760: 656e 2074 7970 6520 6f66 206f 7468 6572  en type of other
+00001770: 0a0a 2020 2020 456e 7375 7265 7320 7072  ..    Ensures pr
+00001780: 6f70 6572 2064 6566 6572 7261 6c20 746f  oper deferral to
+00001790: 2075 7063 6173 7420 7479 7065 7320 696e   upcast types in
+000017a0: 2064 756e 6465 7220 6f70 6572 6174 696f   dunder operatio
+000017b0: 6e73 2077 6974 686f 7574 0a20 2020 2061  ns without.    a
+000017c0: 7373 756d 696e 6720 756e 6b6e 6f77 6e20  ssuming unknown 
+000017d0: 7479 7065 7320 6172 6520 6175 746f 6d61  types are automa
+000017e0: 7469 6361 6c6c 7920 646f 776e 6361 7374  tically downcast
+000017f0: 2074 7970 6573 2e0a 2020 2020 2222 220a   types..    """.
+00001800: 0a20 2020 2040 7772 6170 7328 6629 0a20  .    @wraps(f). 
+00001810: 2020 2064 6566 2077 7261 7070 6572 2873     def wrapper(s
+00001820: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00001830: 2020 2020 2069 6620 5f73 686f 756c 645f       if _should_
+00001840: 6465 6c65 6761 7465 2873 656c 662c 206f  delegate(self, o
+00001850: 7468 6572 293a 0a20 2020 2020 2020 2020  ther):.         
+00001860: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+00001870: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
+00001880: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00001890: 2020 2072 6574 7572 6e20 6628 7365 6c66     return f(self
+000018a0: 2c20 6f74 6865 7229 0a0a 2020 2020 7265  , other)..    re
+000018b0: 7475 726e 2077 7261 7070 6572 0a0a 0a64  turn wrapper...d
+000018c0: 6566 2073 6c69 6365 735f 6672 6f6d 5f63  ef slices_from_c
+000018d0: 6875 6e6b 7328 6368 756e 6b73 293a 0a20  hunks(chunks):. 
+000018e0: 2020 2022 2222 5472 616e 736c 6174 6520     """Translate 
+000018f0: 6368 756e 6b73 2074 7570 6c65 2074 6f20  chunks tuple to 
+00001900: 6120 7365 7420 6f66 2073 6c69 6365 7320  a set of slices 
+00001910: 696e 2070 726f 6475 6374 206f 7264 6572  in product order
+00001920: 0a0a 2020 2020 3e3e 3e20 736c 6963 6573  ..    >>> slices
+00001930: 5f66 726f 6d5f 6368 756e 6b73 2828 2832  _from_chunks(((2
+00001940: 2c20 3229 2c20 2833 2c20 332c 2033 2929  , 2), (3, 3, 3))
+00001950: 2920 2023 2064 6f63 7465 7374 3a20 2b4e  )  # doctest: +N
+00001960: 4f52 4d41 4c49 5a45 5f57 4849 5445 5350  ORMALIZE_WHITESP
+00001970: 4143 450a 2020 2020 205b 2873 6c69 6365  ACE.     [(slice
+00001980: 2830 2c20 322c 204e 6f6e 6529 2c20 736c  (0, 2, None), sl
+00001990: 6963 6528 302c 2033 2c20 4e6f 6e65 2929  ice(0, 3, None))
+000019a0: 2c0a 2020 2020 2020 2873 6c69 6365 2830  ,.      (slice(0
+000019b0: 2c20 322c 204e 6f6e 6529 2c20 736c 6963  , 2, None), slic
+000019c0: 6528 332c 2036 2c20 4e6f 6e65 2929 2c0a  e(3, 6, None)),.
+000019d0: 2020 2020 2020 2873 6c69 6365 2830 2c20        (slice(0, 
+000019e0: 322c 204e 6f6e 6529 2c20 736c 6963 6528  2, None), slice(
+000019f0: 362c 2039 2c20 4e6f 6e65 2929 2c0a 2020  6, 9, None)),.  
+00001a00: 2020 2020 2873 6c69 6365 2832 2c20 342c      (slice(2, 4,
+00001a10: 204e 6f6e 6529 2c20 736c 6963 6528 302c   None), slice(0,
+00001a20: 2033 2c20 4e6f 6e65 2929 2c0a 2020 2020   3, None)),.    
+00001a30: 2020 2873 6c69 6365 2832 2c20 342c 204e    (slice(2, 4, N
+00001a40: 6f6e 6529 2c20 736c 6963 6528 332c 2036  one), slice(3, 6
+00001a50: 2c20 4e6f 6e65 2929 2c0a 2020 2020 2020  , None)),.      
+00001a60: 2873 6c69 6365 2832 2c20 342c 204e 6f6e  (slice(2, 4, Non
+00001a70: 6529 2c20 736c 6963 6528 362c 2039 2c20  e), slice(6, 9, 
+00001a80: 4e6f 6e65 2929 5d0a 2020 2020 2222 220a  None))].    """.
+00001a90: 2020 2020 6375 6d64 696d 7320 3d20 5b63      cumdims = [c
+00001aa0: 6163 6865 645f 6375 6d73 756d 2862 6473  ached_cumsum(bds
+00001ab0: 2c20 696e 6974 6961 6c5f 7a65 726f 3d54  , initial_zero=T
+00001ac0: 7275 6529 2066 6f72 2062 6473 2069 6e20  rue) for bds in 
+00001ad0: 6368 756e 6b73 5d0a 2020 2020 736c 6963  chunks].    slic
+00001ae0: 6573 203d 205b 0a20 2020 2020 2020 205b  es = [.        [
+00001af0: 736c 6963 6528 732c 2073 202b 2064 696d  slice(s, s + dim
+00001b00: 2920 666f 7220 732c 2064 696d 2069 6e20  ) for s, dim in 
+00001b10: 7a69 7028 7374 6172 7473 2c20 7368 6170  zip(starts, shap
+00001b20: 6573 295d 0a20 2020 2020 2020 2066 6f72  es)].        for
+00001b30: 2073 7461 7274 732c 2073 6861 7065 7320   starts, shapes 
+00001b40: 696e 207a 6970 2863 756d 6469 6d73 2c20  in zip(cumdims, 
+00001b50: 6368 756e 6b73 290a 2020 2020 5d0a 2020  chunks).    ].  
+00001b60: 2020 7265 7475 726e 206c 6973 7428 7072    return list(pr
+00001b70: 6f64 7563 7428 2a73 6c69 6365 7329 290a  oduct(*slices)).
+00001b80: 0a0a 6465 6620 6772 6170 685f 6672 6f6d  ..def graph_from
+00001b90: 5f61 7272 6179 6c69 6b65 280a 2020 2020  _arraylike(.    
+00001ba0: 6172 722c 2020 2320 416e 7920 6172 7261  arr,  # Any arra
+00001bb0: 792d 6c69 6b65 2077 6869 6368 2073 7570  y-like which sup
+00001bc0: 706f 7274 7320 736c 6963 696e 670a 2020  ports slicing.  
+00001bd0: 2020 6368 756e 6b73 2c0a 2020 2020 7368    chunks,.    sh
+00001be0: 6170 652c 0a20 2020 206e 616d 652c 0a20  ape,.    name,. 
+00001bf0: 2020 2067 6574 6974 656d 3d67 6574 7465     getitem=gette
+00001c00: 722c 0a20 2020 206c 6f63 6b3d 4661 6c73  r,.    lock=Fals
+00001c10: 652c 0a20 2020 2061 7361 7272 6179 3d54  e,.    asarray=T
+00001c20: 7275 652c 0a20 2020 2064 7479 7065 3d4e  rue,.    dtype=N
+00001c30: 6f6e 652c 0a20 2020 2069 6e6c 696e 655f  one,.    inline_
+00001c40: 6172 7261 793d 4661 6c73 652c 0a29 202d  array=False,.) -
+00001c50: 3e20 4869 6768 4c65 7665 6c47 7261 7068  > HighLevelGraph
+00001c60: 3a0a 2020 2020 2222 220a 2020 2020 4869  :.    """.    Hi
+00001c70: 6768 4c65 7665 6c47 7261 7068 2066 6f72  ghLevelGraph for
+00001c80: 2073 6c69 6369 6e67 2063 6875 6e6b 7320   slicing chunks 
+00001c90: 6672 6f6d 2061 6e20 6172 7261 792d 6c69  from an array-li
+00001ca0: 6b65 2061 6363 6f72 6469 6e67 2074 6f20  ke according to 
+00001cb0: 6120 6368 756e 6b20 7061 7474 6572 6e2e  a chunk pattern.
+00001cc0: 0a0a 2020 2020 4966 2060 6069 6e6c 696e  ..    If ``inlin
+00001cd0: 655f 6172 7261 7960 6020 6973 2054 7275  e_array`` is Tru
+00001ce0: 652c 2074 6869 7320 6d61 6b65 2061 2042  e, this make a B
+00001cf0: 6c6f 636b 7769 7365 206c 6179 6572 206f  lockwise layer o
+00001d00: 6620 736c 6963 696e 6720 7461 736b 7320  f slicing tasks 
+00001d10: 7768 6572 6520 7468 650a 2020 2020 6172  where the.    ar
+00001d20: 7261 792d 6c69 6b65 2069 7320 656d 6265  ray-like is embe
+00001d30: 6464 6564 2069 6e74 6f20 6576 6572 7920  dded into every 
+00001d40: 7461 736b 2e2c 0a0a 2020 2020 4966 2060  task.,..    If `
+00001d50: 6069 6e6c 696e 655f 6172 7261 7960 6020  `inline_array`` 
+00001d60: 6973 2046 616c 7365 2c20 7468 6973 2069  is False, this i
+00001d70: 6e73 6572 7473 2074 6865 2061 7272 6179  nserts the array
+00001d80: 2d6c 696b 6520 6173 2061 2073 7461 6e64  -like as a stand
+00001d90: 616c 6f6e 6520 7661 6c75 6520 696e 0a20  alone value in. 
+00001da0: 2020 2061 204d 6174 6572 6961 6c69 7a65     a Materialize
+00001db0: 644c 6179 6572 2c20 7468 656e 2067 656e  dLayer, then gen
+00001dc0: 6572 6174 6573 2061 2042 6c6f 636b 7769  erates a Blockwi
+00001dd0: 7365 206c 6179 6572 206f 6620 736c 6963  se layer of slic
+00001de0: 696e 6720 7461 736b 7320 7468 6174 2072  ing tasks that r
+00001df0: 6566 6572 0a20 2020 2074 6f20 6974 2e0a  efer.    to it..
+00001e00: 0a20 2020 203e 3e3e 2064 6963 7428 6772  .    >>> dict(gr
+00001e10: 6170 685f 6672 6f6d 5f61 7272 6179 6c69  aph_from_arrayli
+00001e20: 6b65 2861 7272 2c20 6368 756e 6b73 3d28  ke(arr, chunks=(
+00001e30: 322c 2033 292c 2073 6861 7065 3d28 342c  2, 3), shape=(4,
+00001e40: 2036 292c 206e 616d 653d 2258 222c 2069   6), name="X", i
+00001e50: 6e6c 696e 655f 6172 7261 793d 5472 7565  nline_array=True
+00001e60: 2929 2020 2320 646f 6374 6573 743a 202b  ))  # doctest: +
+00001e70: 534b 4950 0a20 2020 207b 2861 7272 2c20  SKIP.    {(arr, 
+00001e80: 302c 2030 293a 2028 6765 7474 6572 2c20  0, 0): (getter, 
+00001e90: 6172 722c 2028 736c 6963 6528 302c 2032  arr, (slice(0, 2
+00001ea0: 292c 2073 6c69 6365 2830 2c20 3329 2929  ), slice(0, 3)))
+00001eb0: 2c0a 2020 2020 2028 6172 722c 2031 2c20  ,.     (arr, 1, 
+00001ec0: 3029 3a20 2867 6574 7465 722c 2061 7272  0): (getter, arr
+00001ed0: 2c20 2873 6c69 6365 2832 2c20 3429 2c20  , (slice(2, 4), 
+00001ee0: 736c 6963 6528 302c 2033 2929 292c 0a20  slice(0, 3))),. 
+00001ef0: 2020 2020 2861 7272 2c20 312c 2031 293a      (arr, 1, 1):
+00001f00: 2028 6765 7474 6572 2c20 6172 722c 2028   (getter, arr, (
+00001f10: 736c 6963 6528 322c 2034 292c 2073 6c69  slice(2, 4), sli
+00001f20: 6365 2833 2c20 3629 2929 2c0a 2020 2020  ce(3, 6))),.    
+00001f30: 2028 6172 722c 2030 2c20 3129 3a20 2867   (arr, 0, 1): (g
+00001f40: 6574 7465 722c 2061 7272 2c20 2873 6c69  etter, arr, (sli
+00001f50: 6365 2830 2c20 3229 2c20 736c 6963 6528  ce(0, 2), slice(
+00001f60: 332c 2036 2929 297d 0a0a 2020 2020 3e3e  3, 6)))}..    >>
+00001f70: 3e20 6469 6374 2820 2023 2064 6f63 7465  > dict(  # docte
+00001f80: 7374 3a20 2b53 4b49 500a 2020 2020 2020  st: +SKIP.      
+00001f90: 2020 2020 2020 6772 6170 685f 6672 6f6d        graph_from
+00001fa0: 5f61 7272 6179 6c69 6b65 2861 7272 2c20  _arraylike(arr, 
+00001fb0: 6368 756e 6b73 3d28 2832 2c20 3229 2c20  chunks=((2, 2), 
+00001fc0: 2833 2c20 3329 292c 2073 6861 7065 3d28  (3, 3)), shape=(
+00001fd0: 342c 3629 2c20 6e61 6d65 3d22 5822 2c20  4,6), name="X", 
+00001fe0: 696e 6c69 6e65 5f61 7272 6179 3d46 616c  inline_array=Fal
+00001ff0: 7365 290a 2020 2020 2020 2020 290a 2020  se).        ).  
+00002000: 2020 7b22 6f72 6967 696e 616c 2d58 223a    {"original-X":
+00002010: 2061 7272 2c0a 2020 2020 2028 2758 272c   arr,.     ('X',
+00002020: 2030 2c20 3029 3a20 2867 6574 7465 722c   0, 0): (getter,
+00002030: 2027 6f72 6967 696e 616c 2d58 272c 2028   'original-X', (
+00002040: 736c 6963 6528 302c 2032 292c 2073 6c69  slice(0, 2), sli
+00002050: 6365 2830 2c20 3329 2929 2c0a 2020 2020  ce(0, 3))),.    
+00002060: 2028 2758 272c 2031 2c20 3029 3a20 2867   ('X', 1, 0): (g
+00002070: 6574 7465 722c 2027 6f72 6967 696e 616c  etter, 'original
+00002080: 2d58 272c 2028 736c 6963 6528 322c 2034  -X', (slice(2, 4
+00002090: 292c 2073 6c69 6365 2830 2c20 3329 2929  ), slice(0, 3)))
+000020a0: 2c0a 2020 2020 2028 2758 272c 2031 2c20  ,.     ('X', 1, 
+000020b0: 3129 3a20 2867 6574 7465 722c 2027 6f72  1): (getter, 'or
+000020c0: 6967 696e 616c 2d58 272c 2028 736c 6963  iginal-X', (slic
+000020d0: 6528 322c 2034 292c 2073 6c69 6365 2833  e(2, 4), slice(3
+000020e0: 2c20 3629 2929 2c0a 2020 2020 2028 2758  , 6))),.     ('X
+000020f0: 272c 2030 2c20 3129 3a20 2867 6574 7465  ', 0, 1): (gette
+00002100: 722c 2027 6f72 6967 696e 616c 2d58 272c  r, 'original-X',
+00002110: 2028 736c 6963 6528 302c 2032 292c 2073   (slice(0, 2), s
+00002120: 6c69 6365 2833 2c20 3629 2929 7d0a 2020  lice(3, 6)))}.  
+00002130: 2020 2222 220a 2020 2020 6368 756e 6b73    """.    chunks
+00002140: 203d 206e 6f72 6d61 6c69 7a65 5f63 6875   = normalize_chu
+00002150: 6e6b 7328 6368 756e 6b73 2c20 7368 6170  nks(chunks, shap
+00002160: 652c 2064 7479 7065 3d64 7479 7065 290a  e, dtype=dtype).
+00002170: 2020 2020 6f75 745f 696e 6420 3d20 7475      out_ind = tu
+00002180: 706c 6528 7261 6e67 6528 6c65 6e28 7368  ple(range(len(sh
+00002190: 6170 6529 2929 0a0a 2020 2020 6966 2028  ape)))..    if (
+000021a0: 0a20 2020 2020 2020 2068 6173 5f6b 6579  .        has_key
+000021b0: 776f 7264 2867 6574 6974 656d 2c20 2261  word(getitem, "a
+000021c0: 7361 7272 6179 2229 0a20 2020 2020 2020  sarray").       
+000021d0: 2061 6e64 2068 6173 5f6b 6579 776f 7264   and has_keyword
+000021e0: 2867 6574 6974 656d 2c20 226c 6f63 6b22  (getitem, "lock"
+000021f0: 290a 2020 2020 2020 2020 616e 6420 286e  ).        and (n
+00002200: 6f74 2061 7361 7272 6179 206f 7220 6c6f  ot asarray or lo
+00002210: 636b 290a 2020 2020 293a 0a20 2020 2020  ck).    ):.     
+00002220: 2020 206b 7761 7267 7320 3d20 7b22 6173     kwargs = {"as
+00002230: 6172 7261 7922 3a20 6173 6172 7261 792c  array": asarray,
+00002240: 2022 6c6f 636b 223a 206c 6f63 6b7d 0a20   "lock": lock}. 
+00002250: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00002260: 2023 2043 6f6d 6d6f 6e20 6361 7365 2c20   # Common case, 
+00002270: 6472 6f70 2065 7874 7261 2070 6172 616d  drop extra param
+00002280: 6574 6572 730a 2020 2020 2020 2020 6b77  eters.        kw
+00002290: 6172 6773 203d 207b 7d0a 0a20 2020 2069  args = {}..    i
+000022a0: 6620 696e 6c69 6e65 5f61 7272 6179 3a0a  f inline_array:.
+000022b0: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+000022c0: 636f 7265 5f62 6c6f 636b 7769 7365 280a  core_blockwise(.
+000022d0: 2020 2020 2020 2020 2020 2020 6765 7469              geti
+000022e0: 7465 6d2c 0a20 2020 2020 2020 2020 2020  tem,.           
+000022f0: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
+00002300: 2020 206f 7574 5f69 6e64 2c0a 2020 2020     out_ind,.    
+00002310: 2020 2020 2020 2020 6172 722c 0a20 2020          arr,.   
+00002320: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00002330: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+00002340: 536c 6963 6544 6570 2863 6875 6e6b 7329  SliceDep(chunks)
+00002350: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00002360: 745f 696e 642c 0a20 2020 2020 2020 2020  t_ind,.         
+00002370: 2020 206e 756d 626c 6f63 6b73 3d7b 7d2c     numblocks={},
+00002380: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+00002390: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+000023a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000023b0: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+000023c0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+000023d0: 6e61 6d65 2c20 6c61 7965 7229 0a20 2020  name, layer).   
+000023e0: 2065 6c73 653a 0a20 2020 2020 2020 206f   else:.        o
+000023f0: 7269 6769 6e61 6c5f 6e61 6d65 203d 2022  riginal_name = "
+00002400: 6f72 6967 696e 616c 2d22 202b 206e 616d  original-" + nam
+00002410: 650a 0a20 2020 2020 2020 206c 6179 6572  e..        layer
+00002420: 7320 3d20 7b7d 0a20 2020 2020 2020 206c  s = {}.        l
+00002430: 6179 6572 735b 6f72 6967 696e 616c 5f6e  ayers[original_n
+00002440: 616d 655d 203d 204d 6174 6572 6961 6c69  ame] = Materiali
+00002450: 7a65 644c 6179 6572 287b 6f72 6967 696e  zedLayer({origin
+00002460: 616c 5f6e 616d 653a 2061 7272 7d29 0a20  al_name: arr}). 
+00002470: 2020 2020 2020 206c 6179 6572 735b 6e61         layers[na
+00002480: 6d65 5d20 3d20 636f 7265 5f62 6c6f 636b  me] = core_block
+00002490: 7769 7365 280a 2020 2020 2020 2020 2020  wise(.          
+000024a0: 2020 6765 7469 7465 6d2c 0a20 2020 2020    getitem,.     
+000024b0: 2020 2020 2020 206e 616d 652c 0a20 2020         name,.   
+000024c0: 2020 2020 2020 2020 206f 7574 5f69 6e64           out_ind
+000024d0: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+000024e0: 6967 696e 616c 5f6e 616d 652c 0a20 2020  iginal_name,.   
+000024f0: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00002500: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+00002510: 536c 6963 6544 6570 2863 6875 6e6b 7329  SliceDep(chunks)
+00002520: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00002530: 745f 696e 642c 0a20 2020 2020 2020 2020  t_ind,.         
+00002540: 2020 206e 756d 626c 6f63 6b73 3d7b 7d2c     numblocks={},
+00002550: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+00002560: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+00002570: 0a0a 2020 2020 2020 2020 6465 7073 203d  ..        deps =
+00002580: 207b 0a20 2020 2020 2020 2020 2020 206f   {.            o
+00002590: 7269 6769 6e61 6c5f 6e61 6d65 3a20 7365  riginal_name: se
+000025a0: 7428 292c 0a20 2020 2020 2020 2020 2020  t(),.           
+000025b0: 206e 616d 653a 207b 6f72 6967 696e 616c   name: {original
+000025c0: 5f6e 616d 657d 2c0a 2020 2020 2020 2020  _name},.        
+000025d0: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+000025e0: 2048 6967 684c 6576 656c 4772 6170 6828   HighLevelGraph(
+000025f0: 6c61 7965 7273 2c20 6465 7073 290a 0a0a  layers, deps)...
+00002600: 6465 6620 646f 746d 616e 7928 412c 2042  def dotmany(A, B
+00002610: 2c20 6c65 6674 6675 6e63 3d4e 6f6e 652c  , leftfunc=None,
+00002620: 2072 6967 6874 6675 6e63 3d4e 6f6e 652c   rightfunc=None,
+00002630: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00002640: 2222 2244 6f74 2070 726f 6475 6374 206f  """Dot product o
+00002650: 6620 6d61 6e79 2061 6c69 676e 6564 2063  f many aligned c
+00002660: 6875 6e6b 730a 0a20 2020 203e 3e3e 2078  hunks..    >>> x
+00002670: 203d 206e 702e 6172 7261 7928 5b5b 312c   = np.array([[1,
+00002680: 2032 5d2c 205b 312c 2032 5d5d 290a 2020   2], [1, 2]]).  
+00002690: 2020 3e3e 3e20 7920 3d20 6e70 2e61 7272    >>> y = np.arr
+000026a0: 6179 285b 5b31 302c 2032 305d 2c20 5b31  ay([[10, 20], [1
+000026b0: 302c 2032 305d 5d29 0a20 2020 203e 3e3e  0, 20]]).    >>>
+000026c0: 2064 6f74 6d61 6e79 285b 782c 2078 2c20   dotmany([x, x, 
+000026d0: 785d 2c20 5b79 2c20 792c 2079 5d29 0a20  x], [y, y, y]). 
+000026e0: 2020 2061 7272 6179 285b 5b20 3930 2c20     array([[ 90, 
+000026f0: 3138 305d 2c0a 2020 2020 2020 2020 2020  180],.          
+00002700: 205b 2039 302c 2031 3830 5d5d 290a 0a20   [ 90, 180]]).. 
+00002710: 2020 204f 7074 696f 6e61 6c6c 7920 7061     Optionally pa
+00002720: 7373 2069 6e20 6675 6e63 7469 6f6e 7320  ss in functions 
+00002730: 746f 2061 7070 6c79 2074 6f20 7468 6520  to apply to the 
+00002740: 6c65 6674 2061 6e64 2072 6967 6874 2063  left and right c
+00002750: 6875 6e6b 730a 0a20 2020 203e 3e3e 2064  hunks..    >>> d
+00002760: 6f74 6d61 6e79 285b 782c 2078 2c20 785d  otmany([x, x, x]
+00002770: 2c20 5b79 2c20 792c 2079 5d2c 2072 6967  , [y, y, y], rig
+00002780: 6874 6675 6e63 3d6e 702e 7472 616e 7370  htfunc=np.transp
+00002790: 6f73 6529 0a20 2020 2061 7272 6179 285b  ose).    array([
+000027a0: 5b31 3530 2c20 3135 305d 2c0a 2020 2020  [150, 150],.    
+000027b0: 2020 2020 2020 205b 3135 302c 2031 3530         [150, 150
+000027c0: 5d5d 290a 2020 2020 2222 220a 2020 2020  ]]).    """.    
+000027d0: 6966 206c 6566 7466 756e 633a 0a20 2020  if leftfunc:.   
+000027e0: 2020 2020 2041 203d 206d 6170 286c 6566       A = map(lef
+000027f0: 7466 756e 632c 2041 290a 2020 2020 6966  tfunc, A).    if
+00002800: 2072 6967 6874 6675 6e63 3a0a 2020 2020   rightfunc:.    
+00002810: 2020 2020 4220 3d20 6d61 7028 7269 6768      B = map(righ
+00002820: 7466 756e 632c 2042 290a 2020 2020 7265  tfunc, B).    re
+00002830: 7475 726e 2073 756d 286d 6170 2870 6172  turn sum(map(par
+00002840: 7469 616c 286e 702e 646f 742c 202a 2a6b  tial(np.dot, **k
+00002850: 7761 7267 7329 2c20 412c 2042 2929 0a0a  wargs), A, B))..
+00002860: 0a64 6566 205f 636f 6e63 6174 656e 6174  .def _concatenat
+00002870: 6532 2861 7272 6179 732c 2061 7865 733d  e2(arrays, axes=
+00002880: 4e6f 6e65 293a 0a20 2020 2022 2222 5265  None):.    """Re
+00002890: 6375 7273 6976 656c 7920 636f 6e63 6174  cursively concat
+000028a0: 656e 6174 6520 6e65 7374 6564 206c 6973  enate nested lis
+000028b0: 7473 206f 6620 6172 7261 7973 2061 6c6f  ts of arrays alo
+000028c0: 6e67 2061 7865 730a 0a20 2020 2045 6163  ng axes..    Eac
+000028d0: 6820 656e 7472 7920 696e 2061 7865 7320  h entry in axes 
+000028e0: 636f 7272 6573 706f 6e64 7320 746f 2065  corresponds to e
+000028f0: 6163 6820 6c65 7665 6c20 6f66 2074 6865  ach level of the
+00002900: 206e 6573 7465 6420 6c69 7374 2e20 2054   nested list.  T
+00002910: 6865 0a20 2020 206c 656e 6774 6820 6f66  he.    length of
+00002920: 2061 7865 7320 7368 6f75 6c64 2063 6f72   axes should cor
+00002930: 7265 7370 6f6e 6420 746f 2074 6865 206c  respond to the l
+00002940: 6576 656c 206f 6620 6e65 7374 696e 6720  evel of nesting 
+00002950: 6f66 2061 7272 6179 732e 0a20 2020 2049  of arrays..    I
+00002960: 6620 6178 6573 2069 7320 616e 2065 6d70  f axes is an emp
+00002970: 7479 206c 6973 7420 6f72 2074 7570 6c65  ty list or tuple
+00002980: 2c20 7265 7475 726e 2061 7272 6179 732c  , return arrays,
+00002990: 206f 7220 6172 7261 7973 5b30 5d20 6966   or arrays[0] if
+000029a0: 0a20 2020 2061 7272 6179 7320 6973 2061  .    arrays is a
+000029b0: 206c 6973 742e 0a0a 2020 2020 3e3e 3e20   list...    >>> 
+000029c0: 7820 3d20 6e70 2e61 7272 6179 285b 5b31  x = np.array([[1
+000029d0: 2c20 325d 2c20 5b33 2c20 345d 5d29 0a20  , 2], [3, 4]]). 
+000029e0: 2020 203e 3e3e 205f 636f 6e63 6174 656e     >>> _concaten
+000029f0: 6174 6532 285b 782c 2078 5d2c 2061 7865  ate2([x, x], axe
+00002a00: 733d 5b30 5d29 0a20 2020 2061 7272 6179  s=[0]).    array
+00002a10: 285b 5b31 2c20 325d 2c0a 2020 2020 2020  ([[1, 2],.      
+00002a20: 2020 2020 205b 332c 2034 5d2c 0a20 2020       [3, 4],.   
+00002a30: 2020 2020 2020 2020 5b31 2c20 325d 2c0a          [1, 2],.
+00002a40: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
+00002a50: 5d5d 290a 0a20 2020 203e 3e3e 205f 636f  ]])..    >>> _co
+00002a60: 6e63 6174 656e 6174 6532 285b 782c 2078  ncatenate2([x, x
+00002a70: 5d2c 2061 7865 733d 5b31 5d29 0a20 2020  ], axes=[1]).   
+00002a80: 2061 7272 6179 285b 5b31 2c20 322c 2031   array([[1, 2, 1
+00002a90: 2c20 325d 2c0a 2020 2020 2020 2020 2020  , 2],.          
+00002aa0: 205b 332c 2034 2c20 332c 2034 5d5d 290a   [3, 4, 3, 4]]).
+00002ab0: 0a20 2020 203e 3e3e 205f 636f 6e63 6174  .    >>> _concat
+00002ac0: 656e 6174 6532 285b 5b78 2c20 785d 2c20  enate2([[x, x], 
+00002ad0: 5b78 2c20 785d 5d2c 2061 7865 733d 5b30  [x, x]], axes=[0
+00002ae0: 2c20 315d 290a 2020 2020 6172 7261 7928  , 1]).    array(
+00002af0: 5b5b 312c 2032 2c20 312c 2032 5d2c 0a20  [[1, 2, 1, 2],. 
+00002b00: 2020 2020 2020 2020 2020 5b33 2c20 342c            [3, 4,
+00002b10: 2033 2c20 345d 2c0a 2020 2020 2020 2020   3, 4],.        
+00002b20: 2020 205b 312c 2032 2c20 312c 2032 5d2c     [1, 2, 1, 2],
+00002b30: 0a20 2020 2020 2020 2020 2020 5b33 2c20  .           [3, 
+00002b40: 342c 2033 2c20 345d 5d29 0a0a 2020 2020  4, 3, 4]])..    
+00002b50: 5375 7070 6f72 7473 2049 7465 7261 746f  Supports Iterato
+00002b60: 7273 0a20 2020 203e 3e3e 205f 636f 6e63  rs.    >>> _conc
+00002b70: 6174 656e 6174 6532 2869 7465 7228 5b78  atenate2(iter([x
+00002b80: 2c20 785d 292c 2061 7865 733d 5b31 5d29  , x]), axes=[1])
+00002b90: 0a20 2020 2061 7272 6179 285b 5b31 2c20  .    array([[1, 
+00002ba0: 322c 2031 2c20 325d 2c0a 2020 2020 2020  2, 1, 2],.      
+00002bb0: 2020 2020 205b 332c 2034 2c20 332c 2034       [3, 4, 3, 4
+00002bc0: 5d5d 290a 0a20 2020 2053 7065 6369 616c  ]])..    Special
+00002bd0: 2043 6173 650a 2020 2020 3e3e 3e20 5f63   Case.    >>> _c
+00002be0: 6f6e 6361 7465 6e61 7465 3228 5b78 2c20  oncatenate2([x, 
+00002bf0: 785d 2c20 6178 6573 3d28 2929 0a20 2020  x], axes=()).   
+00002c00: 2061 7272 6179 285b 5b31 2c20 325d 2c0a   array([[1, 2],.
+00002c10: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
+00002c20: 5d5d 290a 2020 2020 2222 220a 2020 2020  ]]).    """.    
+00002c30: 6966 2061 7865 7320 6973 204e 6f6e 653a  if axes is None:
+00002c40: 0a20 2020 2020 2020 2061 7865 7320 3d20  .        axes = 
+00002c50: 5b5d 0a0a 2020 2020 6966 2061 7865 7320  []..    if axes 
+00002c60: 3d3d 2028 293a 0a20 2020 2020 2020 2069  == ():.        i
+00002c70: 6620 6973 696e 7374 616e 6365 2861 7272  f isinstance(arr
+00002c80: 6179 732c 206c 6973 7429 3a0a 2020 2020  ays, list):.    
+00002c90: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00002ca0: 7272 6179 735b 305d 0a20 2020 2020 2020  rrays[0].       
+00002cb0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00002cc0: 2020 2072 6574 7572 6e20 6172 7261 7973     return arrays
+00002cd0: 0a0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
+00002ce0: 6e63 6528 6172 7261 7973 2c20 4974 6572  nce(arrays, Iter
+00002cf0: 6174 6f72 293a 0a20 2020 2020 2020 2061  ator):.        a
+00002d00: 7272 6179 7320 3d20 6c69 7374 2861 7272  rrays = list(arr
+00002d10: 6179 7329 0a20 2020 2069 6620 6e6f 7420  ays).    if not 
+00002d20: 6973 696e 7374 616e 6365 2861 7272 6179  isinstance(array
+00002d30: 732c 2028 6c69 7374 2c20 7475 706c 6529  s, (list, tuple)
+00002d40: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00002d50: 6e20 6172 7261 7973 0a20 2020 2069 6620  n arrays.    if 
+00002d60: 6c65 6e28 6178 6573 2920 3e20 313a 0a20  len(axes) > 1:. 
+00002d70: 2020 2020 2020 2061 7272 6179 7320 3d20         arrays = 
+00002d80: 5b5f 636f 6e63 6174 656e 6174 6532 2861  [_concatenate2(a
+00002d90: 2c20 6178 6573 3d61 7865 735b 313a 5d29  , axes=axes[1:])
+00002da0: 2066 6f72 2061 2069 6e20 6172 7261 7973   for a in arrays
+00002db0: 5d0a 2020 2020 636f 6e63 6174 656e 6174  ].    concatenat
+00002dc0: 6520 3d20 636f 6e63 6174 656e 6174 655f  e = concatenate_
+00002dd0: 6c6f 6f6b 7570 2e64 6973 7061 7463 6828  lookup.dispatch(
+00002de0: 0a20 2020 2020 2020 2074 7970 6528 6d61  .        type(ma
+00002df0: 7828 6172 7261 7973 2c20 6b65 793d 6c61  x(arrays, key=la
+00002e00: 6d62 6461 2078 3a20 6765 7461 7474 7228  mbda x: getattr(
+00002e10: 782c 2022 5f5f 6172 7261 795f 7072 696f  x, "__array_prio
+00002e20: 7269 7479 5f5f 222c 2030 2929 290a 2020  rity__", 0))).  
+00002e30: 2020 290a 2020 2020 6966 2069 7369 6e73    ).    if isins
+00002e40: 7461 6e63 6528 6172 7261 7973 5b30 5d2c  tance(arrays[0],
+00002e50: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+00002e60: 2320 4861 6e64 6c65 2063 6f6e 6361 7465  # Handle concate
+00002e70: 6e61 7469 6f6e 206f 6620 6064 6963 7460  nation of `dict`
+00002e80: 732c 2075 7365 6420 6173 2061 2072 6570  s, used as a rep
+00002e90: 6c61 6365 6d65 6e74 2066 6f72 2073 7472  lacement for str
+00002ea0: 7563 7475 7265 640a 2020 2020 2020 2020  uctured.        
+00002eb0: 2320 6172 7261 7973 2077 6865 6e20 7468  # arrays when th
+00002ec0: 6174 2773 206e 6f74 2073 7570 706f 7274  at's not support
+00002ed0: 6564 2062 7920 7468 6520 6172 7261 7920  ed by the array 
+00002ee0: 6c69 6272 6172 7920 2865 2e67 2e2c 2043  library (e.g., C
+00002ef0: 7550 7929 2e0a 2020 2020 2020 2020 6b65  uPy)..        ke
+00002f00: 7973 203d 206c 6973 7428 6172 7261 7973  ys = list(arrays
+00002f10: 5b30 5d2e 6b65 7973 2829 290a 2020 2020  [0].keys()).    
+00002f20: 2020 2020 6173 7365 7274 2061 6c6c 286c      assert all(l
+00002f30: 6973 7428 612e 6b65 7973 2829 2920 3d3d  ist(a.keys()) ==
+00002f40: 206b 6579 7320 666f 7220 6120 696e 2061   keys for a in a
+00002f50: 7272 6179 7329 0a20 2020 2020 2020 2072  rrays).        r
+00002f60: 6574 203d 2064 6963 7428 290a 2020 2020  et = dict().    
+00002f70: 2020 2020 666f 7220 6b20 696e 206b 6579      for k in key
+00002f80: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00002f90: 6574 5b6b 5d20 3d20 636f 6e63 6174 656e  et[k] = concaten
+00002fa0: 6174 6528 6c69 7374 2861 5b6b 5d20 666f  ate(list(a[k] fo
+00002fb0: 7220 6120 696e 2061 7272 6179 7329 2c20  r a in arrays), 
+00002fc0: 6178 6973 3d61 7865 735b 305d 290a 2020  axis=axes[0]).  
+00002fd0: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
+00002fe0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00002ff0: 2020 2072 6574 7572 6e20 636f 6e63 6174     return concat
+00003000: 656e 6174 6528 6172 7261 7973 2c20 6178  enate(arrays, ax
+00003010: 6973 3d61 7865 735b 305d 290a 0a0a 6465  is=axes[0])...de
+00003020: 6620 6170 706c 795f 696e 6665 725f 6474  f apply_infer_dt
+00003030: 7970 6528 6675 6e63 2c20 6172 6773 2c20  ype(func, args, 
+00003040: 6b77 6172 6773 2c20 6675 6e63 6e61 6d65  kwargs, funcname
+00003050: 2c20 7375 6767 6573 745f 6474 7970 653d  , suggest_dtype=
+00003060: 2264 7479 7065 222c 206e 6f75 743d 4e6f  "dtype", nout=No
+00003070: 6e65 293a 0a20 2020 2022 2222 0a20 2020  ne):.    """.   
+00003080: 2054 7269 6573 2074 6f20 696e 6665 7220   Tries to infer 
+00003090: 6f75 7470 7574 2064 7479 7065 206f 6620  output dtype of 
+000030a0: 6060 6675 6e63 6060 2066 6f72 2061 2073  ``func`` for a s
+000030b0: 6d61 6c6c 2073 6574 206f 6620 696e 7075  mall set of inpu
+000030c0: 7420 6172 6775 6d65 6e74 732e 0a0a 2020  t arguments...  
+000030d0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+000030e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000030f0: 6675 6e63 3a20 4361 6c6c 6162 6c65 0a20  func: Callable. 
+00003100: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
+00003110: 666f 7220 7768 6963 6820 6f75 7470 7574  for which output
+00003120: 2064 7479 7065 2069 7320 746f 2062 6520   dtype is to be 
+00003130: 6465 7465 726d 696e 6564 0a0a 2020 2020  determined..    
+00003140: 6172 6773 3a20 4c69 7374 206f 6620 6172  args: List of ar
+00003150: 7261 7920 6c69 6b65 0a20 2020 2020 2020  ray like.       
+00003160: 2041 7267 756d 656e 7473 2074 6f20 7468   Arguments to th
+00003170: 6520 6675 6e63 7469 6f6e 2c20 7768 6963  e function, whic
+00003180: 6820 776f 756c 6420 7573 7561 6c6c 7920  h would usually 
+00003190: 6265 2075 7365 642e 204f 6e6c 7920 6174  be used. Only at
+000031a0: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
+000031b0: 2060 606e 6469 6d60 6020 616e 6420 6060   ``ndim`` and ``
+000031c0: 6474 7970 6560 6020 6172 6520 7573 6564  dtype`` are used
+000031d0: 2e0a 0a20 2020 206b 7761 7267 733a 2064  ...    kwargs: d
+000031e0: 6963 740a 2020 2020 2020 2020 4164 6469  ict.        Addi
+000031f0: 7469 6f6e 616c 2060 606b 7761 7267 7360  tional ``kwargs`
+00003200: 6020 746f 2074 6865 2060 6066 756e 6360  ` to the ``func`
+00003210: 600a 0a20 2020 2066 756e 636e 616d 653a  `..    funcname:
+00003220: 2053 7472 696e 670a 2020 2020 2020 2020   String.        
+00003230: 4e61 6d65 206f 6620 6361 6c6c 696e 6720  Name of calling 
+00003240: 6675 6e63 7469 6f6e 2074 6f20 696d 7072  function to impr
+00003250: 6f76 6520 706f 7465 6e74 6961 6c20 6572  ove potential er
+00003260: 726f 7220 6d65 7373 6167 6573 0a0a 2020  ror messages..  
+00003270: 2020 7375 6767 6573 745f 6474 7970 653a    suggest_dtype:
+00003280: 204e 6f6e 652f 4661 6c73 6520 6f72 2053   None/False or S
+00003290: 7472 696e 670a 2020 2020 2020 2020 4966  tring.        If
+000032a0: 206e 6f74 2060 604e 6f6e 6560 6020 6164   not ``None`` ad
+000032b0: 6473 2073 7567 6765 7374 696f 6e20 746f  ds suggestion to
+000032c0: 2070 6f74 656e 7469 616c 2065 7272 6f72   potential error
+000032d0: 206d 6573 7361 6765 2074 6f20 7370 6563   message to spec
+000032e0: 6966 7920 6120 6474 7970 650a 2020 2020  ify a dtype.    
+000032f0: 2020 2020 7669 6120 7468 6520 7370 6563      via the spec
+00003300: 6966 6965 6420 6b77 6172 672e 2044 6566  ified kwarg. Def
+00003310: 6175 6c74 7320 746f 2060 6027 6474 7970  aults to ``'dtyp
+00003320: 6527 6060 2e0a 0a20 2020 206e 6f75 743a  e'``...    nout:
+00003330: 204e 6f6e 6520 6f72 2049 6e74 0a20 2020   None or Int.   
+00003340: 2020 2020 2060 604e 6f6e 6560 6020 6966       ``None`` if
+00003350: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
+00003360: 7320 7369 6e67 6c65 206f 7574 7075 742c  s single output,
+00003370: 2069 6e74 6567 6572 2069 6620 6d61 6e79   integer if many
+00003380: 2e0a 2020 2020 2020 2020 4465 6166 756c  ..        Deaful
+00003390: 7473 2074 6f20 6060 4e6f 6e65 6060 2e0a  ts to ``None``..
+000033a0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+000033b0: 202d 2d2d 2d2d 2d2d 0a20 2020 203a 2064   -------.    : d
+000033c0: 7479 7065 206f 7220 4c69 7374 206f 6620  type or List of 
+000033d0: 6474 7970 650a 2020 2020 2020 2020 4f6e  dtype.        On
+000033e0: 6520 6f72 206d 616e 7920 6474 7970 6573  e or many dtypes
+000033f0: 2028 6465 7065 6e64 696e 6720 6f6e 2060   (depending on `
+00003400: 606e 6f75 7460 6029 0a20 2020 2022 2222  `nout``).    """
+00003410: 0a20 2020 2066 726f 6d20 6461 736b 2e61  .    from dask.a
+00003420: 7272 6179 2e75 7469 6c73 2069 6d70 6f72  rray.utils impor
+00003430: 7420 6d65 7461 5f66 726f 6d5f 6172 7261  t meta_from_arra
+00003440: 790a 0a20 2020 2023 206d 616b 6520 7375  y..    # make su
+00003450: 7265 2074 6861 7420 6576 6572 7920 6172  re that every ar
+00003460: 6720 6973 2061 6e20 6576 616c 7561 7465  g is an evaluate
+00003470: 6420 6172 7261 790a 2020 2020 6172 6773  d array.    args
+00003480: 203d 205b 0a20 2020 2020 2020 206e 702e   = [.        np.
+00003490: 6f6e 6573 5f6c 696b 6528 6d65 7461 5f66  ones_like(meta_f
+000034a0: 726f 6d5f 6172 7261 7928 7829 2c20 7368  rom_array(x), sh
+000034b0: 6170 653d 2828 312c 2920 2a20 782e 6e64  ape=((1,) * x.nd
+000034c0: 696d 292c 2064 7479 7065 3d78 2e64 7479  im), dtype=x.dty
+000034d0: 7065 290a 2020 2020 2020 2020 6966 2069  pe).        if i
+000034e0: 735f 6172 7261 796c 696b 6528 7829 0a20  s_arraylike(x). 
+000034f0: 2020 2020 2020 2065 6c73 6520 780a 2020         else x.  
+00003500: 2020 2020 2020 666f 7220 7820 696e 2061        for x in a
+00003510: 7267 730a 2020 2020 5d0a 2020 2020 7472  rgs.    ].    tr
+00003520: 793a 0a20 2020 2020 2020 2077 6974 6820  y:.        with 
+00003530: 6e70 2e65 7272 7374 6174 6528 616c 6c3d  np.errstate(all=
+00003540: 2269 676e 6f72 6522 293a 0a20 2020 2020  "ignore"):.     
+00003550: 2020 2020 2020 206f 203d 2066 756e 6328         o = func(
+00003560: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00003570: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+00003580: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+00003590: 2020 2020 6578 635f 7479 7065 2c20 6578      exc_type, ex
+000035a0: 635f 7661 6c75 652c 2065 7863 5f74 7261  c_value, exc_tra
+000035b0: 6365 6261 636b 203d 2073 7973 2e65 7863  ceback = sys.exc
+000035c0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+000035d0: 7462 203d 2022 222e 6a6f 696e 2874 7261  tb = "".join(tra
+000035e0: 6365 6261 636b 2e66 6f72 6d61 745f 7462  ceback.format_tb
+000035f0: 2865 7863 5f74 7261 6365 6261 636b 2929  (exc_traceback))
+00003600: 0a20 2020 2020 2020 2073 7567 6765 7374  .        suggest
+00003610: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00003620: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00003630: 2020 2022 506c 6561 7365 2073 7065 6369     "Please speci
+00003640: 6679 2074 6865 2064 7479 7065 2065 7870  fy the dtype exp
+00003650: 6c69 6369 746c 7920 7573 696e 6720 7468  licitly using th
+00003660: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00003670: 2020 2020 2260 7b64 7479 7065 7d60 206b      "`{dtype}` k
+00003680: 7761 7267 2e5c 6e5c 6e22 2e66 6f72 6d61  warg.\n\n".forma
+00003690: 7428 6474 7970 653d 7375 6767 6573 745f  t(dtype=suggest_
+000036a0: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
+000036b0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000036c0: 2069 6620 7375 6767 6573 745f 6474 7970   if suggest_dtyp
+000036d0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+000036e0: 7365 2022 220a 2020 2020 2020 2020 290a  se "".        ).
+000036f0: 2020 2020 2020 2020 6d73 6720 3d20 280a          msg = (.
+00003700: 2020 2020 2020 2020 2020 2020 6622 6064              f"`d
+00003710: 7479 7065 6020 696e 6665 7265 6e63 6520  type` inference 
+00003720: 6661 696c 6564 2069 6e20 607b 6675 6e63  failed in `{func
+00003730: 6e61 6d65 7d60 2e5c 6e5c 6e22 0a20 2020  name}`.\n\n".   
+00003740: 2020 2020 2020 2020 2066 227b 7375 6767           f"{sugg
+00003750: 6573 747d 220a 2020 2020 2020 2020 2020  est}".          
+00003760: 2020 224f 7269 6769 6e61 6c20 6572 726f    "Original erro
+00003770: 7220 6973 2062 656c 6f77 3a5c 6e22 0a20  r is below:\n". 
+00003780: 2020 2020 2020 2020 2020 2022 2d2d 2d2d             "----
+00003790: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000037a0: 2d2d 2d2d 5c6e 220a 2020 2020 2020 2020  ----\n".        
+000037b0: 2020 2020 6622 7b65 2172 7d5c 6e5c 6e22      f"{e!r}\n\n"
+000037c0: 0a20 2020 2020 2020 2020 2020 2022 5472  .            "Tr
+000037d0: 6163 6562 6163 6b3a 5c6e 220a 2020 2020  aceback:\n".    
+000037e0: 2020 2020 2020 2020 222d 2d2d 2d2d 2d2d          "-------
+000037f0: 2d2d 5c6e 220a 2020 2020 2020 2020 2020  --\n".          
+00003800: 2020 6622 7b74 627d 220a 2020 2020 2020    f"{tb}".      
+00003810: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
+00003820: 2020 2020 2020 6d73 6720 3d20 4e6f 6e65        msg = None
+00003830: 0a20 2020 2069 6620 6d73 6720 6973 206e  .    if msg is n
+00003840: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00003850: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00003860: 7228 6d73 6729 0a20 2020 2072 6574 7572  r(msg).    retur
+00003870: 6e20 6765 7461 7474 7228 6f2c 2022 6474  n getattr(o, "dt
+00003880: 7970 6522 2c20 7479 7065 286f 2929 2069  ype", type(o)) i
+00003890: 6620 6e6f 7574 2069 7320 4e6f 6e65 2065  f nout is None e
+000038a0: 6c73 6520 7475 706c 6528 652e 6474 7970  lse tuple(e.dtyp
+000038b0: 6520 666f 7220 6520 696e 206f 290a 0a0a  e for e in o)...
+000038c0: 6465 6620 6e6f 726d 616c 697a 655f 6172  def normalize_ar
+000038d0: 6728 7829 3a0a 2020 2020 2222 224e 6f72  g(x):.    """Nor
+000038e0: 6d61 6c69 7a65 2075 7365 7220 7072 6f76  malize user prov
+000038f0: 6964 6564 2061 7267 756d 656e 7473 2074  ided arguments t
+00003900: 6f20 626c 6f63 6b77 6973 6520 6f72 206d  o blockwise or m
+00003910: 6170 5f62 6c6f 636b 730a 0a20 2020 2057  ap_blocks..    W
+00003920: 6520 646f 2061 2066 6577 2074 6869 6e67  e do a few thing
+00003930: 733a 0a0a 2020 2020 312e 2020 4966 2074  s:..    1.  If t
+00003940: 6865 7920 6172 6520 7374 7269 6e67 206c  hey are string l
+00003950: 6974 6572 616c 7320 7468 6174 206d 6967  iterals that mig
+00003960: 6874 2063 6f6c 6c69 6465 2077 6974 6820  ht collide with 
+00003970: 626c 6f63 6b77 6973 655f 746f 6b65 6e20  blockwise_token 
+00003980: 7468 656e 2077 650a 2020 2020 2020 2020  then we.        
+00003990: 7175 6f74 6520 7468 656d 0a20 2020 2032  quote them.    2
+000039a0: 2e20 2049 4620 7468 6579 2061 7265 206c  .  IF they are l
+000039b0: 6172 6765 2028 6173 2064 6566 696e 6564  arge (as defined
+000039c0: 2062 7920 7369 7a65 6f66 2920 7468 656e   by sizeof) then
+000039d0: 2077 6520 7075 7420 7468 656d 2069 6e74   we put them int
+000039e0: 6f20 7468 650a 2020 2020 2020 2020 6772  o the.        gr
+000039f0: 6170 6820 6f6e 2074 6865 6972 206f 776e  aph on their own
+00003a00: 2062 7920 7573 696e 6720 6461 736b 2e64   by using dask.d
+00003a10: 656c 6179 6564 0a20 2020 2022 2222 0a20  elayed.    """. 
+00003a20: 2020 2069 6620 6973 5f64 6173 6b5f 636f     if is_dask_co
+00003a30: 6c6c 6563 7469 6f6e 2878 293a 0a20 2020  llection(x):.   
+00003a40: 2020 2020 2072 6574 7572 6e20 780a 2020       return x.  
+00003a50: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00003a60: 6528 782c 2073 7472 2920 616e 6420 7265  e(x, str) and re
+00003a70: 2e6d 6174 6368 2872 225f 5c64 2b22 2c20  .match(r"_\d+", 
+00003a80: 7829 3a0a 2020 2020 2020 2020 7265 7475  x):.        retu
+00003a90: 726e 2064 656c 6179 6564 2878 290a 2020  rn delayed(x).  
+00003aa0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00003ab0: 6528 782c 206c 6973 7429 2061 6e64 206c  e(x, list) and l
+00003ac0: 656e 2878 2920 3e3d 2031 303a 0a20 2020  en(x) >= 10:.   
+00003ad0: 2020 2020 2072 6574 7572 6e20 6465 6c61       return dela
+00003ae0: 7965 6428 7829 0a20 2020 2065 6c69 6620  yed(x).    elif 
+00003af0: 7369 7a65 6f66 2878 2920 3e20 3165 363a  sizeof(x) > 1e6:
+00003b00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003b10: 6465 6c61 7965 6428 7829 0a20 2020 2065  delayed(x).    e
+00003b20: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
+00003b30: 7572 6e20 780a 0a0a 6465 6620 5f70 6173  urn x...def _pas
+00003b40: 735f 6578 7472 615f 6b77 6172 6773 2866  s_extra_kwargs(f
+00003b50: 756e 632c 206b 6579 732c 202a 6172 6773  unc, keys, *args
+00003b60: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00003b70: 2022 2222 4865 6c70 6572 2066 6f72 203a   """Helper for :
+00003b80: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00003b90: 2e6d 6170 5f62 6c6f 636b 7360 2074 6f20  .map_blocks` to 
+00003ba0: 7061 7373 2060 626c 6f63 6b5f 696e 666f  pass `block_info
+00003bb0: 6020 6f72 2060 626c 6f63 6b5f 6964 602e  ` or `block_id`.
+00003bc0: 0a0a 2020 2020 466f 7220 6561 6368 2065  ..    For each e
+00003bd0: 6c65 6d65 6e74 206f 6620 606b 6579 7360  lement of `keys`
+00003be0: 2c20 6120 636f 7272 6573 706f 6e64 696e  , a correspondin
+00003bf0: 6720 656c 656d 656e 7420 6f66 2061 7267  g element of arg
+00003c00: 7320 6973 2063 6861 6e67 6564 0a20 2020  s is changed.   
+00003c10: 2074 6f20 6120 6b65 7977 6f72 6420 6172   to a keyword ar
+00003c20: 6775 6d65 6e74 2077 6974 6820 7468 6174  gument with that
+00003c30: 206b 6579 2c20 6265 666f 7265 2061 6c6c   key, before all
+00003c40: 2061 7267 756d 656e 7473 2072 6520 7061   arguments re pa
+00003c50: 7373 6564 206f 6e0a 2020 2020 746f 2060  ssed on.    to `
+00003c60: 6675 6e63 602e 0a20 2020 2022 2222 0a20  func`..    """. 
+00003c70: 2020 206b 7761 7267 732e 7570 6461 7465     kwargs.update
+00003c80: 287a 6970 286b 6579 732c 2061 7267 7329  (zip(keys, args)
+00003c90: 290a 2020 2020 7265 7475 726e 2066 756e  ).    return fun
+00003ca0: 6328 2a61 7267 735b 6c65 6e28 6b65 7973  c(*args[len(keys
+00003cb0: 2920 3a5d 2c20 2a2a 6b77 6172 6773 290a  ) :], **kwargs).
+00003cc0: 0a0a 6465 6620 6d61 705f 626c 6f63 6b73  ..def map_blocks
+00003cd0: 280a 2020 2020 6675 6e63 2c0a 2020 2020  (.    func,.    
+00003ce0: 2a61 7267 732c 0a20 2020 206e 616d 653d  *args,.    name=
+00003cf0: 4e6f 6e65 2c0a 2020 2020 746f 6b65 6e3d  None,.    token=
+00003d00: 4e6f 6e65 2c0a 2020 2020 6474 7970 653d  None,.    dtype=
+00003d10: 4e6f 6e65 2c0a 2020 2020 6368 756e 6b73  None,.    chunks
+00003d20: 3d4e 6f6e 652c 0a20 2020 2064 726f 705f  =None,.    drop_
+00003d30: 6178 6973 3d4e 6f6e 652c 0a20 2020 206e  axis=None,.    n
+00003d40: 6577 5f61 7869 733d 4e6f 6e65 2c0a 2020  ew_axis=None,.  
+00003d50: 2020 656e 666f 7263 655f 6e64 696d 3d46    enforce_ndim=F
+00003d60: 616c 7365 2c0a 2020 2020 6d65 7461 3d4e  alse,.    meta=N
+00003d70: 6f6e 652c 0a20 2020 202a 2a6b 7761 7267  one,.    **kwarg
+00003d80: 732c 0a29 3a0a 2020 2020 2222 224d 6170  s,.):.    """Map
+00003d90: 2061 2066 756e 6374 696f 6e20 6163 726f   a function acro
+00003da0: 7373 2061 6c6c 2062 6c6f 636b 7320 6f66  ss all blocks of
+00003db0: 2061 2064 6173 6b20 6172 7261 792e 0a0a   a dask array...
+00003dc0: 2020 2020 4e6f 7465 2074 6861 7420 6060      Note that ``
+00003dd0: 6d61 705f 626c 6f63 6b73 6060 2077 696c  map_blocks`` wil
+00003de0: 6c20 6174 7465 6d70 7420 746f 2061 7574  l attempt to aut
+00003df0: 6f6d 6174 6963 616c 6c79 2064 6574 6572  omatically deter
+00003e00: 6d69 6e65 2074 6865 206f 7574 7075 740a  mine the output.
+00003e10: 2020 2020 6172 7261 7920 7479 7065 2062      array type b
+00003e20: 7920 6361 6c6c 696e 6720 6060 6675 6e63  y calling ``func
+00003e30: 6060 206f 6e20 302d 6420 7665 7273 696f  `` on 0-d versio
+00003e40: 6e73 206f 6620 7468 6520 696e 7075 7473  ns of the inputs
+00003e50: 2e20 506c 6561 7365 2072 6566 6572 2074  . Please refer t
+00003e60: 6f0a 2020 2020 7468 6520 6060 6d65 7461  o.    the ``meta
+00003e70: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
+00003e80: 656e 7420 6265 6c6f 7720 6966 2079 6f75  ent below if you
+00003e90: 2065 7870 6563 7420 7468 6174 2074 6865   expect that the
+00003ea0: 2066 756e 6374 696f 6e20 7769 6c6c 206e   function will n
+00003eb0: 6f74 0a20 2020 2073 7563 6365 6564 2077  ot.    succeed w
+00003ec0: 6865 6e20 6f70 6572 6174 696e 6720 6f6e  hen operating on
+00003ed0: 2030 2d64 2061 7272 6179 732e 0a0a 2020   0-d arrays...  
+00003ee0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00003ef0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00003f00: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
+00003f10: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
+00003f20: 2074 6f20 6170 706c 7920 746f 2065 7665   to apply to eve
+00003f30: 7279 2062 6c6f 636b 2069 6e20 7468 6520  ry block in the 
+00003f40: 6172 7261 792e 0a20 2020 2020 2020 2049  array..        I
+00003f50: 6620 6060 6675 6e63 6060 2061 6363 6570  f ``func`` accep
+00003f60: 7473 2060 6062 6c6f 636b 5f69 6e66 6f3d  ts ``block_info=
+00003f70: 6060 206f 7220 6060 626c 6f63 6b5f 6964  `` or ``block_id
+00003f80: 3d60 600a 2020 2020 2020 2020 6173 206b  =``.        as k
+00003f90: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00003fa0: 2c20 7468 6573 6520 7769 6c6c 2062 6520  , these will be 
+00003fb0: 7061 7373 6564 2064 6963 7469 6f6e 6172  passed dictionar
+00003fc0: 6965 730a 2020 2020 2020 2020 636f 6e74  ies.        cont
+00003fd0: 6169 6e69 6e67 2069 6e66 6f72 6d61 7469  aining informati
+00003fe0: 6f6e 2061 626f 7574 2069 6e70 7574 2061  on about input a
+00003ff0: 6e64 206f 7574 7075 7420 6368 756e 6b73  nd output chunks
+00004000: 2f61 7272 6179 730a 2020 2020 2020 2020  /arrays.        
+00004010: 6475 7269 6e67 2063 6f6d 7075 7461 7469  during computati
+00004020: 6f6e 2e20 5365 6520 6578 616d 706c 6573  on. See examples
+00004030: 2066 6f72 2064 6574 6169 6c73 2e0a 2020   for details..  
+00004040: 2020 6172 6773 203a 2064 6173 6b20 6172    args : dask ar
+00004050: 7261 7973 206f 7220 6f74 6865 7220 6f62  rays or other ob
+00004060: 6a65 6374 730a 2020 2020 6474 7970 6520  jects.    dtype 
+00004070: 3a20 6e70 2e64 7479 7065 2c20 6f70 7469  : np.dtype, opti
+00004080: 6f6e 616c 0a20 2020 2020 2020 2054 6865  onal.        The
+00004090: 2060 6064 7479 7065 6060 206f 6620 7468   ``dtype`` of th
+000040a0: 6520 6f75 7470 7574 2061 7272 6179 2e20  e output array. 
+000040b0: 4974 2069 7320 7265 636f 6d6d 656e 6465  It is recommende
+000040c0: 6420 746f 2070 726f 7669 6465 2074 6869  d to provide thi
+000040d0: 732e 0a20 2020 2020 2020 2049 6620 6e6f  s..        If no
+000040e0: 7420 7072 6f76 6964 6564 2c20 7769 6c6c  t provided, will
+000040f0: 2062 6520 696e 6665 7272 6564 2062 7920   be inferred by 
+00004100: 6170 706c 7969 6e67 2074 6865 2066 756e  applying the fun
+00004110: 6374 696f 6e20 746f 2061 2073 6d61 6c6c  ction to a small
+00004120: 0a20 2020 2020 2020 2073 6574 206f 6620  .        set of 
+00004130: 6661 6b65 2064 6174 612e 0a20 2020 2063  fake data..    c
+00004140: 6875 6e6b 7320 3a20 7475 706c 652c 206f  hunks : tuple, o
+00004150: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00004160: 4368 756e 6b20 7368 6170 6520 6f66 2072  Chunk shape of r
+00004170: 6573 756c 7469 6e67 2062 6c6f 636b 7320  esulting blocks 
+00004180: 6966 2074 6865 2066 756e 6374 696f 6e20  if the function 
+00004190: 646f 6573 206e 6f74 2070 7265 7365 7276  does not preserv
+000041a0: 650a 2020 2020 2020 2020 7368 6170 652e  e.        shape.
+000041b0: 2049 6620 6e6f 7420 7072 6f76 6964 6564   If not provided
+000041c0: 2c20 7468 6520 7265 7375 6c74 696e 6720  , the resulting 
+000041d0: 6172 7261 7920 6973 2061 7373 756d 6564  array is assumed
+000041e0: 2074 6f20 6861 7665 2074 6865 2073 616d   to have the sam
+000041f0: 650a 2020 2020 2020 2020 626c 6f63 6b20  e.        block 
+00004200: 7374 7275 6374 7572 6520 6173 2074 6865  structure as the
+00004210: 2066 6972 7374 2069 6e70 7574 2061 7272   first input arr
+00004220: 6179 2e0a 2020 2020 6472 6f70 5f61 7869  ay..    drop_axi
+00004230: 7320 3a20 6e75 6d62 6572 206f 7220 6974  s : number or it
+00004240: 6572 6162 6c65 2c20 6f70 7469 6f6e 616c  erable, optional
+00004250: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00004260: 6f6e 7320 6c6f 7374 2062 7920 7468 6520  ons lost by the 
+00004270: 6675 6e63 7469 6f6e 2e0a 2020 2020 6e65  function..    ne
+00004280: 775f 6178 6973 203a 206e 756d 6265 7220  w_axis : number 
 00004290: 6f72 2069 7465 7261 626c 652c 206f 7074  or iterable, opt
-000042a0: 696f 6e61 6c0a 2020 2020 2020 2020 4469  ional.        Di
-000042b0: 6d65 6e73 696f 6e73 206c 6f73 7420 6279  mensions lost by
-000042c0: 2074 6865 2066 756e 6374 696f 6e2e 0a20   the function.. 
-000042d0: 2020 206e 6577 5f61 7869 7320 3a20 6e75     new_axis : nu
-000042e0: 6d62 6572 206f 7220 6974 6572 6162 6c65  mber or iterable
-000042f0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00004300: 2020 204e 6577 2064 696d 656e 7369 6f6e     New dimension
-00004310: 7320 6372 6561 7465 6420 6279 2074 6865  s created by the
-00004320: 2066 756e 6374 696f 6e2e 204e 6f74 6520   function. Note 
-00004330: 7468 6174 2074 6865 7365 2061 7265 2061  that these are a
-00004340: 7070 6c69 6564 0a20 2020 2020 2020 2061  pplied.        a
-00004350: 6674 6572 2060 6064 726f 705f 6178 6973  fter ``drop_axis
-00004360: 6060 2028 6966 2070 7265 7365 6e74 292e  `` (if present).
-00004370: 0a20 2020 2065 6e66 6f72 6365 5f6e 6469  .    enforce_ndi
-00004380: 6d20 3a20 626f 6f6c 2c20 6465 6661 756c  m : bool, defaul
-00004390: 7420 4661 6c73 650a 2020 2020 2020 2020  t False.        
-000043a0: 5768 6574 6865 7220 746f 2065 6e66 6f72  Whether to enfor
-000043b0: 6365 2061 7420 7275 6e74 696d 6520 7468  ce at runtime th
-000043c0: 6174 2074 6865 2064 696d 656e 7369 6f6e  at the dimension
-000043d0: 616c 6974 7920 6f66 2074 6865 2061 7272  ality of the arr
-000043e0: 6179 0a20 2020 2020 2020 2070 726f 6475  ay.        produ
-000043f0: 6365 6420 6279 2060 6066 756e 6360 6020  ced by ``func`` 
-00004400: 6163 7475 616c 6c79 206d 6174 6368 6573  actually matches
-00004410: 2074 6861 7420 6f66 2074 6865 2061 7272   that of the arr
-00004420: 6179 2072 6574 7572 6e65 6420 6279 0a20  ay returned by. 
-00004430: 2020 2020 2020 2060 606d 6170 5f62 6c6f         ``map_blo
-00004440: 636b 7360 602e 0a20 2020 2020 2020 2049  cks``..        I
-00004450: 6620 5472 7565 2c20 7468 6973 2077 696c  f True, this wil
-00004460: 6c20 7261 6973 6520 616e 2065 7272 6f72  l raise an error
-00004470: 2077 6865 6e20 7468 6572 6520 6973 2061   when there is a
-00004480: 206d 6973 6d61 7463 682e 0a20 2020 2074   mismatch..    t
-00004490: 6f6b 656e 203a 2073 7472 696e 672c 206f  oken : string, o
-000044a0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-000044b0: 5468 6520 6b65 7920 7072 6566 6978 2074  The key prefix t
-000044c0: 6f20 7573 6520 666f 7220 7468 6520 6f75  o use for the ou
-000044d0: 7470 7574 2061 7272 6179 2e20 4966 206e  tput array. If n
-000044e0: 6f74 2070 726f 7669 6465 642c 2077 696c  ot provided, wil
-000044f0: 6c20 6265 0a20 2020 2020 2020 2064 6574  l be.        det
-00004500: 6572 6d69 6e65 6420 6672 6f6d 2074 6865  ermined from the
-00004510: 2066 756e 6374 696f 6e20 6e61 6d65 2e0a   function name..
-00004520: 2020 2020 6e61 6d65 203a 2073 7472 696e      name : strin
-00004530: 672c 206f 7074 696f 6e61 6c0a 2020 2020  g, optional.    
-00004540: 2020 2020 5468 6520 6b65 7920 6e61 6d65      The key name
-00004550: 2074 6f20 7573 6520 666f 7220 7468 6520   to use for the 
-00004560: 6f75 7470 7574 2061 7272 6179 2e20 4e6f  output array. No
-00004570: 7465 2074 6861 7420 7468 6973 2066 756c  te that this ful
-00004580: 6c79 0a20 2020 2020 2020 2073 7065 6369  ly.        speci
-00004590: 6669 6573 2074 6865 206f 7574 7075 7420  fies the output 
-000045a0: 6b65 7920 6e61 6d65 2c20 616e 6420 6d75  key name, and mu
-000045b0: 7374 2062 6520 756e 6971 7565 2e20 4966  st be unique. If
-000045c0: 206e 6f74 2070 726f 7669 6465 642c 0a20   not provided,. 
-000045d0: 2020 2020 2020 2077 696c 6c20 6265 2064         will be d
-000045e0: 6574 6572 6d69 6e65 6420 6279 2061 2068  etermined by a h
-000045f0: 6173 6820 6f66 2074 6865 2061 7267 756d  ash of the argum
-00004600: 656e 7473 2e0a 2020 2020 6d65 7461 203a  ents..    meta :
-00004610: 2061 7272 6179 2d6c 696b 652c 206f 7074   array-like, opt
-00004620: 696f 6e61 6c0a 2020 2020 2020 2020 5468  ional.        Th
-00004630: 6520 6060 6d65 7461 6060 206f 6620 7468  e ``meta`` of th
-00004640: 6520 6f75 7470 7574 2061 7272 6179 2c20  e output array, 
-00004650: 7768 656e 2073 7065 6369 6669 6564 2069  when specified i
-00004660: 7320 6578 7065 6374 6564 2074 6f20 6265  s expected to be
-00004670: 2061 6e0a 2020 2020 2020 2020 6172 7261   an.        arra
-00004680: 7920 6f66 2074 6865 2073 616d 6520 7479  y of the same ty
-00004690: 7065 2061 6e64 2064 7479 7065 206f 6620  pe and dtype of 
-000046a0: 7468 6174 2072 6574 7572 6e65 6420 7768  that returned wh
-000046b0: 656e 2063 616c 6c69 6e67 2060 602e 636f  en calling ``.co
-000046c0: 6d70 7574 6528 2960 600a 2020 2020 2020  mpute()``.      
-000046d0: 2020 6f6e 2074 6865 2061 7272 6179 2072    on the array r
-000046e0: 6574 7572 6e65 6420 6279 2074 6869 7320  eturned by this 
-000046f0: 6675 6e63 7469 6f6e 2e20 5768 656e 206e  function. When n
-00004700: 6f74 2070 726f 7669 6465 642c 2060 606d  ot provided, ``m
-00004710: 6574 6160 6020 7769 6c6c 2062 650a 2020  eta`` will be.  
-00004720: 2020 2020 2020 696e 6665 7272 6564 2062        inferred b
-00004730: 7920 6170 706c 7969 6e67 2074 6865 2066  y applying the f
-00004740: 756e 6374 696f 6e20 746f 2061 2073 6d61  unction to a sma
-00004750: 6c6c 2073 6574 206f 6620 6661 6b65 2064  ll set of fake d
-00004760: 6174 612c 2075 7375 616c 6c79 2061 0a20  ata, usually a. 
-00004770: 2020 2020 2020 2030 2d64 2061 7272 6179         0-d array
-00004780: 2e20 4974 2773 2069 6d70 6f72 7461 6e74  . It's important
-00004790: 2074 6f20 656e 7375 7265 2074 6861 7420   to ensure that 
-000047a0: 6060 6675 6e63 6060 2063 616e 2073 7563  ``func`` can suc
-000047b0: 6365 7373 6675 6c6c 7920 636f 6d70 6c65  cessfully comple
-000047c0: 7465 0a20 2020 2020 2020 2063 6f6d 7075  te.        compu
-000047d0: 7461 7469 6f6e 2077 6974 686f 7574 2072  tation without r
-000047e0: 6169 7369 6e67 2065 7863 6570 7469 6f6e  aising exception
-000047f0: 7320 7768 656e 2030 2d64 2069 7320 7061  s when 0-d is pa
-00004800: 7373 6564 2074 6f20 6974 2c20 7072 6f76  ssed to it, prov
-00004810: 6964 696e 670a 2020 2020 2020 2020 6060  iding.        ``
-00004820: 6d65 7461 6060 2077 696c 6c20 6265 2072  meta`` will be r
-00004830: 6571 7569 7265 6420 6f74 6865 7277 6973  equired otherwis
-00004840: 652e 2049 6620 7468 6520 6f75 7470 7574  e. If the output
-00004850: 2074 7970 6520 6973 206b 6e6f 776e 2062   type is known b
-00004860: 6566 6f72 6568 616e 640a 2020 2020 2020  eforehand.      
-00004870: 2020 2865 2e67 2e2c 2060 606e 702e 6e64    (e.g., ``np.nd
-00004880: 6172 7261 7960 602c 2060 6063 7570 792e  array``, ``cupy.
-00004890: 6e64 6172 7261 7960 6029 2c20 616e 2065  ndarray``), an e
-000048a0: 6d70 7479 2061 7272 6179 206f 6620 7375  mpty array of su
-000048b0: 6368 2074 7970 6520 6474 7970 650a 2020  ch type dtype.  
-000048c0: 2020 2020 2020 6361 6e20 6265 2070 6173        can be pas
-000048d0: 7365 642c 2066 6f72 2065 7861 6d70 6c65  sed, for example
-000048e0: 3a20 6060 6d65 7461 3d6e 702e 6172 7261  : ``meta=np.arra
-000048f0: 7928 2829 2c20 6474 7970 653d 6e70 2e69  y((), dtype=np.i
-00004900: 6e74 3332 2960 602e 0a20 2020 202a 2a6b  nt32)``..    **k
-00004910: 7761 7267 7320 3a0a 2020 2020 2020 2020  wargs :.        
-00004920: 4f74 6865 7220 6b65 7977 6f72 6420 6172  Other keyword ar
-00004930: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
-00004940: 746f 2066 756e 6374 696f 6e2e 2056 616c  to function. Val
-00004950: 7565 7320 6d75 7374 2062 6520 636f 6e73  ues must be cons
-00004960: 7461 6e74 730a 2020 2020 2020 2020 286e  tants.        (n
-00004970: 6f74 2064 6173 6b2e 6172 7261 7973 290a  ot dask.arrays).
-00004980: 0a20 2020 2053 6565 2041 6c73 6f0a 2020  .    See Also.  
-00004990: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064    --------.    d
-000049a0: 6173 6b2e 6172 7261 792e 6d61 705f 6f76  ask.array.map_ov
-000049b0: 6572 6c61 7020 3a20 4765 6e65 7261 6c69  erlap : Generali
-000049c0: 7a65 6420 6f70 6572 6174 696f 6e20 7769  zed operation wi
-000049d0: 7468 206f 7665 726c 6170 2062 6574 7765  th overlap betwe
-000049e0: 656e 206e 6569 6768 626f 7273 2e0a 2020  en neighbors..  
-000049f0: 2020 6461 736b 2e61 7272 6179 2e62 6c6f    dask.array.blo
-00004a00: 636b 7769 7365 203a 2047 656e 6572 616c  ckwise : General
-00004a10: 697a 6564 206f 7065 7261 7469 6f6e 2077  ized operation w
-00004a20: 6974 6820 636f 6e74 726f 6c20 6f76 6572  ith control over
-00004a30: 2062 6c6f 636b 2061 6c69 676e 6d65 6e74   block alignment
-00004a40: 2e0a 0a20 2020 2045 7861 6d70 6c65 730a  ...    Examples.
-00004a50: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00004a60: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
-00004a70: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
-00004a80: 203e 3e3e 2078 203d 2064 612e 6172 616e   >>> x = da.aran
-00004a90: 6765 2836 2c20 6368 756e 6b73 3d33 290a  ge(6, chunks=3).
-00004aa0: 0a20 2020 203e 3e3e 2078 2e6d 6170 5f62  .    >>> x.map_b
-00004ab0: 6c6f 636b 7328 6c61 6d62 6461 2078 3a20  locks(lambda x: 
-00004ac0: 7820 2a20 3229 2e63 6f6d 7075 7465 2829  x * 2).compute()
-00004ad0: 0a20 2020 2061 7272 6179 285b 2030 2c20  .    array([ 0, 
-00004ae0: 2032 2c20 2034 2c20 2036 2c20 2038 2c20   2,  4,  6,  8, 
-00004af0: 3130 5d29 0a0a 2020 2020 5468 6520 6060  10])..    The ``
-00004b00: 6461 2e6d 6170 5f62 6c6f 636b 7360 6020  da.map_blocks`` 
-00004b10: 6675 6e63 7469 6f6e 2063 616e 2061 6c73  function can als
-00004b20: 6f20 6163 6365 7074 206d 756c 7469 706c  o accept multipl
-00004b30: 6520 6172 7261 7973 2e0a 0a20 2020 203e  e arrays...    >
-00004b40: 3e3e 2064 203d 2064 612e 6172 616e 6765  >> d = da.arange
-00004b50: 2835 2c20 6368 756e 6b73 3d32 290a 2020  (5, chunks=2).  
-00004b60: 2020 3e3e 3e20 6520 3d20 6461 2e61 7261    >>> e = da.ara
-00004b70: 6e67 6528 352c 2063 6875 6e6b 733d 3229  nge(5, chunks=2)
-00004b80: 0a0a 2020 2020 3e3e 3e20 6620 3d20 6461  ..    >>> f = da
-00004b90: 2e6d 6170 5f62 6c6f 636b 7328 6c61 6d62  .map_blocks(lamb
-00004ba0: 6461 2061 2c20 623a 2061 202b 2062 2a2a  da a, b: a + b**
-00004bb0: 322c 2064 2c20 6529 0a20 2020 203e 3e3e  2, d, e).    >>>
-00004bc0: 2066 2e63 6f6d 7075 7465 2829 0a20 2020   f.compute().   
-00004bd0: 2061 7272 6179 285b 2030 2c20 2032 2c20   array([ 0,  2, 
-00004be0: 2036 2c20 3132 2c20 3230 5d29 0a0a 2020   6, 12, 20])..  
-00004bf0: 2020 4966 2074 6865 2066 756e 6374 696f    If the functio
-00004c00: 6e20 6368 616e 6765 7320 7368 6170 6520  n changes shape 
-00004c10: 6f66 2074 6865 2062 6c6f 636b 7320 7468  of the blocks th
-00004c20: 656e 2079 6f75 206d 7573 7420 7072 6f76  en you must prov
-00004c30: 6964 6520 6368 756e 6b73 0a20 2020 2065  ide chunks.    e
-00004c40: 7870 6c69 6369 746c 792e 0a0a 2020 2020  xplicitly...    
-00004c50: 3e3e 3e20 7920 3d20 782e 6d61 705f 626c  >>> y = x.map_bl
-00004c60: 6f63 6b73 286c 616d 6264 6120 783a 2078  ocks(lambda x: x
-00004c70: 5b3a 3a32 5d2c 2063 6875 6e6b 733d 2828  [::2], chunks=((
-00004c80: 322c 2032 292c 2929 0a0a 2020 2020 596f  2, 2),))..    Yo
-00004c90: 7520 6861 7665 2061 2062 6974 206f 6620  u have a bit of 
-00004ca0: 6672 6565 646f 6d20 696e 2073 7065 6369  freedom in speci
-00004cb0: 6679 696e 6720 6368 756e 6b73 2e20 2049  fying chunks.  I
-00004cc0: 6620 616c 6c20 6f66 2074 6865 206f 7574  f all of the out
-00004cd0: 7075 7420 6368 756e 6b0a 2020 2020 7369  put chunk.    si
-00004ce0: 7a65 7320 6172 6520 7468 6520 7361 6d65  zes are the same
-00004cf0: 2c20 796f 7520 6361 6e20 7072 6f76 6964  , you can provid
-00004d00: 6520 6a75 7374 2074 6861 7420 6368 756e  e just that chun
-00004d10: 6b20 7369 7a65 2061 7320 6120 7369 6e67  k size as a sing
-00004d20: 6c65 2074 7570 6c65 2e0a 0a20 2020 203e  le tuple...    >
-00004d30: 3e3e 2061 203d 2064 612e 6172 616e 6765  >> a = da.arange
-00004d40: 2831 382c 2063 6875 6e6b 733d 2836 2c29  (18, chunks=(6,)
-00004d50: 290a 2020 2020 3e3e 3e20 6220 3d20 612e  ).    >>> b = a.
-00004d60: 6d61 705f 626c 6f63 6b73 286c 616d 6264  map_blocks(lambd
-00004d70: 6120 783a 2078 5b3a 335d 2c20 6368 756e  a x: x[:3], chun
-00004d80: 6b73 3d28 332c 2929 0a0a 2020 2020 4966  ks=(3,))..    If
-00004d90: 2074 6865 2066 756e 6374 696f 6e20 6368   the function ch
-00004da0: 616e 6765 7320 7468 6520 6469 6d65 6e73  anges the dimens
-00004db0: 696f 6e20 6f66 2074 6865 2062 6c6f 636b  ion of the block
-00004dc0: 7320 796f 7520 6d75 7374 2073 7065 6369  s you must speci
-00004dd0: 6679 2074 6865 0a20 2020 2063 7265 6174  fy the.    creat
-00004de0: 6564 206f 7220 6465 7374 726f 7965 6420  ed or destroyed 
-00004df0: 6469 6d65 6e73 696f 6e73 2e0a 0a20 2020  dimensions...   
-00004e00: 203e 3e3e 2062 203d 2061 2e6d 6170 5f62   >>> b = a.map_b
-00004e10: 6c6f 636b 7328 6c61 6d62 6461 2078 3a20  locks(lambda x: 
-00004e20: 785b 4e6f 6e65 2c20 3a2c 204e 6f6e 655d  x[None, :, None]
-00004e30: 2c20 6368 756e 6b73 3d28 312c 2036 2c20  , chunks=(1, 6, 
-00004e40: 3129 2c0a 2020 2020 2e2e 2e20 2020 2020  1),.    ...     
-00004e50: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00004e60: 5f61 7869 733d 5b30 2c20 325d 290a 0a20  _axis=[0, 2]).. 
-00004e70: 2020 2049 6620 6060 6368 756e 6b73 6060     If ``chunks``
-00004e80: 2069 7320 7370 6563 6966 6965 6420 6275   is specified bu
-00004e90: 7420 6060 6e65 775f 6178 6973 6060 2069  t ``new_axis`` i
-00004ea0: 7320 6e6f 742c 2074 6865 6e20 6974 2069  s not, then it i
-00004eb0: 7320 696e 6665 7272 6564 2074 6f0a 2020  s inferred to.  
-00004ec0: 2020 6164 6420 7468 6520 6e65 6365 7373    add the necess
-00004ed0: 6172 7920 6e75 6d62 6572 206f 6620 6178  ary number of ax
-00004ee0: 6573 206f 6e20 7468 6520 6c65 6674 2e0a  es on the left..
-00004ef0: 0a20 2020 204e 6f74 6520 7468 6174 2060  .    Note that `
-00004f00: 606d 6170 5f62 6c6f 636b 7328 2960 6020  `map_blocks()`` 
-00004f10: 7769 6c6c 2063 6f6e 6361 7465 6e61 7465  will concatenate
-00004f20: 2063 6875 6e6b 7320 616c 6f6e 6720 6178   chunks along ax
-00004f30: 6573 2073 7065 6369 6669 6564 2062 790a  es specified by.
-00004f40: 2020 2020 7468 6520 6b65 7977 6f72 6420      the keyword 
-00004f50: 7061 7261 6d65 7465 7220 6060 6472 6f70  parameter ``drop
-00004f60: 5f61 7869 7360 6020 7072 696f 7220 746f  _axis`` prior to
-00004f70: 2061 7070 6c79 696e 6720 7468 6520 6675   applying the fu
-00004f80: 6e63 7469 6f6e 2e0a 2020 2020 5468 6973  nction..    This
-00004f90: 2069 7320 696c 6c75 7374 7261 7465 6420   is illustrated 
-00004fa0: 696e 2074 6865 2066 6967 7572 6520 6265  in the figure be
-00004fb0: 6c6f 773a 0a0a 2020 2020 2e2e 2069 6d61  low:..    .. ima
-00004fc0: 6765 3a3a 202f 696d 6167 6573 2f6d 6170  ge:: /images/map
-00004fd0: 5f62 6c6f 636b 735f 6472 6f70 5f61 7869  _blocks_drop_axi
-00004fe0: 732e 706e 670a 0a20 2020 2044 7565 2074  s.png..    Due t
-00004ff0: 6f20 6d65 6d6f 7279 2d73 697a 652d 636f  o memory-size-co
-00005000: 6e73 7472 6169 6e74 732c 2069 7420 6973  nstraints, it is
-00005010: 206f 6674 656e 206e 6f74 2061 6476 6973   often not advis
-00005020: 6162 6c65 2074 6f20 7573 6520 6060 6472  able to use ``dr
-00005030: 6f70 5f61 7869 7360 600a 2020 2020 6f6e  op_axis``.    on
-00005040: 2061 6e20 6178 6973 2074 6861 7420 6973   an axis that is
-00005050: 2063 6875 6e6b 6564 2e20 2049 6e20 7468   chunked.  In th
-00005060: 6174 2063 6173 652c 2069 7420 6973 2062  at case, it is b
-00005070: 6574 7465 7220 6e6f 7420 746f 2075 7365  etter not to use
-00005080: 0a20 2020 2060 606d 6170 5f62 6c6f 636b  .    ``map_block
-00005090: 7360 6020 6275 7420 7261 7468 6572 0a20  s`` but rather. 
-000050a0: 2020 2060 6064 6173 6b2e 6172 7261 792e     ``dask.array.
-000050b0: 7265 6475 6374 696f 6e28 2e2e 2e2c 2061  reduction(..., a
-000050c0: 7869 733d 6472 6f70 7065 645f 6178 6573  xis=dropped_axes
-000050d0: 2c20 636f 6e63 6174 656e 6174 653d 4661  , concatenate=Fa
-000050e0: 6c73 6529 6060 2077 6869 6368 0a20 2020  lse)`` which.   
-000050f0: 206d 6169 6e74 6169 6e73 2061 206c 6561   maintains a lea
-00005100: 6e65 7220 6d65 6d6f 7279 2066 6f6f 7470  ner memory footp
-00005110: 7269 6e74 2077 6869 6c65 2069 7420 6472  rint while it dr
-00005120: 6f70 7320 616e 7920 6178 6973 2e0a 0a20  ops any axis... 
-00005130: 2020 204d 6170 5f62 6c6f 636b 7320 616c     Map_blocks al
-00005140: 6967 6e73 2062 6c6f 636b 7320 6279 2062  igns blocks by b
-00005150: 6c6f 636b 2070 6f73 6974 696f 6e73 2077  lock positions w
-00005160: 6974 686f 7574 2072 6567 6172 6420 746f  ithout regard to
-00005170: 2073 6861 7065 2e20 496e 2074 6865 0a20   shape. In the. 
-00005180: 2020 2066 6f6c 6c6f 7769 6e67 2065 7861     following exa
-00005190: 6d70 6c65 2077 6520 6861 7665 2074 776f  mple we have two
-000051a0: 2061 7272 6179 7320 7769 7468 2074 6865   arrays with the
-000051b0: 2073 616d 6520 6e75 6d62 6572 206f 6620   same number of 
-000051c0: 626c 6f63 6b73 2062 7574 0a20 2020 2077  blocks but.    w
-000051d0: 6974 6820 6469 6666 6572 656e 7420 7368  ith different sh
-000051e0: 6170 6520 616e 6420 6368 756e 6b20 7369  ape and chunk si
-000051f0: 7a65 732e 0a0a 2020 2020 3e3e 3e20 7820  zes...    >>> x 
-00005200: 3d20 6461 2e61 7261 6e67 6528 3130 3030  = da.arange(1000
-00005210: 2c20 6368 756e 6b73 3d28 3130 302c 2929  , chunks=(100,))
-00005220: 0a20 2020 203e 3e3e 2079 203d 2064 612e  .    >>> y = da.
-00005230: 6172 616e 6765 2831 3030 2c20 6368 756e  arange(100, chun
-00005240: 6b73 3d28 3130 2c29 290a 0a20 2020 2054  ks=(10,))..    T
-00005250: 6865 2072 656c 6576 616e 7420 6174 7472  he relevant attr
-00005260: 6962 7574 6520 746f 206d 6174 6368 2069  ibute to match i
-00005270: 7320 6e75 6d62 6c6f 636b 732e 0a0a 2020  s numblocks...  
-00005280: 2020 3e3e 3e20 782e 6e75 6d62 6c6f 636b    >>> x.numblock
-00005290: 730a 2020 2020 2831 302c 290a 2020 2020  s.    (10,).    
-000052a0: 3e3e 3e20 792e 6e75 6d62 6c6f 636b 730a  >>> y.numblocks.
-000052b0: 2020 2020 2831 302c 290a 0a20 2020 2049      (10,)..    I
-000052c0: 6620 7468 6573 6520 6d61 7463 6820 2875  f these match (u
-000052d0: 7020 746f 2062 726f 6164 6361 7374 696e  p to broadcastin
-000052e0: 6720 7275 6c65 7329 2074 6865 6e20 7765  g rules) then we
-000052f0: 2063 616e 206d 6170 2061 7262 6974 7261   can map arbitra
-00005300: 7279 0a20 2020 2066 756e 6374 696f 6e73  ry.    functions
-00005310: 2061 6372 6f73 7320 626c 6f63 6b73 0a0a   across blocks..
-00005320: 2020 2020 3e3e 3e20 6465 6620 6675 6e63      >>> def func
-00005330: 2861 2c20 6229 3a0a 2020 2020 2e2e 2e20  (a, b):.    ... 
-00005340: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
-00005350: 7261 7928 5b61 2e6d 6178 2829 2c20 622e  ray([a.max(), b.
-00005360: 6d61 7828 295d 290a 0a20 2020 203e 3e3e  max()])..    >>>
-00005370: 2064 612e 6d61 705f 626c 6f63 6b73 2866   da.map_blocks(f
-00005380: 756e 632c 2078 2c20 792c 2063 6875 6e6b  unc, x, y, chunk
-00005390: 733d 2832 2c29 2c20 6474 7970 653d 2769  s=(2,), dtype='i
-000053a0: 3827 290a 2020 2020 6461 736b 2e61 7272  8').    dask.arr
-000053b0: 6179 3c66 756e 632c 2073 6861 7065 3d28  ay<func, shape=(
-000053c0: 3230 2c29 2c20 6474 7970 653d 696e 7436  20,), dtype=int6
-000053d0: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
-000053e0: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
-000053f0: 7079 2e6e 6461 7272 6179 3e0a 0a20 2020  py.ndarray>..   
-00005400: 203e 3e3e 205f 2e63 6f6d 7075 7465 2829   >>> _.compute()
-00005410: 0a20 2020 2061 7272 6179 285b 2039 392c  .    array([ 99,
-00005420: 2020 2039 2c20 3139 392c 2020 3139 2c20     9, 199,  19, 
-00005430: 3239 392c 2020 3239 2c20 3339 392c 2020  299,  29, 399,  
-00005440: 3339 2c20 3439 392c 2020 3439 2c20 3539  39, 499,  49, 59
-00005450: 392c 2020 3539 2c20 3639 392c 0a20 2020  9,  59, 699,.   
-00005460: 2020 2020 2020 2020 2036 392c 2037 3939           69, 799
-00005470: 2c20 2037 392c 2038 3939 2c20 2038 392c  ,  79, 899,  89,
-00005480: 2039 3939 2c20 2039 395d 290a 0a20 2020   999,  99])..   
-00005490: 2059 6f75 7220 626c 6f63 6b20 6675 6e63   Your block func
-000054a0: 7469 6f6e 2063 616e 2067 6574 2069 6e66  tion can get inf
-000054b0: 6f72 6d61 7469 6f6e 2061 626f 7574 2077  ormation about w
-000054c0: 6865 7265 2069 7420 6973 2069 6e20 7468  here it is in th
-000054d0: 6520 6172 7261 7920 6279 0a20 2020 2061  e array by.    a
-000054e0: 6363 6570 7469 6e67 2061 2073 7065 6369  ccepting a speci
-000054f0: 616c 2060 6062 6c6f 636b 5f69 6e66 6f60  al ``block_info`
-00005500: 6020 6f72 2060 6062 6c6f 636b 5f69 6460  ` or ``block_id`
-00005510: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
-00005520: 6e74 2e0a 2020 2020 4475 7269 6e67 2063  nt..    During c
-00005530: 6f6d 7075 7461 7469 6f6e 2c20 7468 6579  omputation, they
-00005540: 2077 696c 6c20 636f 6e74 6169 6e20 696e   will contain in
-00005550: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
-00005560: 6561 6368 206f 6620 7468 6520 696e 7075  each of the inpu
-00005570: 740a 2020 2020 616e 6420 6f75 7470 7574  t.    and output
-00005580: 2063 6875 6e6b 7320 2861 6e64 2064 6173   chunks (and das
-00005590: 6b20 6172 7261 7973 2920 7265 6c65 7661  k arrays) releva
-000055a0: 6e74 2074 6f20 6561 6368 2063 616c 6c20  nt to each call 
-000055b0: 6f66 2060 6066 756e 6360 602e 0a0a 2020  of ``func``...  
-000055c0: 2020 3e3e 3e20 6465 6620 6675 6e63 2862    >>> def func(b
-000055d0: 6c6f 636b 5f69 6e66 6f3d 4e6f 6e65 293a  lock_info=None):
-000055e0: 0a20 2020 202e 2e2e 2020 2020 2070 6173  .    ...     pas
-000055f0: 730a 0a20 2020 2054 6869 7320 7769 6c6c  s..    This will
-00005600: 2072 6563 6569 7665 2074 6865 2066 6f6c   receive the fol
-00005610: 6c6f 7769 6e67 2069 6e66 6f72 6d61 7469  lowing informati
-00005620: 6f6e 3a0a 0a20 2020 203e 3e3e 2062 6c6f  on:..    >>> blo
-00005630: 636b 5f69 6e66 6f20 2023 2064 6f63 7465  ck_info  # docte
-00005640: 7374 3a20 2b53 4b49 500a 2020 2020 7b30  st: +SKIP.    {0
-00005650: 3a20 7b27 7368 6170 6527 3a20 2831 3030  : {'shape': (100
-00005660: 302c 292c 0a20 2020 2020 2020 2020 276e  0,),.         'n
-00005670: 756d 2d63 6875 6e6b 7327 3a20 2831 302c  um-chunks': (10,
-00005680: 292c 0a20 2020 2020 2020 2020 2763 6875  ),.         'chu
-00005690: 6e6b 2d6c 6f63 6174 696f 6e27 3a20 2834  nk-location': (4
-000056a0: 2c29 2c0a 2020 2020 2020 2020 2027 6172  ,),.         'ar
-000056b0: 7261 792d 6c6f 6361 7469 6f6e 273a 205b  ray-location': [
-000056c0: 2834 3030 2c20 3530 3029 5d7d 2c0a 2020  (400, 500)]},.  
-000056d0: 2020 204e 6f6e 653a 207b 2773 6861 7065     None: {'shape
-000056e0: 273a 2028 3130 3030 2c29 2c0a 2020 2020  ': (1000,),.    
-000056f0: 2020 2020 2020 2020 276e 756d 2d63 6875          'num-chu
-00005700: 6e6b 7327 3a20 2831 302c 292c 0a20 2020  nks': (10,),.   
-00005710: 2020 2020 2020 2020 2027 6368 756e 6b2d           'chunk-
-00005720: 6c6f 6361 7469 6f6e 273a 2028 342c 292c  location': (4,),
-00005730: 0a20 2020 2020 2020 2020 2020 2027 6172  .            'ar
-00005740: 7261 792d 6c6f 6361 7469 6f6e 273a 205b  ray-location': [
-00005750: 2834 3030 2c20 3530 3029 5d2c 0a20 2020  (400, 500)],.   
-00005760: 2020 2020 2020 2020 2027 6368 756e 6b2d           'chunk-
-00005770: 7368 6170 6527 3a20 2831 3030 2c29 2c0a  shape': (100,),.
-00005780: 2020 2020 2020 2020 2020 2020 2764 7479              'dty
-00005790: 7065 273a 2064 7479 7065 2827 666c 6f61  pe': dtype('floa
-000057a0: 7436 3427 297d 7d0a 0a20 2020 2054 6865  t64')}}..    The
-000057b0: 206b 6579 7320 746f 2074 6865 2060 6062   keys to the ``b
-000057c0: 6c6f 636b 5f69 6e66 6f60 6020 6469 6374  lock_info`` dict
-000057d0: 696f 6e61 7279 2069 6e64 6963 6174 6520  ionary indicate 
-000057e0: 7768 6963 6820 6973 2074 6865 2069 6e70  which is the inp
-000057f0: 7574 2061 6e64 0a20 2020 206f 7574 7075  ut and.    outpu
-00005800: 7420 4461 736b 2061 7272 6179 3a0a 0a20  t Dask array:.. 
-00005810: 2020 202d 202a 2a49 6e70 7574 2044 6173     - **Input Das
-00005820: 6b20 6172 7261 7928 7329 3a2a 2a20 6060  k array(s):** ``
-00005830: 626c 6f63 6b5f 696e 666f 5b30 5d60 6020  block_info[0]`` 
-00005840: 7265 6665 7273 2074 6f20 7468 6520 6669  refers to the fi
-00005850: 7273 7420 696e 7075 7420 4461 736b 2061  rst input Dask a
-00005860: 7272 6179 2e0a 2020 2020 2020 5468 6520  rray..      The 
-00005870: 6469 6374 696f 6e61 7279 206b 6579 2069  dictionary key i
-00005880: 7320 6060 3060 6020 6265 6361 7573 6520  s ``0`` because 
-00005890: 7468 6174 2069 7320 7468 6520 6172 6775  that is the argu
-000058a0: 6d65 6e74 2069 6e64 6578 2063 6f72 7265  ment index corre
-000058b0: 7370 6f6e 6469 6e67 0a20 2020 2020 2074  sponding.      t
-000058c0: 6f20 7468 6520 6669 7273 7420 696e 7075  o the first inpu
-000058d0: 7420 4461 736b 2061 7272 6179 2e0a 2020  t Dask array..  
-000058e0: 2020 2020 496e 2063 6173 6573 2077 6865      In cases whe
-000058f0: 7265 206d 756c 7469 706c 6520 4461 736b  re multiple Dask
-00005900: 2061 7272 6179 7320 6861 7665 2062 6565   arrays have bee
-00005910: 6e20 7061 7373 6564 2061 7320 696e 7075  n passed as inpu
-00005920: 7420 746f 2074 6865 2066 756e 6374 696f  t to the functio
-00005930: 6e2c 0a20 2020 2020 2079 6f75 2063 616e  n,.      you can
-00005940: 2061 6363 6573 7320 7468 656d 2077 6974   access them wit
-00005950: 6820 7468 6520 6e75 6d62 6572 2063 6f72  h the number cor
-00005960: 7265 7370 6f6e 6469 6e67 2074 6f20 7468  responding to th
-00005970: 6520 696e 7075 7420 6172 6775 6d65 6e74  e input argument
-00005980: 2c0a 2020 2020 2020 6567 3a20 6060 626c  ,.      eg: ``bl
-00005990: 6f63 6b5f 696e 666f 5b31 5d60 602c 2060  ock_info[1]``, `
-000059a0: 6062 6c6f 636b 5f69 6e66 6f5b 325d 6060  `block_info[2]``
-000059b0: 2c20 6574 632e 0a20 2020 2020 2028 4e6f  , etc..      (No
-000059c0: 7465 2074 6861 7420 6966 2079 6f75 2070  te that if you p
-000059d0: 6173 7320 6d75 6c74 6970 6c65 2044 6173  ass multiple Das
-000059e0: 6b20 6172 7261 7973 2061 7320 696e 7075  k arrays as inpu
-000059f0: 7420 746f 206d 6170 5f62 6c6f 636b 732c  t to map_blocks,
-00005a00: 0a20 2020 2020 2074 6865 2061 7272 6179  .      the array
-00005a10: 7320 6d75 7374 206d 6174 6368 2065 6163  s must match eac
-00005a20: 6820 6f74 6865 7220 6279 2068 6176 696e  h other by havin
-00005a30: 6720 6d61 7463 6869 6e67 206e 756d 6265  g matching numbe
-00005a40: 7273 206f 6620 6368 756e 6b73 2c0a 2020  rs of chunks,.  
-00005a50: 2020 2020 616c 6f6e 6720 636f 7272 6573      along corres
-00005a60: 706f 6e64 696e 6720 6469 6d65 6e73 696f  ponding dimensio
-00005a70: 6e73 2075 7020 746f 2062 726f 6164 6361  ns up to broadca
-00005a80: 7374 696e 6720 7275 6c65 732e 290a 2020  sting rules.).  
-00005a90: 2020 2d20 2a2a 4f75 7470 7574 2044 6173    - **Output Das
-00005aa0: 6b20 6172 7261 793a 2a2a 2060 6062 6c6f  k array:** ``blo
-00005ab0: 636b 5f69 6e66 6f5b 4e6f 6e65 5d60 6020  ck_info[None]`` 
-00005ac0: 7265 6665 7273 2074 6f20 7468 6520 6f75  refers to the ou
-00005ad0: 7470 7574 2044 6173 6b20 6172 7261 792c  tput Dask array,
-00005ae0: 0a20 2020 2020 2061 6e64 2063 6f6e 7461  .      and conta
-00005af0: 696e 7320 696e 666f 726d 6174 696f 6e20  ins information 
-00005b00: 6162 6f75 7420 7468 6520 6f75 7470 7574  about the output
-00005b10: 2063 6875 6e6b 732e 0a20 2020 2020 2054   chunks..      T
-00005b20: 6865 206f 7574 7075 7420 6368 756e 6b20  he output chunk 
-00005b30: 7368 6170 6520 616e 6420 6474 7970 6520  shape and dtype 
-00005b40: 6d61 7920 6d61 7920 6265 2064 6966 6665  may may be diffe
-00005b50: 7265 6e74 2074 6861 6e20 7468 6520 696e  rent than the in
-00005b60: 7075 7420 6368 756e 6b73 2e0a 0a20 2020  put chunks...   
-00005b70: 2046 6f72 2065 6163 6820 6461 736b 2061   For each dask a
-00005b80: 7272 6179 2c20 6060 626c 6f63 6b5f 696e  rray, ``block_in
-00005b90: 666f 6060 2064 6573 6372 6962 6573 3a0a  fo`` describes:.
-00005ba0: 0a20 2020 202d 2060 6073 6861 7065 6060  .    - ``shape``
-00005bb0: 3a20 7468 6520 7368 6170 6520 6f66 2074  : the shape of t
-00005bc0: 6865 2066 756c 6c20 4461 736b 2061 7272  he full Dask arr
-00005bd0: 6179 2c0a 2020 2020 2d20 6060 6e75 6d2d  ay,.    - ``num-
-00005be0: 6368 756e 6b73 6060 3a20 7468 6520 6e75  chunks``: the nu
-00005bf0: 6d62 6572 206f 6620 6368 756e 6b73 206f  mber of chunks o
-00005c00: 6620 7468 6520 6675 6c6c 2061 7272 6179  f the full array
-00005c10: 2069 6e20 6561 6368 2064 696d 656e 7369   in each dimensi
-00005c20: 6f6e 2c0a 2020 2020 2d20 6060 6368 756e  on,.    - ``chun
-00005c30: 6b2d 6c6f 6361 7469 6f6e 6060 3a20 7468  k-location``: th
-00005c40: 6520 6368 756e 6b20 6c6f 6361 7469 6f6e  e chunk location
-00005c50: 2028 666f 7220 6578 616d 706c 6520 7468   (for example th
-00005c60: 6520 666f 7572 7468 2063 6875 6e6b 206f  e fourth chunk o
-00005c70: 7665 720a 2020 2020 2020 696e 2074 6865  ver.      in the
-00005c80: 2066 6972 7374 2064 696d 656e 7369 6f6e   first dimension
-00005c90: 292c 2061 6e64 0a20 2020 202d 2060 6061  ), and.    - ``a
-00005ca0: 7272 6179 2d6c 6f63 6174 696f 6e60 603a  rray-location``:
-00005cb0: 2074 6865 2061 7272 6179 206c 6f63 6174   the array locat
-00005cc0: 696f 6e20 7769 7468 696e 2074 6865 2066  ion within the f
-00005cd0: 756c 6c20 4461 736b 2061 7272 6179 0a20  ull Dask array. 
-00005ce0: 2020 2020 2028 666f 7220 6578 616d 706c       (for exampl
-00005cf0: 6520 7468 6520 736c 6963 6520 636f 7272  e the slice corr
-00005d00: 6573 706f 6e64 696e 6720 746f 2060 6034  esponding to ``4
-00005d10: 303a 3530 6060 292e 0a0a 2020 2020 496e  0:50``)...    In
-00005d20: 2061 6464 6974 696f 6e20 746f 2074 6865   addition to the
-00005d30: 7365 2c20 7468 6572 6520 6172 6520 7477  se, there are tw
-00005d40: 6f20 6578 7472 6120 7061 7261 6d65 7465  o extra paramete
-00005d50: 7273 2064 6573 6372 6962 6564 2062 790a  rs described by.
-00005d60: 2020 2020 6060 626c 6f63 6b5f 696e 666f      ``block_info
-00005d70: 6060 2066 6f72 2074 6865 206f 7574 7075  `` for the outpu
-00005d80: 7420 6172 7261 7920 2869 6e20 6060 626c  t array (in ``bl
-00005d90: 6f63 6b5f 696e 666f 5b4e 6f6e 655d 6060  ock_info[None]``
-00005da0: 293a 0a0a 2020 2020 2d20 6060 6368 756e  ):..    - ``chun
-00005db0: 6b2d 7368 6170 6560 603a 2074 6865 206f  k-shape``: the o
-00005dc0: 7574 7075 7420 6368 756e 6b20 7368 6170  utput chunk shap
-00005dd0: 652c 2061 6e64 0a20 2020 202d 2060 6064  e, and.    - ``d
-00005de0: 7479 7065 6060 3a20 7468 6520 6f75 7470  type``: the outp
-00005df0: 7574 2064 7479 7065 2e0a 0a20 2020 2054  ut dtype...    T
-00005e00: 6865 7365 2066 6561 7475 7265 7320 6361  hese features ca
-00005e10: 6e20 6265 2063 6f6d 6269 6e65 6420 746f  n be combined to
-00005e20: 2073 796e 7468 6573 697a 6520 616e 2061   synthesize an a
-00005e30: 7272 6179 2066 726f 6d20 7363 7261 7463  rray from scratc
-00005e40: 682c 2066 6f72 0a20 2020 2065 7861 6d70  h, for.    examp
-00005e50: 6c65 3a0a 0a20 2020 203e 3e3e 2064 6566  le:..    >>> def
-00005e60: 2066 756e 6328 626c 6f63 6b5f 696e 666f   func(block_info
-00005e70: 3d4e 6f6e 6529 3a0a 2020 2020 2e2e 2e20  =None):.    ... 
-00005e80: 2020 2020 6c6f 6320 3d20 626c 6f63 6b5f      loc = block_
-00005e90: 696e 666f 5b4e 6f6e 655d 5b27 6172 7261  info[None]['arra
-00005ea0: 792d 6c6f 6361 7469 6f6e 275d 5b30 5d0a  y-location'][0].
-00005eb0: 2020 2020 2e2e 2e20 2020 2020 7265 7475      ...     retu
-00005ec0: 726e 206e 702e 6172 616e 6765 286c 6f63  rn np.arange(loc
-00005ed0: 5b30 5d2c 206c 6f63 5b31 5d29 0a0a 2020  [0], loc[1])..  
-00005ee0: 2020 3e3e 3e20 6461 2e6d 6170 5f62 6c6f    >>> da.map_blo
-00005ef0: 636b 7328 6675 6e63 2c20 6368 756e 6b73  cks(func, chunks
-00005f00: 3d28 2834 2c20 3429 2c29 2c20 6474 7970  =((4, 4),), dtyp
-00005f10: 653d 6e70 2e66 6c6f 6174 5f29 0a20 2020  e=np.float_).   
-00005f20: 2064 6173 6b2e 6172 7261 793c 6675 6e63   dask.array<func
-00005f30: 2c20 7368 6170 653d 2838 2c29 2c20 6474  , shape=(8,), dt
-00005f40: 7970 653d 666c 6f61 7436 342c 2063 6875  ype=float64, chu
-00005f50: 6e6b 7369 7a65 3d28 342c 292c 2063 6875  nksize=(4,), chu
-00005f60: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-00005f70: 7272 6179 3e0a 0a20 2020 203e 3e3e 205f  rray>..    >>> _
-00005f80: 2e63 6f6d 7075 7465 2829 0a20 2020 2061  .compute().    a
-00005f90: 7272 6179 285b 302c 2031 2c20 322c 2033  rray([0, 1, 2, 3
-00005fa0: 2c20 342c 2035 2c20 362c 2037 5d29 0a0a  , 4, 5, 6, 7])..
-00005fb0: 2020 2020 6060 626c 6f63 6b5f 6964 6060      ``block_id``
-00005fc0: 2069 7320 7369 6d69 6c61 7220 746f 2060   is similar to `
-00005fd0: 6062 6c6f 636b 5f69 6e66 6f60 6020 6275  `block_info`` bu
-00005fe0: 7420 636f 6e74 6169 6e73 206f 6e6c 7920  t contains only 
-00005ff0: 7468 6520 6060 6368 756e 6b5f 6c6f 6361  the ``chunk_loca
-00006000: 7469 6f6e 6060 3a0a 0a20 2020 203e 3e3e  tion``:..    >>>
-00006010: 2064 6566 2066 756e 6328 626c 6f63 6b5f   def func(block_
-00006020: 6964 3d4e 6f6e 6529 3a0a 2020 2020 2e2e  id=None):.    ..
-00006030: 2e20 2020 2020 7061 7373 0a0a 2020 2020  .     pass..    
-00006040: 5468 6973 2077 696c 6c20 7265 6365 6976  This will receiv
-00006050: 6520 7468 6520 666f 6c6c 6f77 696e 6720  e the following 
-00006060: 696e 666f 726d 6174 696f 6e3a 0a0a 2020  information:..  
-00006070: 2020 3e3e 3e20 626c 6f63 6b5f 6964 2020    >>> block_id  
-00006080: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
-00006090: 0a20 2020 2028 342c 2033 290a 0a20 2020  .    (4, 3)..   
-000060a0: 2059 6f75 206d 6179 2073 7065 6369 6679   You may specify
-000060b0: 2074 6865 206b 6579 206e 616d 6520 7072   the key name pr
-000060c0: 6566 6978 206f 6620 7468 6520 7265 7375  efix of the resu
-000060d0: 6c74 696e 6720 7461 736b 2069 6e20 7468  lting task in th
-000060e0: 6520 6772 6170 6820 7769 7468 0a20 2020  e graph with.   
-000060f0: 2074 6865 206f 7074 696f 6e61 6c20 6060   the optional ``
-00006100: 746f 6b65 6e60 6020 6b65 7977 6f72 6420  token`` keyword 
-00006110: 6172 6775 6d65 6e74 2e0a 0a20 2020 203e  argument...    >
-00006120: 3e3e 2078 2e6d 6170 5f62 6c6f 636b 7328  >> x.map_blocks(
-00006130: 6c61 6d62 6461 2078 3a20 7820 2b20 312c  lambda x: x + 1,
-00006140: 206e 616d 653d 2769 6e63 7265 6d65 6e74   name='increment
-00006150: 2729 0a20 2020 2064 6173 6b2e 6172 7261  ').    dask.arra
-00006160: 793c 696e 6372 656d 656e 742c 2073 6861  y<increment, sha
-00006170: 7065 3d28 3130 3030 2c29 2c20 6474 7970  pe=(1000,), dtyp
-00006180: 653d 696e 7436 342c 2063 6875 6e6b 7369  e=int64, chunksi
-00006190: 7a65 3d28 3130 302c 292c 2063 6875 6e6b  ze=(100,), chunk
-000061a0: 7479 7065 3d6e 756d 7079 2e6e 6461 7272  type=numpy.ndarr
-000061b0: 6179 3e0a 0a20 2020 2046 6f72 2066 756e  ay>..    For fun
-000061c0: 6374 696f 6e73 2074 6861 7420 6d61 7920  ctions that may 
-000061d0: 6e6f 7420 6861 6e64 6c65 2030 2d64 2061  not handle 0-d a
-000061e0: 7272 6179 732c 2069 7427 7320 616c 736f  rrays, it's also
-000061f0: 2070 6f73 7369 626c 6520 746f 2073 7065   possible to spe
-00006200: 6369 6679 0a20 2020 2060 606d 6574 6160  cify.    ``meta`
-00006210: 6020 7769 7468 2061 6e20 656d 7074 7920  ` with an empty 
-00006220: 6172 7261 7920 6d61 7463 6869 6e67 2074  array matching t
-00006230: 6865 2074 7970 6520 6f66 2074 6865 2065  he type of the e
-00006240: 7870 6563 7465 6420 7265 7375 6c74 2e20  xpected result. 
-00006250: 496e 0a20 2020 2074 6865 2065 7861 6d70  In.    the examp
-00006260: 6c65 2062 656c 6f77 2c20 6060 6675 6e63  le below, ``func
-00006270: 6060 2077 696c 6c20 7265 7375 6c74 2069  `` will result i
-00006280: 6e20 616e 2060 6049 6e64 6578 4572 726f  n an ``IndexErro
-00006290: 7260 6020 7768 656e 2063 6f6d 7075 7469  r`` when computi
-000062a0: 6e67 0a20 2020 2060 606d 6574 6160 603a  ng.    ``meta``:
-000062b0: 0a0a 2020 2020 3e3e 3e20 726e 6720 3d20  ..    >>> rng = 
-000062c0: 6461 2e72 616e 646f 6d2e 6465 6661 756c  da.random.defaul
-000062d0: 745f 726e 6728 290a 2020 2020 3e3e 3e20  t_rng().    >>> 
-000062e0: 6461 2e6d 6170 5f62 6c6f 636b 7328 6c61  da.map_blocks(la
-000062f0: 6d62 6461 2078 3a20 785b 325d 2c20 726e  mbda x: x[2], rn
-00006300: 672e 7261 6e64 6f6d 2835 292c 206d 6574  g.random(5), met
-00006310: 613d 6e70 2e61 7272 6179 2828 2929 290a  a=np.array(())).
-00006320: 2020 2020 6461 736b 2e61 7272 6179 3c6c      dask.array<l
-00006330: 616d 6264 612c 2073 6861 7065 3d28 352c  ambda, shape=(5,
-00006340: 292c 2064 7479 7065 3d66 6c6f 6174 3634  ), dtype=float64
-00006350: 2c20 6368 756e 6b73 697a 653d 2835 2c29  , chunksize=(5,)
-00006360: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
-00006370: 792e 6e64 6172 7261 793e 0a0a 2020 2020  y.ndarray>..    
-00006380: 5369 6d69 6c61 726c 792c 2069 7427 7320  Similarly, it's 
-00006390: 706f 7373 6962 6c65 2074 6f20 7370 6563  possible to spec
-000063a0: 6966 7920 6120 6e6f 6e2d 4e75 6d50 7920  ify a non-NumPy 
-000063b0: 6172 7261 7920 746f 2060 606d 6574 6160  array to ``meta`
-000063c0: 602c 2061 6e64 2070 726f 7669 6465 0a20  `, and provide. 
-000063d0: 2020 2061 2060 6064 7479 7065 6060 3a0a     a ``dtype``:.
-000063e0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-000063f0: 6375 7079 2020 2320 646f 6374 6573 743a  cupy  # doctest:
-00006400: 202b 534b 4950 0a20 2020 203e 3e3e 2072   +SKIP.    >>> r
-00006410: 6e67 203d 2064 612e 7261 6e64 6f6d 2e64  ng = da.random.d
-00006420: 6566 6175 6c74 5f72 6e67 2863 7570 792e  efault_rng(cupy.
-00006430: 7261 6e64 6f6d 2e64 6566 6175 6c74 5f72  random.default_r
-00006440: 6e67 2829 2920 2023 2064 6f63 7465 7374  ng())  # doctest
-00006450: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
-00006460: 6474 203d 206e 702e 666c 6f61 7433 320a  dt = np.float32.
-00006470: 2020 2020 3e3e 3e20 6461 2e6d 6170 5f62      >>> da.map_b
-00006480: 6c6f 636b 7328 6c61 6d62 6461 2078 3a20  locks(lambda x: 
-00006490: 785b 325d 2c20 726e 672e 7261 6e64 6f6d  x[2], rng.random
-000064a0: 2835 2c20 6474 7970 653d 6474 292c 206d  (5, dtype=dt), m
-000064b0: 6574 613d 6375 7079 2e61 7272 6179 2828  eta=cupy.array((
-000064c0: 292c 2064 7479 7065 3d64 7429 2920 2023  ), dtype=dt))  #
-000064d0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-000064e0: 2020 2020 6461 736b 2e61 7272 6179 3c6c      dask.array<l
-000064f0: 616d 6264 612c 2073 6861 7065 3d28 352c  ambda, shape=(5,
-00006500: 292c 2064 7479 7065 3d66 6c6f 6174 3332  ), dtype=float32
-00006510: 2c20 6368 756e 6b73 697a 653d 2835 2c29  , chunksize=(5,)
-00006520: 2c20 6368 756e 6b74 7970 653d 6375 7079  , chunktype=cupy
-00006530: 2e6e 6461 7272 6179 3e0a 2020 2020 2222  .ndarray>.    ""
-00006540: 220a 2020 2020 6966 2064 726f 705f 6178  ".    if drop_ax
-00006550: 6973 2069 7320 4e6f 6e65 3a0a 2020 2020  is is None:.    
-00006560: 2020 2020 6472 6f70 5f61 7869 7320 3d20      drop_axis = 
-00006570: 5b5d 0a0a 2020 2020 6966 206e 6f74 2063  []..    if not c
-00006580: 616c 6c61 626c 6528 6675 6e63 293a 0a20  allable(func):. 
-00006590: 2020 2020 2020 206d 7367 203d 2028 0a20         msg = (. 
-000065a0: 2020 2020 2020 2020 2020 2022 4669 7273             "Firs
-000065b0: 7420 6172 6775 6d65 6e74 206d 7573 7420  t argument must 
-000065c0: 6265 2063 616c 6c61 626c 6520 6675 6e63  be callable func
-000065d0: 7469 6f6e 2c20 6e6f 7420 2573 5c6e 220a  tion, not %s\n".
-000065e0: 2020 2020 2020 2020 2020 2020 2255 7361              "Usa
-000065f0: 6765 3a20 2020 6461 2e6d 6170 5f62 6c6f  ge:   da.map_blo
-00006600: 636b 7328 6675 6e63 7469 6f6e 2c20 7829  cks(function, x)
-00006610: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00006620: 2220 2020 6f72 3a20 2020 6461 2e6d 6170  "   or:   da.map
-00006630: 5f62 6c6f 636b 7328 6675 6e63 7469 6f6e  _blocks(function
-00006640: 2c20 782c 2079 2c20 7a29 220a 2020 2020  , x, y, z)".    
-00006650: 2020 2020 290a 2020 2020 2020 2020 7261      ).        ra
-00006660: 6973 6520 5479 7065 4572 726f 7228 6d73  ise TypeError(ms
-00006670: 6720 2520 7479 7065 2866 756e 6329 2e5f  g % type(func)._
-00006680: 5f6e 616d 655f 5f29 0a20 2020 2069 6620  _name__).    if 
-00006690: 746f 6b65 6e3a 0a20 2020 2020 2020 2077  token:.        w
-000066a0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-000066b0: 2020 2020 2020 2020 2020 2254 6865 2060            "The `
-000066c0: 746f 6b65 6e3d 6020 6b65 7977 6f72 6420  token=` keyword 
-000066d0: 746f 2060 6d61 705f 626c 6f63 6b73 6020  to `map_blocks` 
-000066e0: 6861 7320 6265 656e 206d 6f76 6564 2074  has been moved t
-000066f0: 6f20 606e 616d 653d 602e 2022 0a20 2020  o `name=`. ".   
-00006700: 2020 2020 2020 2020 2022 506c 6561 7365           "Please
-00006710: 2075 7365 2060 6e61 6d65 3d60 2069 6e73   use `name=` ins
-00006720: 7465 6164 2061 7320 7468 6520 6074 6f6b  tead as the `tok
-00006730: 656e 3d60 206b 6579 776f 7264 2077 696c  en=` keyword wil
-00006740: 6c20 6265 2072 656d 6f76 6564 2022 0a20  l be removed ". 
-00006750: 2020 2020 2020 2020 2020 2022 696e 2061             "in a
-00006760: 2066 7574 7572 6520 7265 6c65 6173 652e   future release.
-00006770: 222c 0a20 2020 2020 2020 2020 2020 2063  ",.            c
-00006780: 6174 6567 6f72 793d 4675 7475 7265 5761  ategory=FutureWa
-00006790: 726e 696e 672c 0a20 2020 2020 2020 2029  rning,.        )
-000067a0: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-000067b0: 746f 6b65 6e0a 0a20 2020 206e 616d 6520  token..    name 
-000067c0: 3d20 6622 7b6e 616d 6520 6f72 2066 756e  = f"{name or fun
-000067d0: 636e 616d 6528 6675 6e63 297d 2d7b 746f  cname(func)}-{to
-000067e0: 6b65 6e69 7a65 2866 756e 632c 2064 7479  kenize(func, dty
-000067f0: 7065 2c20 6368 756e 6b73 2c20 6472 6f70  pe, chunks, drop
-00006800: 5f61 7869 732c 206e 6577 5f61 7869 732c  _axis, new_axis,
-00006810: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00006820: 297d 220a 2020 2020 6e65 775f 6178 6573  )}".    new_axes
-00006830: 203d 207b 7d0a 0a20 2020 2069 6620 6973   = {}..    if is
-00006840: 696e 7374 616e 6365 2864 726f 705f 6178  instance(drop_ax
-00006850: 6973 2c20 4e75 6d62 6572 293a 0a20 2020  is, Number):.   
-00006860: 2020 2020 2064 726f 705f 6178 6973 203d       drop_axis =
-00006870: 205b 6472 6f70 5f61 7869 735d 0a20 2020   [drop_axis].   
-00006880: 2069 6620 6973 696e 7374 616e 6365 286e   if isinstance(n
-00006890: 6577 5f61 7869 732c 204e 756d 6265 7229  ew_axis, Number)
-000068a0: 3a0a 2020 2020 2020 2020 6e65 775f 6178  :.        new_ax
-000068b0: 6973 203d 205b 6e65 775f 6178 6973 5d20  is = [new_axis] 
-000068c0: 2023 2054 4f44 4f3a 2068 616e 646c 6520   # TODO: handle 
-000068d0: 6e65 775f 6178 6973 0a0a 2020 2020 6172  new_axis..    ar
-000068e0: 7273 203d 205b 6120 666f 7220 6120 696e  rs = [a for a in
-000068f0: 2061 7267 7320 6966 2069 7369 6e73 7461   args if isinsta
-00006900: 6e63 6528 612c 2041 7272 6179 295d 0a0a  nce(a, Array)]..
-00006910: 2020 2020 6172 6770 6169 7273 203d 205b      argpairs = [
-00006920: 0a20 2020 2020 2020 2028 612c 2074 7570  .        (a, tup
-00006930: 6c65 2872 616e 6765 2861 2e6e 6469 6d29  le(range(a.ndim)
-00006940: 295b 3a3a 2d31 5d29 2069 6620 6973 696e  )[::-1]) if isin
-00006950: 7374 616e 6365 2861 2c20 4172 7261 7929  stance(a, Array)
-00006960: 2065 6c73 6520 2861 2c20 4e6f 6e65 290a   else (a, None).
-00006970: 2020 2020 2020 2020 666f 7220 6120 696e          for a in
-00006980: 2061 7267 730a 2020 2020 5d0a 2020 2020   args.    ].    
-00006990: 6966 2061 7272 733a 0a20 2020 2020 2020  if arrs:.       
-000069a0: 206f 7574 5f69 6e64 203d 2074 7570 6c65   out_ind = tuple
-000069b0: 2872 616e 6765 286d 6178 2861 2e6e 6469  (range(max(a.ndi
-000069c0: 6d20 666f 7220 6120 696e 2061 7272 7329  m for a in arrs)
-000069d0: 2929 5b3a 3a2d 315d 0a20 2020 2065 6c73  ))[::-1].    els
-000069e0: 653a 0a20 2020 2020 2020 206f 7574 5f69  e:.        out_i
-000069f0: 6e64 203d 2028 290a 0a20 2020 206f 7269  nd = ()..    ori
-00006a00: 6769 6e61 6c5f 6b77 6172 6773 203d 206b  ginal_kwargs = k
-00006a10: 7761 7267 730a 0a20 2020 2069 6620 6474  wargs..    if dt
-00006a20: 7970 6520 6973 204e 6f6e 6520 616e 6420  ype is None and 
-00006a30: 6d65 7461 2069 7320 4e6f 6e65 3a0a 2020  meta is None:.  
-00006a40: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00006a50: 2020 2020 2020 206d 6574 6120 3d20 636f         meta = co
-00006a60: 6d70 7574 655f 6d65 7461 2866 756e 632c  mpute_meta(func,
-00006a70: 2064 7479 7065 2c20 2a61 7267 732c 202a   dtype, *args, *
-00006a80: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00006a90: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00006aa0: 6e3a 0a20 2020 2020 2020 2020 2020 2070  n:.            p
-00006ab0: 6173 730a 0a20 2020 2020 2020 2064 7479  ass..        dty
-00006ac0: 7065 203d 2061 7070 6c79 5f69 6e66 6572  pe = apply_infer
-00006ad0: 5f64 7479 7065 2866 756e 632c 2061 7267  _dtype(func, arg
-00006ae0: 732c 206f 7269 6769 6e61 6c5f 6b77 6172  s, original_kwar
-00006af0: 6773 2c20 226d 6170 5f62 6c6f 636b 7322  gs, "map_blocks"
-00006b00: 290a 0a20 2020 2069 6620 6472 6f70 5f61  )..    if drop_a
-00006b10: 7869 733a 0a20 2020 2020 2020 206e 6469  xis:.        ndi
-00006b20: 6d5f 6f75 7420 3d20 6c65 6e28 6f75 745f  m_out = len(out_
-00006b30: 696e 6429 0a20 2020 2020 2020 2069 6620  ind).        if 
-00006b40: 616e 7928 6920 3c20 2d6e 6469 6d5f 6f75  any(i < -ndim_ou
-00006b50: 7420 6f72 2069 203e 3d20 6e64 696d 5f6f  t or i >= ndim_o
-00006b60: 7574 2066 6f72 2069 2069 6e20 6472 6f70  ut for i in drop
-00006b70: 5f61 7869 7329 3a0a 2020 2020 2020 2020  _axis):.        
-00006b80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00006b90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00006ba0: 2020 2020 2020 6622 6472 6f70 5f61 7869        f"drop_axi
-00006bb0: 7320 6f75 7420 6f66 2072 616e 6765 2028  s out of range (
-00006bc0: 6472 6f70 5f61 7869 733d 7b64 726f 705f  drop_axis={drop_
-00006bd0: 6178 6973 7d2c 2022 0a20 2020 2020 2020  axis}, ".       
-00006be0: 2020 2020 2020 2020 2066 2262 7574 206f           f"but o
-00006bf0: 7574 7075 7420 6973 207b 6e64 696d 5f6f  utput is {ndim_o
-00006c00: 7574 7d64 292e 220a 2020 2020 2020 2020  ut}d).".        
-00006c10: 2020 2020 290a 2020 2020 2020 2020 6472      ).        dr
-00006c20: 6f70 5f61 7869 7320 3d20 5b69 2025 206e  op_axis = [i % n
-00006c30: 6469 6d5f 6f75 7420 666f 7220 6920 696e  dim_out for i in
-00006c40: 2064 726f 705f 6178 6973 5d0a 2020 2020   drop_axis].    
-00006c50: 2020 2020 6f75 745f 696e 6420 3d20 7475      out_ind = tu
-00006c60: 706c 6528 7820 666f 7220 692c 2078 2069  ple(x for i, x i
-00006c70: 6e20 656e 756d 6572 6174 6528 6f75 745f  n enumerate(out_
-00006c80: 696e 6429 2069 6620 6920 6e6f 7420 696e  ind) if i not in
-00006c90: 2064 726f 705f 6178 6973 290a 2020 2020   drop_axis).    
-00006ca0: 6966 206e 6577 5f61 7869 7320 6973 204e  if new_axis is N
-00006cb0: 6f6e 6520 616e 6420 6368 756e 6b73 2069  one and chunks i
-00006cc0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-00006cd0: 656e 286f 7574 5f69 6e64 2920 3c20 6c65  en(out_ind) < le
-00006ce0: 6e28 6368 756e 6b73 293a 0a20 2020 2020  n(chunks):.     
-00006cf0: 2020 206e 6577 5f61 7869 7320 3d20 7261     new_axis = ra
-00006d00: 6e67 6528 6c65 6e28 6368 756e 6b73 2920  nge(len(chunks) 
-00006d10: 2d20 6c65 6e28 6f75 745f 696e 6429 290a  - len(out_ind)).
-00006d20: 2020 2020 6966 206e 6577 5f61 7869 733a      if new_axis:
-00006d30: 0a20 2020 2020 2020 2023 206e 6577 5f61  .        # new_a
-00006d40: 7869 7320 3d20 5b78 202b 206c 656e 2864  xis = [x + len(d
-00006d50: 726f 705f 6178 6973 2920 666f 7220 7820  rop_axis) for x 
-00006d60: 696e 206e 6577 5f61 7869 735d 0a20 2020  in new_axis].   
-00006d70: 2020 2020 206f 7574 5f69 6e64 203d 206c       out_ind = l
-00006d80: 6973 7428 6f75 745f 696e 6429 0a20 2020  ist(out_ind).   
-00006d90: 2020 2020 2066 6f72 2061 7820 696e 2073       for ax in s
-00006da0: 6f72 7465 6428 6e65 775f 6178 6973 293a  orted(new_axis):
-00006db0: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-00006dc0: 206c 656e 286f 7574 5f69 6e64 2920 2b20   len(out_ind) + 
-00006dd0: 6c65 6e28 6472 6f70 5f61 7869 7329 0a20  len(drop_axis). 
-00006de0: 2020 2020 2020 2020 2020 206f 7574 5f69             out_i
-00006df0: 6e64 2e69 6e73 6572 7428 6178 2c20 6e29  nd.insert(ax, n)
-00006e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00006e10: 6368 756e 6b73 2069 7320 6e6f 7420 4e6f  chunks is not No
-00006e20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006e30: 2020 2020 6e65 775f 6178 6573 5b6e 5d20      new_axes[n] 
-00006e40: 3d20 6368 756e 6b73 5b61 785d 0a20 2020  = chunks[ax].   
-00006e50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00006e60: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006e70: 6577 5f61 7865 735b 6e5d 203d 2031 0a20  ew_axes[n] = 1. 
-00006e80: 2020 2020 2020 206f 7574 5f69 6e64 203d         out_ind =
-00006e90: 2074 7570 6c65 286f 7574 5f69 6e64 290a   tuple(out_ind).
-00006ea0: 2020 2020 2020 2020 6966 206d 6178 286e          if max(n
-00006eb0: 6577 5f61 7869 7329 203e 206d 6178 286f  ew_axis) > max(o
-00006ec0: 7574 5f69 6e64 293a 0a20 2020 2020 2020  ut_ind):.       
-00006ed0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00006ee0: 4572 726f 7228 224e 6577 5f61 7869 7320  Error("New_axis 
-00006ef0: 7661 6c75 6573 2064 6f20 6e6f 7420 6669  values do not fi
-00006f00: 6c6c 2069 6e20 616c 6c20 6469 6d65 6e73  ll in all dimens
-00006f10: 696f 6e73 2229 0a0a 2020 2020 6966 2063  ions")..    if c
-00006f20: 6875 6e6b 7320 6973 206e 6f74 204e 6f6e  hunks is not Non
-00006f30: 653a 0a20 2020 2020 2020 2069 6620 6c65  e:.        if le
-00006f40: 6e28 6368 756e 6b73 2920 213d 206c 656e  n(chunks) != len
-00006f50: 286f 7574 5f69 6e64 293a 0a20 2020 2020  (out_ind):.     
-00006f60: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00006f70: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00006f80: 2020 2020 2020 2020 2066 2250 726f 7669           f"Provi
-00006f90: 6465 6420 6368 756e 6b73 2068 6176 6520  ded chunks have 
-00006fa0: 7b6c 656e 2863 6875 6e6b 7329 7d20 6469  {len(chunks)} di
-00006fb0: 6d73 3b20 6578 7065 6374 6564 207b 6c65  ms; expected {le
-00006fc0: 6e28 6f75 745f 696e 6429 7d20 6469 6d73  n(out_ind)} dims
-00006fd0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00006fe0: 2020 2020 2020 2020 6164 6a75 7374 5f63          adjust_c
-00006ff0: 6875 6e6b 7320 3d20 6469 6374 287a 6970  hunks = dict(zip
-00007000: 286f 7574 5f69 6e64 2c20 6368 756e 6b73  (out_ind, chunks
-00007010: 2929 0a20 2020 2065 6c73 653a 0a20 2020  )).    else:.   
-00007020: 2020 2020 2061 646a 7573 745f 6368 756e       adjust_chun
-00007030: 6b73 203d 204e 6f6e 650a 0a20 2020 2069  ks = None..    i
-00007040: 6620 656e 666f 7263 655f 6e64 696d 3a0a  f enforce_ndim:.
-00007050: 2020 2020 2020 2020 6f75 7420 3d20 626c          out = bl
-00007060: 6f63 6b77 6973 6528 0a20 2020 2020 2020  ockwise(.       
-00007070: 2020 2020 2061 7070 6c79 5f61 6e64 5f65       apply_and_e
-00007080: 6e66 6f72 6365 2c0a 2020 2020 2020 2020  nforce,.        
-00007090: 2020 2020 6f75 745f 696e 642c 0a20 2020      out_ind,.   
-000070a0: 2020 2020 2020 2020 202a 636f 6e63 6174           *concat
-000070b0: 2861 7267 7061 6972 7329 2c0a 2020 2020  (argpairs),.    
-000070c0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
-000070d0: 5f6e 6469 6d3d 6c65 6e28 6f75 745f 696e  _ndim=len(out_in
-000070e0: 6429 2c0a 2020 2020 2020 2020 2020 2020  d),.            
-000070f0: 5f66 756e 633d 6675 6e63 2c0a 2020 2020  _func=func,.    
-00007100: 2020 2020 2020 2020 6e61 6d65 3d6e 616d          name=nam
-00007110: 652c 0a20 2020 2020 2020 2020 2020 206e  e,.            n
-00007120: 6577 5f61 7865 733d 6e65 775f 6178 6573  ew_axes=new_axes
-00007130: 2c0a 2020 2020 2020 2020 2020 2020 6474  ,.            dt
-00007140: 7970 653d 6474 7970 652c 0a20 2020 2020  ype=dtype,.     
-00007150: 2020 2020 2020 2063 6f6e 6361 7465 6e61         concatena
-00007160: 7465 3d54 7275 652c 0a20 2020 2020 2020  te=True,.       
-00007170: 2020 2020 2061 6c69 676e 5f61 7272 6179       align_array
-00007180: 733d 4661 6c73 652c 0a20 2020 2020 2020  s=False,.       
-00007190: 2020 2020 2061 646a 7573 745f 6368 756e       adjust_chun
-000071a0: 6b73 3d61 646a 7573 745f 6368 756e 6b73  ks=adjust_chunks
-000071b0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
-000071c0: 7461 3d6d 6574 612c 0a20 2020 2020 2020  ta=meta,.       
-000071d0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-000071e0: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-000071f0: 653a 0a20 2020 2020 2020 206f 7574 203d  e:.        out =
-00007200: 2062 6c6f 636b 7769 7365 280a 2020 2020   blockwise(.    
-00007210: 2020 2020 2020 2020 6675 6e63 2c0a 2020          func,.  
-00007220: 2020 2020 2020 2020 2020 6f75 745f 696e            out_in
-00007230: 642c 0a20 2020 2020 2020 2020 2020 202a  d,.            *
-00007240: 636f 6e63 6174 2861 7267 7061 6972 7329  concat(argpairs)
-00007250: 2c0a 2020 2020 2020 2020 2020 2020 6e61  ,.            na
-00007260: 6d65 3d6e 616d 652c 0a20 2020 2020 2020  me=name,.       
-00007270: 2020 2020 206e 6577 5f61 7865 733d 6e65       new_axes=ne
-00007280: 775f 6178 6573 2c0a 2020 2020 2020 2020  w_axes,.        
-00007290: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
-000072a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000072b0: 6361 7465 6e61 7465 3d54 7275 652c 0a20  catenate=True,. 
-000072c0: 2020 2020 2020 2020 2020 2061 6c69 676e             align
-000072d0: 5f61 7272 6179 733d 4661 6c73 652c 0a20  _arrays=False,. 
-000072e0: 2020 2020 2020 2020 2020 2061 646a 7573             adjus
-000072f0: 745f 6368 756e 6b73 3d61 646a 7573 745f  t_chunks=adjust_
-00007300: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
-00007310: 2020 2020 6d65 7461 3d6d 6574 612c 0a20      meta=meta,. 
-00007320: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
-00007330: 7267 732c 0a20 2020 2020 2020 2029 0a0a  rgs,.        )..
-00007340: 2020 2020 6578 7472 615f 6172 6770 6169      extra_argpai
-00007350: 7273 203d 205b 5d0a 2020 2020 6578 7472  rs = [].    extr
-00007360: 615f 6e61 6d65 7320 3d20 5b5d 0a20 2020  a_names = [].   
-00007370: 2023 2049 6620 6675 6e63 2068 6173 2062   # If func has b
-00007380: 6c6f 636b 5f69 6420 6173 2061 6e20 6172  lock_id as an ar
-00007390: 6775 6d65 6e74 2c20 636f 6e73 7472 7563  gument, construc
-000073a0: 7420 616e 2061 7272 6179 206f 6620 626c  t an array of bl
-000073b0: 6f63 6b20 4944 7320 616e 640a 2020 2020  ock IDs and.    
-000073c0: 2320 7072 6570 6172 6520 746f 2069 6e6a  # prepare to inj
-000073d0: 6563 7420 6974 2e0a 2020 2020 6966 2068  ect it..    if h
-000073e0: 6173 5f6b 6579 776f 7264 2866 756e 632c  as_keyword(func,
-000073f0: 2022 626c 6f63 6b5f 6964 2229 3a0a 2020   "block_id"):.  
-00007400: 2020 2020 2020 626c 6f63 6b5f 6964 5f6e        block_id_n
-00007410: 616d 6520 3d20 2262 6c6f 636b 2d69 642d  ame = "block-id-
-00007420: 2220 2b20 6f75 742e 6e61 6d65 0a20 2020  " + out.name.   
-00007430: 2020 2020 2062 6c6f 636b 5f69 645f 6473       block_id_ds
-00007440: 6b20 3d20 7b0a 2020 2020 2020 2020 2020  k = {.          
-00007450: 2020 2862 6c6f 636b 5f69 645f 6e61 6d65    (block_id_name
-00007460: 2c29 202b 2062 6c6f 636b 5f69 643a 2062  ,) + block_id: b
-00007470: 6c6f 636b 5f69 640a 2020 2020 2020 2020  lock_id.        
-00007480: 2020 2020 666f 7220 626c 6f63 6b5f 6964      for block_id
-00007490: 2069 6e20 7072 6f64 7563 7428 2a28 7261   in product(*(ra
-000074a0: 6e67 6528 6c65 6e28 6329 2920 666f 7220  nge(len(c)) for 
-000074b0: 6320 696e 206f 7574 2e63 6875 6e6b 7329  c in out.chunks)
-000074c0: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
-000074d0: 2020 2020 626c 6f63 6b5f 6964 5f61 7272      block_id_arr
-000074e0: 6179 203d 2041 7272 6179 280a 2020 2020  ay = Array(.    
-000074f0: 2020 2020 2020 2020 626c 6f63 6b5f 6964          block_id
-00007500: 5f64 736b 2c0a 2020 2020 2020 2020 2020  _dsk,.          
-00007510: 2020 626c 6f63 6b5f 6964 5f6e 616d 652c    block_id_name,
-00007520: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-00007530: 6e6b 733d 7475 706c 6528 2831 2c29 202a  nks=tuple((1,) *
-00007540: 206c 656e 2863 2920 666f 7220 6320 696e   len(c) for c in
-00007550: 206f 7574 2e63 6875 6e6b 7329 2c0a 2020   out.chunks),.  
-00007560: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
-00007570: 6e70 2e6f 626a 6563 745f 2c0a 2020 2020  np.object_,.    
-00007580: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
-00007590: 7472 615f 6172 6770 6169 7273 2e61 7070  tra_argpairs.app
-000075a0: 656e 6428 2862 6c6f 636b 5f69 645f 6172  end((block_id_ar
-000075b0: 7261 792c 206f 7574 5f69 6e64 2929 0a20  ray, out_ind)). 
-000075c0: 2020 2020 2020 2065 7874 7261 5f6e 616d         extra_nam
-000075d0: 6573 2e61 7070 656e 6428 2262 6c6f 636b  es.append("block
-000075e0: 5f69 6422 290a 0a20 2020 2023 2049 6620  _id")..    # If 
-000075f0: 6675 6e63 2068 6173 2062 6c6f 636b 5f69  func has block_i
-00007600: 6e66 6f20 6173 2061 6e20 6172 6775 6d65  nfo as an argume
-00007610: 6e74 2c20 636f 6e73 7472 7563 7420 616e  nt, construct an
-00007620: 2061 7272 6179 206f 6620 626c 6f63 6b20   array of block 
-00007630: 696e 666f 0a20 2020 2023 206f 626a 6563  info.    # objec
-00007640: 7473 2061 6e64 2070 7265 7061 7265 2074  ts and prepare t
-00007650: 6f20 696e 6a65 6374 2069 742e 0a20 2020  o inject it..   
-00007660: 2069 6620 6861 735f 6b65 7977 6f72 6428   if has_keyword(
-00007670: 6675 6e63 2c20 2262 6c6f 636b 5f69 6e66  func, "block_inf
-00007680: 6f22 293a 0a20 2020 2020 2020 2073 7461  o"):.        sta
-00007690: 7274 7320 3d20 7b7d 0a20 2020 2020 2020  rts = {}.       
-000076a0: 206e 756d 5f63 6875 6e6b 7320 3d20 7b7d   num_chunks = {}
-000076b0: 0a20 2020 2020 2020 2073 6861 7065 7320  .        shapes 
-000076c0: 3d20 7b7d 0a0a 2020 2020 2020 2020 666f  = {}..        fo
-000076d0: 7220 692c 2028 6172 672c 2069 6e5f 696e  r i, (arg, in_in
-000076e0: 6429 2069 6e20 656e 756d 6572 6174 6528  d) in enumerate(
-000076f0: 6172 6770 6169 7273 293a 0a20 2020 2020  argpairs):.     
-00007700: 2020 2020 2020 2069 6620 696e 5f69 6e64         if in_ind
-00007710: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00007720: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00007730: 6170 6573 5b69 5d20 3d20 6172 672e 7368  apes[i] = arg.sh
-00007740: 6170 650a 2020 2020 2020 2020 2020 2020  ape.            
-00007750: 2020 2020 6966 2064 726f 705f 6178 6973      if drop_axis
-00007760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007770: 2020 2020 2020 2320 5765 2063 6f6e 6361        # We conca
-00007780: 7465 6e61 7465 2061 6c6f 6e67 2064 726f  tenate along dro
-00007790: 7070 6564 2061 7865 732c 2073 6f20 7765  pped axes, so we
-000077a0: 206e 6565 6420 746f 2074 7265 6174 2074   need to treat t
-000077b0: 6865 6d0a 2020 2020 2020 2020 2020 2020  hem.            
-000077c0: 2020 2020 2020 2020 2320 6173 2069 6620          # as if 
-000077d0: 7468 6572 6520 6973 206f 6e6c 7920 6120  there is only a 
-000077e0: 7369 6e67 6c65 2063 6875 6e6b 2e0a 2020  single chunk..  
-000077f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007800: 2020 7374 6172 7473 5b69 5d20 3d20 5b0a    starts[i] = [.
-00007810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007820: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00007830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007840: 2020 2020 2020 6361 6368 6564 5f63 756d        cached_cum
-00007850: 7375 6d28 6172 672e 6368 756e 6b73 5b6a  sum(arg.chunks[j
-00007860: 5d2c 2069 6e69 7469 616c 5f7a 6572 6f3d  ], initial_zero=
-00007870: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00007880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007890: 2020 6966 2069 6e64 2069 6e20 6f75 745f    if ind in out_
-000078a0: 696e 640a 2020 2020 2020 2020 2020 2020  ind.            
-000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078c0: 656c 7365 205b 302c 2061 7267 2e73 6861  else [0, arg.sha
-000078d0: 7065 5b6a 5d5d 0a20 2020 2020 2020 2020  pe[j]].         
-000078e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000078f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007900: 2020 2020 2020 2020 2066 6f72 206a 2c20           for j, 
-00007910: 696e 6420 696e 2065 6e75 6d65 7261 7465  ind in enumerate
-00007920: 2869 6e5f 696e 6429 0a20 2020 2020 2020  (in_ind).       
-00007930: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-00007940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007950: 2020 206e 756d 5f63 6875 6e6b 735b 695d     num_chunks[i]
-00007960: 203d 2074 7570 6c65 286c 656e 2873 2920   = tuple(len(s) 
-00007970: 2d20 3120 666f 7220 7320 696e 2073 7461  - 1 for s in sta
-00007980: 7274 735b 695d 290a 2020 2020 2020 2020  rts[i]).        
-00007990: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000079a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079b0: 2020 7374 6172 7473 5b69 5d20 3d20 5b0a    starts[i] = [.
-000079c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079d0: 2020 2020 2020 2020 6361 6368 6564 5f63          cached_c
-000079e0: 756d 7375 6d28 632c 2069 6e69 7469 616c  umsum(c, initial
-000079f0: 5f7a 6572 6f3d 5472 7565 2920 666f 7220  _zero=True) for 
-00007a00: 6320 696e 2061 7267 2e63 6875 6e6b 730a  c in arg.chunks.
-00007a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a20: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-00007a30: 2020 2020 2020 2020 2020 6e75 6d5f 6368            num_ch
-00007a40: 756e 6b73 5b69 5d20 3d20 6172 672e 6e75  unks[i] = arg.nu
-00007a50: 6d62 6c6f 636b 730a 2020 2020 2020 2020  mblocks.        
-00007a60: 6f75 745f 7374 6172 7473 203d 205b 6361  out_starts = [ca
-00007a70: 6368 6564 5f63 756d 7375 6d28 632c 2069  ched_cumsum(c, i
-00007a80: 6e69 7469 616c 5f7a 6572 6f3d 5472 7565  nitial_zero=True
-00007a90: 2920 666f 7220 6320 696e 206f 7574 2e63  ) for c in out.c
-00007aa0: 6875 6e6b 735d 0a0a 2020 2020 2020 2020  hunks]..        
-00007ab0: 626c 6f63 6b5f 696e 666f 5f6e 616d 6520  block_info_name 
-00007ac0: 3d20 2262 6c6f 636b 2d69 6e66 6f2d 2220  = "block-info-" 
-00007ad0: 2b20 6f75 742e 6e61 6d65 0a20 2020 2020  + out.name.     
-00007ae0: 2020 2062 6c6f 636b 5f69 6e66 6f5f 6473     block_info_ds
-00007af0: 6b20 3d20 7b7d 0a20 2020 2020 2020 2066  k = {}.        f
-00007b00: 6f72 2062 6c6f 636b 5f69 6420 696e 2070  or block_id in p
-00007b10: 726f 6475 6374 282a 2872 616e 6765 286c  roduct(*(range(l
-00007b20: 656e 2863 2929 2066 6f72 2063 2069 6e20  en(c)) for c in 
-00007b30: 6f75 742e 6368 756e 6b73 2929 3a0a 2020  out.chunks)):.  
-00007b40: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
-00007b50: 706f 7369 7469 6f6e 206f 6620 6368 756e  position of chun
-00007b60: 6b2c 2069 6e64 6578 6564 2062 7920 6178  k, indexed by ax
-00007b70: 6973 206c 6162 656c 730a 2020 2020 2020  is labels.      
-00007b80: 2020 2020 2020 6c6f 6361 7469 6f6e 203d        location =
-00007b90: 207b 6f75 745f 696e 645b 695d 3a20 6c6f   {out_ind[i]: lo
-00007ba0: 6320 666f 7220 692c 206c 6f63 2069 6e20  c for i, loc in 
-00007bb0: 656e 756d 6572 6174 6528 626c 6f63 6b5f  enumerate(block_
-00007bc0: 6964 297d 0a20 2020 2020 2020 2020 2020  id)}.           
-00007bd0: 2069 6e66 6f20 3d20 7b7d 0a20 2020 2020   info = {}.     
-00007be0: 2020 2020 2020 2066 6f72 2069 2c20 7368         for i, sh
-00007bf0: 6170 6520 696e 2073 6861 7065 732e 6974  ape in shapes.it
-00007c00: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00007c10: 2020 2020 2020 2023 2043 6f6d 7075 7465         # Compute
-00007c20: 2063 6875 6e6b 206b 6579 2069 6e20 7468   chunk key in th
-00007c30: 6520 6172 7261 792c 2074 616b 696e 6720  e array, taking 
-00007c40: 6272 6f61 6463 6173 7469 6e67 2069 6e74  broadcasting int
-00007c50: 6f0a 2020 2020 2020 2020 2020 2020 2020  o.              
-00007c60: 2020 2320 6163 636f 756e 742e 2057 6520    # account. We 
-00007c70: 646f 6e27 7420 6469 7265 6374 6c79 206b  don't directly k
-00007c80: 6e6f 7720 7768 6963 6820 6469 6d65 6e73  now which dimens
-00007c90: 696f 6e73 2061 7265 0a20 2020 2020 2020  ions are.       
-00007ca0: 2020 2020 2020 2020 2023 2062 726f 6164           # broad
-00007cb0: 6361 7374 2c20 6275 7420 616e 7920 6469  cast, but any di
-00007cc0: 6d65 6e73 696f 6e20 7769 7468 206f 6e6c  mension with onl
-00007cd0: 7920 6f6e 6520 6368 756e 6b20 6361 6e20  y one chunk can 
-00007ce0: 6265 0a20 2020 2020 2020 2020 2020 2020  be.             
-00007cf0: 2020 2023 2074 7265 6174 6564 2061 7320     # treated as 
-00007d00: 6272 6f61 6463 6173 742e 0a20 2020 2020  broadcast..     
-00007d10: 2020 2020 2020 2020 2020 2061 7272 5f6b             arr_k
-00007d20: 203d 2074 7570 6c65 280a 2020 2020 2020   = tuple(.      
-00007d30: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00007d40: 6361 7469 6f6e 2e67 6574 2869 6e64 2c20  cation.get(ind, 
-00007d50: 3029 2069 6620 6e75 6d5f 6368 756e 6b73  0) if num_chunks
-00007d60: 5b69 5d5b 6a5d 203e 2031 2065 6c73 6520  [i][j] > 1 else 
-00007d70: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00007d80: 2020 2020 2020 666f 7220 6a2c 2069 6e64        for j, ind
-00007d90: 2069 6e20 656e 756d 6572 6174 6528 6172   in enumerate(ar
-00007da0: 6770 6169 7273 5b69 5d5b 315d 290a 2020  gpairs[i][1]).  
-00007db0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00007dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007dd0: 696e 666f 5b69 5d20 3d20 7b0a 2020 2020  info[i] = {.    
+000042a0: 696f 6e61 6c0a 2020 2020 2020 2020 4e65  ional.        Ne
+000042b0: 7720 6469 6d65 6e73 696f 6e73 2063 7265  w dimensions cre
+000042c0: 6174 6564 2062 7920 7468 6520 6675 6e63  ated by the func
+000042d0: 7469 6f6e 2e20 4e6f 7465 2074 6861 7420  tion. Note that 
+000042e0: 7468 6573 6520 6172 6520 6170 706c 6965  these are applie
+000042f0: 640a 2020 2020 2020 2020 6166 7465 7220  d.        after 
+00004300: 6060 6472 6f70 5f61 7869 7360 6020 2869  ``drop_axis`` (i
+00004310: 6620 7072 6573 656e 7429 2e0a 2020 2020  f present)..    
+00004320: 656e 666f 7263 655f 6e64 696d 203a 2062  enforce_ndim : b
+00004330: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
+00004340: 7365 0a20 2020 2020 2020 2057 6865 7468  se.        Wheth
+00004350: 6572 2074 6f20 656e 666f 7263 6520 6174  er to enforce at
+00004360: 2072 756e 7469 6d65 2074 6861 7420 7468   runtime that th
+00004370: 6520 6469 6d65 6e73 696f 6e61 6c69 7479  e dimensionality
+00004380: 206f 6620 7468 6520 6172 7261 790a 2020   of the array.  
+00004390: 2020 2020 2020 7072 6f64 7563 6564 2062        produced b
+000043a0: 7920 6060 6675 6e63 6060 2061 6374 7561  y ``func`` actua
+000043b0: 6c6c 7920 6d61 7463 6865 7320 7468 6174  lly matches that
+000043c0: 206f 6620 7468 6520 6172 7261 7920 7265   of the array re
+000043d0: 7475 726e 6564 2062 790a 2020 2020 2020  turned by.      
+000043e0: 2020 6060 6d61 705f 626c 6f63 6b73 6060    ``map_blocks``
+000043f0: 2e0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
+00004400: 652c 2074 6869 7320 7769 6c6c 2072 6169  e, this will rai
+00004410: 7365 2061 6e20 6572 726f 7220 7768 656e  se an error when
+00004420: 2074 6865 7265 2069 7320 6120 6d69 736d   there is a mism
+00004430: 6174 6368 2e0a 2020 2020 746f 6b65 6e20  atch..    token 
+00004440: 3a20 7374 7269 6e67 2c20 6f70 7469 6f6e  : string, option
+00004450: 616c 0a20 2020 2020 2020 2054 6865 206b  al.        The k
+00004460: 6579 2070 7265 6669 7820 746f 2075 7365  ey prefix to use
+00004470: 2066 6f72 2074 6865 206f 7574 7075 7420   for the output 
+00004480: 6172 7261 792e 2049 6620 6e6f 7420 7072  array. If not pr
+00004490: 6f76 6964 6564 2c20 7769 6c6c 2062 650a  ovided, will be.
+000044a0: 2020 2020 2020 2020 6465 7465 726d 696e          determin
+000044b0: 6564 2066 726f 6d20 7468 6520 6675 6e63  ed from the func
+000044c0: 7469 6f6e 206e 616d 652e 0a20 2020 206e  tion name..    n
+000044d0: 616d 6520 3a20 7374 7269 6e67 2c20 6f70  ame : string, op
+000044e0: 7469 6f6e 616c 0a20 2020 2020 2020 2054  tional.        T
+000044f0: 6865 206b 6579 206e 616d 6520 746f 2075  he key name to u
+00004500: 7365 2066 6f72 2074 6865 206f 7574 7075  se for the outpu
+00004510: 7420 6172 7261 792e 204e 6f74 6520 7468  t array. Note th
+00004520: 6174 2074 6869 7320 6675 6c6c 790a 2020  at this fully.  
+00004530: 2020 2020 2020 7370 6563 6966 6965 7320        specifies 
+00004540: 7468 6520 6f75 7470 7574 206b 6579 206e  the output key n
+00004550: 616d 652c 2061 6e64 206d 7573 7420 6265  ame, and must be
+00004560: 2075 6e69 7175 652e 2049 6620 6e6f 7420   unique. If not 
+00004570: 7072 6f76 6964 6564 2c0a 2020 2020 2020  provided,.      
+00004580: 2020 7769 6c6c 2062 6520 6465 7465 726d    will be determ
+00004590: 696e 6564 2062 7920 6120 6861 7368 206f  ined by a hash o
+000045a0: 6620 7468 6520 6172 6775 6d65 6e74 732e  f the arguments.
+000045b0: 0a20 2020 206d 6574 6120 3a20 6172 7261  .    meta : arra
+000045c0: 792d 6c69 6b65 2c20 6f70 7469 6f6e 616c  y-like, optional
+000045d0: 0a20 2020 2020 2020 2054 6865 2060 606d  .        The ``m
+000045e0: 6574 6160 6020 6f66 2074 6865 206f 7574  eta`` of the out
+000045f0: 7075 7420 6172 7261 792c 2077 6865 6e20  put array, when 
+00004600: 7370 6563 6966 6965 6420 6973 2065 7870  specified is exp
+00004610: 6563 7465 6420 746f 2062 6520 616e 0a20  ected to be an. 
+00004620: 2020 2020 2020 2061 7272 6179 206f 6620         array of 
+00004630: 7468 6520 7361 6d65 2074 7970 6520 616e  the same type an
+00004640: 6420 6474 7970 6520 6f66 2074 6861 7420  d dtype of that 
+00004650: 7265 7475 726e 6564 2077 6865 6e20 6361  returned when ca
+00004660: 6c6c 696e 6720 6060 2e63 6f6d 7075 7465  lling ``.compute
+00004670: 2829 6060 0a20 2020 2020 2020 206f 6e20  ()``.        on 
+00004680: 7468 6520 6172 7261 7920 7265 7475 726e  the array return
+00004690: 6564 2062 7920 7468 6973 2066 756e 6374  ed by this funct
+000046a0: 696f 6e2e 2057 6865 6e20 6e6f 7420 7072  ion. When not pr
+000046b0: 6f76 6964 6564 2c20 6060 6d65 7461 6060  ovided, ``meta``
+000046c0: 2077 696c 6c20 6265 0a20 2020 2020 2020   will be.       
+000046d0: 2069 6e66 6572 7265 6420 6279 2061 7070   inferred by app
+000046e0: 6c79 696e 6720 7468 6520 6675 6e63 7469  lying the functi
+000046f0: 6f6e 2074 6f20 6120 736d 616c 6c20 7365  on to a small se
+00004700: 7420 6f66 2066 616b 6520 6461 7461 2c20  t of fake data, 
+00004710: 7573 7561 6c6c 7920 610a 2020 2020 2020  usually a.      
+00004720: 2020 302d 6420 6172 7261 792e 2049 7427    0-d array. It'
+00004730: 7320 696d 706f 7274 616e 7420 746f 2065  s important to e
+00004740: 6e73 7572 6520 7468 6174 2060 6066 756e  nsure that ``fun
+00004750: 6360 6020 6361 6e20 7375 6363 6573 7366  c`` can successf
+00004760: 756c 6c79 2063 6f6d 706c 6574 650a 2020  ully complete.  
+00004770: 2020 2020 2020 636f 6d70 7574 6174 696f        computatio
+00004780: 6e20 7769 7468 6f75 7420 7261 6973 696e  n without raisin
+00004790: 6720 6578 6365 7074 696f 6e73 2077 6865  g exceptions whe
+000047a0: 6e20 302d 6420 6973 2070 6173 7365 6420  n 0-d is passed 
+000047b0: 746f 2069 742c 2070 726f 7669 6469 6e67  to it, providing
+000047c0: 0a20 2020 2020 2020 2060 606d 6574 6160  .        ``meta`
+000047d0: 6020 7769 6c6c 2062 6520 7265 7175 6972  ` will be requir
+000047e0: 6564 206f 7468 6572 7769 7365 2e20 4966  ed otherwise. If
+000047f0: 2074 6865 206f 7574 7075 7420 7479 7065   the output type
+00004800: 2069 7320 6b6e 6f77 6e20 6265 666f 7265   is known before
+00004810: 6861 6e64 0a20 2020 2020 2020 2028 652e  hand.        (e.
+00004820: 672e 2c20 6060 6e70 2e6e 6461 7272 6179  g., ``np.ndarray
+00004830: 6060 2c20 6060 6375 7079 2e6e 6461 7272  ``, ``cupy.ndarr
+00004840: 6179 6060 292c 2061 6e20 656d 7074 7920  ay``), an empty 
+00004850: 6172 7261 7920 6f66 2073 7563 6820 7479  array of such ty
+00004860: 7065 2064 7479 7065 0a20 2020 2020 2020  pe dtype.       
+00004870: 2063 616e 2062 6520 7061 7373 6564 2c20   can be passed, 
+00004880: 666f 7220 6578 616d 706c 653a 2060 606d  for example: ``m
+00004890: 6574 613d 6e70 2e61 7272 6179 2828 292c  eta=np.array((),
+000048a0: 2064 7479 7065 3d6e 702e 696e 7433 3229   dtype=np.int32)
+000048b0: 6060 2e0a 2020 2020 2a2a 6b77 6172 6773  ``..    **kwargs
+000048c0: 203a 0a20 2020 2020 2020 204f 7468 6572   :.        Other
+000048d0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+000048e0: 7473 2074 6f20 7061 7373 2074 6f20 6675  ts to pass to fu
+000048f0: 6e63 7469 6f6e 2e20 5661 6c75 6573 206d  nction. Values m
+00004900: 7573 7420 6265 2063 6f6e 7374 616e 7473  ust be constants
+00004910: 0a20 2020 2020 2020 2028 6e6f 7420 6461  .        (not da
+00004920: 736b 2e61 7272 6179 7329 0a0a 2020 2020  sk.arrays)..    
+00004930: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
+00004940: 2d2d 2d2d 2d0a 2020 2020 6461 736b 2e61  -----.    dask.a
+00004950: 7272 6179 2e6d 6170 5f6f 7665 726c 6170  rray.map_overlap
+00004960: 203a 2047 656e 6572 616c 697a 6564 206f   : Generalized o
+00004970: 7065 7261 7469 6f6e 2077 6974 6820 6f76  peration with ov
+00004980: 6572 6c61 7020 6265 7477 6565 6e20 6e65  erlap between ne
+00004990: 6967 6862 6f72 732e 0a20 2020 2064 6173  ighbors..    das
+000049a0: 6b2e 6172 7261 792e 626c 6f63 6b77 6973  k.array.blockwis
+000049b0: 6520 3a20 4765 6e65 7261 6c69 7a65 6420  e : Generalized 
+000049c0: 6f70 6572 6174 696f 6e20 7769 7468 2063  operation with c
+000049d0: 6f6e 7472 6f6c 206f 7665 7220 626c 6f63  ontrol over bloc
+000049e0: 6b20 616c 6967 6e6d 656e 742e 0a0a 2020  k alignment...  
+000049f0: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00004a00: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00004a10: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+00004a20: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
+00004a30: 7820 3d20 6461 2e61 7261 6e67 6528 362c  x = da.arange(6,
+00004a40: 2063 6875 6e6b 733d 3329 0a0a 2020 2020   chunks=3)..    
+00004a50: 3e3e 3e20 782e 6d61 705f 626c 6f63 6b73  >>> x.map_blocks
+00004a60: 286c 616d 6264 6120 783a 2078 202a 2032  (lambda x: x * 2
+00004a70: 292e 636f 6d70 7574 6528 290a 2020 2020  ).compute().    
+00004a80: 6172 7261 7928 5b20 302c 2020 322c 2020  array([ 0,  2,  
+00004a90: 342c 2020 362c 2020 382c 2031 305d 290a  4,  6,  8, 10]).
+00004aa0: 0a20 2020 2054 6865 2060 6064 612e 6d61  .    The ``da.ma
+00004ab0: 705f 626c 6f63 6b73 6060 2066 756e 6374  p_blocks`` funct
+00004ac0: 696f 6e20 6361 6e20 616c 736f 2061 6363  ion can also acc
+00004ad0: 6570 7420 6d75 6c74 6970 6c65 2061 7272  ept multiple arr
+00004ae0: 6179 732e 0a0a 2020 2020 3e3e 3e20 6420  ays...    >>> d 
+00004af0: 3d20 6461 2e61 7261 6e67 6528 352c 2063  = da.arange(5, c
+00004b00: 6875 6e6b 733d 3229 0a20 2020 203e 3e3e  hunks=2).    >>>
+00004b10: 2065 203d 2064 612e 6172 616e 6765 2835   e = da.arange(5
+00004b20: 2c20 6368 756e 6b73 3d32 290a 0a20 2020  , chunks=2)..   
+00004b30: 203e 3e3e 2066 203d 2064 612e 6d61 705f   >>> f = da.map_
+00004b40: 626c 6f63 6b73 286c 616d 6264 6120 612c  blocks(lambda a,
+00004b50: 2062 3a20 6120 2b20 622a 2a32 2c20 642c   b: a + b**2, d,
+00004b60: 2065 290a 2020 2020 3e3e 3e20 662e 636f   e).    >>> f.co
+00004b70: 6d70 7574 6528 290a 2020 2020 6172 7261  mpute().    arra
+00004b80: 7928 5b20 302c 2020 322c 2020 362c 2031  y([ 0,  2,  6, 1
+00004b90: 322c 2032 305d 290a 0a20 2020 2049 6620  2, 20])..    If 
+00004ba0: 7468 6520 6675 6e63 7469 6f6e 2063 6861  the function cha
+00004bb0: 6e67 6573 2073 6861 7065 206f 6620 7468  nges shape of th
+00004bc0: 6520 626c 6f63 6b73 2074 6865 6e20 796f  e blocks then yo
+00004bd0: 7520 6d75 7374 2070 726f 7669 6465 2063  u must provide c
+00004be0: 6875 6e6b 730a 2020 2020 6578 706c 6963  hunks.    explic
+00004bf0: 6974 6c79 2e0a 0a20 2020 203e 3e3e 2079  itly...    >>> y
+00004c00: 203d 2078 2e6d 6170 5f62 6c6f 636b 7328   = x.map_blocks(
+00004c10: 6c61 6d62 6461 2078 3a20 785b 3a3a 325d  lambda x: x[::2]
+00004c20: 2c20 6368 756e 6b73 3d28 2832 2c20 3229  , chunks=((2, 2)
+00004c30: 2c29 290a 0a20 2020 2059 6f75 2068 6176  ,))..    You hav
+00004c40: 6520 6120 6269 7420 6f66 2066 7265 6564  e a bit of freed
+00004c50: 6f6d 2069 6e20 7370 6563 6966 7969 6e67  om in specifying
+00004c60: 2063 6875 6e6b 732e 2020 4966 2061 6c6c   chunks.  If all
+00004c70: 206f 6620 7468 6520 6f75 7470 7574 2063   of the output c
+00004c80: 6875 6e6b 0a20 2020 2073 697a 6573 2061  hunk.    sizes a
+00004c90: 7265 2074 6865 2073 616d 652c 2079 6f75  re the same, you
+00004ca0: 2063 616e 2070 726f 7669 6465 206a 7573   can provide jus
+00004cb0: 7420 7468 6174 2063 6875 6e6b 2073 697a  t that chunk siz
+00004cc0: 6520 6173 2061 2073 696e 676c 6520 7475  e as a single tu
+00004cd0: 706c 652e 0a0a 2020 2020 3e3e 3e20 6120  ple...    >>> a 
+00004ce0: 3d20 6461 2e61 7261 6e67 6528 3138 2c20  = da.arange(18, 
+00004cf0: 6368 756e 6b73 3d28 362c 2929 0a20 2020  chunks=(6,)).   
+00004d00: 203e 3e3e 2062 203d 2061 2e6d 6170 5f62   >>> b = a.map_b
+00004d10: 6c6f 636b 7328 6c61 6d62 6461 2078 3a20  locks(lambda x: 
+00004d20: 785b 3a33 5d2c 2063 6875 6e6b 733d 2833  x[:3], chunks=(3
+00004d30: 2c29 290a 0a20 2020 2049 6620 7468 6520  ,))..    If the 
+00004d40: 6675 6e63 7469 6f6e 2063 6861 6e67 6573  function changes
+00004d50: 2074 6865 2064 696d 656e 7369 6f6e 206f   the dimension o
+00004d60: 6620 7468 6520 626c 6f63 6b73 2079 6f75  f the blocks you
+00004d70: 206d 7573 7420 7370 6563 6966 7920 7468   must specify th
+00004d80: 650a 2020 2020 6372 6561 7465 6420 6f72  e.    created or
+00004d90: 2064 6573 7472 6f79 6564 2064 696d 656e   destroyed dimen
+00004da0: 7369 6f6e 732e 0a0a 2020 2020 3e3e 3e20  sions...    >>> 
+00004db0: 6220 3d20 612e 6d61 705f 626c 6f63 6b73  b = a.map_blocks
+00004dc0: 286c 616d 6264 6120 783a 2078 5b4e 6f6e  (lambda x: x[Non
+00004dd0: 652c 203a 2c20 4e6f 6e65 5d2c 2063 6875  e, :, None], chu
+00004de0: 6e6b 733d 2831 2c20 362c 2031 292c 0a20  nks=(1, 6, 1),. 
+00004df0: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+00004e00: 2020 2020 2020 2020 6e65 775f 6178 6973          new_axis
+00004e10: 3d5b 302c 2032 5d29 0a0a 2020 2020 4966  =[0, 2])..    If
+00004e20: 2060 6063 6875 6e6b 7360 6020 6973 2073   ``chunks`` is s
+00004e30: 7065 6369 6669 6564 2062 7574 2060 606e  pecified but ``n
+00004e40: 6577 5f61 7869 7360 6020 6973 206e 6f74  ew_axis`` is not
+00004e50: 2c20 7468 656e 2069 7420 6973 2069 6e66  , then it is inf
+00004e60: 6572 7265 6420 746f 0a20 2020 2061 6464  erred to.    add
+00004e70: 2074 6865 206e 6563 6573 7361 7279 206e   the necessary n
+00004e80: 756d 6265 7220 6f66 2061 7865 7320 6f6e  umber of axes on
+00004e90: 2074 6865 206c 6566 742e 0a0a 2020 2020   the left...    
+00004ea0: 4e6f 7465 2074 6861 7420 6060 6d61 705f  Note that ``map_
+00004eb0: 626c 6f63 6b73 2829 6060 2077 696c 6c20  blocks()`` will 
+00004ec0: 636f 6e63 6174 656e 6174 6520 6368 756e  concatenate chun
+00004ed0: 6b73 2061 6c6f 6e67 2061 7865 7320 7370  ks along axes sp
+00004ee0: 6563 6966 6965 6420 6279 0a20 2020 2074  ecified by.    t
+00004ef0: 6865 206b 6579 776f 7264 2070 6172 616d  he keyword param
+00004f00: 6574 6572 2060 6064 726f 705f 6178 6973  eter ``drop_axis
+00004f10: 6060 2070 7269 6f72 2074 6f20 6170 706c  `` prior to appl
+00004f20: 7969 6e67 2074 6865 2066 756e 6374 696f  ying the functio
+00004f30: 6e2e 0a20 2020 2054 6869 7320 6973 2069  n..    This is i
+00004f40: 6c6c 7573 7472 6174 6564 2069 6e20 7468  llustrated in th
+00004f50: 6520 6669 6775 7265 2062 656c 6f77 3a0a  e figure below:.
+00004f60: 0a20 2020 202e 2e20 696d 6167 653a 3a20  .    .. image:: 
+00004f70: 2f69 6d61 6765 732f 6d61 705f 626c 6f63  /images/map_bloc
+00004f80: 6b73 5f64 726f 705f 6178 6973 2e70 6e67  ks_drop_axis.png
+00004f90: 0a0a 2020 2020 4475 6520 746f 206d 656d  ..    Due to mem
+00004fa0: 6f72 792d 7369 7a65 2d63 6f6e 7374 7261  ory-size-constra
+00004fb0: 696e 7473 2c20 6974 2069 7320 6f66 7465  ints, it is ofte
+00004fc0: 6e20 6e6f 7420 6164 7669 7361 626c 6520  n not advisable 
+00004fd0: 746f 2075 7365 2060 6064 726f 705f 6178  to use ``drop_ax
+00004fe0: 6973 6060 0a20 2020 206f 6e20 616e 2061  is``.    on an a
+00004ff0: 7869 7320 7468 6174 2069 7320 6368 756e  xis that is chun
+00005000: 6b65 642e 2020 496e 2074 6861 7420 6361  ked.  In that ca
+00005010: 7365 2c20 6974 2069 7320 6265 7474 6572  se, it is better
+00005020: 206e 6f74 2074 6f20 7573 650a 2020 2020   not to use.    
+00005030: 6060 6d61 705f 626c 6f63 6b73 6060 2062  ``map_blocks`` b
+00005040: 7574 2072 6174 6865 720a 2020 2020 6060  ut rather.    ``
+00005050: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
+00005060: 7469 6f6e 282e 2e2e 2c20 6178 6973 3d64  tion(..., axis=d
+00005070: 726f 7070 6564 5f61 7865 732c 2063 6f6e  ropped_axes, con
+00005080: 6361 7465 6e61 7465 3d46 616c 7365 2960  catenate=False)`
+00005090: 6020 7768 6963 680a 2020 2020 6d61 696e  ` which.    main
+000050a0: 7461 696e 7320 6120 6c65 616e 6572 206d  tains a leaner m
+000050b0: 656d 6f72 7920 666f 6f74 7072 696e 7420  emory footprint 
+000050c0: 7768 696c 6520 6974 2064 726f 7073 2061  while it drops a
+000050d0: 6e79 2061 7869 732e 0a0a 2020 2020 4d61  ny axis...    Ma
+000050e0: 705f 626c 6f63 6b73 2061 6c69 676e 7320  p_blocks aligns 
+000050f0: 626c 6f63 6b73 2062 7920 626c 6f63 6b20  blocks by block 
+00005100: 706f 7369 7469 6f6e 7320 7769 7468 6f75  positions withou
+00005110: 7420 7265 6761 7264 2074 6f20 7368 6170  t regard to shap
+00005120: 652e 2049 6e20 7468 650a 2020 2020 666f  e. In the.    fo
+00005130: 6c6c 6f77 696e 6720 6578 616d 706c 6520  llowing example 
+00005140: 7765 2068 6176 6520 7477 6f20 6172 7261  we have two arra
+00005150: 7973 2077 6974 6820 7468 6520 7361 6d65  ys with the same
+00005160: 206e 756d 6265 7220 6f66 2062 6c6f 636b   number of block
+00005170: 7320 6275 740a 2020 2020 7769 7468 2064  s but.    with d
+00005180: 6966 6665 7265 6e74 2073 6861 7065 2061  ifferent shape a
+00005190: 6e64 2063 6875 6e6b 2073 697a 6573 2e0a  nd chunk sizes..
+000051a0: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
+000051b0: 6172 616e 6765 2831 3030 302c 2063 6875  arange(1000, chu
+000051c0: 6e6b 733d 2831 3030 2c29 290a 2020 2020  nks=(100,)).    
+000051d0: 3e3e 3e20 7920 3d20 6461 2e61 7261 6e67  >>> y = da.arang
+000051e0: 6528 3130 302c 2063 6875 6e6b 733d 2831  e(100, chunks=(1
+000051f0: 302c 2929 0a0a 2020 2020 5468 6520 7265  0,))..    The re
+00005200: 6c65 7661 6e74 2061 7474 7269 6275 7465  levant attribute
+00005210: 2074 6f20 6d61 7463 6820 6973 206e 756d   to match is num
+00005220: 626c 6f63 6b73 2e0a 0a20 2020 203e 3e3e  blocks...    >>>
+00005230: 2078 2e6e 756d 626c 6f63 6b73 0a20 2020   x.numblocks.   
+00005240: 2028 3130 2c29 0a20 2020 203e 3e3e 2079   (10,).    >>> y
+00005250: 2e6e 756d 626c 6f63 6b73 0a20 2020 2028  .numblocks.    (
+00005260: 3130 2c29 0a0a 2020 2020 4966 2074 6865  10,)..    If the
+00005270: 7365 206d 6174 6368 2028 7570 2074 6f20  se match (up to 
+00005280: 6272 6f61 6463 6173 7469 6e67 2072 756c  broadcasting rul
+00005290: 6573 2920 7468 656e 2077 6520 6361 6e20  es) then we can 
+000052a0: 6d61 7020 6172 6269 7472 6172 790a 2020  map arbitrary.  
+000052b0: 2020 6675 6e63 7469 6f6e 7320 6163 726f    functions acro
+000052c0: 7373 2062 6c6f 636b 730a 0a20 2020 203e  ss blocks..    >
+000052d0: 3e3e 2064 6566 2066 756e 6328 612c 2062  >> def func(a, b
+000052e0: 293a 0a20 2020 202e 2e2e 2020 2020 2072  ):.    ...     r
+000052f0: 6574 7572 6e20 6e70 2e61 7272 6179 285b  eturn np.array([
+00005300: 612e 6d61 7828 292c 2062 2e6d 6178 2829  a.max(), b.max()
+00005310: 5d29 0a0a 2020 2020 3e3e 3e20 6461 2e6d  ])..    >>> da.m
+00005320: 6170 5f62 6c6f 636b 7328 6675 6e63 2c20  ap_blocks(func, 
+00005330: 782c 2079 2c20 6368 756e 6b73 3d28 322c  x, y, chunks=(2,
+00005340: 292c 2064 7479 7065 3d27 6938 2729 0a20  ), dtype='i8'). 
+00005350: 2020 2064 6173 6b2e 6172 7261 793c 6675     dask.array<fu
+00005360: 6e63 2c20 7368 6170 653d 2832 302c 292c  nc, shape=(20,),
+00005370: 2064 7479 7065 3d69 6e74 3634 2c20 6368   dtype=int64, ch
+00005380: 756e 6b73 697a 653d 2832 2c29 2c20 6368  unksize=(2,), ch
+00005390: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
+000053a0: 6172 7261 793e 0a0a 2020 2020 3e3e 3e20  array>..    >>> 
+000053b0: 5f2e 636f 6d70 7574 6528 290a 2020 2020  _.compute().    
+000053c0: 6172 7261 7928 5b20 3939 2c20 2020 392c  array([ 99,   9,
+000053d0: 2031 3939 2c20 2031 392c 2032 3939 2c20   199,  19, 299, 
+000053e0: 2032 392c 2033 3939 2c20 2033 392c 2034   29, 399,  39, 4
+000053f0: 3939 2c20 2034 392c 2035 3939 2c20 2035  99,  49, 599,  5
+00005400: 392c 2036 3939 2c0a 2020 2020 2020 2020  9, 699,.        
+00005410: 2020 2020 3639 2c20 3739 392c 2020 3739      69, 799,  79
+00005420: 2c20 3839 392c 2020 3839 2c20 3939 392c  , 899,  89, 999,
+00005430: 2020 3939 5d29 0a0a 2020 2020 596f 7572    99])..    Your
+00005440: 2062 6c6f 636b 2066 756e 6374 696f 6e20   block function 
+00005450: 6361 6e20 6765 7420 696e 666f 726d 6174  can get informat
+00005460: 696f 6e20 6162 6f75 7420 7768 6572 6520  ion about where 
+00005470: 6974 2069 7320 696e 2074 6865 2061 7272  it is in the arr
+00005480: 6179 2062 790a 2020 2020 6163 6365 7074  ay by.    accept
+00005490: 696e 6720 6120 7370 6563 6961 6c20 6060  ing a special ``
+000054a0: 626c 6f63 6b5f 696e 666f 6060 206f 7220  block_info`` or 
+000054b0: 6060 626c 6f63 6b5f 6964 6060 206b 6579  ``block_id`` key
+000054c0: 776f 7264 2061 7267 756d 656e 742e 0a20  word argument.. 
+000054d0: 2020 2044 7572 696e 6720 636f 6d70 7574     During comput
+000054e0: 6174 696f 6e2c 2074 6865 7920 7769 6c6c  ation, they will
+000054f0: 2063 6f6e 7461 696e 2069 6e66 6f72 6d61   contain informa
+00005500: 7469 6f6e 2061 626f 7574 2065 6163 6820  tion about each 
+00005510: 6f66 2074 6865 2069 6e70 7574 0a20 2020  of the input.   
+00005520: 2061 6e64 206f 7574 7075 7420 6368 756e   and output chun
+00005530: 6b73 2028 616e 6420 6461 736b 2061 7272  ks (and dask arr
+00005540: 6179 7329 2072 656c 6576 616e 7420 746f  ays) relevant to
+00005550: 2065 6163 6820 6361 6c6c 206f 6620 6060   each call of ``
+00005560: 6675 6e63 6060 2e0a 0a20 2020 203e 3e3e  func``...    >>>
+00005570: 2064 6566 2066 756e 6328 626c 6f63 6b5f   def func(block_
+00005580: 696e 666f 3d4e 6f6e 6529 3a0a 2020 2020  info=None):.    
+00005590: 2e2e 2e20 2020 2020 7061 7373 0a0a 2020  ...     pass..  
+000055a0: 2020 5468 6973 2077 696c 6c20 7265 6365    This will rece
+000055b0: 6976 6520 7468 6520 666f 6c6c 6f77 696e  ive the followin
+000055c0: 6720 696e 666f 726d 6174 696f 6e3a 0a0a  g information:..
+000055d0: 2020 2020 3e3e 3e20 626c 6f63 6b5f 696e      >>> block_in
+000055e0: 666f 2020 2320 646f 6374 6573 743a 202b  fo  # doctest: +
+000055f0: 534b 4950 0a20 2020 207b 303a 207b 2773  SKIP.    {0: {'s
+00005600: 6861 7065 273a 2028 3130 3030 2c29 2c0a  hape': (1000,),.
+00005610: 2020 2020 2020 2020 2027 6e75 6d2d 6368           'num-ch
+00005620: 756e 6b73 273a 2028 3130 2c29 2c0a 2020  unks': (10,),.  
+00005630: 2020 2020 2020 2027 6368 756e 6b2d 6c6f         'chunk-lo
+00005640: 6361 7469 6f6e 273a 2028 342c 292c 0a20  cation': (4,),. 
+00005650: 2020 2020 2020 2020 2761 7272 6179 2d6c          'array-l
+00005660: 6f63 6174 696f 6e27 3a20 5b28 3430 302c  ocation': [(400,
+00005670: 2035 3030 295d 7d2c 0a20 2020 2020 4e6f   500)]},.     No
+00005680: 6e65 3a20 7b27 7368 6170 6527 3a20 2831  ne: {'shape': (1
+00005690: 3030 302c 292c 0a20 2020 2020 2020 2020  000,),.         
+000056a0: 2020 2027 6e75 6d2d 6368 756e 6b73 273a     'num-chunks':
+000056b0: 2028 3130 2c29 2c0a 2020 2020 2020 2020   (10,),.        
+000056c0: 2020 2020 2763 6875 6e6b 2d6c 6f63 6174      'chunk-locat
+000056d0: 696f 6e27 3a20 2834 2c29 2c0a 2020 2020  ion': (4,),.    
+000056e0: 2020 2020 2020 2020 2761 7272 6179 2d6c          'array-l
+000056f0: 6f63 6174 696f 6e27 3a20 5b28 3430 302c  ocation': [(400,
+00005700: 2035 3030 295d 2c0a 2020 2020 2020 2020   500)],.        
+00005710: 2020 2020 2763 6875 6e6b 2d73 6861 7065      'chunk-shape
+00005720: 273a 2028 3130 302c 292c 0a20 2020 2020  ': (100,),.     
+00005730: 2020 2020 2020 2027 6474 7970 6527 3a20         'dtype': 
+00005740: 6474 7970 6528 2766 6c6f 6174 3634 2729  dtype('float64')
+00005750: 7d7d 0a0a 2020 2020 5468 6520 6b65 7973  }}..    The keys
+00005760: 2074 6f20 7468 6520 6060 626c 6f63 6b5f   to the ``block_
+00005770: 696e 666f 6060 2064 6963 7469 6f6e 6172  info`` dictionar
+00005780: 7920 696e 6469 6361 7465 2077 6869 6368  y indicate which
+00005790: 2069 7320 7468 6520 696e 7075 7420 616e   is the input an
+000057a0: 640a 2020 2020 6f75 7470 7574 2044 6173  d.    output Das
+000057b0: 6b20 6172 7261 793a 0a0a 2020 2020 2d20  k array:..    - 
+000057c0: 2a2a 496e 7075 7420 4461 736b 2061 7272  **Input Dask arr
+000057d0: 6179 2873 293a 2a2a 2060 6062 6c6f 636b  ay(s):** ``block
+000057e0: 5f69 6e66 6f5b 305d 6060 2072 6566 6572  _info[0]`` refer
+000057f0: 7320 746f 2074 6865 2066 6972 7374 2069  s to the first i
+00005800: 6e70 7574 2044 6173 6b20 6172 7261 792e  nput Dask array.
+00005810: 0a20 2020 2020 2054 6865 2064 6963 7469  .      The dicti
+00005820: 6f6e 6172 7920 6b65 7920 6973 2060 6030  onary key is ``0
+00005830: 6060 2062 6563 6175 7365 2074 6861 7420  `` because that 
+00005840: 6973 2074 6865 2061 7267 756d 656e 7420  is the argument 
+00005850: 696e 6465 7820 636f 7272 6573 706f 6e64  index correspond
+00005860: 696e 670a 2020 2020 2020 746f 2074 6865  ing.      to the
+00005870: 2066 6972 7374 2069 6e70 7574 2044 6173   first input Das
+00005880: 6b20 6172 7261 792e 0a20 2020 2020 2049  k array..      I
+00005890: 6e20 6361 7365 7320 7768 6572 6520 6d75  n cases where mu
+000058a0: 6c74 6970 6c65 2044 6173 6b20 6172 7261  ltiple Dask arra
+000058b0: 7973 2068 6176 6520 6265 656e 2070 6173  ys have been pas
+000058c0: 7365 6420 6173 2069 6e70 7574 2074 6f20  sed as input to 
+000058d0: 7468 6520 6675 6e63 7469 6f6e 2c0a 2020  the function,.  
+000058e0: 2020 2020 796f 7520 6361 6e20 6163 6365      you can acce
+000058f0: 7373 2074 6865 6d20 7769 7468 2074 6865  ss them with the
+00005900: 206e 756d 6265 7220 636f 7272 6573 706f   number correspo
+00005910: 6e64 696e 6720 746f 2074 6865 2069 6e70  nding to the inp
+00005920: 7574 2061 7267 756d 656e 742c 0a20 2020  ut argument,.   
+00005930: 2020 2065 673a 2060 6062 6c6f 636b 5f69     eg: ``block_i
+00005940: 6e66 6f5b 315d 6060 2c20 6060 626c 6f63  nfo[1]``, ``bloc
+00005950: 6b5f 696e 666f 5b32 5d60 602c 2065 7463  k_info[2]``, etc
+00005960: 2e0a 2020 2020 2020 284e 6f74 6520 7468  ..      (Note th
+00005970: 6174 2069 6620 796f 7520 7061 7373 206d  at if you pass m
+00005980: 756c 7469 706c 6520 4461 736b 2061 7272  ultiple Dask arr
+00005990: 6179 7320 6173 2069 6e70 7574 2074 6f20  ays as input to 
+000059a0: 6d61 705f 626c 6f63 6b73 2c0a 2020 2020  map_blocks,.    
+000059b0: 2020 7468 6520 6172 7261 7973 206d 7573    the arrays mus
+000059c0: 7420 6d61 7463 6820 6561 6368 206f 7468  t match each oth
+000059d0: 6572 2062 7920 6861 7669 6e67 206d 6174  er by having mat
+000059e0: 6368 696e 6720 6e75 6d62 6572 7320 6f66  ching numbers of
+000059f0: 2063 6875 6e6b 732c 0a20 2020 2020 2061   chunks,.      a
+00005a00: 6c6f 6e67 2063 6f72 7265 7370 6f6e 6469  long correspondi
+00005a10: 6e67 2064 696d 656e 7369 6f6e 7320 7570  ng dimensions up
+00005a20: 2074 6f20 6272 6f61 6463 6173 7469 6e67   to broadcasting
+00005a30: 2072 756c 6573 2e29 0a20 2020 202d 202a   rules.).    - *
+00005a40: 2a4f 7574 7075 7420 4461 736b 2061 7272  *Output Dask arr
+00005a50: 6179 3a2a 2a20 6060 626c 6f63 6b5f 696e  ay:** ``block_in
+00005a60: 666f 5b4e 6f6e 655d 6060 2072 6566 6572  fo[None]`` refer
+00005a70: 7320 746f 2074 6865 206f 7574 7075 7420  s to the output 
+00005a80: 4461 736b 2061 7272 6179 2c0a 2020 2020  Dask array,.    
+00005a90: 2020 616e 6420 636f 6e74 6169 6e73 2069    and contains i
+00005aa0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00005ab0: 2074 6865 206f 7574 7075 7420 6368 756e   the output chun
+00005ac0: 6b73 2e0a 2020 2020 2020 5468 6520 6f75  ks..      The ou
+00005ad0: 7470 7574 2063 6875 6e6b 2073 6861 7065  tput chunk shape
+00005ae0: 2061 6e64 2064 7479 7065 206d 6179 206d   and dtype may m
+00005af0: 6179 2062 6520 6469 6666 6572 656e 7420  ay be different 
+00005b00: 7468 616e 2074 6865 2069 6e70 7574 2063  than the input c
+00005b10: 6875 6e6b 732e 0a0a 2020 2020 466f 7220  hunks...    For 
+00005b20: 6561 6368 2064 6173 6b20 6172 7261 792c  each dask array,
+00005b30: 2060 6062 6c6f 636b 5f69 6e66 6f60 6020   ``block_info`` 
+00005b40: 6465 7363 7269 6265 733a 0a0a 2020 2020  describes:..    
+00005b50: 2d20 6060 7368 6170 6560 603a 2074 6865  - ``shape``: the
+00005b60: 2073 6861 7065 206f 6620 7468 6520 6675   shape of the fu
+00005b70: 6c6c 2044 6173 6b20 6172 7261 792c 0a20  ll Dask array,. 
+00005b80: 2020 202d 2060 606e 756d 2d63 6875 6e6b     - ``num-chunk
+00005b90: 7360 603a 2074 6865 206e 756d 6265 7220  s``: the number 
+00005ba0: 6f66 2063 6875 6e6b 7320 6f66 2074 6865  of chunks of the
+00005bb0: 2066 756c 6c20 6172 7261 7920 696e 2065   full array in e
+00005bc0: 6163 6820 6469 6d65 6e73 696f 6e2c 0a20  ach dimension,. 
+00005bd0: 2020 202d 2060 6063 6875 6e6b 2d6c 6f63     - ``chunk-loc
+00005be0: 6174 696f 6e60 603a 2074 6865 2063 6875  ation``: the chu
+00005bf0: 6e6b 206c 6f63 6174 696f 6e20 2866 6f72  nk location (for
+00005c00: 2065 7861 6d70 6c65 2074 6865 2066 6f75   example the fou
+00005c10: 7274 6820 6368 756e 6b20 6f76 6572 0a20  rth chunk over. 
+00005c20: 2020 2020 2069 6e20 7468 6520 6669 7273       in the firs
+00005c30: 7420 6469 6d65 6e73 696f 6e29 2c20 616e  t dimension), an
+00005c40: 640a 2020 2020 2d20 6060 6172 7261 792d  d.    - ``array-
+00005c50: 6c6f 6361 7469 6f6e 6060 3a20 7468 6520  location``: the 
+00005c60: 6172 7261 7920 6c6f 6361 7469 6f6e 2077  array location w
+00005c70: 6974 6869 6e20 7468 6520 6675 6c6c 2044  ithin the full D
+00005c80: 6173 6b20 6172 7261 790a 2020 2020 2020  ask array.      
+00005c90: 2866 6f72 2065 7861 6d70 6c65 2074 6865  (for example the
+00005ca0: 2073 6c69 6365 2063 6f72 7265 7370 6f6e   slice correspon
+00005cb0: 6469 6e67 2074 6f20 6060 3430 3a35 3060  ding to ``40:50`
+00005cc0: 6029 2e0a 0a20 2020 2049 6e20 6164 6469  `)...    In addi
+00005cd0: 7469 6f6e 2074 6f20 7468 6573 652c 2074  tion to these, t
+00005ce0: 6865 7265 2061 7265 2074 776f 2065 7874  here are two ext
+00005cf0: 7261 2070 6172 616d 6574 6572 7320 6465  ra parameters de
+00005d00: 7363 7269 6265 6420 6279 0a20 2020 2060  scribed by.    `
+00005d10: 6062 6c6f 636b 5f69 6e66 6f60 6020 666f  `block_info`` fo
+00005d20: 7220 7468 6520 6f75 7470 7574 2061 7272  r the output arr
+00005d30: 6179 2028 696e 2060 6062 6c6f 636b 5f69  ay (in ``block_i
+00005d40: 6e66 6f5b 4e6f 6e65 5d60 6029 3a0a 0a20  nfo[None]``):.. 
+00005d50: 2020 202d 2060 6063 6875 6e6b 2d73 6861     - ``chunk-sha
+00005d60: 7065 6060 3a20 7468 6520 6f75 7470 7574  pe``: the output
+00005d70: 2063 6875 6e6b 2073 6861 7065 2c20 616e   chunk shape, an
+00005d80: 640a 2020 2020 2d20 6060 6474 7970 6560  d.    - ``dtype`
+00005d90: 603a 2074 6865 206f 7574 7075 7420 6474  `: the output dt
+00005da0: 7970 652e 0a0a 2020 2020 5468 6573 6520  ype...    These 
+00005db0: 6665 6174 7572 6573 2063 616e 2062 6520  features can be 
+00005dc0: 636f 6d62 696e 6564 2074 6f20 7379 6e74  combined to synt
+00005dd0: 6865 7369 7a65 2061 6e20 6172 7261 7920  hesize an array 
+00005de0: 6672 6f6d 2073 6372 6174 6368 2c20 666f  from scratch, fo
+00005df0: 720a 2020 2020 6578 616d 706c 653a 0a0a  r.    example:..
+00005e00: 2020 2020 3e3e 3e20 6465 6620 6675 6e63      >>> def func
+00005e10: 2862 6c6f 636b 5f69 6e66 6f3d 4e6f 6e65  (block_info=None
+00005e20: 293a 0a20 2020 202e 2e2e 2020 2020 206c  ):.    ...     l
+00005e30: 6f63 203d 2062 6c6f 636b 5f69 6e66 6f5b  oc = block_info[
+00005e40: 4e6f 6e65 5d5b 2761 7272 6179 2d6c 6f63  None]['array-loc
+00005e50: 6174 696f 6e27 5d5b 305d 0a20 2020 202e  ation'][0].    .
+00005e60: 2e2e 2020 2020 2072 6574 7572 6e20 6e70  ..     return np
+00005e70: 2e61 7261 6e67 6528 6c6f 635b 305d 2c20  .arange(loc[0], 
+00005e80: 6c6f 635b 315d 290a 0a20 2020 203e 3e3e  loc[1])..    >>>
+00005e90: 2064 612e 6d61 705f 626c 6f63 6b73 2866   da.map_blocks(f
+00005ea0: 756e 632c 2063 6875 6e6b 733d 2828 342c  unc, chunks=((4,
+00005eb0: 2034 292c 292c 2064 7479 7065 3d6e 702e   4),), dtype=np.
+00005ec0: 666c 6f61 745f 290a 2020 2020 6461 736b  float_).    dask
+00005ed0: 2e61 7272 6179 3c66 756e 632c 2073 6861  .array<func, sha
+00005ee0: 7065 3d28 382c 292c 2064 7479 7065 3d66  pe=(8,), dtype=f
+00005ef0: 6c6f 6174 3634 2c20 6368 756e 6b73 697a  loat64, chunksiz
+00005f00: 653d 2834 2c29 2c20 6368 756e 6b74 7970  e=(4,), chunktyp
+00005f10: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+00005f20: 0a0a 2020 2020 3e3e 3e20 5f2e 636f 6d70  ..    >>> _.comp
+00005f30: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
+00005f40: 5b30 2c20 312c 2032 2c20 332c 2034 2c20  [0, 1, 2, 3, 4, 
+00005f50: 352c 2036 2c20 375d 290a 0a20 2020 2060  5, 6, 7])..    `
+00005f60: 6062 6c6f 636b 5f69 6460 6020 6973 2073  `block_id`` is s
+00005f70: 696d 696c 6172 2074 6f20 6060 626c 6f63  imilar to ``bloc
+00005f80: 6b5f 696e 666f 6060 2062 7574 2063 6f6e  k_info`` but con
+00005f90: 7461 696e 7320 6f6e 6c79 2074 6865 2060  tains only the `
+00005fa0: 6063 6875 6e6b 5f6c 6f63 6174 696f 6e60  `chunk_location`
+00005fb0: 603a 0a0a 2020 2020 3e3e 3e20 6465 6620  `:..    >>> def 
+00005fc0: 6675 6e63 2862 6c6f 636b 5f69 643d 4e6f  func(block_id=No
+00005fd0: 6e65 293a 0a20 2020 202e 2e2e 2020 2020  ne):.    ...    
+00005fe0: 2070 6173 730a 0a20 2020 2054 6869 7320   pass..    This 
+00005ff0: 7769 6c6c 2072 6563 6569 7665 2074 6865  will receive the
+00006000: 2066 6f6c 6c6f 7769 6e67 2069 6e66 6f72   following infor
+00006010: 6d61 7469 6f6e 3a0a 0a20 2020 203e 3e3e  mation:..    >>>
+00006020: 2062 6c6f 636b 5f69 6420 2023 2064 6f63   block_id  # doc
+00006030: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
+00006040: 2834 2c20 3329 0a0a 2020 2020 596f 7520  (4, 3)..    You 
+00006050: 6d61 7920 7370 6563 6966 7920 7468 6520  may specify the 
+00006060: 6b65 7920 6e61 6d65 2070 7265 6669 7820  key name prefix 
+00006070: 6f66 2074 6865 2072 6573 756c 7469 6e67  of the resulting
+00006080: 2074 6173 6b20 696e 2074 6865 2067 7261   task in the gra
+00006090: 7068 2077 6974 680a 2020 2020 7468 6520  ph with.    the 
+000060a0: 6f70 7469 6f6e 616c 2060 6074 6f6b 656e  optional ``token
+000060b0: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
+000060c0: 656e 742e 0a0a 2020 2020 3e3e 3e20 782e  ent...    >>> x.
+000060d0: 6d61 705f 626c 6f63 6b73 286c 616d 6264  map_blocks(lambd
+000060e0: 6120 783a 2078 202b 2031 2c20 6e61 6d65  a x: x + 1, name
+000060f0: 3d27 696e 6372 656d 656e 7427 290a 2020  ='increment').  
+00006100: 2020 6461 736b 2e61 7272 6179 3c69 6e63    dask.array<inc
+00006110: 7265 6d65 6e74 2c20 7368 6170 653d 2831  rement, shape=(1
+00006120: 3030 302c 292c 2064 7479 7065 3d69 6e74  000,), dtype=int
+00006130: 3634 2c20 6368 756e 6b73 697a 653d 2831  64, chunksize=(1
+00006140: 3030 2c29 2c20 6368 756e 6b74 7970 653d  00,), chunktype=
+00006150: 6e75 6d70 792e 6e64 6172 7261 793e 0a0a  numpy.ndarray>..
+00006160: 2020 2020 466f 7220 6675 6e63 7469 6f6e      For function
+00006170: 7320 7468 6174 206d 6179 206e 6f74 2068  s that may not h
+00006180: 616e 646c 6520 302d 6420 6172 7261 7973  andle 0-d arrays
+00006190: 2c20 6974 2773 2061 6c73 6f20 706f 7373  , it's also poss
+000061a0: 6962 6c65 2074 6f20 7370 6563 6966 790a  ible to specify.
+000061b0: 2020 2020 6060 6d65 7461 6060 2077 6974      ``meta`` wit
+000061c0: 6820 616e 2065 6d70 7479 2061 7272 6179  h an empty array
+000061d0: 206d 6174 6368 696e 6720 7468 6520 7479   matching the ty
+000061e0: 7065 206f 6620 7468 6520 6578 7065 6374  pe of the expect
+000061f0: 6564 2072 6573 756c 742e 2049 6e0a 2020  ed result. In.  
+00006200: 2020 7468 6520 6578 616d 706c 6520 6265    the example be
+00006210: 6c6f 772c 2060 6066 756e 6360 6020 7769  low, ``func`` wi
+00006220: 6c6c 2072 6573 756c 7420 696e 2061 6e20  ll result in an 
+00006230: 6060 496e 6465 7845 7272 6f72 6060 2077  ``IndexError`` w
+00006240: 6865 6e20 636f 6d70 7574 696e 670a 2020  hen computing.  
+00006250: 2020 6060 6d65 7461 6060 3a0a 0a20 2020    ``meta``:..   
+00006260: 203e 3e3e 2072 6e67 203d 2064 612e 7261   >>> rng = da.ra
+00006270: 6e64 6f6d 2e64 6566 6175 6c74 5f72 6e67  ndom.default_rng
+00006280: 2829 0a20 2020 203e 3e3e 2064 612e 6d61  ().    >>> da.ma
+00006290: 705f 626c 6f63 6b73 286c 616d 6264 6120  p_blocks(lambda 
+000062a0: 783a 2078 5b32 5d2c 2072 6e67 2e72 616e  x: x[2], rng.ran
+000062b0: 646f 6d28 3529 2c20 6d65 7461 3d6e 702e  dom(5), meta=np.
+000062c0: 6172 7261 7928 2829 2929 0a20 2020 2064  array(())).    d
+000062d0: 6173 6b2e 6172 7261 793c 6c61 6d62 6461  ask.array<lambda
+000062e0: 2c20 7368 6170 653d 2835 2c29 2c20 6474  , shape=(5,), dt
+000062f0: 7970 653d 666c 6f61 7436 342c 2063 6875  ype=float64, chu
+00006300: 6e6b 7369 7a65 3d28 352c 292c 2063 6875  nksize=(5,), chu
+00006310: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
+00006320: 7272 6179 3e0a 0a20 2020 2053 696d 696c  rray>..    Simil
+00006330: 6172 6c79 2c20 6974 2773 2070 6f73 7369  arly, it's possi
+00006340: 626c 6520 746f 2073 7065 6369 6679 2061  ble to specify a
+00006350: 206e 6f6e 2d4e 756d 5079 2061 7272 6179   non-NumPy array
+00006360: 2074 6f20 6060 6d65 7461 6060 2c20 616e   to ``meta``, an
+00006370: 6420 7072 6f76 6964 650a 2020 2020 6120  d provide.    a 
+00006380: 6060 6474 7970 6560 603a 0a0a 2020 2020  ``dtype``:..    
+00006390: 3e3e 3e20 696d 706f 7274 2063 7570 7920  >>> import cupy 
+000063a0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+000063b0: 500a 2020 2020 3e3e 3e20 726e 6720 3d20  P.    >>> rng = 
+000063c0: 6461 2e72 616e 646f 6d2e 6465 6661 756c  da.random.defaul
+000063d0: 745f 726e 6728 6375 7079 2e72 616e 646f  t_rng(cupy.rando
+000063e0: 6d2e 6465 6661 756c 745f 726e 6728 2929  m.default_rng())
+000063f0: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00006400: 4950 0a20 2020 203e 3e3e 2064 7420 3d20  IP.    >>> dt = 
+00006410: 6e70 2e66 6c6f 6174 3332 0a20 2020 203e  np.float32.    >
+00006420: 3e3e 2064 612e 6d61 705f 626c 6f63 6b73  >> da.map_blocks
+00006430: 286c 616d 6264 6120 783a 2078 5b32 5d2c  (lambda x: x[2],
+00006440: 2072 6e67 2e72 616e 646f 6d28 352c 2064   rng.random(5, d
+00006450: 7479 7065 3d64 7429 2c20 6d65 7461 3d63  type=dt), meta=c
+00006460: 7570 792e 6172 7261 7928 2829 2c20 6474  upy.array((), dt
+00006470: 7970 653d 6474 2929 2020 2320 646f 6374  ype=dt))  # doct
+00006480: 6573 743a 202b 534b 4950 0a20 2020 2064  est: +SKIP.    d
+00006490: 6173 6b2e 6172 7261 793c 6c61 6d62 6461  ask.array<lambda
+000064a0: 2c20 7368 6170 653d 2835 2c29 2c20 6474  , shape=(5,), dt
+000064b0: 7970 653d 666c 6f61 7433 322c 2063 6875  ype=float32, chu
+000064c0: 6e6b 7369 7a65 3d28 352c 292c 2063 6875  nksize=(5,), chu
+000064d0: 6e6b 7479 7065 3d63 7570 792e 6e64 6172  nktype=cupy.ndar
+000064e0: 7261 793e 0a20 2020 2022 2222 0a20 2020  ray>.    """.   
+000064f0: 2069 6620 6472 6f70 5f61 7869 7320 6973   if drop_axis is
+00006500: 204e 6f6e 653a 0a20 2020 2020 2020 2064   None:.        d
+00006510: 726f 705f 6178 6973 203d 205b 5d0a 0a20  rop_axis = [].. 
+00006520: 2020 2069 6620 6e6f 7420 6361 6c6c 6162     if not callab
+00006530: 6c65 2866 756e 6329 3a0a 2020 2020 2020  le(func):.      
+00006540: 2020 6d73 6720 3d20 280a 2020 2020 2020    msg = (.      
+00006550: 2020 2020 2020 2246 6972 7374 2061 7267        "First arg
+00006560: 756d 656e 7420 6d75 7374 2062 6520 6361  ument must be ca
+00006570: 6c6c 6162 6c65 2066 756e 6374 696f 6e2c  llable function,
+00006580: 206e 6f74 2025 735c 6e22 0a20 2020 2020   not %s\n".     
+00006590: 2020 2020 2020 2022 5573 6167 653a 2020         "Usage:  
+000065a0: 2064 612e 6d61 705f 626c 6f63 6b73 2866   da.map_blocks(f
+000065b0: 756e 6374 696f 6e2c 2078 295c 6e22 0a20  unction, x)\n". 
+000065c0: 2020 2020 2020 2020 2020 2022 2020 206f             "   o
+000065d0: 723a 2020 2064 612e 6d61 705f 626c 6f63  r:   da.map_bloc
+000065e0: 6b73 2866 756e 6374 696f 6e2c 2078 2c20  ks(function, x, 
+000065f0: 792c 207a 2922 0a20 2020 2020 2020 2029  y, z)".        )
+00006600: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
+00006610: 7970 6545 7272 6f72 286d 7367 2025 2074  ypeError(msg % t
+00006620: 7970 6528 6675 6e63 292e 5f5f 6e61 6d65  ype(func).__name
+00006630: 5f5f 290a 2020 2020 6966 2074 6f6b 656e  __).    if token
+00006640: 3a0a 2020 2020 2020 2020 7761 726e 696e  :.        warnin
+00006650: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+00006660: 2020 2020 2022 5468 6520 6074 6f6b 656e       "The `token
+00006670: 3d60 206b 6579 776f 7264 2074 6f20 606d  =` keyword to `m
+00006680: 6170 5f62 6c6f 636b 7360 2068 6173 2062  ap_blocks` has b
+00006690: 6565 6e20 6d6f 7665 6420 746f 2060 6e61  een moved to `na
+000066a0: 6d65 3d60 2e20 220a 2020 2020 2020 2020  me=`. ".        
+000066b0: 2020 2020 2250 6c65 6173 6520 7573 6520      "Please use 
+000066c0: 606e 616d 653d 6020 696e 7374 6561 6420  `name=` instead 
+000066d0: 6173 2074 6865 2060 746f 6b65 6e3d 6020  as the `token=` 
+000066e0: 6b65 7977 6f72 6420 7769 6c6c 2062 6520  keyword will be 
+000066f0: 7265 6d6f 7665 6420 220a 2020 2020 2020  removed ".      
+00006700: 2020 2020 2020 2269 6e20 6120 6675 7475        "in a futu
+00006710: 7265 2072 656c 6561 7365 2e22 2c0a 2020  re release.",.  
+00006720: 2020 2020 2020 2020 2020 6361 7465 676f            catego
+00006730: 7279 3d46 7574 7572 6557 6172 6e69 6e67  ry=FutureWarning
+00006740: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00006750: 2020 2020 6e61 6d65 203d 2074 6f6b 656e      name = token
+00006760: 0a0a 2020 2020 6e61 6d65 203d 2066 227b  ..    name = f"{
+00006770: 6e61 6d65 206f 7220 6675 6e63 6e61 6d65  name or funcname
+00006780: 2866 756e 6329 7d2d 7b74 6f6b 656e 697a  (func)}-{tokeniz
+00006790: 6528 6675 6e63 2c20 6474 7970 652c 2063  e(func, dtype, c
+000067a0: 6875 6e6b 732c 2064 726f 705f 6178 6973  hunks, drop_axis
+000067b0: 2c20 6e65 775f 6178 6973 2c20 2a61 7267  , new_axis, *arg
+000067c0: 732c 202a 2a6b 7761 7267 7329 7d22 0a20  s, **kwargs)}". 
+000067d0: 2020 206e 6577 5f61 7865 7320 3d20 7b7d     new_axes = {}
+000067e0: 0a0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
+000067f0: 6e63 6528 6472 6f70 5f61 7869 732c 204e  nce(drop_axis, N
+00006800: 756d 6265 7229 3a0a 2020 2020 2020 2020  umber):.        
+00006810: 6472 6f70 5f61 7869 7320 3d20 5b64 726f  drop_axis = [dro
+00006820: 705f 6178 6973 5d0a 2020 2020 6966 2069  p_axis].    if i
+00006830: 7369 6e73 7461 6e63 6528 6e65 775f 6178  sinstance(new_ax
+00006840: 6973 2c20 4e75 6d62 6572 293a 0a20 2020  is, Number):.   
+00006850: 2020 2020 206e 6577 5f61 7869 7320 3d20       new_axis = 
+00006860: 5b6e 6577 5f61 7869 735d 2020 2320 544f  [new_axis]  # TO
+00006870: 444f 3a20 6861 6e64 6c65 206e 6577 5f61  DO: handle new_a
+00006880: 7869 730a 0a20 2020 2061 7272 7320 3d20  xis..    arrs = 
+00006890: 5b61 2066 6f72 2061 2069 6e20 6172 6773  [a for a in args
+000068a0: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
+000068b0: 2c20 4172 7261 7929 5d0a 0a20 2020 2061  , Array)]..    a
+000068c0: 7267 7061 6972 7320 3d20 5b0a 2020 2020  rgpairs = [.    
+000068d0: 2020 2020 2861 2c20 7475 706c 6528 7261      (a, tuple(ra
+000068e0: 6e67 6528 612e 6e64 696d 2929 5b3a 3a2d  nge(a.ndim))[::-
+000068f0: 315d 2920 6966 2069 7369 6e73 7461 6e63  1]) if isinstanc
+00006900: 6528 612c 2041 7272 6179 2920 656c 7365  e(a, Array) else
+00006910: 2028 612c 204e 6f6e 6529 0a20 2020 2020   (a, None).     
+00006920: 2020 2066 6f72 2061 2069 6e20 6172 6773     for a in args
+00006930: 0a20 2020 205d 0a20 2020 2069 6620 6172  .    ].    if ar
+00006940: 7273 3a0a 2020 2020 2020 2020 6f75 745f  rs:.        out_
+00006950: 696e 6420 3d20 7475 706c 6528 7261 6e67  ind = tuple(rang
+00006960: 6528 6d61 7828 612e 6e64 696d 2066 6f72  e(max(a.ndim for
+00006970: 2061 2069 6e20 6172 7273 2929 295b 3a3a   a in arrs)))[::
+00006980: 2d31 5d0a 2020 2020 656c 7365 3a0a 2020  -1].    else:.  
+00006990: 2020 2020 2020 6f75 745f 696e 6420 3d20        out_ind = 
+000069a0: 2829 0a0a 2020 2020 6f72 6967 696e 616c  ()..    original
+000069b0: 5f6b 7761 7267 7320 3d20 6b77 6172 6773  _kwargs = kwargs
+000069c0: 0a0a 2020 2020 6966 2064 7479 7065 2069  ..    if dtype i
+000069d0: 7320 4e6f 6e65 2061 6e64 206d 6574 6120  s None and meta 
+000069e0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000069f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00006a00: 2020 6d65 7461 203d 2063 6f6d 7075 7465    meta = compute
+00006a10: 5f6d 6574 6128 6675 6e63 2c20 6474 7970  _meta(func, dtyp
+00006a20: 652c 202a 6172 6773 2c20 2a2a 6b77 6172  e, *args, **kwar
+00006a30: 6773 290a 2020 2020 2020 2020 6578 6365  gs).        exce
+00006a40: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
+00006a50: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+00006a60: 2020 2020 2020 2020 6474 7970 6520 3d20          dtype = 
+00006a70: 6170 706c 795f 696e 6665 725f 6474 7970  apply_infer_dtyp
+00006a80: 6528 6675 6e63 2c20 6172 6773 2c20 6f72  e(func, args, or
+00006a90: 6967 696e 616c 5f6b 7761 7267 732c 2022  iginal_kwargs, "
+00006aa0: 6d61 705f 626c 6f63 6b73 2229 0a0a 2020  map_blocks")..  
+00006ab0: 2020 6966 2064 726f 705f 6178 6973 3a0a    if drop_axis:.
+00006ac0: 2020 2020 2020 2020 6e64 696d 5f6f 7574          ndim_out
+00006ad0: 203d 206c 656e 286f 7574 5f69 6e64 290a   = len(out_ind).
+00006ae0: 2020 2020 2020 2020 6966 2061 6e79 2869          if any(i
+00006af0: 203c 202d 6e64 696d 5f6f 7574 206f 7220   < -ndim_out or 
+00006b00: 6920 3e3d 206e 6469 6d5f 6f75 7420 666f  i >= ndim_out fo
+00006b10: 7220 6920 696e 2064 726f 705f 6178 6973  r i in drop_axis
+00006b20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00006b30: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00006b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006b50: 2066 2264 726f 705f 6178 6973 206f 7574   f"drop_axis out
+00006b60: 206f 6620 7261 6e67 6520 2864 726f 705f   of range (drop_
+00006b70: 6178 6973 3d7b 6472 6f70 5f61 7869 737d  axis={drop_axis}
+00006b80: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
+00006b90: 2020 2020 6622 6275 7420 6f75 7470 7574      f"but output
+00006ba0: 2069 7320 7b6e 6469 6d5f 6f75 747d 6429   is {ndim_out}d)
+00006bb0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
+00006bc0: 0a20 2020 2020 2020 2064 726f 705f 6178  .        drop_ax
+00006bd0: 6973 203d 205b 6920 2520 6e64 696d 5f6f  is = [i % ndim_o
+00006be0: 7574 2066 6f72 2069 2069 6e20 6472 6f70  ut for i in drop
+00006bf0: 5f61 7869 735d 0a20 2020 2020 2020 206f  _axis].        o
+00006c00: 7574 5f69 6e64 203d 2074 7570 6c65 2878  ut_ind = tuple(x
+00006c10: 2066 6f72 2069 2c20 7820 696e 2065 6e75   for i, x in enu
+00006c20: 6d65 7261 7465 286f 7574 5f69 6e64 2920  merate(out_ind) 
+00006c30: 6966 2069 206e 6f74 2069 6e20 6472 6f70  if i not in drop
+00006c40: 5f61 7869 7329 0a20 2020 2069 6620 6e65  _axis).    if ne
+00006c50: 775f 6178 6973 2069 7320 4e6f 6e65 2061  w_axis is None a
+00006c60: 6e64 2063 6875 6e6b 7320 6973 206e 6f74  nd chunks is not
+00006c70: 204e 6f6e 6520 616e 6420 6c65 6e28 6f75   None and len(ou
+00006c80: 745f 696e 6429 203c 206c 656e 2863 6875  t_ind) < len(chu
+00006c90: 6e6b 7329 3a0a 2020 2020 2020 2020 6e65  nks):.        ne
+00006ca0: 775f 6178 6973 203d 2072 616e 6765 286c  w_axis = range(l
+00006cb0: 656e 2863 6875 6e6b 7329 202d 206c 656e  en(chunks) - len
+00006cc0: 286f 7574 5f69 6e64 2929 0a20 2020 2069  (out_ind)).    i
+00006cd0: 6620 6e65 775f 6178 6973 3a0a 2020 2020  f new_axis:.    
+00006ce0: 2020 2020 2320 6e65 775f 6178 6973 203d      # new_axis =
+00006cf0: 205b 7820 2b20 6c65 6e28 6472 6f70 5f61   [x + len(drop_a
+00006d00: 7869 7329 2066 6f72 2078 2069 6e20 6e65  xis) for x in ne
+00006d10: 775f 6178 6973 5d0a 2020 2020 2020 2020  w_axis].        
+00006d20: 6f75 745f 696e 6420 3d20 6c69 7374 286f  out_ind = list(o
+00006d30: 7574 5f69 6e64 290a 2020 2020 2020 2020  ut_ind).        
+00006d40: 666f 7220 6178 2069 6e20 736f 7274 6564  for ax in sorted
+00006d50: 286e 6577 5f61 7869 7329 3a0a 2020 2020  (new_axis):.    
+00006d60: 2020 2020 2020 2020 6e20 3d20 6c65 6e28          n = len(
+00006d70: 6f75 745f 696e 6429 202b 206c 656e 2864  out_ind) + len(d
+00006d80: 726f 705f 6178 6973 290a 2020 2020 2020  rop_axis).      
+00006d90: 2020 2020 2020 6f75 745f 696e 642e 696e        out_ind.in
+00006da0: 7365 7274 2861 782c 206e 290a 2020 2020  sert(ax, n).    
+00006db0: 2020 2020 2020 2020 6966 2063 6875 6e6b          if chunk
+00006dc0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00006dd0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00006de0: 6577 5f61 7865 735b 6e5d 203d 2063 6875  ew_axes[n] = chu
+00006df0: 6e6b 735b 6178 5d0a 2020 2020 2020 2020  nks[ax].        
+00006e00: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006e10: 2020 2020 2020 2020 2020 6e65 775f 6178            new_ax
+00006e20: 6573 5b6e 5d20 3d20 310a 2020 2020 2020  es[n] = 1.      
+00006e30: 2020 6f75 745f 696e 6420 3d20 7475 706c    out_ind = tupl
+00006e40: 6528 6f75 745f 696e 6429 0a20 2020 2020  e(out_ind).     
+00006e50: 2020 2069 6620 6d61 7828 6e65 775f 6178     if max(new_ax
+00006e60: 6973 2920 3e20 6d61 7828 6f75 745f 696e  is) > max(out_in
+00006e70: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
+00006e80: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00006e90: 2822 4e65 775f 6178 6973 2076 616c 7565  ("New_axis value
+00006ea0: 7320 646f 206e 6f74 2066 696c 6c20 696e  s do not fill in
+00006eb0: 2061 6c6c 2064 696d 656e 7369 6f6e 7322   all dimensions"
+00006ec0: 290a 0a20 2020 2069 6620 6368 756e 6b73  )..    if chunks
+00006ed0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00006ee0: 2020 2020 2020 6966 206c 656e 2863 6875        if len(chu
+00006ef0: 6e6b 7329 2021 3d20 6c65 6e28 6f75 745f  nks) != len(out_
+00006f00: 696e 6429 3a0a 2020 2020 2020 2020 2020  ind):.          
+00006f10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00006f20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00006f30: 2020 2020 6622 5072 6f76 6964 6564 2063      f"Provided c
+00006f40: 6875 6e6b 7320 6861 7665 207b 6c65 6e28  hunks have {len(
+00006f50: 6368 756e 6b73 297d 2064 696d 733b 2065  chunks)} dims; e
+00006f60: 7870 6563 7465 6420 7b6c 656e 286f 7574  xpected {len(out
+00006f70: 5f69 6e64 297d 2064 696d 7322 0a20 2020  _ind)} dims".   
+00006f80: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00006f90: 2020 2061 646a 7573 745f 6368 756e 6b73     adjust_chunks
+00006fa0: 203d 2064 6963 7428 7a69 7028 6f75 745f   = dict(zip(out_
+00006fb0: 696e 642c 2063 6875 6e6b 7329 290a 2020  ind, chunks)).  
+00006fc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00006fd0: 6164 6a75 7374 5f63 6875 6e6b 7320 3d20  adjust_chunks = 
+00006fe0: 4e6f 6e65 0a0a 2020 2020 6966 2065 6e66  None..    if enf
+00006ff0: 6f72 6365 5f6e 6469 6d3a 0a20 2020 2020  orce_ndim:.     
+00007000: 2020 206f 7574 203d 2062 6c6f 636b 7769     out = blockwi
+00007010: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
+00007020: 6170 706c 795f 616e 645f 656e 666f 7263  apply_and_enforc
+00007030: 652c 0a20 2020 2020 2020 2020 2020 206f  e,.            o
+00007040: 7574 5f69 6e64 2c0a 2020 2020 2020 2020  ut_ind,.        
+00007050: 2020 2020 2a63 6f6e 6361 7428 6172 6770      *concat(argp
+00007060: 6169 7273 292c 0a20 2020 2020 2020 2020  airs),.         
+00007070: 2020 2065 7870 6563 7465 645f 6e64 696d     expected_ndim
+00007080: 3d6c 656e 286f 7574 5f69 6e64 292c 0a20  =len(out_ind),. 
+00007090: 2020 2020 2020 2020 2020 205f 6675 6e63             _func
+000070a0: 3d66 756e 632c 0a20 2020 2020 2020 2020  =func,.         
+000070b0: 2020 206e 616d 653d 6e61 6d65 2c0a 2020     name=name,.  
+000070c0: 2020 2020 2020 2020 2020 6e65 775f 6178            new_ax
+000070d0: 6573 3d6e 6577 5f61 7865 732c 0a20 2020  es=new_axes,.   
+000070e0: 2020 2020 2020 2020 2064 7479 7065 3d64           dtype=d
+000070f0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+00007100: 2020 636f 6e63 6174 656e 6174 653d 5472    concatenate=Tr
+00007110: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00007120: 616c 6967 6e5f 6172 7261 7973 3d46 616c  align_arrays=Fal
+00007130: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00007140: 6164 6a75 7374 5f63 6875 6e6b 733d 6164  adjust_chunks=ad
+00007150: 6a75 7374 5f63 6875 6e6b 732c 0a20 2020  just_chunks,.   
+00007160: 2020 2020 2020 2020 206d 6574 613d 6d65           meta=me
+00007170: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
+00007180: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
+00007190: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
+000071a0: 2020 2020 2020 6f75 7420 3d20 626c 6f63        out = bloc
+000071b0: 6b77 6973 6528 0a20 2020 2020 2020 2020  kwise(.         
+000071c0: 2020 2066 756e 632c 0a20 2020 2020 2020     func,.       
+000071d0: 2020 2020 206f 7574 5f69 6e64 2c0a 2020       out_ind,.  
+000071e0: 2020 2020 2020 2020 2020 2a63 6f6e 6361            *conca
+000071f0: 7428 6172 6770 6169 7273 292c 0a20 2020  t(argpairs),.   
+00007200: 2020 2020 2020 2020 206e 616d 653d 6e61           name=na
+00007210: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00007220: 6e65 775f 6178 6573 3d6e 6577 5f61 7865  new_axes=new_axe
+00007230: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
+00007240: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
+00007250: 2020 2020 2020 2020 636f 6e63 6174 656e          concaten
+00007260: 6174 653d 5472 7565 2c0a 2020 2020 2020  ate=True,.      
+00007270: 2020 2020 2020 616c 6967 6e5f 6172 7261        align_arra
+00007280: 7973 3d46 616c 7365 2c0a 2020 2020 2020  ys=False,.      
+00007290: 2020 2020 2020 6164 6a75 7374 5f63 6875        adjust_chu
+000072a0: 6e6b 733d 6164 6a75 7374 5f63 6875 6e6b  nks=adjust_chunk
+000072b0: 732c 0a20 2020 2020 2020 2020 2020 206d  s,.            m
+000072c0: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
+000072d0: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
+000072e0: 2020 2020 2020 2020 290a 0a20 2020 2065          )..    e
+000072f0: 7874 7261 5f61 7267 7061 6972 7320 3d20  xtra_argpairs = 
+00007300: 5b5d 0a20 2020 2065 7874 7261 5f6e 616d  [].    extra_nam
+00007310: 6573 203d 205b 5d0a 2020 2020 2320 4966  es = [].    # If
+00007320: 2066 756e 6320 6861 7320 626c 6f63 6b5f   func has block_
+00007330: 6964 2061 7320 616e 2061 7267 756d 656e  id as an argumen
+00007340: 742c 2063 6f6e 7374 7275 6374 2061 6e20  t, construct an 
+00007350: 6172 7261 7920 6f66 2062 6c6f 636b 2049  array of block I
+00007360: 4473 2061 6e64 0a20 2020 2023 2070 7265  Ds and.    # pre
+00007370: 7061 7265 2074 6f20 696e 6a65 6374 2069  pare to inject i
+00007380: 742e 0a20 2020 2069 6620 6861 735f 6b65  t..    if has_ke
+00007390: 7977 6f72 6428 6675 6e63 2c20 2262 6c6f  yword(func, "blo
+000073a0: 636b 5f69 6422 293a 0a20 2020 2020 2020  ck_id"):.       
+000073b0: 2062 6c6f 636b 5f69 645f 6e61 6d65 203d   block_id_name =
+000073c0: 2022 626c 6f63 6b2d 6964 2d22 202b 206f   "block-id-" + o
+000073d0: 7574 2e6e 616d 650a 2020 2020 2020 2020  ut.name.        
+000073e0: 626c 6f63 6b5f 6964 5f64 736b 203d 207b  block_id_dsk = {
+000073f0: 0a20 2020 2020 2020 2020 2020 2028 626c  .            (bl
+00007400: 6f63 6b5f 6964 5f6e 616d 652c 2920 2b20  ock_id_name,) + 
+00007410: 626c 6f63 6b5f 6964 3a20 626c 6f63 6b5f  block_id: block_
+00007420: 6964 0a20 2020 2020 2020 2020 2020 2066  id.            f
+00007430: 6f72 2062 6c6f 636b 5f69 6420 696e 2070  or block_id in p
+00007440: 726f 6475 6374 282a 2872 616e 6765 286c  roduct(*(range(l
+00007450: 656e 2863 2929 2066 6f72 2063 2069 6e20  en(c)) for c in 
+00007460: 6f75 742e 6368 756e 6b73 2929 0a20 2020  out.chunks)).   
+00007470: 2020 2020 207d 0a20 2020 2020 2020 2062       }.        b
+00007480: 6c6f 636b 5f69 645f 6172 7261 7920 3d20  lock_id_array = 
+00007490: 4172 7261 7928 0a20 2020 2020 2020 2020  Array(.         
+000074a0: 2020 2062 6c6f 636b 5f69 645f 6473 6b2c     block_id_dsk,
+000074b0: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
+000074c0: 636b 5f69 645f 6e61 6d65 2c0a 2020 2020  ck_id_name,.    
+000074d0: 2020 2020 2020 2020 6368 756e 6b73 3d74          chunks=t
+000074e0: 7570 6c65 2828 312c 2920 2a20 6c65 6e28  uple((1,) * len(
+000074f0: 6329 2066 6f72 2063 2069 6e20 6f75 742e  c) for c in out.
+00007500: 6368 756e 6b73 292c 0a20 2020 2020 2020  chunks),.       
+00007510: 2020 2020 2064 7479 7065 3d6e 702e 6f62       dtype=np.ob
+00007520: 6a65 6374 5f2c 0a20 2020 2020 2020 2029  ject_,.        )
+00007530: 0a20 2020 2020 2020 2065 7874 7261 5f61  .        extra_a
+00007540: 7267 7061 6972 732e 6170 7065 6e64 2828  rgpairs.append((
+00007550: 626c 6f63 6b5f 6964 5f61 7272 6179 2c20  block_id_array, 
+00007560: 6f75 745f 696e 6429 290a 2020 2020 2020  out_ind)).      
+00007570: 2020 6578 7472 615f 6e61 6d65 732e 6170    extra_names.ap
+00007580: 7065 6e64 2822 626c 6f63 6b5f 6964 2229  pend("block_id")
+00007590: 0a0a 2020 2020 2320 4966 2066 756e 6320  ..    # If func 
+000075a0: 6861 7320 626c 6f63 6b5f 696e 666f 2061  has block_info a
+000075b0: 7320 616e 2061 7267 756d 656e 742c 2063  s an argument, c
+000075c0: 6f6e 7374 7275 6374 2061 6e20 6172 7261  onstruct an arra
+000075d0: 7920 6f66 2062 6c6f 636b 2069 6e66 6f0a  y of block info.
+000075e0: 2020 2020 2320 6f62 6a65 6374 7320 616e      # objects an
+000075f0: 6420 7072 6570 6172 6520 746f 2069 6e6a  d prepare to inj
+00007600: 6563 7420 6974 2e0a 2020 2020 6966 2068  ect it..    if h
+00007610: 6173 5f6b 6579 776f 7264 2866 756e 632c  as_keyword(func,
+00007620: 2022 626c 6f63 6b5f 696e 666f 2229 3a0a   "block_info"):.
+00007630: 2020 2020 2020 2020 7374 6172 7473 203d          starts =
+00007640: 207b 7d0a 2020 2020 2020 2020 6e75 6d5f   {}.        num_
+00007650: 6368 756e 6b73 203d 207b 7d0a 2020 2020  chunks = {}.    
+00007660: 2020 2020 7368 6170 6573 203d 207b 7d0a      shapes = {}.
+00007670: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+00007680: 2861 7267 2c20 696e 5f69 6e64 2920 696e  (arg, in_ind) in
+00007690: 2065 6e75 6d65 7261 7465 2861 7267 7061   enumerate(argpa
+000076a0: 6972 7329 3a0a 2020 2020 2020 2020 2020  irs):.          
+000076b0: 2020 6966 2069 6e5f 696e 6420 6973 206e    if in_ind is n
+000076c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+000076d0: 2020 2020 2020 2020 2073 6861 7065 735b           shapes[
+000076e0: 695d 203d 2061 7267 2e73 6861 7065 0a20  i] = arg.shape. 
+000076f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00007700: 6620 6472 6f70 5f61 7869 733a 0a20 2020  f drop_axis:.   
+00007710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007720: 2023 2057 6520 636f 6e63 6174 656e 6174   # We concatenat
+00007730: 6520 616c 6f6e 6720 6472 6f70 7065 6420  e along dropped 
+00007740: 6178 6573 2c20 736f 2077 6520 6e65 6564  axes, so we need
+00007750: 2074 6f20 7472 6561 7420 7468 656d 0a20   to treat them. 
+00007760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007770: 2020 2023 2061 7320 6966 2074 6865 7265     # as if there
+00007780: 2069 7320 6f6e 6c79 2061 2073 696e 676c   is only a singl
+00007790: 6520 6368 756e 6b2e 0a20 2020 2020 2020  e chunk..       
+000077a0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+000077b0: 7274 735b 695d 203d 205b 0a20 2020 2020  rts[i] = [.     
+000077c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077d0: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
+000077e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077f0: 2063 6163 6865 645f 6375 6d73 756d 2861   cached_cumsum(a
+00007800: 7267 2e63 6875 6e6b 735b 6a5d 2c20 696e  rg.chunks[j], in
+00007810: 6974 6961 6c5f 7a65 726f 3d54 7275 6529  itial_zero=True)
+00007820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007830: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00007840: 696e 6420 696e 206f 7574 5f69 6e64 0a20  ind in out_ind. 
+00007850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007860: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00007870: 5b30 2c20 6172 672e 7368 6170 655b 6a5d  [0, arg.shape[j]
+00007880: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00007890: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000078a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078b0: 2020 2020 666f 7220 6a2c 2069 6e64 2069      for j, ind i
+000078c0: 6e20 656e 756d 6572 6174 6528 696e 5f69  n enumerate(in_i
+000078d0: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
+000078e0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+000078f0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+00007900: 6d5f 6368 756e 6b73 5b69 5d20 3d20 7475  m_chunks[i] = tu
+00007910: 706c 6528 6c65 6e28 7329 202d 2031 2066  ple(len(s) - 1 f
+00007920: 6f72 2073 2069 6e20 7374 6172 7473 5b69  or s in starts[i
+00007930: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00007940: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00007950: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00007960: 7274 735b 695d 203d 205b 0a20 2020 2020  rts[i] = [.     
+00007970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007980: 2020 2063 6163 6865 645f 6375 6d73 756d     cached_cumsum
+00007990: 2863 2c20 696e 6974 6961 6c5f 7a65 726f  (c, initial_zero
+000079a0: 3d54 7275 6529 2066 6f72 2063 2069 6e20  =True) for c in 
+000079b0: 6172 672e 6368 756e 6b73 0a20 2020 2020  arg.chunks.     
+000079c0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+000079d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000079e0: 2020 2020 206e 756d 5f63 6875 6e6b 735b       num_chunks[
+000079f0: 695d 203d 2061 7267 2e6e 756d 626c 6f63  i] = arg.numbloc
+00007a00: 6b73 0a20 2020 2020 2020 206f 7574 5f73  ks.        out_s
+00007a10: 7461 7274 7320 3d20 5b63 6163 6865 645f  tarts = [cached_
+00007a20: 6375 6d73 756d 2863 2c20 696e 6974 6961  cumsum(c, initia
+00007a30: 6c5f 7a65 726f 3d54 7275 6529 2066 6f72  l_zero=True) for
+00007a40: 2063 2069 6e20 6f75 742e 6368 756e 6b73   c in out.chunks
+00007a50: 5d0a 0a20 2020 2020 2020 2062 6c6f 636b  ]..        block
+00007a60: 5f69 6e66 6f5f 6e61 6d65 203d 2022 626c  _info_name = "bl
+00007a70: 6f63 6b2d 696e 666f 2d22 202b 206f 7574  ock-info-" + out
+00007a80: 2e6e 616d 650a 2020 2020 2020 2020 626c  .name.        bl
+00007a90: 6f63 6b5f 696e 666f 5f64 736b 203d 207b  ock_info_dsk = {
+00007aa0: 7d0a 2020 2020 2020 2020 666f 7220 626c  }.        for bl
+00007ab0: 6f63 6b5f 6964 2069 6e20 7072 6f64 7563  ock_id in produc
+00007ac0: 7428 2a28 7261 6e67 6528 6c65 6e28 6329  t(*(range(len(c)
+00007ad0: 2920 666f 7220 6320 696e 206f 7574 2e63  ) for c in out.c
+00007ae0: 6875 6e6b 7329 293a 0a20 2020 2020 2020  hunks)):.       
+00007af0: 2020 2020 2023 2047 6574 2070 6f73 6974       # Get posit
+00007b00: 696f 6e20 6f66 2063 6875 6e6b 2c20 696e  ion of chunk, in
+00007b10: 6465 7865 6420 6279 2061 7869 7320 6c61  dexed by axis la
+00007b20: 6265 6c73 0a20 2020 2020 2020 2020 2020  bels.           
+00007b30: 206c 6f63 6174 696f 6e20 3d20 7b6f 7574   location = {out
+00007b40: 5f69 6e64 5b69 5d3a 206c 6f63 2066 6f72  _ind[i]: loc for
+00007b50: 2069 2c20 6c6f 6320 696e 2065 6e75 6d65   i, loc in enume
+00007b60: 7261 7465 2862 6c6f 636b 5f69 6429 7d0a  rate(block_id)}.
+00007b70: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00007b80: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+00007b90: 2020 666f 7220 692c 2073 6861 7065 2069    for i, shape i
+00007ba0: 6e20 7368 6170 6573 2e69 7465 6d73 2829  n shapes.items()
+00007bb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007bc0: 2020 2320 436f 6d70 7574 6520 6368 756e    # Compute chun
+00007bd0: 6b20 6b65 7920 696e 2074 6865 2061 7272  k key in the arr
+00007be0: 6179 2c20 7461 6b69 6e67 2062 726f 6164  ay, taking broad
+00007bf0: 6361 7374 696e 6720 696e 746f 0a20 2020  casting into.   
+00007c00: 2020 2020 2020 2020 2020 2020 2023 2061               # a
+00007c10: 6363 6f75 6e74 2e20 5765 2064 6f6e 2774  ccount. We don't
+00007c20: 2064 6972 6563 746c 7920 6b6e 6f77 2077   directly know w
+00007c30: 6869 6368 2064 696d 656e 7369 6f6e 7320  hich dimensions 
+00007c40: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+00007c50: 2020 2020 2320 6272 6f61 6463 6173 742c      # broadcast,
+00007c60: 2062 7574 2061 6e79 2064 696d 656e 7369   but any dimensi
+00007c70: 6f6e 2077 6974 6820 6f6e 6c79 206f 6e65  on with only one
+00007c80: 2063 6875 6e6b 2063 616e 2062 650a 2020   chunk can be.  
+00007c90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00007ca0: 7472 6561 7465 6420 6173 2062 726f 6164  treated as broad
+00007cb0: 6361 7374 2e0a 2020 2020 2020 2020 2020  cast..          
+00007cc0: 2020 2020 2020 6172 725f 6b20 3d20 7475        arr_k = tu
+00007cd0: 706c 6528 0a20 2020 2020 2020 2020 2020  ple(.           
+00007ce0: 2020 2020 2020 2020 206c 6f63 6174 696f           locatio
+00007cf0: 6e2e 6765 7428 696e 642c 2030 2920 6966  n.get(ind, 0) if
+00007d00: 206e 756d 5f63 6875 6e6b 735b 695d 5b6a   num_chunks[i][j
+00007d10: 5d20 3e20 3120 656c 7365 2030 0a20 2020  ] > 1 else 0.   
+00007d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d30: 2066 6f72 206a 2c20 696e 6420 696e 2065   for j, ind in e
+00007d40: 6e75 6d65 7261 7465 2861 7267 7061 6972  numerate(argpair
+00007d50: 735b 695d 5b31 5d29 0a20 2020 2020 2020  s[i][1]).       
+00007d60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00007d70: 2020 2020 2020 2020 2020 2069 6e66 6f5b             info[
+00007d80: 695d 203d 207b 0a20 2020 2020 2020 2020  i] = {.         
+00007d90: 2020 2020 2020 2020 2020 2022 7368 6170             "shap
+00007da0: 6522 3a20 7368 6170 652c 0a20 2020 2020  e": shape,.     
+00007db0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00007dc0: 6e75 6d2d 6368 756e 6b73 223a 206e 756d  num-chunks": num
+00007dd0: 5f63 6875 6e6b 735b 695d 2c0a 2020 2020  _chunks[i],.    
 00007de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007df0: 2273 6861 7065 223a 2073 6861 7065 2c0a  "shape": shape,.
-00007e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e10: 2020 2020 226e 756d 2d63 6875 6e6b 7322      "num-chunks"
-00007e20: 3a20 6e75 6d5f 6368 756e 6b73 5b69 5d2c  : num_chunks[i],
-00007e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007e40: 2020 2020 2022 6172 7261 792d 6c6f 6361       "array-loca
-00007e50: 7469 6f6e 223a 205b 0a20 2020 2020 2020  tion": [.       
-00007e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e70: 2028 7374 6172 7473 5b69 5d5b 696a 5d5b   (starts[i][ij][
-00007e80: 6a5d 2c20 7374 6172 7473 5b69 5d5b 696a  j], starts[i][ij
-00007e90: 5d5b 6a20 2b20 315d 290a 2020 2020 2020  ][j + 1]).      
-00007ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007eb0: 2020 666f 7220 696a 2c20 6a20 696e 2065    for ij, j in e
-00007ec0: 6e75 6d65 7261 7465 2861 7272 5f6b 290a  numerate(arr_k).
-00007ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ee0: 2020 2020 5d2c 0a20 2020 2020 2020 2020      ],.         
-00007ef0: 2020 2020 2020 2020 2020 2022 6368 756e             "chun
-00007f00: 6b2d 6c6f 6361 7469 6f6e 223a 2061 7272  k-location": arr
-00007f10: 5f6b 2c0a 2020 2020 2020 2020 2020 2020  _k,.            
-00007f20: 2020 2020 7d0a 0a20 2020 2020 2020 2020      }..         
-00007f30: 2020 2069 6e66 6f5b 4e6f 6e65 5d20 3d20     info[None] = 
-00007f40: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00007f50: 2020 2273 6861 7065 223a 206f 7574 2e73    "shape": out.s
-00007f60: 6861 7065 2c0a 2020 2020 2020 2020 2020  hape,.          
-00007f70: 2020 2020 2020 226e 756d 2d63 6875 6e6b        "num-chunk
-00007f80: 7322 3a20 6f75 742e 6e75 6d62 6c6f 636b  s": out.numblock
-00007f90: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00007fa0: 2020 2022 6172 7261 792d 6c6f 6361 7469     "array-locati
-00007fb0: 6f6e 223a 205b 0a20 2020 2020 2020 2020  on": [.         
-00007fc0: 2020 2020 2020 2020 2020 2028 6f75 745f             (out_
-00007fd0: 7374 6172 7473 5b69 6a5d 5b6a 5d2c 206f  starts[ij][j], o
-00007fe0: 7574 5f73 7461 7274 735b 696a 5d5b 6a20  ut_starts[ij][j 
-00007ff0: 2b20 315d 290a 2020 2020 2020 2020 2020  + 1]).          
-00008000: 2020 2020 2020 2020 2020 666f 7220 696a            for ij
-00008010: 2c20 6a20 696e 2065 6e75 6d65 7261 7465  , j in enumerate
-00008020: 2862 6c6f 636b 5f69 6429 0a20 2020 2020  (block_id).     
-00008030: 2020 2020 2020 2020 2020 205d 2c0a 2020             ],.  
-00008040: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-00008050: 6875 6e6b 2d6c 6f63 6174 696f 6e22 3a20  hunk-location": 
-00008060: 626c 6f63 6b5f 6964 2c0a 2020 2020 2020  block_id,.      
-00008070: 2020 2020 2020 2020 2020 2263 6875 6e6b            "chunk
-00008080: 2d73 6861 7065 223a 2074 7570 6c65 280a  -shape": tuple(.
-00008090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000080a0: 2020 2020 6f75 742e 6368 756e 6b73 5b69      out.chunks[i
-000080b0: 6a5d 5b6a 5d20 666f 7220 696a 2c20 6a20  j][j] for ij, j 
-000080c0: 696e 2065 6e75 6d65 7261 7465 2862 6c6f  in enumerate(blo
-000080d0: 636b 5f69 6429 0a20 2020 2020 2020 2020  ck_id).         
-000080e0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-000080f0: 2020 2020 2020 2020 2020 2264 7479 7065            "dtype
-00008100: 223a 2064 7479 7065 2c0a 2020 2020 2020  ": dtype,.      
-00008110: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00008120: 2020 2020 626c 6f63 6b5f 696e 666f 5f64      block_info_d
-00008130: 736b 5b28 626c 6f63 6b5f 696e 666f 5f6e  sk[(block_info_n
-00008140: 616d 652c 2920 2b20 626c 6f63 6b5f 6964  ame,) + block_id
-00008150: 5d20 3d20 696e 666f 0a0a 2020 2020 2020  ] = info..      
-00008160: 2020 626c 6f63 6b5f 696e 666f 203d 2041    block_info = A
-00008170: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
-00008180: 2020 626c 6f63 6b5f 696e 666f 5f64 736b    block_info_dsk
-00008190: 2c0a 2020 2020 2020 2020 2020 2020 626c  ,.            bl
-000081a0: 6f63 6b5f 696e 666f 5f6e 616d 652c 0a20  ock_info_name,. 
-000081b0: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-000081c0: 733d 7475 706c 6528 2831 2c29 202a 206c  s=tuple((1,) * l
-000081d0: 656e 2863 2920 666f 7220 6320 696e 206f  en(c) for c in o
-000081e0: 7574 2e63 6875 6e6b 7329 2c0a 2020 2020  ut.chunks),.    
-000081f0: 2020 2020 2020 2020 6474 7970 653d 6e70          dtype=np
-00008200: 2e6f 626a 6563 745f 2c0a 2020 2020 2020  .object_,.      
-00008210: 2020 290a 2020 2020 2020 2020 6578 7472    ).        extr
-00008220: 615f 6172 6770 6169 7273 2e61 7070 656e  a_argpairs.appen
-00008230: 6428 2862 6c6f 636b 5f69 6e66 6f2c 206f  d((block_info, o
-00008240: 7574 5f69 6e64 2929 0a20 2020 2020 2020  ut_ind)).       
-00008250: 2065 7874 7261 5f6e 616d 6573 2e61 7070   extra_names.app
-00008260: 656e 6428 2262 6c6f 636b 5f69 6e66 6f22  end("block_info"
-00008270: 290a 0a20 2020 2069 6620 6578 7472 615f  )..    if extra_
-00008280: 6172 6770 6169 7273 3a0a 2020 2020 2020  argpairs:.      
-00008290: 2020 2320 5265 7772 6974 6520 7468 6520    # Rewrite the 
-000082a0: 426c 6f63 6b77 6973 6520 6c61 7965 722e  Blockwise layer.
-000082b0: 2049 7420 776f 756c 6420 6265 206e 6963   It would be nic
-000082c0: 6520 746f 2066 696e 6420 6120 7761 7920  e to find a way 
-000082d0: 746f 0a20 2020 2020 2020 2023 2061 766f  to.        # avo
-000082e0: 6964 2064 6f69 6e67 2069 7420 7477 6963  id doing it twic
-000082f0: 652c 2062 7574 2069 7427 7320 6375 7272  e, but it's curr
-00008300: 656e 746c 7920 6e65 6564 6564 2074 6f20  ently needed to 
-00008310: 6465 7465 726d 696e 650a 2020 2020 2020  determine.      
-00008320: 2020 2320 6f75 742e 6368 756e 6b73 2066    # out.chunks f
-00008330: 726f 6d20 7468 6520 6669 7273 7420 7061  rom the first pa
-00008340: 7373 2e20 5369 6e63 6520 6974 2063 6f6e  ss. Since it con
-00008350: 7374 7275 6374 7320 6120 426c 6f63 6b77  structs a Blockw
-00008360: 6973 650a 2020 2020 2020 2020 2320 7261  ise.        # ra
-00008370: 7468 6572 2074 6861 6e20 616e 2065 7870  ther than an exp
-00008380: 616e 6465 6420 6772 6170 682c 2069 7420  anded graph, it 
-00008390: 7368 6f75 6c64 6e27 7420 6265 2074 6f6f  shouldn't be too
-000083a0: 2065 7870 656e 7369 7665 2e0a 2020 2020   expensive..    
-000083b0: 2020 2020 6f75 7420 3d20 626c 6f63 6b77      out = blockw
-000083c0: 6973 6528 0a20 2020 2020 2020 2020 2020  ise(.           
-000083d0: 205f 7061 7373 5f65 7874 7261 5f6b 7761   _pass_extra_kwa
-000083e0: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-000083f0: 206f 7574 5f69 6e64 2c0a 2020 2020 2020   out_ind,.      
-00008400: 2020 2020 2020 6675 6e63 2c0a 2020 2020        func,.    
-00008410: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
-00008420: 2020 2020 2020 2020 2020 7475 706c 6528            tuple(
-00008430: 6578 7472 615f 6e61 6d65 7329 2c0a 2020  extra_names),.  
-00008440: 2020 2020 2020 2020 2020 4e6f 6e65 2c0a            None,.
-00008450: 2020 2020 2020 2020 2020 2020 2a63 6f6e              *con
-00008460: 6361 7428 6578 7472 615f 6172 6770 6169  cat(extra_argpai
-00008470: 7273 292c 0a20 2020 2020 2020 2020 2020  rs),.           
-00008480: 202a 636f 6e63 6174 2861 7267 7061 6972   *concat(argpair
-00008490: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-000084a0: 6e61 6d65 3d6f 7574 2e6e 616d 652c 0a20  name=out.name,. 
-000084b0: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-000084c0: 3d6f 7574 2e64 7479 7065 2c0a 2020 2020  =out.dtype,.    
-000084d0: 2020 2020 2020 2020 636f 6e63 6174 656e          concaten
-000084e0: 6174 653d 5472 7565 2c0a 2020 2020 2020  ate=True,.      
-000084f0: 2020 2020 2020 616c 6967 6e5f 6172 7261        align_arra
-00008500: 7973 3d46 616c 7365 2c0a 2020 2020 2020  ys=False,.      
-00008510: 2020 2020 2020 6164 6a75 7374 5f63 6875        adjust_chu
-00008520: 6e6b 733d 6469 6374 287a 6970 286f 7574  nks=dict(zip(out
-00008530: 5f69 6e64 2c20 6f75 742e 6368 756e 6b73  _ind, out.chunks
-00008540: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-00008550: 6d65 7461 3d6d 6574 612c 0a20 2020 2020  meta=meta,.     
-00008560: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00008570: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00008580: 7265 7475 726e 206f 7574 0a0a 0a64 6566  return out...def
-00008590: 2061 7070 6c79 5f61 6e64 5f65 6e66 6f72   apply_and_enfor
-000085a0: 6365 282a 6172 6773 2c20 2a2a 6b77 6172  ce(*args, **kwar
-000085b0: 6773 293a 0a20 2020 2022 2222 4170 706c  gs):.    """Appl
-000085c0: 7920 6120 6675 6e63 7469 6f6e 2c20 616e  y a function, an
-000085d0: 6420 656e 666f 7263 6520 7468 6520 6f75  d enforce the ou
-000085e0: 7470 7574 2e6e 6469 6d20 746f 206d 6174  tput.ndim to mat
-000085f0: 6368 2065 7870 6563 7465 645f 6e64 696d  ch expected_ndim
-00008600: 0a0a 2020 2020 456e 7375 7265 7320 7468  ..    Ensures th
-00008610: 6520 6f75 7470 7574 2068 6173 2074 6865  e output has the
-00008620: 2065 7870 6563 7465 6420 6469 6d65 6e73   expected dimens
-00008630: 696f 6e61 6c69 7479 2e22 2222 0a20 2020  ionality.""".   
-00008640: 2066 756e 6320 3d20 6b77 6172 6773 2e70   func = kwargs.p
-00008650: 6f70 2822 5f66 756e 6322 290a 2020 2020  op("_func").    
-00008660: 6578 7065 6374 6564 5f6e 6469 6d20 3d20  expected_ndim = 
-00008670: 6b77 6172 6773 2e70 6f70 2822 6578 7065  kwargs.pop("expe
-00008680: 6374 6564 5f6e 6469 6d22 290a 2020 2020  cted_ndim").    
-00008690: 6f75 7420 3d20 6675 6e63 282a 6172 6773  out = func(*args
-000086a0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-000086b0: 6966 2067 6574 6174 7472 286f 7574 2c20  if getattr(out, 
-000086c0: 226e 6469 6d22 2c20 3029 2021 3d20 6578  "ndim", 0) != ex
-000086d0: 7065 6374 6564 5f6e 6469 6d3a 0a20 2020  pected_ndim:.   
-000086e0: 2020 2020 206f 7574 5f6e 6469 6d20 3d20       out_ndim = 
-000086f0: 6765 7461 7474 7228 6f75 742c 2022 6e64  getattr(out, "nd
-00008700: 696d 222c 2030 290a 2020 2020 2020 2020  im", 0).        
-00008710: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00008720: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
-00008730: 4469 6d65 6e73 696f 6e20 6d69 736d 6174  Dimension mismat
-00008740: 6368 3a20 6578 7065 6374 6564 206f 7574  ch: expected out
-00008750: 7075 7420 6f66 207b 6675 6e63 7d20 220a  put of {func} ".
-00008760: 2020 2020 2020 2020 2020 2020 6622 746f              f"to
-00008770: 2068 6176 6520 6469 6d73 203d 207b 6578   have dims = {ex
-00008780: 7065 6374 6564 5f6e 6469 6d7d 2e20 2047  pected_ndim}.  G
-00008790: 6f74 207b 6f75 745f 6e64 696d 7d20 696e  ot {out_ndim} in
-000087a0: 7374 6561 642e 220a 2020 2020 2020 2020  stead.".        
-000087b0: 290a 2020 2020 7265 7475 726e 206f 7574  ).    return out
-000087c0: 0a0a 0a64 6566 2062 726f 6164 6361 7374  ...def broadcast
-000087d0: 5f63 6875 6e6b 7328 2a63 6875 6e6b 7373  _chunks(*chunkss
-000087e0: 293a 0a20 2020 2022 2222 436f 6e73 7472  ):.    """Constr
-000087f0: 7563 7420 6120 6368 756e 6b73 2074 7570  uct a chunks tup
-00008800: 6c65 2074 6861 7420 6272 6f61 6463 6173  le that broadcas
-00008810: 7473 206d 616e 7920 6368 756e 6b73 2074  ts many chunks t
-00008820: 7570 6c65 730a 0a20 2020 203e 3e3e 2061  uples..    >>> a
-00008830: 203d 2028 2835 2c20 3529 2c29 0a20 2020   = ((5, 5),).   
-00008840: 203e 3e3e 2062 203d 2028 2835 2c20 3529   >>> b = ((5, 5)
-00008850: 2c29 0a20 2020 203e 3e3e 2062 726f 6164  ,).    >>> broad
-00008860: 6361 7374 5f63 6875 6e6b 7328 612c 2062  cast_chunks(a, b
-00008870: 290a 2020 2020 2828 352c 2035 292c 290a  ).    ((5, 5),).
-00008880: 0a20 2020 203e 3e3e 2061 203d 2028 2831  .    >>> a = ((1
-00008890: 302c 2031 302c 2031 3029 2c20 2835 2c20  0, 10, 10), (5, 
-000088a0: 3529 2c29 0a20 2020 203e 3e3e 2062 203d  5),).    >>> b =
-000088b0: 2028 2835 2c20 3529 2c29 0a20 2020 203e   ((5, 5),).    >
-000088c0: 3e3e 2062 726f 6164 6361 7374 5f63 6875  >> broadcast_chu
-000088d0: 6e6b 7328 612c 2062 290a 2020 2020 2828  nks(a, b).    ((
-000088e0: 3130 2c20 3130 2c20 3130 292c 2028 352c  10, 10, 10), (5,
-000088f0: 2035 2929 0a0a 2020 2020 3e3e 3e20 6120   5))..    >>> a 
-00008900: 3d20 2828 3130 2c20 3130 2c20 3130 292c  = ((10, 10, 10),
-00008910: 2028 352c 2035 292c 290a 2020 2020 3e3e   (5, 5),).    >>
-00008920: 3e20 6220 3d20 2828 312c 292c 2028 352c  > b = ((1,), (5,
-00008930: 2035 292c 290a 2020 2020 3e3e 3e20 6272   5),).    >>> br
-00008940: 6f61 6463 6173 745f 6368 756e 6b73 2861  oadcast_chunks(a
-00008950: 2c20 6229 0a20 2020 2028 2831 302c 2031  , b).    ((10, 1
-00008960: 302c 2031 3029 2c20 2835 2c20 3529 290a  0, 10), (5, 5)).
-00008970: 0a20 2020 203e 3e3e 2061 203d 2028 2831  .    >>> a = ((1
-00008980: 302c 2031 302c 2031 3029 2c20 2835 2c20  0, 10, 10), (5, 
-00008990: 3529 2c29 0a20 2020 203e 3e3e 2062 203d  5),).    >>> b =
-000089a0: 2028 2833 2c20 332c 292c 2028 352c 2035   ((3, 3,), (5, 5
-000089b0: 292c 290a 2020 2020 3e3e 3e20 6272 6f61  ),).    >>> broa
-000089c0: 6463 6173 745f 6368 756e 6b73 2861 2c20  dcast_chunks(a, 
-000089d0: 6229 0a20 2020 2054 7261 6365 6261 636b  b).    Traceback
-000089e0: 2028 6d6f 7374 2072 6563 656e 7420 6361   (most recent ca
-000089f0: 6c6c 206c 6173 7429 3a0a 2020 2020 2020  ll last):.      
-00008a00: 2020 2e2e 2e0a 2020 2020 5661 6c75 6545    ....    ValueE
-00008a10: 7272 6f72 3a20 4368 756e 6b73 2064 6f20  rror: Chunks do 
-00008a20: 6e6f 7420 616c 6967 6e3a 205b 2831 302c  not align: [(10,
-00008a30: 2031 302c 2031 3029 2c20 2833 2c20 3329   10, 10), (3, 3)
-00008a40: 5d0a 2020 2020 2222 220a 2020 2020 6966  ].    """.    if
-00008a50: 206e 6f74 2063 6875 6e6b 7373 3a0a 2020   not chunkss:.  
-00008a60: 2020 2020 2020 7265 7475 726e 2028 290a        return ().
-00008a70: 2020 2020 656c 6966 206c 656e 2863 6875      elif len(chu
-00008a80: 6e6b 7373 2920 3d3d 2031 3a0a 2020 2020  nkss) == 1:.    
-00008a90: 2020 2020 7265 7475 726e 2063 6875 6e6b      return chunk
-00008aa0: 7373 5b30 5d0a 2020 2020 6e20 3d20 6d61  ss[0].    n = ma
-00008ab0: 7828 6d61 7028 6c65 6e2c 2063 6875 6e6b  x(map(len, chunk
-00008ac0: 7373 2929 0a20 2020 2063 6875 6e6b 7373  ss)).    chunkss
-00008ad0: 3220 3d20 5b28 2831 2c29 2c29 202a 2028  2 = [((1,),) * (
-00008ae0: 6e20 2d20 6c65 6e28 6329 2920 2b20 6320  n - len(c)) + c 
-00008af0: 666f 7220 6320 696e 2063 6875 6e6b 7373  for c in chunkss
-00008b00: 5d0a 2020 2020 7265 7375 6c74 203d 205b  ].    result = [
-00008b10: 5d0a 2020 2020 666f 7220 6920 696e 2072  ].    for i in r
-00008b20: 616e 6765 286e 293a 0a20 2020 2020 2020  ange(n):.       
-00008b30: 2073 7465 7031 203d 205b 635b 695d 2066   step1 = [c[i] f
-00008b40: 6f72 2063 2069 6e20 6368 756e 6b73 7332  or c in chunkss2
-00008b50: 5d0a 2020 2020 2020 2020 6966 2061 6c6c  ].        if all
-00008b60: 2863 203d 3d20 2831 2c29 2066 6f72 2063  (c == (1,) for c
-00008b70: 2069 6e20 7374 6570 3129 3a0a 2020 2020   in step1):.    
-00008b80: 2020 2020 2020 2020 7374 6570 3220 3d20          step2 = 
-00008b90: 7374 6570 310a 2020 2020 2020 2020 656c  step1.        el
-00008ba0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008bb0: 7374 6570 3220 3d20 5b63 2066 6f72 2063  step2 = [c for c
-00008bc0: 2069 6e20 7374 6570 3120 6966 2063 2021   in step1 if c !
-00008bd0: 3d20 2831 2c29 5d0a 2020 2020 2020 2020  = (1,)].        
-00008be0: 6966 206c 656e 2873 6574 2873 7465 7032  if len(set(step2
-00008bf0: 2929 2021 3d20 313a 0a20 2020 2020 2020  )) != 1:.       
-00008c00: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00008c10: 4572 726f 7228 2243 6875 6e6b 7320 646f  Error("Chunks do
-00008c20: 206e 6f74 2061 6c69 676e 3a20 2573 2220   not align: %s" 
-00008c30: 2520 7374 7228 7374 6570 3229 290a 2020  % str(step2)).  
-00008c40: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
-00008c50: 656e 6428 7374 6570 325b 305d 290a 2020  end(step2[0]).  
-00008c60: 2020 7265 7475 726e 2074 7570 6c65 2872    return tuple(r
-00008c70: 6573 756c 7429 0a0a 0a64 6566 2073 746f  esult)...def sto
-00008c80: 7265 280a 2020 2020 736f 7572 6365 733a  re(.    sources:
-00008c90: 2041 7272 6179 207c 2043 6f6c 6c65 6374   Array | Collect
-00008ca0: 696f 6e5b 4172 7261 795d 2c0a 2020 2020  ion[Array],.    
-00008cb0: 7461 7267 6574 733a 2041 7272 6179 4c69  targets: ArrayLi
-00008cc0: 6b65 207c 2044 656c 6179 6564 207c 2043  ke | Delayed | C
-00008cd0: 6f6c 6c65 6374 696f 6e5b 4172 7261 794c  ollection[ArrayL
-00008ce0: 696b 6520 7c20 4465 6c61 7965 645d 2c0a  ike | Delayed],.
-00008cf0: 2020 2020 6c6f 636b 3a20 626f 6f6c 207c      lock: bool |
-00008d00: 204c 6f63 6b20 3d20 5472 7565 2c0a 2020   Lock = True,.  
-00008d10: 2020 7265 6769 6f6e 733a 2074 7570 6c65    regions: tuple
-00008d20: 5b73 6c69 6365 2c20 2e2e 2e5d 207c 2043  [slice, ...] | C
-00008d30: 6f6c 6c65 6374 696f 6e5b 7475 706c 655b  ollection[tuple[
-00008d40: 736c 6963 652c 202e 2e2e 5d5d 207c 204e  slice, ...]] | N
-00008d50: 6f6e 6520 3d20 4e6f 6e65 2c0a 2020 2020  one = None,.    
-00008d60: 636f 6d70 7574 653a 2062 6f6f 6c20 3d20  compute: bool = 
-00008d70: 5472 7565 2c0a 2020 2020 7265 7475 726e  True,.    return
-00008d80: 5f73 746f 7265 643a 2062 6f6f 6c20 3d20  _stored: bool = 
-00008d90: 4661 6c73 652c 0a20 2020 202a 2a6b 7761  False,.    **kwa
-00008da0: 7267 732c 0a29 3a0a 2020 2020 2222 2253  rgs,.):.    """S
-00008db0: 746f 7265 2064 6173 6b20 6172 7261 7973  tore dask arrays
-00008dc0: 2069 6e20 6172 7261 792d 6c69 6b65 206f   in array-like o
-00008dd0: 626a 6563 7473 2c20 6f76 6572 7772 6974  bjects, overwrit
-00008de0: 6520 6461 7461 2069 6e20 7461 7267 6574  e data in target
-00008df0: 0a0a 2020 2020 5468 6973 2073 746f 7265  ..    This store
-00008e00: 7320 6461 736b 2061 7272 6179 7320 696e  s dask arrays in
-00008e10: 746f 206f 626a 6563 7420 7468 6174 2073  to object that s
-00008e20: 7570 706f 7274 7320 6e75 6d70 792d 7374  upports numpy-st
-00008e30: 796c 6520 7365 7469 7465 6d0a 2020 2020  yle setitem.    
-00008e40: 696e 6465 7869 6e67 2e20 2049 7420 7374  indexing.  It st
-00008e50: 6f72 6573 2076 616c 7565 7320 6368 756e  ores values chun
-00008e60: 6b20 6279 2063 6875 6e6b 2073 6f20 7468  k by chunk so th
-00008e70: 6174 2069 7420 646f 6573 206e 6f74 2068  at it does not h
-00008e80: 6176 6520 746f 0a20 2020 2066 696c 6c20  ave to.    fill 
-00008e90: 7570 206d 656d 6f72 792e 2020 466f 7220  up memory.  For 
-00008ea0: 6265 7374 2070 6572 666f 726d 616e 6365  best performance
-00008eb0: 2079 6f75 2063 616e 2061 6c69 676e 2074   you can align t
-00008ec0: 6865 2062 6c6f 636b 2073 697a 6520 6f66  he block size of
-00008ed0: 0a20 2020 2074 6865 2073 746f 7261 6765  .    the storage
-00008ee0: 2074 6172 6765 7420 7769 7468 2074 6865   target with the
-00008ef0: 2062 6c6f 636b 2073 697a 6520 6f66 2079   block size of y
-00008f00: 6f75 7220 6172 7261 792e 0a0a 2020 2020  our array...    
-00008f10: 4966 2079 6f75 7220 6461 7461 2066 6974  If your data fit
-00008f20: 7320 696e 206d 656d 6f72 7920 7468 656e  s in memory then
-00008f30: 2079 6f75 206d 6179 2070 7265 6665 7220   you may prefer 
-00008f40: 6361 6c6c 696e 670a 2020 2020 6060 6e70  calling.    ``np
-00008f50: 2e61 7272 6179 286d 7961 7272 6179 2960  .array(myarray)`
-00008f60: 6020 696e 7374 6561 642e 0a0a 2020 2020  ` instead...    
-00008f70: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00008f80: 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020 2073  ---------..    s
-00008f90: 6f75 7263 6573 3a20 4172 7261 7920 6f72  ources: Array or
-00008fa0: 2063 6f6c 6c65 6374 696f 6e20 6f66 2041   collection of A
-00008fb0: 7272 6179 730a 2020 2020 7461 7267 6574  rrays.    target
-00008fc0: 733a 2061 7272 6179 2d6c 696b 6520 6f72  s: array-like or
-00008fd0: 2044 656c 6179 6564 206f 7220 636f 6c6c   Delayed or coll
-00008fe0: 6563 7469 6f6e 206f 6620 6172 7261 792d  ection of array-
-00008ff0: 6c69 6b65 7320 616e 642f 6f72 2044 656c  likes and/or Del
-00009000: 6179 6564 730a 2020 2020 2020 2020 5468  ayeds.        Th
-00009010: 6573 6520 7368 6f75 6c64 2073 7570 706f  ese should suppo
-00009020: 7274 2073 6574 6974 656d 2073 796e 7461  rt setitem synta
-00009030: 7820 6060 7461 7267 6574 5b31 303a 3230  x ``target[10:20
-00009040: 5d20 3d20 2e2e 2e60 602e 0a20 2020 2020  ] = ...``..     
-00009050: 2020 2049 6620 736f 7572 6365 7320 6973     If sources is
-00009060: 2061 2073 696e 676c 6520 6974 656d 2c20   a single item, 
-00009070: 7461 7267 6574 7320 6d75 7374 2062 6520  targets must be 
-00009080: 6120 7369 6e67 6c65 2069 7465 6d3b 2069  a single item; i
-00009090: 6620 736f 7572 6365 7320 6973 2061 0a20  f sources is a. 
-000090a0: 2020 2020 2020 2063 6f6c 6c65 6374 696f         collectio
-000090b0: 6e20 6f66 2061 7272 6179 732c 2074 6172  n of arrays, tar
-000090c0: 6765 7473 206d 7573 7420 6265 2061 206d  gets must be a m
-000090d0: 6174 6368 696e 6720 636f 6c6c 6563 7469  atching collecti
-000090e0: 6f6e 2e0a 2020 2020 6c6f 636b 3a20 626f  on..    lock: bo
-000090f0: 6f6c 6561 6e20 6f72 2074 6872 6561 6469  olean or threadi
-00009100: 6e67 2e4c 6f63 6b2c 206f 7074 696f 6e61  ng.Lock, optiona
-00009110: 6c0a 2020 2020 2020 2020 5768 6574 6865  l.        Whethe
-00009120: 7220 6f72 206e 6f74 2074 6f20 6c6f 636b  r or not to lock
-00009130: 2074 6865 2064 6174 6120 7374 6f72 6573   the data stores
-00009140: 2077 6869 6c65 2073 746f 7269 6e67 2e0a   while storing..
-00009150: 2020 2020 2020 2020 5061 7373 2054 7275          Pass Tru
-00009160: 6520 286c 6f63 6b20 6561 6368 2066 696c  e (lock each fil
-00009170: 6520 696e 6469 7669 6475 616c 6c79 292c  e individually),
-00009180: 2046 616c 7365 2028 646f 6e27 7420 6c6f   False (don't lo
-00009190: 636b 2920 6f72 2061 0a20 2020 2020 2020  ck) or a.       
-000091a0: 2070 6172 7469 6375 6c61 7220 3a63 6c61   particular :cla
-000091b0: 7373 3a60 7468 7265 6164 696e 672e 4c6f  ss:`threading.Lo
-000091c0: 636b 6020 6f62 6a65 6374 2074 6f20 6265  ck` object to be
-000091d0: 2073 6861 7265 6420 616d 6f6e 6720 616c   shared among al
-000091e0: 6c20 7772 6974 6573 2e0a 2020 2020 7265  l writes..    re
-000091f0: 6769 6f6e 733a 2074 7570 6c65 206f 6620  gions: tuple of 
-00009200: 736c 6963 6573 206f 7220 636f 6c6c 6563  slices or collec
-00009210: 7469 6f6e 206f 6620 7475 706c 6573 206f  tion of tuples o
-00009220: 6620 736c 6963 6573 2c20 6f70 7469 6f6e  f slices, option
-00009230: 616c 0a20 2020 2020 2020 2045 6163 6820  al.        Each 
-00009240: 6060 7265 6769 6f6e 6060 2074 7570 6c65  ``region`` tuple
-00009250: 2069 6e20 6060 7265 6769 6f6e 7360 6020   in ``regions`` 
-00009260: 7368 6f75 6c64 2062 6520 7375 6368 2074  should be such t
-00009270: 6861 740a 2020 2020 2020 2020 6060 7461  hat.        ``ta
-00009280: 7267 6574 5b72 6567 696f 6e5d 2e73 6861  rget[region].sha
-00009290: 7065 203d 2073 6f75 7263 652e 7368 6170  pe = source.shap
-000092a0: 6560 600a 2020 2020 2020 2020 666f 7220  e``.        for 
-000092b0: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
-000092c0: 6720 736f 7572 6365 2061 6e64 2074 6172  g source and tar
-000092d0: 6765 7420 696e 2073 6f75 7263 6573 2061  get in sources a
-000092e0: 6e64 2074 6172 6765 7473 2c0a 2020 2020  nd targets,.    
-000092f0: 2020 2020 7265 7370 6563 7469 7665 6c79      respectively
-00009300: 2e20 4966 2074 6869 7320 6973 2061 2074  . If this is a t
-00009310: 7570 6c65 2c20 7468 6520 636f 6e74 656e  uple, the conten
-00009320: 7473 2077 696c 6c20 6265 2061 7373 756d  ts will be assum
-00009330: 6564 2074 6f20 6265 0a20 2020 2020 2020  ed to be.       
-00009340: 2073 6c69 6365 732c 2073 6f20 646f 206e   slices, so do n
-00009350: 6f74 2070 726f 7669 6465 2061 2074 7570  ot provide a tup
-00009360: 6c65 206f 6620 7475 706c 6573 2e0a 2020  le of tuples..  
-00009370: 2020 636f 6d70 7574 653a 2062 6f6f 6c65    compute: boole
-00009380: 616e 2c20 6f70 7469 6f6e 616c 0a20 2020  an, optional.   
-00009390: 2020 2020 2049 6620 7472 7565 2063 6f6d       If true com
-000093a0: 7075 7465 2069 6d6d 6564 6961 7465 6c79  pute immediately
-000093b0: 3b20 7265 7475 726e 203a 636c 6173 733a  ; return :class:
-000093c0: 6064 6173 6b2e 6465 6c61 7965 642e 4465  `dask.delayed.De
-000093d0: 6c61 7965 6460 206f 7468 6572 7769 7365  layed` otherwise
-000093e0: 2e0a 2020 2020 7265 7475 726e 5f73 746f  ..    return_sto
-000093f0: 7265 643a 2062 6f6f 6c65 616e 2c20 6f70  red: boolean, op
-00009400: 7469 6f6e 616c 0a20 2020 2020 2020 204f  tional.        O
-00009410: 7074 696f 6e61 6c6c 7920 7265 7475 726e  ptionally return
-00009420: 2074 6865 2073 746f 7265 6420 7265 7375   the stored resu
-00009430: 6c74 2028 6465 6661 756c 7420 4661 6c73  lt (default Fals
-00009440: 6529 2e0a 2020 2020 6b77 6172 6773 3a0a  e)..    kwargs:.
-00009450: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00009460: 7273 2070 6173 7365 6420 746f 2063 6f6d  rs passed to com
-00009470: 7075 7465 2f70 6572 7369 7374 2028 6f6e  pute/persist (on
-00009480: 6c79 2075 7365 6420 6966 2063 6f6d 7075  ly used if compu
-00009490: 7465 3d54 7275 6529 0a0a 2020 2020 5265  te=True)..    Re
-000094a0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-000094b0: 2d0a 0a20 2020 2049 6620 7265 7475 726e  -..    If return
-000094c0: 5f73 746f 7265 643d 5472 7565 0a20 2020  _stored=True.   
-000094d0: 2020 2020 2074 7570 6c65 206f 6620 4172       tuple of Ar
-000094e0: 7261 7973 0a20 2020 2049 6620 7265 7475  rays.    If retu
-000094f0: 726e 5f73 746f 7265 643d 4661 6c73 6520  rn_stored=False 
-00009500: 616e 6420 636f 6d70 7574 653d 5472 7565  and compute=True
-00009510: 0a20 2020 2020 2020 204e 6f6e 650a 2020  .        None.  
-00009520: 2020 4966 2072 6574 7572 6e5f 7374 6f72    If return_stor
-00009530: 6564 3d46 616c 7365 2061 6e64 2063 6f6d  ed=False and com
-00009540: 7075 7465 3d46 616c 7365 0a20 2020 2020  pute=False.     
-00009550: 2020 2044 656c 6179 6564 0a0a 2020 2020     Delayed..    
-00009560: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-00009570: 2d2d 2d2d 2d0a 0a20 2020 203e 3e3e 2069  -----..    >>> i
-00009580: 6d70 6f72 7420 6835 7079 2020 2320 646f  mport h5py  # do
-00009590: 6374 6573 743a 202b 534b 4950 0a20 2020  ctest: +SKIP.   
-000095a0: 203e 3e3e 2066 203d 2068 3570 792e 4669   >>> f = h5py.Fi
-000095b0: 6c65 2827 6d79 6669 6c65 2e68 6466 3527  le('myfile.hdf5'
-000095c0: 2c20 6d6f 6465 3d27 6127 2920 2023 2064  , mode='a')  # d
-000095d0: 6f63 7465 7374 3a20 2b53 4b49 500a 2020  octest: +SKIP.  
-000095e0: 2020 3e3e 3e20 6473 6574 203d 2066 2e63    >>> dset = f.c
-000095f0: 7265 6174 655f 6461 7461 7365 7428 272f  reate_dataset('/
-00009600: 6461 7461 272c 2073 6861 7065 3d78 2e73  data', shape=x.s
-00009610: 6861 7065 2c0a 2020 2020 2e2e 2e20 2020  hape,.    ...   
-00009620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009630: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00009640: 6875 6e6b 733d 782e 6368 756e 6b73 2c0a  hunks=x.chunks,.
-00009650: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
-00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 2020 2020 2020 2020 2064 7479 7065 3d27           dtype='
-00009680: 6638 2729 2020 2320 646f 6374 6573 743a  f8')  # doctest:
-00009690: 202b 534b 4950 0a0a 2020 2020 3e3e 3e20   +SKIP..    >>> 
-000096a0: 7374 6f72 6528 782c 2064 7365 7429 2020  store(x, dset)  
-000096b0: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
-000096c0: 0a0a 2020 2020 416c 7465 726e 6174 6976  ..    Alternativ
-000096d0: 656c 7920 7374 6f72 6520 6d61 6e79 2061  ely store many a
-000096e0: 7272 6179 7320 6174 2074 6865 2073 616d  rrays at the sam
-000096f0: 6520 7469 6d65 0a0a 2020 2020 3e3e 3e20  e time..    >>> 
-00009700: 7374 6f72 6528 5b78 2c20 792c 207a 5d2c  store([x, y, z],
-00009710: 205b 6473 6574 312c 2064 7365 7432 2c20   [dset1, dset2, 
-00009720: 6473 6574 335d 2920 2023 2064 6f63 7465  dset3])  # docte
-00009730: 7374 3a20 2b53 4b49 500a 2020 2020 2222  st: +SKIP.    ""
-00009740: 220a 0a20 2020 2069 6620 6973 696e 7374  "..    if isinst
-00009750: 616e 6365 2873 6f75 7263 6573 2c20 4172  ance(sources, Ar
-00009760: 7261 7929 3a0a 2020 2020 2020 2020 736f  ray):.        so
-00009770: 7572 6365 7320 3d20 5b73 6f75 7263 6573  urces = [sources
-00009780: 5d0a 2020 2020 2020 2020 2320 5468 6572  ].        # Ther
-00009790: 6527 7320 6e6f 2077 6179 2074 6f20 7465  e's no way to te
-000097a0: 7374 2074 6861 7420 7461 7267 6574 7320  st that targets 
-000097b0: 6973 2061 2073 696e 676c 6520 6172 7261  is a single arra
-000097c0: 792d 6c69 6b65 2e0a 2020 2020 2020 2020  y-like..        
-000097d0: 2320 5765 206e 6565 6420 746f 2074 7275  # We need to tru
-000097e0: 7374 2074 6865 2075 7365 722e 0a20 2020  st the user..   
-000097f0: 2020 2020 2074 6172 6765 7473 203d 205b       targets = [
-00009800: 7461 7267 6574 735d 2020 2320 7479 7065  targets]  # type
-00009810: 3a20 6967 6e6f 7265 0a20 2020 2074 6172  : ignore.    tar
-00009820: 6765 7473 203d 2063 6173 7428 2243 6f6c  gets = cast("Col
-00009830: 6c65 6374 696f 6e5b 4172 7261 794c 696b  lection[ArrayLik
-00009840: 6520 7c20 4465 6c61 7965 645d 222c 2074  e | Delayed]", t
-00009850: 6172 6765 7473 290a 0a20 2020 2069 6620  argets)..    if 
-00009860: 616e 7928 6e6f 7420 6973 696e 7374 616e  any(not isinstan
-00009870: 6365 2873 2c20 4172 7261 7929 2066 6f72  ce(s, Array) for
-00009880: 2073 2069 6e20 736f 7572 6365 7329 3a0a   s in sources):.
-00009890: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-000098a0: 6c75 6545 7272 6f72 2822 416c 6c20 736f  lueError("All so
-000098b0: 7572 6365 7320 6d75 7374 2062 6520 6461  urces must be da
-000098c0: 736b 2061 7272 6179 206f 626a 6563 7473  sk array objects
-000098d0: 2229 0a0a 2020 2020 6966 206c 656e 2873  ")..    if len(s
-000098e0: 6f75 7263 6573 2920 213d 206c 656e 2874  ources) != len(t
-000098f0: 6172 6765 7473 293a 0a20 2020 2020 2020  argets):.       
-00009900: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00009910: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
-00009920: 4469 6666 6572 656e 7420 6e75 6d62 6572  Different number
-00009930: 206f 6620 736f 7572 6365 7320 5b25 645d   of sources [%d]
-00009940: 2061 6e64 2074 6172 6765 7473 205b 2564   and targets [%d
-00009950: 5d22 0a20 2020 2020 2020 2020 2020 2025  ]".            %
-00009960: 2028 6c65 6e28 736f 7572 6365 7329 2c20   (len(sources), 
-00009970: 6c65 6e28 7461 7267 6574 7329 290a 2020  len(targets)).  
-00009980: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-00009990: 6973 696e 7374 616e 6365 2872 6567 696f  isinstance(regio
-000099a0: 6e73 2c20 7475 706c 6529 206f 7220 7265  ns, tuple) or re
-000099b0: 6769 6f6e 7320 6973 204e 6f6e 653a 0a20  gions is None:. 
-000099c0: 2020 2020 2020 2072 6567 696f 6e73 5f6c         regions_l
-000099d0: 6973 7420 3d20 5b72 6567 696f 6e73 5d20  ist = [regions] 
-000099e0: 2a20 6c65 6e28 736f 7572 6365 7329 0a20  * len(sources). 
-000099f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00009a00: 2072 6567 696f 6e73 5f6c 6973 7420 3d20   regions_list = 
-00009a10: 6c69 7374 2872 6567 696f 6e73 290a 2020  list(regions).  
-00009a20: 2020 2020 2020 6966 206c 656e 2873 6f75        if len(sou
-00009a30: 7263 6573 2920 213d 206c 656e 2872 6567  rces) != len(reg
-00009a40: 696f 6e73 5f6c 6973 7429 3a0a 2020 2020  ions_list):.    
-00009a50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00009a60: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00009a70: 2020 2020 2020 2020 2020 6622 4469 6666            f"Diff
-00009a80: 6572 656e 7420 6e75 6d62 6572 206f 6620  erent number of 
-00009a90: 736f 7572 6365 7320 5b7b 6c65 6e28 736f  sources [{len(so
-00009aa0: 7572 6365 7329 7d5d 2061 6e64 2022 0a20  urces)}] and ". 
-00009ab0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009ac0: 2274 6172 6765 7473 205b 7b6c 656e 2874  "targets [{len(t
-00009ad0: 6172 6765 7473 297d 5d20 7468 616e 2072  argets)}] than r
-00009ae0: 6567 696f 6e73 205b 7b6c 656e 2872 6567  egions [{len(reg
-00009af0: 696f 6e73 5f6c 6973 7429 7d5d 220a 2020  ions_list)}]".  
-00009b00: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00009b10: 6465 6c20 7265 6769 6f6e 730a 0a20 2020  del regions..   
-00009b20: 2023 204f 7074 696d 697a 6520 616c 6c20   # Optimize all 
-00009b30: 736f 7572 6365 7320 746f 6765 7468 6572  sources together
-00009b40: 0a20 2020 2073 6f75 7263 6573 5f68 6c67  .    sources_hlg
-00009b50: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
-00009b60: 682e 6d65 7267 6528 2a5b 652e 5f5f 6461  h.merge(*[e.__da
-00009b70: 736b 5f67 7261 7068 5f5f 2829 2066 6f72  sk_graph__() for
-00009b80: 2065 2069 6e20 736f 7572 6365 735d 290a   e in sources]).
-00009b90: 2020 2020 736f 7572 6365 735f 6c61 7965      sources_laye
-00009ba0: 7220 3d20 4172 7261 792e 5f5f 6461 736b  r = Array.__dask
-00009bb0: 5f6f 7074 696d 697a 655f 5f28 0a20 2020  _optimize__(.   
-00009bc0: 2020 2020 2073 6f75 7263 6573 5f68 6c67       sources_hlg
-00009bd0: 2c20 6c69 7374 2863 6f72 652e 666c 6174  , list(core.flat
-00009be0: 7465 6e28 5b65 2e5f 5f64 6173 6b5f 6b65  ten([e.__dask_ke
-00009bf0: 7973 5f5f 2829 2066 6f72 2065 2069 6e20  ys__() for e in 
-00009c00: 736f 7572 6365 735d 2929 0a20 2020 2029  sources])).    )
-00009c10: 0a20 2020 2073 6f75 7263 6573 5f6e 616d  .    sources_nam
-00009c20: 6520 3d20 2273 746f 7265 2d73 6f75 7263  e = "store-sourc
-00009c30: 6573 2d22 202b 2074 6f6b 656e 697a 6528  es-" + tokenize(
-00009c40: 736f 7572 6365 7329 0a20 2020 206c 6179  sources).    lay
-00009c50: 6572 7320 3d20 7b73 6f75 7263 6573 5f6e  ers = {sources_n
-00009c60: 616d 653a 2073 6f75 7263 6573 5f6c 6179  ame: sources_lay
-00009c70: 6572 7d0a 2020 2020 6465 7065 6e64 656e  er}.    dependen
-00009c80: 6369 6573 3a20 6469 6374 5b73 7472 2c20  cies: dict[str, 
-00009c90: 7365 745b 7374 725d 5d20 3d20 7b73 6f75  set[str]] = {sou
-00009ca0: 7263 6573 5f6e 616d 653a 2073 6574 2829  rces_name: set()
-00009cb0: 7d0a 0a20 2020 2023 204f 7074 696d 697a  }..    # Optimiz
-00009cc0: 6520 616c 6c20 7461 7267 6574 7320 746f  e all targets to
-00009cd0: 6765 7468 6572 0a20 2020 2074 6172 6765  gether.    targe
-00009ce0: 7473 5f6b 6579 7320 3d20 5b5d 0a20 2020  ts_keys = [].   
-00009cf0: 2074 6172 6765 7473 5f64 736b 7320 3d20   targets_dsks = 
-00009d00: 5b5d 0a20 2020 2066 6f72 2074 2069 6e20  [].    for t in 
-00009d10: 7461 7267 6574 733a 0a20 2020 2020 2020  targets:.       
-00009d20: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-00009d30: 2c20 4465 6c61 7965 6429 3a0a 2020 2020  , Delayed):.    
-00009d40: 2020 2020 2020 2020 7461 7267 6574 735f          targets_
-00009d50: 6b65 7973 2e61 7070 656e 6428 742e 6b65  keys.append(t.ke
-00009d60: 7929 0a20 2020 2020 2020 2020 2020 2074  y).            t
-00009d70: 6172 6765 7473 5f64 736b 732e 6170 7065  argets_dsks.appe
-00009d80: 6e64 2874 2e5f 5f64 6173 6b5f 6772 6170  nd(t.__dask_grap
-00009d90: 685f 5f28 2929 0a20 2020 2020 2020 2065  h__()).        e
-00009da0: 6c69 6620 6973 5f64 6173 6b5f 636f 6c6c  lif is_dask_coll
-00009db0: 6563 7469 6f6e 2874 293a 0a20 2020 2020  ection(t):.     
-00009dc0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00009dd0: 6545 7272 6f72 2822 5461 7267 6574 7320  eError("Targets 
-00009de0: 6d75 7374 2062 6520 6569 7468 6572 2044  must be either D
-00009df0: 656c 6179 6564 206f 626a 6563 7473 206f  elayed objects o
-00009e00: 7220 6172 7261 792d 6c69 6b65 7322 290a  r array-likes").
-00009e10: 0a20 2020 2069 6620 7461 7267 6574 735f  .    if targets_
-00009e20: 6473 6b73 3a0a 2020 2020 2020 2020 7461  dsks:.        ta
-00009e30: 7267 6574 735f 686c 6720 3d20 4869 6768  rgets_hlg = High
-00009e40: 4c65 7665 6c47 7261 7068 2e6d 6572 6765  LevelGraph.merge
-00009e50: 282a 7461 7267 6574 735f 6473 6b73 290a  (*targets_dsks).
-00009e60: 2020 2020 2020 2020 7461 7267 6574 735f          targets_
-00009e70: 6c61 7965 7220 3d20 4465 6c61 7965 642e  layer = Delayed.
-00009e80: 5f5f 6461 736b 5f6f 7074 696d 697a 655f  __dask_optimize_
-00009e90: 5f28 7461 7267 6574 735f 686c 672c 2074  _(targets_hlg, t
-00009ea0: 6172 6765 7473 5f6b 6579 7329 0a20 2020  argets_keys).   
-00009eb0: 2020 2020 2074 6172 6765 7473 5f6e 616d       targets_nam
-00009ec0: 6520 3d20 2273 746f 7265 2d74 6172 6765  e = "store-targe
-00009ed0: 7473 2d22 202b 2074 6f6b 656e 697a 6528  ts-" + tokenize(
-00009ee0: 7461 7267 6574 735f 6b65 7973 290a 2020  targets_keys).  
-00009ef0: 2020 2020 2020 6c61 7965 7273 5b74 6172        layers[tar
-00009f00: 6765 7473 5f6e 616d 655d 203d 2074 6172  gets_name] = tar
-00009f10: 6765 7473 5f6c 6179 6572 0a20 2020 2020  gets_layer.     
-00009f20: 2020 2064 6570 656e 6465 6e63 6965 735b     dependencies[
-00009f30: 7461 7267 6574 735f 6e61 6d65 5d20 3d20  targets_name] = 
-00009f40: 7365 7428 290a 0a20 2020 206c 6f61 645f  set()..    load_
-00009f50: 7374 6f72 6564 203d 2072 6574 7572 6e5f  stored = return_
-00009f60: 7374 6f72 6564 2061 6e64 206e 6f74 2063  stored and not c
-00009f70: 6f6d 7075 7465 0a0a 2020 2020 6d61 705f  ompute..    map_
-00009f80: 6e61 6d65 7320 3d20 5b0a 2020 2020 2020  names = [.      
-00009f90: 2020 2273 746f 7265 2d6d 6170 2d22 202b    "store-map-" +
-00009fa0: 2074 6f6b 656e 697a 6528 732c 2074 2069   tokenize(s, t i
-00009fb0: 6620 6973 696e 7374 616e 6365 2874 2c20  f isinstance(t, 
-00009fc0: 4465 6c61 7965 6429 2065 6c73 6520 6964  Delayed) else id
-00009fd0: 2874 292c 2072 290a 2020 2020 2020 2020  (t), r).        
-00009fe0: 666f 7220 732c 2074 2c20 7220 696e 207a  for s, t, r in z
-00009ff0: 6970 2873 6f75 7263 6573 2c20 7461 7267  ip(sources, targ
-0000a000: 6574 732c 2072 6567 696f 6e73 5f6c 6973  ets, regions_lis
-0000a010: 7429 0a20 2020 205d 0a20 2020 206d 6170  t).    ].    map
-0000a020: 5f6b 6579 733a 206c 6973 745b 7475 706c  _keys: list[tupl
-0000a030: 655d 203d 205b 5d0a 0a20 2020 2066 6f72  e] = []..    for
-0000a040: 2073 2c20 742c 206e 2c20 7220 696e 207a   s, t, n, r in z
-0000a050: 6970 2873 6f75 7263 6573 2c20 7461 7267  ip(sources, targ
-0000a060: 6574 732c 206d 6170 5f6e 616d 6573 2c20  ets, map_names, 
-0000a070: 7265 6769 6f6e 735f 6c69 7374 293a 0a20  regions_list):. 
-0000a080: 2020 2020 2020 206d 6170 5f6c 6179 6572         map_layer
-0000a090: 203d 2069 6e73 6572 745f 746f 5f6f 6f63   = insert_to_ooc
-0000a0a0: 280a 2020 2020 2020 2020 2020 2020 6b65  (.            ke
-0000a0b0: 7973 3d73 2e5f 5f64 6173 6b5f 6b65 7973  ys=s.__dask_keys
-0000a0c0: 5f5f 2829 2c0a 2020 2020 2020 2020 2020  __(),.          
-0000a0d0: 2020 6368 756e 6b73 3d73 2e63 6875 6e6b    chunks=s.chunk
-0000a0e0: 732c 0a20 2020 2020 2020 2020 2020 206f  s,.            o
-0000a0f0: 7574 3d74 2e6b 6579 2069 6620 6973 696e  ut=t.key if isin
-0000a100: 7374 616e 6365 2874 2c20 4465 6c61 7965  stance(t, Delaye
-0000a110: 6429 2065 6c73 6520 742c 0a20 2020 2020  d) else t,.     
-0000a120: 2020 2020 2020 206e 616d 653d 6e2c 0a20         name=n,. 
-0000a130: 2020 2020 2020 2020 2020 206c 6f63 6b3d             lock=
-0000a140: 6c6f 636b 2c0a 2020 2020 2020 2020 2020  lock,.          
-0000a150: 2020 7265 6769 6f6e 3d72 2c0a 2020 2020    region=r,.    
-0000a160: 2020 2020 2020 2020 7265 7475 726e 5f73          return_s
-0000a170: 746f 7265 643d 7265 7475 726e 5f73 746f  tored=return_sto
-0000a180: 7265 642c 0a20 2020 2020 2020 2020 2020  red,.           
-0000a190: 206c 6f61 645f 7374 6f72 6564 3d6c 6f61   load_stored=loa
-0000a1a0: 645f 7374 6f72 6564 2c0a 2020 2020 2020  d_stored,.      
-0000a1b0: 2020 290a 2020 2020 2020 2020 6c61 7965    ).        laye
-0000a1c0: 7273 5b6e 5d20 3d20 6d61 705f 6c61 7965  rs[n] = map_laye
-0000a1d0: 720a 2020 2020 2020 2020 6966 2069 7369  r.        if isi
-0000a1e0: 6e73 7461 6e63 6528 742c 2044 656c 6179  nstance(t, Delay
-0000a1f0: 6564 293a 0a20 2020 2020 2020 2020 2020  ed):.           
-0000a200: 2064 6570 656e 6465 6e63 6965 735b 6e5d   dependencies[n]
-0000a210: 203d 207b 736f 7572 6365 735f 6e61 6d65   = {sources_name
-0000a220: 2c20 7461 7267 6574 735f 6e61 6d65 7d0a  , targets_name}.
-0000a230: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a240: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
-0000a250: 656e 6369 6573 5b6e 5d20 3d20 7b73 6f75  encies[n] = {sou
-0000a260: 7263 6573 5f6e 616d 657d 0a20 2020 2020  rces_name}.     
-0000a270: 2020 206d 6170 5f6b 6579 7320 2b3d 206d     map_keys += m
-0000a280: 6170 5f6c 6179 6572 2e6b 6579 7328 290a  ap_layer.keys().
-0000a290: 0a20 2020 2069 6620 7265 7475 726e 5f73  .    if return_s
-0000a2a0: 746f 7265 643a 0a20 2020 2020 2020 2073  tored:.        s
-0000a2b0: 746f 7265 5f64 736b 203d 2048 6967 684c  tore_dsk = HighL
-0000a2c0: 6576 656c 4772 6170 6828 6c61 7965 7273  evelGraph(layers
-0000a2d0: 2c20 6465 7065 6e64 656e 6369 6573 290a  , dependencies).
-0000a2e0: 2020 2020 2020 2020 6c6f 6164 5f73 746f          load_sto
-0000a2f0: 7265 5f64 736b 3a20 4869 6768 4c65 7665  re_dsk: HighLeve
-0000a300: 6c47 7261 7068 207c 2064 6963 745b 7475  lGraph | dict[tu
-0000a310: 706c 652c 2041 6e79 5d20 3d20 7374 6f72  ple, Any] = stor
-0000a320: 655f 6473 6b0a 2020 2020 2020 2020 6966  e_dsk.        if
-0000a330: 2063 6f6d 7075 7465 3a0a 2020 2020 2020   compute:.      
-0000a340: 2020 2020 2020 7374 6f72 655f 646c 7964        store_dlyd
-0000a350: 7320 3d20 5b44 656c 6179 6564 286b 2c20  s = [Delayed(k, 
-0000a360: 7374 6f72 655f 6473 6b2c 206c 6179 6572  store_dsk, layer
-0000a370: 3d6b 5b30 5d29 2066 6f72 206b 2069 6e20  =k[0]) for k in 
-0000a380: 6d61 705f 6b65 7973 5d0a 2020 2020 2020  map_keys].      
-0000a390: 2020 2020 2020 7374 6f72 655f 646c 7964        store_dlyd
-0000a3a0: 7320 3d20 7065 7273 6973 7428 2a73 746f  s = persist(*sto
-0000a3b0: 7265 5f64 6c79 6473 2c20 2a2a 6b77 6172  re_dlyds, **kwar
-0000a3c0: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-0000a3d0: 7374 6f72 655f 6473 6b5f 3220 3d20 4869  store_dsk_2 = Hi
-0000a3e0: 6768 4c65 7665 6c47 7261 7068 2e6d 6572  ghLevelGraph.mer
-0000a3f0: 6765 282a 5b65 2e64 6173 6b20 666f 7220  ge(*[e.dask for 
-0000a400: 6520 696e 2073 746f 7265 5f64 6c79 6473  e in store_dlyds
-0000a410: 5d29 0a20 2020 2020 2020 2020 2020 206c  ]).            l
-0000a420: 6f61 645f 7374 6f72 655f 6473 6b20 3d20  oad_store_dsk = 
-0000a430: 7265 7472 6965 7665 5f66 726f 6d5f 6f6f  retrieve_from_oo
-0000a440: 6328 6d61 705f 6b65 7973 2c20 7374 6f72  c(map_keys, stor
-0000a450: 655f 6473 6b2c 2073 746f 7265 5f64 736b  e_dsk, store_dsk
-0000a460: 5f32 290a 2020 2020 2020 2020 2020 2020  _2).            
-0000a470: 6d61 705f 6e61 6d65 7320 3d20 5b22 6c6f  map_names = ["lo
-0000a480: 6164 2d22 202b 206e 2066 6f72 206e 2069  ad-" + n for n i
-0000a490: 6e20 6d61 705f 6e61 6d65 735d 0a0a 2020  n map_names]..  
-0000a4a0: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
-0000a4b0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000a4c0: 4172 7261 7928 6c6f 6164 5f73 746f 7265  Array(load_store
-0000a4d0: 5f64 736b 2c20 6e2c 2073 2e63 6875 6e6b  _dsk, n, s.chunk
-0000a4e0: 732c 206d 6574 613d 7329 0a20 2020 2020  s, meta=s).     
-0000a4f0: 2020 2020 2020 2066 6f72 2073 2c20 6e20         for s, n 
-0000a500: 696e 207a 6970 2873 6f75 7263 6573 2c20  in zip(sources, 
-0000a510: 6d61 705f 6e61 6d65 7329 0a20 2020 2020  map_names).     
-0000a520: 2020 2029 0a0a 2020 2020 656c 6966 2063     )..    elif c
-0000a530: 6f6d 7075 7465 3a0a 2020 2020 2020 2020  ompute:.        
-0000a540: 7374 6f72 655f 6473 6b20 3d20 4869 6768  store_dsk = High
-0000a550: 4c65 7665 6c47 7261 7068 286c 6179 6572  LevelGraph(layer
-0000a560: 732c 2064 6570 656e 6465 6e63 6965 7329  s, dependencies)
-0000a570: 0a20 2020 2020 2020 2063 6f6d 7075 7465  .        compute
-0000a580: 5f61 735f 6966 5f63 6f6c 6c65 6374 696f  _as_if_collectio
-0000a590: 6e28 4172 7261 792c 2073 746f 7265 5f64  n(Array, store_d
-0000a5a0: 736b 2c20 6d61 705f 6b65 7973 2c20 2a2a  sk, map_keys, **
-0000a5b0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0000a5c0: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-0000a5d0: 2065 6c73 653a 0a20 2020 2020 2020 206b   else:.        k
-0000a5e0: 6579 203d 2022 7374 6f72 652d 2220 2b20  ey = "store-" + 
-0000a5f0: 746f 6b65 6e69 7a65 286d 6170 5f6e 616d  tokenize(map_nam
-0000a600: 6573 290a 2020 2020 2020 2020 6c61 7965  es).        laye
-0000a610: 7273 5b6b 6579 5d20 3d20 7b6b 6579 3a20  rs[key] = {key: 
-0000a620: 6d61 705f 6b65 7973 7d0a 2020 2020 2020  map_keys}.      
-0000a630: 2020 6465 7065 6e64 656e 6369 6573 5b6b    dependencies[k
-0000a640: 6579 5d20 3d20 7365 7428 6d61 705f 6e61  ey] = set(map_na
-0000a650: 6d65 7329 0a20 2020 2020 2020 2073 746f  mes).        sto
-0000a660: 7265 5f64 736b 203d 2048 6967 684c 6576  re_dsk = HighLev
-0000a670: 656c 4772 6170 6828 6c61 7965 7273 2c20  elGraph(layers, 
-0000a680: 6465 7065 6e64 656e 6369 6573 290a 2020  dependencies).  
-0000a690: 2020 2020 2020 7265 7475 726e 2044 656c        return Del
-0000a6a0: 6179 6564 286b 6579 2c20 7374 6f72 655f  ayed(key, store_
-0000a6b0: 6473 6b29 0a0a 0a64 6566 2062 6c6f 636b  dsk)...def block
-0000a6c0: 6469 6d73 5f66 726f 6d5f 626c 6f63 6b73  dims_from_blocks
-0000a6d0: 6861 7065 2873 6861 7065 2c20 6368 756e  hape(shape, chun
-0000a6e0: 6b73 293a 0a20 2020 2022 2222 0a0a 2020  ks):.    """..  
-0000a6f0: 2020 3e3e 3e20 626c 6f63 6b64 696d 735f    >>> blockdims_
-0000a700: 6672 6f6d 5f62 6c6f 636b 7368 6170 6528  from_blockshape(
-0000a710: 2831 302c 2031 3029 2c20 2834 2c20 3329  (10, 10), (4, 3)
-0000a720: 290a 2020 2020 2828 342c 2034 2c20 3229  ).    ((4, 4, 2)
-0000a730: 2c20 2833 2c20 332c 2033 2c20 3129 290a  , (3, 3, 3, 1)).
-0000a740: 2020 2020 3e3e 3e20 626c 6f63 6b64 696d      >>> blockdim
-0000a750: 735f 6672 6f6d 5f62 6c6f 636b 7368 6170  s_from_blockshap
-0000a760: 6528 2831 302c 2030 292c 2028 342c 2030  e((10, 0), (4, 0
-0000a770: 2929 0a20 2020 2028 2834 2c20 342c 2032  )).    ((4, 4, 2
-0000a780: 292c 2028 302c 2929 0a20 2020 2022 2222  ), (0,)).    """
-0000a790: 0a20 2020 2069 6620 6368 756e 6b73 2069  .    if chunks i
-0000a7a0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000a7b0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0000a7c0: 224d 7573 7420 7375 7070 6c79 2063 6875  "Must supply chu
-0000a7d0: 6e6b 733d 206b 6579 776f 7264 2061 7267  nks= keyword arg
-0000a7e0: 756d 656e 7422 290a 2020 2020 6966 2073  ument").    if s
-0000a7f0: 6861 7065 2069 7320 4e6f 6e65 3a0a 2020  hape is None:.  
-0000a800: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-0000a810: 4572 726f 7228 224d 7573 7420 7375 7070  Error("Must supp
-0000a820: 6c79 2073 6861 7065 3d20 6b65 7977 6f72  ly shape= keywor
-0000a830: 6420 6172 6775 6d65 6e74 2229 0a20 2020  d argument").   
-0000a840: 2069 6620 6e70 2e69 736e 616e 2873 756d   if np.isnan(sum
-0000a850: 2873 6861 7065 2929 206f 7220 6e70 2e69  (shape)) or np.i
-0000a860: 736e 616e 2873 756d 2863 6875 6e6b 7329  snan(sum(chunks)
-0000a870: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
-0000a880: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0000a890: 2020 2020 2020 2020 2022 4172 7261 7920           "Array 
-0000a8a0: 6368 756e 6b20 7369 7a65 7320 6172 6520  chunk sizes are 
-0000a8b0: 756e 6b6e 6f77 6e2e 2073 6861 7065 3a20  unknown. shape: 
-0000a8c0: 2573 2c20 6368 756e 6b73 3a20 2573 2573  %s, chunks: %s%s
-0000a8d0: 220a 2020 2020 2020 2020 2020 2020 2520  ".            % 
-0000a8e0: 2873 6861 7065 2c20 6368 756e 6b73 2c20  (shape, chunks, 
-0000a8f0: 756e 6b6e 6f77 6e5f 6368 756e 6b5f 6d65  unknown_chunk_me
-0000a900: 7373 6167 6529 0a20 2020 2020 2020 2029  ssage).        )
-0000a910: 0a20 2020 2069 6620 6e6f 7420 616c 6c28  .    if not all(
-0000a920: 6d61 7028 6973 5f69 6e74 6567 6572 2c20  map(is_integer, 
-0000a930: 6368 756e 6b73 2929 3a0a 2020 2020 2020  chunks)):.      
-0000a940: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0000a950: 6f72 2822 6368 756e 6b73 2063 616e 206f  or("chunks can o
-0000a960: 6e6c 7920 636f 6e74 6169 6e20 696e 7465  nly contain inte
-0000a970: 6765 7273 2e22 290a 2020 2020 6966 206e  gers.").    if n
-0000a980: 6f74 2061 6c6c 286d 6170 2869 735f 696e  ot all(map(is_in
-0000a990: 7465 6765 722c 2073 6861 7065 2929 3a0a  teger, shape)):.
-0000a9a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000a9b0: 6c75 6545 7272 6f72 2822 7368 6170 6520  lueError("shape 
-0000a9c0: 6361 6e20 6f6e 6c79 2063 6f6e 7461 696e  can only contain
-0000a9d0: 2069 6e74 6567 6572 732e 2229 0a20 2020   integers.").   
-0000a9e0: 2073 6861 7065 203d 2074 7570 6c65 286d   shape = tuple(m
-0000a9f0: 6170 2869 6e74 2c20 7368 6170 6529 290a  ap(int, shape)).
-0000aa00: 2020 2020 6368 756e 6b73 203d 2074 7570      chunks = tup
-0000aa10: 6c65 286d 6170 2869 6e74 2c20 6368 756e  le(map(int, chun
-0000aa20: 6b73 2929 0a20 2020 2072 6574 7572 6e20  ks)).    return 
-0000aa30: 7475 706c 6528 0a20 2020 2020 2020 2028  tuple(.        (
-0000aa40: 2862 642c 2920 2a20 2864 202f 2f20 6264  (bd,) * (d // bd
-0000aa50: 2920 2b20 2828 6420 2520 6264 2c29 2069  ) + ((d % bd,) i
-0000aa60: 6620 6420 2520 6264 2065 6c73 6520 2829  f d % bd else ()
-0000aa70: 2920 6966 2064 2065 6c73 6520 2830 2c29  ) if d else (0,)
-0000aa80: 290a 2020 2020 2020 2020 666f 7220 642c  ).        for d,
-0000aa90: 2062 6420 696e 207a 6970 2873 6861 7065   bd in zip(shape
-0000aaa0: 2c20 6368 756e 6b73 290a 2020 2020 290a  , chunks).    ).
-0000aab0: 0a0a 6465 6620 6669 6e61 6c69 7a65 2872  ..def finalize(r
-0000aac0: 6573 756c 7473 293a 0a20 2020 2069 6620  esults):.    if 
-0000aad0: 6e6f 7420 7265 7375 6c74 733a 0a20 2020  not results:.   
-0000aae0: 2020 2020 2072 6574 7572 6e20 636f 6e63       return conc
-0000aaf0: 6174 656e 6174 6533 2872 6573 756c 7473  atenate3(results
-0000ab00: 290a 2020 2020 7265 7375 6c74 7332 203d  ).    results2 =
-0000ab10: 2072 6573 756c 7473 0a20 2020 2077 6869   results.    whi
-0000ab20: 6c65 2069 7369 6e73 7461 6e63 6528 7265  le isinstance(re
-0000ab30: 7375 6c74 7332 2c20 2874 7570 6c65 2c20  sults2, (tuple, 
-0000ab40: 6c69 7374 2929 3a0a 2020 2020 2020 2020  list)):.        
-0000ab50: 6966 206c 656e 2872 6573 756c 7473 3229  if len(results2)
-0000ab60: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
-0000ab70: 2020 7265 7475 726e 2063 6f6e 6361 7465    return concate
-0000ab80: 6e61 7465 3328 7265 7375 6c74 7329 0a20  nate3(results). 
-0000ab90: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000aba0: 2020 2020 2020 2020 2072 6573 756c 7473           results
-0000abb0: 3220 3d20 7265 7375 6c74 7332 5b30 5d0a  2 = results2[0].
-0000abc0: 2020 2020 7265 7475 726e 2075 6e70 6163      return unpac
-0000abd0: 6b5f 7369 6e67 6c65 746f 6e28 7265 7375  k_singleton(resu
-0000abe0: 6c74 7329 0a0a 0a43 4855 4e4b 535f 4e4f  lts)...CHUNKS_NO
-0000abf0: 4e45 5f45 5252 4f52 5f4d 4553 5341 4745  NE_ERROR_MESSAGE
-0000ac00: 203d 2022 2222 0a59 6f75 206d 7573 7420   = """.You must 
-0000ac10: 7370 6563 6966 7920 6120 6368 756e 6b73  specify a chunks
-0000ac20: 3d20 6b65 7977 6f72 6420 6172 6775 6d65  = keyword argume
-0000ac30: 6e74 2e0a 5468 6973 2073 7065 6369 6669  nt..This specifi
-0000ac40: 6573 2074 6865 2063 6875 6e6b 7369 7a65  es the chunksize
-0000ac50: 206f 6620 796f 7572 2061 7272 6179 2062   of your array b
-0000ac60: 6c6f 636b 732e 0a0a 5365 6520 7468 6520  locks...See the 
-0000ac70: 666f 6c6c 6f77 696e 6720 646f 6375 6d65  following docume
-0000ac80: 6e74 6174 696f 6e20 7061 6765 2066 6f72  ntation page for
-0000ac90: 2064 6574 6169 6c73 3a0a 2020 6874 7470   details:.  http
-0000aca0: 733a 2f2f 646f 6373 2e64 6173 6b2e 6f72  s://docs.dask.or
-0000acb0: 672f 656e 2f6c 6174 6573 742f 6172 7261  g/en/latest/arra
-0000acc0: 792d 6372 6561 7469 6f6e 2e68 746d 6c23  y-creation.html#
-0000acd0: 6368 756e 6b73 0a22 2222 2e73 7472 6970  chunks.""".strip
-0000ace0: 2829 0a0a 0a63 6c61 7373 2041 7272 6179  ()...class Array
-0000acf0: 2844 6173 6b4d 6574 686f 6473 4d69 7869  (DaskMethodsMixi
-0000ad00: 6e29 3a0a 2020 2020 2222 2250 6172 616c  n):.    """Paral
-0000ad10: 6c65 6c20 4461 736b 2041 7272 6179 0a0a  lel Dask Array..
-0000ad20: 2020 2020 4120 7061 7261 6c6c 656c 206e      A parallel n
-0000ad30: 642d 6172 7261 7920 636f 6d70 7269 7365  d-array comprise
-0000ad40: 6420 6f66 206d 616e 7920 6e75 6d70 7920  d of many numpy 
-0000ad50: 6172 7261 7973 2061 7272 616e 6765 6420  arrays arranged 
-0000ad60: 696e 2061 2067 7269 642e 0a0a 2020 2020  in a grid...    
-0000ad70: 5468 6973 2063 6f6e 7374 7275 6374 6f72  This constructor
-0000ad80: 2069 7320 666f 7220 6164 7661 6e63 6564   is for advanced
-0000ad90: 2075 7365 7320 6f6e 6c79 2e20 2046 6f72   uses only.  For
-0000ada0: 206e 6f72 6d61 6c20 7573 6520 7365 6520   normal use see 
-0000adb0: 7468 650a 2020 2020 3a66 756e 633a 6064  the.    :func:`d
-0000adc0: 6173 6b2e 6172 7261 792e 6672 6f6d 5f61  ask.array.from_a
-0000add0: 7272 6179 6020 6675 6e63 7469 6f6e 2e0a  rray` function..
-0000ade0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-0000adf0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0000ae00: 2020 2064 6173 6b20 3a20 6469 6374 0a20     dask : dict. 
-0000ae10: 2020 2020 2020 2054 6173 6b20 6465 7065         Task depe
-0000ae20: 6e64 656e 6379 2067 7261 7068 0a20 2020  ndency graph.   
-0000ae30: 206e 616d 6520 3a20 7374 7269 6e67 0a20   name : string. 
-0000ae40: 2020 2020 2020 204e 616d 6520 6f66 2061         Name of a
-0000ae50: 7272 6179 2069 6e20 6461 736b 0a20 2020  rray in dask.   
-0000ae60: 2073 6861 7065 203a 2074 7570 6c65 206f   shape : tuple o
-0000ae70: 6620 696e 7473 0a20 2020 2020 2020 2053  f ints.        S
-0000ae80: 6861 7065 206f 6620 7468 6520 656e 7469  hape of the enti
-0000ae90: 7265 2061 7272 6179 0a20 2020 2063 6875  re array.    chu
-0000aea0: 6e6b 733a 2069 7465 7261 626c 6520 6f66  nks: iterable of
-0000aeb0: 2074 7570 6c65 730a 2020 2020 2020 2020   tuples.        
-0000aec0: 626c 6f63 6b20 7369 7a65 7320 616c 6f6e  block sizes alon
-0000aed0: 6720 6561 6368 2064 696d 656e 7369 6f6e  g each dimension
-0000aee0: 0a20 2020 2064 7479 7065 203a 2073 7472  .    dtype : str
-0000aef0: 206f 7220 6474 7970 650a 2020 2020 2020   or dtype.      
-0000af00: 2020 5479 7065 636f 6465 206f 7220 6461    Typecode or da
-0000af10: 7461 2d74 7970 6520 666f 7220 7468 6520  ta-type for the 
-0000af20: 6e65 7720 4461 736b 2041 7272 6179 0a20  new Dask Array. 
-0000af30: 2020 206d 6574 6120 3a20 656d 7074 7920     meta : empty 
-0000af40: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-0000af50: 656d 7074 7920 6e64 6172 7261 7920 6372  empty ndarray cr
-0000af60: 6561 7465 6420 7769 7468 2073 616d 6520  eated with same 
-0000af70: 4e75 6d50 7920 6261 636b 656e 642c 206e  NumPy backend, n
-0000af80: 6469 6d20 616e 6420 6474 7970 6520 6173  dim and dtype as
-0000af90: 2074 6865 0a20 2020 2020 2020 2044 6173   the.        Das
-0000afa0: 6b20 4172 7261 7920 6265 696e 6720 6372  k Array being cr
-0000afb0: 6561 7465 6420 286f 7665 7272 6964 6573  eated (overrides
-0000afc0: 2064 7479 7065 290a 0a20 2020 2053 6565   dtype)..    See
-0000afd0: 2041 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d   Also.    ------
-0000afe0: 2d2d 0a20 2020 2064 6173 6b2e 6172 7261  --.    dask.arra
-0000aff0: 792e 6672 6f6d 5f61 7272 6179 0a20 2020  y.from_array.   
-0000b000: 2022 2222 0a0a 2020 2020 5f5f 736c 6f74   """..    __slot
-0000b010: 735f 5f20 3d20 2264 6173 6b22 2c20 225f  s__ = "dask", "_
-0000b020: 5f6e 616d 6522 2c20 225f 6361 6368 6564  _name", "_cached
-0000b030: 5f6b 6579 7322 2c20 225f 5f63 6875 6e6b  _keys", "__chunk
-0000b040: 7322 2c20 225f 6d65 7461 222c 2022 5f5f  s", "_meta", "__
-0000b050: 6469 6374 5f5f 220a 0a20 2020 2064 6566  dict__"..    def
-0000b060: 205f 5f6e 6577 5f5f 2863 6c73 2c20 6461   __new__(cls, da
-0000b070: 736b 2c20 6e61 6d65 2c20 6368 756e 6b73  sk, name, chunks
-0000b080: 2c20 6474 7970 653d 4e6f 6e65 2c20 6d65  , dtype=None, me
-0000b090: 7461 3d4e 6f6e 652c 2073 6861 7065 3d4e  ta=None, shape=N
-0000b0a0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-0000b0b0: 6c66 203d 2073 7570 6572 2829 2e5f 5f6e  lf = super().__n
-0000b0c0: 6577 5f5f 2863 6c73 290a 2020 2020 2020  ew__(cls).      
-0000b0d0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-0000b0e0: 6e63 6528 6461 736b 2c20 4d61 7070 696e  nce(dask, Mappin
-0000b0f0: 6729 0a20 2020 2020 2020 2069 6620 6e6f  g).        if no
-0000b100: 7420 6973 696e 7374 616e 6365 2864 6173  t isinstance(das
-0000b110: 6b2c 2048 6967 684c 6576 656c 4772 6170  k, HighLevelGrap
-0000b120: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
-0000b130: 6461 736b 203d 2048 6967 684c 6576 656c  dask = HighLevel
-0000b140: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-0000b150: 6374 696f 6e73 286e 616d 652c 2064 6173  ctions(name, das
-0000b160: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
-0000b170: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
-0000b180: 2e64 6173 6b20 3d20 6461 736b 0a20 2020  .dask = dask.   
-0000b190: 2020 2020 2073 656c 662e 5f6e 616d 6520       self._name 
-0000b1a0: 3d20 7374 7228 6e61 6d65 290a 2020 2020  = str(name).    
-0000b1b0: 2020 2020 6d65 7461 203d 206d 6574 615f      meta = meta_
-0000b1c0: 6672 6f6d 5f61 7272 6179 286d 6574 612c  from_array(meta,
-0000b1d0: 2064 7479 7065 3d64 7479 7065 290a 0a20   dtype=dtype).. 
-0000b1e0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-0000b1f0: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-0000b200: 6365 2863 6875 6e6b 732c 2073 7472 290a  ce(chunks, str).
-0000b210: 2020 2020 2020 2020 2020 2020 6f72 2069              or i
-0000b220: 7369 6e73 7461 6e63 6528 6368 756e 6b73  sinstance(chunks
-0000b230: 2c20 7475 706c 6529 0a20 2020 2020 2020  , tuple).       
-0000b240: 2020 2020 2061 6e64 2063 6875 6e6b 730a       and chunks.
-0000b250: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000b260: 616e 7928 6973 696e 7374 616e 6365 2863  any(isinstance(c
-0000b270: 2c20 7374 7229 2066 6f72 2063 2069 6e20  , str) for c in 
-0000b280: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
-0000b290: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-0000b2a0: 7420 3d20 6d65 7461 2e64 7479 7065 0a20  t = meta.dtype. 
-0000b2b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000b2c0: 2020 2020 2020 2020 2064 7420 3d20 4e6f           dt = No
-0000b2d0: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0000b2e0: 5f63 6875 6e6b 7320 3d20 6e6f 726d 616c  _chunks = normal
-0000b2f0: 697a 655f 6368 756e 6b73 2863 6875 6e6b  ize_chunks(chunk
-0000b300: 732c 2073 6861 7065 2c20 6474 7970 653d  s, shape, dtype=
-0000b310: 6474 290a 2020 2020 2020 2020 6966 2073  dt).        if s
-0000b320: 656c 662e 6368 756e 6b73 2069 7320 4e6f  elf.chunks is No
-0000b330: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b340: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000b350: 2843 4855 4e4b 535f 4e4f 4e45 5f45 5252  (CHUNKS_NONE_ERR
-0000b360: 4f52 5f4d 4553 5341 4745 290a 2020 2020  OR_MESSAGE).    
-0000b370: 2020 2020 7365 6c66 2e5f 6d65 7461 203d      self._meta =
-0000b380: 206d 6574 615f 6672 6f6d 5f61 7272 6179   meta_from_array
-0000b390: 286d 6574 612c 206e 6469 6d3d 7365 6c66  (meta, ndim=self
-0000b3a0: 2e6e 6469 6d2c 2064 7479 7065 3d64 7479  .ndim, dtype=dty
-0000b3b0: 7065 290a 0a20 2020 2020 2020 2066 6f72  pe)..        for
-0000b3c0: 2070 6c75 6769 6e20 696e 2063 6f6e 6669   plugin in confi
-0000b3d0: 672e 6765 7428 2261 7272 6179 5f70 6c75  g.get("array_plu
-0000b3e0: 6769 6e73 222c 2028 2929 3a0a 2020 2020  gins", ()):.    
-0000b3f0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000b400: 2070 6c75 6769 6e28 7365 6c66 290a 2020   plugin(self).  
-0000b410: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-0000b420: 756c 7420 6973 206e 6f74 204e 6f6e 653a  ult is not None:
-0000b430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b440: 2073 656c 6620 3d20 7265 7375 6c74 0a0a   self = result..
-0000b450: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000b460: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
-0000b470: 2073 656c 662e 6461 736b 2e6c 6179 6572   self.dask.layer
-0000b480: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
-0000b490: 6578 6365 7074 2028 4174 7472 6962 7574  except (Attribut
-0000b4a0: 6545 7272 6f72 2c20 4b65 7945 7272 6f72  eError, KeyError
-0000b4b0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0000b4c0: 2073 656c 6620 6973 206e 6f20 6c6f 6e67   self is no long
-0000b4d0: 6572 2061 6e20 4172 7261 7920 6166 7465  er an Array afte
-0000b4e0: 7220 6170 706c 7969 6e67 2074 6865 2070  r applying the p
-0000b4f0: 6c75 6769 6e73 2c20 4f52 0a20 2020 2020  lugins, OR.     
-0000b500: 2020 2020 2020 2023 2061 2070 6c75 6769         # a plugi
-0000b510: 6e20 7265 706c 6163 6564 2074 6865 2048  n replaced the H
-0000b520: 6967 684c 6576 656c 4772 6170 6820 7769  ighLevelGraph wi
-0000b530: 7468 2061 2070 6c61 696e 2064 6963 742c  th a plain dict,
-0000b540: 204f 520a 2020 2020 2020 2020 2020 2020   OR.            
-0000b550: 2320 6e61 6d65 2069 7320 6e6f 7420 7468  # name is not th
-0000b560: 6520 746f 7020 6c61 7965 7227 7320 6e61  e top layer's na
-0000b570: 6d65 2028 7468 6973 2063 616e 2068 6170  me (this can hap
-0000b580: 7065 6e20 6166 7465 7220 7468 6520 6c61  pen after the la
-0000b590: 7965 7220 6973 0a20 2020 2020 2020 2020  yer is.         
-0000b5a0: 2020 2023 206d 616e 6970 756c 6174 6564     # manipulated
-0000b5b0: 2c20 746f 2061 766f 6964 2061 2063 6f6c  , to avoid a col
-0000b5c0: 6c69 7369 6f6e 290a 2020 2020 2020 2020  lision).        
-0000b5d0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-0000b5e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000b5f0: 2020 2069 6620 6c61 7965 722e 636f 6c6c     if layer.coll
-0000b600: 6563 7469 6f6e 5f61 6e6e 6f74 6174 696f  ection_annotatio
-0000b610: 6e73 2069 7320 4e6f 6e65 3a0a 2020 2020  ns is None:.    
-0000b620: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000b630: 722e 636f 6c6c 6563 7469 6f6e 5f61 6e6e  r.collection_ann
-0000b640: 6f74 6174 696f 6e73 203d 207b 0a20 2020  otations = {.   
-0000b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b660: 2022 7368 6170 6522 3a20 7365 6c66 2e73   "shape": self.s
-0000b670: 6861 7065 2c0a 2020 2020 2020 2020 2020  hape,.          
-0000b680: 2020 2020 2020 2020 2020 2264 7479 7065            "dtype
-0000b690: 223a 2073 656c 662e 6474 7970 652c 0a20  ": self.dtype,. 
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6b0: 2020 2022 6368 756e 6b73 697a 6522 3a20     "chunksize": 
-0000b6c0: 7365 6c66 2e63 6875 6e6b 7369 7a65 2c0a  self.chunksize,.
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 2263 6875 6e6b 7322 3a20 7365      "chunks": se
-0000b6f0: 6c66 2e63 6875 6e6b 732c 0a20 2020 2020  lf.chunks,.     
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b710: 7479 7065 223a 2074 7970 656e 616d 6528  type": typename(
-0000b720: 7479 7065 2873 656c 6629 292c 0a20 2020  type(self)),.   
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b740: 2022 6368 756e 6b5f 7479 7065 223a 2074   "chunk_type": t
-0000b750: 7970 656e 616d 6528 7479 7065 2873 656c  ypename(type(sel
-0000b760: 662e 5f6d 6574 6129 292c 0a20 2020 2020  f._meta)),.     
-0000b770: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
-0000b780: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000b790: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b7a0: 6179 6572 2e63 6f6c 6c65 6374 696f 6e5f  ayer.collection_
-0000b7b0: 616e 6e6f 7461 7469 6f6e 732e 7570 6461  annotations.upda
-0000b7c0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-0000b7d0: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
+00007df0: 2261 7272 6179 2d6c 6f63 6174 696f 6e22  "array-location"
+00007e00: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
+00007e10: 2020 2020 2020 2020 2020 2020 2873 7461              (sta
+00007e20: 7274 735b 695d 5b69 6a5d 5b6a 5d2c 2073  rts[i][ij][j], s
+00007e30: 7461 7274 735b 695d 5b69 6a5d 5b6a 202b  tarts[i][ij][j +
+00007e40: 2031 5d29 0a20 2020 2020 2020 2020 2020   1]).           
+00007e50: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00007e60: 2069 6a2c 206a 2069 6e20 656e 756d 6572   ij, j in enumer
+00007e70: 6174 6528 6172 725f 6b29 0a20 2020 2020  ate(arr_k).     
+00007e80: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00007e90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007ea0: 2020 2020 2020 2263 6875 6e6b 2d6c 6f63        "chunk-loc
+00007eb0: 6174 696f 6e22 3a20 6172 725f 6b2c 0a20  ation": arr_k,. 
+00007ec0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00007ed0: 0a0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00007ee0: 666f 5b4e 6f6e 655d 203d 207b 0a20 2020  fo[None] = {.   
+00007ef0: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
+00007f00: 6170 6522 3a20 6f75 742e 7368 6170 652c  ape": out.shape,
+00007f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007f20: 2022 6e75 6d2d 6368 756e 6b73 223a 206f   "num-chunks": o
+00007f30: 7574 2e6e 756d 626c 6f63 6b73 2c0a 2020  ut.numblocks,.  
+00007f40: 2020 2020 2020 2020 2020 2020 2020 2261                "a
+00007f50: 7272 6179 2d6c 6f63 6174 696f 6e22 3a20  rray-location": 
+00007f60: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00007f70: 2020 2020 2020 286f 7574 5f73 7461 7274        (out_start
+00007f80: 735b 696a 5d5b 6a5d 2c20 6f75 745f 7374  s[ij][j], out_st
+00007f90: 6172 7473 5b69 6a5d 5b6a 202b 2031 5d29  arts[ij][j + 1])
+00007fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007fb0: 2020 2020 2066 6f72 2069 6a2c 206a 2069       for ij, j i
+00007fc0: 6e20 656e 756d 6572 6174 6528 626c 6f63  n enumerate(bloc
+00007fd0: 6b5f 6964 290a 2020 2020 2020 2020 2020  k_id).          
+00007fe0: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
+00007ff0: 2020 2020 2020 2020 2022 6368 756e 6b2d           "chunk-
+00008000: 6c6f 6361 7469 6f6e 223a 2062 6c6f 636b  location": block
+00008010: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00008020: 2020 2020 2022 6368 756e 6b2d 7368 6170       "chunk-shap
+00008030: 6522 3a20 7475 706c 6528 0a20 2020 2020  e": tuple(.     
+00008040: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00008050: 7574 2e63 6875 6e6b 735b 696a 5d5b 6a5d  ut.chunks[ij][j]
+00008060: 2066 6f72 2069 6a2c 206a 2069 6e20 656e   for ij, j in en
+00008070: 756d 6572 6174 6528 626c 6f63 6b5f 6964  umerate(block_id
+00008080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00008090: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+000080a0: 2020 2020 2022 6474 7970 6522 3a20 6474       "dtype": dt
+000080b0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+000080c0: 207d 0a20 2020 2020 2020 2020 2020 2062   }.            b
+000080d0: 6c6f 636b 5f69 6e66 6f5f 6473 6b5b 2862  lock_info_dsk[(b
+000080e0: 6c6f 636b 5f69 6e66 6f5f 6e61 6d65 2c29  lock_info_name,)
+000080f0: 202b 2062 6c6f 636b 5f69 645d 203d 2069   + block_id] = i
+00008100: 6e66 6f0a 0a20 2020 2020 2020 2062 6c6f  nfo..        blo
+00008110: 636b 5f69 6e66 6f20 3d20 4172 7261 7928  ck_info = Array(
+00008120: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
+00008130: 636b 5f69 6e66 6f5f 6473 6b2c 0a20 2020  ck_info_dsk,.   
+00008140: 2020 2020 2020 2020 2062 6c6f 636b 5f69           block_i
+00008150: 6e66 6f5f 6e61 6d65 2c0a 2020 2020 2020  nfo_name,.      
+00008160: 2020 2020 2020 6368 756e 6b73 3d74 7570        chunks=tup
+00008170: 6c65 2828 312c 2920 2a20 6c65 6e28 6329  le((1,) * len(c)
+00008180: 2066 6f72 2063 2069 6e20 6f75 742e 6368   for c in out.ch
+00008190: 756e 6b73 292c 0a20 2020 2020 2020 2020  unks),.         
+000081a0: 2020 2064 7479 7065 3d6e 702e 6f62 6a65     dtype=np.obje
+000081b0: 6374 5f2c 0a20 2020 2020 2020 2029 0a20  ct_,.        ). 
+000081c0: 2020 2020 2020 2065 7874 7261 5f61 7267         extra_arg
+000081d0: 7061 6972 732e 6170 7065 6e64 2828 626c  pairs.append((bl
+000081e0: 6f63 6b5f 696e 666f 2c20 6f75 745f 696e  ock_info, out_in
+000081f0: 6429 290a 2020 2020 2020 2020 6578 7472  d)).        extr
+00008200: 615f 6e61 6d65 732e 6170 7065 6e64 2822  a_names.append("
+00008210: 626c 6f63 6b5f 696e 666f 2229 0a0a 2020  block_info")..  
+00008220: 2020 6966 2065 7874 7261 5f61 7267 7061    if extra_argpa
+00008230: 6972 733a 0a20 2020 2020 2020 2023 2052  irs:.        # R
+00008240: 6577 7269 7465 2074 6865 2042 6c6f 636b  ewrite the Block
+00008250: 7769 7365 206c 6179 6572 2e20 4974 2077  wise layer. It w
+00008260: 6f75 6c64 2062 6520 6e69 6365 2074 6f20  ould be nice to 
+00008270: 6669 6e64 2061 2077 6179 2074 6f0a 2020  find a way to.  
+00008280: 2020 2020 2020 2320 6176 6f69 6420 646f        # avoid do
+00008290: 696e 6720 6974 2074 7769 6365 2c20 6275  ing it twice, bu
+000082a0: 7420 6974 2773 2063 7572 7265 6e74 6c79  t it's currently
+000082b0: 206e 6565 6465 6420 746f 2064 6574 6572   needed to deter
+000082c0: 6d69 6e65 0a20 2020 2020 2020 2023 206f  mine.        # o
+000082d0: 7574 2e63 6875 6e6b 7320 6672 6f6d 2074  ut.chunks from t
+000082e0: 6865 2066 6972 7374 2070 6173 732e 2053  he first pass. S
+000082f0: 696e 6365 2069 7420 636f 6e73 7472 7563  ince it construc
+00008300: 7473 2061 2042 6c6f 636b 7769 7365 0a20  ts a Blockwise. 
+00008310: 2020 2020 2020 2023 2072 6174 6865 7220         # rather 
+00008320: 7468 616e 2061 6e20 6578 7061 6e64 6564  than an expanded
+00008330: 2067 7261 7068 2c20 6974 2073 686f 756c   graph, it shoul
+00008340: 646e 2774 2062 6520 746f 6f20 6578 7065  dn't be too expe
+00008350: 6e73 6976 652e 0a20 2020 2020 2020 206f  nsive..        o
+00008360: 7574 203d 2062 6c6f 636b 7769 7365 280a  ut = blockwise(.
+00008370: 2020 2020 2020 2020 2020 2020 5f70 6173              _pas
+00008380: 735f 6578 7472 615f 6b77 6172 6773 2c0a  s_extra_kwargs,.
+00008390: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
+000083a0: 696e 642c 0a20 2020 2020 2020 2020 2020  ind,.           
+000083b0: 2066 756e 632c 0a20 2020 2020 2020 2020   func,.         
+000083c0: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
+000083d0: 2020 2020 2074 7570 6c65 2865 7874 7261       tuple(extra
+000083e0: 5f6e 616d 6573 292c 0a20 2020 2020 2020  _names),.       
+000083f0: 2020 2020 204e 6f6e 652c 0a20 2020 2020       None,.     
+00008400: 2020 2020 2020 202a 636f 6e63 6174 2865         *concat(e
+00008410: 7874 7261 5f61 7267 7061 6972 7329 2c0a  xtra_argpairs),.
+00008420: 2020 2020 2020 2020 2020 2020 2a63 6f6e              *con
+00008430: 6361 7428 6172 6770 6169 7273 292c 0a20  cat(argpairs),. 
+00008440: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+00008450: 6f75 742e 6e61 6d65 2c0a 2020 2020 2020  out.name,.      
+00008460: 2020 2020 2020 6474 7970 653d 6f75 742e        dtype=out.
+00008470: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+00008480: 2020 2063 6f6e 6361 7465 6e61 7465 3d54     concatenate=T
+00008490: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+000084a0: 2061 6c69 676e 5f61 7272 6179 733d 4661   align_arrays=Fa
+000084b0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+000084c0: 2061 646a 7573 745f 6368 756e 6b73 3d64   adjust_chunks=d
+000084d0: 6963 7428 7a69 7028 6f75 745f 696e 642c  ict(zip(out_ind,
+000084e0: 206f 7574 2e63 6875 6e6b 7329 292c 0a20   out.chunks)),. 
+000084f0: 2020 2020 2020 2020 2020 206d 6574 613d             meta=
+00008500: 6d65 7461 2c0a 2020 2020 2020 2020 2020  meta,.          
+00008510: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00008520: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
+00008530: 6e20 6f75 740a 0a0a 6465 6620 6170 706c  n out...def appl
+00008540: 795f 616e 645f 656e 666f 7263 6528 2a61  y_and_enforce(*a
+00008550: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00008560: 2020 2020 2222 2241 7070 6c79 2061 2066      """Apply a f
+00008570: 756e 6374 696f 6e2c 2061 6e64 2065 6e66  unction, and enf
+00008580: 6f72 6365 2074 6865 206f 7574 7075 742e  orce the output.
+00008590: 6e64 696d 2074 6f20 6d61 7463 6820 6578  ndim to match ex
+000085a0: 7065 6374 6564 5f6e 6469 6d0a 0a20 2020  pected_ndim..   
+000085b0: 2045 6e73 7572 6573 2074 6865 206f 7574   Ensures the out
+000085c0: 7075 7420 6861 7320 7468 6520 6578 7065  put has the expe
+000085d0: 6374 6564 2064 696d 656e 7369 6f6e 616c  cted dimensional
+000085e0: 6974 792e 2222 220a 2020 2020 6675 6e63  ity.""".    func
+000085f0: 203d 206b 7761 7267 732e 706f 7028 225f   = kwargs.pop("_
+00008600: 6675 6e63 2229 0a20 2020 2065 7870 6563  func").    expec
+00008610: 7465 645f 6e64 696d 203d 206b 7761 7267  ted_ndim = kwarg
+00008620: 732e 706f 7028 2265 7870 6563 7465 645f  s.pop("expected_
+00008630: 6e64 696d 2229 0a20 2020 206f 7574 203d  ndim").    out =
+00008640: 2066 756e 6328 2a61 7267 732c 202a 2a6b   func(*args, **k
+00008650: 7761 7267 7329 0a20 2020 2069 6620 6765  wargs).    if ge
+00008660: 7461 7474 7228 6f75 742c 2022 6e64 696d  tattr(out, "ndim
+00008670: 222c 2030 2920 213d 2065 7870 6563 7465  ", 0) != expecte
+00008680: 645f 6e64 696d 3a0a 2020 2020 2020 2020  d_ndim:.        
+00008690: 6f75 745f 6e64 696d 203d 2067 6574 6174  out_ndim = getat
+000086a0: 7472 286f 7574 2c20 226e 6469 6d22 2c20  tr(out, "ndim", 
+000086b0: 3029 0a20 2020 2020 2020 2072 6169 7365  0).        raise
+000086c0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+000086d0: 2020 2020 2020 2020 2066 2244 696d 656e           f"Dimen
+000086e0: 7369 6f6e 206d 6973 6d61 7463 683a 2065  sion mismatch: e
+000086f0: 7870 6563 7465 6420 6f75 7470 7574 206f  xpected output o
+00008700: 6620 7b66 756e 637d 2022 0a20 2020 2020  f {func} ".     
+00008710: 2020 2020 2020 2066 2274 6f20 6861 7665         f"to have
+00008720: 2064 696d 7320 3d20 7b65 7870 6563 7465   dims = {expecte
+00008730: 645f 6e64 696d 7d2e 2020 476f 7420 7b6f  d_ndim}.  Got {o
+00008740: 7574 5f6e 6469 6d7d 2069 6e73 7465 6164  ut_ndim} instead
+00008750: 2e22 0a20 2020 2020 2020 2029 0a20 2020  .".        ).   
+00008760: 2072 6574 7572 6e20 6f75 740a 0a0a 6465   return out...de
+00008770: 6620 6272 6f61 6463 6173 745f 6368 756e  f broadcast_chun
+00008780: 6b73 282a 6368 756e 6b73 7329 3a0a 2020  ks(*chunkss):.  
+00008790: 2020 2222 2243 6f6e 7374 7275 6374 2061    """Construct a
+000087a0: 2063 6875 6e6b 7320 7475 706c 6520 7468   chunks tuple th
+000087b0: 6174 2062 726f 6164 6361 7374 7320 6d61  at broadcasts ma
+000087c0: 6e79 2063 6875 6e6b 7320 7475 706c 6573  ny chunks tuples
+000087d0: 0a0a 2020 2020 3e3e 3e20 6120 3d20 2828  ..    >>> a = ((
+000087e0: 352c 2035 292c 290a 2020 2020 3e3e 3e20  5, 5),).    >>> 
+000087f0: 6220 3d20 2828 352c 2035 292c 290a 2020  b = ((5, 5),).  
+00008800: 2020 3e3e 3e20 6272 6f61 6463 6173 745f    >>> broadcast_
+00008810: 6368 756e 6b73 2861 2c20 6229 0a20 2020  chunks(a, b).   
+00008820: 2028 2835 2c20 3529 2c29 0a0a 2020 2020   ((5, 5),)..    
+00008830: 3e3e 3e20 6120 3d20 2828 3130 2c20 3130  >>> a = ((10, 10
+00008840: 2c20 3130 292c 2028 352c 2035 292c 290a  , 10), (5, 5),).
+00008850: 2020 2020 3e3e 3e20 6220 3d20 2828 352c      >>> b = ((5,
+00008860: 2035 292c 290a 2020 2020 3e3e 3e20 6272   5),).    >>> br
+00008870: 6f61 6463 6173 745f 6368 756e 6b73 2861  oadcast_chunks(a
+00008880: 2c20 6229 0a20 2020 2028 2831 302c 2031  , b).    ((10, 1
+00008890: 302c 2031 3029 2c20 2835 2c20 3529 290a  0, 10), (5, 5)).
+000088a0: 0a20 2020 203e 3e3e 2061 203d 2028 2831  .    >>> a = ((1
+000088b0: 302c 2031 302c 2031 3029 2c20 2835 2c20  0, 10, 10), (5, 
+000088c0: 3529 2c29 0a20 2020 203e 3e3e 2062 203d  5),).    >>> b =
+000088d0: 2028 2831 2c29 2c20 2835 2c20 3529 2c29   ((1,), (5, 5),)
+000088e0: 0a20 2020 203e 3e3e 2062 726f 6164 6361  .    >>> broadca
+000088f0: 7374 5f63 6875 6e6b 7328 612c 2062 290a  st_chunks(a, b).
+00008900: 2020 2020 2828 3130 2c20 3130 2c20 3130      ((10, 10, 10
+00008910: 292c 2028 352c 2035 2929 0a0a 2020 2020  ), (5, 5))..    
+00008920: 3e3e 3e20 6120 3d20 2828 3130 2c20 3130  >>> a = ((10, 10
+00008930: 2c20 3130 292c 2028 352c 2035 292c 290a  , 10), (5, 5),).
+00008940: 2020 2020 3e3e 3e20 6220 3d20 2828 332c      >>> b = ((3,
+00008950: 2033 2c29 2c20 2835 2c20 3529 2c29 0a20   3,), (5, 5),). 
+00008960: 2020 203e 3e3e 2062 726f 6164 6361 7374     >>> broadcast
+00008970: 5f63 6875 6e6b 7328 612c 2062 290a 2020  _chunks(a, b).  
+00008980: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
+00008990: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
+000089a0: 7374 293a 0a20 2020 2020 2020 202e 2e2e  st):.        ...
+000089b0: 0a20 2020 2056 616c 7565 4572 726f 723a  .    ValueError:
+000089c0: 2043 6875 6e6b 7320 646f 206e 6f74 2061   Chunks do not a
+000089d0: 6c69 676e 3a20 5b28 3130 2c20 3130 2c20  lign: [(10, 10, 
+000089e0: 3130 292c 2028 332c 2033 295d 0a20 2020  10), (3, 3)].   
+000089f0: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
+00008a00: 6368 756e 6b73 733a 0a20 2020 2020 2020  chunkss:.       
+00008a10: 2072 6574 7572 6e20 2829 0a20 2020 2065   return ().    e
+00008a20: 6c69 6620 6c65 6e28 6368 756e 6b73 7329  lif len(chunkss)
+00008a30: 203d 3d20 313a 0a20 2020 2020 2020 2072   == 1:.        r
+00008a40: 6574 7572 6e20 6368 756e 6b73 735b 305d  eturn chunkss[0]
+00008a50: 0a20 2020 206e 203d 206d 6178 286d 6170  .    n = max(map
+00008a60: 286c 656e 2c20 6368 756e 6b73 7329 290a  (len, chunkss)).
+00008a70: 2020 2020 6368 756e 6b73 7332 203d 205b      chunkss2 = [
+00008a80: 2828 312c 292c 2920 2a20 286e 202d 206c  ((1,),) * (n - l
+00008a90: 656e 2863 2929 202b 2063 2066 6f72 2063  en(c)) + c for c
+00008aa0: 2069 6e20 6368 756e 6b73 735d 0a20 2020   in chunkss].   
+00008ab0: 2072 6573 756c 7420 3d20 5b5d 0a20 2020   result = [].   
+00008ac0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00008ad0: 6e29 3a0a 2020 2020 2020 2020 7374 6570  n):.        step
+00008ae0: 3120 3d20 5b63 5b69 5d20 666f 7220 6320  1 = [c[i] for c 
+00008af0: 696e 2063 6875 6e6b 7373 325d 0a20 2020  in chunkss2].   
+00008b00: 2020 2020 2069 6620 616c 6c28 6320 3d3d       if all(c ==
+00008b10: 2028 312c 2920 666f 7220 6320 696e 2073   (1,) for c in s
+00008b20: 7465 7031 293a 0a20 2020 2020 2020 2020  tep1):.         
+00008b30: 2020 2073 7465 7032 203d 2073 7465 7031     step2 = step1
+00008b40: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00008b50: 2020 2020 2020 2020 2020 2073 7465 7032             step2
+00008b60: 203d 205b 6320 666f 7220 6320 696e 2073   = [c for c in s
+00008b70: 7465 7031 2069 6620 6320 213d 2028 312c  tep1 if c != (1,
+00008b80: 295d 0a20 2020 2020 2020 2069 6620 6c65  )].        if le
+00008b90: 6e28 7365 7428 7374 6570 3229 2920 213d  n(set(step2)) !=
+00008ba0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00008bb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00008bc0: 2822 4368 756e 6b73 2064 6f20 6e6f 7420  ("Chunks do not 
+00008bd0: 616c 6967 6e3a 2025 7322 2025 2073 7472  align: %s" % str
+00008be0: 2873 7465 7032 2929 0a20 2020 2020 2020  (step2)).       
+00008bf0: 2072 6573 756c 742e 6170 7065 6e64 2873   result.append(s
+00008c00: 7465 7032 5b30 5d29 0a20 2020 2072 6574  tep2[0]).    ret
+00008c10: 7572 6e20 7475 706c 6528 7265 7375 6c74  urn tuple(result
+00008c20: 290a 0a0a 6465 6620 7374 6f72 6528 0a20  )...def store(. 
+00008c30: 2020 2073 6f75 7263 6573 3a20 4172 7261     sources: Arra
+00008c40: 7920 7c20 436f 6c6c 6563 7469 6f6e 5b41  y | Collection[A
+00008c50: 7272 6179 5d2c 0a20 2020 2074 6172 6765  rray],.    targe
+00008c60: 7473 3a20 4172 7261 794c 696b 6520 7c20  ts: ArrayLike | 
+00008c70: 4465 6c61 7965 6420 7c20 436f 6c6c 6563  Delayed | Collec
+00008c80: 7469 6f6e 5b41 7272 6179 4c69 6b65 207c  tion[ArrayLike |
+00008c90: 2044 656c 6179 6564 5d2c 0a20 2020 206c   Delayed],.    l
+00008ca0: 6f63 6b3a 2062 6f6f 6c20 7c20 4c6f 636b  ock: bool | Lock
+00008cb0: 203d 2054 7275 652c 0a20 2020 2072 6567   = True,.    reg
+00008cc0: 696f 6e73 3a20 7475 706c 655b 736c 6963  ions: tuple[slic
+00008cd0: 652c 202e 2e2e 5d20 7c20 436f 6c6c 6563  e, ...] | Collec
+00008ce0: 7469 6f6e 5b74 7570 6c65 5b73 6c69 6365  tion[tuple[slice
+00008cf0: 2c20 2e2e 2e5d 5d20 7c20 4e6f 6e65 203d  , ...]] | None =
+00008d00: 204e 6f6e 652c 0a20 2020 2063 6f6d 7075   None,.    compu
+00008d10: 7465 3a20 626f 6f6c 203d 2054 7275 652c  te: bool = True,
+00008d20: 0a20 2020 2072 6574 7572 6e5f 7374 6f72  .    return_stor
+00008d30: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
+00008d40: 2c0a 2020 2020 2a2a 6b77 6172 6773 2c0a  ,.    **kwargs,.
+00008d50: 293a 0a20 2020 2022 2222 5374 6f72 6520  ):.    """Store 
+00008d60: 6461 736b 2061 7272 6179 7320 696e 2061  dask arrays in a
+00008d70: 7272 6179 2d6c 696b 6520 6f62 6a65 6374  rray-like object
+00008d80: 732c 206f 7665 7277 7269 7465 2064 6174  s, overwrite dat
+00008d90: 6120 696e 2074 6172 6765 740a 0a20 2020  a in target..   
+00008da0: 2054 6869 7320 7374 6f72 6573 2064 6173   This stores das
+00008db0: 6b20 6172 7261 7973 2069 6e74 6f20 6f62  k arrays into ob
+00008dc0: 6a65 6374 2074 6861 7420 7375 7070 6f72  ject that suppor
+00008dd0: 7473 206e 756d 7079 2d73 7479 6c65 2073  ts numpy-style s
+00008de0: 6574 6974 656d 0a20 2020 2069 6e64 6578  etitem.    index
+00008df0: 696e 672e 2020 4974 2073 746f 7265 7320  ing.  It stores 
+00008e00: 7661 6c75 6573 2063 6875 6e6b 2062 7920  values chunk by 
+00008e10: 6368 756e 6b20 736f 2074 6861 7420 6974  chunk so that it
+00008e20: 2064 6f65 7320 6e6f 7420 6861 7665 2074   does not have t
+00008e30: 6f0a 2020 2020 6669 6c6c 2075 7020 6d65  o.    fill up me
+00008e40: 6d6f 7279 2e20 2046 6f72 2062 6573 7420  mory.  For best 
+00008e50: 7065 7266 6f72 6d61 6e63 6520 796f 7520  performance you 
+00008e60: 6361 6e20 616c 6967 6e20 7468 6520 626c  can align the bl
+00008e70: 6f63 6b20 7369 7a65 206f 660a 2020 2020  ock size of.    
+00008e80: 7468 6520 7374 6f72 6167 6520 7461 7267  the storage targ
+00008e90: 6574 2077 6974 6820 7468 6520 626c 6f63  et with the bloc
+00008ea0: 6b20 7369 7a65 206f 6620 796f 7572 2061  k size of your a
+00008eb0: 7272 6179 2e0a 0a20 2020 2049 6620 796f  rray...    If yo
+00008ec0: 7572 2064 6174 6120 6669 7473 2069 6e20  ur data fits in 
+00008ed0: 6d65 6d6f 7279 2074 6865 6e20 796f 7520  memory then you 
+00008ee0: 6d61 7920 7072 6566 6572 2063 616c 6c69  may prefer calli
+00008ef0: 6e67 0a20 2020 2060 606e 702e 6172 7261  ng.    ``np.arra
+00008f00: 7928 6d79 6172 7261 7929 6060 2069 6e73  y(myarray)`` ins
+00008f10: 7465 6164 2e0a 0a20 2020 2050 6172 616d  tead...    Param
+00008f20: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00008f30: 2d2d 2d2d 0a0a 2020 2020 736f 7572 6365  ----..    source
+00008f40: 733a 2041 7272 6179 206f 7220 636f 6c6c  s: Array or coll
+00008f50: 6563 7469 6f6e 206f 6620 4172 7261 7973  ection of Arrays
+00008f60: 0a20 2020 2074 6172 6765 7473 3a20 6172  .    targets: ar
+00008f70: 7261 792d 6c69 6b65 206f 7220 4465 6c61  ray-like or Dela
+00008f80: 7965 6420 6f72 2063 6f6c 6c65 6374 696f  yed or collectio
+00008f90: 6e20 6f66 2061 7272 6179 2d6c 696b 6573  n of array-likes
+00008fa0: 2061 6e64 2f6f 7220 4465 6c61 7965 6473   and/or Delayeds
+00008fb0: 0a20 2020 2020 2020 2054 6865 7365 2073  .        These s
+00008fc0: 686f 756c 6420 7375 7070 6f72 7420 7365  hould support se
+00008fd0: 7469 7465 6d20 7379 6e74 6178 2060 6074  titem syntax ``t
+00008fe0: 6172 6765 745b 3130 3a32 305d 203d 202e  arget[10:20] = .
+00008ff0: 2e2e 6060 2e0a 2020 2020 2020 2020 4966  ..``..        If
+00009000: 2073 6f75 7263 6573 2069 7320 6120 7369   sources is a si
+00009010: 6e67 6c65 2069 7465 6d2c 2074 6172 6765  ngle item, targe
+00009020: 7473 206d 7573 7420 6265 2061 2073 696e  ts must be a sin
+00009030: 676c 6520 6974 656d 3b20 6966 2073 6f75  gle item; if sou
+00009040: 7263 6573 2069 7320 610a 2020 2020 2020  rces is a.      
+00009050: 2020 636f 6c6c 6563 7469 6f6e 206f 6620    collection of 
+00009060: 6172 7261 7973 2c20 7461 7267 6574 7320  arrays, targets 
+00009070: 6d75 7374 2062 6520 6120 6d61 7463 6869  must be a matchi
+00009080: 6e67 2063 6f6c 6c65 6374 696f 6e2e 0a20  ng collection.. 
+00009090: 2020 206c 6f63 6b3a 2062 6f6f 6c65 616e     lock: boolean
+000090a0: 206f 7220 7468 7265 6164 696e 672e 4c6f   or threading.Lo
+000090b0: 636b 2c20 6f70 7469 6f6e 616c 0a20 2020  ck, optional.   
+000090c0: 2020 2020 2057 6865 7468 6572 206f 7220       Whether or 
+000090d0: 6e6f 7420 746f 206c 6f63 6b20 7468 6520  not to lock the 
+000090e0: 6461 7461 2073 746f 7265 7320 7768 696c  data stores whil
+000090f0: 6520 7374 6f72 696e 672e 0a20 2020 2020  e storing..     
+00009100: 2020 2050 6173 7320 5472 7565 2028 6c6f     Pass True (lo
+00009110: 636b 2065 6163 6820 6669 6c65 2069 6e64  ck each file ind
+00009120: 6976 6964 7561 6c6c 7929 2c20 4661 6c73  ividually), Fals
+00009130: 6520 2864 6f6e 2774 206c 6f63 6b29 206f  e (don't lock) o
+00009140: 7220 610a 2020 2020 2020 2020 7061 7274  r a.        part
+00009150: 6963 756c 6172 203a 636c 6173 733a 6074  icular :class:`t
+00009160: 6872 6561 6469 6e67 2e4c 6f63 6b60 206f  hreading.Lock` o
+00009170: 626a 6563 7420 746f 2062 6520 7368 6172  bject to be shar
+00009180: 6564 2061 6d6f 6e67 2061 6c6c 2077 7269  ed among all wri
+00009190: 7465 732e 0a20 2020 2072 6567 696f 6e73  tes..    regions
+000091a0: 3a20 7475 706c 6520 6f66 2073 6c69 6365  : tuple of slice
+000091b0: 7320 6f72 2063 6f6c 6c65 6374 696f 6e20  s or collection 
+000091c0: 6f66 2074 7570 6c65 7320 6f66 2073 6c69  of tuples of sli
+000091d0: 6365 732c 206f 7074 696f 6e61 6c0a 2020  ces, optional.  
+000091e0: 2020 2020 2020 4561 6368 2060 6072 6567        Each ``reg
+000091f0: 696f 6e60 6020 7475 706c 6520 696e 2060  ion`` tuple in `
+00009200: 6072 6567 696f 6e73 6060 2073 686f 756c  `regions`` shoul
+00009210: 6420 6265 2073 7563 6820 7468 6174 0a20  d be such that. 
+00009220: 2020 2020 2020 2060 6074 6172 6765 745b         ``target[
+00009230: 7265 6769 6f6e 5d2e 7368 6170 6520 3d20  region].shape = 
+00009240: 736f 7572 6365 2e73 6861 7065 6060 0a20  source.shape``. 
+00009250: 2020 2020 2020 2066 6f72 2074 6865 2063         for the c
+00009260: 6f72 7265 7370 6f6e 6469 6e67 2073 6f75  orresponding sou
+00009270: 7263 6520 616e 6420 7461 7267 6574 2069  rce and target i
+00009280: 6e20 736f 7572 6365 7320 616e 6420 7461  n sources and ta
+00009290: 7267 6574 732c 0a20 2020 2020 2020 2072  rgets,.        r
+000092a0: 6573 7065 6374 6976 656c 792e 2049 6620  espectively. If 
+000092b0: 7468 6973 2069 7320 6120 7475 706c 652c  this is a tuple,
+000092c0: 2074 6865 2063 6f6e 7465 6e74 7320 7769   the contents wi
+000092d0: 6c6c 2062 6520 6173 7375 6d65 6420 746f  ll be assumed to
+000092e0: 2062 650a 2020 2020 2020 2020 736c 6963   be.        slic
+000092f0: 6573 2c20 736f 2064 6f20 6e6f 7420 7072  es, so do not pr
+00009300: 6f76 6964 6520 6120 7475 706c 6520 6f66  ovide a tuple of
+00009310: 2074 7570 6c65 732e 0a20 2020 2063 6f6d   tuples..    com
+00009320: 7075 7465 3a20 626f 6f6c 6561 6e2c 206f  pute: boolean, o
+00009330: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00009340: 4966 2074 7275 6520 636f 6d70 7574 6520  If true compute 
+00009350: 696d 6d65 6469 6174 656c 793b 2072 6574  immediately; ret
+00009360: 7572 6e20 3a63 6c61 7373 3a60 6461 736b  urn :class:`dask
+00009370: 2e64 656c 6179 6564 2e44 656c 6179 6564  .delayed.Delayed
+00009380: 6020 6f74 6865 7277 6973 652e 0a20 2020  ` otherwise..   
+00009390: 2072 6574 7572 6e5f 7374 6f72 6564 3a20   return_stored: 
+000093a0: 626f 6f6c 6561 6e2c 206f 7074 696f 6e61  boolean, optiona
+000093b0: 6c0a 2020 2020 2020 2020 4f70 7469 6f6e  l.        Option
+000093c0: 616c 6c79 2072 6574 7572 6e20 7468 6520  ally return the 
+000093d0: 7374 6f72 6564 2072 6573 756c 7420 2864  stored result (d
+000093e0: 6566 6175 6c74 2046 616c 7365 292e 0a20  efault False).. 
+000093f0: 2020 206b 7761 7267 733a 0a20 2020 2020     kwargs:.     
+00009400: 2020 2050 6172 616d 6574 6572 7320 7061     Parameters pa
+00009410: 7373 6564 2074 6f20 636f 6d70 7574 652f  ssed to compute/
+00009420: 7065 7273 6973 7420 286f 6e6c 7920 7573  persist (only us
+00009430: 6564 2069 6620 636f 6d70 7574 653d 5472  ed if compute=Tr
+00009440: 7565 290a 0a20 2020 2052 6574 7572 6e73  ue)..    Returns
+00009450: 0a20 2020 202d 2d2d 2d2d 2d2d 0a0a 2020  .    -------..  
+00009460: 2020 4966 2072 6574 7572 6e5f 7374 6f72    If return_stor
+00009470: 6564 3d54 7275 650a 2020 2020 2020 2020  ed=True.        
+00009480: 7475 706c 6520 6f66 2041 7272 6179 730a  tuple of Arrays.
+00009490: 2020 2020 4966 2072 6574 7572 6e5f 7374      If return_st
+000094a0: 6f72 6564 3d46 616c 7365 2061 6e64 2063  ored=False and c
+000094b0: 6f6d 7075 7465 3d54 7275 650a 2020 2020  ompute=True.    
+000094c0: 2020 2020 4e6f 6e65 0a20 2020 2049 6620      None.    If 
+000094d0: 7265 7475 726e 5f73 746f 7265 643d 4661  return_stored=Fa
+000094e0: 6c73 6520 616e 6420 636f 6d70 7574 653d  lse and compute=
+000094f0: 4661 6c73 650a 2020 2020 2020 2020 4465  False.        De
+00009500: 6c61 7965 640a 0a20 2020 2045 7861 6d70  layed..    Examp
+00009510: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+00009520: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
+00009530: 2068 3570 7920 2023 2064 6f63 7465 7374   h5py  # doctest
+00009540: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
+00009550: 6620 3d20 6835 7079 2e46 696c 6528 276d  f = h5py.File('m
+00009560: 7966 696c 652e 6864 6635 272c 206d 6f64  yfile.hdf5', mod
+00009570: 653d 2761 2729 2020 2320 646f 6374 6573  e='a')  # doctes
+00009580: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
+00009590: 2064 7365 7420 3d20 662e 6372 6561 7465   dset = f.create
+000095a0: 5f64 6174 6173 6574 2827 2f64 6174 6127  _dataset('/data'
+000095b0: 2c20 7368 6170 653d 782e 7368 6170 652c  , shape=x.shape,
+000095c0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
+000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095e0: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
+000095f0: 3d78 2e63 6875 6e6b 732c 0a20 2020 202e  =x.chunks,.    .
+00009600: 2e2e 2020 2020 2020 2020 2020 2020 2020  ..              
+00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009620: 2020 2020 6474 7970 653d 2766 3827 2920      dtype='f8') 
+00009630: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+00009640: 500a 0a20 2020 203e 3e3e 2073 746f 7265  P..    >>> store
+00009650: 2878 2c20 6473 6574 2920 2023 2064 6f63  (x, dset)  # doc
+00009660: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
+00009670: 2041 6c74 6572 6e61 7469 7665 6c79 2073   Alternatively s
+00009680: 746f 7265 206d 616e 7920 6172 7261 7973  tore many arrays
+00009690: 2061 7420 7468 6520 7361 6d65 2074 696d   at the same tim
+000096a0: 650a 0a20 2020 203e 3e3e 2073 746f 7265  e..    >>> store
+000096b0: 285b 782c 2079 2c20 7a5d 2c20 5b64 7365  ([x, y, z], [dse
+000096c0: 7431 2c20 6473 6574 322c 2064 7365 7433  t1, dset2, dset3
+000096d0: 5d29 2020 2320 646f 6374 6573 743a 202b  ])  # doctest: +
+000096e0: 534b 4950 0a20 2020 2022 2222 0a0a 2020  SKIP.    """..  
+000096f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00009700: 736f 7572 6365 732c 2041 7272 6179 293a  sources, Array):
+00009710: 0a20 2020 2020 2020 2073 6f75 7263 6573  .        sources
+00009720: 203d 205b 736f 7572 6365 735d 0a20 2020   = [sources].   
+00009730: 2020 2020 2023 2054 6865 7265 2773 206e       # There's n
+00009740: 6f20 7761 7920 746f 2074 6573 7420 7468  o way to test th
+00009750: 6174 2074 6172 6765 7473 2069 7320 6120  at targets is a 
+00009760: 7369 6e67 6c65 2061 7272 6179 2d6c 696b  single array-lik
+00009770: 652e 0a20 2020 2020 2020 2023 2057 6520  e..        # We 
+00009780: 6e65 6564 2074 6f20 7472 7573 7420 7468  need to trust th
+00009790: 6520 7573 6572 2e0a 2020 2020 2020 2020  e user..        
+000097a0: 7461 7267 6574 7320 3d20 5b74 6172 6765  targets = [targe
+000097b0: 7473 5d20 2023 2074 7970 653a 2069 676e  ts]  # type: ign
+000097c0: 6f72 650a 2020 2020 7461 7267 6574 7320  ore.    targets 
+000097d0: 3d20 6361 7374 2822 436f 6c6c 6563 7469  = cast("Collecti
+000097e0: 6f6e 5b41 7272 6179 4c69 6b65 207c 2044  on[ArrayLike | D
+000097f0: 656c 6179 6564 5d22 2c20 7461 7267 6574  elayed]", target
+00009800: 7329 0a0a 2020 2020 6966 2061 6e79 286e  s)..    if any(n
+00009810: 6f74 2069 7369 6e73 7461 6e63 6528 732c  ot isinstance(s,
+00009820: 2041 7272 6179 2920 666f 7220 7320 696e   Array) for s in
+00009830: 2073 6f75 7263 6573 293a 0a20 2020 2020   sources):.     
+00009840: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00009850: 726f 7228 2241 6c6c 2073 6f75 7263 6573  ror("All sources
+00009860: 206d 7573 7420 6265 2064 6173 6b20 6172   must be dask ar
+00009870: 7261 7920 6f62 6a65 6374 7322 290a 0a20  ray objects").. 
+00009880: 2020 2069 6620 6c65 6e28 736f 7572 6365     if len(source
+00009890: 7329 2021 3d20 6c65 6e28 7461 7267 6574  s) != len(target
+000098a0: 7329 3a0a 2020 2020 2020 2020 7261 6973  s):.        rais
+000098b0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000098c0: 2020 2020 2020 2020 2020 2244 6966 6665            "Diffe
+000098d0: 7265 6e74 206e 756d 6265 7220 6f66 2073  rent number of s
+000098e0: 6f75 7263 6573 205b 2564 5d20 616e 6420  ources [%d] and 
+000098f0: 7461 7267 6574 7320 5b25 645d 220a 2020  targets [%d]".  
+00009900: 2020 2020 2020 2020 2020 2520 286c 656e            % (len
+00009910: 2873 6f75 7263 6573 292c 206c 656e 2874  (sources), len(t
+00009920: 6172 6765 7473 2929 0a20 2020 2020 2020  argets)).       
+00009930: 2029 0a0a 2020 2020 6966 2069 7369 6e73   )..    if isins
+00009940: 7461 6e63 6528 7265 6769 6f6e 732c 2074  tance(regions, t
+00009950: 7570 6c65 2920 6f72 2072 6567 696f 6e73  uple) or regions
+00009960: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00009970: 2020 7265 6769 6f6e 735f 6c69 7374 203d    regions_list =
+00009980: 205b 7265 6769 6f6e 735d 202a 206c 656e   [regions] * len
+00009990: 2873 6f75 7263 6573 290a 2020 2020 656c  (sources).    el
+000099a0: 7365 3a0a 2020 2020 2020 2020 7265 6769  se:.        regi
+000099b0: 6f6e 735f 6c69 7374 203d 206c 6973 7428  ons_list = list(
+000099c0: 7265 6769 6f6e 7329 0a20 2020 2020 2020  regions).       
+000099d0: 2069 6620 6c65 6e28 736f 7572 6365 7329   if len(sources)
+000099e0: 2021 3d20 6c65 6e28 7265 6769 6f6e 735f   != len(regions_
+000099f0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00009a00: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00009a10: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00009a20: 2020 2020 2066 2244 6966 6665 7265 6e74       f"Different
+00009a30: 206e 756d 6265 7220 6f66 2073 6f75 7263   number of sourc
+00009a40: 6573 205b 7b6c 656e 2873 6f75 7263 6573  es [{len(sources
+00009a50: 297d 5d20 616e 6420 220a 2020 2020 2020  )}] and ".      
+00009a60: 2020 2020 2020 2020 2020 6622 7461 7267            f"targ
+00009a70: 6574 7320 5b7b 6c65 6e28 7461 7267 6574  ets [{len(target
+00009a80: 7329 7d5d 2074 6861 6e20 7265 6769 6f6e  s)}] than region
+00009a90: 7320 5b7b 6c65 6e28 7265 6769 6f6e 735f  s [{len(regions_
+00009aa0: 6c69 7374 297d 5d22 0a20 2020 2020 2020  list)}]".       
+00009ab0: 2020 2020 2029 0a20 2020 2064 656c 2072       ).    del r
+00009ac0: 6567 696f 6e73 0a0a 2020 2020 2320 4f70  egions..    # Op
+00009ad0: 7469 6d69 7a65 2061 6c6c 2073 6f75 7263  timize all sourc
+00009ae0: 6573 2074 6f67 6574 6865 720a 2020 2020  es together.    
+00009af0: 736f 7572 6365 735f 686c 6720 3d20 4869  sources_hlg = Hi
+00009b00: 6768 4c65 7665 6c47 7261 7068 2e6d 6572  ghLevelGraph.mer
+00009b10: 6765 282a 5b65 2e5f 5f64 6173 6b5f 6772  ge(*[e.__dask_gr
+00009b20: 6170 685f 5f28 2920 666f 7220 6520 696e  aph__() for e in
+00009b30: 2073 6f75 7263 6573 5d29 0a20 2020 2073   sources]).    s
+00009b40: 6f75 7263 6573 5f6c 6179 6572 203d 2041  ources_layer = A
+00009b50: 7272 6179 2e5f 5f64 6173 6b5f 6f70 7469  rray.__dask_opti
+00009b60: 6d69 7a65 5f5f 280a 2020 2020 2020 2020  mize__(.        
+00009b70: 736f 7572 6365 735f 686c 672c 206c 6973  sources_hlg, lis
+00009b80: 7428 636f 7265 2e66 6c61 7474 656e 285b  t(core.flatten([
+00009b90: 652e 5f5f 6461 736b 5f6b 6579 735f 5f28  e.__dask_keys__(
+00009ba0: 2920 666f 7220 6520 696e 2073 6f75 7263  ) for e in sourc
+00009bb0: 6573 5d29 290a 2020 2020 290a 2020 2020  es])).    ).    
+00009bc0: 736f 7572 6365 735f 6e61 6d65 203d 2022  sources_name = "
+00009bd0: 7374 6f72 652d 736f 7572 6365 732d 2220  store-sources-" 
+00009be0: 2b20 746f 6b65 6e69 7a65 2873 6f75 7263  + tokenize(sourc
+00009bf0: 6573 290a 2020 2020 6c61 7965 7273 203d  es).    layers =
+00009c00: 207b 736f 7572 6365 735f 6e61 6d65 3a20   {sources_name: 
+00009c10: 736f 7572 6365 735f 6c61 7965 727d 0a20  sources_layer}. 
+00009c20: 2020 2064 6570 656e 6465 6e63 6965 733a     dependencies:
+00009c30: 2064 6963 745b 7374 722c 2073 6574 5b73   dict[str, set[s
+00009c40: 7472 5d5d 203d 207b 736f 7572 6365 735f  tr]] = {sources_
+00009c50: 6e61 6d65 3a20 7365 7428 297d 0a0a 2020  name: set()}..  
+00009c60: 2020 2320 4f70 7469 6d69 7a65 2061 6c6c    # Optimize all
+00009c70: 2074 6172 6765 7473 2074 6f67 6574 6865   targets togethe
+00009c80: 720a 2020 2020 7461 7267 6574 735f 6b65  r.    targets_ke
+00009c90: 7973 203d 205b 5d0a 2020 2020 7461 7267  ys = [].    targ
+00009ca0: 6574 735f 6473 6b73 203d 205b 5d0a 2020  ets_dsks = [].  
+00009cb0: 2020 666f 7220 7420 696e 2074 6172 6765    for t in targe
+00009cc0: 7473 3a0a 2020 2020 2020 2020 6966 2069  ts:.        if i
+00009cd0: 7369 6e73 7461 6e63 6528 742c 2044 656c  sinstance(t, Del
+00009ce0: 6179 6564 293a 0a20 2020 2020 2020 2020  ayed):.         
+00009cf0: 2020 2074 6172 6765 7473 5f6b 6579 732e     targets_keys.
+00009d00: 6170 7065 6e64 2874 2e6b 6579 290a 2020  append(t.key).  
+00009d10: 2020 2020 2020 2020 2020 7461 7267 6574            target
+00009d20: 735f 6473 6b73 2e61 7070 656e 6428 742e  s_dsks.append(t.
+00009d30: 5f5f 6461 736b 5f67 7261 7068 5f5f 2829  __dask_graph__()
+00009d40: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+00009d50: 735f 6461 736b 5f63 6f6c 6c65 6374 696f  s_dask_collectio
+00009d60: 6e28 7429 3a0a 2020 2020 2020 2020 2020  n(t):.          
+00009d70: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+00009d80: 7228 2254 6172 6765 7473 206d 7573 7420  r("Targets must 
+00009d90: 6265 2065 6974 6865 7220 4465 6c61 7965  be either Delaye
+00009da0: 6420 6f62 6a65 6374 7320 6f72 2061 7272  d objects or arr
+00009db0: 6179 2d6c 696b 6573 2229 0a0a 2020 2020  ay-likes")..    
+00009dc0: 6966 2074 6172 6765 7473 5f64 736b 733a  if targets_dsks:
+00009dd0: 0a20 2020 2020 2020 2074 6172 6765 7473  .        targets
+00009de0: 5f68 6c67 203d 2048 6967 684c 6576 656c  _hlg = HighLevel
+00009df0: 4772 6170 682e 6d65 7267 6528 2a74 6172  Graph.merge(*tar
+00009e00: 6765 7473 5f64 736b 7329 0a20 2020 2020  gets_dsks).     
+00009e10: 2020 2074 6172 6765 7473 5f6c 6179 6572     targets_layer
+00009e20: 203d 2044 656c 6179 6564 2e5f 5f64 6173   = Delayed.__das
+00009e30: 6b5f 6f70 7469 6d69 7a65 5f5f 2874 6172  k_optimize__(tar
+00009e40: 6765 7473 5f68 6c67 2c20 7461 7267 6574  gets_hlg, target
+00009e50: 735f 6b65 7973 290a 2020 2020 2020 2020  s_keys).        
+00009e60: 7461 7267 6574 735f 6e61 6d65 203d 2022  targets_name = "
+00009e70: 7374 6f72 652d 7461 7267 6574 732d 2220  store-targets-" 
+00009e80: 2b20 746f 6b65 6e69 7a65 2874 6172 6765  + tokenize(targe
+00009e90: 7473 5f6b 6579 7329 0a20 2020 2020 2020  ts_keys).       
+00009ea0: 206c 6179 6572 735b 7461 7267 6574 735f   layers[targets_
+00009eb0: 6e61 6d65 5d20 3d20 7461 7267 6574 735f  name] = targets_
+00009ec0: 6c61 7965 720a 2020 2020 2020 2020 6465  layer.        de
+00009ed0: 7065 6e64 656e 6369 6573 5b74 6172 6765  pendencies[targe
+00009ee0: 7473 5f6e 616d 655d 203d 2073 6574 2829  ts_name] = set()
+00009ef0: 0a0a 2020 2020 6c6f 6164 5f73 746f 7265  ..    load_store
+00009f00: 6420 3d20 7265 7475 726e 5f73 746f 7265  d = return_store
+00009f10: 6420 616e 6420 6e6f 7420 636f 6d70 7574  d and not comput
+00009f20: 650a 0a20 2020 206d 6170 5f6e 616d 6573  e..    map_names
+00009f30: 203d 205b 0a20 2020 2020 2020 2022 7374   = [.        "st
+00009f40: 6f72 652d 6d61 702d 2220 2b20 746f 6b65  ore-map-" + toke
+00009f50: 6e69 7a65 2873 2c20 7420 6966 2069 7369  nize(s, t if isi
+00009f60: 6e73 7461 6e63 6528 742c 2044 656c 6179  nstance(t, Delay
+00009f70: 6564 2920 656c 7365 2069 6428 7429 2c20  ed) else id(t), 
+00009f80: 7229 0a20 2020 2020 2020 2066 6f72 2073  r).        for s
+00009f90: 2c20 742c 2072 2069 6e20 7a69 7028 736f  , t, r in zip(so
+00009fa0: 7572 6365 732c 2074 6172 6765 7473 2c20  urces, targets, 
+00009fb0: 7265 6769 6f6e 735f 6c69 7374 290a 2020  regions_list).  
+00009fc0: 2020 5d0a 2020 2020 6d61 705f 6b65 7973    ].    map_keys
+00009fd0: 3a20 6c69 7374 5b74 7570 6c65 5d20 3d20  : list[tuple] = 
+00009fe0: 5b5d 0a0a 2020 2020 666f 7220 732c 2074  []..    for s, t
+00009ff0: 2c20 6e2c 2072 2069 6e20 7a69 7028 736f  , n, r in zip(so
+0000a000: 7572 6365 732c 2074 6172 6765 7473 2c20  urces, targets, 
+0000a010: 6d61 705f 6e61 6d65 732c 2072 6567 696f  map_names, regio
+0000a020: 6e73 5f6c 6973 7429 3a0a 2020 2020 2020  ns_list):.      
+0000a030: 2020 6d61 705f 6c61 7965 7220 3d20 696e    map_layer = in
+0000a040: 7365 7274 5f74 6f5f 6f6f 6328 0a20 2020  sert_to_ooc(.   
+0000a050: 2020 2020 2020 2020 206b 6579 733d 732e           keys=s.
+0000a060: 5f5f 6461 736b 5f6b 6579 735f 5f28 292c  __dask_keys__(),
+0000a070: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+0000a080: 6e6b 733d 732e 6368 756e 6b73 2c0a 2020  nks=s.chunks,.  
+0000a090: 2020 2020 2020 2020 2020 6f75 743d 742e            out=t.
+0000a0a0: 6b65 7920 6966 2069 7369 6e73 7461 6e63  key if isinstanc
+0000a0b0: 6528 742c 2044 656c 6179 6564 2920 656c  e(t, Delayed) el
+0000a0c0: 7365 2074 2c0a 2020 2020 2020 2020 2020  se t,.          
+0000a0d0: 2020 6e61 6d65 3d6e 2c0a 2020 2020 2020    name=n,.      
+0000a0e0: 2020 2020 2020 6c6f 636b 3d6c 6f63 6b2c        lock=lock,
+0000a0f0: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
+0000a100: 696f 6e3d 722c 0a20 2020 2020 2020 2020  ion=r,.         
+0000a110: 2020 2072 6574 7572 6e5f 7374 6f72 6564     return_stored
+0000a120: 3d72 6574 7572 6e5f 7374 6f72 6564 2c0a  =return_stored,.
+0000a130: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
+0000a140: 5f73 746f 7265 643d 6c6f 6164 5f73 746f  _stored=load_sto
+0000a150: 7265 642c 0a20 2020 2020 2020 2029 0a20  red,.        ). 
+0000a160: 2020 2020 2020 206c 6179 6572 735b 6e5d         layers[n]
+0000a170: 203d 206d 6170 5f6c 6179 6572 0a20 2020   = map_layer.   
+0000a180: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000a190: 6365 2874 2c20 4465 6c61 7965 6429 3a0a  ce(t, Delayed):.
+0000a1a0: 2020 2020 2020 2020 2020 2020 6465 7065              depe
+0000a1b0: 6e64 656e 6369 6573 5b6e 5d20 3d20 7b73  ndencies[n] = {s
+0000a1c0: 6f75 7263 6573 5f6e 616d 652c 2074 6172  ources_name, tar
+0000a1d0: 6765 7473 5f6e 616d 657d 0a20 2020 2020  gets_name}.     
+0000a1e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a1f0: 2020 2020 2064 6570 656e 6465 6e63 6965       dependencie
+0000a200: 735b 6e5d 203d 207b 736f 7572 6365 735f  s[n] = {sources_
+0000a210: 6e61 6d65 7d0a 2020 2020 2020 2020 6d61  name}.        ma
+0000a220: 705f 6b65 7973 202b 3d20 6d61 705f 6c61  p_keys += map_la
+0000a230: 7965 722e 6b65 7973 2829 0a0a 2020 2020  yer.keys()..    
+0000a240: 6966 2072 6574 7572 6e5f 7374 6f72 6564  if return_stored
+0000a250: 3a0a 2020 2020 2020 2020 7374 6f72 655f  :.        store_
+0000a260: 6473 6b20 3d20 4869 6768 4c65 7665 6c47  dsk = HighLevelG
+0000a270: 7261 7068 286c 6179 6572 732c 2064 6570  raph(layers, dep
+0000a280: 656e 6465 6e63 6965 7329 0a20 2020 2020  endencies).     
+0000a290: 2020 206c 6f61 645f 7374 6f72 655f 6473     load_store_ds
+0000a2a0: 6b3a 2048 6967 684c 6576 656c 4772 6170  k: HighLevelGrap
+0000a2b0: 6820 7c20 6469 6374 5b74 7570 6c65 2c20  h | dict[tuple, 
+0000a2c0: 416e 795d 203d 2073 746f 7265 5f64 736b  Any] = store_dsk
+0000a2d0: 0a20 2020 2020 2020 2069 6620 636f 6d70  .        if comp
+0000a2e0: 7574 653a 0a20 2020 2020 2020 2020 2020  ute:.           
+0000a2f0: 2073 746f 7265 5f64 6c79 6473 203d 205b   store_dlyds = [
+0000a300: 4465 6c61 7965 6428 6b2c 2073 746f 7265  Delayed(k, store
+0000a310: 5f64 736b 2c20 6c61 7965 723d 6b5b 305d  _dsk, layer=k[0]
+0000a320: 2920 666f 7220 6b20 696e 206d 6170 5f6b  ) for k in map_k
+0000a330: 6579 735d 0a20 2020 2020 2020 2020 2020  eys].           
+0000a340: 2073 746f 7265 5f64 6c79 6473 203d 2070   store_dlyds = p
+0000a350: 6572 7369 7374 282a 7374 6f72 655f 646c  ersist(*store_dl
+0000a360: 7964 732c 202a 2a6b 7761 7267 7329 0a20  yds, **kwargs). 
+0000a370: 2020 2020 2020 2020 2020 2073 746f 7265             store
+0000a380: 5f64 736b 5f32 203d 2048 6967 684c 6576  _dsk_2 = HighLev
+0000a390: 656c 4772 6170 682e 6d65 7267 6528 2a5b  elGraph.merge(*[
+0000a3a0: 652e 6461 736b 2066 6f72 2065 2069 6e20  e.dask for e in 
+0000a3b0: 7374 6f72 655f 646c 7964 735d 290a 2020  store_dlyds]).  
+0000a3c0: 2020 2020 2020 2020 2020 6c6f 6164 5f73            load_s
+0000a3d0: 746f 7265 5f64 736b 203d 2072 6574 7269  tore_dsk = retri
+0000a3e0: 6576 655f 6672 6f6d 5f6f 6f63 286d 6170  eve_from_ooc(map
+0000a3f0: 5f6b 6579 732c 2073 746f 7265 5f64 736b  _keys, store_dsk
+0000a400: 2c20 7374 6f72 655f 6473 6b5f 3229 0a20  , store_dsk_2). 
+0000a410: 2020 2020 2020 2020 2020 206d 6170 5f6e             map_n
+0000a420: 616d 6573 203d 205b 226c 6f61 642d 2220  ames = ["load-" 
+0000a430: 2b20 6e20 666f 7220 6e20 696e 206d 6170  + n for n in map
+0000a440: 5f6e 616d 6573 5d0a 0a20 2020 2020 2020  _names]..       
+0000a450: 2072 6574 7572 6e20 7475 706c 6528 0a20   return tuple(. 
+0000a460: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+0000a470: 286c 6f61 645f 7374 6f72 655f 6473 6b2c  (load_store_dsk,
+0000a480: 206e 2c20 732e 6368 756e 6b73 2c20 6d65   n, s.chunks, me
+0000a490: 7461 3d73 290a 2020 2020 2020 2020 2020  ta=s).          
+0000a4a0: 2020 666f 7220 732c 206e 2069 6e20 7a69    for s, n in zi
+0000a4b0: 7028 736f 7572 6365 732c 206d 6170 5f6e  p(sources, map_n
+0000a4c0: 616d 6573 290a 2020 2020 2020 2020 290a  ames).        ).
+0000a4d0: 0a20 2020 2065 6c69 6620 636f 6d70 7574  .    elif comput
+0000a4e0: 653a 0a20 2020 2020 2020 2073 746f 7265  e:.        store
+0000a4f0: 5f64 736b 203d 2048 6967 684c 6576 656c  _dsk = HighLevel
+0000a500: 4772 6170 6828 6c61 7965 7273 2c20 6465  Graph(layers, de
+0000a510: 7065 6e64 656e 6369 6573 290a 2020 2020  pendencies).    
+0000a520: 2020 2020 636f 6d70 7574 655f 6173 5f69      compute_as_i
+0000a530: 665f 636f 6c6c 6563 7469 6f6e 2841 7272  f_collection(Arr
+0000a540: 6179 2c20 7374 6f72 655f 6473 6b2c 206d  ay, store_dsk, m
+0000a550: 6170 5f6b 6579 732c 202a 2a6b 7761 7267  ap_keys, **kwarg
+0000a560: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+0000a570: 6e20 4e6f 6e65 0a0a 2020 2020 656c 7365  n None..    else
+0000a580: 3a0a 2020 2020 2020 2020 6b65 7920 3d20  :.        key = 
+0000a590: 2273 746f 7265 2d22 202b 2074 6f6b 656e  "store-" + token
+0000a5a0: 697a 6528 6d61 705f 6e61 6d65 7329 0a20  ize(map_names). 
+0000a5b0: 2020 2020 2020 206c 6179 6572 735b 6b65         layers[ke
+0000a5c0: 795d 203d 207b 6b65 793a 206d 6170 5f6b  y] = {key: map_k
+0000a5d0: 6579 737d 0a20 2020 2020 2020 2064 6570  eys}.        dep
+0000a5e0: 656e 6465 6e63 6965 735b 6b65 795d 203d  endencies[key] =
+0000a5f0: 2073 6574 286d 6170 5f6e 616d 6573 290a   set(map_names).
+0000a600: 2020 2020 2020 2020 7374 6f72 655f 6473          store_ds
+0000a610: 6b20 3d20 4869 6768 4c65 7665 6c47 7261  k = HighLevelGra
+0000a620: 7068 286c 6179 6572 732c 2064 6570 656e  ph(layers, depen
+0000a630: 6465 6e63 6965 7329 0a20 2020 2020 2020  dencies).       
+0000a640: 2072 6574 7572 6e20 4465 6c61 7965 6428   return Delayed(
+0000a650: 6b65 792c 2073 746f 7265 5f64 736b 290a  key, store_dsk).
+0000a660: 0a0a 6465 6620 626c 6f63 6b64 696d 735f  ..def blockdims_
+0000a670: 6672 6f6d 5f62 6c6f 636b 7368 6170 6528  from_blockshape(
+0000a680: 7368 6170 652c 2063 6875 6e6b 7329 3a0a  shape, chunks):.
+0000a690: 2020 2020 2222 220a 0a20 2020 203e 3e3e      """..    >>>
+0000a6a0: 2062 6c6f 636b 6469 6d73 5f66 726f 6d5f   blockdims_from_
+0000a6b0: 626c 6f63 6b73 6861 7065 2828 3130 2c20  blockshape((10, 
+0000a6c0: 3130 292c 2028 342c 2033 2929 0a20 2020  10), (4, 3)).   
+0000a6d0: 2028 2834 2c20 342c 2032 292c 2028 332c   ((4, 4, 2), (3,
+0000a6e0: 2033 2c20 332c 2031 2929 0a20 2020 203e   3, 3, 1)).    >
+0000a6f0: 3e3e 2062 6c6f 636b 6469 6d73 5f66 726f  >> blockdims_fro
+0000a700: 6d5f 626c 6f63 6b73 6861 7065 2828 3130  m_blockshape((10
+0000a710: 2c20 3029 2c20 2834 2c20 3029 290a 2020  , 0), (4, 0)).  
+0000a720: 2020 2828 342c 2034 2c20 3229 2c20 2830    ((4, 4, 2), (0
+0000a730: 2c29 290a 2020 2020 2222 220a 2020 2020  ,)).    """.    
+0000a740: 6966 2063 6875 6e6b 7320 6973 204e 6f6e  if chunks is Non
+0000a750: 653a 0a20 2020 2020 2020 2072 6169 7365  e:.        raise
+0000a760: 2054 7970 6545 7272 6f72 2822 4d75 7374   TypeError("Must
+0000a770: 2073 7570 706c 7920 6368 756e 6b73 3d20   supply chunks= 
+0000a780: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
+0000a790: 2229 0a20 2020 2069 6620 7368 6170 6520  ").    if shape 
+0000a7a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000a7b0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0000a7c0: 2822 4d75 7374 2073 7570 706c 7920 7368  ("Must supply sh
+0000a7d0: 6170 653d 206b 6579 776f 7264 2061 7267  ape= keyword arg
+0000a7e0: 756d 656e 7422 290a 2020 2020 6966 206e  ument").    if n
+0000a7f0: 702e 6973 6e61 6e28 7375 6d28 7368 6170  p.isnan(sum(shap
+0000a800: 6529 2920 6f72 206e 702e 6973 6e61 6e28  e)) or np.isnan(
+0000a810: 7375 6d28 6368 756e 6b73 2929 3a0a 2020  sum(chunks)):.  
+0000a820: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000a830: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000a840: 2020 2020 2241 7272 6179 2063 6875 6e6b      "Array chunk
+0000a850: 2073 697a 6573 2061 7265 2075 6e6b 6e6f   sizes are unkno
+0000a860: 776e 2e20 7368 6170 653a 2025 732c 2063  wn. shape: %s, c
+0000a870: 6875 6e6b 733a 2025 7325 7322 0a20 2020  hunks: %s%s".   
+0000a880: 2020 2020 2020 2020 2025 2028 7368 6170           % (shap
+0000a890: 652c 2063 6875 6e6b 732c 2075 6e6b 6e6f  e, chunks, unkno
+0000a8a0: 776e 5f63 6875 6e6b 5f6d 6573 7361 6765  wn_chunk_message
+0000a8b0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+0000a8c0: 6966 206e 6f74 2061 6c6c 286d 6170 2869  if not all(map(i
+0000a8d0: 735f 696e 7465 6765 722c 2063 6875 6e6b  s_integer, chunk
+0000a8e0: 7329 293a 0a20 2020 2020 2020 2072 6169  s)):.        rai
+0000a8f0: 7365 2056 616c 7565 4572 726f 7228 2263  se ValueError("c
+0000a900: 6875 6e6b 7320 6361 6e20 6f6e 6c79 2063  hunks can only c
+0000a910: 6f6e 7461 696e 2069 6e74 6567 6572 732e  ontain integers.
+0000a920: 2229 0a20 2020 2069 6620 6e6f 7420 616c  ").    if not al
+0000a930: 6c28 6d61 7028 6973 5f69 6e74 6567 6572  l(map(is_integer
+0000a940: 2c20 7368 6170 6529 293a 0a20 2020 2020  , shape)):.     
+0000a950: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000a960: 726f 7228 2273 6861 7065 2063 616e 206f  ror("shape can o
+0000a970: 6e6c 7920 636f 6e74 6169 6e20 696e 7465  nly contain inte
+0000a980: 6765 7273 2e22 290a 2020 2020 7368 6170  gers.").    shap
+0000a990: 6520 3d20 7475 706c 6528 6d61 7028 696e  e = tuple(map(in
+0000a9a0: 742c 2073 6861 7065 2929 0a20 2020 2063  t, shape)).    c
+0000a9b0: 6875 6e6b 7320 3d20 7475 706c 6528 6d61  hunks = tuple(ma
+0000a9c0: 7028 696e 742c 2063 6875 6e6b 7329 290a  p(int, chunks)).
+0000a9d0: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
+0000a9e0: 280a 2020 2020 2020 2020 2828 6264 2c29  (.        ((bd,)
+0000a9f0: 202a 2028 6420 2f2f 2062 6429 202b 2028   * (d // bd) + (
+0000aa00: 2864 2025 2062 642c 2920 6966 2064 2025  (d % bd,) if d %
+0000aa10: 2062 6420 656c 7365 2028 2929 2069 6620   bd else ()) if 
+0000aa20: 6420 656c 7365 2028 302c 2929 0a20 2020  d else (0,)).   
+0000aa30: 2020 2020 2066 6f72 2064 2c20 6264 2069       for d, bd i
+0000aa40: 6e20 7a69 7028 7368 6170 652c 2063 6875  n zip(shape, chu
+0000aa50: 6e6b 7329 0a20 2020 2029 0a0a 0a64 6566  nks).    )...def
+0000aa60: 2066 696e 616c 697a 6528 7265 7375 6c74   finalize(result
+0000aa70: 7329 3a0a 2020 2020 6966 206e 6f74 2072  s):.    if not r
+0000aa80: 6573 756c 7473 3a0a 2020 2020 2020 2020  esults:.        
+0000aa90: 7265 7475 726e 2063 6f6e 6361 7465 6e61  return concatena
+0000aaa0: 7465 3328 7265 7375 6c74 7329 0a20 2020  te3(results).   
+0000aab0: 2072 6573 756c 7473 3220 3d20 7265 7375   results2 = resu
+0000aac0: 6c74 730a 2020 2020 7768 696c 6520 6973  lts.    while is
+0000aad0: 696e 7374 616e 6365 2872 6573 756c 7473  instance(results
+0000aae0: 322c 2028 7475 706c 652c 206c 6973 7429  2, (tuple, list)
+0000aaf0: 293a 0a20 2020 2020 2020 2069 6620 6c65  ):.        if le
+0000ab00: 6e28 7265 7375 6c74 7332 2920 3e20 313a  n(results2) > 1:
+0000ab10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000ab20: 7572 6e20 636f 6e63 6174 656e 6174 6533  urn concatenate3
+0000ab30: 2872 6573 756c 7473 290a 2020 2020 2020  (results).      
+0000ab40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ab50: 2020 2020 7265 7375 6c74 7332 203d 2072      results2 = r
+0000ab60: 6573 756c 7473 325b 305d 0a20 2020 2072  esults2[0].    r
+0000ab70: 6574 7572 6e20 756e 7061 636b 5f73 696e  eturn unpack_sin
+0000ab80: 676c 6574 6f6e 2872 6573 756c 7473 290a  gleton(results).
+0000ab90: 0a0a 4348 554e 4b53 5f4e 4f4e 455f 4552  ..CHUNKS_NONE_ER
+0000aba0: 524f 525f 4d45 5353 4147 4520 3d20 2222  ROR_MESSAGE = ""
+0000abb0: 220a 596f 7520 6d75 7374 2073 7065 6369  ".You must speci
+0000abc0: 6679 2061 2063 6875 6e6b 733d 206b 6579  fy a chunks= key
+0000abd0: 776f 7264 2061 7267 756d 656e 742e 0a54  word argument..T
+0000abe0: 6869 7320 7370 6563 6966 6965 7320 7468  his specifies th
+0000abf0: 6520 6368 756e 6b73 697a 6520 6f66 2079  e chunksize of y
+0000ac00: 6f75 7220 6172 7261 7920 626c 6f63 6b73  our array blocks
+0000ac10: 2e0a 0a53 6565 2074 6865 2066 6f6c 6c6f  ...See the follo
+0000ac20: 7769 6e67 2064 6f63 756d 656e 7461 7469  wing documentati
+0000ac30: 6f6e 2070 6167 6520 666f 7220 6465 7461  on page for deta
+0000ac40: 696c 733a 0a20 2068 7474 7073 3a2f 2f64  ils:.  https://d
+0000ac50: 6f63 732e 6461 736b 2e6f 7267 2f65 6e2f  ocs.dask.org/en/
+0000ac60: 6c61 7465 7374 2f61 7272 6179 2d63 7265  latest/array-cre
+0000ac70: 6174 696f 6e2e 6874 6d6c 2363 6875 6e6b  ation.html#chunk
+0000ac80: 730a 2222 222e 7374 7269 7028 290a 0a0a  s.""".strip()...
+0000ac90: 636c 6173 7320 4172 7261 7928 4461 736b  class Array(Dask
+0000aca0: 4d65 7468 6f64 734d 6978 696e 293a 0a20  MethodsMixin):. 
+0000acb0: 2020 2022 2222 5061 7261 6c6c 656c 2044     """Parallel D
+0000acc0: 6173 6b20 4172 7261 790a 0a20 2020 2041  ask Array..    A
+0000acd0: 2070 6172 616c 6c65 6c20 6e64 2d61 7272   parallel nd-arr
+0000ace0: 6179 2063 6f6d 7072 6973 6564 206f 6620  ay comprised of 
+0000acf0: 6d61 6e79 206e 756d 7079 2061 7272 6179  many numpy array
+0000ad00: 7320 6172 7261 6e67 6564 2069 6e20 6120  s arranged in a 
+0000ad10: 6772 6964 2e0a 0a20 2020 2054 6869 7320  grid...    This 
+0000ad20: 636f 6e73 7472 7563 746f 7220 6973 2066  constructor is f
+0000ad30: 6f72 2061 6476 616e 6365 6420 7573 6573  or advanced uses
+0000ad40: 206f 6e6c 792e 2020 466f 7220 6e6f 726d   only.  For norm
+0000ad50: 616c 2075 7365 2073 6565 2074 6865 0a20  al use see the. 
+0000ad60: 2020 203a 6675 6e63 3a60 6461 736b 2e61     :func:`dask.a
+0000ad70: 7272 6179 2e66 726f 6d5f 6172 7261 7960  rray.from_array`
+0000ad80: 2066 756e 6374 696f 6e2e 0a0a 2020 2020   function...    
+0000ad90: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0000ada0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6461  ---------.    da
+0000adb0: 736b 203a 2064 6963 740a 2020 2020 2020  sk : dict.      
+0000adc0: 2020 5461 736b 2064 6570 656e 6465 6e63    Task dependenc
+0000add0: 7920 6772 6170 680a 2020 2020 6e61 6d65  y graph.    name
+0000ade0: 203a 2073 7472 696e 670a 2020 2020 2020   : string.      
+0000adf0: 2020 4e61 6d65 206f 6620 6172 7261 7920    Name of array 
+0000ae00: 696e 2064 6173 6b0a 2020 2020 7368 6170  in dask.    shap
+0000ae10: 6520 3a20 7475 706c 6520 6f66 2069 6e74  e : tuple of int
+0000ae20: 730a 2020 2020 2020 2020 5368 6170 6520  s.        Shape 
+0000ae30: 6f66 2074 6865 2065 6e74 6972 6520 6172  of the entire ar
+0000ae40: 7261 790a 2020 2020 6368 756e 6b73 3a20  ray.    chunks: 
+0000ae50: 6974 6572 6162 6c65 206f 6620 7475 706c  iterable of tupl
+0000ae60: 6573 0a20 2020 2020 2020 2062 6c6f 636b  es.        block
+0000ae70: 2073 697a 6573 2061 6c6f 6e67 2065 6163   sizes along eac
+0000ae80: 6820 6469 6d65 6e73 696f 6e0a 2020 2020  h dimension.    
+0000ae90: 6474 7970 6520 3a20 7374 7220 6f72 2064  dtype : str or d
+0000aea0: 7479 7065 0a20 2020 2020 2020 2054 7970  type.        Typ
+0000aeb0: 6563 6f64 6520 6f72 2064 6174 612d 7479  ecode or data-ty
+0000aec0: 7065 2066 6f72 2074 6865 206e 6577 2044  pe for the new D
+0000aed0: 6173 6b20 4172 7261 790a 2020 2020 6d65  ask Array.    me
+0000aee0: 7461 203a 2065 6d70 7479 206e 6461 7272  ta : empty ndarr
+0000aef0: 6179 0a20 2020 2020 2020 2065 6d70 7479  ay.        empty
+0000af00: 206e 6461 7272 6179 2063 7265 6174 6564   ndarray created
+0000af10: 2077 6974 6820 7361 6d65 204e 756d 5079   with same NumPy
+0000af20: 2062 6163 6b65 6e64 2c20 6e64 696d 2061   backend, ndim a
+0000af30: 6e64 2064 7479 7065 2061 7320 7468 650a  nd dtype as the.
+0000af40: 2020 2020 2020 2020 4461 736b 2041 7272          Dask Arr
+0000af50: 6179 2062 6569 6e67 2063 7265 6174 6564  ay being created
+0000af60: 2028 6f76 6572 7269 6465 7320 6474 7970   (overrides dtyp
+0000af70: 6529 0a0a 2020 2020 5365 6520 416c 736f  e)..    See Also
+0000af80: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+0000af90: 2020 6461 736b 2e61 7272 6179 2e66 726f    dask.array.fro
+0000afa0: 6d5f 6172 7261 790a 2020 2020 2222 220a  m_array.    """.
+0000afb0: 0a20 2020 205f 5f73 6c6f 7473 5f5f 203d  .    __slots__ =
+0000afc0: 2022 6461 736b 222c 2022 5f5f 6e61 6d65   "dask", "__name
+0000afd0: 222c 2022 5f63 6163 6865 645f 6b65 7973  ", "_cached_keys
+0000afe0: 222c 2022 5f5f 6368 756e 6b73 222c 2022  ", "__chunks", "
+0000aff0: 5f6d 6574 6122 2c20 225f 5f64 6963 745f  _meta", "__dict_
+0000b000: 5f22 0a0a 2020 2020 6465 6620 5f5f 6e65  _"..    def __ne
+0000b010: 775f 5f28 636c 732c 2064 6173 6b2c 206e  w__(cls, dask, n
+0000b020: 616d 652c 2063 6875 6e6b 732c 2064 7479  ame, chunks, dty
+0000b030: 7065 3d4e 6f6e 652c 206d 6574 613d 4e6f  pe=None, meta=No
+0000b040: 6e65 2c20 7368 6170 653d 4e6f 6e65 293a  ne, shape=None):
+0000b050: 0a20 2020 2020 2020 2073 656c 6620 3d20  .        self = 
+0000b060: 7375 7065 7228 292e 5f5f 6e65 775f 5f28  super().__new__(
+0000b070: 636c 7329 0a20 2020 2020 2020 2061 7373  cls).        ass
+0000b080: 6572 7420 6973 696e 7374 616e 6365 2864  ert isinstance(d
+0000b090: 6173 6b2c 204d 6170 7069 6e67 290a 2020  ask, Mapping).  
+0000b0a0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000b0b0: 6e73 7461 6e63 6528 6461 736b 2c20 4869  nstance(dask, Hi
+0000b0c0: 6768 4c65 7665 6c47 7261 7068 293a 0a20  ghLevelGraph):. 
+0000b0d0: 2020 2020 2020 2020 2020 2064 6173 6b20             dask 
+0000b0e0: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
+0000b0f0: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
+0000b100: 7328 6e61 6d65 2c20 6461 736b 2c20 6465  s(name, dask, de
+0000b110: 7065 6e64 656e 6369 6573 3d28 2929 0a20  pendencies=()). 
+0000b120: 2020 2020 2020 2073 656c 662e 6461 736b         self.dask
+0000b130: 203d 2064 6173 6b0a 2020 2020 2020 2020   = dask.        
+0000b140: 7365 6c66 2e5f 6e61 6d65 203d 2073 7472  self._name = str
+0000b150: 286e 616d 6529 0a20 2020 2020 2020 206d  (name).        m
+0000b160: 6574 6120 3d20 6d65 7461 5f66 726f 6d5f  eta = meta_from_
+0000b170: 6172 7261 7928 6d65 7461 2c20 6474 7970  array(meta, dtyp
+0000b180: 653d 6474 7970 6529 0a0a 2020 2020 2020  e=dtype)..      
+0000b190: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+0000b1a0: 2020 2069 7369 6e73 7461 6e63 6528 6368     isinstance(ch
+0000b1b0: 756e 6b73 2c20 7374 7229 0a20 2020 2020  unks, str).     
+0000b1c0: 2020 2020 2020 206f 7220 6973 696e 7374         or isinst
+0000b1d0: 616e 6365 2863 6875 6e6b 732c 2074 7570  ance(chunks, tup
+0000b1e0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+0000b1f0: 616e 6420 6368 756e 6b73 0a20 2020 2020  and chunks.     
+0000b200: 2020 2020 2020 2061 6e64 2061 6e79 2869         and any(i
+0000b210: 7369 6e73 7461 6e63 6528 632c 2073 7472  sinstance(c, str
+0000b220: 2920 666f 7220 6320 696e 2063 6875 6e6b  ) for c in chunk
+0000b230: 7329 0a20 2020 2020 2020 2029 3a0a 2020  s).        ):.  
+0000b240: 2020 2020 2020 2020 2020 6474 203d 206d            dt = m
+0000b250: 6574 612e 6474 7970 650a 2020 2020 2020  eta.dtype.      
+0000b260: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000b270: 2020 2020 6474 203d 204e 6f6e 650a 2020      dt = None.  
+0000b280: 2020 2020 2020 7365 6c66 2e5f 6368 756e        self._chun
+0000b290: 6b73 203d 206e 6f72 6d61 6c69 7a65 5f63  ks = normalize_c
+0000b2a0: 6875 6e6b 7328 6368 756e 6b73 2c20 7368  hunks(chunks, sh
+0000b2b0: 6170 652c 2064 7479 7065 3d64 7429 0a20  ape, dtype=dt). 
+0000b2c0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+0000b2d0: 6875 6e6b 7320 6973 204e 6f6e 653a 0a20  hunks is None:. 
+0000b2e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000b2f0: 2056 616c 7565 4572 726f 7228 4348 554e   ValueError(CHUN
+0000b300: 4b53 5f4e 4f4e 455f 4552 524f 525f 4d45  KS_NONE_ERROR_ME
+0000b310: 5353 4147 4529 0a20 2020 2020 2020 2073  SSAGE).        s
+0000b320: 656c 662e 5f6d 6574 6120 3d20 6d65 7461  elf._meta = meta
+0000b330: 5f66 726f 6d5f 6172 7261 7928 6d65 7461  _from_array(meta
+0000b340: 2c20 6e64 696d 3d73 656c 662e 6e64 696d  , ndim=self.ndim
+0000b350: 2c20 6474 7970 653d 6474 7970 6529 0a0a  , dtype=dtype)..
+0000b360: 2020 2020 2020 2020 666f 7220 706c 7567          for plug
+0000b370: 696e 2069 6e20 636f 6e66 6967 2e67 6574  in in config.get
+0000b380: 2822 6172 7261 795f 706c 7567 696e 7322  ("array_plugins"
+0000b390: 2c20 2829 293a 0a20 2020 2020 2020 2020  , ()):.         
+0000b3a0: 2020 2072 6573 756c 7420 3d20 706c 7567     result = plug
+0000b3b0: 696e 2873 656c 6629 0a20 2020 2020 2020  in(self).       
+0000b3c0: 2020 2020 2069 6620 7265 7375 6c74 2069       if result i
+0000b3d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000b3e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b3f0: 203d 2072 6573 756c 740a 0a20 2020 2020   = result..     
+0000b400: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000b410: 2020 2020 6c61 7965 7220 3d20 7365 6c66      layer = self
+0000b420: 2e64 6173 6b2e 6c61 7965 7273 5b6e 616d  .dask.layers[nam
+0000b430: 655d 0a20 2020 2020 2020 2065 7863 6570  e].        excep
+0000b440: 7420 2841 7474 7269 6275 7465 4572 726f  t (AttributeErro
+0000b450: 722c 204b 6579 4572 726f 7229 3a0a 2020  r, KeyError):.  
+0000b460: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
+0000b470: 2069 7320 6e6f 206c 6f6e 6765 7220 616e   is no longer an
+0000b480: 2041 7272 6179 2061 6674 6572 2061 7070   Array after app
+0000b490: 6c79 696e 6720 7468 6520 706c 7567 696e  lying the plugin
+0000b4a0: 732c 204f 520a 2020 2020 2020 2020 2020  s, OR.          
+0000b4b0: 2020 2320 6120 706c 7567 696e 2072 6570    # a plugin rep
+0000b4c0: 6c61 6365 6420 7468 6520 4869 6768 4c65  laced the HighLe
+0000b4d0: 7665 6c47 7261 7068 2077 6974 6820 6120  velGraph with a 
+0000b4e0: 706c 6169 6e20 6469 6374 2c20 4f52 0a20  plain dict, OR. 
+0000b4f0: 2020 2020 2020 2020 2020 2023 206e 616d             # nam
+0000b500: 6520 6973 206e 6f74 2074 6865 2074 6f70  e is not the top
+0000b510: 206c 6179 6572 2773 206e 616d 6520 2874   layer's name (t
+0000b520: 6869 7320 6361 6e20 6861 7070 656e 2061  his can happen a
+0000b530: 6674 6572 2074 6865 206c 6179 6572 2069  fter the layer i
+0000b540: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
+0000b550: 6d61 6e69 7075 6c61 7465 642c 2074 6f20  manipulated, to 
+0000b560: 6176 6f69 6420 6120 636f 6c6c 6973 696f  avoid a collisio
+0000b570: 6e29 0a20 2020 2020 2020 2020 2020 2070  n).            p
+0000b580: 6173 730a 2020 2020 2020 2020 656c 7365  ass.        else
+0000b590: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000b5a0: 206c 6179 6572 2e63 6f6c 6c65 6374 696f   layer.collectio
+0000b5b0: 6e5f 616e 6e6f 7461 7469 6f6e 7320 6973  n_annotations is
+0000b5c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000b5d0: 2020 2020 2020 206c 6179 6572 2e63 6f6c         layer.col
+0000b5e0: 6c65 6374 696f 6e5f 616e 6e6f 7461 7469  lection_annotati
+0000b5f0: 6f6e 7320 3d20 7b0a 2020 2020 2020 2020  ons = {.        
+0000b600: 2020 2020 2020 2020 2020 2020 2273 6861              "sha
+0000b610: 7065 223a 2073 656c 662e 7368 6170 652c  pe": self.shape,
+0000b620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b630: 2020 2020 2022 6474 7970 6522 3a20 7365       "dtype": se
+0000b640: 6c66 2e64 7479 7065 2c0a 2020 2020 2020  lf.dtype,.      
+0000b650: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+0000b660: 6875 6e6b 7369 7a65 223a 2073 656c 662e  hunksize": self.
+0000b670: 6368 756e 6b73 697a 652c 0a20 2020 2020  chunksize,.     
+0000b680: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000b690: 6368 756e 6b73 223a 2073 656c 662e 6368  chunks": self.ch
+0000b6a0: 756e 6b73 2c0a 2020 2020 2020 2020 2020  unks,.          
+0000b6b0: 2020 2020 2020 2020 2020 2274 7970 6522            "type"
+0000b6c0: 3a20 7479 7065 6e61 6d65 2874 7970 6528  : typename(type(
+0000b6d0: 7365 6c66 2929 2c0a 2020 2020 2020 2020  self)),.        
+0000b6e0: 2020 2020 2020 2020 2020 2020 2263 6875              "chu
+0000b6f0: 6e6b 5f74 7970 6522 3a20 7479 7065 6e61  nk_type": typena
+0000b700: 6d65 2874 7970 6528 7365 6c66 2e5f 6d65  me(type(self._me
+0000b710: 7461 2929 2c0a 2020 2020 2020 2020 2020  ta)),.          
+0000b720: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000b730: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b740: 2020 2020 2020 2020 2020 6c61 7965 722e            layer.
+0000b750: 636f 6c6c 6563 7469 6f6e 5f61 6e6e 6f74  collection_annot
+0000b760: 6174 696f 6e73 2e75 7064 6174 6528 0a20  ations.update(. 
+0000b770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b780: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+0000b790: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
+0000b7a0: 6170 6522 3a20 7365 6c66 2e73 6861 7065  ape": self.shape
+0000b7b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b7c0: 2020 2020 2020 2020 2020 2264 7479 7065            "dtype
+0000b7d0: 223a 2073 656c 662e 6474 7970 652c 0a20  ": self.dtype,. 
 0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7f0: 2020 2273 6861 7065 223a 2073 656c 662e    "shape": self.
-0000b800: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b820: 6474 7970 6522 3a20 7365 6c66 2e64 7479  dtype": self.dty
-0000b830: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0000b840: 2020 2020 2020 2020 2020 2020 2263 6875              "chu
-0000b850: 6e6b 7369 7a65 223a 2073 656c 662e 6368  nksize": self.ch
-0000b860: 756e 6b73 697a 652c 0a20 2020 2020 2020  unksize,.       
-0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b880: 2022 6368 756e 6b73 223a 2073 656c 662e   "chunks": self.
-0000b890: 6368 756e 6b73 2c0a 2020 2020 2020 2020  chunks,.        
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8b0: 2274 7970 6522 3a20 7479 7065 6e61 6d65  "type": typename
-0000b8c0: 2874 7970 6528 7365 6c66 2929 2c0a 2020  (type(self)),.  
-0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8e0: 2020 2020 2020 2263 6875 6e6b 5f74 7970        "chunk_typ
-0000b8f0: 6522 3a20 7479 7065 6e61 6d65 2874 7970  e": typename(typ
-0000b900: 6528 7365 6c66 2e5f 6d65 7461 2929 2c0a  e(self._meta)),.
-0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0000b930: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000b940: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
-0000b950: 2020 6465 6620 5f5f 7265 6475 6365 5f5f    def __reduce__
-0000b960: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000b970: 7265 7475 726e 2028 4172 7261 792c 2028  return (Array, (
-0000b980: 7365 6c66 2e64 6173 6b2c 2073 656c 662e  self.dask, self.
-0000b990: 6e61 6d65 2c20 7365 6c66 2e63 6875 6e6b  name, self.chunk
-0000b9a0: 732c 2073 656c 662e 6474 7970 652c 2073  s, self.dtype, s
-0000b9b0: 656c 662e 5f6d 6574 6129 290a 0a20 2020  elf._meta))..   
-0000b9c0: 2064 6566 205f 5f64 6173 6b5f 6772 6170   def __dask_grap
-0000b9d0: 685f 5f28 7365 6c66 293a 0a20 2020 2020  h__(self):.     
-0000b9e0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-0000b9f0: 6173 6b0a 0a20 2020 2064 6566 205f 5f64  ask..    def __d
-0000ba00: 6173 6b5f 6c61 7965 7273 5f5f 2873 656c  ask_layers__(sel
-0000ba10: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-0000ba20: 726e 2028 7365 6c66 2e6e 616d 652c 290a  rn (self.name,).
-0000ba30: 0a20 2020 2064 6566 205f 5f64 6173 6b5f  .    def __dask_
-0000ba40: 6b65 7973 5f5f 2873 656c 6629 3a0a 2020  keys__(self):.  
-0000ba50: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
-0000ba60: 6163 6865 645f 6b65 7973 2069 7320 6e6f  ached_keys is no
-0000ba70: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000ba80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000ba90: 5f63 6163 6865 645f 6b65 7973 0a0a 2020  _cached_keys..  
-0000baa0: 2020 2020 2020 6e61 6d65 2c20 6368 756e        name, chun
-0000bab0: 6b73 2c20 6e75 6d62 6c6f 636b 7320 3d20  ks, numblocks = 
-0000bac0: 7365 6c66 2e6e 616d 652c 2073 656c 662e  self.name, self.
-0000bad0: 6368 756e 6b73 2c20 7365 6c66 2e6e 756d  chunks, self.num
-0000bae0: 626c 6f63 6b73 0a0a 2020 2020 2020 2020  blocks..        
-0000baf0: 6465 6620 6b65 7973 282a 6172 6773 293a  def keys(*args):
-0000bb00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000bb10: 6e6f 7420 6368 756e 6b73 3a0a 2020 2020  not chunks:.    
-0000bb20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000bb30: 726e 205b 286e 616d 652c 295d 0a20 2020  rn [(name,)].   
-0000bb40: 2020 2020 2020 2020 2069 6e64 203d 206c           ind = l
-0000bb50: 656e 2861 7267 7329 0a20 2020 2020 2020  en(args).       
-0000bb60: 2020 2020 2069 6620 696e 6420 2b20 3120       if ind + 1 
-0000bb70: 3d3d 206c 656e 286e 756d 626c 6f63 6b73  == len(numblocks
-0000bb80: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000bb90: 2020 2072 6573 756c 7420 3d20 5b28 6e61     result = [(na
-0000bba0: 6d65 2c29 202b 2061 7267 7320 2b20 2869  me,) + args + (i
-0000bbb0: 2c29 2066 6f72 2069 2069 6e20 7261 6e67  ,) for i in rang
-0000bbc0: 6528 6e75 6d62 6c6f 636b 735b 696e 645d  e(numblocks[ind]
-0000bbd0: 295d 0a20 2020 2020 2020 2020 2020 2065  )].            e
-0000bbe0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000bbf0: 2020 2020 2072 6573 756c 7420 3d20 5b6b       result = [k
-0000bc00: 6579 7328 2a28 6172 6773 202b 2028 692c  eys(*(args + (i,
-0000bc10: 2929 2920 666f 7220 6920 696e 2072 616e  ))) for i in ran
-0000bc20: 6765 286e 756d 626c 6f63 6b73 5b69 6e64  ge(numblocks[ind
-0000bc30: 5d29 5d0a 2020 2020 2020 2020 2020 2020  ])].            
-0000bc40: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
-0000bc50: 2020 2020 2020 2073 656c 662e 5f63 6163         self._cac
-0000bc60: 6865 645f 6b65 7973 203d 2072 6573 756c  hed_keys = resul
-0000bc70: 7420 3d20 6b65 7973 2829 0a20 2020 2020  t = keys().     
-0000bc80: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0000bc90: 0a0a 2020 2020 6465 6620 5f5f 6461 736b  ..    def __dask
-0000bca0: 5f74 6f6b 656e 697a 655f 5f28 7365 6c66  _tokenize__(self
-0000bcb0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000bcc0: 6e20 7365 6c66 2e6e 616d 650a 0a20 2020  n self.name..   
-0000bcd0: 205f 5f64 6173 6b5f 6f70 7469 6d69 7a65   __dask_optimize
-0000bce0: 5f5f 203d 2067 6c6f 6261 6c6d 6574 686f  __ = globalmetho
-0000bcf0: 6428 0a20 2020 2020 2020 206f 7074 696d  d(.        optim
-0000bd00: 697a 652c 206b 6579 3d22 6172 7261 795f  ize, key="array_
-0000bd10: 6f70 7469 6d69 7a65 222c 2066 616c 7365  optimize", false
-0000bd20: 793d 646f 6e74 5f6f 7074 696d 697a 650a  y=dont_optimize.
-0000bd30: 2020 2020 290a 2020 2020 5f5f 6461 736b      ).    __dask
-0000bd40: 5f73 6368 6564 756c 6572 5f5f 203d 2073  _scheduler__ = s
-0000bd50: 7461 7469 636d 6574 686f 6428 4445 4641  taticmethod(DEFA
-0000bd60: 554c 545f 4745 5429 0a0a 2020 2020 6465  ULT_GET)..    de
-0000bd70: 6620 5f5f 6461 736b 5f70 6f73 7463 6f6d  f __dask_postcom
-0000bd80: 7075 7465 5f5f 2873 656c 6629 3a0a 2020  pute__(self):.  
-0000bd90: 2020 2020 2020 7265 7475 726e 2066 696e        return fin
-0000bda0: 616c 697a 652c 2028 290a 0a20 2020 2064  alize, ()..    d
-0000bdb0: 6566 205f 5f64 6173 6b5f 706f 7374 7065  ef __dask_postpe
-0000bdc0: 7273 6973 745f 5f28 7365 6c66 293a 0a20  rsist__(self):. 
-0000bdd0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000bde0: 6c66 2e5f 7265 6275 696c 642c 2028 290a  lf._rebuild, ().
-0000bdf0: 0a20 2020 2064 6566 205f 7265 6275 696c  .    def _rebuil
-0000be00: 6428 7365 6c66 2c20 6473 6b2c 202a 2c20  d(self, dsk, *, 
-0000be10: 7265 6e61 6d65 3d4e 6f6e 6529 3a0a 2020  rename=None):.  
-0000be20: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
-0000be30: 662e 5f6e 616d 650a 2020 2020 2020 2020  f._name.        
-0000be40: 6966 2072 656e 616d 653a 0a20 2020 2020  if rename:.     
-0000be50: 2020 2020 2020 206e 616d 6520 3d20 7265         name = re
-0000be60: 6e61 6d65 2e67 6574 286e 616d 652c 206e  name.get(name, n
-0000be70: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-0000be80: 7572 6e20 4172 7261 7928 6473 6b2c 206e  urn Array(dsk, n
-0000be90: 616d 652c 2073 656c 662e 6368 756e 6b73  ame, self.chunks
-0000bea0: 2c20 7365 6c66 2e64 7479 7065 2c20 7365  , self.dtype, se
-0000beb0: 6c66 2e5f 6d65 7461 290a 0a20 2020 2064  lf._meta)..    d
-0000bec0: 6566 205f 7265 7365 745f 6361 6368 6528  ef _reset_cache(
-0000bed0: 7365 6c66 2c20 6b65 793d 4e6f 6e65 293a  self, key=None):
-0000bee0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000bef0: 2020 2020 2052 6573 6574 2063 6163 6865       Reset cache
-0000bf00: 6420 7072 6f70 6572 7469 6573 2e0a 0a20  d properties... 
-0000bf10: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0000bf20: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000bf30: 2d2d 2d2d 0a20 2020 2020 2020 206b 6579  ----.        key
-0000bf40: 203a 2073 7472 2c20 6f70 7469 6f6e 616c   : str, optional
-0000bf50: 0a20 2020 2020 2020 2020 2020 2052 656d  .            Rem
-0000bf60: 6f76 6520 7370 6563 6966 6965 6420 6b65  ove specified ke
-0000bf70: 792e 2054 6865 2064 6566 6175 6c74 2072  y. The default r
-0000bf80: 656d 6f76 6573 2061 6c6c 2069 7465 6d73  emoves all items
-0000bf90: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000bfa0: 2020 2020 2020 6966 206b 6579 2069 7320        if key is 
-0000bfb0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0000bfc0: 2020 7365 6c66 2e5f 5f64 6963 745f 5f2e    self.__dict__.
-0000bfd0: 636c 6561 7228 290a 2020 2020 2020 2020  clear().        
-0000bfe0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000bff0: 2020 7365 6c66 2e5f 5f64 6963 745f 5f2e    self.__dict__.
-0000c000: 706f 7028 6b65 792c 204e 6f6e 6529 0a0a  pop(key, None)..
-0000c010: 2020 2020 4063 6163 6865 645f 7072 6f70      @cached_prop
-0000c020: 6572 7479 0a20 2020 2064 6566 205f 6b65  erty.    def _ke
-0000c030: 795f 6172 7261 7928 7365 6c66 293a 0a20  y_array(self):. 
-0000c040: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
-0000c050: 2e61 7272 6179 2873 656c 662e 5f5f 6461  .array(self.__da
-0000c060: 736b 5f6b 6579 735f 5f28 292c 2064 7479  sk_keys__(), dty
-0000c070: 7065 3d6f 626a 6563 7429 0a0a 2020 2020  pe=object)..    
-0000c080: 4063 6163 6865 645f 7072 6f70 6572 7479  @cached_property
-0000c090: 0a20 2020 2064 6566 206e 756d 626c 6f63  .    def numbloc
-0000c0a0: 6b73 2873 656c 6629 3a0a 2020 2020 2020  ks(self):.      
-0000c0b0: 2020 7265 7475 726e 2074 7570 6c65 286d    return tuple(m
-0000c0c0: 6170 286c 656e 2c20 7365 6c66 2e63 6875  ap(len, self.chu
-0000c0d0: 6e6b 7329 290a 0a20 2020 2040 6361 6368  nks))..    @cach
-0000c0e0: 6564 5f70 726f 7065 7274 790a 2020 2020  ed_property.    
-0000c0f0: 6465 6620 6e70 6172 7469 7469 6f6e 7328  def npartitions(
-0000c100: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0000c110: 6574 7572 6e20 7265 6475 6365 286d 756c  eturn reduce(mul
-0000c120: 2c20 7365 6c66 2e6e 756d 626c 6f63 6b73  , self.numblocks
-0000c130: 2c20 3129 0a0a 2020 2020 6465 6620 636f  , 1)..    def co
-0000c140: 6d70 7574 655f 6368 756e 6b5f 7369 7a65  mpute_chunk_size
-0000c150: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000c160: 2022 2222 0a20 2020 2020 2020 2043 6f6d   """.        Com
-0000c170: 7075 7465 2074 6865 2063 6875 6e6b 2073  pute the chunk s
-0000c180: 697a 6573 2066 6f72 2061 2044 6173 6b20  izes for a Dask 
-0000c190: 6172 7261 792e 2054 6869 7320 6973 2065  array. This is e
-0000c1a0: 7370 6563 6961 6c6c 7920 7573 6566 756c  specially useful
-0000c1b0: 0a20 2020 2020 2020 2077 6865 6e20 7468  .        when th
-0000c1c0: 6520 6368 756e 6b20 7369 7a65 7320 6172  e chunk sizes ar
-0000c1d0: 6520 756e 6b6e 6f77 6e20 2865 2e67 2e2c  e unknown (e.g.,
-0000c1e0: 2077 6865 6e20 696e 6465 7869 6e67 206f   when indexing o
-0000c1f0: 6e65 2044 6173 6b20 6172 7261 790a 2020  ne Dask array.  
-0000c200: 2020 2020 2020 7769 7468 2061 6e6f 7468        with anoth
-0000c210: 6572 292e 0a0a 2020 2020 2020 2020 4e6f  er)...        No
-0000c220: 7465 730a 2020 2020 2020 2020 2d2d 2d2d  tes.        ----
-0000c230: 2d0a 2020 2020 2020 2020 5468 6973 2066  -.        This f
-0000c240: 756e 6374 696f 6e20 6d6f 6469 6669 6573  unction modifies
-0000c250: 2074 6865 2044 6173 6b20 6172 7261 7920   the Dask array 
-0000c260: 696e 2d70 6c61 6365 2e0a 0a20 2020 2020  in-place...     
-0000c270: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
-0000c280: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0000c290: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
-0000c2a0: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
-0000c2b0: 0a20 2020 2020 2020 203e 3e3e 2069 6d70  .        >>> imp
-0000c2c0: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-0000c2d0: 2020 2020 2020 2020 3e3e 3e20 7820 3d20          >>> x = 
-0000c2e0: 6461 2e66 726f 6d5f 6172 7261 7928 5b2d  da.from_array([-
-0000c2f0: 322c 202d 312c 2030 2c20 312c 2032 5d2c  2, -1, 0, 1, 2],
-0000c300: 2063 6875 6e6b 733d 3229 0a20 2020 2020   chunks=2).     
-0000c310: 2020 203e 3e3e 2078 2e63 6875 6e6b 730a     >>> x.chunks.
-0000c320: 2020 2020 2020 2020 2828 322c 2032 2c20          ((2, 2, 
-0000c330: 3129 2c29 0a20 2020 2020 2020 203e 3e3e  1),).        >>>
-0000c340: 2079 203d 2078 5b78 203c 3d20 305d 0a20   y = x[x <= 0]. 
-0000c350: 2020 2020 2020 203e 3e3e 2079 2e63 6875         >>> y.chu
-0000c360: 6e6b 730a 2020 2020 2020 2020 2828 6e61  nks.        ((na
-0000c370: 6e2c 206e 616e 2c20 6e61 6e29 2c29 0a20  n, nan, nan),). 
-0000c380: 2020 2020 2020 203e 3e3e 2079 2e63 6f6d         >>> y.com
-0000c390: 7075 7465 5f63 6875 6e6b 5f73 697a 6573  pute_chunk_sizes
-0000c3a0: 2829 2020 2320 696e 2d70 6c61 6365 2063  ()  # in-place c
-0000c3b0: 6f6d 7075 7461 7469 6f6e 0a20 2020 2020  omputation.     
-0000c3c0: 2020 2064 6173 6b2e 6172 7261 793c 6765     dask.array<ge
-0000c3d0: 7469 7465 6d2c 2073 6861 7065 3d28 332c  titem, shape=(3,
-0000c3e0: 292c 2064 7479 7065 3d69 6e74 3634 2c20  ), dtype=int64, 
-0000c3f0: 6368 756e 6b73 697a 653d 2832 2c29 2c20  chunksize=(2,), 
-0000c400: 6368 756e 6b74 7970 653d 6e75 6d70 792e  chunktype=numpy.
-0000c410: 6e64 6172 7261 793e 0a20 2020 2020 2020  ndarray>.       
-0000c420: 203e 3e3e 2079 2e63 6875 6e6b 730a 2020   >>> y.chunks.  
-0000c430: 2020 2020 2020 2828 322c 2031 2c20 3029        ((2, 1, 0)
-0000c440: 2c29 0a0a 2020 2020 2020 2020 2222 220a  ,)..        """.
-0000c450: 2020 2020 2020 2020 7820 3d20 7365 6c66          x = self
-0000c460: 0a20 2020 2020 2020 2063 6875 6e6b 5f73  .        chunk_s
-0000c470: 6861 7065 7320 3d20 782e 6d61 705f 626c  hapes = x.map_bl
-0000c480: 6f63 6b73 280a 2020 2020 2020 2020 2020  ocks(.          
-0000c490: 2020 5f67 6574 5f63 6875 6e6b 5f73 6861    _get_chunk_sha
-0000c4a0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
-0000c4b0: 6474 7970 653d 696e 742c 0a20 2020 2020  dtype=int,.     
-0000c4c0: 2020 2020 2020 2063 6875 6e6b 733d 7475         chunks=tu
-0000c4d0: 706c 6528 6c65 6e28 6329 202a 2028 312c  ple(len(c) * (1,
-0000c4e0: 2920 666f 7220 6320 696e 2078 2e63 6875  ) for c in x.chu
-0000c4f0: 6e6b 7329 202b 2028 2878 2e6e 6469 6d2c  nks) + ((x.ndim,
-0000c500: 292c 292c 0a20 2020 2020 2020 2020 2020  ),),.           
-0000c510: 206e 6577 5f61 7869 733d 782e 6e64 696d   new_axis=x.ndim
-0000c520: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000c530: 2020 2020 2063 203d 205b 5d0a 2020 2020       c = [].    
-0000c540: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-0000c550: 6765 2878 2e6e 6469 6d29 3a0a 2020 2020  ge(x.ndim):.    
-0000c560: 2020 2020 2020 2020 7320 3d20 782e 6e64          s = x.nd
-0000c570: 696d 202a 205b 305d 202b 205b 695d 0a20  im * [0] + [i]. 
-0000c580: 2020 2020 2020 2020 2020 2073 5b69 5d20             s[i] 
-0000c590: 3d20 736c 6963 6528 4e6f 6e65 290a 2020  = slice(None).  
-0000c5a0: 2020 2020 2020 2020 2020 7320 3d20 7475            s = tu
-0000c5b0: 706c 6528 7329 0a0a 2020 2020 2020 2020  ple(s)..        
-0000c5c0: 2020 2020 632e 6170 7065 6e64 2874 7570      c.append(tup
-0000c5d0: 6c65 2863 6875 6e6b 5f73 6861 7065 735b  le(chunk_shapes[
-0000c5e0: 735d 2929 0a0a 2020 2020 2020 2020 2320  s]))..        # 
-0000c5f0: 606d 6170 5f62 6c6f 636b 7360 2061 7373  `map_blocks` ass
-0000c600: 6967 6e73 206e 756d 7079 2064 7479 7065  igns numpy dtype
-0000c610: 730a 2020 2020 2020 2020 2320 6361 7374  s.        # cast
-0000c620: 2063 6875 6e6b 2064 696d 656e 7369 6f6e   chunk dimension
-0000c630: 7320 6261 636b 2074 6f20 7079 7468 6f6e  s back to python
-0000c640: 2069 6e74 2062 6566 6f72 6520 7265 7475   int before retu
-0000c650: 726e 696e 670a 2020 2020 2020 2020 782e  rning.        x.
-0000c660: 5f63 6875 6e6b 7320 3d20 7475 706c 6528  _chunks = tuple(
-0000c670: 0a20 2020 2020 2020 2020 2020 2074 7570  .            tup
-0000c680: 6c65 2869 6e74 2863 6875 6e6b 2920 666f  le(int(chunk) fo
-0000c690: 7220 6368 756e 6b20 696e 2063 6875 6e6b  r chunk in chunk
-0000c6a0: 7329 2066 6f72 2063 6875 6e6b 7320 696e  s) for chunks in
-0000c6b0: 2063 6f6d 7075 7465 2874 7570 6c65 2863   compute(tuple(c
-0000c6c0: 2929 5b30 5d0a 2020 2020 2020 2020 290a  ))[0].        ).
-0000c6d0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-0000c6e0: 0a0a 2020 2020 4063 6163 6865 645f 7072  ..    @cached_pr
-0000c6f0: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
-0000c700: 6861 7065 2873 656c 6629 202d 3e20 7475  hape(self) -> tu
-0000c710: 706c 655b 545f 496e 744f 724e 614e 2c20  ple[T_IntOrNaN, 
-0000c720: 2e2e 2e5d 3a0a 2020 2020 2020 2020 7265  ...]:.        re
-0000c730: 7475 726e 2074 7570 6c65 2863 6163 6865  turn tuple(cache
-0000c740: 645f 6375 6d73 756d 2863 2c20 696e 6974  d_cumsum(c, init
-0000c750: 6961 6c5f 7a65 726f 3d54 7275 6529 5b2d  ial_zero=True)[-
-0000c760: 315d 2066 6f72 2063 2069 6e20 7365 6c66  1] for c in self
-0000c770: 2e63 6875 6e6b 7329 0a0a 2020 2020 4070  .chunks)..    @p
-0000c780: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000c790: 6368 756e 6b73 697a 6528 7365 6c66 2920  chunksize(self) 
-0000c7a0: 2d3e 2074 7570 6c65 5b54 5f49 6e74 4f72  -> tuple[T_IntOr
-0000c7b0: 4e61 4e2c 202e 2e2e 5d3a 0a20 2020 2020  NaN, ...]:.     
-0000c7c0: 2020 2072 6574 7572 6e20 7475 706c 6528     return tuple(
-0000c7d0: 6d61 7828 6329 2066 6f72 2063 2069 6e20  max(c) for c in 
-0000c7e0: 7365 6c66 2e63 6875 6e6b 7329 0a0a 2020  self.chunks)..  
-0000c7f0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000c800: 6465 6620 6474 7970 6528 7365 6c66 293a  def dtype(self):
-0000c810: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0000c820: 7374 616e 6365 2873 656c 662e 5f6d 6574  stance(self._met
-0000c830: 612c 2074 7570 6c65 293a 0a20 2020 2020  a, tuple):.     
-0000c840: 2020 2020 2020 2064 7479 7065 203d 2073         dtype = s
-0000c850: 656c 662e 5f6d 6574 615b 305d 2e64 7479  elf._meta[0].dty
-0000c860: 7065 0a20 2020 2020 2020 2065 6c73 653a  pe.        else:
-0000c870: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
-0000c880: 7065 203d 2073 656c 662e 5f6d 6574 612e  pe = self._meta.
-0000c890: 6474 7970 650a 2020 2020 2020 2020 7265  dtype.        re
-0000c8a0: 7475 726e 2064 7479 7065 0a0a 2020 2020  turn dtype..    
-0000c8b0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0000c8c0: 6620 5f63 6875 6e6b 7328 7365 6c66 293a  f _chunks(self):
-0000c8d0: 0a20 2020 2020 2020 2022 2222 4e6f 6e2d  .        """Non-
-0000c8e0: 7075 626c 6963 2063 6875 6e6b 7320 7072  public chunks pr
-0000c8f0: 6f70 6572 7479 2e20 416c 6c6f 7773 2073  operty. Allows s
-0000c900: 6574 7469 6e67 2061 2063 6875 6e6b 2076  etting a chunk v
-0000c910: 616c 7565 2e22 2222 0a20 2020 2020 2020  alue.""".       
-0000c920: 2072 6574 7572 6e20 7365 6c66 2e5f 5f63   return self.__c
-0000c930: 6875 6e6b 730a 0a20 2020 2040 5f63 6875  hunks..    @_chu
-0000c940: 6e6b 732e 7365 7474 6572 0a20 2020 2064  nks.setter.    d
-0000c950: 6566 205f 6368 756e 6b73 2873 656c 662c  ef _chunks(self,
-0000c960: 2063 6875 6e6b 7329 3a0a 2020 2020 2020   chunks):.      
-0000c970: 2020 7365 6c66 2e5f 5f63 6875 6e6b 7320    self.__chunks 
-0000c980: 3d20 6368 756e 6b73 0a0a 2020 2020 2020  = chunks..      
-0000c990: 2020 2320 5768 656e 2074 6865 2063 6875    # When the chu
-0000c9a0: 6e6b 7320 6368 616e 6765 7320 7468 6520  nks changes the 
-0000c9b0: 6361 6368 6564 2070 726f 7065 7274 6965  cached propertie
-0000c9c0: 7320 7468 6174 2077 6173 0a20 2020 2020  s that was.     
-0000c9d0: 2020 2023 2064 6570 656e 6465 6e74 206f     # dependent o
-0000c9e0: 6e20 6974 206e 6565 6473 2074 6f20 6265  n it needs to be
-0000c9f0: 2064 656c 6574 6564 3a0a 2020 2020 2020   deleted:.      
-0000ca00: 2020 666f 7220 6b65 7920 696e 205b 226e    for key in ["n
-0000ca10: 756d 626c 6f63 6b73 222c 2022 6e70 6172  umblocks", "npar
-0000ca20: 7469 7469 6f6e 7322 2c20 2273 6861 7065  titions", "shape
-0000ca30: 222c 2022 6e64 696d 222c 2022 7369 7a65  ", "ndim", "size
-0000ca40: 222c 2022 5f6b 6579 5f61 7272 6179 225d  ", "_key_array"]
-0000ca50: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000ca60: 6c66 2e5f 7265 7365 745f 6361 6368 6528  lf._reset_cache(
-0000ca70: 6b65 7929 0a0a 2020 2020 4070 726f 7065  key)..    @prope
-0000ca80: 7274 790a 2020 2020 6465 6620 6368 756e  rty.    def chun
-0000ca90: 6b73 2873 656c 6629 3a0a 2020 2020 2020  ks(self):.      
-0000caa0: 2020 2222 2243 6875 6e6b 7320 7072 6f70    """Chunks prop
-0000cab0: 6572 7479 2e22 2222 0a20 2020 2020 2020  erty.""".       
-0000cac0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f63   return self.__c
-0000cad0: 6875 6e6b 730a 0a20 2020 2040 6368 756e  hunks..    @chun
-0000cae0: 6b73 2e73 6574 7465 720a 2020 2020 6465  ks.setter.    de
-0000caf0: 6620 6368 756e 6b73 2873 656c 662c 2063  f chunks(self, c
-0000cb00: 6875 6e6b 7329 3a0a 2020 2020 2020 2020  hunks):.        
-0000cb10: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0000cb20: 0a20 2020 2020 2020 2020 2020 2022 4361  .            "Ca
-0000cb30: 6e20 6e6f 7420 7365 7420 6368 756e 6b73  n not set chunks
-0000cb40: 2064 6972 6563 746c 795c 6e5c 6e22 0a20   directly\n\n". 
-0000cb50: 2020 2020 2020 2020 2020 2022 506c 6561             "Plea
-0000cb60: 7365 2075 7365 2074 6865 2072 6563 6875  se use the rechu
-0000cb70: 6e6b 206d 6574 686f 6420 696e 7374 6561  nk method instea
-0000cb80: 643a 5c6e 220a 2020 2020 2020 2020 2020  d:\n".          
-0000cb90: 2020 6622 2020 782e 7265 6368 756e 6b28    f"  x.rechunk(
-0000cba0: 7b63 6875 6e6b 737d 295c 6e5c 6e22 0a20  {chunks})\n\n". 
-0000cbb0: 2020 2020 2020 2020 2020 2022 4966 2074             "If t
-0000cbc0: 7279 696e 6720 746f 2061 766f 6964 2075  rying to avoid u
-0000cbd0: 6e6b 6e6f 776e 2063 6875 6e6b 732c 2075  nknown chunks, u
-0000cbe0: 7365 5c6e 220a 2020 2020 2020 2020 2020  se\n".          
-0000cbf0: 2020 2220 2078 2e63 6f6d 7075 7465 5f63    "  x.compute_c
-0000cc00: 6875 6e6b 5f73 697a 6573 2829 220a 2020  hunk_sizes()".  
-0000cc10: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0000cc20: 205f 5f6c 656e 5f5f 2873 656c 6629 3a0a   __len__(self):.
-0000cc30: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000cc40: 656c 662e 6368 756e 6b73 3a0a 2020 2020  elf.chunks:.    
-0000cc50: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000cc60: 7065 4572 726f 7228 226c 656e 2829 206f  peError("len() o
-0000cc70: 6620 756e 7369 7a65 6420 6f62 6a65 6374  f unsized object
-0000cc80: 2229 0a20 2020 2020 2020 2069 6620 6e70  ").        if np
-0000cc90: 2e69 736e 616e 2873 656c 662e 6368 756e  .isnan(self.chun
-0000cca0: 6b73 5b30 5d29 2e61 6e79 2829 3a0a 2020  ks[0]).any():.  
-0000ccb0: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-0000ccc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ccd0: 2020 2243 616e 6e6f 7420 6361 6c6c 206c    "Cannot call l
-0000cce0: 656e 2829 206f 6e20 6f62 6a65 6374 2077  en() on object w
-0000ccf0: 6974 6820 756e 6b6e 6f77 6e20 6368 756e  ith unknown chun
-0000cd00: 6b20 7369 7a65 2e22 0a20 2020 2020 2020  k size.".       
-0000cd10: 2020 2020 2020 2020 2066 227b 756e 6b6e           f"{unkn
-0000cd20: 6f77 6e5f 6368 756e 6b5f 6d65 7373 6167  own_chunk_messag
-0000cd30: 657d 220a 2020 2020 2020 2020 2020 2020  e}".            
-0000cd40: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-0000cd50: 6973 6520 5661 6c75 6545 7272 6f72 286d  ise ValueError(m
-0000cd60: 7367 290a 2020 2020 2020 2020 7265 7475  sg).        retu
-0000cd70: 726e 2069 6e74 2873 756d 2873 656c 662e  rn int(sum(self.
-0000cd80: 6368 756e 6b73 5b30 5d29 290a 0a20 2020  chunks[0]))..   
-0000cd90: 2064 6566 205f 5f61 7272 6179 5f75 6675   def __array_ufu
-0000cda0: 6e63 5f5f 2873 656c 662c 206e 756d 7079  nc__(self, numpy
-0000cdb0: 5f75 6675 6e63 2c20 6d65 7468 6f64 2c20  _ufunc, method, 
-0000cdc0: 2a69 6e70 7574 732c 202a 2a6b 7761 7267  *inputs, **kwarg
-0000cdd0: 7329 3a0a 2020 2020 2020 2020 6f75 7420  s):.        out 
-0000cde0: 3d20 6b77 6172 6773 2e67 6574 2822 6f75  = kwargs.get("ou
-0000cdf0: 7422 2c20 2829 290a 2020 2020 2020 2020  t", ()).        
-0000ce00: 666f 7220 7820 696e 2069 6e70 7574 7320  for x in inputs 
-0000ce10: 2b20 6f75 743a 0a20 2020 2020 2020 2020  + out:.         
-0000ce20: 2020 2069 6620 5f73 686f 756c 645f 6465     if _should_de
-0000ce30: 6c65 6761 7465 2873 656c 662c 2078 293a  legate(self, x):
-0000ce40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce50: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
-0000ce60: 6d65 6e74 6564 0a0a 2020 2020 2020 2020  mented..        
-0000ce70: 6966 206d 6574 686f 6420 3d3d 2022 5f5f  if method == "__
-0000ce80: 6361 6c6c 5f5f 223a 0a20 2020 2020 2020  call__":.       
-0000ce90: 2020 2020 2069 6620 6e75 6d70 795f 7566       if numpy_uf
-0000cea0: 756e 6320 6973 206e 702e 6d61 746d 756c  unc is np.matmul
-0000ceb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cec0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-0000ced0: 792e 726f 7574 696e 6573 2069 6d70 6f72  y.routines impor
-0000cee0: 7420 6d61 746d 756c 0a0a 2020 2020 2020  t matmul..      
-0000cef0: 2020 2020 2020 2020 2020 2320 7370 6563            # spec
-0000cf00: 6961 6c20 6361 7365 2075 6e74 696c 2061  ial case until a
-0000cf10: 7070 6c79 5f67 7566 756e 6320 6861 6e64  pply_gufunc hand
-0000cf20: 6c65 7320 6f70 7469 6f6e 616c 2064 696d  les optional dim
-0000cf30: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
-0000cf40: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0000cf50: 6174 6d75 6c28 2a69 6e70 7574 732c 202a  atmul(*inputs, *
-0000cf60: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0000cf70: 2020 2020 2069 6620 6e75 6d70 795f 7566       if numpy_uf
-0000cf80: 756e 632e 7369 676e 6174 7572 6520 6973  unc.signature is
-0000cf90: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000cfa0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0000cfb0: 6461 736b 2e61 7272 6179 2e67 7566 756e  dask.array.gufun
-0000cfc0: 6320 696d 706f 7274 2061 7070 6c79 5f67  c import apply_g
-0000cfd0: 7566 756e 630a 0a20 2020 2020 2020 2020  ufunc..         
-0000cfe0: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
-0000cff0: 706c 795f 6775 6675 6e63 280a 2020 2020  ply_gufunc(.    
-0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d010: 6e75 6d70 795f 7566 756e 632c 206e 756d  numpy_ufunc, num
-0000d020: 7079 5f75 6675 6e63 2e73 6967 6e61 7475  py_ufunc.signatu
-0000d030: 7265 2c20 2a69 6e70 7574 732c 202a 2a6b  re, *inputs, **k
-0000d040: 7761 7267 730a 2020 2020 2020 2020 2020  wargs.          
-0000d050: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d060: 2020 2020 6966 206e 756d 7079 5f75 6675      if numpy_ufu
-0000d070: 6e63 2e6e 6f75 7420 3e20 313a 0a20 2020  nc.nout > 1:.   
-0000d080: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-0000d090: 6d20 6461 736b 2e61 7272 6179 2069 6d70  m dask.array imp
-0000d0a0: 6f72 7420 7566 756e 630a 0a20 2020 2020  ort ufunc..     
-0000d0b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0d0: 2020 2020 6461 5f75 6675 6e63 203d 2067      da_ufunc = g
-0000d0e0: 6574 6174 7472 2875 6675 6e63 2c20 6e75  etattr(ufunc, nu
-0000d0f0: 6d70 795f 7566 756e 632e 5f5f 6e61 6d65  mpy_ufunc.__name
-0000d100: 5f5f 290a 2020 2020 2020 2020 2020 2020  __).            
-0000d110: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-0000d120: 6275 7465 4572 726f 723a 0a20 2020 2020  buteError:.     
-0000d130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d140: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-0000d150: 6e74 6564 0a20 2020 2020 2020 2020 2020  nted.           
-0000d160: 2020 2020 2072 6574 7572 6e20 6461 5f75       return da_u
-0000d170: 6675 6e63 282a 696e 7075 7473 2c20 2a2a  func(*inputs, **
-0000d180: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0000d190: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d1a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d1b0: 2065 6c65 6d77 6973 6528 6e75 6d70 795f   elemwise(numpy_
-0000d1c0: 7566 756e 632c 202a 696e 7075 7473 2c20  ufunc, *inputs, 
-0000d1d0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0000d1e0: 2020 656c 6966 206d 6574 686f 6420 3d3d    elif method ==
-0000d1f0: 2022 6f75 7465 7222 3a0a 2020 2020 2020   "outer":.      
-0000d200: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-0000d210: 6172 7261 7920 696d 706f 7274 2075 6675  array import ufu
-0000d220: 6e63 0a0a 2020 2020 2020 2020 2020 2020  nc..            
-0000d230: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000d240: 2020 2020 2064 615f 7566 756e 6320 3d20       da_ufunc = 
-0000d250: 6765 7461 7474 7228 7566 756e 632c 206e  getattr(ufunc, n
-0000d260: 756d 7079 5f75 6675 6e63 2e5f 5f6e 616d  umpy_ufunc.__nam
-0000d270: 655f 5f29 0a20 2020 2020 2020 2020 2020  e__).           
-0000d280: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-0000d290: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0000d2a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0000d2b0: 6f74 496d 706c 656d 656e 7465 640a 2020  otImplemented.  
-0000d2c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d2d0: 2064 615f 7566 756e 632e 6f75 7465 7228   da_ufunc.outer(
-0000d2e0: 2a69 6e70 7574 732c 202a 2a6b 7761 7267  *inputs, **kwarg
-0000d2f0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0000d300: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000d310: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
-0000d320: 6564 0a0a 2020 2020 6465 6620 5f5f 7265  ed..    def __re
-0000d330: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
-0000d340: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000d350: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
-0000d360: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
-0000d370: 2020 2020 203e 3e3e 2064 612e 6f6e 6573       >>> da.ones
-0000d380: 2828 3130 2c20 3130 292c 2063 6875 6e6b  ((10, 10), chunk
-0000d390: 733d 2835 2c20 3529 2c20 6474 7970 653d  s=(5, 5), dtype=
-0000d3a0: 2769 3427 290a 2020 2020 2020 2020 6461  'i4').        da
-0000d3b0: 736b 2e61 7272 6179 3c2e 2e2e 2c20 7368  sk.array<..., sh
-0000d3c0: 6170 653d 2831 302c 2031 3029 2c20 6474  ape=(10, 10), dt
-0000d3d0: 7970 653d 696e 7433 322c 2063 6875 6e6b  ype=int32, chunk
-0000d3e0: 7369 7a65 3d28 352c 2035 292c 2063 6875  size=(5, 5), chu
-0000d3f0: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-0000d400: 7272 6179 3e0a 2020 2020 2020 2020 2222  rray>.        ""
-0000d410: 220a 2020 2020 2020 2020 6368 756e 6b73  ".        chunks
-0000d420: 697a 6520 3d20 7374 7228 7365 6c66 2e63  ize = str(self.c
-0000d430: 6875 6e6b 7369 7a65 290a 2020 2020 2020  hunksize).      
-0000d440: 2020 6e61 6d65 203d 2073 656c 662e 6e61    name = self.na
-0000d450: 6d65 2e72 7370 6c69 7428 222d 222c 2031  me.rsplit("-", 1
-0000d460: 295b 305d 0a20 2020 2020 2020 2072 6574  )[0].        ret
-0000d470: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-0000d480: 2020 2264 6173 6b2e 6172 7261 793c 7b7d    "dask.array<{}
-0000d490: 2c20 7368 6170 653d 7b7d 2c20 6474 7970  , shape={}, dtyp
-0000d4a0: 653d 7b7d 2c20 6368 756e 6b73 697a 653d  e={}, chunksize=
-0000d4b0: 7b7d 2c20 6368 756e 6b74 7970 653d 7b7d  {}, chunktype={}
-0000d4c0: 2e7b 7d3e 222e 666f 726d 6174 280a 2020  .{}>".format(.  
-0000d4d0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0000d4e0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0000d4f0: 2020 2020 7365 6c66 2e73 6861 7065 2c0a      self.shape,.
-0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d510: 7365 6c66 2e64 7479 7065 2c0a 2020 2020  self.dtype,.    
-0000d520: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-0000d530: 6b73 697a 652c 0a20 2020 2020 2020 2020  ksize,.         
-0000d540: 2020 2020 2020 2074 7970 6528 7365 6c66         type(self
-0000d550: 2e5f 6d65 7461 292e 5f5f 6d6f 6475 6c65  ._meta).__module
-0000d560: 5f5f 2e73 706c 6974 2822 2e22 295b 305d  __.split(".")[0]
-0000d570: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000d580: 2020 7479 7065 2873 656c 662e 5f6d 6574    type(self._met
-0000d590: 6129 2e5f 5f6e 616d 655f 5f2c 0a20 2020  a).__name__,.   
-0000d5a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000d5b0: 2020 2029 0a0a 2020 2020 6465 6620 5f72     )..    def _r
-0000d5c0: 6570 725f 6874 6d6c 5f28 7365 6c66 293a  epr_html_(self):
-0000d5d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000d5e0: 2020 2020 2020 2020 2020 6772 6964 203d            grid =
-0000d5f0: 2073 656c 662e 746f 5f73 7667 2873 697a   self.to_svg(siz
-0000d600: 653d 636f 6e66 6967 2e67 6574 2822 6172  e=config.get("ar
-0000d610: 7261 792e 7376 672e 7369 7a65 222c 2031  ray.svg.size", 1
-0000d620: 3230 2929 0a20 2020 2020 2020 2065 7863  20)).        exc
-0000d630: 6570 7420 4e6f 7449 6d70 6c65 6d65 6e74  ept NotImplement
-0000d640: 6564 4572 726f 723a 0a20 2020 2020 2020  edError:.       
-0000d650: 2020 2020 2067 7269 6420 3d20 2222 0a0a       grid = ""..
-0000d660: 2020 2020 2020 2020 6966 2022 7370 6172          if "spar
-0000d670: 7365 2220 696e 2074 7970 656e 616d 6528  se" in typename(
-0000d680: 7479 7065 2873 656c 662e 5f6d 6574 6129  type(self._meta)
-0000d690: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0000d6a0: 6279 7465 7320 3d20 4e6f 6e65 0a20 2020  bytes = None.   
-0000d6b0: 2020 2020 2020 2020 2063 6279 7465 7320           cbytes 
-0000d6c0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2065  = None.        e
-0000d6d0: 6c69 6620 6e6f 7420 6d61 7468 2e69 736e  lif not math.isn
-0000d6e0: 616e 2873 656c 662e 6e62 7974 6573 293a  an(self.nbytes):
-0000d6f0: 0a20 2020 2020 2020 2020 2020 206e 6279  .            nby
-0000d700: 7465 7320 3d20 666f 726d 6174 5f62 7974  tes = format_byt
-0000d710: 6573 2873 656c 662e 6e62 7974 6573 290a  es(self.nbytes).
-0000d720: 2020 2020 2020 2020 2020 2020 6362 7974              cbyt
-0000d730: 6573 203d 2066 6f72 6d61 745f 6279 7465  es = format_byte
-0000d740: 7328 6d61 7468 2e70 726f 6428 7365 6c66  s(math.prod(self
-0000d750: 2e63 6875 6e6b 7369 7a65 2920 2a20 7365  .chunksize) * se
-0000d760: 6c66 2e64 7479 7065 2e69 7465 6d73 697a  lf.dtype.itemsiz
-0000d770: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-0000d780: 0a20 2020 2020 2020 2020 2020 206e 6279  .            nby
-0000d790: 7465 7320 3d20 2275 6e6b 6e6f 776e 220a  tes = "unknown".
-0000d7a0: 2020 2020 2020 2020 2020 2020 6362 7974              cbyt
-0000d7b0: 6573 203d 2022 756e 6b6e 6f77 6e22 0a0a  es = "unknown"..
-0000d7c0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-0000d7d0: 6574 5f74 656d 706c 6174 6528 2261 7272  et_template("arr
-0000d7e0: 6179 2e68 746d 6c2e 6a32 2229 2e72 656e  ay.html.j2").ren
-0000d7f0: 6465 7228 0a20 2020 2020 2020 2020 2020  der(.           
-0000d800: 2061 7272 6179 3d73 656c 662c 0a20 2020   array=self,.   
-0000d810: 2020 2020 2020 2020 2067 7269 643d 6772           grid=gr
-0000d820: 6964 2c0a 2020 2020 2020 2020 2020 2020  id,.            
-0000d830: 6e62 7974 6573 3d6e 6279 7465 732c 0a20  nbytes=nbytes,. 
-0000d840: 2020 2020 2020 2020 2020 2063 6279 7465             cbyte
-0000d850: 733d 6362 7974 6573 2c0a 2020 2020 2020  s=cbytes,.      
-0000d860: 2020 2020 2020 6c61 7965 7273 3d6d 6179        layers=may
-0000d870: 6265 5f70 6c75 7261 6c69 7a65 286c 656e  be_pluralize(len
-0000d880: 2873 656c 662e 6461 736b 2e6c 6179 6572  (self.dask.layer
-0000d890: 7329 2c20 2267 7261 7068 206c 6179 6572  s), "graph layer
-0000d8a0: 2229 2c0a 2020 2020 2020 2020 290a 0a20  "),.        ).. 
-0000d8b0: 2020 2040 6361 6368 6564 5f70 726f 7065     @cached_prope
-0000d8c0: 7274 790a 2020 2020 6465 6620 6e64 696d  rty.    def ndim
-0000d8d0: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
-0000d8e0: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
-0000d8f0: 6e28 7365 6c66 2e73 6861 7065 290a 0a20  n(self.shape).. 
-0000d900: 2020 2040 6361 6368 6564 5f70 726f 7065     @cached_prope
-0000d910: 7274 790a 2020 2020 6465 6620 7369 7a65  rty.    def size
-0000d920: 2873 656c 6629 202d 3e20 545f 496e 744f  (self) -> T_IntO
-0000d930: 724e 614e 3a0a 2020 2020 2020 2020 2222  rNaN:.        ""
-0000d940: 224e 756d 6265 7220 6f66 2065 6c65 6d65  "Number of eleme
-0000d950: 6e74 7320 696e 2061 7272 6179 2222 220a  nts in array""".
-0000d960: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0000d970: 6564 7563 6528 6d75 6c2c 2073 656c 662e  educe(mul, self.
-0000d980: 7368 6170 652c 2031 290a 0a20 2020 2040  shape, 1)..    @
-0000d990: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000d9a0: 206e 6279 7465 7328 7365 6c66 2920 2d3e   nbytes(self) ->
-0000d9b0: 2054 5f49 6e74 4f72 4e61 4e3a 0a20 2020   T_IntOrNaN:.   
-0000d9c0: 2020 2020 2022 2222 4e75 6d62 6572 206f       """Number o
-0000d9d0: 6620 6279 7465 7320 696e 2061 7272 6179  f bytes in array
-0000d9e0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000d9f0: 726e 2073 656c 662e 7369 7a65 202a 2073  rn self.size * s
-0000da00: 656c 662e 6474 7970 652e 6974 656d 7369  elf.dtype.itemsi
-0000da10: 7a65 0a0a 2020 2020 4070 726f 7065 7274  ze..    @propert
-0000da20: 790a 2020 2020 6465 6620 6974 656d 7369  y.    def itemsi
-0000da30: 7a65 2873 656c 6629 202d 3e20 696e 743a  ze(self) -> int:
-0000da40: 0a20 2020 2020 2020 2022 2222 4c65 6e67  .        """Leng
-0000da50: 7468 206f 6620 6f6e 6520 6172 7261 7920  th of one array 
-0000da60: 656c 656d 656e 7420 696e 2062 7974 6573  element in bytes
-0000da70: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000da80: 726e 2073 656c 662e 6474 7970 652e 6974  rn self.dtype.it
-0000da90: 656d 7369 7a65 0a0a 2020 2020 4070 726f  emsize..    @pro
-0000daa0: 7065 7274 790a 2020 2020 6465 6620 5f6e  perty.    def _n
-0000dab0: 616d 6528 7365 6c66 293a 0a20 2020 2020  ame(self):.     
-0000dac0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000dad0: 5f6e 616d 650a 0a20 2020 2040 5f6e 616d  _name..    @_nam
-0000dae0: 652e 7365 7474 6572 0a20 2020 2064 6566  e.setter.    def
-0000daf0: 205f 6e61 6d65 2873 656c 662c 2076 616c   _name(self, val
-0000db00: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0000db10: 5f5f 6e61 6d65 203d 2076 616c 0a20 2020  __name = val.   
-0000db20: 2020 2020 2023 2043 6c65 6172 2074 6865       # Clear the
-0000db30: 206b 6579 2063 6163 6865 2077 6865 6e20   key cache when 
-0000db40: 7468 6520 6e61 6d65 2069 7320 7265 7365  the name is rese
-0000db50: 740a 2020 2020 2020 2020 7365 6c66 2e5f  t.        self._
-0000db60: 6361 6368 6564 5f6b 6579 7320 3d20 4e6f  cached_keys = No
-0000db70: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-0000db80: 5f72 6573 6574 5f63 6163 6865 2822 5f6b  _reset_cache("_k
-0000db90: 6579 5f61 7272 6179 2229 0a0a 2020 2020  ey_array")..    
-0000dba0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-0000dbb0: 6620 6e61 6d65 2873 656c 6629 3a0a 2020  f name(self):.  
-0000dbc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000dbd0: 662e 5f5f 6e61 6d65 0a0a 2020 2020 406e  f.__name..    @n
-0000dbe0: 616d 652e 7365 7474 6572 0a20 2020 2064  ame.setter.    d
-0000dbf0: 6566 206e 616d 6528 7365 6c66 2c20 7661  ef name(self, va
-0000dc00: 6c29 3a0a 2020 2020 2020 2020 7261 6973  l):.        rais
-0000dc10: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
-0000dc20: 2020 2020 2020 2020 2022 4361 6e6e 6f74           "Cannot
-0000dc30: 2073 6574 206e 616d 6520 6469 7265 6374   set name direct
-0000dc40: 6c79 5c6e 5c6e 220a 2020 2020 2020 2020  ly\n\n".        
-0000dc50: 2020 2020 224e 616d 6520 6973 2075 7365      "Name is use
-0000dc60: 6420 746f 2072 656c 6174 6520 7468 6520  d to relate the 
-0000dc70: 6172 7261 7920 746f 2074 6865 2074 6173  array to the tas
-0000dc80: 6b20 6772 6170 682e 5c6e 220a 2020 2020  k graph.\n".    
-0000dc90: 2020 2020 2020 2020 2249 7420 6973 2075          "It is u
-0000dca0: 6e63 6f6d 6d6f 6e20 746f 206e 6565 6420  ncommon to need 
-0000dcb0: 746f 2063 6861 6e67 6520 6974 2c20 6275  to change it, bu
-0000dcc0: 7420 6966 2079 6f75 2064 6f5c 6e22 0a20  t if you do\n". 
-0000dcd0: 2020 2020 2020 2020 2020 2022 706c 6561             "plea
-0000dce0: 7365 2073 6574 2060 602e 5f6e 616d 6560  se set ``._name`
-0000dcf0: 6022 0a20 2020 2020 2020 2029 0a0a 2020  `".        )..  
-0000dd00: 2020 6465 6620 5f5f 6974 6572 5f5f 2873    def __iter__(s
-0000dd10: 656c 6629 3a0a 2020 2020 2020 2020 666f  elf):.        fo
-0000dd20: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0000dd30: 2873 656c 6629 293a 0a20 2020 2020 2020  (self)):.       
-0000dd40: 2020 2020 2079 6965 6c64 2073 656c 665b       yield self[
-0000dd50: 695d 0a0a 2020 2020 5f5f 6172 7261 795f  i]..    __array_
-0000dd60: 7072 696f 7269 7479 5f5f 203d 2031 3120  priority__ = 11 
-0000dd70: 2023 2068 6967 6865 7220 7468 616e 206e   # higher than n
-0000dd80: 756d 7079 2e6e 6461 7272 6179 2061 6e64  umpy.ndarray and
-0000dd90: 206e 756d 7079 2e6d 6174 7269 780a 0a20   numpy.matrix.. 
-0000dda0: 2020 2064 6566 205f 5f61 7272 6179 5f5f     def __array__
-0000ddb0: 2873 656c 662c 2064 7479 7065 3d4e 6f6e  (self, dtype=Non
-0000ddc0: 652c 202a 2a6b 7761 7267 7329 3a0a 2020  e, **kwargs):.  
-0000ddd0: 2020 2020 2020 7820 3d20 7365 6c66 2e63        x = self.c
-0000dde0: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
-0000ddf0: 2069 6620 6474 7970 6520 616e 6420 782e   if dtype and x.
-0000de00: 6474 7970 6520 213d 2064 7479 7065 3a0a  dtype != dtype:.
-0000de10: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-0000de20: 782e 6173 7479 7065 2864 7479 7065 290a  x.astype(dtype).
-0000de30: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-0000de40: 7369 6e73 7461 6e63 6528 782c 206e 702e  sinstance(x, np.
-0000de50: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
-0000de60: 2020 2020 2020 7820 3d20 6e70 2e61 7272        x = np.arr
-0000de70: 6179 2878 290a 2020 2020 2020 2020 7265  ay(x).        re
-0000de80: 7475 726e 2078 0a0a 2020 2020 6465 6620  turn x..    def 
-0000de90: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
-0000dea0: 5f5f 2873 656c 662c 2066 756e 632c 2074  __(self, func, t
-0000deb0: 7970 6573 2c20 6172 6773 2c20 6b77 6172  ypes, args, kwar
-0000dec0: 6773 293a 0a20 2020 2020 2020 2069 6d70  gs):.        imp
-0000ded0: 6f72 7420 6461 736b 2e61 7272 6179 2061  ort dask.array a
-0000dee0: 7320 6d6f 6475 6c65 0a0a 2020 2020 2020  s module..      
-0000def0: 2020 6465 6620 6861 6e64 6c65 5f6e 6f6e    def handle_non
-0000df00: 6d61 7463 6869 6e67 5f6e 616d 6573 2866  matching_names(f
-0000df10: 756e 632c 2061 7267 732c 206b 7761 7267  unc, args, kwarg
-0000df20: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000df30: 6966 2066 756e 6320 6e6f 7420 696e 205f  if func not in _
-0000df40: 4841 4e44 4c45 445f 4655 4e43 5449 4f4e  HANDLED_FUNCTION
-0000df50: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
-0000df60: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-0000df70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000df80: 2020 2020 2020 2254 6865 2060 7b7d 6020        "The `{}` 
-0000df90: 6675 6e63 7469 6f6e 2069 7320 6e6f 7420  function is not 
-0000dfa0: 696d 706c 656d 656e 7465 6420 6279 2044  implemented by D
-0000dfb0: 6173 6b20 6172 7261 792e 2022 0a20 2020  ask array. ".   
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2022 596f 7520 6d61 7920 7761 6e74 2074   "You may want t
-0000dfe0: 6f20 7573 6520 7468 6520 6461 2e6d 6170  o use the da.map
-0000dff0: 5f62 6c6f 636b 7320 6675 6e63 7469 6f6e  _blocks function
-0000e000: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000e010: 2020 2020 2020 2022 6f72 2073 6f6d 6574         "or somet
-0000e020: 6869 6e67 2073 696d 696c 6172 2074 6f20  hing similar to 
-0000e030: 7369 6c65 6e63 6520 7468 6973 2077 6172  silence this war
-0000e040: 6e69 6e67 2e20 220a 2020 2020 2020 2020  ning. ".        
-0000e050: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
-0000e060: 7220 636f 6465 206d 6179 2073 746f 7020  r code may stop 
-0000e070: 776f 726b 696e 6720 696e 2061 2066 7574  working in a fut
-0000e080: 7572 6520 7265 6c65 6173 652e 222e 666f  ure release.".fo
-0000e090: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
-0000e0a0: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000e0b0: 6e63 2e5f 5f6d 6f64 756c 655f 5f20 2b20  nc.__module__ + 
-0000e0c0: 222e 2220 2b20 6675 6e63 2e5f 5f6e 616d  "." + func.__nam
-0000e0d0: 655f 5f0a 2020 2020 2020 2020 2020 2020  e__.            
-0000e0e0: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-0000e0f0: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-0000e100: 7574 7572 6557 6172 6e69 6e67 2c0a 2020  utureWarning,.  
-0000e110: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e130: 2320 4e65 6564 2074 6f20 636f 6e76 6572  # Need to conver
-0000e140: 7420 746f 2061 7272 6179 206f 626a 6563  t to array objec
-0000e150: 7420 2865 2e67 2e20 6e75 6d70 792e 6e64  t (e.g. numpy.nd
-0000e160: 6172 7261 7920 6f72 0a20 2020 2020 2020  array or.       
-0000e170: 2020 2020 2020 2020 2023 2063 7570 792e           # cupy.
-0000e180: 6e64 6172 7261 7929 2061 7320 6e65 6564  ndarray) as need
-0000e190: 6564 2c20 736f 2077 6520 6361 6e20 6361  ed, so we can ca
-0000e1a0: 6c6c 2074 6865 204e 756d 5079 2066 756e  ll the NumPy fun
-0000e1b0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-0000e1c0: 2020 2020 2020 2320 6167 6169 6e20 616e        # again an
-0000e1d0: 6420 6974 2067 6574 7320 7468 6520 6368  d it gets the ch
-0000e1e0: 616e 6365 2074 6f20 6469 7370 6174 6368  ance to dispatch
-0000e1f0: 2074 6f20 7468 6520 7269 6768 740a 2020   to the right.  
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000e210: 696d 706c 656d 656e 7461 7469 6f6e 2e0a  implementation..
-0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e230: 6172 6773 2c20 6b77 6172 6773 203d 2063  args, kwargs = c
-0000e240: 6f6d 7075 7465 2861 7267 732c 206b 7761  ompute(args, kwa
-0000e250: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-0000e260: 2020 2020 2072 6574 7572 6e20 6675 6e63       return func
-0000e270: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-0000e280: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0000e290: 6574 7572 6e20 5f48 414e 444c 4544 5f46  eturn _HANDLED_F
-0000e2a0: 554e 4354 494f 4e53 5b66 756e 635d 282a  UNCTIONS[func](*
-0000e2b0: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-0000e2c0: 0a20 2020 2020 2020 2023 2046 6972 7374  .        # First
-0000e2d0: 2c20 7665 7269 6679 2074 6861 7420 616c  , verify that al
-0000e2e0: 6c20 7479 7065 7320 6172 6520 6861 6e64  l types are hand
-0000e2f0: 6c65 6420 6279 2044 6173 6b2e 204f 7468  led by Dask. Oth
-0000e300: 6572 7769 7365 2c20 7265 7475 726e 204e  erwise, return N
-0000e310: 6f74 496d 706c 656d 656e 7465 642e 0a20  otImplemented.. 
-0000e320: 2020 2020 2020 2069 6620 6e6f 7420 616c         if not al
-0000e330: 6c28 0a20 2020 2020 2020 2020 2020 2023  l(.            #
-0000e340: 2041 6363 6570 7420 6f75 7220 6f77 6e20   Accept our own 
-0000e350: 7375 7065 7263 6c61 7373 6573 2061 7320  superclasses as 
-0000e360: 7265 636f 6d6d 656e 6465 6420 6279 204e  recommended by N
-0000e370: 4550 2d31 330a 2020 2020 2020 2020 2020  EP-13.          
-0000e380: 2020 2320 2868 7474 7073 3a2f 2f6e 756d    # (https://num
-0000e390: 7079 2e6f 7267 2f6e 6570 732f 6e65 702d  py.org/neps/nep-
-0000e3a0: 3030 3133 2d75 6675 6e63 2d6f 7665 7272  0013-ufunc-overr
-0000e3b0: 6964 6573 2e68 746d 6c23 7375 6263 6c61  ides.html#subcla
-0000e3c0: 7373 2d68 6965 7261 7263 6869 6573 290a  ss-hierarchies).
-0000e3d0: 2020 2020 2020 2020 2020 2020 6973 7375              issu
-0000e3e0: 6263 6c61 7373 2874 7970 6528 7365 6c66  bclass(type(self
-0000e3f0: 292c 2074 7970 655f 2920 6f72 2069 735f  ), type_) or is_
-0000e400: 7661 6c69 645f 6368 756e 6b5f 7479 7065  valid_chunk_type
-0000e410: 2874 7970 655f 290a 2020 2020 2020 2020  (type_).        
-0000e420: 2020 2020 666f 7220 7479 7065 5f20 696e      for type_ in
-0000e430: 2074 7970 6573 0a20 2020 2020 2020 2029   types.        )
-0000e440: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000e450: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
-0000e460: 7465 640a 0a20 2020 2020 2020 2023 204e  ted..        # N
-0000e470: 6f77 2074 7279 2074 6f20 6669 6e64 2061  ow try to find a
-0000e480: 206d 6174 6368 696e 6720 6675 6e63 7469   matching functi
-0000e490: 6f6e 206e 616d 652e 2020 4966 2074 6861  on name.  If tha
-0000e4a0: 7420 646f 6573 6e27 7420 776f 726b 2c20  t doesn't work, 
-0000e4b0: 7765 206d 6179 0a20 2020 2020 2020 2023  we may.        #
-0000e4c0: 2062 6520 6465 616c 696e 6720 7769 7468   be dealing with
-0000e4d0: 2061 6e20 616c 6961 7320 6f72 2061 2066   an alias or a f
-0000e4e0: 756e 6374 696f 6e20 7468 6174 2773 2073  unction that's s
-0000e4f0: 696d 706c 7920 6e6f 7420 696e 2074 6865  imply not in the
-0000e500: 2044 6173 6b20 4150 492e 0a20 2020 2020   Dask API..     
-0000e510: 2020 2023 2048 616e 646c 6520 616c 6961     # Handle alia
-0000e520: 7365 7320 7669 6120 7468 6520 5f48 414e  ses via the _HAN
-0000e530: 444c 4544 5f46 554e 4354 494f 4e53 2064  DLED_FUNCTIONS d
-0000e540: 6963 7420 6d61 7070 696e 672c 2061 6e64  ict mapping, and
-0000e550: 2077 6172 6e20 6f74 6865 7277 6973 652e   warn otherwise.
-0000e560: 0a20 2020 2020 2020 2066 6f72 2073 7562  .        for sub
-0000e570: 6d6f 6475 6c65 2069 6e20 6675 6e63 2e5f  module in func._
-0000e580: 5f6d 6f64 756c 655f 5f2e 7370 6c69 7428  _module__.split(
-0000e590: 222e 2229 5b31 3a5d 3a0a 2020 2020 2020  ".")[1:]:.      
-0000e5a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e5b0: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
-0000e5c0: 6520 3d20 6765 7461 7474 7228 6d6f 6475  e = getattr(modu
-0000e5d0: 6c65 2c20 7375 626d 6f64 756c 6529 0a20  le, submodule). 
-0000e5e0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000e5f0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-0000e600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e610: 2020 7265 7475 726e 2068 616e 646c 655f    return handle_
-0000e620: 6e6f 6e6d 6174 6368 696e 675f 6e61 6d65  nonmatching_name
-0000e630: 7328 6675 6e63 2c20 6172 6773 2c20 6b77  s(func, args, kw
-0000e640: 6172 6773 290a 0a20 2020 2020 2020 2069  args)..        i
-0000e650: 6620 6e6f 7420 6861 7361 7474 7228 6d6f  f not hasattr(mo
-0000e660: 6475 6c65 2c20 6675 6e63 2e5f 5f6e 616d  dule, func.__nam
-0000e670: 655f 5f29 3a0a 2020 2020 2020 2020 2020  e__):.          
-0000e680: 2020 7265 7475 726e 2068 616e 646c 655f    return handle_
-0000e690: 6e6f 6e6d 6174 6368 696e 675f 6e61 6d65  nonmatching_name
-0000e6a0: 7328 6675 6e63 2c20 6172 6773 2c20 6b77  s(func, args, kw
-0000e6b0: 6172 6773 290a 0a20 2020 2020 2020 2064  args)..        d
-0000e6c0: 615f 6675 6e63 203d 2067 6574 6174 7472  a_func = getattr
-0000e6d0: 286d 6f64 756c 652c 2066 756e 632e 5f5f  (module, func.__
-0000e6e0: 6e61 6d65 5f5f 290a 2020 2020 2020 2020  name__).        
-0000e6f0: 6966 2064 615f 6675 6e63 2069 7320 6675  if da_func is fu
-0000e700: 6e63 3a0a 2020 2020 2020 2020 2020 2020  nc:.            
-0000e710: 7265 7475 726e 2068 616e 646c 655f 6e6f  return handle_no
-0000e720: 6e6d 6174 6368 696e 675f 6e61 6d65 7328  nmatching_names(
-0000e730: 6675 6e63 2c20 6172 6773 2c20 6b77 6172  func, args, kwar
-0000e740: 6773 290a 0a20 2020 2020 2020 2023 2049  gs)..        # I
-0000e750: 6620 6060 6c69 6b65 6060 2069 7320 636f  f ``like`` is co
-0000e760: 6e74 6169 6e65 6420 696e 2060 6064 615f  ntained in ``da_
-0000e770: 6675 6e63 6060 2773 2073 6967 6e61 7475  func``'s signatu
-0000e780: 7265 2c20 6164 6420 6060 6c69 6b65 3d73  re, add ``like=s
-0000e790: 656c 6660 600a 2020 2020 2020 2020 2320  elf``.        # 
-0000e7a0: 746f 2074 6865 206b 7761 7267 7320 6469  to the kwargs di
-0000e7b0: 6374 696f 6e61 7279 2e0a 2020 2020 2020  ctionary..      
-0000e7c0: 2020 6966 2068 6173 5f6b 6579 776f 7264    if has_keyword
-0000e7d0: 2864 615f 6675 6e63 2c20 226c 696b 6522  (da_func, "like"
-0000e7e0: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
-0000e7f0: 7761 7267 735b 226c 696b 6522 5d20 3d20  wargs["like"] = 
-0000e800: 7365 6c66 0a0a 2020 2020 2020 2020 7265  self..        re
-0000e810: 7475 726e 2064 615f 6675 6e63 282a 6172  turn da_func(*ar
-0000e820: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
-0000e830: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000e840: 2064 6566 205f 656c 656d 7769 7365 2873   def _elemwise(s
-0000e850: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0000e860: 7475 726e 2065 6c65 6d77 6973 650a 0a20  turn elemwise.. 
-0000e870: 2020 2040 7772 6170 7328 7374 6f72 6529     @wraps(store)
-0000e880: 0a20 2020 2064 6566 2073 746f 7265 2873  .    def store(s
-0000e890: 656c 662c 2074 6172 6765 742c 202a 2a6b  elf, target, **k
-0000e8a0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0000e8b0: 7220 3d20 7374 6f72 6528 5b73 656c 665d  r = store([self]
-0000e8c0: 2c20 5b74 6172 6765 745d 2c20 2a2a 6b77  , [target], **kw
-0000e8d0: 6172 6773 290a 0a20 2020 2020 2020 2069  args)..        i
-0000e8e0: 6620 6b77 6172 6773 2e67 6574 2822 7265  f kwargs.get("re
-0000e8f0: 7475 726e 5f73 746f 7265 6422 2c20 4661  turn_stored", Fa
-0000e900: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-0000e910: 2020 7220 3d20 725b 305d 0a0a 2020 2020    r = r[0]..    
-0000e920: 2020 2020 7265 7475 726e 2072 0a0a 2020      return r..  
-0000e930: 2020 6465 6620 746f 5f73 7667 2873 656c    def to_svg(sel
-0000e940: 662c 2073 697a 653d 3530 3029 3a0a 2020  f, size=500):.  
-0000e950: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
-0000e960: 2063 6875 6e6b 7320 6672 6f6d 2044 6173   chunks from Das
-0000e970: 6b20 4172 7261 7920 696e 746f 2061 6e20  k Array into an 
-0000e980: 5356 4720 496d 6167 650a 0a20 2020 2020  SVG Image..     
-0000e990: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000e9a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000e9b0: 0a20 2020 2020 2020 2063 6875 6e6b 733a  .        chunks:
-0000e9c0: 2074 7570 6c65 0a20 2020 2020 2020 2073   tuple.        s
-0000e9d0: 697a 653a 2069 6e74 0a20 2020 2020 2020  ize: int.       
-0000e9e0: 2020 2020 2052 6f75 6768 2073 697a 6520       Rough size 
-0000e9f0: 6f66 2074 6865 2069 6d61 6765 0a0a 2020  of the image..  
-0000ea00: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
-0000ea10: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-0000ea20: 2020 2020 2020 2020 3e3e 3e20 782e 746f          >>> x.to
-0000ea30: 5f73 7667 2873 697a 653d 3530 3029 2020  _svg(size=500)  
-0000ea40: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
-0000ea50: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-0000ea60: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000ea70: 2d0a 2020 2020 2020 2020 7465 7874 3a20  -.        text: 
-0000ea80: 416e 2073 7667 2073 7472 696e 6720 6465  An svg string de
-0000ea90: 7069 6374 696e 6720 7468 6520 6172 7261  picting the arra
-0000eaa0: 7920 6173 2061 2067 7269 6420 6f66 2063  y as a grid of c
-0000eab0: 6875 6e6b 730a 2020 2020 2020 2020 2222  hunks.        ""
-0000eac0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
-0000ead0: 6173 6b2e 6172 7261 792e 7376 6720 696d  ask.array.svg im
-0000eae0: 706f 7274 2073 7667 0a0a 2020 2020 2020  port svg..      
-0000eaf0: 2020 7265 7475 726e 2073 7667 2873 656c    return svg(sel
-0000eb00: 662e 6368 756e 6b73 2c20 7369 7a65 3d73  f.chunks, size=s
-0000eb10: 697a 6529 0a0a 2020 2020 6465 6620 746f  ize)..    def to
-0000eb20: 5f68 6466 3528 7365 6c66 2c20 6669 6c65  _hdf5(self, file
-0000eb30: 6e61 6d65 2c20 6461 7461 7061 7468 2c20  name, datapath, 
-0000eb40: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000eb50: 2020 2022 2222 5374 6f72 6520 6172 7261     """Store arra
-0000eb60: 7920 696e 2048 4446 3520 6669 6c65 0a0a  y in HDF5 file..
-0000eb70: 2020 2020 2020 2020 3e3e 3e20 782e 746f          >>> x.to
-0000eb80: 5f68 6466 3528 276d 7966 696c 652e 6864  _hdf5('myfile.hd
-0000eb90: 6635 272c 2027 2f78 2729 2020 2320 646f  f5', '/x')  # do
-0000eba0: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
-0000ebb0: 2020 2020 2020 4f70 7469 6f6e 616c 6c79        Optionally
-0000ebc0: 2070 726f 7669 6465 2061 7267 756d 656e   provide argumen
-0000ebd0: 7473 2061 7320 7468 6f75 6768 2074 6f20  ts as though to 
-0000ebe0: 6060 6835 7079 2e46 696c 652e 6372 6561  ``h5py.File.crea
-0000ebf0: 7465 5f64 6174 6173 6574 6060 0a0a 2020  te_dataset``..  
-0000ec00: 2020 2020 2020 3e3e 3e20 782e 746f 5f68        >>> x.to_h
-0000ec10: 6466 3528 276d 7966 696c 652e 6864 6635  df5('myfile.hdf5
-0000ec20: 272c 2027 2f78 272c 2063 6f6d 7072 6573  ', '/x', compres
-0000ec30: 7369 6f6e 3d27 6c7a 6627 2c20 7368 7566  sion='lzf', shuf
-0000ec40: 666c 653d 5472 7565 2920 2023 2064 6f63  fle=True)  # doc
-0000ec50: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
-0000ec60: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-0000ec70: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0000ec80: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
-0000ec90: 792e 7374 6f72 650a 2020 2020 2020 2020  y.store.        
-0000eca0: 6835 7079 2e46 696c 652e 6372 6561 7465  h5py.File.create
-0000ecb0: 5f64 6174 6173 6574 0a20 2020 2020 2020  _dataset.       
-0000ecc0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0000ecd0: 7572 6e20 746f 5f68 6466 3528 6669 6c65  urn to_hdf5(file
-0000ece0: 6e61 6d65 2c20 6461 7461 7061 7468 2c20  name, datapath, 
-0000ecf0: 7365 6c66 2c20 2a2a 6b77 6172 6773 290a  self, **kwargs).
-0000ed00: 0a20 2020 2064 6566 2074 6f5f 6461 736b  .    def to_dask
-0000ed10: 5f64 6174 6166 7261 6d65 2873 656c 662c  _dataframe(self,
-0000ed20: 2063 6f6c 756d 6e73 3d4e 6f6e 652c 2069   columns=None, i
-0000ed30: 6e64 6578 3d4e 6f6e 652c 206d 6574 613d  ndex=None, meta=
-0000ed40: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-0000ed50: 2222 436f 6e76 6572 7420 6461 736b 2041  ""Convert dask A
-0000ed60: 7272 6179 2074 6f20 6461 736b 2044 6174  rray to dask Dat
-0000ed70: 6166 7261 6d65 0a0a 2020 2020 2020 2020  aframe..        
-0000ed80: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0000ed90: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0000eda0: 2020 2020 2020 636f 6c75 6d6e 733a 206c        columns: l
-0000edb0: 6973 7420 6f72 2073 7472 696e 670a 2020  ist or string.  
-0000edc0: 2020 2020 2020 2020 2020 6c69 7374 206f            list o
-0000edd0: 6620 636f 6c75 6d6e 206e 616d 6573 2069  f column names i
-0000ede0: 6620 4461 7461 4672 616d 652c 2073 696e  f DataFrame, sin
-0000edf0: 676c 6520 7374 7269 6e67 2069 6620 5365  gle string if Se
-0000ee00: 7269 6573 0a20 2020 2020 2020 2069 6e64  ries.        ind
-0000ee10: 6578 203a 2064 6173 6b2e 6461 7461 6672  ex : dask.datafr
-0000ee20: 616d 652e 496e 6465 782c 206f 7074 696f  ame.Index, optio
-0000ee30: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0000ee40: 416e 206f 7074 696f 6e61 6c20 2a64 6173  An optional *das
-0000ee50: 6b2a 2049 6e64 6578 2074 6f20 7573 6520  k* Index to use 
-0000ee60: 666f 7220 7468 6520 6f75 7470 7574 2053  for the output S
-0000ee70: 6572 6965 7320 6f72 2044 6174 6146 7261  eries or DataFra
-0000ee80: 6d65 2e0a 0a20 2020 2020 2020 2020 2020  me...           
-0000ee90: 2054 6865 2064 6566 6175 6c74 206f 7574   The default out
-0000eea0: 7075 7420 696e 6465 7820 6465 7065 6e64  put index depend
-0000eeb0: 7320 6f6e 2077 6865 7468 6572 2074 6865  s on whether the
-0000eec0: 2061 7272 6179 2068 6173 2061 6e79 2075   array has any u
-0000eed0: 6e6b 6e6f 776e 0a20 2020 2020 2020 2020  nknown.         
-0000eee0: 2020 2063 6875 6e6b 732e 2049 6620 7468     chunks. If th
-0000eef0: 6572 6520 6172 6520 616e 7920 756e 6b6e  ere are any unkn
-0000ef00: 6f77 6e20 6368 756e 6b73 2c20 7468 6520  own chunks, the 
-0000ef10: 6f75 7470 7574 2068 6173 2060 604e 6f6e  output has ``Non
-0000ef20: 6560 600a 2020 2020 2020 2020 2020 2020  e``.            
-0000ef30: 666f 7220 616c 6c20 7468 6520 6469 7669  for all the divi
-0000ef40: 7369 6f6e 7320 286f 6e65 2070 6572 2063  sions (one per c
-0000ef50: 6875 6e6b 292e 2049 6620 616c 6c20 7468  hunk). If all th
-0000ef60: 6520 6368 756e 6b73 2061 7265 206b 6e6f  e chunks are kno
-0000ef70: 776e 2c0a 2020 2020 2020 2020 2020 2020  wn,.            
-0000ef80: 6120 6465 6661 756c 7420 696e 6465 7820  a default index 
-0000ef90: 7769 7468 206b 6e6f 776e 2064 6976 7369  with known divsi
-0000efa0: 6f6e 7320 6973 2063 7265 6174 6564 2e0a  ons is created..
-0000efb0: 0a20 2020 2020 2020 2020 2020 2053 7065  .            Spe
-0000efc0: 6369 6679 696e 6720 6060 696e 6465 7860  cifying ``index`
-0000efd0: 6020 6361 6e20 6265 2075 7365 6675 6c20  ` can be useful 
-0000efe0: 6966 2079 6f75 2772 6520 636f 6e66 6f72  if you're confor
-0000eff0: 6d69 6e67 2061 2044 6173 6b20 4172 7261  ming a Dask Arra
-0000f000: 790a 2020 2020 2020 2020 2020 2020 746f  y.            to
-0000f010: 2061 6e20 6578 6973 7469 6e67 2064 6173   an existing das
-0000f020: 6b20 5365 7269 6573 206f 7220 4461 7461  k Series or Data
-0000f030: 4672 616d 652c 2061 6e64 2079 6f75 2077  Frame, and you w
-0000f040: 6f75 6c64 206c 696b 6520 7468 650a 2020  ould like the.  
-0000f050: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-0000f060: 7320 746f 206d 6174 6368 2e0a 2020 2020  s to match..    
-0000f070: 2020 2020 6d65 7461 203a 206f 626a 6563      meta : objec
-0000f080: 742c 206f 7074 696f 6e61 6c0a 2020 2020  t, optional.    
-0000f090: 2020 2020 2020 2020 416e 206f 7074 696f          An optio
-0000f0a0: 6e61 6c20 606d 6574 6160 2070 6172 616d  nal `meta` param
-0000f0b0: 6574 6572 2063 616e 2062 6520 7061 7373  eter can be pass
-0000f0c0: 6564 2066 6f72 2064 6173 6b0a 2020 2020  ed for dask.    
-0000f0d0: 2020 2020 2020 2020 746f 2073 7065 6369          to speci
-0000f0e0: 6679 2074 6865 2063 6f6e 6372 6574 6520  fy the concrete 
-0000f0f0: 6461 7461 6672 616d 6520 7479 7065 2074  dataframe type t
-0000f100: 6f20 7573 6520 666f 7220 7061 7274 6974  o use for partit
-0000f110: 696f 6e73 206f 660a 2020 2020 2020 2020  ions of.        
-0000f120: 2020 2020 7468 6520 4461 736b 2064 6174      the Dask dat
-0000f130: 6166 7261 6d65 2e20 4279 2064 6566 6175  aframe. By defau
-0000f140: 6c74 2c20 7061 6e64 6173 2044 6174 6146  lt, pandas DataF
-0000f150: 7261 6d65 2069 7320 7573 6564 2e0a 0a20  rame is used... 
-0000f160: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-0000f170: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000f180: 0a20 2020 2020 2020 2064 6173 6b2e 6461  .        dask.da
-0000f190: 7461 6672 616d 652e 6672 6f6d 5f64 6173  taframe.from_das
-0000f1a0: 6b5f 6172 7261 790a 2020 2020 2020 2020  k_array.        
-0000f1b0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-0000f1c0: 2064 6173 6b2e 6461 7461 6672 616d 6520   dask.dataframe 
-0000f1d0: 696d 706f 7274 2066 726f 6d5f 6461 736b  import from_dask
-0000f1e0: 5f61 7272 6179 0a0a 2020 2020 2020 2020  _array..        
-0000f1f0: 7265 7475 726e 2066 726f 6d5f 6461 736b  return from_dask
-0000f200: 5f61 7272 6179 2873 656c 662c 2063 6f6c  _array(self, col
-0000f210: 756d 6e73 3d63 6f6c 756d 6e73 2c20 696e  umns=columns, in
-0000f220: 6465 783d 696e 6465 782c 206d 6574 613d  dex=index, meta=
-0000f230: 6d65 7461 290a 0a20 2020 2064 6566 2074  meta)..    def t
-0000f240: 6f5f 6261 636b 656e 6428 7365 6c66 2c20  o_backend(self, 
-0000f250: 6261 636b 656e 643a 2073 7472 207c 204e  backend: str | N
-0000f260: 6f6e 6520 3d20 4e6f 6e65 2c20 2a2a 6b77  one = None, **kw
-0000f270: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-0000f280: 2222 4d6f 7665 2074 6f20 6120 6e65 7720  ""Move to a new 
-0000f290: 4172 7261 7920 6261 636b 656e 640a 0a20  Array backend.. 
-0000f2a0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0000f2b0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000f2c0: 2d2d 2d2d 0a20 2020 2020 2020 2062 6163  ----.        bac
-0000f2d0: 6b65 6e64 203a 2073 7472 2c20 4f70 7469  kend : str, Opti
-0000f2e0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
-0000f2f0: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
-0000f300: 206e 6577 2062 6163 6b65 6e64 2074 6f20   new backend to 
-0000f310: 6d6f 7665 2074 6f2e 2054 6865 2064 6566  move to. The def
-0000f320: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-0000f330: 2069 7320 7468 6520 6375 7272 656e 7420   is the current 
-0000f340: 2261 7272 6179 2e62 6163 6b65 6e64 2220  "array.backend" 
-0000f350: 636f 6e66 6967 7572 6174 696f 6e2e 0a0a  configuration...
-0000f360: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0000f370: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0000f380: 2020 2020 2020 2020 4172 7261 790a 2020          Array.  
-0000f390: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f3a0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-0000f3b0: 792e 6372 6561 7469 6f6e 2069 6d70 6f72  y.creation impor
-0000f3c0: 7420 746f 5f62 6163 6b65 6e64 0a0a 2020  t to_backend..  
-0000f3d0: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
-0000f3e0: 6261 636b 656e 6428 7365 6c66 2c20 6261  backend(self, ba
-0000f3f0: 636b 656e 643d 6261 636b 656e 642c 202a  ckend=backend, *
-0000f400: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-0000f410: 6620 5f5f 626f 6f6c 5f5f 2873 656c 6629  f __bool__(self)
-0000f420: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0000f430: 662e 7369 7a65 203e 2031 3a0a 2020 2020  f.size > 1:.    
-0000f440: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000f450: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0000f460: 2020 2020 2020 2020 2020 6622 5468 6520            f"The 
-0000f470: 7472 7574 6820 7661 6c75 6520 6f66 2061  truth value of a
-0000f480: 207b 7365 6c66 2e5f 5f63 6c61 7373 5f5f   {self.__class__
-0000f490: 2e5f 5f6e 616d 655f 5f7d 2069 7320 616d  .__name__} is am
-0000f4a0: 6269 6775 6f75 732e 2022 0a20 2020 2020  biguous. ".     
-0000f4b0: 2020 2020 2020 2020 2020 2022 5573 6520             "Use 
-0000f4c0: 612e 616e 7928 2920 6f72 2061 2e61 6c6c  a.any() or a.all
-0000f4d0: 2829 2e22 0a20 2020 2020 2020 2020 2020  ().".           
-0000f4e0: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-0000f4f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000f500: 7572 6e20 626f 6f6c 2873 656c 662e 636f  urn bool(self.co
-0000f510: 6d70 7574 6528 2929 0a0a 2020 2020 5f5f  mpute())..    __
-0000f520: 6e6f 6e7a 6572 6f5f 5f20 3d20 5f5f 626f  nonzero__ = __bo
-0000f530: 6f6c 5f5f 2020 2320 7079 7468 6f6e 2032  ol__  # python 2
-0000f540: 0a0a 2020 2020 6465 6620 5f73 6361 6c61  ..    def _scala
-0000f550: 7266 756e 6328 7365 6c66 2c20 6361 7374  rfunc(self, cast
-0000f560: 5f74 7970 6529 3a0a 2020 2020 2020 2020  _type):.        
-0000f570: 6966 2073 656c 662e 7369 7a65 203e 2031  if self.size > 1
-0000f580: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000f590: 6973 6520 5479 7065 4572 726f 7228 224f  ise TypeError("O
-0000f5a0: 6e6c 7920 6c65 6e67 7468 2d31 2061 7272  nly length-1 arr
-0000f5b0: 6179 7320 6361 6e20 6265 2063 6f6e 7665  ays can be conve
-0000f5c0: 7274 6564 2074 6f20 5079 7468 6f6e 2073  rted to Python s
-0000f5d0: 6361 6c61 7273 2229 0a20 2020 2020 2020  calars").       
-0000f5e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000f5f0: 2020 2072 6574 7572 6e20 6361 7374 5f74     return cast_t
-0000f600: 7970 6528 7365 6c66 2e63 6f6d 7075 7465  ype(self.compute
-0000f610: 2829 2e69 7465 6d28 2929 0a0a 2020 2020  ().item())..    
-0000f620: 6465 6620 5f5f 696e 745f 5f28 7365 6c66  def __int__(self
-0000f630: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000f640: 6e20 7365 6c66 2e5f 7363 616c 6172 6675  n self._scalarfu
-0000f650: 6e63 2869 6e74 290a 0a20 2020 205f 5f6c  nc(int)..    __l
-0000f660: 6f6e 675f 5f20 3d20 5f5f 696e 745f 5f20  ong__ = __int__ 
-0000f670: 2023 2070 7974 686f 6e20 320a 0a20 2020   # python 2..   
-0000f680: 2064 6566 205f 5f66 6c6f 6174 5f5f 2873   def __float__(s
-0000f690: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0000f6a0: 7475 726e 2073 656c 662e 5f73 6361 6c61  turn self._scala
-0000f6b0: 7266 756e 6328 666c 6f61 7429 0a0a 2020  rfunc(float)..  
-0000f6c0: 2020 6465 6620 5f5f 636f 6d70 6c65 785f    def __complex_
-0000f6d0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0000f6e0: 2072 6574 7572 6e20 7365 6c66 2e5f 7363   return self._sc
-0000f6f0: 616c 6172 6675 6e63 2863 6f6d 706c 6578  alarfunc(complex
-0000f700: 290a 0a20 2020 2064 6566 205f 5f69 6e64  )..    def __ind
-0000f710: 6578 5f5f 2873 656c 6629 3a0a 2020 2020  ex__(self):.    
-0000f720: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f730: 5f73 6361 6c61 7266 756e 6328 6f70 6572  _scalarfunc(oper
-0000f740: 6174 6f72 2e69 6e64 6578 290a 0a20 2020  ator.index)..   
-0000f750: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
-0000f760: 2873 656c 662c 206b 6579 2c20 7661 6c75  (self, key, valu
-0000f770: 6529 3a0a 2020 2020 2020 2020 6966 2076  e):.        if v
-0000f780: 616c 7565 2069 7320 6e70 2e6d 612e 6d61  alue is np.ma.ma
-0000f790: 736b 6564 3a0a 2020 2020 2020 2020 2020  sked:.          
-0000f7a0: 2020 7661 6c75 6520 3d20 6e70 2e6d 612e    value = np.ma.
-0000f7b0: 6d61 736b 6564 5f61 6c6c 2828 292c 2064  masked_all((), d
-0000f7c0: 7479 7065 3d73 656c 662e 6474 7970 6529  type=self.dtype)
-0000f7d0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0000f7e0: 2069 735f 6461 736b 5f63 6f6c 6c65 6374   is_dask_collect
-0000f7f0: 696f 6e28 7661 6c75 6529 2061 6e64 206e  ion(value) and n
-0000f800: 702e 6973 6e61 6e28 7661 6c75 6529 2e61  p.isnan(value).a
-0000f810: 6e79 2829 3a0a 2020 2020 2020 2020 2020  ny():.          
-0000f820: 2020 6966 2069 7373 7562 636c 6173 7328    if issubclass(
-0000f830: 7365 6c66 2e64 7479 7065 2e74 7970 652c  self.dtype.type,
-0000f840: 2049 6e74 6567 7261 6c29 3a0a 2020 2020   Integral):.    
-0000f850: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f860: 6520 5661 6c75 6545 7272 6f72 2822 6361  e ValueError("ca
-0000f870: 6e6e 6f74 2063 6f6e 7665 7274 2066 6c6f  nnot convert flo
-0000f880: 6174 204e 614e 2074 6f20 696e 7465 6765  at NaN to intege
-0000f890: 7222 290a 0a20 2020 2020 2020 2023 2320  r")..        ## 
-0000f8a0: 5573 6520 7468 6520 2277 6865 7265 2220  Use the "where" 
-0000f8b0: 6d65 7468 6f64 2066 6f72 2063 6173 6573  method for cases
-0000f8c0: 2077 6865 6e20 6b65 7920 6973 2061 6e20   when key is an 
-0000f8d0: 4172 7261 790a 2020 2020 2020 2020 6966  Array.        if
-0000f8e0: 2069 7369 6e73 7461 6e63 6528 6b65 792c   isinstance(key,
-0000f8f0: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
-0000f900: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
-0000f910: 7272 6179 2e72 6f75 7469 6e65 7320 696d  rray.routines im
-0000f920: 706f 7274 2077 6865 7265 0a0a 2020 2020  port where..    
-0000f930: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000f940: 7461 6e63 6528 7661 6c75 652c 2041 7272  tance(value, Arr
-0000f950: 6179 2920 616e 6420 7661 6c75 652e 6e64  ay) and value.nd
-0000f960: 696d 203e 2031 3a0a 2020 2020 2020 2020  im > 1:.        
-0000f970: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000f980: 6c75 6545 7272 6f72 2822 626f 6f6c 6561  lueError("boolea
-0000f990: 6e20 696e 6465 7820 6172 7261 7920 7368  n index array sh
-0000f9a0: 6f75 6c64 2068 6176 6520 3120 6469 6d65  ould have 1 dime
-0000f9b0: 6e73 696f 6e22 290a 2020 2020 2020 2020  nsion").        
-0000f9c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000f9d0: 2020 2020 2020 2020 2079 203d 2077 6865           y = whe
-0000f9e0: 7265 286b 6579 2c20 7661 6c75 652c 2073  re(key, value, s
-0000f9f0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
-0000fa00: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
-0000fa10: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000fa20: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0000fa30: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000fa50: 426f 6f6c 6561 6e20 696e 6465 7820 6173  Boolean index as
-0000fa60: 7369 676e 6d65 6e74 2069 6e20 4461 736b  signment in Dask
-0000fa70: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000fa80: 2020 2020 2020 2022 6578 7065 6374 7320         "expects 
-0000fa90: 6571 7561 6c6c 7920 7368 6170 6564 2061  equally shaped a
-0000faa0: 7272 6179 732e 5c6e 4578 616d 706c 653a  rrays.\nExample:
-0000fab0: 2064 6131 5b64 6132 5d20 3d20 6461 3320   da1[da2] = da3 
-0000fac0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000fad0: 2020 2020 2020 2277 6865 7265 2064 6131        "where da1
-0000fae0: 2e73 6861 7065 203d 3d20 2834 2c29 2c20  .shape == (4,), 
-0000faf0: 6461 322e 7368 6170 6520 3d3d 2028 342c  da2.shape == (4,
-0000fb00: 2920 220a 2020 2020 2020 2020 2020 2020  ) ".            
-0000fb10: 2020 2020 2020 2020 2261 6e64 2064 6133          "and da3
-0000fb20: 2e73 6861 7065 203d 3d20 2834 2c29 2e5c  .shape == (4,).\
-0000fb30: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-0000fb40: 2020 2020 2020 2022 416c 7465 726e 6174         "Alternat
-0000fb50: 6976 656c 792c 2079 6f75 2063 616e 2075  ively, you can u
-0000fb60: 7365 2074 6865 2065 7874 656e 6465 6420  se the extended 
-0000fb70: 4150 4920 7468 6174 2073 7570 706f 7274  API that support
-0000fb80: 7322 0a20 2020 2020 2020 2020 2020 2020  s".             
-0000fb90: 2020 2020 2020 2022 696e 6465 7869 6e67         "indexing
-0000fba0: 2077 6974 6820 7475 706c 6573 2e5c 6e45   with tuples.\nE
-0000fbb0: 7861 6d70 6c65 3a20 6461 315b 2864 6132  xample: da1[(da2
-0000fbc0: 2c29 5d20 3d20 6461 332e 220a 2020 2020  ,)] = da3.".    
-0000fbd0: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
-0000fbe0: 6f6d 2065 0a20 2020 2020 2020 2020 2020  om e.           
-0000fbf0: 2073 656c 662e 5f6d 6574 6120 3d20 792e   self._meta = y.
-0000fc00: 5f6d 6574 610a 2020 2020 2020 2020 2020  _meta.          
-0000fc10: 2020 7365 6c66 2e64 6173 6b20 3d20 792e    self.dask = y.
-0000fc20: 6461 736b 0a20 2020 2020 2020 2020 2020  dask.           
-0000fc30: 2073 656c 662e 5f6e 616d 6520 3d20 792e   self._name = y.
-0000fc40: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-0000fc50: 2073 656c 662e 5f63 6875 6e6b 7320 3d20   self._chunks = 
-0000fc60: 792e 6368 756e 6b73 0a20 2020 2020 2020  y.chunks.       
-0000fc70: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-0000fc80: 2020 2020 2069 6620 6e70 2e69 736e 616e       if np.isnan
-0000fc90: 2873 656c 662e 7368 6170 6529 2e61 6e79  (self.shape).any
-0000fca0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000fcb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000fcc0: 2866 2241 7272 6179 7320 6368 756e 6b20  (f"Arrays chunk 
-0000fcd0: 7369 7a65 7320 6172 6520 756e 6b6e 6f77  sizes are unknow
-0000fce0: 6e2e 207b 756e 6b6e 6f77 6e5f 6368 756e  n. {unknown_chun
-0000fcf0: 6b5f 6d65 7373 6167 657d 2229 0a0a 2020  k_message}")..  
-0000fd00: 2020 2020 2020 2320 5374 696c 6c20 6865        # Still he
-0000fd10: 7265 3f20 5468 656e 2061 7070 6c79 2074  re? Then apply t
-0000fd20: 6865 2061 7373 6967 6e6d 656e 7420 746f  he assignment to
-0000fd30: 206f 7468 6572 2074 7970 6520 6f66 0a20   other type of. 
-0000fd40: 2020 2020 2020 2023 2069 6e64 6963 6573         # indices
-0000fd50: 2076 6961 2074 6865 2060 7365 7469 7465   via the `setite
-0000fd60: 6d5f 6172 7261 7960 2066 756e 6374 696f  m_array` functio
-0000fd70: 6e2e 0a20 2020 2020 2020 2076 616c 7565  n..        value
-0000fd80: 203d 2061 7361 6e79 6172 7261 7928 7661   = asanyarray(va
-0000fd90: 6c75 6529 0a0a 2020 2020 2020 2020 6f75  lue)..        ou
-0000fda0: 7420 3d20 2273 6574 6974 656d 2d22 202b  t = "setitem-" +
-0000fdb0: 2074 6f6b 656e 697a 6528 7365 6c66 2c20   tokenize(self, 
-0000fdc0: 6b65 792c 2076 616c 7565 290a 2020 2020  key, value).    
-0000fdd0: 2020 2020 6473 6b20 3d20 7365 7469 7465      dsk = setite
-0000fde0: 6d5f 6172 7261 7928 6f75 742c 2073 656c  m_array(out, sel
-0000fdf0: 662c 206b 6579 2c20 7661 6c75 6529 0a0a  f, key, value)..
-0000fe00: 2020 2020 2020 2020 6d65 7461 203d 206d          meta = m
-0000fe10: 6574 615f 6672 6f6d 5f61 7272 6179 2873  eta_from_array(s
-0000fe20: 656c 662e 5f6d 6574 6129 0a20 2020 2020  elf._meta).     
-0000fe30: 2020 2069 6620 6e70 2e69 7373 6361 6c61     if np.isscala
-0000fe40: 7228 6d65 7461 293a 0a20 2020 2020 2020  r(meta):.       
-0000fe50: 2020 2020 206d 6574 6120 3d20 6e70 2e61       meta = np.a
-0000fe60: 7272 6179 286d 6574 6129 0a0a 2020 2020  rray(meta)..    
-0000fe70: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-0000fe80: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-0000fe90: 636f 6c6c 6563 7469 6f6e 7328 6f75 742c  collections(out,
-0000fea0: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
-0000feb0: 6573 3d5b 7365 6c66 5d29 0a20 2020 2020  es=[self]).     
-0000fec0: 2020 2079 203d 2041 7272 6179 2867 7261     y = Array(gra
-0000fed0: 7068 2c20 6f75 742c 2063 6875 6e6b 733d  ph, out, chunks=
-0000fee0: 7365 6c66 2e63 6875 6e6b 732c 2064 7479  self.chunks, dty
-0000fef0: 7065 3d73 656c 662e 6474 7970 652c 206d  pe=self.dtype, m
-0000ff00: 6574 613d 6d65 7461 290a 0a20 2020 2020  eta=meta)..     
-0000ff10: 2020 2073 656c 662e 5f6d 6574 6120 3d20     self._meta = 
-0000ff20: 792e 5f6d 6574 610a 2020 2020 2020 2020  y._meta.        
-0000ff30: 7365 6c66 2e64 6173 6b20 3d20 792e 6461  self.dask = y.da
-0000ff40: 736b 0a20 2020 2020 2020 2073 656c 662e  sk.        self.
-0000ff50: 5f6e 616d 6520 3d20 792e 6e61 6d65 0a20  _name = y.name. 
-0000ff60: 2020 2020 2020 2073 656c 662e 5f63 6875         self._chu
-0000ff70: 6e6b 7320 3d20 792e 6368 756e 6b73 0a0a  nks = y.chunks..
-0000ff80: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-0000ff90: 6d5f 5f28 7365 6c66 2c20 696e 6465 7829  m__(self, index)
-0000ffa0: 3a0a 2020 2020 2020 2020 2320 4669 656c  :.        # Fiel
-0000ffb0: 6420 6163 6365 7373 2c20 652e 672e 2078  d access, e.g. x
-0000ffc0: 5b27 6127 5d20 6f72 2078 5b5b 2761 272c  ['a'] or x[['a',
-0000ffd0: 2027 6227 5d5d 0a20 2020 2020 2020 2069   'b']].        i
-0000ffe0: 6620 6973 696e 7374 616e 6365 2869 6e64  f isinstance(ind
-0000fff0: 6578 2c20 7374 7229 206f 7220 280a 2020  ex, str) or (.  
-00010000: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-00010010: 616e 6365 2869 6e64 6578 2c20 6c69 7374  ance(index, list
-00010020: 2920 616e 6420 696e 6465 7820 616e 6420  ) and index and 
-00010030: 616c 6c28 6973 696e 7374 616e 6365 2869  all(isinstance(i
-00010040: 2c20 7374 7229 2066 6f72 2069 2069 6e20  , str) for i in 
-00010050: 696e 6465 7829 0a20 2020 2020 2020 2029  index).        )
-00010060: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00010070: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
-00010080: 782c 2073 7472 293a 0a20 2020 2020 2020  x, str):.       
-00010090: 2020 2020 2020 2020 2064 7420 3d20 7365           dt = se
-000100a0: 6c66 2e64 7479 7065 5b69 6e64 6578 5d0a  lf.dtype[index].
-000100b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000100c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000100d0: 2020 6474 203d 206e 702e 6474 7970 6528    dt = np.dtype(
-000100e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000100f0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00010100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00010110: 6e61 6d65 7322 3a20 696e 6465 782c 0a20  names": index,. 
+0000b7f0: 2020 2020 2020 2022 6368 756e 6b73 697a         "chunksiz
+0000b800: 6522 3a20 7365 6c66 2e63 6875 6e6b 7369  e": self.chunksi
+0000b810: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
+0000b820: 2020 2020 2020 2020 2020 2020 2263 6875              "chu
+0000b830: 6e6b 7322 3a20 7365 6c66 2e63 6875 6e6b  nks": self.chunk
+0000b840: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000b850: 2020 2020 2020 2020 2020 2022 7479 7065             "type
+0000b860: 223a 2074 7970 656e 616d 6528 7479 7065  ": typename(type
+0000b870: 2873 656c 6629 292c 0a20 2020 2020 2020  (self)),.       
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2022 6368 756e 6b5f 7479 7065 223a 2074   "chunk_type": t
+0000b8a0: 7970 656e 616d 6528 7479 7065 2873 656c  ypename(type(sel
+0000b8b0: 662e 5f6d 6574 6129 292c 0a20 2020 2020  f._meta)),.     
+0000b8c0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0000b8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b8e0: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
+0000b8f0: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
+0000b900: 205f 5f72 6564 7563 655f 5f28 7365 6c66   __reduce__(self
+0000b910: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000b920: 6e20 2841 7272 6179 2c20 2873 656c 662e  n (Array, (self.
+0000b930: 6461 736b 2c20 7365 6c66 2e6e 616d 652c  dask, self.name,
+0000b940: 2073 656c 662e 6368 756e 6b73 2c20 7365   self.chunks, se
+0000b950: 6c66 2e64 7479 7065 2c20 7365 6c66 2e5f  lf.dtype, self._
+0000b960: 6d65 7461 2929 0a0a 2020 2020 6465 6620  meta))..    def 
+0000b970: 5f5f 6461 736b 5f67 7261 7068 5f5f 2873  __dask_graph__(s
+0000b980: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0000b990: 7475 726e 2073 656c 662e 6461 736b 0a0a  turn self.dask..
+0000b9a0: 2020 2020 6465 6620 5f5f 6461 736b 5f6c      def __dask_l
+0000b9b0: 6179 6572 735f 5f28 7365 6c66 293a 0a20  ayers__(self):. 
+0000b9c0: 2020 2020 2020 2072 6574 7572 6e20 2873         return (s
+0000b9d0: 656c 662e 6e61 6d65 2c29 0a0a 2020 2020  elf.name,)..    
+0000b9e0: 6465 6620 5f5f 6461 736b 5f6b 6579 735f  def __dask_keys_
+0000b9f0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+0000ba00: 2069 6620 7365 6c66 2e5f 6361 6368 6564   if self._cached
+0000ba10: 5f6b 6579 7320 6973 206e 6f74 204e 6f6e  _keys is not Non
+0000ba20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000ba30: 6574 7572 6e20 7365 6c66 2e5f 6361 6368  eturn self._cach
+0000ba40: 6564 5f6b 6579 730a 0a20 2020 2020 2020  ed_keys..       
+0000ba50: 206e 616d 652c 2063 6875 6e6b 732c 206e   name, chunks, n
+0000ba60: 756d 626c 6f63 6b73 203d 2073 656c 662e  umblocks = self.
+0000ba70: 6e61 6d65 2c20 7365 6c66 2e63 6875 6e6b  name, self.chunk
+0000ba80: 732c 2073 656c 662e 6e75 6d62 6c6f 636b  s, self.numblock
+0000ba90: 730a 0a20 2020 2020 2020 2064 6566 206b  s..        def k
+0000baa0: 6579 7328 2a61 7267 7329 3a0a 2020 2020  eys(*args):.    
+0000bab0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+0000bac0: 6875 6e6b 733a 0a20 2020 2020 2020 2020  hunks:.         
+0000bad0: 2020 2020 2020 2072 6574 7572 6e20 5b28         return [(
+0000bae0: 6e61 6d65 2c29 5d0a 2020 2020 2020 2020  name,)].        
+0000baf0: 2020 2020 696e 6420 3d20 6c65 6e28 6172      ind = len(ar
+0000bb00: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+0000bb10: 6966 2069 6e64 202b 2031 203d 3d20 6c65  if ind + 1 == le
+0000bb20: 6e28 6e75 6d62 6c6f 636b 7329 3a0a 2020  n(numblocks):.  
+0000bb30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000bb40: 7375 6c74 203d 205b 286e 616d 652c 2920  sult = [(name,) 
+0000bb50: 2b20 6172 6773 202b 2028 692c 2920 666f  + args + (i,) fo
+0000bb60: 7220 6920 696e 2072 616e 6765 286e 756d  r i in range(num
+0000bb70: 626c 6f63 6b73 5b69 6e64 5d29 5d0a 2020  blocks[ind])].  
+0000bb80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bba0: 7265 7375 6c74 203d 205b 6b65 7973 282a  result = [keys(*
+0000bbb0: 2861 7267 7320 2b20 2869 2c29 2929 2066  (args + (i,))) f
+0000bbc0: 6f72 2069 2069 6e20 7261 6e67 6528 6e75  or i in range(nu
+0000bbd0: 6d62 6c6f 636b 735b 696e 645d 295d 0a20  mblocks[ind])]. 
+0000bbe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000bbf0: 6e20 7265 7375 6c74 0a0a 2020 2020 2020  n result..      
+0000bc00: 2020 7365 6c66 2e5f 6361 6368 6564 5f6b    self._cached_k
+0000bc10: 6579 7320 3d20 7265 7375 6c74 203d 206b  eys = result = k
+0000bc20: 6579 7328 290a 2020 2020 2020 2020 7265  eys().        re
+0000bc30: 7475 726e 2072 6573 756c 740a 0a20 2020  turn result..   
+0000bc40: 2064 6566 205f 5f64 6173 6b5f 746f 6b65   def __dask_toke
+0000bc50: 6e69 7a65 5f5f 2873 656c 6629 3a0a 2020  nize__(self):.  
+0000bc60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000bc70: 662e 6e61 6d65 0a0a 2020 2020 5f5f 6461  f.name..    __da
+0000bc80: 736b 5f6f 7074 696d 697a 655f 5f20 3d20  sk_optimize__ = 
+0000bc90: 676c 6f62 616c 6d65 7468 6f64 280a 2020  globalmethod(.  
+0000bca0: 2020 2020 2020 6f70 7469 6d69 7a65 2c20        optimize, 
+0000bcb0: 6b65 793d 2261 7272 6179 5f6f 7074 696d  key="array_optim
+0000bcc0: 697a 6522 2c20 6661 6c73 6579 3d64 6f6e  ize", falsey=don
+0000bcd0: 745f 6f70 7469 6d69 7a65 0a20 2020 2029  t_optimize.    )
+0000bce0: 0a20 2020 205f 5f64 6173 6b5f 7363 6865  .    __dask_sche
+0000bcf0: 6475 6c65 725f 5f20 3d20 7374 6174 6963  duler__ = static
+0000bd00: 6d65 7468 6f64 2844 4546 4155 4c54 5f47  method(DEFAULT_G
+0000bd10: 4554 290a 0a20 2020 2064 6566 205f 5f64  ET)..    def __d
+0000bd20: 6173 6b5f 706f 7374 636f 6d70 7574 655f  ask_postcompute_
+0000bd30: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+0000bd40: 2072 6574 7572 6e20 6669 6e61 6c69 7a65   return finalize
+0000bd50: 2c20 2829 0a0a 2020 2020 6465 6620 5f5f  , ()..    def __
+0000bd60: 6461 736b 5f70 6f73 7470 6572 7369 7374  dask_postpersist
+0000bd70: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0000bd80: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+0000bd90: 6562 7569 6c64 2c20 2829 0a0a 2020 2020  ebuild, ()..    
+0000bda0: 6465 6620 5f72 6562 7569 6c64 2873 656c  def _rebuild(sel
+0000bdb0: 662c 2064 736b 2c20 2a2c 2072 656e 616d  f, dsk, *, renam
+0000bdc0: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0000bdd0: 206e 616d 6520 3d20 7365 6c66 2e5f 6e61   name = self._na
+0000bde0: 6d65 0a20 2020 2020 2020 2069 6620 7265  me.        if re
+0000bdf0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0000be00: 2020 6e61 6d65 203d 2072 656e 616d 652e    name = rename.
+0000be10: 6765 7428 6e61 6d65 2c20 6e61 6d65 290a  get(name, name).
+0000be20: 2020 2020 2020 2020 7265 7475 726e 2041          return A
+0000be30: 7272 6179 2864 736b 2c20 6e61 6d65 2c20  rray(dsk, name, 
+0000be40: 7365 6c66 2e63 6875 6e6b 732c 2073 656c  self.chunks, sel
+0000be50: 662e 6474 7970 652c 2073 656c 662e 5f6d  f.dtype, self._m
+0000be60: 6574 6129 0a0a 2020 2020 6465 6620 5f72  eta)..    def _r
+0000be70: 6573 6574 5f63 6163 6865 2873 656c 662c  eset_cache(self,
+0000be80: 206b 6579 3d4e 6f6e 6529 3a0a 2020 2020   key=None):.    
+0000be90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000bea0: 5265 7365 7420 6361 6368 6564 2070 726f  Reset cached pro
+0000beb0: 7065 7274 6965 732e 0a0a 2020 2020 2020  perties...      
+0000bec0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000bed0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000bee0: 2020 2020 2020 2020 6b65 7920 3a20 7374          key : st
+0000bef0: 722c 206f 7074 696f 6e61 6c0a 2020 2020  r, optional.    
+0000bf00: 2020 2020 2020 2020 5265 6d6f 7665 2073          Remove s
+0000bf10: 7065 6369 6669 6564 206b 6579 2e20 5468  pecified key. Th
+0000bf20: 6520 6465 6661 756c 7420 7265 6d6f 7665  e default remove
+0000bf30: 7320 616c 6c20 6974 656d 732e 0a20 2020  s all items..   
+0000bf40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000bf50: 2069 6620 6b65 7920 6973 204e 6f6e 653a   if key is None:
+0000bf60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bf70: 662e 5f5f 6469 6374 5f5f 2e63 6c65 6172  f.__dict__.clear
+0000bf80: 2829 0a20 2020 2020 2020 2065 6c73 653a  ().        else:
+0000bf90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bfa0: 662e 5f5f 6469 6374 5f5f 2e70 6f70 286b  f.__dict__.pop(k
+0000bfb0: 6579 2c20 4e6f 6e65 290a 0a20 2020 2040  ey, None)..    @
+0000bfc0: 6361 6368 6564 5f70 726f 7065 7274 790a  cached_property.
+0000bfd0: 2020 2020 6465 6620 5f6b 6579 5f61 7272      def _key_arr
+0000bfe0: 6179 2873 656c 6629 3a0a 2020 2020 2020  ay(self):.      
+0000bff0: 2020 7265 7475 726e 206e 702e 6172 7261    return np.arra
+0000c000: 7928 7365 6c66 2e5f 5f64 6173 6b5f 6b65  y(self.__dask_ke
+0000c010: 7973 5f5f 2829 2c20 6474 7970 653d 6f62  ys__(), dtype=ob
+0000c020: 6a65 6374 290a 0a20 2020 2040 6361 6368  ject)..    @cach
+0000c030: 6564 5f70 726f 7065 7274 790a 2020 2020  ed_property.    
+0000c040: 6465 6620 6e75 6d62 6c6f 636b 7328 7365  def numblocks(se
+0000c050: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0000c060: 7572 6e20 7475 706c 6528 6d61 7028 6c65  urn tuple(map(le
+0000c070: 6e2c 2073 656c 662e 6368 756e 6b73 2929  n, self.chunks))
+0000c080: 0a0a 2020 2020 4063 6163 6865 645f 7072  ..    @cached_pr
+0000c090: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
+0000c0a0: 7061 7274 6974 696f 6e73 2873 656c 6629  partitions(self)
+0000c0b0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000c0c0: 2072 6564 7563 6528 6d75 6c2c 2073 656c   reduce(mul, sel
+0000c0d0: 662e 6e75 6d62 6c6f 636b 732c 2031 290a  f.numblocks, 1).
+0000c0e0: 0a20 2020 2064 6566 2063 6f6d 7075 7465  .    def compute
+0000c0f0: 5f63 6875 6e6b 5f73 697a 6573 2873 656c  _chunk_sizes(sel
+0000c100: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+0000c110: 2020 2020 2020 2020 436f 6d70 7574 6520          Compute 
+0000c120: 7468 6520 6368 756e 6b20 7369 7a65 7320  the chunk sizes 
+0000c130: 666f 7220 6120 4461 736b 2061 7272 6179  for a Dask array
+0000c140: 2e20 5468 6973 2069 7320 6573 7065 6369  . This is especi
+0000c150: 616c 6c79 2075 7365 6675 6c0a 2020 2020  ally useful.    
+0000c160: 2020 2020 7768 656e 2074 6865 2063 6875      when the chu
+0000c170: 6e6b 2073 697a 6573 2061 7265 2075 6e6b  nk sizes are unk
+0000c180: 6e6f 776e 2028 652e 672e 2c20 7768 656e  nown (e.g., when
+0000c190: 2069 6e64 6578 696e 6720 6f6e 6520 4461   indexing one Da
+0000c1a0: 736b 2061 7272 6179 0a20 2020 2020 2020  sk array.       
+0000c1b0: 2077 6974 6820 616e 6f74 6865 7229 2e0a   with another)..
+0000c1c0: 0a20 2020 2020 2020 204e 6f74 6573 0a20  .        Notes. 
+0000c1d0: 2020 2020 2020 202d 2d2d 2d2d 0a20 2020         -----.   
+0000c1e0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+0000c1f0: 6f6e 206d 6f64 6966 6965 7320 7468 6520  on modifies the 
+0000c200: 4461 736b 2061 7272 6179 2069 6e2d 706c  Dask array in-pl
+0000c210: 6163 652e 0a0a 2020 2020 2020 2020 4578  ace...        Ex
+0000c220: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
+0000c230: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000c240: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+0000c250: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
+0000c260: 2020 2020 3e3e 3e20 696d 706f 7274 206e      >>> import n
+0000c270: 756d 7079 2061 7320 6e70 0a20 2020 2020  umpy as np.     
+0000c280: 2020 203e 3e3e 2078 203d 2064 612e 6672     >>> x = da.fr
+0000c290: 6f6d 5f61 7272 6179 285b 2d32 2c20 2d31  om_array([-2, -1
+0000c2a0: 2c20 302c 2031 2c20 325d 2c20 6368 756e  , 0, 1, 2], chun
+0000c2b0: 6b73 3d32 290a 2020 2020 2020 2020 3e3e  ks=2).        >>
+0000c2c0: 3e20 782e 6368 756e 6b73 0a20 2020 2020  > x.chunks.     
+0000c2d0: 2020 2028 2832 2c20 322c 2031 292c 290a     ((2, 2, 1),).
+0000c2e0: 2020 2020 2020 2020 3e3e 3e20 7920 3d20          >>> y = 
+0000c2f0: 785b 7820 3c3d 2030 5d0a 2020 2020 2020  x[x <= 0].      
+0000c300: 2020 3e3e 3e20 792e 6368 756e 6b73 0a20    >>> y.chunks. 
+0000c310: 2020 2020 2020 2028 286e 616e 2c20 6e61         ((nan, na
+0000c320: 6e2c 206e 616e 292c 290a 2020 2020 2020  n, nan),).      
+0000c330: 2020 3e3e 3e20 792e 636f 6d70 7574 655f    >>> y.compute_
+0000c340: 6368 756e 6b5f 7369 7a65 7328 2920 2023  chunk_sizes()  #
+0000c350: 2069 6e2d 706c 6163 6520 636f 6d70 7574   in-place comput
+0000c360: 6174 696f 6e0a 2020 2020 2020 2020 6461  ation.        da
+0000c370: 736b 2e61 7272 6179 3c67 6574 6974 656d  sk.array<getitem
+0000c380: 2c20 7368 6170 653d 2833 2c29 2c20 6474  , shape=(3,), dt
+0000c390: 7970 653d 696e 7436 342c 2063 6875 6e6b  ype=int64, chunk
+0000c3a0: 7369 7a65 3d28 322c 292c 2063 6875 6e6b  size=(2,), chunk
+0000c3b0: 7479 7065 3d6e 756d 7079 2e6e 6461 7272  type=numpy.ndarr
+0000c3c0: 6179 3e0a 2020 2020 2020 2020 3e3e 3e20  ay>.        >>> 
+0000c3d0: 792e 6368 756e 6b73 0a20 2020 2020 2020  y.chunks.       
+0000c3e0: 2028 2832 2c20 312c 2030 292c 290a 0a20   ((2, 1, 0),).. 
+0000c3f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000c400: 2020 2078 203d 2073 656c 660a 2020 2020     x = self.    
+0000c410: 2020 2020 6368 756e 6b5f 7368 6170 6573      chunk_shapes
+0000c420: 203d 2078 2e6d 6170 5f62 6c6f 636b 7328   = x.map_blocks(
+0000c430: 0a20 2020 2020 2020 2020 2020 205f 6765  .            _ge
+0000c440: 745f 6368 756e 6b5f 7368 6170 652c 0a20  t_chunk_shape,. 
+0000c450: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0000c460: 3d69 6e74 2c0a 2020 2020 2020 2020 2020  =int,.          
+0000c470: 2020 6368 756e 6b73 3d74 7570 6c65 286c    chunks=tuple(l
+0000c480: 656e 2863 2920 2a20 2831 2c29 2066 6f72  en(c) * (1,) for
+0000c490: 2063 2069 6e20 782e 6368 756e 6b73 2920   c in x.chunks) 
+0000c4a0: 2b20 2828 782e 6e64 696d 2c29 2c29 2c0a  + ((x.ndim,),),.
+0000c4b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000c4c0: 6178 6973 3d78 2e6e 6469 6d2c 0a20 2020  axis=x.ndim,.   
+0000c4d0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000c4e0: 6320 3d20 5b5d 0a20 2020 2020 2020 2066  c = [].        f
+0000c4f0: 6f72 2069 2069 6e20 7261 6e67 6528 782e  or i in range(x.
+0000c500: 6e64 696d 293a 0a20 2020 2020 2020 2020  ndim):.         
+0000c510: 2020 2073 203d 2078 2e6e 6469 6d20 2a20     s = x.ndim * 
+0000c520: 5b30 5d20 2b20 5b69 5d0a 2020 2020 2020  [0] + [i].      
+0000c530: 2020 2020 2020 735b 695d 203d 2073 6c69        s[i] = sli
+0000c540: 6365 284e 6f6e 6529 0a20 2020 2020 2020  ce(None).       
+0000c550: 2020 2020 2073 203d 2074 7570 6c65 2873       s = tuple(s
+0000c560: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0000c570: 2e61 7070 656e 6428 7475 706c 6528 6368  .append(tuple(ch
+0000c580: 756e 6b5f 7368 6170 6573 5b73 5d29 290a  unk_shapes[s])).
+0000c590: 0a20 2020 2020 2020 2023 2060 6d61 705f  .        # `map_
+0000c5a0: 626c 6f63 6b73 6020 6173 7369 676e 7320  blocks` assigns 
+0000c5b0: 6e75 6d70 7920 6474 7970 6573 0a20 2020  numpy dtypes.   
+0000c5c0: 2020 2020 2023 2063 6173 7420 6368 756e       # cast chun
+0000c5d0: 6b20 6469 6d65 6e73 696f 6e73 2062 6163  k dimensions bac
+0000c5e0: 6b20 746f 2070 7974 686f 6e20 696e 7420  k to python int 
+0000c5f0: 6265 666f 7265 2072 6574 7572 6e69 6e67  before returning
+0000c600: 0a20 2020 2020 2020 2078 2e5f 6368 756e  .        x._chun
+0000c610: 6b73 203d 2074 7570 6c65 280a 2020 2020  ks = tuple(.    
+0000c620: 2020 2020 2020 2020 7475 706c 6528 696e          tuple(in
+0000c630: 7428 6368 756e 6b29 2066 6f72 2063 6875  t(chunk) for chu
+0000c640: 6e6b 2069 6e20 6368 756e 6b73 2920 666f  nk in chunks) fo
+0000c650: 7220 6368 756e 6b73 2069 6e20 636f 6d70  r chunks in comp
+0000c660: 7574 6528 7475 706c 6528 6329 295b 305d  ute(tuple(c))[0]
+0000c670: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+0000c680: 2020 2072 6574 7572 6e20 780a 0a20 2020     return x..   
+0000c690: 2040 6361 6368 6564 5f70 726f 7065 7274   @cached_propert
+0000c6a0: 790a 2020 2020 6465 6620 7368 6170 6528  y.    def shape(
+0000c6b0: 7365 6c66 2920 2d3e 2074 7570 6c65 5b54  self) -> tuple[T
+0000c6c0: 5f49 6e74 4f72 4e61 4e2c 202e 2e2e 5d3a  _IntOrNaN, ...]:
+0000c6d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c6e0: 7475 706c 6528 6361 6368 6564 5f63 756d  tuple(cached_cum
+0000c6f0: 7375 6d28 632c 2069 6e69 7469 616c 5f7a  sum(c, initial_z
+0000c700: 6572 6f3d 5472 7565 295b 2d31 5d20 666f  ero=True)[-1] fo
+0000c710: 7220 6320 696e 2073 656c 662e 6368 756e  r c in self.chun
+0000c720: 6b73 290a 0a20 2020 2040 7072 6f70 6572  ks)..    @proper
+0000c730: 7479 0a20 2020 2064 6566 2063 6875 6e6b  ty.    def chunk
+0000c740: 7369 7a65 2873 656c 6629 202d 3e20 7475  size(self) -> tu
+0000c750: 706c 655b 545f 496e 744f 724e 614e 2c20  ple[T_IntOrNaN, 
+0000c760: 2e2e 2e5d 3a0a 2020 2020 2020 2020 7265  ...]:.        re
+0000c770: 7475 726e 2074 7570 6c65 286d 6178 2863  turn tuple(max(c
+0000c780: 2920 666f 7220 6320 696e 2073 656c 662e  ) for c in self.
+0000c790: 6368 756e 6b73 290a 0a20 2020 2040 7072  chunks)..    @pr
+0000c7a0: 6f70 6572 7479 0a20 2020 2064 6566 2064  operty.    def d
+0000c7b0: 7479 7065 2873 656c 6629 3a0a 2020 2020  type(self):.    
+0000c7c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000c7d0: 6528 7365 6c66 2e5f 6d65 7461 2c20 7475  e(self._meta, tu
+0000c7e0: 706c 6529 3a0a 2020 2020 2020 2020 2020  ple):.          
+0000c7f0: 2020 6474 7970 6520 3d20 7365 6c66 2e5f    dtype = self._
+0000c800: 6d65 7461 5b30 5d2e 6474 7970 650a 2020  meta[0].dtype.  
+0000c810: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000c820: 2020 2020 2020 2020 6474 7970 6520 3d20          dtype = 
+0000c830: 7365 6c66 2e5f 6d65 7461 2e64 7479 7065  self._meta.dtype
+0000c840: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c850: 6474 7970 650a 0a20 2020 2040 7072 6f70  dtype..    @prop
+0000c860: 6572 7479 0a20 2020 2064 6566 205f 6368  erty.    def _ch
+0000c870: 756e 6b73 2873 656c 6629 3a0a 2020 2020  unks(self):.    
+0000c880: 2020 2020 2222 224e 6f6e 2d70 7562 6c69      """Non-publi
+0000c890: 6320 6368 756e 6b73 2070 726f 7065 7274  c chunks propert
+0000c8a0: 792e 2041 6c6c 6f77 7320 7365 7474 696e  y. Allows settin
+0000c8b0: 6720 6120 6368 756e 6b20 7661 6c75 652e  g a chunk value.
+0000c8c0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000c8d0: 726e 2073 656c 662e 5f5f 6368 756e 6b73  rn self.__chunks
+0000c8e0: 0a0a 2020 2020 405f 6368 756e 6b73 2e73  ..    @_chunks.s
+0000c8f0: 6574 7465 720a 2020 2020 6465 6620 5f63  etter.    def _c
+0000c900: 6875 6e6b 7328 7365 6c66 2c20 6368 756e  hunks(self, chun
+0000c910: 6b73 293a 0a20 2020 2020 2020 2073 656c  ks):.        sel
+0000c920: 662e 5f5f 6368 756e 6b73 203d 2063 6875  f.__chunks = chu
+0000c930: 6e6b 730a 0a20 2020 2020 2020 2023 2057  nks..        # W
+0000c940: 6865 6e20 7468 6520 6368 756e 6b73 2063  hen the chunks c
+0000c950: 6861 6e67 6573 2074 6865 2063 6163 6865  hanges the cache
+0000c960: 6420 7072 6f70 6572 7469 6573 2074 6861  d properties tha
+0000c970: 7420 7761 730a 2020 2020 2020 2020 2320  t was.        # 
+0000c980: 6465 7065 6e64 656e 7420 6f6e 2069 7420  dependent on it 
+0000c990: 6e65 6564 7320 746f 2062 6520 6465 6c65  needs to be dele
+0000c9a0: 7465 643a 0a20 2020 2020 2020 2066 6f72  ted:.        for
+0000c9b0: 206b 6579 2069 6e20 5b22 6e75 6d62 6c6f   key in ["numblo
+0000c9c0: 636b 7322 2c20 226e 7061 7274 6974 696f  cks", "npartitio
+0000c9d0: 6e73 222c 2022 7368 6170 6522 2c20 226e  ns", "shape", "n
+0000c9e0: 6469 6d22 2c20 2273 697a 6522 2c20 225f  dim", "size", "_
+0000c9f0: 6b65 795f 6172 7261 7922 5d3a 0a20 2020  key_array"]:.   
+0000ca00: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
+0000ca10: 6573 6574 5f63 6163 6865 286b 6579 290a  eset_cache(key).
+0000ca20: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0000ca30: 2020 2064 6566 2063 6875 6e6b 7328 7365     def chunks(se
+0000ca40: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000ca50: 4368 756e 6b73 2070 726f 7065 7274 792e  Chunks property.
+0000ca60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000ca70: 726e 2073 656c 662e 5f5f 6368 756e 6b73  rn self.__chunks
+0000ca80: 0a0a 2020 2020 4063 6875 6e6b 732e 7365  ..    @chunks.se
+0000ca90: 7474 6572 0a20 2020 2064 6566 2063 6875  tter.    def chu
+0000caa0: 6e6b 7328 7365 6c66 2c20 6368 756e 6b73  nks(self, chunks
+0000cab0: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+0000cac0: 2054 7970 6545 7272 6f72 280a 2020 2020   TypeError(.    
+0000cad0: 2020 2020 2020 2020 2243 616e 206e 6f74          "Can not
+0000cae0: 2073 6574 2063 6875 6e6b 7320 6469 7265   set chunks dire
+0000caf0: 6374 6c79 5c6e 5c6e 220a 2020 2020 2020  ctly\n\n".      
+0000cb00: 2020 2020 2020 2250 6c65 6173 6520 7573        "Please us
+0000cb10: 6520 7468 6520 7265 6368 756e 6b20 6d65  e the rechunk me
+0000cb20: 7468 6f64 2069 6e73 7465 6164 3a5c 6e22  thod instead:\n"
+0000cb30: 0a20 2020 2020 2020 2020 2020 2066 2220  .            f" 
+0000cb40: 2078 2e72 6563 6875 6e6b 287b 6368 756e   x.rechunk({chun
+0000cb50: 6b73 7d29 5c6e 5c6e 220a 2020 2020 2020  ks})\n\n".      
+0000cb60: 2020 2020 2020 2249 6620 7472 7969 6e67        "If trying
+0000cb70: 2074 6f20 6176 6f69 6420 756e 6b6e 6f77   to avoid unknow
+0000cb80: 6e20 6368 756e 6b73 2c20 7573 655c 6e22  n chunks, use\n"
+0000cb90: 0a20 2020 2020 2020 2020 2020 2022 2020  .            "  
+0000cba0: 782e 636f 6d70 7574 655f 6368 756e 6b5f  x.compute_chunk_
+0000cbb0: 7369 7a65 7328 2922 0a20 2020 2020 2020  sizes()".       
+0000cbc0: 2029 0a0a 2020 2020 6465 6620 5f5f 6c65   )..    def __le
+0000cbd0: 6e5f 5f28 7365 6c66 293a 0a20 2020 2020  n__(self):.     
+0000cbe0: 2020 2069 6620 6e6f 7420 7365 6c66 2e63     if not self.c
+0000cbf0: 6875 6e6b 733a 0a20 2020 2020 2020 2020  hunks:.         
+0000cc00: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+0000cc10: 6f72 2822 6c65 6e28 2920 6f66 2075 6e73  or("len() of uns
+0000cc20: 697a 6564 206f 626a 6563 7422 290a 2020  ized object").  
+0000cc30: 2020 2020 2020 6966 206e 702e 6973 6e61        if np.isna
+0000cc40: 6e28 7365 6c66 2e63 6875 6e6b 735b 305d  n(self.chunks[0]
+0000cc50: 292e 616e 7928 293a 0a20 2020 2020 2020  ).any():.       
+0000cc60: 2020 2020 206d 7367 203d 2028 0a20 2020       msg = (.   
+0000cc70: 2020 2020 2020 2020 2020 2020 2022 4361               "Ca
+0000cc80: 6e6e 6f74 2063 616c 6c20 6c65 6e28 2920  nnot call len() 
+0000cc90: 6f6e 206f 626a 6563 7420 7769 7468 2075  on object with u
+0000cca0: 6e6b 6e6f 776e 2063 6875 6e6b 2073 697a  nknown chunk siz
+0000ccb0: 652e 220a 2020 2020 2020 2020 2020 2020  e.".            
+0000ccc0: 2020 2020 6622 7b75 6e6b 6e6f 776e 5f63      f"{unknown_c
+0000ccd0: 6875 6e6b 5f6d 6573 7361 6765 7d22 0a20  hunk_message}". 
+0000cce0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000ccf0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000cd00: 616c 7565 4572 726f 7228 6d73 6729 0a20  alueError(msg). 
+0000cd10: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+0000cd20: 7428 7375 6d28 7365 6c66 2e63 6875 6e6b  t(sum(self.chunk
+0000cd30: 735b 305d 2929 0a0a 2020 2020 6465 6620  s[0]))..    def 
+0000cd40: 5f5f 6172 7261 795f 7566 756e 635f 5f28  __array_ufunc__(
+0000cd50: 7365 6c66 2c20 6e75 6d70 795f 7566 756e  self, numpy_ufun
+0000cd60: 632c 206d 6574 686f 642c 202a 696e 7075  c, method, *inpu
+0000cd70: 7473 2c20 2a2a 6b77 6172 6773 293a 0a20  ts, **kwargs):. 
+0000cd80: 2020 2020 2020 206f 7574 203d 206b 7761         out = kwa
+0000cd90: 7267 732e 6765 7428 226f 7574 222c 2028  rgs.get("out", (
+0000cda0: 2929 0a20 2020 2020 2020 2066 6f72 2078  )).        for x
+0000cdb0: 2069 6e20 696e 7075 7473 202b 206f 7574   in inputs + out
+0000cdc0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000cdd0: 205f 7368 6f75 6c64 5f64 656c 6567 6174   _should_delegat
+0000cde0: 6528 7365 6c66 2c20 7829 3a0a 2020 2020  e(self, x):.    
+0000cdf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000ce00: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
+0000ce10: 640a 0a20 2020 2020 2020 2069 6620 6d65  d..        if me
+0000ce20: 7468 6f64 203d 3d20 225f 5f63 616c 6c5f  thod == "__call_
+0000ce30: 5f22 3a0a 2020 2020 2020 2020 2020 2020  _":.            
+0000ce40: 6966 206e 756d 7079 5f75 6675 6e63 2069  if numpy_ufunc i
+0000ce50: 7320 6e70 2e6d 6174 6d75 6c3a 0a20 2020  s np.matmul:.   
+0000ce60: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+0000ce70: 6d20 6461 736b 2e61 7272 6179 2e72 6f75  m dask.array.rou
+0000ce80: 7469 6e65 7320 696d 706f 7274 206d 6174  tines import mat
+0000ce90: 6d75 6c0a 0a20 2020 2020 2020 2020 2020  mul..           
+0000cea0: 2020 2020 2023 2073 7065 6369 616c 2063       # special c
+0000ceb0: 6173 6520 756e 7469 6c20 6170 706c 795f  ase until apply_
+0000cec0: 6775 6675 6e63 2068 616e 646c 6573 206f  gufunc handles o
+0000ced0: 7074 696f 6e61 6c20 6469 6d65 6e73 696f  ptional dimensio
+0000cee0: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
+0000cef0: 2020 2072 6574 7572 6e20 6d61 746d 756c     return matmul
+0000cf00: 282a 696e 7075 7473 2c20 2a2a 6b77 6172  (*inputs, **kwar
+0000cf10: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
+0000cf20: 6966 206e 756d 7079 5f75 6675 6e63 2e73  if numpy_ufunc.s
+0000cf30: 6967 6e61 7475 7265 2069 7320 6e6f 7420  ignature is not 
+0000cf40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000cf50: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+0000cf60: 6172 7261 792e 6775 6675 6e63 2069 6d70  array.gufunc imp
+0000cf70: 6f72 7420 6170 706c 795f 6775 6675 6e63  ort apply_gufunc
+0000cf80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cf90: 2020 7265 7475 726e 2061 7070 6c79 5f67    return apply_g
+0000cfa0: 7566 756e 6328 0a20 2020 2020 2020 2020  ufunc(.         
+0000cfb0: 2020 2020 2020 2020 2020 206e 756d 7079             numpy
+0000cfc0: 5f75 6675 6e63 2c20 6e75 6d70 795f 7566  _ufunc, numpy_uf
+0000cfd0: 756e 632e 7369 676e 6174 7572 652c 202a  unc.signature, *
+0000cfe0: 696e 7075 7473 2c20 2a2a 6b77 6172 6773  inputs, **kwargs
+0000cff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d000: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+0000d010: 6620 6e75 6d70 795f 7566 756e 632e 6e6f  f numpy_ufunc.no
+0000d020: 7574 203e 2031 3a0a 2020 2020 2020 2020  ut > 1:.        
+0000d030: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+0000d040: 6b2e 6172 7261 7920 696d 706f 7274 2075  k.array import u
+0000d050: 6675 6e63 0a0a 2020 2020 2020 2020 2020  func..          
+0000d060: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000d080: 615f 7566 756e 6320 3d20 6765 7461 7474  a_ufunc = getatt
+0000d090: 7228 7566 756e 632c 206e 756d 7079 5f75  r(ufunc, numpy_u
+0000d0a0: 6675 6e63 2e5f 5f6e 616d 655f 5f29 0a20  func.__name__). 
+0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000d0c0: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
+0000d0d0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+0000d0e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d0f0: 204e 6f74 496d 706c 656d 656e 7465 640a   NotImplemented.
+0000d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d110: 7265 7475 726e 2064 615f 7566 756e 6328  return da_ufunc(
+0000d120: 2a69 6e70 7574 732c 202a 2a6b 7761 7267  *inputs, **kwarg
+0000d130: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+0000d140: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000d150: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+0000d160: 7769 7365 286e 756d 7079 5f75 6675 6e63  wise(numpy_ufunc
+0000d170: 2c20 2a69 6e70 7574 732c 202a 2a6b 7761  , *inputs, **kwa
+0000d180: 7267 7329 0a20 2020 2020 2020 2065 6c69  rgs).        eli
+0000d190: 6620 6d65 7468 6f64 203d 3d20 226f 7574  f method == "out
+0000d1a0: 6572 223a 0a20 2020 2020 2020 2020 2020  er":.           
+0000d1b0: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+0000d1c0: 2069 6d70 6f72 7420 7566 756e 630a 0a20   import ufunc.. 
+0000d1d0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1f0: 6461 5f75 6675 6e63 203d 2067 6574 6174  da_ufunc = getat
+0000d200: 7472 2875 6675 6e63 2c20 6e75 6d70 795f  tr(ufunc, numpy_
+0000d210: 7566 756e 632e 5f5f 6e61 6d65 5f5f 290a  ufunc.__name__).
+0000d220: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000d230: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+0000d240: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0000d250: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+0000d260: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
+0000d270: 2020 2020 2072 6574 7572 6e20 6461 5f75       return da_u
+0000d280: 6675 6e63 2e6f 7574 6572 282a 696e 7075  func.outer(*inpu
+0000d290: 7473 2c20 2a2a 6b77 6172 6773 290a 2020  ts, **kwargs).  
+0000d2a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d2b0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000d2c0: 6f74 496d 706c 656d 656e 7465 640a 0a20  otImplemented.. 
+0000d2d0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+0000d2e0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000d2f0: 2222 0a0a 2020 2020 2020 2020 3e3e 3e20  ""..        >>> 
+0000d300: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+0000d310: 7920 6173 2064 610a 2020 2020 2020 2020  y as da.        
+0000d320: 3e3e 3e20 6461 2e6f 6e65 7328 2831 302c  >>> da.ones((10,
+0000d330: 2031 3029 2c20 6368 756e 6b73 3d28 352c   10), chunks=(5,
+0000d340: 2035 292c 2064 7479 7065 3d27 6934 2729   5), dtype='i4')
+0000d350: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+0000d360: 7261 793c 2e2e 2e2c 2073 6861 7065 3d28  ray<..., shape=(
+0000d370: 3130 2c20 3130 292c 2064 7479 7065 3d69  10, 10), dtype=i
+0000d380: 6e74 3332 2c20 6368 756e 6b73 697a 653d  nt32, chunksize=
+0000d390: 2835 2c20 3529 2c20 6368 756e 6b74 7970  (5, 5), chunktyp
+0000d3a0: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+0000d3b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000d3c0: 2020 2020 2063 6875 6e6b 7369 7a65 203d       chunksize =
+0000d3d0: 2073 7472 2873 656c 662e 6368 756e 6b73   str(self.chunks
+0000d3e0: 697a 6529 0a20 2020 2020 2020 206e 616d  ize).        nam
+0000d3f0: 6520 3d20 7365 6c66 2e6e 616d 652e 7273  e = self.name.rs
+0000d400: 706c 6974 2822 2d22 2c20 3129 5b30 5d0a  plit("-", 1)[0].
+0000d410: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+0000d420: 0a20 2020 2020 2020 2020 2020 2022 6461  .            "da
+0000d430: 736b 2e61 7272 6179 3c7b 7d2c 2073 6861  sk.array<{}, sha
+0000d440: 7065 3d7b 7d2c 2064 7479 7065 3d7b 7d2c  pe={}, dtype={},
+0000d450: 2063 6875 6e6b 7369 7a65 3d7b 7d2c 2063   chunksize={}, c
+0000d460: 6875 6e6b 7479 7065 3d7b 7d2e 7b7d 3e22  hunktype={}.{}>"
+0000d470: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
+0000d480: 2020 2020 2020 2020 206e 616d 652c 0a20           name,. 
+0000d490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d4a0: 656c 662e 7368 6170 652c 0a20 2020 2020  elf.shape,.     
+0000d4b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d4c0: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+0000d4d0: 2020 2020 2020 2063 6875 6e6b 7369 7a65         chunksize
+0000d4e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d4f0: 2020 7479 7065 2873 656c 662e 5f6d 6574    type(self._met
+0000d500: 6129 2e5f 5f6d 6f64 756c 655f 5f2e 7370  a).__module__.sp
+0000d510: 6c69 7428 222e 2229 5b30 5d2c 0a20 2020  lit(".")[0],.   
+0000d520: 2020 2020 2020 2020 2020 2020 2074 7970               typ
+0000d530: 6528 7365 6c66 2e5f 6d65 7461 292e 5f5f  e(self._meta).__
+0000d540: 6e61 6d65 5f5f 2c0a 2020 2020 2020 2020  name__,.        
+0000d550: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
+0000d560: 0a20 2020 2064 6566 205f 7265 7072 5f68  .    def _repr_h
+0000d570: 746d 6c5f 2873 656c 6629 3a0a 2020 2020  tml_(self):.    
+0000d580: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d590: 2020 2020 2067 7269 6420 3d20 7365 6c66       grid = self
+0000d5a0: 2e74 6f5f 7376 6728 7369 7a65 3d63 6f6e  .to_svg(size=con
+0000d5b0: 6669 672e 6765 7428 2261 7272 6179 2e73  fig.get("array.s
+0000d5c0: 7667 2e73 697a 6522 2c20 3132 3029 290a  vg.size", 120)).
+0000d5d0: 2020 2020 2020 2020 6578 6365 7074 204e          except N
+0000d5e0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+0000d5f0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0000d600: 6772 6964 203d 2022 220a 0a20 2020 2020  grid = ""..     
+0000d610: 2020 2069 6620 2273 7061 7273 6522 2069     if "sparse" i
+0000d620: 6e20 7479 7065 6e61 6d65 2874 7970 6528  n typename(type(
+0000d630: 7365 6c66 2e5f 6d65 7461 2929 3a0a 2020  self._meta)):.  
+0000d640: 2020 2020 2020 2020 2020 6e62 7974 6573            nbytes
+0000d650: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000d660: 2020 2020 6362 7974 6573 203d 204e 6f6e      cbytes = Non
+0000d670: 650a 2020 2020 2020 2020 656c 6966 206e  e.        elif n
+0000d680: 6f74 206d 6174 682e 6973 6e61 6e28 7365  ot math.isnan(se
+0000d690: 6c66 2e6e 6279 7465 7329 3a0a 2020 2020  lf.nbytes):.    
+0000d6a0: 2020 2020 2020 2020 6e62 7974 6573 203d          nbytes =
+0000d6b0: 2066 6f72 6d61 745f 6279 7465 7328 7365   format_bytes(se
+0000d6c0: 6c66 2e6e 6279 7465 7329 0a20 2020 2020  lf.nbytes).     
+0000d6d0: 2020 2020 2020 2063 6279 7465 7320 3d20         cbytes = 
+0000d6e0: 666f 726d 6174 5f62 7974 6573 286d 6174  format_bytes(mat
+0000d6f0: 682e 7072 6f64 2873 656c 662e 6368 756e  h.prod(self.chun
+0000d700: 6b73 697a 6529 202a 2073 656c 662e 6474  ksize) * self.dt
+0000d710: 7970 652e 6974 656d 7369 7a65 290a 2020  ype.itemsize).  
+0000d720: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d730: 2020 2020 2020 2020 6e62 7974 6573 203d          nbytes =
+0000d740: 2022 756e 6b6e 6f77 6e22 0a20 2020 2020   "unknown".     
+0000d750: 2020 2020 2020 2063 6279 7465 7320 3d20         cbytes = 
+0000d760: 2275 6e6b 6e6f 776e 220a 0a20 2020 2020  "unknown"..     
+0000d770: 2020 2072 6574 7572 6e20 6765 745f 7465     return get_te
+0000d780: 6d70 6c61 7465 2822 6172 7261 792e 6874  mplate("array.ht
+0000d790: 6d6c 2e6a 3222 292e 7265 6e64 6572 280a  ml.j2").render(.
+0000d7a0: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+0000d7b0: 793d 7365 6c66 2c0a 2020 2020 2020 2020  y=self,.        
+0000d7c0: 2020 2020 6772 6964 3d67 7269 642c 0a20      grid=grid,. 
+0000d7d0: 2020 2020 2020 2020 2020 206e 6279 7465             nbyte
+0000d7e0: 733d 6e62 7974 6573 2c0a 2020 2020 2020  s=nbytes,.      
+0000d7f0: 2020 2020 2020 6362 7974 6573 3d63 6279        cbytes=cby
+0000d800: 7465 732c 0a20 2020 2020 2020 2020 2020  tes,.           
+0000d810: 206c 6179 6572 733d 6d61 7962 655f 706c   layers=maybe_pl
+0000d820: 7572 616c 697a 6528 6c65 6e28 7365 6c66  uralize(len(self
+0000d830: 2e64 6173 6b2e 6c61 7965 7273 292c 2022  .dask.layers), "
+0000d840: 6772 6170 6820 6c61 7965 7222 292c 0a20  graph layer"),. 
+0000d850: 2020 2020 2020 2029 0a0a 2020 2020 4063         )..    @c
+0000d860: 6163 6865 645f 7072 6f70 6572 7479 0a20  ached_property. 
+0000d870: 2020 2064 6566 206e 6469 6d28 7365 6c66     def ndim(self
+0000d880: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0000d890: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
+0000d8a0: 662e 7368 6170 6529 0a0a 2020 2020 4063  f.shape)..    @c
+0000d8b0: 6163 6865 645f 7072 6f70 6572 7479 0a20  ached_property. 
+0000d8c0: 2020 2064 6566 2073 697a 6528 7365 6c66     def size(self
+0000d8d0: 2920 2d3e 2054 5f49 6e74 4f72 4e61 4e3a  ) -> T_IntOrNaN:
+0000d8e0: 0a20 2020 2020 2020 2022 2222 4e75 6d62  .        """Numb
+0000d8f0: 6572 206f 6620 656c 656d 656e 7473 2069  er of elements i
+0000d900: 6e20 6172 7261 7922 2222 0a20 2020 2020  n array""".     
+0000d910: 2020 2072 6574 7572 6e20 7265 6475 6365     return reduce
+0000d920: 286d 756c 2c20 7365 6c66 2e73 6861 7065  (mul, self.shape
+0000d930: 2c20 3129 0a0a 2020 2020 4070 726f 7065  , 1)..    @prope
+0000d940: 7274 790a 2020 2020 6465 6620 6e62 7974  rty.    def nbyt
+0000d950: 6573 2873 656c 6629 202d 3e20 545f 496e  es(self) -> T_In
+0000d960: 744f 724e 614e 3a0a 2020 2020 2020 2020  tOrNaN:.        
+0000d970: 2222 224e 756d 6265 7220 6f66 2062 7974  """Number of byt
+0000d980: 6573 2069 6e20 6172 7261 7922 2222 0a20  es in array""". 
+0000d990: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000d9a0: 6c66 2e73 697a 6520 2a20 7365 6c66 2e64  lf.size * self.d
+0000d9b0: 7479 7065 2e69 7465 6d73 697a 650a 0a20  type.itemsize.. 
+0000d9c0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0000d9d0: 2064 6566 2069 7465 6d73 697a 6528 7365   def itemsize(se
+0000d9e0: 6c66 2920 2d3e 2069 6e74 3a0a 2020 2020  lf) -> int:.    
+0000d9f0: 2020 2020 2222 224c 656e 6774 6820 6f66      """Length of
+0000da00: 206f 6e65 2061 7272 6179 2065 6c65 6d65   one array eleme
+0000da10: 6e74 2069 6e20 6279 7465 7322 2222 0a20  nt in bytes""". 
+0000da20: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000da30: 6c66 2e64 7479 7065 2e69 7465 6d73 697a  lf.dtype.itemsiz
+0000da40: 650a 0a20 2020 2040 7072 6f70 6572 7479  e..    @property
+0000da50: 0a20 2020 2064 6566 205f 6e61 6d65 2873  .    def _name(s
+0000da60: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0000da70: 7475 726e 2073 656c 662e 5f5f 6e61 6d65  turn self.__name
+0000da80: 0a0a 2020 2020 405f 6e61 6d65 2e73 6574  ..    @_name.set
+0000da90: 7465 720a 2020 2020 6465 6620 5f6e 616d  ter.    def _nam
+0000daa0: 6528 7365 6c66 2c20 7661 6c29 3a0a 2020  e(self, val):.  
+0000dab0: 2020 2020 2020 7365 6c66 2e5f 5f6e 616d        self.__nam
+0000dac0: 6520 3d20 7661 6c0a 2020 2020 2020 2020  e = val.        
+0000dad0: 2320 436c 6561 7220 7468 6520 6b65 7920  # Clear the key 
+0000dae0: 6361 6368 6520 7768 656e 2074 6865 206e  cache when the n
+0000daf0: 616d 6520 6973 2072 6573 6574 0a20 2020  ame is reset.   
+0000db00: 2020 2020 2073 656c 662e 5f63 6163 6865       self._cache
+0000db10: 645f 6b65 7973 203d 204e 6f6e 650a 2020  d_keys = None.  
+0000db20: 2020 2020 2020 7365 6c66 2e5f 7265 7365        self._rese
+0000db30: 745f 6361 6368 6528 225f 6b65 795f 6172  t_cache("_key_ar
+0000db40: 7261 7922 290a 0a20 2020 2040 7072 6f70  ray")..    @prop
+0000db50: 6572 7479 0a20 2020 2064 6566 206e 616d  erty.    def nam
+0000db60: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0000db70: 2072 6574 7572 6e20 7365 6c66 2e5f 5f6e   return self.__n
+0000db80: 616d 650a 0a20 2020 2040 6e61 6d65 2e73  ame..    @name.s
+0000db90: 6574 7465 720a 2020 2020 6465 6620 6e61  etter.    def na
+0000dba0: 6d65 2873 656c 662c 2076 616c 293a 0a20  me(self, val):. 
+0000dbb0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000dbc0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000dbd0: 2020 2020 2243 616e 6e6f 7420 7365 7420      "Cannot set 
+0000dbe0: 6e61 6d65 2064 6972 6563 746c 795c 6e5c  name directly\n\
+0000dbf0: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
+0000dc00: 4e61 6d65 2069 7320 7573 6564 2074 6f20  Name is used to 
+0000dc10: 7265 6c61 7465 2074 6865 2061 7272 6179  relate the array
+0000dc20: 2074 6f20 7468 6520 7461 736b 2067 7261   to the task gra
+0000dc30: 7068 2e5c 6e22 0a20 2020 2020 2020 2020  ph.\n".         
+0000dc40: 2020 2022 4974 2069 7320 756e 636f 6d6d     "It is uncomm
+0000dc50: 6f6e 2074 6f20 6e65 6564 2074 6f20 6368  on to need to ch
+0000dc60: 616e 6765 2069 742c 2062 7574 2069 6620  ange it, but if 
+0000dc70: 796f 7520 646f 5c6e 220a 2020 2020 2020  you do\n".      
+0000dc80: 2020 2020 2020 2270 6c65 6173 6520 7365        "please se
+0000dc90: 7420 6060 2e5f 6e61 6d65 6060 220a 2020  t ``._name``".  
+0000dca0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0000dcb0: 205f 5f69 7465 725f 5f28 7365 6c66 293a   __iter__(self):
+0000dcc0: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+0000dcd0: 6e20 7261 6e67 6528 6c65 6e28 7365 6c66  n range(len(self
+0000dce0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000dcf0: 7969 656c 6420 7365 6c66 5b69 5d0a 0a20  yield self[i].. 
+0000dd00: 2020 205f 5f61 7272 6179 5f70 7269 6f72     __array_prior
+0000dd10: 6974 795f 5f20 3d20 3131 2020 2320 6869  ity__ = 11  # hi
+0000dd20: 6768 6572 2074 6861 6e20 6e75 6d70 792e  gher than numpy.
+0000dd30: 6e64 6172 7261 7920 616e 6420 6e75 6d70  ndarray and nump
+0000dd40: 792e 6d61 7472 6978 0a0a 2020 2020 6465  y.matrix..    de
+0000dd50: 6620 5f5f 6172 7261 795f 5f28 7365 6c66  f __array__(self
+0000dd60: 2c20 6474 7970 653d 4e6f 6e65 2c20 2a2a  , dtype=None, **
+0000dd70: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0000dd80: 2078 203d 2073 656c 662e 636f 6d70 7574   x = self.comput
+0000dd90: 6528 290a 2020 2020 2020 2020 6966 2064  e().        if d
+0000dda0: 7479 7065 2061 6e64 2078 2e64 7479 7065  type and x.dtype
+0000ddb0: 2021 3d20 6474 7970 653a 0a20 2020 2020   != dtype:.     
+0000ddc0: 2020 2020 2020 2078 203d 2078 2e61 7374         x = x.ast
+0000ddd0: 7970 6528 6474 7970 6529 0a20 2020 2020  ype(dtype).     
+0000dde0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0000ddf0: 616e 6365 2878 2c20 6e70 2e6e 6461 7272  ance(x, np.ndarr
+0000de00: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
+0000de10: 2078 203d 206e 702e 6172 7261 7928 7829   x = np.array(x)
+0000de20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000de30: 780a 0a20 2020 2064 6566 205f 5f61 7272  x..    def __arr
+0000de40: 6179 5f66 756e 6374 696f 6e5f 5f28 7365  ay_function__(se
+0000de50: 6c66 2c20 6675 6e63 2c20 7479 7065 732c  lf, func, types,
+0000de60: 2061 7267 732c 206b 7761 7267 7329 3a0a   args, kwargs):.
+0000de70: 2020 2020 2020 2020 696d 706f 7274 2064          import d
+0000de80: 6173 6b2e 6172 7261 7920 6173 206d 6f64  ask.array as mod
+0000de90: 756c 650a 0a20 2020 2020 2020 2064 6566  ule..        def
+0000dea0: 2068 616e 646c 655f 6e6f 6e6d 6174 6368   handle_nonmatch
+0000deb0: 696e 675f 6e61 6d65 7328 6675 6e63 2c20  ing_names(func, 
+0000dec0: 6172 6773 2c20 6b77 6172 6773 293a 0a20  args, kwargs):. 
+0000ded0: 2020 2020 2020 2020 2020 2069 6620 6675             if fu
+0000dee0: 6e63 206e 6f74 2069 6e20 5f48 414e 444c  nc not in _HANDL
+0000def0: 4544 5f46 554e 4354 494f 4e53 3a0a 2020  ED_FUNCTIONS:.  
+0000df00: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000df10: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+0000df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df30: 2022 5468 6520 607b 7d60 2066 756e 6374   "The `{}` funct
+0000df40: 696f 6e20 6973 206e 6f74 2069 6d70 6c65  ion is not imple
+0000df50: 6d65 6e74 6564 2062 7920 4461 736b 2061  mented by Dask a
+0000df60: 7272 6179 2e20 220a 2020 2020 2020 2020  rray. ".        
+0000df70: 2020 2020 2020 2020 2020 2020 2259 6f75              "You
+0000df80: 206d 6179 2077 616e 7420 746f 2075 7365   may want to use
+0000df90: 2074 6865 2064 612e 6d61 705f 626c 6f63   the da.map_bloc
+0000dfa0: 6b73 2066 756e 6374 696f 6e20 220a 2020  ks function ".  
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 2020 226f 7220 736f 6d65 7468 696e 6720    "or something 
+0000dfd0: 7369 6d69 6c61 7220 746f 2073 696c 656e  similar to silen
+0000dfe0: 6365 2074 6869 7320 7761 726e 696e 672e  ce this warning.
+0000dff0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000e000: 2020 2020 2020 2022 596f 7572 2063 6f64         "Your cod
+0000e010: 6520 6d61 7920 7374 6f70 2077 6f72 6b69  e may stop worki
+0000e020: 6e67 2069 6e20 6120 6675 7475 7265 2072  ng in a future r
+0000e030: 656c 6561 7365 2e22 2e66 6f72 6d61 7428  elease.".format(
+0000e040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e050: 2020 2020 2020 2020 2066 756e 632e 5f5f           func.__
+0000e060: 6d6f 6475 6c65 5f5f 202b 2022 2e22 202b  module__ + "." +
+0000e070: 2066 756e 632e 5f5f 6e61 6d65 5f5f 0a20   func.__name__. 
+0000e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e090: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+0000e0a0: 2020 2020 2020 2020 2020 4675 7475 7265            Future
+0000e0b0: 5761 726e 696e 672c 0a20 2020 2020 2020  Warning,.       
+0000e0c0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000e0d0: 2020 2020 2020 2020 2020 2023 204e 6565             # Nee
+0000e0e0: 6420 746f 2063 6f6e 7665 7274 2074 6f20  d to convert to 
+0000e0f0: 6172 7261 7920 6f62 6a65 6374 2028 652e  array object (e.
+0000e100: 672e 206e 756d 7079 2e6e 6461 7272 6179  g. numpy.ndarray
+0000e110: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+0000e120: 2020 2020 2320 6375 7079 2e6e 6461 7272      # cupy.ndarr
+0000e130: 6179 2920 6173 206e 6565 6465 642c 2073  ay) as needed, s
+0000e140: 6f20 7765 2063 616e 2063 616c 6c20 7468  o we can call th
+0000e150: 6520 4e75 6d50 7920 6675 6e63 7469 6f6e  e NumPy function
+0000e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e170: 2023 2061 6761 696e 2061 6e64 2069 7420   # again and it 
+0000e180: 6765 7473 2074 6865 2063 6861 6e63 6520  gets the chance 
+0000e190: 746f 2064 6973 7061 7463 6820 746f 2074  to dispatch to t
+0000e1a0: 6865 2072 6967 6874 0a20 2020 2020 2020  he right.       
+0000e1b0: 2020 2020 2020 2020 2023 2069 6d70 6c65           # imple
+0000e1c0: 6d65 6e74 6174 696f 6e2e 0a20 2020 2020  mentation..     
+0000e1d0: 2020 2020 2020 2020 2020 2061 7267 732c             args,
+0000e1e0: 206b 7761 7267 7320 3d20 636f 6d70 7574   kwargs = comput
+0000e1f0: 6528 6172 6773 2c20 6b77 6172 6773 290a  e(args, kwargs).
+0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e210: 7265 7475 726e 2066 756e 6328 2a61 7267  return func(*arg
+0000e220: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
+0000e230: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e240: 205f 4841 4e44 4c45 445f 4655 4e43 5449   _HANDLED_FUNCTI
+0000e250: 4f4e 535b 6675 6e63 5d28 2a61 7267 732c  ONS[func](*args,
+0000e260: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0000e270: 2020 2020 2320 4669 7273 742c 2076 6572      # First, ver
+0000e280: 6966 7920 7468 6174 2061 6c6c 2074 7970  ify that all typ
+0000e290: 6573 2061 7265 2068 616e 646c 6564 2062  es are handled b
+0000e2a0: 7920 4461 736b 2e20 4f74 6865 7277 6973  y Dask. Otherwis
+0000e2b0: 652c 2072 6574 7572 6e20 4e6f 7449 6d70  e, return NotImp
+0000e2c0: 6c65 6d65 6e74 6564 2e0a 2020 2020 2020  lemented..      
+0000e2d0: 2020 6966 206e 6f74 2061 6c6c 280a 2020    if not all(.  
+0000e2e0: 2020 2020 2020 2020 2020 2320 4163 6365            # Acce
+0000e2f0: 7074 206f 7572 206f 776e 2073 7570 6572  pt our own super
+0000e300: 636c 6173 7365 7320 6173 2072 6563 6f6d  classes as recom
+0000e310: 6d65 6e64 6564 2062 7920 4e45 502d 3133  mended by NEP-13
+0000e320: 0a20 2020 2020 2020 2020 2020 2023 2028  .            # (
+0000e330: 6874 7470 733a 2f2f 6e75 6d70 792e 6f72  https://numpy.or
+0000e340: 672f 6e65 7073 2f6e 6570 2d30 3031 332d  g/neps/nep-0013-
+0000e350: 7566 756e 632d 6f76 6572 7269 6465 732e  ufunc-overrides.
+0000e360: 6874 6d6c 2373 7562 636c 6173 732d 6869  html#subclass-hi
+0000e370: 6572 6172 6368 6965 7329 0a20 2020 2020  erarchies).     
+0000e380: 2020 2020 2020 2069 7373 7562 636c 6173         issubclas
+0000e390: 7328 7479 7065 2873 656c 6629 2c20 7479  s(type(self), ty
+0000e3a0: 7065 5f29 206f 7220 6973 5f76 616c 6964  pe_) or is_valid
+0000e3b0: 5f63 6875 6e6b 5f74 7970 6528 7479 7065  _chunk_type(type
+0000e3c0: 5f29 0a20 2020 2020 2020 2020 2020 2066  _).            f
+0000e3d0: 6f72 2074 7970 655f 2069 6e20 7479 7065  or type_ in type
+0000e3e0: 730a 2020 2020 2020 2020 293a 0a20 2020  s.        ):.   
+0000e3f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e400: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0a0a  NotImplemented..
+0000e410: 2020 2020 2020 2020 2320 4e6f 7720 7472          # Now tr
+0000e420: 7920 746f 2066 696e 6420 6120 6d61 7463  y to find a matc
+0000e430: 6869 6e67 2066 756e 6374 696f 6e20 6e61  hing function na
+0000e440: 6d65 2e20 2049 6620 7468 6174 2064 6f65  me.  If that doe
+0000e450: 736e 2774 2077 6f72 6b2c 2077 6520 6d61  sn't work, we ma
+0000e460: 790a 2020 2020 2020 2020 2320 6265 2064  y.        # be d
+0000e470: 6561 6c69 6e67 2077 6974 6820 616e 2061  ealing with an a
+0000e480: 6c69 6173 206f 7220 6120 6675 6e63 7469  lias or a functi
+0000e490: 6f6e 2074 6861 7427 7320 7369 6d70 6c79  on that's simply
+0000e4a0: 206e 6f74 2069 6e20 7468 6520 4461 736b   not in the Dask
+0000e4b0: 2041 5049 2e0a 2020 2020 2020 2020 2320   API..        # 
+0000e4c0: 4861 6e64 6c65 2061 6c69 6173 6573 2076  Handle aliases v
+0000e4d0: 6961 2074 6865 205f 4841 4e44 4c45 445f  ia the _HANDLED_
+0000e4e0: 4655 4e43 5449 4f4e 5320 6469 6374 206d  FUNCTIONS dict m
+0000e4f0: 6170 7069 6e67 2c20 616e 6420 7761 726e  apping, and warn
+0000e500: 206f 7468 6572 7769 7365 2e0a 2020 2020   otherwise..    
+0000e510: 2020 2020 666f 7220 7375 626d 6f64 756c      for submodul
+0000e520: 6520 696e 2066 756e 632e 5f5f 6d6f 6475  e in func.__modu
+0000e530: 6c65 5f5f 2e73 706c 6974 2822 2e22 295b  le__.split(".")[
+0000e540: 313a 5d3a 0a20 2020 2020 2020 2020 2020  1:]:.           
+0000e550: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000e560: 2020 2020 2020 6d6f 6475 6c65 203d 2067        module = g
+0000e570: 6574 6174 7472 286d 6f64 756c 652c 2073  etattr(module, s
+0000e580: 7562 6d6f 6475 6c65 290a 2020 2020 2020  ubmodule).      
+0000e590: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
+0000e5a0: 7269 6275 7465 4572 726f 723a 0a20 2020  ributeError:.   
+0000e5b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e5c0: 7572 6e20 6861 6e64 6c65 5f6e 6f6e 6d61  urn handle_nonma
+0000e5d0: 7463 6869 6e67 5f6e 616d 6573 2866 756e  tching_names(fun
+0000e5e0: 632c 2061 7267 732c 206b 7761 7267 7329  c, args, kwargs)
+0000e5f0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000e600: 2068 6173 6174 7472 286d 6f64 756c 652c   hasattr(module,
+0000e610: 2066 756e 632e 5f5f 6e61 6d65 5f5f 293a   func.__name__):
+0000e620: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000e630: 7572 6e20 6861 6e64 6c65 5f6e 6f6e 6d61  urn handle_nonma
+0000e640: 7463 6869 6e67 5f6e 616d 6573 2866 756e  tching_names(fun
+0000e650: 632c 2061 7267 732c 206b 7761 7267 7329  c, args, kwargs)
+0000e660: 0a0a 2020 2020 2020 2020 6461 5f66 756e  ..        da_fun
+0000e670: 6320 3d20 6765 7461 7474 7228 6d6f 6475  c = getattr(modu
+0000e680: 6c65 2c20 6675 6e63 2e5f 5f6e 616d 655f  le, func.__name_
+0000e690: 5f29 0a20 2020 2020 2020 2069 6620 6461  _).        if da
+0000e6a0: 5f66 756e 6320 6973 2066 756e 633a 0a20  _func is func:. 
+0000e6b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e6c0: 6e20 6861 6e64 6c65 5f6e 6f6e 6d61 7463  n handle_nonmatc
+0000e6d0: 6869 6e67 5f6e 616d 6573 2866 756e 632c  hing_names(func,
+0000e6e0: 2061 7267 732c 206b 7761 7267 7329 0a0a   args, kwargs)..
+0000e6f0: 2020 2020 2020 2020 2320 4966 2060 606c          # If ``l
+0000e700: 696b 6560 6020 6973 2063 6f6e 7461 696e  ike`` is contain
+0000e710: 6564 2069 6e20 6060 6461 5f66 756e 6360  ed in ``da_func`
+0000e720: 6027 7320 7369 676e 6174 7572 652c 2061  `'s signature, a
+0000e730: 6464 2060 606c 696b 653d 7365 6c66 6060  dd ``like=self``
+0000e740: 0a20 2020 2020 2020 2023 2074 6f20 7468  .        # to th
+0000e750: 6520 6b77 6172 6773 2064 6963 7469 6f6e  e kwargs diction
+0000e760: 6172 792e 0a20 2020 2020 2020 2069 6620  ary..        if 
+0000e770: 6861 735f 6b65 7977 6f72 6428 6461 5f66  has_keyword(da_f
+0000e780: 756e 632c 2022 6c69 6b65 2229 3a0a 2020  unc, "like"):.  
+0000e790: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0000e7a0: 5b22 6c69 6b65 225d 203d 2073 656c 660a  ["like"] = self.
+0000e7b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e7c0: 6461 5f66 756e 6328 2a61 7267 732c 202a  da_func(*args, *
+0000e7d0: 2a6b 7761 7267 7329 0a0a 2020 2020 4070  *kwargs)..    @p
+0000e7e0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000e7f0: 5f65 6c65 6d77 6973 6528 7365 6c66 293a  _elemwise(self):
+0000e800: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e810: 656c 656d 7769 7365 0a0a 2020 2020 4077  elemwise..    @w
+0000e820: 7261 7073 2873 746f 7265 290a 2020 2020  raps(store).    
+0000e830: 6465 6620 7374 6f72 6528 7365 6c66 2c20  def store(self, 
+0000e840: 7461 7267 6574 2c20 2a2a 6b77 6172 6773  target, **kwargs
+0000e850: 293a 0a20 2020 2020 2020 2072 203d 2073  ):.        r = s
+0000e860: 746f 7265 285b 7365 6c66 5d2c 205b 7461  tore([self], [ta
+0000e870: 7267 6574 5d2c 202a 2a6b 7761 7267 7329  rget], **kwargs)
+0000e880: 0a0a 2020 2020 2020 2020 6966 206b 7761  ..        if kwa
+0000e890: 7267 732e 6765 7428 2272 6574 7572 6e5f  rgs.get("return_
+0000e8a0: 7374 6f72 6564 222c 2046 616c 7365 293a  stored", False):
+0000e8b0: 0a20 2020 2020 2020 2020 2020 2072 203d  .            r =
+0000e8c0: 2072 5b30 5d0a 0a20 2020 2020 2020 2072   r[0]..        r
+0000e8d0: 6574 7572 6e20 720a 0a20 2020 2064 6566  eturn r..    def
+0000e8e0: 2074 6f5f 7376 6728 7365 6c66 2c20 7369   to_svg(self, si
+0000e8f0: 7a65 3d35 3030 293a 0a20 2020 2020 2020  ze=500):.       
+0000e900: 2022 2222 436f 6e76 6572 7420 6368 756e   """Convert chun
+0000e910: 6b73 2066 726f 6d20 4461 736b 2041 7272  ks from Dask Arr
+0000e920: 6179 2069 6e74 6f20 616e 2053 5647 2049  ay into an SVG I
+0000e930: 6d61 6765 0a0a 2020 2020 2020 2020 5061  mage..        Pa
+0000e940: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+0000e950: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0000e960: 2020 2020 6368 756e 6b73 3a20 7475 706c      chunks: tupl
+0000e970: 650a 2020 2020 2020 2020 7369 7a65 3a20  e.        size: 
+0000e980: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+0000e990: 526f 7567 6820 7369 7a65 206f 6620 7468  Rough size of th
+0000e9a0: 6520 696d 6167 650a 0a20 2020 2020 2020  e image..       
+0000e9b0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+0000e9c0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0000e9d0: 2020 203e 3e3e 2078 2e74 6f5f 7376 6728     >>> x.to_svg(
+0000e9e0: 7369 7a65 3d35 3030 2920 2023 2064 6f63  size=500)  # doc
+0000e9f0: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
+0000ea00: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0000ea10: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0000ea20: 2020 2020 2074 6578 743a 2041 6e20 7376       text: An sv
+0000ea30: 6720 7374 7269 6e67 2064 6570 6963 7469  g string depicti
+0000ea40: 6e67 2074 6865 2061 7272 6179 2061 7320  ng the array as 
+0000ea50: 6120 6772 6964 206f 6620 6368 756e 6b73  a grid of chunks
+0000ea60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ea70: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+0000ea80: 7272 6179 2e73 7667 2069 6d70 6f72 7420  rray.svg import 
+0000ea90: 7376 670a 0a20 2020 2020 2020 2072 6574  svg..        ret
+0000eaa0: 7572 6e20 7376 6728 7365 6c66 2e63 6875  urn svg(self.chu
+0000eab0: 6e6b 732c 2073 697a 653d 7369 7a65 290a  nks, size=size).
+0000eac0: 0a20 2020 2064 6566 2074 6f5f 6864 6635  .    def to_hdf5
+0000ead0: 2873 656c 662c 2066 696c 656e 616d 652c  (self, filename,
+0000eae0: 2064 6174 6170 6174 682c 202a 2a6b 7761   datapath, **kwa
+0000eaf0: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+0000eb00: 2253 746f 7265 2061 7272 6179 2069 6e20  "Store array in 
+0000eb10: 4844 4635 2066 696c 650a 0a20 2020 2020  HDF5 file..     
+0000eb20: 2020 203e 3e3e 2078 2e74 6f5f 6864 6635     >>> x.to_hdf5
+0000eb30: 2827 6d79 6669 6c65 2e68 6466 3527 2c20  ('myfile.hdf5', 
+0000eb40: 272f 7827 2920 2023 2064 6f63 7465 7374  '/x')  # doctest
+0000eb50: 3a20 2b53 4b49 500a 0a20 2020 2020 2020  : +SKIP..       
+0000eb60: 204f 7074 696f 6e61 6c6c 7920 7072 6f76   Optionally prov
+0000eb70: 6964 6520 6172 6775 6d65 6e74 7320 6173  ide arguments as
+0000eb80: 2074 686f 7567 6820 746f 2060 6068 3570   though to ``h5p
+0000eb90: 792e 4669 6c65 2e63 7265 6174 655f 6461  y.File.create_da
+0000eba0: 7461 7365 7460 600a 0a20 2020 2020 2020  taset``..       
+0000ebb0: 203e 3e3e 2078 2e74 6f5f 6864 6635 2827   >>> x.to_hdf5('
+0000ebc0: 6d79 6669 6c65 2e68 6466 3527 2c20 272f  myfile.hdf5', '/
+0000ebd0: 7827 2c20 636f 6d70 7265 7373 696f 6e3d  x', compression=
+0000ebe0: 276c 7a66 272c 2073 6875 6666 6c65 3d54  'lzf', shuffle=T
+0000ebf0: 7275 6529 2020 2320 646f 6374 6573 743a  rue)  # doctest:
+0000ec00: 202b 534b 4950 0a0a 2020 2020 2020 2020   +SKIP..        
+0000ec10: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+0000ec20: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+0000ec30: 2020 6461 736b 2e61 7272 6179 2e73 746f    dask.array.sto
+0000ec40: 7265 0a20 2020 2020 2020 2068 3570 792e  re.        h5py.
+0000ec50: 4669 6c65 2e63 7265 6174 655f 6461 7461  File.create_data
+0000ec60: 7365 740a 2020 2020 2020 2020 2222 220a  set.        """.
+0000ec70: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0000ec80: 6f5f 6864 6635 2866 696c 656e 616d 652c  o_hdf5(filename,
+0000ec90: 2064 6174 6170 6174 682c 2073 656c 662c   datapath, self,
+0000eca0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+0000ecb0: 6465 6620 746f 5f64 6173 6b5f 6461 7461  def to_dask_data
+0000ecc0: 6672 616d 6528 7365 6c66 2c20 636f 6c75  frame(self, colu
+0000ecd0: 6d6e 733d 4e6f 6e65 2c20 696e 6465 783d  mns=None, index=
+0000ece0: 4e6f 6e65 2c20 6d65 7461 3d4e 6f6e 6529  None, meta=None)
+0000ecf0: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+0000ed00: 7665 7274 2064 6173 6b20 4172 7261 7920  vert dask Array 
+0000ed10: 746f 2064 6173 6b20 4461 7461 6672 616d  to dask Datafram
+0000ed20: 650a 0a20 2020 2020 2020 2050 6172 616d  e..        Param
+0000ed30: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0000ed40: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0000ed50: 2063 6f6c 756d 6e73 3a20 6c69 7374 206f   columns: list o
+0000ed60: 7220 7374 7269 6e67 0a20 2020 2020 2020  r string.       
+0000ed70: 2020 2020 206c 6973 7420 6f66 2063 6f6c       list of col
+0000ed80: 756d 6e20 6e61 6d65 7320 6966 2044 6174  umn names if Dat
+0000ed90: 6146 7261 6d65 2c20 7369 6e67 6c65 2073  aFrame, single s
+0000eda0: 7472 696e 6720 6966 2053 6572 6965 730a  tring if Series.
+0000edb0: 2020 2020 2020 2020 696e 6465 7820 3a20          index : 
+0000edc0: 6461 736b 2e64 6174 6166 7261 6d65 2e49  dask.dataframe.I
+0000edd0: 6e64 6578 2c20 6f70 7469 6f6e 616c 0a20  ndex, optional. 
+0000ede0: 2020 2020 2020 2020 2020 2041 6e20 6f70             An op
+0000edf0: 7469 6f6e 616c 202a 6461 736b 2a20 496e  tional *dask* In
+0000ee00: 6465 7820 746f 2075 7365 2066 6f72 2074  dex to use for t
+0000ee10: 6865 206f 7574 7075 7420 5365 7269 6573  he output Series
+0000ee20: 206f 7220 4461 7461 4672 616d 652e 0a0a   or DataFrame...
+0000ee30: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0000ee40: 6465 6661 756c 7420 6f75 7470 7574 2069  default output i
+0000ee50: 6e64 6578 2064 6570 656e 6473 206f 6e20  ndex depends on 
+0000ee60: 7768 6574 6865 7220 7468 6520 6172 7261  whether the arra
+0000ee70: 7920 6861 7320 616e 7920 756e 6b6e 6f77  y has any unknow
+0000ee80: 6e0a 2020 2020 2020 2020 2020 2020 6368  n.            ch
+0000ee90: 756e 6b73 2e20 4966 2074 6865 7265 2061  unks. If there a
+0000eea0: 7265 2061 6e79 2075 6e6b 6e6f 776e 2063  re any unknown c
+0000eeb0: 6875 6e6b 732c 2074 6865 206f 7574 7075  hunks, the outpu
+0000eec0: 7420 6861 7320 6060 4e6f 6e65 6060 0a20  t has ``None``. 
+0000eed0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+0000eee0: 6c6c 2074 6865 2064 6976 6973 696f 6e73  ll the divisions
+0000eef0: 2028 6f6e 6520 7065 7220 6368 756e 6b29   (one per chunk)
+0000ef00: 2e20 4966 2061 6c6c 2074 6865 2063 6875  . If all the chu
+0000ef10: 6e6b 7320 6172 6520 6b6e 6f77 6e2c 0a20  nks are known,. 
+0000ef20: 2020 2020 2020 2020 2020 2061 2064 6566             a def
+0000ef30: 6175 6c74 2069 6e64 6578 2077 6974 6820  ault index with 
+0000ef40: 6b6e 6f77 6e20 6469 7673 696f 6e73 2069  known divsions i
+0000ef50: 7320 6372 6561 7465 642e 0a0a 2020 2020  s created...    
+0000ef60: 2020 2020 2020 2020 5370 6563 6966 7969          Specifyi
+0000ef70: 6e67 2060 6069 6e64 6578 6060 2063 616e  ng ``index`` can
+0000ef80: 2062 6520 7573 6566 756c 2069 6620 796f   be useful if yo
+0000ef90: 7527 7265 2063 6f6e 666f 726d 696e 6720  u're conforming 
+0000efa0: 6120 4461 736b 2041 7272 6179 0a20 2020  a Dask Array.   
+0000efb0: 2020 2020 2020 2020 2074 6f20 616e 2065           to an e
+0000efc0: 7869 7374 696e 6720 6461 736b 2053 6572  xisting dask Ser
+0000efd0: 6965 7320 6f72 2044 6174 6146 7261 6d65  ies or DataFrame
+0000efe0: 2c20 616e 6420 796f 7520 776f 756c 6420  , and you would 
+0000eff0: 6c69 6b65 2074 6865 0a20 2020 2020 2020  like the.       
+0000f000: 2020 2020 2069 6e64 6963 6573 2074 6f20       indices to 
+0000f010: 6d61 7463 682e 0a20 2020 2020 2020 206d  match..        m
+0000f020: 6574 6120 3a20 6f62 6a65 6374 2c20 6f70  eta : object, op
+0000f030: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0000f040: 2020 2041 6e20 6f70 7469 6f6e 616c 2060     An optional `
+0000f050: 6d65 7461 6020 7061 7261 6d65 7465 7220  meta` parameter 
+0000f060: 6361 6e20 6265 2070 6173 7365 6420 666f  can be passed fo
+0000f070: 7220 6461 736b 0a20 2020 2020 2020 2020  r dask.         
+0000f080: 2020 2074 6f20 7370 6563 6966 7920 7468     to specify th
+0000f090: 6520 636f 6e63 7265 7465 2064 6174 6166  e concrete dataf
+0000f0a0: 7261 6d65 2074 7970 6520 746f 2075 7365  rame type to use
+0000f0b0: 2066 6f72 2070 6172 7469 7469 6f6e 7320   for partitions 
+0000f0c0: 6f66 0a20 2020 2020 2020 2020 2020 2074  of.            t
+0000f0d0: 6865 2044 6173 6b20 6461 7461 6672 616d  he Dask datafram
+0000f0e0: 652e 2042 7920 6465 6661 756c 742c 2070  e. By default, p
+0000f0f0: 616e 6461 7320 4461 7461 4672 616d 6520  andas DataFrame 
+0000f100: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
+0000f110: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+0000f120: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0000f130: 2020 2020 6461 736b 2e64 6174 6166 7261      dask.datafra
+0000f140: 6d65 2e66 726f 6d5f 6461 736b 5f61 7272  me.from_dask_arr
+0000f150: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
+0000f160: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+0000f170: 2e64 6174 6166 7261 6d65 2069 6d70 6f72  .dataframe impor
+0000f180: 7420 6672 6f6d 5f64 6173 6b5f 6172 7261  t from_dask_arra
+0000f190: 790a 0a20 2020 2020 2020 2072 6574 7572  y..        retur
+0000f1a0: 6e20 6672 6f6d 5f64 6173 6b5f 6172 7261  n from_dask_arra
+0000f1b0: 7928 7365 6c66 2c20 636f 6c75 6d6e 733d  y(self, columns=
+0000f1c0: 636f 6c75 6d6e 732c 2069 6e64 6578 3d69  columns, index=i
+0000f1d0: 6e64 6578 2c20 6d65 7461 3d6d 6574 6129  ndex, meta=meta)
+0000f1e0: 0a0a 2020 2020 6465 6620 746f 5f62 6163  ..    def to_bac
+0000f1f0: 6b65 6e64 2873 656c 662c 2062 6163 6b65  kend(self, backe
+0000f200: 6e64 3a20 7374 7220 7c20 4e6f 6e65 203d  nd: str | None =
+0000f210: 204e 6f6e 652c 202a 2a6b 7761 7267 7329   None, **kwargs)
+0000f220: 3a0a 2020 2020 2020 2020 2222 224d 6f76  :.        """Mov
+0000f230: 6520 746f 2061 206e 6577 2041 7272 6179  e to a new Array
+0000f240: 2062 6163 6b65 6e64 0a0a 2020 2020 2020   backend..      
+0000f250: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000f260: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+0000f270: 2020 2020 2020 2020 6261 636b 656e 6420          backend 
+0000f280: 3a20 7374 722c 204f 7074 696f 6e61 6c0a  : str, Optional.
+0000f290: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0000f2a0: 6e61 6d65 206f 6620 7468 6520 6e65 7720  name of the new 
+0000f2b0: 6261 636b 656e 6420 746f 206d 6f76 6520  backend to move 
+0000f2c0: 746f 2e20 5468 6520 6465 6661 756c 740a  to. The default.
+0000f2d0: 2020 2020 2020 2020 2020 2020 6973 2074              is t
+0000f2e0: 6865 2063 7572 7265 6e74 2022 6172 7261  he current "arra
+0000f2f0: 792e 6261 636b 656e 6422 2063 6f6e 6669  y.backend" confi
+0000f300: 6775 7261 7469 6f6e 2e0a 0a20 2020 2020  guration...     
+0000f310: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+0000f320: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
+0000f330: 2020 2041 7272 6179 0a20 2020 2020 2020     Array.       
+0000f340: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+0000f350: 6d20 6461 736b 2e61 7272 6179 2e63 7265  m dask.array.cre
+0000f360: 6174 696f 6e20 696d 706f 7274 2074 6f5f  ation import to_
+0000f370: 6261 636b 656e 640a 0a20 2020 2020 2020  backend..       
+0000f380: 2072 6574 7572 6e20 746f 5f62 6163 6b65   return to_backe
+0000f390: 6e64 2873 656c 662c 2062 6163 6b65 6e64  nd(self, backend
+0000f3a0: 3d62 6163 6b65 6e64 2c20 2a2a 6b77 6172  =backend, **kwar
+0000f3b0: 6773 290a 0a20 2020 2064 6566 205f 5f62  gs)..    def __b
+0000f3c0: 6f6f 6c5f 5f28 7365 6c66 293a 0a20 2020  ool__(self):.   
+0000f3d0: 2020 2020 2069 6620 7365 6c66 2e73 697a       if self.siz
+0000f3e0: 6520 3e20 313a 0a20 2020 2020 2020 2020  e > 1:.         
+0000f3f0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000f400: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000f410: 2020 2020 2066 2254 6865 2074 7275 7468       f"The truth
+0000f420: 2076 616c 7565 206f 6620 6120 7b73 656c   value of a {sel
+0000f430: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+0000f440: 6d65 5f5f 7d20 6973 2061 6d62 6967 756f  me__} is ambiguo
+0000f450: 7573 2e20 220a 2020 2020 2020 2020 2020  us. ".          
+0000f460: 2020 2020 2020 2255 7365 2061 2e61 6e79        "Use a.any
+0000f470: 2829 206f 7220 612e 616c 6c28 292e 220a  () or a.all().".
+0000f480: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000f490: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f4a0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+0000f4b0: 6f6f 6c28 7365 6c66 2e63 6f6d 7075 7465  ool(self.compute
+0000f4c0: 2829 290a 0a20 2020 205f 5f6e 6f6e 7a65  ())..    __nonze
+0000f4d0: 726f 5f5f 203d 205f 5f62 6f6f 6c5f 5f20  ro__ = __bool__ 
+0000f4e0: 2023 2070 7974 686f 6e20 320a 0a20 2020   # python 2..   
+0000f4f0: 2064 6566 205f 7363 616c 6172 6675 6e63   def _scalarfunc
+0000f500: 2873 656c 662c 2063 6173 745f 7479 7065  (self, cast_type
+0000f510: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+0000f520: 6c66 2e73 697a 6520 3e20 313a 0a20 2020  lf.size > 1:.   
+0000f530: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000f540: 7970 6545 7272 6f72 2822 4f6e 6c79 206c  ypeError("Only l
+0000f550: 656e 6774 682d 3120 6172 7261 7973 2063  ength-1 arrays c
+0000f560: 616e 2062 6520 636f 6e76 6572 7465 6420  an be converted 
+0000f570: 746f 2050 7974 686f 6e20 7363 616c 6172  to Python scalar
+0000f580: 7322 290a 2020 2020 2020 2020 656c 7365  s").        else
+0000f590: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000f5a0: 7475 726e 2063 6173 745f 7479 7065 2873  turn cast_type(s
+0000f5b0: 656c 662e 636f 6d70 7574 6528 292e 6974  elf.compute().it
+0000f5c0: 656d 2829 290a 0a20 2020 2064 6566 205f  em())..    def _
+0000f5d0: 5f69 6e74 5f5f 2873 656c 6629 3a0a 2020  _int__(self):.  
+0000f5e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000f5f0: 662e 5f73 6361 6c61 7266 756e 6328 696e  f._scalarfunc(in
+0000f600: 7429 0a0a 2020 2020 5f5f 6c6f 6e67 5f5f  t)..    __long__
+0000f610: 203d 205f 5f69 6e74 5f5f 2020 2320 7079   = __int__  # py
+0000f620: 7468 6f6e 2032 0a0a 2020 2020 6465 6620  thon 2..    def 
+0000f630: 5f5f 666c 6f61 745f 5f28 7365 6c66 293a  __float__(self):
+0000f640: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f650: 7365 6c66 2e5f 7363 616c 6172 6675 6e63  self._scalarfunc
+0000f660: 2866 6c6f 6174 290a 0a20 2020 2064 6566  (float)..    def
+0000f670: 205f 5f63 6f6d 706c 6578 5f5f 2873 656c   __complex__(sel
+0000f680: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0000f690: 726e 2073 656c 662e 5f73 6361 6c61 7266  rn self._scalarf
+0000f6a0: 756e 6328 636f 6d70 6c65 7829 0a0a 2020  unc(complex)..  
+0000f6b0: 2020 6465 6620 5f5f 696e 6465 785f 5f28    def __index__(
+0000f6c0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0000f6d0: 6574 7572 6e20 7365 6c66 2e5f 7363 616c  eturn self._scal
+0000f6e0: 6172 6675 6e63 286f 7065 7261 746f 722e  arfunc(operator.
+0000f6f0: 696e 6465 7829 0a0a 2020 2020 6465 6620  index)..    def 
+0000f700: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
+0000f710: 2c20 6b65 792c 2076 616c 7565 293a 0a20  , key, value):. 
+0000f720: 2020 2020 2020 2069 6620 7661 6c75 6520         if value 
+0000f730: 6973 206e 702e 6d61 2e6d 6173 6b65 643a  is np.ma.masked:
+0000f740: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+0000f750: 7565 203d 206e 702e 6d61 2e6d 6173 6b65  ue = np.ma.maske
+0000f760: 645f 616c 6c28 2829 2c20 6474 7970 653d  d_all((), dtype=
+0000f770: 7365 6c66 2e64 7479 7065 290a 0a20 2020  self.dtype)..   
+0000f780: 2020 2020 2069 6620 6e6f 7420 6973 5f64       if not is_d
+0000f790: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2876  ask_collection(v
+0000f7a0: 616c 7565 2920 616e 6420 6e70 2e69 736e  alue) and np.isn
+0000f7b0: 616e 2876 616c 7565 292e 616e 7928 293a  an(value).any():
+0000f7c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f7d0: 6973 7375 6263 6c61 7373 2873 656c 662e  issubclass(self.
+0000f7e0: 6474 7970 652e 7479 7065 2c20 496e 7465  dtype.type, Inte
+0000f7f0: 6772 616c 293a 0a20 2020 2020 2020 2020  gral):.         
+0000f800: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000f810: 7565 4572 726f 7228 2263 616e 6e6f 7420  ueError("cannot 
+0000f820: 636f 6e76 6572 7420 666c 6f61 7420 4e61  convert float Na
+0000f830: 4e20 746f 2069 6e74 6567 6572 2229 0a0a  N to integer")..
+0000f840: 2020 2020 2020 2020 2323 2055 7365 2074          ## Use t
+0000f850: 6865 2022 7768 6572 6522 206d 6574 686f  he "where" metho
+0000f860: 6420 666f 7220 6361 7365 7320 7768 656e  d for cases when
+0000f870: 206b 6579 2069 7320 616e 2041 7272 6179   key is an Array
+0000f880: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0000f890: 7374 616e 6365 286b 6579 2c20 4172 7261  stance(key, Arra
+0000f8a0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+0000f8b0: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+0000f8c0: 726f 7574 696e 6573 2069 6d70 6f72 7420  routines import 
+0000f8d0: 7768 6572 650a 0a20 2020 2020 2020 2020  where..         
+0000f8e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000f8f0: 2876 616c 7565 2c20 4172 7261 7929 2061  (value, Array) a
+0000f900: 6e64 2076 616c 7565 2e6e 6469 6d20 3e20  nd value.ndim > 
+0000f910: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+0000f920: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000f930: 726f 7228 2262 6f6f 6c65 616e 2069 6e64  ror("boolean ind
+0000f940: 6578 2061 7272 6179 2073 686f 756c 6420  ex array should 
+0000f950: 6861 7665 2031 2064 696d 656e 7369 6f6e  have 1 dimension
+0000f960: 2229 0a20 2020 2020 2020 2020 2020 2074  ").            t
+0000f970: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000f980: 2020 2020 7920 3d20 7768 6572 6528 6b65      y = where(ke
+0000f990: 792c 2076 616c 7565 2c20 7365 6c66 290a  y, value, self).
+0000f9a0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000f9b0: 7074 2056 616c 7565 4572 726f 7220 6173  pt ValueError as
+0000f9c0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000f9d0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000f9e0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000f9f0: 2020 2020 2020 2020 2020 2242 6f6f 6c65            "Boole
+0000fa00: 616e 2069 6e64 6578 2061 7373 6967 6e6d  an index assignm
+0000fa10: 656e 7420 696e 2044 6173 6b20 220a 2020  ent in Dask ".  
+0000fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa30: 2020 2265 7870 6563 7473 2065 7175 616c    "expects equal
+0000fa40: 6c79 2073 6861 7065 6420 6172 7261 7973  ly shaped arrays
+0000fa50: 2e5c 6e45 7861 6d70 6c65 3a20 6461 315b  .\nExample: da1[
+0000fa60: 6461 325d 203d 2064 6133 2022 0a20 2020  da2] = da3 ".   
+0000fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa80: 2022 7768 6572 6520 6461 312e 7368 6170   "where da1.shap
+0000fa90: 6520 3d3d 2028 342c 292c 2064 6132 2e73  e == (4,), da2.s
+0000faa0: 6861 7065 203d 3d20 2834 2c29 2022 0a20  hape == (4,) ". 
+0000fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fac0: 2020 2022 616e 6420 6461 332e 7368 6170     "and da3.shap
+0000fad0: 6520 3d3d 2028 342c 292e 5c6e 220a 2020  e == (4,).\n".  
+0000fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000faf0: 2020 2241 6c74 6572 6e61 7469 7665 6c79    "Alternatively
+0000fb00: 2c20 796f 7520 6361 6e20 7573 6520 7468  , you can use th
+0000fb10: 6520 6578 7465 6e64 6564 2041 5049 2074  e extended API t
+0000fb20: 6861 7420 7375 7070 6f72 7473 220a 2020  hat supports".  
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 2020 2269 6e64 6578 696e 6720 7769 7468    "indexing with
+0000fb50: 2074 7570 6c65 732e 5c6e 4578 616d 706c   tuples.\nExampl
+0000fb60: 653a 2064 6131 5b28 6461 322c 295d 203d  e: da1[(da2,)] =
+0000fb70: 2064 6133 2e22 0a20 2020 2020 2020 2020   da3.".         
+0000fb80: 2020 2020 2020 2029 2066 726f 6d20 650a         ) from e.
+0000fb90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fba0: 2e5f 6d65 7461 203d 2079 2e5f 6d65 7461  ._meta = y._meta
+0000fbb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000fbc0: 662e 6461 736b 203d 2079 2e64 6173 6b0a  f.dask = y.dask.
+0000fbd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fbe0: 2e5f 6e61 6d65 203d 2079 2e6e 616d 650a  ._name = y.name.
+0000fbf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fc00: 2e5f 6368 756e 6b73 203d 2079 2e63 6875  ._chunks = y.chu
+0000fc10: 6e6b 730a 2020 2020 2020 2020 2020 2020  nks.            
+0000fc20: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+0000fc30: 6966 206e 702e 6973 6e61 6e28 7365 6c66  if np.isnan(self
+0000fc40: 2e73 6861 7065 292e 616e 7928 293a 0a20  .shape).any():. 
+0000fc50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000fc60: 2056 616c 7565 4572 726f 7228 6622 4172   ValueError(f"Ar
+0000fc70: 7261 7973 2063 6875 6e6b 2073 697a 6573  rays chunk sizes
+0000fc80: 2061 7265 2075 6e6b 6e6f 776e 2e20 7b75   are unknown. {u
+0000fc90: 6e6b 6e6f 776e 5f63 6875 6e6b 5f6d 6573  nknown_chunk_mes
+0000fca0: 7361 6765 7d22 290a 0a20 2020 2020 2020  sage}")..       
+0000fcb0: 2023 2053 7469 6c6c 2068 6572 653f 2054   # Still here? T
+0000fcc0: 6865 6e20 6170 706c 7920 7468 6520 6173  hen apply the as
+0000fcd0: 7369 676e 6d65 6e74 2074 6f20 6f74 6865  signment to othe
+0000fce0: 7220 7479 7065 206f 660a 2020 2020 2020  r type of.      
+0000fcf0: 2020 2320 696e 6469 6365 7320 7669 6120    # indices via 
+0000fd00: 7468 6520 6073 6574 6974 656d 5f61 7272  the `setitem_arr
+0000fd10: 6179 6020 6675 6e63 7469 6f6e 2e0a 2020  ay` function..  
+0000fd20: 2020 2020 2020 7661 6c75 6520 3d20 6173        value = as
+0000fd30: 616e 7961 7272 6179 2876 616c 7565 290a  anyarray(value).
+0000fd40: 0a20 2020 2020 2020 206f 7574 203d 2022  .        out = "
+0000fd50: 7365 7469 7465 6d2d 2220 2b20 746f 6b65  setitem-" + toke
+0000fd60: 6e69 7a65 2873 656c 662c 206b 6579 2c20  nize(self, key, 
+0000fd70: 7661 6c75 6529 0a20 2020 2020 2020 2064  value).        d
+0000fd80: 736b 203d 2073 6574 6974 656d 5f61 7272  sk = setitem_arr
+0000fd90: 6179 286f 7574 2c20 7365 6c66 2c20 6b65  ay(out, self, ke
+0000fda0: 792c 2076 616c 7565 290a 0a20 2020 2020  y, value)..     
+0000fdb0: 2020 206d 6574 6120 3d20 6d65 7461 5f66     meta = meta_f
+0000fdc0: 726f 6d5f 6172 7261 7928 7365 6c66 2e5f  rom_array(self._
+0000fdd0: 6d65 7461 290a 2020 2020 2020 2020 6966  meta).        if
+0000fde0: 206e 702e 6973 7363 616c 6172 286d 6574   np.isscalar(met
+0000fdf0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+0000fe00: 6d65 7461 203d 206e 702e 6172 7261 7928  meta = np.array(
+0000fe10: 6d65 7461 290a 0a20 2020 2020 2020 2067  meta)..        g
+0000fe20: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
+0000fe30: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
+0000fe40: 6374 696f 6e73 286f 7574 2c20 6473 6b2c  ctions(out, dsk,
+0000fe50: 2064 6570 656e 6465 6e63 6965 733d 5b73   dependencies=[s
+0000fe60: 656c 665d 290a 2020 2020 2020 2020 7920  elf]).        y 
+0000fe70: 3d20 4172 7261 7928 6772 6170 682c 206f  = Array(graph, o
+0000fe80: 7574 2c20 6368 756e 6b73 3d73 656c 662e  ut, chunks=self.
+0000fe90: 6368 756e 6b73 2c20 6474 7970 653d 7365  chunks, dtype=se
+0000fea0: 6c66 2e64 7479 7065 2c20 6d65 7461 3d6d  lf.dtype, meta=m
+0000feb0: 6574 6129 0a0a 2020 2020 2020 2020 7365  eta)..        se
+0000fec0: 6c66 2e5f 6d65 7461 203d 2079 2e5f 6d65  lf._meta = y._me
+0000fed0: 7461 0a20 2020 2020 2020 2073 656c 662e  ta.        self.
+0000fee0: 6461 736b 203d 2079 2e64 6173 6b0a 2020  dask = y.dask.  
+0000fef0: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
+0000ff00: 203d 2079 2e6e 616d 650a 2020 2020 2020   = y.name.      
+0000ff10: 2020 7365 6c66 2e5f 6368 756e 6b73 203d    self._chunks =
+0000ff20: 2079 2e63 6875 6e6b 730a 0a20 2020 2064   y.chunks..    d
+0000ff30: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+0000ff40: 656c 662c 2069 6e64 6578 293a 0a20 2020  elf, index):.   
+0000ff50: 2020 2020 2023 2046 6965 6c64 2061 6363       # Field acc
+0000ff60: 6573 732c 2065 2e67 2e20 785b 2761 275d  ess, e.g. x['a']
+0000ff70: 206f 7220 785b 5b27 6127 2c20 2762 275d   or x[['a', 'b']
+0000ff80: 5d0a 2020 2020 2020 2020 6966 2069 7369  ].        if isi
+0000ff90: 6e73 7461 6e63 6528 696e 6465 782c 2073  nstance(index, s
+0000ffa0: 7472 2920 6f72 2028 0a20 2020 2020 2020  tr) or (.       
+0000ffb0: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
+0000ffc0: 696e 6465 782c 206c 6973 7429 2061 6e64  index, list) and
+0000ffd0: 2069 6e64 6578 2061 6e64 2061 6c6c 2869   index and all(i
+0000ffe0: 7369 6e73 7461 6e63 6528 692c 2073 7472  sinstance(i, str
+0000fff0: 2920 666f 7220 6920 696e 2069 6e64 6578  ) for i in index
+00010000: 290a 2020 2020 2020 2020 293a 0a20 2020  ).        ):.   
+00010010: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00010020: 7374 616e 6365 2869 6e64 6578 2c20 7374  stance(index, st
+00010030: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00010040: 2020 2020 6474 203d 2073 656c 662e 6474      dt = self.dt
+00010050: 7970 655b 696e 6465 785d 0a20 2020 2020  ype[index].     
+00010060: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010070: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+00010080: 3d20 6e70 2e64 7479 7065 280a 2020 2020  = np.dtype(.    
+00010090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100a0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000100b0: 2020 2020 2020 2020 2020 226e 616d 6573            "names
+000100c0: 223a 2069 6e64 6578 2c0a 2020 2020 2020  ": index,.      
+000100d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100e0: 2020 2266 6f72 6d61 7473 223a 205b 7365    "formats": [se
+000100f0: 6c66 2e64 7479 7065 2e66 6965 6c64 735b  lf.dtype.fields[
+00010100: 6e61 6d65 5d5b 305d 2066 6f72 206e 616d  name][0] for nam
+00010110: 6520 696e 2069 6e64 6578 5d2c 0a20 2020  e in index],.   
 00010120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010130: 2020 2020 2020 2022 666f 726d 6174 7322         "formats"
-00010140: 3a20 5b73 656c 662e 6474 7970 652e 6669  : [self.dtype.fi
-00010150: 656c 6473 5b6e 616d 655d 5b30 5d20 666f  elds[name][0] fo
-00010160: 7220 6e61 6d65 2069 6e20 696e 6465 785d  r name in index]
-00010170: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010180: 2020 2020 2020 2020 2020 226f 6666 7365            "offse
-00010190: 7473 223a 205b 7365 6c66 2e64 7479 7065  ts": [self.dtype
-000101a0: 2e66 6965 6c64 735b 6e61 6d65 5d5b 315d  .fields[name][1]
-000101b0: 2066 6f72 206e 616d 6520 696e 2069 6e64   for name in ind
-000101c0: 6578 5d2c 0a20 2020 2020 2020 2020 2020  ex],.           
-000101d0: 2020 2020 2020 2020 2020 2020 2022 6974               "it
-000101e0: 656d 7369 7a65 223a 2073 656c 662e 6474  emsize": self.dt
-000101f0: 7970 652e 6974 656d 7369 7a65 2c0a 2020  ype.itemsize,.  
-00010200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010210: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00010220: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-00010230: 2020 2069 6620 6474 2e73 6861 7065 3a0a     if dt.shape:.
-00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010250: 6e65 775f 6178 6973 203d 206c 6973 7428  new_axis = list(
-00010260: 7261 6e67 6528 7365 6c66 2e6e 6469 6d2c  range(self.ndim,
-00010270: 2073 656c 662e 6e64 696d 202b 206c 656e   self.ndim + len
-00010280: 2864 742e 7368 6170 6529 2929 0a20 2020  (dt.shape))).   
-00010290: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-000102a0: 6e6b 7320 3d20 7365 6c66 2e63 6875 6e6b  nks = self.chunk
-000102b0: 7320 2b20 7475 706c 6528 2869 2c29 2066  s + tuple((i,) f
-000102c0: 6f72 2069 2069 6e20 6474 2e73 6861 7065  or i in dt.shape
-000102d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000102e0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-000102f0: 705f 626c 6f63 6b73 280a 2020 2020 2020  p_blocks(.      
-00010300: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-00010310: 7469 7465 6d2c 2069 6e64 6578 2c20 6474  titem, index, dt
-00010320: 7970 653d 6474 2e62 6173 652c 2063 6875  ype=dt.base, chu
-00010330: 6e6b 733d 6368 756e 6b73 2c20 6e65 775f  nks=chunks, new_
-00010340: 6178 6973 3d6e 6577 5f61 7869 730a 2020  axis=new_axis.  
-00010350: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00010360: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00010370: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010380: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-00010390: 705f 626c 6f63 6b73 2867 6574 6974 656d  p_blocks(getitem
-000103a0: 2c20 696e 6465 782c 2064 7479 7065 3d64  , index, dtype=d
-000103b0: 7429 0a0a 2020 2020 2020 2020 6966 206e  t)..        if n
-000103c0: 6f74 2069 7369 6e73 7461 6e63 6528 696e  ot isinstance(in
-000103d0: 6465 782c 2074 7570 6c65 293a 0a20 2020  dex, tuple):.   
-000103e0: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
-000103f0: 2028 696e 6465 782c 290a 0a20 2020 2020   (index,)..     
-00010400: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-00010410: 6179 2e73 6c69 6369 6e67 2069 6d70 6f72  ay.slicing impor
-00010420: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
-00010430: 6e6f 726d 616c 697a 655f 696e 6465 782c  normalize_index,
-00010440: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-00010450: 6365 5f77 6974 685f 626f 6f6c 5f64 6173  ce_with_bool_das
-00010460: 6b5f 6172 7261 792c 0a20 2020 2020 2020  k_array,.       
-00010470: 2020 2020 2073 6c69 6365 5f77 6974 685f       slice_with_
-00010480: 696e 745f 6461 736b 5f61 7272 6179 2c0a  int_dask_array,.
-00010490: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000104a0: 2020 2069 6e64 6578 3220 3d20 6e6f 726d     index2 = norm
-000104b0: 616c 697a 655f 696e 6465 7828 696e 6465  alize_index(inde
-000104c0: 782c 2073 656c 662e 7368 6170 6529 0a20  x, self.shape). 
-000104d0: 2020 2020 2020 2064 6570 656e 6465 6e63         dependenc
-000104e0: 6965 7320 3d20 7b73 656c 662e 6e61 6d65  ies = {self.name
-000104f0: 7d0a 2020 2020 2020 2020 666f 7220 6920  }.        for i 
-00010500: 696e 2069 6e64 6578 323a 0a20 2020 2020  in index2:.     
-00010510: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00010520: 616e 6365 2869 2c20 4172 7261 7929 3a0a  ance(i, Array):.
-00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010540: 6465 7065 6e64 656e 6369 6573 2e61 6464  dependencies.add
-00010550: 2869 2e6e 616d 6529 0a0a 2020 2020 2020  (i.name)..      
-00010560: 2020 6966 2061 6e79 2869 7369 6e73 7461    if any(isinsta
-00010570: 6e63 6528 692c 2041 7272 6179 2920 616e  nce(i, Array) an
-00010580: 6420 692e 6474 7970 652e 6b69 6e64 2069  d i.dtype.kind i
-00010590: 6e20 2269 7522 2066 6f72 2069 2069 6e20  n "iu" for i in 
-000105a0: 696e 6465 7832 293a 0a20 2020 2020 2020  index2):.       
-000105b0: 2020 2020 2073 656c 662c 2069 6e64 6578       self, index
-000105c0: 3220 3d20 736c 6963 655f 7769 7468 5f69  2 = slice_with_i
-000105d0: 6e74 5f64 6173 6b5f 6172 7261 7928 7365  nt_dask_array(se
-000105e0: 6c66 2c20 696e 6465 7832 290a 2020 2020  lf, index2).    
-000105f0: 2020 2020 6966 2061 6e79 2869 7369 6e73      if any(isins
-00010600: 7461 6e63 6528 692c 2041 7272 6179 2920  tance(i, Array) 
-00010610: 616e 6420 692e 6474 7970 6520 3d3d 2062  and i.dtype == b
-00010620: 6f6f 6c20 666f 7220 6920 696e 2069 6e64  ool for i in ind
-00010630: 6578 3229 3a0a 2020 2020 2020 2020 2020  ex2):.          
-00010640: 2020 7365 6c66 2c20 696e 6465 7832 203d    self, index2 =
-00010650: 2073 6c69 6365 5f77 6974 685f 626f 6f6c   slice_with_bool
-00010660: 5f64 6173 6b5f 6172 7261 7928 7365 6c66  _dask_array(self
-00010670: 2c20 696e 6465 7832 290a 0a20 2020 2020  , index2)..     
-00010680: 2020 2069 6620 616c 6c28 6973 696e 7374     if all(isinst
-00010690: 616e 6365 2869 2c20 736c 6963 6529 2061  ance(i, slice) a
-000106a0: 6e64 2069 203d 3d20 736c 6963 6528 4e6f  nd i == slice(No
-000106b0: 6e65 2920 666f 7220 6920 696e 2069 6e64  ne) for i in ind
-000106c0: 6578 3229 3a0a 2020 2020 2020 2020 2020  ex2):.          
-000106d0: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
-000106e0: 2020 2020 2020 206f 7574 203d 2022 6765         out = "ge
-000106f0: 7469 7465 6d2d 2220 2b20 746f 6b65 6e69  titem-" + tokeni
-00010700: 7a65 2873 656c 662c 2069 6e64 6578 3229  ze(self, index2)
-00010710: 0a20 2020 2020 2020 2064 736b 2c20 6368  .        dsk, ch
-00010720: 756e 6b73 203d 2073 6c69 6365 5f61 7272  unks = slice_arr
-00010730: 6179 286f 7574 2c20 7365 6c66 2e6e 616d  ay(out, self.nam
-00010740: 652c 2073 656c 662e 6368 756e 6b73 2c20  e, self.chunks, 
-00010750: 696e 6465 7832 2c20 7365 6c66 2e69 7465  index2, self.ite
-00010760: 6d73 697a 6529 0a0a 2020 2020 2020 2020  msize)..        
-00010770: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
-00010780: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
-00010790: 6563 7469 6f6e 7328 6f75 742c 2064 736b  ections(out, dsk
-000107a0: 2c20 6465 7065 6e64 656e 6369 6573 3d5b  , dependencies=[
-000107b0: 7365 6c66 5d29 0a0a 2020 2020 2020 2020  self])..        
-000107c0: 6d65 7461 203d 206d 6574 615f 6672 6f6d  meta = meta_from
-000107d0: 5f61 7272 6179 2873 656c 662e 5f6d 6574  _array(self._met
-000107e0: 612c 206e 6469 6d3d 6c65 6e28 6368 756e  a, ndim=len(chun
-000107f0: 6b73 2929 0a20 2020 2020 2020 2069 6620  ks)).        if 
-00010800: 6e70 2e69 7373 6361 6c61 7228 6d65 7461  np.isscalar(meta
-00010810: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
-00010820: 6574 6120 3d20 6e70 2e61 7272 6179 286d  eta = np.array(m
-00010830: 6574 6129 0a0a 2020 2020 2020 2020 7265  eta)..        re
-00010840: 7475 726e 2041 7272 6179 2867 7261 7068  turn Array(graph
-00010850: 2c20 6f75 742c 2063 6875 6e6b 732c 206d  , out, chunks, m
-00010860: 6574 613d 6d65 7461 290a 0a20 2020 2064  eta=meta)..    d
-00010870: 6566 205f 7669 6e64 6578 2873 656c 662c  ef _vindex(self,
-00010880: 206b 6579 293a 0a20 2020 2020 2020 2069   key):.        i
-00010890: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-000108a0: 286b 6579 2c20 7475 706c 6529 3a0a 2020  (key, tuple):.  
-000108b0: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-000108c0: 286b 6579 2c29 0a20 2020 2020 2020 2069  (key,).        i
-000108d0: 6620 616e 7928 6b20 6973 204e 6f6e 6520  f any(k is None 
-000108e0: 666f 7220 6b20 696e 206b 6579 293a 0a20  for k in key):. 
-000108f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010900: 2049 6e64 6578 4572 726f 7228 0a20 2020   IndexError(.   
-00010910: 2020 2020 2020 2020 2020 2020 2022 7669               "vi
-00010920: 6e64 6578 2064 6f65 7320 6e6f 7420 7375  ndex does not su
-00010930: 7070 6f72 7420 696e 6465 7869 6e67 2077  pport indexing w
-00010940: 6974 6820 4e6f 6e65 2028 6e70 2e6e 6577  ith None (np.new
-00010950: 6178 6973 292c 2022 0a20 2020 2020 2020  axis), ".       
-00010960: 2020 2020 2020 2020 2022 676f 7420 7b7d           "got {}
-00010970: 222e 666f 726d 6174 286b 6579 290a 2020  ".format(key).  
-00010980: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00010990: 2020 2020 6966 2061 6c6c 2869 7369 6e73      if all(isins
-000109a0: 7461 6e63 6528 6b2c 2073 6c69 6365 2920  tance(k, slice) 
-000109b0: 666f 7220 6b20 696e 206b 6579 293a 0a20  for k in key):. 
-000109c0: 2020 2020 2020 2020 2020 2069 6620 616c             if al
-000109d0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-000109e0: 2020 206b 2e69 6e64 6963 6573 2864 2920     k.indices(d) 
-000109f0: 3d3d 2073 6c69 6365 2830 2c20 6429 2e69  == slice(0, d).i
-00010a00: 6e64 6963 6573 2864 2920 666f 7220 6b2c  ndices(d) for k,
-00010a10: 2064 2069 6e20 7a69 7028 6b65 792c 2073   d in zip(key, s
-00010a20: 656c 662e 7368 6170 6529 0a20 2020 2020  elf.shape).     
-00010a30: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00010a40: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00010a50: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
-00010a60: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
-00010a70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00010a80: 2020 2020 2276 696e 6465 7820 7265 7175      "vindex requ
-00010a90: 6972 6573 2061 7420 6c65 6173 7420 6f6e  ires at least on
-00010aa0: 6520 6e6f 6e2d 736c 6963 6520 746f 2076  e non-slice to v
-00010ab0: 6563 746f 7269 7a65 206f 7665 7220 220a  ectorize over ".
-00010ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ad0: 2277 6865 6e20 7468 6520 736c 6963 6573  "when the slices
-00010ae0: 2061 7265 206e 6f74 206f 7665 7220 7468   are not over th
-00010af0: 6520 656e 7469 7265 2061 7272 6179 2028  e entire array (
-00010b00: 692e 652c 2078 5b3a 5d29 2e20 220a 2020  i.e, x[:]). ".  
-00010b10: 2020 2020 2020 2020 2020 2020 2020 2255                "U
-00010b20: 7365 206e 6f72 6d61 6c20 736c 6963 696e  se normal slicin
-00010b30: 6720 696e 7374 6561 6420 7768 656e 206f  g instead when o
-00010b40: 6e6c 7920 7573 696e 6720 736c 6963 6573  nly using slices
-00010b50: 2e20 476f 743a 207b 7d22 2e66 6f72 6d61  . Got: {}".forma
-00010b60: 7428 6b65 7929 0a20 2020 2020 2020 2020  t(key).         
-00010b70: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00010b80: 6620 616e 7928 6973 5f64 6173 6b5f 636f  f any(is_dask_co
-00010b90: 6c6c 6563 7469 6f6e 286b 2920 666f 7220  llection(k) for 
-00010ba0: 6b20 696e 206b 6579 293a 0a20 2020 2020  k in key):.     
-00010bb0: 2020 2020 2020 2072 6169 7365 2049 6e64         raise Ind
-00010bc0: 6578 4572 726f 7228 0a20 2020 2020 2020  exError(.       
-00010bd0: 2020 2020 2020 2020 2022 7669 6e64 6578           "vindex
-00010be0: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-00010bf0: 7420 696e 6465 7869 6e67 2077 6974 6820  t indexing with 
-00010c00: 6461 736b 206f 626a 6563 7473 2e20 4361  dask objects. Ca
-00010c10: 6c6c 2063 6f6d 7075 7465 2022 0a20 2020  ll compute ".   
-00010c20: 2020 2020 2020 2020 2020 2020 2022 6f6e               "on
-00010c30: 2074 6865 2069 6e64 6578 6572 2066 6972   the indexer fir
-00010c40: 7374 2074 6f20 6765 7420 616e 2065 7661  st to get an eva
-00010c50: 6c75 7261 7465 6420 6172 7261 792e 2047  lurated array. G
-00010c60: 6f74 3a20 7b7d 222e 666f 726d 6174 286b  ot: {}".format(k
-00010c70: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
-00010c80: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00010c90: 205f 7669 6e64 6578 2873 656c 662c 202a   _vindex(self, *
-00010ca0: 6b65 7929 0a0a 2020 2020 4070 726f 7065  key)..    @prope
-00010cb0: 7274 790a 2020 2020 6465 6620 7669 6e64  rty.    def vind
-00010cc0: 6578 2873 656c 6629 3a0a 2020 2020 2020  ex(self):.      
-00010cd0: 2020 2222 2256 6563 746f 7269 7a65 6420    """Vectorized 
-00010ce0: 696e 6465 7869 6e67 2077 6974 6820 6272  indexing with br
-00010cf0: 6f61 6463 6173 7469 6e67 2e0a 0a20 2020  oadcasting...   
-00010d00: 2020 2020 2054 6869 7320 6973 2065 7175       This is equ
-00010d10: 6976 616c 656e 7420 746f 206e 756d 7079  ivalent to numpy
-00010d20: 2773 2061 6476 616e 6365 6420 696e 6465  's advanced inde
-00010d30: 7869 6e67 2c20 7573 696e 6720 6172 7261  xing, using arra
-00010d40: 7973 2074 6861 7420 6172 650a 2020 2020  ys that are.    
-00010d50: 2020 2020 6272 6f61 6463 6173 7420 6167      broadcast ag
-00010d60: 6169 6e73 7420 6561 6368 206f 7468 6572  ainst each other
-00010d70: 2e20 5468 6973 2061 6c6c 6f77 7320 666f  . This allows fo
-00010d80: 7220 706f 696e 7477 6973 6520 696e 6465  r pointwise inde
-00010d90: 7869 6e67 3a0a 0a20 2020 2020 2020 203e  xing:..        >
-00010da0: 3e3e 2069 6d70 6f72 7420 6461 736b 2e61  >> import dask.a
-00010db0: 7272 6179 2061 7320 6461 0a20 2020 2020  rray as da.     
-00010dc0: 2020 203e 3e3e 2078 203d 206e 702e 6172     >>> x = np.ar
-00010dd0: 7261 7928 5b5b 312c 2032 2c20 335d 2c20  ray([[1, 2, 3], 
-00010de0: 5b34 2c20 352c 2036 5d2c 205b 372c 2038  [4, 5, 6], [7, 8
-00010df0: 2c20 395d 5d29 0a20 2020 2020 2020 203e  , 9]]).        >
-00010e00: 3e3e 2078 203d 2064 612e 6672 6f6d 5f61  >> x = da.from_a
-00010e10: 7272 6179 2878 2c20 6368 756e 6b73 3d32  rray(x, chunks=2
-00010e20: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
-00010e30: 7669 6e64 6578 5b5b 302c 2031 2c20 325d  vindex[[0, 1, 2]
-00010e40: 2c20 5b30 2c20 312c 2032 5d5d 2e63 6f6d  , [0, 1, 2]].com
-00010e50: 7075 7465 2829 0a20 2020 2020 2020 2061  pute().        a
-00010e60: 7272 6179 285b 312c 2035 2c20 395d 290a  rray([1, 5, 9]).
-00010e70: 0a20 2020 2020 2020 204d 6978 6564 2062  .        Mixed b
-00010e80: 6173 6963 2f61 6476 616e 6365 6420 696e  asic/advanced in
-00010e90: 6465 7869 6e67 2077 6974 6820 736c 6963  dexing with slic
-00010ea0: 6573 2f61 7272 6179 7320 6973 2061 6c73  es/arrays is als
-00010eb0: 6f20 7375 7070 6f72 7465 642e 2054 6865  o supported. The
-00010ec0: 0a20 2020 2020 2020 206f 7264 6572 206f  .        order o
-00010ed0: 6620 6469 6d65 6e73 696f 6e73 2069 6e20  f dimensions in 
-00010ee0: 7468 6520 7265 7375 6c74 2066 6f6c 6c6f  the result follo
-00010ef0: 7773 2074 686f 7365 2070 726f 706f 7365  ws those propose
-00010f00: 6420 666f 720a 2020 2020 2020 2020 606e  d for.        `n
-00010f10: 6461 7272 6179 2e76 696e 6465 7820 3c68  darray.vindex <h
-00010f20: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-00010f30: 6d2f 6e75 6d70 792f 6e75 6d70 792f 7075  m/numpy/numpy/pu
-00010f40: 6c6c 2f36 3235 363e 605f 3a0a 2020 2020  ll/6256>`_:.    
-00010f50: 2020 2020 7468 6520 7375 6273 7061 6365      the subspace
-00010f60: 2073 7061 6e6e 6564 2062 7920 6172 7261   spanned by arra
-00010f70: 7973 2069 7320 666f 6c6c 6f77 6564 2062  ys is followed b
-00010f80: 7920 616c 6c20 736c 6963 6573 2e0a 0a20  y all slices... 
-00010f90: 2020 2020 2020 204e 6f74 653a 2060 6076         Note: ``v
-00010fa0: 696e 6465 7860 6020 7072 6f76 6964 6573  index`` provides
-00010fb0: 206d 6f72 6520 6765 6e65 7261 6c20 6675   more general fu
-00010fc0: 6e63 7469 6f6e 616c 6974 7920 7468 616e  nctionality than
-00010fd0: 2073 7461 6e64 6172 640a 2020 2020 2020   standard.      
-00010fe0: 2020 696e 6465 7869 6e67 2c20 6275 7420    indexing, but 
-00010ff0: 6974 2061 6c73 6f20 6861 7320 6665 7765  it also has fewe
-00011000: 7220 6f70 7469 6d69 7a61 7469 6f6e 7320  r optimizations 
-00011010: 616e 6420 6361 6e20 6265 2073 6967 6e69  and can be signi
-00011020: 6669 6361 6e74 6c79 0a20 2020 2020 2020  ficantly.       
-00011030: 2073 6c6f 7765 722e 0a20 2020 2020 2020   slower..       
-00011040: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00011050: 7572 6e20 496e 6465 7843 616c 6c61 626c  urn IndexCallabl
-00011060: 6528 7365 6c66 2e5f 7669 6e64 6578 290a  e(self._vindex).
-00011070: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00011080: 2020 2064 6566 2062 6c6f 636b 7328 7365     def blocks(se
-00011090: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000110a0: 416e 2061 7272 6179 2d6c 696b 6520 696e  An array-like in
-000110b0: 7465 7266 6163 6520 746f 2074 6865 2062  terface to the b
-000110c0: 6c6f 636b 7320 6f66 2061 6e20 6172 7261  locks of an arra
-000110d0: 792e 0a0a 2020 2020 2020 2020 5468 6973  y...        This
-000110e0: 2072 6574 7572 6e73 2061 2060 6042 6c6f   returns a ``Blo
-000110f0: 636b 7669 6577 6060 206f 626a 6563 7420  ckview`` object 
-00011100: 7468 6174 2070 726f 7669 6465 7320 616e  that provides an
-00011110: 2061 7272 6179 2d6c 696b 6520 696e 7465   array-like inte
-00011120: 7266 6163 650a 2020 2020 2020 2020 746f  rface.        to
-00011130: 2074 6865 2062 6c6f 636b 7320 6f66 2061   the blocks of a
-00011140: 2064 6173 6b20 6172 7261 792e 2020 4e75   dask array.  Nu
-00011150: 6d70 792d 7374 796c 6520 696e 6465 7869  mpy-style indexi
-00011160: 6e67 206f 6620 6120 6060 426c 6f63 6b76  ng of a ``Blockv
-00011170: 6965 7760 6020 6f62 6a65 6374 0a20 2020  iew`` object.   
-00011180: 2020 2020 2072 6574 7572 6e73 2061 2073       returns a s
-00011190: 656c 6563 7469 6f6e 206f 6620 626c 6f63  election of bloc
-000111a0: 6b73 2061 7320 6120 6e65 7720 6461 736b  ks as a new dask
-000111b0: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
-000111c0: 2059 6f75 2063 616e 2069 6e64 6578 2060   You can index `
-000111d0: 6061 7272 6179 2e62 6c6f 636b 7360 6020  `array.blocks`` 
-000111e0: 6c69 6b65 2061 206e 756d 7079 2061 7272  like a numpy arr
-000111f0: 6179 206f 6620 7368 6170 650a 2020 2020  ay of shape.    
-00011200: 2020 2020 6571 7561 6c20 746f 2074 6865      equal to the
-00011210: 206e 756d 6265 7220 6f66 2062 6c6f 636b   number of block
-00011220: 7320 696e 2065 6163 6820 6469 6d65 6e73  s in each dimens
-00011230: 696f 6e2c 2028 6176 6169 6c61 626c 6520  ion, (available 
-00011240: 6173 0a20 2020 2020 2020 2061 7272 6179  as.        array
-00011250: 2e62 6c6f 636b 732e 7369 7a65 292e 2020  .blocks.size).  
-00011260: 5468 6520 6469 6d65 6e73 696f 6e61 6c69  The dimensionali
-00011270: 7479 206f 6620 7468 6520 6f75 7470 7574  ty of the output
-00011280: 2061 7272 6179 206d 6174 6368 6573 0a20   array matches. 
-00011290: 2020 2020 2020 2074 6865 2064 696d 656e         the dimen
-000112a0: 7369 6f6e 206f 6620 7468 6973 2061 7272  sion of this arr
-000112b0: 6179 2c20 6576 656e 2069 6620 696e 7465  ay, even if inte
-000112c0: 6765 7220 696e 6469 6365 7320 6172 6520  ger indices are 
-000112d0: 7061 7373 6564 2e0a 2020 2020 2020 2020  passed..        
-000112e0: 536c 6963 696e 6720 7769 7468 2060 606e  Slicing with ``n
-000112f0: 702e 6e65 7761 7869 7360 6020 6f72 206d  p.newaxis`` or m
-00011300: 756c 7469 706c 6520 6c69 7374 7320 6973  ultiple lists is
-00011310: 206e 6f74 2073 7570 706f 7274 6564 2e0a   not supported..
-00011320: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-00011330: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00011340: 2d2d 0a20 2020 2020 2020 203e 3e3e 2069  --.        >>> i
-00011350: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
-00011360: 2061 7320 6461 0a20 2020 2020 2020 203e   as da.        >
-00011370: 3e3e 2078 203d 2064 612e 6172 616e 6765  >> x = da.arange
-00011380: 2838 2c20 6368 756e 6b73 3d32 290a 2020  (8, chunks=2).  
-00011390: 2020 2020 2020 3e3e 3e20 782e 626c 6f63        >>> x.bloc
-000113a0: 6b73 2e73 6861 7065 2023 2061 6c69 6173  ks.shape # alias
-000113b0: 6573 2078 2e6e 756d 626c 6f63 6b73 0a20  es x.numblocks. 
-000113c0: 2020 2020 2020 2028 342c 290a 2020 2020         (4,).    
-000113d0: 2020 2020 3e3e 3e20 782e 626c 6f63 6b73      >>> x.blocks
-000113e0: 5b30 5d2e 636f 6d70 7574 6528 290a 2020  [0].compute().  
-000113f0: 2020 2020 2020 6172 7261 7928 5b30 2c20        array([0, 
-00011400: 315d 290a 2020 2020 2020 2020 3e3e 3e20  1]).        >>> 
-00011410: 782e 626c 6f63 6b73 5b3a 335d 2e63 6f6d  x.blocks[:3].com
-00011420: 7075 7465 2829 0a20 2020 2020 2020 2061  pute().        a
-00011430: 7272 6179 285b 302c 2031 2c20 322c 2033  rray([0, 1, 2, 3
-00011440: 2c20 342c 2035 5d29 0a20 2020 2020 2020  , 4, 5]).       
-00011450: 203e 3e3e 2078 2e62 6c6f 636b 735b 3a3a   >>> x.blocks[::
-00011460: 325d 2e63 6f6d 7075 7465 2829 0a20 2020  2].compute().   
-00011470: 2020 2020 2061 7272 6179 285b 302c 2031       array([0, 1
-00011480: 2c20 342c 2035 5d29 0a20 2020 2020 2020  , 4, 5]).       
-00011490: 203e 3e3e 2078 2e62 6c6f 636b 735b 5b2d   >>> x.blocks[[-
-000114a0: 312c 2030 5d5d 2e63 6f6d 7075 7465 2829  1, 0]].compute()
-000114b0: 0a20 2020 2020 2020 2061 7272 6179 285b  .        array([
-000114c0: 362c 2037 2c20 302c 2031 5d29 0a20 2020  6, 7, 0, 1]).   
-000114d0: 2020 2020 203e 3e3e 2078 2e62 6c6f 636b       >>> x.block
-000114e0: 732e 7261 7665 6c28 2920 2320 646f 6374  s.ravel() # doct
-000114f0: 6573 743a 202b 4e4f 524d 414c 495a 455f  est: +NORMALIZE_
-00011500: 5748 4954 4553 5041 4345 0a20 2020 2020  WHITESPACE.     
-00011510: 2020 205b 6461 736b 2e61 7272 6179 3c62     [dask.array<b
-00011520: 6c6f 636b 732c 2073 6861 7065 3d28 322c  locks, shape=(2,
-00011530: 292c 2064 7479 7065 3d69 6e74 3634 2c20  ), dtype=int64, 
-00011540: 6368 756e 6b73 697a 653d 2832 2c29 2c20  chunksize=(2,), 
-00011550: 6368 756e 6b74 7970 653d 6e75 6d70 792e  chunktype=numpy.
-00011560: 6e64 6172 7261 793e 2c0a 2020 2020 2020  ndarray>,.      
-00011570: 2020 2064 6173 6b2e 6172 7261 793c 626c     dask.array<bl
-00011580: 6f63 6b73 2c20 7368 6170 653d 2832 2c29  ocks, shape=(2,)
-00011590: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
-000115a0: 6875 6e6b 7369 7a65 3d28 322c 292c 2063  hunksize=(2,), c
-000115b0: 6875 6e6b 7479 7065 3d6e 756d 7079 2e6e  hunktype=numpy.n
-000115c0: 6461 7272 6179 3e2c 0a20 2020 2020 2020  darray>,.       
-000115d0: 2020 6461 736b 2e61 7272 6179 3c62 6c6f    dask.array<blo
-000115e0: 636b 732c 2073 6861 7065 3d28 322c 292c  cks, shape=(2,),
-000115f0: 2064 7479 7065 3d69 6e74 3634 2c20 6368   dtype=int64, ch
-00011600: 756e 6b73 697a 653d 2832 2c29 2c20 6368  unksize=(2,), ch
-00011610: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
-00011620: 6172 7261 793e 2c0a 2020 2020 2020 2020  array>,.        
-00011630: 2064 6173 6b2e 6172 7261 793c 626c 6f63   dask.array<bloc
-00011640: 6b73 2c20 7368 6170 653d 2832 2c29 2c20  ks, shape=(2,), 
-00011650: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
-00011660: 6e6b 7369 7a65 3d28 322c 292c 2063 6875  nksize=(2,), chu
-00011670: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-00011680: 7272 6179 3e5d 0a0a 2020 2020 2020 2020  rray>]..        
-00011690: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000116a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000116b0: 416e 2069 6e73 7461 6e63 6520 6f66 2060  An instance of `
-000116c0: 6064 6173 6b2e 6172 7261 792e 426c 6f63  `dask.array.Bloc
-000116d0: 6b76 6965 7760 600a 2020 2020 2020 2020  kview``.        
-000116e0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-000116f0: 726e 2042 6c6f 636b 5669 6577 2873 656c  rn BlockView(sel
-00011700: 6629 0a0a 2020 2020 4070 726f 7065 7274  f)..    @propert
-00011710: 790a 2020 2020 6465 6620 7061 7274 6974  y.    def partit
-00011720: 696f 6e73 2873 656c 6629 3a0a 2020 2020  ions(self):.    
-00011730: 2020 2020 2222 2253 6c69 6365 2061 6e20      """Slice an 
-00011740: 6172 7261 7920 6279 2070 6172 7469 7469  array by partiti
-00011750: 6f6e 732e 2041 6c69 6173 206f 6620 6461  ons. Alias of da
-00011760: 736b 2061 7272 6179 202e 626c 6f63 6b73  sk array .blocks
-00011770: 2061 7474 7269 6275 7465 2e0a 0a20 2020   attribute...   
-00011780: 2020 2020 2054 6869 7320 616c 6961 7320       This alias 
-00011790: 616c 6c6f 7773 2079 6f75 2074 6f20 7772  allows you to wr
-000117a0: 6974 6520 6167 6e6f 7374 6963 2063 6f64  ite agnostic cod
-000117b0: 6520 7468 6174 2077 6f72 6b73 2077 6974  e that works wit
-000117c0: 6820 626f 7468 0a20 2020 2020 2020 2064  h both.        d
-000117d0: 6173 6b20 6172 7261 7973 2061 6e64 2064  ask arrays and d
-000117e0: 6173 6b20 6461 7461 6672 616d 6573 2e0a  ask dataframes..
-000117f0: 0a20 2020 2020 2020 2054 6869 7320 7265  .        This re
-00011800: 7475 726e 7320 6120 6060 426c 6f63 6b76  turns a ``Blockv
-00011810: 6965 7760 6020 6f62 6a65 6374 2074 6861  iew`` object tha
-00011820: 7420 7072 6f76 6964 6573 2061 6e20 6172  t provides an ar
-00011830: 7261 792d 6c69 6b65 2069 6e74 6572 6661  ray-like interfa
-00011840: 6365 0a20 2020 2020 2020 2074 6f20 7468  ce.        to th
-00011850: 6520 626c 6f63 6b73 206f 6620 6120 6461  e blocks of a da
-00011860: 736b 2061 7272 6179 2e20 204e 756d 7079  sk array.  Numpy
-00011870: 2d73 7479 6c65 2069 6e64 6578 696e 6720  -style indexing 
-00011880: 6f66 2061 2060 6042 6c6f 636b 7669 6577  of a ``Blockview
-00011890: 6060 206f 626a 6563 740a 2020 2020 2020  `` object.      
-000118a0: 2020 7265 7475 726e 7320 6120 7365 6c65    returns a sele
-000118b0: 6374 696f 6e20 6f66 2062 6c6f 636b 7320  ction of blocks 
-000118c0: 6173 2061 206e 6577 2064 6173 6b20 6172  as a new dask ar
-000118d0: 7261 792e 0a0a 2020 2020 2020 2020 596f  ray...        Yo
-000118e0: 7520 6361 6e20 696e 6465 7820 6060 6172  u can index ``ar
-000118f0: 7261 792e 626c 6f63 6b73 6060 206c 696b  ray.blocks`` lik
-00011900: 6520 6120 6e75 6d70 7920 6172 7261 7920  e a numpy array 
-00011910: 6f66 2073 6861 7065 0a20 2020 2020 2020  of shape.       
-00011920: 2065 7175 616c 2074 6f20 7468 6520 6e75   equal to the nu
-00011930: 6d62 6572 206f 6620 626c 6f63 6b73 2069  mber of blocks i
-00011940: 6e20 6561 6368 2064 696d 656e 7369 6f6e  n each dimension
-00011950: 2c20 2861 7661 696c 6162 6c65 2061 730a  , (available as.
-00011960: 2020 2020 2020 2020 6172 7261 792e 626c          array.bl
-00011970: 6f63 6b73 2e73 697a 6529 2e20 2054 6865  ocks.size).  The
-00011980: 2064 696d 656e 7369 6f6e 616c 6974 7920   dimensionality 
-00011990: 6f66 2074 6865 206f 7574 7075 7420 6172  of the output ar
-000119a0: 7261 7920 6d61 7463 6865 730a 2020 2020  ray matches.    
-000119b0: 2020 2020 7468 6520 6469 6d65 6e73 696f      the dimensio
-000119c0: 6e20 6f66 2074 6869 7320 6172 7261 792c  n of this array,
-000119d0: 2065 7665 6e20 6966 2069 6e74 6567 6572   even if integer
-000119e0: 2069 6e64 6963 6573 2061 7265 2070 6173   indices are pas
-000119f0: 7365 642e 0a20 2020 2020 2020 2053 6c69  sed..        Sli
-00011a00: 6369 6e67 2077 6974 6820 6060 6e70 2e6e  cing with ``np.n
-00011a10: 6577 6178 6973 6060 206f 7220 6d75 6c74  ewaxis`` or mult
-00011a20: 6970 6c65 206c 6973 7473 2069 7320 6e6f  iple lists is no
-00011a30: 7420 7375 7070 6f72 7465 642e 0a0a 2020  t supported...  
-00011a40: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
-00011a50: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00011a60: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
-00011a70: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-00011a80: 2064 610a 2020 2020 2020 2020 3e3e 3e20   da.        >>> 
-00011a90: 7820 3d20 6461 2e61 7261 6e67 6528 382c  x = da.arange(8,
-00011aa0: 2063 6875 6e6b 733d 3229 0a20 2020 2020   chunks=2).     
-00011ab0: 2020 203e 3e3e 2078 2e70 6172 7469 7469     >>> x.partiti
-00011ac0: 6f6e 732e 7368 6170 6520 2320 616c 6961  ons.shape # alia
-00011ad0: 7365 7320 782e 6e75 6d62 6c6f 636b 730a  ses x.numblocks.
-00011ae0: 2020 2020 2020 2020 2834 2c29 0a20 2020          (4,).   
-00011af0: 2020 2020 203e 3e3e 2078 2e70 6172 7469       >>> x.parti
-00011b00: 7469 6f6e 735b 305d 2e63 6f6d 7075 7465  tions[0].compute
-00011b10: 2829 0a20 2020 2020 2020 2061 7272 6179  ().        array
-00011b20: 285b 302c 2031 5d29 0a20 2020 2020 2020  ([0, 1]).       
-00011b30: 203e 3e3e 2078 2e70 6172 7469 7469 6f6e   >>> x.partition
-00011b40: 735b 3a33 5d2e 636f 6d70 7574 6528 290a  s[:3].compute().
-00011b50: 2020 2020 2020 2020 6172 7261 7928 5b30          array([0
-00011b60: 2c20 312c 2032 2c20 332c 2034 2c20 355d  , 1, 2, 3, 4, 5]
-00011b70: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
-00011b80: 7061 7274 6974 696f 6e73 5b3a 3a32 5d2e  partitions[::2].
-00011b90: 636f 6d70 7574 6528 290a 2020 2020 2020  compute().      
-00011ba0: 2020 6172 7261 7928 5b30 2c20 312c 2034    array([0, 1, 4
-00011bb0: 2c20 355d 290a 2020 2020 2020 2020 3e3e  , 5]).        >>
-00011bc0: 3e20 782e 7061 7274 6974 696f 6e73 5b5b  > x.partitions[[
-00011bd0: 2d31 2c20 305d 5d2e 636f 6d70 7574 6528  -1, 0]].compute(
-00011be0: 290a 2020 2020 2020 2020 6172 7261 7928  ).        array(
-00011bf0: 5b36 2c20 372c 2030 2c20 315d 290a 2020  [6, 7, 0, 1]).  
-00011c00: 2020 2020 2020 3e3e 3e20 782e 7061 7274        >>> x.part
-00011c10: 6974 696f 6e73 2e72 6176 656c 2829 2023  itions.ravel() #
-00011c20: 2064 6f63 7465 7374 3a20 2b4e 4f52 4d41   doctest: +NORMA
-00011c30: 4c49 5a45 5f57 4849 5445 5350 4143 450a  LIZE_WHITESPACE.
-00011c40: 2020 2020 2020 2020 5b64 6173 6b2e 6172          [dask.ar
-00011c50: 7261 793c 626c 6f63 6b73 2c20 7368 6170  ray<blocks, shap
-00011c60: 653d 2832 2c29 2c20 6474 7970 653d 696e  e=(2,), dtype=in
-00011c70: 7436 342c 2063 6875 6e6b 7369 7a65 3d28  t64, chunksize=(
-00011c80: 322c 292c 2063 6875 6e6b 7479 7065 3d6e  2,), chunktype=n
-00011c90: 756d 7079 2e6e 6461 7272 6179 3e2c 0a20  umpy.ndarray>,. 
-00011ca0: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
-00011cb0: 6179 3c62 6c6f 636b 732c 2073 6861 7065  ay<blocks, shape
-00011cc0: 3d28 322c 292c 2064 7479 7065 3d69 6e74  =(2,), dtype=int
-00011cd0: 3634 2c20 6368 756e 6b73 697a 653d 2832  64, chunksize=(2
-00011ce0: 2c29 2c20 6368 756e 6b74 7970 653d 6e75  ,), chunktype=nu
-00011cf0: 6d70 792e 6e64 6172 7261 793e 2c0a 2020  mpy.ndarray>,.  
-00011d00: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
-00011d10: 793c 626c 6f63 6b73 2c20 7368 6170 653d  y<blocks, shape=
-00011d20: 2832 2c29 2c20 6474 7970 653d 696e 7436  (2,), dtype=int6
-00011d30: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
-00011d40: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
-00011d50: 7079 2e6e 6461 7272 6179 3e2c 0a20 2020  py.ndarray>,.   
-00011d60: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00011d70: 3c62 6c6f 636b 732c 2073 6861 7065 3d28  <blocks, shape=(
-00011d80: 322c 292c 2064 7479 7065 3d69 6e74 3634  2,), dtype=int64
-00011d90: 2c20 6368 756e 6b73 697a 653d 2832 2c29  , chunksize=(2,)
-00011da0: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
-00011db0: 792e 6e64 6172 7261 793e 5d0a 0a20 2020  y.ndarray>]..   
-00011dc0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00011dd0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00011de0: 2020 2020 2041 6e20 696e 7374 616e 6365       An instance
-00011df0: 206f 6620 6060 6461 2e61 7272 6179 2e42   of ``da.array.B
-00011e00: 6c6f 636b 7669 6577 6060 0a20 2020 2020  lockview``.     
-00011e10: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00011e20: 6574 7572 6e20 7365 6c66 2e62 6c6f 636b  eturn self.block
-00011e30: 730a 0a20 2020 2064 6566 2064 6f74 2873  s..    def dot(s
-00011e40: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00011e50: 2020 2020 2022 2222 446f 7420 7072 6f64       """Dot prod
-00011e60: 7563 7420 6f66 2073 656c 6620 616e 6420  uct of self and 
-00011e70: 6f74 6865 722e 0a0a 2020 2020 2020 2020  other...        
-00011e80: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
-00011e90: 6461 736b 2e61 7272 6179 2e74 656e 736f  dask.array.tenso
-00011ea0: 7264 6f74 6020 666f 7220 6675 6c6c 2064  rdot` for full d
-00011eb0: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
-00011ec0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00011ed0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00011ee0: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
-00011ef0: 7261 792e 646f 7420 3a20 6571 7569 7661  ray.dot : equiva
-00011f00: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
-00011f10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011f20: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-00011f30: 792e 726f 7574 696e 6573 2069 6d70 6f72  y.routines impor
-00011f40: 7420 7465 6e73 6f72 646f 740a 0a20 2020  t tensordot..   
-00011f50: 2020 2020 2072 6574 7572 6e20 7465 6e73       return tens
-00011f60: 6f72 646f 7428 7365 6c66 2c20 6f74 6865  ordot(self, othe
-00011f70: 722c 2061 7865 733d 2828 7365 6c66 2e6e  r, axes=((self.n
-00011f80: 6469 6d20 2d20 312c 292c 2028 6f74 6865  dim - 1,), (othe
-00011f90: 722e 6e64 696d 202d 2032 2c29 2929 0a0a  r.ndim - 2,)))..
-00011fa0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00011fb0: 2020 6465 6620 4128 7365 6c66 293a 0a20    def A(self):. 
-00011fc0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00011fd0: 6c66 0a0a 2020 2020 4070 726f 7065 7274  lf..    @propert
-00011fe0: 790a 2020 2020 6465 6620 5428 7365 6c66  y.    def T(self
-00011ff0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00012000: 6e20 7365 6c66 2e74 7261 6e73 706f 7365  n self.transpose
-00012010: 2829 0a0a 2020 2020 6465 6620 7472 616e  ()..    def tran
-00012020: 7370 6f73 6528 7365 6c66 2c20 2a61 7865  spose(self, *axe
-00012030: 7329 3a0a 2020 2020 2020 2020 2222 2252  s):.        """R
-00012040: 6576 6572 7365 206f 7220 7065 726d 7574  everse or permut
-00012050: 6520 7468 6520 6178 6573 206f 6620 616e  e the axes of an
-00012060: 2061 7272 6179 2e20 5265 7475 726e 2074   array. Return t
-00012070: 6865 206d 6f64 6966 6965 6420 6172 7261  he modified arra
-00012080: 792e 0a0a 2020 2020 2020 2020 5265 6665  y...        Refe
-00012090: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
-000120a0: 2e61 7272 6179 2e74 7261 6e73 706f 7365  .array.transpose
-000120b0: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
-000120c0: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
-000120d0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-000120e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-000120f0: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
-00012100: 7472 616e 7370 6f73 6520 3a20 6571 7569  transpose : equi
-00012110: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
-00012120: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012130: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-00012140: 7261 792e 726f 7574 696e 6573 2069 6d70  ray.routines imp
-00012150: 6f72 7420 7472 616e 7370 6f73 650a 0a20  ort transpose.. 
-00012160: 2020 2020 2020 2069 6620 6e6f 7420 6178         if not ax
-00012170: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00012180: 6178 6573 203d 204e 6f6e 650a 2020 2020  axes = None.    
-00012190: 2020 2020 656c 6966 206c 656e 2861 7865      elif len(axe
-000121a0: 7329 203d 3d20 3120 616e 6420 6973 696e  s) == 1 and isin
-000121b0: 7374 616e 6365 2861 7865 735b 305d 2c20  stance(axes[0], 
-000121c0: 4974 6572 6162 6c65 293a 0a20 2020 2020  Iterable):.     
-000121d0: 2020 2020 2020 2061 7865 7320 3d20 6178         axes = ax
-000121e0: 6573 5b30 5d0a 2020 2020 2020 2020 6966  es[0].        if
-000121f0: 2028 6178 6573 203d 3d20 7475 706c 6528   (axes == tuple(
-00012200: 7261 6e67 6528 7365 6c66 2e6e 6469 6d29  range(self.ndim)
-00012210: 2929 206f 7220 2861 7865 7320 3d3d 2074  )) or (axes == t
-00012220: 7570 6c65 2872 616e 6765 282d 7365 6c66  uple(range(-self
-00012230: 2e6e 6469 6d2c 2030 2929 293a 0a20 2020  .ndim, 0))):.   
-00012240: 2020 2020 2020 2020 2023 206e 6f20 7472           # no tr
-00012250: 616e 7370 6f73 6520 6e65 6365 7373 6172  anspose necessar
-00012260: 790a 2020 2020 2020 2020 2020 2020 7265  y.            re
-00012270: 7475 726e 2073 656c 660a 2020 2020 2020  turn self.      
-00012280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012290: 2020 2020 7265 7475 726e 2074 7261 6e73      return trans
-000122a0: 706f 7365 2873 656c 662c 2061 7865 733d  pose(self, axes=
-000122b0: 6178 6573 290a 0a20 2020 2064 6566 2072  axes)..    def r
-000122c0: 6176 656c 2873 656c 6629 3a0a 2020 2020  avel(self):.    
-000122d0: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
-000122e0: 666c 6174 7465 6e65 6420 6172 7261 792e  flattened array.
-000122f0: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-00012300: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
-00012310: 7272 6179 2e72 6176 656c 6020 666f 7220  rray.ravel` for 
-00012320: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
-00012330: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
-00012340: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00012350: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00012360: 6173 6b2e 6172 7261 792e 7261 7665 6c20  ask.array.ravel 
-00012370: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
-00012380: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-00012390: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
-000123a0: 6173 6b2e 6172 7261 792e 726f 7574 696e  ask.array.routin
-000123b0: 6573 2069 6d70 6f72 7420 7261 7665 6c0a  es import ravel.
-000123c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000123d0: 7261 7665 6c28 7365 6c66 290a 0a20 2020  ravel(self)..   
-000123e0: 2066 6c61 7474 656e 203d 2072 6176 656c   flatten = ravel
-000123f0: 0a0a 2020 2020 6465 6620 6368 6f6f 7365  ..    def choose
-00012400: 2873 656c 662c 2063 686f 6963 6573 293a  (self, choices):
-00012410: 0a20 2020 2020 2020 2022 2222 5573 6520  .        """Use 
-00012420: 616e 2069 6e64 6578 2061 7272 6179 2074  an index array t
-00012430: 6f20 636f 6e73 7472 7563 7420 6120 6e65  o construct a ne
-00012440: 7720 6172 7261 7920 6672 6f6d 2061 2073  w array from a s
-00012450: 6574 206f 6620 6368 6f69 6365 732e 0a0a  et of choices...
-00012460: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-00012470: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
-00012480: 6179 2e63 686f 6f73 6560 2066 6f72 2066  ay.choose` for f
-00012490: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
-000124a0: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
-000124b0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-000124c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
-000124d0: 736b 2e61 7272 6179 2e63 686f 6f73 6520  sk.array.choose 
-000124e0: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
-000124f0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-00012500: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
-00012510: 6173 6b2e 6172 7261 792e 726f 7574 696e  ask.array.routin
-00012520: 6573 2069 6d70 6f72 7420 6368 6f6f 7365  es import choose
-00012530: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00012540: 2063 686f 6f73 6528 7365 6c66 2c20 6368   choose(self, ch
-00012550: 6f69 6365 7329 0a0a 2020 2020 6465 6620  oices)..    def 
-00012560: 7265 7368 6170 6528 7365 6c66 2c20 2a73  reshape(self, *s
-00012570: 6861 7065 2c20 6d65 7267 655f 6368 756e  hape, merge_chun
-00012580: 6b73 3d54 7275 652c 206c 696d 6974 3d4e  ks=True, limit=N
-00012590: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-000125a0: 2252 6573 6861 7065 2061 7272 6179 2074  "Reshape array t
-000125b0: 6f20 6e65 7720 7368 6170 650a 0a20 2020  o new shape..   
-000125c0: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
-000125d0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-000125e0: 7265 7368 6170 6560 2066 6f72 2066 756c  reshape` for ful
-000125f0: 6c20 646f 6375 6d65 6e74 6174 696f 6e2e  l documentation.
-00012600: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00012610: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00012620: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
-00012630: 2e61 7272 6179 2e72 6573 6861 7065 203a  .array.reshape :
-00012640: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-00012650: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-00012660: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00012670: 736b 2e61 7272 6179 2e72 6573 6861 7065  sk.array.reshape
-00012680: 2069 6d70 6f72 7420 7265 7368 6170 650a   import reshape.
-00012690: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-000126a0: 7368 6170 6529 203d 3d20 3120 616e 6420  shape) == 1 and 
-000126b0: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-000126c0: 6861 7065 5b30 5d2c 204e 756d 6265 7229  hape[0], Number)
-000126d0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-000126e0: 6170 6520 3d20 7368 6170 655b 305d 0a20  ape = shape[0]. 
-000126f0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00012700: 7368 6170 6528 7365 6c66 2c20 7368 6170  shape(self, shap
-00012710: 652c 206d 6572 6765 5f63 6875 6e6b 733d  e, merge_chunks=
-00012720: 6d65 7267 655f 6368 756e 6b73 2c20 6c69  merge_chunks, li
-00012730: 6d69 743d 6c69 6d69 7429 0a0a 2020 2020  mit=limit)..    
-00012740: 6465 6620 746f 706b 2873 656c 662c 206b  def topk(self, k
-00012750: 2c20 6178 6973 3d2d 312c 2073 706c 6974  , axis=-1, split
-00012760: 5f65 7665 7279 3d4e 6f6e 6529 3a0a 2020  _every=None):.  
-00012770: 2020 2020 2020 2222 2254 6865 2074 6f70        """The top
-00012780: 206b 2065 6c65 6d65 6e74 7320 6f66 2061   k elements of a
-00012790: 6e20 6172 7261 792e 0a0a 2020 2020 2020  n array...      
-000127a0: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
-000127b0: 3a60 6461 736b 2e61 7272 6179 2e74 6f70  :`dask.array.top
-000127c0: 6b60 2066 6f72 2066 756c 6c20 646f 6375  k` for full docu
-000127d0: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-000127e0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-000127f0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00012800: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00012810: 2e74 6f70 6b20 3a20 6571 7569 7661 6c65  .topk : equivale
-00012820: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
-00012830: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00012840: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-00012850: 7265 6475 6374 696f 6e73 2069 6d70 6f72  reductions impor
-00012860: 7420 746f 706b 0a0a 2020 2020 2020 2020  t topk..        
-00012870: 7265 7475 726e 2074 6f70 6b28 7365 6c66  return topk(self
-00012880: 2c20 6b2c 2061 7869 733d 6178 6973 2c20  , k, axis=axis, 
-00012890: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-000128a0: 745f 6576 6572 7929 0a0a 2020 2020 6465  t_every)..    de
-000128b0: 6620 6172 6774 6f70 6b28 7365 6c66 2c20  f argtopk(self, 
-000128c0: 6b2c 2061 7869 733d 2d31 2c20 7370 6c69  k, axis=-1, spli
-000128d0: 745f 6576 6572 793d 4e6f 6e65 293a 0a20  t_every=None):. 
-000128e0: 2020 2020 2020 2022 2222 5468 6520 696e         """The in
-000128f0: 6469 6365 7320 6f66 2074 6865 2074 6f70  dices of the top
-00012900: 206b 2065 6c65 6d65 6e74 7320 6f66 2061   k elements of a
-00012910: 6e20 6172 7261 792e 0a0a 2020 2020 2020  n array...      
-00012920: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
-00012930: 3a60 6461 736b 2e61 7272 6179 2e61 7267  :`dask.array.arg
-00012940: 746f 706b 6020 666f 7220 6675 6c6c 2064  topk` for full d
-00012950: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
-00012960: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00012970: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012980: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
-00012990: 7261 792e 6172 6774 6f70 6b20 3a20 6571  ray.argtopk : eq
-000129a0: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
-000129b0: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-000129c0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-000129d0: 6172 7261 792e 7265 6475 6374 696f 6e73  array.reductions
-000129e0: 2069 6d70 6f72 7420 6172 6774 6f70 6b0a   import argtopk.
-000129f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012a00: 6172 6774 6f70 6b28 7365 6c66 2c20 6b2c  argtopk(self, k,
-00012a10: 2061 7869 733d 6178 6973 2c20 7370 6c69   axis=axis, spli
-00012a20: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-00012a30: 6572 7929 0a0a 2020 2020 6465 6620 6173  ery)..    def as
-00012a40: 7479 7065 2873 656c 662c 2064 7479 7065  type(self, dtype
-00012a50: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00012a60: 2020 2020 2022 2222 436f 7079 206f 6620       """Copy of 
-00012a70: 7468 6520 6172 7261 792c 2063 6173 7420  the array, cast 
-00012a80: 746f 2061 2073 7065 6369 6669 6564 2074  to a specified t
-00012a90: 7970 652e 0a0a 2020 2020 2020 2020 5061  ype...        Pa
-00012aa0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00012ab0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00012ac0: 2020 2020 6474 7970 6520 3a20 7374 7220      dtype : str 
-00012ad0: 6f72 2064 7479 7065 0a20 2020 2020 2020  or dtype.       
-00012ae0: 2020 2020 2054 7970 6563 6f64 6520 6f72       Typecode or
-00012af0: 2064 6174 612d 7479 7065 2074 6f20 7768   data-type to wh
-00012b00: 6963 6820 7468 6520 6172 7261 7920 6973  ich the array is
-00012b10: 2063 6173 742e 0a20 2020 2020 2020 2063   cast..        c
-00012b20: 6173 7469 6e67 203a 207b 276e 6f27 2c20  asting : {'no', 
-00012b30: 2765 7175 6976 272c 2027 7361 6665 272c  'equiv', 'safe',
-00012b40: 2027 7361 6d65 5f6b 696e 6427 2c20 2775   'same_kind', 'u
-00012b50: 6e73 6166 6527 7d2c 206f 7074 696f 6e61  nsafe'}, optiona
-00012b60: 6c0a 2020 2020 2020 2020 2020 2020 436f  l.            Co
-00012b70: 6e74 726f 6c73 2077 6861 7420 6b69 6e64  ntrols what kind
-00012b80: 206f 6620 6461 7461 2063 6173 7469 6e67   of data casting
-00012b90: 206d 6179 206f 6363 7572 2e20 4465 6661   may occur. Defa
-00012ba0: 756c 7473 2074 6f20 2775 6e73 6166 6527  ults to 'unsafe'
-00012bb0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00012bc0: 2062 6163 6b77 6172 6473 2063 6f6d 7061   backwards compa
-00012bd0: 7469 6269 6c69 7479 2e0a 0a20 2020 2020  tibility...     
-00012be0: 2020 2020 2020 202a 2027 6e6f 2720 6d65         * 'no' me
-00012bf0: 616e 7320 7468 6520 6461 7461 2074 7970  ans the data typ
-00012c00: 6573 2073 686f 756c 6420 6e6f 7420 6265  es should not be
-00012c10: 2063 6173 7420 6174 2061 6c6c 2e0a 2020   cast at all..  
-00012c20: 2020 2020 2020 2020 2020 2a20 2765 7175            * 'equ
-00012c30: 6976 2720 6d65 616e 7320 6f6e 6c79 2062  iv' means only b
-00012c40: 7974 652d 6f72 6465 7220 6368 616e 6765  yte-order change
-00012c50: 7320 6172 6520 616c 6c6f 7765 642e 0a20  s are allowed.. 
-00012c60: 2020 2020 2020 2020 2020 202a 2027 7361             * 'sa
-00012c70: 6665 2720 6d65 616e 7320 6f6e 6c79 2063  fe' means only c
-00012c80: 6173 7473 2077 6869 6368 2063 616e 2070  asts which can p
-00012c90: 7265 7365 7276 6520 7661 6c75 6573 2061  reserve values a
-00012ca0: 7265 2061 6c6c 6f77 6564 2e0a 2020 2020  re allowed..    
-00012cb0: 2020 2020 2020 2020 2a20 2773 616d 655f          * 'same_
-00012cc0: 6b69 6e64 2720 6d65 616e 7320 6f6e 6c79  kind' means only
-00012cd0: 2073 6166 6520 6361 7374 7320 6f72 2063   safe casts or c
-00012ce0: 6173 7473 2077 6974 6869 6e20 6120 6b69  asts within a ki
-00012cf0: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
-00012d00: 2020 2020 6c69 6b65 2066 6c6f 6174 3634      like float64
-00012d10: 2074 6f20 666c 6f61 7433 322c 2061 7265   to float32, are
-00012d20: 2061 6c6c 6f77 6564 2e0a 2020 2020 2020   allowed..      
-00012d30: 2020 2020 2020 2a20 2775 6e73 6166 6527        * 'unsafe'
-00012d40: 206d 6561 6e73 2061 6e79 2064 6174 6120   means any data 
-00012d50: 636f 6e76 6572 7369 6f6e 7320 6d61 7920  conversions may 
-00012d60: 6265 2064 6f6e 652e 0a20 2020 2020 2020  be done..       
-00012d70: 2063 6f70 7920 3a20 626f 6f6c 2c20 6f70   copy : bool, op
-00012d80: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00012d90: 2020 2042 7920 6465 6661 756c 742c 2061     By default, a
-00012da0: 7374 7970 6520 616c 7761 7973 2072 6574  stype always ret
-00012db0: 7572 6e73 2061 206e 6577 6c79 2061 6c6c  urns a newly all
-00012dc0: 6f63 6174 6564 2061 7272 6179 2e20 4966  ocated array. If
-00012dd0: 2074 6869 730a 2020 2020 2020 2020 2020   this.          
-00012de0: 2020 6973 2073 6574 2074 6f20 4661 6c73    is set to Fals
-00012df0: 6520 616e 6420 7468 6520 6064 7479 7065  e and the `dtype
-00012e00: 6020 7265 7175 6972 656d 656e 7420 6973  ` requirement is
-00012e10: 2073 6174 6973 6669 6564 2c20 7468 6520   satisfied, the 
-00012e20: 696e 7075 740a 2020 2020 2020 2020 2020  input.          
-00012e30: 2020 6172 7261 7920 6973 2072 6574 7572    array is retur
-00012e40: 6e65 6420 696e 7374 6561 6420 6f66 2061  ned instead of a
-00012e50: 2063 6f70 792e 0a0a 2020 2020 2020 2020   copy...        
-00012e60: 2020 2020 2e2e 206e 6f74 653a 3a0a 0a20      .. note::.. 
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2044                 D
-00012e80: 6173 6b20 646f 6573 206e 6f74 2072 6573  ask does not res
-00012e90: 7065 6374 2074 6865 2063 6f6e 7469 6775  pect the contigu
-00012ea0: 6f75 7320 6d65 6d6f 7279 206c 6179 6f75  ous memory layou
-00012eb0: 7420 6f66 2074 6865 2061 7272 6179 2c0a  t of the array,.
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 616e 6420 7769 6c6c 2069 676e 6f72 6520  and will ignore 
-00012ee0: 7468 6520 6060 6f72 6465 7260 6020 6b65  the ``order`` ke
-00012ef0: 7977 6f72 6420 6172 6775 6d65 6e74 2e0a  yword argument..
-00012f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f10: 5468 6520 6465 6661 756c 7420 6f72 6465  The default orde
-00012f20: 7220 6973 2027 4327 2063 6f6e 7469 6775  r is 'C' contigu
-00012f30: 6f75 732e 0a20 2020 2020 2020 2022 2222  ous..        """
-00012f40: 0a20 2020 2020 2020 206b 7761 7267 732e  .        kwargs.
-00012f50: 706f 7028 226f 7264 6572 222c 204e 6f6e  pop("order", Non
-00012f60: 6529 2020 2320 606f 7264 6572 6020 6973  e)  # `order` is
-00012f70: 206e 6f74 2072 6573 7065 6374 6564 2c20   not respected, 
-00012f80: 736f 2077 6520 7265 6d6f 7665 2074 6869  so we remove thi
-00012f90: 7320 6b77 6172 670a 2020 2020 2020 2020  s kwarg.        
-00012fa0: 2320 5363 616c 6172 7320 646f 6e27 7420  # Scalars don't 
-00012fb0: 7461 6b65 2060 6361 7374 696e 6760 206f  take `casting` o
-00012fc0: 7220 6063 6f70 7960 206b 7761 7267 7320  r `copy` kwargs 
-00012fd0: 2d20 6173 2073 7563 6820 7765 206f 6e6c  - as such we onl
-00012fe0: 7920 7061 7373 0a20 2020 2020 2020 2023  y pass.        #
-00012ff0: 2074 6865 6d20 746f 2060 6d61 705f 626c   them to `map_bl
-00013000: 6f63 6b73 6020 6966 2073 7065 6369 6669  ocks` if specifi
-00013010: 6564 2062 7920 7573 6572 2028 6469 6666  ed by user (diff
-00013020: 6572 656e 7420 7468 616e 2064 6566 6175  erent than defau
-00013030: 6c74 7329 2e0a 2020 2020 2020 2020 6578  lts)..        ex
-00013040: 7472 6120 3d20 7365 7428 6b77 6172 6773  tra = set(kwargs
-00013050: 2920 2d20 7b22 6361 7374 696e 6722 2c20  ) - {"casting", 
-00013060: 2263 6f70 7922 7d0a 2020 2020 2020 2020  "copy"}.        
-00013070: 6966 2065 7874 7261 3a0a 2020 2020 2020  if extra:.      
-00013080: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00013090: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-000130a0: 2020 2020 2020 2066 2261 7374 7970 6520         f"astype 
-000130b0: 646f 6573 206e 6f74 2074 616b 6520 7468  does not take th
-000130c0: 6520 666f 6c6c 6f77 696e 6720 6b65 7977  e following keyw
-000130d0: 6f72 6420 6172 6775 6d65 6e74 733a 207b  ord arguments: {
-000130e0: 6c69 7374 2865 7874 7261 297d 220a 2020  list(extra)}".  
-000130f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00013100: 2020 2020 6361 7374 696e 6720 3d20 6b77      casting = kw
-00013110: 6172 6773 2e67 6574 2822 6361 7374 696e  args.get("castin
-00013120: 6722 2c20 2275 6e73 6166 6522 290a 2020  g", "unsafe").  
-00013130: 2020 2020 2020 6474 7970 6520 3d20 6e70        dtype = np
-00013140: 2e64 7479 7065 2864 7479 7065 290a 2020  .dtype(dtype).  
-00013150: 2020 2020 2020 6966 2073 656c 662e 6474        if self.dt
-00013160: 7970 6520 3d3d 2064 7479 7065 3a0a 2020  ype == dtype:.  
-00013170: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013180: 2073 656c 660a 2020 2020 2020 2020 656c   self.        el
-00013190: 6966 206e 6f74 206e 702e 6361 6e5f 6361  if not np.can_ca
-000131a0: 7374 2873 656c 662e 6474 7970 652c 2064  st(self.dtype, d
-000131b0: 7479 7065 2c20 6361 7374 696e 673d 6361  type, casting=ca
-000131c0: 7374 696e 6729 3a0a 2020 2020 2020 2020  sting):.        
-000131d0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-000131e0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-000131f0: 2020 2020 2066 2243 616e 6e6f 7420 6361       f"Cannot ca
-00013200: 7374 2061 7272 6179 2066 726f 6d20 7b73  st array from {s
-00013210: 656c 662e 6474 7970 6521 727d 2074 6f20  elf.dtype!r} to 
-00013220: 7b64 7479 7065 2172 7d20 220a 2020 2020  {dtype!r} ".    
-00013230: 2020 2020 2020 2020 2020 2020 6622 6163              f"ac
-00013240: 636f 7264 696e 6720 746f 2074 6865 2072  cording to the r
-00013250: 756c 6520 7b63 6173 7469 6e67 2172 7d22  ule {casting!r}"
-00013260: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00013270: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00013280: 6c66 2e6d 6170 5f62 6c6f 636b 7328 6368  lf.map_blocks(ch
-00013290: 756e 6b2e 6173 7479 7065 2c20 6474 7970  unk.astype, dtyp
-000132a0: 653d 6474 7970 652c 2061 7374 7970 655f  e=dtype, astype_
-000132b0: 6474 7970 653d 6474 7970 652c 202a 2a6b  dtype=dtype, **k
-000132c0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-000132d0: 5f5f 6162 735f 5f28 7365 6c66 293a 0a20  __abs__(self):. 
-000132e0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-000132f0: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-00013300: 6162 732c 2073 656c 6629 0a0a 2020 2020  abs, self)..    
-00013310: 4063 6865 636b 5f69 665f 6861 6e64 6c65  @check_if_handle
-00013320: 645f 6769 7665 6e5f 6f74 6865 720a 2020  d_given_other.  
-00013330: 2020 6465 6620 5f5f 6164 645f 5f28 7365    def __add__(se
-00013340: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00013350: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-00013360: 6973 6528 6f70 6572 6174 6f72 2e61 6464  ise(operator.add
-00013370: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
-00013380: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-00013390: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-000133a0: 720a 2020 2020 6465 6620 5f5f 7261 6464  r.    def __radd
-000133b0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-000133c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000133d0: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
-000133e0: 722e 6164 642c 206f 7468 6572 2c20 7365  r.add, other, se
-000133f0: 6c66 290a 0a20 2020 2040 6368 6563 6b5f  lf)..    @check_
-00013400: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
-00013410: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
-00013420: 5f61 6e64 5f5f 2873 656c 662c 206f 7468  _and__(self, oth
-00013430: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-00013440: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
-00013450: 7261 746f 722e 616e 645f 2c20 7365 6c66  rator.and_, self
-00013460: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-00013470: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-00013480: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00013490: 6465 6620 5f5f 7261 6e64 5f5f 2873 656c  def __rand__(sel
-000134a0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-000134b0: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
-000134c0: 7365 286f 7065 7261 746f 722e 616e 645f  se(operator.and_
-000134d0: 2c20 6f74 6865 722c 2073 656c 6629 0a0a  , other, self)..
-000134e0: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-000134f0: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-00013500: 720a 2020 2020 6465 6620 5f5f 6469 765f  r.    def __div_
-00013510: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-00013520: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013530: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-00013540: 2e64 6976 2c20 7365 6c66 2c20 6f74 6865  .div, self, othe
-00013550: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
-00013560: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013570: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013580: 7264 6976 5f5f 2873 656c 662c 206f 7468  rdiv__(self, oth
-00013590: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-000135a0: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
-000135b0: 7261 746f 722e 6469 762c 206f 7468 6572  rator.div, other
-000135c0: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
-000135d0: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
-000135e0: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
-000135f0: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
-00013600: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-00013610: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
-00013620: 6f70 6572 6174 6f72 2e65 712c 2073 656c  operator.eq, sel
-00013630: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
-00013640: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
-00013650: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
-00013660: 2064 6566 205f 5f67 745f 5f28 7365 6c66   def __gt__(self
-00013670: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-00013680: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
-00013690: 6528 6f70 6572 6174 6f72 2e67 742c 2073  e(operator.gt, s
-000136a0: 656c 662c 206f 7468 6572 290a 0a20 2020  elf, other)..   
-000136b0: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-000136c0: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-000136d0: 2020 2064 6566 205f 5f67 655f 5f28 7365     def __ge__(se
-000136e0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-000136f0: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-00013700: 6973 6528 6f70 6572 6174 6f72 2e67 652c  ise(operator.ge,
-00013710: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
-00013720: 2020 2064 6566 205f 5f69 6e76 6572 745f     def __invert_
-00013730: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00013740: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-00013750: 286f 7065 7261 746f 722e 696e 7665 7274  (operator.invert
-00013760: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
-00013770: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
-00013780: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
-00013790: 6566 205f 5f6c 7368 6966 745f 5f28 7365  ef __lshift__(se
-000137a0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-000137b0: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-000137c0: 6973 6528 6f70 6572 6174 6f72 2e6c 7368  ise(operator.lsh
-000137d0: 6966 742c 2073 656c 662c 206f 7468 6572  ift, self, other
-000137e0: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
-000137f0: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
-00013800: 7468 6572 0a20 2020 2064 6566 205f 5f72  ther.    def __r
-00013810: 6c73 6869 6674 5f5f 2873 656c 662c 206f  lshift__(self, o
-00013820: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-00013830: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
-00013840: 7065 7261 746f 722e 6c73 6869 6674 2c20  perator.lshift, 
-00013850: 6f74 6865 722c 2073 656c 6629 0a0a 2020  other, self)..  
-00013860: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-00013870: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-00013880: 2020 2020 6465 6620 5f5f 6c74 5f5f 2873      def __lt__(s
-00013890: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-000138a0: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-000138b0: 7769 7365 286f 7065 7261 746f 722e 6c74  wise(operator.lt
-000138c0: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
-000138d0: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-000138e0: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-000138f0: 720a 2020 2020 6465 6620 5f5f 6c65 5f5f  r.    def __le__
-00013900: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-00013910: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00013920: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-00013930: 6c65 2c20 7365 6c66 2c20 6f74 6865 7229  le, self, other)
-00013940: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
-00013950: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
-00013960: 6865 720a 2020 2020 6465 6620 5f5f 6d6f  her.    def __mo
-00013970: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
-00013980: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00013990: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
-000139a0: 6f72 2e6d 6f64 2c20 7365 6c66 2c20 6f74  or.mod, self, ot
-000139b0: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
-000139c0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
-000139d0: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
-000139e0: 5f5f 726d 6f64 5f5f 2873 656c 662c 206f  __rmod__(self, o
-000139f0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-00013a00: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
-00013a10: 7065 7261 746f 722e 6d6f 642c 206f 7468  perator.mod, oth
-00013a20: 6572 2c20 7365 6c66 290a 0a20 2020 2040  er, self)..    @
-00013a30: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
-00013a40: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
-00013a50: 2064 6566 205f 5f6d 756c 5f5f 2873 656c   def __mul__(sel
-00013a60: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00013a70: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
-00013a80: 7365 286f 7065 7261 746f 722e 6d75 6c2c  se(operator.mul,
-00013a90: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
-00013aa0: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00013ab0: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00013ac0: 0a20 2020 2064 6566 205f 5f72 6d75 6c5f  .    def __rmul_
-00013ad0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-00013ae0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013af0: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-00013b00: 2e6d 756c 2c20 6f74 6865 722c 2073 656c  .mul, other, sel
-00013b10: 6629 0a0a 2020 2020 4063 6865 636b 5f69  f)..    @check_i
-00013b20: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013b30: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013b40: 6e65 5f5f 2873 656c 662c 206f 7468 6572  ne__(self, other
-00013b50: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00013b60: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
-00013b70: 746f 722e 6e65 2c20 7365 6c66 2c20 6f74  tor.ne, self, ot
-00013b80: 6865 7229 0a0a 2020 2020 6465 6620 5f5f  her)..    def __
-00013b90: 6e65 675f 5f28 7365 6c66 293a 0a20 2020  neg__(self):.   
-00013ba0: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013bb0: 7769 7365 286f 7065 7261 746f 722e 6e65  wise(operator.ne
-00013bc0: 672c 2073 656c 6629 0a0a 2020 2020 4063  g, self)..    @c
-00013bd0: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-00013be0: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00013bf0: 6465 6620 5f5f 6f72 5f5f 2873 656c 662c  def __or__(self,
-00013c00: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00013c10: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-00013c20: 286f 7065 7261 746f 722e 6f72 5f2c 2073  (operator.or_, s
-00013c30: 656c 662c 206f 7468 6572 290a 0a20 2020  elf, other)..   
-00013c40: 2064 6566 205f 5f70 6f73 5f5f 2873 656c   def __pos__(sel
-00013c50: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00013c60: 726e 2073 656c 660a 0a20 2020 2040 6368  rn self..    @ch
-00013c70: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
-00013c80: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
-00013c90: 6566 205f 5f72 6f72 5f5f 2873 656c 662c  ef __ror__(self,
-00013ca0: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00013cb0: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-00013cc0: 286f 7065 7261 746f 722e 6f72 5f2c 206f  (operator.or_, o
-00013cd0: 7468 6572 2c20 7365 6c66 290a 0a20 2020  ther, self)..   
-00013ce0: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-00013cf0: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-00013d00: 2020 2064 6566 205f 5f70 6f77 5f5f 2873     def __pow__(s
-00013d10: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00013d20: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013d30: 7769 7365 286f 7065 7261 746f 722e 706f  wise(operator.po
-00013d40: 772c 2073 656c 662c 206f 7468 6572 290a  w, self, other).
-00013d50: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
-00013d60: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
-00013d70: 6572 0a20 2020 2064 6566 205f 5f72 706f  er.    def __rpo
-00013d80: 775f 5f28 7365 6c66 2c20 6f74 6865 7229  w__(self, other)
-00013d90: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00013da0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
-00013db0: 6f72 2e70 6f77 2c20 6f74 6865 722c 2073  or.pow, other, s
-00013dc0: 656c 6629 0a0a 2020 2020 4063 6865 636b  elf)..    @check
-00013dd0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
-00013de0: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
-00013df0: 5f5f 7273 6869 6674 5f5f 2873 656c 662c  __rshift__(self,
-00013e00: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00013e10: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-00013e20: 286f 7065 7261 746f 722e 7273 6869 6674  (operator.rshift
-00013e30: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
-00013e40: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-00013e50: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-00013e60: 720a 2020 2020 6465 6620 5f5f 7272 7368  r.    def __rrsh
-00013e70: 6966 745f 5f28 7365 6c66 2c20 6f74 6865  ift__(self, othe
-00013e80: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-00013e90: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
-00013ea0: 6174 6f72 2e72 7368 6966 742c 206f 7468  ator.rshift, oth
-00013eb0: 6572 2c20 7365 6c66 290a 0a20 2020 2040  er, self)..    @
-00013ec0: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
-00013ed0: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
-00013ee0: 2064 6566 205f 5f73 7562 5f5f 2873 656c   def __sub__(sel
-00013ef0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00013f00: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
-00013f10: 7365 286f 7065 7261 746f 722e 7375 622c  se(operator.sub,
-00013f20: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
-00013f30: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00013f40: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00013f50: 0a20 2020 2064 6566 205f 5f72 7375 625f  .    def __rsub_
-00013f60: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-00013f70: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013f80: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-00013f90: 2e73 7562 2c20 6f74 6865 722c 2073 656c  .sub, other, sel
-00013fa0: 6629 0a0a 2020 2020 4063 6865 636b 5f69  f)..    @check_i
-00013fb0: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013fc0: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013fd0: 7472 7565 6469 765f 5f28 7365 6c66 2c20  truediv__(self, 
-00013fe0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-00013ff0: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
-00014000: 6f70 6572 6174 6f72 2e74 7275 6564 6976  operator.truediv
-00014010: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
-00014020: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-00014030: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-00014040: 720a 2020 2020 6465 6620 5f5f 7274 7275  r.    def __rtru
-00014050: 6564 6976 5f5f 2873 656c 662c 206f 7468  ediv__(self, oth
-00014060: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-00014070: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
-00014080: 7261 746f 722e 7472 7565 6469 762c 206f  rator.truediv, o
-00014090: 7468 6572 2c20 7365 6c66 290a 0a20 2020  ther, self)..   
-000140a0: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-000140b0: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-000140c0: 2020 2064 6566 205f 5f66 6c6f 6f72 6469     def __floordi
-000140d0: 765f 5f28 7365 6c66 2c20 6f74 6865 7229  v__(self, other)
-000140e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000140f0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
-00014100: 6f72 2e66 6c6f 6f72 6469 762c 2073 656c  or.floordiv, sel
-00014110: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
-00014120: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
-00014130: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
-00014140: 2064 6566 205f 5f72 666c 6f6f 7264 6976   def __rfloordiv
-00014150: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-00014160: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014170: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
-00014180: 722e 666c 6f6f 7264 6976 2c20 6f74 6865  r.floordiv, othe
-00014190: 722c 2073 656c 6629 0a0a 2020 2020 4063  r, self)..    @c
-000141a0: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-000141b0: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-000141c0: 6465 6620 5f5f 786f 725f 5f28 7365 6c66  def __xor__(self
-000141d0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-000141e0: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
-000141f0: 6528 6f70 6572 6174 6f72 2e78 6f72 2c20  e(operator.xor, 
-00014200: 7365 6c66 2c20 6f74 6865 7229 0a0a 2020  self, other)..  
-00014210: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-00014220: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-00014230: 2020 2020 6465 6620 5f5f 7278 6f72 5f5f      def __rxor__
-00014240: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-00014250: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00014260: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-00014270: 786f 722c 206f 7468 6572 2c20 7365 6c66  xor, other, self
-00014280: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
-00014290: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
-000142a0: 7468 6572 0a20 2020 2064 6566 205f 5f6d  ther.    def __m
-000142b0: 6174 6d75 6c5f 5f28 7365 6c66 2c20 6f74  atmul__(self, ot
-000142c0: 6865 7229 3a0a 2020 2020 2020 2020 6672  her):.        fr
-000142d0: 6f6d 2064 6173 6b2e 6172 7261 792e 726f  om dask.array.ro
-000142e0: 7574 696e 6573 2069 6d70 6f72 7420 6d61  utines import ma
-000142f0: 746d 756c 0a0a 2020 2020 2020 2020 7265  tmul..        re
-00014300: 7475 726e 206d 6174 6d75 6c28 7365 6c66  turn matmul(self
-00014310: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-00014320: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-00014330: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00014340: 6465 6620 5f5f 726d 6174 6d75 6c5f 5f28  def __rmatmul__(
-00014350: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-00014360: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00014370: 6172 7261 792e 726f 7574 696e 6573 2069  array.routines i
-00014380: 6d70 6f72 7420 6d61 746d 756c 0a0a 2020  mport matmul..  
-00014390: 2020 2020 2020 7265 7475 726e 206d 6174        return mat
-000143a0: 6d75 6c28 6f74 6865 722c 2073 656c 6629  mul(other, self)
-000143b0: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
-000143c0: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
-000143d0: 6865 720a 2020 2020 6465 6620 5f5f 6469  her.    def __di
-000143e0: 766d 6f64 5f5f 2873 656c 662c 206f 7468  vmod__(self, oth
-000143f0: 6572 293a 0a20 2020 2020 2020 2066 726f  er):.        fro
-00014400: 6d20 6461 736b 2e61 7272 6179 2e75 6675  m dask.array.ufu
-00014410: 6e63 2069 6d70 6f72 7420 6469 766d 6f64  nc import divmod
-00014420: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00014430: 2064 6976 6d6f 6428 7365 6c66 2c20 6f74   divmod(self, ot
-00014440: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
-00014450: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
-00014460: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
-00014470: 5f5f 7264 6976 6d6f 645f 5f28 7365 6c66  __rdivmod__(self
-00014480: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-00014490: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-000144a0: 792e 7566 756e 6320 696d 706f 7274 2064  y.ufunc import d
-000144b0: 6976 6d6f 640a 0a20 2020 2020 2020 2072  ivmod..        r
-000144c0: 6574 7572 6e20 6469 766d 6f64 286f 7468  eturn divmod(oth
-000144d0: 6572 2c20 7365 6c66 290a 0a20 2020 2064  er, self)..    d
-000144e0: 6566 2061 6e79 2873 656c 662c 2061 7869  ef any(self, axi
-000144f0: 733d 4e6f 6e65 2c20 6b65 6570 6469 6d73  s=None, keepdims
-00014500: 3d46 616c 7365 2c20 7370 6c69 745f 6576  =False, split_ev
-00014510: 6572 793d 4e6f 6e65 2c20 6f75 743d 4e6f  ery=None, out=No
-00014520: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00014530: 5265 7475 726e 7320 5472 7565 2069 6620  Returns True if 
-00014540: 616e 7920 6f66 2074 6865 2065 6c65 6d65  any of the eleme
-00014550: 6e74 7320 6576 616c 7561 7465 2074 6f20  nts evaluate to 
-00014560: 5472 7565 2e0a 0a20 2020 2020 2020 2052  True...        R
-00014570: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
-00014580: 6173 6b2e 6172 7261 792e 616e 7960 2066  ask.array.any` f
-00014590: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-000145a0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-000145b0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000145c0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000145d0: 2020 6461 736b 2e61 7272 6179 2e61 6e79    dask.array.any
-000145e0: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
-000145f0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-00014600: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014610: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
-00014620: 7469 6f6e 7320 696d 706f 7274 2061 6e79  tions import any
-00014630: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00014640: 2061 6e79 2873 656c 662c 2061 7869 733d   any(self, axis=
-00014650: 6178 6973 2c20 6b65 6570 6469 6d73 3d6b  axis, keepdims=k
-00014660: 6565 7064 696d 732c 2073 706c 6974 5f65  eepdims, split_e
-00014670: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
-00014680: 2c20 6f75 743d 6f75 7429 0a0a 2020 2020  , out=out)..    
-00014690: 6465 6620 616c 6c28 7365 6c66 2c20 6178  def all(self, ax
-000146a0: 6973 3d4e 6f6e 652c 206b 6565 7064 696d  is=None, keepdim
-000146b0: 733d 4661 6c73 652c 2073 706c 6974 5f65  s=False, split_e
-000146c0: 7665 7279 3d4e 6f6e 652c 206f 7574 3d4e  very=None, out=N
-000146d0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-000146e0: 2252 6574 7572 6e73 2054 7275 6520 6966  "Returns True if
-000146f0: 2061 6c6c 2065 6c65 6d65 6e74 7320 6576   all elements ev
-00014700: 616c 7561 7465 2074 6f20 5472 7565 2e0a  aluate to True..
-00014710: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00014720: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00014730: 7261 792e 616c 6c60 2066 6f72 2066 756c  ray.all` for ful
-00014740: 6c20 646f 6375 6d65 6e74 6174 696f 6e2e  l documentation.
-00014750: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00014760: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00014770: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
-00014780: 2e61 7272 6179 2e61 6c6c 203a 2065 7175  .array.all : equ
-00014790: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
-000147a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000147b0: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
-000147c0: 7272 6179 2e72 6564 7563 7469 6f6e 7320  rray.reductions 
-000147d0: 696d 706f 7274 2061 6c6c 0a0a 2020 2020  import all..    
-000147e0: 2020 2020 7265 7475 726e 2061 6c6c 2873      return all(s
-000147f0: 656c 662c 2061 7869 733d 6178 6973 2c20  elf, axis=axis, 
-00014800: 6b65 6570 6469 6d73 3d6b 6565 7064 696d  keepdims=keepdim
-00014810: 732c 2073 706c 6974 5f65 7665 7279 3d73  s, split_every=s
-00014820: 706c 6974 5f65 7665 7279 2c20 6f75 743d  plit_every, out=
-00014830: 6f75 7429 0a0a 2020 2020 6465 6620 6d69  out)..    def mi
-00014840: 6e28 7365 6c66 2c20 6178 6973 3d4e 6f6e  n(self, axis=Non
-00014850: 652c 206b 6565 7064 696d 733d 4661 6c73  e, keepdims=Fals
-00014860: 652c 2073 706c 6974 5f65 7665 7279 3d4e  e, split_every=N
-00014870: 6f6e 652c 206f 7574 3d4e 6f6e 6529 3a0a  one, out=None):.
-00014880: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00014890: 6e20 7468 6520 6d69 6e69 6d75 6d20 616c  n the minimum al
-000148a0: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
-000148b0: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
-000148c0: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
-000148d0: 6172 7261 792e 6d69 6e60 2066 6f72 2066  array.min` for f
-000148e0: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
-000148f0: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
-00014900: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-00014910: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
-00014920: 736b 2e61 7272 6179 2e6d 696e 203a 2065  sk.array.min : e
-00014930: 7175 6976 616c 656e 7420 6675 6e63 7469  quivalent functi
-00014940: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
-00014950: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-00014960: 2e61 7272 6179 2e72 6564 7563 7469 6f6e  .array.reduction
-00014970: 7320 696d 706f 7274 206d 696e 0a0a 2020  s import min..  
-00014980: 2020 2020 2020 7265 7475 726e 206d 696e        return min
-00014990: 2873 656c 662c 2061 7869 733d 6178 6973  (self, axis=axis
-000149a0: 2c20 6b65 6570 6469 6d73 3d6b 6565 7064  , keepdims=keepd
-000149b0: 696d 732c 2073 706c 6974 5f65 7665 7279  ims, split_every
-000149c0: 3d73 706c 6974 5f65 7665 7279 2c20 6f75  =split_every, ou
-000149d0: 743d 6f75 7429 0a0a 2020 2020 6465 6620  t=out)..    def 
-000149e0: 6d61 7828 7365 6c66 2c20 6178 6973 3d4e  max(self, axis=N
-000149f0: 6f6e 652c 206b 6565 7064 696d 733d 4661  one, keepdims=Fa
-00014a00: 6c73 652c 2073 706c 6974 5f65 7665 7279  lse, split_every
-00014a10: 3d4e 6f6e 652c 206f 7574 3d4e 6f6e 6529  =None, out=None)
-00014a20: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00014a30: 7572 6e20 7468 6520 6d61 7869 6d75 6d20  urn the maximum 
-00014a40: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
-00014a50: 6973 2e0a 0a20 2020 2020 2020 2052 6566  is...        Ref
-00014a60: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00014a70: 6b2e 6172 7261 792e 6d61 7860 2066 6f72  k.array.max` for
-00014a80: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00014a90: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00014aa0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00014ab0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00014ac0: 6461 736b 2e61 7272 6179 2e6d 6178 203a  dask.array.max :
-00014ad0: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-00014ae0: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-00014af0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00014b00: 736b 2e61 7272 6179 2e72 6564 7563 7469  sk.array.reducti
-00014b10: 6f6e 7320 696d 706f 7274 206d 6178 0a0a  ons import max..
-00014b20: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00014b30: 6178 2873 656c 662c 2061 7869 733d 6178  ax(self, axis=ax
-00014b40: 6973 2c20 6b65 6570 6469 6d73 3d6b 6565  is, keepdims=kee
-00014b50: 7064 696d 732c 2073 706c 6974 5f65 7665  pdims, split_eve
-00014b60: 7279 3d73 706c 6974 5f65 7665 7279 2c20  ry=split_every, 
-00014b70: 6f75 743d 6f75 7429 0a0a 2020 2020 6465  out=out)..    de
-00014b80: 6620 6172 676d 696e 2873 656c 662c 2061  f argmin(self, a
-00014b90: 7869 733d 4e6f 6e65 2c20 2a2c 206b 6565  xis=None, *, kee
-00014ba0: 7064 696d 733d 4661 6c73 652c 2073 706c  pdims=False, spl
-00014bb0: 6974 5f65 7665 7279 3d4e 6f6e 652c 206f  it_every=None, o
-00014bc0: 7574 3d4e 6f6e 6529 3a0a 2020 2020 2020  ut=None):.      
-00014bd0: 2020 2222 2252 6574 7572 6e20 696e 6469    """Return indi
-00014be0: 6365 7320 6f66 2074 6865 206d 696e 696d  ces of the minim
-00014bf0: 756d 2076 616c 7565 7320 616c 6f6e 6720  um values along 
-00014c00: 7468 6520 6769 7665 6e20 6178 6973 2e0a  the given axis..
-00014c10: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00014c20: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00014c30: 7261 792e 6172 676d 696e 6020 666f 7220  ray.argmin` for 
-00014c40: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
-00014c50: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
-00014c60: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00014c70: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00014c80: 6173 6b2e 6172 7261 792e 6172 676d 696e  ask.array.argmin
-00014c90: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
-00014ca0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-00014cb0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014cc0: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
-00014cd0: 7469 6f6e 7320 696d 706f 7274 2061 7267  tions import arg
-00014ce0: 6d69 6e0a 0a20 2020 2020 2020 2072 6574  min..        ret
-00014cf0: 7572 6e20 6172 676d 696e 280a 2020 2020  urn argmin(.    
-00014d00: 2020 2020 2020 2020 7365 6c66 2c20 6178          self, ax
-00014d10: 6973 3d61 7869 732c 206b 6565 7064 696d  is=axis, keepdim
-00014d20: 733d 6b65 6570 6469 6d73 2c20 7370 6c69  s=keepdims, spli
-00014d30: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-00014d40: 6572 792c 206f 7574 3d6f 7574 0a20 2020  ery, out=out.   
-00014d50: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00014d60: 6172 676d 6178 2873 656c 662c 2061 7869  argmax(self, axi
-00014d70: 733d 4e6f 6e65 2c20 2a2c 206b 6565 7064  s=None, *, keepd
-00014d80: 696d 733d 4661 6c73 652c 2073 706c 6974  ims=False, split
-00014d90: 5f65 7665 7279 3d4e 6f6e 652c 206f 7574  _every=None, out
-00014da0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00014db0: 2222 2252 6574 7572 6e20 696e 6469 6365  """Return indice
-00014dc0: 7320 6f66 2074 6865 206d 6178 696d 756d  s of the maximum
-00014dd0: 2076 616c 7565 7320 616c 6f6e 6720 7468   values along th
-00014de0: 6520 6769 7665 6e20 6178 6973 2e0a 0a20  e given axis... 
-00014df0: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
-00014e00: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
-00014e10: 792e 6172 676d 6178 6020 666f 7220 6675  y.argmax` for fu
-00014e20: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
-00014e30: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00014e40: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00014e50: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-00014e60: 6b2e 6172 7261 792e 6172 676d 6178 203a  k.array.argmax :
-00014e70: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-00014e80: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-00014e90: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00014ea0: 736b 2e61 7272 6179 2e72 6564 7563 7469  sk.array.reducti
-00014eb0: 6f6e 7320 696d 706f 7274 2061 7267 6d61  ons import argma
-00014ec0: 780a 0a20 2020 2020 2020 2072 6574 7572  x..        retur
-00014ed0: 6e20 6172 676d 6178 280a 2020 2020 2020  n argmax(.      
-00014ee0: 2020 2020 2020 7365 6c66 2c20 6178 6973        self, axis
-00014ef0: 3d61 7869 732c 206b 6565 7064 696d 733d  =axis, keepdims=
-00014f00: 6b65 6570 6469 6d73 2c20 7370 6c69 745f  keepdims, split_
-00014f10: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
-00014f20: 792c 206f 7574 3d6f 7574 0a20 2020 2020  y, out=out.     
-00014f30: 2020 2029 0a0a 2020 2020 6465 6620 7375     )..    def su
-00014f40: 6d28 7365 6c66 2c20 6178 6973 3d4e 6f6e  m(self, axis=Non
-00014f50: 652c 2064 7479 7065 3d4e 6f6e 652c 206b  e, dtype=None, k
-00014f60: 6565 7064 696d 733d 4661 6c73 652c 2073  eepdims=False, s
-00014f70: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
-00014f80: 206f 7574 3d4e 6f6e 6529 3a0a 2020 2020   out=None):.    
-00014f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00014fa0: 5265 7475 726e 2074 6865 2073 756d 206f  Return the sum o
-00014fb0: 6620 7468 6520 6172 7261 7920 656c 656d  f the array elem
-00014fc0: 656e 7473 206f 7665 7220 7468 6520 6769  ents over the gi
-00014fd0: 7665 6e20 6178 6973 2e0a 0a20 2020 2020  ven axis...     
-00014fe0: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
-00014ff0: 633a 6064 6173 6b2e 6172 7261 792e 7375  c:`dask.array.su
-00015000: 6d60 2066 6f72 2066 756c 6c20 646f 6375  m` for full docu
-00015010: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-00015020: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00015030: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00015040: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00015050: 2e73 756d 203a 2065 7175 6976 616c 656e  .sum : equivalen
-00015060: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00015070: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00015080: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00015090: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-000150a0: 2073 756d 0a0a 2020 2020 2020 2020 7265   sum..        re
-000150b0: 7475 726e 2073 756d 280a 2020 2020 2020  turn sum(.      
-000150c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000150d0: 2020 2020 2020 2020 6178 6973 3d61 7869          axis=axi
-000150e0: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-000150f0: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
-00015100: 2020 2020 2020 2020 6b65 6570 6469 6d73          keepdims
-00015110: 3d6b 6565 7064 696d 732c 0a20 2020 2020  =keepdims,.     
-00015120: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
-00015130: 7279 3d73 706c 6974 5f65 7665 7279 2c0a  ry=split_every,.
-00015140: 2020 2020 2020 2020 2020 2020 6f75 743d              out=
-00015150: 6f75 742c 0a20 2020 2020 2020 2029 0a0a  out,.        )..
-00015160: 2020 2020 6465 6620 7472 6163 6528 7365      def trace(se
-00015170: 6c66 2c20 6f66 6673 6574 3d30 2c20 6178  lf, offset=0, ax
-00015180: 6973 313d 302c 2061 7869 7332 3d31 2c20  is1=0, axis2=1, 
-00015190: 6474 7970 653d 4e6f 6e65 293a 0a20 2020  dtype=None):.   
-000151a0: 2020 2020 2022 2222 5265 7475 726e 2074       """Return t
-000151b0: 6865 2073 756d 2061 6c6f 6e67 2064 6961  he sum along dia
-000151c0: 676f 6e61 6c73 206f 6620 7468 6520 6172  gonals of the ar
-000151d0: 7261 792e 0a0a 2020 2020 2020 2020 5265  ray...        Re
-000151e0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
-000151f0: 736b 2e61 7272 6179 2e74 7261 6365 6020  sk.array.trace` 
-00015200: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
-00015210: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
-00015220: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00015230: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00015240: 2020 2064 6173 6b2e 6172 7261 792e 7472     dask.array.tr
-00015250: 6163 6520 3a20 6571 7569 7661 6c65 6e74  ace : equivalent
-00015260: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-00015270: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00015280: 6f6d 2064 6173 6b2e 6172 7261 792e 7265  om dask.array.re
-00015290: 6475 6374 696f 6e73 2069 6d70 6f72 7420  ductions import 
-000152a0: 7472 6163 650a 0a20 2020 2020 2020 2072  trace..        r
-000152b0: 6574 7572 6e20 7472 6163 6528 7365 6c66  eturn trace(self
-000152c0: 2c20 6f66 6673 6574 3d6f 6666 7365 742c  , offset=offset,
-000152d0: 2061 7869 7331 3d61 7869 7331 2c20 6178   axis1=axis1, ax
-000152e0: 6973 323d 6178 6973 322c 2064 7479 7065  is2=axis2, dtype
-000152f0: 3d64 7479 7065 290a 0a20 2020 2064 6566  =dtype)..    def
-00015300: 2070 726f 6428 7365 6c66 2c20 6178 6973   prod(self, axis
-00015310: 3d4e 6f6e 652c 2064 7479 7065 3d4e 6f6e  =None, dtype=Non
-00015320: 652c 206b 6565 7064 696d 733d 4661 6c73  e, keepdims=Fals
-00015330: 652c 2073 706c 6974 5f65 7665 7279 3d4e  e, split_every=N
-00015340: 6f6e 652c 206f 7574 3d4e 6f6e 6529 3a0a  one, out=None):.
-00015350: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00015360: 6e20 7468 6520 7072 6f64 7563 7420 6f66  n the product of
-00015370: 2074 6865 2061 7272 6179 2065 6c65 6d65   the array eleme
-00015380: 6e74 7320 6f76 6572 2074 6865 2067 6976  nts over the giv
-00015390: 656e 2061 7869 730a 0a20 2020 2020 2020  en axis..       
-000153a0: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
-000153b0: 6064 6173 6b2e 6172 7261 792e 7072 6f64  `dask.array.prod
-000153c0: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
-000153d0: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
-000153e0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-000153f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00015400: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
-00015410: 7072 6f64 203a 2065 7175 6976 616c 656e  prod : equivalen
-00015420: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00015430: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00015440: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00015450: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-00015460: 2070 726f 640a 0a20 2020 2020 2020 2072   prod..        r
-00015470: 6574 7572 6e20 7072 6f64 280a 2020 2020  eturn prod(.    
-00015480: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00015490: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
-000154a0: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-000154b0: 2064 7479 7065 3d64 7479 7065 2c0a 2020   dtype=dtype,.  
-000154c0: 2020 2020 2020 2020 2020 6b65 6570 6469            keepdi
-000154d0: 6d73 3d6b 6565 7064 696d 732c 0a20 2020  ms=keepdims,.   
-000154e0: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
-000154f0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
-00015500: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
-00015510: 743d 6f75 742c 0a20 2020 2020 2020 2029  t=out,.        )
-00015520: 0a0a 2020 2020 6465 6620 6d65 616e 2873  ..    def mean(s
-00015530: 656c 662c 2061 7869 733d 4e6f 6e65 2c20  elf, axis=None, 
-00015540: 6474 7970 653d 4e6f 6e65 2c20 6b65 6570  dtype=None, keep
-00015550: 6469 6d73 3d46 616c 7365 2c20 7370 6c69  dims=False, spli
-00015560: 745f 6576 6572 793d 4e6f 6e65 2c20 6f75  t_every=None, ou
-00015570: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
-00015580: 2022 2222 5265 7475 726e 7320 7468 6520   """Returns the 
-00015590: 6176 6572 6167 6520 6f66 2074 6865 2061  average of the a
-000155a0: 7272 6179 2065 6c65 6d65 6e74 7320 616c  rray elements al
-000155b0: 6f6e 6720 6769 7665 6e20 6178 6973 2e0a  ong given axis..
-000155c0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-000155d0: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-000155e0: 7261 792e 6d65 616e 6020 666f 7220 6675  ray.mean` for fu
-000155f0: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
-00015600: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00015610: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00015620: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-00015630: 6b2e 6172 7261 792e 6d65 616e 203a 2065  k.array.mean : e
-00015640: 7175 6976 616c 656e 7420 6675 6e63 7469  quivalent functi
-00015650: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
-00015660: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-00015670: 2e61 7272 6179 2e72 6564 7563 7469 6f6e  .array.reduction
-00015680: 7320 696d 706f 7274 206d 6561 6e0a 0a20  s import mean.. 
-00015690: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
-000156a0: 616e 280a 2020 2020 2020 2020 2020 2020  an(.            
-000156b0: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-000156c0: 2020 6178 6973 3d61 7869 732c 0a20 2020    axis=axis,.   
-000156d0: 2020 2020 2020 2020 2064 7479 7065 3d64           dtype=d
-000156e0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-000156f0: 2020 6b65 6570 6469 6d73 3d6b 6565 7064    keepdims=keepd
-00015700: 696d 732c 0a20 2020 2020 2020 2020 2020  ims,.           
-00015710: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
-00015720: 6974 5f65 7665 7279 2c0a 2020 2020 2020  it_every,.      
-00015730: 2020 2020 2020 6f75 743d 6f75 742c 0a20        out=out,. 
-00015740: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00015750: 6620 7374 6428 0a20 2020 2020 2020 2073  f std(.        s
-00015760: 656c 662c 2061 7869 733d 4e6f 6e65 2c20  elf, axis=None, 
-00015770: 6474 7970 653d 4e6f 6e65 2c20 6b65 6570  dtype=None, keep
-00015780: 6469 6d73 3d46 616c 7365 2c20 6464 6f66  dims=False, ddof
-00015790: 3d30 2c20 7370 6c69 745f 6576 6572 793d  =0, split_every=
-000157a0: 4e6f 6e65 2c20 6f75 743d 4e6f 6e65 0a20  None, out=None. 
-000157b0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-000157c0: 2252 6574 7572 6e73 2074 6865 2073 7461  "Returns the sta
-000157d0: 6e64 6172 6420 6465 7669 6174 696f 6e20  ndard deviation 
-000157e0: 6f66 2074 6865 2061 7272 6179 2065 6c65  of the array ele
-000157f0: 6d65 6e74 7320 616c 6f6e 6720 6769 7665  ments along give
-00015800: 6e20 6178 6973 2e0a 0a20 2020 2020 2020  n axis...       
-00015810: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
-00015820: 6064 6173 6b2e 6172 7261 792e 7374 6460  `dask.array.std`
-00015830: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-00015840: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00015850: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00015860: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00015870: 2020 2020 6461 736b 2e61 7272 6179 2e73      dask.array.s
-00015880: 7464 203a 2065 7175 6976 616c 656e 7420  td : equivalent 
-00015890: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-000158a0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-000158b0: 6d20 6461 736b 2e61 7272 6179 2e72 6564  m dask.array.red
-000158c0: 7563 7469 6f6e 7320 696d 706f 7274 2073  uctions import s
-000158d0: 7464 0a0a 2020 2020 2020 2020 7265 7475  td..        retu
-000158e0: 726e 2073 7464 280a 2020 2020 2020 2020  rn std(.        
-000158f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00015900: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
-00015910: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
-00015920: 7065 3d64 7479 7065 2c0a 2020 2020 2020  pe=dtype,.      
-00015930: 2020 2020 2020 6b65 6570 6469 6d73 3d6b        keepdims=k
-00015940: 6565 7064 696d 732c 0a20 2020 2020 2020  eepdims,.       
-00015950: 2020 2020 2064 646f 663d 6464 6f66 2c0a       ddof=ddof,.
-00015960: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00015970: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-00015980: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
-00015990: 206f 7574 3d6f 7574 2c0a 2020 2020 2020   out=out,.      
-000159a0: 2020 290a 0a20 2020 2064 6566 2076 6172    )..    def var
-000159b0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-000159c0: 6178 6973 3d4e 6f6e 652c 2064 7479 7065  axis=None, dtype
-000159d0: 3d4e 6f6e 652c 206b 6565 7064 696d 733d  =None, keepdims=
-000159e0: 4661 6c73 652c 2064 646f 663d 302c 2073  False, ddof=0, s
-000159f0: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
-00015a00: 206f 7574 3d4e 6f6e 650a 2020 2020 293a   out=None.    ):
-00015a10: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00015a20: 726e 7320 7468 6520 7661 7269 616e 6365  rns the variance
-00015a30: 206f 6620 7468 6520 6172 7261 7920 656c   of the array el
-00015a40: 656d 656e 7473 2c20 616c 6f6e 6720 6769  ements, along gi
-00015a50: 7665 6e20 6178 6973 2e0a 0a20 2020 2020  ven axis...     
-00015a60: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
-00015a70: 633a 6064 6173 6b2e 6172 7261 792e 7661  c:`dask.array.va
-00015a80: 7260 2066 6f72 2066 756c 6c20 646f 6375  r` for full docu
-00015a90: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-00015aa0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00015ab0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00015ac0: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00015ad0: 2e76 6172 203a 2065 7175 6976 616c 656e  .var : equivalen
-00015ae0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00015af0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00015b00: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00015b10: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-00015b20: 2076 6172 0a0a 2020 2020 2020 2020 7265   var..        re
-00015b30: 7475 726e 2076 6172 280a 2020 2020 2020  turn var(.      
-00015b40: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00015b50: 2020 2020 2020 2020 6178 6973 3d61 7869          axis=axi
-00015b60: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-00015b70: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
-00015b80: 2020 2020 2020 2020 6b65 6570 6469 6d73          keepdims
-00015b90: 3d6b 6565 7064 696d 732c 0a20 2020 2020  =keepdims,.     
-00015ba0: 2020 2020 2020 2064 646f 663d 6464 6f66         ddof=ddof
-00015bb0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-00015bc0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00015bd0: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
-00015be0: 2020 206f 7574 3d6f 7574 2c0a 2020 2020     out=out,.    
-00015bf0: 2020 2020 290a 0a20 2020 2064 6566 206d      )..    def m
-00015c00: 6f6d 656e 7428 0a20 2020 2020 2020 2073  oment(.        s
-00015c10: 656c 662c 0a20 2020 2020 2020 206f 7264  elf,.        ord
-00015c20: 6572 2c0a 2020 2020 2020 2020 6178 6973  er,.        axis
-00015c30: 3d4e 6f6e 652c 0a20 2020 2020 2020 2064  =None,.        d
-00015c40: 7479 7065 3d4e 6f6e 652c 0a20 2020 2020  type=None,.     
-00015c50: 2020 206b 6565 7064 696d 733d 4661 6c73     keepdims=Fals
-00015c60: 652c 0a20 2020 2020 2020 2064 646f 663d  e,.        ddof=
-00015c70: 302c 0a20 2020 2020 2020 2073 706c 6974  0,.        split
-00015c80: 5f65 7665 7279 3d4e 6f6e 652c 0a20 2020  _every=None,.   
-00015c90: 2020 2020 206f 7574 3d4e 6f6e 652c 0a20       out=None,. 
-00015ca0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00015cb0: 2243 616c 6375 6c61 7465 2074 6865 206e  "Calculate the n
-00015cc0: 7468 2063 656e 7472 616c 697a 6564 206d  th centralized m
-00015cd0: 6f6d 656e 742e 0a0a 2020 2020 2020 2020  oment...        
-00015ce0: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
-00015cf0: 6461 736b 2e61 7272 6179 2e6d 6f6d 656e  dask.array.momen
-00015d00: 7460 2066 6f72 2074 6865 2066 756c 6c20  t` for the full 
-00015d10: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
-00015d20: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00015d30: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015d40: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
-00015d50: 7272 6179 2e6d 6f6d 656e 7420 3a20 6571  rray.moment : eq
-00015d60: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
-00015d70: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00015d80: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00015d90: 6172 7261 792e 7265 6475 6374 696f 6e73  array.reductions
-00015da0: 2069 6d70 6f72 7420 6d6f 6d65 6e74 0a0a   import moment..
-00015db0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00015dc0: 6f6d 656e 7428 0a20 2020 2020 2020 2020  oment(.         
-00015dd0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00015de0: 2020 2020 206f 7264 6572 2c0a 2020 2020       order,.    
-00015df0: 2020 2020 2020 2020 6178 6973 3d61 7869          axis=axi
-00015e00: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-00015e10: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
-00015e20: 2020 2020 2020 2020 6b65 6570 6469 6d73          keepdims
-00015e30: 3d6b 6565 7064 696d 732c 0a20 2020 2020  =keepdims,.     
-00015e40: 2020 2020 2020 2064 646f 663d 6464 6f66         ddof=ddof
-00015e50: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-00015e60: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00015e70: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
-00015e80: 2020 206f 7574 3d6f 7574 2c0a 2020 2020     out=out,.    
-00015e90: 2020 2020 290a 0a20 2020 2040 7772 6170      )..    @wrap
-00015ea0: 7328 6d61 705f 626c 6f63 6b73 290a 2020  s(map_blocks).  
-00015eb0: 2020 6465 6620 6d61 705f 626c 6f63 6b73    def map_blocks
-00015ec0: 2873 656c 662c 2066 756e 632c 202a 6172  (self, func, *ar
-00015ed0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-00015ee0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
-00015ef0: 705f 626c 6f63 6b73 2866 756e 632c 2073  p_blocks(func, s
-00015f00: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00015f10: 6172 6773 290a 0a20 2020 2064 6566 206d  args)..    def m
-00015f20: 6170 5f6f 7665 726c 6170 2873 656c 662c  ap_overlap(self,
-00015f30: 2066 756e 632c 2064 6570 7468 2c20 626f   func, depth, bo
-00015f40: 756e 6461 7279 3d4e 6f6e 652c 2074 7269  undary=None, tri
-00015f50: 6d3d 5472 7565 2c20 2a2a 6b77 6172 6773  m=True, **kwargs
-00015f60: 293a 0a20 2020 2020 2020 2022 2222 4d61  ):.        """Ma
-00015f70: 7020 6120 6675 6e63 7469 6f6e 206f 7665  p a function ove
-00015f80: 7220 626c 6f63 6b73 206f 6620 7468 6520  r blocks of the 
-00015f90: 6172 7261 7920 7769 7468 2073 6f6d 6520  array with some 
-00015fa0: 6f76 6572 6c61 700a 0a20 2020 2020 2020  overlap..       
-00015fb0: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
-00015fc0: 6064 6173 6b2e 6172 7261 792e 6d61 705f  `dask.array.map_
-00015fd0: 6f76 6572 6c61 7060 2066 6f72 2066 756c  overlap` for ful
-00015fe0: 6c20 646f 6375 6d65 6e74 6174 696f 6e2e  l documentation.
-00015ff0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00016000: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00016010: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
-00016020: 2e61 7272 6179 2e6d 6170 5f6f 7665 726c  .array.map_overl
-00016030: 6170 203a 2065 7175 6976 616c 656e 7420  ap : equivalent 
-00016040: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00016050: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00016060: 6d20 6461 736b 2e61 7272 6179 2e6f 7665  m dask.array.ove
-00016070: 726c 6170 2069 6d70 6f72 7420 6d61 705f  rlap import map_
-00016080: 6f76 6572 6c61 700a 0a20 2020 2020 2020  overlap..       
-00016090: 2072 6574 7572 6e20 6d61 705f 6f76 6572   return map_over
-000160a0: 6c61 7028 0a20 2020 2020 2020 2020 2020  lap(.           
-000160b0: 2066 756e 632c 2073 656c 662c 2064 6570   func, self, dep
-000160c0: 7468 3d64 6570 7468 2c20 626f 756e 6461  th=depth, bounda
-000160d0: 7279 3d62 6f75 6e64 6172 792c 2074 7269  ry=boundary, tri
-000160e0: 6d3d 7472 696d 2c20 2a2a 6b77 6172 6773  m=trim, **kwargs
-000160f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00016100: 6465 6620 6375 6d73 756d 2873 656c 662c  def cumsum(self,
-00016110: 2061 7869 732c 2064 7479 7065 3d4e 6f6e   axis, dtype=Non
-00016120: 652c 206f 7574 3d4e 6f6e 652c 202a 2c20  e, out=None, *, 
-00016130: 6d65 7468 6f64 3d22 7365 7175 656e 7469  method="sequenti
-00016140: 616c 2229 3a0a 2020 2020 2020 2020 2222  al"):.        ""
-00016150: 2252 6574 7572 6e20 7468 6520 6375 6d75  "Return the cumu
-00016160: 6c61 7469 7665 2073 756d 206f 6620 7468  lative sum of th
-00016170: 6520 656c 656d 656e 7473 2061 6c6f 6e67  e elements along
-00016180: 2074 6865 2067 6976 656e 2061 7869 732e   the given axis.
-00016190: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-000161a0: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
-000161b0: 7272 6179 2e63 756d 7375 6d60 2066 6f72  rray.cumsum` for
-000161c0: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-000161d0: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-000161e0: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-000161f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00016200: 6461 736b 2e61 7272 6179 2e63 756d 7375  dask.array.cumsu
-00016210: 6d20 3a20 6571 7569 7661 6c65 6e74 2066  m : equivalent f
-00016220: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-00016230: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00016240: 2064 6173 6b2e 6172 7261 792e 7265 6475   dask.array.redu
-00016250: 6374 696f 6e73 2069 6d70 6f72 7420 6375  ctions import cu
-00016260: 6d73 756d 0a0a 2020 2020 2020 2020 7265  msum..        re
-00016270: 7475 726e 2063 756d 7375 6d28 7365 6c66  turn cumsum(self
-00016280: 2c20 6178 6973 2c20 6474 7970 652c 206f  , axis, dtype, o
-00016290: 7574 3d6f 7574 2c20 6d65 7468 6f64 3d6d  ut=out, method=m
-000162a0: 6574 686f 6429 0a0a 2020 2020 6465 6620  ethod)..    def 
-000162b0: 6375 6d70 726f 6428 7365 6c66 2c20 6178  cumprod(self, ax
-000162c0: 6973 2c20 6474 7970 653d 4e6f 6e65 2c20  is, dtype=None, 
-000162d0: 6f75 743d 4e6f 6e65 2c20 2a2c 206d 6574  out=None, *, met
-000162e0: 686f 643d 2273 6571 7565 6e74 6961 6c22  hod="sequential"
-000162f0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00016300: 7475 726e 2074 6865 2063 756d 756c 6174  turn the cumulat
-00016310: 6976 6520 7072 6f64 7563 7420 6f66 2074  ive product of t
-00016320: 6865 2065 6c65 6d65 6e74 7320 616c 6f6e  he elements alon
-00016330: 6720 7468 6520 6769 7665 6e20 6178 6973  g the given axis
-00016340: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
-00016350: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
-00016360: 6172 7261 792e 6375 6d70 726f 6460 2066  array.cumprod` f
-00016370: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-00016380: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00016390: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000163a0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000163b0: 2020 6461 736b 2e61 7272 6179 2e63 756d    dask.array.cum
-000163c0: 7072 6f64 203a 2065 7175 6976 616c 656e  prod : equivalen
-000163d0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-000163e0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-000163f0: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00016400: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-00016410: 2063 756d 7072 6f64 0a0a 2020 2020 2020   cumprod..      
-00016420: 2020 7265 7475 726e 2063 756d 7072 6f64    return cumprod
-00016430: 2873 656c 662c 2061 7869 732c 2064 7479  (self, axis, dty
-00016440: 7065 2c20 6f75 743d 6f75 742c 206d 6574  pe, out=out, met
-00016450: 686f 643d 6d65 7468 6f64 290a 0a20 2020  hod=method)..   
-00016460: 2064 6566 2073 7175 6565 7a65 2873 656c   def squeeze(sel
-00016470: 662c 2061 7869 733d 4e6f 6e65 293a 0a20  f, axis=None):. 
-00016480: 2020 2020 2020 2022 2222 5265 6d6f 7665         """Remove
-00016490: 2061 7865 7320 6f66 206c 656e 6774 6820   axes of length 
-000164a0: 6f6e 6520 6672 6f6d 2061 7272 6179 2e0a  one from array..
-000164b0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-000164c0: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-000164d0: 7261 792e 7371 7565 657a 6560 2066 6f72  ray.squeeze` for
-000164e0: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-000164f0: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00016500: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00016510: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00016520: 6461 736b 2e61 7272 6179 2e73 7175 6565  dask.array.squee
-00016530: 7a65 203a 2065 7175 6976 616c 656e 7420  ze : equivalent 
-00016540: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00016550: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00016560: 6d20 6461 736b 2e61 7272 6179 2e72 6f75  m dask.array.rou
-00016570: 7469 6e65 7320 696d 706f 7274 2073 7175  tines import squ
-00016580: 6565 7a65 0a0a 2020 2020 2020 2020 7265  eeze..        re
-00016590: 7475 726e 2073 7175 6565 7a65 2873 656c  turn squeeze(sel
-000165a0: 662c 2061 7869 7329 0a0a 2020 2020 6465  f, axis)..    de
-000165b0: 6620 7265 6368 756e 6b28 0a20 2020 2020  f rechunk(.     
-000165c0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000165d0: 2063 6875 6e6b 733d 2261 7574 6f22 2c0a   chunks="auto",.
-000165e0: 2020 2020 2020 2020 7468 7265 7368 6f6c          threshol
-000165f0: 643d 4e6f 6e65 2c0a 2020 2020 2020 2020  d=None,.        
-00016600: 626c 6f63 6b5f 7369 7a65 5f6c 696d 6974  block_size_limit
-00016610: 3d4e 6f6e 652c 0a20 2020 2020 2020 2062  =None,.        b
-00016620: 616c 616e 6365 3d46 616c 7365 2c0a 2020  alance=False,.  
-00016630: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
-00016640: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-00016650: 2020 2222 2243 6f6e 7665 7274 2062 6c6f    """Convert blo
-00016660: 636b 7320 696e 2064 6173 6b20 6172 7261  cks in dask arra
-00016670: 7920 7820 666f 7220 6e65 7720 6368 756e  y x for new chun
-00016680: 6b73 2e0a 0a20 2020 2020 2020 2052 6566  ks...        Ref
-00016690: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-000166a0: 6b2e 6172 7261 792e 7265 6368 756e 6b60  k.array.rechunk`
-000166b0: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-000166c0: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-000166d0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-000166e0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000166f0: 2020 2020 6461 736b 2e61 7272 6179 2e72      dask.array.r
-00016700: 6563 6875 6e6b 203a 2065 7175 6976 616c  echunk : equival
-00016710: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-00016720: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016730: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00016740: 2e72 6563 6875 6e6b 2069 6d70 6f72 7420  .rechunk import 
-00016750: 7265 6368 756e 6b20 2023 2061 766f 6964  rechunk  # avoid
-00016760: 2063 6972 6375 6c61 7220 696d 706f 7274   circular import
-00016770: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00016780: 2072 6563 6875 6e6b 2873 656c 662c 2063   rechunk(self, c
-00016790: 6875 6e6b 732c 2074 6872 6573 686f 6c64  hunks, threshold
-000167a0: 2c20 626c 6f63 6b5f 7369 7a65 5f6c 696d  , block_size_lim
-000167b0: 6974 2c20 6261 6c61 6e63 652c 206d 6574  it, balance, met
-000167c0: 686f 6429 0a0a 2020 2020 4070 726f 7065  hod)..    @prope
-000167d0: 7274 790a 2020 2020 6465 6620 7265 616c  rty.    def real
-000167e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000167f0: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-00016800: 7566 756e 6320 696d 706f 7274 2072 6561  ufunc import rea
-00016810: 6c0a 0a20 2020 2020 2020 2072 6574 7572  l..        retur
-00016820: 6e20 7265 616c 2873 656c 6629 0a0a 2020  n real(self)..  
-00016830: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00016840: 6465 6620 696d 6167 2873 656c 6629 3a0a  def imag(self):.
-00016850: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
-00016860: 6b2e 6172 7261 792e 7566 756e 6320 696d  k.array.ufunc im
-00016870: 706f 7274 2069 6d61 670a 0a20 2020 2020  port imag..     
-00016880: 2020 2072 6574 7572 6e20 696d 6167 2873     return imag(s
-00016890: 656c 6629 0a0a 2020 2020 6465 6620 636f  elf)..    def co
-000168a0: 6e6a 2873 656c 6629 3a0a 2020 2020 2020  nj(self):.      
-000168b0: 2020 2222 2243 6f6d 706c 6578 2d63 6f6e    """Complex-con
-000168c0: 6a75 6761 7465 2061 6c6c 2065 6c65 6d65  jugate all eleme
-000168d0: 6e74 732e 0a0a 2020 2020 2020 2020 5265  nts...        Re
-000168e0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
-000168f0: 736b 2e61 7272 6179 2e63 6f6e 6a60 2066  sk.array.conj` f
-00016900: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-00016910: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00016920: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00016930: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00016940: 2020 6461 736b 2e61 7272 6179 2e63 6f6e    dask.array.con
-00016950: 6a20 3a20 6571 7569 7661 6c65 6e74 2066  j : equivalent f
-00016960: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-00016970: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00016980: 2064 6173 6b2e 6172 7261 792e 7566 756e   dask.array.ufun
-00016990: 6320 696d 706f 7274 2063 6f6e 6a0a 0a20  c import conj.. 
-000169a0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-000169b0: 6e6a 2873 656c 6629 0a0a 2020 2020 6465  nj(self)..    de
-000169c0: 6620 636c 6970 2873 656c 662c 206d 696e  f clip(self, min
-000169d0: 3d4e 6f6e 652c 206d 6178 3d4e 6f6e 6529  =None, max=None)
-000169e0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000169f0: 7572 6e20 616e 2061 7272 6179 2077 686f  urn an array who
-00016a00: 7365 2076 616c 7565 7320 6172 6520 6c69  se values are li
-00016a10: 6d69 7465 6420 746f 2060 605b 6d69 6e2c  mited to ``[min,
-00016a20: 206d 6178 5d60 602e 0a20 2020 2020 2020   max]``..       
-00016a30: 204f 6e65 206f 6620 6d61 7820 6f72 206d   One of max or m
-00016a40: 696e 206d 7573 7420 6265 2067 6976 656e  in must be given
-00016a50: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
-00016a60: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
-00016a70: 6172 7261 792e 636c 6970 6020 666f 7220  array.clip` for 
-00016a80: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
-00016a90: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
-00016aa0: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00016ab0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00016ac0: 6173 6b2e 6172 7261 792e 636c 6970 203a  ask.array.clip :
-00016ad0: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-00016ae0: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-00016af0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00016b00: 736b 2e61 7272 6179 2e75 6675 6e63 2069  sk.array.ufunc i
-00016b10: 6d70 6f72 7420 636c 6970 0a0a 2020 2020  mport clip..    
-00016b20: 2020 2020 7265 7475 726e 2063 6c69 7028      return clip(
-00016b30: 7365 6c66 2c20 6d69 6e2c 206d 6178 290a  self, min, max).
-00016b40: 0a20 2020 2064 6566 2076 6965 7728 7365  .    def view(se
-00016b50: 6c66 2c20 6474 7970 653d 4e6f 6e65 2c20  lf, dtype=None, 
-00016b60: 6f72 6465 723d 2243 2229 3a0a 2020 2020  order="C"):.    
-00016b70: 2020 2020 2222 2247 6574 2061 2076 6965      """Get a vie
-00016b80: 7720 6f66 2074 6865 2061 7272 6179 2061  w of the array a
-00016b90: 7320 6120 6e65 7720 6461 7461 2074 7970  s a new data typ
-00016ba0: 650a 0a20 2020 2020 2020 2050 6172 616d  e..        Param
-00016bb0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00016bc0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00016bd0: 2064 7479 7065 3a0a 2020 2020 2020 2020   dtype:.        
-00016be0: 2020 2020 5468 6520 6474 7970 6520 6279      The dtype by
-00016bf0: 2077 6869 6368 2074 6f20 7669 6577 2074   which to view t
-00016c00: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
-00016c10: 2020 2020 2020 5468 6520 6465 6661 756c        The defaul
-00016c20: 742c 204e 6f6e 652c 2072 6573 756c 7473  t, None, results
-00016c30: 2069 6e20 7468 6520 7669 6577 2068 6176   in the view hav
-00016c40: 696e 6720 7468 6520 7361 6d65 2064 6174  ing the same dat
-00016c50: 612d 7479 7065 0a20 2020 2020 2020 2020  a-type.         
-00016c60: 2020 2061 7320 7468 6520 6f72 6967 696e     as the origin
-00016c70: 616c 2061 7272 6179 2e0a 2020 2020 2020  al array..      
-00016c80: 2020 6f72 6465 723a 2073 7472 696e 670a    order: string.
-00016c90: 2020 2020 2020 2020 2020 2020 2743 2720              'C' 
-00016ca0: 6f72 2027 4627 2028 466f 7274 7261 6e29  or 'F' (Fortran)
-00016cb0: 206f 7264 6572 696e 670a 0a20 2020 2020   ordering..     
-00016cc0: 2020 2054 6869 7320 7265 696e 7465 7270     This reinterp
-00016cd0: 7265 7473 2074 6865 2062 7974 6573 206f  rets the bytes o
-00016ce0: 6620 7468 6520 6172 7261 7920 756e 6465  f the array unde
-00016cf0: 7220 6120 6e65 7720 6474 7970 652e 2020  r a new dtype.  
-00016d00: 4966 2074 6861 740a 2020 2020 2020 2020  If that.        
-00016d10: 6474 7970 6520 646f 6573 206e 6f74 2068  dtype does not h
-00016d20: 6176 6520 7468 6520 7361 6d65 2073 697a  ave the same siz
-00016d30: 6520 6173 2074 6865 206f 7269 6769 6e61  e as the origina
-00016d40: 6c20 6172 7261 7920 7468 656e 2074 6865  l array then the
-00016d50: 2073 6861 7065 0a20 2020 2020 2020 2077   shape.        w
-00016d60: 696c 6c20 6368 616e 6765 2e0a 0a20 2020  ill change...   
-00016d70: 2020 2020 2042 6577 6172 6520 7468 6174       Beware that
-00016d80: 2062 6f74 6820 6e75 6d70 7920 616e 6420   both numpy and 
-00016d90: 6461 736b 2e61 7272 6179 2063 616e 2062  dask.array can b
-00016da0: 6568 6176 6520 6f64 646c 7920 7768 656e  ehave oddly when
-00016db0: 2074 616b 696e 670a 2020 2020 2020 2020   taking.        
-00016dc0: 7368 6170 652d 6368 616e 6769 6e67 2076  shape-changing v
-00016dd0: 6965 7773 206f 6620 6172 7261 7973 2075  iews of arrays u
-00016de0: 6e64 6572 2046 6f72 7472 616e 206f 7264  nder Fortran ord
-00016df0: 6572 696e 672e 2020 556e 6465 7220 736f  ering.  Under so
-00016e00: 6d65 0a20 2020 2020 2020 2076 6572 7369  me.        versi
-00016e10: 6f6e 7320 6f66 204e 756d 5079 2074 6869  ons of NumPy thi
-00016e20: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
-00016e30: 6661 696c 2077 6865 6e20 7461 6b69 6e67  fail when taking
-00016e40: 2073 6861 7065 2d63 6861 6e67 696e 670a   shape-changing.
-00016e50: 2020 2020 2020 2020 7669 6577 7320 6f66          views of
-00016e60: 2046 6f72 7472 616e 206f 7264 6572 6564   Fortran ordered
-00016e70: 2061 7272 6179 7320 6966 2074 6865 2066   arrays if the f
-00016e80: 6972 7374 2064 696d 656e 7369 6f6e 2068  irst dimension h
-00016e90: 6173 2063 6875 6e6b 7320 6f66 0a20 2020  as chunks of.   
-00016ea0: 2020 2020 2073 697a 6520 6f6e 652e 0a20       size one.. 
-00016eb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016ec0: 2020 2069 6620 6474 7970 6520 6973 204e     if dtype is N
-00016ed0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00016ee0: 2064 7479 7065 203d 2073 656c 662e 6474   dtype = self.dt
-00016ef0: 7970 650a 2020 2020 2020 2020 656c 7365  ype.        else
-00016f00: 3a0a 2020 2020 2020 2020 2020 2020 6474  :.            dt
-00016f10: 7970 6520 3d20 6e70 2e64 7479 7065 2864  ype = np.dtype(d
-00016f20: 7479 7065 290a 2020 2020 2020 2020 6d75  type).        mu
-00016f30: 6c74 203d 2073 656c 662e 6474 7970 652e  lt = self.dtype.
-00016f40: 6974 656d 7369 7a65 202f 2064 7479 7065  itemsize / dtype
-00016f50: 2e69 7465 6d73 697a 650a 0a20 2020 2020  .itemsize..     
-00016f60: 2020 2069 6620 6f72 6465 7220 3d3d 2022     if order == "
-00016f70: 4322 3a0a 2020 2020 2020 2020 2020 2020  C":.            
-00016f80: 6368 756e 6b73 203d 2073 656c 662e 6368  chunks = self.ch
-00016f90: 756e 6b73 5b3a 2d31 5d20 2b20 280a 2020  unks[:-1] + (.  
-00016fa0: 2020 2020 2020 2020 2020 2020 2020 7475                tu
-00016fb0: 706c 6528 656e 7375 7265 5f69 6e74 2863  ple(ensure_int(c
-00016fc0: 202a 206d 756c 7429 2066 6f72 2063 2069   * mult) for c i
-00016fd0: 6e20 7365 6c66 2e63 6875 6e6b 735b 2d31  n self.chunks[-1
-00016fe0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-00016ff0: 290a 2020 2020 2020 2020 656c 6966 206f  ).        elif o
-00017000: 7264 6572 203d 3d20 2246 223a 0a20 2020  rder == "F":.   
-00017010: 2020 2020 2020 2020 2063 6875 6e6b 7320           chunks 
-00017020: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00017030: 2020 2020 7475 706c 6528 656e 7375 7265      tuple(ensure
-00017040: 5f69 6e74 2863 202a 206d 756c 7429 2066  _int(c * mult) f
-00017050: 6f72 2063 2069 6e20 7365 6c66 2e63 6875  or c in self.chu
-00017060: 6e6b 735b 305d 292c 0a20 2020 2020 2020  nks[0]),.       
-00017070: 2020 2020 2029 202b 2073 656c 662e 6368       ) + self.ch
-00017080: 756e 6b73 5b31 3a5d 0a20 2020 2020 2020  unks[1:].       
-00017090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000170a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000170b0: 726f 7228 224f 7264 6572 206d 7573 7420  ror("Order must 
-000170c0: 6265 206f 6e65 206f 6620 2743 2720 6f72  be one of 'C' or
-000170d0: 2027 4627 2229 0a0a 2020 2020 2020 2020   'F'")..        
-000170e0: 7265 7475 726e 2073 656c 662e 6d61 705f  return self.map_
-000170f0: 626c 6f63 6b73 280a 2020 2020 2020 2020  blocks(.        
-00017100: 2020 2020 6368 756e 6b2e 7669 6577 2c20      chunk.view, 
-00017110: 6474 7970 652c 206f 7264 6572 3d6f 7264  dtype, order=ord
-00017120: 6572 2c20 6474 7970 653d 6474 7970 652c  er, dtype=dtype,
-00017130: 2063 6875 6e6b 733d 6368 756e 6b73 0a20   chunks=chunks. 
-00017140: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00017150: 6620 7377 6170 6178 6573 2873 656c 662c  f swapaxes(self,
-00017160: 2061 7869 7331 2c20 6178 6973 3229 3a0a   axis1, axis2):.
-00017170: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00017180: 6e20 6120 7669 6577 206f 6620 7468 6520  n a view of the 
-00017190: 6172 7261 7920 7769 7468 2060 6061 7869  array with ``axi
-000171a0: 7331 6060 2061 6e64 2060 6061 7869 7332  s1`` and ``axis2
-000171b0: 6060 2069 6e74 6572 6368 616e 6765 642e  `` interchanged.
-000171c0: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
-000171d0: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
-000171e0: 7272 6179 2e73 7761 7061 7865 7360 2066  rray.swapaxes` f
-000171f0: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-00017200: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00017210: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00017220: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00017230: 2020 6461 736b 2e61 7272 6179 2e73 7761    dask.array.swa
-00017240: 7061 7865 7320 3a20 6571 7569 7661 6c65  paxes : equivale
-00017250: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
-00017260: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00017270: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-00017280: 726f 7574 696e 6573 2069 6d70 6f72 7420  routines import 
-00017290: 7377 6170 6178 6573 0a0a 2020 2020 2020  swapaxes..      
-000172a0: 2020 7265 7475 726e 2073 7761 7061 7865    return swapaxe
-000172b0: 7328 7365 6c66 2c20 6178 6973 312c 2061  s(self, axis1, a
-000172c0: 7869 7332 290a 0a20 2020 2064 6566 2072  xis2)..    def r
-000172d0: 6f75 6e64 2873 656c 662c 2064 6563 696d  ound(self, decim
-000172e0: 616c 733d 3029 3a0a 2020 2020 2020 2020  als=0):.        
-000172f0: 2222 2252 6574 7572 6e20 6172 7261 7920  """Return array 
-00017300: 7769 7468 2065 6163 6820 656c 656d 656e  with each elemen
-00017310: 7420 726f 756e 6465 6420 746f 2074 6865  t rounded to the
-00017320: 2067 6976 656e 206e 756d 6265 7220 6f66   given number of
-00017330: 2064 6563 696d 616c 732e 0a0a 2020 2020   decimals...    
-00017340: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
-00017350: 6e63 3a60 6461 736b 2e61 7272 6179 2e72  nc:`dask.array.r
-00017360: 6f75 6e64 6020 666f 7220 6675 6c6c 2064  ound` for full d
-00017370: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
-00017380: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00017390: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000173a0: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
-000173b0: 7261 792e 726f 756e 6420 3a20 6571 7569  ray.round : equi
-000173c0: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
-000173d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000173e0: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-000173f0: 7261 792e 726f 7574 696e 6573 2069 6d70  ray.routines imp
-00017400: 6f72 7420 726f 756e 640a 0a20 2020 2020  ort round..     
-00017410: 2020 2072 6574 7572 6e20 726f 756e 6428     return round(
-00017420: 7365 6c66 2c20 6465 6369 6d61 6c73 3d64  self, decimals=d
-00017430: 6563 696d 616c 7329 0a0a 2020 2020 6465  ecimals)..    de
-00017440: 6620 636f 7079 2873 656c 6629 3a0a 2020  f copy(self):.  
-00017450: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00017460: 2020 436f 7079 2061 7272 6179 2e20 2054    Copy array.  T
-00017470: 6869 7320 6973 2061 206e 6f2d 6f70 2066  his is a no-op f
-00017480: 6f72 2064 6173 6b2e 6172 7261 7973 2c20  or dask.arrays, 
-00017490: 7768 6963 6820 6172 6520 696d 6d75 7461  which are immuta
-000174a0: 626c 650a 2020 2020 2020 2020 2222 220a  ble.        """.
-000174b0: 2020 2020 2020 2020 7265 7475 726e 2041          return A
-000174c0: 7272 6179 2873 656c 662e 6461 736b 2c20  rray(self.dask, 
-000174d0: 7365 6c66 2e6e 616d 652c 2073 656c 662e  self.name, self.
-000174e0: 6368 756e 6b73 2c20 6d65 7461 3d73 656c  chunks, meta=sel
-000174f0: 6629 0a0a 2020 2020 6465 6620 5f5f 6465  f)..    def __de
-00017500: 6570 636f 7079 5f5f 2873 656c 662c 206d  epcopy__(self, m
-00017510: 656d 6f29 3a0a 2020 2020 2020 2020 6320  emo):.        c 
-00017520: 3d20 7365 6c66 2e63 6f70 7928 290a 2020  = self.copy().  
-00017530: 2020 2020 2020 6d65 6d6f 5b69 6428 7365        memo[id(se
-00017540: 6c66 295d 203d 2063 0a20 2020 2020 2020  lf)] = c.       
-00017550: 2072 6574 7572 6e20 630a 0a20 2020 2064   return c..    d
-00017560: 6566 2074 6f5f 6465 6c61 7965 6428 7365  ef to_delayed(se
-00017570: 6c66 2c20 6f70 7469 6d69 7a65 5f67 7261  lf, optimize_gra
-00017580: 7068 3d54 7275 6529 3a0a 2020 2020 2020  ph=True):.      
-00017590: 2020 2222 2243 6f6e 7665 7274 2069 6e74    """Convert int
-000175a0: 6f20 616e 2061 7272 6179 206f 6620 3a63  o an array of :c
-000175b0: 6c61 7373 3a60 6461 736b 2e64 656c 6179  lass:`dask.delay
-000175c0: 6564 2e44 656c 6179 6564 6020 6f62 6a65  ed.Delayed` obje
-000175d0: 6374 732c 206f 6e65 2070 6572 2063 6875  cts, one per chu
-000175e0: 6e6b 2e0a 0a20 2020 2020 2020 2050 6172  nk...        Par
-000175f0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00017600: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00017610: 2020 206f 7074 696d 697a 655f 6772 6170     optimize_grap
-00017620: 6820 3a20 626f 6f6c 2c20 6f70 7469 6f6e  h : bool, option
-00017630: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
-00017640: 6620 5472 7565 205b 6465 6661 756c 745d  f True [default]
-00017650: 2c20 7468 6520 6772 6170 6820 6973 206f  , the graph is o
-00017660: 7074 696d 697a 6564 2062 6566 6f72 6520  ptimized before 
-00017670: 636f 6e76 6572 7469 6e67 2069 6e74 6f0a  converting into.
-00017680: 2020 2020 2020 2020 2020 2020 3a63 6c61              :cla
-00017690: 7373 3a60 6461 736b 2e64 656c 6179 6564  ss:`dask.delayed
-000176a0: 2e44 656c 6179 6564 6020 6f62 6a65 6374  .Delayed` object
-000176b0: 732e 0a0a 2020 2020 2020 2020 5365 6520  s...        See 
-000176c0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-000176d0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
-000176e0: 736b 2e61 7272 6179 2e66 726f 6d5f 6465  sk.array.from_de
-000176f0: 6c61 7965 640a 2020 2020 2020 2020 2222  layed.        ""
-00017700: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
-00017710: 2073 656c 662e 5f5f 6461 736b 5f6b 6579   self.__dask_key
-00017720: 735f 5f28 290a 2020 2020 2020 2020 6772  s__().        gr
-00017730: 6170 6820 3d20 7365 6c66 2e5f 5f64 6173  aph = self.__das
-00017740: 6b5f 6772 6170 685f 5f28 290a 2020 2020  k_graph__().    
-00017750: 2020 2020 6c61 7965 7220 3d20 7365 6c66      layer = self
-00017760: 2e5f 5f64 6173 6b5f 6c61 7965 7273 5f5f  .__dask_layers__
-00017770: 2829 5b30 5d0a 2020 2020 2020 2020 6966  ()[0].        if
-00017780: 206f 7074 696d 697a 655f 6772 6170 683a   optimize_graph:
-00017790: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
-000177a0: 7068 203d 2073 656c 662e 5f5f 6461 736b  ph = self.__dask
-000177b0: 5f6f 7074 696d 697a 655f 5f28 6772 6170  _optimize__(grap
-000177c0: 682c 206b 6579 7329 2020 2320 544f 444f  h, keys)  # TODO
-000177d0: 2c20 646f 6e27 7420 636f 6c6c 6170 6520  , don't collape 
-000177e0: 6772 6170 680a 2020 2020 2020 2020 2020  graph.          
-000177f0: 2020 6c61 7965 7220 3d20 2264 656c 6179    layer = "delay
-00017800: 6564 2d22 202b 2073 656c 662e 6e61 6d65  ed-" + self.name
-00017810: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
-00017820: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
-00017830: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-00017840: 696f 6e73 286c 6179 6572 2c20 6772 6170  ions(layer, grap
-00017850: 682c 2064 6570 656e 6465 6e63 6965 733d  h, dependencies=
-00017860: 2829 290a 2020 2020 2020 2020 4c20 3d20  ()).        L = 
-00017870: 6e64 6565 706d 6170 2873 656c 662e 6e64  ndeepmap(self.nd
-00017880: 696d 2c20 6c61 6d62 6461 206b 3a20 4465  im, lambda k: De
-00017890: 6c61 7965 6428 6b2c 2067 7261 7068 2c20  layed(k, graph, 
-000178a0: 6c61 7965 723d 6c61 7965 7229 2c20 6b65  layer=layer), ke
-000178b0: 7973 290a 2020 2020 2020 2020 7265 7475  ys).        retu
-000178c0: 726e 206e 702e 6172 7261 7928 4c2c 2064  rn np.array(L, d
-000178d0: 7479 7065 3d6f 626a 6563 7429 0a0a 2020  type=object)..  
-000178e0: 2020 6465 6620 7265 7065 6174 2873 656c    def repeat(sel
-000178f0: 662c 2072 6570 6561 7473 2c20 6178 6973  f, repeats, axis
-00017900: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00017910: 2222 2252 6570 6561 7420 656c 656d 656e  """Repeat elemen
-00017920: 7473 206f 6620 616e 2061 7272 6179 2e0a  ts of an array..
-00017930: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00017940: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00017950: 7261 792e 7265 7065 6174 6020 666f 7220  ray.repeat` for 
-00017960: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
-00017970: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
-00017980: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00017990: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-000179a0: 6173 6b2e 6172 7261 792e 7265 7065 6174  ask.array.repeat
-000179b0: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
-000179c0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-000179d0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-000179e0: 6461 736b 2e61 7272 6179 2e63 7265 6174  dask.array.creat
-000179f0: 696f 6e20 696d 706f 7274 2072 6570 6561  ion import repea
-00017a00: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
-00017a10: 6e20 7265 7065 6174 2873 656c 662c 2072  n repeat(self, r
-00017a20: 6570 6561 7473 2c20 6178 6973 3d61 7869  epeats, axis=axi
-00017a30: 7329 0a0a 2020 2020 6465 6620 6e6f 6e7a  s)..    def nonz
-00017a40: 6572 6f28 7365 6c66 293a 0a20 2020 2020  ero(self):.     
-00017a50: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
-00017a60: 2069 6e64 6963 6573 206f 6620 7468 6520   indices of the 
-00017a70: 656c 656d 656e 7473 2074 6861 7420 6172  elements that ar
-00017a80: 6520 6e6f 6e2d 7a65 726f 2e0a 0a20 2020  e non-zero...   
-00017a90: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
-00017aa0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-00017ab0: 6e6f 6e7a 6572 6f60 2066 6f72 2066 756c  nonzero` for ful
-00017ac0: 6c20 646f 6375 6d65 6e74 6174 696f 6e2e  l documentation.
-00017ad0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-00017ae0: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-00017af0: 2d2d 2d0a 2020 2020 2020 2020 6461 736b  ---.        dask
-00017b00: 2e61 7272 6179 2e6e 6f6e 7a65 726f 203a  .array.nonzero :
-00017b10: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-00017b20: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-00017b30: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00017b40: 736b 2e61 7272 6179 2e72 6f75 7469 6e65  sk.array.routine
-00017b50: 7320 696d 706f 7274 206e 6f6e 7a65 726f  s import nonzero
-00017b60: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00017b70: 206e 6f6e 7a65 726f 2873 656c 6629 0a0a   nonzero(self)..
-00017b80: 2020 2020 6465 6620 746f 5f7a 6172 7228      def to_zarr(
-00017b90: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-00017ba0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00017bb0: 2222 2253 6176 6520 6172 7261 7920 746f  """Save array to
-00017bc0: 2074 6865 207a 6172 7220 7374 6f72 6167   the zarr storag
-00017bd0: 6520 666f 726d 6174 0a0a 2020 2020 2020  e format..      
-00017be0: 2020 5365 6520 6874 7470 733a 2f2f 7a61    See https://za
-00017bf0: 7272 2e72 6561 6474 6865 646f 6373 2e69  rr.readthedocs.i
-00017c00: 6f20 666f 7220 6465 7461 696c 7320 6162  o for details ab
-00017c10: 6f75 7420 7468 6520 666f 726d 6174 2e0a  out the format..
-00017c20: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00017c30: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00017c40: 7261 792e 746f 5f7a 6172 7260 2066 6f72  ray.to_zarr` for
-00017c50: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00017c60: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00017c70: 6520 616c 736f 0a20 2020 2020 2020 202d  e also.        -
-00017c80: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00017c90: 6461 736b 2e61 7272 6179 2e74 6f5f 7a61  dask.array.to_za
-00017ca0: 7272 203a 2065 7175 6976 616c 656e 7420  rr : equivalent 
-00017cb0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00017cc0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00017cd0: 7572 6e20 746f 5f7a 6172 7228 7365 6c66  urn to_zarr(self
-00017ce0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-00017cf0: 7329 0a0a 2020 2020 6465 6620 746f 5f74  s)..    def to_t
-00017d00: 696c 6564 6228 7365 6c66 2c20 7572 692c  iledb(self, uri,
-00017d10: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00017d20: 293a 0a20 2020 2020 2020 2022 2222 5361  ):.        """Sa
-00017d30: 7665 2061 7272 6179 2074 6f20 7468 6520  ve array to the 
-00017d40: 5469 6c65 4442 2073 746f 7261 6765 206d  TileDB storage m
-00017d50: 616e 6167 6572 0a0a 2020 2020 2020 2020  anager..        
-00017d60: 5365 6520 6874 7470 733a 2f2f 646f 6373  See https://docs
-00017d70: 2e74 696c 6564 622e 696f 2066 6f72 2064  .tiledb.io for d
-00017d80: 6574 6169 6c73 2061 626f 7574 2074 6865  etails about the
-00017d90: 2066 6f72 6d61 7420 616e 6420 656e 6769   format and engi
-00017da0: 6e65 2e0a 0a20 2020 2020 2020 2053 6565  ne...        See
-00017db0: 2066 756e 6374 696f 6e20 3a66 756e 633a   function :func:
-00017dc0: 6064 6173 6b2e 6172 7261 792e 746f 5f74  `dask.array.to_t
-00017dd0: 696c 6564 6260 2066 6f72 2061 7267 756d  iledb` for argum
-00017de0: 656e 7420 646f 6375 6d65 6e74 6174 696f  ent documentatio
-00017df0: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
-00017e00: 616c 736f 0a20 2020 2020 2020 202d 2d2d  also.        ---
-00017e10: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
-00017e20: 736b 2e61 7272 6179 2e74 6f5f 7469 6c65  sk.array.to_tile
-00017e30: 6462 203a 2065 7175 6976 616c 656e 7420  db : equivalent 
-00017e40: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00017e50: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00017e60: 6d20 6461 736b 2e61 7272 6179 2e74 696c  m dask.array.til
-00017e70: 6564 625f 696f 2069 6d70 6f72 7420 746f  edb_io import to
-00017e80: 5f74 696c 6564 620a 0a20 2020 2020 2020  _tiledb..       
-00017e90: 2072 6574 7572 6e20 746f 5f74 696c 6564   return to_tiled
-00017ea0: 6228 7365 6c66 2c20 7572 692c 202a 6172  b(self, uri, *ar
-00017eb0: 6773 2c20 2a2a 6b77 6172 6773 290a 0a0a  gs, **kwargs)...
-00017ec0: 6465 6620 656e 7375 7265 5f69 6e74 2866  def ensure_int(f
-00017ed0: 293a 0a20 2020 2069 203d 2069 6e74 2866  ):.    i = int(f
-00017ee0: 290a 2020 2020 6966 2069 2021 3d20 663a  ).    if i != f:
-00017ef0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-00017f00: 616c 7565 4572 726f 7228 2243 6f75 6c64  alueError("Could
-00017f10: 206e 6f74 2063 6f65 7263 6520 2566 2074   not coerce %f t
-00017f20: 6f20 696e 7465 6765 7222 2025 2066 290a  o integer" % f).
-00017f30: 2020 2020 7265 7475 726e 2069 0a0a 0a64      return i...d
-00017f40: 6566 206e 6f72 6d61 6c69 7a65 5f63 6875  ef normalize_chu
-00017f50: 6e6b 7328 6368 756e 6b73 2c20 7368 6170  nks(chunks, shap
-00017f60: 653d 4e6f 6e65 2c20 6c69 6d69 743d 4e6f  e=None, limit=No
-00017f70: 6e65 2c20 6474 7970 653d 4e6f 6e65 2c20  ne, dtype=None, 
-00017f80: 7072 6576 696f 7573 5f63 6875 6e6b 733d  previous_chunks=
-00017f90: 4e6f 6e65 293a 0a20 2020 2022 2222 4e6f  None):.    """No
-00017fa0: 726d 616c 697a 6520 6368 756e 6b73 2074  rmalize chunks t
-00017fb0: 6f20 7475 706c 6520 6f66 2074 7570 6c65  o tuple of tuple
-00017fc0: 730a 0a20 2020 2054 6869 7320 7461 6b65  s..    This take
-00017fd0: 7320 696e 2061 2076 6172 6965 7479 206f  s in a variety o
-00017fe0: 6620 696e 7075 7420 7479 7065 7320 616e  f input types an
-00017ff0: 6420 696e 666f 726d 6174 696f 6e20 616e  d information an
-00018000: 6420 7072 6f64 7563 6573 2061 2066 756c  d produces a ful
-00018010: 6c0a 2020 2020 7475 706c 652d 6f66 2d74  l.    tuple-of-t
-00018020: 7570 6c65 7320 7265 7375 6c74 2066 6f72  uples result for
-00018030: 2063 6875 6e6b 732c 2073 7569 7461 626c   chunks, suitabl
-00018040: 6520 746f 2062 6520 7061 7373 6564 2074  e to be passed t
-00018050: 6f20 4172 7261 7920 6f72 0a20 2020 2072  o Array or.    r
-00018060: 6563 6875 6e6b 206f 7220 616e 7920 6f74  echunk or any ot
-00018070: 6865 7220 6f70 6572 6174 696f 6e20 7468  her operation th
-00018080: 6174 2063 7265 6174 6573 2061 2044 6173  at creates a Das
-00018090: 6b20 6172 7261 792e 0a0a 2020 2020 5061  k array...    Pa
-000180a0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-000180b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6368 756e  -------.    chun
-000180c0: 6b73 3a20 7475 706c 652c 2069 6e74 2c20  ks: tuple, int, 
-000180d0: 6469 6374 2c20 6f72 2073 7472 696e 670a  dict, or string.
-000180e0: 2020 2020 2020 2020 5468 6520 6368 756e          The chun
-000180f0: 6b73 2074 6f20 6265 206e 6f72 6d61 6c69  ks to be normali
-00018100: 7a65 642e 2020 5365 6520 6578 616d 706c  zed.  See exampl
-00018110: 6573 2062 656c 6f77 2066 6f72 206d 6f72  es below for mor
-00018120: 6520 6465 7461 696c 730a 2020 2020 7368  e details.    sh
-00018130: 6170 653a 2054 7570 6c65 5b69 6e74 5d0a  ape: Tuple[int].
-00018140: 2020 2020 2020 2020 5468 6520 7368 6170          The shap
-00018150: 6520 6f66 2074 6865 2061 7272 6179 0a20  e of the array. 
-00018160: 2020 206c 696d 6974 3a20 696e 7420 286f     limit: int (o
-00018170: 7074 696f 6e61 6c29 0a20 2020 2020 2020  ptional).       
-00018180: 2054 6865 206d 6178 696d 756d 2062 6c6f   The maximum blo
-00018190: 636b 2073 697a 6520 746f 2074 6172 6765  ck size to targe
-000181a0: 7420 696e 2062 7974 6573 2c0a 2020 2020  t in bytes,.    
-000181b0: 2020 2020 6966 2066 7265 6564 6f6d 2069      if freedom i
-000181c0: 7320 6769 7665 6e20 746f 2063 686f 6f73  s given to choos
-000181d0: 650a 2020 2020 6474 7970 653a 206e 702e  e.    dtype: np.
-000181e0: 6474 7970 650a 2020 2020 7072 6576 696f  dtype.    previo
-000181f0: 7573 5f63 6875 6e6b 733a 2054 7570 6c65  us_chunks: Tuple
-00018200: 5b54 7570 6c65 5b69 6e74 5d5d 206f 7074  [Tuple[int]] opt
-00018210: 696f 6e61 6c0a 2020 2020 2020 2020 4368  ional.        Ch
-00018220: 756e 6b73 2066 726f 6d20 6120 7072 6576  unks from a prev
-00018230: 696f 7573 2061 7272 6179 2074 6861 7420  ious array that 
-00018240: 7765 2073 686f 756c 6420 7573 6520 666f  we should use fo
-00018250: 7220 696e 7370 6972 6174 696f 6e20 7768  r inspiration wh
-00018260: 656e 0a20 2020 2020 2020 2072 6563 6875  en.        rechu
-00018270: 6e6b 696e 6720 6175 746f 2064 696d 656e  nking auto dimen
-00018280: 7369 6f6e 732e 2020 4966 206e 6f74 2070  sions.  If not p
-00018290: 726f 7669 6465 6420 6275 7420 6175 746f  rovided but auto
-000182a0: 2d63 6875 6e6b 696e 6720 6578 6973 7473  -chunking exists
-000182b0: 0a20 2020 2020 2020 2074 6865 6e20 6175  .        then au
-000182c0: 746f 2d64 696d 656e 7369 6f6e 7320 7769  to-dimensions wi
-000182d0: 6c6c 2070 7265 6665 7220 7371 7561 7265  ll prefer square
-000182e0: 2d6c 696b 6520 6368 756e 6b20 7368 6170  -like chunk shap
-000182f0: 6573 2e0a 0a20 2020 2045 7861 6d70 6c65  es...    Example
-00018300: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
-00018310: 2020 2053 7065 6369 6679 2075 6e69 666f     Specify unifo
-00018320: 726d 2063 6875 6e6b 2073 697a 6573 0a0a  rm chunk sizes..
-00018330: 2020 2020 3e3e 3e20 6672 6f6d 2064 6173      >>> from das
-00018340: 6b2e 6172 7261 792e 636f 7265 2069 6d70  k.array.core imp
-00018350: 6f72 7420 6e6f 726d 616c 697a 655f 6368  ort normalize_ch
-00018360: 756e 6b73 0a20 2020 203e 3e3e 206e 6f72  unks.    >>> nor
-00018370: 6d61 6c69 7a65 5f63 6875 6e6b 7328 2832  malize_chunks((2
-00018380: 2c20 3229 2c20 7368 6170 653d 2835 2c20  , 2), shape=(5, 
-00018390: 3629 290a 2020 2020 2828 322c 2032 2c20  6)).    ((2, 2, 
-000183a0: 3129 2c20 2832 2c20 322c 2032 2929 0a0a  1), (2, 2, 2))..
-000183b0: 2020 2020 416c 736f 2070 6173 7365 7320      Also passes 
-000183c0: 7468 726f 7567 6820 6675 6c6c 7920 6578  through fully ex
-000183d0: 706c 6963 6974 2074 7570 6c65 2d6f 662d  plicit tuple-of-
-000183e0: 7475 706c 6573 0a0a 2020 2020 3e3e 3e20  tuples..    >>> 
-000183f0: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
-00018400: 2828 2832 2c20 322c 2031 292c 2028 322c  (((2, 2, 1), (2,
-00018410: 2032 2c20 3229 292c 2073 6861 7065 3d28   2, 2)), shape=(
-00018420: 352c 2036 2929 0a20 2020 2028 2832 2c20  5, 6)).    ((2, 
-00018430: 322c 2031 292c 2028 322c 2032 2c20 3229  2, 1), (2, 2, 2)
-00018440: 290a 0a20 2020 2043 6c65 616e 7320 7570  )..    Cleans up
-00018450: 206c 6973 7473 2074 6f20 7475 706c 6573   lists to tuples
-00018460: 0a0a 2020 2020 3e3e 3e20 6e6f 726d 616c  ..    >>> normal
-00018470: 697a 655f 6368 756e 6b73 285b 5b32 2c20  ize_chunks([[2, 
-00018480: 325d 2c20 5b33 2c20 335d 5d29 0a20 2020  2], [3, 3]]).   
-00018490: 2028 2832 2c20 3229 2c20 2833 2c20 3329   ((2, 2), (3, 3)
-000184a0: 290a 0a20 2020 2045 7870 616e 6473 2069  )..    Expands i
-000184b0: 6e74 6567 6572 2069 6e70 7574 7320 3130  nteger inputs 10
-000184c0: 202d 3e20 2831 302c 2031 3029 0a0a 2020   -> (10, 10)..  
-000184d0: 2020 3e3e 3e20 6e6f 726d 616c 697a 655f    >>> normalize_
-000184e0: 6368 756e 6b73 2831 302c 2073 6861 7065  chunks(10, shape
-000184f0: 3d28 3330 2c20 3529 290a 2020 2020 2828  =(30, 5)).    ((
-00018500: 3130 2c20 3130 2c20 3130 292c 2028 352c  10, 10, 10), (5,
-00018510: 2929 0a0a 2020 2020 4578 7061 6e64 7320  ))..    Expands 
-00018520: 6469 6374 2069 6e70 7574 730a 0a20 2020  dict inputs..   
-00018530: 203e 3e3e 206e 6f72 6d61 6c69 7a65 5f63   >>> normalize_c
-00018540: 6875 6e6b 7328 7b30 3a20 322c 2031 3a20  hunks({0: 2, 1: 
-00018550: 337d 2c20 7368 6170 653d 2836 2c20 3629  3}, shape=(6, 6)
-00018560: 290a 2020 2020 2828 322c 2032 2c20 3229  ).    ((2, 2, 2)
-00018570: 2c20 2833 2c20 3329 290a 0a20 2020 2054  , (3, 3))..    T
-00018580: 6865 2076 616c 7565 7320 2d31 2061 6e64  he values -1 and
-00018590: 204e 6f6e 6520 6765 7420 6d61 7070 6564   None get mapped
-000185a0: 2074 6f20 6675 6c6c 2073 697a 650a 0a20   to full size.. 
-000185b0: 2020 203e 3e3e 206e 6f72 6d61 6c69 7a65     >>> normalize
-000185c0: 5f63 6875 6e6b 7328 2835 2c20 2d31 292c  _chunks((5, -1),
-000185d0: 2073 6861 7065 3d28 3130 2c20 3130 2929   shape=(10, 10))
-000185e0: 0a20 2020 2028 2835 2c20 3529 2c20 2831  .    ((5, 5), (1
-000185f0: 302c 2929 0a0a 2020 2020 5573 6520 7468  0,))..    Use th
-00018600: 6520 7661 6c75 6520 2261 7574 6f22 2074  e value "auto" t
-00018610: 6f20 6175 746f 6d61 7469 6361 6c6c 7920  o automatically 
-00018620: 6465 7465 726d 696e 6520 6368 756e 6b20  determine chunk 
-00018630: 7369 7a65 7320 616c 6f6e 6720 6365 7274  sizes along cert
-00018640: 6169 6e0a 2020 2020 6469 6d65 6e73 696f  ain.    dimensio
-00018650: 6e73 2e20 2054 6869 7320 7573 6573 2074  ns.  This uses t
-00018660: 6865 2060 606c 696d 6974 3d60 6020 616e  he ``limit=`` an
-00018670: 6420 6060 6474 7970 653d 6060 206b 6579  d ``dtype=`` key
-00018680: 776f 7264 7320 746f 0a20 2020 2064 6574  words to.    det
-00018690: 6572 6d69 6e65 2068 6f77 206c 6172 6765  ermine how large
-000186a0: 2074 6f20 6d61 6b65 2074 6865 2063 6875   to make the chu
-000186b0: 6e6b 732e 2020 5468 6520 7465 726d 2022  nks.  The term "
-000186c0: 6175 746f 2220 6361 6e20 6265 2075 7365  auto" can be use
-000186d0: 640a 2020 2020 616e 7977 6865 7265 2061  d.    anywhere a
-000186e0: 6e20 696e 7465 6765 7220 6361 6e20 6265  n integer can be
-000186f0: 2075 7365 642e 2020 5365 6520 6172 7261   used.  See arra
-00018700: 7920 6368 756e 6b69 6e67 2064 6f63 756d  y chunking docum
-00018710: 656e 7461 7469 6f6e 2066 6f72 206d 6f72  entation for mor
-00018720: 650a 2020 2020 696e 666f 726d 6174 696f  e.    informatio
-00018730: 6e2e 0a0a 2020 2020 3e3e 3e20 6e6f 726d  n...    >>> norm
-00018740: 616c 697a 655f 6368 756e 6b73 2828 2261  alize_chunks(("a
-00018750: 7574 6f22 2c29 2c20 7368 6170 653d 2832  uto",), shape=(2
-00018760: 302c 292c 206c 696d 6974 3d35 2c20 6474  0,), limit=5, dt
-00018770: 7970 653d 2775 696e 7438 2729 0a20 2020  ype='uint8').   
-00018780: 2028 2835 2c20 352c 2035 2c20 3529 2c29   ((5, 5, 5, 5),)
-00018790: 0a0a 2020 2020 596f 7520 6361 6e20 616c  ..    You can al
-000187a0: 736f 2075 7365 2062 7974 6520 7369 7a65  so use byte size
-000187b0: 7320 2873 6565 203a 6675 6e63 3a60 6461  s (see :func:`da
-000187c0: 736b 2e75 7469 6c73 2e70 6172 7365 5f62  sk.utils.parse_b
-000187d0: 7974 6573 6029 2069 6e20 706c 6163 6520  ytes`) in place 
-000187e0: 6f66 0a20 2020 2022 6175 746f 2220 746f  of.    "auto" to
-000187f0: 2061 736b 2066 6f72 2061 2070 6172 7469   ask for a parti
-00018800: 6375 6c61 7220 7369 7a65 0a0a 2020 2020  cular size..    
-00018810: 3e3e 3e20 6e6f 726d 616c 697a 655f 6368  >>> normalize_ch
-00018820: 756e 6b73 2822 316b 6942 222c 2073 6861  unks("1kiB", sha
-00018830: 7065 3d28 3230 3030 2c29 2c20 6474 7970  pe=(2000,), dtyp
-00018840: 653d 2766 6c6f 6174 3332 2729 0a20 2020  e='float32').   
-00018850: 2028 2832 3536 2c20 3235 362c 2032 3536   ((256, 256, 256
-00018860: 2c20 3235 362c 2032 3536 2c20 3235 362c  , 256, 256, 256,
-00018870: 2032 3536 2c20 3230 3829 2c29 0a0a 2020   256, 208),)..  
-00018880: 2020 5265 7370 6563 7473 206e 756c 6c20    Respects null 
-00018890: 6469 6d65 6e73 696f 6e73 0a0a 2020 2020  dimensions..    
-000188a0: 3e3e 3e20 6e6f 726d 616c 697a 655f 6368  >>> normalize_ch
-000188b0: 756e 6b73 2828 292c 2073 6861 7065 3d28  unks((), shape=(
-000188c0: 302c 2030 2929 0a20 2020 2028 2830 2c29  0, 0)).    ((0,)
-000188d0: 2c20 2830 2c29 290a 2020 2020 2222 220a  , (0,)).    """.
-000188e0: 2020 2020 6966 2064 7479 7065 2061 6e64      if dtype and
-000188f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00018900: 6474 7970 652c 206e 702e 6474 7970 6529  dtype, np.dtype)
-00018910: 3a0a 2020 2020 2020 2020 6474 7970 6520  :.        dtype 
-00018920: 3d20 6e70 2e64 7479 7065 2864 7479 7065  = np.dtype(dtype
-00018930: 290a 2020 2020 6966 2063 6875 6e6b 7320  ).    if chunks 
-00018940: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00018950: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00018960: 7228 4348 554e 4b53 5f4e 4f4e 455f 4552  r(CHUNKS_NONE_ER
-00018970: 524f 525f 4d45 5353 4147 4529 0a20 2020  ROR_MESSAGE).   
-00018980: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00018990: 6875 6e6b 732c 206c 6973 7429 3a0a 2020  hunks, list):.  
-000189a0: 2020 2020 2020 6368 756e 6b73 203d 2074        chunks = t
-000189b0: 7570 6c65 2863 6875 6e6b 7329 0a20 2020  uple(chunks).   
-000189c0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-000189d0: 6875 6e6b 732c 2028 4e75 6d62 6572 2c20  hunks, (Number, 
-000189e0: 7374 7229 293a 0a20 2020 2020 2020 2063  str)):.        c
-000189f0: 6875 6e6b 7320 3d20 2863 6875 6e6b 732c  hunks = (chunks,
-00018a00: 2920 2a20 6c65 6e28 7368 6170 6529 0a20  ) * len(shape). 
-00018a10: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00018a20: 2863 6875 6e6b 732c 2064 6963 7429 3a0a  (chunks, dict):.
-00018a30: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
-00018a40: 2074 7570 6c65 2863 6875 6e6b 732e 6765   tuple(chunks.ge
-00018a50: 7428 692c 204e 6f6e 6529 2066 6f72 2069  t(i, None) for i
-00018a60: 2069 6e20 7261 6e67 6528 6c65 6e28 7368   in range(len(sh
-00018a70: 6170 6529 2929 0a20 2020 2069 6620 6973  ape))).    if is
-00018a80: 696e 7374 616e 6365 2863 6875 6e6b 732c  instance(chunks,
-00018a90: 206e 702e 6e64 6172 7261 7929 3a0a 2020   np.ndarray):.  
-00018aa0: 2020 2020 2020 6368 756e 6b73 203d 2063        chunks = c
-00018ab0: 6875 6e6b 732e 746f 6c69 7374 2829 0a20  hunks.tolist(). 
-00018ac0: 2020 2069 6620 6e6f 7420 6368 756e 6b73     if not chunks
-00018ad0: 2061 6e64 2073 6861 7065 2061 6e64 2061   and shape and a
-00018ae0: 6c6c 2873 203d 3d20 3020 666f 7220 7320  ll(s == 0 for s 
-00018af0: 696e 2073 6861 7065 293a 0a20 2020 2020  in shape):.     
-00018b00: 2020 2063 6875 6e6b 7320 3d20 2828 302c     chunks = ((0,
-00018b10: 292c 2920 2a20 6c65 6e28 7368 6170 6529  ),) * len(shape)
-00018b20: 0a0a 2020 2020 6966 2028 0a20 2020 2020  ..    if (.     
-00018b30: 2020 2073 6861 7065 0a20 2020 2020 2020     shape.       
-00018b40: 2061 6e64 206c 656e 2873 6861 7065 2920   and len(shape) 
-00018b50: 3d3d 2031 0a20 2020 2020 2020 2061 6e64  == 1.        and
-00018b60: 206c 656e 2863 6875 6e6b 7329 203e 2031   len(chunks) > 1
-00018b70: 0a20 2020 2020 2020 2061 6e64 2061 6c6c  .        and all
-00018b80: 2869 7369 6e73 7461 6e63 6528 632c 2028  (isinstance(c, (
-00018b90: 4e75 6d62 6572 2c20 7374 7229 2920 666f  Number, str)) fo
-00018ba0: 7220 6320 696e 2063 6875 6e6b 7329 0a20  r c in chunks). 
-00018bb0: 2020 2029 3a0a 2020 2020 2020 2020 6368     ):.        ch
-00018bc0: 756e 6b73 203d 2028 6368 756e 6b73 2c29  unks = (chunks,)
-00018bd0: 0a0a 2020 2020 6966 2073 6861 7065 2061  ..    if shape a
-00018be0: 6e64 206c 656e 2863 6875 6e6b 7329 2021  nd len(chunks) !
-00018bf0: 3d20 6c65 6e28 7368 6170 6529 3a0a 2020  = len(shape):.  
-00018c00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00018c10: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00018c20: 2020 2020 2243 6875 6e6b 7320 616e 6420      "Chunks and 
-00018c30: 7368 6170 6520 6d75 7374 2062 6520 6f66  shape must be of
-00018c40: 2074 6865 2073 616d 6520 6c65 6e67 7468   the same length
-00018c50: 2f64 696d 656e 7369 6f6e 2e20 220a 2020  /dimension. ".  
-00018c60: 2020 2020 2020 2020 2020 2247 6f74 2063            "Got c
-00018c70: 6875 6e6b 733d 2573 2c20 7368 6170 653d  hunks=%s, shape=
-00018c80: 2573 2220 2520 2863 6875 6e6b 732c 2073  %s" % (chunks, s
-00018c90: 6861 7065 290a 2020 2020 2020 2020 290a  hape).        ).
-00018ca0: 2020 2020 6966 202d 3120 696e 2063 6875      if -1 in chu
-00018cb0: 6e6b 7320 6f72 204e 6f6e 6520 696e 2063  nks or None in c
-00018cc0: 6875 6e6b 733a 0a20 2020 2020 2020 2063  hunks:.        c
-00018cd0: 6875 6e6b 7320 3d20 7475 706c 6528 7320  hunks = tuple(s 
-00018ce0: 6966 2063 203d 3d20 2d31 206f 7220 6320  if c == -1 or c 
-00018cf0: 6973 204e 6f6e 6520 656c 7365 2063 2066  is None else c f
-00018d00: 6f72 2063 2c20 7320 696e 207a 6970 2863  or c, s in zip(c
-00018d10: 6875 6e6b 732c 2073 6861 7065 2929 0a0a  hunks, shape))..
-00018d20: 2020 2020 2320 4966 2073 7065 6369 6679      # If specify
-00018d30: 696e 6720 6368 756e 6b20 7369 7a65 2069  ing chunk size i
-00018d40: 6e20 6279 7465 732c 2075 7365 2074 6861  n bytes, use tha
-00018d50: 7420 7661 6c75 6520 746f 2073 6574 2074  t value to set t
-00018d60: 6865 206c 696d 6974 2e0a 2020 2020 2320  he limit..    # 
-00018d70: 5665 7269 6679 2074 6865 7265 2069 7320  Verify there is 
-00018d80: 6f6e 6c79 206f 6e65 2063 6f6e 7369 7374  only one consist
-00018d90: 656e 7420 7661 6c75 6520 6f66 206c 696d  ent value of lim
-00018da0: 6974 206f 7220 6368 756e 6b2d 6279 7465  it or chunk-byte
-00018db0: 7320 7573 6564 2e0a 2020 2020 666f 7220  s used..    for 
-00018dc0: 6320 696e 2063 6875 6e6b 733a 0a20 2020  c in chunks:.   
-00018dd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00018de0: 6365 2863 2c20 7374 7229 2061 6e64 2063  ce(c, str) and c
-00018df0: 2021 3d20 2261 7574 6f22 3a0a 2020 2020   != "auto":.    
-00018e00: 2020 2020 2020 2020 7061 7273 6564 203d          parsed =
-00018e10: 2070 6172 7365 5f62 7974 6573 2863 290a   parse_bytes(c).
-00018e20: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00018e30: 696d 6974 2069 7320 4e6f 6e65 3a0a 2020  imit is None:.  
-00018e40: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00018e50: 6d69 7420 3d20 7061 7273 6564 0a20 2020  mit = parsed.   
-00018e60: 2020 2020 2020 2020 2065 6c69 6620 7061           elif pa
-00018e70: 7273 6564 2021 3d20 6c69 6d69 743a 0a20  rsed != limit:. 
-00018e80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00018e90: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00018ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018eb0: 2020 2020 2022 4f6e 6c79 206f 6e65 2063       "Only one c
-00018ec0: 6f6e 7369 7374 656e 7420 7661 6c75 6520  onsistent value 
-00018ed0: 6f66 206c 696d 6974 206f 7220 6368 756e  of limit or chun
-00018ee0: 6b20 6973 2061 6c6c 6f77 6564 2e22 0a20  k is allowed.". 
-00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f00: 2020 2022 5573 6564 2025 7320 213d 2025     "Used %s != %
-00018f10: 7322 2025 2028 7061 7273 6564 2c20 6c69  s" % (parsed, li
-00018f20: 6d69 7429 0a20 2020 2020 2020 2020 2020  mit).           
-00018f30: 2020 2020 2029 0a20 2020 2023 2053 7562       ).    # Sub
-00018f40: 7374 6974 7574 6520 6279 7465 206c 696d  stitute byte lim
-00018f50: 6974 7320 7769 7468 2027 6175 746f 2720  its with 'auto' 
-00018f60: 6e6f 7720 7468 6174 206c 696d 6974 2069  now that limit i
-00018f70: 7320 7365 742e 0a20 2020 2063 6875 6e6b  s set..    chunk
-00018f80: 7320 3d20 7475 706c 6528 2261 7574 6f22  s = tuple("auto"
-00018f90: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00018fa0: 2c20 7374 7229 2061 6e64 2063 2021 3d20  , str) and c != 
-00018fb0: 2261 7574 6f22 2065 6c73 6520 6320 666f  "auto" else c fo
-00018fc0: 7220 6320 696e 2063 6875 6e6b 7329 0a0a  r c in chunks)..
-00018fd0: 2020 2020 6966 2061 6e79 2863 203d 3d20      if any(c == 
-00018fe0: 2261 7574 6f22 2066 6f72 2063 2069 6e20  "auto" for c in 
-00018ff0: 6368 756e 6b73 293a 0a20 2020 2020 2020  chunks):.       
-00019000: 2063 6875 6e6b 7320 3d20 6175 746f 5f63   chunks = auto_c
-00019010: 6875 6e6b 7328 6368 756e 6b73 2c20 7368  hunks(chunks, sh
-00019020: 6170 652c 206c 696d 6974 2c20 6474 7970  ape, limit, dtyp
-00019030: 652c 2070 7265 7669 6f75 735f 6368 756e  e, previous_chun
-00019040: 6b73 290a 0a20 2020 2069 6620 7368 6170  ks)..    if shap
-00019050: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00019060: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
-00019070: 7475 706c 6528 6320 6966 2063 206e 6f74  tuple(c if c not
-00019080: 2069 6e20 7b4e 6f6e 652c 202d 317d 2065   in {None, -1} e
-00019090: 6c73 6520 7320 666f 7220 632c 2073 2069  lse s for c, s i
-000190a0: 6e20 7a69 7028 6368 756e 6b73 2c20 7368  n zip(chunks, sh
-000190b0: 6170 6529 290a 0a20 2020 2069 6620 6368  ape))..    if ch
-000190c0: 756e 6b73 2061 6e64 2073 6861 7065 2069  unks and shape i
-000190d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000190e0: 2020 2020 6368 756e 6b73 203d 2073 756d      chunks = sum
-000190f0: 280a 2020 2020 2020 2020 2020 2020 280a  (.            (.
-00019100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019110: 626c 6f63 6b64 696d 735f 6672 6f6d 5f62  blockdims_from_b
-00019120: 6c6f 636b 7368 6170 6528 2873 2c29 2c20  lockshape((s,), 
-00019130: 2863 2c29 290a 2020 2020 2020 2020 2020  (c,)).          
-00019140: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00019150: 6e73 7461 6e63 6528 632c 2028 7475 706c  nstance(c, (tupl
-00019160: 652c 206c 6973 7429 290a 2020 2020 2020  e, list)).      
-00019170: 2020 2020 2020 2020 2020 656c 7365 2028            else (
-00019180: 632c 290a 2020 2020 2020 2020 2020 2020  c,).            
-00019190: 2020 2020 666f 7220 732c 2063 2069 6e20      for s, c in 
-000191a0: 7a69 7028 7368 6170 652c 2063 6875 6e6b  zip(shape, chunk
-000191b0: 7329 0a20 2020 2020 2020 2020 2020 2029  s).            )
-000191c0: 2c0a 2020 2020 2020 2020 2020 2020 2829  ,.            ()
-000191d0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-000191e0: 666f 7220 6320 696e 2063 6875 6e6b 733a  for c in chunks:
-000191f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00019200: 633a 0a20 2020 2020 2020 2020 2020 2072  c:.            r
-00019210: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00019220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019230: 2022 456d 7074 7920 7475 706c 6573 2061   "Empty tuples a
-00019240: 7265 206e 6f74 2061 6c6c 6f77 6564 2069  re not allowed i
-00019250: 6e20 6368 756e 6b73 2e20 4578 7072 6573  n chunks. Expres
-00019260: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00019270: 2020 2020 227a 6572 6f20 6c65 6e67 7468      "zero length
-00019280: 2064 696d 656e 7369 6f6e 7320 7769 7468   dimensions with
-00019290: 2030 2873 2920 696e 2063 6875 6e6b 7322   0(s) in chunks"
-000192a0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-000192b0: 2020 2020 6966 2073 6861 7065 2069 7320      if shape is 
-000192c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000192d0: 2020 6966 206c 656e 2863 6875 6e6b 7329    if len(chunks)
-000192e0: 2021 3d20 6c65 6e28 7368 6170 6529 3a0a   != len(shape):.
-000192f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00019300: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00019310: 2020 2020 2020 2020 2020 2020 2020 2249                "I
-00019320: 6e70 7574 2061 7272 6179 2068 6173 2025  nput array has %
-00019330: 6420 6469 6d65 6e73 696f 6e73 2062 7574  d dimensions but
-00019340: 2074 6865 2073 7570 706c 6965 6420 220a   the supplied ".
-00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019360: 2263 6875 6e6b 7320 6861 7320 6f6e 6c79  "chunks has only
-00019370: 2025 6420 6469 6d65 6e73 696f 6e73 2220   %d dimensions" 
-00019380: 2520 286c 656e 2873 6861 7065 292c 206c  % (len(shape), l
-00019390: 656e 2863 6875 6e6b 7329 290a 2020 2020  en(chunks)).    
-000193a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000193b0: 2020 6966 206e 6f74 2061 6c6c 280a 2020    if not all(.  
-000193c0: 2020 2020 2020 2020 2020 6320 3d3d 2073            c == s
-000193d0: 206f 7220 286d 6174 682e 6973 6e61 6e28   or (math.isnan(
-000193e0: 6329 206f 7220 6d61 7468 2e69 736e 616e  c) or math.isnan
-000193f0: 2873 2929 0a20 2020 2020 2020 2020 2020  (s)).           
-00019400: 2066 6f72 2063 2c20 7320 696e 207a 6970   for c, s in zip
-00019410: 286d 6170 2873 756d 2c20 6368 756e 6b73  (map(sum, chunks
-00019420: 292c 2073 6861 7065 290a 2020 2020 2020  ), shape).      
-00019430: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00019440: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00019450: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00019460: 2020 2022 4368 756e 6b73 2064 6f20 6e6f     "Chunks do no
-00019470: 7420 6164 6420 7570 2074 6f20 7368 6170  t add up to shap
-00019480: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
-00019490: 2020 2020 2022 476f 7420 6368 756e 6b73       "Got chunks
-000194a0: 3d25 732c 2073 6861 7065 3d25 7322 2025  =%s, shape=%s" %
-000194b0: 2028 6368 756e 6b73 2c20 7368 6170 6529   (chunks, shape)
-000194c0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-000194d0: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
-000194e0: 280a 2020 2020 2020 2020 7475 706c 6528  (.        tuple(
-000194f0: 696e 7428 7829 2069 6620 6e6f 7420 6d61  int(x) if not ma
-00019500: 7468 2e69 736e 616e 2878 2920 656c 7365  th.isnan(x) else
-00019510: 206e 702e 6e61 6e20 666f 7220 7820 696e   np.nan for x in
-00019520: 2063 2920 666f 7220 6320 696e 2063 6875   c) for c in chu
-00019530: 6e6b 730a 2020 2020 290a 0a0a 6465 6620  nks.    )...def 
-00019540: 5f63 6f6d 7075 7465 5f6d 756c 7469 706c  _compute_multipl
-00019550: 6965 7228 6c69 6d69 743a 2069 6e74 2c20  ier(limit: int, 
-00019560: 6474 7970 652c 206c 6172 6765 7374 5f62  dtype, largest_b
-00019570: 6c6f 636b 3a20 696e 742c 2072 6573 756c  lock: int, resul
-00019580: 7429 3a0a 2020 2020 2222 220a 2020 2020  t):.    """.    
-00019590: 5574 696c 6974 7920 6675 6e63 7469 6f6e  Utility function
-000195a0: 2066 6f72 2061 7574 6f5f 6368 756e 6b2c   for auto_chunk,
-000195b0: 2074 6f20 6669 6e20 686f 7720 6d75 6368   to fin how much
-000195c0: 206c 6172 6765 7220 6f72 2073 6d61 6c6c   larger or small
-000195d0: 6572 2074 6865 2069 6465 616c 0a20 2020  er the ideal.   
-000195e0: 2063 6875 6e6b 2073 697a 6520 6973 2072   chunk size is r
-000195f0: 656c 6174 6976 6520 746f 2077 6861 7420  elative to what 
-00019600: 7765 2068 6176 6520 6e6f 772e 0a20 2020  we have now..   
-00019610: 2022 2222 0a20 2020 2072 6574 7572 6e20   """.    return 
-00019620: 280a 2020 2020 2020 2020 6c69 6d69 740a  (.        limit.
-00019630: 2020 2020 2020 2020 2f20 6474 7970 652e          / dtype.
-00019640: 6974 656d 7369 7a65 0a20 2020 2020 2020  itemsize.       
-00019650: 202f 206c 6172 6765 7374 5f62 6c6f 636b   / largest_block
-00019660: 0a20 2020 2020 2020 202f 206d 6174 682e  .        / math.
-00019670: 7072 6f64 2872 2066 6f72 2072 2069 6e20  prod(r for r in 
-00019680: 7265 7375 6c74 2e76 616c 7565 7328 2920  result.values() 
-00019690: 6966 2072 290a 2020 2020 290a 0a0a 6465  if r).    )...de
-000196a0: 6620 6175 746f 5f63 6875 6e6b 7328 6368  f auto_chunks(ch
-000196b0: 756e 6b73 2c20 7368 6170 652c 206c 696d  unks, shape, lim
-000196c0: 6974 2c20 6474 7970 652c 2070 7265 7669  it, dtype, previ
-000196d0: 6f75 735f 6368 756e 6b73 3d4e 6f6e 6529  ous_chunks=None)
-000196e0: 3a0a 2020 2020 2222 2244 6574 6572 6d69  :.    """Determi
-000196f0: 6e65 2061 7574 6f6d 6174 6963 2063 6875  ne automatic chu
-00019700: 6e6b 730a 0a20 2020 2054 6869 7320 7461  nks..    This ta
-00019710: 6b65 7320 696e 2061 2063 6875 6e6b 7320  kes in a chunks 
-00019720: 7661 6c75 6520 7468 6174 2063 6f6e 7461  value that conta
-00019730: 696e 7320 6060 2261 7574 6f22 6060 2076  ins ``"auto"`` v
-00019740: 616c 7565 7320 696e 2063 6572 7461 696e  alues in certain
-00019750: 0a20 2020 2064 696d 656e 7369 6f6e 7320  .    dimensions 
-00019760: 616e 6420 7265 706c 6163 6573 2074 686f  and replaces tho
-00019770: 7365 2076 616c 7565 7320 7769 7468 2063  se values with c
-00019780: 6f6e 6372 6574 6520 6469 6d65 6e73 696f  oncrete dimensio
-00019790: 6e20 7369 7a65 7320 7468 6174 2074 7279  n sizes that try
-000197a0: 0a20 2020 2074 6f20 6765 7420 6368 756e  .    to get chun
-000197b0: 6b73 2074 6f20 6265 206f 6620 6120 6365  ks to be of a ce
-000197c0: 7274 6169 6e20 7369 7a65 2069 6e20 6279  rtain size in by
-000197d0: 7465 732c 2070 726f 7669 6465 6420 6279  tes, provided by
-000197e0: 2074 6865 2060 606c 696d 6974 3d60 600a   the ``limit=``.
-000197f0: 2020 2020 6b65 7977 6f72 642e 2020 4966      keyword.  If
-00019800: 206d 756c 7469 706c 6520 6469 6d65 6e73   multiple dimens
-00019810: 696f 6e73 2061 7265 206d 6172 6b65 6420  ions are marked 
-00019820: 6173 2060 6022 6175 746f 2260 6020 7468  as ``"auto"`` th
-00019830: 656e 2074 6865 7920 7769 6c6c 0a20 2020  en they will.   
-00019840: 2061 6c6c 2072 6573 706f 6e64 2074 6f20   all respond to 
-00019850: 6d65 6574 2074 6865 2064 6573 6972 6564  meet the desired
-00019860: 2062 7974 6520 6c69 6d69 742c 2074 7279   byte limit, try
-00019870: 696e 6720 746f 2072 6573 7065 6374 2074  ing to respect t
-00019880: 6865 2061 7370 6563 740a 2020 2020 7261  he aspect.    ra
-00019890: 7469 6f20 6f66 2074 6865 6972 2064 696d  tio of their dim
-000198a0: 656e 7369 6f6e 7320 696e 2060 6070 7265  ensions in ``pre
-000198b0: 7669 6f75 735f 6368 756e 6b73 3d60 602c  vious_chunks=``,
-000198c0: 2069 6620 6769 7665 6e2e 0a0a 2020 2020   if given...    
-000198d0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-000198e0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6368  ---------.    ch
-000198f0: 756e 6b73 3a20 5475 706c 650a 2020 2020  unks: Tuple.    
-00019900: 2020 2020 4120 7475 706c 6520 6f66 2065      A tuple of e
-00019910: 6974 6865 7220 6469 6d65 6e73 696f 6e73  ither dimensions
-00019920: 206f 7220 7475 706c 6573 206f 6620 6578   or tuples of ex
-00019930: 706c 6963 6974 2063 6875 6e6b 2064 696d  plicit chunk dim
-00019940: 656e 7369 6f6e 730a 2020 2020 2020 2020  ensions.        
-00019950: 536f 6d65 2065 6e74 7269 6573 2073 686f  Some entries sho
-00019960: 756c 6420 6265 2022 6175 746f 220a 2020  uld be "auto".  
-00019970: 2020 7368 6170 653a 2054 7570 6c65 5b69    shape: Tuple[i
-00019980: 6e74 5d0a 2020 2020 6c69 6d69 743a 2069  nt].    limit: i
-00019990: 6e74 2c20 7374 720a 2020 2020 2020 2020  nt, str.        
-000199a0: 5468 6520 6d61 7869 6d75 6d20 616c 6c6f  The maximum allo
-000199b0: 7761 626c 6520 7369 7a65 206f 6620 6120  wable size of a 
-000199c0: 6368 756e 6b20 696e 2062 7974 6573 0a20  chunk in bytes. 
-000199d0: 2020 2070 7265 7669 6f75 735f 6368 756e     previous_chun
-000199e0: 6b73 3a20 5475 706c 655b 5475 706c 655b  ks: Tuple[Tuple[
-000199f0: 696e 745d 5d0a 0a20 2020 2053 6565 2061  int]]..    See a
-00019a00: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
-00019a10: 0a20 2020 206e 6f72 6d61 6c69 7a65 5f63  .    normalize_c
-00019a20: 6875 6e6b 733a 2066 6f72 2066 756c 6c20  hunks: for full 
-00019a30: 646f 6373 7472 696e 6720 616e 6420 7061  docstring and pa
-00019a40: 7261 6d65 7465 7273 0a20 2020 2022 2222  rameters.    """
-00019a50: 0a20 2020 2069 6620 7072 6576 696f 7573  .    if previous
-00019a60: 5f63 6875 6e6b 7320 6973 206e 6f74 204e  _chunks is not N
-00019a70: 6f6e 653a 0a20 2020 2020 2020 2070 7265  one:.        pre
-00019a80: 7669 6f75 735f 6368 756e 6b73 203d 2074  vious_chunks = t
-00019a90: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
-00019aa0: 2020 6320 6966 2069 7369 6e73 7461 6e63    c if isinstanc
-00019ab0: 6528 632c 2074 7570 6c65 2920 656c 7365  e(c, tuple) else
-00019ac0: 2028 632c 2920 666f 7220 6320 696e 2070   (c,) for c in p
-00019ad0: 7265 7669 6f75 735f 6368 756e 6b73 0a20  revious_chunks. 
-00019ae0: 2020 2020 2020 2029 0a20 2020 2063 6875         ).    chu
-00019af0: 6e6b 7320 3d20 6c69 7374 2863 6875 6e6b  nks = list(chunk
-00019b00: 7329 0a0a 2020 2020 6175 746f 7320 3d20  s)..    autos = 
-00019b10: 7b69 2066 6f72 2069 2c20 6320 696e 2065  {i for i, c in e
-00019b20: 6e75 6d65 7261 7465 2863 6875 6e6b 7329  numerate(chunks)
-00019b30: 2069 6620 6320 3d3d 2022 6175 746f 227d   if c == "auto"}
-00019b40: 0a20 2020 2069 6620 6e6f 7420 6175 746f  .    if not auto
-00019b50: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
-00019b60: 6e20 7475 706c 6528 6368 756e 6b73 290a  n tuple(chunks).
-00019b70: 0a20 2020 2069 6620 6c69 6d69 7420 6973  .    if limit is
-00019b80: 204e 6f6e 653a 0a20 2020 2020 2020 206c   None:.        l
-00019b90: 696d 6974 203d 2063 6f6e 6669 672e 6765  imit = config.ge
-00019ba0: 7428 2261 7272 6179 2e63 6875 6e6b 2d73  t("array.chunk-s
-00019bb0: 697a 6522 290a 2020 2020 6966 2069 7369  ize").    if isi
-00019bc0: 6e73 7461 6e63 6528 6c69 6d69 742c 2073  nstance(limit, s
-00019bd0: 7472 293a 0a20 2020 2020 2020 206c 696d  tr):.        lim
-00019be0: 6974 203d 2070 6172 7365 5f62 7974 6573  it = parse_bytes
-00019bf0: 286c 696d 6974 290a 0a20 2020 2069 6620  (limit)..    if 
-00019c00: 6474 7970 6520 6973 204e 6f6e 653a 0a20  dtype is None:. 
-00019c10: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00019c20: 6545 7272 6f72 2822 6474 7970 6520 6d75  eError("dtype mu
-00019c30: 7374 2062 6520 6b6e 6f77 6e20 666f 7220  st be known for 
-00019c40: 6175 746f 2d63 6875 6e6b 696e 6722 290a  auto-chunking").
-00019c50: 0a20 2020 2069 6620 6474 7970 652e 6861  .    if dtype.ha
-00019c60: 736f 626a 6563 743a 0a20 2020 2020 2020  sobject:.       
-00019c70: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-00019c80: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
-00019c90: 2020 2020 2020 2020 2243 616e 206e 6f74          "Can not
-00019ca0: 2075 7365 2061 7574 6f20 7265 6368 756e   use auto rechun
-00019cb0: 6b69 6e67 2077 6974 6820 6f62 6a65 6374  king with object
-00019cc0: 2064 7479 7065 2e20 220a 2020 2020 2020   dtype. ".      
-00019cd0: 2020 2020 2020 2257 6520 6172 6520 756e        "We are un
-00019ce0: 6162 6c65 2074 6f20 6573 7469 6d61 7465  able to estimate
-00019cf0: 2074 6865 2073 697a 6520 696e 2062 7974   the size in byt
-00019d00: 6573 206f 6620 6f62 6a65 6374 2064 6174  es of object dat
-00019d10: 6122 0a20 2020 2020 2020 2029 0a0a 2020  a".        )..  
-00019d20: 2020 666f 7220 7820 696e 2074 7570 6c65    for x in tuple
-00019d30: 2863 6875 6e6b 7329 202b 2074 7570 6c65  (chunks) + tuple
-00019d40: 2873 6861 7065 293a 0a20 2020 2020 2020  (shape):.       
-00019d50: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00019d60: 2020 6973 696e 7374 616e 6365 2878 2c20    isinstance(x, 
-00019d70: 4e75 6d62 6572 290a 2020 2020 2020 2020  Number).        
-00019d80: 2020 2020 616e 6420 6e70 2e69 736e 616e      and np.isnan
-00019d90: 2878 290a 2020 2020 2020 2020 2020 2020  (x).            
-00019da0: 6f72 2069 7369 6e73 7461 6e63 6528 782c  or isinstance(x,
-00019db0: 2074 7570 6c65 290a 2020 2020 2020 2020   tuple).        
-00019dc0: 2020 2020 616e 6420 6e70 2e69 736e 616e      and np.isnan
-00019dd0: 2878 292e 616e 7928 290a 2020 2020 2020  (x).any().      
-00019de0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00019df0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00019e00: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00019e10: 2020 2022 4361 6e20 6e6f 7420 7065 7266     "Can not perf
-00019e20: 6f72 6d20 6175 746f 6d61 7469 6320 7265  orm automatic re
-00019e30: 6368 756e 6b69 6e67 2077 6974 6820 756e  chunking with un
-00019e40: 6b6e 6f77 6e20 220a 2020 2020 2020 2020  known ".        
-00019e50: 2020 2020 2020 2020 2228 6e61 6e29 2063          "(nan) c
-00019e60: 6875 6e6b 2073 697a 6573 2e25 7322 2025  hunk sizes.%s" %
-00019e70: 2075 6e6b 6e6f 776e 5f63 6875 6e6b 5f6d   unknown_chunk_m
-00019e80: 6573 7361 6765 0a20 2020 2020 2020 2020  essage.         
-00019e90: 2020 2029 0a0a 2020 2020 6c69 6d69 7420     )..    limit 
-00019ea0: 3d20 6d61 7828 312c 206c 696d 6974 290a  = max(1, limit).
-00019eb0: 0a20 2020 206c 6172 6765 7374 5f62 6c6f  .    largest_blo
-00019ec0: 636b 203d 206d 6174 682e 7072 6f64 280a  ck = math.prod(.
-00019ed0: 2020 2020 2020 2020 6373 2069 6620 6973          cs if is
-00019ee0: 696e 7374 616e 6365 2863 732c 204e 756d  instance(cs, Num
-00019ef0: 6265 7229 2065 6c73 6520 6d61 7828 6373  ber) else max(cs
-00019f00: 2920 666f 7220 6373 2069 6e20 6368 756e  ) for cs in chun
-00019f10: 6b73 2069 6620 6373 2021 3d20 2261 7574  ks if cs != "aut
-00019f20: 6f22 0a20 2020 2029 0a0a 2020 2020 6966  o".    )..    if
-00019f30: 2070 7265 7669 6f75 735f 6368 756e 6b73   previous_chunks
-00019f40: 3a0a 2020 2020 2020 2020 2320 4261 7365  :.        # Base
-00019f50: 2069 6465 616c 2072 6174 696f 206f 6e20   ideal ratio on 
-00019f60: 7468 6520 6d65 6469 616e 2063 6875 6e6b  the median chunk
-00019f70: 2073 697a 6520 6f66 2074 6865 2070 7265   size of the pre
-00019f80: 7669 6f75 7320 6368 756e 6b73 0a20 2020  vious chunks.   
-00019f90: 2020 2020 2072 6573 756c 7420 3d20 7b61       result = {a
-00019fa0: 3a20 6e70 2e6d 6564 6961 6e28 7072 6576  : np.median(prev
-00019fb0: 696f 7573 5f63 6875 6e6b 735b 615d 2920  ious_chunks[a]) 
-00019fc0: 666f 7220 6120 696e 2061 7574 6f73 7d0a  for a in autos}.
-00019fd0: 0a20 2020 2020 2020 2069 6465 616c 5f73  .        ideal_s
-00019fe0: 6861 7065 203d 205b 5d0a 2020 2020 2020  hape = [].      
-00019ff0: 2020 666f 7220 692c 2073 2069 6e20 656e    for i, s in en
-0001a000: 756d 6572 6174 6528 7368 6170 6529 3a0a  umerate(shape):.
-0001a010: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-0001a020: 6b5f 6672 6571 7565 6e63 6965 7320 3d20  k_frequencies = 
-0001a030: 6672 6571 7565 6e63 6965 7328 7072 6576  frequencies(prev
-0001a040: 696f 7573 5f63 6875 6e6b 735b 695d 290a  ious_chunks[i]).
-0001a050: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-0001a060: 2c20 636f 756e 7420 3d20 6d61 7828 6368  , count = max(ch
-0001a070: 756e 6b5f 6672 6571 7565 6e63 6965 732e  unk_frequencies.
-0001a080: 6974 656d 7328 292c 206b 6579 3d6c 616d  items(), key=lam
-0001a090: 6264 6120 6b76 3a20 6b76 5b31 5d29 0a20  bda kv: kv[1]). 
-0001a0a0: 2020 2020 2020 2020 2020 2069 6620 6d6f             if mo
-0001a0b0: 6465 203e 2031 2061 6e64 2063 6f75 6e74  de > 1 and count
-0001a0c0: 203e 3d20 6c65 6e28 7072 6576 696f 7573   >= len(previous
-0001a0d0: 5f63 6875 6e6b 735b 695d 2920 2f20 323a  _chunks[i]) / 2:
-0001a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a0f0: 2069 6465 616c 5f73 6861 7065 2e61 7070   ideal_shape.app
-0001a100: 656e 6428 6d6f 6465 290a 2020 2020 2020  end(mode).      
-0001a110: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a120: 2020 2020 2020 2020 2020 2020 6964 6561              idea
-0001a130: 6c5f 7368 6170 652e 6170 7065 6e64 2873  l_shape.append(s
-0001a140: 290a 0a20 2020 2020 2020 2023 2048 6f77  )..        # How
-0001a150: 206d 7563 6820 6c61 7267 6572 206f 7220   much larger or 
-0001a160: 736d 616c 6c65 7220 7468 6520 6964 6561  smaller the idea
-0001a170: 6c20 6368 756e 6b20 7369 7a65 2069 7320  l chunk size is 
-0001a180: 7265 6c61 7469 7665 2074 6f20 7768 6174  relative to what
-0001a190: 2077 6520 6861 7665 206e 6f77 0a20 2020   we have now.   
-0001a1a0: 2020 2020 206d 756c 7469 706c 6965 7220       multiplier 
-0001a1b0: 3d20 5f63 6f6d 7075 7465 5f6d 756c 7469  = _compute_multi
-0001a1c0: 706c 6965 7228 6c69 6d69 742c 2064 7479  plier(limit, dty
-0001a1d0: 7065 2c20 6c61 7267 6573 745f 626c 6f63  pe, largest_bloc
-0001a1e0: 6b2c 2072 6573 756c 7429 0a0a 2020 2020  k, result)..    
-0001a1f0: 2020 2020 6c61 7374 5f6d 756c 7469 706c      last_multipl
-0001a200: 6965 7220 3d20 300a 2020 2020 2020 2020  ier = 0.        
-0001a210: 6c61 7374 5f61 7574 6f73 203d 2073 6574  last_autos = set
-0001a220: 2829 0a20 2020 2020 2020 2077 6869 6c65  ().        while
-0001a230: 2028 0a20 2020 2020 2020 2020 2020 206d   (.            m
-0001a240: 756c 7469 706c 6965 7220 213d 206c 6173  ultiplier != las
-0001a250: 745f 6d75 6c74 6970 6c69 6572 206f 7220  t_multiplier or 
-0001a260: 6175 746f 7320 213d 206c 6173 745f 6175  autos != last_au
-0001a270: 746f 730a 2020 2020 2020 2020 293a 2020  tos.        ):  
-0001a280: 2320 7768 696c 6520 7468 696e 6773 2063  # while things c
-0001a290: 6861 6e67 650a 2020 2020 2020 2020 2020  hange.          
-0001a2a0: 2020 6c61 7374 5f6d 756c 7469 706c 6965    last_multiplie
-0001a2b0: 7220 3d20 6d75 6c74 6970 6c69 6572 2020  r = multiplier  
-0001a2c0: 2320 7265 636f 7264 2070 7265 7669 6f75  # record previou
-0001a2d0: 7320 7661 6c75 6573 0a20 2020 2020 2020  s values.       
-0001a2e0: 2020 2020 206c 6173 745f 6175 746f 7320       last_autos 
-0001a2f0: 3d20 7365 7428 6175 746f 7329 2020 2320  = set(autos)  # 
-0001a300: 7265 636f 7264 2070 7265 7669 6f75 7320  record previous 
-0001a310: 7661 6c75 6573 0a0a 2020 2020 2020 2020  values..        
-0001a320: 2020 2020 2320 4578 7061 6e64 206f 7220      # Expand or 
-0001a330: 636f 6e74 7261 6374 2065 6163 6820 6f66  contract each of
-0001a340: 2074 6865 2064 696d 656e 7369 6f6e 7320   the dimensions 
-0001a350: 6170 7072 6f70 7269 6174 656c 790a 2020  appropriately.  
-0001a360: 2020 2020 2020 2020 2020 666f 7220 6120            for a 
-0001a370: 696e 2073 6f72 7465 6428 6175 746f 7329  in sorted(autos)
-0001a380: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a390: 2020 6966 2069 6465 616c 5f73 6861 7065    if ideal_shape
-0001a3a0: 5b61 5d20 3d3d 2030 3a0a 2020 2020 2020  [a] == 0:.      
-0001a3b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001a3c0: 7375 6c74 5b61 5d20 3d20 300a 2020 2020  sult[a] = 0.    
-0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a3e0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001a3f0: 2020 2020 2020 2020 2070 726f 706f 7365           propose
-0001a400: 6420 3d20 7265 7375 6c74 5b61 5d20 2a20  d = result[a] * 
-0001a410: 6d75 6c74 6970 6c69 6572 202a 2a20 2831  multiplier ** (1
-0001a420: 202f 206c 656e 2861 7574 6f73 2929 0a20   / len(autos)). 
-0001a430: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a440: 6620 7072 6f70 6f73 6564 203e 2073 6861  f proposed > sha
-0001a450: 7065 5b61 5d3a 2020 2320 7765 2776 6520  pe[a]:  # we've 
-0001a460: 6869 7420 7468 6520 7368 6170 6520 626f  hit the shape bo
-0001a470: 756e 6461 7279 0a20 2020 2020 2020 2020  undary.         
-0001a480: 2020 2020 2020 2020 2020 2061 7574 6f73             autos
-0001a490: 2e72 656d 6f76 6528 6129 0a20 2020 2020  .remove(a).     
-0001a4a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001a4b0: 6172 6765 7374 5f62 6c6f 636b 202a 3d20  argest_block *= 
-0001a4c0: 7368 6170 655b 615d 0a20 2020 2020 2020  shape[a].       
-0001a4d0: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-0001a4e0: 6e6b 735b 615d 203d 2073 6861 7065 5b61  nks[a] = shape[a
-0001a4f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001a500: 2020 2020 2020 6465 6c20 7265 7375 6c74        del result
-0001a510: 5b61 5d0a 2020 2020 2020 2020 2020 2020  [a].            
-0001a520: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a530: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001a540: 7375 6c74 5b61 5d20 3d20 726f 756e 645f  sult[a] = round_
-0001a550: 746f 2870 726f 706f 7365 642c 2069 6465  to(proposed, ide
-0001a560: 616c 5f73 6861 7065 5b61 5d29 0a0a 2020  al_shape[a])..  
-0001a570: 2020 2020 2020 2020 2020 2320 7265 636f            # reco
-0001a580: 6d70 7574 6520 686f 7720 6d75 6368 206d  mpute how much m
-0001a590: 756c 7469 706c 6965 7220 7765 2068 6176  ultiplier we hav
-0001a5a0: 6520 6c65 6674 2c20 7265 7065 6174 0a20  e left, repeat. 
-0001a5b0: 2020 2020 2020 2020 2020 206d 756c 7469             multi
-0001a5c0: 706c 6965 7220 3d20 5f63 6f6d 7075 7465  plier = _compute
-0001a5d0: 5f6d 756c 7469 706c 6965 7228 6c69 6d69  _multiplier(limi
-0001a5e0: 742c 2064 7479 7065 2c20 6c61 7267 6573  t, dtype, larges
-0001a5f0: 745f 626c 6f63 6b2c 2072 6573 756c 7429  t_block, result)
-0001a600: 0a0a 2020 2020 2020 2020 666f 7220 6b2c  ..        for k,
-0001a610: 2076 2069 6e20 7265 7375 6c74 2e69 7465   v in result.ite
-0001a620: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0001a630: 2020 6368 756e 6b73 5b6b 5d20 3d20 760a    chunks[k] = v.
-0001a640: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0001a650: 7570 6c65 2863 6875 6e6b 7329 0a0a 2020  uple(chunks)..  
-0001a660: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001a670: 2320 4368 6563 6b20 6966 2064 7479 7065  # Check if dtype
-0001a680: 2e69 7465 6d73 697a 6520 6973 2067 7265  .itemsize is gre
-0001a690: 6174 6572 2074 6861 6e20 300a 2020 2020  ater than 0.    
-0001a6a0: 2020 2020 6966 2064 7479 7065 2e69 7465      if dtype.ite
-0001a6b0: 6d73 697a 6520 3d3d 2030 3a0a 2020 2020  msize == 0:.    
-0001a6c0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0001a6d0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0001a6e0: 2020 2020 2020 2020 2020 2261 7574 6f2d            "auto-
-0001a6f0: 6368 756e 6b69 6e67 2077 6974 6820 6474  chunking with dt
-0001a700: 7970 652e 6974 656d 7369 7a65 203d 3d20  ype.itemsize == 
-0001a710: 3020 6973 206e 6f74 2073 7570 706f 7274  0 is not support
-0001a720: 6564 2c20 706c 6561 7365 2070 6173 7320  ed, please pass 
-0001a730: 696e 2060 6368 756e 6b73 6020 6578 706c  in `chunks` expl
-0001a740: 6963 6974 6c79 220a 2020 2020 2020 2020  icitly".        
-0001a750: 2020 2020 290a 2020 2020 2020 2020 7369      ).        si
-0001a760: 7a65 203d 2028 6c69 6d69 7420 2f20 6474  ze = (limit / dt
-0001a770: 7970 652e 6974 656d 7369 7a65 202f 206c  ype.itemsize / l
-0001a780: 6172 6765 7374 5f62 6c6f 636b 2920 2a2a  argest_block) **
-0001a790: 2028 3120 2f20 6c65 6e28 6175 746f 7329   (1 / len(autos)
-0001a7a0: 290a 2020 2020 2020 2020 736d 616c 6c20  ).        small 
-0001a7b0: 3d20 5b69 2066 6f72 2069 2069 6e20 6175  = [i for i in au
-0001a7c0: 746f 7320 6966 2073 6861 7065 5b69 5d20  tos if shape[i] 
-0001a7d0: 3c20 7369 7a65 5d0a 2020 2020 2020 2020  < size].        
-0001a7e0: 6966 2073 6d61 6c6c 3a0a 2020 2020 2020  if small:.      
-0001a7f0: 2020 2020 2020 666f 7220 6920 696e 2073        for i in s
-0001a800: 6d61 6c6c 3a0a 2020 2020 2020 2020 2020  mall:.          
-0001a810: 2020 2020 2020 6368 756e 6b73 5b69 5d20        chunks[i] 
-0001a820: 3d20 2873 6861 7065 5b69 5d2c 290a 2020  = (shape[i],).  
-0001a830: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001a840: 2061 7574 6f5f 6368 756e 6b73 2863 6875   auto_chunks(chu
-0001a850: 6e6b 732c 2073 6861 7065 2c20 6c69 6d69  nks, shape, limi
-0001a860: 742c 2064 7479 7065 290a 0a20 2020 2020  t, dtype)..     
-0001a870: 2020 2066 6f72 2069 2069 6e20 6175 746f     for i in auto
-0001a880: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-0001a890: 6875 6e6b 735b 695d 203d 2072 6f75 6e64  hunks[i] = round
-0001a8a0: 5f74 6f28 7369 7a65 2c20 7368 6170 655b  _to(size, shape[
-0001a8b0: 695d 290a 0a20 2020 2020 2020 2072 6574  i])..        ret
-0001a8c0: 7572 6e20 7475 706c 6528 6368 756e 6b73  urn tuple(chunks
-0001a8d0: 290a 0a0a 6465 6620 726f 756e 645f 746f  )...def round_to
-0001a8e0: 2863 2c20 7329 3a0a 2020 2020 2222 2252  (c, s):.    """R
-0001a8f0: 6574 7572 6e20 6120 6368 756e 6b20 6469  eturn a chunk di
-0001a900: 6d65 6e73 696f 6e20 7468 6174 2069 7320  mension that is 
-0001a910: 636c 6f73 6520 746f 2061 6e20 6576 656e  close to an even
-0001a920: 206d 756c 7469 706c 6520 6f72 2066 6163   multiple or fac
-0001a930: 746f 720a 0a20 2020 2057 6520 7761 6e74  tor..    We want
-0001a940: 2076 616c 7565 7320 666f 7220 6320 7468   values for c th
-0001a950: 6174 2061 7265 206e 6963 656c 7920 616c  at are nicely al
-0001a960: 6967 6e65 6420 7769 7468 2073 2e0a 0a20  igned with s... 
-0001a970: 2020 2049 6620 6320 6973 2073 6d61 6c6c     If c is small
-0001a980: 6572 2074 6861 6e20 7320 7765 2075 7365  er than s we use
-0001a990: 2074 6865 206f 7269 6769 6e61 6c20 6368   the original ch
-0001a9a0: 756e 6b20 7369 7a65 2061 6e64 2061 6363  unk size and acc
-0001a9b0: 6570 7420 616e 0a20 2020 2075 6e65 7665  ept an.    uneve
-0001a9c0: 6e20 6368 756e 6b20 6174 2074 6865 2065  n chunk at the e
-0001a9d0: 6e64 2e0a 0a20 2020 2049 6620 6320 6973  nd...    If c is
-0001a9e0: 206c 6172 6765 7220 7468 616e 2073 2074   larger than s t
-0001a9f0: 6865 6e20 7765 2077 616e 7420 7468 6520  hen we want the 
-0001aa00: 6c61 7267 6573 7420 6d75 6c74 6970 6c65  largest multiple
-0001aa10: 206f 6620 7320 7468 6174 2069 7320 7374   of s that is st
-0001aa20: 696c 6c0a 2020 2020 736d 616c 6c65 7220  ill.    smaller 
-0001aa30: 7468 616e 2063 2e0a 2020 2020 2222 220a  than c..    """.
-0001aa40: 2020 2020 6966 2063 203c 3d20 733a 0a20      if c <= s:. 
-0001aa50: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
-0001aa60: 7828 312c 2069 6e74 2863 2929 0a20 2020  x(1, int(c)).   
-0001aa70: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-0001aa80: 6574 7572 6e20 6320 2f2f 2073 202a 2073  eturn c // s * s
-0001aa90: 0a0a 0a64 6566 205f 6765 745f 6368 756e  ...def _get_chun
-0001aaa0: 6b5f 7368 6170 6528 6129 3a0a 2020 2020  k_shape(a):.    
-0001aab0: 7320 3d20 6e70 2e61 7361 7272 6179 2861  s = np.asarray(a
-0001aac0: 2e73 6861 7065 2c20 6474 7970 653d 696e  .shape, dtype=in
-0001aad0: 7429 0a20 2020 2072 6574 7572 6e20 735b  t).    return s[
-0001aae0: 6c65 6e28 7329 202a 2028 4e6f 6e65 2c29  len(s) * (None,)
-0001aaf0: 202b 2028 736c 6963 6528 4e6f 6e65 292c   + (slice(None),
-0001ab00: 295d 0a0a 0a64 6566 2066 726f 6d5f 6172  )]...def from_ar
-0001ab10: 7261 7928 0a20 2020 2078 2c0a 2020 2020  ray(.    x,.    
-0001ab20: 6368 756e 6b73 3d22 6175 746f 222c 0a20  chunks="auto",. 
-0001ab30: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
-0001ab40: 2020 6c6f 636b 3d46 616c 7365 2c0a 2020    lock=False,.  
-0001ab50: 2020 6173 6172 7261 793d 4e6f 6e65 2c0a    asarray=None,.
-0001ab60: 2020 2020 6661 6e63 793d 5472 7565 2c0a      fancy=True,.
-0001ab70: 2020 2020 6765 7469 7465 6d3d 4e6f 6e65      getitem=None
-0001ab80: 2c0a 2020 2020 6d65 7461 3d4e 6f6e 652c  ,.    meta=None,
-0001ab90: 0a20 2020 2069 6e6c 696e 655f 6172 7261  .    inline_arra
-0001aba0: 793d 4661 6c73 652c 0a29 3a0a 2020 2020  y=False,.):.    
-0001abb0: 2222 2243 7265 6174 6520 6461 736b 2061  """Create dask a
-0001abc0: 7272 6179 2066 726f 6d20 736f 6d65 7468  rray from someth
-0001abd0: 696e 6720 7468 6174 206c 6f6f 6b73 206c  ing that looks l
-0001abe0: 696b 6520 616e 2061 7272 6179 2e0a 0a20  ike an array... 
-0001abf0: 2020 2049 6e70 7574 206d 7573 7420 6861     Input must ha
-0001ac00: 7665 2061 2060 602e 7368 6170 6560 602c  ve a ``.shape``,
-0001ac10: 2060 602e 6e64 696d 6060 2c20 6060 2e64   ``.ndim``, ``.d
-0001ac20: 7479 7065 6060 2061 6e64 2073 7570 706f  type`` and suppo
-0001ac30: 7274 206e 756d 7079 2d73 7479 6c65 2073  rt numpy-style s
-0001ac40: 6c69 6369 6e67 2e0a 0a20 2020 2050 6172  licing...    Par
-0001ac50: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-0001ac60: 2d2d 2d2d 2d2d 0a20 2020 2078 203a 2061  ------.    x : a
-0001ac70: 7272 6179 5f6c 696b 650a 2020 2020 6368  rray_like.    ch
-0001ac80: 756e 6b73 203a 2069 6e74 2c20 7475 706c  unks : int, tupl
-0001ac90: 650a 2020 2020 2020 2020 486f 7720 746f  e.        How to
-0001aca0: 2063 6875 6e6b 2074 6865 2061 7272 6179   chunk the array
-0001acb0: 2e20 4d75 7374 2062 6520 6f6e 6520 6f66  . Must be one of
-0001acc0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2066   the following f
-0001acd0: 6f72 6d73 3a0a 0a20 2020 2020 2020 202d  orms:..        -
-0001ace0: 2041 2062 6c6f 636b 7369 7a65 206c 696b   A blocksize lik
-0001acf0: 6520 3130 3030 2e0a 2020 2020 2020 2020  e 1000..        
-0001ad00: 2d20 4120 626c 6f63 6b73 6861 7065 206c  - A blockshape l
-0001ad10: 696b 6520 2831 3030 302c 2031 3030 3029  ike (1000, 1000)
-0001ad20: 2e0a 2020 2020 2020 2020 2d20 4578 706c  ..        - Expl
-0001ad30: 6963 6974 2073 697a 6573 206f 6620 616c  icit sizes of al
-0001ad40: 6c20 626c 6f63 6b73 2061 6c6f 6e67 2061  l blocks along a
-0001ad50: 6c6c 2064 696d 656e 7369 6f6e 7320 6c69  ll dimensions li
-0001ad60: 6b65 0a20 2020 2020 2020 2020 2028 2831  ke.          ((1
-0001ad70: 3030 302c 2031 3030 302c 2035 3030 292c  000, 1000, 500),
-0001ad80: 2028 3430 302c 2034 3030 2929 2e0a 2020   (400, 400))..  
-0001ad90: 2020 2020 2020 2d20 4120 7369 7a65 2069        - A size i
-0001ada0: 6e20 6279 7465 732c 206c 696b 6520 2231  n bytes, like "1
-0001adb0: 3030 204d 6942 2220 7768 6963 6820 7769  00 MiB" which wi
-0001adc0: 6c6c 2063 686f 6f73 6520 6120 756e 6966  ll choose a unif
-0001add0: 6f72 6d0a 2020 2020 2020 2020 2020 626c  orm.          bl
-0001ade0: 6f63 6b2d 6c69 6b65 2073 6861 7065 0a20  ock-like shape. 
-0001adf0: 2020 2020 2020 202d 2054 6865 2077 6f72         - The wor
-0001ae00: 6420 2261 7574 6f22 2077 6869 6368 2061  d "auto" which a
-0001ae10: 6374 7320 6c69 6b65 2074 6865 2061 626f  cts like the abo
-0001ae20: 7665 2c20 6275 7420 7573 6573 2061 2063  ve, but uses a c
-0001ae30: 6f6e 6669 6775 7261 7469 6f6e 0a20 2020  onfiguration.   
-0001ae40: 2020 2020 2020 2076 616c 7565 2060 6061         value ``a
-0001ae50: 7272 6179 2e63 6875 6e6b 2d73 697a 6560  rray.chunk-size`
-0001ae60: 6020 666f 7220 7468 6520 6368 756e 6b20  ` for the chunk 
-0001ae70: 7369 7a65 0a0a 2020 2020 2020 2020 2d31  size..        -1
-0001ae80: 206f 7220 4e6f 6e65 2061 7320 6120 626c   or None as a bl
-0001ae90: 6f63 6b73 697a 6520 696e 6469 6361 7465  ocksize indicate
-0001aea0: 2074 6865 2073 697a 6520 6f66 2074 6865   the size of the
-0001aeb0: 2063 6f72 7265 7370 6f6e 6469 6e67 0a20   corresponding. 
-0001aec0: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-0001aed0: 2e0a 2020 2020 6e61 6d65 203a 2073 7472  ..    name : str
-0001aee0: 206f 7220 626f 6f6c 2c20 6f70 7469 6f6e   or bool, option
-0001aef0: 616c 0a20 2020 2020 2020 2054 6865 206b  al.        The k
-0001af00: 6579 206e 616d 6520 746f 2075 7365 2066  ey name to use f
-0001af10: 6f72 2074 6865 2061 7272 6179 2e20 4465  or the array. De
-0001af20: 6661 756c 7473 2074 6f20 6120 6861 7368  faults to a hash
-0001af30: 206f 6620 6060 7860 602e 0a0a 2020 2020   of ``x``...    
-0001af40: 2020 2020 4861 7368 696e 6720 6973 2075      Hashing is u
-0001af50: 7365 6675 6c20 6966 2074 6865 2073 616d  seful if the sam
-0001af60: 6520 7661 6c75 6520 6f66 2060 6078 6060  e value of ``x``
-0001af70: 2069 7320 7573 6564 2074 6f20 6372 6561   is used to crea
-0001af80: 7465 206d 756c 7469 706c 650a 2020 2020  te multiple.    
-0001af90: 2020 2020 6172 7261 7973 2c20 6173 2044      arrays, as D
-0001afa0: 6173 6b20 6361 6e20 7468 656e 2072 6563  ask can then rec
-0001afb0: 6f67 6e69 7365 2074 6861 7420 7468 6579  ognise that they
-0001afc0: 2772 6520 7468 6520 7361 6d65 2061 6e64  're the same and
-0001afd0: 0a20 2020 2020 2020 2061 766f 6964 2064  .        avoid d
-0001afe0: 7570 6c69 6361 7465 2063 6f6d 7075 7461  uplicate computa
-0001aff0: 7469 6f6e 732e 2048 6f77 6576 6572 2c20  tions. However, 
-0001b000: 6974 2063 616e 2061 6c73 6f20 6265 2073  it can also be s
-0001b010: 6c6f 772c 2061 6e64 2069 6620 7468 650a  low, and if the.
-0001b020: 2020 2020 2020 2020 6172 7261 7920 6973          array is
-0001b030: 206e 6f74 2063 6f6e 7469 6775 6f75 7320   not contiguous 
-0001b040: 6974 2069 7320 636f 7069 6564 2066 6f72  it is copied for
-0001b050: 2068 6173 6869 6e67 2e20 4966 2074 6865   hashing. If the
-0001b060: 2061 7272 6179 2075 7365 730a 2020 2020   array uses.    
-0001b070: 2020 2020 7374 7269 6465 2074 7269 636b      stride trick
-0001b080: 7320 2873 7563 6820 6173 203a 6675 6e63  s (such as :func
-0001b090: 3a60 6e75 6d70 792e 6272 6f61 6463 6173  :`numpy.broadcas
-0001b0a0: 745f 746f 6020 6f72 0a20 2020 2020 2020  t_to` or.       
-0001b0b0: 203a 6675 6e63 3a60 736b 696d 6167 652e   :func:`skimage.
-0001b0c0: 7574 696c 2e76 6965 775f 6173 5f77 696e  util.view_as_win
-0001b0d0: 646f 7773 6029 2074 6f20 6861 7665 2061  dows`) to have a
-0001b0e0: 206c 6172 6765 7220 6c6f 6769 6361 6c0a   larger logical.
-0001b0f0: 2020 2020 2020 2020 7468 616e 2070 6879          than phy
-0001b100: 7369 6361 6c20 7369 7a65 2c20 7468 6973  sical size, this
-0001b110: 2063 6f70 7920 6361 6e20 6361 7573 6520   copy can cause 
-0001b120: 6578 6365 7373 6976 6520 6d65 6d6f 7279  excessive memory
-0001b130: 2075 7361 6765 2e0a 0a20 2020 2020 2020   usage...       
-0001b140: 2049 6620 796f 7520 646f 6e27 7420 6e65   If you don't ne
-0001b150: 6564 2074 6865 2064 6564 7570 6c69 6361  ed the deduplica
-0001b160: 7469 6f6e 2070 726f 7669 6465 6420 6279  tion provided by
-0001b170: 2068 6173 6869 6e67 2c20 7573 650a 2020   hashing, use.  
-0001b180: 2020 2020 2020 6060 6e61 6d65 3d46 616c        ``name=Fal
-0001b190: 7365 6060 2074 6f20 6765 6e65 7261 7465  se`` to generate
-0001b1a0: 2061 2072 616e 646f 6d20 6e61 6d65 2069   a random name i
-0001b1b0: 6e73 7465 6164 206f 6620 6861 7368 696e  nstead of hashin
-0001b1c0: 672c 2077 6869 6368 0a20 2020 2020 2020  g, which.       
-0001b1d0: 2061 766f 6964 7320 7468 6520 7069 7466   avoids the pitf
-0001b1e0: 616c 6c73 2064 6573 6372 6962 6564 2061  alls described a
-0001b1f0: 626f 7665 2e20 5573 696e 6720 6060 6e61  bove. Using ``na
-0001b200: 6d65 3d54 7275 6560 6020 6973 0a20 2020  me=True`` is.   
-0001b210: 2020 2020 2065 7175 6976 616c 656e 7420       equivalent 
-0001b220: 746f 2074 6865 2064 6566 6175 6c74 2e0a  to the default..
-0001b230: 0a20 2020 2020 2020 2042 7920 6465 6661  .        By defa
-0001b240: 756c 742c 2068 6173 6869 6e67 2075 7365  ult, hashing use
-0001b250: 7320 7079 7468 6f6e 2773 2073 7461 6e64  s python's stand
-0001b260: 6172 6420 7368 6131 2e20 5468 6973 2062  ard sha1. This b
-0001b270: 6568 6176 696f 7572 2063 616e 2062 650a  ehaviour can be.
-0001b280: 2020 2020 2020 2020 6368 616e 6765 6420          changed 
-0001b290: 6279 2069 6e73 7461 6c6c 696e 6720 6369  by installing ci
-0001b2a0: 7479 6861 7368 2c20 7878 6861 7368 206f  tyhash, xxhash o
-0001b2b0: 7220 6d75 726d 7572 6861 7368 2e20 4966  r murmurhash. If
-0001b2c0: 2069 6e73 7461 6c6c 6564 2c0a 2020 2020   installed,.    
-0001b2d0: 2020 2020 6120 6c61 7267 652d 6661 6374      a large-fact
-0001b2e0: 6f72 2073 7065 6564 7570 2063 616e 2062  or speedup can b
-0001b2f0: 6520 6f62 7461 696e 6564 2069 6e20 7468  e obtained in th
-0001b300: 6520 746f 6b65 6e69 7361 7469 6f6e 2073  e tokenisation s
-0001b310: 7465 702e 0a0a 2020 2020 2020 2020 2e2e  tep...        ..
-0001b320: 206e 6f74 653a 3a0a 0a20 2020 2020 2020   note::..       
-0001b330: 2020 2020 4265 6361 7573 6520 7468 6973      Because this
-0001b340: 2060 606e 616d 6560 6020 6973 2075 7365   ``name`` is use
-0001b350: 6420 6173 2074 6865 206b 6579 2069 6e20  d as the key in 
-0001b360: 7461 736b 2067 7261 7068 732c 2079 6f75  task graphs, you
-0001b370: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
-0001b380: 2020 2065 6e73 7572 6520 7468 6174 2069     ensure that i
-0001b390: 7420 756e 6971 7565 6c79 2069 6465 6e74  t uniquely ident
-0001b3a0: 6966 6965 7320 7468 6520 6461 7461 2063  ifies the data c
-0001b3b0: 6f6e 7461 696e 6564 2077 6974 6869 6e2e  ontained within.
-0001b3c0: 2049 660a 2020 2020 2020 2020 2020 2079   If.           y
-0001b3d0: 6f75 2764 206c 696b 6520 746f 2070 726f  ou'd like to pro
-0001b3e0: 7669 6465 2061 2064 6573 6372 6970 7469  vide a descripti
-0001b3f0: 7665 206e 616d 6520 7468 6174 2069 7320  ve name that is 
-0001b400: 7374 696c 6c20 756e 6971 7565 2c20 636f  still unique, co
-0001b410: 6d62 696e 650a 2020 2020 2020 2020 2020  mbine.          
-0001b420: 2074 6865 2064 6573 6372 6970 7469 7665   the descriptive
-0001b430: 206e 616d 6520 7769 7468 203a 6675 6e63   name with :func
-0001b440: 3a60 6461 736b 2e62 6173 652e 746f 6b65  :`dask.base.toke
-0001b450: 6e69 7a65 6020 6f66 2074 6865 0a20 2020  nize` of the.   
-0001b460: 2020 2020 2020 2020 6060 6172 7261 795f          ``array_
-0001b470: 6c69 6b65 6060 2e20 5365 6520 3a72 6566  like``. See :ref
-0001b480: 3a60 6772 6170 6873 6020 666f 7220 6d6f  :`graphs` for mo
-0001b490: 7265 2e0a 0a20 2020 206c 6f63 6b20 3a20  re...    lock : 
-0001b4a0: 626f 6f6c 206f 7220 4c6f 636b 2c20 6f70  bool or Lock, op
-0001b4b0: 7469 6f6e 616c 0a20 2020 2020 2020 2049  tional.        I
-0001b4c0: 6620 6060 7860 6020 646f 6573 6e27 7420  f ``x`` doesn't 
-0001b4d0: 7375 7070 6f72 7420 636f 6e63 7572 7265  support concurre
-0001b4e0: 6e74 2072 6561 6473 2074 6865 6e20 7072  nt reads then pr
-0001b4f0: 6f76 6964 6520 6120 6c6f 636b 2068 6572  ovide a lock her
-0001b500: 652c 206f 720a 2020 2020 2020 2020 7061  e, or.        pa
-0001b510: 7373 2069 6e20 5472 7565 2074 6f20 6861  ss in True to ha
-0001b520: 7665 2064 6173 6b2e 6172 7261 7920 6372  ve dask.array cr
-0001b530: 6561 7465 206f 6e65 2066 6f72 2079 6f75  eate one for you
-0001b540: 2e0a 2020 2020 6173 6172 7261 7920 3a20  ..    asarray : 
-0001b550: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
-0001b560: 2020 2020 2020 2049 6620 5472 7565 2074         If True t
-0001b570: 6865 6e20 6361 6c6c 206e 702e 6173 6172  hen call np.asar
-0001b580: 7261 7920 6f6e 2063 6875 6e6b 7320 746f  ray on chunks to
-0001b590: 2063 6f6e 7665 7274 2074 6865 6d20 746f   convert them to
-0001b5a0: 206e 756d 7079 2061 7272 6179 732e 0a20   numpy arrays.. 
-0001b5b0: 2020 2020 2020 2049 6620 4661 6c73 6520         If False 
-0001b5c0: 7468 656e 2063 6875 6e6b 7320 6172 6520  then chunks are 
-0001b5d0: 7061 7373 6564 2074 6872 6f75 6768 2075  passed through u
-0001b5e0: 6e63 6861 6e67 6564 2e0a 2020 2020 2020  nchanged..      
-0001b5f0: 2020 4966 204e 6f6e 6520 2864 6566 6175    If None (defau
-0001b600: 6c74 2920 7468 656e 2077 6520 7573 6520  lt) then we use 
-0001b610: 5472 7565 2069 6620 7468 6520 6060 5f5f  True if the ``__
-0001b620: 6172 7261 795f 6675 6e63 7469 6f6e 5f5f  array_function__
-0001b630: 6060 206d 6574 686f 640a 2020 2020 2020  `` method.      
-0001b640: 2020 6973 2075 6e64 6566 696e 6564 2e0a    is undefined..
-0001b650: 0a20 2020 2020 2020 202e 2e20 6e6f 7465  .        .. note
-0001b660: 3a3a 0a0a 2020 2020 2020 2020 2020 2020  ::..            
-0001b670: 4461 736b 2064 6f65 7320 6e6f 7420 7072  Dask does not pr
-0001b680: 6573 6572 7665 2074 6865 206d 656d 6f72  eserve the memor
-0001b690: 7920 6c61 796f 7574 206f 6620 7468 6520  y layout of the 
-0001b6a0: 6f72 6967 696e 616c 2061 7272 6179 2077  original array w
-0001b6b0: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
-0001b6c0: 7468 6520 6172 7261 7920 6973 2063 7265  the array is cre
-0001b6d0: 6174 6564 2075 7369 6e67 2046 6f72 7472  ated using Fortr
-0001b6e0: 616e 2072 6174 6865 7220 7468 616e 2043  an rather than C
-0001b6f0: 206f 7264 6572 696e 672e 0a0a 2020 2020   ordering...    
-0001b700: 6661 6e63 7920 3a20 626f 6f6c 2c20 6f70  fancy : bool, op
-0001b710: 7469 6f6e 616c 0a20 2020 2020 2020 2049  tional.        I
-0001b720: 6620 6060 7860 6020 646f 6573 6e27 7420  f ``x`` doesn't 
-0001b730: 7375 7070 6f72 7420 6661 6e63 7920 696e  support fancy in
-0001b740: 6465 7869 6e67 2028 652e 672e 2069 6e64  dexing (e.g. ind
-0001b750: 6578 696e 6720 7769 7468 206c 6973 7473  exing with lists
-0001b760: 206f 720a 2020 2020 2020 2020 6172 7261   or.        arra
-0001b770: 7973 2920 7468 656e 2073 6574 2074 6f20  ys) then set to 
-0001b780: 4661 6c73 652e 2044 6566 6175 6c74 2069  False. Default i
-0001b790: 7320 5472 7565 2e0a 2020 2020 6d65 7461  s True..    meta
-0001b7a0: 203a 2041 7272 6179 2d6c 696b 652c 206f   : Array-like, o
-0001b7b0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0001b7c0: 5468 6520 6d65 7461 6461 7461 2066 6f72  The metadata for
-0001b7d0: 2074 6865 2072 6573 756c 7469 6e67 2064   the resulting d
-0001b7e0: 6173 6b20 6172 7261 792e 2020 5468 6973  ask array.  This
-0001b7f0: 2069 7320 7468 6520 6b69 6e64 206f 6620   is the kind of 
-0001b800: 6172 7261 790a 2020 2020 2020 2020 7468  array.        th
-0001b810: 6174 2077 696c 6c20 7265 7375 6c74 2066  at will result f
-0001b820: 726f 6d20 736c 6963 696e 6720 7468 6520  rom slicing the 
-0001b830: 696e 7075 7420 6172 7261 792e 0a20 2020  input array..   
-0001b840: 2020 2020 2044 6566 6175 6c74 7320 746f       Defaults to
-0001b850: 2074 6865 2069 6e70 7574 2061 7272 6179   the input array
-0001b860: 2e0a 2020 2020 696e 6c69 6e65 5f61 7272  ..    inline_arr
-0001b870: 6179 203a 2062 6f6f 6c2c 2064 6566 6175  ay : bool, defau
-0001b880: 6c74 2046 616c 7365 0a20 2020 2020 2020  lt False.       
-0001b890: 2048 6f77 2074 6f20 696e 636c 7564 6520   How to include 
-0001b8a0: 7468 6520 6172 7261 7920 696e 2074 6865  the array in the
-0001b8b0: 2074 6173 6b20 6772 6170 682e 2042 7920   task graph. By 
-0001b8c0: 6465 6661 756c 740a 2020 2020 2020 2020  default.        
-0001b8d0: 2860 6069 6e6c 696e 655f 6172 7261 793d  (``inline_array=
-0001b8e0: 4661 6c73 6560 6029 2074 6865 2061 7272  False``) the arr
-0001b8f0: 6179 2069 7320 696e 636c 7564 6564 2069  ay is included i
-0001b900: 6e20 6120 7461 736b 2062 7920 6974 7365  n a task by itse
-0001b910: 6c66 2c0a 2020 2020 2020 2020 616e 6420  lf,.        and 
-0001b920: 6561 6368 2063 6875 6e6b 2072 6566 6572  each chunk refer
-0001b930: 7320 746f 2074 6861 7420 7461 736b 2062  s to that task b
-0001b940: 7920 6974 7320 6b65 792e 0a0a 2020 2020  y its key...    
-0001b950: 2020 2020 2e2e 2063 6f64 652d 626c 6f63      .. code-bloc
-0001b960: 6b3a 3a20 7079 7468 6f6e 0a0a 2020 2020  k:: python..    
-0001b970: 2020 2020 2020 203e 3e3e 2078 203d 2068         >>> x = h
-0001b980: 3570 792e 4669 6c65 2822 6461 7461 2e68  5py.File("data.h
-0001b990: 3522 295b 222f 7822 5d20 2023 2064 6f63  5")["/x"]  # doc
-0001b9a0: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-0001b9b0: 2020 2020 2020 203e 3e3e 2061 203d 2064         >>> a = d
-0001b9c0: 612e 6672 6f6d 5f61 7272 6179 2878 2c20  a.from_array(x, 
-0001b9d0: 6368 756e 6b73 3d35 3030 2920 2023 2064  chunks=500)  # d
-0001b9e0: 6f63 7465 7374 3a20 2b53 4b49 500a 2020  octest: +SKIP.  
-0001b9f0: 2020 2020 2020 2020 203e 3e3e 2064 6963           >>> dic
-0001ba00: 7428 612e 6461 736b 2920 2023 2064 6f63  t(a.dask)  # doc
-0001ba10: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-0001ba20: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-0001ba30: 2020 2020 2020 2027 6172 7261 792d 6f72         'array-or
-0001ba40: 6967 696e 616c 2d3c 6e61 6d65 3e27 3a20  iginal-<name>': 
-0001ba50: 3c48 4446 3520 6461 7461 7365 7420 2e2e  <HDF5 dataset ..
-0001ba60: 2e3e 2c0a 2020 2020 2020 2020 2020 2020  .>,.            
-0001ba70: 2020 2827 6172 7261 792d 3c6e 616d 653e    ('array-<name>
-0001ba80: 272c 2030 293a 2028 6765 7469 7465 6d2c  ', 0): (getitem,
-0001ba90: 2022 6172 7261 792d 6f72 6967 696e 616c   "array-original
-0001baa0: 2d3c 6e61 6d65 3e22 2c20 2e2e 2e29 2c0a  -<name>", ...),.
-0001bab0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
-0001bac0: 6172 7261 792d 3c6e 616d 653e 272c 2031  array-<name>', 1
-0001bad0: 293a 2028 6765 7469 7465 6d2c 2022 6172  ): (getitem, "ar
-0001bae0: 7261 792d 6f72 6967 696e 616c 2d3c 6e61  ray-original-<na
-0001baf0: 6d65 3e22 2c20 2e2e 2e29 0a20 2020 2020  me>", ...).     
-0001bb00: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-0001bb10: 2057 6974 6820 6060 696e 6c69 6e65 5f61   With ``inline_a
-0001bb20: 7272 6179 3d54 7275 6560 602c 2044 6173  rray=True``, Das
-0001bb30: 6b20 7769 6c6c 2069 6e73 7465 6164 2069  k will instead i
-0001bb40: 6e6c 696e 6520 7468 6520 6172 7261 7920  nline the array 
-0001bb50: 6469 7265 6374 6c79 0a20 2020 2020 2020  directly.       
-0001bb60: 2069 6e20 7468 6520 7661 6c75 6573 206f   in the values o
-0001bb70: 6620 7468 6520 7461 736b 2067 7261 7068  f the task graph
-0001bb80: 2e0a 0a20 2020 2020 2020 202e 2e20 636f  ...        .. co
-0001bb90: 6465 2d62 6c6f 636b 3a3a 2070 7974 686f  de-block:: pytho
-0001bba0: 6e0a 0a20 2020 2020 2020 2020 2020 3e3e  n..           >>
-0001bbb0: 3e20 6120 3d20 6461 2e66 726f 6d5f 6172  > a = da.from_ar
-0001bbc0: 7261 7928 782c 2063 6875 6e6b 733d 3530  ray(x, chunks=50
-0001bbd0: 302c 2069 6e6c 696e 655f 6172 7261 793d  0, inline_array=
-0001bbe0: 5472 7565 2920 2023 2064 6f63 7465 7374  True)  # doctest
-0001bbf0: 3a20 2b53 4b49 500a 2020 2020 2020 2020  : +SKIP.        
-0001bc00: 2020 203e 3e3e 2064 6963 7428 612e 6461     >>> dict(a.da
-0001bc10: 736b 2920 2023 2064 6f63 7465 7374 3a20  sk)  # doctest: 
-0001bc20: 2b53 4b49 500a 2020 2020 2020 2020 2020  +SKIP.          
-0001bc30: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0001bc40: 2028 2761 7272 6179 2d3c 6e61 6d65 3e27   ('array-<name>'
-0001bc50: 2c20 3029 3a20 2867 6574 6974 656d 2c20  , 0): (getitem, 
-0001bc60: 3c48 4446 3520 6461 7461 7365 7420 2e2e  <HDF5 dataset ..
-0001bc70: 2e3e 2c20 2e2e 2e29 2c0a 2020 2020 2020  .>, ...),.      
-0001bc80: 2020 2020 2020 2020 2827 6172 7261 792d          ('array-
-0001bc90: 3c6e 616d 653e 272c 2031 293a 2028 6765  <name>', 1): (ge
-0001bca0: 7469 7465 6d2c 203c 4844 4635 2064 6174  titem, <HDF5 dat
-0001bcb0: 6173 6574 202e 2e2e 3e2c 202e 2e2e 290a  aset ...>, ...).
-0001bcc0: 2020 2020 2020 2020 2020 207d 0a0a 2020             }..  
-0001bcd0: 2020 2020 2020 4e6f 7465 2074 6861 7420        Note that 
-0001bce0: 7468 6572 6527 7320 6e6f 206b 6579 2069  there's no key i
-0001bcf0: 6e20 7468 6520 7461 736b 2067 7261 7068  n the task graph
-0001bd00: 2077 6974 6820 6a75 7374 2074 6865 2061   with just the a
-0001bd10: 7272 6179 2060 7860 0a20 2020 2020 2020  rray `x`.       
-0001bd20: 2061 6e79 6d6f 7265 2e20 496e 7374 6561   anymore. Instea
-0001bd30: 6420 6974 2773 2070 6c61 6365 6420 6469  d it's placed di
-0001bd40: 7265 6374 6c79 2069 6e20 7468 6520 7661  rectly in the va
-0001bd50: 6c75 6573 2e0a 0a20 2020 2020 2020 2054  lues...        T
-0001bd60: 6865 2072 6967 6874 2063 686f 6963 6520  he right choice 
-0001bd70: 666f 7220 6060 696e 6c69 6e65 5f61 7272  for ``inline_arr
-0001bd80: 6179 6060 2064 6570 656e 6473 206f 6e20  ay`` depends on 
-0001bd90: 7365 7665 7261 6c20 6661 6374 6f72 732c  several factors,
-0001bda0: 0a20 2020 2020 2020 2069 6e63 6c75 6469  .        includi
-0001bdb0: 6e67 2074 6865 2073 697a 6520 6f66 2060  ng the size of `
-0001bdc0: 6078 6060 2c20 686f 7720 6578 7065 6e73  `x``, how expens
-0001bdd0: 6976 6520 6974 2069 7320 746f 2063 7265  ive it is to cre
-0001bde0: 6174 652c 2077 6869 6368 0a20 2020 2020  ate, which.     
-0001bdf0: 2020 2073 6368 6564 756c 6572 2079 6f75     scheduler you
-0001be00: 2772 6520 7573 696e 672c 2061 6e64 2074  're using, and t
-0001be10: 6865 2070 6174 7465 726e 206f 6620 646f  he pattern of do
-0001be20: 776e 7374 7265 616d 2063 6f6d 7075 7461  wnstream computa
-0001be30: 7469 6f6e 732e 0a20 2020 2020 2020 2041  tions..        A
-0001be40: 7320 6120 6865 7572 6973 7469 632c 2060  s a heuristic, `
-0001be50: 6069 6e6c 696e 655f 6172 7261 793d 5472  `inline_array=Tr
-0001be60: 7565 6060 206d 6179 2062 6520 7468 6520  ue`` may be the 
-0001be70: 7269 6768 7420 6368 6f69 6365 2077 6865  right choice whe
-0001be80: 6e0a 2020 2020 2020 2020 7468 6520 6172  n.        the ar
-0001be90: 7261 7920 6060 7860 6020 6973 2063 6865  ray ``x`` is che
-0001bea0: 6170 2074 6f20 7365 7269 616c 697a 6520  ap to serialize 
-0001beb0: 616e 6420 6465 7365 7269 616c 697a 6520  and deserialize 
-0001bec0: 2873 696e 6365 2069 7427 730a 2020 2020  (since it's.    
-0001bed0: 2020 2020 696e 636c 7564 6564 2069 6e20      included in 
-0001bee0: 7468 6520 6772 6170 6820 6d61 6e79 2074  the graph many t
-0001bef0: 696d 6573 2920 616e 6420 6966 2079 6f75  imes) and if you
-0001bf00: 2772 6520 6578 7065 7269 656e 6369 6e67  're experiencing
-0001bf10: 206f 7264 6572 696e 670a 2020 2020 2020   ordering.      
-0001bf20: 2020 6973 7375 6573 2028 7365 6520 3a72    issues (see :r
-0001bf30: 6566 3a60 6f72 6465 7260 2066 6f72 206d  ef:`order` for m
-0001bf40: 6f72 6529 2e0a 0a20 2020 2020 2020 2054  ore)...        T
-0001bf50: 6869 7320 6861 7320 6e6f 2065 6666 6563  his has no effec
-0001bf60: 7420 7768 656e 2060 6078 6060 2069 7320  t when ``x`` is 
-0001bf70: 6120 4e75 6d50 7920 6172 7261 792e 0a0a  a NumPy array...
-0001bf80: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-0001bf90: 202d 2d2d 2d2d 2d2d 2d0a 0a20 2020 203e   --------..    >
-0001bfa0: 3e3e 2078 203d 2068 3570 792e 4669 6c65  >> x = h5py.File
-0001bfb0: 2827 2e2e 2e27 295b 272f 6461 7461 2f70  ('...')['/data/p
-0001bfc0: 6174 6827 5d20 2023 2064 6f63 7465 7374  ath']  # doctest
-0001bfd0: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
-0001bfe0: 6120 3d20 6461 2e66 726f 6d5f 6172 7261  a = da.from_arra
-0001bff0: 7928 782c 2063 6875 6e6b 733d 2831 3030  y(x, chunks=(100
-0001c000: 302c 2031 3030 3029 2920 2023 2064 6f63  0, 1000))  # doc
-0001c010: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
-0001c020: 2049 6620 796f 7572 2075 6e64 6572 6c79   If your underly
-0001c030: 696e 6720 6461 7461 7374 6f72 6520 646f  ing datastore do
-0001c040: 6573 206e 6f74 2073 7570 706f 7274 2063  es not support c
-0001c050: 6f6e 6375 7272 656e 7420 7265 6164 7320  oncurrent reads 
-0001c060: 7468 656e 2069 6e63 6c75 6465 0a20 2020  then include.   
-0001c070: 2074 6865 2060 606c 6f63 6b3d 5472 7565   the ``lock=True
-0001c080: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
-0001c090: 656e 7420 6f72 2060 606c 6f63 6b3d 6d79  ent or ``lock=my
-0001c0a0: 6c6f 636b 6060 2069 6620 796f 7520 7761  lock`` if you wa
-0001c0b0: 6e74 206d 756c 7469 706c 650a 2020 2020  nt multiple.    
-0001c0c0: 6172 7261 7973 2074 6f20 636f 6f72 6469  arrays to coordi
-0001c0d0: 6e61 7465 2061 726f 756e 6420 7468 6520  nate around the 
-0001c0e0: 7361 6d65 206c 6f63 6b2e 0a0a 2020 2020  same lock...    
-0001c0f0: 3e3e 3e20 6120 3d20 6461 2e66 726f 6d5f  >>> a = da.from_
-0001c100: 6172 7261 7928 782c 2063 6875 6e6b 733d  array(x, chunks=
-0001c110: 2831 3030 302c 2031 3030 3029 2c20 6c6f  (1000, 1000), lo
-0001c120: 636b 3d54 7275 6529 2020 2320 646f 6374  ck=True)  # doct
-0001c130: 6573 743a 202b 534b 4950 0a0a 2020 2020  est: +SKIP..    
-0001c140: 4966 2079 6f75 7220 756e 6465 726c 7969  If your underlyi
-0001c150: 6e67 2064 6174 6173 746f 7265 2068 6173  ng datastore has
-0001c160: 2061 2060 602e 6368 756e 6b73 6060 2061   a ``.chunks`` a
-0001c170: 7474 7269 6275 7465 2028 6173 2068 3570  ttribute (as h5p
-0001c180: 7920 616e 6420 7a61 7272 0a20 2020 2064  y and zarr.    d
-0001c190: 6174 6173 6574 7320 646f 2920 7468 656e  atasets do) then
-0001c1a0: 2061 206d 756c 7469 706c 6520 6f66 2074   a multiple of t
-0001c1b0: 6861 7420 6368 756e 6b20 7368 6170 6520  hat chunk shape 
-0001c1c0: 7769 6c6c 2062 6520 7573 6564 2069 6620  will be used if 
-0001c1d0: 796f 750a 2020 2020 646f 206e 6f74 2070  you.    do not p
-0001c1e0: 726f 7669 6465 2061 2063 6875 6e6b 2073  rovide a chunk s
-0001c1f0: 6861 7065 2e0a 0a20 2020 203e 3e3e 2061  hape...    >>> a
-0001c200: 203d 2064 612e 6672 6f6d 5f61 7272 6179   = da.from_array
-0001c210: 2878 2c20 6368 756e 6b73 3d27 6175 746f  (x, chunks='auto
-0001c220: 2729 2020 2320 646f 6374 6573 743a 202b  ')  # doctest: +
-0001c230: 534b 4950 0a20 2020 203e 3e3e 2061 203d  SKIP.    >>> a =
-0001c240: 2064 612e 6672 6f6d 5f61 7272 6179 2878   da.from_array(x
-0001c250: 2c20 6368 756e 6b73 3d27 3130 3020 4d69  , chunks='100 Mi
-0001c260: 4227 2920 2023 2064 6f63 7465 7374 3a20  B')  # doctest: 
-0001c270: 2b53 4b49 500a 2020 2020 3e3e 3e20 6120  +SKIP.    >>> a 
-0001c280: 3d20 6461 2e66 726f 6d5f 6172 7261 7928  = da.from_array(
-0001c290: 7829 2020 2320 646f 6374 6573 743a 202b  x)  # doctest: +
-0001c2a0: 534b 4950 0a0a 2020 2020 4966 2070 726f  SKIP..    If pro
-0001c2b0: 7669 6469 6e67 2061 206e 616d 652c 2065  viding a name, e
-0001c2c0: 6e73 7572 6520 7468 6174 2069 7420 6973  nsure that it is
-0001c2d0: 2075 6e69 7175 650a 0a20 2020 203e 3e3e   unique..    >>>
-0001c2e0: 2069 6d70 6f72 7420 6461 736b 2e62 6173   import dask.bas
-0001c2f0: 650a 2020 2020 3e3e 3e20 746f 6b65 6e20  e.    >>> token 
-0001c300: 3d20 6461 736b 2e62 6173 652e 746f 6b65  = dask.base.toke
-0001c310: 6e69 7a65 2878 2920 2023 2064 6f63 7465  nize(x)  # docte
-0001c320: 7374 3a20 2b53 4b49 500a 2020 2020 3e3e  st: +SKIP.    >>
-0001c330: 3e20 6120 3d20 6461 2e66 726f 6d5f 6172  > a = da.from_ar
-0001c340: 7261 7928 276d 7961 7272 6179 2d27 202b  ray('myarray-' +
-0001c350: 2074 6f6b 656e 2920 2023 2064 6f63 7465   token)  # docte
-0001c360: 7374 3a20 2b53 4b49 500a 0a20 2020 204e  st: +SKIP..    N
-0001c370: 756d 5079 206e 6461 7272 6179 7320 6172  umPy ndarrays ar
-0001c380: 6520 6561 6765 726c 7920 736c 6963 6564  e eagerly sliced
-0001c390: 2061 6e64 2074 6865 6e20 656d 6265 6464   and then embedd
-0001c3a0: 6564 2069 6e20 7468 6520 6772 6170 682e  ed in the graph.
-0001c3b0: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
-0001c3c0: 2064 6173 6b2e 6172 7261 790a 2020 2020   dask.array.    
-0001c3d0: 3e3e 3e20 6120 3d20 6461 736b 2e61 7272  >>> a = dask.arr
-0001c3e0: 6179 2e66 726f 6d5f 6172 7261 7928 6e70  ay.from_array(np
-0001c3f0: 2e61 7272 6179 285b 5b31 2c20 325d 2c20  .array([[1, 2], 
-0001c400: 5b33 2c20 345d 5d29 2c20 6368 756e 6b73  [3, 4]]), chunks
-0001c410: 3d28 312c 3129 290a 2020 2020 3e3e 3e20  =(1,1)).    >>> 
-0001c420: 612e 6461 736b 5b61 2e6e 616d 652c 2030  a.dask[a.name, 0
-0001c430: 2c20 305d 5b30 5d0a 2020 2020 6172 7261  , 0][0].    arra
-0001c440: 7928 5b31 5d29 0a0a 2020 2020 4368 756e  y([1])..    Chun
-0001c450: 6b73 2077 6974 6820 6578 6163 746c 792d  ks with exactly-
-0001c460: 7370 6563 6966 6965 642c 2064 6966 6665  specified, diffe
-0001c470: 7265 6e74 2073 697a 6573 2063 616e 2062  rent sizes can b
-0001c480: 6520 6372 6561 7465 642e 0a0a 2020 2020  e created...    
-0001c490: 3e3e 3e20 696d 706f 7274 206e 756d 7079  >>> import numpy
-0001c4a0: 2061 7320 6e70 0a20 2020 203e 3e3e 2069   as np.    >>> i
-0001c4b0: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
-0001c4c0: 2061 7320 6461 0a20 2020 203e 3e3e 2072   as da.    >>> r
-0001c4d0: 6e67 203d 206e 702e 7261 6e64 6f6d 2e64  ng = np.random.d
-0001c4e0: 6566 6175 6c74 5f72 6e67 2829 0a20 2020  efault_rng().   
-0001c4f0: 203e 3e3e 2078 203d 2072 6e67 2e72 616e   >>> x = rng.ran
-0001c500: 646f 6d28 2831 3030 2c20 3629 290a 2020  dom((100, 6)).  
-0001c510: 2020 3e3e 3e20 6120 3d20 6461 2e66 726f    >>> a = da.fro
-0001c520: 6d5f 6172 7261 7928 782c 2063 6875 6e6b  m_array(x, chunk
-0001c530: 733d 2828 3637 2c20 3333 292c 2028 362c  s=((67, 33), (6,
-0001c540: 2929 290a 2020 2020 2222 220a 2020 2020  ))).    """.    
-0001c550: 6966 2069 7369 6e73 7461 6e63 6528 782c  if isinstance(x,
-0001c560: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
-0001c570: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0001c580: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
-0001c590: 4172 7261 7920 6973 2061 6c72 6561 6479  Array is already
-0001c5a0: 2061 2064 6173 6b20 6172 7261 792e 2055   a dask array. U
-0001c5b0: 7365 2027 6173 6172 7261 7927 206f 7220  se 'asarray' or 
-0001c5c0: 2220 2227 7265 6368 756e 6b27 2069 6e73  " "'rechunk' ins
-0001c5d0: 7465 6164 2e22 0a20 2020 2020 2020 2029  tead.".        )
-0001c5e0: 0a20 2020 2065 6c69 6620 6973 5f64 6173  .    elif is_das
-0001c5f0: 6b5f 636f 6c6c 6563 7469 6f6e 2878 293a  k_collection(x):
-0001c600: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
-0001c610: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0001c620: 2020 2020 2250 6173 7369 6e67 2061 6e20      "Passing an 
-0001c630: 6f62 6a65 6374 2074 6f20 6461 736b 2e61  object to dask.a
-0001c640: 7272 6179 2e66 726f 6d5f 6172 7261 7920  rray.from_array 
-0001c650: 7768 6963 6820 6973 2061 6c72 6561 6479  which is already
-0001c660: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
-0001c670: 2022 4461 736b 2063 6f6c 6c65 6374 696f   "Dask collectio
-0001c680: 6e2e 2054 6869 7320 6361 6e20 6c65 6164  n. This can lead
-0001c690: 2074 6f20 756e 6578 7065 6374 6564 2062   to unexpected b
-0001c6a0: 6568 6176 696f 722e 220a 2020 2020 2020  ehavior.".      
-0001c6b0: 2020 290a 0a20 2020 2069 6620 6973 696e    )..    if isin
-0001c6c0: 7374 616e 6365 2878 2c20 286c 6973 742c  stance(x, (list,
-0001c6d0: 2074 7570 6c65 2c20 6d65 6d6f 7279 7669   tuple, memoryvi
-0001c6e0: 6577 2920 2b20 6e70 2e53 6361 6c61 7254  ew) + np.ScalarT
-0001c6f0: 7970 6529 3a0a 2020 2020 2020 2020 7820  ype):.        x 
-0001c700: 3d20 6e70 2e61 7272 6179 2878 290a 0a20  = np.array(x).. 
-0001c710: 2020 2069 6620 6173 6172 7261 7920 6973     if asarray is
-0001c720: 204e 6f6e 653a 0a20 2020 2020 2020 2061   None:.        a
-0001c730: 7361 7272 6179 203d 206e 6f74 2068 6173  sarray = not has
-0001c740: 6174 7472 2878 2c20 225f 5f61 7272 6179  attr(x, "__array
-0001c750: 5f66 756e 6374 696f 6e5f 5f22 290a 0a20  _function__").. 
-0001c760: 2020 2070 7265 7669 6f75 735f 6368 756e     previous_chun
-0001c770: 6b73 203d 2067 6574 6174 7472 2878 2c20  ks = getattr(x, 
-0001c780: 2263 6875 6e6b 7322 2c20 4e6f 6e65 290a  "chunks", None).
-0001c790: 0a20 2020 2063 6875 6e6b 7320 3d20 6e6f  .    chunks = no
-0001c7a0: 726d 616c 697a 655f 6368 756e 6b73 280a  rmalize_chunks(.
-0001c7b0: 2020 2020 2020 2020 6368 756e 6b73 2c20          chunks, 
-0001c7c0: 782e 7368 6170 652c 2064 7479 7065 3d78  x.shape, dtype=x
-0001c7d0: 2e64 7479 7065 2c20 7072 6576 696f 7573  .dtype, previous
-0001c7e0: 5f63 6875 6e6b 733d 7072 6576 696f 7573  _chunks=previous
-0001c7f0: 5f63 6875 6e6b 730a 2020 2020 290a 0a20  _chunks.    ).. 
-0001c800: 2020 2069 6620 6e61 6d65 2069 6e20 284e     if name in (N
-0001c810: 6f6e 652c 2054 7275 6529 3a0a 2020 2020  one, True):.    
-0001c820: 2020 2020 746f 6b65 6e20 3d20 746f 6b65      token = toke
-0001c830: 6e69 7a65 2878 2c20 6368 756e 6b73 2c20  nize(x, chunks, 
-0001c840: 6c6f 636b 2c20 6173 6172 7261 792c 2066  lock, asarray, f
-0001c850: 616e 6379 2c20 6765 7469 7465 6d2c 2069  ancy, getitem, i
-0001c860: 6e6c 696e 655f 6172 7261 7929 0a20 2020  nline_array).   
-0001c870: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
-0001c880: 206f 7220 2261 7272 6179 2d22 202b 2074   or "array-" + t
-0001c890: 6f6b 656e 0a20 2020 2065 6c69 6620 6e61  oken.    elif na
-0001c8a0: 6d65 2069 7320 4661 6c73 653a 0a20 2020  me is False:.   
-0001c8b0: 2020 2020 206e 616d 6520 3d20 2261 7272       name = "arr
-0001c8c0: 6179 2d22 202b 2073 7472 2875 7569 642e  ay-" + str(uuid.
-0001c8d0: 7575 6964 3128 2929 0a0a 2020 2020 6966  uuid1())..    if
-0001c8e0: 206c 6f63 6b20 6973 2054 7275 653a 0a20   lock is True:. 
-0001c8f0: 2020 2020 2020 206c 6f63 6b20 3d20 5365         lock = Se
-0001c900: 7269 616c 697a 6162 6c65 4c6f 636b 2829  rializableLock()
-0001c910: 0a0a 2020 2020 6973 5f6e 6461 7272 6179  ..    is_ndarray
-0001c920: 203d 2074 7970 6528 7829 2069 6e20 286e   = type(x) in (n
-0001c930: 702e 6e64 6172 7261 792c 206e 702e 6d61  p.ndarray, np.ma
-0001c940: 2e63 6f72 652e 4d61 736b 6564 4172 7261  .core.MaskedArra
-0001c950: 7929 0a20 2020 2069 735f 7369 6e67 6c65  y).    is_single
-0001c960: 5f62 6c6f 636b 203d 2061 6c6c 286c 656e  _block = all(len
-0001c970: 2863 2920 3d3d 2031 2066 6f72 2063 2069  (c) == 1 for c i
-0001c980: 6e20 6368 756e 6b73 290a 2020 2020 2320  n chunks).    # 
-0001c990: 416c 7761 7973 2075 7365 2074 6865 2067  Always use the g
-0001c9a0: 6574 7465 7220 666f 7220 6835 7079 2065  etter for h5py e
-0001c9b0: 7463 2e20 4e6f 7420 7573 696e 6720 6973  tc. Not using is
-0001c9c0: 696e 7374 616e 6365 2878 2c20 6e70 2e6e  instance(x, np.n
-0001c9d0: 6461 7272 6179 290a 2020 2020 2320 6265  darray).    # be
-0001c9e0: 6361 7573 6520 6e70 2e6d 6174 7269 7820  cause np.matrix 
-0001c9f0: 6973 2061 2073 7562 636c 6173 7320 6f66  is a subclass of
-0001ca00: 206e 702e 6e64 6172 7261 792e 0a20 2020   np.ndarray..   
-0001ca10: 2069 6620 6973 5f6e 6461 7272 6179 2061   if is_ndarray a
-0001ca20: 6e64 206e 6f74 2069 735f 7369 6e67 6c65  nd not is_single
-0001ca30: 5f62 6c6f 636b 2061 6e64 206e 6f74 206c  _block and not l
-0001ca40: 6f63 6b3a 0a20 2020 2020 2020 2023 2065  ock:.        # e
-0001ca50: 6167 6572 6c79 2073 6c69 6365 206e 756d  agerly slice num
-0001ca60: 7079 2061 7272 6179 7320 746f 2070 7265  py arrays to pre
-0001ca70: 7665 6e74 206d 656d 6f72 7920 626c 6f77  vent memory blow
-0001ca80: 7570 0a20 2020 2020 2020 2023 2047 4835  up.        # GH5
-0001ca90: 3336 372c 2047 4835 3630 310a 2020 2020  367, GH5601.    
-0001caa0: 2020 2020 736c 6963 6573 203d 2073 6c69      slices = sli
-0001cab0: 6365 735f 6672 6f6d 5f63 6875 6e6b 7328  ces_from_chunks(
-0001cac0: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
-0001cad0: 6b65 7973 203d 2070 726f 6475 6374 285b  keys = product([
-0001cae0: 6e61 6d65 5d2c 202a 2872 616e 6765 286c  name], *(range(l
-0001caf0: 656e 2862 6473 2929 2066 6f72 2062 6473  en(bds)) for bds
-0001cb00: 2069 6e20 6368 756e 6b73 2929 0a20 2020   in chunks)).   
-0001cb10: 2020 2020 2076 616c 7565 7320 3d20 5b78       values = [x
-0001cb20: 5b73 6c63 5d20 666f 7220 736c 6320 696e  [slc] for slc in
-0001cb30: 2073 6c69 6365 735d 0a20 2020 2020 2020   slices].       
-0001cb40: 2064 736b 203d 2064 6963 7428 7a69 7028   dsk = dict(zip(
-0001cb50: 6b65 7973 2c20 7661 6c75 6573 2929 0a0a  keys, values))..
-0001cb60: 2020 2020 656c 6966 2069 735f 6e64 6172      elif is_ndar
-0001cb70: 7261 7920 616e 6420 6973 5f73 696e 676c  ray and is_singl
-0001cb80: 655f 626c 6f63 6b3a 0a20 2020 2020 2020  e_block:.       
-0001cb90: 2023 204e 6f20 736c 6963 696e 6720 6e65   # No slicing ne
-0001cba0: 6564 6564 0a20 2020 2020 2020 2064 736b  eded.        dsk
-0001cbb0: 203d 207b 286e 616d 652c 2920 2b20 2830   = {(name,) + (0
-0001cbc0: 2c29 202a 2078 2e6e 6469 6d3a 2078 7d0a  ,) * x.ndim: x}.
-0001cbd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001cbe0: 2020 6966 2067 6574 6974 656d 2069 7320    if getitem is 
-0001cbf0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001cc00: 2020 6966 2066 616e 6379 3a0a 2020 2020    if fancy:.    
-0001cc10: 2020 2020 2020 2020 2020 2020 6765 7469              geti
-0001cc20: 7465 6d20 3d20 6765 7474 6572 0a20 2020  tem = getter.   
-0001cc30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-0001cc50: 6574 6974 656d 203d 2067 6574 7465 725f  etitem = getter_
-0001cc60: 6e6f 6661 6e63 790a 0a20 2020 2020 2020  nofancy..       
-0001cc70: 2064 736b 203d 2067 7261 7068 5f66 726f   dsk = graph_fro
-0001cc80: 6d5f 6172 7261 796c 696b 6528 0a20 2020  m_arraylike(.   
-0001cc90: 2020 2020 2020 2020 2078 2c0a 2020 2020           x,.    
-0001cca0: 2020 2020 2020 2020 6368 756e 6b73 2c0a          chunks,.
-0001ccb0: 2020 2020 2020 2020 2020 2020 782e 7368              x.sh
-0001ccc0: 6170 652c 0a20 2020 2020 2020 2020 2020  ape,.           
-0001ccd0: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
-0001cce0: 2020 2067 6574 6974 656d 3d67 6574 6974     getitem=getit
-0001ccf0: 656d 2c0a 2020 2020 2020 2020 2020 2020  em,.            
-0001cd00: 6c6f 636b 3d6c 6f63 6b2c 0a20 2020 2020  lock=lock,.     
-0001cd10: 2020 2020 2020 2061 7361 7272 6179 3d61         asarray=a
-0001cd20: 7361 7272 6179 2c0a 2020 2020 2020 2020  sarray,.        
-0001cd30: 2020 2020 6474 7970 653d 782e 6474 7970      dtype=x.dtyp
-0001cd40: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
-0001cd50: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
-0001cd60: 6e65 5f61 7272 6179 2c0a 2020 2020 2020  ne_array,.      
-0001cd70: 2020 290a 0a20 2020 2023 2057 6f72 6b61    )..    # Worka
-0001cd80: 726f 756e 6420 666f 7220 5469 6c65 4442  round for TileDB
-0001cd90: 2c20 6974 7320 696e 6465 7869 6e67 2069  , its indexing i
-0001cda0: 7320 312d 6261 7365 642c 0a20 2020 2023  s 1-based,.    #
-0001cdb0: 2061 6e64 2064 6f65 736e 2774 2073 6565   and doesn't see
-0001cdc0: 6d73 2074 6f20 7375 7070 6f72 7420 302d  ms to support 0-
-0001cdd0: 6c65 6e67 7468 2073 6c69 6369 6e67 0a20  length slicing. 
-0001cde0: 2020 2069 6620 782e 5f5f 636c 6173 735f     if x.__class_
-0001cdf0: 5f2e 5f5f 6d6f 6475 6c65 5f5f 2e73 706c  _.__module__.spl
-0001ce00: 6974 2822 2e22 295b 305d 203d 3d20 2274  it(".")[0] == "t
-0001ce10: 696c 6564 6222 2061 6e64 2068 6173 6174  iledb" and hasat
-0001ce20: 7472 2878 2c20 225f 6374 785f 2229 3a0a  tr(x, "_ctx_"):.
-0001ce30: 2020 2020 2020 2020 7265 7475 726e 2041          return A
-0001ce40: 7272 6179 2864 736b 2c20 6e61 6d65 2c20  rray(dsk, name, 
-0001ce50: 6368 756e 6b73 2c20 6474 7970 653d 782e  chunks, dtype=x.
-0001ce60: 6474 7970 6529 0a0a 2020 2020 6966 206d  dtype)..    if m
-0001ce70: 6574 6120 6973 204e 6f6e 653a 0a20 2020  eta is None:.   
-0001ce80: 2020 2020 206d 6574 6120 3d20 780a 0a20       meta = x.. 
-0001ce90: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
-0001cea0: 6473 6b2c 206e 616d 652c 2063 6875 6e6b  dsk, name, chunk
-0001ceb0: 732c 206d 6574 613d 6d65 7461 2c20 6474  s, meta=meta, dt
-0001cec0: 7970 653d 6765 7461 7474 7228 782c 2022  ype=getattr(x, "
-0001ced0: 6474 7970 6522 2c20 4e6f 6e65 2929 0a0a  dtype", None))..
-0001cee0: 0a64 6566 2066 726f 6d5f 7a61 7272 280a  .def from_zarr(.
-0001cef0: 2020 2020 7572 6c2c 0a20 2020 2063 6f6d      url,.    com
-0001cf00: 706f 6e65 6e74 3d4e 6f6e 652c 0a20 2020  ponent=None,.   
-0001cf10: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
-0001cf20: 3d4e 6f6e 652c 0a20 2020 2063 6875 6e6b  =None,.    chunk
-0001cf30: 733d 4e6f 6e65 2c0a 2020 2020 6e61 6d65  s=None,.    name
-0001cf40: 3d4e 6f6e 652c 0a20 2020 2069 6e6c 696e  =None,.    inlin
-0001cf50: 655f 6172 7261 793d 4661 6c73 652c 0a20  e_array=False,. 
-0001cf60: 2020 202a 2a6b 7761 7267 732c 0a29 3a0a     **kwargs,.):.
-0001cf70: 2020 2020 2222 224c 6f61 6420 6172 7261      """Load arra
-0001cf80: 7920 6672 6f6d 2074 6865 207a 6172 7220  y from the zarr 
-0001cf90: 7374 6f72 6167 6520 666f 726d 6174 0a0a  storage format..
-0001cfa0: 2020 2020 5365 6520 6874 7470 733a 2f2f      See https://
-0001cfb0: 7a61 7272 2e72 6561 6474 6865 646f 6373  zarr.readthedocs
-0001cfc0: 2e69 6f20 666f 7220 6465 7461 696c 7320  .io for details 
-0001cfd0: 6162 6f75 7420 7468 6520 666f 726d 6174  about the format
-0001cfe0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-0001cff0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-0001d000: 0a20 2020 2075 726c 3a20 5a61 7272 2041  .    url: Zarr A
-0001d010: 7272 6179 206f 7220 7374 7220 6f72 204d  rray or str or M
-0001d020: 7574 6162 6c65 4d61 7070 696e 670a 2020  utableMapping.  
-0001d030: 2020 2020 2020 4c6f 6361 7469 6f6e 206f        Location o
-0001d040: 6620 7468 6520 6461 7461 2e20 4120 5552  f the data. A UR
-0001d050: 4c20 6361 6e20 696e 636c 7564 6520 6120  L can include a 
-0001d060: 7072 6f74 6f63 6f6c 2073 7065 6369 6669  protocol specifi
-0001d070: 6572 206c 696b 6520 7333 3a2f 2f0a 2020  er like s3://.  
-0001d080: 2020 2020 2020 666f 7220 7265 6d6f 7465        for remote
-0001d090: 2064 6174 612e 2043 616e 2061 6c73 6f20   data. Can also 
-0001d0a0: 6265 2061 6e79 204d 7574 6162 6c65 4d61  be any MutableMa
-0001d0b0: 7070 696e 6720 696e 7374 616e 6365 2c20  pping instance, 
-0001d0c0: 7768 6963 6820 7368 6f75 6c64 0a20 2020  which should.   
-0001d0d0: 2020 2020 2062 6520 7365 7269 616c 697a       be serializ
-0001d0e0: 6162 6c65 2069 6620 7573 6564 2069 6e20  able if used in 
-0001d0f0: 6d75 6c74 6970 6c65 2070 726f 6365 7373  multiple process
-0001d100: 6573 2e0a 2020 2020 636f 6d70 6f6e 656e  es..    componen
-0001d110: 743a 2073 7472 206f 7220 4e6f 6e65 0a20  t: str or None. 
-0001d120: 2020 2020 2020 2049 6620 7468 6520 6c6f         If the lo
-0001d130: 6361 7469 6f6e 2069 7320 6120 7a61 7272  cation is a zarr
-0001d140: 2067 726f 7570 2072 6174 6865 7220 7468   group rather th
-0001d150: 616e 2061 6e20 6172 7261 792c 2074 6869  an an array, thi
-0001d160: 7320 6973 2074 6865 0a20 2020 2020 2020  s is the.       
-0001d170: 2073 7562 636f 6d70 6f6e 656e 7420 7468   subcomponent th
-0001d180: 6174 2073 686f 756c 6420 6265 206c 6f61  at should be loa
-0001d190: 6465 642c 2073 6f6d 6574 6869 6e67 206c  ded, something l
-0001d1a0: 696b 6520 6060 2766 6f6f 2f62 6172 2760  ike ``'foo/bar'`
-0001d1b0: 602e 0a20 2020 2073 746f 7261 6765 5f6f  `..    storage_o
-0001d1c0: 7074 696f 6e73 3a20 6469 6374 0a20 2020  ptions: dict.   
-0001d1d0: 2020 2020 2041 6e79 2061 6464 6974 696f       Any additio
-0001d1e0: 6e61 6c20 7061 7261 6d65 7465 7273 2066  nal parameters f
-0001d1f0: 6f72 2074 6865 2073 746f 7261 6765 2062  or the storage b
-0001d200: 6163 6b65 6e64 2028 6967 6e6f 7265 6420  ackend (ignored 
-0001d210: 666f 7220 6c6f 6361 6c0a 2020 2020 2020  for local.      
-0001d220: 2020 7061 7468 7329 0a20 2020 2063 6875    paths).    chu
-0001d230: 6e6b 733a 2074 7570 6c65 206f 6620 696e  nks: tuple of in
-0001d240: 7473 206f 7220 7475 706c 6573 206f 6620  ts or tuples of 
-0001d250: 696e 7473 0a20 2020 2020 2020 2050 6173  ints.        Pas
-0001d260: 7365 6420 746f 203a 6675 6e63 3a60 6461  sed to :func:`da
-0001d270: 736b 2e61 7272 6179 2e66 726f 6d5f 6172  sk.array.from_ar
-0001d280: 7261 7960 2c20 616c 6c6f 7773 2073 6574  ray`, allows set
-0001d290: 7469 6e67 2074 6865 2063 6875 6e6b 7320  ting the chunks 
-0001d2a0: 6f6e 0a20 2020 2020 2020 2069 6e69 7469  on.        initi
-0001d2b0: 616c 6973 6174 696f 6e2c 2069 6620 7468  alisation, if th
-0001d2c0: 6520 6368 756e 6b69 6e67 2073 6368 656d  e chunking schem
-0001d2d0: 6520 696e 2074 6865 206f 6e2d 6469 7363  e in the on-disc
-0001d2e0: 2064 6174 6173 6574 2069 7320 6e6f 740a   dataset is not.
-0001d2f0: 2020 2020 2020 2020 6f70 7469 6d61 6c20          optimal 
-0001d300: 666f 7220 7468 6520 6361 6c63 756c 6174  for the calculat
-0001d310: 696f 6e73 2074 6f20 666f 6c6c 6f77 2e0a  ions to follow..
-0001d320: 2020 2020 6e61 6d65 203a 2073 7472 2c20      name : str, 
-0001d330: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0001d340: 2020 416e 206f 7074 696f 6e61 6c20 6b65    An optional ke
-0001d350: 796e 616d 6520 666f 7220 7468 6520 6172  yname for the ar
-0001d360: 7261 792e 2020 4465 6661 756c 7473 2074  ray.  Defaults t
-0001d370: 6f20 6861 7368 696e 6720 7468 6520 696e  o hashing the in
-0001d380: 7075 740a 2020 2020 6b77 6172 6773 3a0a  put.    kwargs:.
-0001d390: 2020 2020 2020 2020 5061 7373 6564 2074          Passed t
-0001d3a0: 6f20 3a63 6c61 7373 3a60 7a61 7272 2e63  o :class:`zarr.c
-0001d3b0: 6f72 652e 4172 7261 7960 2e0a 2020 2020  ore.Array`..    
-0001d3c0: 696e 6c69 6e65 5f61 7272 6179 203a 2062  inline_array : b
-0001d3d0: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
-0001d3e0: 7365 0a20 2020 2020 2020 2057 6865 7468  se.        Wheth
-0001d3f0: 6572 2074 6f20 696e 6c69 6e65 2074 6865  er to inline the
-0001d400: 207a 6172 7220 4172 7261 7920 696e 2074   zarr Array in t
-0001d410: 6865 2076 616c 7565 7320 6f66 2074 6865  he values of the
-0001d420: 2074 6173 6b20 6772 6170 682e 0a20 2020   task graph..   
-0001d430: 2020 2020 2053 6565 203a 6d65 7468 3a60       See :meth:`
-0001d440: 6461 736b 2e61 7272 6179 2e66 726f 6d5f  dask.array.from_
-0001d450: 6172 7261 7960 2066 6f72 2061 6e20 6578  array` for an ex
-0001d460: 706c 616e 6174 696f 6e2e 0a0a 2020 2020  planation...    
-0001d470: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
-0001d480: 2d2d 2d2d 2d0a 2020 2020 6672 6f6d 5f61  -----.    from_a
-0001d490: 7272 6179 0a20 2020 2022 2222 0a20 2020  rray.    """.   
-0001d4a0: 2069 6d70 6f72 7420 7a61 7272 0a0a 2020   import zarr..  
-0001d4b0: 2020 7374 6f72 6167 655f 6f70 7469 6f6e    storage_option
-0001d4c0: 7320 3d20 7374 6f72 6167 655f 6f70 7469  s = storage_opti
-0001d4d0: 6f6e 7320 6f72 207b 7d0a 2020 2020 6966  ons or {}.    if
-0001d4e0: 2069 7369 6e73 7461 6e63 6528 7572 6c2c   isinstance(url,
-0001d4f0: 207a 6172 722e 4172 7261 7929 3a0a 2020   zarr.Array):.  
-0001d500: 2020 2020 2020 7a20 3d20 7572 6c0a 2020        z = url.  
-0001d510: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-0001d520: 6528 7572 6c2c 2028 7374 722c 206f 732e  e(url, (str, os.
-0001d530: 5061 7468 4c69 6b65 2929 3a0a 2020 2020  PathLike)):.    
-0001d540: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001d550: 6528 7572 6c2c 206f 732e 5061 7468 4c69  e(url, os.PathLi
-0001d560: 6b65 293a 0a20 2020 2020 2020 2020 2020  ke):.           
-0001d570: 2075 726c 203d 206f 732e 6673 7061 7468   url = os.fspath
-0001d580: 2875 726c 290a 2020 2020 2020 2020 6966  (url).        if
-0001d590: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
-0001d5a0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-0001d5b0: 6f72 6520 3d20 7a61 7272 2e73 746f 7261  ore = zarr.stora
-0001d5c0: 6765 2e46 5353 746f 7265 2875 726c 2c20  ge.FSStore(url, 
-0001d5d0: 2a2a 7374 6f72 6167 655f 6f70 7469 6f6e  **storage_option
-0001d5e0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0001d5f0: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-0001d600: 7265 203d 2075 726c 0a20 2020 2020 2020  re = url.       
-0001d610: 207a 203d 207a 6172 722e 4172 7261 7928   z = zarr.Array(
-0001d620: 7374 6f72 652c 2072 6561 645f 6f6e 6c79  store, read_only
-0001d630: 3d54 7275 652c 2070 6174 683d 636f 6d70  =True, path=comp
-0001d640: 6f6e 656e 742c 202a 2a6b 7761 7267 7329  onent, **kwargs)
-0001d650: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0001d660: 2020 207a 203d 207a 6172 722e 4172 7261     z = zarr.Arra
-0001d670: 7928 7572 6c2c 2072 6561 645f 6f6e 6c79  y(url, read_only
-0001d680: 3d54 7275 652c 2070 6174 683d 636f 6d70  =True, path=comp
-0001d690: 6f6e 656e 742c 202a 2a6b 7761 7267 7329  onent, **kwargs)
-0001d6a0: 0a20 2020 2063 6875 6e6b 7320 3d20 6368  .    chunks = ch
-0001d6b0: 756e 6b73 2069 6620 6368 756e 6b73 2069  unks if chunks i
-0001d6c0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-0001d6d0: 7a2e 6368 756e 6b73 0a20 2020 2069 6620  z.chunks.    if 
-0001d6e0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
-0001d6f0: 2020 2020 2020 6e61 6d65 203d 2022 6672        name = "fr
-0001d700: 6f6d 2d7a 6172 722d 2220 2b20 746f 6b65  om-zarr-" + toke
-0001d710: 6e69 7a65 287a 2c20 636f 6d70 6f6e 656e  nize(z, componen
-0001d720: 742c 2073 746f 7261 6765 5f6f 7074 696f  t, storage_optio
-0001d730: 6e73 2c20 6368 756e 6b73 2c20 2a2a 6b77  ns, chunks, **kw
-0001d740: 6172 6773 290a 2020 2020 7265 7475 726e  args).    return
-0001d750: 2066 726f 6d5f 6172 7261 7928 7a2c 2063   from_array(z, c
-0001d760: 6875 6e6b 732c 206e 616d 653d 6e61 6d65  hunks, name=name
-0001d770: 2c20 696e 6c69 6e65 5f61 7272 6179 3d69  , inline_array=i
-0001d780: 6e6c 696e 655f 6172 7261 7929 0a0a 0a64  nline_array)...d
-0001d790: 6566 2074 6f5f 7a61 7272 280a 2020 2020  ef to_zarr(.    
-0001d7a0: 6172 722c 0a20 2020 2075 726c 2c0a 2020  arr,.    url,.  
-0001d7b0: 2020 636f 6d70 6f6e 656e 743d 4e6f 6e65    component=None
-0001d7c0: 2c0a 2020 2020 7374 6f72 6167 655f 6f70  ,.    storage_op
-0001d7d0: 7469 6f6e 733d 4e6f 6e65 2c0a 2020 2020  tions=None,.    
-0001d7e0: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
-0001d7f0: 0a20 2020 2072 6567 696f 6e3d 4e6f 6e65  .    region=None
-0001d800: 2c0a 2020 2020 636f 6d70 7574 653d 5472  ,.    compute=Tr
-0001d810: 7565 2c0a 2020 2020 7265 7475 726e 5f73  ue,.    return_s
-0001d820: 746f 7265 643d 4661 6c73 652c 0a20 2020  tored=False,.   
-0001d830: 202a 2a6b 7761 7267 732c 0a29 3a0a 2020   **kwargs,.):.  
-0001d840: 2020 2222 2253 6176 6520 6172 7261 7920    """Save array 
-0001d850: 746f 2074 6865 207a 6172 7220 7374 6f72  to the zarr stor
-0001d860: 6167 6520 666f 726d 6174 0a0a 2020 2020  age format..    
-0001d870: 5365 6520 6874 7470 733a 2f2f 7a61 7272  See https://zarr
-0001d880: 2e72 6561 6474 6865 646f 6373 2e69 6f20  .readthedocs.io 
-0001d890: 666f 7220 6465 7461 696c 7320 6162 6f75  for details abou
-0001d8a0: 7420 7468 6520 666f 726d 6174 2e0a 0a20  t the format... 
-0001d8b0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0001d8c0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0001d8d0: 2061 7272 3a20 6461 736b 2e61 7272 6179   arr: dask.array
-0001d8e0: 0a20 2020 2020 2020 2044 6174 6120 746f  .        Data to
-0001d8f0: 2073 746f 7265 0a20 2020 2075 726c 3a20   store.    url: 
-0001d900: 5a61 7272 2041 7272 6179 206f 7220 7374  Zarr Array or st
-0001d910: 7220 6f72 204d 7574 6162 6c65 4d61 7070  r or MutableMapp
-0001d920: 696e 670a 2020 2020 2020 2020 4c6f 6361  ing.        Loca
-0001d930: 7469 6f6e 206f 6620 7468 6520 6461 7461  tion of the data
-0001d940: 2e20 4120 5552 4c20 6361 6e20 696e 636c  . A URL can incl
-0001d950: 7564 6520 6120 7072 6f74 6f63 6f6c 2073  ude a protocol s
-0001d960: 7065 6369 6669 6572 206c 696b 6520 7333  pecifier like s3
-0001d970: 3a2f 2f0a 2020 2020 2020 2020 666f 7220  ://.        for 
-0001d980: 7265 6d6f 7465 2064 6174 612e 2043 616e  remote data. Can
-0001d990: 2061 6c73 6f20 6265 2061 6e79 204d 7574   also be any Mut
-0001d9a0: 6162 6c65 4d61 7070 696e 6720 696e 7374  ableMapping inst
-0001d9b0: 616e 6365 2c20 7768 6963 6820 7368 6f75  ance, which shou
-0001d9c0: 6c64 0a20 2020 2020 2020 2062 6520 7365  ld.        be se
-0001d9d0: 7269 616c 697a 6162 6c65 2069 6620 7573  rializable if us
-0001d9e0: 6564 2069 6e20 6d75 6c74 6970 6c65 2070  ed in multiple p
-0001d9f0: 726f 6365 7373 6573 2e0a 2020 2020 636f  rocesses..    co
-0001da00: 6d70 6f6e 656e 743a 2073 7472 206f 7220  mponent: str or 
-0001da10: 4e6f 6e65 0a20 2020 2020 2020 2049 6620  None.        If 
-0001da20: 7468 6520 6c6f 6361 7469 6f6e 2069 7320  the location is 
-0001da30: 6120 7a61 7272 2067 726f 7570 2072 6174  a zarr group rat
-0001da40: 6865 7220 7468 616e 2061 6e20 6172 7261  her than an arra
-0001da50: 792c 2074 6869 7320 6973 2074 6865 0a20  y, this is the. 
-0001da60: 2020 2020 2020 2073 7562 636f 6d70 6f6e         subcompon
-0001da70: 656e 7420 7468 6174 2073 686f 756c 6420  ent that should 
-0001da80: 6265 2063 7265 6174 6564 2f6f 7665 722d  be created/over-
-0001da90: 7772 6974 7465 6e2e 0a20 2020 2073 746f  written..    sto
-0001daa0: 7261 6765 5f6f 7074 696f 6e73 3a20 6469  rage_options: di
-0001dab0: 6374 0a20 2020 2020 2020 2041 6e79 2061  ct.        Any a
-0001dac0: 6464 6974 696f 6e61 6c20 7061 7261 6d65  dditional parame
-0001dad0: 7465 7273 2066 6f72 2074 6865 2073 746f  ters for the sto
-0001dae0: 7261 6765 2062 6163 6b65 6e64 2028 6967  rage backend (ig
-0001daf0: 6e6f 7265 6420 666f 7220 6c6f 6361 6c0a  nored for local.
-0001db00: 2020 2020 2020 2020 7061 7468 7329 0a20          paths). 
-0001db10: 2020 206f 7665 7277 7269 7465 3a20 626f     overwrite: bo
-0001db20: 6f6c 0a20 2020 2020 2020 2049 6620 6769  ol.        If gi
-0001db30: 7665 6e20 6172 7261 7920 616c 7265 6164  ven array alread
-0001db40: 7920 6578 6973 7473 2c20 6f76 6572 7772  y exists, overwr
-0001db50: 6974 653d 4661 6c73 6520 7769 6c6c 2063  ite=False will c
-0001db60: 6175 7365 2061 6e20 6572 726f 722c 0a20  ause an error,. 
-0001db70: 2020 2020 2020 2077 6865 7265 206f 7665         where ove
-0001db80: 7277 7269 7465 3d54 7275 6520 7769 6c6c  rwrite=True will
-0001db90: 2072 6570 6c61 6365 2074 6865 2065 7869   replace the exi
-0001dba0: 7374 696e 6720 6461 7461 2e0a 2020 2020  sting data..    
-0001dbb0: 7265 6769 6f6e 3a20 7475 706c 6520 6f66  region: tuple of
-0001dbc0: 2073 6c69 6365 7320 6f72 204e 6f6e 650a   slices or None.
-0001dbd0: 2020 2020 2020 2020 5468 6520 7265 6769          The regi
-0001dbe0: 6f6e 206f 6620 6461 7461 2074 6861 7420  on of data that 
-0001dbf0: 7368 6f75 6c64 2062 6520 7772 6974 7465  should be writte
-0001dc00: 6e20 6966 2060 6075 726c 6060 2069 7320  n if ``url`` is 
-0001dc10: 6120 7a61 7272 2e41 7272 6179 2e0a 2020  a zarr.Array..  
-0001dc20: 2020 2020 2020 4e6f 7420 746f 2062 6520        Not to be 
-0001dc30: 7573 6564 2077 6974 6820 6f74 6865 7220  used with other 
-0001dc40: 7479 7065 7320 6f66 2060 6075 726c 6060  types of ``url``
-0001dc50: 2e0a 2020 2020 636f 6d70 7574 653a 2062  ..    compute: b
-0001dc60: 6f6f 6c0a 2020 2020 2020 2020 5365 6520  ool.        See 
-0001dc70: 3a66 756e 633a 607e 6461 736b 2e61 7272  :func:`~dask.arr
-0001dc80: 6179 2e73 746f 7265 6020 666f 7220 6d6f  ay.store` for mo
-0001dc90: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
-0001dca0: 7265 7475 726e 5f73 746f 7265 643a 2062  return_stored: b
-0001dcb0: 6f6f 6c0a 2020 2020 2020 2020 5365 6520  ool.        See 
-0001dcc0: 3a66 756e 633a 607e 6461 736b 2e61 7272  :func:`~dask.arr
-0001dcd0: 6179 2e73 746f 7265 6020 666f 7220 6d6f  ay.store` for mo
-0001dce0: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
-0001dcf0: 2a2a 6b77 6172 6773 3a0a 2020 2020 2020  **kwargs:.      
-0001dd00: 2020 5061 7373 6564 2074 6f20 7468 6520    Passed to the 
-0001dd10: 3a66 756e 633a 607a 6172 722e 6372 6561  :func:`zarr.crea
-0001dd20: 7469 6f6e 2e63 7265 6174 6560 2066 756e  tion.create` fun
-0001dd30: 6374 696f 6e2c 2065 2e67 2e2c 2063 6f6d  ction, e.g., com
-0001dd40: 7072 6573 7369 6f6e 206f 7074 696f 6e73  pression options
-0001dd50: 2e0a 0a20 2020 2052 6169 7365 730a 2020  ...    Raises.  
-0001dd60: 2020 2d2d 2d2d 2d2d 0a20 2020 2056 616c    ------.    Val
-0001dd70: 7565 4572 726f 720a 2020 2020 2020 2020  ueError.        
-0001dd80: 4966 2060 6061 7272 6060 2068 6173 2075  If ``arr`` has u
-0001dd90: 6e6b 6e6f 776e 2063 6875 6e6b 2073 697a  nknown chunk siz
-0001dda0: 6573 2c20 7768 6963 6820 6973 206e 6f74  es, which is not
-0001ddb0: 2073 7570 706f 7274 6564 2062 7920 5a61   supported by Za
-0001ddc0: 7272 2e0a 2020 2020 2020 2020 4966 2060  rr..        If `
-0001ddd0: 6072 6567 696f 6e60 6020 6973 2073 7065  `region`` is spe
-0001dde0: 6369 6669 6564 2061 6e64 2060 6075 726c  cified and ``url
-0001ddf0: 6060 2069 7320 6e6f 7420 6120 7a61 7272  `` is not a zarr
-0001de00: 2e41 7272 6179 0a0a 2020 2020 5365 6520  .Array..    See 
-0001de10: 416c 736f 0a20 2020 202d 2d2d 2d2d 2d2d  Also.    -------
-0001de20: 2d0a 2020 2020 6461 736b 2e61 7272 6179  -.    dask.array
-0001de30: 2e73 746f 7265 0a20 2020 2064 6173 6b2e  .store.    dask.
-0001de40: 6172 7261 792e 4172 7261 792e 636f 6d70  array.Array.comp
-0001de50: 7574 655f 6368 756e 6b5f 7369 7a65 730a  ute_chunk_sizes.
-0001de60: 0a20 2020 2022 2222 0a20 2020 2069 6d70  .    """.    imp
-0001de70: 6f72 7420 7a61 7272 0a0a 2020 2020 6966  ort zarr..    if
-0001de80: 206e 702e 6973 6e61 6e28 6172 722e 7368   np.isnan(arr.sh
-0001de90: 6170 6529 2e61 6e79 2829 3a0a 2020 2020  ape).any():.    
-0001dea0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001deb0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0001dec0: 2020 2253 6176 696e 6720 6120 6461 736b    "Saving a dask
-0001ded0: 2061 7272 6179 2077 6974 6820 756e 6b6e   array with unkn
-0001dee0: 6f77 6e20 6368 756e 6b20 7369 7a65 7320  own chunk sizes 
-0001def0: 6973 206e 6f74 2022 0a20 2020 2020 2020  is not ".       
-0001df00: 2020 2020 2022 6375 7272 656e 746c 7920       "currently 
-0001df10: 7375 7070 6f72 7465 6420 6279 205a 6172  supported by Zar
-0001df20: 722e 2573 2220 2520 756e 6b6e 6f77 6e5f  r.%s" % unknown_
-0001df30: 6368 756e 6b5f 6d65 7373 6167 650a 2020  chunk_message.  
-0001df40: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-0001df50: 6973 696e 7374 616e 6365 2875 726c 2c20  isinstance(url, 
-0001df60: 7a61 7272 2e41 7272 6179 293a 0a20 2020  zarr.Array):.   
-0001df70: 2020 2020 207a 203d 2075 726c 0a20 2020       z = url.   
-0001df80: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0001df90: 6365 287a 2e73 746f 7265 2c20 2864 6963  ce(z.store, (dic
-0001dfa0: 742c 204d 7574 6162 6c65 4d61 7070 696e  t, MutableMappin
-0001dfb0: 6729 293a 0a20 2020 2020 2020 2020 2020  g)):.           
-0001dfc0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001dfd0: 2020 2020 2020 6672 6f6d 2064 6973 7472        from distr
-0001dfe0: 6962 7574 6564 2069 6d70 6f72 7420 6465  ibuted import de
-0001dff0: 6661 756c 745f 636c 6965 6e74 0a0a 2020  fault_client..  
-0001e000: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0001e010: 6661 756c 745f 636c 6965 6e74 2829 0a20  fault_client(). 
-0001e020: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0001e030: 7420 2849 6d70 6f72 7445 7272 6f72 2c20  t (ImportError, 
-0001e040: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
-0001e050: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-0001e060: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
-0001e070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001e080: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
-0001e090: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0001e0a0: 2020 2020 2020 2020 2020 2020 2243 616e              "Can
-0001e0b0: 6e6f 7420 7374 6f72 6520 696e 746f 2069  not store into i
-0001e0c0: 6e20 6d65 6d6f 7279 205a 6172 7220 4172  n memory Zarr Ar
-0001e0d0: 7261 7920 7573 696e 6720 220a 2020 2020  ray using ".    
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 2274 6865 2064 6973 7472 6962 7574 6564  "the distributed
-0001e100: 2073 6368 6564 756c 6572 2e22 0a20 2020   scheduler.".   
-0001e110: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0001e120: 2020 2020 2020 2020 6966 2072 6567 696f          if regio
-0001e130: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-0001e140: 2020 2020 2020 2061 7272 203d 2061 7272         arr = arr
-0001e150: 2e72 6563 6875 6e6b 287a 2e63 6875 6e6b  .rechunk(z.chunk
-0001e160: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-0001e170: 6567 696f 6e73 203d 204e 6f6e 650a 2020  egions = None.  
-0001e180: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001e190: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
-0001e1a0: 6b2e 6172 7261 792e 736c 6963 696e 6720  k.array.slicing 
-0001e1b0: 696d 706f 7274 206e 6577 5f62 6c6f 636b  import new_block
-0001e1c0: 6469 6d2c 206e 6f72 6d61 6c69 7a65 5f69  dim, normalize_i
-0001e1d0: 6e64 6578 0a0a 2020 2020 2020 2020 2020  ndex..          
-0001e1e0: 2020 6f6c 645f 6368 756e 6b73 203d 206e    old_chunks = n
-0001e1f0: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 7328  ormalize_chunks(
-0001e200: 7a2e 6368 756e 6b73 2c20 7a2e 7368 6170  z.chunks, z.shap
-0001e210: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-0001e220: 6e64 6578 203d 206e 6f72 6d61 6c69 7a65  ndex = normalize
-0001e230: 5f69 6e64 6578 2872 6567 696f 6e2c 207a  _index(region, z
-0001e240: 2e73 6861 7065 290a 2020 2020 2020 2020  .shape).        
-0001e250: 2020 2020 6368 756e 6b73 203d 2074 7570      chunks = tup
-0001e260: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0001e270: 2020 2020 7475 706c 6528 6e65 775f 626c      tuple(new_bl
-0001e280: 6f63 6b64 696d 2873 2c20 632c 2072 2929  ockdim(s, c, r))
-0001e290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e2a0: 2066 6f72 2073 2c20 632c 2072 2069 6e20   for s, c, r in 
-0001e2b0: 7a69 7028 7a2e 7368 6170 652c 206f 6c64  zip(z.shape, old
-0001e2c0: 5f63 6875 6e6b 732c 2069 6e64 6578 290a  _chunks, index).
-0001e2d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001e2e0: 2020 2020 2020 2020 2020 6172 7220 3d20            arr = 
-0001e2f0: 6172 722e 7265 6368 756e 6b28 6368 756e  arr.rechunk(chun
-0001e300: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
-0001e310: 7265 6769 6f6e 7320 3d20 5b72 6567 696f  regions = [regio
-0001e320: 6e5d 0a20 2020 2020 2020 2072 6574 7572  n].        retur
-0001e330: 6e20 6172 722e 7374 6f72 6528 0a20 2020  n arr.store(.   
-0001e340: 2020 2020 2020 2020 207a 2c20 6c6f 636b           z, lock
-0001e350: 3d46 616c 7365 2c20 7265 6769 6f6e 733d  =False, regions=
-0001e360: 7265 6769 6f6e 732c 2063 6f6d 7075 7465  regions, compute
-0001e370: 3d63 6f6d 7075 7465 2c20 7265 7475 726e  =compute, return
-0001e380: 5f73 746f 7265 643d 7265 7475 726e 5f73  _stored=return_s
-0001e390: 746f 7265 640a 2020 2020 2020 2020 290a  tored.        ).
-0001e3a0: 0a20 2020 2069 6620 7265 6769 6f6e 2069  .    if region i
-0001e3b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001e3c0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001e3d0: 7272 6f72 2822 4361 6e6e 6f74 2075 7365  rror("Cannot use
-0001e3e0: 2060 7265 6769 6f6e 6020 6b65 7977 6f72   `region` keywor
-0001e3f0: 6420 7768 656e 2075 726c 2069 7320 6e6f  d when url is no
-0001e400: 7420 6120 607a 6172 722e 4172 7261 7960  t a `zarr.Array`
-0001e410: 2e22 290a 0a20 2020 2069 6620 6e6f 7420  .")..    if not 
-0001e420: 5f63 6865 636b 5f72 6567 756c 6172 5f63  _check_regular_c
-0001e430: 6875 6e6b 7328 6172 722e 6368 756e 6b73  hunks(arr.chunks
-0001e440: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
-0001e450: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0001e460: 2020 2020 2020 2020 2022 4174 7465 6d70           "Attemp
-0001e470: 7420 746f 2073 6176 6520 6172 7261 7920  t to save array 
-0001e480: 746f 207a 6172 7220 7769 7468 2069 7272  to zarr with irr
-0001e490: 6567 756c 6172 2022 0a20 2020 2020 2020  egular ".       
-0001e4a0: 2020 2020 2022 6368 756e 6b69 6e67 2c20       "chunking, 
-0001e4b0: 706c 6561 7365 2063 616c 6c20 6061 7272  please call `arr
-0001e4c0: 2e72 6563 6875 6e6b 282e 2e2e 2960 2066  .rechunk(...)` f
-0001e4d0: 6972 7374 2e22 0a20 2020 2020 2020 2029  irst.".        )
-0001e4e0: 0a0a 2020 2020 7374 6f72 6167 655f 6f70  ..    storage_op
-0001e4f0: 7469 6f6e 7320 3d20 7374 6f72 6167 655f  tions = storage_
-0001e500: 6f70 7469 6f6e 7320 6f72 207b 7d0a 0a20  options or {}.. 
-0001e510: 2020 2069 6620 7374 6f72 6167 655f 6f70     if storage_op
-0001e520: 7469 6f6e 733a 0a20 2020 2020 2020 2073  tions:.        s
-0001e530: 746f 7265 203d 207a 6172 722e 7374 6f72  tore = zarr.stor
-0001e540: 6167 652e 4653 5374 6f72 6528 7572 6c2c  age.FSStore(url,
-0001e550: 202a 2a73 746f 7261 6765 5f6f 7074 696f   **storage_optio
-0001e560: 6e73 290a 2020 2020 656c 7365 3a0a 2020  ns).    else:.  
-0001e570: 2020 2020 2020 7374 6f72 6520 3d20 7572        store = ur
-0001e580: 6c0a 0a20 2020 2063 6875 6e6b 7320 3d20  l..    chunks = 
-0001e590: 5b63 5b30 5d20 666f 7220 6320 696e 2061  [c[0] for c in a
-0001e5a0: 7272 2e63 6875 6e6b 735d 0a0a 2020 2020  rr.chunks]..    
-0001e5b0: 7a20 3d20 7a61 7272 2e63 7265 6174 6528  z = zarr.create(
-0001e5c0: 0a20 2020 2020 2020 2073 6861 7065 3d61  .        shape=a
-0001e5d0: 7272 2e73 6861 7065 2c0a 2020 2020 2020  rr.shape,.      
-0001e5e0: 2020 6368 756e 6b73 3d63 6875 6e6b 732c    chunks=chunks,
-0001e5f0: 0a20 2020 2020 2020 2064 7479 7065 3d61  .        dtype=a
-0001e600: 7272 2e64 7479 7065 2c0a 2020 2020 2020  rr.dtype,.      
-0001e610: 2020 7374 6f72 653d 7374 6f72 652c 0a20    store=store,. 
-0001e620: 2020 2020 2020 2070 6174 683d 636f 6d70         path=comp
-0001e630: 6f6e 656e 742c 0a20 2020 2020 2020 206f  onent,.        o
-0001e640: 7665 7277 7269 7465 3d6f 7665 7277 7269  verwrite=overwri
-0001e650: 7465 2c0a 2020 2020 2020 2020 2a2a 6b77  te,.        **kw
-0001e660: 6172 6773 2c0a 2020 2020 290a 2020 2020  args,.    ).    
-0001e670: 7265 7475 726e 2061 7272 2e73 746f 7265  return arr.store
-0001e680: 287a 2c20 6c6f 636b 3d46 616c 7365 2c20  (z, lock=False, 
-0001e690: 636f 6d70 7574 653d 636f 6d70 7574 652c  compute=compute,
-0001e6a0: 2072 6574 7572 6e5f 7374 6f72 6564 3d72   return_stored=r
-0001e6b0: 6574 7572 6e5f 7374 6f72 6564 290a 0a0a  eturn_stored)...
-0001e6c0: 6465 6620 5f63 6865 636b 5f72 6567 756c  def _check_regul
-0001e6d0: 6172 5f63 6875 6e6b 7328 6368 756e 6b73  ar_chunks(chunks
-0001e6e0: 6574 293a 0a20 2020 2022 2222 4368 6563  et):.    """Chec
-0001e6f0: 6b20 6966 2074 6865 2063 6875 6e6b 7320  k if the chunks 
-0001e700: 6172 6520 7265 6775 6c61 720a 0a20 2020  are regular..   
-0001e710: 2022 5265 6775 6c61 7222 2069 6e20 7468   "Regular" in th
-0001e720: 6973 2063 6f6e 7465 7874 206d 6561 6e73  is context means
-0001e730: 2074 6861 7420 616c 6f6e 6720 6576 6572   that along ever
-0001e740: 7920 6178 6973 2c20 7468 6520 6368 756e  y axis, the chun
-0001e750: 6b73 2061 6c6c 0a20 2020 2068 6176 6520  ks all.    have 
-0001e760: 7468 6520 7361 6d65 2073 697a 652c 2065  the same size, e
-0001e770: 7863 6570 7420 7468 6520 6c61 7374 206f  xcept the last o
-0001e780: 6e65 2c20 7768 6963 6820 6d61 7920 6265  ne, which may be
-0001e790: 2073 6d61 6c6c 6572 0a0a 2020 2020 5061   smaller..    Pa
-0001e7a0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-0001e7b0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6368 756e  -------.    chun
-0001e7c0: 6b73 6574 3a20 7475 706c 6520 6f66 2074  kset: tuple of t
-0001e7d0: 7570 6c65 7320 6f66 2069 6e74 730a 2020  uples of ints.  
-0001e7e0: 2020 2020 2020 4672 6f6d 2074 6865 2060        From the `
-0001e7f0: 602e 6368 756e 6b73 6060 2061 7474 7269  `.chunks`` attri
-0001e800: 6275 7465 206f 6620 616e 2060 6041 7272  bute of an ``Arr
-0001e810: 6179 6060 0a0a 2020 2020 5265 7475 726e  ay``..    Return
-0001e820: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0001e830: 2020 5472 7565 2069 6620 6368 756e 6b73    True if chunks
-0001e840: 6574 2070 6173 7365 732c 2065 6c73 6520  et passes, else 
-0001e850: 4661 6c73 650a 0a20 2020 2045 7861 6d70  False..    Examp
-0001e860: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0001e870: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-0001e880: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
-0001e890: 0a20 2020 203e 3e3e 2061 7272 203d 2064  .    >>> arr = d
-0001e8a0: 612e 7a65 726f 7328 3130 2c20 6368 756e  a.zeros(10, chun
-0001e8b0: 6b73 3d28 352c 2029 290a 2020 2020 3e3e  ks=(5, )).    >>
-0001e8c0: 3e20 5f63 6865 636b 5f72 6567 756c 6172  > _check_regular
-0001e8d0: 5f63 6875 6e6b 7328 6172 722e 6368 756e  _chunks(arr.chun
-0001e8e0: 6b73 290a 2020 2020 5472 7565 0a0a 2020  ks).    True..  
-0001e8f0: 2020 3e3e 3e20 6172 7220 3d20 6461 2e7a    >>> arr = da.z
-0001e900: 6572 6f73 2831 302c 2063 6875 6e6b 733d  eros(10, chunks=
-0001e910: 2828 332c 2033 2c20 332c 2031 292c 2029  ((3, 3, 3, 1), )
-0001e920: 290a 2020 2020 3e3e 3e20 5f63 6865 636b  ).    >>> _check
-0001e930: 5f72 6567 756c 6172 5f63 6875 6e6b 7328  _regular_chunks(
-0001e940: 6172 722e 6368 756e 6b73 290a 2020 2020  arr.chunks).    
-0001e950: 5472 7565 0a0a 2020 2020 3e3e 3e20 6172  True..    >>> ar
-0001e960: 7220 3d20 6461 2e7a 6572 6f73 2831 302c  r = da.zeros(10,
-0001e970: 2063 6875 6e6b 733d 2828 332c 2031 2c20   chunks=((3, 1, 
-0001e980: 332c 2033 292c 2029 290a 2020 2020 3e3e  3, 3), )).    >>
-0001e990: 3e20 5f63 6865 636b 5f72 6567 756c 6172  > _check_regular
-0001e9a0: 5f63 6875 6e6b 7328 6172 722e 6368 756e  _chunks(arr.chun
-0001e9b0: 6b73 290a 2020 2020 4661 6c73 650a 2020  ks).    False.  
-0001e9c0: 2020 2222 220a 2020 2020 666f 7220 6368    """.    for ch
-0001e9d0: 756e 6b73 2069 6e20 6368 756e 6b73 6574  unks in chunkset
-0001e9e0: 3a0a 2020 2020 2020 2020 6966 206c 656e  :.        if len
-0001e9f0: 2863 6875 6e6b 7329 203d 3d20 313a 0a20  (chunks) == 1:. 
-0001ea00: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001ea10: 6e75 650a 2020 2020 2020 2020 6966 206c  nue.        if l
-0001ea20: 656e 2873 6574 2863 6875 6e6b 735b 3a2d  en(set(chunks[:-
-0001ea30: 315d 2929 203e 2031 3a0a 2020 2020 2020  1])) > 1:.      
-0001ea40: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001ea50: 7365 0a20 2020 2020 2020 2069 6620 6368  se.        if ch
-0001ea60: 756e 6b73 5b2d 315d 203e 2063 6875 6e6b  unks[-1] > chunk
-0001ea70: 735b 305d 3a0a 2020 2020 2020 2020 2020  s[0]:.          
-0001ea80: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-0001ea90: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
-0001eaa0: 0a64 6566 2066 726f 6d5f 6465 6c61 7965  .def from_delaye
-0001eab0: 6428 7661 6c75 652c 2073 6861 7065 2c20  d(value, shape, 
-0001eac0: 6474 7970 653d 4e6f 6e65 2c20 6d65 7461  dtype=None, meta
-0001ead0: 3d4e 6f6e 652c 206e 616d 653d 4e6f 6e65  =None, name=None
-0001eae0: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
-0001eaf0: 2061 2064 6173 6b20 6172 7261 7920 6672   a dask array fr
-0001eb00: 6f6d 2061 2064 6173 6b20 6465 6c61 7965  om a dask delaye
-0001eb10: 6420 7661 6c75 650a 0a20 2020 2054 6869  d value..    Thi
-0001eb20: 7320 726f 7574 696e 6520 6973 2075 7365  s routine is use
-0001eb30: 6675 6c20 666f 7220 636f 6e73 7472 7563  ful for construc
-0001eb40: 7469 6e67 2064 6173 6b20 6172 7261 7973  ting dask arrays
-0001eb50: 2069 6e20 616e 2061 642d 686f 6320 6661   in an ad-hoc fa
-0001eb60: 7368 696f 6e0a 2020 2020 7573 696e 6720  shion.    using 
-0001eb70: 6461 736b 2064 656c 6179 6564 2c20 7061  dask delayed, pa
-0001eb80: 7274 6963 756c 6172 6c79 2077 6865 6e20  rticularly when 
-0001eb90: 636f 6d62 696e 6564 2077 6974 6820 7374  combined with st
-0001eba0: 6163 6b20 616e 6420 636f 6e63 6174 656e  ack and concaten
-0001ebb0: 6174 652e 0a0a 2020 2020 5468 6520 6461  ate...    The da
-0001ebc0: 736b 2061 7272 6179 2077 696c 6c20 636f  sk array will co
-0001ebd0: 6e73 6973 7420 6f66 2061 2073 696e 676c  nsist of a singl
-0001ebe0: 6520 6368 756e 6b2e 0a0a 2020 2020 4578  e chunk...    Ex
-0001ebf0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-0001ec00: 2d2d 2d0a 2020 2020 3e3e 3e20 696d 706f  ---.    >>> impo
-0001ec10: 7274 2064 6173 6b0a 2020 2020 3e3e 3e20  rt dask.    >>> 
-0001ec20: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-0001ec30: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
-0001ec40: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-0001ec50: 6e70 0a20 2020 203e 3e3e 2076 616c 7565  np.    >>> value
-0001ec60: 203d 2064 6173 6b2e 6465 6c61 7965 6428   = dask.delayed(
-0001ec70: 6e70 2e6f 6e65 7329 2835 290a 2020 2020  np.ones)(5).    
-0001ec80: 3e3e 3e20 6172 7261 7920 3d20 6461 2e66  >>> array = da.f
-0001ec90: 726f 6d5f 6465 6c61 7965 6428 7661 6c75  rom_delayed(valu
-0001eca0: 652c 2028 352c 292c 2064 7479 7065 3d66  e, (5,), dtype=f
-0001ecb0: 6c6f 6174 290a 2020 2020 3e3e 3e20 6172  loat).    >>> ar
-0001ecc0: 7261 790a 2020 2020 6461 736b 2e61 7272  ray.    dask.arr
-0001ecd0: 6179 3c66 726f 6d2d 7661 6c75 652c 2073  ay<from-value, s
-0001ece0: 6861 7065 3d28 352c 292c 2064 7479 7065  hape=(5,), dtype
-0001ecf0: 3d66 6c6f 6174 3634 2c20 6368 756e 6b73  =float64, chunks
-0001ed00: 697a 653d 2835 2c29 2c20 6368 756e 6b74  ize=(5,), chunkt
-0001ed10: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
-0001ed20: 793e 0a20 2020 203e 3e3e 2061 7272 6179  y>.    >>> array
-0001ed30: 2e63 6f6d 7075 7465 2829 0a20 2020 2061  .compute().    a
-0001ed40: 7272 6179 285b 312e 2c20 312e 2c20 312e  rray([1., 1., 1.
-0001ed50: 2c20 312e 2c20 312e 5d29 0a20 2020 2022  , 1., 1.]).    "
-0001ed60: 2222 0a20 2020 2066 726f 6d20 6461 736b  "".    from dask
-0001ed70: 2e64 656c 6179 6564 2069 6d70 6f72 7420  .delayed import 
-0001ed80: 4465 6c61 7965 642c 2064 656c 6179 6564  Delayed, delayed
-0001ed90: 0a0a 2020 2020 6966 206e 6f74 2069 7369  ..    if not isi
-0001eda0: 6e73 7461 6e63 6528 7661 6c75 652c 2044  nstance(value, D
-0001edb0: 656c 6179 6564 2920 616e 6420 6861 7361  elayed) and hasa
-0001edc0: 7474 7228 7661 6c75 652c 2022 6b65 7922  ttr(value, "key"
-0001edd0: 293a 0a20 2020 2020 2020 2076 616c 7565  ):.        value
-0001ede0: 203d 2064 656c 6179 6564 2876 616c 7565   = delayed(value
-0001edf0: 290a 0a20 2020 206e 616d 6520 3d20 6e61  )..    name = na
-0001ee00: 6d65 206f 7220 2266 726f 6d2d 7661 6c75  me or "from-valu
-0001ee10: 652d 2220 2b20 746f 6b65 6e69 7a65 2876  e-" + tokenize(v
-0001ee20: 616c 7565 2c20 7368 6170 652c 2064 7479  alue, shape, dty
-0001ee30: 7065 2c20 6d65 7461 290a 2020 2020 6473  pe, meta).    ds
-0001ee40: 6b20 3d20 7b28 6e61 6d65 2c29 202b 2028  k = {(name,) + (
-0001ee50: 302c 2920 2a20 6c65 6e28 7368 6170 6529  0,) * len(shape)
-0001ee60: 3a20 7661 6c75 652e 6b65 797d 0a20 2020  : value.key}.   
-0001ee70: 2063 6875 6e6b 7320 3d20 7475 706c 6528   chunks = tuple(
-0001ee80: 2864 2c29 2066 6f72 2064 2069 6e20 7368  (d,) for d in sh
-0001ee90: 6170 6529 0a20 2020 2023 2054 4f44 4f3a  ape).    # TODO:
-0001eea0: 2076 616c 7565 2e5f 6b65 7920 6d61 7920   value._key may 
-0001eeb0: 6e6f 7420 6265 2074 6865 206e 616d 6520  not be the name 
-0001eec0: 6f66 2074 6865 206c 6179 6572 2069 6e20  of the layer in 
-0001eed0: 7661 6c75 652e 6461 736b 0a20 2020 2023  value.dask.    #
-0001eee0: 2054 6869 7320 7368 6f75 6c64 2062 6520   This should be 
-0001eef0: 6669 7865 6420 6166 7465 7220 7765 2062  fixed after we b
-0001ef00: 7569 6c64 2066 756c 6c20 6578 7072 6573  uild full expres
-0001ef10: 7369 6f6e 2067 7261 7068 730a 2020 2020  sion graphs.    
-0001ef20: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
-0001ef30: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
-0001ef40: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
-0001ef50: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
-0001ef60: 5b76 616c 7565 5d29 0a20 2020 2072 6574  [value]).    ret
-0001ef70: 7572 6e20 4172 7261 7928 6772 6170 682c  urn Array(graph,
-0001ef80: 206e 616d 652c 2063 6875 6e6b 732c 2064   name, chunks, d
-0001ef90: 7479 7065 3d64 7479 7065 2c20 6d65 7461  type=dtype, meta
-0001efa0: 3d6d 6574 6129 0a0a 0a64 6566 2066 726f  =meta)...def fro
-0001efb0: 6d5f 6675 6e63 2866 756e 632c 2073 6861  m_func(func, sha
-0001efc0: 7065 2c20 6474 7970 653d 4e6f 6e65 2c20  pe, dtype=None, 
-0001efd0: 6e61 6d65 3d4e 6f6e 652c 2061 7267 733d  name=None, args=
-0001efe0: 2829 2c20 6b77 6172 6773 3d4e 6f6e 6529  (), kwargs=None)
-0001eff0: 3a0a 2020 2020 2222 2243 7265 6174 6520  :.    """Create 
-0001f000: 6461 736b 2061 7272 6179 2069 6e20 6120  dask array in a 
-0001f010: 7369 6e67 6c65 2062 6c6f 636b 2062 7920  single block by 
-0001f020: 6361 6c6c 696e 6720 6120 6675 6e63 7469  calling a functi
-0001f030: 6f6e 0a0a 2020 2020 4361 6c6c 696e 6720  on..    Calling 
-0001f040: 7468 6520 7072 6f76 6964 6564 2066 756e  the provided fun
-0001f050: 6374 696f 6e20 7769 7468 2066 756e 6328  ction with func(
-0001f060: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0001f070: 2073 686f 756c 6420 7265 7475 726e 2061   should return a
-0001f080: 0a20 2020 204e 756d 5079 2061 7272 6179  .    NumPy array
-0001f090: 206f 6620 7468 6520 696e 6469 6361 7465   of the indicate
-0001f0a0: 6420 7368 6170 6520 616e 6420 6474 7970  d shape and dtyp
-0001f0b0: 652e 0a0a 2020 2020 4578 616d 706c 6573  e...    Examples
-0001f0c0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20  .    --------.. 
-0001f0d0: 2020 203e 3e3e 2061 203d 2066 726f 6d5f     >>> a = from_
-0001f0e0: 6675 6e63 286e 702e 6172 616e 6765 2c20  func(np.arange, 
-0001f0f0: 2833 2c29 2c20 6474 7970 653d 2769 3827  (3,), dtype='i8'
-0001f100: 2c20 6172 6773 3d28 332c 2929 0a20 2020  , args=(3,)).   
-0001f110: 203e 3e3e 2061 2e63 6f6d 7075 7465 2829   >>> a.compute()
-0001f120: 0a20 2020 2061 7272 6179 285b 302c 2031  .    array([0, 1
-0001f130: 2c20 325d 290a 0a20 2020 2054 6869 7320  , 2])..    This 
-0001f140: 776f 726b 7320 7061 7274 6963 756c 6172  works particular
-0001f150: 6c79 2077 656c 6c20 7768 656e 2063 6f75  ly well when cou
-0001f160: 706c 6564 2077 6974 6820 6461 736b 2e61  pled with dask.a
-0001f170: 7272 6179 2066 756e 6374 696f 6e73 206c  rray functions l
-0001f180: 696b 650a 2020 2020 636f 6e63 6174 656e  ike.    concaten
-0001f190: 6174 6520 616e 6420 7374 6163 6b3a 0a0a  ate and stack:..
-0001f1a0: 2020 2020 3e3e 3e20 6172 7261 7973 203d      >>> arrays =
-0001f1b0: 205b 6672 6f6d 5f66 756e 6328 6e70 2e61   [from_func(np.a
-0001f1c0: 7272 6179 2c20 2829 2c20 6474 7970 653d  rray, (), dtype=
-0001f1d0: 2769 3827 2c20 6172 6773 3d28 6e2c 2929  'i8', args=(n,))
-0001f1e0: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
-0001f1f0: 3529 5d0a 2020 2020 3e3e 3e20 7374 6163  5)].    >>> stac
-0001f200: 6b28 6172 7261 7973 292e 636f 6d70 7574  k(arrays).comput
-0001f210: 6528 290a 2020 2020 6172 7261 7928 5b30  e().    array([0
-0001f220: 2c20 312c 2032 2c20 332c 2034 5d29 0a20  , 1, 2, 3, 4]). 
-0001f230: 2020 2022 2222 0a20 2020 2069 6620 6b77     """.    if kw
-0001f240: 6172 6773 2069 7320 4e6f 6e65 3a0a 2020  args is None:.  
-0001f250: 2020 2020 2020 6b77 6172 6773 203d 207b        kwargs = {
-0001f260: 7d0a 0a20 2020 206e 616d 6520 3d20 6e61  }..    name = na
-0001f270: 6d65 206f 7220 2266 726f 6d5f 6675 6e63  me or "from_func
-0001f280: 2d22 202b 2074 6f6b 656e 697a 6528 6675  -" + tokenize(fu
-0001f290: 6e63 2c20 7368 6170 652c 2064 7479 7065  nc, shape, dtype
-0001f2a0: 2c20 6172 6773 2c20 6b77 6172 6773 290a  , args, kwargs).
-0001f2b0: 2020 2020 6966 2061 7267 7320 6f72 206b      if args or k
-0001f2c0: 7761 7267 733a 0a20 2020 2020 2020 2066  wargs:.        f
-0001f2d0: 756e 6320 3d20 7061 7274 6961 6c28 6675  unc = partial(fu
-0001f2e0: 6e63 2c20 2a61 7267 732c 202a 2a6b 7761  nc, *args, **kwa
-0001f2f0: 7267 7329 0a20 2020 2064 736b 203d 207b  rgs).    dsk = {
-0001f300: 286e 616d 652c 2920 2b20 2830 2c29 202a  (name,) + (0,) *
-0001f310: 206c 656e 2873 6861 7065 293a 2028 6675   len(shape): (fu
-0001f320: 6e63 2c29 7d0a 2020 2020 6368 756e 6b73  nc,)}.    chunks
-0001f330: 203d 2074 7570 6c65 2828 692c 2920 666f   = tuple((i,) fo
-0001f340: 7220 6920 696e 2073 6861 7065 290a 2020  r i in shape).  
-0001f350: 2020 7265 7475 726e 2041 7272 6179 2864    return Array(d
-0001f360: 736b 2c20 6e61 6d65 2c20 6368 756e 6b73  sk, name, chunks
-0001f370: 2c20 6474 7970 6529 0a0a 0a64 6566 2063  , dtype)...def c
-0001f380: 6f6d 6d6f 6e5f 626c 6f63 6b64 696d 2862  ommon_blockdim(b
-0001f390: 6c6f 636b 6469 6d73 293a 0a20 2020 2022  lockdims):.    "
-0001f3a0: 2222 4669 6e64 2074 6865 2063 6f6d 6d6f  ""Find the commo
-0001f3b0: 6e20 626c 6f63 6b20 6469 6d65 6e73 696f  n block dimensio
-0001f3c0: 6e73 2066 726f 6d20 7468 6520 6c69 7374  ns from the list
-0001f3d0: 206f 6620 626c 6f63 6b20 6469 6d65 6e73   of block dimens
-0001f3e0: 696f 6e73 0a0a 2020 2020 4375 7272 656e  ions..    Curren
-0001f3f0: 746c 7920 6f6e 6c79 2069 6d70 6c65 6d65  tly only impleme
-0001f400: 6e74 7320 7468 6520 7369 6d70 6c65 7374  nts the simplest
-0001f410: 2070 6f73 7369 626c 6520 6865 7572 6973   possible heuris
-0001f420: 7469 633a 2074 6865 2063 6f6d 6d6f 6e0a  tic: the common.
-0001f430: 2020 2020 626c 6f63 6b2d 6469 6d65 6e73      block-dimens
-0001f440: 696f 6e20 6973 2074 6865 206f 6e6c 7920  ion is the only 
-0001f450: 6f6e 6520 7468 6174 2064 6f65 7320 6e6f  one that does no
-0001f460: 7420 7370 616e 2066 756c 6c79 2073 7061  t span fully spa
-0001f470: 6e20 6120 6469 6d65 6e73 696f 6e2e 0a20  n a dimension.. 
-0001f480: 2020 2054 6869 7320 6973 2061 2063 6f6e     This is a con
-0001f490: 7365 7276 6174 6976 6520 6368 6f69 6365  servative choice
-0001f4a0: 2074 6861 7420 616c 6c6f 7773 2075 7320   that allows us 
-0001f4b0: 746f 2061 766f 6964 2070 6f74 656e 7469  to avoid potenti
-0001f4c0: 616c 6c79 2076 6572 790a 2020 2020 6578  ally very.    ex
-0001f4d0: 7065 6e73 6976 6520 7265 6368 756e 6b69  pensive rechunki
-0001f4e0: 6e67 2e0a 0a20 2020 2041 7373 756d 6573  ng...    Assumes
-0001f4f0: 2074 6861 7420 6561 6368 2065 6c65 6d65   that each eleme
-0001f500: 6e74 206f 6620 7468 6520 696e 7075 7420  nt of the input 
-0001f510: 626c 6f63 6b20 6469 6d65 6e73 696f 6e73  block dimensions
-0001f520: 2068 6173 2061 6c6c 2074 6865 2073 616d   has all the sam
-0001f530: 650a 2020 2020 7375 6d20 2869 2e65 2e2c  e.    sum (i.e.,
-0001f540: 2074 6861 7420 7468 6579 2063 6f72 7265   that they corre
-0001f550: 7370 6f6e 6420 746f 2064 696d 656e 7369  spond to dimensi
-0001f560: 6f6e 7320 6f66 2074 6865 2073 616d 6520  ons of the same 
-0001f570: 7369 7a65 292e 0a0a 2020 2020 4578 616d  size)...    Exam
-0001f580: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-0001f590: 2d0a 2020 2020 3e3e 3e20 636f 6d6d 6f6e  -.    >>> common
-0001f5a0: 5f62 6c6f 636b 6469 6d28 5b28 332c 292c  _blockdim([(3,),
-0001f5b0: 2028 322c 2031 295d 290a 2020 2020 2832   (2, 1)]).    (2
-0001f5c0: 2c20 3129 0a20 2020 203e 3e3e 2063 6f6d  , 1).    >>> com
-0001f5d0: 6d6f 6e5f 626c 6f63 6b64 696d 285b 2831  mon_blockdim([(1
-0001f5e0: 2c20 3229 2c20 2832 2c20 3129 5d29 0a20  , 2), (2, 1)]). 
-0001f5f0: 2020 2028 312c 2031 2c20 3129 0a20 2020     (1, 1, 1).   
-0001f600: 203e 3e3e 2063 6f6d 6d6f 6e5f 626c 6f63   >>> common_bloc
-0001f610: 6b64 696d 285b 2832 2c20 3229 2c20 2833  kdim([(2, 2), (3
-0001f620: 2c20 3129 5d29 2020 2320 646f 6374 6573  , 1)])  # doctes
-0001f630: 743a 202b 534b 4950 0a20 2020 2054 7261  t: +SKIP.    Tra
-0001f640: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
-0001f650: 656e 7420 6361 6c6c 206c 6173 7429 3a0a  ent call last):.
-0001f660: 2020 2020 2020 2020 2e2e 2e0a 2020 2020          ....    
-0001f670: 5661 6c75 6545 7272 6f72 3a20 4368 756e  ValueError: Chun
-0001f680: 6b73 2064 6f20 6e6f 7420 616c 6967 6e0a  ks do not align.
-0001f690: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
-0001f6a0: 6f74 2061 6e79 2862 6c6f 636b 6469 6d73  ot any(blockdims
-0001f6b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001f6c0: 6e20 2829 0a20 2020 206e 6f6e 5f74 7269  n ().    non_tri
-0001f6d0: 7669 616c 5f64 696d 7320 3d20 7b64 2066  vial_dims = {d f
-0001f6e0: 6f72 2064 2069 6e20 626c 6f63 6b64 696d  or d in blockdim
-0001f6f0: 7320 6966 206c 656e 2864 2920 3e20 317d  s if len(d) > 1}
-0001f700: 0a20 2020 2069 6620 6c65 6e28 6e6f 6e5f  .    if len(non_
-0001f710: 7472 6976 6961 6c5f 6469 6d73 2920 3d3d  trivial_dims) ==
-0001f720: 2031 3a0a 2020 2020 2020 2020 7265 7475   1:.        retu
-0001f730: 726e 2066 6972 7374 286e 6f6e 5f74 7269  rn first(non_tri
-0001f740: 7669 616c 5f64 696d 7329 0a20 2020 2069  vial_dims).    i
-0001f750: 6620 6c65 6e28 6e6f 6e5f 7472 6976 6961  f len(non_trivia
-0001f760: 6c5f 6469 6d73 2920 3d3d 2030 3a0a 2020  l_dims) == 0:.  
-0001f770: 2020 2020 2020 7265 7475 726e 206d 6178        return max
-0001f780: 2862 6c6f 636b 6469 6d73 2c20 6b65 793d  (blockdims, key=
-0001f790: 6669 7273 7429 0a0a 2020 2020 6966 206e  first)..    if n
-0001f7a0: 702e 6973 6e61 6e28 7375 6d28 6d61 7028  p.isnan(sum(map(
-0001f7b0: 7375 6d2c 2062 6c6f 636b 6469 6d73 2929  sum, blockdims))
-0001f7c0: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
-0001f7d0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-0001f7e0: 2020 2020 2020 2020 2022 4172 7261 7973           "Arrays
-0001f7f0: 2720 6368 756e 6b20 7369 7a65 7320 2825  ' chunk sizes (%
-0001f800: 7329 2061 7265 2075 6e6b 6e6f 776e 2e5c  s) are unknown.\
-0001f810: 6e5c 6e22 0a20 2020 2020 2020 2020 2020  n\n".           
-0001f820: 2022 4120 706f 7373 6962 6c65 2073 6f6c   "A possible sol
-0001f830: 7574 696f 6e3a 5c6e 220a 2020 2020 2020  ution:\n".      
-0001f840: 2020 2020 2020 2220 2078 2e63 6f6d 7075        "  x.compu
-0001f850: 7465 5f63 6875 6e6b 5f73 697a 6573 2829  te_chunk_sizes()
-0001f860: 2220 2520 626c 6f63 6b64 696d 730a 2020  " % blockdims.  
-0001f870: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
-0001f880: 6c65 6e28 7365 7428 6d61 7028 7375 6d2c  len(set(map(sum,
-0001f890: 206e 6f6e 5f74 7269 7669 616c 5f64 696d   non_trivial_dim
-0001f8a0: 7329 2929 203e 2031 3a0a 2020 2020 2020  s))) > 1:.      
-0001f8b0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001f8c0: 6f72 2822 4368 756e 6b73 2064 6f20 6e6f  or("Chunks do no
-0001f8d0: 7420 6164 6420 7570 2074 6f20 7361 6d65  t add up to same
-0001f8e0: 2076 616c 7565 222c 2062 6c6f 636b 6469   value", blockdi
-0001f8f0: 6d73 290a 0a20 2020 2023 2057 6520 6861  ms)..    # We ha
-0001f900: 7665 206d 756c 7469 706c 6520 6e6f 6e2d  ve multiple non-
-0001f910: 7472 6976 6961 6c20 6368 756e 6b73 206f  trivial chunks o
-0001f920: 6e20 7468 6973 2061 7869 730a 2020 2020  n this axis.    
-0001f930: 2320 652e 672e 2028 352c 2032 2920 616e  # e.g. (5, 2) an
-0001f940: 6420 2834 2c20 3329 0a0a 2020 2020 2320  d (4, 3)..    # 
-0001f950: 5765 2063 7265 6174 6520 6120 7369 6e67  We create a sing
-0001f960: 6c65 2063 6875 6e6b 2074 7570 6c65 2077  le chunk tuple w
-0001f970: 6974 6820 7468 6520 7361 6d65 2074 6f74  ith the same tot
-0001f980: 616c 206c 656e 6774 680a 2020 2020 2320  al length.    # 
-0001f990: 7468 6174 2065 7665 6e6c 7920 6469 7669  that evenly divi
-0001f9a0: 6465 7320 626f 7468 2c20 652e 672e 2028  des both, e.g. (
-0001f9b0: 342c 2031 2c20 3229 0a0a 2020 2020 2320  4, 1, 2)..    # 
-0001f9c0: 546f 2061 6363 6f6d 706c 6973 6820 7468  To accomplish th
-0001f9d0: 6973 2077 6520 7761 6c6b 2064 6f77 6e20  is we walk down 
-0001f9e0: 616c 6c20 6368 756e 6b20 7475 706c 6573  all chunk tuples
-0001f9f0: 2074 6f67 6574 6865 722c 2066 696e 6469   together, findi
-0001fa00: 6e67 2074 6865 0a20 2020 2023 2073 6d61  ng the.    # sma
-0001fa10: 6c6c 6573 7420 656c 656d 656e 742c 2061  llest element, a
-0001fa20: 6464 696e 6720 6974 2074 6f20 7468 6520  dding it to the 
-0001fa30: 6f75 7470 7574 2c20 616e 6420 7375 6274  output, and subt
-0001fa40: 7261 6374 696e 6720 6974 2066 726f 6d20  racting it from 
-0001fa50: 616c 6c0a 2020 2020 2320 6f74 6865 7220  all.    # other 
-0001fa60: 656c 656d 656e 7473 2061 6e64 2072 656d  elements and rem
-0001fa70: 6f76 6520 7468 6520 656c 656d 656e 7420  ove the element 
-0001fa80: 6974 7365 6c66 2e20 2057 6520 7374 6f70  itself.  We stop
-0001fa90: 206f 6e63 6520 7765 2068 6176 650a 2020   once we have.  
-0001faa0: 2020 2320 6275 726e 6564 2074 6872 6f75    # burned throu
-0001fab0: 6768 2061 6c6c 206f 6620 7468 6520 6368  gh all of the ch
-0001fac0: 756e 6b20 7475 706c 6573 2e0a 2020 2020  unk tuples..    
-0001fad0: 2320 466f 7220 6566 6669 6369 656e 6379  # For efficiency
-0001fae0: 2773 2073 616b 6520 7765 2072 6576 6572  's sake we rever
-0001faf0: 7365 2074 6865 206c 6973 7473 2073 6f20  se the lists so 
-0001fb00: 7468 6174 2077 6520 6361 6e20 706f 7020  that we can pop 
-0001fb10: 6f66 6620 7468 6520 656e 640a 2020 2020  off the end.    
-0001fb20: 7263 6875 6e6b 7320 3d20 5b6c 6973 7428  rchunks = [list(
-0001fb30: 6e74 6429 5b3a 3a2d 315d 2066 6f72 206e  ntd)[::-1] for n
-0001fb40: 7464 2069 6e20 6e6f 6e5f 7472 6976 6961  td in non_trivia
-0001fb50: 6c5f 6469 6d73 5d0a 2020 2020 746f 7461  l_dims].    tota
-0001fb60: 6c20 3d20 7375 6d28 6669 7273 7428 6e6f  l = sum(first(no
-0001fb70: 6e5f 7472 6976 6961 6c5f 6469 6d73 2929  n_trivial_dims))
-0001fb80: 0a20 2020 2069 203d 2030 0a0a 2020 2020  .    i = 0..    
-0001fb90: 6f75 7420 3d20 5b5d 0a20 2020 2077 6869  out = [].    whi
-0001fba0: 6c65 2069 203c 2074 6f74 616c 3a0a 2020  le i < total:.  
-0001fbb0: 2020 2020 2020 6d20 3d20 6d69 6e28 635b        m = min(c[
-0001fbc0: 2d31 5d20 666f 7220 6320 696e 2072 6368  -1] for c in rch
-0001fbd0: 756e 6b73 290a 2020 2020 2020 2020 6f75  unks).        ou
-0001fbe0: 742e 6170 7065 6e64 286d 290a 2020 2020  t.append(m).    
-0001fbf0: 2020 2020 666f 7220 6320 696e 2072 6368      for c in rch
-0001fc00: 756e 6b73 3a0a 2020 2020 2020 2020 2020  unks:.          
-0001fc10: 2020 635b 2d31 5d20 2d3d 206d 0a20 2020    c[-1] -= m.   
-0001fc20: 2020 2020 2020 2020 2069 6620 635b 2d31           if c[-1
-0001fc30: 5d20 3d3d 2030 3a0a 2020 2020 2020 2020  ] == 0:.        
-0001fc40: 2020 2020 2020 2020 632e 706f 7028 290a          c.pop().
-0001fc50: 2020 2020 2020 2020 6920 2b3d 206d 0a0a          i += m..
-0001fc60: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
-0001fc70: 286f 7574 290a 0a0a 6465 6620 756e 6966  (out)...def unif
-0001fc80: 795f 6368 756e 6b73 282a 6172 6773 2c20  y_chunks(*args, 
-0001fc90: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0001fca0: 2222 0a20 2020 2055 6e69 6679 2063 6875  "".    Unify chu
-0001fcb0: 6e6b 7320 6163 726f 7373 2061 2073 6571  nks across a seq
-0001fcc0: 7565 6e63 6520 6f66 2061 7272 6179 730a  uence of arrays.
-0001fcd0: 0a20 2020 2054 6869 7320 7574 696c 6974  .    This utilit
-0001fce0: 7920 6675 6e63 7469 6f6e 2069 7320 7573  y function is us
-0001fcf0: 6564 2077 6974 6869 6e20 6f74 6865 7220  ed within other 
-0001fd00: 636f 6d6d 6f6e 206f 7065 7261 7469 6f6e  common operation
-0001fd10: 7320 6c69 6b65 0a20 2020 203a 6675 6e63  s like.    :func
-0001fd20: 3a60 6461 736b 2e61 7272 6179 2e63 6f72  :`dask.array.cor
-0001fd30: 652e 6d61 705f 626c 6f63 6b73 6020 616e  e.map_blocks` an
-0001fd40: 6420 3a66 756e 633a 6064 6173 6b2e 6172  d :func:`dask.ar
-0001fd50: 7261 792e 636f 7265 2e62 6c6f 636b 7769  ray.core.blockwi
-0001fd60: 7365 602e 0a20 2020 2049 7420 6973 206e  se`..    It is n
-0001fd70: 6f74 2063 6f6d 6d6f 6e6c 7920 7573 6564  ot commonly used
-0001fd80: 2062 7920 656e 642d 7573 6572 7320 6469   by end-users di
-0001fd90: 7265 6374 6c79 2e0a 0a20 2020 2050 6172  rectly...    Par
-0001fda0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-0001fdb0: 2d2d 2d2d 2d2d 0a20 2020 202a 6172 6773  ------.    *args
-0001fdc0: 3a20 7365 7175 656e 6365 206f 6620 4172  : sequence of Ar
-0001fdd0: 7261 792c 2069 6e64 6578 2070 6169 7273  ray, index pairs
-0001fde0: 0a20 2020 2020 2020 2053 6571 7565 6e63  .        Sequenc
-0001fdf0: 6520 6c69 6b65 2028 782c 2027 696a 272c  e like (x, 'ij',
-0001fe00: 2079 2c20 276a 6b27 2c20 7a2c 2027 6927   y, 'jk', z, 'i'
-0001fe10: 290a 0a20 2020 2045 7861 6d70 6c65 730a  )..    Examples.
-0001fe20: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-0001fe30: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
-0001fe40: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
-0001fe50: 203e 3e3e 2078 203d 2064 612e 6f6e 6573   >>> x = da.ones
-0001fe60: 2831 302c 2063 6875 6e6b 733d 2828 352c  (10, chunks=((5,
-0001fe70: 2032 2c20 3329 2c29 290a 2020 2020 3e3e   2, 3),)).    >>
-0001fe80: 3e20 7920 3d20 6461 2e6f 6e65 7328 3130  > y = da.ones(10
-0001fe90: 2c20 6368 756e 6b73 3d28 2832 2c20 332c  , chunks=((2, 3,
-0001fea0: 2035 292c 2929 0a20 2020 203e 3e3e 2063   5),)).    >>> c
-0001feb0: 6875 6e6b 7373 2c20 6172 7261 7973 203d  hunkss, arrays =
-0001fec0: 2075 6e69 6679 5f63 6875 6e6b 7328 782c   unify_chunks(x,
-0001fed0: 2027 6927 2c20 792c 2027 6927 290a 2020   'i', y, 'i').  
-0001fee0: 2020 3e3e 3e20 6368 756e 6b73 730a 2020    >>> chunkss.  
-0001fef0: 2020 7b27 6927 3a20 2832 2c20 332c 2032    {'i': (2, 3, 2
-0001ff00: 2c20 3329 7d0a 0a20 2020 203e 3e3e 2078  , 3)}..    >>> x
-0001ff10: 203d 2064 612e 6f6e 6573 2828 3130 302c   = da.ones((100,
-0001ff20: 2031 3029 2c20 6368 756e 6b73 3d28 3230   10), chunks=(20
-0001ff30: 2c20 3529 290a 2020 2020 3e3e 3e20 7920  , 5)).    >>> y 
-0001ff40: 3d20 6461 2e6f 6e65 7328 2831 302c 2031  = da.ones((10, 1
-0001ff50: 3030 292c 2063 6875 6e6b 733d 2834 2c20  00), chunks=(4, 
-0001ff60: 3530 2929 0a20 2020 203e 3e3e 2063 6875  50)).    >>> chu
-0001ff70: 6e6b 7373 2c20 6172 7261 7973 203d 2075  nkss, arrays = u
-0001ff80: 6e69 6679 5f63 6875 6e6b 7328 782c 2027  nify_chunks(x, '
-0001ff90: 696a 272c 2079 2c20 276a 6b27 2c20 2763  ij', y, 'jk', 'c
-0001ffa0: 6f6e 7374 616e 7427 2c20 4e6f 6e65 290a  onstant', None).
-0001ffb0: 2020 2020 3e3e 3e20 6368 756e 6b73 7320      >>> chunkss 
-0001ffc0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
-0001ffd0: 500a 2020 2020 7b27 6b27 3a20 2835 302c  P.    {'k': (50,
-0001ffe0: 2035 3029 2c20 2769 273a 2028 3230 2c20   50), 'i': (20, 
-0001fff0: 3230 2c20 3230 2c20 3230 2c20 3230 292c  20, 20, 20, 20),
-00020000: 2027 6a27 3a20 2834 2c20 312c 2033 2c20   'j': (4, 1, 3, 
-00020010: 3229 7d0a 0a20 2020 203e 3e3e 2075 6e69  2)}..    >>> uni
-00020020: 6679 5f63 6875 6e6b 7328 302c 204e 6f6e  fy_chunks(0, Non
-00020030: 6529 0a20 2020 2028 7b7d 2c20 5b30 5d29  e).    ({}, [0])
-00020040: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
-00020050: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 6368    -------.    ch
-00020060: 756e 6b73 7320 3a20 6469 6374 0a20 2020  unkss : dict.   
-00020070: 2020 2020 204d 6170 206c 696b 6520 7b69       Map like {i
-00020080: 6e64 6578 3a20 6368 756e 6b73 7d2e 0a20  ndex: chunks}.. 
-00020090: 2020 2061 7272 6179 7320 3a20 6c69 7374     arrays : list
-000200a0: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
-000200b0: 2072 6563 6875 6e6b 6564 2061 7272 6179   rechunked array
-000200c0: 732e 0a0a 2020 2020 5365 6520 416c 736f  s...    See Also
-000200d0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-000200e0: 2020 636f 6d6d 6f6e 5f62 6c6f 636b 6469    common_blockdi
-000200f0: 6d0a 2020 2020 2222 220a 2020 2020 6966  m.    """.    if
-00020100: 206e 6f74 2061 7267 733a 0a20 2020 2020   not args:.     
-00020110: 2020 2072 6574 7572 6e20 7b7d 2c20 5b5d     return {}, []
-00020120: 0a0a 2020 2020 6172 6769 6e64 7320 3d20  ..    arginds = 
-00020130: 5b0a 2020 2020 2020 2020 2861 7361 6e79  [.        (asany
-00020140: 6172 7261 7928 6129 2069 6620 696e 6420  array(a) if ind 
-00020150: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00020160: 2061 2c20 696e 6429 2066 6f72 2061 2c20   a, ind) for a, 
-00020170: 696e 6420 696e 2070 6172 7469 7469 6f6e  ind in partition
-00020180: 2832 2c20 6172 6773 290a 2020 2020 5d20  (2, args).    ] 
-00020190: 2023 205b 782c 2069 6a2c 2079 2c20 6a6b   # [x, ij, y, jk
-000201a0: 5d0a 2020 2020 7761 726e 203d 206b 7761  ].    warn = kwa
-000201b0: 7267 732e 6765 7428 2277 6172 6e22 2c20  rgs.get("warn", 
-000201c0: 5472 7565 290a 0a20 2020 2061 7272 6179  True)..    array
-000201d0: 732c 2069 6e64 7320 3d20 7a69 7028 2a61  s, inds = zip(*a
-000201e0: 7267 696e 6473 290a 2020 2020 6966 2061  rginds).    if a
-000201f0: 6c6c 2869 6e64 2069 7320 4e6f 6e65 2066  ll(ind is None f
-00020200: 6f72 2069 6e64 2069 6e20 696e 6473 293a  or ind in inds):
-00020210: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020220: 7b7d 2c20 6c69 7374 2861 7272 6179 7329  {}, list(arrays)
-00020230: 0a20 2020 2069 6620 616c 6c28 696e 6420  .    if all(ind 
-00020240: 3d3d 2069 6e64 735b 305d 2066 6f72 2069  == inds[0] for i
-00020250: 6e64 2069 6e20 696e 6473 2920 616e 6420  nd in inds) and 
-00020260: 616c 6c28 0a20 2020 2020 2020 2061 2e63  all(.        a.c
-00020270: 6875 6e6b 7320 3d3d 2061 7272 6179 735b  hunks == arrays[
-00020280: 305d 2e63 6875 6e6b 7320 666f 7220 6120  0].chunks for a 
-00020290: 696e 2061 7272 6179 730a 2020 2020 293a  in arrays.    ):
-000202a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000202b0: 6469 6374 287a 6970 2869 6e64 735b 305d  dict(zip(inds[0]
-000202c0: 2c20 6172 7261 7973 5b30 5d2e 6368 756e  , arrays[0].chun
-000202d0: 6b73 2929 2c20 6172 7261 7973 0a0a 2020  ks)), arrays..  
-000202e0: 2020 6e61 6d65 696e 6473 203d 205b 5d0a    nameinds = [].
-000202f0: 2020 2020 626c 6f63 6b64 696d 5f64 6963      blockdim_dic
-00020300: 7420 3d20 6469 6374 2829 0a20 2020 206d  t = dict().    m
-00020310: 6178 5f70 6172 7473 203d 2030 0a20 2020  ax_parts = 0.   
-00020320: 2066 6f72 2061 2c20 696e 6420 696e 2061   for a, ind in a
-00020330: 7267 696e 6473 3a0a 2020 2020 2020 2020  rginds:.        
-00020340: 6966 2069 6e64 2069 7320 6e6f 7420 4e6f  if ind is not No
-00020350: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00020360: 6e61 6d65 696e 6473 2e61 7070 656e 6428  nameinds.append(
-00020370: 2861 2e6e 616d 652c 2069 6e64 2929 0a20  (a.name, ind)). 
-00020380: 2020 2020 2020 2020 2020 2062 6c6f 636b             block
-00020390: 6469 6d5f 6469 6374 5b61 2e6e 616d 655d  dim_dict[a.name]
-000203a0: 203d 2061 2e63 6875 6e6b 730a 2020 2020   = a.chunks.    
-000203b0: 2020 2020 2020 2020 6d61 785f 7061 7274          max_part
-000203c0: 7320 3d20 6d61 7828 6d61 785f 7061 7274  s = max(max_part
-000203d0: 732c 2061 2e6e 7061 7274 6974 696f 6e73  s, a.npartitions
-000203e0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-000203f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00020400: 696e 6473 2e61 7070 656e 6428 2861 2c20  inds.append((a, 
-00020410: 696e 6429 290a 0a20 2020 2063 6875 6e6b  ind))..    chunk
-00020420: 7373 203d 2062 726f 6164 6361 7374 5f64  ss = broadcast_d
-00020430: 696d 656e 7369 6f6e 7328 6e61 6d65 696e  imensions(namein
-00020440: 6473 2c20 626c 6f63 6b64 696d 5f64 6963  ds, blockdim_dic
-00020450: 742c 2063 6f6e 736f 6c69 6461 7465 3d63  t, consolidate=c
-00020460: 6f6d 6d6f 6e5f 626c 6f63 6b64 696d 290a  ommon_blockdim).
-00020470: 2020 2020 6e70 6172 7473 203d 206d 6174      nparts = mat
-00020480: 682e 7072 6f64 286d 6170 286c 656e 2c20  h.prod(map(len, 
-00020490: 6368 756e 6b73 732e 7661 6c75 6573 2829  chunkss.values()
-000204a0: 2929 0a0a 2020 2020 6966 2077 6172 6e20  ))..    if warn 
-000204b0: 616e 6420 6e70 6172 7473 2061 6e64 206e  and nparts and n
-000204c0: 7061 7274 7320 3e3d 206d 6178 5f70 6172  parts >= max_par
-000204d0: 7473 202a 2031 303a 0a20 2020 2020 2020  ts * 10:.       
-000204e0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-000204f0: 2020 2020 2020 2020 2020 2020 2249 6e63              "Inc
-00020500: 7265 6173 696e 6720 6e75 6d62 6572 206f  reasing number o
-00020510: 6620 6368 756e 6b73 2062 7920 6661 6374  f chunks by fact
-00020520: 6f72 206f 6620 2564 2220 2520 286e 7061  or of %d" % (npa
-00020530: 7274 7320 2f20 6d61 785f 7061 7274 7329  rts / max_parts)
-00020540: 2c0a 2020 2020 2020 2020 2020 2020 5065  ,.            Pe
-00020550: 7266 6f72 6d61 6e63 6557 6172 6e69 6e67  rformanceWarning
-00020560: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
-00020570: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
-00020580: 2020 2020 290a 0a20 2020 2061 7272 6179      )..    array
-00020590: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
-000205a0: 2c20 6920 696e 2061 7267 696e 6473 3a0a  , i in arginds:.
-000205b0: 2020 2020 2020 2020 6966 2069 2069 7320          if i is 
-000205c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000205d0: 2020 6172 7261 7973 2e61 7070 656e 6428    arrays.append(
-000205e0: 6129 0a20 2020 2020 2020 2065 6c73 653a  a).        else:
-000205f0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-00020600: 6e6b 7320 3d20 7475 706c 6528 0a20 2020  nks = tuple(.   
-00020610: 2020 2020 2020 2020 2020 2020 2063 6875               chu
-00020620: 6e6b 7373 5b6a 5d0a 2020 2020 2020 2020  nkss[j].        
-00020630: 2020 2020 2020 2020 6966 2061 2e73 6861          if a.sha
-00020640: 7065 5b6e 5d20 3e20 310a 2020 2020 2020  pe[n] > 1.      
-00020650: 2020 2020 2020 2020 2020 656c 7365 2061            else a
-00020660: 2e73 6861 7065 5b6e 5d0a 2020 2020 2020  .shape[n].      
-00020670: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00020680: 206e 702e 6973 6e61 6e28 7375 6d28 6368   np.isnan(sum(ch
-00020690: 756e 6b73 735b 6a5d 2929 0a20 2020 2020  unkss[j])).     
-000206a0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-000206b0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000206c0: 2020 2020 2066 6f72 206e 2c20 6a20 696e       for n, j in
-000206d0: 2065 6e75 6d65 7261 7465 2869 290a 2020   enumerate(i).  
-000206e0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000206f0: 2020 2020 2020 2020 6966 2063 6875 6e6b          if chunk
-00020700: 7320 213d 2061 2e63 6875 6e6b 7320 616e  s != a.chunks an
-00020710: 6420 616c 6c28 612e 6368 756e 6b73 293a  d all(a.chunks):
-00020720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020730: 2061 7272 6179 732e 6170 7065 6e64 2861   arrays.append(a
-00020740: 2e72 6563 6875 6e6b 2863 6875 6e6b 7329  .rechunk(chunks)
-00020750: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00020760: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00020770: 2020 2020 6172 7261 7973 2e61 7070 656e      arrays.appen
-00020780: 6428 6129 0a20 2020 2072 6574 7572 6e20  d(a).    return 
-00020790: 6368 756e 6b73 732c 2061 7272 6179 730a  chunkss, arrays.
-000207a0: 0a0a 6465 6620 756e 7061 636b 5f73 696e  ..def unpack_sin
-000207b0: 676c 6574 6f6e 2878 293a 0a20 2020 2022  gleton(x):.    "
-000207c0: 2222 0a0a 2020 2020 3e3e 3e20 756e 7061  ""..    >>> unpa
-000207d0: 636b 5f73 696e 676c 6574 6f6e 285b 5b5b  ck_singleton([[[
-000207e0: 5b31 5d5d 5d5d 290a 2020 2020 310a 2020  [1]]]]).    1.  
-000207f0: 2020 3e3e 3e20 756e 7061 636b 5f73 696e    >>> unpack_sin
-00020800: 676c 6574 6f6e 286e 702e 6172 7261 7928  gleton(np.array(
-00020810: 6e70 2e64 6174 6574 696d 6536 3428 2732  np.datetime64('2
-00020820: 3030 302d 3031 2d30 3127 2929 290a 2020  000-01-01'))).  
-00020830: 2020 6172 7261 7928 2732 3030 302d 3031    array('2000-01
-00020840: 2d30 3127 2c20 6474 7970 653d 2764 6174  -01', dtype='dat
-00020850: 6574 696d 6536 345b 445d 2729 0a20 2020  etime64[D]').   
-00020860: 2022 2222 0a20 2020 2077 6869 6c65 2069   """.    while i
-00020870: 7369 6e73 7461 6e63 6528 782c 2028 6c69  sinstance(x, (li
-00020880: 7374 2c20 7475 706c 6529 293a 0a20 2020  st, tuple)):.   
-00020890: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000208a0: 2020 2020 2020 7820 3d20 785b 305d 0a20        x = x[0]. 
-000208b0: 2020 2020 2020 2065 7863 6570 7420 2849         except (I
-000208c0: 6e64 6578 4572 726f 722c 2054 7970 6545  ndexError, TypeE
-000208d0: 7272 6f72 2c20 4b65 7945 7272 6f72 293a  rror, KeyError):
-000208e0: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
-000208f0: 616b 0a20 2020 2072 6574 7572 6e20 780a  ak.    return x.
-00020900: 0a0a 6465 6620 626c 6f63 6b28 6172 7261  ..def block(arra
-00020910: 7973 2c20 616c 6c6f 775f 756e 6b6e 6f77  ys, allow_unknow
-00020920: 6e5f 6368 756e 6b73 697a 6573 3d46 616c  n_chunksizes=Fal
-00020930: 7365 293a 0a20 2020 2022 2222 0a20 2020  se):.    """.   
-00020940: 2041 7373 656d 626c 6520 616e 206e 642d   Assemble an nd-
-00020950: 6172 7261 7920 6672 6f6d 206e 6573 7465  array from neste
-00020960: 6420 6c69 7374 7320 6f66 2062 6c6f 636b  d lists of block
-00020970: 732e 0a0a 2020 2020 426c 6f63 6b73 2069  s...    Blocks i
-00020980: 6e20 7468 6520 696e 6e65 726d 6f73 7420  n the innermost 
-00020990: 6c69 7374 7320 6172 6520 636f 6e63 6174  lists are concat
-000209a0: 656e 6174 6564 2061 6c6f 6e67 2074 6865  enated along the
-000209b0: 206c 6173 740a 2020 2020 6469 6d65 6e73   last.    dimens
-000209c0: 696f 6e20 282d 3129 2c20 7468 656e 2074  ion (-1), then t
-000209d0: 6865 7365 2061 7265 2063 6f6e 6361 7465  hese are concate
-000209e0: 6e61 7465 6420 616c 6f6e 6720 7468 6520  nated along the 
-000209f0: 7365 636f 6e64 2d6c 6173 740a 2020 2020  second-last.    
-00020a00: 6469 6d65 6e73 696f 6e20 282d 3229 2c20  dimension (-2), 
-00020a10: 616e 6420 736f 206f 6e20 756e 7469 6c20  and so on until 
-00020a20: 7468 6520 6f75 7465 726d 6f73 7420 6c69  the outermost li
-00020a30: 7374 2069 7320 7265 6163 6865 640a 0a20  st is reached.. 
-00020a40: 2020 2042 6c6f 636b 7320 6361 6e20 6265     Blocks can be
-00020a50: 206f 6620 616e 7920 6469 6d65 6e73 696f   of any dimensio
-00020a60: 6e2c 2062 7574 2077 696c 6c20 6e6f 7420  n, but will not 
-00020a70: 6265 2062 726f 6164 6361 7374 6564 2075  be broadcasted u
-00020a80: 7369 6e67 2074 6865 206e 6f72 6d61 6c0a  sing the normal.
-00020a90: 2020 2020 7275 6c65 732e 2049 6e73 7465      rules. Inste
-00020aa0: 6164 2c20 6c65 6164 696e 6720 6178 6573  ad, leading axes
-00020ab0: 206f 6620 7369 7a65 2031 2061 7265 2069   of size 1 are i
-00020ac0: 6e73 6572 7465 642c 2074 6f20 6d61 6b65  nserted, to make
-00020ad0: 2060 6062 6c6f 636b 2e6e 6469 6d60 600a   ``block.ndim``.
-00020ae0: 2020 2020 7468 6520 7361 6d65 2066 6f72      the same for
-00020af0: 2061 6c6c 2062 6c6f 636b 732e 2054 6869   all blocks. Thi
-00020b00: 7320 6973 2070 7269 6d61 7269 6c79 2075  s is primarily u
-00020b10: 7365 6675 6c20 666f 7220 776f 726b 696e  seful for workin
-00020b20: 6720 7769 7468 2073 6361 6c61 7273 2c0a  g with scalars,.
-00020b30: 2020 2020 616e 6420 6d65 616e 7320 7468      and means th
-00020b40: 6174 2063 6f64 6520 6c69 6b65 2060 6062  at code like ``b
-00020b50: 6c6f 636b 285b 762c 2031 5d29 6060 2069  lock([v, 1])`` i
-00020b60: 7320 7661 6c69 642c 2077 6865 7265 0a20  s valid, where. 
-00020b70: 2020 2060 6076 2e6e 6469 6d20 3d3d 2031     ``v.ndim == 1
-00020b80: 6060 2e0a 0a20 2020 2057 6865 6e20 7468  ``...    When th
-00020b90: 6520 6e65 7374 6564 206c 6973 7420 6973  e nested list is
-00020ba0: 2074 776f 206c 6576 656c 7320 6465 6570   two levels deep
-00020bb0: 2c20 7468 6973 2061 6c6c 6f77 7320 626c  , this allows bl
-00020bc0: 6f63 6b20 6d61 7472 6963 6573 2074 6f20  ock matrices to 
-00020bd0: 6265 0a20 2020 2063 6f6e 7374 7275 6374  be.    construct
-00020be0: 6564 2066 726f 6d20 7468 6569 7220 636f  ed from their co
-00020bf0: 6d70 6f6e 656e 7473 2e0a 0a20 2020 2050  mponents...    P
-00020c00: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00020c10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7272  --------.    arr
-00020c20: 6179 7320 3a20 6e65 7374 6564 206c 6973  ays : nested lis
-00020c30: 7420 6f66 2061 7272 6179 5f6c 696b 6520  t of array_like 
-00020c40: 6f72 2073 6361 6c61 7273 2028 6275 7420  or scalars (but 
-00020c50: 6e6f 7420 7475 706c 6573 290a 2020 2020  not tuples).    
-00020c60: 2020 2020 4966 2070 6173 7365 6420 6120      If passed a 
-00020c70: 7369 6e67 6c65 206e 6461 7272 6179 206f  single ndarray o
-00020c80: 7220 7363 616c 6172 2028 6120 6e65 7374  r scalar (a nest
-00020c90: 6564 206c 6973 7420 6f66 2064 6570 7468  ed list of depth
-00020ca0: 2030 292c 2074 6869 730a 2020 2020 2020   0), this.      
-00020cb0: 2020 6973 2072 6574 7572 6e65 6420 756e    is returned un
-00020cc0: 6d6f 6469 6669 6564 2028 616e 6420 6e6f  modified (and no
-00020cd0: 7420 636f 7069 6564 292e 0a0a 2020 2020  t copied)...    
-00020ce0: 2020 2020 456c 656d 656e 7473 2073 6861      Elements sha
-00020cf0: 7065 7320 6d75 7374 206d 6174 6368 2061  pes must match a
-00020d00: 6c6f 6e67 2074 6865 2061 7070 726f 7072  long the appropr
-00020d10: 6961 7465 2061 7865 7320 2877 6974 686f  iate axes (witho
-00020d20: 7574 0a20 2020 2020 2020 2062 726f 6164  ut.        broad
-00020d30: 6361 7374 696e 6729 2c20 6275 7420 6c65  casting), but le
-00020d40: 6164 696e 6720 3173 2077 696c 6c20 6265  ading 1s will be
-00020d50: 2070 7265 7065 6e64 6564 2074 6f20 7468   prepended to th
-00020d60: 6520 7368 6170 6520 6173 0a20 2020 2020  e shape as.     
-00020d70: 2020 206e 6563 6573 7361 7279 2074 6f20     necessary to 
-00020d80: 6d61 6b65 2074 6865 2064 696d 656e 7369  make the dimensi
-00020d90: 6f6e 7320 6d61 7463 682e 0a0a 2020 2020  ons match...    
-00020da0: 616c 6c6f 775f 756e 6b6e 6f77 6e5f 6368  allow_unknown_ch
-00020db0: 756e 6b73 697a 6573 3a20 626f 6f6c 0a20  unksizes: bool. 
-00020dc0: 2020 2020 2020 2041 6c6c 6f77 2075 6e6b         Allow unk
-00020dd0: 6e6f 776e 2063 6875 6e6b 7369 7a65 732c  nown chunksizes,
-00020de0: 2073 7563 6820 6173 2063 6f6d 6520 6672   such as come fr
-00020df0: 6f6d 2063 6f6e 7665 7274 696e 6720 6672  om converting fr
-00020e00: 6f6d 2064 6173 6b0a 2020 2020 2020 2020  om dask.        
-00020e10: 6461 7461 6672 616d 6573 2e20 2044 6173  dataframes.  Das
-00020e20: 6b2e 6172 7261 7920 6973 2075 6e61 626c  k.array is unabl
-00020e30: 6520 746f 2076 6572 6966 7920 7468 6174  e to verify that
-00020e40: 2063 6875 6e6b 7320 6c69 6e65 2075 702e   chunks line up.
-00020e50: 2020 4966 0a20 2020 2020 2020 2064 6174    If.        dat
-00020e60: 6120 636f 6d65 7320 6672 6f6d 2064 6966  a comes from dif
-00020e70: 6665 7265 6e74 6c79 2061 6c69 676e 6564  ferently aligned
-00020e80: 2073 6f75 7263 6573 2074 6865 6e20 7468   sources then th
-00020e90: 6973 2063 616e 2063 6175 7365 0a20 2020  is can cause.   
-00020ea0: 2020 2020 2075 6e65 7870 6563 7465 6420       unexpected 
-00020eb0: 7265 7375 6c74 732e 0a0a 2020 2020 5265  results...    Re
-00020ec0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00020ed0: 2d0a 2020 2020 626c 6f63 6b5f 6172 7261  -.    block_arra
-00020ee0: 7920 3a20 6e64 6172 7261 790a 2020 2020  y : ndarray.    
-00020ef0: 2020 2020 5468 6520 6172 7261 7920 6173      The array as
-00020f00: 7365 6d62 6c65 6420 6672 6f6d 2074 6865  sembled from the
-00020f10: 2067 6976 656e 2062 6c6f 636b 732e 0a0a   given blocks...
-00020f20: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
-00020f30: 6e73 696f 6e61 6c69 7479 206f 6620 7468  nsionality of th
-00020f40: 6520 6f75 7470 7574 2069 7320 6571 7561  e output is equa
-00020f50: 6c20 746f 2074 6865 2067 7265 6174 6573  l to the greates
-00020f60: 7420 6f66 3a0a 2020 2020 2020 2020 2a20  t of:.        * 
-00020f70: 7468 6520 6469 6d65 6e73 696f 6e61 6c69  the dimensionali
-00020f80: 7479 206f 6620 616c 6c20 7468 6520 696e  ty of all the in
-00020f90: 7075 7473 0a20 2020 2020 2020 202a 2074  puts.        * t
-00020fa0: 6865 2064 6570 7468 2074 6f20 7768 6963  he depth to whic
-00020fb0: 6820 7468 6520 696e 7075 7420 6c69 7374  h the input list
-00020fc0: 2069 7320 6e65 7374 6564 0a0a 2020 2020   is nested..    
-00020fd0: 5261 6973 6573 0a20 2020 202d 2d2d 2d2d  Raises.    -----
-00020fe0: 2d0a 2020 2020 5661 6c75 6545 7272 6f72  -.    ValueError
-00020ff0: 0a20 2020 2020 2020 202a 2049 6620 6c69  .        * If li
-00021000: 7374 2064 6570 7468 7320 6172 6520 6d69  st depths are mi
-00021010: 736d 6174 6368 6564 202d 2066 6f72 2069  smatched - for i
-00021020: 6e73 7461 6e63 652c 2060 605b 5b61 2c20  nstance, ``[[a, 
-00021030: 625d 2c20 635d 6060 2069 730a 2020 2020  b], c]`` is.    
-00021040: 2020 2020 2020 696c 6c65 6761 6c2c 2061        illegal, a
-00021050: 6e64 2073 686f 756c 6420 6265 2073 7065  nd should be spe
-00021060: 6c74 2060 605b 5b61 2c20 625d 2c20 5b63  lt ``[[a, b], [c
-00021070: 5d5d 6060 0a20 2020 2020 2020 202a 2049  ]]``.        * I
-00021080: 6620 6c69 7374 7320 6172 6520 656d 7074  f lists are empt
-00021090: 7920 2d20 666f 7220 696e 7374 616e 6365  y - for instance
-000210a0: 2c20 6060 5b5b 612c 2062 5d2c 205b 5d5d  , ``[[a, b], []]
-000210b0: 6060 0a0a 2020 2020 5365 6520 416c 736f  ``..    See Also
-000210c0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-000210d0: 2020 636f 6e63 6174 656e 6174 6520 3a20    concatenate : 
-000210e0: 4a6f 696e 2061 2073 6571 7565 6e63 6520  Join a sequence 
-000210f0: 6f66 2061 7272 6179 7320 746f 6765 7468  of arrays togeth
-00021100: 6572 2e0a 2020 2020 7374 6163 6b20 3a20  er..    stack : 
-00021110: 5374 6163 6b20 6172 7261 7973 2069 6e20  Stack arrays in 
-00021120: 7365 7175 656e 6365 2061 6c6f 6e67 2061  sequence along a
-00021130: 206e 6577 2064 696d 656e 7369 6f6e 2e0a   new dimension..
-00021140: 2020 2020 6873 7461 636b 203a 2053 7461      hstack : Sta
-00021150: 636b 2061 7272 6179 7320 696e 2073 6571  ck arrays in seq
-00021160: 7565 6e63 6520 686f 7269 7a6f 6e74 616c  uence horizontal
-00021170: 6c79 2028 636f 6c75 6d6e 2077 6973 6529  ly (column wise)
-00021180: 2e0a 2020 2020 7673 7461 636b 203a 2053  ..    vstack : S
-00021190: 7461 636b 2061 7272 6179 7320 696e 2073  tack arrays in s
-000211a0: 6571 7565 6e63 6520 7665 7274 6963 616c  equence vertical
-000211b0: 6c79 2028 726f 7720 7769 7365 292e 0a20  ly (row wise).. 
-000211c0: 2020 2064 7374 6163 6b20 3a20 5374 6163     dstack : Stac
-000211d0: 6b20 6172 7261 7973 2069 6e20 7365 7175  k arrays in sequ
-000211e0: 656e 6365 2064 6570 7468 2077 6973 6520  ence depth wise 
-000211f0: 2861 6c6f 6e67 2074 6869 7264 2064 696d  (along third dim
-00021200: 656e 7369 6f6e 292e 0a20 2020 2076 7370  ension)..    vsp
-00021210: 6c69 7420 3a20 5370 6c69 7420 6172 7261  lit : Split arra
-00021220: 7920 696e 746f 2061 206c 6973 7420 6f66  y into a list of
-00021230: 206d 756c 7469 706c 6520 7375 622d 6172   multiple sub-ar
-00021240: 7261 7973 2076 6572 7469 6361 6c6c 792e  rays vertically.
-00021250: 0a0a 2020 2020 4e6f 7465 730a 2020 2020  ..    Notes.    
-00021260: 2d2d 2d2d 2d0a 0a20 2020 2057 6865 6e20  -----..    When 
-00021270: 6361 6c6c 6564 2077 6974 6820 6f6e 6c79  called with only
-00021280: 2073 6361 6c61 7273 2c20 6060 626c 6f63   scalars, ``bloc
-00021290: 6b60 6020 6973 2065 7175 6976 616c 656e  k`` is equivalen
-000212a0: 7420 746f 2061 6e20 6e64 6172 7261 790a  t to an ndarray.
-000212b0: 2020 2020 6361 6c6c 2e20 536f 2060 6062      call. So ``b
-000212c0: 6c6f 636b 285b 5b31 2c20 325d 2c20 5b33  lock([[1, 2], [3
-000212d0: 2c20 345d 5d29 6060 2069 7320 6571 7569  , 4]])`` is equi
-000212e0: 7661 6c65 6e74 2074 6f0a 2020 2020 6060  valent to.    ``
-000212f0: 6172 7261 7928 5b5b 312c 2032 5d2c 205b  array([[1, 2], [
-00021300: 332c 2034 5d5d 2960 602e 0a0a 2020 2020  3, 4]])``...    
-00021310: 5468 6973 2066 756e 6374 696f 6e20 646f  This function do
-00021320: 6573 206e 6f74 2065 6e66 6f72 6365 2074  es not enforce t
-00021330: 6861 7420 7468 6520 626c 6f63 6b73 206c  hat the blocks l
-00021340: 6965 206f 6e20 6120 6669 7865 6420 6772  ie on a fixed gr
-00021350: 6964 2e0a 2020 2020 6060 626c 6f63 6b28  id..    ``block(
-00021360: 5b5b 612c 2062 5d2c 205b 632c 2064 5d5d  [[a, b], [c, d]]
-00021370: 2960 6020 6973 206e 6f74 2072 6573 7472  )`` is not restr
-00021380: 6963 7465 6420 746f 2061 7272 6179 7320  icted to arrays 
-00021390: 6f66 2074 6865 2066 6f72 6d3a 3a0a 0a20  of the form::.. 
-000213a0: 2020 2020 2020 2041 4141 6262 0a20 2020         AAAbb.   
-000213b0: 2020 2020 2041 4141 6262 0a20 2020 2020       AAAbb.     
-000213c0: 2020 2063 6363 4444 0a0a 2020 2020 4275     cccDD..    Bu
-000213d0: 7420 6973 2061 6c73 6f20 616c 6c6f 7765  t is also allowe
-000213e0: 6420 746f 2070 726f 6475 6365 2c20 666f  d to produce, fo
-000213f0: 7220 736f 6d65 2060 6061 2c20 622c 2063  r some ``a, b, c
-00021400: 2c20 6460 603a 3a0a 0a20 2020 2020 2020  , d``::..       
-00021410: 2041 4141 6262 0a20 2020 2020 2020 2041   AAAbb.        A
-00021420: 4141 6262 0a20 2020 2020 2020 2063 4444  AAbb.        cDD
-00021430: 4444 0a0a 2020 2020 5369 6e63 6520 636f  DD..    Since co
-00021440: 6e63 6174 656e 6174 696f 6e20 6861 7070  ncatenation happ
-00021450: 656e 7320 616c 6f6e 6720 7468 6520 6c61  ens along the la
-00021460: 7374 2061 7869 7320 6669 7273 742c 2060  st axis first, `
-00021470: 626c 6f63 6b60 2069 7320 5f6e 6f74 5f0a  block` is _not_.
-00021480: 2020 2020 6361 7061 626c 6520 6f66 2070      capable of p
-00021490: 726f 6475 6369 6e67 2074 6865 2066 6f6c  roducing the fol
-000214a0: 6c6f 7769 6e67 2064 6972 6563 746c 793a  lowing directly:
-000214b0: 3a0a 0a20 2020 2020 2020 2041 4141 6262  :..        AAAbb
-000214c0: 0a20 2020 2020 2020 2063 6363 6262 0a20  .        cccbb. 
-000214d0: 2020 2020 2020 2063 6363 4444 0a0a 2020         cccDD..  
-000214e0: 2020 4d61 746c 6162 2773 2022 7371 7561    Matlab's "squa
-000214f0: 7265 2062 7261 636b 6574 2073 7461 636b  re bracket stack
-00021500: 696e 6722 2c20 6060 5b41 2c20 422c 202e  ing", ``[A, B, .
-00021510: 2e2e 3b20 702c 2071 2c20 2e2e 2e5d 6060  ..; p, q, ...]``
-00021520: 2c20 6973 0a20 2020 2065 7175 6976 616c  , is.    equival
-00021530: 656e 7420 746f 2060 6062 6c6f 636b 285b  ent to ``block([
-00021540: 5b41 2c20 422c 202e 2e2e 5d2c 205b 702c  [A, B, ...], [p,
-00021550: 2071 2c20 2e2e 2e5d 5d29 6060 2e0a 2020   q, ...]])``..  
-00021560: 2020 2222 220a 0a20 2020 2023 2054 6869    """..    # Thi
-00021570: 7320 7761 7320 636f 7069 6564 2061 6c6d  s was copied alm
-00021580: 6f73 7420 7665 7262 6174 696d 2066 726f  ost verbatim fro
-00021590: 6d20 6e75 6d70 792e 636f 7265 2e73 6861  m numpy.core.sha
-000215a0: 7065 5f62 6173 652e 626c 6f63 6b0a 2020  pe_base.block.  
-000215b0: 2020 2320 5365 6520 6e75 6d70 7920 6c69    # See numpy li
-000215c0: 6365 6e73 6520 6174 2068 7474 7073 3a2f  cense at https:/
-000215d0: 2f67 6974 6875 622e 636f 6d2f 6e75 6d70  /github.com/nump
-000215e0: 792f 6e75 6d70 792f 626c 6f62 2f6d 6173  y/numpy/blob/mas
-000215f0: 7465 722f 4c49 4345 4e53 452e 7478 740a  ter/LICENSE.txt.
-00021600: 2020 2020 2320 6f72 204e 554d 5059 5f4c      # or NUMPY_L
-00021610: 4943 454e 5345 2e74 7874 2077 6974 6869  ICENSE.txt withi
-00021620: 6e20 7468 6973 2064 6972 6563 746f 7279  n this directory
-00021630: 0a0a 2020 2020 6465 6620 6174 6c65 6173  ..    def atleas
-00021640: 745f 6e64 2878 2c20 6e64 696d 293a 0a20  t_nd(x, ndim):. 
-00021650: 2020 2020 2020 2078 203d 2061 7361 6e79         x = asany
-00021660: 6172 7261 7928 7829 0a20 2020 2020 2020  array(x).       
-00021670: 2064 6966 6620 3d20 6d61 7828 6e64 696d   diff = max(ndim
-00021680: 202d 2078 2e6e 6469 6d2c 2030 290a 2020   - x.ndim, 0).  
-00021690: 2020 2020 2020 6966 2064 6966 6620 3d3d        if diff ==
-000216a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000216b0: 7265 7475 726e 2078 0a20 2020 2020 2020  return x.       
-000216c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000216d0: 2020 2072 6574 7572 6e20 785b 284e 6f6e     return x[(Non
-000216e0: 652c 2920 2a20 6469 6666 202b 2028 456c  e,) * diff + (El
-000216f0: 6c69 7073 6973 2c29 5d0a 0a20 2020 2064  lipsis,)]..    d
-00021700: 6566 2066 6f72 6d61 745f 696e 6465 7828  ef format_index(
-00021710: 696e 6465 7829 3a0a 2020 2020 2020 2020  index):.        
-00021720: 7265 7475 726e 2022 6172 7261 7973 2220  return "arrays" 
-00021730: 2b20 2222 2e6a 6f69 6e28 6622 5b7b 697d  + "".join(f"[{i}
-00021740: 5d22 2066 6f72 2069 2069 6e20 696e 6465  ]" for i in inde
-00021750: 7829 0a0a 2020 2020 7265 6320 3d20 5f52  x)..    rec = _R
-00021760: 6563 7572 7365 7228 7265 6375 7273 655f  ecurser(recurse_
-00021770: 6966 3d6c 616d 6264 6120 783a 2074 7970  if=lambda x: typ
-00021780: 6528 7829 2069 7320 6c69 7374 290a 0a20  e(x) is list).. 
-00021790: 2020 2023 2065 6e73 7572 6520 7468 6174     # ensure that
-000217a0: 2074 6865 206c 6973 7473 2061 7265 2061   the lists are a
-000217b0: 6c6c 206d 6174 6368 6564 2069 6e20 6465  ll matched in de
-000217c0: 7074 680a 2020 2020 6c69 7374 5f6e 6469  pth.    list_ndi
-000217d0: 6d20 3d20 4e6f 6e65 0a20 2020 2061 6e79  m = None.    any
-000217e0: 5f65 6d70 7479 203d 2046 616c 7365 0a20  _empty = False. 
-000217f0: 2020 2066 6f72 2069 6e64 6578 2c20 7661     for index, va
-00021800: 6c75 652c 2065 6e74 6572 696e 6720 696e  lue, entering in
-00021810: 2072 6563 2e77 616c 6b28 6172 7261 7973   rec.walk(arrays
-00021820: 293a 0a20 2020 2020 2020 2069 6620 7479  ):.        if ty
-00021830: 7065 2876 616c 7565 2920 6973 2074 7570  pe(value) is tup
-00021840: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00021850: 2320 6e6f 7420 7374 7269 6374 6c79 206e  # not strictly n
-00021860: 6563 6573 7361 7279 2c20 6275 7420 7361  ecessary, but sa
-00021870: 7665 7320 7573 2066 726f 6d3a 0a20 2020  ves us from:.   
-00021880: 2020 2020 2020 2020 2023 2020 2d20 6d6f           #  - mo
-00021890: 7265 2074 6861 6e20 6f6e 6520 7761 7920  re than one way 
-000218a0: 746f 2064 6f20 7468 696e 6773 202d 206e  to do things - n
-000218b0: 6f20 706f 696e 7420 7472 6561 7469 6e67  o point treating
-000218c0: 2074 7570 6c65 7320 6c69 6b65 0a20 2020   tuples like.   
-000218d0: 2020 2020 2020 2020 2023 2020 2020 6c69           #    li
-000218e0: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
-000218f0: 2320 202d 2068 6f72 7269 626c 7920 636f  #  - horribly co
-00021900: 6e66 7573 696e 6720 6265 6861 7669 6f75  nfusing behaviou
-00021910: 7220 7468 6174 2072 6573 756c 7473 2077  r that results w
-00021920: 6865 6e20 7475 706c 6573 2061 7265 0a20  hen tuples are. 
-00021930: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00021940: 7472 6561 7465 6420 6c69 6b65 206e 6461  treated like nda
-00021950: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
-00021960: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-00021970: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00021980: 2020 227b 7d20 6973 2061 2074 7570 6c65    "{} is a tuple
-00021990: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-000219a0: 2020 2020 224f 6e6c 7920 6c69 7374 7320      "Only lists 
-000219b0: 6361 6e20 6265 2075 7365 6420 746f 2061  can be used to a
-000219c0: 7272 616e 6765 2062 6c6f 636b 732c 2061  rrange blocks, a
-000219d0: 6e64 206e 702e 626c 6f63 6b20 646f 6573  nd np.block does
-000219e0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000219f0: 2020 2022 6e6f 7420 616c 6c6f 7720 696d     "not allow im
-00021a00: 706c 6963 6974 2063 6f6e 7665 7273 696f  plicit conversio
-00021a10: 6e20 6672 6f6d 2074 7570 6c65 2074 6f20  n from tuple to 
-00021a20: 6e64 6172 7261 792e 222e 666f 726d 6174  ndarray.".format
-00021a30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00021a40: 2020 2020 2020 666f 726d 6174 5f69 6e64        format_ind
-00021a50: 6578 2869 6e64 6578 290a 2020 2020 2020  ex(index).      
-00021a60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00021a70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00021a80: 2020 6966 206e 6f74 2065 6e74 6572 696e    if not enterin
-00021a90: 673a 0a20 2020 2020 2020 2020 2020 2063  g:.            c
-00021aa0: 7572 725f 6465 7074 6820 3d20 6c65 6e28  urr_depth = len(
-00021ab0: 696e 6465 7829 0a20 2020 2020 2020 2065  index).        e
-00021ac0: 6c69 6620 6c65 6e28 7661 6c75 6529 203d  lif len(value) =
-00021ad0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00021ae0: 2063 7572 725f 6465 7074 6820 3d20 6c65   curr_depth = le
-00021af0: 6e28 696e 6465 7829 202b 2031 0a20 2020  n(index) + 1.   
-00021b00: 2020 2020 2020 2020 2061 6e79 5f65 6d70           any_emp
-00021b10: 7479 203d 2054 7275 650a 2020 2020 2020  ty = True.      
-00021b20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00021b30: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00021b40: 2020 2020 2020 6966 206c 6973 745f 6e64        if list_nd
-00021b50: 696d 2069 7320 6e6f 7420 4e6f 6e65 2061  im is not None a
-00021b60: 6e64 206c 6973 745f 6e64 696d 2021 3d20  nd list_ndim != 
-00021b70: 6375 7272 5f64 6570 7468 3a0a 2020 2020  curr_depth:.    
-00021b80: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00021b90: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00021ba0: 2020 2020 2020 2020 2020 224c 6973 7420            "List 
-00021bb0: 6465 7074 6873 2061 7265 206d 6973 6d61  depths are misma
-00021bc0: 7463 6865 642e 2046 6972 7374 2065 6c65  tched. First ele
-00021bd0: 6d65 6e74 2077 6173 2061 7420 6465 7074  ment was at dept
-00021be0: 6820 7b7d 2c20 220a 2020 2020 2020 2020  h {}, ".        
-00021bf0: 2020 2020 2020 2020 2262 7574 2074 6865          "but the
-00021c00: 7265 2069 7320 616e 2065 6c65 6d65 6e74  re is an element
-00021c10: 2061 7420 6465 7074 6820 7b7d 2028 7b7d   at depth {} ({}
-00021c20: 2922 2e66 6f72 6d61 7428 0a20 2020 2020  )".format(.     
-00021c30: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00021c40: 6973 745f 6e64 696d 2c20 6375 7272 5f64  ist_ndim, curr_d
-00021c50: 6570 7468 2c20 666f 726d 6174 5f69 6e64  epth, format_ind
-00021c60: 6578 2869 6e64 6578 290a 2020 2020 2020  ex(index).      
-00021c70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00021c80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00021c90: 2020 6c69 7374 5f6e 6469 6d20 3d20 6375    list_ndim = cu
-00021ca0: 7272 5f64 6570 7468 0a0a 2020 2020 2320  rr_depth..    # 
-00021cb0: 646f 2074 6869 7320 6865 7265 2073 6f20  do this here so 
-00021cc0: 7765 2063 6174 6368 2064 6570 7468 206d  we catch depth m
-00021cd0: 6973 6d61 7463 6865 7320 6669 7273 740a  ismatches first.
-00021ce0: 2020 2020 6966 2061 6e79 5f65 6d70 7479      if any_empty
-00021cf0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00021d00: 5661 6c75 6545 7272 6f72 2822 4c69 7374  ValueError("List
-00021d10: 7320 6361 6e6e 6f74 2062 6520 656d 7074  s cannot be empt
-00021d20: 7922 290a 0a20 2020 2023 2063 6f6e 7665  y")..    # conve
-00021d30: 7274 2061 6c6c 2074 6865 2061 7272 6179  rt all the array
-00021d40: 7320 746f 206e 6461 7272 6179 730a 2020  s to ndarrays.  
-00021d50: 2020 6172 7261 7973 203d 2072 6563 2e6d    arrays = rec.m
-00021d60: 6170 5f72 6564 7563 6528 6172 7261 7973  ap_reduce(arrays
-00021d70: 2c20 665f 6d61 703d 6173 616e 7961 7272  , f_map=asanyarr
-00021d80: 6179 2c20 665f 7265 6475 6365 3d6c 6973  ay, f_reduce=lis
-00021d90: 7429 0a0a 2020 2020 2320 6465 7465 726d  t)..    # determ
-00021da0: 696e 6520 7468 6520 6d61 7869 6d75 6d20  ine the maximum 
-00021db0: 6469 6d65 6e73 696f 6e20 6f66 2074 6865  dimension of the
-00021dc0: 2065 6c65 6d65 6e74 730a 2020 2020 656c   elements.    el
-00021dd0: 656d 5f6e 6469 6d20 3d20 7265 632e 6d61  em_ndim = rec.ma
-00021de0: 705f 7265 6475 6365 2861 7272 6179 732c  p_reduce(arrays,
-00021df0: 2066 5f6d 6170 3d6c 616d 6264 6120 7869   f_map=lambda xi
-00021e00: 3a20 7869 2e6e 6469 6d2c 2066 5f72 6564  : xi.ndim, f_red
-00021e10: 7563 653d 6d61 7829 0a20 2020 206e 6469  uce=max).    ndi
-00021e20: 6d20 3d20 6d61 7828 6c69 7374 5f6e 6469  m = max(list_ndi
-00021e30: 6d2c 2065 6c65 6d5f 6e64 696d 290a 0a20  m, elem_ndim).. 
-00021e40: 2020 2023 2066 6972 7374 2061 7869 7320     # first axis 
-00021e50: 746f 2063 6f6e 6361 7465 6e61 7465 2061  to concatenate a
-00021e60: 6c6f 6e67 0a20 2020 2066 6972 7374 5f61  long.    first_a
-00021e70: 7869 7320 3d20 6e64 696d 202d 206c 6973  xis = ndim - lis
-00021e80: 745f 6e64 696d 0a0a 2020 2020 2320 4d61  t_ndim..    # Ma
-00021e90: 6b65 2061 6c6c 2074 6865 2065 6c65 6d65  ke all the eleme
-00021ea0: 6e74 7320 7468 6520 7361 6d65 2064 696d  nts the same dim
-00021eb0: 656e 7369 6f6e 0a20 2020 2061 7272 6179  ension.    array
-00021ec0: 7320 3d20 7265 632e 6d61 705f 7265 6475  s = rec.map_redu
-00021ed0: 6365 280a 2020 2020 2020 2020 6172 7261  ce(.        arra
-00021ee0: 7973 2c20 665f 6d61 703d 6c61 6d62 6461  ys, f_map=lambda
-00021ef0: 2078 693a 2061 746c 6561 7374 5f6e 6428   xi: atleast_nd(
-00021f00: 7869 2c20 6e64 696d 292c 2066 5f72 6564  xi, ndim), f_red
-00021f10: 7563 653d 6c69 7374 0a20 2020 2029 0a0a  uce=list.    )..
-00021f20: 2020 2020 2320 636f 6e63 6174 656e 6174      # concatenat
-00021f30: 6520 696e 6e65 726d 6f73 7420 6c69 7374  e innermost list
-00021f40: 7320 6f6e 2074 6865 2072 6967 6874 2c20  s on the right, 
-00021f50: 6f75 7465 726d 6f73 7420 6f6e 2074 6865  outermost on the
-00021f60: 206c 6566 740a 2020 2020 7265 7475 726e   left.    return
-00021f70: 2072 6563 2e6d 6170 5f72 6564 7563 6528   rec.map_reduce(
-00021f80: 0a20 2020 2020 2020 2061 7272 6179 732c  .        arrays,
-00021f90: 0a20 2020 2020 2020 2066 5f72 6564 7563  .        f_reduc
-00021fa0: 653d 6c61 6d62 6461 2078 732c 2061 7869  e=lambda xs, axi
-00021fb0: 733a 2063 6f6e 6361 7465 6e61 7465 280a  s: concatenate(.
-00021fc0: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-00021fd0: 2878 7329 2c20 6178 6973 3d61 7869 732c  (xs), axis=axis,
-00021fe0: 2061 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63   allow_unknown_c
-00021ff0: 6875 6e6b 7369 7a65 733d 616c 6c6f 775f  hunksizes=allow_
-00022000: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
-00022010: 6573 0a20 2020 2020 2020 2029 2c0a 2020  es.        ),.  
-00022020: 2020 2020 2020 665f 6b77 6172 6773 3d6c        f_kwargs=l
-00022030: 616d 6264 6120 6178 6973 3a20 6469 6374  ambda axis: dict
-00022040: 2861 7869 733d 2861 7869 7320 2b20 3129  (axis=(axis + 1)
-00022050: 292c 0a20 2020 2020 2020 2061 7869 733d  ),.        axis=
-00022060: 6669 7273 745f 6178 6973 2c0a 2020 2020  first_axis,.    
-00022070: 290a 0a0a 6465 6620 636f 6e63 6174 656e  )...def concaten
-00022080: 6174 6528 7365 712c 2061 7869 733d 302c  ate(seq, axis=0,
-00022090: 2061 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63   allow_unknown_c
-000220a0: 6875 6e6b 7369 7a65 733d 4661 6c73 6529  hunksizes=False)
-000220b0: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
-000220c0: 6e63 6174 656e 6174 6520 6172 7261 7973  ncatenate arrays
-000220d0: 2061 6c6f 6e67 2061 6e20 6578 6973 7469   along an existi
-000220e0: 6e67 2061 7869 730a 0a20 2020 2047 6976  ng axis..    Giv
-000220f0: 656e 2061 2073 6571 7565 6e63 6520 6f66  en a sequence of
-00022100: 2064 6173 6b20 4172 7261 7973 2066 6f72   dask Arrays for
-00022110: 6d20 6120 6e65 7720 6461 736b 2041 7272  m a new dask Arr
-00022120: 6179 2062 7920 7374 6163 6b69 6e67 2074  ay by stacking t
-00022130: 6865 6d0a 2020 2020 616c 6f6e 6720 616e  hem.    along an
-00022140: 2065 7869 7374 696e 6720 6469 6d65 6e73   existing dimens
-00022150: 696f 6e20 2861 7869 733d 3020 6279 2064  ion (axis=0 by d
-00022160: 6566 6175 6c74 290a 0a20 2020 2050 6172  efault)..    Par
-00022170: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00022180: 2d2d 2d2d 2d2d 0a20 2020 2073 6571 3a20  ------.    seq: 
-00022190: 6c69 7374 206f 6620 6461 736b 2e61 7272  list of dask.arr
-000221a0: 6179 730a 2020 2020 6178 6973 3a20 696e  ays.    axis: in
-000221b0: 740a 2020 2020 2020 2020 4469 6d65 6e73  t.        Dimens
-000221c0: 696f 6e20 616c 6f6e 6720 7768 6963 6820  ion along which 
-000221d0: 746f 2061 6c69 676e 2061 6c6c 206f 6620  to align all of 
-000221e0: 7468 6520 6172 7261 7973 2e20 4966 2061  the arrays. If a
-000221f0: 7869 7320 6973 204e 6f6e 652c 0a20 2020  xis is None,.   
-00022200: 2020 2020 2061 7272 6179 7320 6172 6520       arrays are 
-00022210: 666c 6174 7465 6e65 6420 6265 666f 7265  flattened before
-00022220: 2075 7365 2e0a 2020 2020 616c 6c6f 775f   use..    allow_
-00022230: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
-00022240: 6573 3a20 626f 6f6c 0a20 2020 2020 2020  es: bool.       
-00022250: 2041 6c6c 6f77 2075 6e6b 6e6f 776e 2063   Allow unknown c
-00022260: 6875 6e6b 7369 7a65 732c 2073 7563 6820  hunksizes, such 
-00022270: 6173 2063 6f6d 6520 6672 6f6d 2063 6f6e  as come from con
-00022280: 7665 7274 696e 6720 6672 6f6d 2064 6173  verting from das
-00022290: 6b0a 2020 2020 2020 2020 6461 7461 6672  k.        datafr
-000222a0: 616d 6573 2e20 2044 6173 6b2e 6172 7261  ames.  Dask.arra
-000222b0: 7920 6973 2075 6e61 626c 6520 746f 2076  y is unable to v
-000222c0: 6572 6966 7920 7468 6174 2063 6875 6e6b  erify that chunk
-000222d0: 7320 6c69 6e65 2075 702e 2020 4966 0a20  s line up.  If. 
-000222e0: 2020 2020 2020 2064 6174 6120 636f 6d65         data come
-000222f0: 7320 6672 6f6d 2064 6966 6665 7265 6e74  s from different
-00022300: 6c79 2061 6c69 676e 6564 2073 6f75 7263  ly aligned sourc
-00022310: 6573 2074 6865 6e20 7468 6973 2063 616e  es then this can
-00022320: 2063 6175 7365 0a20 2020 2020 2020 2075   cause.        u
-00022330: 6e65 7870 6563 7465 6420 7265 7375 6c74  nexpected result
-00022340: 732e 0a0a 2020 2020 4578 616d 706c 6573  s...    Examples
-00022350: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20  .    --------.. 
-00022360: 2020 2043 7265 6174 6520 736c 6963 6573     Create slices
-00022370: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
-00022380: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
-00022390: 610a 2020 2020 3e3e 3e20 696d 706f 7274  a.    >>> import
-000223a0: 206e 756d 7079 2061 7320 6e70 0a0a 2020   numpy as np..  
-000223b0: 2020 3e3e 3e20 6461 7461 203d 205b 6461    >>> data = [da
-000223c0: 2e66 726f 6d5f 6172 7261 7928 6e70 2e6f  .from_array(np.o
-000223d0: 6e65 7328 2834 2c20 3429 292c 2063 6875  nes((4, 4)), chu
-000223e0: 6e6b 733d 2832 2c20 3229 290a 2020 2020  nks=(2, 2)).    
-000223f0: 2e2e 2e20 2020 2020 2020 2020 2066 6f72  ...          for
-00022400: 2069 2069 6e20 7261 6e67 6528 3329 5d0a   i in range(3)].
-00022410: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
-00022420: 636f 6e63 6174 656e 6174 6528 6461 7461  concatenate(data
-00022430: 2c20 6178 6973 3d30 290a 2020 2020 3e3e  , axis=0).    >>
-00022440: 3e20 782e 7368 6170 650a 2020 2020 2831  > x.shape.    (1
-00022450: 322c 2034 290a 0a20 2020 203e 3e3e 2064  2, 4)..    >>> d
-00022460: 612e 636f 6e63 6174 656e 6174 6528 6461  a.concatenate(da
-00022470: 7461 2c20 6178 6973 3d31 292e 7368 6170  ta, axis=1).shap
-00022480: 650a 2020 2020 2834 2c20 3132 290a 0a20  e.    (4, 12).. 
-00022490: 2020 2052 6573 756c 7420 6973 2061 206e     Result is a n
-000224a0: 6577 2064 6173 6b20 4172 7261 790a 0a20  ew dask Array.. 
-000224b0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
-000224c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 7461  --------.    sta
-000224d0: 636b 0a20 2020 2022 2222 0a20 2020 2066  ck.    """.    f
-000224e0: 726f 6d20 6461 736b 2e61 7272 6179 2069  rom dask.array i
-000224f0: 6d70 6f72 7420 7772 6170 0a0a 2020 2020  mport wrap..    
-00022500: 7365 7120 3d20 5b61 7361 7272 6179 2861  seq = [asarray(a
-00022510: 2c20 616c 6c6f 775f 756e 6b6e 6f77 6e5f  , allow_unknown_
-00022520: 6368 756e 6b73 697a 6573 3d61 6c6c 6f77  chunksizes=allow
-00022530: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
-00022540: 7a65 7329 2066 6f72 2061 2069 6e20 7365  zes) for a in se
-00022550: 715d 0a0a 2020 2020 6966 206e 6f74 2073  q]..    if not s
-00022560: 6571 3a0a 2020 2020 2020 2020 7261 6973  eq:.        rais
-00022570: 6520 5661 6c75 6545 7272 6f72 2822 4e65  e ValueError("Ne
-00022580: 6564 2061 7272 6179 2873 2920 746f 2063  ed array(s) to c
-00022590: 6f6e 6361 7465 6e61 7465 2229 0a0a 2020  oncatenate")..  
-000225a0: 2020 6966 2061 7869 7320 6973 204e 6f6e    if axis is Non
-000225b0: 653a 0a20 2020 2020 2020 2073 6571 203d  e:.        seq =
-000225c0: 205b 612e 666c 6174 7465 6e28 2920 666f   [a.flatten() fo
-000225d0: 7220 6120 696e 2073 6571 5d0a 2020 2020  r a in seq].    
-000225e0: 2020 2020 6178 6973 203d 2030 0a0a 2020      axis = 0..  
-000225f0: 2020 7365 715f 6d65 7461 7320 3d20 5b6d    seq_metas = [m
-00022600: 6574 615f 6672 6f6d 5f61 7272 6179 2873  eta_from_array(s
-00022610: 2920 666f 7220 7320 696e 2073 6571 5d0a  ) for s in seq].
-00022620: 2020 2020 5f63 6f6e 6361 7465 6e61 7465      _concatenate
-00022630: 203d 2063 6f6e 6361 7465 6e61 7465 5f6c   = concatenate_l
-00022640: 6f6f 6b75 702e 6469 7370 6174 6368 280a  ookup.dispatch(.
-00022650: 2020 2020 2020 2020 7479 7065 286d 6178          type(max
-00022660: 2873 6571 5f6d 6574 6173 2c20 6b65 793d  (seq_metas, key=
-00022670: 6c61 6d62 6461 2078 3a20 6765 7461 7474  lambda x: getatt
-00022680: 7228 782c 2022 5f5f 6172 7261 795f 7072  r(x, "__array_pr
-00022690: 696f 7269 7479 5f5f 222c 2030 2929 290a  iority__", 0))).
-000226a0: 2020 2020 290a 2020 2020 6d65 7461 203d      ).    meta =
-000226b0: 205f 636f 6e63 6174 656e 6174 6528 7365   _concatenate(se
-000226c0: 715f 6d65 7461 732c 2061 7869 733d 6178  q_metas, axis=ax
-000226d0: 6973 290a 0a20 2020 2023 2050 726f 6d6f  is)..    # Promo
-000226e0: 7465 2074 7970 6573 2074 6f20 6d61 7463  te types to matc
-000226f0: 6820 6d65 7461 0a20 2020 2073 6571 203d  h meta.    seq =
-00022700: 205b 612e 6173 7479 7065 286d 6574 612e   [a.astype(meta.
-00022710: 6474 7970 6529 2066 6f72 2061 2069 6e20  dtype) for a in 
-00022720: 7365 715d 0a0a 2020 2020 2320 4669 6e64  seq]..    # Find
-00022730: 206f 7574 7075 7420 6172 7261 7920 7368   output array sh
-00022740: 6170 650a 2020 2020 6e64 696d 203d 206c  ape.    ndim = l
-00022750: 656e 2873 6571 5b30 5d2e 7368 6170 6529  en(seq[0].shape)
-00022760: 0a20 2020 2073 6861 7065 203d 2074 7570  .    shape = tup
-00022770: 6c65 280a 2020 2020 2020 2020 7375 6d28  le(.        sum(
-00022780: 612e 7368 6170 655b 695d 2066 6f72 2061  a.shape[i] for a
-00022790: 2069 6e20 7365 7129 2069 6620 6920 3d3d   in seq) if i ==
-000227a0: 2061 7869 7320 656c 7365 2073 6571 5b30   axis else seq[0
-000227b0: 5d2e 7368 6170 655b 695d 0a20 2020 2020  ].shape[i].     
-000227c0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000227d0: 6528 6e64 696d 290a 2020 2020 290a 0a20  e(ndim).    ).. 
-000227e0: 2020 2023 2044 726f 7020 656d 7074 7920     # Drop empty 
-000227f0: 6172 7261 7973 0a20 2020 2073 6571 3220  arrays.    seq2 
-00022800: 3d20 5b61 2066 6f72 2061 2069 6e20 7365  = [a for a in se
-00022810: 7120 6966 2061 2e73 697a 655d 0a20 2020  q if a.size].   
-00022820: 2069 6620 6e6f 7420 7365 7132 3a0a 2020   if not seq2:.  
-00022830: 2020 2020 2020 7365 7132 203d 2073 6571        seq2 = seq
-00022840: 0a0a 2020 2020 6966 2061 7869 7320 3c20  ..    if axis < 
-00022850: 303a 0a20 2020 2020 2020 2061 7869 7320  0:.        axis 
-00022860: 3d20 6e64 696d 202b 2061 7869 730a 2020  = ndim + axis.  
-00022870: 2020 6966 2061 7869 7320 3e3d 206e 6469    if axis >= ndi
-00022880: 6d3a 0a20 2020 2020 2020 206d 7367 203d  m:.        msg =
-00022890: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
-000228a0: 4178 6973 206d 7573 7420 6265 206c 6573  Axis must be les
-000228b0: 7320 7468 616e 2074 6861 6e20 6e75 6d62  s than than numb
-000228c0: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
-000228d0: 220a 2020 2020 2020 2020 2020 2020 225c  ".            "\
-000228e0: 6e44 6174 6120 6861 7320 2564 2064 696d  nData has %d dim
-000228f0: 656e 7369 6f6e 732c 2062 7574 2067 6f74  ensions, but got
-00022900: 2061 7869 733d 2564 220a 2020 2020 2020   axis=%d".      
-00022910: 2020 290a 2020 2020 2020 2020 7261 6973    ).        rais
-00022920: 6520 5661 6c75 6545 7272 6f72 286d 7367  e ValueError(msg
-00022930: 2025 2028 6e64 696d 2c20 6178 6973 2929   % (ndim, axis))
-00022940: 0a0a 2020 2020 6e20 3d20 6c65 6e28 7365  ..    n = len(se
-00022950: 7132 290a 2020 2020 6966 206e 203d 3d20  q2).    if n == 
-00022960: 303a 0a20 2020 2020 2020 2074 7279 3a0a  0:.        try:.
-00022970: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00022980: 726e 2077 7261 702e 656d 7074 795f 6c69  rn wrap.empty_li
-00022990: 6b65 286d 6574 612c 2073 6861 7065 3d73  ke(meta, shape=s
-000229a0: 6861 7065 2c20 6368 756e 6b73 3d73 6861  hape, chunks=sha
-000229b0: 7065 2c20 6474 7970 653d 6d65 7461 2e64  pe, dtype=meta.d
-000229c0: 7479 7065 290a 2020 2020 2020 2020 6578  type).        ex
-000229d0: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
-000229e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000229f0: 726e 2077 7261 702e 656d 7074 7928 7368  rn wrap.empty(sh
-00022a00: 6170 652c 2063 6875 6e6b 733d 7368 6170  ape, chunks=shap
-00022a10: 652c 2064 7479 7065 3d6d 6574 612e 6474  e, dtype=meta.dt
-00022a20: 7970 6529 0a20 2020 2065 6c69 6620 6e20  ype).    elif n 
-00022a30: 3d3d 2031 3a0a 2020 2020 2020 2020 7265  == 1:.        re
-00022a40: 7475 726e 2073 6571 325b 305d 0a0a 2020  turn seq2[0]..  
-00022a50: 2020 6966 206e 6f74 2061 6c6c 6f77 5f75    if not allow_u
-00022a60: 6e6b 6e6f 776e 5f63 6875 6e6b 7369 7a65  nknown_chunksize
-00022a70: 7320 616e 6420 6e6f 7420 616c 6c28 0a20  s and not all(. 
-00022a80: 2020 2020 2020 2069 203d 3d20 6178 6973         i == axis
-00022a90: 206f 7220 616c 6c28 782e 7368 6170 655b   or all(x.shape[
-00022aa0: 695d 203d 3d20 7365 7132 5b30 5d2e 7368  i] == seq2[0].sh
-00022ab0: 6170 655b 695d 2066 6f72 2078 2069 6e20  ape[i] for x in 
-00022ac0: 7365 7132 290a 2020 2020 2020 2020 666f  seq2).        fo
-00022ad0: 7220 6920 696e 2072 616e 6765 286e 6469  r i in range(ndi
-00022ae0: 6d29 0a20 2020 2029 3a0a 2020 2020 2020  m).    ):.      
-00022af0: 2020 6966 2061 6e79 286d 6170 286e 702e    if any(map(np.
-00022b00: 6973 6e61 6e2c 2073 6571 325b 305d 2e73  isnan, seq2[0].s
-00022b10: 6861 7065 2929 3a0a 2020 2020 2020 2020  hape)):.        
-00022b20: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00022b30: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00022b40: 2020 2020 2020 2254 7269 6564 2074 6f20        "Tried to 
-00022b50: 636f 6e63 6174 656e 6174 6520 6172 7261  concatenate arra
-00022b60: 7973 2077 6974 6820 756e 6b6e 6f77 6e22  ys with unknown"
-00022b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b80: 2022 2073 6861 7065 2025 732e 5c6e 5c6e   " shape %s.\n\n
-00022b90: 5477 6f20 736f 6c75 7469 6f6e 733a 5c6e  Two solutions:\n
-00022ba0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022bb0: 2020 2220 2031 2e20 466f 7263 6520 636f    "  1. Force co
-00022bc0: 6e63 6174 656e 6174 696f 6e20 7061 7373  ncatenation pass
-00022bd0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022be0: 2020 2220 616c 6c6f 775f 756e 6b6e 6f77    " allow_unknow
-00022bf0: 6e5f 6368 756e 6b73 697a 6573 3d54 7275  n_chunksizes=Tru
-00022c00: 652e 5c6e 220a 2020 2020 2020 2020 2020  e.\n".          
-00022c10: 2020 2020 2020 2220 2032 2e20 436f 6d70        "  2. Comp
-00022c20: 7574 6520 7368 6170 6573 2077 6974 6820  ute shapes with 
-00022c30: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00022c40: 2020 225b 782e 636f 6d70 7574 655f 6368    "[x.compute_ch
-00022c50: 756e 6b5f 7369 7a65 7328 2920 666f 7220  unk_sizes() for 
-00022c60: 7820 696e 2073 6571 5d22 2025 2073 7472  x in seq]" % str
-00022c70: 2873 6571 325b 305d 2e73 6861 7065 290a  (seq2[0].shape).
-00022c80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00022c90: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00022ca0: 6545 7272 6f72 2822 5368 6170 6573 2064  eError("Shapes d
-00022cb0: 6f20 6e6f 7420 616c 6967 6e3a 2025 7322  o not align: %s"
-00022cc0: 2c20 5b78 2e73 6861 7065 2066 6f72 2078  , [x.shape for x
-00022cd0: 2069 6e20 7365 7132 5d29 0a0a 2020 2020   in seq2])..    
-00022ce0: 696e 6473 203d 205b 6c69 7374 2872 616e  inds = [list(ran
-00022cf0: 6765 286e 6469 6d29 2920 666f 7220 6920  ge(ndim)) for i 
-00022d00: 696e 2072 616e 6765 286e 295d 0a20 2020  in range(n)].   
-00022d10: 2066 6f72 2069 2c20 696e 6420 696e 2065   for i, ind in e
-00022d20: 6e75 6d65 7261 7465 2869 6e64 7329 3a0a  numerate(inds):.
-00022d30: 2020 2020 2020 2020 696e 645b 6178 6973          ind[axis
-00022d40: 5d20 3d20 2d28 6920 2b20 3129 0a0a 2020  ] = -(i + 1)..  
-00022d50: 2020 7563 5f61 7267 7320 3d20 6c69 7374    uc_args = list
-00022d60: 2863 6f6e 6361 7428 7a69 7028 7365 7132  (concat(zip(seq2
-00022d70: 2c20 696e 6473 2929 290a 2020 2020 5f2c  , inds))).    _,
-00022d80: 2073 6571 3220 3d20 756e 6966 795f 6368   seq2 = unify_ch
-00022d90: 756e 6b73 282a 7563 5f61 7267 732c 2077  unks(*uc_args, w
-00022da0: 6172 6e3d 4661 6c73 6529 0a0a 2020 2020  arn=False)..    
-00022db0: 6264 7320 3d20 5b61 2e63 6875 6e6b 7320  bds = [a.chunks 
-00022dc0: 666f 7220 6120 696e 2073 6571 325d 0a0a  for a in seq2]..
-00022dd0: 2020 2020 6368 756e 6b73 203d 2028 0a20      chunks = (. 
-00022de0: 2020 2020 2020 2073 6571 325b 305d 2e63         seq2[0].c
-00022df0: 6875 6e6b 735b 3a61 7869 735d 0a20 2020  hunks[:axis].   
-00022e00: 2020 2020 202b 2028 7375 6d28 2862 645b       + (sum((bd[
-00022e10: 6178 6973 5d20 666f 7220 6264 2069 6e20  axis] for bd in 
-00022e20: 6264 7329 2c20 2829 292c 290a 2020 2020  bds), ()),).    
-00022e30: 2020 2020 2b20 7365 7132 5b30 5d2e 6368      + seq2[0].ch
-00022e40: 756e 6b73 5b61 7869 7320 2b20 3120 3a5d  unks[axis + 1 :]
-00022e50: 0a20 2020 2029 0a0a 2020 2020 6375 6d5f  .    )..    cum_
-00022e60: 6469 6d73 203d 205b 305d 202b 206c 6973  dims = [0] + lis
-00022e70: 7428 6163 6375 6d75 6c61 7465 2861 6464  t(accumulate(add
-00022e80: 2c20 5b6c 656e 2861 2e63 6875 6e6b 735b  , [len(a.chunks[
-00022e90: 6178 6973 5d29 2066 6f72 2061 2069 6e20  axis]) for a in 
-00022ea0: 7365 7132 5d29 290a 0a20 2020 206e 616d  seq2]))..    nam
-00022eb0: 6573 203d 205b 612e 6e61 6d65 2066 6f72  es = [a.name for
-00022ec0: 2061 2069 6e20 7365 7132 5d0a 0a20 2020   a in seq2]..   
-00022ed0: 206e 616d 6520 3d20 2263 6f6e 6361 7465   name = "concate
-00022ee0: 6e61 7465 2d22 202b 2074 6f6b 656e 697a  nate-" + tokeniz
-00022ef0: 6528 6e61 6d65 732c 2061 7869 7329 0a20  e(names, axis). 
-00022f00: 2020 206b 6579 7320 3d20 6c69 7374 2870     keys = list(p
-00022f10: 726f 6475 6374 285b 6e61 6d65 5d2c 202a  roduct([name], *
-00022f20: 5b72 616e 6765 286c 656e 2862 6429 2920  [range(len(bd)) 
-00022f30: 666f 7220 6264 2069 6e20 6368 756e 6b73  for bd in chunks
-00022f40: 5d29 290a 0a20 2020 2076 616c 7565 7320  ]))..    values 
-00022f50: 3d20 5b0a 2020 2020 2020 2020 286e 616d  = [.        (nam
-00022f60: 6573 5b62 6973 6563 7428 6375 6d5f 6469  es[bisect(cum_di
-00022f70: 6d73 2c20 6b65 795b 6178 6973 202b 2031  ms, key[axis + 1
-00022f80: 5d29 202d 2031 5d2c 290a 2020 2020 2020  ]) - 1],).      
-00022f90: 2020 2b20 6b65 795b 3120 3a20 6178 6973    + key[1 : axis
-00022fa0: 202b 2031 5d0a 2020 2020 2020 2020 2b20   + 1].        + 
-00022fb0: 286b 6579 5b61 7869 7320 2b20 315d 202d  (key[axis + 1] -
-00022fc0: 2063 756d 5f64 696d 735b 6269 7365 6374   cum_dims[bisect
-00022fd0: 2863 756d 5f64 696d 732c 206b 6579 5b61  (cum_dims, key[a
-00022fe0: 7869 7320 2b20 315d 2920 2d20 315d 2c29  xis + 1]) - 1],)
-00022ff0: 0a20 2020 2020 2020 202b 206b 6579 5b61  .        + key[a
-00023000: 7869 7320 2b20 3220 3a5d 0a20 2020 2020  xis + 2 :].     
-00023010: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
-00023020: 7973 0a20 2020 205d 0a0a 2020 2020 6473  ys.    ]..    ds
-00023030: 6b20 3d20 6469 6374 287a 6970 286b 6579  k = dict(zip(key
-00023040: 732c 2076 616c 7565 7329 290a 2020 2020  s, values)).    
-00023050: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
-00023060: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
-00023070: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
-00023080: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
-00023090: 7365 7132 290a 0a20 2020 2072 6574 7572  seq2)..    retur
-000230a0: 6e20 4172 7261 7928 6772 6170 682c 206e  n Array(graph, n
-000230b0: 616d 652c 2063 6875 6e6b 732c 206d 6574  ame, chunks, met
-000230c0: 613d 6d65 7461 290a 0a0a 6465 6620 6c6f  a=meta)...def lo
-000230d0: 6164 5f73 746f 7265 5f63 6875 6e6b 280a  ad_store_chunk(.
-000230e0: 2020 2020 783a 2041 6e79 2c0a 2020 2020      x: Any,.    
-000230f0: 6f75 743a 2041 6e79 2c0a 2020 2020 696e  out: Any,.    in
-00023100: 6465 783a 2073 6c69 6365 2c0a 2020 2020  dex: slice,.    
-00023110: 6c6f 636b 3a20 416e 792c 0a20 2020 2072  lock: Any,.    r
-00023120: 6574 7572 6e5f 7374 6f72 6564 3a20 626f  eturn_stored: bo
-00023130: 6f6c 2c0a 2020 2020 6c6f 6164 5f73 746f  ol,.    load_sto
-00023140: 7265 643a 2062 6f6f 6c2c 0a29 3a0a 2020  red: bool,.):.  
-00023150: 2020 2222 220a 2020 2020 4120 6675 6e63    """.    A func
-00023160: 7469 6f6e 2069 6e73 6572 7465 6420 696e  tion inserted in
-00023170: 2061 2044 6173 6b20 6772 6170 6820 666f   a Dask graph fo
-00023180: 7220 7374 6f72 696e 6720 6120 6368 756e  r storing a chun
-00023190: 6b2e 0a0a 2020 2020 5061 7261 6d65 7465  k...    Paramete
-000231a0: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-000231b0: 2d0a 2020 2020 783a 2061 7272 6179 2d6c  -.    x: array-l
-000231c0: 696b 650a 2020 2020 2020 2020 416e 2061  ike.        An a
-000231d0: 7272 6179 2028 706f 7465 6e74 6961 6c6c  rray (potentiall
-000231e0: 7920 6120 4e75 6d50 7920 6f6e 6529 0a20  y a NumPy one). 
-000231f0: 2020 206f 7574 3a20 6172 7261 792d 6c69     out: array-li
-00023200: 6b65 0a20 2020 2020 2020 2057 6865 7265  ke.        Where
-00023210: 2074 6f20 7374 6f72 6520 7265 7375 6c74   to store result
-00023220: 732e 0a20 2020 2069 6e64 6578 3a20 736c  s..    index: sl
-00023230: 6963 652d 6c69 6b65 0a20 2020 2020 2020  ice-like.       
-00023240: 2057 6865 7265 2074 6f20 7374 6f72 6520   Where to store 
-00023250: 7265 7375 6c74 2066 726f 6d20 6060 7860  result from ``x`
-00023260: 6020 696e 2060 606f 7574 6060 2e0a 2020  ` in ``out``..  
-00023270: 2020 6c6f 636b 3a20 4c6f 636b 2d6c 696b    lock: Lock-lik
-00023280: 6520 6f72 2046 616c 7365 0a20 2020 2020  e or False.     
-00023290: 2020 204c 6f63 6b20 746f 2075 7365 2062     Lock to use b
-000232a0: 6566 6f72 6520 7772 6974 696e 6720 746f  efore writing to
-000232b0: 2060 606f 7574 6060 2e0a 2020 2020 7265   ``out``..    re
-000232c0: 7475 726e 5f73 746f 7265 643a 2062 6f6f  turn_stored: boo
-000232d0: 6c0a 2020 2020 2020 2020 5768 6574 6865  l.        Whethe
-000232e0: 7220 746f 2072 6574 7572 6e20 6060 6f75  r to return ``ou
-000232f0: 7460 602e 0a20 2020 206c 6f61 645f 7374  t``..    load_st
-00023300: 6f72 6564 3a20 626f 6f6c 0a20 2020 2020  ored: bool.     
-00023310: 2020 2057 6865 7468 6572 2074 6f20 7265     Whether to re
-00023320: 7475 726e 2074 6865 2061 7272 6179 2073  turn the array s
-00023330: 746f 7265 6420 696e 2060 606f 7574 6060  tored in ``out``
-00023340: 2e0a 2020 2020 2020 2020 4967 6e6f 7265  ..        Ignore
-00023350: 6420 6966 2060 6072 6574 7572 6e5f 7374  d if ``return_st
-00023360: 6f72 6564 6060 2069 7320 6e6f 7420 6060  ored`` is not ``
-00023370: 5472 7565 6060 2e0a 0a20 2020 2052 6574  True``...    Ret
-00023380: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
-00023390: 0a0a 2020 2020 4966 2072 6574 7572 6e5f  ..    If return_
-000233a0: 7374 6f72 6564 3d54 7275 6520 616e 6420  stored=True and 
-000233b0: 6c6f 6164 5f73 746f 7265 643d 4661 6c73  load_stored=Fals
-000233c0: 650a 2020 2020 2020 2020 6f75 740a 2020  e.        out.  
-000233d0: 2020 4966 2072 6574 7572 6e5f 7374 6f72    If return_stor
-000233e0: 6564 3d54 7275 6520 616e 6420 6c6f 6164  ed=True and load
-000233f0: 5f73 746f 7265 643d 5472 7565 0a20 2020  _stored=True.   
-00023400: 2020 2020 206f 7574 5b69 6e64 6578 5d0a       out[index].
-00023410: 2020 2020 4966 2072 6574 7572 6e5f 7374      If return_st
-00023420: 6f72 6564 3d46 616c 7365 2061 6e64 2063  ored=False and c
-00023430: 6f6d 7075 7465 3d46 616c 7365 0a20 2020  ompute=False.   
-00023440: 2020 2020 204e 6f6e 650a 0a20 2020 2045       None..    E
-00023450: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-00023460: 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20 6120  ----..    >>> a 
-00023470: 3d20 6e70 2e6f 6e65 7328 2835 2c20 3629  = np.ones((5, 6)
-00023480: 290a 2020 2020 3e3e 3e20 6220 3d20 6e70  ).    >>> b = np
-00023490: 2e65 6d70 7479 2861 2e73 6861 7065 290a  .empty(a.shape).
-000234a0: 2020 2020 3e3e 3e20 6c6f 6164 5f73 746f      >>> load_sto
-000234b0: 7265 5f63 6875 6e6b 2861 2c20 622c 2028  re_chunk(a, b, (
-000234c0: 736c 6963 6528 4e6f 6e65 292c 2073 6c69  slice(None), sli
-000234d0: 6365 284e 6f6e 6529 292c 2046 616c 7365  ce(None)), False
-000234e0: 2c20 4661 6c73 652c 2046 616c 7365 290a  , False, False).
-000234f0: 2020 2020 2222 220a 2020 2020 6966 206c      """.    if l
-00023500: 6f63 6b3a 0a20 2020 2020 2020 206c 6f63  ock:.        loc
-00023510: 6b2e 6163 7175 6972 6528 290a 2020 2020  k.acquire().    
-00023520: 7472 793a 0a20 2020 2020 2020 2069 6620  try:.        if 
-00023530: 7820 6973 206e 6f74 204e 6f6e 653a 0a20  x is not None:. 
-00023540: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00023550: 5f61 7272 6179 6c69 6b65 2878 293a 0a20  _arraylike(x):. 
-00023560: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00023570: 7574 5b69 6e64 6578 5d20 3d20 780a 2020  ut[index] = x.  
-00023580: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00023590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000235a0: 6f75 745b 696e 6465 785d 203d 206e 702e  out[index] = np.
-000235b0: 6173 616e 7961 7272 6179 2878 290a 0a20  asanyarray(x).. 
-000235c0: 2020 2020 2020 2069 6620 7265 7475 726e         if return
-000235d0: 5f73 746f 7265 6420 616e 6420 6c6f 6164  _stored and load
-000235e0: 5f73 746f 7265 643a 0a20 2020 2020 2020  _stored:.       
-000235f0: 2020 2020 2072 6574 7572 6e20 6f75 745b       return out[
-00023600: 696e 6465 785d 0a20 2020 2020 2020 2065  index].        e
-00023610: 6c69 6620 7265 7475 726e 5f73 746f 7265  lif return_store
-00023620: 6420 616e 6420 6e6f 7420 6c6f 6164 5f73  d and not load_s
-00023630: 746f 7265 643a 0a20 2020 2020 2020 2020  tored:.         
-00023640: 2020 2072 6574 7572 6e20 6f75 740a 2020     return out.  
-00023650: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00023660: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00023670: 6f6e 650a 2020 2020 6669 6e61 6c6c 793a  one.    finally:
-00023680: 0a20 2020 2020 2020 2069 6620 6c6f 636b  .        if lock
-00023690: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-000236a0: 636b 2e72 656c 6561 7365 2829 0a0a 0a64  ck.release()...d
-000236b0: 6566 2073 746f 7265 5f63 6875 6e6b 280a  ef store_chunk(.
-000236c0: 2020 2020 783a 2041 7272 6179 4c69 6b65      x: ArrayLike
-000236d0: 2c20 6f75 743a 2041 7272 6179 4c69 6b65  , out: ArrayLike
-000236e0: 2c20 696e 6465 783a 2073 6c69 6365 2c20  , index: slice, 
-000236f0: 6c6f 636b 3a20 416e 792c 2072 6574 7572  lock: Any, retur
-00023700: 6e5f 7374 6f72 6564 3a20 626f 6f6c 0a29  n_stored: bool.)
-00023710: 3a0a 2020 2020 7265 7475 726e 206c 6f61  :.    return loa
-00023720: 645f 7374 6f72 655f 6368 756e 6b28 782c  d_store_chunk(x,
-00023730: 206f 7574 2c20 696e 6465 782c 206c 6f63   out, index, loc
-00023740: 6b2c 2072 6574 7572 6e5f 7374 6f72 6564  k, return_stored
-00023750: 2c20 4661 6c73 6529 0a0a 0a41 203d 2054  , False)...A = T
-00023760: 7970 6556 6172 2822 4122 2c20 626f 756e  ypeVar("A", boun
-00023770: 643d 4172 7261 794c 696b 6529 0a0a 0a64  d=ArrayLike)...d
-00023780: 6566 206c 6f61 645f 6368 756e 6b28 6f75  ef load_chunk(ou
-00023790: 743a 2041 2c20 696e 6465 783a 2073 6c69  t: A, index: sli
-000237a0: 6365 2c20 6c6f 636b 3a20 416e 7929 202d  ce, lock: Any) -
-000237b0: 3e20 413a 0a20 2020 2072 6574 7572 6e20  > A:.    return 
-000237c0: 6c6f 6164 5f73 746f 7265 5f63 6875 6e6b  load_store_chunk
-000237d0: 284e 6f6e 652c 206f 7574 2c20 696e 6465  (None, out, inde
-000237e0: 782c 206c 6f63 6b2c 2054 7275 652c 2054  x, lock, True, T
-000237f0: 7275 6529 0a0a 0a64 6566 2069 6e73 6572  rue)...def inser
-00023800: 745f 746f 5f6f 6f63 280a 2020 2020 6b65  t_to_ooc(.    ke
-00023810: 7973 3a20 6c69 7374 2c0a 2020 2020 6368  ys: list,.    ch
-00023820: 756e 6b73 3a20 7475 706c 655b 7475 706c  unks: tuple[tupl
-00023830: 655b 696e 742c 202e 2e2e 5d2c 202e 2e2e  e[int, ...], ...
-00023840: 5d2c 0a20 2020 206f 7574 3a20 4172 7261  ],.    out: Arra
-00023850: 794c 696b 652c 0a20 2020 206e 616d 653a  yLike,.    name:
-00023860: 2073 7472 2c0a 2020 2020 2a2c 0a20 2020   str,.    *,.   
-00023870: 206c 6f63 6b3a 204c 6f63 6b20 7c20 626f   lock: Lock | bo
-00023880: 6f6c 203d 2054 7275 652c 0a20 2020 2072  ol = True,.    r
-00023890: 6567 696f 6e3a 2074 7570 6c65 5b73 6c69  egion: tuple[sli
-000238a0: 6365 2c20 2e2e 2e5d 207c 2073 6c69 6365  ce, ...] | slice
-000238b0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-000238c0: 2020 2020 7265 7475 726e 5f73 746f 7265      return_store
-000238d0: 643a 2062 6f6f 6c20 3d20 4661 6c73 652c  d: bool = False,
-000238e0: 0a20 2020 206c 6f61 645f 7374 6f72 6564  .    load_stored
-000238f0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00023900: 2920 2d3e 2064 6963 743a 0a20 2020 2022  ) -> dict:.    "
-00023910: 2222 0a20 2020 2043 7265 6174 6573 2061  "".    Creates a
-00023920: 2044 6173 6b20 6772 6170 6820 666f 7220   Dask graph for 
-00023930: 7374 6f72 696e 6720 6368 756e 6b73 2066  storing chunks f
-00023940: 726f 6d20 6060 6172 7260 6020 696e 2060  rom ``arr`` in `
-00023950: 606f 7574 6060 2e0a 0a20 2020 2050 6172  `out``...    Par
-00023960: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00023970: 2d2d 2d2d 2d2d 0a20 2020 206b 6579 733a  ------.    keys:
-00023980: 206c 6973 740a 2020 2020 2020 2020 4461   list.        Da
-00023990: 736b 206b 6579 7320 6f66 2074 6865 2069  sk keys of the i
-000239a0: 6e70 7574 2061 7272 6179 0a20 2020 2063  nput array.    c
-000239b0: 6875 6e6b 733a 2074 7570 6c65 0a20 2020  hunks: tuple.   
-000239c0: 2020 2020 2044 6173 6b20 6368 756e 6b73       Dask chunks
-000239d0: 206f 6620 7468 6520 696e 7075 7420 6172   of the input ar
-000239e0: 7261 790a 2020 2020 6f75 743a 2061 7272  ray.    out: arr
-000239f0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
-00023a00: 5768 6572 6520 746f 2073 746f 7265 2072  Where to store r
-00023a10: 6573 756c 7473 2074 6f0a 2020 2020 6e61  esults to.    na
-00023a20: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
-00023a30: 4669 7273 7420 656c 656d 656e 7420 6f66  First element of
-00023a40: 2064 6173 6b20 6b65 7973 0a20 2020 206c   dask keys.    l
-00023a50: 6f63 6b3a 204c 6f63 6b2d 6c69 6b65 206f  ock: Lock-like o
-00023a60: 7220 626f 6f6c 2c20 6f70 7469 6f6e 616c  r bool, optional
-00023a70: 0a20 2020 2020 2020 2057 6865 7468 6572  .        Whether
-00023a80: 2074 6f20 6c6f 636b 206f 7220 7769 7468   to lock or with
-00023a90: 2077 6861 7420 2864 6566 6175 6c74 2069   what (default i
-00023aa0: 7320 6060 5472 7565 6060 2c0a 2020 2020  s ``True``,.    
-00023ab0: 2020 2020 7768 6963 6820 6d65 616e 7320      which means 
-00023ac0: 6120 3a63 6c61 7373 3a60 7468 7265 6164  a :class:`thread
-00023ad0: 696e 672e 4c6f 636b 6020 696e 7374 616e  ing.Lock` instan
-00023ae0: 6365 292e 0a20 2020 2072 6567 696f 6e3a  ce)..    region:
-00023af0: 2073 6c69 6365 2d6c 696b 652c 206f 7074   slice-like, opt
-00023b00: 696f 6e61 6c0a 2020 2020 2020 2020 5768  ional.        Wh
-00023b10: 6572 6520 696e 2060 606f 7574 6060 2074  ere in ``out`` t
-00023b20: 6f20 7374 6f72 6520 6060 6172 7260 6027  o store ``arr``'
-00023b30: 7320 7265 7375 6c74 730a 2020 2020 2020  s results.      
-00023b40: 2020 2864 6566 6175 6c74 2069 7320 6060    (default is ``
-00023b50: 4e6f 6e65 6060 2c20 6d65 616e 696e 6720  None``, meaning 
-00023b60: 616c 6c20 6f66 2060 606f 7574 6060 292e  all of ``out``).
-00023b70: 0a20 2020 2072 6574 7572 6e5f 7374 6f72  .    return_stor
-00023b80: 6564 3a20 626f 6f6c 2c20 6f70 7469 6f6e  ed: bool, option
-00023b90: 616c 0a20 2020 2020 2020 2057 6865 7468  al.        Wheth
-00023ba0: 6572 2074 6f20 7265 7475 726e 2060 606f  er to return ``o
-00023bb0: 7574 6060 0a20 2020 2020 2020 2028 6465  ut``.        (de
-00023bc0: 6661 756c 7420 6973 2060 6046 616c 7365  fault is ``False
-00023bd0: 6060 2c20 6d65 616e 696e 6720 6060 4e6f  ``, meaning ``No
-00023be0: 6e65 6060 2069 7320 7265 7475 726e 6564  ne`` is returned
-00023bf0: 292e 0a20 2020 206c 6f61 645f 7374 6f72  )..    load_stor
-00023c00: 6564 3a20 626f 6f6c 2c20 6f70 7469 6f6e  ed: bool, option
-00023c10: 616c 0a20 2020 2020 2020 2057 6865 7468  al.        Wheth
-00023c20: 6572 2074 6f20 6861 6e64 6c69 6e67 206c  er to handling l
-00023c30: 6f61 6469 6e67 2066 726f 6d20 6060 6f75  oading from ``ou
-00023c40: 7460 6020 6174 2074 6865 2073 616d 6520  t`` at the same 
-00023c50: 7469 6d65 2e0a 2020 2020 2020 2020 4967  time..        Ig
-00023c60: 6e6f 7265 6420 6966 2060 6072 6574 7572  nored if ``retur
-00023c70: 6e5f 7374 6f72 6564 6060 2069 7320 6e6f  n_stored`` is no
-00023c80: 7420 6060 5472 7565 6060 2e0a 2020 2020  t ``True``..    
-00023c90: 2020 2020 2864 6566 6175 6c74 2069 7320      (default is 
-00023ca0: 6060 4661 6c73 6560 602c 206d 6561 6e69  ``False``, meani
-00023cb0: 6e67 2064 6566 6572 2074 6f20 6060 7265  ng defer to ``re
-00023cc0: 7475 726e 5f73 746f 7265 6460 6029 2e0a  turn_stored``)..
-00023cd0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
-00023ce0: 202d 2d2d 2d2d 2d2d 0a20 2020 2064 6173   -------.    das
-00023cf0: 6b20 6772 6170 6820 6f66 2073 746f 7265  k graph of store
-00023d00: 206f 7065 7261 7469 6f6e 0a0a 2020 2020   operation..    
-00023d10: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-00023d20: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 696d  -----.    >>> im
-00023d30: 706f 7274 2064 6173 6b2e 6172 7261 7920  port dask.array 
-00023d40: 6173 2064 610a 2020 2020 3e3e 3e20 6420  as da.    >>> d 
-00023d50: 3d20 6461 2e6f 6e65 7328 2835 2c20 3629  = da.ones((5, 6)
-00023d60: 2c20 6368 756e 6b73 3d28 322c 2033 2929  , chunks=(2, 3))
-00023d70: 0a20 2020 203e 3e3e 2061 203d 206e 702e  .    >>> a = np.
-00023d80: 656d 7074 7928 642e 7368 6170 6529 0a20  empty(d.shape). 
-00023d90: 2020 203e 3e3e 2069 6e73 6572 745f 746f     >>> insert_to
-00023da0: 5f6f 6f63 2864 2e5f 5f64 6173 6b5f 6b65  _ooc(d.__dask_ke
-00023db0: 7973 5f5f 2829 2c20 642e 6368 756e 6b73  ys__(), d.chunks
-00023dc0: 2c20 612c 2022 7374 6f72 652d 3132 3322  , a, "store-123"
-00023dd0: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00023de0: 4b49 500a 2020 2020 2222 220a 0a20 2020  KIP.    """..   
-00023df0: 2069 6620 6c6f 636b 2069 7320 5472 7565   if lock is True
-00023e00: 3a0a 2020 2020 2020 2020 6c6f 636b 203d  :.        lock =
-00023e10: 204c 6f63 6b28 290a 0a20 2020 2073 6c69   Lock()..    sli
-00023e20: 6365 7320 3d20 736c 6963 6573 5f66 726f  ces = slices_fro
-00023e30: 6d5f 6368 756e 6b73 2863 6875 6e6b 7329  m_chunks(chunks)
-00023e40: 0a20 2020 2069 6620 7265 6769 6f6e 3a0a  .    if region:.
-00023e50: 2020 2020 2020 2020 736c 6963 6573 203d          slices =
-00023e60: 205b 6675 7365 5f73 6c69 6365 2872 6567   [fuse_slice(reg
-00023e70: 696f 6e2c 2073 6c63 2920 666f 7220 736c  ion, slc) for sl
-00023e80: 6320 696e 2073 6c69 6365 735d 0a0a 2020  c in slices]..  
-00023e90: 2020 6966 2072 6574 7572 6e5f 7374 6f72    if return_stor
-00023ea0: 6564 2061 6e64 206c 6f61 645f 7374 6f72  ed and load_stor
-00023eb0: 6564 3a0a 2020 2020 2020 2020 6675 6e63  ed:.        func
-00023ec0: 203d 206c 6f61 645f 7374 6f72 655f 6368   = load_store_ch
-00023ed0: 756e 6b0a 2020 2020 2020 2020 6172 6773  unk.        args
-00023ee0: 203d 2028 6c6f 6164 5f73 746f 7265 642c   = (load_stored,
-00023ef0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00023f00: 2020 2020 6675 6e63 203d 2073 746f 7265      func = store
-00023f10: 5f63 6875 6e6b 2020 2320 7479 7065 3a20  _chunk  # type: 
-00023f20: 6967 6e6f 7265 0a20 2020 2020 2020 2061  ignore.        a
-00023f30: 7267 7320 3d20 2829 2020 2320 7479 7065  rgs = ()  # type
-00023f40: 3a20 6967 6e6f 7265 0a0a 2020 2020 6473  : ignore..    ds
-00023f50: 6b20 3d20 7b0a 2020 2020 2020 2020 286e  k = {.        (n
-00023f60: 616d 652c 2920 2b20 745b 313a 5d3a 2028  ame,) + t[1:]: (
-00023f70: 6675 6e63 2c20 742c 206f 7574 2c20 736c  func, t, out, sl
-00023f80: 632c 206c 6f63 6b2c 2072 6574 7572 6e5f  c, lock, return_
-00023f90: 7374 6f72 6564 2920 2b20 6172 6773 0a20  stored) + args. 
-00023fa0: 2020 2020 2020 2066 6f72 2074 2c20 736c         for t, sl
-00023fb0: 6320 696e 207a 6970 2863 6f72 652e 666c  c in zip(core.fl
-00023fc0: 6174 7465 6e28 6b65 7973 292c 2073 6c69  atten(keys), sli
-00023fd0: 6365 7329 0a20 2020 207d 0a20 2020 2072  ces).    }.    r
-00023fe0: 6574 7572 6e20 6473 6b0a 0a0a 6465 6620  eturn dsk...def 
-00023ff0: 7265 7472 6965 7665 5f66 726f 6d5f 6f6f  retrieve_from_oo
-00024000: 6328 0a20 2020 206b 6579 733a 2043 6f6c  c(.    keys: Col
-00024010: 6c65 6374 696f 6e5b 4861 7368 6162 6c65  lection[Hashable
-00024020: 5d2c 2064 736b 5f70 7265 3a20 4d61 7070  ], dsk_pre: Mapp
-00024030: 696e 672c 2064 736b 5f70 6f73 743a 204d  ing, dsk_post: M
-00024040: 6170 7069 6e67 0a29 202d 3e20 6469 6374  apping.) -> dict
-00024050: 5b74 7570 6c65 2c20 416e 795d 3a0a 2020  [tuple, Any]:.  
-00024060: 2020 2222 220a 2020 2020 4372 6561 7465    """.    Create
-00024070: 7320 6120 4461 736b 2067 7261 7068 2066  s a Dask graph f
-00024080: 6f72 206c 6f61 6469 6e67 2073 746f 7265  or loading store
-00024090: 6420 6060 6b65 7973 6060 2066 726f 6d20  d ``keys`` from 
-000240a0: 6060 6473 6b60 602e 0a0a 2020 2020 5061  ``dsk``...    Pa
-000240b0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-000240c0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6b65 7973  -------.    keys
-000240d0: 3a20 436f 6c6c 6563 7469 6f6e 0a20 2020  : Collection.   
-000240e0: 2020 2020 2041 2073 6571 7565 6e63 6520       A sequence 
-000240f0: 636f 6e74 6169 6e69 6e67 2044 6173 6b20  containing Dask 
-00024100: 6772 6170 6820 6b65 7973 2074 6f20 6c6f  graph keys to lo
-00024110: 6164 0a20 2020 2064 736b 5f70 7265 3a20  ad.    dsk_pre: 
-00024120: 4d61 7070 696e 670a 2020 2020 2020 2020  Mapping.        
-00024130: 4120 4461 736b 2067 7261 7068 2063 6f72  A Dask graph cor
-00024140: 7265 7370 6f6e 6469 6e67 2074 6f20 6120  responding to a 
-00024150: 4461 736b 2041 7272 6179 2062 6566 6f72  Dask Array befor
-00024160: 6520 636f 6d70 7574 6174 696f 6e0a 2020  e computation.  
-00024170: 2020 6473 6b5f 706f 7374 3a20 4d61 7070    dsk_post: Mapp
-00024180: 696e 670a 2020 2020 2020 2020 4120 4461  ing.        A Da
-00024190: 736b 2067 7261 7068 2063 6f72 7265 7370  sk graph corresp
-000241a0: 6f6e 6469 6e67 2074 6f20 6120 4461 736b  onding to a Dask
-000241b0: 2041 7272 6179 2061 6674 6572 2063 6f6d   Array after com
-000241c0: 7075 7461 7469 6f6e 0a0a 2020 2020 4578  putation..    Ex
-000241d0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-000241e0: 2d2d 2d0a 2020 2020 3e3e 3e20 696d 706f  ---.    >>> impo
-000241f0: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-00024200: 2064 610a 2020 2020 3e3e 3e20 6420 3d20   da.    >>> d = 
-00024210: 6461 2e6f 6e65 7328 2835 2c20 3629 2c20  da.ones((5, 6), 
-00024220: 6368 756e 6b73 3d28 322c 2033 2929 0a20  chunks=(2, 3)). 
-00024230: 2020 203e 3e3e 2061 203d 206e 702e 656d     >>> a = np.em
-00024240: 7074 7928 642e 7368 6170 6529 0a20 2020  pty(d.shape).   
-00024250: 203e 3e3e 2067 203d 2069 6e73 6572 745f   >>> g = insert_
-00024260: 746f 5f6f 6f63 2864 2e5f 5f64 6173 6b5f  to_ooc(d.__dask_
-00024270: 6b65 7973 5f5f 2829 2c20 642e 6368 756e  keys__(), d.chun
-00024280: 6b73 2c20 612c 2022 7374 6f72 652d 3132  ks, a, "store-12
-00024290: 3322 290a 2020 2020 3e3e 3e20 7265 7472  3").    >>> retr
-000242a0: 6965 7665 5f66 726f 6d5f 6f6f 6328 672e  ieve_from_ooc(g.
-000242b0: 6b65 7973 2829 2c20 672c 207b 6b3a 206b  keys(), g, {k: k
-000242c0: 2066 6f72 206b 2069 6e20 672e 6b65 7973   for k in g.keys
-000242d0: 2829 7d29 2020 2320 646f 6374 6573 743a  ()})  # doctest:
-000242e0: 202b 534b 4950 0a20 2020 2022 2222 0a20   +SKIP.    """. 
-000242f0: 2020 206c 6f61 645f 6473 6b20 3d20 7b0a     load_dsk = {.
-00024300: 2020 2020 2020 2020 2822 6c6f 6164 2d22          ("load-"
-00024310: 202b 206b 5b30 5d2c 2920 2b20 6b5b 313a   + k[0],) + k[1:
-00024320: 5d3a 2028 6c6f 6164 5f63 6875 6e6b 2c20  ]: (load_chunk, 
-00024330: 6473 6b5f 706f 7374 5b6b 5d29 202b 2064  dsk_post[k]) + d
-00024340: 736b 5f70 7265 5b6b 5d5b 333a 2d31 5d20  sk_pre[k][3:-1] 
-00024350: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-00024360: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-00024370: 206b 6579 730a 2020 2020 7d0a 0a20 2020   keys.    }..   
-00024380: 2072 6574 7572 6e20 6c6f 6164 5f64 736b   return load_dsk
-00024390: 0a0a 0a64 6566 2061 7361 7272 6179 280a  ...def asarray(.
-000243a0: 2020 2020 612c 2061 6c6c 6f77 5f75 6e6b      a, allow_unk
-000243b0: 6e6f 776e 5f63 6875 6e6b 7369 7a65 733d  nown_chunksizes=
-000243c0: 4661 6c73 652c 2064 7479 7065 3d4e 6f6e  False, dtype=Non
-000243d0: 652c 206f 7264 6572 3d4e 6f6e 652c 202a  e, order=None, *
-000243e0: 2c20 6c69 6b65 3d4e 6f6e 652c 202a 2a6b  , like=None, **k
-000243f0: 7761 7267 730a 293a 0a20 2020 2022 2222  wargs.):.    """
-00024400: 436f 6e76 6572 7420 7468 6520 696e 7075  Convert the inpu
-00024410: 7420 746f 2061 2064 6173 6b20 6172 7261  t to a dask arra
-00024420: 792e 0a0a 2020 2020 5061 7261 6d65 7465  y...    Paramete
-00024430: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00024440: 2d0a 2020 2020 6120 3a20 6172 7261 792d  -.    a : array-
-00024450: 6c69 6b65 0a20 2020 2020 2020 2049 6e70  like.        Inp
-00024460: 7574 2064 6174 612c 2069 6e20 616e 7920  ut data, in any 
-00024470: 666f 726d 2074 6861 7420 6361 6e20 6265  form that can be
-00024480: 2063 6f6e 7665 7274 6564 2074 6f20 6120   converted to a 
-00024490: 6461 736b 2061 7272 6179 2e20 5468 6973  dask array. This
-000244a0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
-000244b0: 7320 6c69 7374 732c 206c 6973 7473 206f  s lists, lists o
-000244c0: 6620 7475 706c 6573 2c20 7475 706c 6573  f tuples, tuples
-000244d0: 2c20 7475 706c 6573 206f 6620 7475 706c  , tuples of tupl
-000244e0: 6573 2c20 7475 706c 6573 206f 660a 2020  es, tuples of.  
-000244f0: 2020 2020 2020 6c69 7374 7320 616e 6420        lists and 
-00024500: 6e64 6172 7261 7973 2e0a 2020 2020 616c  ndarrays..    al
-00024510: 6c6f 775f 756e 6b6e 6f77 6e5f 6368 756e  low_unknown_chun
-00024520: 6b73 697a 6573 3a20 626f 6f6c 0a20 2020  ksizes: bool.   
-00024530: 2020 2020 2041 6c6c 6f77 2075 6e6b 6e6f       Allow unkno
-00024540: 776e 2063 6875 6e6b 7369 7a65 732c 2073  wn chunksizes, s
-00024550: 7563 6820 6173 2063 6f6d 6520 6672 6f6d  uch as come from
-00024560: 2063 6f6e 7665 7274 696e 6720 6672 6f6d   converting from
-00024570: 2064 6173 6b0a 2020 2020 2020 2020 6461   dask.        da
-00024580: 7461 6672 616d 6573 2e20 2044 6173 6b2e  taframes.  Dask.
-00024590: 6172 7261 7920 6973 2075 6e61 626c 6520  array is unable 
-000245a0: 746f 2076 6572 6966 7920 7468 6174 2063  to verify that c
-000245b0: 6875 6e6b 7320 6c69 6e65 2075 702e 2020  hunks line up.  
-000245c0: 4966 0a20 2020 2020 2020 2064 6174 6120  If.        data 
-000245d0: 636f 6d65 7320 6672 6f6d 2064 6966 6665  comes from diffe
-000245e0: 7265 6e74 6c79 2061 6c69 676e 6564 2073  rently aligned s
-000245f0: 6f75 7263 6573 2074 6865 6e20 7468 6973  ources then this
-00024600: 2063 616e 2063 6175 7365 0a20 2020 2020   can cause.     
-00024610: 2020 2075 6e65 7870 6563 7465 6420 7265     unexpected re
-00024620: 7375 6c74 732e 0a20 2020 2064 7479 7065  sults..    dtype
-00024630: 203a 2064 6174 612d 7479 7065 2c20 6f70   : data-type, op
-00024640: 7469 6f6e 616c 0a20 2020 2020 2020 2042  tional.        B
-00024650: 7920 6465 6661 756c 742c 2074 6865 2064  y default, the d
-00024660: 6174 612d 7479 7065 2069 7320 696e 6665  ata-type is infe
-00024670: 7272 6564 2066 726f 6d20 7468 6520 696e  rred from the in
-00024680: 7075 7420 6461 7461 2e0a 2020 2020 6f72  put data..    or
-00024690: 6465 7220 3a20 7be2 8098 43e2 8099 2c20  der : {...C..., 
-000246a0: e280 9846 e280 992c 20e2 8098 41e2 8099  ...F..., ...A...
-000246b0: 2c20 e280 984b e280 997d 2c20 6f70 7469  , ...K...}, opti
-000246c0: 6f6e 616c 0a20 2020 2020 2020 204d 656d  onal.        Mem
-000246d0: 6f72 7920 6c61 796f 7574 2e20 e280 9841  ory layout. ...A
-000246e0: e280 9920 616e 6420 e280 984b e280 9920  ... and ...K... 
-000246f0: 6465 7065 6e64 206f 6e20 7468 6520 6f72  depend on the or
-00024700: 6465 7220 6f66 2069 6e70 7574 2061 7272  der of input arr
-00024710: 6179 2061 2e0a 2020 2020 2020 2020 e280  ay a..        ..
-00024720: 9843 e280 9920 726f 772d 6d61 6a6f 7220  .C... row-major 
-00024730: 2843 2d73 7479 6c65 292c 20e2 8098 46e2  (C-style), ...F.
-00024740: 8099 2063 6f6c 756d 6e2d 6d61 6a6f 7220  .. column-major 
-00024750: 2846 6f72 7472 616e 2d73 7479 6c65 2920  (Fortran-style) 
-00024760: 6d65 6d6f 7279 0a20 2020 2020 2020 2072  memory.        r
-00024770: 6570 7265 7365 6e74 6174 696f 6e2e 20e2  epresentation. .
-00024780: 8098 41e2 8099 2028 616e 7929 206d 6561  ..A... (any) mea
-00024790: 6e73 20e2 8098 46e2 8099 2069 6620 6120  ns ...F... if a 
-000247a0: 6973 2046 6f72 7472 616e 2063 6f6e 7469  is Fortran conti
-000247b0: 6775 6f75 732c 20e2 8098 43e2 8099 0a20  guous, ...C.... 
-000247c0: 2020 2020 2020 206f 7468 6572 7769 7365         otherwise
-000247d0: 20e2 8098 4be2 8099 2028 6b65 6570 2920   ...K... (keep) 
-000247e0: 7072 6573 6572 7665 2069 6e70 7574 206f  preserve input o
-000247f0: 7264 6572 2e20 4465 6661 756c 7473 2074  rder. Defaults t
-00024800: 6f20 e280 9843 e280 992e 0a20 2020 206c  o ...C.....    l
-00024810: 696b 653a 2061 7272 6179 2d6c 696b 650a  ike: array-like.
-00024820: 2020 2020 2020 2020 5265 6665 7265 6e63          Referenc
-00024830: 6520 6f62 6a65 6374 2074 6f20 616c 6c6f  e object to allo
-00024840: 7720 7468 6520 6372 6561 7469 6f6e 206f  w the creation o
-00024850: 6620 4461 736b 2061 7272 6179 7320 7769  f Dask arrays wi
-00024860: 7468 2063 6875 6e6b 730a 2020 2020 2020  th chunks.      
-00024870: 2020 7468 6174 2061 7265 206e 6f74 204e    that are not N
-00024880: 756d 5079 2061 7272 6179 732e 2049 6620  umPy arrays. If 
-00024890: 616e 2061 7272 6179 2d6c 696b 6520 7061  an array-like pa
-000248a0: 7373 6564 2069 6e20 6173 2060 606c 696b  ssed in as ``lik
-000248b0: 6560 600a 2020 2020 2020 2020 7375 7070  e``.        supp
-000248c0: 6f72 7473 2074 6865 2060 605f 5f61 7272  orts the ``__arr
-000248d0: 6179 5f66 756e 6374 696f 6e5f 5f60 6020  ay_function__`` 
-000248e0: 7072 6f74 6f63 6f6c 2c20 7468 6520 6368  protocol, the ch
-000248f0: 756e 6b20 7479 7065 206f 6620 7468 650a  unk type of the.
-00024900: 2020 2020 2020 2020 7265 7375 6c74 696e          resultin
-00024910: 6720 6172 7261 7920 7769 6c6c 2062 6520  g array will be 
-00024920: 6465 6669 6e64 6520 6279 2069 742e 2049  definde by it. I
-00024930: 6e20 7468 6973 2063 6173 652c 2069 7420  n this case, it 
-00024940: 656e 7375 7265 7320 7468 650a 2020 2020  ensures the.    
-00024950: 2020 2020 6372 6561 7469 6f6e 206f 6620      creation of 
-00024960: 6120 4461 736b 2061 7272 6179 2063 6f6d  a Dask array com
-00024970: 7061 7469 626c 6520 7769 7468 2074 6861  patible with tha
-00024980: 7420 7061 7373 6564 2069 6e20 7669 6120  t passed in via 
-00024990: 7468 6973 0a20 2020 2020 2020 2061 7267  this.        arg
-000249a0: 756d 656e 742e 2049 6620 6060 6c69 6b65  ument. If ``like
-000249b0: 6060 2069 7320 6120 4461 736b 2061 7272  `` is a Dask arr
-000249c0: 6179 2c20 7468 6520 6368 756e 6b20 7479  ay, the chunk ty
-000249d0: 7065 206f 6620 7468 650a 2020 2020 2020  pe of the.      
-000249e0: 2020 7265 7375 6c74 696e 6720 6172 7261    resulting arra
-000249f0: 7920 7769 6c6c 2062 6520 6465 6669 6e65  y will be define
-00024a00: 6420 6279 2074 6865 2063 6875 6e6b 2074  d by the chunk t
-00024a10: 7970 6520 6f66 2060 606c 696b 6560 602e  ype of ``like``.
-00024a20: 0a20 2020 2020 2020 2052 6571 7569 7265  .        Require
-00024a30: 7320 4e75 6d50 7920 312e 3230 2e30 206f  s NumPy 1.20.0 o
-00024a40: 7220 6869 6768 6572 2e0a 0a20 2020 2052  r higher...    R
-00024a50: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00024a60: 2d2d 0a20 2020 206f 7574 203a 2064 6173  --.    out : das
-00024a70: 6b20 6172 7261 790a 2020 2020 2020 2020  k array.        
-00024a80: 4461 736b 2061 7272 6179 2069 6e74 6572  Dask array inter
-00024a90: 7072 6574 6174 696f 6e20 6f66 2061 2e0a  pretation of a..
-00024aa0: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-00024ab0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-00024ac0: 3e3e 2069 6d70 6f72 7420 6461 736b 2e61  >> import dask.a
-00024ad0: 7272 6179 2061 7320 6461 0a20 2020 203e  rray as da.    >
-00024ae0: 3e3e 2069 6d70 6f72 7420 6e75 6d70 7920  >> import numpy 
-00024af0: 6173 206e 700a 2020 2020 3e3e 3e20 7820  as np.    >>> x 
-00024b00: 3d20 6e70 2e61 7261 6e67 6528 3329 0a20  = np.arange(3). 
-00024b10: 2020 203e 3e3e 2064 612e 6173 6172 7261     >>> da.asarra
-00024b20: 7928 7829 0a20 2020 2064 6173 6b2e 6172  y(x).    dask.ar
-00024b30: 7261 793c 6172 7261 792c 2073 6861 7065  ray<array, shape
-00024b40: 3d28 332c 292c 2064 7479 7065 3d69 6e74  =(3,), dtype=int
-00024b50: 3634 2c20 6368 756e 6b73 697a 653d 2833  64, chunksize=(3
-00024b60: 2c29 2c20 6368 756e 6b74 7970 653d 6e75  ,), chunktype=nu
-00024b70: 6d70 792e 6e64 6172 7261 793e 0a0a 2020  mpy.ndarray>..  
-00024b80: 2020 3e3e 3e20 7920 3d20 5b5b 312c 2032    >>> y = [[1, 2
-00024b90: 2c20 335d 2c20 5b34 2c20 352c 2036 5d5d  , 3], [4, 5, 6]]
-00024ba0: 0a20 2020 203e 3e3e 2064 612e 6173 6172  .    >>> da.asar
-00024bb0: 7261 7928 7929 0a20 2020 2064 6173 6b2e  ray(y).    dask.
-00024bc0: 6172 7261 793c 6172 7261 792c 2073 6861  array<array, sha
-00024bd0: 7065 3d28 322c 2033 292c 2064 7479 7065  pe=(2, 3), dtype
-00024be0: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
-00024bf0: 653d 2832 2c20 3329 2c20 6368 756e 6b74  e=(2, 3), chunkt
-00024c00: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
-00024c10: 793e 0a20 2020 2022 2222 0a20 2020 2069  y>.    """.    i
-00024c20: 6620 6c69 6b65 2069 7320 4e6f 6e65 3a0a  f like is None:.
-00024c30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00024c40: 7461 6e63 6528 612c 2041 7272 6179 293a  tance(a, Array):
-00024c50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00024c60: 7572 6e20 610a 2020 2020 2020 2020 656c  urn a.        el
-00024c70: 6966 2068 6173 6174 7472 2861 2c20 2274  if hasattr(a, "t
-00024c80: 6f5f 6461 736b 5f61 7272 6179 2229 3a0a  o_dask_array"):.
-00024c90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00024ca0: 726e 2061 2e74 6f5f 6461 736b 5f61 7272  rn a.to_dask_arr
-00024cb0: 6179 2829 0a20 2020 2020 2020 2065 6c69  ay().        eli
-00024cc0: 6620 7479 7065 2861 292e 5f5f 6d6f 6475  f type(a).__modu
-00024cd0: 6c65 5f5f 2e73 706c 6974 2822 2e22 295b  le__.split(".")[
-00024ce0: 305d 203d 3d20 2278 6172 7261 7922 2061  0] == "xarray" a
-00024cf0: 6e64 2068 6173 6174 7472 2861 2c20 2264  nd hasattr(a, "d
-00024d00: 6174 6122 293a 0a20 2020 2020 2020 2020  ata"):.         
-00024d10: 2020 2072 6574 7572 6e20 6173 6172 7261     return asarra
-00024d20: 7928 612e 6461 7461 290a 2020 2020 2020  y(a.data).      
-00024d30: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00024d40: 6528 612c 2028 6c69 7374 2c20 7475 706c  e(a, (list, tupl
-00024d50: 6529 2920 616e 6420 616e 7928 6973 696e  e)) and any(isin
-00024d60: 7374 616e 6365 2869 2c20 4172 7261 7929  stance(i, Array)
-00024d70: 2066 6f72 2069 2069 6e20 6129 3a0a 2020   for i in a):.  
-00024d80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00024d90: 2073 7461 636b 2861 2c20 616c 6c6f 775f   stack(a, allow_
-00024da0: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
-00024db0: 6573 3d61 6c6c 6f77 5f75 6e6b 6e6f 776e  es=allow_unknown
-00024dc0: 5f63 6875 6e6b 7369 7a65 7329 0a20 2020  _chunksizes).   
-00024dd0: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
-00024de0: 696e 7374 616e 6365 2867 6574 6174 7472  instance(getattr
-00024df0: 2861 2c20 2273 6861 7065 222c 204e 6f6e  (a, "shape", Non
-00024e00: 6529 2c20 4974 6572 6162 6c65 293a 0a20  e), Iterable):. 
-00024e10: 2020 2020 2020 2020 2020 2061 203d 206e             a = n
-00024e20: 702e 6173 6172 7261 7928 612c 2064 7479  p.asarray(a, dty
-00024e30: 7065 3d64 7479 7065 2c20 6f72 6465 723d  pe=dtype, order=
-00024e40: 6f72 6465 7229 0a20 2020 2065 6c73 653a  order).    else:
-00024e50: 0a20 2020 2020 2020 206c 696b 655f 6d65  .        like_me
-00024e60: 7461 203d 206d 6574 615f 6672 6f6d 5f61  ta = meta_from_a
-00024e70: 7272 6179 286c 696b 6529 0a20 2020 2020  rray(like).     
-00024e80: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00024e90: 2861 2c20 4172 7261 7929 3a0a 2020 2020  (a, Array):.    
-00024ea0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00024eb0: 2e6d 6170 5f62 6c6f 636b 7328 6e70 2e61  .map_blocks(np.a
-00024ec0: 7361 7272 6179 2c20 6c69 6b65 3d6c 696b  sarray, like=lik
-00024ed0: 655f 6d65 7461 2c20 6474 7970 653d 6474  e_meta, dtype=dt
-00024ee0: 7970 652c 206f 7264 6572 3d6f 7264 6572  ype, order=order
-00024ef0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00024f00: 2020 2020 2020 2020 2020 2020 6120 3d20              a = 
-00024f10: 6e70 2e61 7361 7272 6179 2861 2c20 6c69  np.asarray(a, li
-00024f20: 6b65 3d6c 696b 655f 6d65 7461 2c20 6474  ke=like_meta, dt
-00024f30: 7970 653d 6474 7970 652c 206f 7264 6572  ype=dtype, order
-00024f40: 3d6f 7264 6572 290a 2020 2020 7265 7475  =order).    retu
-00024f50: 726e 2066 726f 6d5f 6172 7261 7928 612c  rn from_array(a,
-00024f60: 2067 6574 6974 656d 3d67 6574 7465 725f   getitem=getter_
-00024f70: 696e 6c69 6e65 2c20 2a2a 6b77 6172 6773  inline, **kwargs
-00024f80: 290a 0a0a 6465 6620 6173 616e 7961 7272  )...def asanyarr
-00024f90: 6179 2861 2c20 6474 7970 653d 4e6f 6e65  ay(a, dtype=None
-00024fa0: 2c20 6f72 6465 723d 4e6f 6e65 2c20 2a2c  , order=None, *,
-00024fb0: 206c 696b 653d 4e6f 6e65 2c20 696e 6c69   like=None, inli
-00024fc0: 6e65 5f61 7272 6179 3d46 616c 7365 293a  ne_array=False):
-00024fd0: 0a20 2020 2022 2222 436f 6e76 6572 7420  .    """Convert 
-00024fe0: 7468 6520 696e 7075 7420 746f 2061 2064  the input to a d
-00024ff0: 6173 6b20 6172 7261 792e 0a0a 2020 2020  ask array...    
-00025000: 5375 6263 6c61 7373 6573 206f 6620 6060  Subclasses of ``
-00025010: 6e70 2e6e 6461 7272 6179 6060 2077 696c  np.ndarray`` wil
-00025020: 6c20 6265 2070 6173 7365 6420 7468 726f  l be passed thro
-00025030: 7567 6820 6173 2063 6875 6e6b 7320 756e  ugh as chunks un
-00025040: 6368 616e 6765 642e 0a0a 2020 2020 5061  changed...    Pa
-00025050: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00025060: 2d2d 2d2d 2d2d 2d0a 2020 2020 6120 3a20  -------.    a : 
-00025070: 6172 7261 792d 6c69 6b65 0a20 2020 2020  array-like.     
-00025080: 2020 2049 6e70 7574 2064 6174 612c 2069     Input data, i
-00025090: 6e20 616e 7920 666f 726d 2074 6861 7420  n any form that 
-000250a0: 6361 6e20 6265 2063 6f6e 7665 7274 6564  can be converted
-000250b0: 2074 6f20 6120 6461 736b 2061 7272 6179   to a dask array
-000250c0: 2e20 5468 6973 0a20 2020 2020 2020 2069  . This.        i
-000250d0: 6e63 6c75 6465 7320 6c69 7374 732c 206c  ncludes lists, l
-000250e0: 6973 7473 206f 6620 7475 706c 6573 2c20  ists of tuples, 
-000250f0: 7475 706c 6573 2c20 7475 706c 6573 206f  tuples, tuples o
-00025100: 6620 7475 706c 6573 2c20 7475 706c 6573  f tuples, tuples
-00025110: 206f 660a 2020 2020 2020 2020 6c69 7374   of.        list
-00025120: 7320 616e 6420 6e64 6172 7261 7973 2e0a  s and ndarrays..
-00025130: 2020 2020 6474 7970 6520 3a20 6461 7461      dtype : data
-00025140: 2d74 7970 652c 206f 7074 696f 6e61 6c0a  -type, optional.
-00025150: 2020 2020 2020 2020 4279 2064 6566 6175          By defau
-00025160: 6c74 2c20 7468 6520 6461 7461 2d74 7970  lt, the data-typ
-00025170: 6520 6973 2069 6e66 6572 7265 6420 6672  e is inferred fr
-00025180: 6f6d 2074 6865 2069 6e70 7574 2064 6174  om the input dat
-00025190: 612e 0a20 2020 206f 7264 6572 203a 207b  a..    order : {
-000251a0: e280 9843 e280 992c 20e2 8098 46e2 8099  ...C..., ...F...
-000251b0: 2c20 e280 9841 e280 992c 20e2 8098 4be2  , ...A..., ...K.
-000251c0: 8099 7d2c 206f 7074 696f 6e61 6c0a 2020  ..}, optional.  
-000251d0: 2020 2020 2020 4d65 6d6f 7279 206c 6179        Memory lay
-000251e0: 6f75 742e 20e2 8098 41e2 8099 2061 6e64  out. ...A... and
-000251f0: 20e2 8098 4be2 8099 2064 6570 656e 6420   ...K... depend 
-00025200: 6f6e 2074 6865 206f 7264 6572 206f 6620  on the order of 
-00025210: 696e 7075 7420 6172 7261 7920 612e 0a20  input array a.. 
-00025220: 2020 2020 2020 20e2 8098 43e2 8099 2072         ...C... r
-00025230: 6f77 2d6d 616a 6f72 2028 432d 7374 796c  ow-major (C-styl
-00025240: 6529 2c20 e280 9846 e280 9920 636f 6c75  e), ...F... colu
-00025250: 6d6e 2d6d 616a 6f72 2028 466f 7274 7261  mn-major (Fortra
-00025260: 6e2d 7374 796c 6529 206d 656d 6f72 790a  n-style) memory.
-00025270: 2020 2020 2020 2020 7265 7072 6573 656e          represen
-00025280: 7461 7469 6f6e 2e20 e280 9841 e280 9920  tation. ...A... 
-00025290: 2861 6e79 2920 6d65 616e 7320 e280 9846  (any) means ...F
-000252a0: e280 9920 6966 2061 2069 7320 466f 7274  ... if a is Fort
-000252b0: 7261 6e20 636f 6e74 6967 756f 7573 2c20  ran contiguous, 
-000252c0: e280 9843 e280 990a 2020 2020 2020 2020  ...C....        
-000252d0: 6f74 6865 7277 6973 6520 e280 984b e280  otherwise ...K..
-000252e0: 9920 286b 6565 7029 2070 7265 7365 7276  . (keep) preserv
-000252f0: 6520 696e 7075 7420 6f72 6465 722e 2044  e input order. D
-00025300: 6566 6175 6c74 7320 746f 20e2 8098 43e2  efaults to ...C.
-00025310: 8099 2e0a 2020 2020 6c69 6b65 3a20 6172  ....    like: ar
-00025320: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
-00025330: 2052 6566 6572 656e 6365 206f 626a 6563   Reference objec
-00025340: 7420 746f 2061 6c6c 6f77 2074 6865 2063  t to allow the c
-00025350: 7265 6174 696f 6e20 6f66 2044 6173 6b20  reation of Dask 
-00025360: 6172 7261 7973 2077 6974 6820 6368 756e  arrays with chun
-00025370: 6b73 0a20 2020 2020 2020 2074 6861 7420  ks.        that 
-00025380: 6172 6520 6e6f 7420 4e75 6d50 7920 6172  are not NumPy ar
-00025390: 7261 7973 2e20 4966 2061 6e20 6172 7261  rays. If an arra
-000253a0: 792d 6c69 6b65 2070 6173 7365 6420 696e  y-like passed in
-000253b0: 2061 7320 6060 6c69 6b65 6060 0a20 2020   as ``like``.   
-000253c0: 2020 2020 2073 7570 706f 7274 7320 7468       supports th
-000253d0: 6520 6060 5f5f 6172 7261 795f 6675 6e63  e ``__array_func
-000253e0: 7469 6f6e 5f5f 6060 2070 726f 746f 636f  tion__`` protoco
-000253f0: 6c2c 2074 6865 2063 6875 6e6b 2074 7970  l, the chunk typ
-00025400: 6520 6f66 2074 6865 0a20 2020 2020 2020  e of the.       
-00025410: 2072 6573 756c 7469 6e67 2061 7272 6179   resulting array
-00025420: 2077 696c 6c20 6265 2064 6566 696e 6465   will be definde
-00025430: 2062 7920 6974 2e20 496e 2074 6869 7320   by it. In this 
-00025440: 6361 7365 2c20 6974 2065 6e73 7572 6573  case, it ensures
-00025450: 2074 6865 0a20 2020 2020 2020 2063 7265   the.        cre
-00025460: 6174 696f 6e20 6f66 2061 2044 6173 6b20  ation of a Dask 
-00025470: 6172 7261 7920 636f 6d70 6174 6962 6c65  array compatible
-00025480: 2077 6974 6820 7468 6174 2070 6173 7365   with that passe
-00025490: 6420 696e 2076 6961 2074 6869 730a 2020  d in via this.  
-000254a0: 2020 2020 2020 6172 6775 6d65 6e74 2e20        argument. 
-000254b0: 4966 2060 606c 696b 6560 6020 6973 2061  If ``like`` is a
-000254c0: 2044 6173 6b20 6172 7261 792c 2074 6865   Dask array, the
-000254d0: 2063 6875 6e6b 2074 7970 6520 6f66 2074   chunk type of t
-000254e0: 6865 0a20 2020 2020 2020 2072 6573 756c  he.        resul
-000254f0: 7469 6e67 2061 7272 6179 2077 696c 6c20  ting array will 
-00025500: 6265 2064 6566 696e 6564 2062 7920 7468  be defined by th
-00025510: 6520 6368 756e 6b20 7479 7065 206f 6620  e chunk type of 
-00025520: 6060 6c69 6b65 6060 2e0a 2020 2020 2020  ``like``..      
-00025530: 2020 5265 7175 6972 6573 204e 756d 5079    Requires NumPy
-00025540: 2031 2e32 302e 3020 6f72 2068 6967 6865   1.20.0 or highe
-00025550: 722e 0a20 2020 2069 6e6c 696e 655f 6172  r..    inline_ar
-00025560: 7261 793a 0a20 2020 2020 2020 2057 6865  ray:.        Whe
-00025570: 7468 6572 2074 6f20 696e 6c69 6e65 2074  ther to inline t
-00025580: 6865 2061 7272 6179 2069 6e20 7468 6520  he array in the 
-00025590: 7265 7375 6c74 696e 6720 6461 736b 2067  resulting dask g
-000255a0: 7261 7068 2e20 466f 7220 6d6f 7265 2069  raph. For more i
-000255b0: 6e66 6f72 6d61 7469 6f6e 2c0a 2020 2020  nformation,.    
-000255c0: 2020 2020 7365 6520 7468 6520 646f 6375      see the docu
-000255d0: 6d65 6e74 6174 696f 6e20 666f 7220 6060  mentation for ``
-000255e0: 6461 736b 2e61 7272 6179 2e66 726f 6d5f  dask.array.from_
-000255f0: 6172 7261 7928 2960 602e 0a0a 2020 2020  array()``...    
-00025600: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00025610: 2d2d 2d0a 2020 2020 6f75 7420 3a20 6461  ---.    out : da
-00025620: 736b 2061 7272 6179 0a20 2020 2020 2020  sk array.       
-00025630: 2044 6173 6b20 6172 7261 7920 696e 7465   Dask array inte
-00025640: 7270 7265 7461 7469 6f6e 206f 6620 612e  rpretation of a.
-00025650: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-00025660: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00025670: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
-00025680: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
-00025690: 3e3e 3e20 696d 706f 7274 206e 756d 7079  >>> import numpy
-000256a0: 2061 7320 6e70 0a20 2020 203e 3e3e 2078   as np.    >>> x
-000256b0: 203d 206e 702e 6172 616e 6765 2833 290a   = np.arange(3).
-000256c0: 2020 2020 3e3e 3e20 6461 2e61 7361 6e79      >>> da.asany
-000256d0: 6172 7261 7928 7829 0a20 2020 2064 6173  array(x).    das
-000256e0: 6b2e 6172 7261 793c 6172 7261 792c 2073  k.array<array, s
-000256f0: 6861 7065 3d28 332c 292c 2064 7479 7065  hape=(3,), dtype
-00025700: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
-00025710: 653d 2833 2c29 2c20 6368 756e 6b74 7970  e=(3,), chunktyp
-00025720: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
-00025730: 0a0a 2020 2020 3e3e 3e20 7920 3d20 5b5b  ..    >>> y = [[
-00025740: 312c 2032 2c20 335d 2c20 5b34 2c20 352c  1, 2, 3], [4, 5,
-00025750: 2036 5d5d 0a20 2020 203e 3e3e 2064 612e   6]].    >>> da.
-00025760: 6173 616e 7961 7272 6179 2879 290a 2020  asanyarray(y).  
-00025770: 2020 6461 736b 2e61 7272 6179 3c61 7272    dask.array<arr
-00025780: 6179 2c20 7368 6170 653d 2832 2c20 3329  ay, shape=(2, 3)
-00025790: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
-000257a0: 6875 6e6b 7369 7a65 3d28 322c 2033 292c  hunksize=(2, 3),
-000257b0: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
-000257c0: 2e6e 6461 7272 6179 3e0a 2020 2020 2222  .ndarray>.    ""
-000257d0: 220a 2020 2020 6966 206c 696b 6520 6973  ".    if like is
-000257e0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
-000257f0: 6620 6973 696e 7374 616e 6365 2861 2c20  f isinstance(a, 
-00025800: 4172 7261 7929 3a0a 2020 2020 2020 2020  Array):.        
-00025810: 2020 2020 7265 7475 726e 2061 0a20 2020      return a.   
-00025820: 2020 2020 2065 6c69 6620 6861 7361 7474       elif hasatt
-00025830: 7228 612c 2022 746f 5f64 6173 6b5f 6172  r(a, "to_dask_ar
-00025840: 7261 7922 293a 0a20 2020 2020 2020 2020  ray"):.         
-00025850: 2020 2072 6574 7572 6e20 612e 746f 5f64     return a.to_d
-00025860: 6173 6b5f 6172 7261 7928 290a 2020 2020  ask_array().    
-00025870: 2020 2020 656c 6966 2074 7970 6528 6129      elif type(a)
-00025880: 2e5f 5f6d 6f64 756c 655f 5f2e 7370 6c69  .__module__.spli
-00025890: 7428 222e 2229 5b30 5d20 3d3d 2022 7861  t(".")[0] == "xa
-000258a0: 7272 6179 2220 616e 6420 6861 7361 7474  rray" and hasatt
-000258b0: 7228 612c 2022 6461 7461 2229 3a0a 2020  r(a, "data"):.  
-000258c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000258d0: 2061 7361 6e79 6172 7261 7928 612e 6461   asanyarray(a.da
-000258e0: 7461 290a 2020 2020 2020 2020 656c 6966  ta).        elif
-000258f0: 2069 7369 6e73 7461 6e63 6528 612c 2028   isinstance(a, (
-00025900: 6c69 7374 2c20 7475 706c 6529 2920 616e  list, tuple)) an
-00025910: 6420 616e 7928 6973 696e 7374 616e 6365  d any(isinstance
-00025920: 2869 2c20 4172 7261 7929 2066 6f72 2069  (i, Array) for i
-00025930: 2069 6e20 6129 3a0a 2020 2020 2020 2020   in a):.        
-00025940: 2020 2020 7265 7475 726e 2073 7461 636b      return stack
-00025950: 2861 290a 2020 2020 2020 2020 656c 6966  (a).        elif
-00025960: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00025970: 6765 7461 7474 7228 612c 2022 7368 6170  getattr(a, "shap
-00025980: 6522 2c20 4e6f 6e65 292c 2049 7465 7261  e", None), Itera
-00025990: 626c 6529 3a0a 2020 2020 2020 2020 2020  ble):.          
-000259a0: 2020 6120 3d20 6e70 2e61 7361 6e79 6172    a = np.asanyar
-000259b0: 7261 7928 612c 2064 7479 7065 3d64 7479  ray(a, dtype=dty
-000259c0: 7065 2c20 6f72 6465 723d 6f72 6465 7229  pe, order=order)
-000259d0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-000259e0: 2020 206c 696b 655f 6d65 7461 203d 206d     like_meta = m
-000259f0: 6574 615f 6672 6f6d 5f61 7272 6179 286c  eta_from_array(l
-00025a00: 696b 6529 0a20 2020 2020 2020 2069 6620  ike).        if 
-00025a10: 6973 696e 7374 616e 6365 2861 2c20 4172  isinstance(a, Ar
-00025a20: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
-00025a30: 2020 7265 7475 726e 2061 2e6d 6170 5f62    return a.map_b
-00025a40: 6c6f 636b 7328 6e70 2e61 7361 6e79 6172  locks(np.asanyar
-00025a50: 7261 792c 206c 696b 653d 6c69 6b65 5f6d  ray, like=like_m
-00025a60: 6574 612c 2064 7479 7065 3d64 7479 7065  eta, dtype=dtype
-00025a70: 2c20 6f72 6465 723d 6f72 6465 7229 0a20  , order=order). 
-00025a80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00025a90: 2020 2020 2020 2020 2061 203d 206e 702e           a = np.
-00025aa0: 6173 616e 7961 7272 6179 2861 2c20 6c69  asanyarray(a, li
-00025ab0: 6b65 3d6c 696b 655f 6d65 7461 2c20 6474  ke=like_meta, dt
-00025ac0: 7970 653d 6474 7970 652c 206f 7264 6572  ype=dtype, order
-00025ad0: 3d6f 7264 6572 290a 2020 2020 7265 7475  =order).    retu
-00025ae0: 726e 2066 726f 6d5f 6172 7261 7928 0a20  rn from_array(. 
-00025af0: 2020 2020 2020 2061 2c0a 2020 2020 2020         a,.      
-00025b00: 2020 6368 756e 6b73 3d61 2e73 6861 7065    chunks=a.shape
-00025b10: 2c0a 2020 2020 2020 2020 6765 7469 7465  ,.        getite
-00025b20: 6d3d 6765 7474 6572 5f69 6e6c 696e 652c  m=getter_inline,
-00025b30: 0a20 2020 2020 2020 2061 7361 7272 6179  .        asarray
-00025b40: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00025b50: 696e 6c69 6e65 5f61 7272 6179 3d69 6e6c  inline_array=inl
-00025b60: 696e 655f 6172 7261 792c 0a20 2020 2029  ine_array,.    )
-00025b70: 0a0a 0a64 6566 2069 735f 7363 616c 6172  ...def is_scalar
-00025b80: 5f66 6f72 5f65 6c65 6d77 6973 6528 6172  _for_elemwise(ar
-00025b90: 6729 3a0a 2020 2020 2222 220a 0a20 2020  g):.    """..   
-00025ba0: 203e 3e3e 2069 735f 7363 616c 6172 5f66   >>> is_scalar_f
-00025bb0: 6f72 5f65 6c65 6d77 6973 6528 3432 290a  or_elemwise(42).
-00025bc0: 2020 2020 5472 7565 0a20 2020 203e 3e3e      True.    >>>
-00025bd0: 2069 735f 7363 616c 6172 5f66 6f72 5f65   is_scalar_for_e
-00025be0: 6c65 6d77 6973 6528 2766 6f6f 2729 0a20  lemwise('foo'). 
-00025bf0: 2020 2054 7275 650a 2020 2020 3e3e 3e20     True.    >>> 
-00025c00: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
-00025c10: 656d 7769 7365 2854 7275 6529 0a20 2020  emwise(True).   
-00025c20: 2054 7275 650a 2020 2020 3e3e 3e20 6973   True.    >>> is
-00025c30: 5f73 6361 6c61 725f 666f 725f 656c 656d  _scalar_for_elem
-00025c40: 7769 7365 286e 702e 6172 7261 7928 3432  wise(np.array(42
-00025c50: 2929 0a20 2020 2054 7275 650a 2020 2020  )).    True.    
-00025c60: 3e3e 3e20 6973 5f73 6361 6c61 725f 666f  >>> is_scalar_fo
-00025c70: 725f 656c 656d 7769 7365 285b 312c 2032  r_elemwise([1, 2
-00025c80: 2c20 335d 290a 2020 2020 5472 7565 0a20  , 3]).    True. 
-00025c90: 2020 203e 3e3e 2069 735f 7363 616c 6172     >>> is_scalar
-00025ca0: 5f66 6f72 5f65 6c65 6d77 6973 6528 6e70  _for_elemwise(np
-00025cb0: 2e61 7272 6179 285b 312c 2032 2c20 335d  .array([1, 2, 3]
-00025cc0: 2929 0a20 2020 2046 616c 7365 0a20 2020  )).    False.   
-00025cd0: 203e 3e3e 2069 735f 7363 616c 6172 5f66   >>> is_scalar_f
-00025ce0: 6f72 5f65 6c65 6d77 6973 6528 6672 6f6d  or_elemwise(from
-00025cf0: 5f61 7272 6179 286e 702e 6172 7261 7928  _array(np.array(
-00025d00: 3029 2c20 6368 756e 6b73 3d28 2929 290a  0), chunks=())).
-00025d10: 2020 2020 4661 6c73 650a 2020 2020 3e3e      False.    >>
-00025d20: 3e20 6973 5f73 6361 6c61 725f 666f 725f  > is_scalar_for_
-00025d30: 656c 656d 7769 7365 286e 702e 6474 7970  elemwise(np.dtyp
-00025d40: 6528 2769 3427 2929 0a20 2020 2054 7275  e('i4')).    Tru
-00025d50: 650a 2020 2020 2222 220a 2020 2020 2320  e.    """.    # 
-00025d60: 7468 6520 7365 636f 6e64 2068 616c 6620  the second half 
-00025d70: 6f66 2073 6861 7065 5f63 6f6e 6469 7469  of shape_conditi
-00025d80: 6f6e 2069 7320 6573 7365 6e74 6961 6c6c  on is essentiall
-00025d90: 7920 6a75 7374 2074 6f20 656e 7375 7265  y just to ensure
-00025da0: 2074 6861 740a 2020 2020 2320 6461 736b   that.    # dask
-00025db0: 2073 6572 6965 7320 2f20 6672 616d 6520   series / frame 
-00025dc0: 6172 6520 7472 6561 7465 6420 6173 2073  are treated as s
-00025dd0: 6361 6c61 7273 2069 6e20 656c 656d 7769  calars in elemwi
-00025de0: 7365 2e0a 2020 2020 6d61 7962 655f 7368  se..    maybe_sh
-00025df0: 6170 6520 3d20 6765 7461 7474 7228 6172  ape = getattr(ar
-00025e00: 672c 2022 7368 6170 6522 2c20 4e6f 6e65  g, "shape", None
-00025e10: 290a 2020 2020 7368 6170 655f 636f 6e64  ).    shape_cond
-00025e20: 6974 696f 6e20 3d20 6e6f 7420 6973 696e  ition = not isin
-00025e30: 7374 616e 6365 286d 6179 6265 5f73 6861  stance(maybe_sha
-00025e40: 7065 2c20 4974 6572 6162 6c65 2920 6f72  pe, Iterable) or
-00025e50: 2061 6e79 280a 2020 2020 2020 2020 6973   any(.        is
-00025e60: 5f64 6173 6b5f 636f 6c6c 6563 7469 6f6e  _dask_collection
-00025e70: 2878 2920 666f 7220 7820 696e 206d 6179  (x) for x in may
-00025e80: 6265 5f73 6861 7065 0a20 2020 2029 0a0a  be_shape.    )..
-00025e90: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-00025ea0: 2020 2020 206e 702e 6973 7363 616c 6172       np.isscalar
-00025eb0: 2861 7267 290a 2020 2020 2020 2020 6f72  (arg).        or
-00025ec0: 2073 6861 7065 5f63 6f6e 6469 7469 6f6e   shape_condition
-00025ed0: 0a20 2020 2020 2020 206f 7220 6973 696e  .        or isin
-00025ee0: 7374 616e 6365 2861 7267 2c20 6e70 2e64  stance(arg, np.d
-00025ef0: 7479 7065 290a 2020 2020 2020 2020 6f72  type).        or
-00025f00: 2028 6973 696e 7374 616e 6365 2861 7267   (isinstance(arg
-00025f10: 2c20 6e70 2e6e 6461 7272 6179 2920 616e  , np.ndarray) an
-00025f20: 6420 6172 672e 6e64 696d 203d 3d20 3029  d arg.ndim == 0)
-00025f30: 0a20 2020 2029 0a0a 0a64 6566 2062 726f  .    )...def bro
-00025f40: 6164 6361 7374 5f73 6861 7065 7328 2a73  adcast_shapes(*s
-00025f50: 6861 7065 7329 3a0a 2020 2020 2222 220a  hapes):.    """.
-00025f60: 2020 2020 4465 7465 726d 696e 6573 206f      Determines o
-00025f70: 7574 7075 7420 7368 6170 6520 6672 6f6d  utput shape from
-00025f80: 2062 726f 6164 6361 7374 696e 6720 6172   broadcasting ar
-00025f90: 7261 7973 2e0a 0a20 2020 2050 6172 616d  rays...    Param
-00025fa0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00025fb0: 2d2d 2d2d 0a20 2020 2073 6861 7065 7320  ----.    shapes 
-00025fc0: 3a20 7475 706c 6573 0a20 2020 2020 2020  : tuples.       
-00025fd0: 2054 6865 2073 6861 7065 7320 6f66 2074   The shapes of t
-00025fe0: 6865 2061 7267 756d 656e 7473 2e0a 0a20  he arguments... 
-00025ff0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00026000: 2d2d 2d2d 2d2d 0a20 2020 206f 7574 7075  ------.    outpu
-00026010: 745f 7368 6170 6520 3a20 7475 706c 650a  t_shape : tuple.
-00026020: 0a20 2020 2052 6169 7365 730a 2020 2020  .    Raises.    
-00026030: 2d2d 2d2d 2d2d 0a20 2020 2056 616c 7565  ------.    Value
-00026040: 4572 726f 720a 2020 2020 2020 2020 4966  Error.        If
-00026050: 2074 6865 2069 6e70 7574 2073 6861 7065   the input shape
-00026060: 7320 6361 6e6e 6f74 2062 6520 7375 6363  s cannot be succ
-00026070: 6573 7366 756c 6c79 2062 726f 6164 6361  essfully broadca
-00026080: 7374 2074 6f67 6574 6865 722e 0a20 2020  st together..   
-00026090: 2022 2222 0a20 2020 2069 6620 6c65 6e28   """.    if len(
-000260a0: 7368 6170 6573 2920 3d3d 2031 3a0a 2020  shapes) == 1:.  
-000260b0: 2020 2020 2020 7265 7475 726e 2073 6861        return sha
-000260c0: 7065 735b 305d 0a20 2020 206f 7574 203d  pes[0].    out =
-000260d0: 205b 5d0a 2020 2020 666f 7220 7369 7a65   [].    for size
-000260e0: 7320 696e 207a 6970 5f6c 6f6e 6765 7374  s in zip_longest
-000260f0: 282a 6d61 7028 7265 7665 7273 6564 2c20  (*map(reversed, 
-00026100: 7368 6170 6573 292c 2066 696c 6c76 616c  shapes), fillval
-00026110: 7565 3d2d 3129 3a0a 2020 2020 2020 2020  ue=-1):.        
-00026120: 6966 206e 702e 6973 6e61 6e28 7369 7a65  if np.isnan(size
-00026130: 7329 2e61 6e79 2829 3a0a 2020 2020 2020  s).any():.      
-00026140: 2020 2020 2020 6469 6d20 3d20 6e70 2e6e        dim = np.n
-00026150: 616e 0a20 2020 2020 2020 2065 6c73 653a  an.        else:
-00026160: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
-00026170: 203d 2030 2069 6620 3020 696e 2073 697a   = 0 if 0 in siz
-00026180: 6573 2065 6c73 6520 6e70 2e6d 6178 2873  es else np.max(s
-00026190: 697a 6573 290a 2020 2020 2020 2020 6966  izes).        if
-000261a0: 2061 6e79 2869 206e 6f74 2069 6e20 5b2d   any(i not in [-
-000261b0: 312c 2030 2c20 312c 2064 696d 5d20 616e  1, 0, 1, dim] an
-000261c0: 6420 6e6f 7420 6e70 2e69 736e 616e 2869  d not np.isnan(i
-000261d0: 2920 666f 7220 6920 696e 2073 697a 6573  ) for i in sizes
-000261e0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000261f0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00026200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026210: 2022 6f70 6572 616e 6473 2063 6f75 6c64   "operands could
-00026220: 206e 6f74 2062 6520 6272 6f61 6463 6173   not be broadcas
-00026230: 7420 746f 6765 7468 6572 2077 6974 6820  t together with 
-00026240: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00026250: 2020 2273 6861 7065 7320 7b7d 222e 666f    "shapes {}".fo
-00026260: 726d 6174 2822 2022 2e6a 6f69 6e28 6d61  rmat(" ".join(ma
-00026270: 7028 7374 722c 2073 6861 7065 7329 2929  p(str, shapes)))
-00026280: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00026290: 2020 2020 2020 206f 7574 2e61 7070 656e         out.appen
-000262a0: 6428 6469 6d29 0a20 2020 2072 6574 7572  d(dim).    retur
-000262b0: 6e20 7475 706c 6528 7265 7665 7273 6564  n tuple(reversed
-000262c0: 286f 7574 2929 0a0a 0a64 6566 2065 6c65  (out))...def ele
-000262d0: 6d77 6973 6528 6f70 2c20 2a61 7267 732c  mwise(op, *args,
-000262e0: 206f 7574 3d4e 6f6e 652c 2077 6865 7265   out=None, where
-000262f0: 3d54 7275 652c 2064 7479 7065 3d4e 6f6e  =True, dtype=Non
-00026300: 652c 206e 616d 653d 4e6f 6e65 2c20 2a2a  e, name=None, **
-00026310: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
-00026320: 4170 706c 7920 616e 2065 6c65 6d65 6e74  Apply an element
-00026330: 7769 7365 2075 6675 6e63 2d6c 696b 6520  wise ufunc-like 
-00026340: 6675 6e63 7469 6f6e 2062 6c6f 636b 7769  function blockwi
-00026350: 7365 2061 6372 6f73 7320 6172 6775 6d65  se across argume
-00026360: 6e74 732e 0a0a 2020 2020 4c69 6b65 206e  nts...    Like n
-00026370: 756d 7079 2075 6675 6e63 732c 2062 726f  umpy ufuncs, bro
-00026380: 6164 6361 7374 696e 6720 7275 6c65 7320  adcasting rules 
-00026390: 6172 6520 7265 7370 6563 7465 642e 0a0a  are respected...
-000263a0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-000263b0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-000263c0: 2020 6f70 203a 2063 616c 6c61 626c 650a    op : callable.
-000263d0: 2020 2020 2020 2020 5468 6520 6675 6e63          The func
-000263e0: 7469 6f6e 2074 6f20 6170 706c 792e 2053  tion to apply. S
-000263f0: 686f 756c 6420 6265 206e 756d 7079 2075  hould be numpy u
-00026400: 6675 6e63 2d6c 696b 6520 696e 2074 6865  func-like in the
-00026410: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
-00026420: 2020 2020 7468 6174 2069 7420 6163 6365      that it acce
-00026430: 7074 732e 0a20 2020 202a 6172 6773 203a  pts..    *args :
-00026440: 2041 6e79 0a20 2020 2020 2020 2041 7267   Any.        Arg
-00026450: 756d 656e 7473 2074 6f20 7061 7373 2074  uments to pass t
-00026460: 6f20 606f 7060 2e20 4e6f 6e2d 6461 736b  o `op`. Non-dask
-00026470: 2061 7272 6179 2d6c 696b 6520 6f62 6a65   array-like obje
-00026480: 6374 7320 6172 6520 6669 7273 740a 2020  cts are first.  
-00026490: 2020 2020 2020 636f 6e76 6572 7465 6420        converted 
-000264a0: 746f 2064 6173 6b20 6172 7261 7973 2c20  to dask arrays, 
-000264b0: 7468 656e 2061 6c6c 2061 7272 6179 7320  then all arrays 
-000264c0: 6172 6520 6272 6f61 6463 6173 7420 746f  are broadcast to
-000264d0: 6765 7468 6572 2062 6566 6f72 650a 2020  gether before.  
-000264e0: 2020 2020 2020 6170 706c 7969 6e67 2074        applying t
-000264f0: 6865 2066 756e 6374 696f 6e20 626c 6f63  he function bloc
-00026500: 6b77 6973 6520 6163 726f 7373 2061 6c6c  kwise across all
-00026510: 2061 7267 756d 656e 7473 2e20 416e 7920   arguments. Any 
-00026520: 7363 616c 6172 0a20 2020 2020 2020 2061  scalar.        a
-00026530: 7267 756d 656e 7473 2061 7265 2070 6173  rguments are pas
-00026540: 7365 6420 6173 2d69 7320 666f 6c6c 6f77  sed as-is follow
-00026550: 696e 6720 6e6f 726d 616c 206e 756d 7079  ing normal numpy
-00026560: 2075 6675 6e63 2062 6568 6176 696f 722e   ufunc behavior.
-00026570: 0a20 2020 206f 7574 203a 2064 6173 6b20  .    out : dask 
-00026580: 6172 7261 792c 206f 7074 696f 6e61 6c0a  array, optional.
-00026590: 2020 2020 2020 2020 4966 206f 7574 2069          If out i
-000265a0: 7320 6120 6461 736b 2e61 7272 6179 2074  s a dask.array t
-000265b0: 6865 6e20 7468 6973 206f 7665 7277 7269  hen this overwri
-000265c0: 7465 7320 7468 6520 636f 6e74 656e 7473  tes the contents
-000265d0: 206f 6620 7468 6174 2061 7272 6179 0a20   of that array. 
-000265e0: 2020 2020 2020 2077 6974 6820 7468 6520         with the 
-000265f0: 7265 7375 6c74 2e0a 2020 2020 7768 6572  result..    wher
-00026600: 6520 3a20 6172 7261 795f 6c69 6b65 2c20  e : array_like, 
-00026610: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00026620: 2041 6e20 6f70 7469 6f6e 616c 2062 6f6f   An optional boo
-00026630: 6c65 616e 206d 6173 6b20 6d61 726b 696e  lean mask markin
-00026640: 6720 6c6f 6361 7469 6f6e 7320 7768 6572  g locations wher
-00026650: 6520 7468 6520 7566 756e 6320 7368 6f75  e the ufunc shou
-00026660: 6c64 2062 650a 2020 2020 2020 2020 6170  ld be.        ap
-00026670: 706c 6965 642e 2043 616e 2062 6520 6120  plied. Can be a 
-00026680: 7363 616c 6172 2c20 6461 736b 2061 7272  scalar, dask arr
-00026690: 6179 2c20 6f72 2061 6e79 206f 7468 6572  ay, or any other
-000266a0: 2061 7272 6179 2d6c 696b 6520 6f62 6a65   array-like obje
-000266b0: 6374 2e0a 2020 2020 2020 2020 4d69 7272  ct..        Mirr
-000266c0: 6f72 7320 7468 6520 6060 7768 6572 6560  ors the ``where`
-000266d0: 6020 6172 6775 6d65 6e74 2074 6f20 6e75  ` argument to nu
-000266e0: 6d70 7920 7566 756e 6373 2c20 7365 6520  mpy ufuncs, see 
-000266f0: 652e 672e 2060 606e 756d 7079 2e61 6464  e.g. ``numpy.add
-00026700: 6060 0a20 2020 2020 2020 2066 6f72 206d  ``.        for m
-00026710: 6f72 6520 696e 666f 726d 6174 696f 6e2e  ore information.
-00026720: 0a20 2020 2064 7479 7065 203a 2064 7479  .    dtype : dty
-00026730: 7065 2c20 6f70 7469 6f6e 616c 0a20 2020  pe, optional.   
-00026740: 2020 2020 2049 6620 7072 6f76 6964 6564       If provided
-00026750: 2c20 6f76 6572 7269 6465 7320 7468 6520  , overrides the 
-00026760: 6f75 7470 7574 2061 7272 6179 2064 7479  output array dty
-00026770: 7065 2e0a 2020 2020 6e61 6d65 203a 2073  pe..    name : s
-00026780: 7472 2c20 6f70 7469 6f6e 616c 0a20 2020  tr, optional.   
-00026790: 2020 2020 2041 2075 6e69 7175 6520 6b65       A unique ke
-000267a0: 7920 6e61 6d65 2074 6f20 7573 6520 7768  y name to use wh
-000267b0: 656e 2062 7569 6c64 696e 6720 7468 6520  en building the 
-000267c0: 6261 636b 696e 6720 6461 736b 2067 7261  backing dask gra
-000267d0: 7068 2e20 4966 206e 6f74 0a20 2020 2020  ph. If not.     
-000267e0: 2020 2070 726f 7669 6465 642c 206f 6e65     provided, one
-000267f0: 2077 696c 6c20 6265 2061 7574 6f6d 6174   will be automat
-00026800: 6963 616c 6c79 2067 656e 6572 6174 6564  ically generated
-00026810: 2062 6173 6564 206f 6e20 7468 6520 696e   based on the in
-00026820: 7075 740a 2020 2020 2020 2020 6172 6775  put.        argu
-00026830: 6d65 6e74 732e 0a0a 2020 2020 4578 616d  ments...    Exam
-00026840: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
-00026850: 2d0a 2020 2020 3e3e 3e20 656c 656d 7769  -.    >>> elemwi
-00026860: 7365 2861 6464 2c20 782c 2079 2920 2023  se(add, x, y)  #
-00026870: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-00026880: 2020 2020 3e3e 3e20 656c 656d 7769 7365      >>> elemwise
-00026890: 2873 696e 2c20 7829 2020 2320 646f 6374  (sin, x)  # doct
-000268a0: 6573 743a 202b 534b 4950 0a20 2020 203e  est: +SKIP.    >
-000268b0: 3e3e 2065 6c65 6d77 6973 6528 7369 6e2c  >> elemwise(sin,
-000268c0: 2078 2c20 6f75 743d 6461 736b 5f61 7272   x, out=dask_arr
-000268d0: 6179 2920 2023 2064 6f63 7465 7374 3a20  ay)  # doctest: 
-000268e0: 2b53 4b49 500a 0a20 2020 2053 6565 2041  +SKIP..    See A
-000268f0: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
-00026900: 0a20 2020 2062 6c6f 636b 7769 7365 0a20  .    blockwise. 
-00026910: 2020 2022 2222 0a20 2020 2069 6620 6b77     """.    if kw
-00026920: 6172 6773 3a0a 2020 2020 2020 2020 7261  args:.        ra
-00026930: 6973 6520 5479 7065 4572 726f 7228 0a20  ise TypeError(. 
-00026940: 2020 2020 2020 2020 2020 2066 227b 6f70             f"{op
-00026950: 2e5f 5f6e 616d 655f 5f7d 2064 6f65 7320  .__name__} does 
-00026960: 6e6f 7420 7461 6b65 2074 6865 2066 6f6c  not take the fol
-00026970: 6c6f 7769 6e67 206b 6579 776f 7264 2061  lowing keyword a
-00026980: 7267 756d 656e 7473 2022 0a20 2020 2020  rguments ".     
-00026990: 2020 2020 2020 2066 227b 736f 7274 6564         f"{sorted
-000269a0: 286b 7761 7267 7329 7d22 0a20 2020 2020  (kwargs)}".     
-000269b0: 2020 2029 0a0a 2020 2020 6f75 7420 3d20     )..    out = 
-000269c0: 5f65 6c65 6d77 6973 655f 6e6f 726d 616c  _elemwise_normal
-000269d0: 697a 655f 6f75 7428 6f75 7429 0a20 2020  ize_out(out).   
-000269e0: 2077 6865 7265 203d 205f 656c 656d 7769   where = _elemwi
-000269f0: 7365 5f6e 6f72 6d61 6c69 7a65 5f77 6865  se_normalize_whe
-00026a00: 7265 2877 6865 7265 290a 2020 2020 6172  re(where).    ar
-00026a10: 6773 203d 205b 6e70 2e61 7361 7272 6179  gs = [np.asarray
-00026a20: 2861 2920 6966 2069 7369 6e73 7461 6e63  (a) if isinstanc
-00026a30: 6528 612c 2028 6c69 7374 2c20 7475 706c  e(a, (list, tupl
-00026a40: 6529 2920 656c 7365 2061 2066 6f72 2061  e)) else a for a
-00026a50: 2069 6e20 6172 6773 5d0a 0a20 2020 2073   in args]..    s
-00026a60: 6861 7065 7320 3d20 5b5d 0a20 2020 2066  hapes = [].    f
-00026a70: 6f72 2061 7267 2069 6e20 6172 6773 3a0a  or arg in args:.
-00026a80: 2020 2020 2020 2020 7368 6170 6520 3d20          shape = 
-00026a90: 6765 7461 7474 7228 6172 672c 2022 7368  getattr(arg, "sh
-00026aa0: 6170 6522 2c20 2829 290a 2020 2020 2020  ape", ()).      
-00026ab0: 2020 6966 2061 6e79 2869 735f 6461 736b    if any(is_dask
-00026ac0: 5f63 6f6c 6c65 6374 696f 6e28 7829 2066  _collection(x) f
-00026ad0: 6f72 2078 2069 6e20 7368 6170 6529 3a0a  or x in shape):.
-00026ae0: 2020 2020 2020 2020 2020 2020 2320 5761              # Wa
-00026af0: 6e74 2074 6f20 6578 636c 7564 6520 4465  nt to exclude De
-00026b00: 6c61 7965 6420 7368 6170 6573 2061 6e64  layed shapes and
-00026b10: 2064 642e 5363 616c 6172 0a20 2020 2020   dd.Scalar.     
-00026b20: 2020 2020 2020 2073 6861 7065 203d 2028         shape = (
-00026b30: 290a 2020 2020 2020 2020 7368 6170 6573  ).        shapes
-00026b40: 2e61 7070 656e 6428 7368 6170 6529 0a20  .append(shape). 
-00026b50: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00026b60: 2877 6865 7265 2c20 4172 7261 7929 3a0a  (where, Array):.
-00026b70: 2020 2020 2020 2020 7368 6170 6573 2e61          shapes.a
-00026b80: 7070 656e 6428 7768 6572 652e 7368 6170  ppend(where.shap
-00026b90: 6529 0a20 2020 2069 6620 6973 696e 7374  e).    if isinst
-00026ba0: 616e 6365 286f 7574 2c20 4172 7261 7929  ance(out, Array)
-00026bb0: 3a0a 2020 2020 2020 2020 7368 6170 6573  :.        shapes
-00026bc0: 2e61 7070 656e 6428 6f75 742e 7368 6170  .append(out.shap
-00026bd0: 6529 0a0a 2020 2020 7368 6170 6573 203d  e)..    shapes =
-00026be0: 205b 7320 6966 2069 7369 6e73 7461 6e63   [s if isinstanc
-00026bf0: 6528 732c 2049 7465 7261 626c 6529 2065  e(s, Iterable) e
-00026c00: 6c73 6520 2829 2066 6f72 2073 2069 6e20  lse () for s in 
-00026c10: 7368 6170 6573 5d0a 2020 2020 6f75 745f  shapes].    out_
-00026c20: 6e64 696d 203d 206c 656e 280a 2020 2020  ndim = len(.    
-00026c30: 2020 2020 6272 6f61 6463 6173 745f 7368      broadcast_sh
-00026c40: 6170 6573 282a 7368 6170 6573 290a 2020  apes(*shapes).  
-00026c50: 2020 2920 2023 2052 6169 7365 7320 5661    )  # Raises Va
-00026c60: 6c75 6545 7272 6f72 2069 6620 6469 6d65  lueError if dime
-00026c70: 6e73 696f 6e73 206d 6973 6d61 7463 680a  nsions mismatch.
-00026c80: 2020 2020 6578 7072 5f69 6e64 7320 3d20      expr_inds = 
-00026c90: 7475 706c 6528 7261 6e67 6528 6f75 745f  tuple(range(out_
-00026ca0: 6e64 696d 2929 5b3a 3a2d 315d 0a0a 2020  ndim))[::-1]..  
-00026cb0: 2020 6966 2064 7479 7065 2069 7320 6e6f    if dtype is no
-00026cc0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00026cd0: 6e65 6564 5f65 6e66 6f72 6365 5f64 7479  need_enforce_dty
-00026ce0: 7065 203d 2054 7275 650a 2020 2020 656c  pe = True.    el
-00026cf0: 7365 3a0a 2020 2020 2020 2020 2320 5765  se:.        # We
-00026d00: 2066 6f6c 6c6f 7720 4e75 6d50 7927 7320   follow NumPy's 
-00026d10: 7275 6c65 7320 666f 7220 6474 7970 6520  rules for dtype 
-00026d20: 7072 6f6d 6f74 696f 6e2c 2077 6869 6368  promotion, which
-00026d30: 2073 7065 6369 616c 2063 6173 6573 0a20   special cases. 
-00026d40: 2020 2020 2020 2023 2073 6361 6c61 7273         # scalars
-00026d50: 2061 6e64 2030 6420 6e64 6172 7261 7973   and 0d ndarrays
-00026d60: 2028 7768 6963 6820 6974 2063 6f6e 7369   (which it consi
-00026d70: 6465 7273 2065 7175 6976 616c 656e 7429  ders equivalent)
-00026d80: 2062 7920 7573 696e 670a 2020 2020 2020   by using.      
-00026d90: 2020 2320 7468 6569 7220 7661 6c75 6573    # their values
-00026da0: 2074 6f20 636f 6d70 7574 6520 7468 6520   to compute the 
-00026db0: 7265 7375 6c74 2064 7479 7065 3a0a 2020  result dtype:.  
-00026dc0: 2020 2020 2020 2320 6874 7470 733a 2f2f        # https://
-00026dd0: 6769 7468 7562 2e63 6f6d 2f6e 756d 7079  github.com/numpy
-00026de0: 2f6e 756d 7079 2f69 7373 7565 732f 3632  /numpy/issues/62
-00026df0: 3430 0a20 2020 2020 2020 2023 2057 6520  40.        # We 
-00026e00: 646f 6e27 7420 696e 7370 6563 7420 7468  don't inspect th
-00026e10: 6520 7661 6c75 6573 206f 6620 3064 2064  e values of 0d d
-00026e20: 6173 6b20 6172 7261 7973 2c20 6265 6361  ask arrays, beca
-00026e30: 7573 6520 7468 6573 6520 636f 756c 640a  use these could.
-00026e40: 2020 2020 2020 2020 2320 686f 6c64 2070          # hold p
-00026e50: 6f74 656e 7469 616c 6c79 2076 6572 7920  otentially very 
-00026e60: 6578 7065 6e73 6976 6520 6361 6c63 756c  expensive calcul
-00026e70: 6174 696f 6e73 2e20 496e 7374 6561 642c  ations. Instead,
-00026e80: 2077 6520 7472 6561 740a 2020 2020 2020   we treat.      
-00026e90: 2020 2320 7468 656d 206a 7573 7420 6c69    # them just li
-00026ea0: 6b65 206f 7468 6572 2061 7272 6179 732c  ke other arrays,
-00026eb0: 2061 6e64 2069 6620 6e65 6365 7373 6172   and if necessar
-00026ec0: 7920 6361 7374 2074 6865 2072 6573 756c  y cast the resul
-00026ed0: 7420 6f66 206f 700a 2020 2020 2020 2020  t of op.        
-00026ee0: 2320 746f 206d 6174 6368 2e0a 2020 2020  # to match..    
-00026ef0: 2020 2020 7661 6c73 203d 205b 0a20 2020      vals = [.   
-00026f00: 2020 2020 2020 2020 206e 702e 656d 7074           np.empt
-00026f10: 7928 2831 2c29 202a 206d 6178 2831 2c20  y((1,) * max(1, 
-00026f20: 612e 6e64 696d 292c 2064 7479 7065 3d61  a.ndim), dtype=a
-00026f30: 2e64 7479 7065 290a 2020 2020 2020 2020  .dtype).        
-00026f40: 2020 2020 6966 206e 6f74 2069 735f 7363      if not is_sc
-00026f50: 616c 6172 5f66 6f72 5f65 6c65 6d77 6973  alar_for_elemwis
-00026f60: 6528 6129 0a20 2020 2020 2020 2020 2020  e(a).           
-00026f70: 2065 6c73 6520 610a 2020 2020 2020 2020   else a.        
-00026f80: 2020 2020 666f 7220 6120 696e 2061 7267      for a in arg
-00026f90: 730a 2020 2020 2020 2020 5d0a 2020 2020  s.        ].    
-00026fa0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00026fb0: 2020 2020 2064 7479 7065 203d 2061 7070       dtype = app
-00026fc0: 6c79 5f69 6e66 6572 5f64 7479 7065 286f  ly_infer_dtype(o
-00026fd0: 702c 2076 616c 732c 207b 7d2c 2022 656c  p, vals, {}, "el
-00026fe0: 656d 7769 7365 222c 2073 7567 6765 7374  emwise", suggest
-00026ff0: 5f64 7479 7065 3d46 616c 7365 290a 2020  _dtype=False).  
-00027000: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00027010: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00027020: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
-00027030: 706c 656d 656e 7465 640a 2020 2020 2020  plemented.      
-00027040: 2020 6e65 6564 5f65 6e66 6f72 6365 5f64    need_enforce_d
-00027050: 7479 7065 203d 2061 6e79 280a 2020 2020  type = any(.    
-00027060: 2020 2020 2020 2020 6e6f 7420 6973 5f73          not is_s
-00027070: 6361 6c61 725f 666f 725f 656c 656d 7769  calar_for_elemwi
-00027080: 7365 2861 2920 616e 6420 612e 6e64 696d  se(a) and a.ndim
-00027090: 203d 3d20 3020 666f 7220 6120 696e 2061   == 0 for a in a
-000270a0: 7267 730a 2020 2020 2020 2020 290a 0a20  rgs.        ).. 
-000270b0: 2020 2069 6620 6e6f 7420 6e61 6d65 3a0a     if not name:.
-000270c0: 2020 2020 2020 2020 6e61 6d65 203d 2066          name = f
-000270d0: 227b 6675 6e63 6e61 6d65 286f 7029 7d2d  "{funcname(op)}-
-000270e0: 7b74 6f6b 656e 697a 6528 6f70 2c20 6474  {tokenize(op, dt
-000270f0: 7970 652c 202a 6172 6773 2c20 7768 6572  ype, *args, wher
-00027100: 6529 7d22 0a0a 2020 2020 626c 6f63 6b77  e)}"..    blockw
-00027110: 6973 655f 6b77 6172 6773 203d 2064 6963  ise_kwargs = dic
-00027120: 7428 6474 7970 653d 6474 7970 652c 206e  t(dtype=dtype, n
-00027130: 616d 653d 6e61 6d65 2c20 746f 6b65 6e3d  ame=name, token=
-00027140: 6675 6e63 6e61 6d65 286f 7029 2e73 7472  funcname(op).str
-00027150: 6970 2822 5f22 2929 0a0a 2020 2020 6966  ip("_"))..    if
-00027160: 2077 6865 7265 2069 7320 6e6f 7420 5472   where is not Tr
-00027170: 7565 3a0a 2020 2020 2020 2020 626c 6f63  ue:.        bloc
-00027180: 6b77 6973 655f 6b77 6172 6773 5b22 656c  kwise_kwargs["el
-00027190: 656d 7769 7365 5f77 6865 7265 5f66 756e  emwise_where_fun
-000271a0: 6374 696f 6e22 5d20 3d20 6f70 0a20 2020  ction"] = op.   
-000271b0: 2020 2020 206f 7020 3d20 5f65 6c65 6d77       op = _elemw
-000271c0: 6973 655f 6861 6e64 6c65 5f77 6865 7265  ise_handle_where
-000271d0: 0a20 2020 2020 2020 2061 7267 732e 6578  .        args.ex
-000271e0: 7465 6e64 285b 7768 6572 652c 206f 7574  tend([where, out
-000271f0: 5d29 0a0a 2020 2020 6966 206e 6565 645f  ])..    if need_
-00027200: 656e 666f 7263 655f 6474 7970 653a 0a20  enforce_dtype:. 
-00027210: 2020 2020 2020 2062 6c6f 636b 7769 7365         blockwise
-00027220: 5f6b 7761 7267 735b 2265 6e66 6f72 6365  _kwargs["enforce
-00027230: 5f64 7479 7065 225d 203d 2064 7479 7065  _dtype"] = dtype
-00027240: 0a20 2020 2020 2020 2062 6c6f 636b 7769  .        blockwi
-00027250: 7365 5f6b 7761 7267 735b 2265 6e66 6f72  se_kwargs["enfor
-00027260: 6365 5f64 7479 7065 5f66 756e 6374 696f  ce_dtype_functio
-00027270: 6e22 5d20 3d20 6f70 0a20 2020 2020 2020  n"] = op.       
-00027280: 206f 7020 3d20 5f65 6e66 6f72 6365 5f64   op = _enforce_d
-00027290: 7479 7065 0a0a 2020 2020 7265 7375 6c74  type..    result
-000272a0: 203d 2062 6c6f 636b 7769 7365 280a 2020   = blockwise(.  
-000272b0: 2020 2020 2020 6f70 2c0a 2020 2020 2020        op,.      
-000272c0: 2020 6578 7072 5f69 6e64 732c 0a20 2020    expr_inds,.   
-000272d0: 2020 2020 202a 636f 6e63 6174 280a 2020       *concat(.  
-000272e0: 2020 2020 2020 2020 2020 2861 2c20 7475            (a, tu
-000272f0: 706c 6528 7261 6e67 6528 612e 6e64 696d  ple(range(a.ndim
-00027300: 295b 3a3a 2d31 5d29 2069 6620 6e6f 7420  )[::-1]) if not 
-00027310: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
-00027320: 656d 7769 7365 2861 2920 656c 7365 204e  emwise(a) else N
-00027330: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-00027340: 2066 6f72 2061 2069 6e20 6172 6773 0a20   for a in args. 
-00027350: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00027360: 2020 2a2a 626c 6f63 6b77 6973 655f 6b77    **blockwise_kw
-00027370: 6172 6773 2c0a 2020 2020 290a 0a20 2020  args,.    )..   
-00027380: 2072 6574 7572 6e20 6861 6e64 6c65 5f6f   return handle_o
-00027390: 7574 286f 7574 2c20 7265 7375 6c74 290a  ut(out, result).
-000273a0: 0a0a 6465 6620 5f65 6c65 6d77 6973 655f  ..def _elemwise_
-000273b0: 6e6f 726d 616c 697a 655f 7768 6572 6528  normalize_where(
-000273c0: 7768 6572 6529 3a0a 2020 2020 6966 2077  where):.    if w
-000273d0: 6865 7265 2069 7320 5472 7565 3a0a 2020  here is True:.  
-000273e0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-000273f0: 650a 2020 2020 656c 6966 2077 6865 7265  e.    elif where
-00027400: 2069 7320 4661 6c73 6520 6f72 2077 6865   is False or whe
-00027410: 7265 2069 7320 4e6f 6e65 3a0a 2020 2020  re is None:.    
-00027420: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00027430: 0a20 2020 2072 6574 7572 6e20 6173 6172  .    return asar
-00027440: 7261 7928 7768 6572 6529 0a0a 0a64 6566  ray(where)...def
-00027450: 205f 656c 656d 7769 7365 5f68 616e 646c   _elemwise_handl
-00027460: 655f 7768 6572 6528 2a61 7267 732c 202a  e_where(*args, *
-00027470: 2a6b 7761 7267 7329 3a0a 2020 2020 6675  *kwargs):.    fu
-00027480: 6e63 7469 6f6e 203d 206b 7761 7267 732e  nction = kwargs.
-00027490: 706f 7028 2265 6c65 6d77 6973 655f 7768  pop("elemwise_wh
-000274a0: 6572 655f 6675 6e63 7469 6f6e 2229 0a20  ere_function"). 
-000274b0: 2020 202a 6172 6773 2c20 7768 6572 652c     *args, where,
-000274c0: 206f 7574 203d 2061 7267 730a 2020 2020   out = args.    
-000274d0: 6966 2068 6173 6174 7472 286f 7574 2c20  if hasattr(out, 
-000274e0: 2263 6f70 7922 293a 0a20 2020 2020 2020  "copy"):.       
-000274f0: 206f 7574 203d 206f 7574 2e63 6f70 7928   out = out.copy(
-00027500: 290a 2020 2020 7265 7475 726e 2066 756e  ).    return fun
-00027510: 6374 696f 6e28 2a61 7267 732c 2077 6865  ction(*args, whe
-00027520: 7265 3d77 6865 7265 2c20 6f75 743d 6f75  re=where, out=ou
-00027530: 742c 202a 2a6b 7761 7267 7329 0a0a 0a64  t, **kwargs)...d
-00027540: 6566 205f 656c 656d 7769 7365 5f6e 6f72  ef _elemwise_nor
-00027550: 6d61 6c69 7a65 5f6f 7574 286f 7574 293a  malize_out(out):
-00027560: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00027570: 6365 286f 7574 2c20 7475 706c 6529 3a0a  ce(out, tuple):.
-00027580: 2020 2020 2020 2020 6966 206c 656e 286f          if len(o
-00027590: 7574 2920 3d3d 2031 3a0a 2020 2020 2020  ut) == 1:.      
-000275a0: 2020 2020 2020 6f75 7420 3d20 6f75 745b        out = out[
-000275b0: 305d 0a20 2020 2020 2020 2065 6c69 6620  0].        elif 
-000275c0: 6c65 6e28 6f75 7429 203e 2031 3a0a 2020  len(out) > 1:.  
-000275d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000275e0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-000275f0: 726f 7228 2254 6865 206f 7574 2070 6172  ror("The out par
-00027600: 616d 6574 6572 2069 7320 6e6f 7420 6675  ameter is not fu
-00027610: 6c6c 7920 7375 7070 6f72 7465 6422 290a  lly supported").
-00027620: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00027630: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-00027640: 4e6f 6e65 0a20 2020 2069 6620 6e6f 7420  None.    if not 
-00027650: 286f 7574 2069 7320 4e6f 6e65 206f 7220  (out is None or 
-00027660: 6973 696e 7374 616e 6365 286f 7574 2c20  isinstance(out, 
-00027670: 4172 7261 7929 293a 0a20 2020 2020 2020  Array)):.       
-00027680: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-00027690: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
-000276a0: 2020 2020 2020 2020 6622 5468 6520 6f75          f"The ou
-000276b0: 7420 7061 7261 6d65 7465 7220 6973 206e  t parameter is n
-000276c0: 6f74 2066 756c 6c79 2073 7570 706f 7274  ot fully support
-000276d0: 6564 2e22 0a20 2020 2020 2020 2020 2020  ed.".           
-000276e0: 2066 2220 5265 6365 6976 6564 2074 7970   f" Received typ
-000276f0: 6520 7b74 7970 6528 6f75 7429 2e5f 5f6e  e {type(out).__n
-00027700: 616d 655f 5f7d 2c20 6578 7065 6374 6564  ame__}, expected
-00027710: 2044 6173 6b20 4172 7261 7922 0a20 2020   Dask Array".   
-00027720: 2020 2020 2029 0a20 2020 2072 6574 7572       ).    retur
-00027730: 6e20 6f75 740a 0a0a 6465 6620 6861 6e64  n out...def hand
-00027740: 6c65 5f6f 7574 286f 7574 2c20 7265 7375  le_out(out, resu
-00027750: 6c74 293a 0a20 2020 2022 2222 4861 6e64  lt):.    """Hand
-00027760: 6c65 206f 7574 2070 6172 616d 6574 6572  le out parameter
-00027770: 730a 0a20 2020 2049 6620 6f75 7420 6973  s..    If out is
-00027780: 2061 2064 6173 6b2e 6172 7261 7920 7468   a dask.array th
-00027790: 656e 2074 6869 7320 6f76 6572 7772 6974  en this overwrit
-000277a0: 6573 2074 6865 2063 6f6e 7465 6e74 7320  es the contents 
-000277b0: 6f66 2074 6861 7420 6172 7261 7920 7769  of that array wi
-000277c0: 7468 0a20 2020 2074 6865 2072 6573 756c  th.    the resul
-000277d0: 740a 2020 2020 2222 220a 2020 2020 6f75  t.    """.    ou
-000277e0: 7420 3d20 5f65 6c65 6d77 6973 655f 6e6f  t = _elemwise_no
-000277f0: 726d 616c 697a 655f 6f75 7428 6f75 7429  rmalize_out(out)
-00027800: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00027810: 6365 286f 7574 2c20 4172 7261 7929 3a0a  ce(out, Array):.
-00027820: 2020 2020 2020 2020 6966 206f 7574 2e73          if out.s
-00027830: 6861 7065 2021 3d20 7265 7375 6c74 2e73  hape != result.s
-00027840: 6861 7065 3a0a 2020 2020 2020 2020 2020  hape:.          
-00027850: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00027860: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00027870: 2020 2020 224d 6973 6d61 7463 6865 6420      "Mismatched 
-00027880: 7368 6170 6573 2062 6574 7765 656e 2072  shapes between r
-00027890: 6573 756c 7420 616e 6420 6f75 7420 7061  esult and out pa
-000278a0: 7261 6d65 7465 722e 2022 0a20 2020 2020  rameter. ".     
-000278b0: 2020 2020 2020 2020 2020 2022 6f75 743d             "out=
-000278c0: 2573 2c20 7265 7375 6c74 3d25 7322 2025  %s, result=%s" %
-000278d0: 2028 7374 7228 6f75 742e 7368 6170 6529   (str(out.shape)
-000278e0: 2c20 7374 7228 7265 7375 6c74 2e73 6861  , str(result.sha
-000278f0: 7065 2929 0a20 2020 2020 2020 2020 2020  pe)).           
-00027900: 2029 0a20 2020 2020 2020 206f 7574 2e5f   ).        out._
-00027910: 6368 756e 6b73 203d 2072 6573 756c 742e  chunks = result.
-00027920: 6368 756e 6b73 0a20 2020 2020 2020 206f  chunks.        o
-00027930: 7574 2e64 6173 6b20 3d20 7265 7375 6c74  ut.dask = result
-00027940: 2e64 6173 6b0a 2020 2020 2020 2020 6f75  .dask.        ou
-00027950: 742e 5f6d 6574 6120 3d20 7265 7375 6c74  t._meta = result
-00027960: 2e5f 6d65 7461 0a20 2020 2020 2020 206f  ._meta.        o
-00027970: 7574 2e5f 6e61 6d65 203d 2072 6573 756c  ut._name = resul
-00027980: 742e 6e61 6d65 0a20 2020 2020 2020 2072  t.name.        r
-00027990: 6574 7572 6e20 6f75 740a 2020 2020 656c  eturn out.    el
-000279a0: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
-000279b0: 726e 2072 6573 756c 740a 0a0a 6465 6620  rn result...def 
-000279c0: 5f65 6e66 6f72 6365 5f64 7479 7065 282a  _enforce_dtype(*
-000279d0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-000279e0: 0a20 2020 2022 2222 4361 6c6c 7320 6120  .    """Calls a 
-000279f0: 6675 6e63 7469 6f6e 2061 6e64 2063 6f6e  function and con
-00027a00: 7665 7274 7320 6974 7320 7265 7375 6c74  verts its result
-00027a10: 2074 6f20 7468 6520 6769 7665 6e20 6474   to the given dt
-00027a20: 7970 652e 0a0a 2020 2020 5468 6520 7061  ype...    The pa
-00027a30: 7261 6d65 7465 7273 2068 6176 6520 6465  rameters have de
-00027a40: 6c69 6265 7261 7465 6c79 2062 6565 6e20  liberately been 
-00027a50: 6769 7665 6e20 756e 7769 656c 6479 206e  given unwieldy n
-00027a60: 616d 6573 2074 6f20 6176 6f69 640a 2020  ames to avoid.  
-00027a70: 2020 636c 6173 6865 7320 7769 7468 206b    clashes with k
-00027a80: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
-00027a90: 2063 6f6e 7375 6d65 6420 6279 2062 6c6f   consumed by blo
-00027aa0: 636b 7769 7365 0a0a 2020 2020 4120 6474  ckwise..    A dt
-00027ab0: 7970 6520 6f66 2060 6f62 6a65 6374 6020  ype of `object` 
-00027ac0: 6973 2074 7265 6174 6564 2061 7320 6120  is treated as a 
-00027ad0: 7370 6563 6961 6c20 6361 7365 2061 6e64  special case and
-00027ae0: 206e 6f74 2065 6e66 6f72 6365 642c 0a20   not enforced,. 
-00027af0: 2020 2062 6563 6175 7365 2069 7420 6973     because it is
-00027b00: 2075 7365 6420 6173 2061 2064 756d 6d79   used as a dummy
-00027b10: 2076 616c 7565 2069 6e20 736f 6d65 2070   value in some p
-00027b20: 6c61 6365 7320 7768 656e 2074 6865 2072  laces when the r
-00027b30: 6573 756c 7420 7769 6c6c 0a20 2020 206e  esult will.    n
-00027b40: 6f74 2062 6520 6120 626c 6f63 6b20 696e  ot be a block in
-00027b50: 2061 6e20 4172 7261 792e 0a0a 2020 2020   an Array...    
-00027b60: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-00027b70: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 656e  ---------.    en
-00027b80: 666f 7263 655f 6474 7970 6520 3a20 6474  force_dtype : dt
-00027b90: 7970 650a 2020 2020 2020 2020 5265 7375  ype.        Resu
-00027ba0: 6c74 2064 7479 7065 0a20 2020 2065 6e66  lt dtype.    enf
-00027bb0: 6f72 6365 5f64 7479 7065 5f66 756e 6374  orce_dtype_funct
-00027bc0: 696f 6e20 3a20 6361 6c6c 6162 6c65 0a20  ion : callable. 
-00027bd0: 2020 2020 2020 2054 6865 2077 7261 7070         The wrapp
-00027be0: 6564 2066 756e 6374 696f 6e2c 2077 6869  ed function, whi
-00027bf0: 6368 2077 696c 6c20 6265 2070 6173 7365  ch will be passe
-00027c00: 6420 7468 6520 7265 6d61 696e 696e 6720  d the remaining 
-00027c10: 6172 6775 6d65 6e74 730a 2020 2020 2222  arguments.    ""
-00027c20: 220a 2020 2020 6474 7970 6520 3d20 6b77  ".    dtype = kw
-00027c30: 6172 6773 2e70 6f70 2822 656e 666f 7263  args.pop("enforc
-00027c40: 655f 6474 7970 6522 290a 2020 2020 6675  e_dtype").    fu
-00027c50: 6e63 7469 6f6e 203d 206b 7761 7267 732e  nction = kwargs.
-00027c60: 706f 7028 2265 6e66 6f72 6365 5f64 7479  pop("enforce_dty
-00027c70: 7065 5f66 756e 6374 696f 6e22 290a 0a20  pe_function").. 
-00027c80: 2020 2072 6573 756c 7420 3d20 6675 6e63     result = func
-00027c90: 7469 6f6e 282a 6172 6773 2c20 2a2a 6b77  tion(*args, **kw
-00027ca0: 6172 6773 290a 2020 2020 6966 2068 6173  args).    if has
-00027cb0: 6174 7472 2872 6573 756c 742c 2022 6474  attr(result, "dt
-00027cc0: 7970 6522 2920 616e 6420 6474 7970 6520  ype") and dtype 
-00027cd0: 213d 2072 6573 756c 742e 6474 7970 6520  != result.dtype 
-00027ce0: 616e 6420 6474 7970 6520 213d 206f 626a  and dtype != obj
-00027cf0: 6563 743a 0a20 2020 2020 2020 2069 6620  ect:.        if 
-00027d00: 6e6f 7420 6e70 2e63 616e 5f63 6173 7428  not np.can_cast(
-00027d10: 7265 7375 6c74 2c20 6474 7970 652c 2063  result, dtype, c
-00027d20: 6173 7469 6e67 3d22 7361 6d65 5f6b 696e  asting="same_kin
-00027d30: 6422 293a 0a20 2020 2020 2020 2020 2020  d"):.           
-00027d40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00027d50: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00027d60: 2020 2022 496e 6665 7272 6564 2064 7479     "Inferred dty
-00027d70: 7065 2066 726f 6d20 6675 6e63 7469 6f6e  pe from function
-00027d80: 2025 7220 7761 7320 2572 2022 0a20 2020   %r was %r ".   
-00027d90: 2020 2020 2020 2020 2020 2020 2022 6275               "bu
-00027da0: 7420 676f 7420 2572 2c20 7768 6963 6820  t got %r, which 
-00027db0: 6361 6e27 7420 6265 2063 6173 7420 7573  can't be cast us
-00027dc0: 696e 6720 220a 2020 2020 2020 2020 2020  ing ".          
-00027dd0: 2020 2020 2020 2263 6173 7469 6e67 3d27        "casting='
-00027de0: 7361 6d65 5f6b 696e 6427 220a 2020 2020  same_kind'".    
-00027df0: 2020 2020 2020 2020 2020 2020 2520 2866              % (f
-00027e00: 756e 636e 616d 6528 6675 6e63 7469 6f6e  uncname(function
-00027e10: 292c 2073 7472 2864 7479 7065 292c 2073  ), str(dtype), s
-00027e20: 7472 2872 6573 756c 742e 6474 7970 6529  tr(result.dtype)
-00027e30: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00027e40: 2020 2020 2020 2020 6966 206e 702e 6973          if np.is
-00027e50: 7363 616c 6172 2872 6573 756c 7429 3a0a  scalar(result):.
-00027e60: 2020 2020 2020 2020 2020 2020 2320 7363              # sc
-00027e70: 616c 6172 2061 7374 7970 6520 6d65 7468  alar astype meth
-00027e80: 6f64 2064 6f65 736e 2774 2074 616b 6520  od doesn't take 
-00027e90: 7468 6520 6b65 7977 6f72 6420 6172 6775  the keyword argu
-00027ea0: 6d65 6e74 732c 2073 6f0a 2020 2020 2020  ments, so.      
-00027eb0: 2020 2020 2020 2320 6861 7665 2074 6f20        # have to 
-00027ec0: 636f 6e76 6572 7420 7669 6120 302d 6469  convert via 0-di
-00027ed0: 6d65 6e73 696f 6e61 6c20 6172 7261 7920  mensional array 
-00027ee0: 616e 6420 6261 636b 2e0a 2020 2020 2020  and back..      
-00027ef0: 2020 2020 2020 7265 7375 6c74 203d 2072        result = r
-00027f00: 6573 756c 742e 6173 7479 7065 2864 7479  esult.astype(dty
-00027f10: 7065 290a 2020 2020 2020 2020 656c 7365  pe).        else
-00027f20: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
-00027f30: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00027f40: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
-00027f50: 6c74 2e61 7374 7970 6528 6474 7970 652c  lt.astype(dtype,
-00027f60: 2063 6f70 793d 4661 6c73 6529 0a20 2020   copy=False).   
-00027f70: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00027f80: 5479 7065 4572 726f 723a 0a20 2020 2020  TypeError:.     
-00027f90: 2020 2020 2020 2020 2020 2023 204d 6973             # Mis
-00027fa0: 7369 6e67 2063 6f70 7920 6b77 6172 670a  sing copy kwarg.
-00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fc0: 7265 7375 6c74 203d 2072 6573 756c 742e  result = result.
-00027fd0: 6173 7479 7065 2864 7479 7065 290a 2020  astype(dtype).  
-00027fe0: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-00027ff0: 0a0a 6465 6620 6272 6f61 6463 6173 745f  ..def broadcast_
-00028000: 746f 2878 2c20 7368 6170 652c 2063 6875  to(x, shape, chu
-00028010: 6e6b 733d 4e6f 6e65 2c20 6d65 7461 3d4e  nks=None, meta=N
-00028020: 6f6e 6529 3a0a 2020 2020 2222 2242 726f  one):.    """Bro
-00028030: 6164 6361 7374 2061 6e20 6172 7261 7920  adcast an array 
-00028040: 746f 2061 206e 6577 2073 6861 7065 2e0a  to a new shape..
-00028050: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00028060: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00028070: 2020 2078 203a 2061 7272 6179 5f6c 696b     x : array_lik
-00028080: 650a 2020 2020 2020 2020 5468 6520 6172  e.        The ar
-00028090: 7261 7920 746f 2062 726f 6164 6361 7374  ray to broadcast
-000280a0: 2e0a 2020 2020 7368 6170 6520 3a20 7475  ..    shape : tu
-000280b0: 706c 650a 2020 2020 2020 2020 5468 6520  ple.        The 
-000280c0: 7368 6170 6520 6f66 2074 6865 2064 6573  shape of the des
-000280d0: 6972 6564 2061 7272 6179 2e0a 2020 2020  ired array..    
-000280e0: 6368 756e 6b73 203a 2074 7570 6c65 2c20  chunks : tuple, 
-000280f0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00028100: 2049 6620 7072 6f76 6964 6564 2c20 7468   If provided, th
-00028110: 656e 2074 6865 2072 6573 756c 7420 7769  en the result wi
-00028120: 6c6c 2075 7365 2074 6865 7365 2063 6875  ll use these chu
-00028130: 6e6b 7320 696e 7374 6561 6420 6f66 2074  nks instead of t
-00028140: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
-00028150: 6368 756e 6b73 2061 7320 7468 6520 736f  chunks as the so
-00028160: 7572 6365 2061 7272 6179 2e20 5365 7474  urce array. Sett
-00028170: 696e 6720 6368 756e 6b73 2065 7870 6c69  ing chunks expli
-00028180: 6369 746c 7920 6173 2070 6172 7420 6f66  citly as part of
-00028190: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
-000281a0: 7374 5f74 6f20 6973 206d 6f72 6520 6566  st_to is more ef
-000281b0: 6669 6369 656e 7420 7468 616e 2072 6563  ficient than rec
-000281c0: 6875 6e6b 696e 6720 6166 7465 7277 6172  hunking afterwar
-000281d0: 6473 2e20 4368 756e 6b73 2061 7265 0a20  ds. Chunks are. 
-000281e0: 2020 2020 2020 206f 6e6c 7920 616c 6c6f         only allo
-000281f0: 7765 6420 746f 2064 6966 6665 7220 6672  wed to differ fr
-00028200: 6f6d 2074 6865 206f 7269 6769 6e61 6c20  om the original 
-00028210: 7368 6170 6520 616c 6f6e 6720 6469 6d65  shape along dime
-00028220: 6e73 696f 6e73 2074 6861 740a 2020 2020  nsions that.    
-00028230: 2020 2020 6172 6520 6e65 7720 6f6e 2074      are new on t
-00028240: 6865 2072 6573 756c 7420 6f72 2068 6176  he result or hav
-00028250: 6520 7369 7a65 2031 2074 6865 2069 6e70  e size 1 the inp
-00028260: 7574 2061 7272 6179 2e0a 2020 2020 6d65  ut array..    me
-00028270: 7461 203a 2065 6d70 7479 206e 6461 7272  ta : empty ndarr
-00028280: 6179 0a20 2020 2020 2020 2065 6d70 7479  ay.        empty
-00028290: 206e 6461 7272 6179 2063 7265 6174 6564   ndarray created
-000282a0: 2077 6974 6820 7361 6d65 204e 756d 5079   with same NumPy
-000282b0: 2062 6163 6b65 6e64 2c20 6e64 696d 2061   backend, ndim a
-000282c0: 6e64 2064 7479 7065 2061 7320 7468 650a  nd dtype as the.
-000282d0: 2020 2020 2020 2020 4461 736b 2041 7272          Dask Arr
-000282e0: 6179 2062 6569 6e67 2063 7265 6174 6564  ay being created
-000282f0: 2028 6f76 6572 7269 6465 7320 6474 7970   (overrides dtyp
-00028300: 6529 0a0a 2020 2020 5265 7475 726e 730a  e)..    Returns.
-00028310: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00028320: 6272 6f61 6463 6173 7420 3a20 6461 736b  broadcast : dask
-00028330: 2061 7272 6179 0a0a 2020 2020 5365 6520   array..    See 
-00028340: 416c 736f 0a20 2020 202d 2d2d 2d2d 2d2d  Also.    -------
-00028350: 2d0a 2020 2020 3a66 756e 633a 606e 756d  -.    :func:`num
-00028360: 7079 2e62 726f 6164 6361 7374 5f74 6f60  py.broadcast_to`
-00028370: 0a20 2020 2022 2222 0a20 2020 2078 203d  .    """.    x =
-00028380: 2061 7361 7272 6179 2878 290a 2020 2020   asarray(x).    
-00028390: 7368 6170 6520 3d20 7475 706c 6528 7368  shape = tuple(sh
-000283a0: 6170 6529 0a0a 2020 2020 6966 206d 6574  ape)..    if met
-000283b0: 6120 6973 204e 6f6e 653a 0a20 2020 2020  a is None:.     
-000283c0: 2020 206d 6574 6120 3d20 6d65 7461 5f66     meta = meta_f
-000283d0: 726f 6d5f 6172 7261 7928 7829 0a0a 2020  rom_array(x)..  
-000283e0: 2020 6966 2078 2e73 6861 7065 203d 3d20    if x.shape == 
-000283f0: 7368 6170 6520 616e 6420 2863 6875 6e6b  shape and (chunk
-00028400: 7320 6973 204e 6f6e 6520 6f72 2063 6875  s is None or chu
-00028410: 6e6b 7320 3d3d 2078 2e63 6875 6e6b 7329  nks == x.chunks)
-00028420: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00028430: 2078 0a0a 2020 2020 6e64 696d 5f6e 6577   x..    ndim_new
-00028440: 203d 206c 656e 2873 6861 7065 2920 2d20   = len(shape) - 
-00028450: 782e 6e64 696d 0a20 2020 2069 6620 6e64  x.ndim.    if nd
-00028460: 696d 5f6e 6577 203c 2030 206f 7220 616e  im_new < 0 or an
-00028470: 7928 0a20 2020 2020 2020 206e 6577 2021  y(.        new !
-00028480: 3d20 6f6c 6420 666f 7220 6e65 772c 206f  = old for new, o
-00028490: 6c64 2069 6e20 7a69 7028 7368 6170 655b  ld in zip(shape[
-000284a0: 6e64 696d 5f6e 6577 3a5d 2c20 782e 7368  ndim_new:], x.sh
-000284b0: 6170 6529 2069 6620 6f6c 6420 213d 2031  ape) if old != 1
-000284c0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000284d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000284e0: 2866 2263 616e 6e6f 7420 6272 6f61 6463  (f"cannot broadc
-000284f0: 6173 7420 7368 6170 6520 7b78 2e73 6861  ast shape {x.sha
-00028500: 7065 7d20 746f 2073 6861 7065 207b 7368  pe} to shape {sh
-00028510: 6170 657d 2229 0a0a 2020 2020 6966 2063  ape}")..    if c
-00028520: 6875 6e6b 7320 6973 204e 6f6e 653a 0a20  hunks is None:. 
-00028530: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
-00028540: 7475 706c 6528 2873 2c29 2066 6f72 2073  tuple((s,) for s
-00028550: 2069 6e20 7368 6170 655b 3a6e 6469 6d5f   in shape[:ndim_
-00028560: 6e65 775d 2920 2b20 7475 706c 6528 0a20  new]) + tuple(. 
-00028570: 2020 2020 2020 2020 2020 2062 6420 6966             bd if
-00028580: 206f 6c64 203e 2031 2065 6c73 6520 286e   old > 1 else (n
-00028590: 6577 2c29 0a20 2020 2020 2020 2020 2020  ew,).           
-000285a0: 2066 6f72 2062 642c 206f 6c64 2c20 6e65   for bd, old, ne
-000285b0: 7720 696e 207a 6970 2878 2e63 6875 6e6b  w in zip(x.chunk
-000285c0: 732c 2078 2e73 6861 7065 2c20 7368 6170  s, x.shape, shap
-000285d0: 655b 6e64 696d 5f6e 6577 3a5d 290a 2020  e[ndim_new:]).  
-000285e0: 2020 2020 2020 290a 2020 2020 656c 7365        ).    else
-000285f0: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
-00028600: 203d 206e 6f72 6d61 6c69 7a65 5f63 6875   = normalize_chu
-00028610: 6e6b 7328 0a20 2020 2020 2020 2020 2020  nks(.           
-00028620: 2063 6875 6e6b 732c 2073 6861 7065 2c20   chunks, shape, 
-00028630: 6474 7970 653d 782e 6474 7970 652c 2070  dtype=x.dtype, p
-00028640: 7265 7669 6f75 735f 6368 756e 6b73 3d78  revious_chunks=x
-00028650: 2e63 6875 6e6b 730a 2020 2020 2020 2020  .chunks.        
-00028660: 290a 2020 2020 2020 2020 666f 7220 6f6c  ).        for ol
-00028670: 645f 6264 2c20 6e65 775f 6264 2069 6e20  d_bd, new_bd in 
-00028680: 7a69 7028 782e 6368 756e 6b73 2c20 6368  zip(x.chunks, ch
-00028690: 756e 6b73 5b6e 6469 6d5f 6e65 773a 5d29  unks[ndim_new:])
-000286a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000286b0: 206f 6c64 5f62 6420 213d 206e 6577 5f62   old_bd != new_b
-000286c0: 6420 616e 6420 6f6c 645f 6264 2021 3d20  d and old_bd != 
-000286d0: 2831 2c29 3a0a 2020 2020 2020 2020 2020  (1,):.          
-000286e0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000286f0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00028700: 2020 2020 2020 2020 2020 2020 2263 616e              "can
-00028710: 6e6f 7420 6272 6f61 6463 6173 7420 6368  not broadcast ch
-00028720: 756e 6b73 2025 7320 746f 2063 6875 6e6b  unks %s to chunk
-00028730: 7320 2573 3a20 220a 2020 2020 2020 2020  s %s: ".        
-00028740: 2020 2020 2020 2020 2020 2020 226e 6577              "new
-00028750: 2063 6875 6e6b 7320 6d75 7374 2065 6974   chunks must eit
-00028760: 6865 7220 6265 2061 6c6f 6e67 2061 206e  her be along a n
-00028770: 6577 2022 0a20 2020 2020 2020 2020 2020  ew ".           
-00028780: 2020 2020 2020 2020 2022 6469 6d65 6e73           "dimens
-00028790: 696f 6e20 6f72 2061 2064 696d 656e 7369  ion or a dimensi
-000287a0: 6f6e 206f 6620 7369 7a65 2031 2220 2520  on of size 1" % 
-000287b0: 2878 2e63 6875 6e6b 732c 2063 6875 6e6b  (x.chunks, chunk
-000287c0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-000287d0: 2020 2029 0a0a 2020 2020 6e61 6d65 203d     )..    name =
-000287e0: 2022 6272 6f61 6463 6173 745f 746f 2d22   "broadcast_to-"
-000287f0: 202b 2074 6f6b 656e 697a 6528 782c 2073   + tokenize(x, s
-00028800: 6861 7065 2c20 6368 756e 6b73 290a 2020  hape, chunks).  
-00028810: 2020 6473 6b20 3d20 7b7d 0a0a 2020 2020    dsk = {}..    
-00028820: 656e 756d 6572 6174 6564 5f63 6875 6e6b  enumerated_chunk
-00028830: 7320 3d20 7072 6f64 7563 7428 2a28 656e  s = product(*(en
-00028840: 756d 6572 6174 6528 6264 7329 2066 6f72  umerate(bds) for
-00028850: 2062 6473 2069 6e20 6368 756e 6b73 2929   bds in chunks))
-00028860: 0a20 2020 2066 6f72 206e 6577 5f69 6e64  .    for new_ind
-00028870: 6578 2c20 6368 756e 6b5f 7368 6170 6520  ex, chunk_shape 
-00028880: 696e 2028 7a69 7028 2a65 6329 2066 6f72  in (zip(*ec) for
-00028890: 2065 6320 696e 2065 6e75 6d65 7261 7465   ec in enumerate
-000288a0: 645f 6368 756e 6b73 293a 0a20 2020 2020  d_chunks):.     
-000288b0: 2020 206f 6c64 5f69 6e64 6578 203d 2074     old_index = t
-000288c0: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
-000288d0: 2020 3020 6966 2062 6420 3d3d 2028 312c    0 if bd == (1,
-000288e0: 2920 656c 7365 2069 2066 6f72 2062 642c  ) else i for bd,
-000288f0: 2069 2069 6e20 7a69 7028 782e 6368 756e   i in zip(x.chun
-00028900: 6b73 2c20 6e65 775f 696e 6465 785b 6e64  ks, new_index[nd
-00028910: 696d 5f6e 6577 3a5d 290a 2020 2020 2020  im_new:]).      
-00028920: 2020 290a 2020 2020 2020 2020 6f6c 645f    ).        old_
-00028930: 6b65 7920 3d20 2878 2e6e 616d 652c 2920  key = (x.name,) 
-00028940: 2b20 6f6c 645f 696e 6465 780a 2020 2020  + old_index.    
-00028950: 2020 2020 6e65 775f 6b65 7920 3d20 286e      new_key = (n
-00028960: 616d 652c 2920 2b20 6e65 775f 696e 6465  ame,) + new_inde
-00028970: 780a 2020 2020 2020 2020 6473 6b5b 6e65  x.        dsk[ne
-00028980: 775f 6b65 795d 203d 2028 6e70 2e62 726f  w_key] = (np.bro
-00028990: 6164 6361 7374 5f74 6f2c 206f 6c64 5f6b  adcast_to, old_k
-000289a0: 6579 2c20 7175 6f74 6528 6368 756e 6b5f  ey, quote(chunk_
-000289b0: 7368 6170 6529 290a 0a20 2020 2067 7261  shape))..    gra
-000289c0: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
-000289d0: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-000289e0: 696f 6e73 286e 616d 652c 2064 736b 2c20  ions(name, dsk, 
-000289f0: 6465 7065 6e64 656e 6369 6573 3d5b 785d  dependencies=[x]
-00028a00: 290a 2020 2020 7265 7475 726e 2041 7272  ).    return Arr
-00028a10: 6179 2867 7261 7068 2c20 6e61 6d65 2c20  ay(graph, name, 
-00028a20: 6368 756e 6b73 2c20 6474 7970 653d 782e  chunks, dtype=x.
-00028a30: 6474 7970 652c 206d 6574 613d 6d65 7461  dtype, meta=meta
-00028a40: 290a 0a0a 4064 6572 6976 6564 5f66 726f  )...@derived_fro
-00028a50: 6d28 6e70 290a 6465 6620 6272 6f61 6463  m(np).def broadc
-00028a60: 6173 745f 6172 7261 7973 282a 6172 6773  ast_arrays(*args
-00028a70: 2c20 7375 626f 6b3d 4661 6c73 6529 3a0a  , subok=False):.
-00028a80: 2020 2020 7375 626f 6b20 3d20 626f 6f6c      subok = bool
-00028a90: 2873 7562 6f6b 290a 0a20 2020 2074 6f5f  (subok)..    to_
-00028aa0: 6172 7261 7920 3d20 6173 616e 7961 7272  array = asanyarr
-00028ab0: 6179 2069 6620 7375 626f 6b20 656c 7365  ay if subok else
-00028ac0: 2061 7361 7272 6179 0a20 2020 2061 7267   asarray.    arg
-00028ad0: 7320 3d20 7475 706c 6528 746f 5f61 7272  s = tuple(to_arr
-00028ae0: 6179 2865 2920 666f 7220 6520 696e 2061  ay(e) for e in a
-00028af0: 7267 7329 0a0a 2020 2020 2320 556e 6966  rgs)..    # Unif
-00028b00: 7920 756e 6576 656e 2063 6875 6e6b 696e  y uneven chunkin
-00028b10: 670a 2020 2020 696e 6473 203d 205b 6c69  g.    inds = [li
-00028b20: 7374 2872 6576 6572 7365 6428 7261 6e67  st(reversed(rang
-00028b30: 6528 782e 6e64 696d 2929 2920 666f 7220  e(x.ndim))) for 
-00028b40: 7820 696e 2061 7267 735d 0a20 2020 2075  x in args].    u
-00028b50: 635f 6172 6773 203d 2063 6f6e 6361 7428  c_args = concat(
-00028b60: 7a69 7028 6172 6773 2c20 696e 6473 2929  zip(args, inds))
-00028b70: 0a20 2020 205f 2c20 6172 6773 203d 2075  .    _, args = u
-00028b80: 6e69 6679 5f63 6875 6e6b 7328 2a75 635f  nify_chunks(*uc_
-00028b90: 6172 6773 2c20 7761 726e 3d46 616c 7365  args, warn=False
-00028ba0: 290a 0a20 2020 2073 6861 7065 203d 2062  )..    shape = b
-00028bb0: 726f 6164 6361 7374 5f73 6861 7065 7328  roadcast_shapes(
-00028bc0: 2a28 652e 7368 6170 6520 666f 7220 6520  *(e.shape for e 
-00028bd0: 696e 2061 7267 7329 290a 2020 2020 6368  in args)).    ch
-00028be0: 756e 6b73 203d 2062 726f 6164 6361 7374  unks = broadcast
-00028bf0: 5f63 6875 6e6b 7328 2a28 652e 6368 756e  _chunks(*(e.chun
-00028c00: 6b73 2066 6f72 2065 2069 6e20 6172 6773  ks for e in args
-00028c10: 2929 0a0a 2020 2020 7265 7375 6c74 203d  ))..    result =
-00028c20: 205b 6272 6f61 6463 6173 745f 746f 2865   [broadcast_to(e
-00028c30: 2c20 7368 6170 653d 7368 6170 652c 2063  , shape=shape, c
-00028c40: 6875 6e6b 733d 6368 756e 6b73 2920 666f  hunks=chunks) fo
-00028c50: 7220 6520 696e 2061 7267 735d 0a0a 2020  r e in args]..  
-00028c60: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-00028c70: 0a0a 6465 6620 6f66 6673 6574 5f66 756e  ..def offset_fun
-00028c80: 6328 6675 6e63 2c20 6f66 6673 6574 2c20  c(func, offset, 
-00028c90: 2a61 7267 7329 3a0a 2020 2020 2222 224f  *args):.    """O
-00028ca0: 6666 7365 7473 2069 6e70 7574 7320 6279  ffsets inputs by
-00028cb0: 206f 6666 7365 740a 0a20 2020 203e 3e3e   offset..    >>>
-00028cc0: 2064 6f75 626c 6520 3d20 6c61 6d62 6461   double = lambda
-00028cd0: 2078 3a20 7820 2a20 320a 2020 2020 3e3e   x: x * 2.    >>
-00028ce0: 3e20 6620 3d20 6f66 6673 6574 5f66 756e  > f = offset_fun
-00028cf0: 6328 646f 7562 6c65 2c20 2831 302c 2929  c(double, (10,))
-00028d00: 0a20 2020 203e 3e3e 2066 2831 290a 2020  .    >>> f(1).  
-00028d10: 2020 3232 0a20 2020 203e 3e3e 2066 2833    22.    >>> f(3
-00028d20: 3030 290a 2020 2020 3632 300a 2020 2020  00).    620.    
-00028d30: 2222 220a 0a20 2020 2064 6566 205f 6f66  """..    def _of
-00028d40: 6673 6574 282a 6172 6773 293a 0a20 2020  fset(*args):.   
-00028d50: 2020 2020 2061 7267 7332 203d 206c 6973       args2 = lis
-00028d60: 7428 6d61 7028 6164 642c 2061 7267 732c  t(map(add, args,
-00028d70: 206f 6666 7365 7429 290a 2020 2020 2020   offset)).      
-00028d80: 2020 7265 7475 726e 2066 756e 6328 2a61    return func(*a
-00028d90: 7267 7332 290a 0a20 2020 2077 6974 6820  rgs2)..    with 
-00028da0: 636f 6e74 6578 746c 6962 2e73 7570 7072  contextlib.suppr
-00028db0: 6573 7328 4578 6365 7074 696f 6e29 3a0a  ess(Exception):.
-00028dc0: 2020 2020 2020 2020 5f6f 6666 7365 742e          _offset.
-00028dd0: 5f5f 6e61 6d65 5f5f 203d 2022 6f66 6673  __name__ = "offs
-00028de0: 6574 5f22 202b 2066 756e 632e 5f5f 6e61  et_" + func.__na
-00028df0: 6d65 5f5f 0a0a 2020 2020 7265 7475 726e  me__..    return
-00028e00: 205f 6f66 6673 6574 0a0a 0a64 6566 2063   _offset...def c
-00028e10: 6875 6e6b 735f 6672 6f6d 5f61 7272 6179  hunks_from_array
-00028e20: 7328 6172 7261 7973 293a 0a20 2020 2022  s(arrays):.    "
-00028e30: 2222 4368 756e 6b73 2074 7570 6c65 2066  ""Chunks tuple f
-00028e40: 726f 6d20 6e65 7374 6564 206c 6973 7420  rom nested list 
-00028e50: 6f66 2061 7272 6179 730a 0a20 2020 203e  of arrays..    >
-00028e60: 3e3e 2078 203d 206e 702e 6172 7261 7928  >> x = np.array(
-00028e70: 5b31 2c20 325d 290a 2020 2020 3e3e 3e20  [1, 2]).    >>> 
-00028e80: 6368 756e 6b73 5f66 726f 6d5f 6172 7261  chunks_from_arra
-00028e90: 7973 285b 782c 2078 5d29 0a20 2020 2028  ys([x, x]).    (
-00028ea0: 2832 2c20 3229 2c29 0a0a 2020 2020 3e3e  (2, 2),)..    >>
-00028eb0: 3e20 7820 3d20 6e70 2e61 7272 6179 285b  > x = np.array([
-00028ec0: 5b31 2c20 325d 5d29 0a20 2020 203e 3e3e  [1, 2]]).    >>>
-00028ed0: 2063 6875 6e6b 735f 6672 6f6d 5f61 7272   chunks_from_arr
-00028ee0: 6179 7328 5b5b 785d 2c20 5b78 5d5d 290a  ays([[x], [x]]).
-00028ef0: 2020 2020 2828 312c 2031 292c 2028 322c      ((1, 1), (2,
-00028f00: 2929 0a0a 2020 2020 3e3e 3e20 7820 3d20  ))..    >>> x = 
-00028f10: 6e70 2e61 7272 6179 285b 5b31 2c20 325d  np.array([[1, 2]
-00028f20: 5d29 0a20 2020 203e 3e3e 2063 6875 6e6b  ]).    >>> chunk
-00028f30: 735f 6672 6f6d 5f61 7272 6179 7328 5b5b  s_from_arrays([[
-00028f40: 782c 2078 5d5d 290a 2020 2020 2828 312c  x, x]]).    ((1,
-00028f50: 292c 2028 322c 2032 2929 0a0a 2020 2020  ), (2, 2))..    
-00028f60: 3e3e 3e20 6368 756e 6b73 5f66 726f 6d5f  >>> chunks_from_
-00028f70: 6172 7261 7973 285b 312c 2031 5d29 0a20  arrays([1, 1]). 
-00028f80: 2020 2028 2831 2c20 3129 2c29 0a20 2020     ((1, 1),).   
-00028f90: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
-00028fa0: 6172 7261 7973 3a0a 2020 2020 2020 2020  arrays:.        
-00028fb0: 7265 7475 726e 2028 290a 2020 2020 7265  return ().    re
-00028fc0: 7375 6c74 203d 205b 5d0a 2020 2020 6469  sult = [].    di
-00028fd0: 6d20 3d20 300a 0a20 2020 2064 6566 2073  m = 0..    def s
-00028fe0: 6861 7065 2878 293a 0a20 2020 2020 2020  hape(x):.       
-00028ff0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00029000: 2020 7265 7475 726e 2078 2e73 6861 7065    return x.shape
-00029010: 2069 6620 782e 7368 6170 6520 656c 7365   if x.shape else
-00029020: 2028 312c 290a 2020 2020 2020 2020 6578   (1,).        ex
-00029030: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00029040: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00029050: 2072 6574 7572 6e20 2831 2c29 0a0a 2020   return (1,)..  
-00029060: 2020 7768 696c 6520 6973 696e 7374 616e    while isinstan
-00029070: 6365 2861 7272 6179 732c 2028 6c69 7374  ce(arrays, (list
-00029080: 2c20 7475 706c 6529 293a 0a20 2020 2020  , tuple)):.     
-00029090: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
-000290a0: 2874 7570 6c65 2873 6861 7065 2864 6565  (tuple(shape(dee
-000290b0: 7066 6972 7374 2861 2929 5b64 696d 5d20  pfirst(a))[dim] 
-000290c0: 666f 7220 6120 696e 2061 7272 6179 7329  for a in arrays)
-000290d0: 290a 2020 2020 2020 2020 6172 7261 7973  ).        arrays
-000290e0: 203d 2061 7272 6179 735b 305d 0a20 2020   = arrays[0].   
-000290f0: 2020 2020 2064 696d 202b 3d20 310a 2020       dim += 1.  
-00029100: 2020 7265 7475 726e 2074 7570 6c65 2872    return tuple(r
-00029110: 6573 756c 7429 0a0a 0a64 6566 2064 6565  esult)...def dee
-00029120: 7066 6972 7374 2873 6571 293a 0a20 2020  pfirst(seq):.   
-00029130: 2022 2222 4669 7273 7420 656c 656d 656e   """First elemen
-00029140: 7420 696e 2061 206e 6573 7465 6420 6c69  t in a nested li
-00029150: 7374 0a0a 2020 2020 3e3e 3e20 6465 6570  st..    >>> deep
-00029160: 6669 7273 7428 5b5b 5b31 2c20 325d 2c20  first([[[1, 2], 
-00029170: 5b33 2c20 345d 5d2c 205b 352c 2036 5d2c  [3, 4]], [5, 6],
-00029180: 205b 372c 2038 5d5d 290a 2020 2020 310a   [7, 8]]).    1.
-00029190: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
-000291a0: 6f74 2069 7369 6e73 7461 6e63 6528 7365  ot isinstance(se
-000291b0: 712c 2028 6c69 7374 2c20 7475 706c 6529  q, (list, tuple)
-000291c0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000291d0: 6e20 7365 710a 2020 2020 656c 7365 3a0a  n seq.    else:.
-000291e0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-000291f0: 6565 7066 6972 7374 2873 6571 5b30 5d29  eepfirst(seq[0])
-00029200: 0a0a 0a64 6566 2073 6861 7065 6c69 7374  ...def shapelist
-00029210: 2861 293a 0a20 2020 2022 2222 4765 7420  (a):.    """Get 
-00029220: 7468 6520 7368 6170 6520 6f66 206e 6573  the shape of nes
-00029230: 7465 6420 6c69 7374 2222 220a 2020 2020  ted list""".    
-00029240: 6966 2074 7970 6528 6129 2069 7320 6c69  if type(a) is li
-00029250: 7374 3a0a 2020 2020 2020 2020 7265 7475  st:.        retu
-00029260: 726e 2074 7570 6c65 285b 6c65 6e28 6129  rn tuple([len(a)
-00029270: 5d20 2b20 6c69 7374 2873 6861 7065 6c69  ] + list(shapeli
-00029280: 7374 2861 5b30 5d29 2929 0a20 2020 2065  st(a[0]))).    e
-00029290: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-000292a0: 7572 6e20 2829 0a0a 0a64 6566 2074 7261  urn ()...def tra
-000292b0: 6e73 706f 7365 6c69 7374 2861 7272 6179  nsposelist(array
-000292c0: 732c 2061 7865 732c 2065 7874 7261 6469  s, axes, extradi
-000292d0: 6d73 3d30 293a 0a20 2020 2022 2222 5065  ms=0):.    """Pe
-000292e0: 726d 7574 6520 6178 6573 206f 6620 6e65  rmute axes of ne
-000292f0: 7374 6564 206c 6973 740a 0a20 2020 203e  sted list..    >
-00029300: 3e3e 2074 7261 6e73 706f 7365 6c69 7374  >> transposelist
-00029310: 285b 5b31 2c31 2c31 5d2c 5b31 2c31 2c31  ([[1,1,1],[1,1,1
-00029320: 5d5d 2c20 5b32 2c31 5d29 0a20 2020 205b  ]], [2,1]).    [
-00029330: 5b5b 312c 2031 5d2c 205b 312c 2031 5d2c  [[1, 1], [1, 1],
-00029340: 205b 312c 2031 5d5d 5d0a 0a20 2020 203e   [1, 1]]]..    >
-00029350: 3e3e 2074 7261 6e73 706f 7365 6c69 7374  >> transposelist
-00029360: 285b 5b31 2c31 2c31 5d2c 5b31 2c31 2c31  ([[1,1,1],[1,1,1
-00029370: 5d5d 2c20 5b32 2c31 5d2c 2065 7874 7261  ]], [2,1], extra
-00029380: 6469 6d73 3d31 290a 2020 2020 5b5b 5b5b  dims=1).    [[[[
-00029390: 315d 2c20 5b31 5d5d 2c20 5b5b 315d 2c20  1], [1]], [[1], 
-000293a0: 5b31 5d5d 2c20 5b5b 315d 2c20 5b31 5d5d  [1]], [[1], [1]]
-000293b0: 5d5d 0a20 2020 2022 2222 0a20 2020 2069  ]].    """.    i
-000293c0: 6620 6c65 6e28 6178 6573 2920 213d 206e  f len(axes) != n
-000293d0: 6469 6d6c 6973 7428 6172 7261 7973 293a  dimlist(arrays):
-000293e0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-000293f0: 616c 7565 4572 726f 7228 224c 656e 6774  alueError("Lengt
-00029400: 6820 6f66 2061 7865 7320 7368 6f75 6c64  h of axes should
-00029410: 2065 7175 616c 2064 6570 7468 206f 6620   equal depth of 
-00029420: 6e65 7374 6564 2061 7272 6179 7322 290a  nested arrays").
-00029430: 2020 2020 6966 2065 7874 7261 6469 6d73      if extradims
-00029440: 203c 2030 3a0a 2020 2020 2020 2020 7261   < 0:.        ra
-00029450: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00029460: 606e 6577 6469 6d73 6020 7368 6f75 6c64  `newdims` should
-00029470: 2062 6520 706f 7369 7469 7665 2229 0a20   be positive"). 
-00029480: 2020 2069 6620 6c65 6e28 6178 6573 2920     if len(axes) 
-00029490: 3e20 6c65 6e28 7365 7428 6178 6573 2929  > len(set(axes))
-000294a0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-000294b0: 5661 6c75 6545 7272 6f72 2822 6061 7865  ValueError("`axe
-000294c0: 7360 2073 686f 756c 6420 6265 2075 6e69  s` should be uni
-000294d0: 7175 6522 290a 0a20 2020 206e 6469 6d20  que")..    ndim 
-000294e0: 3d20 6d61 7828 6178 6573 2920 2b20 310a  = max(axes) + 1.
-000294f0: 2020 2020 7368 6170 6520 3d20 7368 6170      shape = shap
-00029500: 656c 6973 7428 6172 7261 7973 290a 2020  elist(arrays).  
-00029510: 2020 6e65 7773 6861 7065 203d 205b 0a20    newshape = [. 
-00029520: 2020 2020 2020 2073 6861 7065 5b61 7865         shape[axe
-00029530: 732e 696e 6465 7828 6929 5d20 6966 2069  s.index(i)] if i
-00029540: 2069 6e20 6178 6573 2065 6c73 6520 3120   in axes else 1 
-00029550: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
-00029560: 6469 6d20 2b20 6578 7472 6164 696d 7329  dim + extradims)
-00029570: 0a20 2020 205d 0a0a 2020 2020 7265 7375  .    ]..    resu
-00029580: 6c74 203d 206c 6973 7428 636f 7265 2e66  lt = list(core.f
-00029590: 6c61 7474 656e 2861 7272 6179 7329 290a  latten(arrays)).
-000295a0: 2020 2020 7265 7475 726e 2072 6573 6861      return resha
-000295b0: 7065 6c69 7374 286e 6577 7368 6170 652c  pelist(newshape,
-000295c0: 2072 6573 756c 7429 0a0a 0a64 6566 2073   result)...def s
-000295d0: 7461 636b 2873 6571 2c20 6178 6973 3d30  tack(seq, axis=0
-000295e0: 2c20 616c 6c6f 775f 756e 6b6e 6f77 6e5f  , allow_unknown_
-000295f0: 6368 756e 6b73 697a 6573 3d46 616c 7365  chunksizes=False
-00029600: 293a 0a20 2020 2022 2222 0a20 2020 2053  ):.    """.    S
-00029610: 7461 636b 2061 7272 6179 7320 616c 6f6e  tack arrays alon
-00029620: 6720 6120 6e65 7720 6178 6973 0a0a 2020  g a new axis..  
-00029630: 2020 4769 7665 6e20 6120 7365 7175 656e    Given a sequen
-00029640: 6365 206f 6620 6461 736b 2061 7272 6179  ce of dask array
-00029650: 732c 2066 6f72 6d20 6120 6e65 7720 6461  s, form a new da
-00029660: 736b 2061 7272 6179 2062 7920 7374 6163  sk array by stac
-00029670: 6b69 6e67 2074 6865 6d0a 2020 2020 616c  king them.    al
-00029680: 6f6e 6720 6120 6e65 7720 6469 6d65 6e73  ong a new dimens
-00029690: 696f 6e20 2861 7869 733d 3020 6279 2064  ion (axis=0 by d
-000296a0: 6566 6175 6c74 290a 0a20 2020 2050 6172  efault)..    Par
-000296b0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-000296c0: 2d2d 2d2d 2d2d 0a20 2020 2073 6571 3a20  ------.    seq: 
-000296d0: 6c69 7374 206f 6620 6461 736b 2e61 7272  list of dask.arr
-000296e0: 6179 730a 2020 2020 6178 6973 3a20 696e  ays.    axis: in
-000296f0: 740a 2020 2020 2020 2020 4469 6d65 6e73  t.        Dimens
-00029700: 696f 6e20 616c 6f6e 6720 7768 6963 6820  ion along which 
-00029710: 746f 2061 6c69 676e 2061 6c6c 206f 6620  to align all of 
-00029720: 7468 6520 6172 7261 7973 0a20 2020 2061  the arrays.    a
-00029730: 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63 6875  llow_unknown_chu
-00029740: 6e6b 7369 7a65 733a 2062 6f6f 6c0a 2020  nksizes: bool.  
-00029750: 2020 2020 2020 416c 6c6f 7720 756e 6b6e        Allow unkn
-00029760: 6f77 6e20 6368 756e 6b73 697a 6573 2c20  own chunksizes, 
-00029770: 7375 6368 2061 7320 636f 6d65 2066 726f  such as come fro
-00029780: 6d20 636f 6e76 6572 7469 6e67 2066 726f  m converting fro
-00029790: 6d20 6461 736b 0a20 2020 2020 2020 2064  m dask.        d
-000297a0: 6174 6166 7261 6d65 732e 2020 4461 736b  ataframes.  Dask
-000297b0: 2e61 7272 6179 2069 7320 756e 6162 6c65  .array is unable
-000297c0: 2074 6f20 7665 7269 6679 2074 6861 7420   to verify that 
-000297d0: 6368 756e 6b73 206c 696e 6520 7570 2e20  chunks line up. 
-000297e0: 2049 660a 2020 2020 2020 2020 6461 7461   If.        data
-000297f0: 2063 6f6d 6573 2066 726f 6d20 6469 6666   comes from diff
-00029800: 6572 656e 746c 7920 616c 6967 6e65 6420  erently aligned 
-00029810: 736f 7572 6365 7320 7468 656e 2074 6869  sources then thi
-00029820: 7320 6361 6e20 6361 7573 650a 2020 2020  s can cause.    
-00029830: 2020 2020 756e 6578 7065 6374 6564 2072      unexpected r
-00029840: 6573 756c 7473 2e0a 0a20 2020 2045 7861  esults...    Exa
-00029850: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-00029860: 2d2d 0a0a 2020 2020 4372 6561 7465 2073  --..    Create s
-00029870: 6c69 6365 730a 0a20 2020 203e 3e3e 2069  lices..    >>> i
-00029880: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
-00029890: 2061 7320 6461 0a20 2020 203e 3e3e 2069   as da.    >>> i
-000298a0: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
-000298b0: 700a 0a20 2020 203e 3e3e 2064 6174 6120  p..    >>> data 
-000298c0: 3d20 5b64 612e 6672 6f6d 5f61 7272 6179  = [da.from_array
-000298d0: 286e 702e 6f6e 6573 2828 342c 2034 2929  (np.ones((4, 4))
-000298e0: 2c20 6368 756e 6b73 3d28 322c 2032 2929  , chunks=(2, 2))
-000298f0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-00029900: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00029910: 3329 5d0a 0a20 2020 203e 3e3e 2078 203d  3)]..    >>> x =
-00029920: 2064 612e 7374 6163 6b28 6461 7461 2c20   da.stack(data, 
-00029930: 6178 6973 3d30 290a 2020 2020 3e3e 3e20  axis=0).    >>> 
-00029940: 782e 7368 6170 650a 2020 2020 2833 2c20  x.shape.    (3, 
-00029950: 342c 2034 290a 0a20 2020 203e 3e3e 2064  4, 4)..    >>> d
-00029960: 612e 7374 6163 6b28 6461 7461 2c20 6178  a.stack(data, ax
-00029970: 6973 3d31 292e 7368 6170 650a 2020 2020  is=1).shape.    
-00029980: 2834 2c20 332c 2034 290a 0a20 2020 203e  (4, 3, 4)..    >
-00029990: 3e3e 2064 612e 7374 6163 6b28 6461 7461  >> da.stack(data
-000299a0: 2c20 6178 6973 3d2d 3129 2e73 6861 7065  , axis=-1).shape
-000299b0: 0a20 2020 2028 342c 2034 2c20 3329 0a0a  .    (4, 4, 3)..
-000299c0: 2020 2020 5265 7375 6c74 2069 7320 6120      Result is a 
-000299d0: 6e65 7720 6461 736b 2041 7272 6179 0a0a  new dask Array..
-000299e0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-000299f0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 636f   --------.    co
-00029a00: 6e63 6174 656e 6174 650a 2020 2020 2222  ncatenate.    ""
-00029a10: 220a 2020 2020 6672 6f6d 2064 6173 6b2e  ".    from dask.
-00029a20: 6172 7261 7920 696d 706f 7274 2077 7261  array import wra
-00029a30: 700a 0a20 2020 2073 6571 203d 205b 6173  p..    seq = [as
-00029a40: 6172 7261 7928 612c 2061 6c6c 6f77 5f75  array(a, allow_u
-00029a50: 6e6b 6e6f 776e 5f63 6875 6e6b 7369 7a65  nknown_chunksize
-00029a60: 733d 616c 6c6f 775f 756e 6b6e 6f77 6e5f  s=allow_unknown_
-00029a70: 6368 756e 6b73 697a 6573 2920 666f 7220  chunksizes) for 
-00029a80: 6120 696e 2073 6571 5d0a 0a20 2020 2069  a in seq]..    i
-00029a90: 6620 6e6f 7420 7365 713a 0a20 2020 2020  f not seq:.     
-00029aa0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00029ab0: 726f 7228 224e 6565 6420 6172 7261 7928  ror("Need array(
-00029ac0: 7329 2074 6f20 7374 6163 6b22 290a 2020  s) to stack").  
-00029ad0: 2020 6966 206e 6f74 2061 6c6c 6f77 5f75    if not allow_u
-00029ae0: 6e6b 6e6f 776e 5f63 6875 6e6b 7369 7a65  nknown_chunksize
-00029af0: 7320 616e 6420 6e6f 7420 616c 6c28 782e  s and not all(x.
-00029b00: 7368 6170 6520 3d3d 2073 6571 5b30 5d2e  shape == seq[0].
-00029b10: 7368 6170 6520 666f 7220 7820 696e 2073  shape for x in s
-00029b20: 6571 293a 0a20 2020 2020 2020 2069 6478  eq):.        idx
-00029b30: 203d 2066 6972 7374 2869 2066 6f72 2069   = first(i for i
-00029b40: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-00029b50: 7129 2069 6620 695b 315d 2e73 6861 7065  q) if i[1].shape
-00029b60: 2021 3d20 7365 715b 305d 2e73 6861 7065   != seq[0].shape
-00029b70: 290a 2020 2020 2020 2020 7261 6973 6520  ).        raise 
-00029b80: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00029b90: 2020 2020 2020 2020 2253 7461 636b 6564          "Stacked
-00029ba0: 2061 7272 6179 7320 6d75 7374 2068 6176   arrays must hav
-00029bb0: 6520 7468 6520 7361 6d65 2073 6861 7065  e the same shape
-00029bc0: 2e20 5468 6520 6669 7273 7420 6172 7261  . The first arra
-00029bd0: 7920 6861 6420 7368 6170 6520 220a 2020  y had shape ".  
-00029be0: 2020 2020 2020 2020 2020 6622 7b73 6571            f"{seq
-00029bf0: 5b30 5d2e 7368 6170 657d 2c20 7768 696c  [0].shape}, whil
-00029c00: 6520 6172 7261 7920 7b69 6478 5b30 5d20  e array {idx[0] 
-00029c10: 2b20 317d 2068 6173 2073 6861 7065 207b  + 1} has shape {
-00029c20: 6964 785b 315d 2e73 6861 7065 7d2e 220a  idx[1].shape}.".
-00029c30: 2020 2020 2020 2020 290a 0a20 2020 206d          )..    m
-00029c40: 6574 6120 3d20 6e70 2e73 7461 636b 285b  eta = np.stack([
-00029c50: 6d65 7461 5f66 726f 6d5f 6172 7261 7928  meta_from_array(
-00029c60: 6129 2066 6f72 2061 2069 6e20 7365 715d  a) for a in seq]
-00029c70: 2c20 6178 6973 3d61 7869 7329 0a20 2020  , axis=axis).   
-00029c80: 2073 6571 203d 205b 782e 6173 7479 7065   seq = [x.astype
-00029c90: 286d 6574 612e 6474 7970 6529 2066 6f72  (meta.dtype) for
-00029ca0: 2078 2069 6e20 7365 715d 0a0a 2020 2020   x in seq]..    
-00029cb0: 6e64 696d 203d 206d 6574 612e 6e64 696d  ndim = meta.ndim
-00029cc0: 202d 2031 0a20 2020 2069 6620 6178 6973   - 1.    if axis
-00029cd0: 203c 2030 3a0a 2020 2020 2020 2020 6178   < 0:.        ax
-00029ce0: 6973 203d 206e 6469 6d20 2b20 6178 6973  is = ndim + axis
-00029cf0: 202b 2031 0a20 2020 2073 6861 7065 203d   + 1.    shape =
-00029d00: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
-00029d10: 6c65 6e28 7365 7129 0a20 2020 2020 2020  len(seq).       
-00029d20: 2069 6620 6920 3d3d 2061 7869 730a 2020   if i == axis.  
-00029d30: 2020 2020 2020 656c 7365 2028 7365 715b        else (seq[
-00029d40: 305d 2e73 6861 7065 5b69 5d20 6966 2069  0].shape[i] if i
-00029d50: 203c 2061 7869 7320 656c 7365 2073 6571   < axis else seq
-00029d60: 5b30 5d2e 7368 6170 655b 6920 2d20 315d  [0].shape[i - 1]
-00029d70: 290a 2020 2020 2020 2020 666f 7220 6920  ).        for i 
-00029d80: 696e 2072 616e 6765 286d 6574 612e 6e64  in range(meta.nd
-00029d90: 696d 290a 2020 2020 290a 0a20 2020 2073  im).    )..    s
-00029da0: 6571 3220 3d20 5b61 2066 6f72 2061 2069  eq2 = [a for a i
-00029db0: 6e20 7365 7120 6966 2061 2e73 697a 655d  n seq if a.size]
-00029dc0: 0a20 2020 2069 6620 6e6f 7420 7365 7132  .    if not seq2
-00029dd0: 3a0a 2020 2020 2020 2020 7365 7132 203d  :.        seq2 =
-00029de0: 2073 6571 0a0a 2020 2020 6e20 3d20 6c65   seq..    n = le
-00029df0: 6e28 7365 7132 290a 2020 2020 6966 206e  n(seq2).    if n
-00029e00: 203d 3d20 303a 0a20 2020 2020 2020 2074   == 0:.        t
-00029e10: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00029e20: 7265 7475 726e 2077 7261 702e 656d 7074  return wrap.empt
-00029e30: 795f 6c69 6b65 286d 6574 612c 2073 6861  y_like(meta, sha
-00029e40: 7065 3d73 6861 7065 2c20 6368 756e 6b73  pe=shape, chunks
-00029e50: 3d73 6861 7065 2c20 6474 7970 653d 6d65  =shape, dtype=me
-00029e60: 7461 2e64 7479 7065 290a 2020 2020 2020  ta.dtype).      
-00029e70: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-00029e80: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00029e90: 7265 7475 726e 2077 7261 702e 656d 7074  return wrap.empt
-00029ea0: 7928 7368 6170 652c 2063 6875 6e6b 733d  y(shape, chunks=
-00029eb0: 7368 6170 652c 2064 7479 7065 3d6d 6574  shape, dtype=met
-00029ec0: 612e 6474 7970 6529 0a0a 2020 2020 696e  a.dtype)..    in
-00029ed0: 6420 3d20 6c69 7374 2872 616e 6765 286e  d = list(range(n
-00029ee0: 6469 6d29 290a 2020 2020 7563 5f61 7267  dim)).    uc_arg
-00029ef0: 7320 3d20 6c69 7374 2863 6f6e 6361 7428  s = list(concat(
-00029f00: 2878 2c20 696e 6429 2066 6f72 2078 2069  (x, ind) for x i
-00029f10: 6e20 7365 7132 2929 0a20 2020 205f 2c20  n seq2)).    _, 
-00029f20: 7365 7132 203d 2075 6e69 6679 5f63 6875  seq2 = unify_chu
-00029f30: 6e6b 7328 2a75 635f 6172 6773 290a 0a20  nks(*uc_args).. 
-00029f40: 2020 2061 7373 6572 7420 6c65 6e28 7b61     assert len({a
-00029f50: 2e63 6875 6e6b 7320 666f 7220 6120 696e  .chunks for a in
-00029f60: 2073 6571 327d 2920 3d3d 2031 2020 2320   seq2}) == 1  # 
-00029f70: 7361 6d65 2063 6875 6e6b 730a 2020 2020  same chunks.    
-00029f80: 6368 756e 6b73 203d 2073 6571 325b 305d  chunks = seq2[0]
-00029f90: 2e63 6875 6e6b 735b 3a61 7869 735d 202b  .chunks[:axis] +
-00029fa0: 2028 2831 2c29 202a 206e 2c29 202b 2073   ((1,) * n,) + s
-00029fb0: 6571 325b 305d 2e63 6875 6e6b 735b 6178  eq2[0].chunks[ax
-00029fc0: 6973 3a5d 0a0a 2020 2020 6e61 6d65 7320  is:]..    names 
-00029fd0: 3d20 5b61 2e6e 616d 6520 666f 7220 6120  = [a.name for a 
-00029fe0: 696e 2073 6571 325d 0a20 2020 206e 616d  in seq2].    nam
-00029ff0: 6520 3d20 2273 7461 636b 2d22 202b 2074  e = "stack-" + t
-0002a000: 6f6b 656e 697a 6528 6e61 6d65 732c 2061  okenize(names, a
-0002a010: 7869 7329 0a20 2020 206b 6579 7320 3d20  xis).    keys = 
-0002a020: 6c69 7374 2870 726f 6475 6374 285b 6e61  list(product([na
-0002a030: 6d65 5d2c 202a 5b72 616e 6765 286c 656e  me], *[range(len
-0002a040: 2862 6429 2920 666f 7220 6264 2069 6e20  (bd)) for bd in 
-0002a050: 6368 756e 6b73 5d29 290a 0a20 2020 2069  chunks]))..    i
-0002a060: 6e70 7574 7320 3d20 5b0a 2020 2020 2020  nputs = [.      
-0002a070: 2020 286e 616d 6573 5b6b 6579 5b61 7869    (names[key[axi
-0002a080: 7320 2b20 315d 5d2c 2920 2b20 6b65 795b  s + 1]],) + key[
-0002a090: 3120 3a20 6178 6973 202b 2031 5d20 2b20  1 : axis + 1] + 
-0002a0a0: 6b65 795b 6178 6973 202b 2032 203a 5d20  key[axis + 2 :] 
-0002a0b0: 666f 7220 6b65 7920 696e 206b 6579 730a  for key in keys.
-0002a0c0: 2020 2020 5d0a 2020 2020 7661 6c75 6573      ].    values
-0002a0d0: 203d 205b 0a20 2020 2020 2020 2028 0a20   = [.        (. 
-0002a0e0: 2020 2020 2020 2020 2020 2067 6574 6974             getit
-0002a0f0: 656d 2c0a 2020 2020 2020 2020 2020 2020  em,.            
-0002a100: 696e 702c 0a20 2020 2020 2020 2020 2020  inp,.           
-0002a110: 2028 736c 6963 6528 4e6f 6e65 2c20 4e6f   (slice(None, No
-0002a120: 6e65 2c20 4e6f 6e65 292c 2920 2a20 6178  ne, None),) * ax
-0002a130: 6973 0a20 2020 2020 2020 2020 2020 202b  is.            +
-0002a140: 2028 4e6f 6e65 2c29 0a20 2020 2020 2020   (None,).       
-0002a150: 2020 2020 202b 2028 736c 6963 6528 4e6f       + (slice(No
-0002a160: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 292c  ne, None, None),
-0002a170: 2920 2a20 286e 6469 6d20 2d20 6178 6973  ) * (ndim - axis
-0002a180: 292c 0a20 2020 2020 2020 2029 0a20 2020  ),.        ).   
-0002a190: 2020 2020 2066 6f72 2069 6e70 2069 6e20       for inp in 
-0002a1a0: 696e 7075 7473 0a20 2020 205d 0a0a 2020  inputs.    ]..  
-0002a1b0: 2020 6c61 7965 7220 3d20 6469 6374 287a    layer = dict(z
-0002a1c0: 6970 286b 6579 732c 2076 616c 7565 7329  ip(keys, values)
-0002a1d0: 290a 2020 2020 6772 6170 6820 3d20 4869  ).    graph = Hi
-0002a1e0: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-0002a1f0: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6e61  m_collections(na
-0002a200: 6d65 2c20 6c61 7965 722c 2064 6570 656e  me, layer, depen
-0002a210: 6465 6e63 6965 733d 7365 7132 290a 0a20  dencies=seq2).. 
-0002a220: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
-0002a230: 6772 6170 682c 206e 616d 652c 2063 6875  graph, name, chu
-0002a240: 6e6b 732c 206d 6574 613d 6d65 7461 290a  nks, meta=meta).
-0002a250: 0a0a 6465 6620 636f 6e63 6174 656e 6174  ..def concatenat
-0002a260: 6533 2861 7272 6179 7329 3a0a 2020 2020  e3(arrays):.    
-0002a270: 2222 2252 6563 7572 7369 7665 206e 702e  """Recursive np.
-0002a280: 636f 6e63 6174 656e 6174 650a 0a20 2020  concatenate..   
-0002a290: 2049 6e70 7574 2073 686f 756c 6420 6265   Input should be
-0002a2a0: 2061 206e 6573 7465 6420 6c69 7374 206f   a nested list o
-0002a2b0: 6620 6e75 6d70 7920 6172 7261 7973 2061  f numpy arrays a
-0002a2c0: 7272 616e 6765 6420 696e 2074 6865 206f  rranged in the o
-0002a2d0: 7264 6572 2074 6865 790a 2020 2020 7368  rder they.    sh
-0002a2e0: 6f75 6c64 2061 7070 6561 7220 696e 2074  ould appear in t
-0002a2f0: 6865 2061 7272 6179 2069 7473 656c 662e  he array itself.
-0002a300: 2020 4561 6368 2061 7272 6179 2073 686f    Each array sho
-0002a310: 756c 6420 6861 7665 2074 6865 2073 616d  uld have the sam
-0002a320: 6520 6e75 6d62 6572 0a20 2020 206f 6620  e number.    of 
-0002a330: 6469 6d65 6e73 696f 6e73 2061 7320 7468  dimensions as th
-0002a340: 6520 6465 7369 7265 6420 6f75 7470 7574  e desired output
-0002a350: 2061 6e64 2074 6865 206e 6573 7469 6e67   and the nesting
-0002a360: 206f 6620 7468 6520 6c69 7374 732e 0a0a   of the lists...
-0002a370: 2020 2020 3e3e 3e20 7820 3d20 6e70 2e61      >>> x = np.a
-0002a380: 7272 6179 285b 5b31 2c20 325d 5d29 0a20  rray([[1, 2]]). 
-0002a390: 2020 203e 3e3e 2063 6f6e 6361 7465 6e61     >>> concatena
-0002a3a0: 7465 3328 5b5b 782c 2078 2c20 785d 2c20  te3([[x, x, x], 
-0002a3b0: 5b78 2c20 782c 2078 5d5d 290a 2020 2020  [x, x, x]]).    
-0002a3c0: 6172 7261 7928 5b5b 312c 2032 2c20 312c  array([[1, 2, 1,
-0002a3d0: 2032 2c20 312c 2032 5d2c 0a20 2020 2020   2, 1, 2],.     
-0002a3e0: 2020 2020 2020 5b31 2c20 322c 2031 2c20        [1, 2, 1, 
-0002a3f0: 322c 2031 2c20 325d 5d29 0a0a 2020 2020  2, 1, 2]])..    
-0002a400: 3e3e 3e20 636f 6e63 6174 656e 6174 6533  >>> concatenate3
-0002a410: 285b 5b78 2c20 785d 2c20 5b78 2c20 785d  ([[x, x], [x, x]
-0002a420: 2c20 5b78 2c20 785d 5d29 0a20 2020 2061  , [x, x]]).    a
-0002a430: 7272 6179 285b 5b31 2c20 322c 2031 2c20  rray([[1, 2, 1, 
-0002a440: 325d 2c0a 2020 2020 2020 2020 2020 205b  2],.           [
-0002a450: 312c 2032 2c20 312c 2032 5d2c 0a20 2020  1, 2, 1, 2],.   
-0002a460: 2020 2020 2020 2020 5b31 2c20 322c 2031          [1, 2, 1
-0002a470: 2c20 325d 5d29 0a20 2020 2022 2222 0a20  , 2]]).    """. 
-0002a480: 2020 2023 2057 6520 6e65 6564 2074 6869     # We need thi
-0002a490: 7320 6173 205f 5f61 7272 6179 5f66 756e  s as __array_fun
-0002a4a0: 6374 696f 6e5f 5f20 6d61 7920 6e6f 7420  ction__ may not 
-0002a4b0: 6578 6973 7420 6f6e 206f 6c64 6572 204e  exist on older N
-0002a4c0: 756d 5079 2076 6572 7369 6f6e 732e 0a20  umPy versions.. 
-0002a4d0: 2020 2023 2041 6e64 2074 6f20 7265 6475     # And to redu
-0002a4e0: 6365 2076 6572 626f 7369 7479 2e0a 2020  ce verbosity..  
-0002a4f0: 2020 4e44 4152 5241 595f 4152 5241 595f    NDARRAY_ARRAY_
-0002a500: 4655 4e43 5449 4f4e 203d 2067 6574 6174  FUNCTION = getat
-0002a510: 7472 286e 702e 6e64 6172 7261 792c 2022  tr(np.ndarray, "
-0002a520: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
-0002a530: 5f5f 222c 204e 6f6e 6529 0a0a 2020 2020  __", None)..    
-0002a540: 6172 7261 7973 203d 2063 6f6e 6372 6574  arrays = concret
-0002a550: 6528 6172 7261 7973 290a 2020 2020 6966  e(arrays).    if
-0002a560: 206e 6f74 2061 7272 6179 733a 0a20 2020   not arrays:.   
-0002a570: 2020 2020 2072 6574 7572 6e20 6e70 2e65       return np.e
-0002a580: 6d70 7479 2830 290a 0a20 2020 2061 6476  mpty(0)..    adv
-0002a590: 616e 6365 6420 3d20 6d61 7828 0a20 2020  anced = max(.   
-0002a5a0: 2020 2020 2063 6f72 652e 666c 6174 7465       core.flatte
-0002a5b0: 6e28 6172 7261 7973 2c20 636f 6e74 6169  n(arrays, contai
-0002a5c0: 6e65 723d 286c 6973 742c 2074 7570 6c65  ner=(list, tuple
-0002a5d0: 2929 2c0a 2020 2020 2020 2020 6b65 793d  )),.        key=
-0002a5e0: 6c61 6d62 6461 2078 3a20 6765 7461 7474  lambda x: getatt
-0002a5f0: 7228 782c 2022 5f5f 6172 7261 795f 7072  r(x, "__array_pr
-0002a600: 696f 7269 7479 5f5f 222c 2030 292c 0a20  iority__", 0),. 
-0002a610: 2020 2029 0a0a 2020 2020 6966 206e 6f74     )..    if not
-0002a620: 2061 6c6c 280a 2020 2020 2020 2020 4e44   all(.        ND
-0002a630: 4152 5241 595f 4152 5241 595f 4655 4e43  ARRAY_ARRAY_FUNC
-0002a640: 5449 4f4e 0a20 2020 2020 2020 2069 7320  TION.        is 
-0002a650: 6765 7461 7474 7228 7479 7065 2861 7272  getattr(type(arr
-0002a660: 292c 2022 5f5f 6172 7261 795f 6675 6e63  ), "__array_func
-0002a670: 7469 6f6e 5f5f 222c 204e 4441 5252 4159  tion__", NDARRAY
-0002a680: 5f41 5252 4159 5f46 554e 4354 494f 4e29  _ARRAY_FUNCTION)
-0002a690: 0a20 2020 2020 2020 2066 6f72 2061 7272  .        for arr
-0002a6a0: 2069 6e20 636f 7265 2e66 6c61 7474 656e   in core.flatten
-0002a6b0: 2861 7272 6179 732c 2063 6f6e 7461 696e  (arrays, contain
-0002a6c0: 6572 3d28 6c69 7374 2c20 7475 706c 6529  er=(list, tuple)
-0002a6d0: 290a 2020 2020 293a 0a20 2020 2020 2020  ).    ):.       
-0002a6e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0002a6f0: 2020 7820 3d20 756e 7061 636b 5f73 696e    x = unpack_sin
-0002a700: 676c 6574 6f6e 2861 7272 6179 7329 0a20  gleton(arrays). 
-0002a710: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002a720: 6e20 5f63 6f6e 6361 7465 6e61 7465 3228  n _concatenate2(
-0002a730: 6172 7261 7973 2c20 6178 6573 3d74 7570  arrays, axes=tup
-0002a740: 6c65 2872 616e 6765 2878 2e6e 6469 6d29  le(range(x.ndim)
-0002a750: 2929 0a20 2020 2020 2020 2065 7863 6570  )).        excep
-0002a760: 7420 5479 7065 4572 726f 723a 0a20 2020  t TypeError:.   
-0002a770: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-0002a780: 2020 2069 6620 636f 6e63 6174 656e 6174     if concatenat
-0002a790: 655f 6c6f 6f6b 7570 2e64 6973 7061 7463  e_lookup.dispatc
-0002a7a0: 6828 7479 7065 2861 6476 616e 6365 6429  h(type(advanced)
-0002a7b0: 2920 6973 206e 6f74 206e 702e 636f 6e63  ) is not np.conc
-0002a7c0: 6174 656e 6174 653a 0a20 2020 2020 2020  atenate:.       
-0002a7d0: 2078 203d 2075 6e70 6163 6b5f 7369 6e67   x = unpack_sing
-0002a7e0: 6c65 746f 6e28 6172 7261 7973 290a 2020  leton(arrays).  
-0002a7f0: 2020 2020 2020 7265 7475 726e 205f 636f        return _co
-0002a800: 6e63 6174 656e 6174 6532 2861 7272 6179  ncatenate2(array
-0002a810: 732c 2061 7865 733d 6c69 7374 2872 616e  s, axes=list(ran
-0002a820: 6765 2878 2e6e 6469 6d29 2929 0a0a 2020  ge(x.ndim)))..  
-0002a830: 2020 6e64 696d 203d 206e 6469 6d6c 6973    ndim = ndimlis
-0002a840: 7428 6172 7261 7973 290a 2020 2020 6966  t(arrays).    if
-0002a850: 206e 6f74 206e 6469 6d3a 0a20 2020 2020   not ndim:.     
-0002a860: 2020 2072 6574 7572 6e20 6172 7261 7973     return arrays
-0002a870: 0a20 2020 2063 6875 6e6b 7320 3d20 6368  .    chunks = ch
-0002a880: 756e 6b73 5f66 726f 6d5f 6172 7261 7973  unks_from_arrays
-0002a890: 2861 7272 6179 7329 0a20 2020 2073 6861  (arrays).    sha
-0002a8a0: 7065 203d 2074 7570 6c65 286d 6170 2873  pe = tuple(map(s
-0002a8b0: 756d 2c20 6368 756e 6b73 2929 0a0a 2020  um, chunks))..  
-0002a8c0: 2020 6465 6620 6474 7970 6528 7829 3a0a    def dtype(x):.
-0002a8d0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0002a8e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0002a8f0: 782e 6474 7970 650a 2020 2020 2020 2020  x.dtype.        
-0002a900: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
-0002a910: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-0002a920: 2020 2072 6574 7572 6e20 7479 7065 2878     return type(x
-0002a930: 290a 0a20 2020 2072 6573 756c 7420 3d20  )..    result = 
-0002a940: 6e70 2e65 6d70 7479 2873 6861 7065 3d73  np.empty(shape=s
-0002a950: 6861 7065 2c20 6474 7970 653d 6474 7970  hape, dtype=dtyp
-0002a960: 6528 6465 6570 6669 7273 7428 6172 7261  e(deepfirst(arra
-0002a970: 7973 2929 290a 0a20 2020 2066 6f72 2069  ys)))..    for i
-0002a980: 6478 2c20 6172 7220 696e 207a 6970 280a  dx, arr in zip(.
-0002a990: 2020 2020 2020 2020 736c 6963 6573 5f66          slices_f
-0002a9a0: 726f 6d5f 6368 756e 6b73 2863 6875 6e6b  rom_chunks(chunk
-0002a9b0: 7329 2c20 636f 7265 2e66 6c61 7474 656e  s), core.flatten
-0002a9c0: 2861 7272 6179 732c 2063 6f6e 7461 696e  (arrays, contain
-0002a9d0: 6572 3d28 6c69 7374 2c20 7475 706c 6529  er=(list, tuple)
-0002a9e0: 290a 2020 2020 293a 0a20 2020 2020 2020  ).    ):.       
-0002a9f0: 2069 6620 6861 7361 7474 7228 6172 722c   if hasattr(arr,
-0002aa00: 2022 6e64 696d 2229 3a0a 2020 2020 2020   "ndim"):.      
-0002aa10: 2020 2020 2020 7768 696c 6520 6172 722e        while arr.
-0002aa20: 6e64 696d 203c 206e 6469 6d3a 0a20 2020  ndim < ndim:.   
-0002aa30: 2020 2020 2020 2020 2020 2020 2061 7272               arr
-0002aa40: 203d 2061 7272 5b4e 6f6e 652c 202e 2e2e   = arr[None, ...
-0002aa50: 5d0a 2020 2020 2020 2020 7265 7375 6c74  ].        result
-0002aa60: 5b69 6478 5d20 3d20 6172 720a 0a20 2020  [idx] = arr..   
-0002aa70: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
-0002aa80: 0a64 6566 2063 6f6e 6361 7465 6e61 7465  .def concatenate
-0002aa90: 5f61 7865 7328 6172 7261 7973 2c20 6178  _axes(arrays, ax
-0002aaa0: 6573 293a 0a20 2020 2022 2222 5265 6375  es):.    """Recu
-0002aab0: 7273 6976 656c 7920 6361 6c6c 206e 702e  rsively call np.
-0002aac0: 636f 6e63 6174 656e 6174 6520 616c 6f6e  concatenate alon
-0002aad0: 6720 6178 6573 2222 220a 2020 2020 6966  g axes""".    if
-0002aae0: 206c 656e 2861 7865 7329 2021 3d20 6e64   len(axes) != nd
-0002aaf0: 696d 6c69 7374 2861 7272 6179 7329 3a0a  imlist(arrays):.
-0002ab00: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002ab10: 6c75 6545 7272 6f72 2822 4c65 6e67 7468  lueError("Length
-0002ab20: 206f 6620 6178 6573 2073 686f 756c 6420   of axes should 
-0002ab30: 6571 7561 6c20 6465 7074 6820 6f66 206e  equal depth of n
-0002ab40: 6573 7465 6420 6172 7261 7973 2229 0a0a  ested arrays")..
-0002ab50: 2020 2020 6578 7472 6164 696d 7320 3d20      extradims = 
-0002ab60: 6d61 7828 302c 2064 6565 7066 6972 7374  max(0, deepfirst
-0002ab70: 2861 7272 6179 7329 2e6e 6469 6d20 2d20  (arrays).ndim - 
-0002ab80: 286d 6178 2861 7865 7329 202b 2031 2929  (max(axes) + 1))
-0002ab90: 0a20 2020 2072 6574 7572 6e20 636f 6e63  .    return conc
-0002aba0: 6174 656e 6174 6533 2874 7261 6e73 706f  atenate3(transpo
-0002abb0: 7365 6c69 7374 2861 7272 6179 732c 2061  selist(arrays, a
-0002abc0: 7865 732c 2065 7874 7261 6469 6d73 3d65  xes, extradims=e
-0002abd0: 7874 7261 6469 6d73 2929 0a0a 0a64 6566  xtradims))...def
-0002abe0: 2074 6f5f 6864 6635 2866 696c 656e 616d   to_hdf5(filenam
-0002abf0: 652c 202a 6172 6773 2c20 6368 756e 6b73  e, *args, chunks
-0002ac00: 3d54 7275 652c 202a 2a6b 7761 7267 7329  =True, **kwargs)
-0002ac10: 3a0a 2020 2020 2222 2253 746f 7265 2061  :.    """Store a
-0002ac20: 7272 6179 7320 696e 2048 4446 3520 6669  rrays in HDF5 fi
-0002ac30: 6c65 0a0a 2020 2020 5468 6973 2073 6176  le..    This sav
-0002ac40: 6573 2073 6576 6572 616c 2064 6173 6b20  es several dask 
-0002ac50: 6172 7261 7973 2069 6e74 6f20 7365 7665  arrays into seve
-0002ac60: 7261 6c20 6461 7461 7061 7468 7320 696e  ral datapaths in
-0002ac70: 2061 6e20 4844 4635 2066 696c 652e 0a20   an HDF5 file.. 
-0002ac80: 2020 2049 7420 6372 6561 7465 7320 7468     It creates th
-0002ac90: 6520 6e65 6365 7373 6172 7920 6461 7461  e necessary data
-0002aca0: 7365 7473 2061 6e64 2068 616e 646c 6573  sets and handles
-0002acb0: 2063 6c65 616e 2066 696c 6520 6f70 656e   clean file open
-0002acc0: 696e 672f 636c 6f73 696e 672e 0a0a 2020  ing/closing...  
-0002acd0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-0002ace0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-0002acf0: 6368 756e 6b73 3a20 7475 706c 6520 6f72  chunks: tuple or
-0002ad00: 2060 6054 7275 6560 600a 2020 2020 2020   ``True``.      
-0002ad10: 2020 4368 756e 6b20 7368 6170 652c 206f    Chunk shape, o
-0002ad20: 7220 6060 5472 7565 6060 2074 6f20 7061  r ``True`` to pa
-0002ad30: 7373 2074 6865 2063 6875 6e6b 7320 6672  ss the chunks fr
-0002ad40: 6f6d 2074 6865 2064 6173 6b20 6172 7261  om the dask arra
-0002ad50: 792e 0a20 2020 2020 2020 2044 6566 6175  y..        Defau
-0002ad60: 6c74 7320 746f 2060 6054 7275 6560 602e  lts to ``True``.
-0002ad70: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-0002ad80: 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20 2020     --------..   
-0002ad90: 203e 3e3e 2064 612e 746f 5f68 6466 3528   >>> da.to_hdf5(
-0002ada0: 276d 7966 696c 652e 6864 6635 272c 2027  'myfile.hdf5', '
-0002adb0: 2f78 272c 2078 2920 2023 2064 6f63 7465  /x', x)  # docte
-0002adc0: 7374 3a20 2b53 4b49 500a 0a20 2020 206f  st: +SKIP..    o
-0002add0: 720a 0a20 2020 203e 3e3e 2064 612e 746f  r..    >>> da.to
-0002ade0: 5f68 6466 3528 276d 7966 696c 652e 6864  _hdf5('myfile.hd
-0002adf0: 6635 272c 207b 272f 7827 3a20 782c 2027  f5', {'/x': x, '
-0002ae00: 2f79 273a 2079 7d29 2020 2320 646f 6374  /y': y})  # doct
-0002ae10: 6573 743a 202b 534b 4950 0a0a 2020 2020  est: +SKIP..    
-0002ae20: 4f70 7469 6f6e 616c 6c79 2070 726f 7669  Optionally provi
-0002ae30: 6465 2061 7267 756d 656e 7473 2061 7320  de arguments as 
-0002ae40: 7468 6f75 6768 2074 6f20 6060 6835 7079  though to ``h5py
-0002ae50: 2e46 696c 652e 6372 6561 7465 5f64 6174  .File.create_dat
-0002ae60: 6173 6574 6060 0a0a 2020 2020 3e3e 3e20  aset``..    >>> 
-0002ae70: 6461 2e74 6f5f 6864 6635 2827 6d79 6669  da.to_hdf5('myfi
-0002ae80: 6c65 2e68 6466 3527 2c20 272f 7827 2c20  le.hdf5', '/x', 
-0002ae90: 782c 2063 6f6d 7072 6573 7369 6f6e 3d27  x, compression='
-0002aea0: 6c7a 6627 2c20 7368 7566 666c 653d 5472  lzf', shuffle=Tr
-0002aeb0: 7565 2920 2023 2064 6f63 7465 7374 3a20  ue)  # doctest: 
-0002aec0: 2b53 4b49 500a 0a20 2020 203e 3e3e 2064  +SKIP..    >>> d
-0002aed0: 612e 746f 5f68 6466 3528 276d 7966 696c  a.to_hdf5('myfil
-0002aee0: 652e 6864 6635 272c 2027 2f78 272c 2078  e.hdf5', '/x', x
-0002aef0: 2c20 6368 756e 6b73 3d28 3130 2c32 302c  , chunks=(10,20,
-0002af00: 3330 2929 2020 2320 646f 6374 6573 743a  30))  # doctest:
-0002af10: 202b 534b 4950 0a0a 2020 2020 5468 6973   +SKIP..    This
-0002af20: 2063 616e 2061 6c73 6f20 6265 2075 7365   can also be use
-0002af30: 6420 6173 2061 206d 6574 686f 6420 6f6e  d as a method on
-0002af40: 2061 2073 696e 676c 6520 4172 7261 790a   a single Array.
-0002af50: 0a20 2020 203e 3e3e 2078 2e74 6f5f 6864  .    >>> x.to_hd
-0002af60: 6635 2827 6d79 6669 6c65 2e68 6466 3527  f5('myfile.hdf5'
-0002af70: 2c20 272f 7827 2920 2023 2064 6f63 7465  , '/x')  # docte
-0002af80: 7374 3a20 2b53 4b49 500a 0a20 2020 2053  st: +SKIP..    S
-0002af90: 6565 2041 6c73 6f0a 2020 2020 2d2d 2d2d  ee Also.    ----
-0002afa0: 2d2d 2d2d 0a20 2020 2064 612e 7374 6f72  ----.    da.stor
-0002afb0: 650a 2020 2020 6835 7079 2e46 696c 652e  e.    h5py.File.
-0002afc0: 6372 6561 7465 5f64 6174 6173 6574 0a20  create_dataset. 
-0002afd0: 2020 2022 2222 0a20 2020 2069 6620 6c65     """.    if le
-0002afe0: 6e28 6172 6773 2920 3d3d 2031 2061 6e64  n(args) == 1 and
-0002aff0: 2069 7369 6e73 7461 6e63 6528 6172 6773   isinstance(args
-0002b000: 5b30 5d2c 2064 6963 7429 3a0a 2020 2020  [0], dict):.    
-0002b010: 2020 2020 6461 7461 203d 2061 7267 735b      data = args[
-0002b020: 305d 0a20 2020 2065 6c69 6620 6c65 6e28  0].    elif len(
-0002b030: 6172 6773 2920 3d3d 2032 2061 6e64 2069  args) == 2 and i
-0002b040: 7369 6e73 7461 6e63 6528 6172 6773 5b30  sinstance(args[0
-0002b050: 5d2c 2073 7472 2920 616e 6420 6973 696e  ], str) and isin
-0002b060: 7374 616e 6365 2861 7267 735b 315d 2c20  stance(args[1], 
-0002b070: 4172 7261 7929 3a0a 2020 2020 2020 2020  Array):.        
-0002b080: 6461 7461 203d 207b 6172 6773 5b30 5d3a  data = {args[0]:
-0002b090: 2061 7267 735b 315d 7d0a 2020 2020 656c   args[1]}.    el
-0002b0a0: 7365 3a0a 2020 2020 2020 2020 7261 6973  se:.        rais
-0002b0b0: 6520 5661 6c75 6545 7272 6f72 2822 506c  e ValueError("Pl
-0002b0c0: 6561 7365 2070 726f 7669 6465 207b 272f  ease provide {'/
-0002b0d0: 6461 7461 2f70 6174 6827 3a20 6172 7261  data/path': arra
-0002b0e0: 797d 2064 6963 7469 6f6e 6172 7922 290a  y} dictionary").
-0002b0f0: 0a20 2020 2069 6d70 6f72 7420 6835 7079  .    import h5py
-0002b100: 0a0a 2020 2020 7769 7468 2068 3570 792e  ..    with h5py.
-0002b110: 4669 6c65 2866 696c 656e 616d 652c 206d  File(filename, m
-0002b120: 6f64 653d 2261 2229 2061 7320 663a 0a20  ode="a") as f:. 
-0002b130: 2020 2020 2020 2064 7365 7473 203d 205b         dsets = [
-0002b140: 0a20 2020 2020 2020 2020 2020 2066 2e72  .            f.r
-0002b150: 6571 7569 7265 5f64 6174 6173 6574 280a  equire_dataset(.
-0002b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b170: 6470 2c0a 2020 2020 2020 2020 2020 2020  dp,.            
-0002b180: 2020 2020 7368 6170 653d 782e 7368 6170      shape=x.shap
-0002b190: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0002b1a0: 2020 2064 7479 7065 3d78 2e64 7479 7065     dtype=x.dtype
-0002b1b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002b1c0: 2020 6368 756e 6b73 3d74 7570 6c65 2863    chunks=tuple(c
-0002b1d0: 5b30 5d20 666f 7220 6320 696e 2078 2e63  [0] for c in x.c
-0002b1e0: 6875 6e6b 7329 2069 6620 6368 756e 6b73  hunks) if chunks
-0002b1f0: 2069 7320 5472 7565 2065 6c73 6520 6368   is True else ch
-0002b200: 756e 6b73 2c0a 2020 2020 2020 2020 2020  unks,.          
-0002b210: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-0002b220: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0002b230: 2020 2020 2020 2020 2020 666f 7220 6470            for dp
-0002b240: 2c20 7820 696e 2064 6174 612e 6974 656d  , x in data.item
-0002b250: 7328 290a 2020 2020 2020 2020 5d0a 2020  s().        ].  
-0002b260: 2020 2020 2020 7374 6f72 6528 6c69 7374        store(list
-0002b270: 2864 6174 612e 7661 6c75 6573 2829 292c  (data.values()),
-0002b280: 2064 7365 7473 290a 0a0a 6465 6620 696e   dsets)...def in
-0002b290: 7465 726c 6561 7665 5f6e 6f6e 6528 612c  terleave_none(a,
-0002b2a0: 2062 293a 0a20 2020 2022 2222 0a0a 2020   b):.    """..  
-0002b2b0: 2020 3e3e 3e20 696e 7465 726c 6561 7665    >>> interleave
-0002b2c0: 5f6e 6f6e 6528 5b30 2c20 4e6f 6e65 2c20  _none([0, None, 
-0002b2d0: 322c 204e 6f6e 655d 2c20 5b31 2c20 335d  2, None], [1, 3]
-0002b2e0: 290a 2020 2020 2830 2c20 312c 2032 2c20  ).    (0, 1, 2, 
-0002b2f0: 3329 0a20 2020 2022 2222 0a20 2020 2072  3).    """.    r
-0002b300: 6573 756c 7420 3d20 5b5d 0a20 2020 2069  esult = [].    i
-0002b310: 203d 206a 203d 2030 0a20 2020 206e 203d   = j = 0.    n =
-0002b320: 206c 656e 2861 2920 2b20 6c65 6e28 6229   len(a) + len(b)
-0002b330: 0a20 2020 2077 6869 6c65 2069 202b 206a  .    while i + j
-0002b340: 203c 206e 3a0a 2020 2020 2020 2020 6966   < n:.        if
-0002b350: 2061 5b69 5d20 6973 206e 6f74 204e 6f6e   a[i] is not Non
-0002b360: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0002b370: 6573 756c 742e 6170 7065 6e64 2861 5b69  esult.append(a[i
-0002b380: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-0002b390: 202b 3d20 310a 2020 2020 2020 2020 656c   += 1.        el
-0002b3a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002b3b0: 7265 7375 6c74 2e61 7070 656e 6428 625b  result.append(b[
-0002b3c0: 6a5d 290a 2020 2020 2020 2020 2020 2020  j]).            
-0002b3d0: 6920 2b3d 2031 0a20 2020 2020 2020 2020  i += 1.         
-0002b3e0: 2020 206a 202b 3d20 310a 2020 2020 7265     j += 1.    re
-0002b3f0: 7475 726e 2074 7570 6c65 2872 6573 756c  turn tuple(resul
-0002b400: 7429 0a0a 0a64 6566 206b 6579 6e61 6d65  t)...def keyname
-0002b410: 286e 616d 652c 2069 2c20 6f6b 6579 293a  (name, i, okey):
-0002b420: 0a20 2020 2022 2222 0a0a 2020 2020 3e3e  .    """..    >>
-0002b430: 3e20 6b65 796e 616d 6528 2778 272c 2033  > keyname('x', 3
-0002b440: 2c20 5b4e 6f6e 652c 204e 6f6e 652c 2030  , [None, None, 0
-0002b450: 2c20 325d 290a 2020 2020 2827 7827 2c20  , 2]).    ('x', 
-0002b460: 332c 2030 2c20 3229 0a20 2020 2022 2222  3, 0, 2).    """
-0002b470: 0a20 2020 2072 6574 7572 6e20 286e 616d  .    return (nam
-0002b480: 652c 2069 2920 2b20 7475 706c 6528 6b20  e, i) + tuple(k 
-0002b490: 666f 7220 6b20 696e 206f 6b65 7920 6966  for k in okey if
-0002b4a0: 206b 2069 7320 6e6f 7420 4e6f 6e65 290a   k is not None).
-0002b4b0: 0a0a 6465 6620 5f76 696e 6465 7828 782c  ..def _vindex(x,
-0002b4c0: 202a 696e 6465 7865 7329 3a0a 2020 2020   *indexes):.    
-0002b4d0: 2222 2250 6f69 6e74 2077 6973 6520 696e  """Point wise in
-0002b4e0: 6465 7869 6e67 2077 6974 6820 6272 6f61  dexing with broa
-0002b4f0: 6463 6173 7469 6e67 2e0a 0a20 2020 203e  dcasting...    >
-0002b500: 3e3e 2078 203d 206e 702e 6172 616e 6765  >> x = np.arange
-0002b510: 2835 3629 2e72 6573 6861 7065 2828 372c  (56).reshape((7,
-0002b520: 2038 2929 0a20 2020 203e 3e3e 2078 0a20   8)).    >>> x. 
-0002b530: 2020 2061 7272 6179 285b 5b20 302c 2020     array([[ 0,  
-0002b540: 312c 2020 322c 2020 332c 2020 342c 2020  1,  2,  3,  4,  
-0002b550: 352c 2020 362c 2020 375d 2c0a 2020 2020  5,  6,  7],.    
-0002b560: 2020 2020 2020 205b 2038 2c20 2039 2c20         [ 8,  9, 
-0002b570: 3130 2c20 3131 2c20 3132 2c20 3133 2c20  10, 11, 12, 13, 
-0002b580: 3134 2c20 3135 5d2c 0a20 2020 2020 2020  14, 15],.       
-0002b590: 2020 2020 5b31 362c 2031 372c 2031 382c      [16, 17, 18,
-0002b5a0: 2031 392c 2032 302c 2032 312c 2032 322c   19, 20, 21, 22,
-0002b5b0: 2032 335d 2c0a 2020 2020 2020 2020 2020   23],.          
-0002b5c0: 205b 3234 2c20 3235 2c20 3236 2c20 3237   [24, 25, 26, 27
-0002b5d0: 2c20 3238 2c20 3239 2c20 3330 2c20 3331  , 28, 29, 30, 31
-0002b5e0: 5d2c 0a20 2020 2020 2020 2020 2020 5b33  ],.           [3
-0002b5f0: 322c 2033 332c 2033 342c 2033 352c 2033  2, 33, 34, 35, 3
-0002b600: 362c 2033 372c 2033 382c 2033 395d 2c0a  6, 37, 38, 39],.
-0002b610: 2020 2020 2020 2020 2020 205b 3430 2c20             [40, 
-0002b620: 3431 2c20 3432 2c20 3433 2c20 3434 2c20  41, 42, 43, 44, 
-0002b630: 3435 2c20 3436 2c20 3437 5d2c 0a20 2020  45, 46, 47],.   
-0002b640: 2020 2020 2020 2020 5b34 382c 2034 392c          [48, 49,
-0002b650: 2035 302c 2035 312c 2035 322c 2035 332c   50, 51, 52, 53,
-0002b660: 2035 342c 2035 355d 5d29 0a0a 2020 2020   54, 55]])..    
-0002b670: 3e3e 3e20 6420 3d20 6672 6f6d 5f61 7272  >>> d = from_arr
-0002b680: 6179 2878 2c20 6368 756e 6b73 3d28 332c  ay(x, chunks=(3,
-0002b690: 2034 2929 0a20 2020 203e 3e3e 2072 6573   4)).    >>> res
-0002b6a0: 756c 7420 3d20 5f76 696e 6465 7828 642c  ult = _vindex(d,
-0002b6b0: 205b 302c 2031 2c20 362c 2030 5d2c 205b   [0, 1, 6, 0], [
-0002b6c0: 302c 2031 2c20 302c 2037 5d29 0a20 2020  0, 1, 0, 7]).   
-0002b6d0: 203e 3e3e 2072 6573 756c 742e 636f 6d70   >>> result.comp
-0002b6e0: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
-0002b6f0: 5b20 302c 2020 392c 2034 382c 2020 375d  [ 0,  9, 48,  7]
-0002b700: 290a 2020 2020 2222 220a 2020 2020 696e  ).    """.    in
-0002b710: 6465 7865 7320 3d20 7265 706c 6163 655f  dexes = replace_
-0002b720: 656c 6c69 7073 6973 2878 2e6e 6469 6d2c  ellipsis(x.ndim,
-0002b730: 2069 6e64 6578 6573 290a 0a20 2020 206e   indexes)..    n
-0002b740: 6f6e 6661 6e63 795f 696e 6465 7865 7320  onfancy_indexes 
-0002b750: 3d20 5b5d 0a20 2020 2072 6564 7563 6564  = [].    reduced
-0002b760: 5f69 6e64 6578 6573 203d 205b 5d0a 2020  _indexes = [].  
-0002b770: 2020 666f 7220 696e 6420 696e 2069 6e64    for ind in ind
-0002b780: 6578 6573 3a0a 2020 2020 2020 2020 6966  exes:.        if
-0002b790: 2069 7369 6e73 7461 6e63 6528 696e 642c   isinstance(ind,
-0002b7a0: 204e 756d 6265 7229 3a0a 2020 2020 2020   Number):.      
-0002b7b0: 2020 2020 2020 6e6f 6e66 616e 6379 5f69        nonfancy_i
-0002b7c0: 6e64 6578 6573 2e61 7070 656e 6428 696e  ndexes.append(in
-0002b7d0: 6429 0a20 2020 2020 2020 2065 6c69 6620  d).        elif 
-0002b7e0: 6973 696e 7374 616e 6365 2869 6e64 2c20  isinstance(ind, 
-0002b7f0: 736c 6963 6529 3a0a 2020 2020 2020 2020  slice):.        
-0002b800: 2020 2020 6e6f 6e66 616e 6379 5f69 6e64      nonfancy_ind
-0002b810: 6578 6573 2e61 7070 656e 6428 696e 6429  exes.append(ind)
-0002b820: 0a20 2020 2020 2020 2020 2020 2072 6564  .            red
-0002b830: 7563 6564 5f69 6e64 6578 6573 2e61 7070  uced_indexes.app
-0002b840: 656e 6428 736c 6963 6528 4e6f 6e65 2929  end(slice(None))
-0002b850: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0002b860: 2020 2020 2020 2020 2020 206e 6f6e 6661             nonfa
-0002b870: 6e63 795f 696e 6465 7865 732e 6170 7065  ncy_indexes.appe
-0002b880: 6e64 2873 6c69 6365 284e 6f6e 6529 290a  nd(slice(None)).
-0002b890: 2020 2020 2020 2020 2020 2020 7265 6475              redu
-0002b8a0: 6365 645f 696e 6465 7865 732e 6170 7065  ced_indexes.appe
-0002b8b0: 6e64 2869 6e64 290a 0a20 2020 206e 6f6e  nd(ind)..    non
-0002b8c0: 6661 6e63 795f 696e 6465 7865 7320 3d20  fancy_indexes = 
-0002b8d0: 7475 706c 6528 6e6f 6e66 616e 6379 5f69  tuple(nonfancy_i
-0002b8e0: 6e64 6578 6573 290a 2020 2020 7265 6475  ndexes).    redu
-0002b8f0: 6365 645f 696e 6465 7865 7320 3d20 7475  ced_indexes = tu
-0002b900: 706c 6528 7265 6475 6365 645f 696e 6465  ple(reduced_inde
-0002b910: 7865 7329 0a0a 2020 2020 7820 3d20 785b  xes)..    x = x[
-0002b920: 6e6f 6e66 616e 6379 5f69 6e64 6578 6573  nonfancy_indexes
-0002b930: 5d0a 0a20 2020 2061 7272 6179 5f69 6e64  ]..    array_ind
-0002b940: 6578 6573 203d 207b 7d0a 2020 2020 666f  exes = {}.    fo
-0002b950: 7220 692c 2028 696e 642c 2073 697a 6529  r i, (ind, size)
-0002b960: 2069 6e20 656e 756d 6572 6174 6528 7a69   in enumerate(zi
-0002b970: 7028 7265 6475 6365 645f 696e 6465 7865  p(reduced_indexe
-0002b980: 732c 2078 2e73 6861 7065 2929 3a0a 2020  s, x.shape)):.  
-0002b990: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0002b9a0: 6e73 7461 6e63 6528 696e 642c 2073 6c69  nstance(ind, sli
-0002b9b0: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
-0002b9c0: 2069 6e64 203d 206e 702e 6172 7261 7928   ind = np.array(
-0002b9d0: 696e 642c 2063 6f70 793d 5472 7565 290a  ind, copy=True).
-0002b9e0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0002b9f0: 6e64 2e64 7479 7065 2e6b 696e 6420 3d3d  nd.dtype.kind ==
-0002ba00: 2022 6222 3a0a 2020 2020 2020 2020 2020   "b":.          
-0002ba10: 2020 2020 2020 7261 6973 6520 496e 6465        raise Inde
-0002ba20: 7845 7272 6f72 2822 7669 6e64 6578 2064  xError("vindex d
-0002ba30: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
-0002ba40: 696e 6465 7869 6e67 2077 6974 6820 626f  indexing with bo
-0002ba50: 6f6c 6561 6e20 6172 7261 7973 2229 0a20  olean arrays"). 
-0002ba60: 2020 2020 2020 2020 2020 2069 6620 2828             if ((
-0002ba70: 696e 6420 3e3d 2073 697a 6529 207c 2028  ind >= size) | (
-0002ba80: 696e 6420 3c20 2d73 697a 6529 292e 616e  ind < -size)).an
-0002ba90: 7928 293a 0a20 2020 2020 2020 2020 2020  y():.           
-0002baa0: 2020 2020 2072 6169 7365 2049 6e64 6578       raise Index
-0002bab0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0002bac0: 2020 2020 2020 2020 2020 2022 7669 6e64             "vind
-0002bad0: 6578 206b 6579 2068 6173 2065 6e74 7269  ex key has entri
-0002bae0: 6573 206f 7574 206f 6620 626f 756e 6473  es out of bounds
-0002baf0: 2066 6f72 2022 0a20 2020 2020 2020 2020   for ".         
-0002bb00: 2020 2020 2020 2020 2020 2022 696e 6465             "inde
-0002bb10: 7869 6e67 2061 6c6f 6e67 2061 7869 7320  xing along axis 
-0002bb20: 2573 206f 6620 7369 7a65 2025 733a 2025  %s of size %s: %
-0002bb30: 7222 2025 2028 692c 2073 697a 652c 2069  r" % (i, size, i
-0002bb40: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
-0002bb50: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0002bb60: 2020 696e 6420 253d 2073 697a 650a 2020    ind %= size.  
-0002bb70: 2020 2020 2020 2020 2020 6172 7261 795f            array_
-0002bb80: 696e 6465 7865 735b 695d 203d 2069 6e64  indexes[i] = ind
-0002bb90: 0a0a 2020 2020 6966 2061 7272 6179 5f69  ..    if array_i
-0002bba0: 6e64 6578 6573 3a0a 2020 2020 2020 2020  ndexes:.        
-0002bbb0: 7820 3d20 5f76 696e 6465 785f 6172 7261  x = _vindex_arra
-0002bbc0: 7928 782c 2061 7272 6179 5f69 6e64 6578  y(x, array_index
-0002bbd0: 6573 290a 0a20 2020 2072 6574 7572 6e20  es)..    return 
-0002bbe0: 780a 0a0a 6465 6620 5f76 696e 6465 785f  x...def _vindex_
-0002bbf0: 6172 7261 7928 782c 2064 6963 745f 696e  array(x, dict_in
-0002bc00: 6465 7865 7329 3a0a 2020 2020 2222 2250  dexes):.    """P
-0002bc10: 6f69 6e74 2077 6973 6520 696e 6465 7869  oint wise indexi
-0002bc20: 6e67 2077 6974 6820 6f6e 6c79 204e 756d  ng with only Num
-0002bc30: 5079 2041 7272 6179 732e 2222 220a 0a20  Py Arrays.""".. 
-0002bc40: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0002bc50: 6272 6f61 6463 6173 745f 696e 6465 7865  broadcast_indexe
-0002bc60: 7320 3d20 6e70 2e62 726f 6164 6361 7374  s = np.broadcast
-0002bc70: 5f61 7272 6179 7328 2a64 6963 745f 696e  _arrays(*dict_in
-0002bc80: 6465 7865 732e 7661 6c75 6573 2829 290a  dexes.values()).
-0002bc90: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0002bca0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0002bcb0: 2020 2020 2320 6e6f 7465 3a20 6572 726f      # note: erro
-0002bcc0: 7220 6d65 7373 6167 6520 6578 6163 746c  r message exactl
-0002bcd0: 7920 6d61 7463 6865 7320 6e75 6d70 790a  y matches numpy.
-0002bce0: 2020 2020 2020 2020 7368 6170 6573 5f73          shapes_s
-0002bcf0: 7472 203d 2022 2022 2e6a 6f69 6e28 7374  tr = " ".join(st
-0002bd00: 7228 612e 7368 6170 6529 2066 6f72 2061  r(a.shape) for a
-0002bd10: 2069 6e20 6469 6374 5f69 6e64 6578 6573   in dict_indexes
-0002bd20: 2e76 616c 7565 7328 2929 0a20 2020 2020  .values()).     
-0002bd30: 2020 2072 6169 7365 2049 6e64 6578 4572     raise IndexEr
-0002bd40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0002bd50: 2022 7368 6170 6520 6d69 736d 6174 6368   "shape mismatch
-0002bd60: 3a20 696e 6465 7869 6e67 2061 7272 6179  : indexing array
-0002bd70: 7320 636f 756c 6420 6e6f 7420 6265 2022  s could not be "
-0002bd80: 0a20 2020 2020 2020 2020 2020 2022 6272  .            "br
-0002bd90: 6f61 6463 6173 7420 746f 6765 7468 6572  oadcast together
-0002bda0: 2077 6974 6820 7368 6170 6573 2022 202b   with shapes " +
-0002bdb0: 2073 6861 7065 735f 7374 720a 2020 2020   shapes_str.    
-0002bdc0: 2020 2020 2920 6672 6f6d 2065 0a20 2020      ) from e.   
-0002bdd0: 2062 726f 6164 6361 7374 5f73 6861 7065   broadcast_shape
-0002bde0: 203d 2062 726f 6164 6361 7374 5f69 6e64   = broadcast_ind
-0002bdf0: 6578 6573 5b30 5d2e 7368 6170 650a 0a20  exes[0].shape.. 
-0002be00: 2020 206c 6f6f 6b75 7020 3d20 6469 6374     lookup = dict
-0002be10: 287a 6970 2864 6963 745f 696e 6465 7865  (zip(dict_indexe
-0002be20: 732c 2062 726f 6164 6361 7374 5f69 6e64  s, broadcast_ind
-0002be30: 6578 6573 2929 0a20 2020 2066 6c61 745f  exes)).    flat_
-0002be40: 696e 6465 7865 7320 3d20 5b0a 2020 2020  indexes = [.    
-0002be50: 2020 2020 6c6f 6f6b 7570 5b69 5d2e 7261      lookup[i].ra
-0002be60: 7665 6c28 292e 746f 6c69 7374 2829 2069  vel().tolist() i
-0002be70: 6620 6920 696e 206c 6f6f 6b75 7020 656c  f i in lookup el
-0002be80: 7365 204e 6f6e 6520 666f 7220 6920 696e  se None for i in
-0002be90: 2072 616e 6765 2878 2e6e 6469 6d29 0a20   range(x.ndim). 
-0002bea0: 2020 205d 0a20 2020 2066 6c61 745f 696e     ].    flat_in
-0002beb0: 6465 7865 732e 6578 7465 6e64 285b 4e6f  dexes.extend([No
-0002bec0: 6e65 5d20 2a20 2878 2e6e 6469 6d20 2d20  ne] * (x.ndim - 
-0002bed0: 6c65 6e28 666c 6174 5f69 6e64 6578 6573  len(flat_indexes
-0002bee0: 2929 290a 0a20 2020 2066 6c61 745f 696e  )))..    flat_in
-0002bef0: 6465 7865 7320 3d20 5b0a 2020 2020 2020  dexes = [.      
-0002bf00: 2020 6c69 7374 2869 6e64 6578 2920 6966    list(index) if
-0002bf10: 2069 6e64 6578 2069 7320 6e6f 7420 4e6f   index is not No
-0002bf20: 6e65 2065 6c73 6520 696e 6465 7820 666f  ne else index fo
-0002bf30: 7220 696e 6465 7820 696e 2066 6c61 745f  r index in flat_
-0002bf40: 696e 6465 7865 730a 2020 2020 5d0a 2020  indexes.    ].  
-0002bf50: 2020 626f 756e 6473 203d 205b 6c69 7374    bounds = [list
-0002bf60: 2861 6363 756d 756c 6174 6528 6164 642c  (accumulate(add,
-0002bf70: 2028 302c 2920 2b20 6329 2920 666f 7220   (0,) + c)) for 
-0002bf80: 6320 696e 2078 2e63 6875 6e6b 735d 0a20  c in x.chunks]. 
-0002bf90: 2020 2062 6f75 6e64 7332 203d 205b 6220     bounds2 = [b 
-0002bfa0: 666f 7220 692c 2062 2069 6e20 7a69 7028  for i, b in zip(
-0002bfb0: 666c 6174 5f69 6e64 6578 6573 2c20 626f  flat_indexes, bo
-0002bfc0: 756e 6473 2920 6966 2069 2069 7320 6e6f  unds) if i is no
-0002bfd0: 7420 4e6f 6e65 5d0a 2020 2020 6178 6973  t None].    axis
-0002bfe0: 203d 205f 6765 745f 6178 6973 2866 6c61   = _get_axis(fla
-0002bff0: 745f 696e 6465 7865 7329 0a20 2020 2074  t_indexes).    t
-0002c000: 6f6b 656e 203d 2074 6f6b 656e 697a 6528  oken = tokenize(
-0002c010: 782c 2066 6c61 745f 696e 6465 7865 7329  x, flat_indexes)
-0002c020: 0a20 2020 206f 7574 5f6e 616d 6520 3d20  .    out_name = 
-0002c030: 2276 696e 6465 782d 6d65 7267 652d 2220  "vindex-merge-" 
-0002c040: 2b20 746f 6b65 6e0a 0a20 2020 2070 6f69  + token..    poi
-0002c050: 6e74 7320 3d20 6c69 7374 2829 0a20 2020  nts = list().   
-0002c060: 2066 6f72 2069 2c20 6964 7820 696e 2065   for i, idx in e
-0002c070: 6e75 6d65 7261 7465 287a 6970 282a 5b69  numerate(zip(*[i
-0002c080: 2066 6f72 2069 2069 6e20 666c 6174 5f69   for i in flat_i
-0002c090: 6e64 6578 6573 2069 6620 6920 6973 206e  ndexes if i is n
-0002c0a0: 6f74 204e 6f6e 655d 2929 3a0a 2020 2020  ot None])):.    
-0002c0b0: 2020 2020 626c 6f63 6b5f 6964 7820 3d20      block_idx = 
-0002c0c0: 5b62 6973 6563 7428 622c 2069 6e64 2920  [bisect(b, ind) 
-0002c0d0: 2d20 3120 666f 7220 622c 2069 6e64 2069  - 1 for b, ind i
-0002c0e0: 6e20 7a69 7028 626f 756e 6473 322c 2069  n zip(bounds2, i
-0002c0f0: 6478 295d 0a20 2020 2020 2020 2069 6e62  dx)].        inb
-0002c100: 6c6f 636b 5f69 6478 203d 205b 0a20 2020  lock_idx = [.   
-0002c110: 2020 2020 2020 2020 2069 6e64 202d 2062           ind - b
-0002c120: 6f75 6e64 7332 5b6b 5d5b 6a5d 2066 6f72  ounds2[k][j] for
-0002c130: 206b 2c20 2869 6e64 2c20 6a29 2069 6e20   k, (ind, j) in 
-0002c140: 656e 756d 6572 6174 6528 7a69 7028 6964  enumerate(zip(id
-0002c150: 782c 2062 6c6f 636b 5f69 6478 2929 0a20  x, block_idx)). 
-0002c160: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-0002c170: 2070 6f69 6e74 732e 6170 7065 6e64 2828   points.append((
-0002c180: 692c 2074 7570 6c65 2862 6c6f 636b 5f69  i, tuple(block_i
-0002c190: 6478 292c 2074 7570 6c65 2869 6e62 6c6f  dx), tuple(inblo
-0002c1a0: 636b 5f69 6478 2929 290a 0a20 2020 2063  ck_idx)))..    c
-0002c1b0: 6875 6e6b 7320 3d20 5b63 2066 6f72 2069  hunks = [c for i
-0002c1c0: 2c20 6320 696e 207a 6970 2866 6c61 745f  , c in zip(flat_
-0002c1d0: 696e 6465 7865 732c 2078 2e63 6875 6e6b  indexes, x.chunk
-0002c1e0: 7329 2069 6620 6920 6973 204e 6f6e 655d  s) if i is None]
-0002c1f0: 0a20 2020 2063 6875 6e6b 732e 696e 7365  .    chunks.inse
-0002c200: 7274 2830 2c20 286c 656e 2870 6f69 6e74  rt(0, (len(point
-0002c210: 7329 2c29 2069 6620 706f 696e 7473 2065  s),) if points e
-0002c220: 6c73 6520 2830 2c29 290a 2020 2020 6368  lse (0,)).    ch
-0002c230: 756e 6b73 203d 2074 7570 6c65 2863 6875  unks = tuple(chu
-0002c240: 6e6b 7329 0a0a 2020 2020 6966 2070 6f69  nks)..    if poi
-0002c250: 6e74 733a 0a20 2020 2020 2020 2070 6572  nts:.        per
-0002c260: 5f62 6c6f 636b 203d 2067 726f 7570 6279  _block = groupby
-0002c270: 2831 2c20 706f 696e 7473 290a 2020 2020  (1, points).    
-0002c280: 2020 2020 7065 725f 626c 6f63 6b20 3d20      per_block = 
-0002c290: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-0002c2a0: 6e20 7065 725f 626c 6f63 6b2e 6974 656d  n per_block.item
-0002c2b0: 7328 2920 6966 2076 7d0a 0a20 2020 2020  s() if v}..     
-0002c2c0: 2020 206f 7468 6572 5f62 6c6f 636b 7320     other_blocks 
-0002c2d0: 3d20 6c69 7374 280a 2020 2020 2020 2020  = list(.        
-0002c2e0: 2020 2020 7072 6f64 7563 7428 0a20 2020      product(.   
-0002c2f0: 2020 2020 2020 2020 2020 2020 202a 5b0a               *[.
-0002c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c310: 2020 2020 6c69 7374 2872 616e 6765 286c      list(range(l
-0002c320: 656e 2863 2929 2920 6966 2069 2069 7320  en(c))) if i is 
-0002c330: 4e6f 6e65 2065 6c73 6520 5b4e 6f6e 655d  None else [None]
-0002c340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c350: 2020 2020 2066 6f72 2069 2c20 6320 696e       for i, c in
-0002c360: 207a 6970 2866 6c61 745f 696e 6465 7865   zip(flat_indexe
-0002c370: 732c 2078 2e63 6875 6e6b 7329 0a20 2020  s, x.chunks).   
-0002c380: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-0002c390: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0002c3a0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002c3b0: 6675 6c6c 5f73 6c69 6365 7320 3d20 5b73  full_slices = [s
-0002c3c0: 6c69 6365 284e 6f6e 652c 204e 6f6e 6529  lice(None, None)
-0002c3d0: 2069 6620 6920 6973 204e 6f6e 6520 656c   if i is None el
-0002c3e0: 7365 204e 6f6e 6520 666f 7220 6920 696e  se None for i in
-0002c3f0: 2066 6c61 745f 696e 6465 7865 735d 0a0a   flat_indexes]..
-0002c400: 2020 2020 2020 2020 6e61 6d65 203d 2022          name = "
-0002c410: 7669 6e64 6578 2d73 6c69 6365 2d22 202b  vindex-slice-" +
-0002c420: 2074 6f6b 656e 0a20 2020 2020 2020 2076   token.        v
-0002c430: 696e 6465 785f 6d65 7267 655f 6e61 6d65  index_merge_name
-0002c440: 203d 2022 7669 6e64 6578 2d6d 6572 6765   = "vindex-merge
-0002c450: 2d22 202b 2074 6f6b 656e 0a20 2020 2020  -" + token.     
-0002c460: 2020 2064 736b 203d 207b 7d0a 2020 2020     dsk = {}.    
-0002c470: 2020 2020 666f 7220 6f6b 6579 2069 6e20      for okey in 
-0002c480: 6f74 6865 725f 626c 6f63 6b73 3a0a 2020  other_blocks:.  
-0002c490: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-0002c4a0: 206b 6579 2069 6e20 656e 756d 6572 6174   key in enumerat
-0002c4b0: 6528 7065 725f 626c 6f63 6b29 3a0a 2020  e(per_block):.  
-0002c4c0: 2020 2020 2020 2020 2020 2020 2020 6473                ds
-0002c4d0: 6b5b 6b65 796e 616d 6528 6e61 6d65 2c20  k[keyname(name, 
-0002c4e0: 692c 206f 6b65 7929 5d20 3d20 280a 2020  i, okey)] = (.  
-0002c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c500: 2020 5f76 696e 6465 785f 7472 616e 7370    _vindex_transp
-0002c510: 6f73 652c 0a20 2020 2020 2020 2020 2020  ose,.           
-0002c520: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-0002c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c540: 2020 205f 7669 6e64 6578 5f73 6c69 6365     _vindex_slice
-0002c550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c560: 2020 2020 2020 2020 2020 2878 2e6e 616d            (x.nam
-0002c570: 652c 2920 2b20 696e 7465 726c 6561 7665  e,) + interleave
-0002c580: 5f6e 6f6e 6528 6f6b 6579 2c20 6b65 7929  _none(okey, key)
-0002c590: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002c5a0: 2020 2020 2020 2020 2020 696e 7465 726c            interl
-0002c5b0: 6561 7665 5f6e 6f6e 6528 0a20 2020 2020  eave_none(.     
-0002c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c5d0: 2020 2020 2020 2066 756c 6c5f 736c 6963         full_slic
-0002c5e0: 6573 2c20 6c69 7374 287a 6970 282a 706c  es, list(zip(*pl
-0002c5f0: 7563 6b28 322c 2070 6572 5f62 6c6f 636b  uck(2, per_block
-0002c600: 5b6b 6579 5d29 2929 0a20 2020 2020 2020  [key]))).       
-0002c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c620: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0002c630: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-0002c640: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0002c650: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-0002c660: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0002c670: 2020 2064 736b 5b6b 6579 6e61 6d65 2876     dsk[keyname(v
-0002c680: 696e 6465 785f 6d65 7267 655f 6e61 6d65  index_merge_name
-0002c690: 2c20 302c 206f 6b65 7929 5d20 3d20 280a  , 0, okey)] = (.
-0002c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c6b0: 5f76 696e 6465 785f 6d65 7267 652c 0a20  _vindex_merge,. 
-0002c6c0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0002c6d0: 6c69 7374 2870 6c75 636b 2830 2c20 7065  list(pluck(0, pe
-0002c6e0: 725f 626c 6f63 6b5b 6b65 795d 2929 2066  r_block[key])) f
-0002c6f0: 6f72 206b 6579 2069 6e20 7065 725f 626c  or key in per_bl
-0002c700: 6f63 6b5d 2c0a 2020 2020 2020 2020 2020  ock],.          
-0002c710: 2020 2020 2020 5b6b 6579 6e61 6d65 286e        [keyname(n
-0002c720: 616d 652c 2069 2c20 6f6b 6579 2920 666f  ame, i, okey) fo
-0002c730: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0002c740: 2870 6572 5f62 6c6f 636b 2929 5d2c 0a20  (per_block))],. 
-0002c750: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0002c760: 2020 2020 2020 7265 7375 6c74 5f31 6420        result_1d 
-0002c770: 3d20 4172 7261 7928 0a20 2020 2020 2020  = Array(.       
-0002c780: 2020 2020 2048 6967 684c 6576 656c 4772       HighLevelGr
-0002c790: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-0002c7a0: 696f 6e73 286f 7574 5f6e 616d 652c 2064  ions(out_name, d
-0002c7b0: 736b 2c20 6465 7065 6e64 656e 6369 6573  sk, dependencies
-0002c7c0: 3d5b 785d 292c 0a20 2020 2020 2020 2020  =[x]),.         
-0002c7d0: 2020 206f 7574 5f6e 616d 652c 0a20 2020     out_name,.   
-0002c7e0: 2020 2020 2020 2020 2063 6875 6e6b 732c           chunks,
-0002c7f0: 0a20 2020 2020 2020 2020 2020 2078 2e64  .            x.d
-0002c800: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-0002c810: 2020 6d65 7461 3d78 2e5f 6d65 7461 2c0a    meta=x._meta,.
-0002c820: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0002c830: 2020 7265 7475 726e 2072 6573 756c 745f    return result_
-0002c840: 3164 2e72 6573 6861 7065 2862 726f 6164  1d.reshape(broad
-0002c850: 6361 7374 5f73 6861 7065 202b 2072 6573  cast_shape + res
-0002c860: 756c 745f 3164 2e73 6861 7065 5b31 3a5d  ult_1d.shape[1:]
-0002c870: 290a 0a20 2020 2023 206f 7574 7075 7420  )..    # output 
-0002c880: 6861 7320 6120 7a65 726f 2064 696d 656e  has a zero dimen
-0002c890: 7369 6f6e 2c20 6a75 7374 2063 7265 6174  sion, just creat
-0002c8a0: 6520 6120 6e65 7720 7a65 726f 2d73 6861  e a new zero-sha
-0002c8b0: 7065 2061 7272 6179 2077 6974 6820 7468  pe array with th
-0002c8c0: 650a 2020 2020 2320 7361 6d65 2064 7479  e.    # same dty
-0002c8d0: 7065 0a20 2020 2066 726f 6d20 6461 736b  pe.    from dask
-0002c8e0: 2e61 7272 6179 2e77 7261 7020 696d 706f  .array.wrap impo
-0002c8f0: 7274 2065 6d70 7479 0a0a 2020 2020 7265  rt empty..    re
-0002c900: 7375 6c74 5f31 6420 3d20 656d 7074 7928  sult_1d = empty(
-0002c910: 0a20 2020 2020 2020 2074 7570 6c65 286d  .        tuple(m
-0002c920: 6170 2873 756d 2c20 6368 756e 6b73 2929  ap(sum, chunks))
-0002c930: 2c20 6368 756e 6b73 3d63 6875 6e6b 732c  , chunks=chunks,
-0002c940: 2064 7479 7065 3d78 2e64 7479 7065 2c20   dtype=x.dtype, 
-0002c950: 6e61 6d65 3d6f 7574 5f6e 616d 650a 2020  name=out_name.  
-0002c960: 2020 290a 2020 2020 7265 7475 726e 2072    ).    return r
-0002c970: 6573 756c 745f 3164 2e72 6573 6861 7065  esult_1d.reshape
-0002c980: 2862 726f 6164 6361 7374 5f73 6861 7065  (broadcast_shape
-0002c990: 202b 2072 6573 756c 745f 3164 2e73 6861   + result_1d.sha
-0002c9a0: 7065 5b31 3a5d 290a 0a0a 6465 6620 5f67  pe[1:])...def _g
-0002c9b0: 6574 5f61 7869 7328 696e 6465 7865 7329  et_axis(indexes)
-0002c9c0: 3a0a 2020 2020 2222 2247 6574 2061 7869  :.    """Get axi
-0002c9d0: 7320 616c 6f6e 6720 7768 6963 6820 706f  s along which po
-0002c9e0: 696e 742d 7769 7365 2073 6c69 6369 6e67  int-wise slicing
-0002c9f0: 2072 6573 756c 7473 206c 6965 0a0a 2020   results lie..  
-0002ca00: 2020 5468 6973 2069 7320 6d6f 7374 6c79    This is mostly
-0002ca10: 2061 2068 6163 6b20 6265 6361 7573 6520   a hack because 
-0002ca20: 4920 6361 6e27 7420 6669 6775 7265 206f  I can't figure o
-0002ca30: 7574 204e 756d 5079 2773 2072 756c 6520  ut NumPy's rule 
-0002ca40: 6f6e 2074 6869 7320 616e 640a 2020 2020  on this and.    
-0002ca50: 6361 6e27 7420 6265 2062 6f74 6865 7265  can't be bothere
-0002ca60: 6420 746f 2067 6f20 7265 6164 696e 672e  d to go reading.
-0002ca70: 0a0a 2020 2020 3e3e 3e20 5f67 6574 5f61  ..    >>> _get_a
-0002ca80: 7869 7328 5b5b 312c 2032 5d2c 204e 6f6e  xis([[1, 2], Non
-0002ca90: 652c 205b 312c 2032 5d2c 204e 6f6e 655d  e, [1, 2], None]
-0002caa0: 290a 2020 2020 300a 2020 2020 3e3e 3e20  ).    0.    >>> 
-0002cab0: 5f67 6574 5f61 7869 7328 5b4e 6f6e 652c  _get_axis([None,
-0002cac0: 205b 312c 2032 5d2c 205b 312c 2032 5d2c   [1, 2], [1, 2],
-0002cad0: 204e 6f6e 655d 290a 2020 2020 310a 2020   None]).    1.  
-0002cae0: 2020 3e3e 3e20 5f67 6574 5f61 7869 7328    >>> _get_axis(
-0002caf0: 5b4e 6f6e 652c 204e 6f6e 652c 205b 312c  [None, None, [1,
-0002cb00: 2032 5d2c 205b 312c 2032 5d5d 290a 2020   2], [1, 2]]).  
-0002cb10: 2020 320a 2020 2020 2222 220a 2020 2020    2.    """.    
-0002cb20: 6e64 696d 203d 206c 656e 2869 6e64 6578  ndim = len(index
-0002cb30: 6573 290a 2020 2020 696e 6465 7865 7320  es).    indexes 
-0002cb40: 3d20 5b73 6c69 6365 284e 6f6e 652c 204e  = [slice(None, N
-0002cb50: 6f6e 6529 2069 6620 6920 6973 204e 6f6e  one) if i is Non
-0002cb60: 6520 656c 7365 205b 305d 2066 6f72 2069  e else [0] for i
-0002cb70: 2069 6e20 696e 6465 7865 735d 0a20 2020   in indexes].   
-0002cb80: 2078 203d 206e 702e 656d 7074 7928 2832   x = np.empty((2
-0002cb90: 2c29 202a 206e 6469 6d29 0a20 2020 2078  ,) * ndim).    x
-0002cba0: 3220 3d20 785b 7475 706c 6528 696e 6465  2 = x[tuple(inde
-0002cbb0: 7865 7329 5d0a 2020 2020 7265 7475 726e  xes)].    return
-0002cbc0: 2078 322e 7368 6170 652e 696e 6465 7828   x2.shape.index(
-0002cbd0: 3129 0a0a 0a64 6566 205f 7669 6e64 6578  1)...def _vindex
-0002cbe0: 5f73 6c69 6365 2862 6c6f 636b 2c20 706f  _slice(block, po
-0002cbf0: 696e 7473 293a 0a20 2020 2022 2222 5075  ints):.    """Pu
-0002cc00: 6c6c 206f 7574 2070 6f69 6e74 2d77 6973  ll out point-wis
-0002cc10: 6520 736c 6963 6573 2066 726f 6d20 626c  e slices from bl
-0002cc20: 6f63 6b22 2222 0a20 2020 2070 6f69 6e74  ock""".    point
-0002cc30: 7320 3d20 5b70 2069 6620 6973 696e 7374  s = [p if isinst
-0002cc40: 616e 6365 2870 2c20 736c 6963 6529 2065  ance(p, slice) e
-0002cc50: 6c73 6520 6c69 7374 2870 2920 666f 7220  lse list(p) for 
-0002cc60: 7020 696e 2070 6f69 6e74 735d 0a20 2020  p in points].   
-0002cc70: 2072 6574 7572 6e20 626c 6f63 6b5b 7475   return block[tu
-0002cc80: 706c 6528 706f 696e 7473 295d 0a0a 0a64  ple(points)]...d
-0002cc90: 6566 205f 7669 6e64 6578 5f74 7261 6e73  ef _vindex_trans
-0002cca0: 706f 7365 2862 6c6f 636b 2c20 6178 6973  pose(block, axis
-0002ccb0: 293a 0a20 2020 2022 2222 526f 7461 7465  ):.    """Rotate
-0002ccc0: 2062 6c6f 636b 2073 6f20 7468 6174 2070   block so that p
-0002ccd0: 6f69 6e74 7320 6172 6520 6f6e 2074 6865  oints are on the
-0002cce0: 2066 6972 7374 2064 696d 656e 7369 6f6e   first dimension
-0002ccf0: 2222 220a 2020 2020 6178 6573 203d 205b  """.    axes = [
-0002cd00: 6178 6973 5d20 2b20 6c69 7374 2872 616e  axis] + list(ran
-0002cd10: 6765 2861 7869 7329 2920 2b20 6c69 7374  ge(axis)) + list
-0002cd20: 2872 616e 6765 2861 7869 7320 2b20 312c  (range(axis + 1,
-0002cd30: 2062 6c6f 636b 2e6e 6469 6d29 290a 2020   block.ndim)).  
-0002cd40: 2020 7265 7475 726e 2062 6c6f 636b 2e74    return block.t
-0002cd50: 7261 6e73 706f 7365 2861 7865 7329 0a0a  ranspose(axes)..
-0002cd60: 0a64 6566 205f 7669 6e64 6578 5f6d 6572  .def _vindex_mer
-0002cd70: 6765 286c 6f63 6174 696f 6e73 2c20 7661  ge(locations, va
-0002cd80: 6c75 6573 293a 0a20 2020 2022 2222 0a0a  lues):.    """..
-0002cd90: 2020 2020 3e3e 3e20 6c6f 6361 7469 6f6e      >>> location
-0002cda0: 7320 3d20 5b30 5d2c 205b 322c 2031 5d0a  s = [0], [2, 1].
-0002cdb0: 2020 2020 3e3e 3e20 7661 6c75 6573 203d      >>> values =
-0002cdc0: 205b 6e70 2e61 7272 6179 285b 5b31 2c20   [np.array([[1, 
-0002cdd0: 322c 2033 5d5d 292c 0a20 2020 202e 2e2e  2, 3]]),.    ...
-0002cde0: 2020 2020 2020 2020 2020 206e 702e 6172             np.ar
-0002cdf0: 7261 7928 5b5b 3130 2c20 3230 2c20 3330  ray([[10, 20, 30
-0002ce00: 5d2c 205b 3430 2c20 3530 2c20 3630 5d5d  ], [40, 50, 60]]
-0002ce10: 295d 0a0a 2020 2020 3e3e 3e20 5f76 696e  )]..    >>> _vin
-0002ce20: 6465 785f 6d65 7267 6528 6c6f 6361 7469  dex_merge(locati
-0002ce30: 6f6e 732c 2076 616c 7565 7329 0a20 2020  ons, values).   
-0002ce40: 2061 7272 6179 285b 5b20 312c 2020 322c   array([[ 1,  2,
-0002ce50: 2020 335d 2c0a 2020 2020 2020 2020 2020    3],.          
-0002ce60: 205b 3430 2c20 3530 2c20 3630 5d2c 0a20   [40, 50, 60],. 
-0002ce70: 2020 2020 2020 2020 2020 5b31 302c 2032            [10, 2
-0002ce80: 302c 2033 305d 5d29 0a20 2020 2022 2222  0, 30]]).    """
-0002ce90: 0a20 2020 206c 6f63 6174 696f 6e73 203d  .    locations =
-0002cea0: 206c 6973 7428 6d61 7028 6c69 7374 2c20   list(map(list, 
-0002ceb0: 6c6f 6361 7469 6f6e 7329 290a 2020 2020  locations)).    
-0002cec0: 7661 6c75 6573 203d 206c 6973 7428 7661  values = list(va
-0002ced0: 6c75 6573 290a 0a20 2020 206e 203d 2073  lues)..    n = s
-0002cee0: 756d 286d 6170 286c 656e 2c20 6c6f 6361  um(map(len, loca
-0002cef0: 7469 6f6e 7329 290a 0a20 2020 2073 6861  tions))..    sha
-0002cf00: 7065 203d 206c 6973 7428 7661 6c75 6573  pe = list(values
-0002cf10: 5b30 5d2e 7368 6170 6529 0a20 2020 2073  [0].shape).    s
-0002cf20: 6861 7065 5b30 5d20 3d20 6e0a 2020 2020  hape[0] = n.    
-0002cf30: 7368 6170 6520 3d20 7475 706c 6528 7368  shape = tuple(sh
-0002cf40: 6170 6529 0a0a 2020 2020 6474 7970 6520  ape)..    dtype 
-0002cf50: 3d20 7661 6c75 6573 5b30 5d2e 6474 7970  = values[0].dtyp
-0002cf60: 650a 0a20 2020 2078 203d 206e 702e 656d  e..    x = np.em
-0002cf70: 7074 795f 6c69 6b65 2876 616c 7565 735b  pty_like(values[
-0002cf80: 305d 2c20 6474 7970 653d 6474 7970 652c  0], dtype=dtype,
-0002cf90: 2073 6861 7065 3d73 6861 7065 290a 0a20   shape=shape).. 
-0002cfa0: 2020 2069 6e64 203d 205b 736c 6963 6528     ind = [slice(
-0002cfb0: 4e6f 6e65 2c20 4e6f 6e65 2920 666f 7220  None, None) for 
-0002cfc0: 6920 696e 2072 616e 6765 2878 2e6e 6469  i in range(x.ndi
-0002cfd0: 6d29 5d0a 2020 2020 666f 7220 6c6f 632c  m)].    for loc,
-0002cfe0: 2076 616c 2069 6e20 7a69 7028 6c6f 6361   val in zip(loca
-0002cff0: 7469 6f6e 732c 2076 616c 7565 7329 3a0a  tions, values):.
-0002d000: 2020 2020 2020 2020 696e 645b 305d 203d          ind[0] =
-0002d010: 206c 6f63 0a20 2020 2020 2020 2078 5b74   loc.        x[t
-0002d020: 7570 6c65 2869 6e64 295d 203d 2076 616c  uple(ind)] = val
-0002d030: 0a0a 2020 2020 7265 7475 726e 2078 0a0a  ..    return x..
-0002d040: 0a64 6566 2074 6f5f 6e70 795f 7374 6163  .def to_npy_stac
-0002d050: 6b28 6469 726e 616d 652c 2078 2c20 6178  k(dirname, x, ax
-0002d060: 6973 3d30 293a 0a20 2020 2022 2222 5772  is=0):.    """Wr
-0002d070: 6974 6520 6461 736b 2061 7272 6179 2074  ite dask array t
-0002d080: 6f20 6120 7374 6163 6b20 6f66 202e 6e70  o a stack of .np
-0002d090: 7920 6669 6c65 730a 0a20 2020 2054 6869  y files..    Thi
-0002d0a0: 7320 7061 7274 6974 696f 6e73 2074 6865  s partitions the
-0002d0b0: 2064 6173 6b2e 6172 7261 7920 616c 6f6e   dask.array alon
-0002d0c0: 6720 6f6e 6520 6178 6973 2061 6e64 2073  g one axis and s
-0002d0d0: 746f 7265 7320 6561 6368 2062 6c6f 636b  tores each block
-0002d0e0: 2061 6c6f 6e67 0a20 2020 2074 6861 7420   along.    that 
-0002d0f0: 6178 6973 2061 7320 6120 7369 6e67 6c65  axis as a single
-0002d100: 202e 6e70 7920 6669 6c65 2069 6e20 7468   .npy file in th
-0002d110: 6520 7370 6563 6966 6965 6420 6469 7265  e specified dire
-0002d120: 6374 6f72 790a 0a20 2020 2045 7861 6d70  ctory..    Examp
-0002d130: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0002d140: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
-0002d150: 6f6e 6573 2828 352c 2031 302c 2031 3029  ones((5, 10, 10)
-0002d160: 2c20 6368 756e 6b73 3d28 322c 2034 2c20  , chunks=(2, 4, 
-0002d170: 3429 2920 2023 2064 6f63 7465 7374 3a20  4))  # doctest: 
-0002d180: 2b53 4b49 500a 2020 2020 3e3e 3e20 6461  +SKIP.    >>> da
-0002d190: 2e74 6f5f 6e70 795f 7374 6163 6b28 2764  .to_npy_stack('d
-0002d1a0: 6174 612f 272c 2078 2c20 6178 6973 3d30  ata/', x, axis=0
-0002d1b0: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-0002d1c0: 4b49 500a 0a20 2020 2054 6865 2060 602e  KIP..    The ``.
-0002d1d0: 6e70 7960 6020 6669 6c65 7320 7374 6f72  npy`` files stor
-0002d1e0: 6520 6e75 6d70 7920 6172 7261 7973 2066  e numpy arrays f
-0002d1f0: 6f72 2060 6078 5b30 3a32 5d2c 2078 5b32  or ``x[0:2], x[2
-0002d200: 3a34 5d2c 2061 6e64 2078 5b34 3a35 5d60  :4], and x[4:5]`
-0002d210: 600a 2020 2020 7265 7370 6563 7469 7665  `.    respective
-0002d220: 6c79 2c20 6173 2069 7320 7370 6563 6966  ly, as is specif
-0002d230: 6965 6420 6279 2074 6865 2063 6875 6e6b  ied by the chunk
-0002d240: 2073 697a 6520 616c 6f6e 6720 7468 6520   size along the 
-0002d250: 7a65 726f 7468 2061 7869 733a 3a0a 0a20  zeroth axis::.. 
-0002d260: 2020 2020 2020 2024 2074 7265 6520 6461         $ tree da
-0002d270: 7461 2f0a 2020 2020 2020 2020 6461 7461  ta/.        data
-0002d280: 2f0a 2020 2020 2020 2020 7c2d 2d20 302e  /.        |-- 0.
-0002d290: 6e70 790a 2020 2020 2020 2020 7c2d 2d20  npy.        |-- 
-0002d2a0: 312e 6e70 790a 2020 2020 2020 2020 7c2d  1.npy.        |-
-0002d2b0: 2d20 322e 6e70 790a 2020 2020 2020 2020  - 2.npy.        
-0002d2c0: 7c2d 2d20 696e 666f 0a0a 2020 2020 5468  |-- info..    Th
-0002d2d0: 6520 6060 696e 666f 6060 2066 696c 6520  e ``info`` file 
-0002d2e0: 7374 6f72 6573 2074 6865 2064 7479 7065  stores the dtype
-0002d2f0: 2c20 6368 756e 6b73 2c20 616e 6420 6178  , chunks, and ax
-0002d300: 6973 2069 6e66 6f72 6d61 7469 6f6e 206f  is information o
-0002d310: 6620 7468 6520 6172 7261 792e 0a20 2020  f the array..   
-0002d320: 2059 6f75 2063 616e 206c 6f61 6420 7468   You can load th
-0002d330: 6573 6520 7374 6163 6b73 2077 6974 6820  ese stacks with 
-0002d340: 7468 6520 3a66 756e 633a 6064 6173 6b2e  the :func:`dask.
-0002d350: 6172 7261 792e 6672 6f6d 5f6e 7079 5f73  array.from_npy_s
-0002d360: 7461 636b 6020 6675 6e63 7469 6f6e 2e0a  tack` function..
-0002d370: 0a20 2020 203e 3e3e 2079 203d 2064 612e  .    >>> y = da.
-0002d380: 6672 6f6d 5f6e 7079 5f73 7461 636b 2827  from_npy_stack('
-0002d390: 6461 7461 2f27 2920 2023 2064 6f63 7465  data/')  # docte
-0002d3a0: 7374 3a20 2b53 4b49 500a 0a20 2020 2053  st: +SKIP..    S
-0002d3b0: 6565 2041 6c73 6f0a 2020 2020 2d2d 2d2d  ee Also.    ----
-0002d3c0: 2d2d 2d2d 0a20 2020 2066 726f 6d5f 6e70  ----.    from_np
-0002d3d0: 795f 7374 6163 6b0a 2020 2020 2222 220a  y_stack.    """.
-0002d3e0: 0a20 2020 2063 6875 6e6b 7320 3d20 7475  .    chunks = tu
-0002d3f0: 706c 6528 2863 2069 6620 6920 3d3d 2061  ple((c if i == a
-0002d400: 7869 7320 656c 7365 2028 7375 6d28 6329  xis else (sum(c)
-0002d410: 2c29 2920 666f 7220 692c 2063 2069 6e20  ,)) for i, c in 
-0002d420: 656e 756d 6572 6174 6528 782e 6368 756e  enumerate(x.chun
-0002d430: 6b73 2929 0a20 2020 2078 7820 3d20 782e  ks)).    xx = x.
-0002d440: 7265 6368 756e 6b28 6368 756e 6b73 290a  rechunk(chunks).
-0002d450: 0a20 2020 2069 6620 6e6f 7420 6f73 2e70  .    if not os.p
-0002d460: 6174 682e 6578 6973 7473 2864 6972 6e61  ath.exists(dirna
-0002d470: 6d65 293a 0a20 2020 2020 2020 206f 732e  me):.        os.
-0002d480: 6d6b 6469 7228 6469 726e 616d 6529 0a0a  mkdir(dirname)..
-0002d490: 2020 2020 6d65 7461 203d 207b 2263 6875      meta = {"chu
-0002d4a0: 6e6b 7322 3a20 6368 756e 6b73 2c20 2264  nks": chunks, "d
-0002d4b0: 7479 7065 223a 2078 2e64 7479 7065 2c20  type": x.dtype, 
-0002d4c0: 2261 7869 7322 3a20 6178 6973 7d0a 0a20  "axis": axis}.. 
-0002d4d0: 2020 2077 6974 6820 6f70 656e 286f 732e     with open(os.
-0002d4e0: 7061 7468 2e6a 6f69 6e28 6469 726e 616d  path.join(dirnam
-0002d4f0: 652c 2022 696e 666f 2229 2c20 2277 6222  e, "info"), "wb"
-0002d500: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-0002d510: 7069 636b 6c65 2e64 756d 7028 6d65 7461  pickle.dump(meta
-0002d520: 2c20 6629 0a0a 2020 2020 6e61 6d65 203d  , f)..    name =
-0002d530: 2022 746f 2d6e 7079 2d73 7461 636b 2d22   "to-npy-stack-"
-0002d540: 202b 2073 7472 2875 7569 642e 7575 6964   + str(uuid.uuid
-0002d550: 3128 2929 0a20 2020 2064 736b 203d 207b  1()).    dsk = {
-0002d560: 0a20 2020 2020 2020 2028 6e61 6d65 2c20  .        (name, 
-0002d570: 6929 3a20 286e 702e 7361 7665 2c20 6f73  i): (np.save, os
-0002d580: 2e70 6174 682e 6a6f 696e 2864 6972 6e61  .path.join(dirna
-0002d590: 6d65 2c20 2225 642e 6e70 7922 2025 2069  me, "%d.npy" % i
-0002d5a0: 292c 206b 6579 290a 2020 2020 2020 2020  ), key).        
-0002d5b0: 666f 7220 692c 206b 6579 2069 6e20 656e  for i, key in en
-0002d5c0: 756d 6572 6174 6528 636f 7265 2e66 6c61  umerate(core.fla
-0002d5d0: 7474 656e 2878 782e 5f5f 6461 736b 5f6b  tten(xx.__dask_k
-0002d5e0: 6579 735f 5f28 2929 290a 2020 2020 7d0a  eys__())).    }.
-0002d5f0: 0a20 2020 2067 7261 7068 203d 2048 6967  .    graph = Hig
-0002d600: 684c 6576 656c 4772 6170 682e 6672 6f6d  hLevelGraph.from
-0002d610: 5f63 6f6c 6c65 6374 696f 6e73 286e 616d  _collections(nam
-0002d620: 652c 2064 736b 2c20 6465 7065 6e64 656e  e, dsk, dependen
-0002d630: 6369 6573 3d5b 7878 5d29 0a20 2020 2063  cies=[xx]).    c
-0002d640: 6f6d 7075 7465 5f61 735f 6966 5f63 6f6c  ompute_as_if_col
-0002d650: 6c65 6374 696f 6e28 4172 7261 792c 2067  lection(Array, g
-0002d660: 7261 7068 2c20 6c69 7374 2864 736b 2929  raph, list(dsk))
-0002d670: 0a0a 0a64 6566 2066 726f 6d5f 6e70 795f  ...def from_npy_
-0002d680: 7374 6163 6b28 6469 726e 616d 652c 206d  stack(dirname, m
-0002d690: 6d61 705f 6d6f 6465 3d22 7222 293a 0a20  map_mode="r"):. 
-0002d6a0: 2020 2022 2222 4c6f 6164 2064 6173 6b20     """Load dask 
-0002d6b0: 6172 7261 7920 6672 6f6d 2073 7461 636b  array from stack
-0002d6c0: 206f 6620 6e70 7920 6669 6c65 730a 0a20   of npy files.. 
-0002d6d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0002d6e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-0002d6f0: 2064 6972 6e61 6d65 3a20 7374 7269 6e67   dirname: string
-0002d700: 0a20 2020 2020 2020 2044 6972 6563 746f  .        Directo
-0002d710: 7279 206f 6620 2e6e 7079 2066 696c 6573  ry of .npy files
-0002d720: 0a20 2020 206d 6d61 705f 6d6f 6465 3a20  .    mmap_mode: 
-0002d730: 284e 6f6e 6520 6f72 2027 7227 290a 2020  (None or 'r').  
-0002d740: 2020 2020 2020 5265 6164 2064 6174 6120        Read data 
-0002d750: 696e 206d 656d 6f72 7920 6d61 7020 6d6f  in memory map mo
-0002d760: 6465 0a0a 2020 2020 5365 6520 416c 736f  de..    See Also
-0002d770: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0002d780: 2020 746f 5f6e 7079 5f73 7461 636b 0a20    to_npy_stack. 
-0002d790: 2020 2022 2222 0a20 2020 2077 6974 6820     """.    with 
-0002d7a0: 6f70 656e 286f 732e 7061 7468 2e6a 6f69  open(os.path.joi
-0002d7b0: 6e28 6469 726e 616d 652c 2022 696e 666f  n(dirname, "info
-0002d7c0: 2229 2c20 2272 6222 2920 6173 2066 3a0a  "), "rb") as f:.
-0002d7d0: 2020 2020 2020 2020 696e 666f 203d 2070          info = p
-0002d7e0: 6963 6b6c 652e 6c6f 6164 2866 290a 0a20  ickle.load(f).. 
-0002d7f0: 2020 2064 7479 7065 203d 2069 6e66 6f5b     dtype = info[
-0002d800: 2264 7479 7065 225d 0a20 2020 2063 6875  "dtype"].    chu
-0002d810: 6e6b 7320 3d20 696e 666f 5b22 6368 756e  nks = info["chun
-0002d820: 6b73 225d 0a20 2020 2061 7869 7320 3d20  ks"].    axis = 
-0002d830: 696e 666f 5b22 6178 6973 225d 0a0a 2020  info["axis"]..  
-0002d840: 2020 6e61 6d65 203d 2022 6672 6f6d 2d6e    name = "from-n
-0002d850: 7079 2d73 7461 636b 2d25 7322 2025 2064  py-stack-%s" % d
-0002d860: 6972 6e61 6d65 0a20 2020 206b 6579 7320  irname.    keys 
-0002d870: 3d20 6c69 7374 2870 726f 6475 6374 285b  = list(product([
-0002d880: 6e61 6d65 5d2c 202a 5b72 616e 6765 286c  name], *[range(l
-0002d890: 656e 2863 2929 2066 6f72 2063 2069 6e20  en(c)) for c in 
-0002d8a0: 6368 756e 6b73 5d29 290a 2020 2020 7661  chunks])).    va
-0002d8b0: 6c75 6573 203d 205b 0a20 2020 2020 2020  lues = [.       
-0002d8c0: 2028 6e70 2e6c 6f61 642c 206f 732e 7061   (np.load, os.pa
-0002d8d0: 7468 2e6a 6f69 6e28 6469 726e 616d 652c  th.join(dirname,
-0002d8e0: 2022 2564 2e6e 7079 2220 2520 6929 2c20   "%d.npy" % i), 
-0002d8f0: 6d6d 6170 5f6d 6f64 6529 0a20 2020 2020  mmap_mode).     
-0002d900: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0002d910: 6528 6c65 6e28 6368 756e 6b73 5b61 7869  e(len(chunks[axi
-0002d920: 735d 2929 0a20 2020 205d 0a20 2020 2064  s])).    ].    d
-0002d930: 736b 203d 2064 6963 7428 7a69 7028 6b65  sk = dict(zip(ke
-0002d940: 7973 2c20 7661 6c75 6573 2929 0a0a 2020  ys, values))..  
-0002d950: 2020 7265 7475 726e 2041 7272 6179 2864    return Array(d
-0002d960: 736b 2c20 6e61 6d65 2c20 6368 756e 6b73  sk, name, chunks
-0002d970: 2c20 6474 7970 6529 0a0a 0a64 6566 206e  , dtype)...def n
-0002d980: 6577 5f64 615f 6f62 6a65 6374 2864 736b  ew_da_object(dsk
-0002d990: 2c20 6e61 6d65 2c20 6368 756e 6b73 2c20  , name, chunks, 
-0002d9a0: 6d65 7461 3d4e 6f6e 652c 2064 7479 7065  meta=None, dtype
-0002d9b0: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2247  =None):.    """G
-0002d9c0: 656e 6572 6963 2063 6f6e 7374 7275 6374  eneric construct
-0002d9d0: 6f72 2066 6f72 2064 6173 6b2e 6172 7261  or for dask.arra
-0002d9e0: 7920 6f72 2064 6173 6b2e 6461 7461 6672  y or dask.datafr
-0002d9f0: 616d 6520 6f62 6a65 6374 732e 0a0a 2020  ame objects...  
-0002da00: 2020 4465 6369 6465 7320 7468 6520 6170    Decides the ap
-0002da10: 7072 6f70 7269 6174 6520 6f75 7470 7574  propriate output
-0002da20: 2063 6c61 7373 2062 6173 6564 206f 6e20   class based on 
-0002da30: 7468 6520 7479 7065 206f 6620 606d 6574  the type of `met
-0002da40: 6160 2070 726f 7669 6465 642e 0a20 2020  a` provided..   
-0002da50: 2022 2222 0a20 2020 2069 6620 6973 5f64   """.    if is_d
-0002da60: 6174 6166 7261 6d65 5f6c 696b 6528 6d65  ataframe_like(me
-0002da70: 7461 2920 6f72 2069 735f 7365 7269 6573  ta) or is_series
-0002da80: 5f6c 696b 6528 6d65 7461 2920 6f72 2069  _like(meta) or i
-0002da90: 735f 696e 6465 785f 6c69 6b65 286d 6574  s_index_like(met
-0002daa0: 6129 3a0a 2020 2020 2020 2020 6672 6f6d  a):.        from
-0002dab0: 2064 6173 6b2e 6461 7461 6672 616d 652e   dask.dataframe.
-0002dac0: 636f 7265 2069 6d70 6f72 7420 6e65 775f  core import new_
-0002dad0: 6464 5f6f 626a 6563 740a 0a20 2020 2020  dd_object..     
-0002dae0: 2020 2061 7373 6572 7420 616c 6c28 6c65     assert all(le
-0002daf0: 6e28 6329 203d 3d20 3120 666f 7220 6320  n(c) == 1 for c 
-0002db00: 696e 2063 6875 6e6b 735b 313a 5d29 0a20  in chunks[1:]). 
-0002db10: 2020 2020 2020 2064 6976 6973 696f 6e73         divisions
-0002db20: 203d 205b 4e6f 6e65 5d20 2a20 286c 656e   = [None] * (len
-0002db30: 2863 6875 6e6b 735b 305d 2920 2b20 3129  (chunks[0]) + 1)
-0002db40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002db50: 6e65 775f 6464 5f6f 626a 6563 7428 6473  new_dd_object(ds
-0002db60: 6b2c 206e 616d 652c 206d 6574 612c 2064  k, name, meta, d
-0002db70: 6976 6973 696f 6e73 290a 2020 2020 656c  ivisions).    el
-0002db80: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
-0002db90: 726e 2041 7272 6179 2864 736b 2c20 6e61  rn Array(dsk, na
-0002dba0: 6d65 3d6e 616d 652c 2063 6875 6e6b 733d  me=name, chunks=
-0002dbb0: 6368 756e 6b73 2c20 6d65 7461 3d6d 6574  chunks, meta=met
-0002dbc0: 612c 2064 7479 7065 3d64 7479 7065 290a  a, dtype=dtype).
-0002dbd0: 0a0a 636c 6173 7320 426c 6f63 6b56 6965  ..class BlockVie
-0002dbe0: 773a 0a20 2020 2022 2222 416e 2061 7272  w:.    """An arr
-0002dbf0: 6179 2d6c 696b 6520 696e 7465 7266 6163  ay-like interfac
-0002dc00: 6520 746f 2074 6865 2062 6c6f 636b 7320  e to the blocks 
-0002dc10: 6f66 2061 6e20 6172 7261 792e 0a0a 2020  of an array...  
-0002dc20: 2020 6060 426c 6f63 6b56 6965 7760 6020    ``BlockView`` 
-0002dc30: 7072 6f76 6964 6573 2061 6e20 6172 7261  provides an arra
-0002dc40: 792d 6c69 6b65 2069 6e74 6572 6661 6365  y-like interface
-0002dc50: 0a20 2020 2074 6f20 7468 6520 626c 6f63  .    to the bloc
-0002dc60: 6b73 206f 6620 6120 6461 736b 2061 7272  ks of a dask arr
-0002dc70: 6179 2e20 204e 756d 7079 2d73 7479 6c65  ay.  Numpy-style
-0002dc80: 2069 6e64 6578 696e 6720 6f66 2061 0a20   indexing of a. 
-0002dc90: 2020 2020 6060 426c 6f63 6b56 6965 7760      ``BlockView`
-0002dca0: 6020 7265 7475 726e 7320 6120 7365 6c65  ` returns a sele
-0002dcb0: 6374 696f 6e20 6f66 2062 6c6f 636b 7320  ction of blocks 
-0002dcc0: 6173 2061 206e 6577 2064 6173 6b20 6172  as a new dask ar
-0002dcd0: 7261 792e 0a0a 2020 2020 596f 7520 6361  ray...    You ca
-0002dce0: 6e20 696e 6465 7820 6060 426c 6f63 6b56  n index ``BlockV
-0002dcf0: 6965 7760 6020 6c69 6b65 2061 206e 756d  iew`` like a num
-0002dd00: 7079 2061 7272 6179 206f 6620 7368 6170  py array of shap
-0002dd10: 650a 2020 2020 6571 7561 6c20 746f 2074  e.    equal to t
-0002dd20: 6865 206e 756d 6265 7220 6f66 2062 6c6f  he number of blo
-0002dd30: 636b 7320 696e 2065 6163 6820 6469 6d65  cks in each dime
-0002dd40: 6e73 696f 6e2c 2028 6176 6169 6c61 626c  nsion, (availabl
-0002dd50: 6520 6173 0a20 2020 2061 7272 6179 2e62  e as.    array.b
-0002dd60: 6c6f 636b 732e 7369 7a65 292e 2020 5468  locks.size).  Th
-0002dd70: 6520 6469 6d65 6e73 696f 6e61 6c69 7479  e dimensionality
-0002dd80: 206f 6620 7468 6520 6f75 7470 7574 2061   of the output a
-0002dd90: 7272 6179 206d 6174 6368 6573 0a20 2020  rray matches.   
-0002dda0: 2074 6865 2064 696d 656e 7369 6f6e 206f   the dimension o
-0002ddb0: 6620 7468 6973 2061 7272 6179 2c20 6576  f this array, ev
-0002ddc0: 656e 2069 6620 696e 7465 6765 7220 696e  en if integer in
-0002ddd0: 6469 6365 7320 6172 6520 7061 7373 6564  dices are passed
-0002dde0: 2e0a 2020 2020 536c 6963 696e 6720 7769  ..    Slicing wi
-0002ddf0: 7468 2060 606e 702e 6e65 7761 7869 7360  th ``np.newaxis`
-0002de00: 6020 6f72 206d 756c 7469 706c 6520 6c69  ` or multiple li
-0002de10: 7374 7320 6973 206e 6f74 2073 7570 706f  sts is not suppo
-0002de20: 7274 6564 2e0a 0a20 2020 2045 7861 6d70  rted...    Examp
-0002de30: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-0002de40: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
-0002de50: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
-0002de60: 0a20 2020 203e 3e3e 2066 726f 6d20 6461  .    >>> from da
-0002de70: 736b 2e61 7272 6179 2e63 6f72 6520 696d  sk.array.core im
-0002de80: 706f 7274 2042 6c6f 636b 5669 6577 0a20  port BlockView. 
-0002de90: 2020 203e 3e3e 2078 203d 2064 612e 6172     >>> x = da.ar
-0002dea0: 616e 6765 2838 2c20 6368 756e 6b73 3d32  ange(8, chunks=2
-0002deb0: 290a 2020 2020 3e3e 3e20 6276 203d 2042  ).    >>> bv = B
-0002dec0: 6c6f 636b 5669 6577 2878 290a 2020 2020  lockView(x).    
-0002ded0: 3e3e 3e20 6276 2e73 6861 7065 2023 2061  >>> bv.shape # a
-0002dee0: 6c69 6173 6573 2078 2e6e 756d 626c 6f63  liases x.numbloc
-0002def0: 6b73 0a20 2020 2028 342c 290a 2020 2020  ks.    (4,).    
-0002df00: 3e3e 3e20 6276 2e73 697a 650a 2020 2020  >>> bv.size.    
-0002df10: 340a 2020 2020 3e3e 3e20 6276 5b30 5d2e  4.    >>> bv[0].
-0002df20: 636f 6d70 7574 6528 290a 2020 2020 6172  compute().    ar
-0002df30: 7261 7928 5b30 2c20 315d 290a 2020 2020  ray([0, 1]).    
-0002df40: 3e3e 3e20 6276 5b3a 335d 2e63 6f6d 7075  >>> bv[:3].compu
-0002df50: 7465 2829 0a20 2020 2061 7272 6179 285b  te().    array([
-0002df60: 302c 2031 2c20 322c 2033 2c20 342c 2035  0, 1, 2, 3, 4, 5
-0002df70: 5d29 0a20 2020 203e 3e3e 2062 765b 3a3a  ]).    >>> bv[::
-0002df80: 325d 2e63 6f6d 7075 7465 2829 0a20 2020  2].compute().   
-0002df90: 2061 7272 6179 285b 302c 2031 2c20 342c   array([0, 1, 4,
-0002dfa0: 2035 5d29 0a20 2020 203e 3e3e 2062 765b   5]).    >>> bv[
-0002dfb0: 5b2d 312c 2030 5d5d 2e63 6f6d 7075 7465  [-1, 0]].compute
-0002dfc0: 2829 0a20 2020 2061 7272 6179 285b 362c  ().    array([6,
-0002dfd0: 2037 2c20 302c 2031 5d29 0a20 2020 203e   7, 0, 1]).    >
-0002dfe0: 3e3e 2062 762e 7261 7665 6c28 2920 2023  >> bv.ravel()  #
-0002dff0: 2064 6f63 7465 7374 3a20 2b4e 4f52 4d41   doctest: +NORMA
-0002e000: 4c49 5a45 5f57 4849 5445 5350 4143 450a  LIZE_WHITESPACE.
-0002e010: 2020 2020 5b64 6173 6b2e 6172 7261 793c      [dask.array<
-0002e020: 626c 6f63 6b73 2c20 7368 6170 653d 2832  blocks, shape=(2
-0002e030: 2c29 2c20 6474 7970 653d 696e 7436 342c  ,), dtype=int64,
-0002e040: 2063 6875 6e6b 7369 7a65 3d28 322c 292c   chunksize=(2,),
-0002e050: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
-0002e060: 2e6e 6461 7272 6179 3e2c 0a20 2020 2020  .ndarray>,.     
-0002e070: 6461 736b 2e61 7272 6179 3c62 6c6f 636b  dask.array<block
-0002e080: 732c 2073 6861 7065 3d28 322c 292c 2064  s, shape=(2,), d
-0002e090: 7479 7065 3d69 6e74 3634 2c20 6368 756e  type=int64, chun
-0002e0a0: 6b73 697a 653d 2832 2c29 2c20 6368 756e  ksize=(2,), chun
-0002e0b0: 6b74 7970 653d 6e75 6d70 792e 6e64 6172  ktype=numpy.ndar
-0002e0c0: 7261 793e 2c0a 2020 2020 2064 6173 6b2e  ray>,.     dask.
-0002e0d0: 6172 7261 793c 626c 6f63 6b73 2c20 7368  array<blocks, sh
-0002e0e0: 6170 653d 2832 2c29 2c20 6474 7970 653d  ape=(2,), dtype=
-0002e0f0: 696e 7436 342c 2063 6875 6e6b 7369 7a65  int64, chunksize
-0002e100: 3d28 322c 292c 2063 6875 6e6b 7479 7065  =(2,), chunktype
-0002e110: 3d6e 756d 7079 2e6e 6461 7272 6179 3e2c  =numpy.ndarray>,
-0002e120: 0a20 2020 2020 6461 736b 2e61 7272 6179  .     dask.array
-0002e130: 3c62 6c6f 636b 732c 2073 6861 7065 3d28  <blocks, shape=(
-0002e140: 322c 292c 2064 7479 7065 3d69 6e74 3634  2,), dtype=int64
-0002e150: 2c20 6368 756e 6b73 697a 653d 2832 2c29  , chunksize=(2,)
-0002e160: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
-0002e170: 792e 6e64 6172 7261 793e 5d0a 0a20 2020  y.ndarray>]..   
-0002e180: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-0002e190: 2d2d 2d2d 0a20 2020 2041 6e20 696e 7374  ----.    An inst
-0002e1a0: 616e 6365 206f 6620 6060 6461 2e61 7272  ance of ``da.arr
-0002e1b0: 6179 2e42 6c6f 636b 7669 6577 6060 0a20  ay.Blockview``. 
-0002e1c0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-0002e1d0: 5f5f 696e 6974 5f5f 2873 656c 662c 2061  __init__(self, a
-0002e1e0: 7272 6179 3a20 4172 7261 7929 3a0a 2020  rray: Array):.  
-0002e1f0: 2020 2020 2020 7365 6c66 2e5f 6172 7261        self._arra
-0002e200: 7920 3d20 6172 7261 790a 0a20 2020 2064  y = array..    d
-0002e210: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-0002e220: 656c 662c 2069 6e64 6578 3a20 416e 7929  elf, index: Any)
-0002e230: 202d 3e20 4172 7261 793a 0a20 2020 2020   -> Array:.     
-0002e240: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-0002e250: 6179 2e73 6c69 6369 6e67 2069 6d70 6f72  ay.slicing impor
-0002e260: 7420 6e6f 726d 616c 697a 655f 696e 6465  t normalize_inde
-0002e270: 780a 0a20 2020 2020 2020 2069 6620 6e6f  x..        if no
-0002e280: 7420 6973 696e 7374 616e 6365 2869 6e64  t isinstance(ind
-0002e290: 6578 2c20 7475 706c 6529 3a0a 2020 2020  ex, tuple):.    
-0002e2a0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-0002e2b0: 2869 6e64 6578 2c29 0a20 2020 2020 2020  (index,).       
-0002e2c0: 2069 6620 7375 6d28 6973 696e 7374 616e   if sum(isinstan
-0002e2d0: 6365 2869 6e64 2c20 286e 702e 6e64 6172  ce(ind, (np.ndar
-0002e2e0: 7261 792c 206c 6973 7429 2920 666f 7220  ray, list)) for 
-0002e2f0: 696e 6420 696e 2069 6e64 6578 2920 3e20  ind in index) > 
-0002e300: 313a 0a20 2020 2020 2020 2020 2020 2072  1:.            r
-0002e310: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0002e320: 2243 616e 206f 6e6c 7920 736c 6963 6520  "Can only slice 
-0002e330: 7769 7468 2061 2073 696e 676c 6520 6c69  with a single li
-0002e340: 7374 2229 0a20 2020 2020 2020 2069 6620  st").        if 
-0002e350: 616e 7928 696e 6420 6973 204e 6f6e 6520  any(ind is None 
-0002e360: 666f 7220 696e 6420 696e 2069 6e64 6578  for ind in index
-0002e370: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0002e380: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0002e390: 2253 6c69 6369 6e67 2077 6974 6820 6e70  "Slicing with np
-0002e3a0: 2e6e 6577 6178 6973 206f 7220 4e6f 6e65  .newaxis or None
-0002e3b0: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
-0002e3c0: 6422 290a 2020 2020 2020 2020 696e 6465  d").        inde
-0002e3d0: 7820 3d20 6e6f 726d 616c 697a 655f 696e  x = normalize_in
-0002e3e0: 6465 7828 696e 6465 782c 2073 656c 662e  dex(index, self.
-0002e3f0: 5f61 7272 6179 2e6e 756d 626c 6f63 6b73  _array.numblocks
-0002e400: 290a 2020 2020 2020 2020 696e 6465 7820  ).        index 
-0002e410: 3d20 7475 706c 6528 0a20 2020 2020 2020  = tuple(.       
-0002e420: 2020 2020 2073 6c69 6365 286b 2c20 6b20       slice(k, k 
-0002e430: 2b20 3129 2069 6620 6973 696e 7374 616e  + 1) if isinstan
-0002e440: 6365 286b 2c20 4e75 6d62 6572 2920 656c  ce(k, Number) el
-0002e450: 7365 206b 2020 2320 7479 7065 3a20 6967  se k  # type: ig
-0002e460: 6e6f 7265 0a20 2020 2020 2020 2020 2020  nore.           
-0002e470: 2066 6f72 206b 2069 6e20 696e 6465 780a   for k in index.
-0002e480: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0002e490: 2020 206e 616d 6520 3d20 2262 6c6f 636b     name = "block
-0002e4a0: 732d 2220 2b20 746f 6b65 6e69 7a65 2873  s-" + tokenize(s
-0002e4b0: 656c 662e 5f61 7272 6179 2c20 696e 6465  elf._array, inde
-0002e4c0: 7829 0a0a 2020 2020 2020 2020 6e65 775f  x)..        new_
-0002e4d0: 6b65 7973 203d 2073 656c 662e 5f61 7272  keys = self._arr
-0002e4e0: 6179 2e5f 6b65 795f 6172 7261 795b 696e  ay._key_array[in
-0002e4f0: 6465 785d 0a0a 2020 2020 2020 2020 6368  dex]..        ch
-0002e500: 756e 6b73 203d 2074 7570 6c65 280a 2020  unks = tuple(.  
-0002e510: 2020 2020 2020 2020 2020 7475 706c 6528            tuple(
-0002e520: 6e70 2e61 7272 6179 2863 295b 695d 2e74  np.array(c)[i].t
-0002e530: 6f6c 6973 7428 2929 2066 6f72 2063 2c20  olist()) for c, 
-0002e540: 6920 696e 207a 6970 2873 656c 662e 5f61  i in zip(self._a
-0002e550: 7272 6179 2e63 6875 6e6b 732c 2069 6e64  rray.chunks, ind
-0002e560: 6578 290a 2020 2020 2020 2020 290a 0a20  ex).        ).. 
-0002e570: 2020 2020 2020 206b 6579 7320 3d20 7072         keys = pr
-0002e580: 6f64 7563 7428 2a28 7261 6e67 6528 6c65  oduct(*(range(le
-0002e590: 6e28 6329 2920 666f 7220 6320 696e 2063  n(c)) for c in c
-0002e5a0: 6875 6e6b 7329 290a 0a20 2020 2020 2020  hunks))..       
-0002e5b0: 206c 6179 6572 203d 207b 286e 616d 652c   layer = {(name,
-0002e5c0: 2920 2b20 6b65 793a 2074 7570 6c65 286e  ) + key: tuple(n
-0002e5d0: 6577 5f6b 6579 735b 6b65 795d 2e74 6f6c  ew_keys[key].tol
-0002e5e0: 6973 7428 2929 2066 6f72 206b 6579 2069  ist()) for key i
-0002e5f0: 6e20 6b65 7973 7d0a 0a20 2020 2020 2020  n keys}..       
-0002e600: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
-0002e610: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
-0002e620: 6c65 6374 696f 6e73 286e 616d 652c 206c  lections(name, l
-0002e630: 6179 6572 2c20 6465 7065 6e64 656e 6369  ayer, dependenci
-0002e640: 6573 3d5b 7365 6c66 2e5f 6172 7261 795d  es=[self._array]
-0002e650: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002e660: 2041 7272 6179 2867 7261 7068 2c20 6e61   Array(graph, na
-0002e670: 6d65 2c20 6368 756e 6b73 2c20 6d65 7461  me, chunks, meta
-0002e680: 3d73 656c 662e 5f61 7272 6179 290a 0a20  =self._array).. 
-0002e690: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
-0002e6a0: 6c66 2c20 6f74 6865 723a 2041 6e79 2920  lf, other: Any) 
-0002e6b0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-0002e6c0: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-0002e6d0: 7468 6572 2c20 426c 6f63 6b56 6965 7729  ther, BlockView)
-0002e6e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0002e6f0: 7475 726e 2073 656c 662e 5f61 7272 6179  turn self._array
-0002e700: 2069 7320 6f74 6865 722e 5f61 7272 6179   is other._array
-0002e710: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0002e720: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002e730: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-0002e740: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-0002e750: 2020 2020 6465 6620 7369 7a65 2873 656c      def size(sel
-0002e760: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0002e770: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-0002e780: 6865 2074 6f74 616c 206e 756d 6265 7220  he total number 
-0002e790: 6f66 2062 6c6f 636b 7320 696e 2074 6865  of blocks in the
-0002e7a0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
-0002e7b0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0002e7c0: 726e 206d 6174 682e 7072 6f64 2873 656c  rn math.prod(sel
-0002e7d0: 662e 7368 6170 6529 0a0a 2020 2020 4070  f.shape)..    @p
-0002e7e0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0002e7f0: 7368 6170 6528 7365 6c66 2920 2d3e 2074  shape(self) -> t
-0002e800: 7570 6c65 5b69 6e74 2c20 2e2e 2e5d 3a0a  uple[int, ...]:.
-0002e810: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0002e820: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
-0002e830: 6620 626c 6f63 6b73 2070 6572 2061 7869  f blocks per axi
-0002e840: 732e 2041 6c69 6173 206f 6620 6060 6461  s. Alias of ``da
-0002e850: 736b 2e61 7272 6179 2e6e 756d 626c 6f63  sk.array.numbloc
-0002e860: 6b73 6060 2e0a 2020 2020 2020 2020 2222  ks``..        ""
-0002e870: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0002e880: 2073 656c 662e 5f61 7272 6179 2e6e 756d   self._array.num
-0002e890: 626c 6f63 6b73 0a0a 2020 2020 6465 6620  blocks..    def 
-0002e8a0: 7261 7665 6c28 7365 6c66 2920 2d3e 206c  ravel(self) -> l
-0002e8b0: 6973 745b 4172 7261 795d 3a0a 2020 2020  ist[Array]:.    
-0002e8c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002e8d0: 5265 7475 726e 2061 2066 6c61 7474 656e  Return a flatten
-0002e8e0: 6564 206c 6973 7420 6f66 2061 6c6c 2074  ed list of all t
-0002e8f0: 6865 2062 6c6f 636b 7320 696e 2074 6865  he blocks in the
-0002e900: 2061 7272 6179 2069 6e20 4320 6f72 6465   array in C orde
-0002e910: 722e 0a20 2020 2020 2020 2022 2222 0a20  r..        """. 
-0002e920: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
-0002e930: 656c 665b 6964 785d 2066 6f72 2069 6478  elf[idx] for idx
-0002e940: 2069 6e20 6e70 2e6e 6469 6e64 6578 2873   in np.ndindex(s
-0002e950: 656c 662e 7368 6170 6529 5d0a 0a0a 6672  elf.shape)]...fr
-0002e960: 6f6d 2064 6173 6b2e 6172 7261 792e 626c  om dask.array.bl
-0002e970: 6f63 6b77 6973 6520 696d 706f 7274 2062  ockwise import b
-0002e980: 6c6f 636b 7769 7365 0a66 726f 6d20 6461  lockwise.from da
-0002e990: 736b 2e61 7272 6179 2e75 7469 6c73 2069  sk.array.utils i
-0002e9a0: 6d70 6f72 7420 636f 6d70 7574 655f 6d65  mport compute_me
-0002e9b0: 7461 2c20 6d65 7461 5f66 726f 6d5f 6172  ta, meta_from_ar
-0002e9c0: 7261 790a                                ray.
+00010130: 2020 2020 2022 6f66 6673 6574 7322 3a20       "offsets": 
+00010140: 5b73 656c 662e 6474 7970 652e 6669 656c  [self.dtype.fiel
+00010150: 6473 5b6e 616d 655d 5b31 5d20 666f 7220  ds[name][1] for 
+00010160: 6e61 6d65 2069 6e20 696e 6465 785d 2c0a  name in index],.
+00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010180: 2020 2020 2020 2020 2269 7465 6d73 697a          "itemsiz
+00010190: 6522 3a20 7365 6c66 2e64 7479 7065 2e69  e": self.dtype.i
+000101a0: 7465 6d73 697a 652c 0a20 2020 2020 2020  temsize,.       
+000101b0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+000101c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000101d0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000101e0: 2064 742e 7368 6170 653a 0a20 2020 2020   dt.shape:.     
+000101f0: 2020 2020 2020 2020 2020 206e 6577 5f61             new_a
+00010200: 7869 7320 3d20 6c69 7374 2872 616e 6765  xis = list(range
+00010210: 2873 656c 662e 6e64 696d 2c20 7365 6c66  (self.ndim, self
+00010220: 2e6e 6469 6d20 2b20 6c65 6e28 6474 2e73  .ndim + len(dt.s
+00010230: 6861 7065 2929 290a 2020 2020 2020 2020  hape))).        
+00010240: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+00010250: 2073 656c 662e 6368 756e 6b73 202b 2074   self.chunks + t
+00010260: 7570 6c65 2828 692c 2920 666f 7220 6920  uple((i,) for i 
+00010270: 696e 2064 742e 7368 6170 6529 0a20 2020  in dt.shape).   
+00010280: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010290: 7572 6e20 7365 6c66 2e6d 6170 5f62 6c6f  urn self.map_blo
+000102a0: 636b 7328 0a20 2020 2020 2020 2020 2020  cks(.           
+000102b0: 2020 2020 2020 2020 2067 6574 6974 656d           getitem
+000102c0: 2c20 696e 6465 782c 2064 7479 7065 3d64  , index, dtype=d
+000102d0: 742e 6261 7365 2c20 6368 756e 6b73 3d63  t.base, chunks=c
+000102e0: 6875 6e6b 732c 206e 6577 5f61 7869 733d  hunks, new_axis=
+000102f0: 6e65 775f 6178 6973 0a20 2020 2020 2020  new_axis.       
+00010300: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00010310: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010320: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010330: 7572 6e20 7365 6c66 2e6d 6170 5f62 6c6f  urn self.map_blo
+00010340: 636b 7328 6765 7469 7465 6d2c 2069 6e64  cks(getitem, ind
+00010350: 6578 2c20 6474 7970 653d 6474 290a 0a20  ex, dtype=dt).. 
+00010360: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00010370: 696e 7374 616e 6365 2869 6e64 6578 2c20  instance(index, 
+00010380: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
+00010390: 2020 2020 696e 6465 7820 3d20 2869 6e64      index = (ind
+000103a0: 6578 2c29 0a0a 2020 2020 2020 2020 6672  ex,)..        fr
+000103b0: 6f6d 2064 6173 6b2e 6172 7261 792e 736c  om dask.array.sl
+000103c0: 6963 696e 6720 696d 706f 7274 2028 0a20  icing import (. 
+000103d0: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+000103e0: 6c69 7a65 5f69 6e64 6578 2c0a 2020 2020  lize_index,.    
+000103f0: 2020 2020 2020 2020 736c 6963 655f 7769          slice_wi
+00010400: 7468 5f62 6f6f 6c5f 6461 736b 5f61 7272  th_bool_dask_arr
+00010410: 6179 2c0a 2020 2020 2020 2020 2020 2020  ay,.            
+00010420: 736c 6963 655f 7769 7468 5f69 6e74 5f64  slice_with_int_d
+00010430: 6173 6b5f 6172 7261 792c 0a20 2020 2020  ask_array,.     
+00010440: 2020 2029 0a0a 2020 2020 2020 2020 696e     )..        in
+00010450: 6465 7832 203d 206e 6f72 6d61 6c69 7a65  dex2 = normalize
+00010460: 5f69 6e64 6578 2869 6e64 6578 2c20 7365  _index(index, se
+00010470: 6c66 2e73 6861 7065 290a 2020 2020 2020  lf.shape).      
+00010480: 2020 6465 7065 6e64 656e 6369 6573 203d    dependencies =
+00010490: 207b 7365 6c66 2e6e 616d 657d 0a20 2020   {self.name}.   
+000104a0: 2020 2020 2066 6f72 2069 2069 6e20 696e       for i in in
+000104b0: 6465 7832 3a0a 2020 2020 2020 2020 2020  dex2:.          
+000104c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000104d0: 692c 2041 7272 6179 293a 0a20 2020 2020  i, Array):.     
+000104e0: 2020 2020 2020 2020 2020 2064 6570 656e             depen
+000104f0: 6465 6e63 6965 732e 6164 6428 692e 6e61  dencies.add(i.na
+00010500: 6d65 290a 0a20 2020 2020 2020 2069 6620  me)..        if 
+00010510: 616e 7928 6973 696e 7374 616e 6365 2869  any(isinstance(i
+00010520: 2c20 4172 7261 7929 2061 6e64 2069 2e64  , Array) and i.d
+00010530: 7479 7065 2e6b 696e 6420 696e 2022 6975  type.kind in "iu
+00010540: 2220 666f 7220 6920 696e 2069 6e64 6578  " for i in index
+00010550: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
+00010560: 7365 6c66 2c20 696e 6465 7832 203d 2073  self, index2 = s
+00010570: 6c69 6365 5f77 6974 685f 696e 745f 6461  lice_with_int_da
+00010580: 736b 5f61 7272 6179 2873 656c 662c 2069  sk_array(self, i
+00010590: 6e64 6578 3229 0a20 2020 2020 2020 2069  ndex2).        i
+000105a0: 6620 616e 7928 6973 696e 7374 616e 6365  f any(isinstance
+000105b0: 2869 2c20 4172 7261 7929 2061 6e64 2069  (i, Array) and i
+000105c0: 2e64 7479 7065 203d 3d20 626f 6f6c 2066  .dtype == bool f
+000105d0: 6f72 2069 2069 6e20 696e 6465 7832 293a  or i in index2):
+000105e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000105f0: 662c 2069 6e64 6578 3220 3d20 736c 6963  f, index2 = slic
+00010600: 655f 7769 7468 5f62 6f6f 6c5f 6461 736b  e_with_bool_dask
+00010610: 5f61 7272 6179 2873 656c 662c 2069 6e64  _array(self, ind
+00010620: 6578 3229 0a0a 2020 2020 2020 2020 6966  ex2)..        if
+00010630: 2061 6c6c 2869 7369 6e73 7461 6e63 6528   all(isinstance(
+00010640: 692c 2073 6c69 6365 2920 616e 6420 6920  i, slice) and i 
+00010650: 3d3d 2073 6c69 6365 284e 6f6e 6529 2066  == slice(None) f
+00010660: 6f72 2069 2069 6e20 696e 6465 7832 293a  or i in index2):
+00010670: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010680: 7572 6e20 7365 6c66 0a0a 2020 2020 2020  urn self..      
+00010690: 2020 6f75 7420 3d20 2267 6574 6974 656d    out = "getitem
+000106a0: 2d22 202b 2074 6f6b 656e 697a 6528 7365  -" + tokenize(se
+000106b0: 6c66 2c20 696e 6465 7832 290a 2020 2020  lf, index2).    
+000106c0: 2020 2020 6473 6b2c 2063 6875 6e6b 7320      dsk, chunks 
+000106d0: 3d20 736c 6963 655f 6172 7261 7928 6f75  = slice_array(ou
+000106e0: 742c 2073 656c 662e 6e61 6d65 2c20 7365  t, self.name, se
+000106f0: 6c66 2e63 6875 6e6b 732c 2069 6e64 6578  lf.chunks, index
+00010700: 322c 2073 656c 662e 6974 656d 7369 7a65  2, self.itemsize
+00010710: 290a 0a20 2020 2020 2020 2067 7261 7068  )..        graph
+00010720: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+00010730: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+00010740: 6e73 286f 7574 2c20 6473 6b2c 2064 6570  ns(out, dsk, dep
+00010750: 656e 6465 6e63 6965 733d 5b73 656c 665d  endencies=[self]
+00010760: 290a 0a20 2020 2020 2020 206d 6574 6120  )..        meta 
+00010770: 3d20 6d65 7461 5f66 726f 6d5f 6172 7261  = meta_from_arra
+00010780: 7928 7365 6c66 2e5f 6d65 7461 2c20 6e64  y(self._meta, nd
+00010790: 696d 3d6c 656e 2863 6875 6e6b 7329 290a  im=len(chunks)).
+000107a0: 2020 2020 2020 2020 6966 206e 702e 6973          if np.is
+000107b0: 7363 616c 6172 286d 6574 6129 3a0a 2020  scalar(meta):.  
+000107c0: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
+000107d0: 206e 702e 6172 7261 7928 6d65 7461 290a   np.array(meta).
+000107e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000107f0: 4172 7261 7928 6772 6170 682c 206f 7574  Array(graph, out
+00010800: 2c20 6368 756e 6b73 2c20 6d65 7461 3d6d  , chunks, meta=m
+00010810: 6574 6129 0a0a 2020 2020 6465 6620 5f76  eta)..    def _v
+00010820: 696e 6465 7828 7365 6c66 2c20 6b65 7929  index(self, key)
+00010830: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
+00010840: 2069 7369 6e73 7461 6e63 6528 6b65 792c   isinstance(key,
+00010850: 2074 7570 6c65 293a 0a20 2020 2020 2020   tuple):.       
+00010860: 2020 2020 206b 6579 203d 2028 6b65 792c       key = (key,
+00010870: 290a 2020 2020 2020 2020 6966 2061 6e79  ).        if any
+00010880: 286b 2069 7320 4e6f 6e65 2066 6f72 206b  (k is None for k
+00010890: 2069 6e20 6b65 7929 3a0a 2020 2020 2020   in key):.      
+000108a0: 2020 2020 2020 7261 6973 6520 496e 6465        raise Inde
+000108b0: 7845 7272 6f72 280a 2020 2020 2020 2020  xError(.        
+000108c0: 2020 2020 2020 2020 2276 696e 6465 7820          "vindex 
+000108d0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
+000108e0: 2069 6e64 6578 696e 6720 7769 7468 204e   indexing with N
+000108f0: 6f6e 6520 286e 702e 6e65 7761 7869 7329  one (np.newaxis)
+00010900: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
+00010910: 2020 2020 2267 6f74 207b 7d22 2e66 6f72      "got {}".for
+00010920: 6d61 7428 6b65 7929 0a20 2020 2020 2020  mat(key).       
+00010930: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00010940: 6620 616c 6c28 6973 696e 7374 616e 6365  f all(isinstance
+00010950: 286b 2c20 736c 6963 6529 2066 6f72 206b  (k, slice) for k
+00010960: 2069 6e20 6b65 7929 3a0a 2020 2020 2020   in key):.      
+00010970: 2020 2020 2020 6966 2061 6c6c 280a 2020        if all(.  
+00010980: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00010990: 696e 6469 6365 7328 6429 203d 3d20 736c  indices(d) == sl
+000109a0: 6963 6528 302c 2064 292e 696e 6469 6365  ice(0, d).indice
+000109b0: 7328 6429 2066 6f72 206b 2c20 6420 696e  s(d) for k, d in
+000109c0: 207a 6970 286b 6579 2c20 7365 6c66 2e73   zip(key, self.s
+000109d0: 6861 7065 290a 2020 2020 2020 2020 2020  hape).          
+000109e0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+000109f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00010a00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010a10: 7365 2049 6e64 6578 4572 726f 7228 0a20  se IndexError(. 
+00010a20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010a30: 7669 6e64 6578 2072 6571 7569 7265 7320  vindex requires 
+00010a40: 6174 206c 6561 7374 206f 6e65 206e 6f6e  at least one non
+00010a50: 2d73 6c69 6365 2074 6f20 7665 6374 6f72  -slice to vector
+00010a60: 697a 6520 6f76 6572 2022 0a20 2020 2020  ize over ".     
+00010a70: 2020 2020 2020 2020 2020 2022 7768 656e             "when
+00010a80: 2074 6865 2073 6c69 6365 7320 6172 6520   the slices are 
+00010a90: 6e6f 7420 6f76 6572 2074 6865 2065 6e74  not over the ent
+00010aa0: 6972 6520 6172 7261 7920 2869 2e65 2c20  ire array (i.e, 
+00010ab0: 785b 3a5d 292e 2022 0a20 2020 2020 2020  x[:]). ".       
+00010ac0: 2020 2020 2020 2020 2022 5573 6520 6e6f           "Use no
+00010ad0: 726d 616c 2073 6c69 6369 6e67 2069 6e73  rmal slicing ins
+00010ae0: 7465 6164 2077 6865 6e20 6f6e 6c79 2075  tead when only u
+00010af0: 7369 6e67 2073 6c69 6365 732e 2047 6f74  sing slices. Got
+00010b00: 3a20 7b7d 222e 666f 726d 6174 286b 6579  : {}".format(key
+00010b10: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00010b20: 2020 2020 2020 2020 656c 6966 2061 6e79          elif any
+00010b30: 2869 735f 6461 736b 5f63 6f6c 6c65 6374  (is_dask_collect
+00010b40: 696f 6e28 6b29 2066 6f72 206b 2069 6e20  ion(k) for k in 
+00010b50: 6b65 7929 3a0a 2020 2020 2020 2020 2020  key):.          
+00010b60: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
+00010b70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00010b80: 2020 2020 2276 696e 6465 7820 646f 6573      "vindex does
+00010b90: 206e 6f74 2073 7570 706f 7274 2069 6e64   not support ind
+00010ba0: 6578 696e 6720 7769 7468 2064 6173 6b20  exing with dask 
+00010bb0: 6f62 6a65 6374 732e 2043 616c 6c20 636f  objects. Call co
+00010bc0: 6d70 7574 6520 220a 2020 2020 2020 2020  mpute ".        
+00010bd0: 2020 2020 2020 2020 226f 6e20 7468 6520          "on the 
+00010be0: 696e 6465 7865 7220 6669 7273 7420 746f  indexer first to
+00010bf0: 2067 6574 2061 6e20 6576 616c 7572 6174   get an evalurat
+00010c00: 6564 2061 7272 6179 2e20 476f 743a 207b  ed array. Got: {
+00010c10: 7d22 2e66 6f72 6d61 7428 6b65 7929 0a20  }".format(key). 
+00010c20: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00010c30: 2020 2020 2072 6574 7572 6e20 5f76 696e       return _vin
+00010c40: 6465 7828 7365 6c66 2c20 2a6b 6579 290a  dex(self, *key).
+00010c50: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00010c60: 2020 2064 6566 2076 696e 6465 7828 7365     def vindex(se
+00010c70: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00010c80: 5665 6374 6f72 697a 6564 2069 6e64 6578  Vectorized index
+00010c90: 696e 6720 7769 7468 2062 726f 6164 6361  ing with broadca
+00010ca0: 7374 696e 672e 0a0a 2020 2020 2020 2020  sting...        
+00010cb0: 5468 6973 2069 7320 6571 7569 7661 6c65  This is equivale
+00010cc0: 6e74 2074 6f20 6e75 6d70 7927 7320 6164  nt to numpy's ad
+00010cd0: 7661 6e63 6564 2069 6e64 6578 696e 672c  vanced indexing,
+00010ce0: 2075 7369 6e67 2061 7272 6179 7320 7468   using arrays th
+00010cf0: 6174 2061 7265 0a20 2020 2020 2020 2062  at are.        b
+00010d00: 726f 6164 6361 7374 2061 6761 696e 7374  roadcast against
+00010d10: 2065 6163 6820 6f74 6865 722e 2054 6869   each other. Thi
+00010d20: 7320 616c 6c6f 7773 2066 6f72 2070 6f69  s allows for poi
+00010d30: 6e74 7769 7365 2069 6e64 6578 696e 673a  ntwise indexing:
+00010d40: 0a0a 2020 2020 2020 2020 3e3e 3e20 696d  ..        >>> im
+00010d50: 706f 7274 2064 6173 6b2e 6172 7261 7920  port dask.array 
+00010d60: 6173 2064 610a 2020 2020 2020 2020 3e3e  as da.        >>
+00010d70: 3e20 7820 3d20 6e70 2e61 7272 6179 285b  > x = np.array([
+00010d80: 5b31 2c20 322c 2033 5d2c 205b 342c 2035  [1, 2, 3], [4, 5
+00010d90: 2c20 365d 2c20 5b37 2c20 382c 2039 5d5d  , 6], [7, 8, 9]]
+00010da0: 290a 2020 2020 2020 2020 3e3e 3e20 7820  ).        >>> x 
+00010db0: 3d20 6461 2e66 726f 6d5f 6172 7261 7928  = da.from_array(
+00010dc0: 782c 2063 6875 6e6b 733d 3229 0a20 2020  x, chunks=2).   
+00010dd0: 2020 2020 203e 3e3e 2078 2e76 696e 6465       >>> x.vinde
+00010de0: 785b 5b30 2c20 312c 2032 5d2c 205b 302c  x[[0, 1, 2], [0,
+00010df0: 2031 2c20 325d 5d2e 636f 6d70 7574 6528   1, 2]].compute(
+00010e00: 290a 2020 2020 2020 2020 6172 7261 7928  ).        array(
+00010e10: 5b31 2c20 352c 2039 5d29 0a0a 2020 2020  [1, 5, 9])..    
+00010e20: 2020 2020 4d69 7865 6420 6261 7369 632f      Mixed basic/
+00010e30: 6164 7661 6e63 6564 2069 6e64 6578 696e  advanced indexin
+00010e40: 6720 7769 7468 2073 6c69 6365 732f 6172  g with slices/ar
+00010e50: 7261 7973 2069 7320 616c 736f 2073 7570  rays is also sup
+00010e60: 706f 7274 6564 2e20 5468 650a 2020 2020  ported. The.    
+00010e70: 2020 2020 6f72 6465 7220 6f66 2064 696d      order of dim
+00010e80: 656e 7369 6f6e 7320 696e 2074 6865 2072  ensions in the r
+00010e90: 6573 756c 7420 666f 6c6c 6f77 7320 7468  esult follows th
+00010ea0: 6f73 6520 7072 6f70 6f73 6564 2066 6f72  ose proposed for
+00010eb0: 0a20 2020 2020 2020 2060 6e64 6172 7261  .        `ndarra
+00010ec0: 792e 7669 6e64 6578 203c 6874 7470 733a  y.vindex <https:
+00010ed0: 2f2f 6769 7468 7562 2e63 6f6d 2f6e 756d  //github.com/num
+00010ee0: 7079 2f6e 756d 7079 2f70 756c 6c2f 3632  py/numpy/pull/62
+00010ef0: 3536 3e60 5f3a 0a20 2020 2020 2020 2074  56>`_:.        t
+00010f00: 6865 2073 7562 7370 6163 6520 7370 616e  he subspace span
+00010f10: 6e65 6420 6279 2061 7272 6179 7320 6973  ned by arrays is
+00010f20: 2066 6f6c 6c6f 7765 6420 6279 2061 6c6c   followed by all
+00010f30: 2073 6c69 6365 732e 0a0a 2020 2020 2020   slices...      
+00010f40: 2020 4e6f 7465 3a20 6060 7669 6e64 6578    Note: ``vindex
+00010f50: 6060 2070 726f 7669 6465 7320 6d6f 7265  `` provides more
+00010f60: 2067 656e 6572 616c 2066 756e 6374 696f   general functio
+00010f70: 6e61 6c69 7479 2074 6861 6e20 7374 616e  nality than stan
+00010f80: 6461 7264 0a20 2020 2020 2020 2069 6e64  dard.        ind
+00010f90: 6578 696e 672c 2062 7574 2069 7420 616c  exing, but it al
+00010fa0: 736f 2068 6173 2066 6577 6572 206f 7074  so has fewer opt
+00010fb0: 696d 697a 6174 696f 6e73 2061 6e64 2063  imizations and c
+00010fc0: 616e 2062 6520 7369 676e 6966 6963 616e  an be significan
+00010fd0: 746c 790a 2020 2020 2020 2020 736c 6f77  tly.        slow
+00010fe0: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
+00010ff0: 2020 2020 2020 2020 7265 7475 726e 2049          return I
+00011000: 6e64 6578 4361 6c6c 6162 6c65 2873 656c  ndexCallable(sel
+00011010: 662e 5f76 696e 6465 7829 0a0a 2020 2020  f._vindex)..    
+00011020: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00011030: 6620 626c 6f63 6b73 2873 656c 6629 3a0a  f blocks(self):.
+00011040: 2020 2020 2020 2020 2222 2241 6e20 6172          """An ar
+00011050: 7261 792d 6c69 6b65 2069 6e74 6572 6661  ray-like interfa
+00011060: 6365 2074 6f20 7468 6520 626c 6f63 6b73  ce to the blocks
+00011070: 206f 6620 616e 2061 7272 6179 2e0a 0a20   of an array... 
+00011080: 2020 2020 2020 2054 6869 7320 7265 7475         This retu
+00011090: 726e 7320 6120 6060 426c 6f63 6b76 6965  rns a ``Blockvie
+000110a0: 7760 6020 6f62 6a65 6374 2074 6861 7420  w`` object that 
+000110b0: 7072 6f76 6964 6573 2061 6e20 6172 7261  provides an arra
+000110c0: 792d 6c69 6b65 2069 6e74 6572 6661 6365  y-like interface
+000110d0: 0a20 2020 2020 2020 2074 6f20 7468 6520  .        to the 
+000110e0: 626c 6f63 6b73 206f 6620 6120 6461 736b  blocks of a dask
+000110f0: 2061 7272 6179 2e20 204e 756d 7079 2d73   array.  Numpy-s
+00011100: 7479 6c65 2069 6e64 6578 696e 6720 6f66  tyle indexing of
+00011110: 2061 2060 6042 6c6f 636b 7669 6577 6060   a ``Blockview``
+00011120: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+00011130: 7265 7475 726e 7320 6120 7365 6c65 6374  returns a select
+00011140: 696f 6e20 6f66 2062 6c6f 636b 7320 6173  ion of blocks as
+00011150: 2061 206e 6577 2064 6173 6b20 6172 7261   a new dask arra
+00011160: 792e 0a0a 2020 2020 2020 2020 596f 7520  y...        You 
+00011170: 6361 6e20 696e 6465 7820 6060 6172 7261  can index ``arra
+00011180: 792e 626c 6f63 6b73 6060 206c 696b 6520  y.blocks`` like 
+00011190: 6120 6e75 6d70 7920 6172 7261 7920 6f66  a numpy array of
+000111a0: 2073 6861 7065 0a20 2020 2020 2020 2065   shape.        e
+000111b0: 7175 616c 2074 6f20 7468 6520 6e75 6d62  qual to the numb
+000111c0: 6572 206f 6620 626c 6f63 6b73 2069 6e20  er of blocks in 
+000111d0: 6561 6368 2064 696d 656e 7369 6f6e 2c20  each dimension, 
+000111e0: 2861 7661 696c 6162 6c65 2061 730a 2020  (available as.  
+000111f0: 2020 2020 2020 6172 7261 792e 626c 6f63        array.bloc
+00011200: 6b73 2e73 697a 6529 2e20 2054 6865 2064  ks.size).  The d
+00011210: 696d 656e 7369 6f6e 616c 6974 7920 6f66  imensionality of
+00011220: 2074 6865 206f 7574 7075 7420 6172 7261   the output arra
+00011230: 7920 6d61 7463 6865 730a 2020 2020 2020  y matches.      
+00011240: 2020 7468 6520 6469 6d65 6e73 696f 6e20    the dimension 
+00011250: 6f66 2074 6869 7320 6172 7261 792c 2065  of this array, e
+00011260: 7665 6e20 6966 2069 6e74 6567 6572 2069  ven if integer i
+00011270: 6e64 6963 6573 2061 7265 2070 6173 7365  ndices are passe
+00011280: 642e 0a20 2020 2020 2020 2053 6c69 6369  d..        Slici
+00011290: 6e67 2077 6974 6820 6060 6e70 2e6e 6577  ng with ``np.new
+000112a0: 6178 6973 6060 206f 7220 6d75 6c74 6970  axis`` or multip
+000112b0: 6c65 206c 6973 7473 2069 7320 6e6f 7420  le lists is not 
+000112c0: 7375 7070 6f72 7465 642e 0a0a 2020 2020  supported...    
+000112d0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+000112e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
+000112f0: 2020 2020 2020 3e3e 3e20 696d 706f 7274        >>> import
+00011300: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
+00011310: 610a 2020 2020 2020 2020 3e3e 3e20 7820  a.        >>> x 
+00011320: 3d20 6461 2e61 7261 6e67 6528 382c 2063  = da.arange(8, c
+00011330: 6875 6e6b 733d 3229 0a20 2020 2020 2020  hunks=2).       
+00011340: 203e 3e3e 2078 2e62 6c6f 636b 732e 7368   >>> x.blocks.sh
+00011350: 6170 6520 2320 616c 6961 7365 7320 782e  ape # aliases x.
+00011360: 6e75 6d62 6c6f 636b 730a 2020 2020 2020  numblocks.      
+00011370: 2020 2834 2c29 0a20 2020 2020 2020 203e    (4,).        >
+00011380: 3e3e 2078 2e62 6c6f 636b 735b 305d 2e63  >> x.blocks[0].c
+00011390: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
+000113a0: 2061 7272 6179 285b 302c 2031 5d29 0a20   array([0, 1]). 
+000113b0: 2020 2020 2020 203e 3e3e 2078 2e62 6c6f         >>> x.blo
+000113c0: 636b 735b 3a33 5d2e 636f 6d70 7574 6528  cks[:3].compute(
+000113d0: 290a 2020 2020 2020 2020 6172 7261 7928  ).        array(
+000113e0: 5b30 2c20 312c 2032 2c20 332c 2034 2c20  [0, 1, 2, 3, 4, 
+000113f0: 355d 290a 2020 2020 2020 2020 3e3e 3e20  5]).        >>> 
+00011400: 782e 626c 6f63 6b73 5b3a 3a32 5d2e 636f  x.blocks[::2].co
+00011410: 6d70 7574 6528 290a 2020 2020 2020 2020  mpute().        
+00011420: 6172 7261 7928 5b30 2c20 312c 2034 2c20  array([0, 1, 4, 
+00011430: 355d 290a 2020 2020 2020 2020 3e3e 3e20  5]).        >>> 
+00011440: 782e 626c 6f63 6b73 5b5b 2d31 2c20 305d  x.blocks[[-1, 0]
+00011450: 5d2e 636f 6d70 7574 6528 290a 2020 2020  ].compute().    
+00011460: 2020 2020 6172 7261 7928 5b36 2c20 372c      array([6, 7,
+00011470: 2030 2c20 315d 290a 2020 2020 2020 2020   0, 1]).        
+00011480: 3e3e 3e20 782e 626c 6f63 6b73 2e72 6176  >>> x.blocks.rav
+00011490: 656c 2829 2023 2064 6f63 7465 7374 3a20  el() # doctest: 
+000114a0: 2b4e 4f52 4d41 4c49 5a45 5f57 4849 5445  +NORMALIZE_WHITE
+000114b0: 5350 4143 450a 2020 2020 2020 2020 5b64  SPACE.        [d
+000114c0: 6173 6b2e 6172 7261 793c 626c 6f63 6b73  ask.array<blocks
+000114d0: 2c20 7368 6170 653d 2832 2c29 2c20 6474  , shape=(2,), dt
+000114e0: 7970 653d 696e 7436 342c 2063 6875 6e6b  ype=int64, chunk
+000114f0: 7369 7a65 3d28 322c 292c 2063 6875 6e6b  size=(2,), chunk
+00011500: 7479 7065 3d6e 756d 7079 2e6e 6461 7272  type=numpy.ndarr
+00011510: 6179 3e2c 0a20 2020 2020 2020 2020 6461  ay>,.         da
+00011520: 736b 2e61 7272 6179 3c62 6c6f 636b 732c  sk.array<blocks,
+00011530: 2073 6861 7065 3d28 322c 292c 2064 7479   shape=(2,), dty
+00011540: 7065 3d69 6e74 3634 2c20 6368 756e 6b73  pe=int64, chunks
+00011550: 697a 653d 2832 2c29 2c20 6368 756e 6b74  ize=(2,), chunkt
+00011560: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
+00011570: 793e 2c0a 2020 2020 2020 2020 2064 6173  y>,.         das
+00011580: 6b2e 6172 7261 793c 626c 6f63 6b73 2c20  k.array<blocks, 
+00011590: 7368 6170 653d 2832 2c29 2c20 6474 7970  shape=(2,), dtyp
+000115a0: 653d 696e 7436 342c 2063 6875 6e6b 7369  e=int64, chunksi
+000115b0: 7a65 3d28 322c 292c 2063 6875 6e6b 7479  ze=(2,), chunkty
+000115c0: 7065 3d6e 756d 7079 2e6e 6461 7272 6179  pe=numpy.ndarray
+000115d0: 3e2c 0a20 2020 2020 2020 2020 6461 736b  >,.         dask
+000115e0: 2e61 7272 6179 3c62 6c6f 636b 732c 2073  .array<blocks, s
+000115f0: 6861 7065 3d28 322c 292c 2064 7479 7065  hape=(2,), dtype
+00011600: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
+00011610: 653d 2832 2c29 2c20 6368 756e 6b74 7970  e=(2,), chunktyp
+00011620: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+00011630: 5d0a 0a20 2020 2020 2020 2052 6574 7572  ]..        Retur
+00011640: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00011650: 2d2d 0a20 2020 2020 2020 2041 6e20 696e  --.        An in
+00011660: 7374 616e 6365 206f 6620 6060 6461 736b  stance of ``dask
+00011670: 2e61 7272 6179 2e42 6c6f 636b 7669 6577  .array.Blockview
+00011680: 6060 0a20 2020 2020 2020 2022 2222 0a20  ``.        """. 
+00011690: 2020 2020 2020 2072 6574 7572 6e20 426c         return Bl
+000116a0: 6f63 6b56 6965 7728 7365 6c66 290a 0a20  ockView(self).. 
+000116b0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000116c0: 2064 6566 2070 6172 7469 7469 6f6e 7328   def partitions(
+000116d0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000116e0: 2222 536c 6963 6520 616e 2061 7272 6179  ""Slice an array
+000116f0: 2062 7920 7061 7274 6974 696f 6e73 2e20   by partitions. 
+00011700: 416c 6961 7320 6f66 2064 6173 6b20 6172  Alias of dask ar
+00011710: 7261 7920 2e62 6c6f 636b 7320 6174 7472  ray .blocks attr
+00011720: 6962 7574 652e 0a0a 2020 2020 2020 2020  ibute...        
+00011730: 5468 6973 2061 6c69 6173 2061 6c6c 6f77  This alias allow
+00011740: 7320 796f 7520 746f 2077 7269 7465 2061  s you to write a
+00011750: 676e 6f73 7469 6320 636f 6465 2074 6861  gnostic code tha
+00011760: 7420 776f 726b 7320 7769 7468 2062 6f74  t works with bot
+00011770: 680a 2020 2020 2020 2020 6461 736b 2061  h.        dask a
+00011780: 7272 6179 7320 616e 6420 6461 736b 2064  rrays and dask d
+00011790: 6174 6166 7261 6d65 732e 0a0a 2020 2020  ataframes...    
+000117a0: 2020 2020 5468 6973 2072 6574 7572 6e73      This returns
+000117b0: 2061 2060 6042 6c6f 636b 7669 6577 6060   a ``Blockview``
+000117c0: 206f 626a 6563 7420 7468 6174 2070 726f   object that pro
+000117d0: 7669 6465 7320 616e 2061 7272 6179 2d6c  vides an array-l
+000117e0: 696b 6520 696e 7465 7266 6163 650a 2020  ike interface.  
+000117f0: 2020 2020 2020 746f 2074 6865 2062 6c6f        to the blo
+00011800: 636b 7320 6f66 2061 2064 6173 6b20 6172  cks of a dask ar
+00011810: 7261 792e 2020 4e75 6d70 792d 7374 796c  ray.  Numpy-styl
+00011820: 6520 696e 6465 7869 6e67 206f 6620 6120  e indexing of a 
+00011830: 6060 426c 6f63 6b76 6965 7760 6020 6f62  ``Blockview`` ob
+00011840: 6a65 6374 0a20 2020 2020 2020 2072 6574  ject.        ret
+00011850: 7572 6e73 2061 2073 656c 6563 7469 6f6e  urns a selection
+00011860: 206f 6620 626c 6f63 6b73 2061 7320 6120   of blocks as a 
+00011870: 6e65 7720 6461 736b 2061 7272 6179 2e0a  new dask array..
+00011880: 0a20 2020 2020 2020 2059 6f75 2063 616e  .        You can
+00011890: 2069 6e64 6578 2060 6061 7272 6179 2e62   index ``array.b
+000118a0: 6c6f 636b 7360 6020 6c69 6b65 2061 206e  locks`` like a n
+000118b0: 756d 7079 2061 7272 6179 206f 6620 7368  umpy array of sh
+000118c0: 6170 650a 2020 2020 2020 2020 6571 7561  ape.        equa
+000118d0: 6c20 746f 2074 6865 206e 756d 6265 7220  l to the number 
+000118e0: 6f66 2062 6c6f 636b 7320 696e 2065 6163  of blocks in eac
+000118f0: 6820 6469 6d65 6e73 696f 6e2c 2028 6176  h dimension, (av
+00011900: 6169 6c61 626c 6520 6173 0a20 2020 2020  ailable as.     
+00011910: 2020 2061 7272 6179 2e62 6c6f 636b 732e     array.blocks.
+00011920: 7369 7a65 292e 2020 5468 6520 6469 6d65  size).  The dime
+00011930: 6e73 696f 6e61 6c69 7479 206f 6620 7468  nsionality of th
+00011940: 6520 6f75 7470 7574 2061 7272 6179 206d  e output array m
+00011950: 6174 6368 6573 0a20 2020 2020 2020 2074  atches.        t
+00011960: 6865 2064 696d 656e 7369 6f6e 206f 6620  he dimension of 
+00011970: 7468 6973 2061 7272 6179 2c20 6576 656e  this array, even
+00011980: 2069 6620 696e 7465 6765 7220 696e 6469   if integer indi
+00011990: 6365 7320 6172 6520 7061 7373 6564 2e0a  ces are passed..
+000119a0: 2020 2020 2020 2020 536c 6963 696e 6720          Slicing 
+000119b0: 7769 7468 2060 606e 702e 6e65 7761 7869  with ``np.newaxi
+000119c0: 7360 6020 6f72 206d 756c 7469 706c 6520  s`` or multiple 
+000119d0: 6c69 7374 7320 6973 206e 6f74 2073 7570  lists is not sup
+000119e0: 706f 7274 6564 2e0a 0a20 2020 2020 2020  ported...       
+000119f0: 2045 7861 6d70 6c65 730a 2020 2020 2020   Examples.      
+00011a00: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00011a10: 2020 203e 3e3e 2069 6d70 6f72 7420 6461     >>> import da
+00011a20: 736b 2e61 7272 6179 2061 7320 6461 0a20  sk.array as da. 
+00011a30: 2020 2020 2020 203e 3e3e 2078 203d 2064         >>> x = d
+00011a40: 612e 6172 616e 6765 2838 2c20 6368 756e  a.arange(8, chun
+00011a50: 6b73 3d32 290a 2020 2020 2020 2020 3e3e  ks=2).        >>
+00011a60: 3e20 782e 7061 7274 6974 696f 6e73 2e73  > x.partitions.s
+00011a70: 6861 7065 2023 2061 6c69 6173 6573 2078  hape # aliases x
+00011a80: 2e6e 756d 626c 6f63 6b73 0a20 2020 2020  .numblocks.     
+00011a90: 2020 2028 342c 290a 2020 2020 2020 2020     (4,).        
+00011aa0: 3e3e 3e20 782e 7061 7274 6974 696f 6e73  >>> x.partitions
+00011ab0: 5b30 5d2e 636f 6d70 7574 6528 290a 2020  [0].compute().  
+00011ac0: 2020 2020 2020 6172 7261 7928 5b30 2c20        array([0, 
+00011ad0: 315d 290a 2020 2020 2020 2020 3e3e 3e20  1]).        >>> 
+00011ae0: 782e 7061 7274 6974 696f 6e73 5b3a 335d  x.partitions[:3]
+00011af0: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
+00011b00: 2020 2061 7272 6179 285b 302c 2031 2c20     array([0, 1, 
+00011b10: 322c 2033 2c20 342c 2035 5d29 0a20 2020  2, 3, 4, 5]).   
+00011b20: 2020 2020 203e 3e3e 2078 2e70 6172 7469       >>> x.parti
+00011b30: 7469 6f6e 735b 3a3a 325d 2e63 6f6d 7075  tions[::2].compu
+00011b40: 7465 2829 0a20 2020 2020 2020 2061 7272  te().        arr
+00011b50: 6179 285b 302c 2031 2c20 342c 2035 5d29  ay([0, 1, 4, 5])
+00011b60: 0a20 2020 2020 2020 203e 3e3e 2078 2e70  .        >>> x.p
+00011b70: 6172 7469 7469 6f6e 735b 5b2d 312c 2030  artitions[[-1, 0
+00011b80: 5d5d 2e63 6f6d 7075 7465 2829 0a20 2020  ]].compute().   
+00011b90: 2020 2020 2061 7272 6179 285b 362c 2037       array([6, 7
+00011ba0: 2c20 302c 2031 5d29 0a20 2020 2020 2020  , 0, 1]).       
+00011bb0: 203e 3e3e 2078 2e70 6172 7469 7469 6f6e   >>> x.partition
+00011bc0: 732e 7261 7665 6c28 2920 2320 646f 6374  s.ravel() # doct
+00011bd0: 6573 743a 202b 4e4f 524d 414c 495a 455f  est: +NORMALIZE_
+00011be0: 5748 4954 4553 5041 4345 0a20 2020 2020  WHITESPACE.     
+00011bf0: 2020 205b 6461 736b 2e61 7272 6179 3c62     [dask.array<b
+00011c00: 6c6f 636b 732c 2073 6861 7065 3d28 322c  locks, shape=(2,
+00011c10: 292c 2064 7479 7065 3d69 6e74 3634 2c20  ), dtype=int64, 
+00011c20: 6368 756e 6b73 697a 653d 2832 2c29 2c20  chunksize=(2,), 
+00011c30: 6368 756e 6b74 7970 653d 6e75 6d70 792e  chunktype=numpy.
+00011c40: 6e64 6172 7261 793e 2c0a 2020 2020 2020  ndarray>,.      
+00011c50: 2020 2064 6173 6b2e 6172 7261 793c 626c     dask.array<bl
+00011c60: 6f63 6b73 2c20 7368 6170 653d 2832 2c29  ocks, shape=(2,)
+00011c70: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
+00011c80: 6875 6e6b 7369 7a65 3d28 322c 292c 2063  hunksize=(2,), c
+00011c90: 6875 6e6b 7479 7065 3d6e 756d 7079 2e6e  hunktype=numpy.n
+00011ca0: 6461 7272 6179 3e2c 0a20 2020 2020 2020  darray>,.       
+00011cb0: 2020 6461 736b 2e61 7272 6179 3c62 6c6f    dask.array<blo
+00011cc0: 636b 732c 2073 6861 7065 3d28 322c 292c  cks, shape=(2,),
+00011cd0: 2064 7479 7065 3d69 6e74 3634 2c20 6368   dtype=int64, ch
+00011ce0: 756e 6b73 697a 653d 2832 2c29 2c20 6368  unksize=(2,), ch
+00011cf0: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
+00011d00: 6172 7261 793e 2c0a 2020 2020 2020 2020  array>,.        
+00011d10: 2064 6173 6b2e 6172 7261 793c 626c 6f63   dask.array<bloc
+00011d20: 6b73 2c20 7368 6170 653d 2832 2c29 2c20  ks, shape=(2,), 
+00011d30: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
+00011d40: 6e6b 7369 7a65 3d28 322c 292c 2063 6875  nksize=(2,), chu
+00011d50: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
+00011d60: 7272 6179 3e5d 0a0a 2020 2020 2020 2020  rray>]..        
+00011d70: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00011d80: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00011d90: 416e 2069 6e73 7461 6e63 6520 6f66 2060  An instance of `
+00011da0: 6064 612e 6172 7261 792e 426c 6f63 6b76  `da.array.Blockv
+00011db0: 6965 7760 600a 2020 2020 2020 2020 2222  iew``.        ""
+00011dc0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00011dd0: 2073 656c 662e 626c 6f63 6b73 0a0a 2020   self.blocks..  
+00011de0: 2020 6465 6620 646f 7428 7365 6c66 2c20    def dot(self, 
+00011df0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+00011e00: 2222 2244 6f74 2070 726f 6475 6374 206f  """Dot product o
+00011e10: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
+00011e20: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
+00011e30: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
+00011e40: 6172 7261 792e 7465 6e73 6f72 646f 7460  array.tensordot`
+00011e50: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00011e60: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00011e70: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00011e80: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00011e90: 2020 2020 6461 736b 2e61 7272 6179 2e64      dask.array.d
+00011ea0: 6f74 203a 2065 7175 6976 616c 656e 7420  ot : equivalent 
+00011eb0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
+00011ec0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00011ed0: 6d20 6461 736b 2e61 7272 6179 2e72 6f75  m dask.array.rou
+00011ee0: 7469 6e65 7320 696d 706f 7274 2074 656e  tines import ten
+00011ef0: 736f 7264 6f74 0a0a 2020 2020 2020 2020  sordot..        
+00011f00: 7265 7475 726e 2074 656e 736f 7264 6f74  return tensordot
+00011f10: 2873 656c 662c 206f 7468 6572 2c20 6178  (self, other, ax
+00011f20: 6573 3d28 2873 656c 662e 6e64 696d 202d  es=((self.ndim -
+00011f30: 2031 2c29 2c20 286f 7468 6572 2e6e 6469   1,), (other.ndi
+00011f40: 6d20 2d20 322c 2929 290a 0a20 2020 2040  m - 2,)))..    @
+00011f50: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00011f60: 2041 2873 656c 6629 3a0a 2020 2020 2020   A(self):.      
+00011f70: 2020 7265 7475 726e 2073 656c 660a 0a20    return self.. 
+00011f80: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00011f90: 2064 6566 2054 2873 656c 6629 3a0a 2020   def T(self):.  
+00011fa0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00011fb0: 662e 7472 616e 7370 6f73 6528 290a 0a20  f.transpose().. 
+00011fc0: 2020 2064 6566 2074 7261 6e73 706f 7365     def transpose
+00011fd0: 2873 656c 662c 202a 6178 6573 293a 0a20  (self, *axes):. 
+00011fe0: 2020 2020 2020 2022 2222 5265 7665 7273         """Revers
+00011ff0: 6520 6f72 2070 6572 6d75 7465 2074 6865  e or permute the
+00012000: 2061 7865 7320 6f66 2061 6e20 6172 7261   axes of an arra
+00012010: 792e 2052 6574 7572 6e20 7468 6520 6d6f  y. Return the mo
+00012020: 6469 6669 6564 2061 7272 6179 2e0a 0a20  dified array... 
+00012030: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
+00012040: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
+00012050: 792e 7472 616e 7370 6f73 6560 2066 6f72  y.transpose` for
+00012060: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
+00012070: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
+00012080: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+00012090: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000120a0: 6461 736b 2e61 7272 6179 2e74 7261 6e73  dask.array.trans
+000120b0: 706f 7365 203a 2065 7175 6976 616c 656e  pose : equivalen
+000120c0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
+000120d0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000120e0: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
+000120f0: 6f75 7469 6e65 7320 696d 706f 7274 2074  outines import t
+00012100: 7261 6e73 706f 7365 0a0a 2020 2020 2020  ranspose..      
+00012110: 2020 6966 206e 6f74 2061 7865 733a 0a20    if not axes:. 
+00012120: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
+00012130: 3d20 4e6f 6e65 0a20 2020 2020 2020 2065  = None.        e
+00012140: 6c69 6620 6c65 6e28 6178 6573 2920 3d3d  lif len(axes) ==
+00012150: 2031 2061 6e64 2069 7369 6e73 7461 6e63   1 and isinstanc
+00012160: 6528 6178 6573 5b30 5d2c 2049 7465 7261  e(axes[0], Itera
+00012170: 626c 6529 3a0a 2020 2020 2020 2020 2020  ble):.          
+00012180: 2020 6178 6573 203d 2061 7865 735b 305d    axes = axes[0]
+00012190: 0a20 2020 2020 2020 2069 6620 2861 7865  .        if (axe
+000121a0: 7320 3d3d 2074 7570 6c65 2872 616e 6765  s == tuple(range
+000121b0: 2873 656c 662e 6e64 696d 2929 2920 6f72  (self.ndim))) or
+000121c0: 2028 6178 6573 203d 3d20 7475 706c 6528   (axes == tuple(
+000121d0: 7261 6e67 6528 2d73 656c 662e 6e64 696d  range(-self.ndim
+000121e0: 2c20 3029 2929 3a0a 2020 2020 2020 2020  , 0))):.        
+000121f0: 2020 2020 2320 6e6f 2074 7261 6e73 706f      # no transpo
+00012200: 7365 206e 6563 6573 7361 7279 0a20 2020  se necessary.   
+00012210: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012220: 7365 6c66 0a20 2020 2020 2020 2065 6c73  self.        els
+00012230: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00012240: 6574 7572 6e20 7472 616e 7370 6f73 6528  eturn transpose(
+00012250: 7365 6c66 2c20 6178 6573 3d61 7865 7329  self, axes=axes)
+00012260: 0a0a 2020 2020 6465 6620 7261 7665 6c28  ..    def ravel(
+00012270: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00012280: 2222 5265 7475 726e 2061 2066 6c61 7474  ""Return a flatt
+00012290: 656e 6564 2061 7272 6179 2e0a 0a20 2020  ened array...   
+000122a0: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
+000122b0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
+000122c0: 7261 7665 6c60 2066 6f72 2066 756c 6c20  ravel` for full 
+000122d0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+000122e0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+000122f0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00012300: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00012310: 7272 6179 2e72 6176 656c 203a 2065 7175  rray.ravel : equ
+00012320: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
+00012330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012340: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+00012350: 7272 6179 2e72 6f75 7469 6e65 7320 696d  rray.routines im
+00012360: 706f 7274 2072 6176 656c 0a0a 2020 2020  port ravel..    
+00012370: 2020 2020 7265 7475 726e 2072 6176 656c      return ravel
+00012380: 2873 656c 6629 0a0a 2020 2020 666c 6174  (self)..    flat
+00012390: 7465 6e20 3d20 7261 7665 6c0a 0a20 2020  ten = ravel..   
+000123a0: 2064 6566 2063 686f 6f73 6528 7365 6c66   def choose(self
+000123b0: 2c20 6368 6f69 6365 7329 3a0a 2020 2020  , choices):.    
+000123c0: 2020 2020 2222 2255 7365 2061 6e20 696e      """Use an in
+000123d0: 6465 7820 6172 7261 7920 746f 2063 6f6e  dex array to con
+000123e0: 7374 7275 6374 2061 206e 6577 2061 7272  struct a new arr
+000123f0: 6179 2066 726f 6d20 6120 7365 7420 6f66  ay from a set of
+00012400: 2063 686f 6963 6573 2e0a 0a20 2020 2020   choices...     
+00012410: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
+00012420: 633a 6064 6173 6b2e 6172 7261 792e 6368  c:`dask.array.ch
+00012430: 6f6f 7365 6020 666f 7220 6675 6c6c 2064  oose` for full d
+00012440: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
+00012450: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00012460: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00012470: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+00012480: 7261 792e 6368 6f6f 7365 203a 2065 7175  ray.choose : equ
+00012490: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
+000124a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000124b0: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+000124c0: 7272 6179 2e72 6f75 7469 6e65 7320 696d  rray.routines im
+000124d0: 706f 7274 2063 686f 6f73 650a 0a20 2020  port choose..   
+000124e0: 2020 2020 2072 6574 7572 6e20 6368 6f6f       return choo
+000124f0: 7365 2873 656c 662c 2063 686f 6963 6573  se(self, choices
+00012500: 290a 0a20 2020 2064 6566 2072 6573 6861  )..    def resha
+00012510: 7065 2873 656c 662c 202a 7368 6170 652c  pe(self, *shape,
+00012520: 206d 6572 6765 5f63 6875 6e6b 733d 5472   merge_chunks=Tr
+00012530: 7565 2c20 6c69 6d69 743d 4e6f 6e65 293a  ue, limit=None):
+00012540: 0a20 2020 2020 2020 2022 2222 5265 7368  .        """Resh
+00012550: 6170 6520 6172 7261 7920 746f 206e 6577  ape array to new
+00012560: 2073 6861 7065 0a0a 2020 2020 2020 2020   shape..        
+00012570: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
+00012580: 6461 736b 2e61 7272 6179 2e72 6573 6861  dask.array.resha
+00012590: 7065 6020 666f 7220 6675 6c6c 2064 6f63  pe` for full doc
+000125a0: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+000125b0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000125c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000125d0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+000125e0: 792e 7265 7368 6170 6520 3a20 6571 7569  y.reshape : equi
+000125f0: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00012600: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012610: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00012620: 7261 792e 7265 7368 6170 6520 696d 706f  ray.reshape impo
+00012630: 7274 2072 6573 6861 7065 0a0a 2020 2020  rt reshape..    
+00012640: 2020 2020 6966 206c 656e 2873 6861 7065      if len(shape
+00012650: 2920 3d3d 2031 2061 6e64 206e 6f74 2069  ) == 1 and not i
+00012660: 7369 6e73 7461 6e63 6528 7368 6170 655b  sinstance(shape[
+00012670: 305d 2c20 4e75 6d62 6572 293a 0a20 2020  0], Number):.   
+00012680: 2020 2020 2020 2020 2073 6861 7065 203d           shape =
+00012690: 2073 6861 7065 5b30 5d0a 2020 2020 2020   shape[0].      
+000126a0: 2020 7265 7475 726e 2072 6573 6861 7065    return reshape
+000126b0: 2873 656c 662c 2073 6861 7065 2c20 6d65  (self, shape, me
+000126c0: 7267 655f 6368 756e 6b73 3d6d 6572 6765  rge_chunks=merge
+000126d0: 5f63 6875 6e6b 732c 206c 696d 6974 3d6c  _chunks, limit=l
+000126e0: 696d 6974 290a 0a20 2020 2064 6566 2074  imit)..    def t
+000126f0: 6f70 6b28 7365 6c66 2c20 6b2c 2061 7869  opk(self, k, axi
+00012700: 733d 2d31 2c20 7370 6c69 745f 6576 6572  s=-1, split_ever
+00012710: 793d 4e6f 6e65 293a 0a20 2020 2020 2020  y=None):.       
+00012720: 2022 2222 5468 6520 746f 7020 6b20 656c   """The top k el
+00012730: 656d 656e 7473 206f 6620 616e 2061 7272  ements of an arr
+00012740: 6179 2e0a 0a20 2020 2020 2020 2052 6566  ay...        Ref
+00012750: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
+00012760: 6b2e 6172 7261 792e 746f 706b 6020 666f  k.array.topk` fo
+00012770: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00012780: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00012790: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+000127a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000127b0: 2064 6173 6b2e 6172 7261 792e 746f 706b   dask.array.topk
+000127c0: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
+000127d0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
+000127e0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+000127f0: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
+00012800: 7469 6f6e 7320 696d 706f 7274 2074 6f70  tions import top
+00012810: 6b0a 0a20 2020 2020 2020 2072 6574 7572  k..        retur
+00012820: 6e20 746f 706b 2873 656c 662c 206b 2c20  n topk(self, k, 
+00012830: 6178 6973 3d61 7869 732c 2073 706c 6974  axis=axis, split
+00012840: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
+00012850: 7279 290a 0a20 2020 2064 6566 2061 7267  ry)..    def arg
+00012860: 746f 706b 2873 656c 662c 206b 2c20 6178  topk(self, k, ax
+00012870: 6973 3d2d 312c 2073 706c 6974 5f65 7665  is=-1, split_eve
+00012880: 7279 3d4e 6f6e 6529 3a0a 2020 2020 2020  ry=None):.      
+00012890: 2020 2222 2254 6865 2069 6e64 6963 6573    """The indices
+000128a0: 206f 6620 7468 6520 746f 7020 6b20 656c   of the top k el
+000128b0: 656d 656e 7473 206f 6620 616e 2061 7272  ements of an arr
+000128c0: 6179 2e0a 0a20 2020 2020 2020 2052 6566  ay...        Ref
+000128d0: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
+000128e0: 6b2e 6172 7261 792e 6172 6774 6f70 6b60  k.array.argtopk`
+000128f0: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00012900: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00012910: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00012920: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00012930: 2020 2020 6461 736b 2e61 7272 6179 2e61      dask.array.a
+00012940: 7267 746f 706b 203a 2065 7175 6976 616c  rgtopk : equival
+00012950: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
+00012960: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012970: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00012980: 2e72 6564 7563 7469 6f6e 7320 696d 706f  .reductions impo
+00012990: 7274 2061 7267 746f 706b 0a0a 2020 2020  rt argtopk..    
+000129a0: 2020 2020 7265 7475 726e 2061 7267 746f      return argto
+000129b0: 706b 2873 656c 662c 206b 2c20 6178 6973  pk(self, k, axis
+000129c0: 3d61 7869 732c 2073 706c 6974 5f65 7665  =axis, split_eve
+000129d0: 7279 3d73 706c 6974 5f65 7665 7279 290a  ry=split_every).
+000129e0: 0a20 2020 2064 6566 2061 7374 7970 6528  .    def astype(
+000129f0: 7365 6c66 2c20 6474 7970 652c 202a 2a6b  self, dtype, **k
+00012a00: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00012a10: 2222 2243 6f70 7920 6f66 2074 6865 2061  """Copy of the a
+00012a20: 7272 6179 2c20 6361 7374 2074 6f20 6120  rray, cast to a 
+00012a30: 7370 6563 6966 6965 6420 7479 7065 2e0a  specified type..
+00012a40: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00012a50: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00012a60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00012a70: 7479 7065 203a 2073 7472 206f 7220 6474  type : str or dt
+00012a80: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+00012a90: 5479 7065 636f 6465 206f 7220 6461 7461  Typecode or data
+00012aa0: 2d74 7970 6520 746f 2077 6869 6368 2074  -type to which t
+00012ab0: 6865 2061 7272 6179 2069 7320 6361 7374  he array is cast
+00012ac0: 2e0a 2020 2020 2020 2020 6361 7374 696e  ..        castin
+00012ad0: 6720 3a20 7b27 6e6f 272c 2027 6571 7569  g : {'no', 'equi
+00012ae0: 7627 2c20 2773 6166 6527 2c20 2773 616d  v', 'safe', 'sam
+00012af0: 655f 6b69 6e64 272c 2027 756e 7361 6665  e_kind', 'unsafe
+00012b00: 277d 2c20 6f70 7469 6f6e 616c 0a20 2020  '}, optional.   
+00012b10: 2020 2020 2020 2020 2043 6f6e 7472 6f6c           Control
+00012b20: 7320 7768 6174 206b 696e 6420 6f66 2064  s what kind of d
+00012b30: 6174 6120 6361 7374 696e 6720 6d61 7920  ata casting may 
+00012b40: 6f63 6375 722e 2044 6566 6175 6c74 7320  occur. Defaults 
+00012b50: 746f 2027 756e 7361 6665 270a 2020 2020  to 'unsafe'.    
+00012b60: 2020 2020 2020 2020 666f 7220 6261 636b          for back
+00012b70: 7761 7264 7320 636f 6d70 6174 6962 696c  wards compatibil
+00012b80: 6974 792e 0a0a 2020 2020 2020 2020 2020  ity...          
+00012b90: 2020 2a20 276e 6f27 206d 6561 6e73 2074    * 'no' means t
+00012ba0: 6865 2064 6174 6120 7479 7065 7320 7368  he data types sh
+00012bb0: 6f75 6c64 206e 6f74 2062 6520 6361 7374  ould not be cast
+00012bc0: 2061 7420 616c 6c2e 0a20 2020 2020 2020   at all..       
+00012bd0: 2020 2020 202a 2027 6571 7569 7627 206d       * 'equiv' m
+00012be0: 6561 6e73 206f 6e6c 7920 6279 7465 2d6f  eans only byte-o
+00012bf0: 7264 6572 2063 6861 6e67 6573 2061 7265  rder changes are
+00012c00: 2061 6c6c 6f77 6564 2e0a 2020 2020 2020   allowed..      
+00012c10: 2020 2020 2020 2a20 2773 6166 6527 206d        * 'safe' m
+00012c20: 6561 6e73 206f 6e6c 7920 6361 7374 7320  eans only casts 
+00012c30: 7768 6963 6820 6361 6e20 7072 6573 6572  which can preser
+00012c40: 7665 2076 616c 7565 7320 6172 6520 616c  ve values are al
+00012c50: 6c6f 7765 642e 0a20 2020 2020 2020 2020  lowed..         
+00012c60: 2020 202a 2027 7361 6d65 5f6b 696e 6427     * 'same_kind'
+00012c70: 206d 6561 6e73 206f 6e6c 7920 7361 6665   means only safe
+00012c80: 2063 6173 7473 206f 7220 6361 7374 7320   casts or casts 
+00012c90: 7769 7468 696e 2061 206b 696e 642c 0a20  within a kind,. 
+00012ca0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00012cb0: 696b 6520 666c 6f61 7436 3420 746f 2066  ike float64 to f
+00012cc0: 6c6f 6174 3332 2c20 6172 6520 616c 6c6f  loat32, are allo
+00012cd0: 7765 642e 0a20 2020 2020 2020 2020 2020  wed..           
+00012ce0: 202a 2027 756e 7361 6665 2720 6d65 616e   * 'unsafe' mean
+00012cf0: 7320 616e 7920 6461 7461 2063 6f6e 7665  s any data conve
+00012d00: 7273 696f 6e73 206d 6179 2062 6520 646f  rsions may be do
+00012d10: 6e65 2e0a 2020 2020 2020 2020 636f 7079  ne..        copy
+00012d20: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
+00012d30: 6c0a 2020 2020 2020 2020 2020 2020 4279  l.            By
+00012d40: 2064 6566 6175 6c74 2c20 6173 7479 7065   default, astype
+00012d50: 2061 6c77 6179 7320 7265 7475 726e 7320   always returns 
+00012d60: 6120 6e65 776c 7920 616c 6c6f 6361 7465  a newly allocate
+00012d70: 6420 6172 7261 792e 2049 6620 7468 6973  d array. If this
+00012d80: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
+00012d90: 7365 7420 746f 2046 616c 7365 2061 6e64  set to False and
+00012da0: 2074 6865 2060 6474 7970 6560 2072 6571   the `dtype` req
+00012db0: 7569 7265 6d65 6e74 2069 7320 7361 7469  uirement is sati
+00012dc0: 7366 6965 642c 2074 6865 2069 6e70 7574  sfied, the input
+00012dd0: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
+00012de0: 6179 2069 7320 7265 7475 726e 6564 2069  ay is returned i
+00012df0: 6e73 7465 6164 206f 6620 6120 636f 7079  nstead of a copy
+00012e00: 2e0a 0a20 2020 2020 2020 2020 2020 202e  ...            .
+00012e10: 2e20 6e6f 7465 3a3a 0a0a 2020 2020 2020  . note::..      
+00012e20: 2020 2020 2020 2020 2020 4461 736b 2064            Dask d
+00012e30: 6f65 7320 6e6f 7420 7265 7370 6563 7420  oes not respect 
+00012e40: 7468 6520 636f 6e74 6967 756f 7573 206d  the contiguous m
+00012e50: 656d 6f72 7920 6c61 796f 7574 206f 6620  emory layout of 
+00012e60: 7468 6520 6172 7261 792c 0a20 2020 2020  the array,.     
+00012e70: 2020 2020 2020 2020 2020 2061 6e64 2077             and w
+00012e80: 696c 6c20 6967 6e6f 7265 2074 6865 2060  ill ignore the `
+00012e90: 606f 7264 6572 6060 206b 6579 776f 7264  `order`` keyword
+00012ea0: 2061 7267 756d 656e 742e 0a20 2020 2020   argument..     
+00012eb0: 2020 2020 2020 2020 2020 2054 6865 2064             The d
+00012ec0: 6566 6175 6c74 206f 7264 6572 2069 7320  efault order is 
+00012ed0: 2743 2720 636f 6e74 6967 756f 7573 2e0a  'C' contiguous..
+00012ee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012ef0: 2020 2020 6b77 6172 6773 2e70 6f70 2822      kwargs.pop("
+00012f00: 6f72 6465 7222 2c20 4e6f 6e65 2920 2023  order", None)  #
+00012f10: 2060 6f72 6465 7260 2069 7320 6e6f 7420   `order` is not 
+00012f20: 7265 7370 6563 7465 642c 2073 6f20 7765  respected, so we
+00012f30: 2072 656d 6f76 6520 7468 6973 206b 7761   remove this kwa
+00012f40: 7267 0a20 2020 2020 2020 2023 2053 6361  rg.        # Sca
+00012f50: 6c61 7273 2064 6f6e 2774 2074 616b 6520  lars don't take 
+00012f60: 6063 6173 7469 6e67 6020 6f72 2060 636f  `casting` or `co
+00012f70: 7079 6020 6b77 6172 6773 202d 2061 7320  py` kwargs - as 
+00012f80: 7375 6368 2077 6520 6f6e 6c79 2070 6173  such we only pas
+00012f90: 730a 2020 2020 2020 2020 2320 7468 656d  s.        # them
+00012fa0: 2074 6f20 606d 6170 5f62 6c6f 636b 7360   to `map_blocks`
+00012fb0: 2069 6620 7370 6563 6966 6965 6420 6279   if specified by
+00012fc0: 2075 7365 7220 2864 6966 6665 7265 6e74   user (different
+00012fd0: 2074 6861 6e20 6465 6661 756c 7473 292e   than defaults).
+00012fe0: 0a20 2020 2020 2020 2065 7874 7261 203d  .        extra =
+00012ff0: 2073 6574 286b 7761 7267 7329 202d 207b   set(kwargs) - {
+00013000: 2263 6173 7469 6e67 222c 2022 636f 7079  "casting", "copy
+00013010: 227d 0a20 2020 2020 2020 2069 6620 6578  "}.        if ex
+00013020: 7472 613a 0a20 2020 2020 2020 2020 2020  tra:.           
+00013030: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00013040: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00013050: 2020 6622 6173 7479 7065 2064 6f65 7320    f"astype does 
+00013060: 6e6f 7420 7461 6b65 2074 6865 2066 6f6c  not take the fol
+00013070: 6c6f 7769 6e67 206b 6579 776f 7264 2061  lowing keyword a
+00013080: 7267 756d 656e 7473 3a20 7b6c 6973 7428  rguments: {list(
+00013090: 6578 7472 6129 7d22 0a20 2020 2020 2020  extra)}".       
+000130a0: 2020 2020 2029 0a20 2020 2020 2020 2063       ).        c
+000130b0: 6173 7469 6e67 203d 206b 7761 7267 732e  asting = kwargs.
+000130c0: 6765 7428 2263 6173 7469 6e67 222c 2022  get("casting", "
+000130d0: 756e 7361 6665 2229 0a20 2020 2020 2020  unsafe").       
+000130e0: 2064 7479 7065 203d 206e 702e 6474 7970   dtype = np.dtyp
+000130f0: 6528 6474 7970 6529 0a20 2020 2020 2020  e(dtype).       
+00013100: 2069 6620 7365 6c66 2e64 7479 7065 203d   if self.dtype =
+00013110: 3d20 6474 7970 653a 0a20 2020 2020 2020  = dtype:.       
+00013120: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013130: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
+00013140: 7420 6e70 2e63 616e 5f63 6173 7428 7365  t np.can_cast(se
+00013150: 6c66 2e64 7479 7065 2c20 6474 7970 652c  lf.dtype, dtype,
+00013160: 2063 6173 7469 6e67 3d63 6173 7469 6e67   casting=casting
+00013170: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00013180: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
+00013190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131a0: 6622 4361 6e6e 6f74 2063 6173 7420 6172  f"Cannot cast ar
+000131b0: 7261 7920 6672 6f6d 207b 7365 6c66 2e64  ray from {self.d
+000131c0: 7479 7065 2172 7d20 746f 207b 6474 7970  type!r} to {dtyp
+000131d0: 6521 727d 2022 0a20 2020 2020 2020 2020  e!r} ".         
+000131e0: 2020 2020 2020 2066 2261 6363 6f72 6469         f"accordi
+000131f0: 6e67 2074 6f20 7468 6520 7275 6c65 207b  ng to the rule {
+00013200: 6361 7374 696e 6721 727d 220a 2020 2020  casting!r}".    
+00013210: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013220: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+00013230: 705f 626c 6f63 6b73 2863 6875 6e6b 2e61  p_blocks(chunk.a
+00013240: 7374 7970 652c 2064 7479 7065 3d64 7479  stype, dtype=dty
+00013250: 7065 2c20 6173 7479 7065 5f64 7479 7065  pe, astype_dtype
+00013260: 3d64 7479 7065 2c20 2a2a 6b77 6172 6773  =dtype, **kwargs
+00013270: 290a 0a20 2020 2064 6566 205f 5f61 6273  )..    def __abs
+00013280: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00013290: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+000132a0: 6528 6f70 6572 6174 6f72 2e61 6273 2c20  e(operator.abs, 
+000132b0: 7365 6c66 290a 0a20 2020 2040 6368 6563  self)..    @chec
+000132c0: 6b5f 6966 5f68 616e 646c 6564 5f67 6976  k_if_handled_giv
+000132d0: 656e 5f6f 7468 6572 0a20 2020 2064 6566  en_other.    def
+000132e0: 205f 5f61 6464 5f5f 2873 656c 662c 206f   __add__(self, o
+000132f0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+00013300: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+00013310: 7065 7261 746f 722e 6164 642c 2073 656c  perator.add, sel
+00013320: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+00013330: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00013340: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+00013350: 2064 6566 205f 5f72 6164 645f 5f28 7365   def __radd__(se
+00013360: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00013370: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
+00013380: 6973 6528 6f70 6572 6174 6f72 2e61 6464  ise(operator.add
+00013390: 2c20 6f74 6865 722c 2073 656c 6629 0a0a  , other, self)..
+000133a0: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
+000133b0: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
+000133c0: 720a 2020 2020 6465 6620 5f5f 616e 645f  r.    def __and_
+000133d0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+000133e0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+000133f0: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00013400: 2e61 6e64 5f2c 2073 656c 662c 206f 7468  .and_, self, oth
+00013410: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+00013420: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00013430: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00013440: 5f72 616e 645f 5f28 7365 6c66 2c20 6f74  _rand__(self, ot
+00013450: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+00013460: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
+00013470: 6572 6174 6f72 2e61 6e64 5f2c 206f 7468  erator.and_, oth
+00013480: 6572 2c20 7365 6c66 290a 0a20 2020 2040  er, self)..    @
+00013490: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+000134a0: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+000134b0: 2064 6566 205f 5f64 6976 5f5f 2873 656c   def __div__(sel
+000134c0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+000134d0: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
+000134e0: 7365 286f 7065 7261 746f 722e 6469 762c  se(operator.div,
+000134f0: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
+00013500: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00013510: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00013520: 0a20 2020 2064 6566 205f 5f72 6469 765f  .    def __rdiv_
+00013530: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+00013540: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00013550: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00013560: 2e64 6976 2c20 6f74 6865 722c 2073 656c  .div, other, sel
+00013570: 6629 0a0a 2020 2020 4063 6865 636b 5f69  f)..    @check_i
+00013580: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
+00013590: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
+000135a0: 6571 5f5f 2873 656c 662c 206f 7468 6572  eq__(self, other
+000135b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000135c0: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
+000135d0: 746f 722e 6571 2c20 7365 6c66 2c20 6f74  tor.eq, self, ot
+000135e0: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
+000135f0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
+00013600: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
+00013610: 5f5f 6774 5f5f 2873 656c 662c 206f 7468  __gt__(self, oth
+00013620: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00013630: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
+00013640: 7261 746f 722e 6774 2c20 7365 6c66 2c20  rator.gt, self, 
+00013650: 6f74 6865 7229 0a0a 2020 2020 4063 6865  other)..    @che
+00013660: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
+00013670: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
+00013680: 6620 5f5f 6765 5f5f 2873 656c 662c 206f  f __ge__(self, o
+00013690: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+000136a0: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+000136b0: 7065 7261 746f 722e 6765 2c20 7365 6c66  perator.ge, self
+000136c0: 2c20 6f74 6865 7229 0a0a 2020 2020 6465  , other)..    de
+000136d0: 6620 5f5f 696e 7665 7274 5f5f 2873 656c  f __invert__(sel
+000136e0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+000136f0: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013700: 6174 6f72 2e69 6e76 6572 742c 2073 656c  ator.invert, sel
+00013710: 6629 0a0a 2020 2020 4063 6865 636b 5f69  f)..    @check_i
+00013720: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
+00013730: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
+00013740: 6c73 6869 6674 5f5f 2873 656c 662c 206f  lshift__(self, o
+00013750: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+00013760: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+00013770: 7065 7261 746f 722e 6c73 6869 6674 2c20  perator.lshift, 
+00013780: 7365 6c66 2c20 6f74 6865 7229 0a0a 2020  self, other)..  
+00013790: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
+000137a0: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
+000137b0: 2020 2020 6465 6620 5f5f 726c 7368 6966      def __rlshif
+000137c0: 745f 5f28 7365 6c66 2c20 6f74 6865 7229  t__(self, other)
+000137d0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000137e0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
+000137f0: 6f72 2e6c 7368 6966 742c 206f 7468 6572  or.lshift, other
+00013800: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
+00013810: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
+00013820: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
+00013830: 6566 205f 5f6c 745f 5f28 7365 6c66 2c20  ef __lt__(self, 
+00013840: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+00013850: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
+00013860: 6f70 6572 6174 6f72 2e6c 742c 2073 656c  operator.lt, sel
+00013870: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+00013880: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00013890: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+000138a0: 2064 6566 205f 5f6c 655f 5f28 7365 6c66   def __le__(self
+000138b0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+000138c0: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+000138d0: 6528 6f70 6572 6174 6f72 2e6c 652c 2073  e(operator.le, s
+000138e0: 656c 662c 206f 7468 6572 290a 0a20 2020  elf, other)..   
+000138f0: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
+00013900: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
+00013910: 2020 2064 6566 205f 5f6d 6f64 5f5f 2873     def __mod__(s
+00013920: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00013930: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+00013940: 7769 7365 286f 7065 7261 746f 722e 6d6f  wise(operator.mo
+00013950: 642c 2073 656c 662c 206f 7468 6572 290a  d, self, other).
+00013960: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
+00013970: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
+00013980: 6572 0a20 2020 2064 6566 205f 5f72 6d6f  er.    def __rmo
+00013990: 645f 5f28 7365 6c66 2c20 6f74 6865 7229  d__(self, other)
+000139a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000139b0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
+000139c0: 6f72 2e6d 6f64 2c20 6f74 6865 722c 2073  or.mod, other, s
+000139d0: 656c 6629 0a0a 2020 2020 4063 6865 636b  elf)..    @check
+000139e0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
+000139f0: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
+00013a00: 5f5f 6d75 6c5f 5f28 7365 6c66 2c20 6f74  __mul__(self, ot
+00013a10: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+00013a20: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
+00013a30: 6572 6174 6f72 2e6d 756c 2c20 7365 6c66  erator.mul, self
+00013a40: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
+00013a50: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
+00013a60: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
+00013a70: 6465 6620 5f5f 726d 756c 5f5f 2873 656c  def __rmul__(sel
+00013a80: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+00013a90: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
+00013aa0: 7365 286f 7065 7261 746f 722e 6d75 6c2c  se(operator.mul,
+00013ab0: 206f 7468 6572 2c20 7365 6c66 290a 0a20   other, self).. 
+00013ac0: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00013ad0: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00013ae0: 0a20 2020 2064 6566 205f 5f6e 655f 5f28  .    def __ne__(
+00013af0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00013b00: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00013b10: 6d77 6973 6528 6f70 6572 6174 6f72 2e6e  mwise(operator.n
+00013b20: 652c 2073 656c 662c 206f 7468 6572 290a  e, self, other).
+00013b30: 0a20 2020 2064 6566 205f 5f6e 6567 5f5f  .    def __neg__
+00013b40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00013b50: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
+00013b60: 6f70 6572 6174 6f72 2e6e 6567 2c20 7365  operator.neg, se
+00013b70: 6c66 290a 0a20 2020 2040 6368 6563 6b5f  lf)..    @check_
+00013b80: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00013b90: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00013ba0: 5f6f 725f 5f28 7365 6c66 2c20 6f74 6865  _or__(self, othe
+00013bb0: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00013bc0: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013bd0: 6174 6f72 2e6f 725f 2c20 7365 6c66 2c20  ator.or_, self, 
+00013be0: 6f74 6865 7229 0a0a 2020 2020 6465 6620  other)..    def 
+00013bf0: 5f5f 706f 735f 5f28 7365 6c66 293a 0a20  __pos__(self):. 
+00013c00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00013c10: 6c66 0a0a 2020 2020 4063 6865 636b 5f69  lf..    @check_i
+00013c20: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
+00013c30: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
+00013c40: 726f 725f 5f28 7365 6c66 2c20 6f74 6865  ror__(self, othe
+00013c50: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00013c60: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013c70: 6174 6f72 2e6f 725f 2c20 6f74 6865 722c  ator.or_, other,
+00013c80: 2073 656c 6629 0a0a 2020 2020 4063 6865   self)..    @che
+00013c90: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
+00013ca0: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
+00013cb0: 6620 5f5f 706f 775f 5f28 7365 6c66 2c20  f __pow__(self, 
+00013cc0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+00013cd0: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
+00013ce0: 6f70 6572 6174 6f72 2e70 6f77 2c20 7365  operator.pow, se
+00013cf0: 6c66 2c20 6f74 6865 7229 0a0a 2020 2020  lf, other)..    
+00013d00: 4063 6865 636b 5f69 665f 6861 6e64 6c65  @check_if_handle
+00013d10: 645f 6769 7665 6e5f 6f74 6865 720a 2020  d_given_other.  
+00013d20: 2020 6465 6620 5f5f 7270 6f77 5f5f 2873    def __rpow__(s
+00013d30: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00013d40: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+00013d50: 7769 7365 286f 7065 7261 746f 722e 706f  wise(operator.po
+00013d60: 772c 206f 7468 6572 2c20 7365 6c66 290a  w, other, self).
+00013d70: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
+00013d80: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
+00013d90: 6572 0a20 2020 2064 6566 205f 5f72 7368  er.    def __rsh
+00013da0: 6966 745f 5f28 7365 6c66 2c20 6f74 6865  ift__(self, othe
+00013db0: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00013dc0: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013dd0: 6174 6f72 2e72 7368 6966 742c 2073 656c  ator.rshift, sel
+00013de0: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+00013df0: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00013e00: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+00013e10: 2064 6566 205f 5f72 7273 6869 6674 5f5f   def __rrshift__
+00013e20: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+00013e30: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
+00013e40: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
+00013e50: 7273 6869 6674 2c20 6f74 6865 722c 2073  rshift, other, s
+00013e60: 656c 6629 0a0a 2020 2020 4063 6865 636b  elf)..    @check
+00013e70: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
+00013e80: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
+00013e90: 5f5f 7375 625f 5f28 7365 6c66 2c20 6f74  __sub__(self, ot
+00013ea0: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+00013eb0: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
+00013ec0: 6572 6174 6f72 2e73 7562 2c20 7365 6c66  erator.sub, self
+00013ed0: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
+00013ee0: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
+00013ef0: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
+00013f00: 6465 6620 5f5f 7273 7562 5f5f 2873 656c  def __rsub__(sel
+00013f10: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+00013f20: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
+00013f30: 7365 286f 7065 7261 746f 722e 7375 622c  se(operator.sub,
+00013f40: 206f 7468 6572 2c20 7365 6c66 290a 0a20   other, self).. 
+00013f50: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00013f60: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00013f70: 0a20 2020 2064 6566 205f 5f74 7275 6564  .    def __trued
+00013f80: 6976 5f5f 2873 656c 662c 206f 7468 6572  iv__(self, other
+00013f90: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00013fa0: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
+00013fb0: 746f 722e 7472 7565 6469 762c 2073 656c  tor.truediv, sel
+00013fc0: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+00013fd0: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00013fe0: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+00013ff0: 2064 6566 205f 5f72 7472 7565 6469 765f   def __rtruediv_
+00014000: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+00014010: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00014020: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00014030: 2e74 7275 6564 6976 2c20 6f74 6865 722c  .truediv, other,
+00014040: 2073 656c 6629 0a0a 2020 2020 4063 6865   self)..    @che
+00014050: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
+00014060: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
+00014070: 6620 5f5f 666c 6f6f 7264 6976 5f5f 2873  f __floordiv__(s
+00014080: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00014090: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+000140a0: 7769 7365 286f 7065 7261 746f 722e 666c  wise(operator.fl
+000140b0: 6f6f 7264 6976 2c20 7365 6c66 2c20 6f74  oordiv, self, ot
+000140c0: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
+000140d0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
+000140e0: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
+000140f0: 5f5f 7266 6c6f 6f72 6469 765f 5f28 7365  __rfloordiv__(se
+00014100: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00014110: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
+00014120: 6973 6528 6f70 6572 6174 6f72 2e66 6c6f  ise(operator.flo
+00014130: 6f72 6469 762c 206f 7468 6572 2c20 7365  ordiv, other, se
+00014140: 6c66 290a 0a20 2020 2040 6368 6563 6b5f  lf)..    @check_
+00014150: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00014160: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00014170: 5f78 6f72 5f5f 2873 656c 662c 206f 7468  _xor__(self, oth
+00014180: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00014190: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
+000141a0: 7261 746f 722e 786f 722c 2073 656c 662c  rator.xor, self,
+000141b0: 206f 7468 6572 290a 0a20 2020 2040 6368   other)..    @ch
+000141c0: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
+000141d0: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
+000141e0: 6566 205f 5f72 786f 725f 5f28 7365 6c66  ef __rxor__(self
+000141f0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+00014200: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+00014210: 6528 6f70 6572 6174 6f72 2e78 6f72 2c20  e(operator.xor, 
+00014220: 6f74 6865 722c 2073 656c 6629 0a0a 2020  other, self)..  
+00014230: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
+00014240: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
+00014250: 2020 2020 6465 6620 5f5f 6d61 746d 756c      def __matmul
+00014260: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+00014270: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00014280: 736b 2e61 7272 6179 2e72 6f75 7469 6e65  sk.array.routine
+00014290: 7320 696d 706f 7274 206d 6174 6d75 6c0a  s import matmul.
+000142a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000142b0: 6d61 746d 756c 2873 656c 662c 206f 7468  matmul(self, oth
+000142c0: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+000142d0: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+000142e0: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+000142f0: 5f72 6d61 746d 756c 5f5f 2873 656c 662c  _rmatmul__(self,
+00014300: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00014310: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00014320: 2e72 6f75 7469 6e65 7320 696d 706f 7274  .routines import
+00014330: 206d 6174 6d75 6c0a 0a20 2020 2020 2020   matmul..       
+00014340: 2072 6574 7572 6e20 6d61 746d 756c 286f   return matmul(o
+00014350: 7468 6572 2c20 7365 6c66 290a 0a20 2020  ther, self)..   
+00014360: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
+00014370: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
+00014380: 2020 2064 6566 205f 5f64 6976 6d6f 645f     def __divmod_
+00014390: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+000143a0: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+000143b0: 6b2e 6172 7261 792e 7566 756e 6320 696d  k.array.ufunc im
+000143c0: 706f 7274 2064 6976 6d6f 640a 0a20 2020  port divmod..   
+000143d0: 2020 2020 2072 6574 7572 6e20 6469 766d       return divm
+000143e0: 6f64 2873 656c 662c 206f 7468 6572 290a  od(self, other).
+000143f0: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
+00014400: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
+00014410: 6572 0a20 2020 2064 6566 205f 5f72 6469  er.    def __rdi
+00014420: 766d 6f64 5f5f 2873 656c 662c 206f 7468  vmod__(self, oth
+00014430: 6572 293a 0a20 2020 2020 2020 2066 726f  er):.        fro
+00014440: 6d20 6461 736b 2e61 7272 6179 2e75 6675  m dask.array.ufu
+00014450: 6e63 2069 6d70 6f72 7420 6469 766d 6f64  nc import divmod
+00014460: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00014470: 2064 6976 6d6f 6428 6f74 6865 722c 2073   divmod(other, s
+00014480: 656c 6629 0a0a 2020 2020 6465 6620 616e  elf)..    def an
+00014490: 7928 7365 6c66 2c20 6178 6973 3d4e 6f6e  y(self, axis=Non
+000144a0: 652c 206b 6565 7064 696d 733d 4661 6c73  e, keepdims=Fals
+000144b0: 652c 2073 706c 6974 5f65 7665 7279 3d4e  e, split_every=N
+000144c0: 6f6e 652c 206f 7574 3d4e 6f6e 6529 3a0a  one, out=None):.
+000144d0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+000144e0: 6e73 2054 7275 6520 6966 2061 6e79 206f  ns True if any o
+000144f0: 6620 7468 6520 656c 656d 656e 7473 2065  f the elements e
+00014500: 7661 6c75 6174 6520 746f 2054 7275 652e  valuate to True.
+00014510: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
+00014520: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
+00014530: 7272 6179 2e61 6e79 6020 666f 7220 6675  rray.any` for fu
+00014540: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
+00014550: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+00014560: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00014570: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+00014580: 6b2e 6172 7261 792e 616e 7920 3a20 6571  k.array.any : eq
+00014590: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
+000145a0: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+000145b0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+000145c0: 6172 7261 792e 7265 6475 6374 696f 6e73  array.reductions
+000145d0: 2069 6d70 6f72 7420 616e 790a 0a20 2020   import any..   
+000145e0: 2020 2020 2072 6574 7572 6e20 616e 7928       return any(
+000145f0: 7365 6c66 2c20 6178 6973 3d61 7869 732c  self, axis=axis,
+00014600: 206b 6565 7064 696d 733d 6b65 6570 6469   keepdims=keepdi
+00014610: 6d73 2c20 7370 6c69 745f 6576 6572 793d  ms, split_every=
+00014620: 7370 6c69 745f 6576 6572 792c 206f 7574  split_every, out
+00014630: 3d6f 7574 290a 0a20 2020 2064 6566 2061  =out)..    def a
+00014640: 6c6c 2873 656c 662c 2061 7869 733d 4e6f  ll(self, axis=No
+00014650: 6e65 2c20 6b65 6570 6469 6d73 3d46 616c  ne, keepdims=Fal
+00014660: 7365 2c20 7370 6c69 745f 6576 6572 793d  se, split_every=
+00014670: 4e6f 6e65 2c20 6f75 743d 4e6f 6e65 293a  None, out=None):
+00014680: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00014690: 726e 7320 5472 7565 2069 6620 616c 6c20  rns True if all 
+000146a0: 656c 656d 656e 7473 2065 7661 6c75 6174  elements evaluat
+000146b0: 6520 746f 2054 7275 652e 0a0a 2020 2020  e to True...    
+000146c0: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+000146d0: 6e63 3a60 6461 736b 2e61 7272 6179 2e61  nc:`dask.array.a
+000146e0: 6c6c 6020 666f 7220 6675 6c6c 2064 6f63  ll` for full doc
+000146f0: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00014700: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00014710: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00014720: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+00014730: 792e 616c 6c20 3a20 6571 7569 7661 6c65  y.all : equivale
+00014740: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
+00014750: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014760: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+00014770: 7265 6475 6374 696f 6e73 2069 6d70 6f72  reductions impor
+00014780: 7420 616c 6c0a 0a20 2020 2020 2020 2072  t all..        r
+00014790: 6574 7572 6e20 616c 6c28 7365 6c66 2c20  eturn all(self, 
+000147a0: 6178 6973 3d61 7869 732c 206b 6565 7064  axis=axis, keepd
+000147b0: 696d 733d 6b65 6570 6469 6d73 2c20 7370  ims=keepdims, sp
+000147c0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+000147d0: 6576 6572 792c 206f 7574 3d6f 7574 290a  every, out=out).
+000147e0: 0a20 2020 2064 6566 206d 696e 2873 656c  .    def min(sel
+000147f0: 662c 2061 7869 733d 4e6f 6e65 2c20 6b65  f, axis=None, ke
+00014800: 6570 6469 6d73 3d46 616c 7365 2c20 7370  epdims=False, sp
+00014810: 6c69 745f 6576 6572 793d 4e6f 6e65 2c20  lit_every=None, 
+00014820: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
+00014830: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
+00014840: 206d 696e 696d 756d 2061 6c6f 6e67 2061   minimum along a
+00014850: 2067 6976 656e 2061 7869 732e 0a0a 2020   given axis...  
+00014860: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+00014870: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00014880: 2e6d 696e 6020 666f 7220 6675 6c6c 2064  .min` for full d
+00014890: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
+000148a0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000148b0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000148c0: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+000148d0: 7261 792e 6d69 6e20 3a20 6571 7569 7661  ray.min : equiva
+000148e0: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+000148f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00014900: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00014910: 792e 7265 6475 6374 696f 6e73 2069 6d70  y.reductions imp
+00014920: 6f72 7420 6d69 6e0a 0a20 2020 2020 2020  ort min..       
+00014930: 2072 6574 7572 6e20 6d69 6e28 7365 6c66   return min(self
+00014940: 2c20 6178 6973 3d61 7869 732c 206b 6565  , axis=axis, kee
+00014950: 7064 696d 733d 6b65 6570 6469 6d73 2c20  pdims=keepdims, 
+00014960: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
+00014970: 745f 6576 6572 792c 206f 7574 3d6f 7574  t_every, out=out
+00014980: 290a 0a20 2020 2064 6566 206d 6178 2873  )..    def max(s
+00014990: 656c 662c 2061 7869 733d 4e6f 6e65 2c20  elf, axis=None, 
+000149a0: 6b65 6570 6469 6d73 3d46 616c 7365 2c20  keepdims=False, 
+000149b0: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
+000149c0: 2c20 6f75 743d 4e6f 6e65 293a 0a20 2020  , out=None):.   
+000149d0: 2020 2020 2022 2222 5265 7475 726e 2074       """Return t
+000149e0: 6865 206d 6178 696d 756d 2061 6c6f 6e67  he maximum along
+000149f0: 2061 2067 6976 656e 2061 7869 732e 0a0a   a given axis...
+00014a00: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+00014a10: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
+00014a20: 6179 2e6d 6178 6020 666f 7220 6675 6c6c  ay.max` for full
+00014a30: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00014a40: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00014a50: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00014a60: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00014a70: 6172 7261 792e 6d61 7820 3a20 6571 7569  array.max : equi
+00014a80: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00014a90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014aa0: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00014ab0: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+00014ac0: 6d70 6f72 7420 6d61 780a 0a20 2020 2020  mport max..     
+00014ad0: 2020 2072 6574 7572 6e20 6d61 7828 7365     return max(se
+00014ae0: 6c66 2c20 6178 6973 3d61 7869 732c 206b  lf, axis=axis, k
+00014af0: 6565 7064 696d 733d 6b65 6570 6469 6d73  eepdims=keepdims
+00014b00: 2c20 7370 6c69 745f 6576 6572 793d 7370  , split_every=sp
+00014b10: 6c69 745f 6576 6572 792c 206f 7574 3d6f  lit_every, out=o
+00014b20: 7574 290a 0a20 2020 2064 6566 2061 7267  ut)..    def arg
+00014b30: 6d69 6e28 7365 6c66 2c20 6178 6973 3d4e  min(self, axis=N
+00014b40: 6f6e 652c 202a 2c20 6b65 6570 6469 6d73  one, *, keepdims
+00014b50: 3d46 616c 7365 2c20 7370 6c69 745f 6576  =False, split_ev
+00014b60: 6572 793d 4e6f 6e65 2c20 6f75 743d 4e6f  ery=None, out=No
+00014b70: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00014b80: 5265 7475 726e 2069 6e64 6963 6573 206f  Return indices o
+00014b90: 6620 7468 6520 6d69 6e69 6d75 6d20 7661  f the minimum va
+00014ba0: 6c75 6573 2061 6c6f 6e67 2074 6865 2067  lues along the g
+00014bb0: 6976 656e 2061 7869 732e 0a0a 2020 2020  iven axis...    
+00014bc0: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+00014bd0: 6e63 3a60 6461 736b 2e61 7272 6179 2e61  nc:`dask.array.a
+00014be0: 7267 6d69 6e60 2066 6f72 2066 756c 6c20  rgmin` for full 
+00014bf0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+00014c00: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00014c10: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00014c20: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00014c30: 7272 6179 2e61 7267 6d69 6e20 3a20 6571  rray.argmin : eq
+00014c40: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
+00014c50: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00014c60: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+00014c70: 6172 7261 792e 7265 6475 6374 696f 6e73  array.reductions
+00014c80: 2069 6d70 6f72 7420 6172 676d 696e 0a0a   import argmin..
+00014c90: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00014ca0: 7267 6d69 6e28 0a20 2020 2020 2020 2020  rgmin(.         
+00014cb0: 2020 2073 656c 662c 2061 7869 733d 6178     self, axis=ax
+00014cc0: 6973 2c20 6b65 6570 6469 6d73 3d6b 6565  is, keepdims=kee
+00014cd0: 7064 696d 732c 2073 706c 6974 5f65 7665  pdims, split_eve
+00014ce0: 7279 3d73 706c 6974 5f65 7665 7279 2c20  ry=split_every, 
+00014cf0: 6f75 743d 6f75 740a 2020 2020 2020 2020  out=out.        
+00014d00: 290a 0a20 2020 2064 6566 2061 7267 6d61  )..    def argma
+00014d10: 7828 7365 6c66 2c20 6178 6973 3d4e 6f6e  x(self, axis=Non
+00014d20: 652c 202a 2c20 6b65 6570 6469 6d73 3d46  e, *, keepdims=F
+00014d30: 616c 7365 2c20 7370 6c69 745f 6576 6572  alse, split_ever
+00014d40: 793d 4e6f 6e65 2c20 6f75 743d 4e6f 6e65  y=None, out=None
+00014d50: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+00014d60: 7475 726e 2069 6e64 6963 6573 206f 6620  turn indices of 
+00014d70: 7468 6520 6d61 7869 6d75 6d20 7661 6c75  the maximum valu
+00014d80: 6573 2061 6c6f 6e67 2074 6865 2067 6976  es along the giv
+00014d90: 656e 2061 7869 732e 0a0a 2020 2020 2020  en axis...      
+00014da0: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
+00014db0: 3a60 6461 736b 2e61 7272 6179 2e61 7267  :`dask.array.arg
+00014dc0: 6d61 7860 2066 6f72 2066 756c 6c20 646f  max` for full do
+00014dd0: 6375 6d65 6e74 6174 696f 6e2e 0a0a 2020  cumentation...  
+00014de0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+00014df0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00014e00: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
+00014e10: 6179 2e61 7267 6d61 7820 3a20 6571 7569  ay.argmax : equi
+00014e20: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00014e30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014e40: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00014e50: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+00014e60: 6d70 6f72 7420 6172 676d 6178 0a0a 2020  mport argmax..  
+00014e70: 2020 2020 2020 7265 7475 726e 2061 7267        return arg
+00014e80: 6d61 7828 0a20 2020 2020 2020 2020 2020  max(.           
+00014e90: 2073 656c 662c 2061 7869 733d 6178 6973   self, axis=axis
+00014ea0: 2c20 6b65 6570 6469 6d73 3d6b 6565 7064  , keepdims=keepd
+00014eb0: 696d 732c 2073 706c 6974 5f65 7665 7279  ims, split_every
+00014ec0: 3d73 706c 6974 5f65 7665 7279 2c20 6f75  =split_every, ou
+00014ed0: 743d 6f75 740a 2020 2020 2020 2020 290a  t=out.        ).
+00014ee0: 0a20 2020 2064 6566 2073 756d 2873 656c  .    def sum(sel
+00014ef0: 662c 2061 7869 733d 4e6f 6e65 2c20 6474  f, axis=None, dt
+00014f00: 7970 653d 4e6f 6e65 2c20 6b65 6570 6469  ype=None, keepdi
+00014f10: 6d73 3d46 616c 7365 2c20 7370 6c69 745f  ms=False, split_
+00014f20: 6576 6572 793d 4e6f 6e65 2c20 6f75 743d  every=None, out=
+00014f30: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00014f40: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00014f50: 6e20 7468 6520 7375 6d20 6f66 2074 6865  n the sum of the
+00014f60: 2061 7272 6179 2065 6c65 6d65 6e74 7320   array elements 
+00014f70: 6f76 6572 2074 6865 2067 6976 656e 2061  over the given a
+00014f80: 7869 732e 0a0a 2020 2020 2020 2020 5265  xis...        Re
+00014f90: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00014fa0: 736b 2e61 7272 6179 2e73 756d 6020 666f  sk.array.sum` fo
+00014fb0: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00014fc0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00014fd0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00014fe0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00014ff0: 2064 6173 6b2e 6172 7261 792e 7375 6d20   dask.array.sum 
+00015000: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
+00015010: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+00015020: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+00015030: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
+00015040: 696f 6e73 2069 6d70 6f72 7420 7375 6d0a  ions import sum.
+00015050: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015060: 7375 6d28 0a20 2020 2020 2020 2020 2020  sum(.           
+00015070: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00015080: 2020 2061 7869 733d 6178 6973 2c0a 2020     axis=axis,.  
+00015090: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+000150a0: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+000150b0: 2020 206b 6565 7064 696d 733d 6b65 6570     keepdims=keep
+000150c0: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+000150d0: 2020 7370 6c69 745f 6576 6572 793d 7370    split_every=sp
+000150e0: 6c69 745f 6576 6572 792c 0a20 2020 2020  lit_every,.     
+000150f0: 2020 2020 2020 206f 7574 3d6f 7574 2c0a         out=out,.
+00015100: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00015110: 6566 2074 7261 6365 2873 656c 662c 206f  ef trace(self, o
+00015120: 6666 7365 743d 302c 2061 7869 7331 3d30  ffset=0, axis1=0
+00015130: 2c20 6178 6973 323d 312c 2064 7479 7065  , axis2=1, dtype
+00015140: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00015150: 2222 2252 6574 7572 6e20 7468 6520 7375  """Return the su
+00015160: 6d20 616c 6f6e 6720 6469 6167 6f6e 616c  m along diagonal
+00015170: 7320 6f66 2074 6865 2061 7272 6179 2e0a  s of the array..
+00015180: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
+00015190: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
+000151a0: 7261 792e 7472 6163 6560 2066 6f72 2066  ray.trace` for f
+000151b0: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
+000151c0: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
+000151d0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+000151e0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
+000151f0: 736b 2e61 7272 6179 2e74 7261 6365 203a  sk.array.trace :
+00015200: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
+00015210: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
+00015220: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00015230: 736b 2e61 7272 6179 2e72 6564 7563 7469  sk.array.reducti
+00015240: 6f6e 7320 696d 706f 7274 2074 7261 6365  ons import trace
+00015250: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015260: 2074 7261 6365 2873 656c 662c 206f 6666   trace(self, off
+00015270: 7365 743d 6f66 6673 6574 2c20 6178 6973  set=offset, axis
+00015280: 313d 6178 6973 312c 2061 7869 7332 3d61  1=axis1, axis2=a
+00015290: 7869 7332 2c20 6474 7970 653d 6474 7970  xis2, dtype=dtyp
+000152a0: 6529 0a0a 2020 2020 6465 6620 7072 6f64  e)..    def prod
+000152b0: 2873 656c 662c 2061 7869 733d 4e6f 6e65  (self, axis=None
+000152c0: 2c20 6474 7970 653d 4e6f 6e65 2c20 6b65  , dtype=None, ke
+000152d0: 6570 6469 6d73 3d46 616c 7365 2c20 7370  epdims=False, sp
+000152e0: 6c69 745f 6576 6572 793d 4e6f 6e65 2c20  lit_every=None, 
+000152f0: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
+00015300: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
+00015310: 2070 726f 6475 6374 206f 6620 7468 6520   product of the 
+00015320: 6172 7261 7920 656c 656d 656e 7473 206f  array elements o
+00015330: 7665 7220 7468 6520 6769 7665 6e20 6178  ver the given ax
+00015340: 6973 0a0a 2020 2020 2020 2020 5265 6665  is..        Refe
+00015350: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
+00015360: 2e61 7272 6179 2e70 726f 6460 2066 6f72  .array.prod` for
+00015370: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
+00015380: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
+00015390: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+000153a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000153b0: 6461 736b 2e61 7272 6179 2e70 726f 6420  dask.array.prod 
+000153c0: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
+000153d0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+000153e0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+000153f0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
+00015400: 696f 6e73 2069 6d70 6f72 7420 7072 6f64  ions import prod
+00015410: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00015420: 2070 726f 6428 0a20 2020 2020 2020 2020   prod(.         
+00015430: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00015440: 2020 2020 2061 7869 733d 6178 6973 2c0a       axis=axis,.
+00015450: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00015460: 653d 6474 7970 652c 0a20 2020 2020 2020  e=dtype,.       
+00015470: 2020 2020 206b 6565 7064 696d 733d 6b65       keepdims=ke
+00015480: 6570 6469 6d73 2c0a 2020 2020 2020 2020  epdims,.        
+00015490: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
+000154a0: 7370 6c69 745f 6576 6572 792c 0a20 2020  split_every,.   
+000154b0: 2020 2020 2020 2020 206f 7574 3d6f 7574           out=out
+000154c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000154d0: 2064 6566 206d 6561 6e28 7365 6c66 2c20   def mean(self, 
+000154e0: 6178 6973 3d4e 6f6e 652c 2064 7479 7065  axis=None, dtype
+000154f0: 3d4e 6f6e 652c 206b 6565 7064 696d 733d  =None, keepdims=
+00015500: 4661 6c73 652c 2073 706c 6974 5f65 7665  False, split_eve
+00015510: 7279 3d4e 6f6e 652c 206f 7574 3d4e 6f6e  ry=None, out=Non
+00015520: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
+00015530: 6574 7572 6e73 2074 6865 2061 7665 7261  eturns the avera
+00015540: 6765 206f 6620 7468 6520 6172 7261 7920  ge of the array 
+00015550: 656c 656d 656e 7473 2061 6c6f 6e67 2067  elements along g
+00015560: 6976 656e 2061 7869 732e 0a0a 2020 2020  iven axis...    
+00015570: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+00015580: 6e63 3a60 6461 736b 2e61 7272 6179 2e6d  nc:`dask.array.m
+00015590: 6561 6e60 2066 6f72 2066 756c 6c20 646f  ean` for full do
+000155a0: 6375 6d65 6e74 6174 696f 6e2e 0a0a 2020  cumentation...  
+000155b0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+000155c0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+000155d0: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
+000155e0: 6179 2e6d 6561 6e20 3a20 6571 7569 7661  ay.mean : equiva
+000155f0: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+00015600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00015610: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00015620: 792e 7265 6475 6374 696f 6e73 2069 6d70  y.reductions imp
+00015630: 6f72 7420 6d65 616e 0a0a 2020 2020 2020  ort mean..      
+00015640: 2020 7265 7475 726e 206d 6561 6e28 0a20    return mean(. 
+00015650: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00015660: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
+00015670: 733d 6178 6973 2c0a 2020 2020 2020 2020  s=axis,.        
+00015680: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
+00015690: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+000156a0: 7064 696d 733d 6b65 6570 6469 6d73 2c0a  pdims=keepdims,.
+000156b0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+000156c0: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
+000156d0: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
+000156e0: 206f 7574 3d6f 7574 2c0a 2020 2020 2020   out=out,.      
+000156f0: 2020 290a 0a20 2020 2064 6566 2073 7464    )..    def std
+00015700: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00015710: 6178 6973 3d4e 6f6e 652c 2064 7479 7065  axis=None, dtype
+00015720: 3d4e 6f6e 652c 206b 6565 7064 696d 733d  =None, keepdims=
+00015730: 4661 6c73 652c 2064 646f 663d 302c 2073  False, ddof=0, s
+00015740: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
+00015750: 206f 7574 3d4e 6f6e 650a 2020 2020 293a   out=None.    ):
+00015760: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00015770: 726e 7320 7468 6520 7374 616e 6461 7264  rns the standard
+00015780: 2064 6576 6961 7469 6f6e 206f 6620 7468   deviation of th
+00015790: 6520 6172 7261 7920 656c 656d 656e 7473  e array elements
+000157a0: 2061 6c6f 6e67 2067 6976 656e 2061 7869   along given axi
+000157b0: 732e 0a0a 2020 2020 2020 2020 5265 6665  s...        Refe
+000157c0: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
+000157d0: 2e61 7272 6179 2e73 7464 6020 666f 7220  .array.std` for 
+000157e0: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
+000157f0: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
+00015800: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00015810: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00015820: 6173 6b2e 6172 7261 792e 7374 6420 3a20  ask.array.std : 
+00015830: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
+00015840: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00015850: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00015860: 6b2e 6172 7261 792e 7265 6475 6374 696f  k.array.reductio
+00015870: 6e73 2069 6d70 6f72 7420 7374 640a 0a20  ns import std.. 
+00015880: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00015890: 6428 0a20 2020 2020 2020 2020 2020 2073  d(.            s
+000158a0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+000158b0: 2061 7869 733d 6178 6973 2c0a 2020 2020   axis=axis,.    
+000158c0: 2020 2020 2020 2020 6474 7970 653d 6474          dtype=dt
+000158d0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+000158e0: 206b 6565 7064 696d 733d 6b65 6570 6469   keepdims=keepdi
+000158f0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+00015900: 6464 6f66 3d64 646f 662c 0a20 2020 2020  ddof=ddof,.     
+00015910: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
+00015920: 7279 3d73 706c 6974 5f65 7665 7279 2c0a  ry=split_every,.
+00015930: 2020 2020 2020 2020 2020 2020 6f75 743d              out=
+00015940: 6f75 742c 0a20 2020 2020 2020 2029 0a0a  out,.        )..
+00015950: 2020 2020 6465 6620 7661 7228 0a20 2020      def var(.   
+00015960: 2020 2020 2073 656c 662c 2061 7869 733d       self, axis=
+00015970: 4e6f 6e65 2c20 6474 7970 653d 4e6f 6e65  None, dtype=None
+00015980: 2c20 6b65 6570 6469 6d73 3d46 616c 7365  , keepdims=False
+00015990: 2c20 6464 6f66 3d30 2c20 7370 6c69 745f  , ddof=0, split_
+000159a0: 6576 6572 793d 4e6f 6e65 2c20 6f75 743d  every=None, out=
+000159b0: 4e6f 6e65 0a20 2020 2029 3a0a 2020 2020  None.    ):.    
+000159c0: 2020 2020 2222 2252 6574 7572 6e73 2074      """Returns t
+000159d0: 6865 2076 6172 6961 6e63 6520 6f66 2074  he variance of t
+000159e0: 6865 2061 7272 6179 2065 6c65 6d65 6e74  he array element
+000159f0: 732c 2061 6c6f 6e67 2067 6976 656e 2061  s, along given a
+00015a00: 7869 732e 0a0a 2020 2020 2020 2020 5265  xis...        Re
+00015a10: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00015a20: 736b 2e61 7272 6179 2e76 6172 6020 666f  sk.array.var` fo
+00015a30: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00015a40: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00015a50: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00015a60: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00015a70: 2064 6173 6b2e 6172 7261 792e 7661 7220   dask.array.var 
+00015a80: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
+00015a90: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+00015aa0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+00015ab0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
+00015ac0: 696f 6e73 2069 6d70 6f72 7420 7661 720a  ions import var.
+00015ad0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015ae0: 7661 7228 0a20 2020 2020 2020 2020 2020  var(.           
+00015af0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00015b00: 2020 2061 7869 733d 6178 6973 2c0a 2020     axis=axis,.  
+00015b10: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+00015b20: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+00015b30: 2020 206b 6565 7064 696d 733d 6b65 6570     keepdims=keep
+00015b40: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+00015b50: 2020 6464 6f66 3d64 646f 662c 0a20 2020    ddof=ddof,.   
+00015b60: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
+00015b70: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00015b80: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00015b90: 743d 6f75 742c 0a20 2020 2020 2020 2029  t=out,.        )
+00015ba0: 0a0a 2020 2020 6465 6620 6d6f 6d65 6e74  ..    def moment
+00015bb0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00015bc0: 2020 2020 2020 2020 6f72 6465 722c 0a20          order,. 
+00015bd0: 2020 2020 2020 2061 7869 733d 4e6f 6e65         axis=None
+00015be0: 2c0a 2020 2020 2020 2020 6474 7970 653d  ,.        dtype=
+00015bf0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6b65  None,.        ke
+00015c00: 6570 6469 6d73 3d46 616c 7365 2c0a 2020  epdims=False,.  
+00015c10: 2020 2020 2020 6464 6f66 3d30 2c0a 2020        ddof=0,.  
+00015c20: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
+00015c30: 793d 4e6f 6e65 2c0a 2020 2020 2020 2020  y=None,.        
+00015c40: 6f75 743d 4e6f 6e65 2c0a 2020 2020 293a  out=None,.    ):
+00015c50: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
+00015c60: 756c 6174 6520 7468 6520 6e74 6820 6365  ulate the nth ce
+00015c70: 6e74 7261 6c69 7a65 6420 6d6f 6d65 6e74  ntralized moment
+00015c80: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
+00015c90: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
+00015ca0: 6172 7261 792e 6d6f 6d65 6e74 6020 666f  array.moment` fo
+00015cb0: 7220 7468 6520 6675 6c6c 2064 6f63 756d  r the full docum
+00015cc0: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+00015cd0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00015ce0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00015cf0: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
+00015d00: 6d6f 6d65 6e74 203a 2065 7175 6976 616c  moment : equival
+00015d10: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
+00015d20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015d30: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00015d40: 2e72 6564 7563 7469 6f6e 7320 696d 706f  .reductions impo
+00015d50: 7274 206d 6f6d 656e 740a 0a20 2020 2020  rt moment..     
+00015d60: 2020 2072 6574 7572 6e20 6d6f 6d65 6e74     return moment
+00015d70: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00015d80: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00015d90: 6f72 6465 722c 0a20 2020 2020 2020 2020  order,.         
+00015da0: 2020 2061 7869 733d 6178 6973 2c0a 2020     axis=axis,.  
+00015db0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+00015dc0: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+00015dd0: 2020 206b 6565 7064 696d 733d 6b65 6570     keepdims=keep
+00015de0: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+00015df0: 2020 6464 6f66 3d64 646f 662c 0a20 2020    ddof=ddof,.   
+00015e00: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
+00015e10: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00015e20: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00015e30: 743d 6f75 742c 0a20 2020 2020 2020 2029  t=out,.        )
+00015e40: 0a0a 2020 2020 4077 7261 7073 286d 6170  ..    @wraps(map
+00015e50: 5f62 6c6f 636b 7329 0a20 2020 2064 6566  _blocks).    def
+00015e60: 206d 6170 5f62 6c6f 636b 7328 7365 6c66   map_blocks(self
+00015e70: 2c20 6675 6e63 2c20 2a61 7267 732c 202a  , func, *args, *
+00015e80: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00015e90: 2020 7265 7475 726e 206d 6170 5f62 6c6f    return map_blo
+00015ea0: 636b 7328 6675 6e63 2c20 7365 6c66 2c20  cks(func, self, 
+00015eb0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00015ec0: 0a0a 2020 2020 6465 6620 6d61 705f 6f76  ..    def map_ov
+00015ed0: 6572 6c61 7028 7365 6c66 2c20 6675 6e63  erlap(self, func
+00015ee0: 2c20 6465 7074 682c 2062 6f75 6e64 6172  , depth, boundar
+00015ef0: 793d 4e6f 6e65 2c20 7472 696d 3d54 7275  y=None, trim=Tru
+00015f00: 652c 202a 2a6b 7761 7267 7329 3a0a 2020  e, **kwargs):.  
+00015f10: 2020 2020 2020 2222 224d 6170 2061 2066        """Map a f
+00015f20: 756e 6374 696f 6e20 6f76 6572 2062 6c6f  unction over blo
+00015f30: 636b 7320 6f66 2074 6865 2061 7272 6179  cks of the array
+00015f40: 2077 6974 6820 736f 6d65 206f 7665 726c   with some overl
+00015f50: 6170 0a0a 2020 2020 2020 2020 5265 6665  ap..        Refe
+00015f60: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
+00015f70: 2e61 7272 6179 2e6d 6170 5f6f 7665 726c  .array.map_overl
+00015f80: 6170 6020 666f 7220 6675 6c6c 2064 6f63  ap` for full doc
+00015f90: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00015fa0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00015fb0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00015fc0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+00015fd0: 792e 6d61 705f 6f76 6572 6c61 7020 3a20  y.map_overlap : 
+00015fe0: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
+00015ff0: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00016000: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00016010: 6b2e 6172 7261 792e 6f76 6572 6c61 7020  k.array.overlap 
+00016020: 696d 706f 7274 206d 6170 5f6f 7665 726c  import map_overl
+00016030: 6170 0a0a 2020 2020 2020 2020 7265 7475  ap..        retu
+00016040: 726e 206d 6170 5f6f 7665 726c 6170 280a  rn map_overlap(.
+00016050: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00016060: 2c20 7365 6c66 2c20 6465 7074 683d 6465  , self, depth=de
+00016070: 7074 682c 2062 6f75 6e64 6172 793d 626f  pth, boundary=bo
+00016080: 756e 6461 7279 2c20 7472 696d 3d74 7269  undary, trim=tri
+00016090: 6d2c 202a 2a6b 7761 7267 730a 2020 2020  m, **kwargs.    
+000160a0: 2020 2020 290a 0a20 2020 2064 6566 2063      )..    def c
+000160b0: 756d 7375 6d28 7365 6c66 2c20 6178 6973  umsum(self, axis
+000160c0: 2c20 6474 7970 653d 4e6f 6e65 2c20 6f75  , dtype=None, ou
+000160d0: 743d 4e6f 6e65 2c20 2a2c 206d 6574 686f  t=None, *, metho
+000160e0: 643d 2273 6571 7565 6e74 6961 6c22 293a  d="sequential"):
+000160f0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00016100: 726e 2074 6865 2063 756d 756c 6174 6976  rn the cumulativ
+00016110: 6520 7375 6d20 6f66 2074 6865 2065 6c65  e sum of the ele
+00016120: 6d65 6e74 7320 616c 6f6e 6720 7468 6520  ments along the 
+00016130: 6769 7665 6e20 6178 6973 2e0a 0a20 2020  given axis...   
+00016140: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
+00016150: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
+00016160: 6375 6d73 756d 6020 666f 7220 6675 6c6c  cumsum` for full
+00016170: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00016180: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00016190: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+000161a0: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+000161b0: 6172 7261 792e 6375 6d73 756d 203a 2065  array.cumsum : e
+000161c0: 7175 6976 616c 656e 7420 6675 6e63 7469  quivalent functi
+000161d0: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
+000161e0: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+000161f0: 2e61 7272 6179 2e72 6564 7563 7469 6f6e  .array.reduction
+00016200: 7320 696d 706f 7274 2063 756d 7375 6d0a  s import cumsum.
+00016210: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016220: 6375 6d73 756d 2873 656c 662c 2061 7869  cumsum(self, axi
+00016230: 732c 2064 7479 7065 2c20 6f75 743d 6f75  s, dtype, out=ou
+00016240: 742c 206d 6574 686f 643d 6d65 7468 6f64  t, method=method
+00016250: 290a 0a20 2020 2064 6566 2063 756d 7072  )..    def cumpr
+00016260: 6f64 2873 656c 662c 2061 7869 732c 2064  od(self, axis, d
+00016270: 7479 7065 3d4e 6f6e 652c 206f 7574 3d4e  type=None, out=N
+00016280: 6f6e 652c 202a 2c20 6d65 7468 6f64 3d22  one, *, method="
+00016290: 7365 7175 656e 7469 616c 2229 3a0a 2020  sequential"):.  
+000162a0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+000162b0: 7468 6520 6375 6d75 6c61 7469 7665 2070  the cumulative p
+000162c0: 726f 6475 6374 206f 6620 7468 6520 656c  roduct of the el
+000162d0: 656d 656e 7473 2061 6c6f 6e67 2074 6865  ements along the
+000162e0: 2067 6976 656e 2061 7869 732e 0a0a 2020   given axis...  
+000162f0: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+00016300: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00016310: 2e63 756d 7072 6f64 6020 666f 7220 6675  .cumprod` for fu
+00016320: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
+00016330: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+00016340: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00016350: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+00016360: 6b2e 6172 7261 792e 6375 6d70 726f 6420  k.array.cumprod 
+00016370: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
+00016380: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+00016390: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+000163a0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
+000163b0: 696f 6e73 2069 6d70 6f72 7420 6375 6d70  ions import cump
+000163c0: 726f 640a 0a20 2020 2020 2020 2072 6574  rod..        ret
+000163d0: 7572 6e20 6375 6d70 726f 6428 7365 6c66  urn cumprod(self
+000163e0: 2c20 6178 6973 2c20 6474 7970 652c 206f  , axis, dtype, o
+000163f0: 7574 3d6f 7574 2c20 6d65 7468 6f64 3d6d  ut=out, method=m
+00016400: 6574 686f 6429 0a0a 2020 2020 6465 6620  ethod)..    def 
+00016410: 7371 7565 657a 6528 7365 6c66 2c20 6178  squeeze(self, ax
+00016420: 6973 3d4e 6f6e 6529 3a0a 2020 2020 2020  is=None):.      
+00016430: 2020 2222 2252 656d 6f76 6520 6178 6573    """Remove axes
+00016440: 206f 6620 6c65 6e67 7468 206f 6e65 2066   of length one f
+00016450: 726f 6d20 6172 7261 792e 0a0a 2020 2020  rom array...    
+00016460: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+00016470: 6e63 3a60 6461 736b 2e61 7272 6179 2e73  nc:`dask.array.s
+00016480: 7175 6565 7a65 6020 666f 7220 6675 6c6c  queeze` for full
+00016490: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+000164a0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+000164b0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+000164c0: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+000164d0: 6172 7261 792e 7371 7565 657a 6520 3a20  array.squeeze : 
+000164e0: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
+000164f0: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00016500: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00016510: 6b2e 6172 7261 792e 726f 7574 696e 6573  k.array.routines
+00016520: 2069 6d70 6f72 7420 7371 7565 657a 650a   import squeeze.
+00016530: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016540: 7371 7565 657a 6528 7365 6c66 2c20 6178  squeeze(self, ax
+00016550: 6973 290a 0a20 2020 2064 6566 2072 6563  is)..    def rec
+00016560: 6875 6e6b 280a 2020 2020 2020 2020 7365  hunk(.        se
+00016570: 6c66 2c0a 2020 2020 2020 2020 6368 756e  lf,.        chun
+00016580: 6b73 3d22 6175 746f 222c 0a20 2020 2020  ks="auto",.     
+00016590: 2020 2074 6872 6573 686f 6c64 3d4e 6f6e     threshold=Non
+000165a0: 652c 0a20 2020 2020 2020 2062 6c6f 636b  e,.        block
+000165b0: 5f73 697a 655f 6c69 6d69 743d 4e6f 6e65  _size_limit=None
+000165c0: 2c0a 2020 2020 2020 2020 6261 6c61 6e63  ,.        balanc
+000165d0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+000165e0: 206d 6574 686f 643d 4e6f 6e65 2c0a 2020   method=None,.  
+000165f0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00016600: 436f 6e76 6572 7420 626c 6f63 6b73 2069  Convert blocks i
+00016610: 6e20 6461 736b 2061 7272 6179 2078 2066  n dask array x f
+00016620: 6f72 206e 6577 2063 6875 6e6b 732e 0a0a  or new chunks...
+00016630: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+00016640: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
+00016650: 6179 2e72 6563 6875 6e6b 6020 666f 7220  ay.rechunk` for 
+00016660: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
+00016670: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
+00016680: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00016690: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+000166a0: 6173 6b2e 6172 7261 792e 7265 6368 756e  ask.array.rechun
+000166b0: 6b20 3a20 6571 7569 7661 6c65 6e74 2066  k : equivalent f
+000166c0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+000166d0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+000166e0: 2064 6173 6b2e 6172 7261 792e 7265 6368   dask.array.rech
+000166f0: 756e 6b20 696d 706f 7274 2072 6563 6875  unk import rechu
+00016700: 6e6b 2020 2320 6176 6f69 6420 6369 7263  nk  # avoid circ
+00016710: 756c 6172 2069 6d70 6f72 740a 0a20 2020  ular import..   
+00016720: 2020 2020 2072 6574 7572 6e20 7265 6368       return rech
+00016730: 756e 6b28 7365 6c66 2c20 6368 756e 6b73  unk(self, chunks
+00016740: 2c20 7468 7265 7368 6f6c 642c 2062 6c6f  , threshold, blo
+00016750: 636b 5f73 697a 655f 6c69 6d69 742c 2062  ck_size_limit, b
+00016760: 616c 616e 6365 2c20 6d65 7468 6f64 290a  alance, method).
+00016770: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00016780: 2020 2064 6566 2072 6561 6c28 7365 6c66     def real(self
+00016790: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+000167a0: 6461 736b 2e61 7272 6179 2e75 6675 6e63  dask.array.ufunc
+000167b0: 2069 6d70 6f72 7420 7265 616c 0a0a 2020   import real..  
+000167c0: 2020 2020 2020 7265 7475 726e 2072 6561        return rea
+000167d0: 6c28 7365 6c66 290a 0a20 2020 2040 7072  l(self)..    @pr
+000167e0: 6f70 6572 7479 0a20 2020 2064 6566 2069  operty.    def i
+000167f0: 6d61 6728 7365 6c66 293a 0a20 2020 2020  mag(self):.     
+00016800: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
+00016810: 6179 2e75 6675 6e63 2069 6d70 6f72 7420  ay.ufunc import 
+00016820: 696d 6167 0a0a 2020 2020 2020 2020 7265  imag..        re
+00016830: 7475 726e 2069 6d61 6728 7365 6c66 290a  turn imag(self).
+00016840: 0a20 2020 2064 6566 2063 6f6e 6a28 7365  .    def conj(se
+00016850: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00016860: 436f 6d70 6c65 782d 636f 6e6a 7567 6174  Complex-conjugat
+00016870: 6520 616c 6c20 656c 656d 656e 7473 2e0a  e all elements..
+00016880: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
+00016890: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
+000168a0: 7261 792e 636f 6e6a 6020 666f 7220 6675  ray.conj` for fu
+000168b0: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
+000168c0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+000168d0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+000168e0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+000168f0: 6b2e 6172 7261 792e 636f 6e6a 203a 2065  k.array.conj : e
+00016900: 7175 6976 616c 656e 7420 6675 6e63 7469  quivalent functi
+00016910: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
+00016920: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+00016930: 2e61 7272 6179 2e75 6675 6e63 2069 6d70  .array.ufunc imp
+00016940: 6f72 7420 636f 6e6a 0a0a 2020 2020 2020  ort conj..      
+00016950: 2020 7265 7475 726e 2063 6f6e 6a28 7365    return conj(se
+00016960: 6c66 290a 0a20 2020 2064 6566 2063 6c69  lf)..    def cli
+00016970: 7028 7365 6c66 2c20 6d69 6e3d 4e6f 6e65  p(self, min=None
+00016980: 2c20 6d61 783d 4e6f 6e65 293a 0a20 2020  , max=None):.   
+00016990: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
+000169a0: 6e20 6172 7261 7920 7768 6f73 6520 7661  n array whose va
+000169b0: 6c75 6573 2061 7265 206c 696d 6974 6564  lues are limited
+000169c0: 2074 6f20 6060 5b6d 696e 2c20 6d61 785d   to ``[min, max]
+000169d0: 6060 2e0a 2020 2020 2020 2020 4f6e 6520  ``..        One 
+000169e0: 6f66 206d 6178 206f 7220 6d69 6e20 6d75  of max or min mu
+000169f0: 7374 2062 6520 6769 7665 6e2e 0a0a 2020  st be given...  
+00016a00: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+00016a10: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00016a20: 2e63 6c69 7060 2066 6f72 2066 756c 6c20  .clip` for full 
+00016a30: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+00016a40: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00016a50: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00016a60: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00016a70: 7272 6179 2e63 6c69 7020 3a20 6571 7569  rray.clip : equi
+00016a80: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00016a90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00016aa0: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00016ab0: 7261 792e 7566 756e 6320 696d 706f 7274  ray.ufunc import
+00016ac0: 2063 6c69 700a 0a20 2020 2020 2020 2072   clip..        r
+00016ad0: 6574 7572 6e20 636c 6970 2873 656c 662c  eturn clip(self,
+00016ae0: 206d 696e 2c20 6d61 7829 0a0a 2020 2020   min, max)..    
+00016af0: 6465 6620 7669 6577 2873 656c 662c 2064  def view(self, d
+00016b00: 7479 7065 3d4e 6f6e 652c 206f 7264 6572  type=None, order
+00016b10: 3d22 4322 293a 0a20 2020 2020 2020 2022  ="C"):.        "
+00016b20: 2222 4765 7420 6120 7669 6577 206f 6620  ""Get a view of 
+00016b30: 7468 6520 6172 7261 7920 6173 2061 206e  the array as a n
+00016b40: 6577 2064 6174 6120 7479 7065 0a0a 2020  ew data type..  
+00016b50: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00016b60: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00016b70: 2d2d 2d0a 2020 2020 2020 2020 6474 7970  ---.        dtyp
+00016b80: 653a 0a20 2020 2020 2020 2020 2020 2054  e:.            T
+00016b90: 6865 2064 7479 7065 2062 7920 7768 6963  he dtype by whic
+00016ba0: 6820 746f 2076 6965 7720 7468 6520 6172  h to view the ar
+00016bb0: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
+00016bc0: 2054 6865 2064 6566 6175 6c74 2c20 4e6f   The default, No
+00016bd0: 6e65 2c20 7265 7375 6c74 7320 696e 2074  ne, results in t
+00016be0: 6865 2076 6965 7720 6861 7669 6e67 2074  he view having t
+00016bf0: 6865 2073 616d 6520 6461 7461 2d74 7970  he same data-typ
+00016c00: 650a 2020 2020 2020 2020 2020 2020 6173  e.            as
+00016c10: 2074 6865 206f 7269 6769 6e61 6c20 6172   the original ar
+00016c20: 7261 792e 0a20 2020 2020 2020 206f 7264  ray..        ord
+00016c30: 6572 3a20 7374 7269 6e67 0a20 2020 2020  er: string.     
+00016c40: 2020 2020 2020 2027 4327 206f 7220 2746         'C' or 'F
+00016c50: 2720 2846 6f72 7472 616e 2920 6f72 6465  ' (Fortran) orde
+00016c60: 7269 6e67 0a0a 2020 2020 2020 2020 5468  ring..        Th
+00016c70: 6973 2072 6569 6e74 6572 7072 6574 7320  is reinterprets 
+00016c80: 7468 6520 6279 7465 7320 6f66 2074 6865  the bytes of the
+00016c90: 2061 7272 6179 2075 6e64 6572 2061 206e   array under a n
+00016ca0: 6577 2064 7479 7065 2e20 2049 6620 7468  ew dtype.  If th
+00016cb0: 6174 0a20 2020 2020 2020 2064 7479 7065  at.        dtype
+00016cc0: 2064 6f65 7320 6e6f 7420 6861 7665 2074   does not have t
+00016cd0: 6865 2073 616d 6520 7369 7a65 2061 7320  he same size as 
+00016ce0: 7468 6520 6f72 6967 696e 616c 2061 7272  the original arr
+00016cf0: 6179 2074 6865 6e20 7468 6520 7368 6170  ay then the shap
+00016d00: 650a 2020 2020 2020 2020 7769 6c6c 2063  e.        will c
+00016d10: 6861 6e67 652e 0a0a 2020 2020 2020 2020  hange...        
+00016d20: 4265 7761 7265 2074 6861 7420 626f 7468  Beware that both
+00016d30: 206e 756d 7079 2061 6e64 2064 6173 6b2e   numpy and dask.
+00016d40: 6172 7261 7920 6361 6e20 6265 6861 7665  array can behave
+00016d50: 206f 6464 6c79 2077 6865 6e20 7461 6b69   oddly when taki
+00016d60: 6e67 0a20 2020 2020 2020 2073 6861 7065  ng.        shape
+00016d70: 2d63 6861 6e67 696e 6720 7669 6577 7320  -changing views 
+00016d80: 6f66 2061 7272 6179 7320 756e 6465 7220  of arrays under 
+00016d90: 466f 7274 7261 6e20 6f72 6465 7269 6e67  Fortran ordering
+00016da0: 2e20 2055 6e64 6572 2073 6f6d 650a 2020  .  Under some.  
+00016db0: 2020 2020 2020 7665 7273 696f 6e73 206f        versions o
+00016dc0: 6620 4e75 6d50 7920 7468 6973 2066 756e  f NumPy this fun
+00016dd0: 6374 696f 6e20 7769 6c6c 2066 6169 6c20  ction will fail 
+00016de0: 7768 656e 2074 616b 696e 6720 7368 6170  when taking shap
+00016df0: 652d 6368 616e 6769 6e67 0a20 2020 2020  e-changing.     
+00016e00: 2020 2076 6965 7773 206f 6620 466f 7274     views of Fort
+00016e10: 7261 6e20 6f72 6465 7265 6420 6172 7261  ran ordered arra
+00016e20: 7973 2069 6620 7468 6520 6669 7273 7420  ys if the first 
+00016e30: 6469 6d65 6e73 696f 6e20 6861 7320 6368  dimension has ch
+00016e40: 756e 6b73 206f 660a 2020 2020 2020 2020  unks of.        
+00016e50: 7369 7a65 206f 6e65 2e0a 2020 2020 2020  size one..      
+00016e60: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00016e70: 2064 7479 7065 2069 7320 4e6f 6e65 3a0a   dtype is None:.
+00016e80: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00016e90: 6520 3d20 7365 6c66 2e64 7479 7065 0a20  e = self.dtype. 
+00016ea0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016eb0: 2020 2020 2020 2020 2064 7479 7065 203d           dtype =
+00016ec0: 206e 702e 6474 7970 6528 6474 7970 6529   np.dtype(dtype)
+00016ed0: 0a20 2020 2020 2020 206d 756c 7420 3d20  .        mult = 
+00016ee0: 7365 6c66 2e64 7479 7065 2e69 7465 6d73  self.dtype.items
+00016ef0: 697a 6520 2f20 6474 7970 652e 6974 656d  ize / dtype.item
+00016f00: 7369 7a65 0a0a 2020 2020 2020 2020 6966  size..        if
+00016f10: 206f 7264 6572 203d 3d20 2243 223a 0a20   order == "C":. 
+00016f20: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00016f30: 7320 3d20 7365 6c66 2e63 6875 6e6b 735b  s = self.chunks[
+00016f40: 3a2d 315d 202b 2028 0a20 2020 2020 2020  :-1] + (.       
+00016f50: 2020 2020 2020 2020 2074 7570 6c65 2865           tuple(e
+00016f60: 6e73 7572 655f 696e 7428 6320 2a20 6d75  nsure_int(c * mu
+00016f70: 6c74 2920 666f 7220 6320 696e 2073 656c  lt) for c in sel
+00016f80: 662e 6368 756e 6b73 5b2d 315d 292c 0a20  f.chunks[-1]),. 
+00016f90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00016fa0: 2020 2020 2065 6c69 6620 6f72 6465 7220       elif order 
+00016fb0: 3d3d 2022 4622 3a0a 2020 2020 2020 2020  == "F":.        
+00016fc0: 2020 2020 6368 756e 6b73 203d 2028 0a20      chunks = (. 
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00016fe0: 7570 6c65 2865 6e73 7572 655f 696e 7428  uple(ensure_int(
+00016ff0: 6320 2a20 6d75 6c74 2920 666f 7220 6320  c * mult) for c 
+00017000: 696e 2073 656c 662e 6368 756e 6b73 5b30  in self.chunks[0
+00017010: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+00017020: 2920 2b20 7365 6c66 2e63 6875 6e6b 735b  ) + self.chunks[
+00017030: 313a 5d0a 2020 2020 2020 2020 656c 7365  1:].        else
+00017040: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00017050: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00017060: 4f72 6465 7220 6d75 7374 2062 6520 6f6e  Order must be on
+00017070: 6520 6f66 2027 4327 206f 7220 2746 2722  e of 'C' or 'F'"
+00017080: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00017090: 6e20 7365 6c66 2e6d 6170 5f62 6c6f 636b  n self.map_block
+000170a0: 7328 0a20 2020 2020 2020 2020 2020 2063  s(.            c
+000170b0: 6875 6e6b 2e76 6965 772c 2064 7479 7065  hunk.view, dtype
+000170c0: 2c20 6f72 6465 723d 6f72 6465 722c 2064  , order=order, d
+000170d0: 7479 7065 3d64 7479 7065 2c20 6368 756e  type=dtype, chun
+000170e0: 6b73 3d63 6875 6e6b 730a 2020 2020 2020  ks=chunks.      
+000170f0: 2020 290a 0a20 2020 2064 6566 2073 7761    )..    def swa
+00017100: 7061 7865 7328 7365 6c66 2c20 6178 6973  paxes(self, axis
+00017110: 312c 2061 7869 7332 293a 0a20 2020 2020  1, axis2):.     
+00017120: 2020 2022 2222 5265 7475 726e 2061 2076     """Return a v
+00017130: 6965 7720 6f66 2074 6865 2061 7272 6179  iew of the array
+00017140: 2077 6974 6820 6060 6178 6973 3160 6020   with ``axis1`` 
+00017150: 616e 6420 6060 6178 6973 3260 6020 696e  and ``axis2`` in
+00017160: 7465 7263 6861 6e67 6564 2e0a 0a20 2020  terchanged...   
+00017170: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
+00017180: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
+00017190: 7377 6170 6178 6573 6020 666f 7220 6675  swapaxes` for fu
+000171a0: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
+000171b0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
+000171c0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+000171d0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+000171e0: 6b2e 6172 7261 792e 7377 6170 6178 6573  k.array.swapaxes
+000171f0: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
+00017200: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
+00017210: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00017220: 6461 736b 2e61 7272 6179 2e72 6f75 7469  dask.array.routi
+00017230: 6e65 7320 696d 706f 7274 2073 7761 7061  nes import swapa
+00017240: 7865 730a 0a20 2020 2020 2020 2072 6574  xes..        ret
+00017250: 7572 6e20 7377 6170 6178 6573 2873 656c  urn swapaxes(sel
+00017260: 662c 2061 7869 7331 2c20 6178 6973 3229  f, axis1, axis2)
+00017270: 0a0a 2020 2020 6465 6620 726f 756e 6428  ..    def round(
+00017280: 7365 6c66 2c20 6465 6369 6d61 6c73 3d30  self, decimals=0
+00017290: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+000172a0: 7475 726e 2061 7272 6179 2077 6974 6820  turn array with 
+000172b0: 6561 6368 2065 6c65 6d65 6e74 2072 6f75  each element rou
+000172c0: 6e64 6564 2074 6f20 7468 6520 6769 7665  nded to the give
+000172d0: 6e20 6e75 6d62 6572 206f 6620 6465 6369  n number of deci
+000172e0: 6d61 6c73 2e0a 0a20 2020 2020 2020 2052  mals...        R
+000172f0: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
+00017300: 6173 6b2e 6172 7261 792e 726f 756e 6460  ask.array.round`
+00017310: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00017320: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00017330: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00017340: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00017350: 2020 2020 6461 736b 2e61 7272 6179 2e72      dask.array.r
+00017360: 6f75 6e64 203a 2065 7175 6976 616c 656e  ound : equivalen
+00017370: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
+00017380: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00017390: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
+000173a0: 6f75 7469 6e65 7320 696d 706f 7274 2072  outines import r
+000173b0: 6f75 6e64 0a0a 2020 2020 2020 2020 7265  ound..        re
+000173c0: 7475 726e 2072 6f75 6e64 2873 656c 662c  turn round(self,
+000173d0: 2064 6563 696d 616c 733d 6465 6369 6d61   decimals=decima
+000173e0: 6c73 290a 0a20 2020 2064 6566 2063 6f70  ls)..    def cop
+000173f0: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
+00017400: 2022 2222 0a20 2020 2020 2020 2043 6f70   """.        Cop
+00017410: 7920 6172 7261 792e 2020 5468 6973 2069  y array.  This i
+00017420: 7320 6120 6e6f 2d6f 7020 666f 7220 6461  s a no-op for da
+00017430: 736b 2e61 7272 6179 732c 2077 6869 6368  sk.arrays, which
+00017440: 2061 7265 2069 6d6d 7574 6162 6c65 0a20   are immutable. 
+00017450: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00017460: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
+00017470: 7365 6c66 2e64 6173 6b2c 2073 656c 662e  self.dask, self.
+00017480: 6e61 6d65 2c20 7365 6c66 2e63 6875 6e6b  name, self.chunk
+00017490: 732c 206d 6574 613d 7365 6c66 290a 0a20  s, meta=self).. 
+000174a0: 2020 2064 6566 205f 5f64 6565 7063 6f70     def __deepcop
+000174b0: 795f 5f28 7365 6c66 2c20 6d65 6d6f 293a  y__(self, memo):
+000174c0: 0a20 2020 2020 2020 2063 203d 2073 656c  .        c = sel
+000174d0: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+000174e0: 206d 656d 6f5b 6964 2873 656c 6629 5d20   memo[id(self)] 
+000174f0: 3d20 630a 2020 2020 2020 2020 7265 7475  = c.        retu
+00017500: 726e 2063 0a0a 2020 2020 6465 6620 746f  rn c..    def to
+00017510: 5f64 656c 6179 6564 2873 656c 662c 206f  _delayed(self, o
+00017520: 7074 696d 697a 655f 6772 6170 683d 5472  ptimize_graph=Tr
+00017530: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+00017540: 436f 6e76 6572 7420 696e 746f 2061 6e20  Convert into an 
+00017550: 6172 7261 7920 6f66 203a 636c 6173 733a  array of :class:
+00017560: 6064 6173 6b2e 6465 6c61 7965 642e 4465  `dask.delayed.De
+00017570: 6c61 7965 6460 206f 626a 6563 7473 2c20  layed` objects, 
+00017580: 6f6e 6520 7065 7220 6368 756e 6b2e 0a0a  one per chunk...
+00017590: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000175a0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000175b0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f70  -----.        op
+000175c0: 7469 6d69 7a65 5f67 7261 7068 203a 2062  timize_graph : b
+000175d0: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+000175e0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+000175f0: 6520 5b64 6566 6175 6c74 5d2c 2074 6865  e [default], the
+00017600: 2067 7261 7068 2069 7320 6f70 7469 6d69   graph is optimi
+00017610: 7a65 6420 6265 666f 7265 2063 6f6e 7665  zed before conve
+00017620: 7274 696e 6720 696e 746f 0a20 2020 2020  rting into.     
+00017630: 2020 2020 2020 203a 636c 6173 733a 6064         :class:`d
+00017640: 6173 6b2e 6465 6c61 7965 642e 4465 6c61  ask.delayed.Dela
+00017650: 7965 6460 206f 626a 6563 7473 2e0a 0a20  yed` objects... 
+00017660: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00017670: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00017680: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+00017690: 7261 792e 6672 6f6d 5f64 656c 6179 6564  ray.from_delayed
+000176a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000176b0: 2020 2020 206b 6579 7320 3d20 7365 6c66       keys = self
+000176c0: 2e5f 5f64 6173 6b5f 6b65 7973 5f5f 2829  .__dask_keys__()
+000176d0: 0a20 2020 2020 2020 2067 7261 7068 203d  .        graph =
+000176e0: 2073 656c 662e 5f5f 6461 736b 5f67 7261   self.__dask_gra
+000176f0: 7068 5f5f 2829 0a20 2020 2020 2020 206c  ph__().        l
+00017700: 6179 6572 203d 2073 656c 662e 5f5f 6461  ayer = self.__da
+00017710: 736b 5f6c 6179 6572 735f 5f28 295b 305d  sk_layers__()[0]
+00017720: 0a20 2020 2020 2020 2069 6620 6f70 7469  .        if opti
+00017730: 6d69 7a65 5f67 7261 7068 3a0a 2020 2020  mize_graph:.    
+00017740: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
+00017750: 7365 6c66 2e5f 5f64 6173 6b5f 6f70 7469  self.__dask_opti
+00017760: 6d69 7a65 5f5f 2867 7261 7068 2c20 6b65  mize__(graph, ke
+00017770: 7973 2920 2023 2054 4f44 4f2c 2064 6f6e  ys)  # TODO, don
+00017780: 2774 2063 6f6c 6c61 7065 2067 7261 7068  't collape graph
+00017790: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+000177a0: 6572 203d 2022 6465 6c61 7965 642d 2220  er = "delayed-" 
+000177b0: 2b20 7365 6c66 2e6e 616d 650a 2020 2020  + self.name.    
+000177c0: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
+000177d0: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+000177e0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+000177f0: 6c61 7965 722c 2067 7261 7068 2c20 6465  layer, graph, de
+00017800: 7065 6e64 656e 6369 6573 3d28 2929 0a20  pendencies=()). 
+00017810: 2020 2020 2020 204c 203d 206e 6465 6570         L = ndeep
+00017820: 6d61 7028 7365 6c66 2e6e 6469 6d2c 206c  map(self.ndim, l
+00017830: 616d 6264 6120 6b3a 2044 656c 6179 6564  ambda k: Delayed
+00017840: 286b 2c20 6772 6170 682c 206c 6179 6572  (k, graph, layer
+00017850: 3d6c 6179 6572 292c 206b 6579 7329 0a20  =layer), keys). 
+00017860: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
+00017870: 2e61 7272 6179 284c 2c20 6474 7970 653d  .array(L, dtype=
+00017880: 6f62 6a65 6374 290a 0a20 2020 2064 6566  object)..    def
+00017890: 2072 6570 6561 7428 7365 6c66 2c20 7265   repeat(self, re
+000178a0: 7065 6174 732c 2061 7869 733d 4e6f 6e65  peats, axis=None
+000178b0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+000178c0: 7065 6174 2065 6c65 6d65 6e74 7320 6f66  peat elements of
+000178d0: 2061 6e20 6172 7261 792e 0a0a 2020 2020   an array...    
+000178e0: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+000178f0: 6e63 3a60 6461 736b 2e61 7272 6179 2e72  nc:`dask.array.r
+00017900: 6570 6561 7460 2066 6f72 2066 756c 6c20  epeat` for full 
+00017910: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+00017920: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00017930: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00017940: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00017950: 7272 6179 2e72 6570 6561 7420 3a20 6571  rray.repeat : eq
+00017960: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
+00017970: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00017980: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+00017990: 6172 7261 792e 6372 6561 7469 6f6e 2069  array.creation i
+000179a0: 6d70 6f72 7420 7265 7065 6174 0a0a 2020  mport repeat..  
+000179b0: 2020 2020 2020 7265 7475 726e 2072 6570        return rep
+000179c0: 6561 7428 7365 6c66 2c20 7265 7065 6174  eat(self, repeat
+000179d0: 732c 2061 7869 733d 6178 6973 290a 0a20  s, axis=axis).. 
+000179e0: 2020 2064 6566 206e 6f6e 7a65 726f 2873     def nonzero(s
+000179f0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00017a00: 2252 6574 7572 6e20 7468 6520 696e 6469  "Return the indi
+00017a10: 6365 7320 6f66 2074 6865 2065 6c65 6d65  ces of the eleme
+00017a20: 6e74 7320 7468 6174 2061 7265 206e 6f6e  nts that are non
+00017a30: 2d7a 6572 6f2e 0a0a 2020 2020 2020 2020  -zero...        
+00017a40: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
+00017a50: 6461 736b 2e61 7272 6179 2e6e 6f6e 7a65  dask.array.nonze
+00017a60: 726f 6020 666f 7220 6675 6c6c 2064 6f63  ro` for full doc
+00017a70: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00017a80: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00017a90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00017aa0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+00017ab0: 792e 6e6f 6e7a 6572 6f20 3a20 6571 7569  y.nonzero : equi
+00017ac0: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00017ad0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017ae0: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00017af0: 7261 792e 726f 7574 696e 6573 2069 6d70  ray.routines imp
+00017b00: 6f72 7420 6e6f 6e7a 6572 6f0a 0a20 2020  ort nonzero..   
+00017b10: 2020 2020 2072 6574 7572 6e20 6e6f 6e7a       return nonz
+00017b20: 6572 6f28 7365 6c66 290a 0a20 2020 2064  ero(self)..    d
+00017b30: 6566 2074 6f5f 7a61 7272 2873 656c 662c  ef to_zarr(self,
+00017b40: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
+00017b50: 293a 0a20 2020 2020 2020 2022 2222 5361  ):.        """Sa
+00017b60: 7665 2061 7272 6179 2074 6f20 7468 6520  ve array to the 
+00017b70: 7a61 7272 2073 746f 7261 6765 2066 6f72  zarr storage for
+00017b80: 6d61 740a 0a20 2020 2020 2020 2053 6565  mat..        See
+00017b90: 2068 7474 7073 3a2f 2f7a 6172 722e 7265   https://zarr.re
+00017ba0: 6164 7468 6564 6f63 732e 696f 2066 6f72  adthedocs.io for
+00017bb0: 2064 6574 6169 6c73 2061 626f 7574 2074   details about t
+00017bc0: 6865 2066 6f72 6d61 742e 0a0a 2020 2020  he format...    
+00017bd0: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+00017be0: 6e63 3a60 6461 736b 2e61 7272 6179 2e74  nc:`dask.array.t
+00017bf0: 6f5f 7a61 7272 6020 666f 7220 6675 6c6c  o_zarr` for full
+00017c00: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00017c10: 0a20 2020 2020 2020 2053 6565 2061 6c73  .        See als
+00017c20: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00017c30: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00017c40: 6172 7261 792e 746f 5f7a 6172 7220 3a20  array.to_zarr : 
+00017c50: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
+00017c60: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00017c70: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00017c80: 6f5f 7a61 7272 2873 656c 662c 202a 6172  o_zarr(self, *ar
+00017c90: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
+00017ca0: 2020 2064 6566 2074 6f5f 7469 6c65 6462     def to_tiledb
+00017cb0: 2873 656c 662c 2075 7269 2c20 2a61 7267  (self, uri, *arg
+00017cc0: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
+00017cd0: 2020 2020 2020 2222 2253 6176 6520 6172        """Save ar
+00017ce0: 7261 7920 746f 2074 6865 2054 696c 6544  ray to the TileD
+00017cf0: 4220 7374 6f72 6167 6520 6d61 6e61 6765  B storage manage
+00017d00: 720a 0a20 2020 2020 2020 2053 6565 2068  r..        See h
+00017d10: 7474 7073 3a2f 2f64 6f63 732e 7469 6c65  ttps://docs.tile
+00017d20: 6462 2e69 6f20 666f 7220 6465 7461 696c  db.io for detail
+00017d30: 7320 6162 6f75 7420 7468 6520 666f 726d  s about the form
+00017d40: 6174 2061 6e64 2065 6e67 696e 652e 0a0a  at and engine...
+00017d50: 2020 2020 2020 2020 5365 6520 6675 6e63          See func
+00017d60: 7469 6f6e 203a 6675 6e63 3a60 6461 736b  tion :func:`dask
+00017d70: 2e61 7272 6179 2e74 6f5f 7469 6c65 6462  .array.to_tiledb
+00017d80: 6020 666f 7220 6172 6775 6d65 6e74 2064  ` for argument d
+00017d90: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
+00017da0: 2020 2020 2020 2053 6565 2061 6c73 6f0a         See also.
+00017db0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00017dc0: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+00017dd0: 7261 792e 746f 5f74 696c 6564 6220 3a20  ray.to_tiledb : 
+00017de0: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
+00017df0: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+00017e00: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00017e10: 6b2e 6172 7261 792e 7469 6c65 6462 5f69  k.array.tiledb_i
+00017e20: 6f20 696d 706f 7274 2074 6f5f 7469 6c65  o import to_tile
+00017e30: 6462 0a0a 2020 2020 2020 2020 7265 7475  db..        retu
+00017e40: 726e 2074 6f5f 7469 6c65 6462 2873 656c  rn to_tiledb(sel
+00017e50: 662c 2075 7269 2c20 2a61 7267 732c 202a  f, uri, *args, *
+00017e60: 2a6b 7761 7267 7329 0a0a 0a64 6566 2065  *kwargs)...def e
+00017e70: 6e73 7572 655f 696e 7428 6629 3a0a 2020  nsure_int(f):.  
+00017e80: 2020 6920 3d20 696e 7428 6629 0a20 2020    i = int(f).   
+00017e90: 2069 6620 6920 213d 2066 3a0a 2020 2020   if i != f:.    
+00017ea0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00017eb0: 7272 6f72 2822 436f 756c 6420 6e6f 7420  rror("Could not 
+00017ec0: 636f 6572 6365 2025 6620 746f 2069 6e74  coerce %f to int
+00017ed0: 6567 6572 2220 2520 6629 0a20 2020 2072  eger" % f).    r
+00017ee0: 6574 7572 6e20 690a 0a0a 6465 6620 6e6f  eturn i...def no
+00017ef0: 726d 616c 697a 655f 6368 756e 6b73 2863  rmalize_chunks(c
+00017f00: 6875 6e6b 732c 2073 6861 7065 3d4e 6f6e  hunks, shape=Non
+00017f10: 652c 206c 696d 6974 3d4e 6f6e 652c 2064  e, limit=None, d
+00017f20: 7479 7065 3d4e 6f6e 652c 2070 7265 7669  type=None, previ
+00017f30: 6f75 735f 6368 756e 6b73 3d4e 6f6e 6529  ous_chunks=None)
+00017f40: 3a0a 2020 2020 2222 224e 6f72 6d61 6c69  :.    """Normali
+00017f50: 7a65 2063 6875 6e6b 7320 746f 2074 7570  ze chunks to tup
+00017f60: 6c65 206f 6620 7475 706c 6573 0a0a 2020  le of tuples..  
+00017f70: 2020 5468 6973 2074 616b 6573 2069 6e20    This takes in 
+00017f80: 6120 7661 7269 6574 7920 6f66 2069 6e70  a variety of inp
+00017f90: 7574 2074 7970 6573 2061 6e64 2069 6e66  ut types and inf
+00017fa0: 6f72 6d61 7469 6f6e 2061 6e64 2070 726f  ormation and pro
+00017fb0: 6475 6365 7320 6120 6675 6c6c 0a20 2020  duces a full.   
+00017fc0: 2074 7570 6c65 2d6f 662d 7475 706c 6573   tuple-of-tuples
+00017fd0: 2072 6573 756c 7420 666f 7220 6368 756e   result for chun
+00017fe0: 6b73 2c20 7375 6974 6162 6c65 2074 6f20  ks, suitable to 
+00017ff0: 6265 2070 6173 7365 6420 746f 2041 7272  be passed to Arr
+00018000: 6179 206f 720a 2020 2020 7265 6368 756e  ay or.    rechun
+00018010: 6b20 6f72 2061 6e79 206f 7468 6572 206f  k or any other o
+00018020: 7065 7261 7469 6f6e 2074 6861 7420 6372  peration that cr
+00018030: 6561 7465 7320 6120 4461 736b 2061 7272  eates a Dask arr
+00018040: 6179 2e0a 0a20 2020 2050 6172 616d 6574  ay...    Paramet
+00018050: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00018060: 2d2d 0a20 2020 2063 6875 6e6b 733a 2074  --.    chunks: t
+00018070: 7570 6c65 2c20 696e 742c 2064 6963 742c  uple, int, dict,
+00018080: 206f 7220 7374 7269 6e67 0a20 2020 2020   or string.     
+00018090: 2020 2054 6865 2063 6875 6e6b 7320 746f     The chunks to
+000180a0: 2062 6520 6e6f 726d 616c 697a 6564 2e20   be normalized. 
+000180b0: 2053 6565 2065 7861 6d70 6c65 7320 6265   See examples be
+000180c0: 6c6f 7720 666f 7220 6d6f 7265 2064 6574  low for more det
+000180d0: 6169 6c73 0a20 2020 2073 6861 7065 3a20  ails.    shape: 
+000180e0: 5475 706c 655b 696e 745d 0a20 2020 2020  Tuple[int].     
+000180f0: 2020 2054 6865 2073 6861 7065 206f 6620     The shape of 
+00018100: 7468 6520 6172 7261 790a 2020 2020 6c69  the array.    li
+00018110: 6d69 743a 2069 6e74 2028 6f70 7469 6f6e  mit: int (option
+00018120: 616c 290a 2020 2020 2020 2020 5468 6520  al).        The 
+00018130: 6d61 7869 6d75 6d20 626c 6f63 6b20 7369  maximum block si
+00018140: 7a65 2074 6f20 7461 7267 6574 2069 6e20  ze to target in 
+00018150: 6279 7465 732c 0a20 2020 2020 2020 2069  bytes,.        i
+00018160: 6620 6672 6565 646f 6d20 6973 2067 6976  f freedom is giv
+00018170: 656e 2074 6f20 6368 6f6f 7365 0a20 2020  en to choose.   
+00018180: 2064 7479 7065 3a20 6e70 2e64 7479 7065   dtype: np.dtype
+00018190: 0a20 2020 2070 7265 7669 6f75 735f 6368  .    previous_ch
+000181a0: 756e 6b73 3a20 5475 706c 655b 5475 706c  unks: Tuple[Tupl
+000181b0: 655b 696e 745d 5d20 6f70 7469 6f6e 616c  e[int]] optional
+000181c0: 0a20 2020 2020 2020 2043 6875 6e6b 7320  .        Chunks 
+000181d0: 6672 6f6d 2061 2070 7265 7669 6f75 7320  from a previous 
+000181e0: 6172 7261 7920 7468 6174 2077 6520 7368  array that we sh
+000181f0: 6f75 6c64 2075 7365 2066 6f72 2069 6e73  ould use for ins
+00018200: 7069 7261 7469 6f6e 2077 6865 6e0a 2020  piration when.  
+00018210: 2020 2020 2020 7265 6368 756e 6b69 6e67        rechunking
+00018220: 2061 7574 6f20 6469 6d65 6e73 696f 6e73   auto dimensions
+00018230: 2e20 2049 6620 6e6f 7420 7072 6f76 6964  .  If not provid
+00018240: 6564 2062 7574 2061 7574 6f2d 6368 756e  ed but auto-chun
+00018250: 6b69 6e67 2065 7869 7374 730a 2020 2020  king exists.    
+00018260: 2020 2020 7468 656e 2061 7574 6f2d 6469      then auto-di
+00018270: 6d65 6e73 696f 6e73 2077 696c 6c20 7072  mensions will pr
+00018280: 6566 6572 2073 7175 6172 652d 6c69 6b65  efer square-like
+00018290: 2063 6875 6e6b 2073 6861 7065 732e 0a0a   chunk shapes...
+000182a0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+000182b0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 5370   --------.    Sp
+000182c0: 6563 6966 7920 756e 6966 6f72 6d20 6368  ecify uniform ch
+000182d0: 756e 6b20 7369 7a65 730a 0a20 2020 203e  unk sizes..    >
+000182e0: 3e3e 2066 726f 6d20 6461 736b 2e61 7272  >> from dask.arr
+000182f0: 6179 2e63 6f72 6520 696d 706f 7274 206e  ay.core import n
+00018300: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 730a  ormalize_chunks.
+00018310: 2020 2020 3e3e 3e20 6e6f 726d 616c 697a      >>> normaliz
+00018320: 655f 6368 756e 6b73 2828 322c 2032 292c  e_chunks((2, 2),
+00018330: 2073 6861 7065 3d28 352c 2036 2929 0a20   shape=(5, 6)). 
+00018340: 2020 2028 2832 2c20 322c 2031 292c 2028     ((2, 2, 1), (
+00018350: 322c 2032 2c20 3229 290a 0a20 2020 2041  2, 2, 2))..    A
+00018360: 6c73 6f20 7061 7373 6573 2074 6872 6f75  lso passes throu
+00018370: 6768 2066 756c 6c79 2065 7870 6c69 6369  gh fully explici
+00018380: 7420 7475 706c 652d 6f66 2d74 7570 6c65  t tuple-of-tuple
+00018390: 730a 0a20 2020 203e 3e3e 206e 6f72 6d61  s..    >>> norma
+000183a0: 6c69 7a65 5f63 6875 6e6b 7328 2828 322c  lize_chunks(((2,
+000183b0: 2032 2c20 3129 2c20 2832 2c20 322c 2032   2, 1), (2, 2, 2
+000183c0: 2929 2c20 7368 6170 653d 2835 2c20 3629  )), shape=(5, 6)
+000183d0: 290a 2020 2020 2828 322c 2032 2c20 3129  ).    ((2, 2, 1)
+000183e0: 2c20 2832 2c20 322c 2032 2929 0a0a 2020  , (2, 2, 2))..  
+000183f0: 2020 436c 6561 6e73 2075 7020 6c69 7374    Cleans up list
+00018400: 7320 746f 2074 7570 6c65 730a 0a20 2020  s to tuples..   
+00018410: 203e 3e3e 206e 6f72 6d61 6c69 7a65 5f63   >>> normalize_c
+00018420: 6875 6e6b 7328 5b5b 322c 2032 5d2c 205b  hunks([[2, 2], [
+00018430: 332c 2033 5d5d 290a 2020 2020 2828 322c  3, 3]]).    ((2,
+00018440: 2032 292c 2028 332c 2033 2929 0a0a 2020   2), (3, 3))..  
+00018450: 2020 4578 7061 6e64 7320 696e 7465 6765    Expands intege
+00018460: 7220 696e 7075 7473 2031 3020 2d3e 2028  r inputs 10 -> (
+00018470: 3130 2c20 3130 290a 0a20 2020 203e 3e3e  10, 10)..    >>>
+00018480: 206e 6f72 6d61 6c69 7a65 5f63 6875 6e6b   normalize_chunk
+00018490: 7328 3130 2c20 7368 6170 653d 2833 302c  s(10, shape=(30,
+000184a0: 2035 2929 0a20 2020 2028 2831 302c 2031   5)).    ((10, 1
+000184b0: 302c 2031 3029 2c20 2835 2c29 290a 0a20  0, 10), (5,)).. 
+000184c0: 2020 2045 7870 616e 6473 2064 6963 7420     Expands dict 
+000184d0: 696e 7075 7473 0a0a 2020 2020 3e3e 3e20  inputs..    >>> 
+000184e0: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
+000184f0: 287b 303a 2032 2c20 313a 2033 7d2c 2073  ({0: 2, 1: 3}, s
+00018500: 6861 7065 3d28 362c 2036 2929 0a20 2020  hape=(6, 6)).   
+00018510: 2028 2832 2c20 322c 2032 292c 2028 332c   ((2, 2, 2), (3,
+00018520: 2033 2929 0a0a 2020 2020 5468 6520 7661   3))..    The va
+00018530: 6c75 6573 202d 3120 616e 6420 4e6f 6e65  lues -1 and None
+00018540: 2067 6574 206d 6170 7065 6420 746f 2066   get mapped to f
+00018550: 756c 6c20 7369 7a65 0a0a 2020 2020 3e3e  ull size..    >>
+00018560: 3e20 6e6f 726d 616c 697a 655f 6368 756e  > normalize_chun
+00018570: 6b73 2828 352c 202d 3129 2c20 7368 6170  ks((5, -1), shap
+00018580: 653d 2831 302c 2031 3029 290a 2020 2020  e=(10, 10)).    
+00018590: 2828 352c 2035 292c 2028 3130 2c29 290a  ((5, 5), (10,)).
+000185a0: 0a20 2020 2055 7365 2074 6865 2076 616c  .    Use the val
+000185b0: 7565 2022 6175 746f 2220 746f 2061 7574  ue "auto" to aut
+000185c0: 6f6d 6174 6963 616c 6c79 2064 6574 6572  omatically deter
+000185d0: 6d69 6e65 2063 6875 6e6b 2073 697a 6573  mine chunk sizes
+000185e0: 2061 6c6f 6e67 2063 6572 7461 696e 0a20   along certain. 
+000185f0: 2020 2064 696d 656e 7369 6f6e 732e 2020     dimensions.  
+00018600: 5468 6973 2075 7365 7320 7468 6520 6060  This uses the ``
+00018610: 6c69 6d69 743d 6060 2061 6e64 2060 6064  limit=`` and ``d
+00018620: 7479 7065 3d60 6020 6b65 7977 6f72 6473  type=`` keywords
+00018630: 2074 6f0a 2020 2020 6465 7465 726d 696e   to.    determin
+00018640: 6520 686f 7720 6c61 7267 6520 746f 206d  e how large to m
+00018650: 616b 6520 7468 6520 6368 756e 6b73 2e20  ake the chunks. 
+00018660: 2054 6865 2074 6572 6d20 2261 7574 6f22   The term "auto"
+00018670: 2063 616e 2062 6520 7573 6564 0a20 2020   can be used.   
+00018680: 2061 6e79 7768 6572 6520 616e 2069 6e74   anywhere an int
+00018690: 6567 6572 2063 616e 2062 6520 7573 6564  eger can be used
+000186a0: 2e20 2053 6565 2061 7272 6179 2063 6875  .  See array chu
+000186b0: 6e6b 696e 6720 646f 6375 6d65 6e74 6174  nking documentat
+000186c0: 696f 6e20 666f 7220 6d6f 7265 0a20 2020  ion for more.   
+000186d0: 2069 6e66 6f72 6d61 7469 6f6e 2e0a 0a20   information... 
+000186e0: 2020 203e 3e3e 206e 6f72 6d61 6c69 7a65     >>> normalize
+000186f0: 5f63 6875 6e6b 7328 2822 6175 746f 222c  _chunks(("auto",
+00018700: 292c 2073 6861 7065 3d28 3230 2c29 2c20  ), shape=(20,), 
+00018710: 6c69 6d69 743d 352c 2064 7479 7065 3d27  limit=5, dtype='
+00018720: 7569 6e74 3827 290a 2020 2020 2828 352c  uint8').    ((5,
+00018730: 2035 2c20 352c 2035 292c 290a 0a20 2020   5, 5, 5),)..   
+00018740: 2059 6f75 2063 616e 2061 6c73 6f20 7573   You can also us
+00018750: 6520 6279 7465 2073 697a 6573 2028 7365  e byte sizes (se
+00018760: 6520 3a66 756e 633a 6064 6173 6b2e 7574  e :func:`dask.ut
+00018770: 696c 732e 7061 7273 655f 6279 7465 7360  ils.parse_bytes`
+00018780: 2920 696e 2070 6c61 6365 206f 660a 2020  ) in place of.  
+00018790: 2020 2261 7574 6f22 2074 6f20 6173 6b20    "auto" to ask 
+000187a0: 666f 7220 6120 7061 7274 6963 756c 6172  for a particular
+000187b0: 2073 697a 650a 0a20 2020 203e 3e3e 206e   size..    >>> n
+000187c0: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 7328  ormalize_chunks(
+000187d0: 2231 6b69 4222 2c20 7368 6170 653d 2832  "1kiB", shape=(2
+000187e0: 3030 302c 292c 2064 7479 7065 3d27 666c  000,), dtype='fl
+000187f0: 6f61 7433 3227 290a 2020 2020 2828 3235  oat32').    ((25
+00018800: 362c 2032 3536 2c20 3235 362c 2032 3536  6, 256, 256, 256
+00018810: 2c20 3235 362c 2032 3536 2c20 3235 362c  , 256, 256, 256,
+00018820: 2032 3038 292c 290a 0a20 2020 2052 6573   208),)..    Res
+00018830: 7065 6374 7320 6e75 6c6c 2064 696d 656e  pects null dimen
+00018840: 7369 6f6e 730a 0a20 2020 203e 3e3e 206e  sions..    >>> n
+00018850: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 7328  ormalize_chunks(
+00018860: 2829 2c20 7368 6170 653d 2830 2c20 3029  (), shape=(0, 0)
+00018870: 290a 2020 2020 2828 302c 292c 2028 302c  ).    ((0,), (0,
+00018880: 2929 0a20 2020 2022 2222 0a20 2020 2069  )).    """.    i
+00018890: 6620 6474 7970 6520 616e 6420 6e6f 7420  f dtype and not 
+000188a0: 6973 696e 7374 616e 6365 2864 7479 7065  isinstance(dtype
+000188b0: 2c20 6e70 2e64 7479 7065 293a 0a20 2020  , np.dtype):.   
+000188c0: 2020 2020 2064 7479 7065 203d 206e 702e       dtype = np.
+000188d0: 6474 7970 6528 6474 7970 6529 0a20 2020  dtype(dtype).   
+000188e0: 2069 6620 6368 756e 6b73 2069 7320 4e6f   if chunks is No
+000188f0: 6e65 3a0a 2020 2020 2020 2020 7261 6973  ne:.        rais
+00018900: 6520 5661 6c75 6545 7272 6f72 2843 4855  e ValueError(CHU
+00018910: 4e4b 535f 4e4f 4e45 5f45 5252 4f52 5f4d  NKS_NONE_ERROR_M
+00018920: 4553 5341 4745 290a 2020 2020 6966 2069  ESSAGE).    if i
+00018930: 7369 6e73 7461 6e63 6528 6368 756e 6b73  sinstance(chunks
+00018940: 2c20 6c69 7374 293a 0a20 2020 2020 2020  , list):.       
+00018950: 2063 6875 6e6b 7320 3d20 7475 706c 6528   chunks = tuple(
+00018960: 6368 756e 6b73 290a 2020 2020 6966 2069  chunks).    if i
+00018970: 7369 6e73 7461 6e63 6528 6368 756e 6b73  sinstance(chunks
+00018980: 2c20 284e 756d 6265 722c 2073 7472 2929  , (Number, str))
+00018990: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
+000189a0: 203d 2028 6368 756e 6b73 2c29 202a 206c   = (chunks,) * l
+000189b0: 656e 2873 6861 7065 290a 2020 2020 6966  en(shape).    if
+000189c0: 2069 7369 6e73 7461 6e63 6528 6368 756e   isinstance(chun
+000189d0: 6b73 2c20 6469 6374 293a 0a20 2020 2020  ks, dict):.     
+000189e0: 2020 2063 6875 6e6b 7320 3d20 7475 706c     chunks = tupl
+000189f0: 6528 6368 756e 6b73 2e67 6574 2869 2c20  e(chunks.get(i, 
+00018a00: 4e6f 6e65 2920 666f 7220 6920 696e 2072  None) for i in r
+00018a10: 616e 6765 286c 656e 2873 6861 7065 2929  ange(len(shape))
+00018a20: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
+00018a30: 6e63 6528 6368 756e 6b73 2c20 6e70 2e6e  nce(chunks, np.n
+00018a40: 6461 7272 6179 293a 0a20 2020 2020 2020  darray):.       
+00018a50: 2063 6875 6e6b 7320 3d20 6368 756e 6b73   chunks = chunks
+00018a60: 2e74 6f6c 6973 7428 290a 2020 2020 6966  .tolist().    if
+00018a70: 206e 6f74 2063 6875 6e6b 7320 616e 6420   not chunks and 
+00018a80: 7368 6170 6520 616e 6420 616c 6c28 7320  shape and all(s 
+00018a90: 3d3d 2030 2066 6f72 2073 2069 6e20 7368  == 0 for s in sh
+00018aa0: 6170 6529 3a0a 2020 2020 2020 2020 6368  ape):.        ch
+00018ab0: 756e 6b73 203d 2028 2830 2c29 2c29 202a  unks = ((0,),) *
+00018ac0: 206c 656e 2873 6861 7065 290a 0a20 2020   len(shape)..   
+00018ad0: 2069 6620 280a 2020 2020 2020 2020 7368   if (.        sh
+00018ae0: 6170 650a 2020 2020 2020 2020 616e 6420  ape.        and 
+00018af0: 6c65 6e28 7368 6170 6529 203d 3d20 310a  len(shape) == 1.
+00018b00: 2020 2020 2020 2020 616e 6420 6c65 6e28          and len(
+00018b10: 6368 756e 6b73 2920 3e20 310a 2020 2020  chunks) > 1.    
+00018b20: 2020 2020 616e 6420 616c 6c28 6973 696e      and all(isin
+00018b30: 7374 616e 6365 2863 2c20 284e 756d 6265  stance(c, (Numbe
+00018b40: 722c 2073 7472 2929 2066 6f72 2063 2069  r, str)) for c i
+00018b50: 6e20 6368 756e 6b73 290a 2020 2020 293a  n chunks).    ):
+00018b60: 0a20 2020 2020 2020 2063 6875 6e6b 7320  .        chunks 
+00018b70: 3d20 2863 6875 6e6b 732c 290a 0a20 2020  = (chunks,)..   
+00018b80: 2069 6620 7368 6170 6520 616e 6420 6c65   if shape and le
+00018b90: 6e28 6368 756e 6b73 2920 213d 206c 656e  n(chunks) != len
+00018ba0: 2873 6861 7065 293a 0a20 2020 2020 2020  (shape):.       
+00018bb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00018bc0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
+00018bd0: 4368 756e 6b73 2061 6e64 2073 6861 7065  Chunks and shape
+00018be0: 206d 7573 7420 6265 206f 6620 7468 6520   must be of the 
+00018bf0: 7361 6d65 206c 656e 6774 682f 6469 6d65  same length/dime
+00018c00: 6e73 696f 6e2e 2022 0a20 2020 2020 2020  nsion. ".       
+00018c10: 2020 2020 2022 476f 7420 6368 756e 6b73       "Got chunks
+00018c20: 3d25 732c 2073 6861 7065 3d25 7322 2025  =%s, shape=%s" %
+00018c30: 2028 6368 756e 6b73 2c20 7368 6170 6529   (chunks, shape)
+00018c40: 0a20 2020 2020 2020 2029 0a20 2020 2069  .        ).    i
+00018c50: 6620 2d31 2069 6e20 6368 756e 6b73 206f  f -1 in chunks o
+00018c60: 7220 4e6f 6e65 2069 6e20 6368 756e 6b73  r None in chunks
+00018c70: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
+00018c80: 203d 2074 7570 6c65 2873 2069 6620 6320   = tuple(s if c 
+00018c90: 3d3d 202d 3120 6f72 2063 2069 7320 4e6f  == -1 or c is No
+00018ca0: 6e65 2065 6c73 6520 6320 666f 7220 632c  ne else c for c,
+00018cb0: 2073 2069 6e20 7a69 7028 6368 756e 6b73   s in zip(chunks
+00018cc0: 2c20 7368 6170 6529 290a 0a20 2020 2023  , shape))..    #
+00018cd0: 2049 6620 7370 6563 6966 7969 6e67 2063   If specifying c
+00018ce0: 6875 6e6b 2073 697a 6520 696e 2062 7974  hunk size in byt
+00018cf0: 6573 2c20 7573 6520 7468 6174 2076 616c  es, use that val
+00018d00: 7565 2074 6f20 7365 7420 7468 6520 6c69  ue to set the li
+00018d10: 6d69 742e 0a20 2020 2023 2056 6572 6966  mit..    # Verif
+00018d20: 7920 7468 6572 6520 6973 206f 6e6c 7920  y there is only 
+00018d30: 6f6e 6520 636f 6e73 6973 7465 6e74 2076  one consistent v
+00018d40: 616c 7565 206f 6620 6c69 6d69 7420 6f72  alue of limit or
+00018d50: 2063 6875 6e6b 2d62 7974 6573 2075 7365   chunk-bytes use
+00018d60: 642e 0a20 2020 2066 6f72 2063 2069 6e20  d..    for c in 
+00018d70: 6368 756e 6b73 3a0a 2020 2020 2020 2020  chunks:.        
+00018d80: 6966 2069 7369 6e73 7461 6e63 6528 632c  if isinstance(c,
+00018d90: 2073 7472 2920 616e 6420 6320 213d 2022   str) and c != "
+00018da0: 6175 746f 223a 0a20 2020 2020 2020 2020  auto":.         
+00018db0: 2020 2070 6172 7365 6420 3d20 7061 7273     parsed = pars
+00018dc0: 655f 6279 7465 7328 6329 0a20 2020 2020  e_bytes(c).     
+00018dd0: 2020 2020 2020 2069 6620 6c69 6d69 7420         if limit 
+00018de0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00018df0: 2020 2020 2020 2020 206c 696d 6974 203d           limit =
+00018e00: 2070 6172 7365 640a 2020 2020 2020 2020   parsed.        
+00018e10: 2020 2020 656c 6966 2070 6172 7365 6420      elif parsed 
+00018e20: 213d 206c 696d 6974 3a0a 2020 2020 2020  != limit:.      
+00018e30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00018e40: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00018e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e60: 224f 6e6c 7920 6f6e 6520 636f 6e73 6973  "Only one consis
+00018e70: 7465 6e74 2076 616c 7565 206f 6620 6c69  tent value of li
+00018e80: 6d69 7420 6f72 2063 6875 6e6b 2069 7320  mit or chunk is 
+00018e90: 616c 6c6f 7765 642e 220a 2020 2020 2020  allowed.".      
+00018ea0: 2020 2020 2020 2020 2020 2020 2020 2255                "U
+00018eb0: 7365 6420 2573 2021 3d20 2573 2220 2520  sed %s != %s" % 
+00018ec0: 2870 6172 7365 642c 206c 696d 6974 290a  (parsed, limit).
+00018ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ee0: 290a 2020 2020 2320 5375 6273 7469 7475  ).    # Substitu
+00018ef0: 7465 2062 7974 6520 6c69 6d69 7473 2077  te byte limits w
+00018f00: 6974 6820 2761 7574 6f27 206e 6f77 2074  ith 'auto' now t
+00018f10: 6861 7420 6c69 6d69 7420 6973 2073 6574  hat limit is set
+00018f20: 2e0a 2020 2020 6368 756e 6b73 203d 2074  ..    chunks = t
+00018f30: 7570 6c65 2822 6175 746f 2220 6966 2069  uple("auto" if i
+00018f40: 7369 6e73 7461 6e63 6528 632c 2073 7472  sinstance(c, str
+00018f50: 2920 616e 6420 6320 213d 2022 6175 746f  ) and c != "auto
+00018f60: 2220 656c 7365 2063 2066 6f72 2063 2069  " else c for c i
+00018f70: 6e20 6368 756e 6b73 290a 0a20 2020 2069  n chunks)..    i
+00018f80: 6620 616e 7928 6320 3d3d 2022 6175 746f  f any(c == "auto
+00018f90: 2220 666f 7220 6320 696e 2063 6875 6e6b  " for c in chunk
+00018fa0: 7329 3a0a 2020 2020 2020 2020 6368 756e  s):.        chun
+00018fb0: 6b73 203d 2061 7574 6f5f 6368 756e 6b73  ks = auto_chunks
+00018fc0: 2863 6875 6e6b 732c 2073 6861 7065 2c20  (chunks, shape, 
+00018fd0: 6c69 6d69 742c 2064 7479 7065 2c20 7072  limit, dtype, pr
+00018fe0: 6576 696f 7573 5f63 6875 6e6b 7329 0a0a  evious_chunks)..
+00018ff0: 2020 2020 6966 2073 6861 7065 2069 7320      if shape is 
+00019000: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00019010: 2020 6368 756e 6b73 203d 2074 7570 6c65    chunks = tuple
+00019020: 2863 2069 6620 6320 6e6f 7420 696e 207b  (c if c not in {
+00019030: 4e6f 6e65 2c20 2d31 7d20 656c 7365 2073  None, -1} else s
+00019040: 2066 6f72 2063 2c20 7320 696e 207a 6970   for c, s in zip
+00019050: 2863 6875 6e6b 732c 2073 6861 7065 2929  (chunks, shape))
+00019060: 0a0a 2020 2020 6966 2063 6875 6e6b 7320  ..    if chunks 
+00019070: 616e 6420 7368 6170 6520 6973 206e 6f74  and shape is not
+00019080: 204e 6f6e 653a 0a20 2020 2020 2020 2063   None:.        c
+00019090: 6875 6e6b 7320 3d20 7375 6d28 0a20 2020  hunks = sum(.   
+000190a0: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
+000190b0: 2020 2020 2020 2020 2020 2062 6c6f 636b             block
+000190c0: 6469 6d73 5f66 726f 6d5f 626c 6f63 6b73  dims_from_blocks
+000190d0: 6861 7065 2828 732c 292c 2028 632c 2929  hape((s,), (c,))
+000190e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190f0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00019100: 6365 2863 2c20 2874 7570 6c65 2c20 6c69  ce(c, (tuple, li
+00019110: 7374 2929 0a20 2020 2020 2020 2020 2020  st)).           
+00019120: 2020 2020 2065 6c73 6520 2863 2c29 0a20       else (c,). 
+00019130: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00019140: 6f72 2073 2c20 6320 696e 207a 6970 2873  or s, c in zip(s
+00019150: 6861 7065 2c20 6368 756e 6b73 290a 2020  hape, chunks).  
+00019160: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00019170: 2020 2020 2020 2020 2028 292c 0a20 2020           (),.   
+00019180: 2020 2020 2029 0a20 2020 2066 6f72 2063       ).    for c
+00019190: 2069 6e20 6368 756e 6b73 3a0a 2020 2020   in chunks:.    
+000191a0: 2020 2020 6966 206e 6f74 2063 3a0a 2020      if not c:.  
+000191b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000191c0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000191d0: 2020 2020 2020 2020 2020 2020 2245 6d70              "Emp
+000191e0: 7479 2074 7570 6c65 7320 6172 6520 6e6f  ty tuples are no
+000191f0: 7420 616c 6c6f 7765 6420 696e 2063 6875  t allowed in chu
+00019200: 6e6b 732e 2045 7870 7265 7373 2022 0a20  nks. Express ". 
+00019210: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00019220: 7a65 726f 206c 656e 6774 6820 6469 6d65  zero length dime
+00019230: 6e73 696f 6e73 2077 6974 6820 3028 7329  nsions with 0(s)
+00019240: 2069 6e20 6368 756e 6b73 220a 2020 2020   in chunks".    
+00019250: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
+00019260: 6620 7368 6170 6520 6973 206e 6f74 204e  f shape is not N
+00019270: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
+00019280: 6c65 6e28 6368 756e 6b73 2920 213d 206c  len(chunks) != l
+00019290: 656e 2873 6861 7065 293a 0a20 2020 2020  en(shape):.     
+000192a0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000192b0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+000192c0: 2020 2020 2020 2020 2022 496e 7075 7420           "Input 
+000192d0: 6172 7261 7920 6861 7320 2564 2064 696d  array has %d dim
+000192e0: 656e 7369 6f6e 7320 6275 7420 7468 6520  ensions but the 
+000192f0: 7375 7070 6c69 6564 2022 0a20 2020 2020  supplied ".     
+00019300: 2020 2020 2020 2020 2020 2022 6368 756e             "chun
+00019310: 6b73 2068 6173 206f 6e6c 7920 2564 2064  ks has only %d d
+00019320: 696d 656e 7369 6f6e 7322 2025 2028 6c65  imensions" % (le
+00019330: 6e28 7368 6170 6529 2c20 6c65 6e28 6368  n(shape), len(ch
+00019340: 756e 6b73 2929 0a20 2020 2020 2020 2020  unks)).         
+00019350: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00019360: 6e6f 7420 616c 6c28 0a20 2020 2020 2020  not all(.       
+00019370: 2020 2020 2063 203d 3d20 7320 6f72 2028       c == s or (
+00019380: 6d61 7468 2e69 736e 616e 2863 2920 6f72  math.isnan(c) or
+00019390: 206d 6174 682e 6973 6e61 6e28 7329 290a   math.isnan(s)).
+000193a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000193b0: 632c 2073 2069 6e20 7a69 7028 6d61 7028  c, s in zip(map(
+000193c0: 7375 6d2c 2063 6875 6e6b 7329 2c20 7368  sum, chunks), sh
+000193d0: 6170 6529 0a20 2020 2020 2020 2029 3a0a  ape).        ):.
+000193e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000193f0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00019400: 2020 2020 2020 2020 2020 2020 2020 2243                "C
+00019410: 6875 6e6b 7320 646f 206e 6f74 2061 6464  hunks do not add
+00019420: 2075 7020 746f 2073 6861 7065 2e20 220a   up to shape. ".
+00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019440: 2247 6f74 2063 6875 6e6b 733d 2573 2c20  "Got chunks=%s, 
+00019450: 7368 6170 653d 2573 2220 2520 2863 6875  shape=%s" % (chu
+00019460: 6e6b 732c 2073 6861 7065 290a 2020 2020  nks, shape).    
+00019470: 2020 2020 2020 2020 290a 0a20 2020 2072          )..    r
+00019480: 6574 7572 6e20 7475 706c 6528 0a20 2020  eturn tuple(.   
+00019490: 2020 2020 2074 7570 6c65 2869 6e74 2878       tuple(int(x
+000194a0: 2920 6966 206e 6f74 206d 6174 682e 6973  ) if not math.is
+000194b0: 6e61 6e28 7829 2065 6c73 6520 6e70 2e6e  nan(x) else np.n
+000194c0: 616e 2066 6f72 2078 2069 6e20 6329 2066  an for x in c) f
+000194d0: 6f72 2063 2069 6e20 6368 756e 6b73 0a20  or c in chunks. 
+000194e0: 2020 2029 0a0a 0a64 6566 205f 636f 6d70     )...def _comp
+000194f0: 7574 655f 6d75 6c74 6970 6c69 6572 286c  ute_multiplier(l
+00019500: 696d 6974 3a20 696e 742c 2064 7479 7065  imit: int, dtype
+00019510: 2c20 6c61 7267 6573 745f 626c 6f63 6b3a  , largest_block:
+00019520: 2069 6e74 2c20 7265 7375 6c74 293a 0a20   int, result):. 
+00019530: 2020 2022 2222 0a20 2020 2055 7469 6c69     """.    Utili
+00019540: 7479 2066 756e 6374 696f 6e20 666f 7220  ty function for 
+00019550: 6175 746f 5f63 6875 6e6b 2c20 746f 2066  auto_chunk, to f
+00019560: 696e 2068 6f77 206d 7563 6820 6c61 7267  in how much larg
+00019570: 6572 206f 7220 736d 616c 6c65 7220 7468  er or smaller th
+00019580: 6520 6964 6561 6c0a 2020 2020 6368 756e  e ideal.    chun
+00019590: 6b20 7369 7a65 2069 7320 7265 6c61 7469  k size is relati
+000195a0: 7665 2074 6f20 7768 6174 2077 6520 6861  ve to what we ha
+000195b0: 7665 206e 6f77 2e0a 2020 2020 2222 220a  ve now..    """.
+000195c0: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+000195d0: 2020 2020 206c 696d 6974 0a20 2020 2020       limit.     
+000195e0: 2020 202f 2064 7479 7065 2e69 7465 6d73     / dtype.items
+000195f0: 697a 650a 2020 2020 2020 2020 2f20 6c61  ize.        / la
+00019600: 7267 6573 745f 626c 6f63 6b0a 2020 2020  rgest_block.    
+00019610: 2020 2020 2f20 6d61 7468 2e70 726f 6428      / math.prod(
+00019620: 7220 666f 7220 7220 696e 2072 6573 756c  r for r in resul
+00019630: 742e 7661 6c75 6573 2829 2069 6620 7229  t.values() if r)
+00019640: 0a20 2020 2029 0a0a 0a64 6566 2061 7574  .    )...def aut
+00019650: 6f5f 6368 756e 6b73 2863 6875 6e6b 732c  o_chunks(chunks,
+00019660: 2073 6861 7065 2c20 6c69 6d69 742c 2064   shape, limit, d
+00019670: 7479 7065 2c20 7072 6576 696f 7573 5f63  type, previous_c
+00019680: 6875 6e6b 733d 4e6f 6e65 293a 0a20 2020  hunks=None):.   
+00019690: 2022 2222 4465 7465 726d 696e 6520 6175   """Determine au
+000196a0: 746f 6d61 7469 6320 6368 756e 6b73 0a0a  tomatic chunks..
+000196b0: 2020 2020 5468 6973 2074 616b 6573 2069      This takes i
+000196c0: 6e20 6120 6368 756e 6b73 2076 616c 7565  n a chunks value
+000196d0: 2074 6861 7420 636f 6e74 6169 6e73 2060   that contains `
+000196e0: 6022 6175 746f 2260 6020 7661 6c75 6573  `"auto"`` values
+000196f0: 2069 6e20 6365 7274 6169 6e0a 2020 2020   in certain.    
+00019700: 6469 6d65 6e73 696f 6e73 2061 6e64 2072  dimensions and r
+00019710: 6570 6c61 6365 7320 7468 6f73 6520 7661  eplaces those va
+00019720: 6c75 6573 2077 6974 6820 636f 6e63 7265  lues with concre
+00019730: 7465 2064 696d 656e 7369 6f6e 2073 697a  te dimension siz
+00019740: 6573 2074 6861 7420 7472 790a 2020 2020  es that try.    
+00019750: 746f 2067 6574 2063 6875 6e6b 7320 746f  to get chunks to
+00019760: 2062 6520 6f66 2061 2063 6572 7461 696e   be of a certain
+00019770: 2073 697a 6520 696e 2062 7974 6573 2c20   size in bytes, 
+00019780: 7072 6f76 6964 6564 2062 7920 7468 6520  provided by the 
+00019790: 6060 6c69 6d69 743d 6060 0a20 2020 206b  ``limit=``.    k
+000197a0: 6579 776f 7264 2e20 2049 6620 6d75 6c74  eyword.  If mult
+000197b0: 6970 6c65 2064 696d 656e 7369 6f6e 7320  iple dimensions 
+000197c0: 6172 6520 6d61 726b 6564 2061 7320 6060  are marked as ``
+000197d0: 2261 7574 6f22 6060 2074 6865 6e20 7468  "auto"`` then th
+000197e0: 6579 2077 696c 6c0a 2020 2020 616c 6c20  ey will.    all 
+000197f0: 7265 7370 6f6e 6420 746f 206d 6565 7420  respond to meet 
+00019800: 7468 6520 6465 7369 7265 6420 6279 7465  the desired byte
+00019810: 206c 696d 6974 2c20 7472 7969 6e67 2074   limit, trying t
+00019820: 6f20 7265 7370 6563 7420 7468 6520 6173  o respect the as
+00019830: 7065 6374 0a20 2020 2072 6174 696f 206f  pect.    ratio o
+00019840: 6620 7468 6569 7220 6469 6d65 6e73 696f  f their dimensio
+00019850: 6e73 2069 6e20 6060 7072 6576 696f 7573  ns in ``previous
+00019860: 5f63 6875 6e6b 733d 6060 2c20 6966 2067  _chunks=``, if g
+00019870: 6976 656e 2e0a 0a20 2020 2050 6172 616d  iven...    Param
+00019880: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00019890: 2d2d 2d2d 0a20 2020 2063 6875 6e6b 733a  ----.    chunks:
+000198a0: 2054 7570 6c65 0a20 2020 2020 2020 2041   Tuple.        A
+000198b0: 2074 7570 6c65 206f 6620 6569 7468 6572   tuple of either
+000198c0: 2064 696d 656e 7369 6f6e 7320 6f72 2074   dimensions or t
+000198d0: 7570 6c65 7320 6f66 2065 7870 6c69 6369  uples of explici
+000198e0: 7420 6368 756e 6b20 6469 6d65 6e73 696f  t chunk dimensio
+000198f0: 6e73 0a20 2020 2020 2020 2053 6f6d 6520  ns.        Some 
+00019900: 656e 7472 6965 7320 7368 6f75 6c64 2062  entries should b
+00019910: 6520 2261 7574 6f22 0a20 2020 2073 6861  e "auto".    sha
+00019920: 7065 3a20 5475 706c 655b 696e 745d 0a20  pe: Tuple[int]. 
+00019930: 2020 206c 696d 6974 3a20 696e 742c 2073     limit: int, s
+00019940: 7472 0a20 2020 2020 2020 2054 6865 206d  tr.        The m
+00019950: 6178 696d 756d 2061 6c6c 6f77 6162 6c65  aximum allowable
+00019960: 2073 697a 6520 6f66 2061 2063 6875 6e6b   size of a chunk
+00019970: 2069 6e20 6279 7465 730a 2020 2020 7072   in bytes.    pr
+00019980: 6576 696f 7573 5f63 6875 6e6b 733a 2054  evious_chunks: T
+00019990: 7570 6c65 5b54 7570 6c65 5b69 6e74 5d5d  uple[Tuple[int]]
+000199a0: 0a0a 2020 2020 5365 6520 616c 736f 0a20  ..    See also. 
+000199b0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+000199c0: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
+000199d0: 3a20 666f 7220 6675 6c6c 2064 6f63 7374  : for full docst
+000199e0: 7269 6e67 2061 6e64 2070 6172 616d 6574  ring and paramet
+000199f0: 6572 730a 2020 2020 2222 220a 2020 2020  ers.    """.    
+00019a00: 6966 2070 7265 7669 6f75 735f 6368 756e  if previous_chun
+00019a10: 6b73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ks is not None:.
+00019a20: 2020 2020 2020 2020 7072 6576 696f 7573          previous
+00019a30: 5f63 6875 6e6b 7320 3d20 7475 706c 6528  _chunks = tuple(
+00019a40: 0a20 2020 2020 2020 2020 2020 2063 2069  .            c i
+00019a50: 6620 6973 696e 7374 616e 6365 2863 2c20  f isinstance(c, 
+00019a60: 7475 706c 6529 2065 6c73 6520 2863 2c29  tuple) else (c,)
+00019a70: 2066 6f72 2063 2069 6e20 7072 6576 696f   for c in previo
+00019a80: 7573 5f63 6875 6e6b 730a 2020 2020 2020  us_chunks.      
+00019a90: 2020 290a 2020 2020 6368 756e 6b73 203d    ).    chunks =
+00019aa0: 206c 6973 7428 6368 756e 6b73 290a 0a20   list(chunks).. 
+00019ab0: 2020 2061 7574 6f73 203d 207b 6920 666f     autos = {i fo
+00019ac0: 7220 692c 2063 2069 6e20 656e 756d 6572  r i, c in enumer
+00019ad0: 6174 6528 6368 756e 6b73 2920 6966 2063  ate(chunks) if c
+00019ae0: 203d 3d20 2261 7574 6f22 7d0a 2020 2020   == "auto"}.    
+00019af0: 6966 206e 6f74 2061 7574 6f73 3a0a 2020  if not autos:.  
+00019b00: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
+00019b10: 6c65 2863 6875 6e6b 7329 0a0a 2020 2020  le(chunks)..    
+00019b20: 6966 206c 696d 6974 2069 7320 4e6f 6e65  if limit is None
+00019b30: 3a0a 2020 2020 2020 2020 6c69 6d69 7420  :.        limit 
+00019b40: 3d20 636f 6e66 6967 2e67 6574 2822 6172  = config.get("ar
+00019b50: 7261 792e 6368 756e 6b2d 7369 7a65 2229  ray.chunk-size")
+00019b60: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00019b70: 6365 286c 696d 6974 2c20 7374 7229 3a0a  ce(limit, str):.
+00019b80: 2020 2020 2020 2020 6c69 6d69 7420 3d20          limit = 
+00019b90: 7061 7273 655f 6279 7465 7328 6c69 6d69  parse_bytes(limi
+00019ba0: 7429 0a0a 2020 2020 6966 2064 7479 7065  t)..    if dtype
+00019bb0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00019bc0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+00019bd0: 7228 2264 7479 7065 206d 7573 7420 6265  r("dtype must be
+00019be0: 206b 6e6f 776e 2066 6f72 2061 7574 6f2d   known for auto-
+00019bf0: 6368 756e 6b69 6e67 2229 0a0a 2020 2020  chunking")..    
+00019c00: 6966 2064 7479 7065 2e68 6173 6f62 6a65  if dtype.hasobje
+00019c10: 6374 3a0a 2020 2020 2020 2020 7261 6973  ct:.        rais
+00019c20: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+00019c30: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00019c40: 2020 2022 4361 6e20 6e6f 7420 7573 6520     "Can not use 
+00019c50: 6175 746f 2072 6563 6875 6e6b 696e 6720  auto rechunking 
+00019c60: 7769 7468 206f 626a 6563 7420 6474 7970  with object dtyp
+00019c70: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
+00019c80: 2022 5765 2061 7265 2075 6e61 626c 6520   "We are unable 
+00019c90: 746f 2065 7374 696d 6174 6520 7468 6520  to estimate the 
+00019ca0: 7369 7a65 2069 6e20 6279 7465 7320 6f66  size in bytes of
+00019cb0: 206f 626a 6563 7420 6461 7461 220a 2020   object data".  
+00019cc0: 2020 2020 2020 290a 0a20 2020 2066 6f72        )..    for
+00019cd0: 2078 2069 6e20 7475 706c 6528 6368 756e   x in tuple(chun
+00019ce0: 6b73 2920 2b20 7475 706c 6528 7368 6170  ks) + tuple(shap
+00019cf0: 6529 3a0a 2020 2020 2020 2020 6966 2028  e):.        if (
+00019d00: 0a20 2020 2020 2020 2020 2020 2069 7369  .            isi
+00019d10: 6e73 7461 6e63 6528 782c 204e 756d 6265  nstance(x, Numbe
+00019d20: 7229 0a20 2020 2020 2020 2020 2020 2061  r).            a
+00019d30: 6e64 206e 702e 6973 6e61 6e28 7829 0a20  nd np.isnan(x). 
+00019d40: 2020 2020 2020 2020 2020 206f 7220 6973             or is
+00019d50: 696e 7374 616e 6365 2878 2c20 7475 706c  instance(x, tupl
+00019d60: 6529 0a20 2020 2020 2020 2020 2020 2061  e).            a
+00019d70: 6e64 206e 702e 6973 6e61 6e28 7829 2e61  nd np.isnan(x).a
+00019d80: 6e79 2829 0a20 2020 2020 2020 2029 3a0a  ny().        ):.
+00019d90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00019da0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00019db0: 2020 2020 2020 2020 2020 2020 2020 2243                "C
+00019dc0: 616e 206e 6f74 2070 6572 666f 726d 2061  an not perform a
+00019dd0: 7574 6f6d 6174 6963 2072 6563 6875 6e6b  utomatic rechunk
+00019de0: 696e 6720 7769 7468 2075 6e6b 6e6f 776e  ing with unknown
+00019df0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00019e00: 2020 2022 286e 616e 2920 6368 756e 6b20     "(nan) chunk 
+00019e10: 7369 7a65 732e 2573 2220 2520 756e 6b6e  sizes.%s" % unkn
+00019e20: 6f77 6e5f 6368 756e 6b5f 6d65 7373 6167  own_chunk_messag
+00019e30: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
+00019e40: 0a20 2020 206c 696d 6974 203d 206d 6178  .    limit = max
+00019e50: 2831 2c20 6c69 6d69 7429 0a0a 2020 2020  (1, limit)..    
+00019e60: 6c61 7267 6573 745f 626c 6f63 6b20 3d20  largest_block = 
+00019e70: 6d61 7468 2e70 726f 6428 0a20 2020 2020  math.prod(.     
+00019e80: 2020 2063 7320 6966 2069 7369 6e73 7461     cs if isinsta
+00019e90: 6e63 6528 6373 2c20 4e75 6d62 6572 2920  nce(cs, Number) 
+00019ea0: 656c 7365 206d 6178 2863 7329 2066 6f72  else max(cs) for
+00019eb0: 2063 7320 696e 2063 6875 6e6b 7320 6966   cs in chunks if
+00019ec0: 2063 7320 213d 2022 6175 746f 220a 2020   cs != "auto".  
+00019ed0: 2020 290a 0a20 2020 2069 6620 7072 6576    )..    if prev
+00019ee0: 696f 7573 5f63 6875 6e6b 733a 0a20 2020  ious_chunks:.   
+00019ef0: 2020 2020 2023 2042 6173 6520 6964 6561       # Base idea
+00019f00: 6c20 7261 7469 6f20 6f6e 2074 6865 206d  l ratio on the m
+00019f10: 6564 6961 6e20 6368 756e 6b20 7369 7a65  edian chunk size
+00019f20: 206f 6620 7468 6520 7072 6576 696f 7573   of the previous
+00019f30: 2063 6875 6e6b 730a 2020 2020 2020 2020   chunks.        
+00019f40: 7265 7375 6c74 203d 207b 613a 206e 702e  result = {a: np.
+00019f50: 6d65 6469 616e 2870 7265 7669 6f75 735f  median(previous_
+00019f60: 6368 756e 6b73 5b61 5d29 2066 6f72 2061  chunks[a]) for a
+00019f70: 2069 6e20 6175 746f 737d 0a0a 2020 2020   in autos}..    
+00019f80: 2020 2020 6964 6561 6c5f 7368 6170 6520      ideal_shape 
+00019f90: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00019fa0: 2069 2c20 7320 696e 2065 6e75 6d65 7261   i, s in enumera
+00019fb0: 7465 2873 6861 7065 293a 0a20 2020 2020  te(shape):.     
+00019fc0: 2020 2020 2020 2063 6875 6e6b 5f66 7265         chunk_fre
+00019fd0: 7175 656e 6369 6573 203d 2066 7265 7175  quencies = frequ
+00019fe0: 656e 6369 6573 2870 7265 7669 6f75 735f  encies(previous_
+00019ff0: 6368 756e 6b73 5b69 5d29 0a20 2020 2020  chunks[i]).     
+0001a000: 2020 2020 2020 206d 6f64 652c 2063 6f75         mode, cou
+0001a010: 6e74 203d 206d 6178 2863 6875 6e6b 5f66  nt = max(chunk_f
+0001a020: 7265 7175 656e 6369 6573 2e69 7465 6d73  requencies.items
+0001a030: 2829 2c20 6b65 793d 6c61 6d62 6461 206b  (), key=lambda k
+0001a040: 763a 206b 765b 315d 290a 2020 2020 2020  v: kv[1]).      
+0001a050: 2020 2020 2020 6966 206d 6f64 6520 3e20        if mode > 
+0001a060: 3120 616e 6420 636f 756e 7420 3e3d 206c  1 and count >= l
+0001a070: 656e 2870 7265 7669 6f75 735f 6368 756e  en(previous_chun
+0001a080: 6b73 5b69 5d29 202f 2032 3a0a 2020 2020  ks[i]) / 2:.    
+0001a090: 2020 2020 2020 2020 2020 2020 6964 6561              idea
+0001a0a0: 6c5f 7368 6170 652e 6170 7065 6e64 286d  l_shape.append(m
+0001a0b0: 6f64 6529 0a20 2020 2020 2020 2020 2020  ode).           
+0001a0c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001a0d0: 2020 2020 2020 2069 6465 616c 5f73 6861         ideal_sha
+0001a0e0: 7065 2e61 7070 656e 6428 7329 0a0a 2020  pe.append(s)..  
+0001a0f0: 2020 2020 2020 2320 486f 7720 6d75 6368        # How much
+0001a100: 206c 6172 6765 7220 6f72 2073 6d61 6c6c   larger or small
+0001a110: 6572 2074 6865 2069 6465 616c 2063 6875  er the ideal chu
+0001a120: 6e6b 2073 697a 6520 6973 2072 656c 6174  nk size is relat
+0001a130: 6976 6520 746f 2077 6861 7420 7765 2068  ive to what we h
+0001a140: 6176 6520 6e6f 770a 2020 2020 2020 2020  ave now.        
+0001a150: 6d75 6c74 6970 6c69 6572 203d 205f 636f  multiplier = _co
+0001a160: 6d70 7574 655f 6d75 6c74 6970 6c69 6572  mpute_multiplier
+0001a170: 286c 696d 6974 2c20 6474 7970 652c 206c  (limit, dtype, l
+0001a180: 6172 6765 7374 5f62 6c6f 636b 2c20 7265  argest_block, re
+0001a190: 7375 6c74 290a 0a20 2020 2020 2020 206c  sult)..        l
+0001a1a0: 6173 745f 6d75 6c74 6970 6c69 6572 203d  ast_multiplier =
+0001a1b0: 2030 0a20 2020 2020 2020 206c 6173 745f   0.        last_
+0001a1c0: 6175 746f 7320 3d20 7365 7428 290a 2020  autos = set().  
+0001a1d0: 2020 2020 2020 7768 696c 6520 280a 2020        while (.  
+0001a1e0: 2020 2020 2020 2020 2020 6d75 6c74 6970            multip
+0001a1f0: 6c69 6572 2021 3d20 6c61 7374 5f6d 756c  lier != last_mul
+0001a200: 7469 706c 6965 7220 6f72 2061 7574 6f73  tiplier or autos
+0001a210: 2021 3d20 6c61 7374 5f61 7574 6f73 0a20   != last_autos. 
+0001a220: 2020 2020 2020 2029 3a20 2023 2077 6869         ):  # whi
+0001a230: 6c65 2074 6869 6e67 7320 6368 616e 6765  le things change
+0001a240: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
+0001a250: 745f 6d75 6c74 6970 6c69 6572 203d 206d  t_multiplier = m
+0001a260: 756c 7469 706c 6965 7220 2023 2072 6563  ultiplier  # rec
+0001a270: 6f72 6420 7072 6576 696f 7573 2076 616c  ord previous val
+0001a280: 7565 730a 2020 2020 2020 2020 2020 2020  ues.            
+0001a290: 6c61 7374 5f61 7574 6f73 203d 2073 6574  last_autos = set
+0001a2a0: 2861 7574 6f73 2920 2023 2072 6563 6f72  (autos)  # recor
+0001a2b0: 6420 7072 6576 696f 7573 2076 616c 7565  d previous value
+0001a2c0: 730a 0a20 2020 2020 2020 2020 2020 2023  s..            #
+0001a2d0: 2045 7870 616e 6420 6f72 2063 6f6e 7472   Expand or contr
+0001a2e0: 6163 7420 6561 6368 206f 6620 7468 6520  act each of the 
+0001a2f0: 6469 6d65 6e73 696f 6e73 2061 7070 726f  dimensions appro
+0001a300: 7072 6961 7465 6c79 0a20 2020 2020 2020  priately.       
+0001a310: 2020 2020 2066 6f72 2061 2069 6e20 736f       for a in so
+0001a320: 7274 6564 2861 7574 6f73 293a 0a20 2020  rted(autos):.   
+0001a330: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001a340: 6964 6561 6c5f 7368 6170 655b 615d 203d  ideal_shape[a] =
+0001a350: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0001a360: 2020 2020 2020 2020 2072 6573 756c 745b           result[
+0001a370: 615d 203d 2030 0a20 2020 2020 2020 2020  a] = 0.         
+0001a380: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001a390: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0001a3a0: 2020 2020 7072 6f70 6f73 6564 203d 2072      proposed = r
+0001a3b0: 6573 756c 745b 615d 202a 206d 756c 7469  esult[a] * multi
+0001a3c0: 706c 6965 7220 2a2a 2028 3120 2f20 6c65  plier ** (1 / le
+0001a3d0: 6e28 6175 746f 7329 290a 2020 2020 2020  n(autos)).      
+0001a3e0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
+0001a3f0: 706f 7365 6420 3e20 7368 6170 655b 615d  posed > shape[a]
+0001a400: 3a20 2023 2077 6527 7665 2068 6974 2074  :  # we've hit t
+0001a410: 6865 2073 6861 7065 2062 6f75 6e64 6172  he shape boundar
+0001a420: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0001a430: 2020 2020 2020 6175 746f 732e 7265 6d6f        autos.remo
+0001a440: 7665 2861 290a 2020 2020 2020 2020 2020  ve(a).          
+0001a450: 2020 2020 2020 2020 2020 6c61 7267 6573            larges
+0001a460: 745f 626c 6f63 6b20 2a3d 2073 6861 7065  t_block *= shape
+0001a470: 5b61 5d0a 2020 2020 2020 2020 2020 2020  [a].            
+0001a480: 2020 2020 2020 2020 6368 756e 6b73 5b61          chunks[a
+0001a490: 5d20 3d20 7368 6170 655b 615d 0a20 2020  ] = shape[a].   
+0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4b0: 2064 656c 2072 6573 756c 745b 615d 0a20   del result[a]. 
+0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a4d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a4e0: 2020 2020 2020 2020 2072 6573 756c 745b           result[
+0001a4f0: 615d 203d 2072 6f75 6e64 5f74 6f28 7072  a] = round_to(pr
+0001a500: 6f70 6f73 6564 2c20 6964 6561 6c5f 7368  oposed, ideal_sh
+0001a510: 6170 655b 615d 290a 0a20 2020 2020 2020  ape[a])..       
+0001a520: 2020 2020 2023 2072 6563 6f6d 7075 7465       # recompute
+0001a530: 2068 6f77 206d 7563 6820 6d75 6c74 6970   how much multip
+0001a540: 6c69 6572 2077 6520 6861 7665 206c 6566  lier we have lef
+0001a550: 742c 2072 6570 6561 740a 2020 2020 2020  t, repeat.      
+0001a560: 2020 2020 2020 6d75 6c74 6970 6c69 6572        multiplier
+0001a570: 203d 205f 636f 6d70 7574 655f 6d75 6c74   = _compute_mult
+0001a580: 6970 6c69 6572 286c 696d 6974 2c20 6474  iplier(limit, dt
+0001a590: 7970 652c 206c 6172 6765 7374 5f62 6c6f  ype, largest_blo
+0001a5a0: 636b 2c20 7265 7375 6c74 290a 0a20 2020  ck, result)..   
+0001a5b0: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+0001a5c0: 2072 6573 756c 742e 6974 656d 7328 293a   result.items():
+0001a5d0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+0001a5e0: 6e6b 735b 6b5d 203d 2076 0a20 2020 2020  nks[k] = v.     
+0001a5f0: 2020 2072 6574 7572 6e20 7475 706c 6528     return tuple(
+0001a600: 6368 756e 6b73 290a 0a20 2020 2065 6c73  chunks)..    els
+0001a610: 653a 0a20 2020 2020 2020 2023 2043 6865  e:.        # Che
+0001a620: 636b 2069 6620 6474 7970 652e 6974 656d  ck if dtype.item
+0001a630: 7369 7a65 2069 7320 6772 6561 7465 7220  size is greater 
+0001a640: 7468 616e 2030 0a20 2020 2020 2020 2069  than 0.        i
+0001a650: 6620 6474 7970 652e 6974 656d 7369 7a65  f dtype.itemsize
+0001a660: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0001a670: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001a680: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0001a690: 2020 2020 2022 6175 746f 2d63 6875 6e6b       "auto-chunk
+0001a6a0: 696e 6720 7769 7468 2064 7479 7065 2e69  ing with dtype.i
+0001a6b0: 7465 6d73 697a 6520 3d3d 2030 2069 7320  temsize == 0 is 
+0001a6c0: 6e6f 7420 7375 7070 6f72 7465 642c 2070  not supported, p
+0001a6d0: 6c65 6173 6520 7061 7373 2069 6e20 6063  lease pass in `c
+0001a6e0: 6875 6e6b 7360 2065 7870 6c69 6369 746c  hunks` explicitl
+0001a6f0: 7922 0a20 2020 2020 2020 2020 2020 2029  y".            )
+0001a700: 0a20 2020 2020 2020 2073 697a 6520 3d20  .        size = 
+0001a710: 286c 696d 6974 202f 2064 7479 7065 2e69  (limit / dtype.i
+0001a720: 7465 6d73 697a 6520 2f20 6c61 7267 6573  temsize / larges
+0001a730: 745f 626c 6f63 6b29 202a 2a20 2831 202f  t_block) ** (1 /
+0001a740: 206c 656e 2861 7574 6f73 2929 0a20 2020   len(autos)).   
+0001a750: 2020 2020 2073 6d61 6c6c 203d 205b 6920       small = [i 
+0001a760: 666f 7220 6920 696e 2061 7574 6f73 2069  for i in autos i
+0001a770: 6620 7368 6170 655b 695d 203c 2073 697a  f shape[i] < siz
+0001a780: 655d 0a20 2020 2020 2020 2069 6620 736d  e].        if sm
+0001a790: 616c 6c3a 0a20 2020 2020 2020 2020 2020  all:.           
+0001a7a0: 2066 6f72 2069 2069 6e20 736d 616c 6c3a   for i in small:
+0001a7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a7c0: 2063 6875 6e6b 735b 695d 203d 2028 7368   chunks[i] = (sh
+0001a7d0: 6170 655b 695d 2c29 0a20 2020 2020 2020  ape[i],).       
+0001a7e0: 2020 2020 2072 6574 7572 6e20 6175 746f       return auto
+0001a7f0: 5f63 6875 6e6b 7328 6368 756e 6b73 2c20  _chunks(chunks, 
+0001a800: 7368 6170 652c 206c 696d 6974 2c20 6474  shape, limit, dt
+0001a810: 7970 6529 0a0a 2020 2020 2020 2020 666f  ype)..        fo
+0001a820: 7220 6920 696e 2061 7574 6f73 3a0a 2020  r i in autos:.  
+0001a830: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
+0001a840: 5b69 5d20 3d20 726f 756e 645f 746f 2873  [i] = round_to(s
+0001a850: 697a 652c 2073 6861 7065 5b69 5d29 0a0a  ize, shape[i])..
+0001a860: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+0001a870: 7570 6c65 2863 6875 6e6b 7329 0a0a 0a64  uple(chunks)...d
+0001a880: 6566 2072 6f75 6e64 5f74 6f28 632c 2073  ef round_to(c, s
+0001a890: 293a 0a20 2020 2022 2222 5265 7475 726e  ):.    """Return
+0001a8a0: 2061 2063 6875 6e6b 2064 696d 656e 7369   a chunk dimensi
+0001a8b0: 6f6e 2074 6861 7420 6973 2063 6c6f 7365  on that is close
+0001a8c0: 2074 6f20 616e 2065 7665 6e20 6d75 6c74   to an even mult
+0001a8d0: 6970 6c65 206f 7220 6661 6374 6f72 0a0a  iple or factor..
+0001a8e0: 2020 2020 5765 2077 616e 7420 7661 6c75      We want valu
+0001a8f0: 6573 2066 6f72 2063 2074 6861 7420 6172  es for c that ar
+0001a900: 6520 6e69 6365 6c79 2061 6c69 676e 6564  e nicely aligned
+0001a910: 2077 6974 6820 732e 0a0a 2020 2020 4966   with s...    If
+0001a920: 2063 2069 7320 736d 616c 6c65 7220 7468   c is smaller th
+0001a930: 616e 2073 2077 6520 7573 6520 7468 6520  an s we use the 
+0001a940: 6f72 6967 696e 616c 2063 6875 6e6b 2073  original chunk s
+0001a950: 697a 6520 616e 6420 6163 6365 7074 2061  ize and accept a
+0001a960: 6e0a 2020 2020 756e 6576 656e 2063 6875  n.    uneven chu
+0001a970: 6e6b 2061 7420 7468 6520 656e 642e 0a0a  nk at the end...
+0001a980: 2020 2020 4966 2063 2069 7320 6c61 7267      If c is larg
+0001a990: 6572 2074 6861 6e20 7320 7468 656e 2077  er than s then w
+0001a9a0: 6520 7761 6e74 2074 6865 206c 6172 6765  e want the large
+0001a9b0: 7374 206d 756c 7469 706c 6520 6f66 2073  st multiple of s
+0001a9c0: 2074 6861 7420 6973 2073 7469 6c6c 0a20   that is still. 
+0001a9d0: 2020 2073 6d61 6c6c 6572 2074 6861 6e20     smaller than 
+0001a9e0: 632e 0a20 2020 2022 2222 0a20 2020 2069  c..    """.    i
+0001a9f0: 6620 6320 3c3d 2073 3a0a 2020 2020 2020  f c <= s:.      
+0001aa00: 2020 7265 7475 726e 206d 6178 2831 2c20    return max(1, 
+0001aa10: 696e 7428 6329 290a 2020 2020 656c 7365  int(c)).    else
+0001aa20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001aa30: 2063 202f 2f20 7320 2a20 730a 0a0a 6465   c // s * s...de
+0001aa40: 6620 5f67 6574 5f63 6875 6e6b 5f73 6861  f _get_chunk_sha
+0001aa50: 7065 2861 293a 0a20 2020 2073 203d 206e  pe(a):.    s = n
+0001aa60: 702e 6173 6172 7261 7928 612e 7368 6170  p.asarray(a.shap
+0001aa70: 652c 2064 7479 7065 3d69 6e74 290a 2020  e, dtype=int).  
+0001aa80: 2020 7265 7475 726e 2073 5b6c 656e 2873    return s[len(s
+0001aa90: 2920 2a20 284e 6f6e 652c 2920 2b20 2873  ) * (None,) + (s
+0001aaa0: 6c69 6365 284e 6f6e 6529 2c29 5d0a 0a0a  lice(None),)]...
+0001aab0: 6465 6620 6672 6f6d 5f61 7272 6179 280a  def from_array(.
+0001aac0: 2020 2020 782c 0a20 2020 2063 6875 6e6b      x,.    chunk
+0001aad0: 733d 2261 7574 6f22 2c0a 2020 2020 6e61  s="auto",.    na
+0001aae0: 6d65 3d4e 6f6e 652c 0a20 2020 206c 6f63  me=None,.    loc
+0001aaf0: 6b3d 4661 6c73 652c 0a20 2020 2061 7361  k=False,.    asa
+0001ab00: 7272 6179 3d4e 6f6e 652c 0a20 2020 2066  rray=None,.    f
+0001ab10: 616e 6379 3d54 7275 652c 0a20 2020 2067  ancy=True,.    g
+0001ab20: 6574 6974 656d 3d4e 6f6e 652c 0a20 2020  etitem=None,.   
+0001ab30: 206d 6574 613d 4e6f 6e65 2c0a 2020 2020   meta=None,.    
+0001ab40: 696e 6c69 6e65 5f61 7272 6179 3d46 616c  inline_array=Fal
+0001ab50: 7365 2c0a 293a 0a20 2020 2022 2222 4372  se,.):.    """Cr
+0001ab60: 6561 7465 2064 6173 6b20 6172 7261 7920  eate dask array 
+0001ab70: 6672 6f6d 2073 6f6d 6574 6869 6e67 2074  from something t
+0001ab80: 6861 7420 6c6f 6f6b 7320 6c69 6b65 2061  hat looks like a
+0001ab90: 6e20 6172 7261 792e 0a0a 2020 2020 496e  n array...    In
+0001aba0: 7075 7420 6d75 7374 2068 6176 6520 6120  put must have a 
+0001abb0: 6060 2e73 6861 7065 6060 2c20 6060 2e6e  ``.shape``, ``.n
+0001abc0: 6469 6d60 602c 2060 602e 6474 7970 6560  dim``, ``.dtype`
+0001abd0: 6020 616e 6420 7375 7070 6f72 7420 6e75  ` and support nu
+0001abe0: 6d70 792d 7374 796c 6520 736c 6963 696e  mpy-style slicin
+0001abf0: 672e 0a0a 2020 2020 5061 7261 6d65 7465  g...    Paramete
+0001ac00: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0001ac10: 2d0a 2020 2020 7820 3a20 6172 7261 795f  -.    x : array_
+0001ac20: 6c69 6b65 0a20 2020 2063 6875 6e6b 7320  like.    chunks 
+0001ac30: 3a20 696e 742c 2074 7570 6c65 0a20 2020  : int, tuple.   
+0001ac40: 2020 2020 2048 6f77 2074 6f20 6368 756e       How to chun
+0001ac50: 6b20 7468 6520 6172 7261 792e 204d 7573  k the array. Mus
+0001ac60: 7420 6265 206f 6e65 206f 6620 7468 6520  t be one of the 
+0001ac70: 666f 6c6c 6f77 696e 6720 666f 726d 733a  following forms:
+0001ac80: 0a0a 2020 2020 2020 2020 2d20 4120 626c  ..        - A bl
+0001ac90: 6f63 6b73 697a 6520 6c69 6b65 2031 3030  ocksize like 100
+0001aca0: 302e 0a20 2020 2020 2020 202d 2041 2062  0..        - A b
+0001acb0: 6c6f 636b 7368 6170 6520 6c69 6b65 2028  lockshape like (
+0001acc0: 3130 3030 2c20 3130 3030 292e 0a20 2020  1000, 1000)..   
+0001acd0: 2020 2020 202d 2045 7870 6c69 6369 7420       - Explicit 
+0001ace0: 7369 7a65 7320 6f66 2061 6c6c 2062 6c6f  sizes of all blo
+0001acf0: 636b 7320 616c 6f6e 6720 616c 6c20 6469  cks along all di
+0001ad00: 6d65 6e73 696f 6e73 206c 696b 650a 2020  mensions like.  
+0001ad10: 2020 2020 2020 2020 2828 3130 3030 2c20          ((1000, 
+0001ad20: 3130 3030 2c20 3530 3029 2c20 2834 3030  1000, 500), (400
+0001ad30: 2c20 3430 3029 292e 0a20 2020 2020 2020  , 400))..       
+0001ad40: 202d 2041 2073 697a 6520 696e 2062 7974   - A size in byt
+0001ad50: 6573 2c20 6c69 6b65 2022 3130 3020 4d69  es, like "100 Mi
+0001ad60: 4222 2077 6869 6368 2077 696c 6c20 6368  B" which will ch
+0001ad70: 6f6f 7365 2061 2075 6e69 666f 726d 0a20  oose a uniform. 
+0001ad80: 2020 2020 2020 2020 2062 6c6f 636b 2d6c           block-l
+0001ad90: 696b 6520 7368 6170 650a 2020 2020 2020  ike shape.      
+0001ada0: 2020 2d20 5468 6520 776f 7264 2022 6175    - The word "au
+0001adb0: 746f 2220 7768 6963 6820 6163 7473 206c  to" which acts l
+0001adc0: 696b 6520 7468 6520 6162 6f76 652c 2062  ike the above, b
+0001add0: 7574 2075 7365 7320 6120 636f 6e66 6967  ut uses a config
+0001ade0: 7572 6174 696f 6e0a 2020 2020 2020 2020  uration.        
+0001adf0: 2020 7661 6c75 6520 6060 6172 7261 792e    value ``array.
+0001ae00: 6368 756e 6b2d 7369 7a65 6060 2066 6f72  chunk-size`` for
+0001ae10: 2074 6865 2063 6875 6e6b 2073 697a 650a   the chunk size.
+0001ae20: 0a20 2020 2020 2020 202d 3120 6f72 204e  .        -1 or N
+0001ae30: 6f6e 6520 6173 2061 2062 6c6f 636b 7369  one as a blocksi
+0001ae40: 7a65 2069 6e64 6963 6174 6520 7468 6520  ze indicate the 
+0001ae50: 7369 7a65 206f 6620 7468 6520 636f 7272  size of the corr
+0001ae60: 6573 706f 6e64 696e 670a 2020 2020 2020  esponding.      
+0001ae70: 2020 6469 6d65 6e73 696f 6e2e 0a20 2020    dimension..   
+0001ae80: 206e 616d 6520 3a20 7374 7220 6f72 2062   name : str or b
+0001ae90: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+0001aea0: 2020 2020 2020 5468 6520 6b65 7920 6e61        The key na
+0001aeb0: 6d65 2074 6f20 7573 6520 666f 7220 7468  me to use for th
+0001aec0: 6520 6172 7261 792e 2044 6566 6175 6c74  e array. Default
+0001aed0: 7320 746f 2061 2068 6173 6820 6f66 2060  s to a hash of `
+0001aee0: 6078 6060 2e0a 0a20 2020 2020 2020 2048  `x``...        H
+0001aef0: 6173 6869 6e67 2069 7320 7573 6566 756c  ashing is useful
+0001af00: 2069 6620 7468 6520 7361 6d65 2076 616c   if the same val
+0001af10: 7565 206f 6620 6060 7860 6020 6973 2075  ue of ``x`` is u
+0001af20: 7365 6420 746f 2063 7265 6174 6520 6d75  sed to create mu
+0001af30: 6c74 6970 6c65 0a20 2020 2020 2020 2061  ltiple.        a
+0001af40: 7272 6179 732c 2061 7320 4461 736b 2063  rrays, as Dask c
+0001af50: 616e 2074 6865 6e20 7265 636f 676e 6973  an then recognis
+0001af60: 6520 7468 6174 2074 6865 7927 7265 2074  e that they're t
+0001af70: 6865 2073 616d 6520 616e 640a 2020 2020  he same and.    
+0001af80: 2020 2020 6176 6f69 6420 6475 706c 6963      avoid duplic
+0001af90: 6174 6520 636f 6d70 7574 6174 696f 6e73  ate computations
+0001afa0: 2e20 486f 7765 7665 722c 2069 7420 6361  . However, it ca
+0001afb0: 6e20 616c 736f 2062 6520 736c 6f77 2c20  n also be slow, 
+0001afc0: 616e 6420 6966 2074 6865 0a20 2020 2020  and if the.     
+0001afd0: 2020 2061 7272 6179 2069 7320 6e6f 7420     array is not 
+0001afe0: 636f 6e74 6967 756f 7573 2069 7420 6973  contiguous it is
+0001aff0: 2063 6f70 6965 6420 666f 7220 6861 7368   copied for hash
+0001b000: 696e 672e 2049 6620 7468 6520 6172 7261  ing. If the arra
+0001b010: 7920 7573 6573 0a20 2020 2020 2020 2073  y uses.        s
+0001b020: 7472 6964 6520 7472 6963 6b73 2028 7375  tride tricks (su
+0001b030: 6368 2061 7320 3a66 756e 633a 606e 756d  ch as :func:`num
+0001b040: 7079 2e62 726f 6164 6361 7374 5f74 6f60  py.broadcast_to`
+0001b050: 206f 720a 2020 2020 2020 2020 3a66 756e   or.        :fun
+0001b060: 633a 6073 6b69 6d61 6765 2e75 7469 6c2e  c:`skimage.util.
+0001b070: 7669 6577 5f61 735f 7769 6e64 6f77 7360  view_as_windows`
+0001b080: 2920 746f 2068 6176 6520 6120 6c61 7267  ) to have a larg
+0001b090: 6572 206c 6f67 6963 616c 0a20 2020 2020  er logical.     
+0001b0a0: 2020 2074 6861 6e20 7068 7973 6963 616c     than physical
+0001b0b0: 2073 697a 652c 2074 6869 7320 636f 7079   size, this copy
+0001b0c0: 2063 616e 2063 6175 7365 2065 7863 6573   can cause exces
+0001b0d0: 7369 7665 206d 656d 6f72 7920 7573 6167  sive memory usag
+0001b0e0: 652e 0a0a 2020 2020 2020 2020 4966 2079  e...        If y
+0001b0f0: 6f75 2064 6f6e 2774 206e 6565 6420 7468  ou don't need th
+0001b100: 6520 6465 6475 706c 6963 6174 696f 6e20  e deduplication 
+0001b110: 7072 6f76 6964 6564 2062 7920 6861 7368  provided by hash
+0001b120: 696e 672c 2075 7365 0a20 2020 2020 2020  ing, use.       
+0001b130: 2060 606e 616d 653d 4661 6c73 6560 6020   ``name=False`` 
+0001b140: 746f 2067 656e 6572 6174 6520 6120 7261  to generate a ra
+0001b150: 6e64 6f6d 206e 616d 6520 696e 7374 6561  ndom name instea
+0001b160: 6420 6f66 2068 6173 6869 6e67 2c20 7768  d of hashing, wh
+0001b170: 6963 680a 2020 2020 2020 2020 6176 6f69  ich.        avoi
+0001b180: 6473 2074 6865 2070 6974 6661 6c6c 7320  ds the pitfalls 
+0001b190: 6465 7363 7269 6265 6420 6162 6f76 652e  described above.
+0001b1a0: 2055 7369 6e67 2060 606e 616d 653d 5472   Using ``name=Tr
+0001b1b0: 7565 6060 2069 730a 2020 2020 2020 2020  ue`` is.        
+0001b1c0: 6571 7569 7661 6c65 6e74 2074 6f20 7468  equivalent to th
+0001b1d0: 6520 6465 6661 756c 742e 0a0a 2020 2020  e default...    
+0001b1e0: 2020 2020 4279 2064 6566 6175 6c74 2c20      By default, 
+0001b1f0: 6861 7368 696e 6720 7573 6573 2070 7974  hashing uses pyt
+0001b200: 686f 6e27 7320 7374 616e 6461 7264 2073  hon's standard s
+0001b210: 6861 312e 2054 6869 7320 6265 6861 7669  ha1. This behavi
+0001b220: 6f75 7220 6361 6e20 6265 0a20 2020 2020  our can be.     
+0001b230: 2020 2063 6861 6e67 6564 2062 7920 696e     changed by in
+0001b240: 7374 616c 6c69 6e67 2063 6974 7968 6173  stalling cityhas
+0001b250: 682c 2078 7868 6173 6820 6f72 206d 7572  h, xxhash or mur
+0001b260: 6d75 7268 6173 682e 2049 6620 696e 7374  murhash. If inst
+0001b270: 616c 6c65 642c 0a20 2020 2020 2020 2061  alled,.        a
+0001b280: 206c 6172 6765 2d66 6163 746f 7220 7370   large-factor sp
+0001b290: 6565 6475 7020 6361 6e20 6265 206f 6274  eedup can be obt
+0001b2a0: 6169 6e65 6420 696e 2074 6865 2074 6f6b  ained in the tok
+0001b2b0: 656e 6973 6174 696f 6e20 7374 6570 2e0a  enisation step..
+0001b2c0: 0a20 2020 2020 2020 202e 2e20 6e6f 7465  .        .. note
+0001b2d0: 3a3a 0a0a 2020 2020 2020 2020 2020 2042  ::..           B
+0001b2e0: 6563 6175 7365 2074 6869 7320 6060 6e61  ecause this ``na
+0001b2f0: 6d65 6060 2069 7320 7573 6564 2061 7320  me`` is used as 
+0001b300: 7468 6520 6b65 7920 696e 2074 6173 6b20  the key in task 
+0001b310: 6772 6170 6873 2c20 796f 7520 7368 6f75  graphs, you shou
+0001b320: 6c64 0a20 2020 2020 2020 2020 2020 656e  ld.           en
+0001b330: 7375 7265 2074 6861 7420 6974 2075 6e69  sure that it uni
+0001b340: 7175 656c 7920 6964 656e 7469 6669 6573  quely identifies
+0001b350: 2074 6865 2064 6174 6120 636f 6e74 6169   the data contai
+0001b360: 6e65 6420 7769 7468 696e 2e20 4966 0a20  ned within. If. 
+0001b370: 2020 2020 2020 2020 2020 796f 7527 6420            you'd 
+0001b380: 6c69 6b65 2074 6f20 7072 6f76 6964 6520  like to provide 
+0001b390: 6120 6465 7363 7269 7074 6976 6520 6e61  a descriptive na
+0001b3a0: 6d65 2074 6861 7420 6973 2073 7469 6c6c  me that is still
+0001b3b0: 2075 6e69 7175 652c 2063 6f6d 6269 6e65   unique, combine
+0001b3c0: 0a20 2020 2020 2020 2020 2020 7468 6520  .           the 
+0001b3d0: 6465 7363 7269 7074 6976 6520 6e61 6d65  descriptive name
+0001b3e0: 2077 6974 6820 3a66 756e 633a 6064 6173   with :func:`das
+0001b3f0: 6b2e 6261 7365 2e74 6f6b 656e 697a 6560  k.base.tokenize`
+0001b400: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+0001b410: 2020 2060 6061 7272 6179 5f6c 696b 6560     ``array_like`
+0001b420: 602e 2053 6565 203a 7265 663a 6067 7261  `. See :ref:`gra
+0001b430: 7068 7360 2066 6f72 206d 6f72 652e 0a0a  phs` for more...
+0001b440: 2020 2020 6c6f 636b 203a 2062 6f6f 6c20      lock : bool 
+0001b450: 6f72 204c 6f63 6b2c 206f 7074 696f 6e61  or Lock, optiona
+0001b460: 6c0a 2020 2020 2020 2020 4966 2060 6078  l.        If ``x
+0001b470: 6060 2064 6f65 736e 2774 2073 7570 706f  `` doesn't suppo
+0001b480: 7274 2063 6f6e 6375 7272 656e 7420 7265  rt concurrent re
+0001b490: 6164 7320 7468 656e 2070 726f 7669 6465  ads then provide
+0001b4a0: 2061 206c 6f63 6b20 6865 7265 2c20 6f72   a lock here, or
+0001b4b0: 0a20 2020 2020 2020 2070 6173 7320 696e  .        pass in
+0001b4c0: 2054 7275 6520 746f 2068 6176 6520 6461   True to have da
+0001b4d0: 736b 2e61 7272 6179 2063 7265 6174 6520  sk.array create 
+0001b4e0: 6f6e 6520 666f 7220 796f 752e 0a20 2020  one for you..   
+0001b4f0: 2061 7361 7272 6179 203a 2062 6f6f 6c2c   asarray : bool,
+0001b500: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001b510: 2020 4966 2054 7275 6520 7468 656e 2063    If True then c
+0001b520: 616c 6c20 6e70 2e61 7361 7272 6179 206f  all np.asarray o
+0001b530: 6e20 6368 756e 6b73 2074 6f20 636f 6e76  n chunks to conv
+0001b540: 6572 7420 7468 656d 2074 6f20 6e75 6d70  ert them to nump
+0001b550: 7920 6172 7261 7973 2e0a 2020 2020 2020  y arrays..      
+0001b560: 2020 4966 2046 616c 7365 2074 6865 6e20    If False then 
+0001b570: 6368 756e 6b73 2061 7265 2070 6173 7365  chunks are passe
+0001b580: 6420 7468 726f 7567 6820 756e 6368 616e  d through unchan
+0001b590: 6765 642e 0a20 2020 2020 2020 2049 6620  ged..        If 
+0001b5a0: 4e6f 6e65 2028 6465 6661 756c 7429 2074  None (default) t
+0001b5b0: 6865 6e20 7765 2075 7365 2054 7275 6520  hen we use True 
+0001b5c0: 6966 2074 6865 2060 605f 5f61 7272 6179  if the ``__array
+0001b5d0: 5f66 756e 6374 696f 6e5f 5f60 6020 6d65  _function__`` me
+0001b5e0: 7468 6f64 0a20 2020 2020 2020 2069 7320  thod.        is 
+0001b5f0: 756e 6465 6669 6e65 642e 0a0a 2020 2020  undefined...    
+0001b600: 2020 2020 2e2e 206e 6f74 653a 3a0a 0a20      .. note::.. 
+0001b610: 2020 2020 2020 2020 2020 2044 6173 6b20             Dask 
+0001b620: 646f 6573 206e 6f74 2070 7265 7365 7276  does not preserv
+0001b630: 6520 7468 6520 6d65 6d6f 7279 206c 6179  e the memory lay
+0001b640: 6f75 7420 6f66 2074 6865 206f 7269 6769  out of the origi
+0001b650: 6e61 6c20 6172 7261 7920 7768 656e 0a20  nal array when. 
+0001b660: 2020 2020 2020 2020 2020 2074 6865 2061             the a
+0001b670: 7272 6179 2069 7320 6372 6561 7465 6420  rray is created 
+0001b680: 7573 696e 6720 466f 7274 7261 6e20 7261  using Fortran ra
+0001b690: 7468 6572 2074 6861 6e20 4320 6f72 6465  ther than C orde
+0001b6a0: 7269 6e67 2e0a 0a20 2020 2066 616e 6379  ring...    fancy
+0001b6b0: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
+0001b6c0: 6c0a 2020 2020 2020 2020 4966 2060 6078  l.        If ``x
+0001b6d0: 6060 2064 6f65 736e 2774 2073 7570 706f  `` doesn't suppo
+0001b6e0: 7274 2066 616e 6379 2069 6e64 6578 696e  rt fancy indexin
+0001b6f0: 6720 2865 2e67 2e20 696e 6465 7869 6e67  g (e.g. indexing
+0001b700: 2077 6974 6820 6c69 7374 7320 6f72 0a20   with lists or. 
+0001b710: 2020 2020 2020 2061 7272 6179 7329 2074         arrays) t
+0001b720: 6865 6e20 7365 7420 746f 2046 616c 7365  hen set to False
+0001b730: 2e20 4465 6661 756c 7420 6973 2054 7275  . Default is Tru
+0001b740: 652e 0a20 2020 206d 6574 6120 3a20 4172  e..    meta : Ar
+0001b750: 7261 792d 6c69 6b65 2c20 6f70 7469 6f6e  ray-like, option
+0001b760: 616c 0a20 2020 2020 2020 2054 6865 206d  al.        The m
+0001b770: 6574 6164 6174 6120 666f 7220 7468 6520  etadata for the 
+0001b780: 7265 7375 6c74 696e 6720 6461 736b 2061  resulting dask a
+0001b790: 7272 6179 2e20 2054 6869 7320 6973 2074  rray.  This is t
+0001b7a0: 6865 206b 696e 6420 6f66 2061 7272 6179  he kind of array
+0001b7b0: 0a20 2020 2020 2020 2074 6861 7420 7769  .        that wi
+0001b7c0: 6c6c 2072 6573 756c 7420 6672 6f6d 2073  ll result from s
+0001b7d0: 6c69 6369 6e67 2074 6865 2069 6e70 7574  licing the input
+0001b7e0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+0001b7f0: 4465 6661 756c 7473 2074 6f20 7468 6520  Defaults to the 
+0001b800: 696e 7075 7420 6172 7261 792e 0a20 2020  input array..   
+0001b810: 2069 6e6c 696e 655f 6172 7261 7920 3a20   inline_array : 
+0001b820: 626f 6f6c 2c20 6465 6661 756c 7420 4661  bool, default Fa
+0001b830: 6c73 650a 2020 2020 2020 2020 486f 7720  lse.        How 
+0001b840: 746f 2069 6e63 6c75 6465 2074 6865 2061  to include the a
+0001b850: 7272 6179 2069 6e20 7468 6520 7461 736b  rray in the task
+0001b860: 2067 7261 7068 2e20 4279 2064 6566 6175   graph. By defau
+0001b870: 6c74 0a20 2020 2020 2020 2028 6060 696e  lt.        (``in
+0001b880: 6c69 6e65 5f61 7272 6179 3d46 616c 7365  line_array=False
+0001b890: 6060 2920 7468 6520 6172 7261 7920 6973  ``) the array is
+0001b8a0: 2069 6e63 6c75 6465 6420 696e 2061 2074   included in a t
+0001b8b0: 6173 6b20 6279 2069 7473 656c 662c 0a20  ask by itself,. 
+0001b8c0: 2020 2020 2020 2061 6e64 2065 6163 6820         and each 
+0001b8d0: 6368 756e 6b20 7265 6665 7273 2074 6f20  chunk refers to 
+0001b8e0: 7468 6174 2074 6173 6b20 6279 2069 7473  that task by its
+0001b8f0: 206b 6579 2e0a 0a20 2020 2020 2020 202e   key...        .
+0001b900: 2e20 636f 6465 2d62 6c6f 636b 3a3a 2070  . code-block:: p
+0001b910: 7974 686f 6e0a 0a20 2020 2020 2020 2020  ython..         
+0001b920: 2020 3e3e 3e20 7820 3d20 6835 7079 2e46    >>> x = h5py.F
+0001b930: 696c 6528 2264 6174 612e 6835 2229 5b22  ile("data.h5")["
+0001b940: 2f78 225d 2020 2320 646f 6374 6573 743a  /x"]  # doctest:
+0001b950: 202b 534b 4950 0a20 2020 2020 2020 2020   +SKIP.         
+0001b960: 2020 3e3e 3e20 6120 3d20 6461 2e66 726f    >>> a = da.fro
+0001b970: 6d5f 6172 7261 7928 782c 2063 6875 6e6b  m_array(x, chunk
+0001b980: 733d 3530 3029 2020 2320 646f 6374 6573  s=500)  # doctes
+0001b990: 743a 202b 534b 4950 0a20 2020 2020 2020  t: +SKIP.       
+0001b9a0: 2020 2020 3e3e 3e20 6469 6374 2861 2e64      >>> dict(a.d
+0001b9b0: 6173 6b29 2020 2320 646f 6374 6573 743a  ask)  # doctest:
+0001b9c0: 202b 534b 4950 0a20 2020 2020 2020 2020   +SKIP.         
+0001b9d0: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+0001b9e0: 2020 2761 7272 6179 2d6f 7269 6769 6e61    'array-origina
+0001b9f0: 6c2d 3c6e 616d 653e 273a 203c 4844 4635  l-<name>': <HDF5
+0001ba00: 2064 6174 6173 6574 202e 2e2e 3e2c 0a20   dataset ...>,. 
+0001ba10: 2020 2020 2020 2020 2020 2020 2028 2761               ('a
+0001ba20: 7272 6179 2d3c 6e61 6d65 3e27 2c20 3029  rray-<name>', 0)
+0001ba30: 3a20 2867 6574 6974 656d 2c20 2261 7272  : (getitem, "arr
+0001ba40: 6179 2d6f 7269 6769 6e61 6c2d 3c6e 616d  ay-original-<nam
+0001ba50: 653e 222c 202e 2e2e 292c 0a20 2020 2020  e>", ...),.     
+0001ba60: 2020 2020 2020 2020 2028 2761 7272 6179           ('array
+0001ba70: 2d3c 6e61 6d65 3e27 2c20 3129 3a20 2867  -<name>', 1): (g
+0001ba80: 6574 6974 656d 2c20 2261 7272 6179 2d6f  etitem, "array-o
+0001ba90: 7269 6769 6e61 6c2d 3c6e 616d 653e 222c  riginal-<name>",
+0001baa0: 202e 2e2e 290a 2020 2020 2020 2020 2020   ...).          
+0001bab0: 207d 0a0a 2020 2020 2020 2020 5769 7468   }..        With
+0001bac0: 2060 6069 6e6c 696e 655f 6172 7261 793d   ``inline_array=
+0001bad0: 5472 7565 6060 2c20 4461 736b 2077 696c  True``, Dask wil
+0001bae0: 6c20 696e 7374 6561 6420 696e 6c69 6e65  l instead inline
+0001baf0: 2074 6865 2061 7272 6179 2064 6972 6563   the array direc
+0001bb00: 746c 790a 2020 2020 2020 2020 696e 2074  tly.        in t
+0001bb10: 6865 2076 616c 7565 7320 6f66 2074 6865  he values of the
+0001bb20: 2074 6173 6b20 6772 6170 682e 0a0a 2020   task graph...  
+0001bb30: 2020 2020 2020 2e2e 2063 6f64 652d 626c        .. code-bl
+0001bb40: 6f63 6b3a 3a20 7079 7468 6f6e 0a0a 2020  ock:: python..  
+0001bb50: 2020 2020 2020 2020 203e 3e3e 2061 203d           >>> a =
+0001bb60: 2064 612e 6672 6f6d 5f61 7272 6179 2878   da.from_array(x
+0001bb70: 2c20 6368 756e 6b73 3d35 3030 2c20 696e  , chunks=500, in
+0001bb80: 6c69 6e65 5f61 7272 6179 3d54 7275 6529  line_array=True)
+0001bb90: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+0001bba0: 4950 0a20 2020 2020 2020 2020 2020 3e3e  IP.           >>
+0001bbb0: 3e20 6469 6374 2861 2e64 6173 6b29 2020  > dict(a.dask)  
+0001bbc0: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0001bbd0: 0a20 2020 2020 2020 2020 2020 7b0a 2020  .           {.  
+0001bbe0: 2020 2020 2020 2020 2020 2020 2827 6172              ('ar
+0001bbf0: 7261 792d 3c6e 616d 653e 272c 2030 293a  ray-<name>', 0):
+0001bc00: 2028 6765 7469 7465 6d2c 203c 4844 4635   (getitem, <HDF5
+0001bc10: 2064 6174 6173 6574 202e 2e2e 3e2c 202e   dataset ...>, .
+0001bc20: 2e2e 292c 0a20 2020 2020 2020 2020 2020  ..),.           
+0001bc30: 2020 2028 2761 7272 6179 2d3c 6e61 6d65     ('array-<name
+0001bc40: 3e27 2c20 3129 3a20 2867 6574 6974 656d  >', 1): (getitem
+0001bc50: 2c20 3c48 4446 3520 6461 7461 7365 7420  , <HDF5 dataset 
+0001bc60: 2e2e 2e3e 2c20 2e2e 2e29 0a20 2020 2020  ...>, ...).     
+0001bc70: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0001bc80: 204e 6f74 6520 7468 6174 2074 6865 7265   Note that there
+0001bc90: 2773 206e 6f20 6b65 7920 696e 2074 6865  's no key in the
+0001bca0: 2074 6173 6b20 6772 6170 6820 7769 7468   task graph with
+0001bcb0: 206a 7573 7420 7468 6520 6172 7261 7920   just the array 
+0001bcc0: 6078 600a 2020 2020 2020 2020 616e 796d  `x`.        anym
+0001bcd0: 6f72 652e 2049 6e73 7465 6164 2069 7427  ore. Instead it'
+0001bce0: 7320 706c 6163 6564 2064 6972 6563 746c  s placed directl
+0001bcf0: 7920 696e 2074 6865 2076 616c 7565 732e  y in the values.
+0001bd00: 0a0a 2020 2020 2020 2020 5468 6520 7269  ..        The ri
+0001bd10: 6768 7420 6368 6f69 6365 2066 6f72 2060  ght choice for `
+0001bd20: 6069 6e6c 696e 655f 6172 7261 7960 6020  `inline_array`` 
+0001bd30: 6465 7065 6e64 7320 6f6e 2073 6576 6572  depends on sever
+0001bd40: 616c 2066 6163 746f 7273 2c0a 2020 2020  al factors,.    
+0001bd50: 2020 2020 696e 636c 7564 696e 6720 7468      including th
+0001bd60: 6520 7369 7a65 206f 6620 6060 7860 602c  e size of ``x``,
+0001bd70: 2068 6f77 2065 7870 656e 7369 7665 2069   how expensive i
+0001bd80: 7420 6973 2074 6f20 6372 6561 7465 2c20  t is to create, 
+0001bd90: 7768 6963 680a 2020 2020 2020 2020 7363  which.        sc
+0001bda0: 6865 6475 6c65 7220 796f 7527 7265 2075  heduler you're u
+0001bdb0: 7369 6e67 2c20 616e 6420 7468 6520 7061  sing, and the pa
+0001bdc0: 7474 6572 6e20 6f66 2064 6f77 6e73 7472  ttern of downstr
+0001bdd0: 6561 6d20 636f 6d70 7574 6174 696f 6e73  eam computations
+0001bde0: 2e0a 2020 2020 2020 2020 4173 2061 2068  ..        As a h
+0001bdf0: 6575 7269 7374 6963 2c20 6060 696e 6c69  euristic, ``inli
+0001be00: 6e65 5f61 7272 6179 3d54 7275 6560 6020  ne_array=True`` 
+0001be10: 6d61 7920 6265 2074 6865 2072 6967 6874  may be the right
+0001be20: 2063 686f 6963 6520 7768 656e 0a20 2020   choice when.   
+0001be30: 2020 2020 2074 6865 2061 7272 6179 2060       the array `
+0001be40: 6078 6060 2069 7320 6368 6561 7020 746f  `x`` is cheap to
+0001be50: 2073 6572 6961 6c69 7a65 2061 6e64 2064   serialize and d
+0001be60: 6573 6572 6961 6c69 7a65 2028 7369 6e63  eserialize (sinc
+0001be70: 6520 6974 2773 0a20 2020 2020 2020 2069  e it's.        i
+0001be80: 6e63 6c75 6465 6420 696e 2074 6865 2067  ncluded in the g
+0001be90: 7261 7068 206d 616e 7920 7469 6d65 7329  raph many times)
+0001bea0: 2061 6e64 2069 6620 796f 7527 7265 2065   and if you're e
+0001beb0: 7870 6572 6965 6e63 696e 6720 6f72 6465  xperiencing orde
+0001bec0: 7269 6e67 0a20 2020 2020 2020 2069 7373  ring.        iss
+0001bed0: 7565 7320 2873 6565 203a 7265 663a 606f  ues (see :ref:`o
+0001bee0: 7264 6572 6020 666f 7220 6d6f 7265 292e  rder` for more).
+0001bef0: 0a0a 2020 2020 2020 2020 5468 6973 2068  ..        This h
+0001bf00: 6173 206e 6f20 6566 6665 6374 2077 6865  as no effect whe
+0001bf10: 6e20 6060 7860 6020 6973 2061 204e 756d  n ``x`` is a Num
+0001bf20: 5079 2061 7272 6179 2e0a 0a20 2020 2045  Py array...    E
+0001bf30: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
+0001bf40: 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20 7820  ----..    >>> x 
+0001bf50: 3d20 6835 7079 2e46 696c 6528 272e 2e2e  = h5py.File('...
+0001bf60: 2729 5b27 2f64 6174 612f 7061 7468 275d  ')['/data/path']
+0001bf70: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+0001bf80: 4950 0a20 2020 203e 3e3e 2061 203d 2064  IP.    >>> a = d
+0001bf90: 612e 6672 6f6d 5f61 7272 6179 2878 2c20  a.from_array(x, 
+0001bfa0: 6368 756e 6b73 3d28 3130 3030 2c20 3130  chunks=(1000, 10
+0001bfb0: 3030 2929 2020 2320 646f 6374 6573 743a  00))  # doctest:
+0001bfc0: 202b 534b 4950 0a0a 2020 2020 4966 2079   +SKIP..    If y
+0001bfd0: 6f75 7220 756e 6465 726c 7969 6e67 2064  our underlying d
+0001bfe0: 6174 6173 746f 7265 2064 6f65 7320 6e6f  atastore does no
+0001bff0: 7420 7375 7070 6f72 7420 636f 6e63 7572  t support concur
+0001c000: 7265 6e74 2072 6561 6473 2074 6865 6e20  rent reads then 
+0001c010: 696e 636c 7564 650a 2020 2020 7468 6520  include.    the 
+0001c020: 6060 6c6f 636b 3d54 7275 6560 6020 6b65  ``lock=True`` ke
+0001c030: 7977 6f72 6420 6172 6775 6d65 6e74 206f  yword argument o
+0001c040: 7220 6060 6c6f 636b 3d6d 796c 6f63 6b60  r ``lock=mylock`
+0001c050: 6020 6966 2079 6f75 2077 616e 7420 6d75  ` if you want mu
+0001c060: 6c74 6970 6c65 0a20 2020 2061 7272 6179  ltiple.    array
+0001c070: 7320 746f 2063 6f6f 7264 696e 6174 6520  s to coordinate 
+0001c080: 6172 6f75 6e64 2074 6865 2073 616d 6520  around the same 
+0001c090: 6c6f 636b 2e0a 0a20 2020 203e 3e3e 2061  lock...    >>> a
+0001c0a0: 203d 2064 612e 6672 6f6d 5f61 7272 6179   = da.from_array
+0001c0b0: 2878 2c20 6368 756e 6b73 3d28 3130 3030  (x, chunks=(1000
+0001c0c0: 2c20 3130 3030 292c 206c 6f63 6b3d 5472  , 1000), lock=Tr
+0001c0d0: 7565 2920 2023 2064 6f63 7465 7374 3a20  ue)  # doctest: 
+0001c0e0: 2b53 4b49 500a 0a20 2020 2049 6620 796f  +SKIP..    If yo
+0001c0f0: 7572 2075 6e64 6572 6c79 696e 6720 6461  ur underlying da
+0001c100: 7461 7374 6f72 6520 6861 7320 6120 6060  tastore has a ``
+0001c110: 2e63 6875 6e6b 7360 6020 6174 7472 6962  .chunks`` attrib
+0001c120: 7574 6520 2861 7320 6835 7079 2061 6e64  ute (as h5py and
+0001c130: 207a 6172 720a 2020 2020 6461 7461 7365   zarr.    datase
+0001c140: 7473 2064 6f29 2074 6865 6e20 6120 6d75  ts do) then a mu
+0001c150: 6c74 6970 6c65 206f 6620 7468 6174 2063  ltiple of that c
+0001c160: 6875 6e6b 2073 6861 7065 2077 696c 6c20  hunk shape will 
+0001c170: 6265 2075 7365 6420 6966 2079 6f75 0a20  be used if you. 
+0001c180: 2020 2064 6f20 6e6f 7420 7072 6f76 6964     do not provid
+0001c190: 6520 6120 6368 756e 6b20 7368 6170 652e  e a chunk shape.
+0001c1a0: 0a0a 2020 2020 3e3e 3e20 6120 3d20 6461  ..    >>> a = da
+0001c1b0: 2e66 726f 6d5f 6172 7261 7928 782c 2063  .from_array(x, c
+0001c1c0: 6875 6e6b 733d 2761 7574 6f27 2920 2023  hunks='auto')  #
+0001c1d0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
+0001c1e0: 2020 2020 3e3e 3e20 6120 3d20 6461 2e66      >>> a = da.f
+0001c1f0: 726f 6d5f 6172 7261 7928 782c 2063 6875  rom_array(x, chu
+0001c200: 6e6b 733d 2731 3030 204d 6942 2729 2020  nks='100 MiB')  
+0001c210: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0001c220: 0a20 2020 203e 3e3e 2061 203d 2064 612e  .    >>> a = da.
+0001c230: 6672 6f6d 5f61 7272 6179 2878 2920 2023  from_array(x)  #
+0001c240: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
+0001c250: 0a20 2020 2049 6620 7072 6f76 6964 696e  .    If providin
+0001c260: 6720 6120 6e61 6d65 2c20 656e 7375 7265  g a name, ensure
+0001c270: 2074 6861 7420 6974 2069 7320 756e 6971   that it is uniq
+0001c280: 7565 0a0a 2020 2020 3e3e 3e20 696d 706f  ue..    >>> impo
+0001c290: 7274 2064 6173 6b2e 6261 7365 0a20 2020  rt dask.base.   
+0001c2a0: 203e 3e3e 2074 6f6b 656e 203d 2064 6173   >>> token = das
+0001c2b0: 6b2e 6261 7365 2e74 6f6b 656e 697a 6528  k.base.tokenize(
+0001c2c0: 7829 2020 2320 646f 6374 6573 743a 202b  x)  # doctest: +
+0001c2d0: 534b 4950 0a20 2020 203e 3e3e 2061 203d  SKIP.    >>> a =
+0001c2e0: 2064 612e 6672 6f6d 5f61 7272 6179 2827   da.from_array('
+0001c2f0: 6d79 6172 7261 792d 2720 2b20 746f 6b65  myarray-' + toke
+0001c300: 6e29 2020 2320 646f 6374 6573 743a 202b  n)  # doctest: +
+0001c310: 534b 4950 0a0a 2020 2020 4e75 6d50 7920  SKIP..    NumPy 
+0001c320: 6e64 6172 7261 7973 2061 7265 2065 6167  ndarrays are eag
+0001c330: 6572 6c79 2073 6c69 6365 6420 616e 6420  erly sliced and 
+0001c340: 7468 656e 2065 6d62 6564 6465 6420 696e  then embedded in
+0001c350: 2074 6865 2067 7261 7068 2e0a 0a20 2020   the graph...   
+0001c360: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
+0001c370: 2e61 7272 6179 0a20 2020 203e 3e3e 2061  .array.    >>> a
+0001c380: 203d 2064 6173 6b2e 6172 7261 792e 6672   = dask.array.fr
+0001c390: 6f6d 5f61 7272 6179 286e 702e 6172 7261  om_array(np.arra
+0001c3a0: 7928 5b5b 312c 2032 5d2c 205b 332c 2034  y([[1, 2], [3, 4
+0001c3b0: 5d5d 292c 2063 6875 6e6b 733d 2831 2c31  ]]), chunks=(1,1
+0001c3c0: 2929 0a20 2020 203e 3e3e 2061 2e64 6173  )).    >>> a.das
+0001c3d0: 6b5b 612e 6e61 6d65 2c20 302c 2030 5d5b  k[a.name, 0, 0][
+0001c3e0: 305d 0a20 2020 2061 7272 6179 285b 315d  0].    array([1]
+0001c3f0: 290a 0a20 2020 2043 6875 6e6b 7320 7769  )..    Chunks wi
+0001c400: 7468 2065 7861 6374 6c79 2d73 7065 6369  th exactly-speci
+0001c410: 6669 6564 2c20 6469 6666 6572 656e 7420  fied, different 
+0001c420: 7369 7a65 7320 6361 6e20 6265 2063 7265  sizes can be cre
+0001c430: 6174 6564 2e0a 0a20 2020 203e 3e3e 2069  ated...    >>> i
+0001c440: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+0001c450: 700a 2020 2020 3e3e 3e20 696d 706f 7274  p.    >>> import
+0001c460: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
+0001c470: 610a 2020 2020 3e3e 3e20 726e 6720 3d20  a.    >>> rng = 
+0001c480: 6e70 2e72 616e 646f 6d2e 6465 6661 756c  np.random.defaul
+0001c490: 745f 726e 6728 290a 2020 2020 3e3e 3e20  t_rng().    >>> 
+0001c4a0: 7820 3d20 726e 672e 7261 6e64 6f6d 2828  x = rng.random((
+0001c4b0: 3130 302c 2036 2929 0a20 2020 203e 3e3e  100, 6)).    >>>
+0001c4c0: 2061 203d 2064 612e 6672 6f6d 5f61 7272   a = da.from_arr
+0001c4d0: 6179 2878 2c20 6368 756e 6b73 3d28 2836  ay(x, chunks=((6
+0001c4e0: 372c 2033 3329 2c20 2836 2c29 2929 0a20  7, 33), (6,))). 
+0001c4f0: 2020 2022 2222 0a20 2020 2069 6620 6973     """.    if is
+0001c500: 696e 7374 616e 6365 2878 2c20 4172 7261  instance(x, Arra
+0001c510: 7929 3a0a 2020 2020 2020 2020 7261 6973  y):.        rais
+0001c520: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+0001c530: 2020 2020 2020 2020 2020 2241 7272 6179            "Array
+0001c540: 2069 7320 616c 7265 6164 7920 6120 6461   is already a da
+0001c550: 736b 2061 7272 6179 2e20 5573 6520 2761  sk array. Use 'a
+0001c560: 7361 7272 6179 2720 6f72 2022 2022 2772  sarray' or " "'r
+0001c570: 6563 6875 6e6b 2720 696e 7374 6561 642e  echunk' instead.
+0001c580: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+0001c590: 656c 6966 2069 735f 6461 736b 5f63 6f6c  elif is_dask_col
+0001c5a0: 6c65 6374 696f 6e28 7829 3a0a 2020 2020  lection(x):.    
+0001c5b0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
+0001c5c0: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
+0001c5d0: 5061 7373 696e 6720 616e 206f 626a 6563  Passing an objec
+0001c5e0: 7420 746f 2064 6173 6b2e 6172 7261 792e  t to dask.array.
+0001c5f0: 6672 6f6d 5f61 7272 6179 2077 6869 6368  from_array which
+0001c600: 2069 7320 616c 7265 6164 7920 6120 220a   is already a ".
+0001c610: 2020 2020 2020 2020 2020 2020 2244 6173              "Das
+0001c620: 6b20 636f 6c6c 6563 7469 6f6e 2e20 5468  k collection. Th
+0001c630: 6973 2063 616e 206c 6561 6420 746f 2075  is can lead to u
+0001c640: 6e65 7870 6563 7465 6420 6265 6861 7669  nexpected behavi
+0001c650: 6f72 2e22 0a20 2020 2020 2020 2029 0a0a  or.".        )..
+0001c660: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001c670: 6528 782c 2028 6c69 7374 2c20 7475 706c  e(x, (list, tupl
+0001c680: 652c 206d 656d 6f72 7976 6965 7729 202b  e, memoryview) +
+0001c690: 206e 702e 5363 616c 6172 5479 7065 293a   np.ScalarType):
+0001c6a0: 0a20 2020 2020 2020 2078 203d 206e 702e  .        x = np.
+0001c6b0: 6172 7261 7928 7829 0a0a 2020 2020 6966  array(x)..    if
+0001c6c0: 2061 7361 7272 6179 2069 7320 4e6f 6e65   asarray is None
+0001c6d0: 3a0a 2020 2020 2020 2020 6173 6172 7261  :.        asarra
+0001c6e0: 7920 3d20 6e6f 7420 6861 7361 7474 7228  y = not hasattr(
+0001c6f0: 782c 2022 5f5f 6172 7261 795f 6675 6e63  x, "__array_func
+0001c700: 7469 6f6e 5f5f 2229 0a0a 2020 2020 7072  tion__")..    pr
+0001c710: 6576 696f 7573 5f63 6875 6e6b 7320 3d20  evious_chunks = 
+0001c720: 6765 7461 7474 7228 782c 2022 6368 756e  getattr(x, "chun
+0001c730: 6b73 222c 204e 6f6e 6529 0a0a 2020 2020  ks", None)..    
+0001c740: 6368 756e 6b73 203d 206e 6f72 6d61 6c69  chunks = normali
+0001c750: 7a65 5f63 6875 6e6b 7328 0a20 2020 2020  ze_chunks(.     
+0001c760: 2020 2063 6875 6e6b 732c 2078 2e73 6861     chunks, x.sha
+0001c770: 7065 2c20 6474 7970 653d 782e 6474 7970  pe, dtype=x.dtyp
+0001c780: 652c 2070 7265 7669 6f75 735f 6368 756e  e, previous_chun
+0001c790: 6b73 3d70 7265 7669 6f75 735f 6368 756e  ks=previous_chun
+0001c7a0: 6b73 0a20 2020 2029 0a0a 2020 2020 6966  ks.    )..    if
+0001c7b0: 206e 616d 6520 696e 2028 4e6f 6e65 2c20   name in (None, 
+0001c7c0: 5472 7565 293a 0a20 2020 2020 2020 2074  True):.        t
+0001c7d0: 6f6b 656e 203d 2074 6f6b 656e 697a 6528  oken = tokenize(
+0001c7e0: 782c 2063 6875 6e6b 732c 206c 6f63 6b2c  x, chunks, lock,
+0001c7f0: 2061 7361 7272 6179 2c20 6661 6e63 792c   asarray, fancy,
+0001c800: 2067 6574 6974 656d 2c20 696e 6c69 6e65   getitem, inline
+0001c810: 5f61 7272 6179 290a 2020 2020 2020 2020  _array).        
+0001c820: 6e61 6d65 203d 206e 616d 6520 6f72 2022  name = name or "
+0001c830: 6172 7261 792d 2220 2b20 746f 6b65 6e0a  array-" + token.
+0001c840: 2020 2020 656c 6966 206e 616d 6520 6973      elif name is
+0001c850: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
+0001c860: 6e61 6d65 203d 2022 6172 7261 792d 2220  name = "array-" 
+0001c870: 2b20 7374 7228 7575 6964 2e75 7569 6431  + str(uuid.uuid1
+0001c880: 2829 290a 0a20 2020 2069 6620 6c6f 636b  ())..    if lock
+0001c890: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
+0001c8a0: 2020 6c6f 636b 203d 2053 6572 6961 6c69    lock = Seriali
+0001c8b0: 7a61 626c 654c 6f63 6b28 290a 0a20 2020  zableLock()..   
+0001c8c0: 2069 735f 6e64 6172 7261 7920 3d20 7479   is_ndarray = ty
+0001c8d0: 7065 2878 2920 696e 2028 6e70 2e6e 6461  pe(x) in (np.nda
+0001c8e0: 7272 6179 2c20 6e70 2e6d 612e 636f 7265  rray, np.ma.core
+0001c8f0: 2e4d 6173 6b65 6441 7272 6179 290a 2020  .MaskedArray).  
+0001c900: 2020 6973 5f73 696e 676c 655f 626c 6f63    is_single_bloc
+0001c910: 6b20 3d20 616c 6c28 6c65 6e28 6329 203d  k = all(len(c) =
+0001c920: 3d20 3120 666f 7220 6320 696e 2063 6875  = 1 for c in chu
+0001c930: 6e6b 7329 0a20 2020 2023 2041 6c77 6179  nks).    # Alway
+0001c940: 7320 7573 6520 7468 6520 6765 7474 6572  s use the getter
+0001c950: 2066 6f72 2068 3570 7920 6574 632e 204e   for h5py etc. N
+0001c960: 6f74 2075 7369 6e67 2069 7369 6e73 7461  ot using isinsta
+0001c970: 6e63 6528 782c 206e 702e 6e64 6172 7261  nce(x, np.ndarra
+0001c980: 7929 0a20 2020 2023 2062 6563 6175 7365  y).    # because
+0001c990: 206e 702e 6d61 7472 6978 2069 7320 6120   np.matrix is a 
+0001c9a0: 7375 6263 6c61 7373 206f 6620 6e70 2e6e  subclass of np.n
+0001c9b0: 6461 7272 6179 2e0a 2020 2020 6966 2069  darray..    if i
+0001c9c0: 735f 6e64 6172 7261 7920 616e 6420 6e6f  s_ndarray and no
+0001c9d0: 7420 6973 5f73 696e 676c 655f 626c 6f63  t is_single_bloc
+0001c9e0: 6b20 616e 6420 6e6f 7420 6c6f 636b 3a0a  k and not lock:.
+0001c9f0: 2020 2020 2020 2020 2320 6561 6765 726c          # eagerl
+0001ca00: 7920 736c 6963 6520 6e75 6d70 7920 6172  y slice numpy ar
+0001ca10: 7261 7973 2074 6f20 7072 6576 656e 7420  rays to prevent 
+0001ca20: 6d65 6d6f 7279 2062 6c6f 7775 700a 2020  memory blowup.  
+0001ca30: 2020 2020 2020 2320 4748 3533 3637 2c20        # GH5367, 
+0001ca40: 4748 3536 3031 0a20 2020 2020 2020 2073  GH5601.        s
+0001ca50: 6c69 6365 7320 3d20 736c 6963 6573 5f66  lices = slices_f
+0001ca60: 726f 6d5f 6368 756e 6b73 2863 6875 6e6b  rom_chunks(chunk
+0001ca70: 7329 0a20 2020 2020 2020 206b 6579 7320  s).        keys 
+0001ca80: 3d20 7072 6f64 7563 7428 5b6e 616d 655d  = product([name]
+0001ca90: 2c20 2a28 7261 6e67 6528 6c65 6e28 6264  , *(range(len(bd
+0001caa0: 7329 2920 666f 7220 6264 7320 696e 2063  s)) for bds in c
+0001cab0: 6875 6e6b 7329 290a 2020 2020 2020 2020  hunks)).        
+0001cac0: 7661 6c75 6573 203d 205b 785b 736c 635d  values = [x[slc]
+0001cad0: 2066 6f72 2073 6c63 2069 6e20 736c 6963   for slc in slic
+0001cae0: 6573 5d0a 2020 2020 2020 2020 6473 6b20  es].        dsk 
+0001caf0: 3d20 6469 6374 287a 6970 286b 6579 732c  = dict(zip(keys,
+0001cb00: 2076 616c 7565 7329 290a 0a20 2020 2065   values))..    e
+0001cb10: 6c69 6620 6973 5f6e 6461 7272 6179 2061  lif is_ndarray a
+0001cb20: 6e64 2069 735f 7369 6e67 6c65 5f62 6c6f  nd is_single_blo
+0001cb30: 636b 3a0a 2020 2020 2020 2020 2320 4e6f  ck:.        # No
+0001cb40: 2073 6c69 6369 6e67 206e 6565 6465 640a   slicing needed.
+0001cb50: 2020 2020 2020 2020 6473 6b20 3d20 7b28          dsk = {(
+0001cb60: 6e61 6d65 2c29 202b 2028 302c 2920 2a20  name,) + (0,) * 
+0001cb70: 782e 6e64 696d 3a20 787d 0a20 2020 2065  x.ndim: x}.    e
+0001cb80: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
+0001cb90: 6765 7469 7465 6d20 6973 204e 6f6e 653a  getitem is None:
+0001cba0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001cbb0: 6661 6e63 793a 0a20 2020 2020 2020 2020  fancy:.         
+0001cbc0: 2020 2020 2020 2067 6574 6974 656d 203d         getitem =
+0001cbd0: 2067 6574 7465 720a 2020 2020 2020 2020   getter.        
+0001cbe0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001cbf0: 2020 2020 2020 2020 2020 6765 7469 7465            getite
+0001cc00: 6d20 3d20 6765 7474 6572 5f6e 6f66 616e  m = getter_nofan
+0001cc10: 6379 0a0a 2020 2020 2020 2020 6473 6b20  cy..        dsk 
+0001cc20: 3d20 6772 6170 685f 6672 6f6d 5f61 7272  = graph_from_arr
+0001cc30: 6179 6c69 6b65 280a 2020 2020 2020 2020  aylike(.        
+0001cc40: 2020 2020 782c 0a20 2020 2020 2020 2020      x,.         
+0001cc50: 2020 2063 6875 6e6b 732c 0a20 2020 2020     chunks,.     
+0001cc60: 2020 2020 2020 2078 2e73 6861 7065 2c0a         x.shape,.
+0001cc70: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0001cc80: 2c0a 2020 2020 2020 2020 2020 2020 6765  ,.            ge
+0001cc90: 7469 7465 6d3d 6765 7469 7465 6d2c 0a20  titem=getitem,. 
+0001cca0: 2020 2020 2020 2020 2020 206c 6f63 6b3d             lock=
+0001ccb0: 6c6f 636b 2c0a 2020 2020 2020 2020 2020  lock,.          
+0001ccc0: 2020 6173 6172 7261 793d 6173 6172 7261    asarray=asarra
+0001ccd0: 792c 0a20 2020 2020 2020 2020 2020 2064  y,.            d
+0001cce0: 7479 7065 3d78 2e64 7479 7065 2c0a 2020  type=x.dtype,.  
+0001ccf0: 2020 2020 2020 2020 2020 696e 6c69 6e65            inline
+0001cd00: 5f61 7272 6179 3d69 6e6c 696e 655f 6172  _array=inline_ar
+0001cd10: 7261 792c 0a20 2020 2020 2020 2029 0a0a  ray,.        )..
+0001cd20: 2020 2020 2320 576f 726b 6172 6f75 6e64      # Workaround
+0001cd30: 2066 6f72 2054 696c 6544 422c 2069 7473   for TileDB, its
+0001cd40: 2069 6e64 6578 696e 6720 6973 2031 2d62   indexing is 1-b
+0001cd50: 6173 6564 2c0a 2020 2020 2320 616e 6420  ased,.    # and 
+0001cd60: 646f 6573 6e27 7420 7365 656d 7320 746f  doesn't seems to
+0001cd70: 2073 7570 706f 7274 2030 2d6c 656e 6774   support 0-lengt
+0001cd80: 6820 736c 6963 696e 670a 2020 2020 6966  h slicing.    if
+0001cd90: 2078 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6d   x.__class__.__m
+0001cda0: 6f64 756c 655f 5f2e 7370 6c69 7428 222e  odule__.split(".
+0001cdb0: 2229 5b30 5d20 3d3d 2022 7469 6c65 6462  ")[0] == "tiledb
+0001cdc0: 2220 616e 6420 6861 7361 7474 7228 782c  " and hasattr(x,
+0001cdd0: 2022 5f63 7478 5f22 293a 0a20 2020 2020   "_ctx_"):.     
+0001cde0: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
+0001cdf0: 6473 6b2c 206e 616d 652c 2063 6875 6e6b  dsk, name, chunk
+0001ce00: 732c 2064 7479 7065 3d78 2e64 7479 7065  s, dtype=x.dtype
+0001ce10: 290a 0a20 2020 2069 6620 6d65 7461 2069  )..    if meta i
+0001ce20: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001ce30: 6d65 7461 203d 2078 0a0a 2020 2020 7265  meta = x..    re
+0001ce40: 7475 726e 2041 7272 6179 2864 736b 2c20  turn Array(dsk, 
+0001ce50: 6e61 6d65 2c20 6368 756e 6b73 2c20 6d65  name, chunks, me
+0001ce60: 7461 3d6d 6574 612c 2064 7479 7065 3d67  ta=meta, dtype=g
+0001ce70: 6574 6174 7472 2878 2c20 2264 7479 7065  etattr(x, "dtype
+0001ce80: 222c 204e 6f6e 6529 290a 0a0a 6465 6620  ", None))...def 
+0001ce90: 6672 6f6d 5f7a 6172 7228 0a20 2020 2075  from_zarr(.    u
+0001cea0: 726c 2c0a 2020 2020 636f 6d70 6f6e 656e  rl,.    componen
+0001ceb0: 743d 4e6f 6e65 2c0a 2020 2020 7374 6f72  t=None,.    stor
+0001cec0: 6167 655f 6f70 7469 6f6e 733d 4e6f 6e65  age_options=None
+0001ced0: 2c0a 2020 2020 6368 756e 6b73 3d4e 6f6e  ,.    chunks=Non
+0001cee0: 652c 0a20 2020 206e 616d 653d 4e6f 6e65  e,.    name=None
+0001cef0: 2c0a 2020 2020 696e 6c69 6e65 5f61 7272  ,.    inline_arr
+0001cf00: 6179 3d46 616c 7365 2c0a 2020 2020 2a2a  ay=False,.    **
+0001cf10: 6b77 6172 6773 2c0a 293a 0a20 2020 2022  kwargs,.):.    "
+0001cf20: 2222 4c6f 6164 2061 7272 6179 2066 726f  ""Load array fro
+0001cf30: 6d20 7468 6520 7a61 7272 2073 746f 7261  m the zarr stora
+0001cf40: 6765 2066 6f72 6d61 740a 0a20 2020 2053  ge format..    S
+0001cf50: 6565 2068 7474 7073 3a2f 2f7a 6172 722e  ee https://zarr.
+0001cf60: 7265 6164 7468 6564 6f63 732e 696f 2066  readthedocs.io f
+0001cf70: 6f72 2064 6574 6169 6c73 2061 626f 7574  or details about
+0001cf80: 2074 6865 2066 6f72 6d61 742e 0a0a 2020   the format...  
+0001cf90: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0001cfa0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0001cfb0: 7572 6c3a 205a 6172 7220 4172 7261 7920  url: Zarr Array 
+0001cfc0: 6f72 2073 7472 206f 7220 4d75 7461 626c  or str or Mutabl
+0001cfd0: 654d 6170 7069 6e67 0a20 2020 2020 2020  eMapping.       
+0001cfe0: 204c 6f63 6174 696f 6e20 6f66 2074 6865   Location of the
+0001cff0: 2064 6174 612e 2041 2055 524c 2063 616e   data. A URL can
+0001d000: 2069 6e63 6c75 6465 2061 2070 726f 746f   include a proto
+0001d010: 636f 6c20 7370 6563 6966 6965 7220 6c69  col specifier li
+0001d020: 6b65 2073 333a 2f2f 0a20 2020 2020 2020  ke s3://.       
+0001d030: 2066 6f72 2072 656d 6f74 6520 6461 7461   for remote data
+0001d040: 2e20 4361 6e20 616c 736f 2062 6520 616e  . Can also be an
+0001d050: 7920 4d75 7461 626c 654d 6170 7069 6e67  y MutableMapping
+0001d060: 2069 6e73 7461 6e63 652c 2077 6869 6368   instance, which
+0001d070: 2073 686f 756c 640a 2020 2020 2020 2020   should.        
+0001d080: 6265 2073 6572 6961 6c69 7a61 626c 6520  be serializable 
+0001d090: 6966 2075 7365 6420 696e 206d 756c 7469  if used in multi
+0001d0a0: 706c 6520 7072 6f63 6573 7365 732e 0a20  ple processes.. 
+0001d0b0: 2020 2063 6f6d 706f 6e65 6e74 3a20 7374     component: st
+0001d0c0: 7220 6f72 204e 6f6e 650a 2020 2020 2020  r or None.      
+0001d0d0: 2020 4966 2074 6865 206c 6f63 6174 696f    If the locatio
+0001d0e0: 6e20 6973 2061 207a 6172 7220 6772 6f75  n is a zarr grou
+0001d0f0: 7020 7261 7468 6572 2074 6861 6e20 616e  p rather than an
+0001d100: 2061 7272 6179 2c20 7468 6973 2069 7320   array, this is 
+0001d110: 7468 650a 2020 2020 2020 2020 7375 6263  the.        subc
+0001d120: 6f6d 706f 6e65 6e74 2074 6861 7420 7368  omponent that sh
+0001d130: 6f75 6c64 2062 6520 6c6f 6164 6564 2c20  ould be loaded, 
+0001d140: 736f 6d65 7468 696e 6720 6c69 6b65 2060  something like `
+0001d150: 6027 666f 6f2f 6261 7227 6060 2e0a 2020  `'foo/bar'``..  
+0001d160: 2020 7374 6f72 6167 655f 6f70 7469 6f6e    storage_option
+0001d170: 733a 2064 6963 740a 2020 2020 2020 2020  s: dict.        
+0001d180: 416e 7920 6164 6469 7469 6f6e 616c 2070  Any additional p
+0001d190: 6172 616d 6574 6572 7320 666f 7220 7468  arameters for th
+0001d1a0: 6520 7374 6f72 6167 6520 6261 636b 656e  e storage backen
+0001d1b0: 6420 2869 676e 6f72 6564 2066 6f72 206c  d (ignored for l
+0001d1c0: 6f63 616c 0a20 2020 2020 2020 2070 6174  ocal.        pat
+0001d1d0: 6873 290a 2020 2020 6368 756e 6b73 3a20  hs).    chunks: 
+0001d1e0: 7475 706c 6520 6f66 2069 6e74 7320 6f72  tuple of ints or
+0001d1f0: 2074 7570 6c65 7320 6f66 2069 6e74 730a   tuples of ints.
+0001d200: 2020 2020 2020 2020 5061 7373 6564 2074          Passed t
+0001d210: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
+0001d220: 7261 792e 6672 6f6d 5f61 7272 6179 602c  ray.from_array`,
+0001d230: 2061 6c6c 6f77 7320 7365 7474 696e 6720   allows setting 
+0001d240: 7468 6520 6368 756e 6b73 206f 6e0a 2020  the chunks on.  
+0001d250: 2020 2020 2020 696e 6974 6961 6c69 7361        initialisa
+0001d260: 7469 6f6e 2c20 6966 2074 6865 2063 6875  tion, if the chu
+0001d270: 6e6b 696e 6720 7363 6865 6d65 2069 6e20  nking scheme in 
+0001d280: 7468 6520 6f6e 2d64 6973 6320 6461 7461  the on-disc data
+0001d290: 7365 7420 6973 206e 6f74 0a20 2020 2020  set is not.     
+0001d2a0: 2020 206f 7074 696d 616c 2066 6f72 2074     optimal for t
+0001d2b0: 6865 2063 616c 6375 6c61 7469 6f6e 7320  he calculations 
+0001d2c0: 746f 2066 6f6c 6c6f 772e 0a20 2020 206e  to follow..    n
+0001d2d0: 616d 6520 3a20 7374 722c 206f 7074 696f  ame : str, optio
+0001d2e0: 6e61 6c0a 2020 2020 2020 2020 2041 6e20  nal.         An 
+0001d2f0: 6f70 7469 6f6e 616c 206b 6579 6e61 6d65  optional keyname
+0001d300: 2066 6f72 2074 6865 2061 7272 6179 2e20   for the array. 
+0001d310: 2044 6566 6175 6c74 7320 746f 2068 6173   Defaults to has
+0001d320: 6869 6e67 2074 6865 2069 6e70 7574 0a20  hing the input. 
+0001d330: 2020 206b 7761 7267 733a 0a20 2020 2020     kwargs:.     
+0001d340: 2020 2050 6173 7365 6420 746f 203a 636c     Passed to :cl
+0001d350: 6173 733a 607a 6172 722e 636f 7265 2e41  ass:`zarr.core.A
+0001d360: 7272 6179 602e 0a20 2020 2069 6e6c 696e  rray`..    inlin
+0001d370: 655f 6172 7261 7920 3a20 626f 6f6c 2c20  e_array : bool, 
+0001d380: 6465 6661 756c 7420 4661 6c73 650a 2020  default False.  
+0001d390: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+0001d3a0: 2069 6e6c 696e 6520 7468 6520 7a61 7272   inline the zarr
+0001d3b0: 2041 7272 6179 2069 6e20 7468 6520 7661   Array in the va
+0001d3c0: 6c75 6573 206f 6620 7468 6520 7461 736b  lues of the task
+0001d3d0: 2067 7261 7068 2e0a 2020 2020 2020 2020   graph..        
+0001d3e0: 5365 6520 3a6d 6574 683a 6064 6173 6b2e  See :meth:`dask.
+0001d3f0: 6172 7261 792e 6672 6f6d 5f61 7272 6179  array.from_array
+0001d400: 6020 666f 7220 616e 2065 7870 6c61 6e61  ` for an explana
+0001d410: 7469 6f6e 2e0a 0a20 2020 2053 6565 2041  tion...    See A
+0001d420: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
+0001d430: 0a20 2020 2066 726f 6d5f 6172 7261 790a  .    from_array.
+0001d440: 2020 2020 2222 220a 2020 2020 696d 706f      """.    impo
+0001d450: 7274 207a 6172 720a 0a20 2020 2073 746f  rt zarr..    sto
+0001d460: 7261 6765 5f6f 7074 696f 6e73 203d 2073  rage_options = s
+0001d470: 746f 7261 6765 5f6f 7074 696f 6e73 206f  torage_options o
+0001d480: 7220 7b7d 0a20 2020 2069 6620 6973 696e  r {}.    if isin
+0001d490: 7374 616e 6365 2875 726c 2c20 7a61 7272  stance(url, zarr
+0001d4a0: 2e41 7272 6179 293a 0a20 2020 2020 2020  .Array):.       
+0001d4b0: 207a 203d 2075 726c 0a20 2020 2065 6c69   z = url.    eli
+0001d4c0: 6620 6973 696e 7374 616e 6365 2875 726c  f isinstance(url
+0001d4d0: 2c20 2873 7472 2c20 6f73 2e50 6174 684c  , (str, os.PathL
+0001d4e0: 696b 6529 293a 0a20 2020 2020 2020 2069  ike)):.        i
+0001d4f0: 6620 6973 696e 7374 616e 6365 2875 726c  f isinstance(url
+0001d500: 2c20 6f73 2e50 6174 684c 696b 6529 3a0a  , os.PathLike):.
+0001d510: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
+0001d520: 3d20 6f73 2e66 7370 6174 6828 7572 6c29  = os.fspath(url)
+0001d530: 0a20 2020 2020 2020 2069 6620 7374 6f72  .        if stor
+0001d540: 6167 655f 6f70 7469 6f6e 733a 0a20 2020  age_options:.   
+0001d550: 2020 2020 2020 2020 2073 746f 7265 203d           store =
+0001d560: 207a 6172 722e 7374 6f72 6167 652e 4653   zarr.storage.FS
+0001d570: 5374 6f72 6528 7572 6c2c 202a 2a73 746f  Store(url, **sto
+0001d580: 7261 6765 5f6f 7074 696f 6e73 290a 2020  rage_options).  
+0001d590: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001d5a0: 2020 2020 2020 2020 7374 6f72 6520 3d20          store = 
+0001d5b0: 7572 6c0a 2020 2020 2020 2020 7a20 3d20  url.        z = 
+0001d5c0: 7a61 7272 2e41 7272 6179 2873 746f 7265  zarr.Array(store
+0001d5d0: 2c20 7265 6164 5f6f 6e6c 793d 5472 7565  , read_only=True
+0001d5e0: 2c20 7061 7468 3d63 6f6d 706f 6e65 6e74  , path=component
+0001d5f0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0001d600: 656c 7365 3a0a 2020 2020 2020 2020 7a20  else:.        z 
+0001d610: 3d20 7a61 7272 2e41 7272 6179 2875 726c  = zarr.Array(url
+0001d620: 2c20 7265 6164 5f6f 6e6c 793d 5472 7565  , read_only=True
+0001d630: 2c20 7061 7468 3d63 6f6d 706f 6e65 6e74  , path=component
+0001d640: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0001d650: 6368 756e 6b73 203d 2063 6875 6e6b 7320  chunks = chunks 
+0001d660: 6966 2063 6875 6e6b 7320 6973 206e 6f74  if chunks is not
+0001d670: 204e 6f6e 6520 656c 7365 207a 2e63 6875   None else z.chu
+0001d680: 6e6b 730a 2020 2020 6966 206e 616d 6520  nks.    if name 
+0001d690: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001d6a0: 206e 616d 6520 3d20 2266 726f 6d2d 7a61   name = "from-za
+0001d6b0: 7272 2d22 202b 2074 6f6b 656e 697a 6528  rr-" + tokenize(
+0001d6c0: 7a2c 2063 6f6d 706f 6e65 6e74 2c20 7374  z, component, st
+0001d6d0: 6f72 6167 655f 6f70 7469 6f6e 732c 2063  orage_options, c
+0001d6e0: 6875 6e6b 732c 202a 2a6b 7761 7267 7329  hunks, **kwargs)
+0001d6f0: 0a20 2020 2072 6574 7572 6e20 6672 6f6d  .    return from
+0001d700: 5f61 7272 6179 287a 2c20 6368 756e 6b73  _array(z, chunks
+0001d710: 2c20 6e61 6d65 3d6e 616d 652c 2069 6e6c  , name=name, inl
+0001d720: 696e 655f 6172 7261 793d 696e 6c69 6e65  ine_array=inline
+0001d730: 5f61 7272 6179 290a 0a0a 6465 6620 746f  _array)...def to
+0001d740: 5f7a 6172 7228 0a20 2020 2061 7272 2c0a  _zarr(.    arr,.
+0001d750: 2020 2020 7572 6c2c 0a20 2020 2063 6f6d      url,.    com
+0001d760: 706f 6e65 6e74 3d4e 6f6e 652c 0a20 2020  ponent=None,.   
+0001d770: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+0001d780: 3d4e 6f6e 652c 0a20 2020 206f 7665 7277  =None,.    overw
+0001d790: 7269 7465 3d46 616c 7365 2c0a 2020 2020  rite=False,.    
+0001d7a0: 7265 6769 6f6e 3d4e 6f6e 652c 0a20 2020  region=None,.   
+0001d7b0: 2063 6f6d 7075 7465 3d54 7275 652c 0a20   compute=True,. 
+0001d7c0: 2020 2072 6574 7572 6e5f 7374 6f72 6564     return_stored
+0001d7d0: 3d46 616c 7365 2c0a 2020 2020 2a2a 6b77  =False,.    **kw
+0001d7e0: 6172 6773 2c0a 293a 0a20 2020 2022 2222  args,.):.    """
+0001d7f0: 5361 7665 2061 7272 6179 2074 6f20 7468  Save array to th
+0001d800: 6520 7a61 7272 2073 746f 7261 6765 2066  e zarr storage f
+0001d810: 6f72 6d61 740a 0a20 2020 2053 6565 2068  ormat..    See h
+0001d820: 7474 7073 3a2f 2f7a 6172 722e 7265 6164  ttps://zarr.read
+0001d830: 7468 6564 6f63 732e 696f 2066 6f72 2064  thedocs.io for d
+0001d840: 6574 6169 6c73 2061 626f 7574 2074 6865  etails about the
+0001d850: 2066 6f72 6d61 742e 0a0a 2020 2020 5061   format...    Pa
+0001d860: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0001d870: 2d2d 2d2d 2d2d 2d0a 2020 2020 6172 723a  -------.    arr:
+0001d880: 2064 6173 6b2e 6172 7261 790a 2020 2020   dask.array.    
+0001d890: 2020 2020 4461 7461 2074 6f20 7374 6f72      Data to stor
+0001d8a0: 650a 2020 2020 7572 6c3a 205a 6172 7220  e.    url: Zarr 
+0001d8b0: 4172 7261 7920 6f72 2073 7472 206f 7220  Array or str or 
+0001d8c0: 4d75 7461 626c 654d 6170 7069 6e67 0a20  MutableMapping. 
+0001d8d0: 2020 2020 2020 204c 6f63 6174 696f 6e20         Location 
+0001d8e0: 6f66 2074 6865 2064 6174 612e 2041 2055  of the data. A U
+0001d8f0: 524c 2063 616e 2069 6e63 6c75 6465 2061  RL can include a
+0001d900: 2070 726f 746f 636f 6c20 7370 6563 6966   protocol specif
+0001d910: 6965 7220 6c69 6b65 2073 333a 2f2f 0a20  ier like s3://. 
+0001d920: 2020 2020 2020 2066 6f72 2072 656d 6f74         for remot
+0001d930: 6520 6461 7461 2e20 4361 6e20 616c 736f  e data. Can also
+0001d940: 2062 6520 616e 7920 4d75 7461 626c 654d   be any MutableM
+0001d950: 6170 7069 6e67 2069 6e73 7461 6e63 652c  apping instance,
+0001d960: 2077 6869 6368 2073 686f 756c 640a 2020   which should.  
+0001d970: 2020 2020 2020 6265 2073 6572 6961 6c69        be seriali
+0001d980: 7a61 626c 6520 6966 2075 7365 6420 696e  zable if used in
+0001d990: 206d 756c 7469 706c 6520 7072 6f63 6573   multiple proces
+0001d9a0: 7365 732e 0a20 2020 2063 6f6d 706f 6e65  ses..    compone
+0001d9b0: 6e74 3a20 7374 7220 6f72 204e 6f6e 650a  nt: str or None.
+0001d9c0: 2020 2020 2020 2020 4966 2074 6865 206c          If the l
+0001d9d0: 6f63 6174 696f 6e20 6973 2061 207a 6172  ocation is a zar
+0001d9e0: 7220 6772 6f75 7020 7261 7468 6572 2074  r group rather t
+0001d9f0: 6861 6e20 616e 2061 7272 6179 2c20 7468  han an array, th
+0001da00: 6973 2069 7320 7468 650a 2020 2020 2020  is is the.      
+0001da10: 2020 7375 6263 6f6d 706f 6e65 6e74 2074    subcomponent t
+0001da20: 6861 7420 7368 6f75 6c64 2062 6520 6372  hat should be cr
+0001da30: 6561 7465 642f 6f76 6572 2d77 7269 7474  eated/over-writt
+0001da40: 656e 2e0a 2020 2020 7374 6f72 6167 655f  en..    storage_
+0001da50: 6f70 7469 6f6e 733a 2064 6963 740a 2020  options: dict.  
+0001da60: 2020 2020 2020 416e 7920 6164 6469 7469        Any additi
+0001da70: 6f6e 616c 2070 6172 616d 6574 6572 7320  onal parameters 
+0001da80: 666f 7220 7468 6520 7374 6f72 6167 6520  for the storage 
+0001da90: 6261 636b 656e 6420 2869 676e 6f72 6564  backend (ignored
+0001daa0: 2066 6f72 206c 6f63 616c 0a20 2020 2020   for local.     
+0001dab0: 2020 2070 6174 6873 290a 2020 2020 6f76     paths).    ov
+0001dac0: 6572 7772 6974 653a 2062 6f6f 6c0a 2020  erwrite: bool.  
+0001dad0: 2020 2020 2020 4966 2067 6976 656e 2061        If given a
+0001dae0: 7272 6179 2061 6c72 6561 6479 2065 7869  rray already exi
+0001daf0: 7374 732c 206f 7665 7277 7269 7465 3d46  sts, overwrite=F
+0001db00: 616c 7365 2077 696c 6c20 6361 7573 6520  alse will cause 
+0001db10: 616e 2065 7272 6f72 2c0a 2020 2020 2020  an error,.      
+0001db20: 2020 7768 6572 6520 6f76 6572 7772 6974    where overwrit
+0001db30: 653d 5472 7565 2077 696c 6c20 7265 706c  e=True will repl
+0001db40: 6163 6520 7468 6520 6578 6973 7469 6e67  ace the existing
+0001db50: 2064 6174 612e 0a20 2020 2072 6567 696f   data..    regio
+0001db60: 6e3a 2074 7570 6c65 206f 6620 736c 6963  n: tuple of slic
+0001db70: 6573 206f 7220 4e6f 6e65 0a20 2020 2020  es or None.     
+0001db80: 2020 2054 6865 2072 6567 696f 6e20 6f66     The region of
+0001db90: 2064 6174 6120 7468 6174 2073 686f 756c   data that shoul
+0001dba0: 6420 6265 2077 7269 7474 656e 2069 6620  d be written if 
+0001dbb0: 6060 7572 6c60 6020 6973 2061 207a 6172  ``url`` is a zar
+0001dbc0: 722e 4172 7261 792e 0a20 2020 2020 2020  r.Array..       
+0001dbd0: 204e 6f74 2074 6f20 6265 2075 7365 6420   Not to be used 
+0001dbe0: 7769 7468 206f 7468 6572 2074 7970 6573  with other types
+0001dbf0: 206f 6620 6060 7572 6c60 602e 0a20 2020   of ``url``..   
+0001dc00: 2063 6f6d 7075 7465 3a20 626f 6f6c 0a20   compute: bool. 
+0001dc10: 2020 2020 2020 2053 6565 203a 6675 6e63         See :func
+0001dc20: 3a60 7e64 6173 6b2e 6172 7261 792e 7374  :`~dask.array.st
+0001dc30: 6f72 6560 2066 6f72 206d 6f72 6520 6465  ore` for more de
+0001dc40: 7461 696c 732e 0a20 2020 2072 6574 7572  tails..    retur
+0001dc50: 6e5f 7374 6f72 6564 3a20 626f 6f6c 0a20  n_stored: bool. 
+0001dc60: 2020 2020 2020 2053 6565 203a 6675 6e63         See :func
+0001dc70: 3a60 7e64 6173 6b2e 6172 7261 792e 7374  :`~dask.array.st
+0001dc80: 6f72 6560 2066 6f72 206d 6f72 6520 6465  ore` for more de
+0001dc90: 7461 696c 732e 0a20 2020 202a 2a6b 7761  tails..    **kwa
+0001dca0: 7267 733a 0a20 2020 2020 2020 2050 6173  rgs:.        Pas
+0001dcb0: 7365 6420 746f 2074 6865 203a 6675 6e63  sed to the :func
+0001dcc0: 3a60 7a61 7272 2e63 7265 6174 696f 6e2e  :`zarr.creation.
+0001dcd0: 6372 6561 7465 6020 6675 6e63 7469 6f6e  create` function
+0001dce0: 2c20 652e 672e 2c20 636f 6d70 7265 7373  , e.g., compress
+0001dcf0: 696f 6e20 6f70 7469 6f6e 732e 0a0a 2020  ion options...  
+0001dd00: 2020 5261 6973 6573 0a20 2020 202d 2d2d    Raises.    ---
+0001dd10: 2d2d 2d0a 2020 2020 5661 6c75 6545 7272  ---.    ValueErr
+0001dd20: 6f72 0a20 2020 2020 2020 2049 6620 6060  or.        If ``
+0001dd30: 6172 7260 6020 6861 7320 756e 6b6e 6f77  arr`` has unknow
+0001dd40: 6e20 6368 756e 6b20 7369 7a65 732c 2077  n chunk sizes, w
+0001dd50: 6869 6368 2069 7320 6e6f 7420 7375 7070  hich is not supp
+0001dd60: 6f72 7465 6420 6279 205a 6172 722e 0a20  orted by Zarr.. 
+0001dd70: 2020 2020 2020 2049 6620 6060 7265 6769         If ``regi
+0001dd80: 6f6e 6060 2069 7320 7370 6563 6966 6965  on`` is specifie
+0001dd90: 6420 616e 6420 6060 7572 6c60 6020 6973  d and ``url`` is
+0001dda0: 206e 6f74 2061 207a 6172 722e 4172 7261   not a zarr.Arra
+0001ddb0: 790a 0a20 2020 2053 6565 2041 6c73 6f0a  y..    See Also.
+0001ddc0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0001ddd0: 2064 6173 6b2e 6172 7261 792e 7374 6f72   dask.array.stor
+0001dde0: 650a 2020 2020 6461 736b 2e61 7272 6179  e.    dask.array
+0001ddf0: 2e41 7272 6179 2e63 6f6d 7075 7465 5f63  .Array.compute_c
+0001de00: 6875 6e6b 5f73 697a 6573 0a0a 2020 2020  hunk_sizes..    
+0001de10: 2222 220a 2020 2020 696d 706f 7274 207a  """.    import z
+0001de20: 6172 720a 0a20 2020 2069 6620 6e70 2e69  arr..    if np.i
+0001de30: 736e 616e 2861 7272 2e73 6861 7065 292e  snan(arr.shape).
+0001de40: 616e 7928 293a 0a20 2020 2020 2020 2072  any():.        r
+0001de50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0001de60: 0a20 2020 2020 2020 2020 2020 2022 5361  .            "Sa
+0001de70: 7669 6e67 2061 2064 6173 6b20 6172 7261  ving a dask arra
+0001de80: 7920 7769 7468 2075 6e6b 6e6f 776e 2063  y with unknown c
+0001de90: 6875 6e6b 2073 697a 6573 2069 7320 6e6f  hunk sizes is no
+0001dea0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
+0001deb0: 2263 7572 7265 6e74 6c79 2073 7570 706f  "currently suppo
+0001dec0: 7274 6564 2062 7920 5a61 7272 2e25 7322  rted by Zarr.%s"
+0001ded0: 2025 2075 6e6b 6e6f 776e 5f63 6875 6e6b   % unknown_chunk
+0001dee0: 5f6d 6573 7361 6765 0a20 2020 2020 2020  _message.       
+0001def0: 2029 0a0a 2020 2020 6966 2069 7369 6e73   )..    if isins
+0001df00: 7461 6e63 6528 7572 6c2c 207a 6172 722e  tance(url, zarr.
+0001df10: 4172 7261 7929 3a0a 2020 2020 2020 2020  Array):.        
+0001df20: 7a20 3d20 7572 6c0a 2020 2020 2020 2020  z = url.        
+0001df30: 6966 2069 7369 6e73 7461 6e63 6528 7a2e  if isinstance(z.
+0001df40: 7374 6f72 652c 2028 6469 6374 2c20 4d75  store, (dict, Mu
+0001df50: 7461 626c 654d 6170 7069 6e67 2929 3a0a  tableMapping)):.
+0001df60: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0001df70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001df80: 2066 726f 6d20 6469 7374 7269 6275 7465   from distribute
+0001df90: 6420 696d 706f 7274 2064 6566 6175 6c74  d import default
+0001dfa0: 5f63 6c69 656e 740a 0a20 2020 2020 2020  _client..       
+0001dfb0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0001dfc0: 5f63 6c69 656e 7428 290a 2020 2020 2020  _client().      
+0001dfd0: 2020 2020 2020 6578 6365 7074 2028 496d        except (Im
+0001dfe0: 706f 7274 4572 726f 722c 2056 616c 7565  portError, Value
+0001dff0: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+0001e000: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+0001e010: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001e020: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001e030: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+0001e040: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0001e050: 2020 2020 2020 2022 4361 6e6e 6f74 2073         "Cannot s
+0001e060: 746f 7265 2069 6e74 6f20 696e 206d 656d  tore into in mem
+0001e070: 6f72 7920 5a61 7272 2041 7272 6179 2075  ory Zarr Array u
+0001e080: 7369 6e67 2022 0a20 2020 2020 2020 2020  sing ".         
+0001e090: 2020 2020 2020 2020 2020 2022 7468 6520             "the 
+0001e0a0: 6469 7374 7269 6275 7465 6420 7363 6865  distributed sche
+0001e0b0: 6475 6c65 722e 220a 2020 2020 2020 2020  duler.".        
+0001e0c0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001e0d0: 2020 2069 6620 7265 6769 6f6e 2069 7320     if region is 
+0001e0e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001e0f0: 2020 6172 7220 3d20 6172 722e 7265 6368    arr = arr.rech
+0001e100: 756e 6b28 7a2e 6368 756e 6b73 290a 2020  unk(z.chunks).  
+0001e110: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0001e120: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
+0001e130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001e140: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
+0001e150: 6179 2e73 6c69 6369 6e67 2069 6d70 6f72  ay.slicing impor
+0001e160: 7420 6e65 775f 626c 6f63 6b64 696d 2c20  t new_blockdim, 
+0001e170: 6e6f 726d 616c 697a 655f 696e 6465 780a  normalize_index.
+0001e180: 0a20 2020 2020 2020 2020 2020 206f 6c64  .            old
+0001e190: 5f63 6875 6e6b 7320 3d20 6e6f 726d 616c  _chunks = normal
+0001e1a0: 697a 655f 6368 756e 6b73 287a 2e63 6875  ize_chunks(z.chu
+0001e1b0: 6e6b 732c 207a 2e73 6861 7065 290a 2020  nks, z.shape).  
+0001e1c0: 2020 2020 2020 2020 2020 696e 6465 7820            index 
+0001e1d0: 3d20 6e6f 726d 616c 697a 655f 696e 6465  = normalize_inde
+0001e1e0: 7828 7265 6769 6f6e 2c20 7a2e 7368 6170  x(region, z.shap
+0001e1f0: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
+0001e200: 6875 6e6b 7320 3d20 7475 706c 6528 0a20  hunks = tuple(. 
+0001e210: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001e220: 7570 6c65 286e 6577 5f62 6c6f 636b 6469  uple(new_blockdi
+0001e230: 6d28 732c 2063 2c20 7229 290a 2020 2020  m(s, c, r)).    
+0001e240: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001e250: 732c 2063 2c20 7220 696e 207a 6970 287a  s, c, r in zip(z
+0001e260: 2e73 6861 7065 2c20 6f6c 645f 6368 756e  .shape, old_chun
+0001e270: 6b73 2c20 696e 6465 7829 0a20 2020 2020  ks, index).     
+0001e280: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e290: 2020 2020 2061 7272 203d 2061 7272 2e72       arr = arr.r
+0001e2a0: 6563 6875 6e6b 2863 6875 6e6b 7329 0a20  echunk(chunks). 
+0001e2b0: 2020 2020 2020 2020 2020 2072 6567 696f             regio
+0001e2c0: 6e73 203d 205b 7265 6769 6f6e 5d0a 2020  ns = [region].  
+0001e2d0: 2020 2020 2020 7265 7475 726e 2061 7272        return arr
+0001e2e0: 2e73 746f 7265 280a 2020 2020 2020 2020  .store(.        
+0001e2f0: 2020 2020 7a2c 206c 6f63 6b3d 4661 6c73      z, lock=Fals
+0001e300: 652c 2072 6567 696f 6e73 3d72 6567 696f  e, regions=regio
+0001e310: 6e73 2c20 636f 6d70 7574 653d 636f 6d70  ns, compute=comp
+0001e320: 7574 652c 2072 6574 7572 6e5f 7374 6f72  ute, return_stor
+0001e330: 6564 3d72 6574 7572 6e5f 7374 6f72 6564  ed=return_stored
+0001e340: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0001e350: 6966 2072 6567 696f 6e20 6973 206e 6f74  if region is not
+0001e360: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+0001e370: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0001e380: 2243 616e 6e6f 7420 7573 6520 6072 6567  "Cannot use `reg
+0001e390: 696f 6e60 206b 6579 776f 7264 2077 6865  ion` keyword whe
+0001e3a0: 6e20 7572 6c20 6973 206e 6f74 2061 2060  n url is not a `
+0001e3b0: 7a61 7272 2e41 7272 6179 602e 2229 0a0a  zarr.Array`.")..
+0001e3c0: 2020 2020 6966 206e 6f74 205f 6368 6563      if not _chec
+0001e3d0: 6b5f 7265 6775 6c61 725f 6368 756e 6b73  k_regular_chunks
+0001e3e0: 2861 7272 2e63 6875 6e6b 7329 3a0a 2020  (arr.chunks):.  
+0001e3f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0001e400: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0001e410: 2020 2020 2241 7474 656d 7074 2074 6f20      "Attempt to 
+0001e420: 7361 7665 2061 7272 6179 2074 6f20 7a61  save array to za
+0001e430: 7272 2077 6974 6820 6972 7265 6775 6c61  rr with irregula
+0001e440: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
+0001e450: 2263 6875 6e6b 696e 672c 2070 6c65 6173  "chunking, pleas
+0001e460: 6520 6361 6c6c 2060 6172 722e 7265 6368  e call `arr.rech
+0001e470: 756e 6b28 2e2e 2e29 6020 6669 7273 742e  unk(...)` first.
+0001e480: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0001e490: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+0001e4a0: 203d 2073 746f 7261 6765 5f6f 7074 696f   = storage_optio
+0001e4b0: 6e73 206f 7220 7b7d 0a0a 2020 2020 6966  ns or {}..    if
+0001e4c0: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+0001e4d0: 3a0a 2020 2020 2020 2020 7374 6f72 6520  :.        store 
+0001e4e0: 3d20 7a61 7272 2e73 746f 7261 6765 2e46  = zarr.storage.F
+0001e4f0: 5353 746f 7265 2875 726c 2c20 2a2a 7374  SStore(url, **st
+0001e500: 6f72 6167 655f 6f70 7469 6f6e 7329 0a20  orage_options). 
+0001e510: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001e520: 2073 746f 7265 203d 2075 726c 0a0a 2020   store = url..  
+0001e530: 2020 6368 756e 6b73 203d 205b 635b 305d    chunks = [c[0]
+0001e540: 2066 6f72 2063 2069 6e20 6172 722e 6368   for c in arr.ch
+0001e550: 756e 6b73 5d0a 0a20 2020 207a 203d 207a  unks]..    z = z
+0001e560: 6172 722e 6372 6561 7465 280a 2020 2020  arr.create(.    
+0001e570: 2020 2020 7368 6170 653d 6172 722e 7368      shape=arr.sh
+0001e580: 6170 652c 0a20 2020 2020 2020 2063 6875  ape,.        chu
+0001e590: 6e6b 733d 6368 756e 6b73 2c0a 2020 2020  nks=chunks,.    
+0001e5a0: 2020 2020 6474 7970 653d 6172 722e 6474      dtype=arr.dt
+0001e5b0: 7970 652c 0a20 2020 2020 2020 2073 746f  ype,.        sto
+0001e5c0: 7265 3d73 746f 7265 2c0a 2020 2020 2020  re=store,.      
+0001e5d0: 2020 7061 7468 3d63 6f6d 706f 6e65 6e74    path=component
+0001e5e0: 2c0a 2020 2020 2020 2020 6f76 6572 7772  ,.        overwr
+0001e5f0: 6974 653d 6f76 6572 7772 6974 652c 0a20  ite=overwrite,. 
+0001e600: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+0001e610: 0a20 2020 2029 0a20 2020 2072 6574 7572  .    ).    retur
+0001e620: 6e20 6172 722e 7374 6f72 6528 7a2c 206c  n arr.store(z, l
+0001e630: 6f63 6b3d 4661 6c73 652c 2063 6f6d 7075  ock=False, compu
+0001e640: 7465 3d63 6f6d 7075 7465 2c20 7265 7475  te=compute, retu
+0001e650: 726e 5f73 746f 7265 643d 7265 7475 726e  rn_stored=return
+0001e660: 5f73 746f 7265 6429 0a0a 0a64 6566 205f  _stored)...def _
+0001e670: 6368 6563 6b5f 7265 6775 6c61 725f 6368  check_regular_ch
+0001e680: 756e 6b73 2863 6875 6e6b 7365 7429 3a0a  unks(chunkset):.
+0001e690: 2020 2020 2222 2243 6865 636b 2069 6620      """Check if 
+0001e6a0: 7468 6520 6368 756e 6b73 2061 7265 2072  the chunks are r
+0001e6b0: 6567 756c 6172 0a0a 2020 2020 2252 6567  egular..    "Reg
+0001e6c0: 756c 6172 2220 696e 2074 6869 7320 636f  ular" in this co
+0001e6d0: 6e74 6578 7420 6d65 616e 7320 7468 6174  ntext means that
+0001e6e0: 2061 6c6f 6e67 2065 7665 7279 2061 7869   along every axi
+0001e6f0: 732c 2074 6865 2063 6875 6e6b 7320 616c  s, the chunks al
+0001e700: 6c0a 2020 2020 6861 7665 2074 6865 2073  l.    have the s
+0001e710: 616d 6520 7369 7a65 2c20 6578 6365 7074  ame size, except
+0001e720: 2074 6865 206c 6173 7420 6f6e 652c 2077   the last one, w
+0001e730: 6869 6368 206d 6179 2062 6520 736d 616c  hich may be smal
+0001e740: 6c65 720a 0a20 2020 2050 6172 616d 6574  ler..    Paramet
+0001e750: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0001e760: 2d2d 0a20 2020 2063 6875 6e6b 7365 743a  --.    chunkset:
+0001e770: 2074 7570 6c65 206f 6620 7475 706c 6573   tuple of tuples
+0001e780: 206f 6620 696e 7473 0a20 2020 2020 2020   of ints.       
+0001e790: 2046 726f 6d20 7468 6520 6060 2e63 6875   From the ``.chu
+0001e7a0: 6e6b 7360 6020 6174 7472 6962 7574 6520  nks`` attribute 
+0001e7b0: 6f66 2061 6e20 6060 4172 7261 7960 600a  of an ``Array``.
+0001e7c0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+0001e7d0: 202d 2d2d 2d2d 2d2d 0a20 2020 2054 7275   -------.    Tru
+0001e7e0: 6520 6966 2063 6875 6e6b 7365 7420 7061  e if chunkset pa
+0001e7f0: 7373 6573 2c20 656c 7365 2046 616c 7365  sses, else False
+0001e800: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
+0001e810: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0001e820: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+0001e830: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
+0001e840: 3e3e 3e20 6172 7220 3d20 6461 2e7a 6572  >>> arr = da.zer
+0001e850: 6f73 2831 302c 2063 6875 6e6b 733d 2835  os(10, chunks=(5
+0001e860: 2c20 2929 0a20 2020 203e 3e3e 205f 6368  , )).    >>> _ch
+0001e870: 6563 6b5f 7265 6775 6c61 725f 6368 756e  eck_regular_chun
+0001e880: 6b73 2861 7272 2e63 6875 6e6b 7329 0a20  ks(arr.chunks). 
+0001e890: 2020 2054 7275 650a 0a20 2020 203e 3e3e     True..    >>>
+0001e8a0: 2061 7272 203d 2064 612e 7a65 726f 7328   arr = da.zeros(
+0001e8b0: 3130 2c20 6368 756e 6b73 3d28 2833 2c20  10, chunks=((3, 
+0001e8c0: 332c 2033 2c20 3129 2c20 2929 0a20 2020  3, 3, 1), )).   
+0001e8d0: 203e 3e3e 205f 6368 6563 6b5f 7265 6775   >>> _check_regu
+0001e8e0: 6c61 725f 6368 756e 6b73 2861 7272 2e63  lar_chunks(arr.c
+0001e8f0: 6875 6e6b 7329 0a20 2020 2054 7275 650a  hunks).    True.
+0001e900: 0a20 2020 203e 3e3e 2061 7272 203d 2064  .    >>> arr = d
+0001e910: 612e 7a65 726f 7328 3130 2c20 6368 756e  a.zeros(10, chun
+0001e920: 6b73 3d28 2833 2c20 312c 2033 2c20 3329  ks=((3, 1, 3, 3)
+0001e930: 2c20 2929 0a20 2020 203e 3e3e 205f 6368  , )).    >>> _ch
+0001e940: 6563 6b5f 7265 6775 6c61 725f 6368 756e  eck_regular_chun
+0001e950: 6b73 2861 7272 2e63 6875 6e6b 7329 0a20  ks(arr.chunks). 
+0001e960: 2020 2046 616c 7365 0a20 2020 2022 2222     False.    """
+0001e970: 0a20 2020 2066 6f72 2063 6875 6e6b 7320  .    for chunks 
+0001e980: 696e 2063 6875 6e6b 7365 743a 0a20 2020  in chunkset:.   
+0001e990: 2020 2020 2069 6620 6c65 6e28 6368 756e       if len(chun
+0001e9a0: 6b73 2920 3d3d 2031 3a0a 2020 2020 2020  ks) == 1:.      
+0001e9b0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001e9c0: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+0001e9d0: 7428 6368 756e 6b73 5b3a 2d31 5d29 2920  t(chunks[:-1])) 
+0001e9e0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+0001e9f0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+0001ea00: 2020 2020 2020 6966 2063 6875 6e6b 735b        if chunks[
+0001ea10: 2d31 5d20 3e20 6368 756e 6b73 5b30 5d3a  -1] > chunks[0]:
+0001ea20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001ea30: 7572 6e20 4661 6c73 650a 2020 2020 7265  urn False.    re
+0001ea40: 7475 726e 2054 7275 650a 0a0a 6465 6620  turn True...def 
+0001ea50: 6672 6f6d 5f64 656c 6179 6564 2876 616c  from_delayed(val
+0001ea60: 7565 2c20 7368 6170 652c 2064 7479 7065  ue, shape, dtype
+0001ea70: 3d4e 6f6e 652c 206d 6574 613d 4e6f 6e65  =None, meta=None
+0001ea80: 2c20 6e61 6d65 3d4e 6f6e 6529 3a0a 2020  , name=None):.  
+0001ea90: 2020 2222 2243 7265 6174 6520 6120 6461    """Create a da
+0001eaa0: 736b 2061 7272 6179 2066 726f 6d20 6120  sk array from a 
+0001eab0: 6461 736b 2064 656c 6179 6564 2076 616c  dask delayed val
+0001eac0: 7565 0a0a 2020 2020 5468 6973 2072 6f75  ue..    This rou
+0001ead0: 7469 6e65 2069 7320 7573 6566 756c 2066  tine is useful f
+0001eae0: 6f72 2063 6f6e 7374 7275 6374 696e 6720  or constructing 
+0001eaf0: 6461 736b 2061 7272 6179 7320 696e 2061  dask arrays in a
+0001eb00: 6e20 6164 2d68 6f63 2066 6173 6869 6f6e  n ad-hoc fashion
+0001eb10: 0a20 2020 2075 7369 6e67 2064 6173 6b20  .    using dask 
+0001eb20: 6465 6c61 7965 642c 2070 6172 7469 6375  delayed, particu
+0001eb30: 6c61 726c 7920 7768 656e 2063 6f6d 6269  larly when combi
+0001eb40: 6e65 6420 7769 7468 2073 7461 636b 2061  ned with stack a
+0001eb50: 6e64 2063 6f6e 6361 7465 6e61 7465 2e0a  nd concatenate..
+0001eb60: 0a20 2020 2054 6865 2064 6173 6b20 6172  .    The dask ar
+0001eb70: 7261 7920 7769 6c6c 2063 6f6e 7369 7374  ray will consist
+0001eb80: 206f 6620 6120 7369 6e67 6c65 2063 6875   of a single chu
+0001eb90: 6e6b 2e0a 0a20 2020 2045 7861 6d70 6c65  nk...    Example
+0001eba0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
+0001ebb0: 2020 203e 3e3e 2069 6d70 6f72 7420 6461     >>> import da
+0001ebc0: 736b 0a20 2020 203e 3e3e 2069 6d70 6f72  sk.    >>> impor
+0001ebd0: 7420 6461 736b 2e61 7272 6179 2061 7320  t dask.array as 
+0001ebe0: 6461 0a20 2020 203e 3e3e 2069 6d70 6f72  da.    >>> impor
+0001ebf0: 7420 6e75 6d70 7920 6173 206e 700a 2020  t numpy as np.  
+0001ec00: 2020 3e3e 3e20 7661 6c75 6520 3d20 6461    >>> value = da
+0001ec10: 736b 2e64 656c 6179 6564 286e 702e 6f6e  sk.delayed(np.on
+0001ec20: 6573 2928 3529 0a20 2020 203e 3e3e 2061  es)(5).    >>> a
+0001ec30: 7272 6179 203d 2064 612e 6672 6f6d 5f64  rray = da.from_d
+0001ec40: 656c 6179 6564 2876 616c 7565 2c20 2835  elayed(value, (5
+0001ec50: 2c29 2c20 6474 7970 653d 666c 6f61 7429  ,), dtype=float)
+0001ec60: 0a20 2020 203e 3e3e 2061 7272 6179 0a20  .    >>> array. 
+0001ec70: 2020 2064 6173 6b2e 6172 7261 793c 6672     dask.array<fr
+0001ec80: 6f6d 2d76 616c 7565 2c20 7368 6170 653d  om-value, shape=
+0001ec90: 2835 2c29 2c20 6474 7970 653d 666c 6f61  (5,), dtype=floa
+0001eca0: 7436 342c 2063 6875 6e6b 7369 7a65 3d28  t64, chunksize=(
+0001ecb0: 352c 292c 2063 6875 6e6b 7479 7065 3d6e  5,), chunktype=n
+0001ecc0: 756d 7079 2e6e 6461 7272 6179 3e0a 2020  umpy.ndarray>.  
+0001ecd0: 2020 3e3e 3e20 6172 7261 792e 636f 6d70    >>> array.comp
+0001ece0: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
+0001ecf0: 5b31 2e2c 2031 2e2c 2031 2e2c 2031 2e2c  [1., 1., 1., 1.,
+0001ed00: 2031 2e5d 290a 2020 2020 2222 220a 2020   1.]).    """.  
+0001ed10: 2020 6672 6f6d 2064 6173 6b2e 6465 6c61    from dask.dela
+0001ed20: 7965 6420 696d 706f 7274 2044 656c 6179  yed import Delay
+0001ed30: 6564 2c20 6465 6c61 7965 640a 0a20 2020  ed, delayed..   
+0001ed40: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0001ed50: 6365 2876 616c 7565 2c20 4465 6c61 7965  ce(value, Delaye
+0001ed60: 6429 2061 6e64 2068 6173 6174 7472 2876  d) and hasattr(v
+0001ed70: 616c 7565 2c20 226b 6579 2229 3a0a 2020  alue, "key"):.  
+0001ed80: 2020 2020 2020 7661 6c75 6520 3d20 6465        value = de
+0001ed90: 6c61 7965 6428 7661 6c75 6529 0a0a 2020  layed(value)..  
+0001eda0: 2020 6e61 6d65 203d 206e 616d 6520 6f72    name = name or
+0001edb0: 2022 6672 6f6d 2d76 616c 7565 2d22 202b   "from-value-" +
+0001edc0: 2074 6f6b 656e 697a 6528 7661 6c75 652c   tokenize(value,
+0001edd0: 2073 6861 7065 2c20 6474 7970 652c 206d   shape, dtype, m
+0001ede0: 6574 6129 0a20 2020 2064 736b 203d 207b  eta).    dsk = {
+0001edf0: 286e 616d 652c 2920 2b20 2830 2c29 202a  (name,) + (0,) *
+0001ee00: 206c 656e 2873 6861 7065 293a 2076 616c   len(shape): val
+0001ee10: 7565 2e6b 6579 7d0a 2020 2020 6368 756e  ue.key}.    chun
+0001ee20: 6b73 203d 2074 7570 6c65 2828 642c 2920  ks = tuple((d,) 
+0001ee30: 666f 7220 6420 696e 2073 6861 7065 290a  for d in shape).
+0001ee40: 2020 2020 2320 544f 444f 3a20 7661 6c75      # TODO: valu
+0001ee50: 652e 5f6b 6579 206d 6179 206e 6f74 2062  e._key may not b
+0001ee60: 6520 7468 6520 6e61 6d65 206f 6620 7468  e the name of th
+0001ee70: 6520 6c61 7965 7220 696e 2076 616c 7565  e layer in value
+0001ee80: 2e64 6173 6b0a 2020 2020 2320 5468 6973  .dask.    # This
+0001ee90: 2073 686f 756c 6420 6265 2066 6978 6564   should be fixed
+0001eea0: 2061 6674 6572 2077 6520 6275 696c 6420   after we build 
+0001eeb0: 6675 6c6c 2065 7870 7265 7373 696f 6e20  full expression 
+0001eec0: 6772 6170 6873 0a20 2020 2067 7261 7068  graphs.    graph
+0001eed0: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+0001eee0: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+0001eef0: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
+0001ef00: 7065 6e64 656e 6369 6573 3d5b 7661 6c75  pendencies=[valu
+0001ef10: 655d 290a 2020 2020 7265 7475 726e 2041  e]).    return A
+0001ef20: 7272 6179 2867 7261 7068 2c20 6e61 6d65  rray(graph, name
+0001ef30: 2c20 6368 756e 6b73 2c20 6474 7970 653d  , chunks, dtype=
+0001ef40: 6474 7970 652c 206d 6574 613d 6d65 7461  dtype, meta=meta
+0001ef50: 290a 0a0a 6465 6620 6672 6f6d 5f66 756e  )...def from_fun
+0001ef60: 6328 6675 6e63 2c20 7368 6170 652c 2064  c(func, shape, d
+0001ef70: 7479 7065 3d4e 6f6e 652c 206e 616d 653d  type=None, name=
+0001ef80: 4e6f 6e65 2c20 6172 6773 3d28 292c 206b  None, args=(), k
+0001ef90: 7761 7267 733d 4e6f 6e65 293a 0a20 2020  wargs=None):.   
+0001efa0: 2022 2222 4372 6561 7465 2064 6173 6b20   """Create dask 
+0001efb0: 6172 7261 7920 696e 2061 2073 696e 676c  array in a singl
+0001efc0: 6520 626c 6f63 6b20 6279 2063 616c 6c69  e block by calli
+0001efd0: 6e67 2061 2066 756e 6374 696f 6e0a 0a20  ng a function.. 
+0001efe0: 2020 2043 616c 6c69 6e67 2074 6865 2070     Calling the p
+0001eff0: 726f 7669 6465 6420 6675 6e63 7469 6f6e  rovided function
+0001f000: 2077 6974 6820 6675 6e63 282a 6172 6773   with func(*args
+0001f010: 2c20 2a2a 6b77 6172 6773 2920 7368 6f75  , **kwargs) shou
+0001f020: 6c64 2072 6574 7572 6e20 610a 2020 2020  ld return a.    
+0001f030: 4e75 6d50 7920 6172 7261 7920 6f66 2074  NumPy array of t
+0001f040: 6865 2069 6e64 6963 6174 6564 2073 6861  he indicated sha
+0001f050: 7065 2061 6e64 2064 7479 7065 2e0a 0a20  pe and dtype... 
+0001f060: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+0001f070: 2d2d 2d2d 2d2d 2d2d 0a0a 2020 2020 3e3e  --------..    >>
+0001f080: 3e20 6120 3d20 6672 6f6d 5f66 756e 6328  > a = from_func(
+0001f090: 6e70 2e61 7261 6e67 652c 2028 332c 292c  np.arange, (3,),
+0001f0a0: 2064 7479 7065 3d27 6938 272c 2061 7267   dtype='i8', arg
+0001f0b0: 733d 2833 2c29 290a 2020 2020 3e3e 3e20  s=(3,)).    >>> 
+0001f0c0: 612e 636f 6d70 7574 6528 290a 2020 2020  a.compute().    
+0001f0d0: 6172 7261 7928 5b30 2c20 312c 2032 5d29  array([0, 1, 2])
+0001f0e0: 0a0a 2020 2020 5468 6973 2077 6f72 6b73  ..    This works
+0001f0f0: 2070 6172 7469 6375 6c61 726c 7920 7765   particularly we
+0001f100: 6c6c 2077 6865 6e20 636f 7570 6c65 6420  ll when coupled 
+0001f110: 7769 7468 2064 6173 6b2e 6172 7261 7920  with dask.array 
+0001f120: 6675 6e63 7469 6f6e 7320 6c69 6b65 0a20  functions like. 
+0001f130: 2020 2063 6f6e 6361 7465 6e61 7465 2061     concatenate a
+0001f140: 6e64 2073 7461 636b 3a0a 0a20 2020 203e  nd stack:..    >
+0001f150: 3e3e 2061 7272 6179 7320 3d20 5b66 726f  >> arrays = [fro
+0001f160: 6d5f 6675 6e63 286e 702e 6172 7261 792c  m_func(np.array,
+0001f170: 2028 292c 2064 7479 7065 3d27 6938 272c   (), dtype='i8',
+0001f180: 2061 7267 733d 286e 2c29 2920 666f 7220   args=(n,)) for 
+0001f190: 6e20 696e 2072 616e 6765 2835 295d 0a20  n in range(5)]. 
+0001f1a0: 2020 203e 3e3e 2073 7461 636b 2861 7272     >>> stack(arr
+0001f1b0: 6179 7329 2e63 6f6d 7075 7465 2829 0a20  ays).compute(). 
+0001f1c0: 2020 2061 7272 6179 285b 302c 2031 2c20     array([0, 1, 
+0001f1d0: 322c 2033 2c20 345d 290a 2020 2020 2222  2, 3, 4]).    ""
+0001f1e0: 220a 2020 2020 6966 206b 7761 7267 7320  ".    if kwargs 
+0001f1f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001f200: 206b 7761 7267 7320 3d20 7b7d 0a0a 2020   kwargs = {}..  
+0001f210: 2020 6e61 6d65 203d 206e 616d 6520 6f72    name = name or
+0001f220: 2022 6672 6f6d 5f66 756e 632d 2220 2b20   "from_func-" + 
+0001f230: 746f 6b65 6e69 7a65 2866 756e 632c 2073  tokenize(func, s
+0001f240: 6861 7065 2c20 6474 7970 652c 2061 7267  hape, dtype, arg
+0001f250: 732c 206b 7761 7267 7329 0a20 2020 2069  s, kwargs).    i
+0001f260: 6620 6172 6773 206f 7220 6b77 6172 6773  f args or kwargs
+0001f270: 3a0a 2020 2020 2020 2020 6675 6e63 203d  :.        func =
+0001f280: 2070 6172 7469 616c 2866 756e 632c 202a   partial(func, *
+0001f290: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
+0001f2a0: 2020 2020 6473 6b20 3d20 7b28 6e61 6d65      dsk = {(name
+0001f2b0: 2c29 202b 2028 302c 2920 2a20 6c65 6e28  ,) + (0,) * len(
+0001f2c0: 7368 6170 6529 3a20 2866 756e 632c 297d  shape): (func,)}
+0001f2d0: 0a20 2020 2063 6875 6e6b 7320 3d20 7475  .    chunks = tu
+0001f2e0: 706c 6528 2869 2c29 2066 6f72 2069 2069  ple((i,) for i i
+0001f2f0: 6e20 7368 6170 6529 0a20 2020 2072 6574  n shape).    ret
+0001f300: 7572 6e20 4172 7261 7928 6473 6b2c 206e  urn Array(dsk, n
+0001f310: 616d 652c 2063 6875 6e6b 732c 2064 7479  ame, chunks, dty
+0001f320: 7065 290a 0a0a 6465 6620 636f 6d6d 6f6e  pe)...def common
+0001f330: 5f62 6c6f 636b 6469 6d28 626c 6f63 6b64  _blockdim(blockd
+0001f340: 696d 7329 3a0a 2020 2020 2222 2246 696e  ims):.    """Fin
+0001f350: 6420 7468 6520 636f 6d6d 6f6e 2062 6c6f  d the common blo
+0001f360: 636b 2064 696d 656e 7369 6f6e 7320 6672  ck dimensions fr
+0001f370: 6f6d 2074 6865 206c 6973 7420 6f66 2062  om the list of b
+0001f380: 6c6f 636b 2064 696d 656e 7369 6f6e 730a  lock dimensions.
+0001f390: 0a20 2020 2043 7572 7265 6e74 6c79 206f  .    Currently o
+0001f3a0: 6e6c 7920 696d 706c 656d 656e 7473 2074  nly implements t
+0001f3b0: 6865 2073 696d 706c 6573 7420 706f 7373  he simplest poss
+0001f3c0: 6962 6c65 2068 6575 7269 7374 6963 3a20  ible heuristic: 
+0001f3d0: 7468 6520 636f 6d6d 6f6e 0a20 2020 2062  the common.    b
+0001f3e0: 6c6f 636b 2d64 696d 656e 7369 6f6e 2069  lock-dimension i
+0001f3f0: 7320 7468 6520 6f6e 6c79 206f 6e65 2074  s the only one t
+0001f400: 6861 7420 646f 6573 206e 6f74 2073 7061  hat does not spa
+0001f410: 6e20 6675 6c6c 7920 7370 616e 2061 2064  n fully span a d
+0001f420: 696d 656e 7369 6f6e 2e0a 2020 2020 5468  imension..    Th
+0001f430: 6973 2069 7320 6120 636f 6e73 6572 7661  is is a conserva
+0001f440: 7469 7665 2063 686f 6963 6520 7468 6174  tive choice that
+0001f450: 2061 6c6c 6f77 7320 7573 2074 6f20 6176   allows us to av
+0001f460: 6f69 6420 706f 7465 6e74 6961 6c6c 7920  oid potentially 
+0001f470: 7665 7279 0a20 2020 2065 7870 656e 7369  very.    expensi
+0001f480: 7665 2072 6563 6875 6e6b 696e 672e 0a0a  ve rechunking...
+0001f490: 2020 2020 4173 7375 6d65 7320 7468 6174      Assumes that
+0001f4a0: 2065 6163 6820 656c 656d 656e 7420 6f66   each element of
+0001f4b0: 2074 6865 2069 6e70 7574 2062 6c6f 636b   the input block
+0001f4c0: 2064 696d 656e 7369 6f6e 7320 6861 7320   dimensions has 
+0001f4d0: 616c 6c20 7468 6520 7361 6d65 0a20 2020  all the same.   
+0001f4e0: 2073 756d 2028 692e 652e 2c20 7468 6174   sum (i.e., that
+0001f4f0: 2074 6865 7920 636f 7272 6573 706f 6e64   they correspond
+0001f500: 2074 6f20 6469 6d65 6e73 696f 6e73 206f   to dimensions o
+0001f510: 6620 7468 6520 7361 6d65 2073 697a 6529  f the same size)
+0001f520: 2e0a 0a20 2020 2045 7861 6d70 6c65 730a  ...    Examples.
+0001f530: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0001f540: 203e 3e3e 2063 6f6d 6d6f 6e5f 626c 6f63   >>> common_bloc
+0001f550: 6b64 696d 285b 2833 2c29 2c20 2832 2c20  kdim([(3,), (2, 
+0001f560: 3129 5d29 0a20 2020 2028 322c 2031 290a  1)]).    (2, 1).
+0001f570: 2020 2020 3e3e 3e20 636f 6d6d 6f6e 5f62      >>> common_b
+0001f580: 6c6f 636b 6469 6d28 5b28 312c 2032 292c  lockdim([(1, 2),
+0001f590: 2028 322c 2031 295d 290a 2020 2020 2831   (2, 1)]).    (1
+0001f5a0: 2c20 312c 2031 290a 2020 2020 3e3e 3e20  , 1, 1).    >>> 
+0001f5b0: 636f 6d6d 6f6e 5f62 6c6f 636b 6469 6d28  common_blockdim(
+0001f5c0: 5b28 322c 2032 292c 2028 332c 2031 295d  [(2, 2), (3, 1)]
+0001f5d0: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
+0001f5e0: 4b49 500a 2020 2020 5472 6163 6562 6163  KIP.    Tracebac
+0001f5f0: 6b20 286d 6f73 7420 7265 6365 6e74 2063  k (most recent c
+0001f600: 616c 6c20 6c61 7374 293a 0a20 2020 2020  all last):.     
+0001f610: 2020 202e 2e2e 0a20 2020 2056 616c 7565     ....    Value
+0001f620: 4572 726f 723a 2043 6875 6e6b 7320 646f  Error: Chunks do
+0001f630: 206e 6f74 2061 6c69 676e 0a20 2020 2022   not align.    "
+0001f640: 2222 0a20 2020 2069 6620 6e6f 7420 616e  "".    if not an
+0001f650: 7928 626c 6f63 6b64 696d 7329 3a0a 2020  y(blockdims):.  
+0001f660: 2020 2020 2020 7265 7475 726e 2028 290a        return ().
+0001f670: 2020 2020 6e6f 6e5f 7472 6976 6961 6c5f      non_trivial_
+0001f680: 6469 6d73 203d 207b 6420 666f 7220 6420  dims = {d for d 
+0001f690: 696e 2062 6c6f 636b 6469 6d73 2069 6620  in blockdims if 
+0001f6a0: 6c65 6e28 6429 203e 2031 7d0a 2020 2020  len(d) > 1}.    
+0001f6b0: 6966 206c 656e 286e 6f6e 5f74 7269 7669  if len(non_trivi
+0001f6c0: 616c 5f64 696d 7329 203d 3d20 313a 0a20  al_dims) == 1:. 
+0001f6d0: 2020 2020 2020 2072 6574 7572 6e20 6669         return fi
+0001f6e0: 7273 7428 6e6f 6e5f 7472 6976 6961 6c5f  rst(non_trivial_
+0001f6f0: 6469 6d73 290a 2020 2020 6966 206c 656e  dims).    if len
+0001f700: 286e 6f6e 5f74 7269 7669 616c 5f64 696d  (non_trivial_dim
+0001f710: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+0001f720: 2072 6574 7572 6e20 6d61 7828 626c 6f63   return max(bloc
+0001f730: 6b64 696d 732c 206b 6579 3d66 6972 7374  kdims, key=first
+0001f740: 290a 0a20 2020 2069 6620 6e70 2e69 736e  )..    if np.isn
+0001f750: 616e 2873 756d 286d 6170 2873 756d 2c20  an(sum(map(sum, 
+0001f760: 626c 6f63 6b64 696d 7329 2929 3a0a 2020  blockdims))):.  
+0001f770: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0001f780: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0001f790: 2020 2020 2241 7272 6179 7327 2063 6875      "Arrays' chu
+0001f7a0: 6e6b 2073 697a 6573 2028 2573 2920 6172  nk sizes (%s) ar
+0001f7b0: 6520 756e 6b6e 6f77 6e2e 5c6e 5c6e 220a  e unknown.\n\n".
+0001f7c0: 2020 2020 2020 2020 2020 2020 2241 2070              "A p
+0001f7d0: 6f73 7369 626c 6520 736f 6c75 7469 6f6e  ossible solution
+0001f7e0: 3a5c 6e22 0a20 2020 2020 2020 2020 2020  :\n".           
+0001f7f0: 2022 2020 782e 636f 6d70 7574 655f 6368   "  x.compute_ch
+0001f800: 756e 6b5f 7369 7a65 7328 2922 2025 2062  unk_sizes()" % b
+0001f810: 6c6f 636b 6469 6d73 0a20 2020 2020 2020  lockdims.       
+0001f820: 2029 0a0a 2020 2020 6966 206c 656e 2873   )..    if len(s
+0001f830: 6574 286d 6170 2873 756d 2c20 6e6f 6e5f  et(map(sum, non_
+0001f840: 7472 6976 6961 6c5f 6469 6d73 2929 2920  trivial_dims))) 
+0001f850: 3e20 313a 0a20 2020 2020 2020 2072 6169  > 1:.        rai
+0001f860: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
+0001f870: 6875 6e6b 7320 646f 206e 6f74 2061 6464  hunks do not add
+0001f880: 2075 7020 746f 2073 616d 6520 7661 6c75   up to same valu
+0001f890: 6522 2c20 626c 6f63 6b64 696d 7329 0a0a  e", blockdims)..
+0001f8a0: 2020 2020 2320 5765 2068 6176 6520 6d75      # We have mu
+0001f8b0: 6c74 6970 6c65 206e 6f6e 2d74 7269 7669  ltiple non-trivi
+0001f8c0: 616c 2063 6875 6e6b 7320 6f6e 2074 6869  al chunks on thi
+0001f8d0: 7320 6178 6973 0a20 2020 2023 2065 2e67  s axis.    # e.g
+0001f8e0: 2e20 2835 2c20 3229 2061 6e64 2028 342c  . (5, 2) and (4,
+0001f8f0: 2033 290a 0a20 2020 2023 2057 6520 6372   3)..    # We cr
+0001f900: 6561 7465 2061 2073 696e 676c 6520 6368  eate a single ch
+0001f910: 756e 6b20 7475 706c 6520 7769 7468 2074  unk tuple with t
+0001f920: 6865 2073 616d 6520 746f 7461 6c20 6c65  he same total le
+0001f930: 6e67 7468 0a20 2020 2023 2074 6861 7420  ngth.    # that 
+0001f940: 6576 656e 6c79 2064 6976 6964 6573 2062  evenly divides b
+0001f950: 6f74 682c 2065 2e67 2e20 2834 2c20 312c  oth, e.g. (4, 1,
+0001f960: 2032 290a 0a20 2020 2023 2054 6f20 6163   2)..    # To ac
+0001f970: 636f 6d70 6c69 7368 2074 6869 7320 7765  complish this we
+0001f980: 2077 616c 6b20 646f 776e 2061 6c6c 2063   walk down all c
+0001f990: 6875 6e6b 2074 7570 6c65 7320 746f 6765  hunk tuples toge
+0001f9a0: 7468 6572 2c20 6669 6e64 696e 6720 7468  ther, finding th
+0001f9b0: 650a 2020 2020 2320 736d 616c 6c65 7374  e.    # smallest
+0001f9c0: 2065 6c65 6d65 6e74 2c20 6164 6469 6e67   element, adding
+0001f9d0: 2069 7420 746f 2074 6865 206f 7574 7075   it to the outpu
+0001f9e0: 742c 2061 6e64 2073 7562 7472 6163 7469  t, and subtracti
+0001f9f0: 6e67 2069 7420 6672 6f6d 2061 6c6c 0a20  ng it from all. 
+0001fa00: 2020 2023 206f 7468 6572 2065 6c65 6d65     # other eleme
+0001fa10: 6e74 7320 616e 6420 7265 6d6f 7665 2074  nts and remove t
+0001fa20: 6865 2065 6c65 6d65 6e74 2069 7473 656c  he element itsel
+0001fa30: 662e 2020 5765 2073 746f 7020 6f6e 6365  f.  We stop once
+0001fa40: 2077 6520 6861 7665 0a20 2020 2023 2062   we have.    # b
+0001fa50: 7572 6e65 6420 7468 726f 7567 6820 616c  urned through al
+0001fa60: 6c20 6f66 2074 6865 2063 6875 6e6b 2074  l of the chunk t
+0001fa70: 7570 6c65 732e 0a20 2020 2023 2046 6f72  uples..    # For
+0001fa80: 2065 6666 6963 6965 6e63 7927 7320 7361   efficiency's sa
+0001fa90: 6b65 2077 6520 7265 7665 7273 6520 7468  ke we reverse th
+0001faa0: 6520 6c69 7374 7320 736f 2074 6861 7420  e lists so that 
+0001fab0: 7765 2063 616e 2070 6f70 206f 6666 2074  we can pop off t
+0001fac0: 6865 2065 6e64 0a20 2020 2072 6368 756e  he end.    rchun
+0001fad0: 6b73 203d 205b 6c69 7374 286e 7464 295b  ks = [list(ntd)[
+0001fae0: 3a3a 2d31 5d20 666f 7220 6e74 6420 696e  ::-1] for ntd in
+0001faf0: 206e 6f6e 5f74 7269 7669 616c 5f64 696d   non_trivial_dim
+0001fb00: 735d 0a20 2020 2074 6f74 616c 203d 2073  s].    total = s
+0001fb10: 756d 2866 6972 7374 286e 6f6e 5f74 7269  um(first(non_tri
+0001fb20: 7669 616c 5f64 696d 7329 290a 2020 2020  vial_dims)).    
+0001fb30: 6920 3d20 300a 0a20 2020 206f 7574 203d  i = 0..    out =
+0001fb40: 205b 5d0a 2020 2020 7768 696c 6520 6920   [].    while i 
+0001fb50: 3c20 746f 7461 6c3a 0a20 2020 2020 2020  < total:.       
+0001fb60: 206d 203d 206d 696e 2863 5b2d 315d 2066   m = min(c[-1] f
+0001fb70: 6f72 2063 2069 6e20 7263 6875 6e6b 7329  or c in rchunks)
+0001fb80: 0a20 2020 2020 2020 206f 7574 2e61 7070  .        out.app
+0001fb90: 656e 6428 6d29 0a20 2020 2020 2020 2066  end(m).        f
+0001fba0: 6f72 2063 2069 6e20 7263 6875 6e6b 733a  or c in rchunks:
+0001fbb0: 0a20 2020 2020 2020 2020 2020 2063 5b2d  .            c[-
+0001fbc0: 315d 202d 3d20 6d0a 2020 2020 2020 2020  1] -= m.        
+0001fbd0: 2020 2020 6966 2063 5b2d 315d 203d 3d20      if c[-1] == 
+0001fbe0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0001fbf0: 2020 2063 2e70 6f70 2829 0a20 2020 2020     c.pop().     
+0001fc00: 2020 2069 202b 3d20 6d0a 0a20 2020 2072     i += m..    r
+0001fc10: 6574 7572 6e20 7475 706c 6528 6f75 7429  eturn tuple(out)
+0001fc20: 0a0a 0a64 6566 2075 6e69 6679 5f63 6875  ...def unify_chu
+0001fc30: 6e6b 7328 2a61 7267 732c 202a 2a6b 7761  nks(*args, **kwa
+0001fc40: 7267 7329 3a0a 2020 2020 2222 220a 2020  rgs):.    """.  
+0001fc50: 2020 556e 6966 7920 6368 756e 6b73 2061    Unify chunks a
+0001fc60: 6372 6f73 7320 6120 7365 7175 656e 6365  cross a sequence
+0001fc70: 206f 6620 6172 7261 7973 0a0a 2020 2020   of arrays..    
+0001fc80: 5468 6973 2075 7469 6c69 7479 2066 756e  This utility fun
+0001fc90: 6374 696f 6e20 6973 2075 7365 6420 7769  ction is used wi
+0001fca0: 7468 696e 206f 7468 6572 2063 6f6d 6d6f  thin other commo
+0001fcb0: 6e20 6f70 6572 6174 696f 6e73 206c 696b  n operations lik
+0001fcc0: 650a 2020 2020 3a66 756e 633a 6064 6173  e.    :func:`das
+0001fcd0: 6b2e 6172 7261 792e 636f 7265 2e6d 6170  k.array.core.map
+0001fce0: 5f62 6c6f 636b 7360 2061 6e64 203a 6675  _blocks` and :fu
+0001fcf0: 6e63 3a60 6461 736b 2e61 7272 6179 2e63  nc:`dask.array.c
+0001fd00: 6f72 652e 626c 6f63 6b77 6973 6560 2e0a  ore.blockwise`..
+0001fd10: 2020 2020 4974 2069 7320 6e6f 7420 636f      It is not co
+0001fd20: 6d6d 6f6e 6c79 2075 7365 6420 6279 2065  mmonly used by e
+0001fd30: 6e64 2d75 7365 7273 2064 6972 6563 746c  nd-users directl
+0001fd40: 792e 0a0a 2020 2020 5061 7261 6d65 7465  y...    Paramete
+0001fd50: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+0001fd60: 2d0a 2020 2020 2a61 7267 733a 2073 6571  -.    *args: seq
+0001fd70: 7565 6e63 6520 6f66 2041 7272 6179 2c20  uence of Array, 
+0001fd80: 696e 6465 7820 7061 6972 730a 2020 2020  index pairs.    
+0001fd90: 2020 2020 5365 7175 656e 6365 206c 696b      Sequence lik
+0001fda0: 6520 2878 2c20 2769 6a27 2c20 792c 2027  e (x, 'ij', y, '
+0001fdb0: 6a6b 272c 207a 2c20 2769 2729 0a0a 2020  jk', z, 'i')..  
+0001fdc0: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+0001fdd0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+0001fde0: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+0001fdf0: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
+0001fe00: 7820 3d20 6461 2e6f 6e65 7328 3130 2c20  x = da.ones(10, 
+0001fe10: 6368 756e 6b73 3d28 2835 2c20 322c 2033  chunks=((5, 2, 3
+0001fe20: 292c 2929 0a20 2020 203e 3e3e 2079 203d  ),)).    >>> y =
+0001fe30: 2064 612e 6f6e 6573 2831 302c 2063 6875   da.ones(10, chu
+0001fe40: 6e6b 733d 2828 322c 2033 2c20 3529 2c29  nks=((2, 3, 5),)
+0001fe50: 290a 2020 2020 3e3e 3e20 6368 756e 6b73  ).    >>> chunks
+0001fe60: 732c 2061 7272 6179 7320 3d20 756e 6966  s, arrays = unif
+0001fe70: 795f 6368 756e 6b73 2878 2c20 2769 272c  y_chunks(x, 'i',
+0001fe80: 2079 2c20 2769 2729 0a20 2020 203e 3e3e   y, 'i').    >>>
+0001fe90: 2063 6875 6e6b 7373 0a20 2020 207b 2769   chunkss.    {'i
+0001fea0: 273a 2028 322c 2033 2c20 322c 2033 297d  ': (2, 3, 2, 3)}
+0001feb0: 0a0a 2020 2020 3e3e 3e20 7820 3d20 6461  ..    >>> x = da
+0001fec0: 2e6f 6e65 7328 2831 3030 2c20 3130 292c  .ones((100, 10),
+0001fed0: 2063 6875 6e6b 733d 2832 302c 2035 2929   chunks=(20, 5))
+0001fee0: 0a20 2020 203e 3e3e 2079 203d 2064 612e  .    >>> y = da.
+0001fef0: 6f6e 6573 2828 3130 2c20 3130 3029 2c20  ones((10, 100), 
+0001ff00: 6368 756e 6b73 3d28 342c 2035 3029 290a  chunks=(4, 50)).
+0001ff10: 2020 2020 3e3e 3e20 6368 756e 6b73 732c      >>> chunkss,
+0001ff20: 2061 7272 6179 7320 3d20 756e 6966 795f   arrays = unify_
+0001ff30: 6368 756e 6b73 2878 2c20 2769 6a27 2c20  chunks(x, 'ij', 
+0001ff40: 792c 2027 6a6b 272c 2027 636f 6e73 7461  y, 'jk', 'consta
+0001ff50: 6e74 272c 204e 6f6e 6529 0a20 2020 203e  nt', None).    >
+0001ff60: 3e3e 2063 6875 6e6b 7373 2020 2320 646f  >> chunkss  # do
+0001ff70: 6374 6573 743a 202b 534b 4950 0a20 2020  ctest: +SKIP.   
+0001ff80: 207b 276b 273a 2028 3530 2c20 3530 292c   {'k': (50, 50),
+0001ff90: 2027 6927 3a20 2832 302c 2032 302c 2032   'i': (20, 20, 2
+0001ffa0: 302c 2032 302c 2032 3029 2c20 276a 273a  0, 20, 20), 'j':
+0001ffb0: 2028 342c 2031 2c20 332c 2032 297d 0a0a   (4, 1, 3, 2)}..
+0001ffc0: 2020 2020 3e3e 3e20 756e 6966 795f 6368      >>> unify_ch
+0001ffd0: 756e 6b73 2830 2c20 4e6f 6e65 290a 2020  unks(0, None).  
+0001ffe0: 2020 287b 7d2c 205b 305d 290a 0a20 2020    ({}, [0])..   
+0001fff0: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
+00020000: 2d2d 2d2d 0a20 2020 2063 6875 6e6b 7373  ----.    chunkss
+00020010: 203a 2064 6963 740a 2020 2020 2020 2020   : dict.        
+00020020: 4d61 7020 6c69 6b65 207b 696e 6465 783a  Map like {index:
+00020030: 2063 6875 6e6b 737d 2e0a 2020 2020 6172   chunks}..    ar
+00020040: 7261 7973 203a 206c 6973 740a 2020 2020  rays : list.    
+00020050: 2020 2020 4c69 7374 206f 6620 7265 6368      List of rech
+00020060: 756e 6b65 6420 6172 7261 7973 2e0a 0a20  unked arrays... 
+00020070: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00020080: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063 6f6d  --------.    com
+00020090: 6d6f 6e5f 626c 6f63 6b64 696d 0a20 2020  mon_blockdim.   
+000200a0: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
+000200b0: 6172 6773 3a0a 2020 2020 2020 2020 7265  args:.        re
+000200c0: 7475 726e 207b 7d2c 205b 5d0a 0a20 2020  turn {}, []..   
+000200d0: 2061 7267 696e 6473 203d 205b 0a20 2020   arginds = [.   
+000200e0: 2020 2020 2028 6173 616e 7961 7272 6179       (asanyarray
+000200f0: 2861 2920 6966 2069 6e64 2069 7320 6e6f  (a) if ind is no
+00020100: 7420 4e6f 6e65 2065 6c73 6520 612c 2069  t None else a, i
+00020110: 6e64 2920 666f 7220 612c 2069 6e64 2069  nd) for a, ind i
+00020120: 6e20 7061 7274 6974 696f 6e28 322c 2061  n partition(2, a
+00020130: 7267 7329 0a20 2020 205d 2020 2320 5b78  rgs).    ]  # [x
+00020140: 2c20 696a 2c20 792c 206a 6b5d 0a20 2020  , ij, y, jk].   
+00020150: 2077 6172 6e20 3d20 6b77 6172 6773 2e67   warn = kwargs.g
+00020160: 6574 2822 7761 726e 222c 2054 7275 6529  et("warn", True)
+00020170: 0a0a 2020 2020 6172 7261 7973 2c20 696e  ..    arrays, in
+00020180: 6473 203d 207a 6970 282a 6172 6769 6e64  ds = zip(*argind
+00020190: 7329 0a20 2020 2069 6620 616c 6c28 696e  s).    if all(in
+000201a0: 6420 6973 204e 6f6e 6520 666f 7220 696e  d is None for in
+000201b0: 6420 696e 2069 6e64 7329 3a0a 2020 2020  d in inds):.    
+000201c0: 2020 2020 7265 7475 726e 207b 7d2c 206c      return {}, l
+000201d0: 6973 7428 6172 7261 7973 290a 2020 2020  ist(arrays).    
+000201e0: 6966 2061 6c6c 2869 6e64 203d 3d20 696e  if all(ind == in
+000201f0: 6473 5b30 5d20 666f 7220 696e 6420 696e  ds[0] for ind in
+00020200: 2069 6e64 7329 2061 6e64 2061 6c6c 280a   inds) and all(.
+00020210: 2020 2020 2020 2020 612e 6368 756e 6b73          a.chunks
+00020220: 203d 3d20 6172 7261 7973 5b30 5d2e 6368   == arrays[0].ch
+00020230: 756e 6b73 2066 6f72 2061 2069 6e20 6172  unks for a in ar
+00020240: 7261 7973 0a20 2020 2029 3a0a 2020 2020  rays.    ):.    
+00020250: 2020 2020 7265 7475 726e 2064 6963 7428      return dict(
+00020260: 7a69 7028 696e 6473 5b30 5d2c 2061 7272  zip(inds[0], arr
+00020270: 6179 735b 305d 2e63 6875 6e6b 7329 292c  ays[0].chunks)),
+00020280: 2061 7272 6179 730a 0a20 2020 206e 616d   arrays..    nam
+00020290: 6569 6e64 7320 3d20 5b5d 0a20 2020 2062  einds = [].    b
+000202a0: 6c6f 636b 6469 6d5f 6469 6374 203d 2064  lockdim_dict = d
+000202b0: 6963 7428 290a 2020 2020 6d61 785f 7061  ict().    max_pa
+000202c0: 7274 7320 3d20 300a 2020 2020 666f 7220  rts = 0.    for 
+000202d0: 612c 2069 6e64 2069 6e20 6172 6769 6e64  a, ind in argind
+000202e0: 733a 0a20 2020 2020 2020 2069 6620 696e  s:.        if in
+000202f0: 6420 6973 206e 6f74 204e 6f6e 653a 0a20  d is not None:. 
+00020300: 2020 2020 2020 2020 2020 206e 616d 6569             namei
+00020310: 6e64 732e 6170 7065 6e64 2828 612e 6e61  nds.append((a.na
+00020320: 6d65 2c20 696e 6429 290a 2020 2020 2020  me, ind)).      
+00020330: 2020 2020 2020 626c 6f63 6b64 696d 5f64        blockdim_d
+00020340: 6963 745b 612e 6e61 6d65 5d20 3d20 612e  ict[a.name] = a.
+00020350: 6368 756e 6b73 0a20 2020 2020 2020 2020  chunks.         
+00020360: 2020 206d 6178 5f70 6172 7473 203d 206d     max_parts = m
+00020370: 6178 286d 6178 5f70 6172 7473 2c20 612e  ax(max_parts, a.
+00020380: 6e70 6172 7469 7469 6f6e 7329 0a20 2020  npartitions).   
+00020390: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000203a0: 2020 2020 2020 206e 616d 6569 6e64 732e         nameinds.
+000203b0: 6170 7065 6e64 2828 612c 2069 6e64 2929  append((a, ind))
+000203c0: 0a0a 2020 2020 6368 756e 6b73 7320 3d20  ..    chunkss = 
+000203d0: 6272 6f61 6463 6173 745f 6469 6d65 6e73  broadcast_dimens
+000203e0: 696f 6e73 286e 616d 6569 6e64 732c 2062  ions(nameinds, b
+000203f0: 6c6f 636b 6469 6d5f 6469 6374 2c20 636f  lockdim_dict, co
+00020400: 6e73 6f6c 6964 6174 653d 636f 6d6d 6f6e  nsolidate=common
+00020410: 5f62 6c6f 636b 6469 6d29 0a20 2020 206e  _blockdim).    n
+00020420: 7061 7274 7320 3d20 6d61 7468 2e70 726f  parts = math.pro
+00020430: 6428 6d61 7028 6c65 6e2c 2063 6875 6e6b  d(map(len, chunk
+00020440: 7373 2e76 616c 7565 7328 2929 290a 0a20  ss.values())).. 
+00020450: 2020 2069 6620 7761 726e 2061 6e64 206e     if warn and n
+00020460: 7061 7274 7320 616e 6420 6e70 6172 7473  parts and nparts
+00020470: 203e 3d20 6d61 785f 7061 7274 7320 2a20   >= max_parts * 
+00020480: 3130 3a0a 2020 2020 2020 2020 7761 726e  10:.        warn
+00020490: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
+000204a0: 2020 2020 2020 2022 496e 6372 6561 7369         "Increasi
+000204b0: 6e67 206e 756d 6265 7220 6f66 2063 6875  ng number of chu
+000204c0: 6e6b 7320 6279 2066 6163 746f 7220 6f66  nks by factor of
+000204d0: 2025 6422 2025 2028 6e70 6172 7473 202f   %d" % (nparts /
+000204e0: 206d 6178 5f70 6172 7473 292c 0a20 2020   max_parts),.   
+000204f0: 2020 2020 2020 2020 2050 6572 666f 726d           Perform
+00020500: 616e 6365 5761 726e 696e 672c 0a20 2020  anceWarning,.   
+00020510: 2020 2020 2020 2020 2073 7461 636b 6c65           stackle
+00020520: 7665 6c3d 332c 0a20 2020 2020 2020 2029  vel=3,.        )
+00020530: 0a0a 2020 2020 6172 7261 7973 203d 205b  ..    arrays = [
+00020540: 5d0a 2020 2020 666f 7220 612c 2069 2069  ].    for a, i i
+00020550: 6e20 6172 6769 6e64 733a 0a20 2020 2020  n arginds:.     
+00020560: 2020 2069 6620 6920 6973 204e 6f6e 653a     if i is None:
+00020570: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
+00020580: 6179 732e 6170 7065 6e64 2861 290a 2020  ays.append(a).  
+00020590: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000205a0: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+000205b0: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
+000205c0: 2020 2020 2020 2020 6368 756e 6b73 735b          chunkss[
+000205d0: 6a5d 0a20 2020 2020 2020 2020 2020 2020  j].             
+000205e0: 2020 2069 6620 612e 7368 6170 655b 6e5d     if a.shape[n]
+000205f0: 203e 2031 0a20 2020 2020 2020 2020 2020   > 1.           
+00020600: 2020 2020 2065 6c73 6520 612e 7368 6170       else a.shap
+00020610: 655b 6e5d 0a20 2020 2020 2020 2020 2020  e[n].           
+00020620: 2020 2020 2069 6620 6e6f 7420 6e70 2e69       if not np.i
+00020630: 736e 616e 2873 756d 2863 6875 6e6b 7373  snan(sum(chunkss
+00020640: 5b6a 5d29 290a 2020 2020 2020 2020 2020  [j])).          
+00020650: 2020 2020 2020 656c 7365 204e 6f6e 650a        else None.
+00020660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020670: 666f 7220 6e2c 206a 2069 6e20 656e 756d  for n, j in enum
+00020680: 6572 6174 6528 6929 0a20 2020 2020 2020  erate(i).       
+00020690: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000206a0: 2020 2069 6620 6368 756e 6b73 2021 3d20     if chunks != 
+000206b0: 612e 6368 756e 6b73 2061 6e64 2061 6c6c  a.chunks and all
+000206c0: 2861 2e63 6875 6e6b 7329 3a0a 2020 2020  (a.chunks):.    
+000206d0: 2020 2020 2020 2020 2020 2020 6172 7261              arra
+000206e0: 7973 2e61 7070 656e 6428 612e 7265 6368  ys.append(a.rech
+000206f0: 756e 6b28 6368 756e 6b73 2929 0a20 2020  unk(chunks)).   
+00020700: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00020710: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00020720: 7272 6179 732e 6170 7065 6e64 2861 290a  rrays.append(a).
+00020730: 2020 2020 7265 7475 726e 2063 6875 6e6b      return chunk
+00020740: 7373 2c20 6172 7261 7973 0a0a 0a64 6566  ss, arrays...def
+00020750: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+00020760: 6e28 7829 3a0a 2020 2020 2222 220a 0a20  n(x):.    """.. 
+00020770: 2020 203e 3e3e 2075 6e70 6163 6b5f 7369     >>> unpack_si
+00020780: 6e67 6c65 746f 6e28 5b5b 5b5b 315d 5d5d  ngleton([[[[1]]]
+00020790: 5d29 0a20 2020 2031 0a20 2020 203e 3e3e  ]).    1.    >>>
+000207a0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+000207b0: 6e28 6e70 2e61 7272 6179 286e 702e 6461  n(np.array(np.da
+000207c0: 7465 7469 6d65 3634 2827 3230 3030 2d30  tetime64('2000-0
+000207d0: 312d 3031 2729 2929 0a20 2020 2061 7272  1-01'))).    arr
+000207e0: 6179 2827 3230 3030 2d30 312d 3031 272c  ay('2000-01-01',
+000207f0: 2064 7479 7065 3d27 6461 7465 7469 6d65   dtype='datetime
+00020800: 3634 5b44 5d27 290a 2020 2020 2222 220a  64[D]').    """.
+00020810: 2020 2020 7768 696c 6520 6973 696e 7374      while isinst
+00020820: 616e 6365 2878 2c20 286c 6973 742c 2074  ance(x, (list, t
+00020830: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
+00020840: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00020850: 2078 203d 2078 5b30 5d0a 2020 2020 2020   x = x[0].      
+00020860: 2020 6578 6365 7074 2028 496e 6465 7845    except (IndexE
+00020870: 7272 6f72 2c20 5479 7065 4572 726f 722c  rror, TypeError,
+00020880: 204b 6579 4572 726f 7229 3a0a 2020 2020   KeyError):.    
+00020890: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+000208a0: 2020 7265 7475 726e 2078 0a0a 0a64 6566    return x...def
+000208b0: 2062 6c6f 636b 2861 7272 6179 732c 2061   block(arrays, a
+000208c0: 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63 6875  llow_unknown_chu
+000208d0: 6e6b 7369 7a65 733d 4661 6c73 6529 3a0a  nksizes=False):.
+000208e0: 2020 2020 2222 220a 2020 2020 4173 7365      """.    Asse
+000208f0: 6d62 6c65 2061 6e20 6e64 2d61 7272 6179  mble an nd-array
+00020900: 2066 726f 6d20 6e65 7374 6564 206c 6973   from nested lis
+00020910: 7473 206f 6620 626c 6f63 6b73 2e0a 0a20  ts of blocks... 
+00020920: 2020 2042 6c6f 636b 7320 696e 2074 6865     Blocks in the
+00020930: 2069 6e6e 6572 6d6f 7374 206c 6973 7473   innermost lists
+00020940: 2061 7265 2063 6f6e 6361 7465 6e61 7465   are concatenate
+00020950: 6420 616c 6f6e 6720 7468 6520 6c61 7374  d along the last
+00020960: 0a20 2020 2064 696d 656e 7369 6f6e 2028  .    dimension (
+00020970: 2d31 292c 2074 6865 6e20 7468 6573 6520  -1), then these 
+00020980: 6172 6520 636f 6e63 6174 656e 6174 6564  are concatenated
+00020990: 2061 6c6f 6e67 2074 6865 2073 6563 6f6e   along the secon
+000209a0: 642d 6c61 7374 0a20 2020 2064 696d 656e  d-last.    dimen
+000209b0: 7369 6f6e 2028 2d32 292c 2061 6e64 2073  sion (-2), and s
+000209c0: 6f20 6f6e 2075 6e74 696c 2074 6865 206f  o on until the o
+000209d0: 7574 6572 6d6f 7374 206c 6973 7420 6973  utermost list is
+000209e0: 2072 6561 6368 6564 0a0a 2020 2020 426c   reached..    Bl
+000209f0: 6f63 6b73 2063 616e 2062 6520 6f66 2061  ocks can be of a
+00020a00: 6e79 2064 696d 656e 7369 6f6e 2c20 6275  ny dimension, bu
+00020a10: 7420 7769 6c6c 206e 6f74 2062 6520 6272  t will not be br
+00020a20: 6f61 6463 6173 7465 6420 7573 696e 6720  oadcasted using 
+00020a30: 7468 6520 6e6f 726d 616c 0a20 2020 2072  the normal.    r
+00020a40: 756c 6573 2e20 496e 7374 6561 642c 206c  ules. Instead, l
+00020a50: 6561 6469 6e67 2061 7865 7320 6f66 2073  eading axes of s
+00020a60: 697a 6520 3120 6172 6520 696e 7365 7274  ize 1 are insert
+00020a70: 6564 2c20 746f 206d 616b 6520 6060 626c  ed, to make ``bl
+00020a80: 6f63 6b2e 6e64 696d 6060 0a20 2020 2074  ock.ndim``.    t
+00020a90: 6865 2073 616d 6520 666f 7220 616c 6c20  he same for all 
+00020aa0: 626c 6f63 6b73 2e20 5468 6973 2069 7320  blocks. This is 
+00020ab0: 7072 696d 6172 696c 7920 7573 6566 756c  primarily useful
+00020ac0: 2066 6f72 2077 6f72 6b69 6e67 2077 6974   for working wit
+00020ad0: 6820 7363 616c 6172 732c 0a20 2020 2061  h scalars,.    a
+00020ae0: 6e64 206d 6561 6e73 2074 6861 7420 636f  nd means that co
+00020af0: 6465 206c 696b 6520 6060 626c 6f63 6b28  de like ``block(
+00020b00: 5b76 2c20 315d 2960 6020 6973 2076 616c  [v, 1])`` is val
+00020b10: 6964 2c20 7768 6572 650a 2020 2020 6060  id, where.    ``
+00020b20: 762e 6e64 696d 203d 3d20 3160 602e 0a0a  v.ndim == 1``...
+00020b30: 2020 2020 5768 656e 2074 6865 206e 6573      When the nes
+00020b40: 7465 6420 6c69 7374 2069 7320 7477 6f20  ted list is two 
+00020b50: 6c65 7665 6c73 2064 6565 702c 2074 6869  levels deep, thi
+00020b60: 7320 616c 6c6f 7773 2062 6c6f 636b 206d  s allows block m
+00020b70: 6174 7269 6365 7320 746f 2062 650a 2020  atrices to be.  
+00020b80: 2020 636f 6e73 7472 7563 7465 6420 6672    constructed fr
+00020b90: 6f6d 2074 6865 6972 2063 6f6d 706f 6e65  om their compone
+00020ba0: 6e74 732e 0a0a 2020 2020 5061 7261 6d65  nts...    Parame
+00020bb0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00020bc0: 2d2d 2d0a 2020 2020 6172 7261 7973 203a  ---.    arrays :
+00020bd0: 206e 6573 7465 6420 6c69 7374 206f 6620   nested list of 
+00020be0: 6172 7261 795f 6c69 6b65 206f 7220 7363  array_like or sc
+00020bf0: 616c 6172 7320 2862 7574 206e 6f74 2074  alars (but not t
+00020c00: 7570 6c65 7329 0a20 2020 2020 2020 2049  uples).        I
+00020c10: 6620 7061 7373 6564 2061 2073 696e 676c  f passed a singl
+00020c20: 6520 6e64 6172 7261 7920 6f72 2073 6361  e ndarray or sca
+00020c30: 6c61 7220 2861 206e 6573 7465 6420 6c69  lar (a nested li
+00020c40: 7374 206f 6620 6465 7074 6820 3029 2c20  st of depth 0), 
+00020c50: 7468 6973 0a20 2020 2020 2020 2069 7320  this.        is 
+00020c60: 7265 7475 726e 6564 2075 6e6d 6f64 6966  returned unmodif
+00020c70: 6965 6420 2861 6e64 206e 6f74 2063 6f70  ied (and not cop
+00020c80: 6965 6429 2e0a 0a20 2020 2020 2020 2045  ied)...        E
+00020c90: 6c65 6d65 6e74 7320 7368 6170 6573 206d  lements shapes m
+00020ca0: 7573 7420 6d61 7463 6820 616c 6f6e 6720  ust match along 
+00020cb0: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
+00020cc0: 6178 6573 2028 7769 7468 6f75 740a 2020  axes (without.  
+00020cd0: 2020 2020 2020 6272 6f61 6463 6173 7469        broadcasti
+00020ce0: 6e67 292c 2062 7574 206c 6561 6469 6e67  ng), but leading
+00020cf0: 2031 7320 7769 6c6c 2062 6520 7072 6570   1s will be prep
+00020d00: 656e 6465 6420 746f 2074 6865 2073 6861  ended to the sha
+00020d10: 7065 2061 730a 2020 2020 2020 2020 6e65  pe as.        ne
+00020d20: 6365 7373 6172 7920 746f 206d 616b 6520  cessary to make 
+00020d30: 7468 6520 6469 6d65 6e73 696f 6e73 206d  the dimensions m
+00020d40: 6174 6368 2e0a 0a20 2020 2061 6c6c 6f77  atch...    allow
+00020d50: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
+00020d60: 7a65 733a 2062 6f6f 6c0a 2020 2020 2020  zes: bool.      
+00020d70: 2020 416c 6c6f 7720 756e 6b6e 6f77 6e20    Allow unknown 
+00020d80: 6368 756e 6b73 697a 6573 2c20 7375 6368  chunksizes, such
+00020d90: 2061 7320 636f 6d65 2066 726f 6d20 636f   as come from co
+00020da0: 6e76 6572 7469 6e67 2066 726f 6d20 6461  nverting from da
+00020db0: 736b 0a20 2020 2020 2020 2064 6174 6166  sk.        dataf
+00020dc0: 7261 6d65 732e 2020 4461 736b 2e61 7272  rames.  Dask.arr
+00020dd0: 6179 2069 7320 756e 6162 6c65 2074 6f20  ay is unable to 
+00020de0: 7665 7269 6679 2074 6861 7420 6368 756e  verify that chun
+00020df0: 6b73 206c 696e 6520 7570 2e20 2049 660a  ks line up.  If.
+00020e00: 2020 2020 2020 2020 6461 7461 2063 6f6d          data com
+00020e10: 6573 2066 726f 6d20 6469 6666 6572 656e  es from differen
+00020e20: 746c 7920 616c 6967 6e65 6420 736f 7572  tly aligned sour
+00020e30: 6365 7320 7468 656e 2074 6869 7320 6361  ces then this ca
+00020e40: 6e20 6361 7573 650a 2020 2020 2020 2020  n cause.        
+00020e50: 756e 6578 7065 6374 6564 2072 6573 756c  unexpected resul
+00020e60: 7473 2e0a 0a20 2020 2052 6574 7572 6e73  ts...    Returns
+00020e70: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
+00020e80: 2062 6c6f 636b 5f61 7272 6179 203a 206e   block_array : n
+00020e90: 6461 7272 6179 0a20 2020 2020 2020 2054  darray.        T
+00020ea0: 6865 2061 7272 6179 2061 7373 656d 626c  he array assembl
+00020eb0: 6564 2066 726f 6d20 7468 6520 6769 7665  ed from the give
+00020ec0: 6e20 626c 6f63 6b73 2e0a 0a20 2020 2020  n blocks...     
+00020ed0: 2020 2054 6865 2064 696d 656e 7369 6f6e     The dimension
+00020ee0: 616c 6974 7920 6f66 2074 6865 206f 7574  ality of the out
+00020ef0: 7075 7420 6973 2065 7175 616c 2074 6f20  put is equal to 
+00020f00: 7468 6520 6772 6561 7465 7374 206f 663a  the greatest of:
+00020f10: 0a20 2020 2020 2020 202a 2074 6865 2064  .        * the d
+00020f20: 696d 656e 7369 6f6e 616c 6974 7920 6f66  imensionality of
+00020f30: 2061 6c6c 2074 6865 2069 6e70 7574 730a   all the inputs.
+00020f40: 2020 2020 2020 2020 2a20 7468 6520 6465          * the de
+00020f50: 7074 6820 746f 2077 6869 6368 2074 6865  pth to which the
+00020f60: 2069 6e70 7574 206c 6973 7420 6973 206e   input list is n
+00020f70: 6573 7465 640a 0a20 2020 2052 6169 7365  ested..    Raise
+00020f80: 730a 2020 2020 2d2d 2d2d 2d2d 0a20 2020  s.    ------.   
+00020f90: 2056 616c 7565 4572 726f 720a 2020 2020   ValueError.    
+00020fa0: 2020 2020 2a20 4966 206c 6973 7420 6465      * If list de
+00020fb0: 7074 6873 2061 7265 206d 6973 6d61 7463  pths are mismatc
+00020fc0: 6865 6420 2d20 666f 7220 696e 7374 616e  hed - for instan
+00020fd0: 6365 2c20 6060 5b5b 612c 2062 5d2c 2063  ce, ``[[a, b], c
+00020fe0: 5d60 6020 6973 0a20 2020 2020 2020 2020  ]`` is.         
+00020ff0: 2069 6c6c 6567 616c 2c20 616e 6420 7368   illegal, and sh
+00021000: 6f75 6c64 2062 6520 7370 656c 7420 6060  ould be spelt ``
+00021010: 5b5b 612c 2062 5d2c 205b 635d 5d60 600a  [[a, b], [c]]``.
+00021020: 2020 2020 2020 2020 2a20 4966 206c 6973          * If lis
+00021030: 7473 2061 7265 2065 6d70 7479 202d 2066  ts are empty - f
+00021040: 6f72 2069 6e73 7461 6e63 652c 2060 605b  or instance, ``[
+00021050: 5b61 2c20 625d 2c20 5b5d 5d60 600a 0a20  [a, b], []]``.. 
+00021060: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00021070: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2063 6f6e  --------.    con
+00021080: 6361 7465 6e61 7465 203a 204a 6f69 6e20  catenate : Join 
+00021090: 6120 7365 7175 656e 6365 206f 6620 6172  a sequence of ar
+000210a0: 7261 7973 2074 6f67 6574 6865 722e 0a20  rays together.. 
+000210b0: 2020 2073 7461 636b 203a 2053 7461 636b     stack : Stack
+000210c0: 2061 7272 6179 7320 696e 2073 6571 7565   arrays in seque
+000210d0: 6e63 6520 616c 6f6e 6720 6120 6e65 7720  nce along a new 
+000210e0: 6469 6d65 6e73 696f 6e2e 0a20 2020 2068  dimension..    h
+000210f0: 7374 6163 6b20 3a20 5374 6163 6b20 6172  stack : Stack ar
+00021100: 7261 7973 2069 6e20 7365 7175 656e 6365  rays in sequence
+00021110: 2068 6f72 697a 6f6e 7461 6c6c 7920 2863   horizontally (c
+00021120: 6f6c 756d 6e20 7769 7365 292e 0a20 2020  olumn wise)..   
+00021130: 2076 7374 6163 6b20 3a20 5374 6163 6b20   vstack : Stack 
+00021140: 6172 7261 7973 2069 6e20 7365 7175 656e  arrays in sequen
+00021150: 6365 2076 6572 7469 6361 6c6c 7920 2872  ce vertically (r
+00021160: 6f77 2077 6973 6529 2e0a 2020 2020 6473  ow wise)..    ds
+00021170: 7461 636b 203a 2053 7461 636b 2061 7272  tack : Stack arr
+00021180: 6179 7320 696e 2073 6571 7565 6e63 6520  ays in sequence 
+00021190: 6465 7074 6820 7769 7365 2028 616c 6f6e  depth wise (alon
+000211a0: 6720 7468 6972 6420 6469 6d65 6e73 696f  g third dimensio
+000211b0: 6e29 2e0a 2020 2020 7673 706c 6974 203a  n)..    vsplit :
+000211c0: 2053 706c 6974 2061 7272 6179 2069 6e74   Split array int
+000211d0: 6f20 6120 6c69 7374 206f 6620 6d75 6c74  o a list of mult
+000211e0: 6970 6c65 2073 7562 2d61 7272 6179 7320  iple sub-arrays 
+000211f0: 7665 7274 6963 616c 6c79 2e0a 0a20 2020  vertically...   
+00021200: 204e 6f74 6573 0a20 2020 202d 2d2d 2d2d   Notes.    -----
+00021210: 0a0a 2020 2020 5768 656e 2063 616c 6c65  ..    When calle
+00021220: 6420 7769 7468 206f 6e6c 7920 7363 616c  d with only scal
+00021230: 6172 732c 2060 6062 6c6f 636b 6060 2069  ars, ``block`` i
+00021240: 7320 6571 7569 7661 6c65 6e74 2074 6f20  s equivalent to 
+00021250: 616e 206e 6461 7272 6179 0a20 2020 2063  an ndarray.    c
+00021260: 616c 6c2e 2053 6f20 6060 626c 6f63 6b28  all. So ``block(
+00021270: 5b5b 312c 2032 5d2c 205b 332c 2034 5d5d  [[1, 2], [3, 4]]
+00021280: 2960 6020 6973 2065 7175 6976 616c 656e  )`` is equivalen
+00021290: 7420 746f 0a20 2020 2060 6061 7272 6179  t to.    ``array
+000212a0: 285b 5b31 2c20 325d 2c20 5b33 2c20 345d  ([[1, 2], [3, 4]
+000212b0: 5d29 6060 2e0a 0a20 2020 2054 6869 7320  ])``...    This 
+000212c0: 6675 6e63 7469 6f6e 2064 6f65 7320 6e6f  function does no
+000212d0: 7420 656e 666f 7263 6520 7468 6174 2074  t enforce that t
+000212e0: 6865 2062 6c6f 636b 7320 6c69 6520 6f6e  he blocks lie on
+000212f0: 2061 2066 6978 6564 2067 7269 642e 0a20   a fixed grid.. 
+00021300: 2020 2060 6062 6c6f 636b 285b 5b61 2c20     ``block([[a, 
+00021310: 625d 2c20 5b63 2c20 645d 5d29 6060 2069  b], [c, d]])`` i
+00021320: 7320 6e6f 7420 7265 7374 7269 6374 6564  s not restricted
+00021330: 2074 6f20 6172 7261 7973 206f 6620 7468   to arrays of th
+00021340: 6520 666f 726d 3a3a 0a0a 2020 2020 2020  e form::..      
+00021350: 2020 4141 4162 620a 2020 2020 2020 2020    AAAbb.        
+00021360: 4141 4162 620a 2020 2020 2020 2020 6363  AAAbb.        cc
+00021370: 6344 440a 0a20 2020 2042 7574 2069 7320  cDD..    But is 
+00021380: 616c 736f 2061 6c6c 6f77 6564 2074 6f20  also allowed to 
+00021390: 7072 6f64 7563 652c 2066 6f72 2073 6f6d  produce, for som
+000213a0: 6520 6060 612c 2062 2c20 632c 2064 6060  e ``a, b, c, d``
+000213b0: 3a3a 0a0a 2020 2020 2020 2020 4141 4162  ::..        AAAb
+000213c0: 620a 2020 2020 2020 2020 4141 4162 620a  b.        AAAbb.
+000213d0: 2020 2020 2020 2020 6344 4444 440a 0a20          cDDDD.. 
+000213e0: 2020 2053 696e 6365 2063 6f6e 6361 7465     Since concate
+000213f0: 6e61 7469 6f6e 2068 6170 7065 6e73 2061  nation happens a
+00021400: 6c6f 6e67 2074 6865 206c 6173 7420 6178  long the last ax
+00021410: 6973 2066 6972 7374 2c20 6062 6c6f 636b  is first, `block
+00021420: 6020 6973 205f 6e6f 745f 0a20 2020 2063  ` is _not_.    c
+00021430: 6170 6162 6c65 206f 6620 7072 6f64 7563  apable of produc
+00021440: 696e 6720 7468 6520 666f 6c6c 6f77 696e  ing the followin
+00021450: 6720 6469 7265 6374 6c79 3a3a 0a0a 2020  g directly::..  
+00021460: 2020 2020 2020 4141 4162 620a 2020 2020        AAAbb.    
+00021470: 2020 2020 6363 6362 620a 2020 2020 2020      cccbb.      
+00021480: 2020 6363 6344 440a 0a20 2020 204d 6174    cccDD..    Mat
+00021490: 6c61 6227 7320 2273 7175 6172 6520 6272  lab's "square br
+000214a0: 6163 6b65 7420 7374 6163 6b69 6e67 222c  acket stacking",
+000214b0: 2060 605b 412c 2042 2c20 2e2e 2e3b 2070   ``[A, B, ...; p
+000214c0: 2c20 712c 202e 2e2e 5d60 602c 2069 730a  , q, ...]``, is.
+000214d0: 2020 2020 6571 7569 7661 6c65 6e74 2074      equivalent t
+000214e0: 6f20 6060 626c 6f63 6b28 5b5b 412c 2042  o ``block([[A, B
+000214f0: 2c20 2e2e 2e5d 2c20 5b70 2c20 712c 202e  , ...], [p, q, .
+00021500: 2e2e 5d5d 2960 602e 0a20 2020 2022 2222  ..]])``..    """
+00021510: 0a0a 2020 2020 2320 5468 6973 2077 6173  ..    # This was
+00021520: 2063 6f70 6965 6420 616c 6d6f 7374 2076   copied almost v
+00021530: 6572 6261 7469 6d20 6672 6f6d 206e 756d  erbatim from num
+00021540: 7079 2e63 6f72 652e 7368 6170 655f 6261  py.core.shape_ba
+00021550: 7365 2e62 6c6f 636b 0a20 2020 2023 2053  se.block.    # S
+00021560: 6565 206e 756d 7079 206c 6963 656e 7365  ee numpy license
+00021570: 2061 7420 6874 7470 733a 2f2f 6769 7468   at https://gith
+00021580: 7562 2e63 6f6d 2f6e 756d 7079 2f6e 756d  ub.com/numpy/num
+00021590: 7079 2f62 6c6f 622f 6d61 7374 6572 2f4c  py/blob/master/L
+000215a0: 4943 454e 5345 2e74 7874 0a20 2020 2023  ICENSE.txt.    #
+000215b0: 206f 7220 4e55 4d50 595f 4c49 4345 4e53   or NUMPY_LICENS
+000215c0: 452e 7478 7420 7769 7468 696e 2074 6869  E.txt within thi
+000215d0: 7320 6469 7265 6374 6f72 790a 0a20 2020  s directory..   
+000215e0: 2064 6566 2061 746c 6561 7374 5f6e 6428   def atleast_nd(
+000215f0: 782c 206e 6469 6d29 3a0a 2020 2020 2020  x, ndim):.      
+00021600: 2020 7820 3d20 6173 616e 7961 7272 6179    x = asanyarray
+00021610: 2878 290a 2020 2020 2020 2020 6469 6666  (x).        diff
+00021620: 203d 206d 6178 286e 6469 6d20 2d20 782e   = max(ndim - x.
+00021630: 6e64 696d 2c20 3029 0a20 2020 2020 2020  ndim, 0).       
+00021640: 2069 6620 6469 6666 203d 3d20 303a 0a20   if diff == 0:. 
+00021650: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00021660: 6e20 780a 2020 2020 2020 2020 656c 7365  n x.        else
+00021670: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00021680: 7475 726e 2078 5b28 4e6f 6e65 2c29 202a  turn x[(None,) *
+00021690: 2064 6966 6620 2b20 2845 6c6c 6970 7369   diff + (Ellipsi
+000216a0: 732c 295d 0a0a 2020 2020 6465 6620 666f  s,)]..    def fo
+000216b0: 726d 6174 5f69 6e64 6578 2869 6e64 6578  rmat_index(index
+000216c0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000216d0: 6e20 2261 7272 6179 7322 202b 2022 222e  n "arrays" + "".
+000216e0: 6a6f 696e 2866 225b 7b69 7d5d 2220 666f  join(f"[{i}]" fo
+000216f0: 7220 6920 696e 2069 6e64 6578 290a 0a20  r i in index).. 
+00021700: 2020 2072 6563 203d 205f 5265 6375 7273     rec = _Recurs
+00021710: 6572 2872 6563 7572 7365 5f69 663d 6c61  er(recurse_if=la
+00021720: 6d62 6461 2078 3a20 7479 7065 2878 2920  mbda x: type(x) 
+00021730: 6973 206c 6973 7429 0a0a 2020 2020 2320  is list)..    # 
+00021740: 656e 7375 7265 2074 6861 7420 7468 6520  ensure that the 
+00021750: 6c69 7374 7320 6172 6520 616c 6c20 6d61  lists are all ma
+00021760: 7463 6865 6420 696e 2064 6570 7468 0a20  tched in depth. 
+00021770: 2020 206c 6973 745f 6e64 696d 203d 204e     list_ndim = N
+00021780: 6f6e 650a 2020 2020 616e 795f 656d 7074  one.    any_empt
+00021790: 7920 3d20 4661 6c73 650a 2020 2020 666f  y = False.    fo
+000217a0: 7220 696e 6465 782c 2076 616c 7565 2c20  r index, value, 
+000217b0: 656e 7465 7269 6e67 2069 6e20 7265 632e  entering in rec.
+000217c0: 7761 6c6b 2861 7272 6179 7329 3a0a 2020  walk(arrays):.  
+000217d0: 2020 2020 2020 6966 2074 7970 6528 7661        if type(va
+000217e0: 6c75 6529 2069 7320 7475 706c 653a 0a20  lue) is tuple:. 
+000217f0: 2020 2020 2020 2020 2020 2023 206e 6f74             # not
+00021800: 2073 7472 6963 746c 7920 6e65 6365 7373   strictly necess
+00021810: 6172 792c 2062 7574 2073 6176 6573 2075  ary, but saves u
+00021820: 7320 6672 6f6d 3a0a 2020 2020 2020 2020  s from:.        
+00021830: 2020 2020 2320 202d 206d 6f72 6520 7468      #  - more th
+00021840: 616e 206f 6e65 2077 6179 2074 6f20 646f  an one way to do
+00021850: 2074 6869 6e67 7320 2d20 6e6f 2070 6f69   things - no poi
+00021860: 6e74 2074 7265 6174 696e 6720 7475 706c  nt treating tupl
+00021870: 6573 206c 696b 650a 2020 2020 2020 2020  es like.        
+00021880: 2020 2020 2320 2020 206c 6973 7473 0a20      #    lists. 
+00021890: 2020 2020 2020 2020 2020 2023 2020 2d20             #  - 
+000218a0: 686f 7272 6962 6c79 2063 6f6e 6675 7369  horribly confusi
+000218b0: 6e67 2062 6568 6176 696f 7572 2074 6861  ng behaviour tha
+000218c0: 7420 7265 7375 6c74 7320 7768 656e 2074  t results when t
+000218d0: 7570 6c65 7320 6172 650a 2020 2020 2020  uples are.      
+000218e0: 2020 2020 2020 2320 2020 2074 7265 6174        #    treat
+000218f0: 6564 206c 696b 6520 6e64 6172 7261 790a  ed like ndarray.
+00021900: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00021910: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
+00021920: 2020 2020 2020 2020 2020 2020 2022 7b7d               "{}
+00021930: 2069 7320 6120 7475 706c 652e 2022 0a20   is a tuple. ". 
+00021940: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00021950: 4f6e 6c79 206c 6973 7473 2063 616e 2062  Only lists can b
+00021960: 6520 7573 6564 2074 6f20 6172 7261 6e67  e used to arrang
+00021970: 6520 626c 6f63 6b73 2c20 616e 6420 6e70  e blocks, and np
+00021980: 2e62 6c6f 636b 2064 6f65 7320 220a 2020  .block does ".  
+00021990: 2020 2020 2020 2020 2020 2020 2020 226e                "n
+000219a0: 6f74 2061 6c6c 6f77 2069 6d70 6c69 6369  ot allow implici
+000219b0: 7420 636f 6e76 6572 7369 6f6e 2066 726f  t conversion fro
+000219c0: 6d20 7475 706c 6520 746f 206e 6461 7272  m tuple to ndarr
+000219d0: 6179 2e22 2e66 6f72 6d61 7428 0a20 2020  ay.".format(.   
+000219e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219f0: 2066 6f72 6d61 745f 696e 6465 7828 696e   format_index(in
+00021a00: 6465 7829 0a20 2020 2020 2020 2020 2020  dex).           
+00021a10: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00021a20: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00021a30: 6e6f 7420 656e 7465 7269 6e67 3a0a 2020  not entering:.  
+00021a40: 2020 2020 2020 2020 2020 6375 7272 5f64            curr_d
+00021a50: 6570 7468 203d 206c 656e 2869 6e64 6578  epth = len(index
+00021a60: 290a 2020 2020 2020 2020 656c 6966 206c  ).        elif l
+00021a70: 656e 2876 616c 7565 2920 3d3d 2030 3a0a  en(value) == 0:.
+00021a80: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00021a90: 5f64 6570 7468 203d 206c 656e 2869 6e64  _depth = len(ind
+00021aa0: 6578 2920 2b20 310a 2020 2020 2020 2020  ex) + 1.        
+00021ab0: 2020 2020 616e 795f 656d 7074 7920 3d20      any_empty = 
+00021ac0: 5472 7565 0a20 2020 2020 2020 2065 6c73  True.        els
+00021ad0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00021ae0: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
+00021af0: 2069 6620 6c69 7374 5f6e 6469 6d20 6973   if list_ndim is
+00021b00: 206e 6f74 204e 6f6e 6520 616e 6420 6c69   not None and li
+00021b10: 7374 5f6e 6469 6d20 213d 2063 7572 725f  st_ndim != curr_
+00021b20: 6465 7074 683a 0a20 2020 2020 2020 2020  depth:.         
+00021b30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00021b40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00021b50: 2020 2020 2022 4c69 7374 2064 6570 7468       "List depth
+00021b60: 7320 6172 6520 6d69 736d 6174 6368 6564  s are mismatched
+00021b70: 2e20 4669 7273 7420 656c 656d 656e 7420  . First element 
+00021b80: 7761 7320 6174 2064 6570 7468 207b 7d2c  was at depth {},
+00021b90: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00021ba0: 2020 2022 6275 7420 7468 6572 6520 6973     "but there is
+00021bb0: 2061 6e20 656c 656d 656e 7420 6174 2064   an element at d
+00021bc0: 6570 7468 207b 7d20 287b 7d29 222e 666f  epth {} ({})".fo
+00021bd0: 726d 6174 280a 2020 2020 2020 2020 2020  rmat(.          
+00021be0: 2020 2020 2020 2020 2020 6c69 7374 5f6e            list_n
+00021bf0: 6469 6d2c 2063 7572 725f 6465 7074 682c  dim, curr_depth,
+00021c00: 2066 6f72 6d61 745f 696e 6465 7828 696e   format_index(in
+00021c10: 6465 7829 0a20 2020 2020 2020 2020 2020  dex).           
+00021c20: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00021c30: 2020 2029 0a20 2020 2020 2020 206c 6973     ).        lis
+00021c40: 745f 6e64 696d 203d 2063 7572 725f 6465  t_ndim = curr_de
+00021c50: 7074 680a 0a20 2020 2023 2064 6f20 7468  pth..    # do th
+00021c60: 6973 2068 6572 6520 736f 2077 6520 6361  is here so we ca
+00021c70: 7463 6820 6465 7074 6820 6d69 736d 6174  tch depth mismat
+00021c80: 6368 6573 2066 6972 7374 0a20 2020 2069  ches first.    i
+00021c90: 6620 616e 795f 656d 7074 793a 0a20 2020  f any_empty:.   
+00021ca0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00021cb0: 4572 726f 7228 224c 6973 7473 2063 616e  Error("Lists can
+00021cc0: 6e6f 7420 6265 2065 6d70 7479 2229 0a0a  not be empty")..
+00021cd0: 2020 2020 2320 636f 6e76 6572 7420 616c      # convert al
+00021ce0: 6c20 7468 6520 6172 7261 7973 2074 6f20  l the arrays to 
+00021cf0: 6e64 6172 7261 7973 0a20 2020 2061 7272  ndarrays.    arr
+00021d00: 6179 7320 3d20 7265 632e 6d61 705f 7265  ays = rec.map_re
+00021d10: 6475 6365 2861 7272 6179 732c 2066 5f6d  duce(arrays, f_m
+00021d20: 6170 3d61 7361 6e79 6172 7261 792c 2066  ap=asanyarray, f
+00021d30: 5f72 6564 7563 653d 6c69 7374 290a 0a20  _reduce=list).. 
+00021d40: 2020 2023 2064 6574 6572 6d69 6e65 2074     # determine t
+00021d50: 6865 206d 6178 696d 756d 2064 696d 656e  he maximum dimen
+00021d60: 7369 6f6e 206f 6620 7468 6520 656c 656d  sion of the elem
+00021d70: 656e 7473 0a20 2020 2065 6c65 6d5f 6e64  ents.    elem_nd
+00021d80: 696d 203d 2072 6563 2e6d 6170 5f72 6564  im = rec.map_red
+00021d90: 7563 6528 6172 7261 7973 2c20 665f 6d61  uce(arrays, f_ma
+00021da0: 703d 6c61 6d62 6461 2078 693a 2078 692e  p=lambda xi: xi.
+00021db0: 6e64 696d 2c20 665f 7265 6475 6365 3d6d  ndim, f_reduce=m
+00021dc0: 6178 290a 2020 2020 6e64 696d 203d 206d  ax).    ndim = m
+00021dd0: 6178 286c 6973 745f 6e64 696d 2c20 656c  ax(list_ndim, el
+00021de0: 656d 5f6e 6469 6d29 0a0a 2020 2020 2320  em_ndim)..    # 
+00021df0: 6669 7273 7420 6178 6973 2074 6f20 636f  first axis to co
+00021e00: 6e63 6174 656e 6174 6520 616c 6f6e 670a  ncatenate along.
+00021e10: 2020 2020 6669 7273 745f 6178 6973 203d      first_axis =
+00021e20: 206e 6469 6d20 2d20 6c69 7374 5f6e 6469   ndim - list_ndi
+00021e30: 6d0a 0a20 2020 2023 204d 616b 6520 616c  m..    # Make al
+00021e40: 6c20 7468 6520 656c 656d 656e 7473 2074  l the elements t
+00021e50: 6865 2073 616d 6520 6469 6d65 6e73 696f  he same dimensio
+00021e60: 6e0a 2020 2020 6172 7261 7973 203d 2072  n.    arrays = r
+00021e70: 6563 2e6d 6170 5f72 6564 7563 6528 0a20  ec.map_reduce(. 
+00021e80: 2020 2020 2020 2061 7272 6179 732c 2066         arrays, f
+00021e90: 5f6d 6170 3d6c 616d 6264 6120 7869 3a20  _map=lambda xi: 
+00021ea0: 6174 6c65 6173 745f 6e64 2878 692c 206e  atleast_nd(xi, n
+00021eb0: 6469 6d29 2c20 665f 7265 6475 6365 3d6c  dim), f_reduce=l
+00021ec0: 6973 740a 2020 2020 290a 0a20 2020 2023  ist.    )..    #
+00021ed0: 2063 6f6e 6361 7465 6e61 7465 2069 6e6e   concatenate inn
+00021ee0: 6572 6d6f 7374 206c 6973 7473 206f 6e20  ermost lists on 
+00021ef0: 7468 6520 7269 6768 742c 206f 7574 6572  the right, outer
+00021f00: 6d6f 7374 206f 6e20 7468 6520 6c65 6674  most on the left
+00021f10: 0a20 2020 2072 6574 7572 6e20 7265 632e  .    return rec.
+00021f20: 6d61 705f 7265 6475 6365 280a 2020 2020  map_reduce(.    
+00021f30: 2020 2020 6172 7261 7973 2c0a 2020 2020      arrays,.    
+00021f40: 2020 2020 665f 7265 6475 6365 3d6c 616d      f_reduce=lam
+00021f50: 6264 6120 7873 2c20 6178 6973 3a20 636f  bda xs, axis: co
+00021f60: 6e63 6174 656e 6174 6528 0a20 2020 2020  ncatenate(.     
+00021f70: 2020 2020 2020 206c 6973 7428 7873 292c         list(xs),
+00021f80: 2061 7869 733d 6178 6973 2c20 616c 6c6f   axis=axis, allo
+00021f90: 775f 756e 6b6e 6f77 6e5f 6368 756e 6b73  w_unknown_chunks
+00021fa0: 697a 6573 3d61 6c6c 6f77 5f75 6e6b 6e6f  izes=allow_unkno
+00021fb0: 776e 5f63 6875 6e6b 7369 7a65 730a 2020  wn_chunksizes.  
+00021fc0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00021fd0: 2066 5f6b 7761 7267 733d 6c61 6d62 6461   f_kwargs=lambda
+00021fe0: 2061 7869 733a 2064 6963 7428 6178 6973   axis: dict(axis
+00021ff0: 3d28 6178 6973 202b 2031 2929 2c0a 2020  =(axis + 1)),.  
+00022000: 2020 2020 2020 6178 6973 3d66 6972 7374        axis=first
+00022010: 5f61 7869 732c 0a20 2020 2029 0a0a 0a64  _axis,.    )...d
+00022020: 6566 2063 6f6e 6361 7465 6e61 7465 2873  ef concatenate(s
+00022030: 6571 2c20 6178 6973 3d30 2c20 616c 6c6f  eq, axis=0, allo
+00022040: 775f 756e 6b6e 6f77 6e5f 6368 756e 6b73  w_unknown_chunks
+00022050: 697a 6573 3d46 616c 7365 293a 0a20 2020  izes=False):.   
+00022060: 2022 2222 0a20 2020 2043 6f6e 6361 7465   """.    Concate
+00022070: 6e61 7465 2061 7272 6179 7320 616c 6f6e  nate arrays alon
+00022080: 6720 616e 2065 7869 7374 696e 6720 6178  g an existing ax
+00022090: 6973 0a0a 2020 2020 4769 7665 6e20 6120  is..    Given a 
+000220a0: 7365 7175 656e 6365 206f 6620 6461 736b  sequence of dask
+000220b0: 2041 7272 6179 7320 666f 726d 2061 206e   Arrays form a n
+000220c0: 6577 2064 6173 6b20 4172 7261 7920 6279  ew dask Array by
+000220d0: 2073 7461 636b 696e 6720 7468 656d 0a20   stacking them. 
+000220e0: 2020 2061 6c6f 6e67 2061 6e20 6578 6973     along an exis
+000220f0: 7469 6e67 2064 696d 656e 7369 6f6e 2028  ting dimension (
+00022100: 6178 6973 3d30 2062 7920 6465 6661 756c  axis=0 by defaul
+00022110: 7429 0a0a 2020 2020 5061 7261 6d65 7465  t)..    Paramete
+00022120: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00022130: 2d0a 2020 2020 7365 713a 206c 6973 7420  -.    seq: list 
+00022140: 6f66 2064 6173 6b2e 6172 7261 7973 0a20  of dask.arrays. 
+00022150: 2020 2061 7869 733a 2069 6e74 0a20 2020     axis: int.   
+00022160: 2020 2020 2044 696d 656e 7369 6f6e 2061       Dimension a
+00022170: 6c6f 6e67 2077 6869 6368 2074 6f20 616c  long which to al
+00022180: 6967 6e20 616c 6c20 6f66 2074 6865 2061  ign all of the a
+00022190: 7272 6179 732e 2049 6620 6178 6973 2069  rrays. If axis i
+000221a0: 7320 4e6f 6e65 2c0a 2020 2020 2020 2020  s None,.        
+000221b0: 6172 7261 7973 2061 7265 2066 6c61 7474  arrays are flatt
+000221c0: 656e 6564 2062 6566 6f72 6520 7573 652e  ened before use.
+000221d0: 0a20 2020 2061 6c6c 6f77 5f75 6e6b 6e6f  .    allow_unkno
+000221e0: 776e 5f63 6875 6e6b 7369 7a65 733a 2062  wn_chunksizes: b
+000221f0: 6f6f 6c0a 2020 2020 2020 2020 416c 6c6f  ool.        Allo
+00022200: 7720 756e 6b6e 6f77 6e20 6368 756e 6b73  w unknown chunks
+00022210: 697a 6573 2c20 7375 6368 2061 7320 636f  izes, such as co
+00022220: 6d65 2066 726f 6d20 636f 6e76 6572 7469  me from converti
+00022230: 6e67 2066 726f 6d20 6461 736b 0a20 2020  ng from dask.   
+00022240: 2020 2020 2064 6174 6166 7261 6d65 732e       dataframes.
+00022250: 2020 4461 736b 2e61 7272 6179 2069 7320    Dask.array is 
+00022260: 756e 6162 6c65 2074 6f20 7665 7269 6679  unable to verify
+00022270: 2074 6861 7420 6368 756e 6b73 206c 696e   that chunks lin
+00022280: 6520 7570 2e20 2049 660a 2020 2020 2020  e up.  If.      
+00022290: 2020 6461 7461 2063 6f6d 6573 2066 726f    data comes fro
+000222a0: 6d20 6469 6666 6572 656e 746c 7920 616c  m differently al
+000222b0: 6967 6e65 6420 736f 7572 6365 7320 7468  igned sources th
+000222c0: 656e 2074 6869 7320 6361 6e20 6361 7573  en this can caus
+000222d0: 650a 2020 2020 2020 2020 756e 6578 7065  e.        unexpe
+000222e0: 6374 6564 2072 6573 756c 7473 2e0a 0a20  cted results... 
+000222f0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00022300: 2d2d 2d2d 2d2d 2d2d 0a0a 2020 2020 4372  --------..    Cr
+00022310: 6561 7465 2073 6c69 6365 730a 0a20 2020  eate slices..   
+00022320: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
+00022330: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
+00022340: 203e 3e3e 2069 6d70 6f72 7420 6e75 6d70   >>> import nump
+00022350: 7920 6173 206e 700a 0a20 2020 203e 3e3e  y as np..    >>>
+00022360: 2064 6174 6120 3d20 5b64 612e 6672 6f6d   data = [da.from
+00022370: 5f61 7272 6179 286e 702e 6f6e 6573 2828  _array(np.ones((
+00022380: 342c 2034 2929 2c20 6368 756e 6b73 3d28  4, 4)), chunks=(
+00022390: 322c 2032 2929 0a20 2020 202e 2e2e 2020  2, 2)).    ...  
+000223a0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+000223b0: 2072 616e 6765 2833 295d 0a0a 2020 2020   range(3)]..    
+000223c0: 3e3e 3e20 7820 3d20 6461 2e63 6f6e 6361  >>> x = da.conca
+000223d0: 7465 6e61 7465 2864 6174 612c 2061 7869  tenate(data, axi
+000223e0: 733d 3029 0a20 2020 203e 3e3e 2078 2e73  s=0).    >>> x.s
+000223f0: 6861 7065 0a20 2020 2028 3132 2c20 3429  hape.    (12, 4)
+00022400: 0a0a 2020 2020 3e3e 3e20 6461 2e63 6f6e  ..    >>> da.con
+00022410: 6361 7465 6e61 7465 2864 6174 612c 2061  catenate(data, a
+00022420: 7869 733d 3129 2e73 6861 7065 0a20 2020  xis=1).shape.   
+00022430: 2028 342c 2031 3229 0a0a 2020 2020 5265   (4, 12)..    Re
+00022440: 7375 6c74 2069 7320 6120 6e65 7720 6461  sult is a new da
+00022450: 736b 2041 7272 6179 0a0a 2020 2020 5365  sk Array..    Se
+00022460: 6520 416c 736f 0a20 2020 202d 2d2d 2d2d  e Also.    -----
+00022470: 2d2d 2d0a 2020 2020 7374 6163 6b0a 2020  ---.    stack.  
+00022480: 2020 2222 220a 2020 2020 6672 6f6d 2064    """.    from d
+00022490: 6173 6b2e 6172 7261 7920 696d 706f 7274  ask.array import
+000224a0: 2077 7261 700a 0a20 2020 2073 6571 203d   wrap..    seq =
+000224b0: 205b 6173 6172 7261 7928 612c 2061 6c6c   [asarray(a, all
+000224c0: 6f77 5f75 6e6b 6e6f 776e 5f63 6875 6e6b  ow_unknown_chunk
+000224d0: 7369 7a65 733d 616c 6c6f 775f 756e 6b6e  sizes=allow_unkn
+000224e0: 6f77 6e5f 6368 756e 6b73 697a 6573 2920  own_chunksizes) 
+000224f0: 666f 7220 6120 696e 2073 6571 5d0a 0a20  for a in seq].. 
+00022500: 2020 2069 6620 6e6f 7420 7365 713a 0a20     if not seq:. 
+00022510: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00022520: 7565 4572 726f 7228 224e 6565 6420 6172  ueError("Need ar
+00022530: 7261 7928 7329 2074 6f20 636f 6e63 6174  ray(s) to concat
+00022540: 656e 6174 6522 290a 0a20 2020 2069 6620  enate")..    if 
+00022550: 6178 6973 2069 7320 4e6f 6e65 3a0a 2020  axis is None:.  
+00022560: 2020 2020 2020 7365 7120 3d20 5b61 2e66        seq = [a.f
+00022570: 6c61 7474 656e 2829 2066 6f72 2061 2069  latten() for a i
+00022580: 6e20 7365 715d 0a20 2020 2020 2020 2061  n seq].        a
+00022590: 7869 7320 3d20 300a 0a20 2020 2073 6571  xis = 0..    seq
+000225a0: 5f6d 6574 6173 203d 205b 6d65 7461 5f66  _metas = [meta_f
+000225b0: 726f 6d5f 6172 7261 7928 7329 2066 6f72  rom_array(s) for
+000225c0: 2073 2069 6e20 7365 715d 0a20 2020 205f   s in seq].    _
+000225d0: 636f 6e63 6174 656e 6174 6520 3d20 636f  concatenate = co
+000225e0: 6e63 6174 656e 6174 655f 6c6f 6f6b 7570  ncatenate_lookup
+000225f0: 2e64 6973 7061 7463 6828 0a20 2020 2020  .dispatch(.     
+00022600: 2020 2074 7970 6528 6d61 7828 7365 715f     type(max(seq_
+00022610: 6d65 7461 732c 206b 6579 3d6c 616d 6264  metas, key=lambd
+00022620: 6120 783a 2067 6574 6174 7472 2878 2c20  a x: getattr(x, 
+00022630: 225f 5f61 7272 6179 5f70 7269 6f72 6974  "__array_priorit
+00022640: 795f 5f22 2c20 3029 2929 0a20 2020 2029  y__", 0))).    )
+00022650: 0a20 2020 206d 6574 6120 3d20 5f63 6f6e  .    meta = _con
+00022660: 6361 7465 6e61 7465 2873 6571 5f6d 6574  catenate(seq_met
+00022670: 6173 2c20 6178 6973 3d61 7869 7329 0a0a  as, axis=axis)..
+00022680: 2020 2020 2320 5072 6f6d 6f74 6520 7479      # Promote ty
+00022690: 7065 7320 746f 206d 6174 6368 206d 6574  pes to match met
+000226a0: 610a 2020 2020 7365 7120 3d20 5b61 2e61  a.    seq = [a.a
+000226b0: 7374 7970 6528 6d65 7461 2e64 7479 7065  stype(meta.dtype
+000226c0: 2920 666f 7220 6120 696e 2073 6571 5d0a  ) for a in seq].
+000226d0: 0a20 2020 2023 2046 696e 6420 6f75 7470  .    # Find outp
+000226e0: 7574 2061 7272 6179 2073 6861 7065 0a20  ut array shape. 
+000226f0: 2020 206e 6469 6d20 3d20 6c65 6e28 7365     ndim = len(se
+00022700: 715b 305d 2e73 6861 7065 290a 2020 2020  q[0].shape).    
+00022710: 7368 6170 6520 3d20 7475 706c 6528 0a20  shape = tuple(. 
+00022720: 2020 2020 2020 2073 756d 2861 2e73 6861         sum(a.sha
+00022730: 7065 5b69 5d20 666f 7220 6120 696e 2073  pe[i] for a in s
+00022740: 6571 2920 6966 2069 203d 3d20 6178 6973  eq) if i == axis
+00022750: 2065 6c73 6520 7365 715b 305d 2e73 6861   else seq[0].sha
+00022760: 7065 5b69 5d0a 2020 2020 2020 2020 666f  pe[i].        fo
+00022770: 7220 6920 696e 2072 616e 6765 286e 6469  r i in range(ndi
+00022780: 6d29 0a20 2020 2029 0a0a 2020 2020 2320  m).    )..    # 
+00022790: 4472 6f70 2065 6d70 7479 2061 7272 6179  Drop empty array
+000227a0: 730a 2020 2020 7365 7132 203d 205b 6120  s.    seq2 = [a 
+000227b0: 666f 7220 6120 696e 2073 6571 2069 6620  for a in seq if 
+000227c0: 612e 7369 7a65 5d0a 2020 2020 6966 206e  a.size].    if n
+000227d0: 6f74 2073 6571 323a 0a20 2020 2020 2020  ot seq2:.       
+000227e0: 2073 6571 3220 3d20 7365 710a 0a20 2020   seq2 = seq..   
+000227f0: 2069 6620 6178 6973 203c 2030 3a0a 2020   if axis < 0:.  
+00022800: 2020 2020 2020 6178 6973 203d 206e 6469        axis = ndi
+00022810: 6d20 2b20 6178 6973 0a20 2020 2069 6620  m + axis.    if 
+00022820: 6178 6973 203e 3d20 6e64 696d 3a0a 2020  axis >= ndim:.  
+00022830: 2020 2020 2020 6d73 6720 3d20 280a 2020        msg = (.  
+00022840: 2020 2020 2020 2020 2020 2241 7869 7320            "Axis 
+00022850: 6d75 7374 2062 6520 6c65 7373 2074 6861  must be less tha
+00022860: 6e20 7468 616e 206e 756d 6265 7220 6f66  n than number of
+00022870: 2064 696d 656e 7369 6f6e 7322 0a20 2020   dimensions".   
+00022880: 2020 2020 2020 2020 2022 5c6e 4461 7461           "\nData
+00022890: 2068 6173 2025 6420 6469 6d65 6e73 696f   has %d dimensio
+000228a0: 6e73 2c20 6275 7420 676f 7420 6178 6973  ns, but got axis
+000228b0: 3d25 6422 0a20 2020 2020 2020 2029 0a20  =%d".        ). 
+000228c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000228d0: 7565 4572 726f 7228 6d73 6720 2520 286e  ueError(msg % (n
+000228e0: 6469 6d2c 2061 7869 7329 290a 0a20 2020  dim, axis))..   
+000228f0: 206e 203d 206c 656e 2873 6571 3229 0a20   n = len(seq2). 
+00022900: 2020 2069 6620 6e20 3d3d 2030 3a0a 2020     if n == 0:.  
+00022910: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00022920: 2020 2020 2020 2072 6574 7572 6e20 7772         return wr
+00022930: 6170 2e65 6d70 7479 5f6c 696b 6528 6d65  ap.empty_like(me
+00022940: 7461 2c20 7368 6170 653d 7368 6170 652c  ta, shape=shape,
+00022950: 2063 6875 6e6b 733d 7368 6170 652c 2064   chunks=shape, d
+00022960: 7479 7065 3d6d 6574 612e 6474 7970 6529  type=meta.dtype)
+00022970: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00022980: 5479 7065 4572 726f 723a 0a20 2020 2020  TypeError:.     
+00022990: 2020 2020 2020 2072 6574 7572 6e20 7772         return wr
+000229a0: 6170 2e65 6d70 7479 2873 6861 7065 2c20  ap.empty(shape, 
+000229b0: 6368 756e 6b73 3d73 6861 7065 2c20 6474  chunks=shape, dt
+000229c0: 7970 653d 6d65 7461 2e64 7479 7065 290a  ype=meta.dtype).
+000229d0: 2020 2020 656c 6966 206e 203d 3d20 313a      elif n == 1:
+000229e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000229f0: 7365 7132 5b30 5d0a 0a20 2020 2069 6620  seq2[0]..    if 
+00022a00: 6e6f 7420 616c 6c6f 775f 756e 6b6e 6f77  not allow_unknow
+00022a10: 6e5f 6368 756e 6b73 697a 6573 2061 6e64  n_chunksizes and
+00022a20: 206e 6f74 2061 6c6c 280a 2020 2020 2020   not all(.      
+00022a30: 2020 6920 3d3d 2061 7869 7320 6f72 2061    i == axis or a
+00022a40: 6c6c 2878 2e73 6861 7065 5b69 5d20 3d3d  ll(x.shape[i] ==
+00022a50: 2073 6571 325b 305d 2e73 6861 7065 5b69   seq2[0].shape[i
+00022a60: 5d20 666f 7220 7820 696e 2073 6571 3229  ] for x in seq2)
+00022a70: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+00022a80: 6e20 7261 6e67 6528 6e64 696d 290a 2020  n range(ndim).  
+00022a90: 2020 293a 0a20 2020 2020 2020 2069 6620    ):.        if 
+00022aa0: 616e 7928 6d61 7028 6e70 2e69 736e 616e  any(map(np.isnan
+00022ab0: 2c20 7365 7132 5b30 5d2e 7368 6170 6529  , seq2[0].shape)
+00022ac0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00022ad0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00022ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022af0: 2022 5472 6965 6420 746f 2063 6f6e 6361   "Tried to conca
+00022b00: 7465 6e61 7465 2061 7272 6179 7320 7769  tenate arrays wi
+00022b10: 7468 2075 6e6b 6e6f 776e 220a 2020 2020  th unknown".    
+00022b20: 2020 2020 2020 2020 2020 2020 2220 7368              " sh
+00022b30: 6170 6520 2573 2e5c 6e5c 6e54 776f 2073  ape %s.\n\nTwo s
+00022b40: 6f6c 7574 696f 6e73 3a5c 6e22 0a20 2020  olutions:\n".   
+00022b50: 2020 2020 2020 2020 2020 2020 2022 2020               "  
+00022b60: 312e 2046 6f72 6365 2063 6f6e 6361 7465  1. Force concate
+00022b70: 6e61 7469 6f6e 2070 6173 7322 0a20 2020  nation pass".   
+00022b80: 2020 2020 2020 2020 2020 2020 2022 2061               " a
+00022b90: 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63 6875  llow_unknown_chu
+00022ba0: 6e6b 7369 7a65 733d 5472 7565 2e5c 6e22  nksizes=True.\n"
+00022bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022bc0: 2022 2020 322e 2043 6f6d 7075 7465 2073   "  2. Compute s
+00022bd0: 6861 7065 7320 7769 7468 2022 0a20 2020  hapes with ".   
+00022be0: 2020 2020 2020 2020 2020 2020 2022 5b78               "[x
+00022bf0: 2e63 6f6d 7075 7465 5f63 6875 6e6b 5f73  .compute_chunk_s
+00022c00: 697a 6573 2829 2066 6f72 2078 2069 6e20  izes() for x in 
+00022c10: 7365 715d 2220 2520 7374 7228 7365 7132  seq]" % str(seq2
+00022c20: 5b30 5d2e 7368 6170 6529 0a20 2020 2020  [0].shape).     
+00022c30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00022c40: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00022c50: 7228 2253 6861 7065 7320 646f 206e 6f74  r("Shapes do not
+00022c60: 2061 6c69 676e 3a20 2573 222c 205b 782e   align: %s", [x.
+00022c70: 7368 6170 6520 666f 7220 7820 696e 2073  shape for x in s
+00022c80: 6571 325d 290a 0a20 2020 2069 6e64 7320  eq2])..    inds 
+00022c90: 3d20 5b6c 6973 7428 7261 6e67 6528 6e64  = [list(range(nd
+00022ca0: 696d 2929 2066 6f72 2069 2069 6e20 7261  im)) for i in ra
+00022cb0: 6e67 6528 6e29 5d0a 2020 2020 666f 7220  nge(n)].    for 
+00022cc0: 692c 2069 6e64 2069 6e20 656e 756d 6572  i, ind in enumer
+00022cd0: 6174 6528 696e 6473 293a 0a20 2020 2020  ate(inds):.     
+00022ce0: 2020 2069 6e64 5b61 7869 735d 203d 202d     ind[axis] = -
+00022cf0: 2869 202b 2031 290a 0a20 2020 2075 635f  (i + 1)..    uc_
+00022d00: 6172 6773 203d 206c 6973 7428 636f 6e63  args = list(conc
+00022d10: 6174 287a 6970 2873 6571 322c 2069 6e64  at(zip(seq2, ind
+00022d20: 7329 2929 0a20 2020 205f 2c20 7365 7132  s))).    _, seq2
+00022d30: 203d 2075 6e69 6679 5f63 6875 6e6b 7328   = unify_chunks(
+00022d40: 2a75 635f 6172 6773 2c20 7761 726e 3d46  *uc_args, warn=F
+00022d50: 616c 7365 290a 0a20 2020 2062 6473 203d  alse)..    bds =
+00022d60: 205b 612e 6368 756e 6b73 2066 6f72 2061   [a.chunks for a
+00022d70: 2069 6e20 7365 7132 5d0a 0a20 2020 2063   in seq2]..    c
+00022d80: 6875 6e6b 7320 3d20 280a 2020 2020 2020  hunks = (.      
+00022d90: 2020 7365 7132 5b30 5d2e 6368 756e 6b73    seq2[0].chunks
+00022da0: 5b3a 6178 6973 5d0a 2020 2020 2020 2020  [:axis].        
+00022db0: 2b20 2873 756d 2828 6264 5b61 7869 735d  + (sum((bd[axis]
+00022dc0: 2066 6f72 2062 6420 696e 2062 6473 292c   for bd in bds),
+00022dd0: 2028 2929 2c29 0a20 2020 2020 2020 202b   ()),).        +
+00022de0: 2073 6571 325b 305d 2e63 6875 6e6b 735b   seq2[0].chunks[
+00022df0: 6178 6973 202b 2031 203a 5d0a 2020 2020  axis + 1 :].    
+00022e00: 290a 0a20 2020 2063 756d 5f64 696d 7320  )..    cum_dims 
+00022e10: 3d20 5b30 5d20 2b20 6c69 7374 2861 6363  = [0] + list(acc
+00022e20: 756d 756c 6174 6528 6164 642c 205b 6c65  umulate(add, [le
+00022e30: 6e28 612e 6368 756e 6b73 5b61 7869 735d  n(a.chunks[axis]
+00022e40: 2920 666f 7220 6120 696e 2073 6571 325d  ) for a in seq2]
+00022e50: 2929 0a0a 2020 2020 6e61 6d65 7320 3d20  ))..    names = 
+00022e60: 5b61 2e6e 616d 6520 666f 7220 6120 696e  [a.name for a in
+00022e70: 2073 6571 325d 0a0a 2020 2020 6e61 6d65   seq2]..    name
+00022e80: 203d 2022 636f 6e63 6174 656e 6174 652d   = "concatenate-
+00022e90: 2220 2b20 746f 6b65 6e69 7a65 286e 616d  " + tokenize(nam
+00022ea0: 6573 2c20 6178 6973 290a 2020 2020 6b65  es, axis).    ke
+00022eb0: 7973 203d 206c 6973 7428 7072 6f64 7563  ys = list(produc
+00022ec0: 7428 5b6e 616d 655d 2c20 2a5b 7261 6e67  t([name], *[rang
+00022ed0: 6528 6c65 6e28 6264 2929 2066 6f72 2062  e(len(bd)) for b
+00022ee0: 6420 696e 2063 6875 6e6b 735d 2929 0a0a  d in chunks]))..
+00022ef0: 2020 2020 7661 6c75 6573 203d 205b 0a20      values = [. 
+00022f00: 2020 2020 2020 2028 6e61 6d65 735b 6269         (names[bi
+00022f10: 7365 6374 2863 756d 5f64 696d 732c 206b  sect(cum_dims, k
+00022f20: 6579 5b61 7869 7320 2b20 315d 2920 2d20  ey[axis + 1]) - 
+00022f30: 315d 2c29 0a20 2020 2020 2020 202b 206b  1],).        + k
+00022f40: 6579 5b31 203a 2061 7869 7320 2b20 315d  ey[1 : axis + 1]
+00022f50: 0a20 2020 2020 2020 202b 2028 6b65 795b  .        + (key[
+00022f60: 6178 6973 202b 2031 5d20 2d20 6375 6d5f  axis + 1] - cum_
+00022f70: 6469 6d73 5b62 6973 6563 7428 6375 6d5f  dims[bisect(cum_
+00022f80: 6469 6d73 2c20 6b65 795b 6178 6973 202b  dims, key[axis +
+00022f90: 2031 5d29 202d 2031 5d2c 290a 2020 2020   1]) - 1],).    
+00022fa0: 2020 2020 2b20 6b65 795b 6178 6973 202b      + key[axis +
+00022fb0: 2032 203a 5d0a 2020 2020 2020 2020 666f   2 :].        fo
+00022fc0: 7220 6b65 7920 696e 206b 6579 730a 2020  r key in keys.  
+00022fd0: 2020 5d0a 0a20 2020 2064 736b 203d 2064    ]..    dsk = d
+00022fe0: 6963 7428 7a69 7028 6b65 7973 2c20 7661  ict(zip(keys, va
+00022ff0: 6c75 6573 2929 0a20 2020 2067 7261 7068  lues)).    graph
+00023000: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+00023010: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+00023020: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
+00023030: 7065 6e64 656e 6369 6573 3d73 6571 3229  pendencies=seq2)
+00023040: 0a0a 2020 2020 7265 7475 726e 2041 7272  ..    return Arr
+00023050: 6179 2867 7261 7068 2c20 6e61 6d65 2c20  ay(graph, name, 
+00023060: 6368 756e 6b73 2c20 6d65 7461 3d6d 6574  chunks, meta=met
+00023070: 6129 0a0a 0a64 6566 206c 6f61 645f 7374  a)...def load_st
+00023080: 6f72 655f 6368 756e 6b28 0a20 2020 2078  ore_chunk(.    x
+00023090: 3a20 416e 792c 0a20 2020 206f 7574 3a20  : Any,.    out: 
+000230a0: 416e 792c 0a20 2020 2069 6e64 6578 3a20  Any,.    index: 
+000230b0: 736c 6963 652c 0a20 2020 206c 6f63 6b3a  slice,.    lock:
+000230c0: 2041 6e79 2c0a 2020 2020 7265 7475 726e   Any,.    return
+000230d0: 5f73 746f 7265 643a 2062 6f6f 6c2c 0a20  _stored: bool,. 
+000230e0: 2020 206c 6f61 645f 7374 6f72 6564 3a20     load_stored: 
+000230f0: 626f 6f6c 2c0a 293a 0a20 2020 2022 2222  bool,.):.    """
+00023100: 0a20 2020 2041 2066 756e 6374 696f 6e20  .    A function 
+00023110: 696e 7365 7274 6564 2069 6e20 6120 4461  inserted in a Da
+00023120: 736b 2067 7261 7068 2066 6f72 2073 746f  sk graph for sto
+00023130: 7269 6e67 2061 2063 6875 6e6b 2e0a 0a20  ring a chunk... 
+00023140: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00023150: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00023160: 2078 3a20 6172 7261 792d 6c69 6b65 0a20   x: array-like. 
+00023170: 2020 2020 2020 2041 6e20 6172 7261 7920         An array 
+00023180: 2870 6f74 656e 7469 616c 6c79 2061 204e  (potentially a N
+00023190: 756d 5079 206f 6e65 290a 2020 2020 6f75  umPy one).    ou
+000231a0: 743a 2061 7272 6179 2d6c 696b 650a 2020  t: array-like.  
+000231b0: 2020 2020 2020 5768 6572 6520 746f 2073        Where to s
+000231c0: 746f 7265 2072 6573 756c 7473 2e0a 2020  tore results..  
+000231d0: 2020 696e 6465 783a 2073 6c69 6365 2d6c    index: slice-l
+000231e0: 696b 650a 2020 2020 2020 2020 5768 6572  ike.        Wher
+000231f0: 6520 746f 2073 746f 7265 2072 6573 756c  e to store resul
+00023200: 7420 6672 6f6d 2060 6078 6060 2069 6e20  t from ``x`` in 
+00023210: 6060 6f75 7460 602e 0a20 2020 206c 6f63  ``out``..    loc
+00023220: 6b3a 204c 6f63 6b2d 6c69 6b65 206f 7220  k: Lock-like or 
+00023230: 4661 6c73 650a 2020 2020 2020 2020 4c6f  False.        Lo
+00023240: 636b 2074 6f20 7573 6520 6265 666f 7265  ck to use before
+00023250: 2077 7269 7469 6e67 2074 6f20 6060 6f75   writing to ``ou
+00023260: 7460 602e 0a20 2020 2072 6574 7572 6e5f  t``..    return_
+00023270: 7374 6f72 6564 3a20 626f 6f6c 0a20 2020  stored: bool.   
+00023280: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
+00023290: 7265 7475 726e 2060 606f 7574 6060 2e0a  return ``out``..
+000232a0: 2020 2020 6c6f 6164 5f73 746f 7265 643a      load_stored:
+000232b0: 2062 6f6f 6c0a 2020 2020 2020 2020 5768   bool.        Wh
+000232c0: 6574 6865 7220 746f 2072 6574 7572 6e20  ether to return 
+000232d0: 7468 6520 6172 7261 7920 7374 6f72 6564  the array stored
+000232e0: 2069 6e20 6060 6f75 7460 602e 0a20 2020   in ``out``..   
+000232f0: 2020 2020 2049 676e 6f72 6564 2069 6620       Ignored if 
+00023300: 6060 7265 7475 726e 5f73 746f 7265 6460  ``return_stored`
+00023310: 6020 6973 206e 6f74 2060 6054 7275 6560  ` is not ``True`
+00023320: 602e 0a0a 2020 2020 5265 7475 726e 730a  `...    Returns.
+00023330: 2020 2020 2d2d 2d2d 2d2d 2d0a 0a20 2020      -------..   
+00023340: 2049 6620 7265 7475 726e 5f73 746f 7265   If return_store
+00023350: 643d 5472 7565 2061 6e64 206c 6f61 645f  d=True and load_
+00023360: 7374 6f72 6564 3d46 616c 7365 0a20 2020  stored=False.   
+00023370: 2020 2020 206f 7574 0a20 2020 2049 6620       out.    If 
+00023380: 7265 7475 726e 5f73 746f 7265 643d 5472  return_stored=Tr
+00023390: 7565 2061 6e64 206c 6f61 645f 7374 6f72  ue and load_stor
+000233a0: 6564 3d54 7275 650a 2020 2020 2020 2020  ed=True.        
+000233b0: 6f75 745b 696e 6465 785d 0a20 2020 2049  out[index].    I
+000233c0: 6620 7265 7475 726e 5f73 746f 7265 643d  f return_stored=
+000233d0: 4661 6c73 6520 616e 6420 636f 6d70 7574  False and comput
+000233e0: 653d 4661 6c73 650a 2020 2020 2020 2020  e=False.        
+000233f0: 4e6f 6e65 0a0a 2020 2020 4578 616d 706c  None..    Exampl
+00023400: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+00023410: 0a20 2020 203e 3e3e 2061 203d 206e 702e  .    >>> a = np.
+00023420: 6f6e 6573 2828 352c 2036 2929 0a20 2020  ones((5, 6)).   
+00023430: 203e 3e3e 2062 203d 206e 702e 656d 7074   >>> b = np.empt
+00023440: 7928 612e 7368 6170 6529 0a20 2020 203e  y(a.shape).    >
+00023450: 3e3e 206c 6f61 645f 7374 6f72 655f 6368  >> load_store_ch
+00023460: 756e 6b28 612c 2062 2c20 2873 6c69 6365  unk(a, b, (slice
+00023470: 284e 6f6e 6529 2c20 736c 6963 6528 4e6f  (None), slice(No
+00023480: 6e65 2929 2c20 4661 6c73 652c 2046 616c  ne)), False, Fal
+00023490: 7365 2c20 4661 6c73 6529 0a20 2020 2022  se, False).    "
+000234a0: 2222 0a20 2020 2069 6620 6c6f 636b 3a0a  "".    if lock:.
+000234b0: 2020 2020 2020 2020 6c6f 636b 2e61 6371          lock.acq
+000234c0: 7569 7265 2829 0a20 2020 2074 7279 3a0a  uire().    try:.
+000234d0: 2020 2020 2020 2020 6966 2078 2069 7320          if x is 
+000234e0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000234f0: 2020 2020 2020 6966 2069 735f 6172 7261        if is_arra
+00023500: 796c 696b 6528 7829 3a0a 2020 2020 2020  ylike(x):.      
+00023510: 2020 2020 2020 2020 2020 6f75 745b 696e            out[in
+00023520: 6465 785d 203d 2078 0a20 2020 2020 2020  dex] = x.       
+00023530: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00023540: 2020 2020 2020 2020 2020 206f 7574 5b69             out[i
+00023550: 6e64 6578 5d20 3d20 6e70 2e61 7361 6e79  ndex] = np.asany
+00023560: 6172 7261 7928 7829 0a0a 2020 2020 2020  array(x)..      
+00023570: 2020 6966 2072 6574 7572 6e5f 7374 6f72    if return_stor
+00023580: 6564 2061 6e64 206c 6f61 645f 7374 6f72  ed and load_stor
+00023590: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+000235a0: 7265 7475 726e 206f 7574 5b69 6e64 6578  return out[index
+000235b0: 5d0a 2020 2020 2020 2020 656c 6966 2072  ].        elif r
+000235c0: 6574 7572 6e5f 7374 6f72 6564 2061 6e64  eturn_stored and
+000235d0: 206e 6f74 206c 6f61 645f 7374 6f72 6564   not load_stored
+000235e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000235f0: 7475 726e 206f 7574 0a20 2020 2020 2020  turn out.       
+00023600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00023610: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00023620: 2020 2066 696e 616c 6c79 3a0a 2020 2020     finally:.    
+00023630: 2020 2020 6966 206c 6f63 6b3a 0a20 2020      if lock:.   
+00023640: 2020 2020 2020 2020 206c 6f63 6b2e 7265           lock.re
+00023650: 6c65 6173 6528 290a 0a0a 6465 6620 7374  lease()...def st
+00023660: 6f72 655f 6368 756e 6b28 0a20 2020 2078  ore_chunk(.    x
+00023670: 3a20 4172 7261 794c 696b 652c 206f 7574  : ArrayLike, out
+00023680: 3a20 4172 7261 794c 696b 652c 2069 6e64  : ArrayLike, ind
+00023690: 6578 3a20 736c 6963 652c 206c 6f63 6b3a  ex: slice, lock:
+000236a0: 2041 6e79 2c20 7265 7475 726e 5f73 746f   Any, return_sto
+000236b0: 7265 643a 2062 6f6f 6c0a 293a 0a20 2020  red: bool.):.   
+000236c0: 2072 6574 7572 6e20 6c6f 6164 5f73 746f   return load_sto
+000236d0: 7265 5f63 6875 6e6b 2878 2c20 6f75 742c  re_chunk(x, out,
+000236e0: 2069 6e64 6578 2c20 6c6f 636b 2c20 7265   index, lock, re
+000236f0: 7475 726e 5f73 746f 7265 642c 2046 616c  turn_stored, Fal
+00023700: 7365 290a 0a0a 4120 3d20 5479 7065 5661  se)...A = TypeVa
+00023710: 7228 2241 222c 2062 6f75 6e64 3d41 7272  r("A", bound=Arr
+00023720: 6179 4c69 6b65 290a 0a0a 6465 6620 6c6f  ayLike)...def lo
+00023730: 6164 5f63 6875 6e6b 286f 7574 3a20 412c  ad_chunk(out: A,
+00023740: 2069 6e64 6578 3a20 736c 6963 652c 206c   index: slice, l
+00023750: 6f63 6b3a 2041 6e79 2920 2d3e 2041 3a0a  ock: Any) -> A:.
+00023760: 2020 2020 7265 7475 726e 206c 6f61 645f      return load_
+00023770: 7374 6f72 655f 6368 756e 6b28 4e6f 6e65  store_chunk(None
+00023780: 2c20 6f75 742c 2069 6e64 6578 2c20 6c6f  , out, index, lo
+00023790: 636b 2c20 5472 7565 2c20 5472 7565 290a  ck, True, True).
+000237a0: 0a0a 6465 6620 696e 7365 7274 5f74 6f5f  ..def insert_to_
+000237b0: 6f6f 6328 0a20 2020 206b 6579 733a 206c  ooc(.    keys: l
+000237c0: 6973 742c 0a20 2020 2063 6875 6e6b 733a  ist,.    chunks:
+000237d0: 2074 7570 6c65 5b74 7570 6c65 5b69 6e74   tuple[tuple[int
+000237e0: 2c20 2e2e 2e5d 2c20 2e2e 2e5d 2c0a 2020  , ...], ...],.  
+000237f0: 2020 6f75 743a 2041 7272 6179 4c69 6b65    out: ArrayLike
+00023800: 2c0a 2020 2020 6e61 6d65 3a20 7374 722c  ,.    name: str,
+00023810: 0a20 2020 202a 2c0a 2020 2020 6c6f 636b  .    *,.    lock
+00023820: 3a20 4c6f 636b 207c 2062 6f6f 6c20 3d20  : Lock | bool = 
+00023830: 5472 7565 2c0a 2020 2020 7265 6769 6f6e  True,.    region
+00023840: 3a20 7475 706c 655b 736c 6963 652c 202e  : tuple[slice, .
+00023850: 2e2e 5d20 7c20 736c 6963 6520 7c20 4e6f  ..] | slice | No
+00023860: 6e65 203d 204e 6f6e 652c 0a20 2020 2072  ne = None,.    r
+00023870: 6574 7572 6e5f 7374 6f72 6564 3a20 626f  eturn_stored: bo
+00023880: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+00023890: 6c6f 6164 5f73 746f 7265 643a 2062 6f6f  load_stored: boo
+000238a0: 6c20 3d20 4661 6c73 652c 0a29 202d 3e20  l = False,.) -> 
+000238b0: 6469 6374 3a0a 2020 2020 2222 220a 2020  dict:.    """.  
+000238c0: 2020 4372 6561 7465 7320 6120 4461 736b    Creates a Dask
+000238d0: 2067 7261 7068 2066 6f72 2073 746f 7269   graph for stori
+000238e0: 6e67 2063 6875 6e6b 7320 6672 6f6d 2060  ng chunks from `
+000238f0: 6061 7272 6060 2069 6e20 6060 6f75 7460  `arr`` in ``out`
+00023900: 602e 0a0a 2020 2020 5061 7261 6d65 7465  `...    Paramete
+00023910: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00023920: 2d0a 2020 2020 6b65 7973 3a20 6c69 7374  -.    keys: list
+00023930: 0a20 2020 2020 2020 2044 6173 6b20 6b65  .        Dask ke
+00023940: 7973 206f 6620 7468 6520 696e 7075 7420  ys of the input 
+00023950: 6172 7261 790a 2020 2020 6368 756e 6b73  array.    chunks
+00023960: 3a20 7475 706c 650a 2020 2020 2020 2020  : tuple.        
+00023970: 4461 736b 2063 6875 6e6b 7320 6f66 2074  Dask chunks of t
+00023980: 6865 2069 6e70 7574 2061 7272 6179 0a20  he input array. 
+00023990: 2020 206f 7574 3a20 6172 7261 792d 6c69     out: array-li
+000239a0: 6b65 0a20 2020 2020 2020 2057 6865 7265  ke.        Where
+000239b0: 2074 6f20 7374 6f72 6520 7265 7375 6c74   to store result
+000239c0: 7320 746f 0a20 2020 206e 616d 653a 2073  s to.    name: s
+000239d0: 7472 0a20 2020 2020 2020 2046 6972 7374  tr.        First
+000239e0: 2065 6c65 6d65 6e74 206f 6620 6461 736b   element of dask
+000239f0: 206b 6579 730a 2020 2020 6c6f 636b 3a20   keys.    lock: 
+00023a00: 4c6f 636b 2d6c 696b 6520 6f72 2062 6f6f  Lock-like or boo
+00023a10: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+00023a20: 2020 2020 5768 6574 6865 7220 746f 206c      Whether to l
+00023a30: 6f63 6b20 6f72 2077 6974 6820 7768 6174  ock or with what
+00023a40: 2028 6465 6661 756c 7420 6973 2060 6054   (default is ``T
+00023a50: 7275 6560 602c 0a20 2020 2020 2020 2077  rue``,.        w
+00023a60: 6869 6368 206d 6561 6e73 2061 203a 636c  hich means a :cl
+00023a70: 6173 733a 6074 6872 6561 6469 6e67 2e4c  ass:`threading.L
+00023a80: 6f63 6b60 2069 6e73 7461 6e63 6529 2e0a  ock` instance)..
+00023a90: 2020 2020 7265 6769 6f6e 3a20 736c 6963      region: slic
+00023aa0: 652d 6c69 6b65 2c20 6f70 7469 6f6e 616c  e-like, optional
+00023ab0: 0a20 2020 2020 2020 2057 6865 7265 2069  .        Where i
+00023ac0: 6e20 6060 6f75 7460 6020 746f 2073 746f  n ``out`` to sto
+00023ad0: 7265 2060 6061 7272 6060 2773 2072 6573  re ``arr``'s res
+00023ae0: 756c 7473 0a20 2020 2020 2020 2028 6465  ults.        (de
+00023af0: 6661 756c 7420 6973 2060 604e 6f6e 6560  fault is ``None`
+00023b00: 602c 206d 6561 6e69 6e67 2061 6c6c 206f  `, meaning all o
+00023b10: 6620 6060 6f75 7460 6029 2e0a 2020 2020  f ``out``)..    
+00023b20: 7265 7475 726e 5f73 746f 7265 643a 2062  return_stored: b
+00023b30: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+00023b40: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+00023b50: 2072 6574 7572 6e20 6060 6f75 7460 600a   return ``out``.
+00023b60: 2020 2020 2020 2020 2864 6566 6175 6c74          (default
+00023b70: 2069 7320 6060 4661 6c73 6560 602c 206d   is ``False``, m
+00023b80: 6561 6e69 6e67 2060 604e 6f6e 6560 6020  eaning ``None`` 
+00023b90: 6973 2072 6574 7572 6e65 6429 2e0a 2020  is returned)..  
+00023ba0: 2020 6c6f 6164 5f73 746f 7265 643a 2062    load_stored: b
+00023bb0: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+00023bc0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+00023bd0: 2068 616e 646c 696e 6720 6c6f 6164 696e   handling loadin
+00023be0: 6720 6672 6f6d 2060 606f 7574 6060 2061  g from ``out`` a
+00023bf0: 7420 7468 6520 7361 6d65 2074 696d 652e  t the same time.
+00023c00: 0a20 2020 2020 2020 2049 676e 6f72 6564  .        Ignored
+00023c10: 2069 6620 6060 7265 7475 726e 5f73 746f   if ``return_sto
+00023c20: 7265 6460 6020 6973 206e 6f74 2060 6054  red`` is not ``T
+00023c30: 7275 6560 602e 0a20 2020 2020 2020 2028  rue``..        (
+00023c40: 6465 6661 756c 7420 6973 2060 6046 616c  default is ``Fal
+00023c50: 7365 6060 2c20 6d65 616e 696e 6720 6465  se``, meaning de
+00023c60: 6665 7220 746f 2060 6072 6574 7572 6e5f  fer to ``return_
+00023c70: 7374 6f72 6564 6060 292e 0a0a 2020 2020  stored``)...    
+00023c80: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00023c90: 2d2d 2d0a 2020 2020 6461 736b 2067 7261  ---.    dask gra
+00023ca0: 7068 206f 6620 7374 6f72 6520 6f70 6572  ph of store oper
+00023cb0: 6174 696f 6e0a 0a20 2020 2045 7861 6d70  ation..    Examp
+00023cc0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+00023cd0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
+00023ce0: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
+00023cf0: 0a20 2020 203e 3e3e 2064 203d 2064 612e  .    >>> d = da.
+00023d00: 6f6e 6573 2828 352c 2036 292c 2063 6875  ones((5, 6), chu
+00023d10: 6e6b 733d 2832 2c20 3329 290a 2020 2020  nks=(2, 3)).    
+00023d20: 3e3e 3e20 6120 3d20 6e70 2e65 6d70 7479  >>> a = np.empty
+00023d30: 2864 2e73 6861 7065 290a 2020 2020 3e3e  (d.shape).    >>
+00023d40: 3e20 696e 7365 7274 5f74 6f5f 6f6f 6328  > insert_to_ooc(
+00023d50: 642e 5f5f 6461 736b 5f6b 6579 735f 5f28  d.__dask_keys__(
+00023d60: 292c 2064 2e63 6875 6e6b 732c 2061 2c20  ), d.chunks, a, 
+00023d70: 2273 746f 7265 2d31 3233 2229 2020 2320  "store-123")  # 
+00023d80: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
+00023d90: 2020 2022 2222 0a0a 2020 2020 6966 206c     """..    if l
+00023da0: 6f63 6b20 6973 2054 7275 653a 0a20 2020  ock is True:.   
+00023db0: 2020 2020 206c 6f63 6b20 3d20 4c6f 636b       lock = Lock
+00023dc0: 2829 0a0a 2020 2020 736c 6963 6573 203d  ()..    slices =
+00023dd0: 2073 6c69 6365 735f 6672 6f6d 5f63 6875   slices_from_chu
+00023de0: 6e6b 7328 6368 756e 6b73 290a 2020 2020  nks(chunks).    
+00023df0: 6966 2072 6567 696f 6e3a 0a20 2020 2020  if region:.     
+00023e00: 2020 2073 6c69 6365 7320 3d20 5b66 7573     slices = [fus
+00023e10: 655f 736c 6963 6528 7265 6769 6f6e 2c20  e_slice(region, 
+00023e20: 736c 6329 2066 6f72 2073 6c63 2069 6e20  slc) for slc in 
+00023e30: 736c 6963 6573 5d0a 0a20 2020 2069 6620  slices]..    if 
+00023e40: 7265 7475 726e 5f73 746f 7265 6420 616e  return_stored an
+00023e50: 6420 6c6f 6164 5f73 746f 7265 643a 0a20  d load_stored:. 
+00023e60: 2020 2020 2020 2066 756e 6320 3d20 6c6f         func = lo
+00023e70: 6164 5f73 746f 7265 5f63 6875 6e6b 0a20  ad_store_chunk. 
+00023e80: 2020 2020 2020 2061 7267 7320 3d20 286c         args = (l
+00023e90: 6f61 645f 7374 6f72 6564 2c29 0a20 2020  oad_stored,).   
+00023ea0: 2065 6c73 653a 0a20 2020 2020 2020 2066   else:.        f
+00023eb0: 756e 6320 3d20 7374 6f72 655f 6368 756e  unc = store_chun
+00023ec0: 6b20 2023 2074 7970 653a 2069 676e 6f72  k  # type: ignor
+00023ed0: 650a 2020 2020 2020 2020 6172 6773 203d  e.        args =
+00023ee0: 2028 2920 2023 2074 7970 653a 2069 676e   ()  # type: ign
+00023ef0: 6f72 650a 0a20 2020 2064 736b 203d 207b  ore..    dsk = {
+00023f00: 0a20 2020 2020 2020 2028 6e61 6d65 2c29  .        (name,)
+00023f10: 202b 2074 5b31 3a5d 3a20 2866 756e 632c   + t[1:]: (func,
+00023f20: 2074 2c20 6f75 742c 2073 6c63 2c20 6c6f   t, out, slc, lo
+00023f30: 636b 2c20 7265 7475 726e 5f73 746f 7265  ck, return_store
+00023f40: 6429 202b 2061 7267 730a 2020 2020 2020  d) + args.      
+00023f50: 2020 666f 7220 742c 2073 6c63 2069 6e20    for t, slc in 
+00023f60: 7a69 7028 636f 7265 2e66 6c61 7474 656e  zip(core.flatten
+00023f70: 286b 6579 7329 2c20 736c 6963 6573 290a  (keys), slices).
+00023f80: 2020 2020 7d0a 2020 2020 7265 7475 726e      }.    return
+00023f90: 2064 736b 0a0a 0a64 6566 2072 6574 7269   dsk...def retri
+00023fa0: 6576 655f 6672 6f6d 5f6f 6f63 280a 2020  eve_from_ooc(.  
+00023fb0: 2020 6b65 7973 3a20 436f 6c6c 6563 7469    keys: Collecti
+00023fc0: 6f6e 5b48 6173 6861 626c 655d 2c20 6473  on[Hashable], ds
+00023fd0: 6b5f 7072 653a 204d 6170 7069 6e67 2c20  k_pre: Mapping, 
+00023fe0: 6473 6b5f 706f 7374 3a20 4d61 7070 696e  dsk_post: Mappin
+00023ff0: 670a 2920 2d3e 2064 6963 745b 7475 706c  g.) -> dict[tupl
+00024000: 652c 2041 6e79 5d3a 0a20 2020 2022 2222  e, Any]:.    """
+00024010: 0a20 2020 2043 7265 6174 6573 2061 2044  .    Creates a D
+00024020: 6173 6b20 6772 6170 6820 666f 7220 6c6f  ask graph for lo
+00024030: 6164 696e 6720 7374 6f72 6564 2060 606b  ading stored ``k
+00024040: 6579 7360 6020 6672 6f6d 2060 6064 736b  eys`` from ``dsk
+00024050: 6060 2e0a 0a20 2020 2050 6172 616d 6574  ``...    Paramet
+00024060: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00024070: 2d2d 0a20 2020 206b 6579 733a 2043 6f6c  --.    keys: Col
+00024080: 6c65 6374 696f 6e0a 2020 2020 2020 2020  lection.        
+00024090: 4120 7365 7175 656e 6365 2063 6f6e 7461  A sequence conta
+000240a0: 696e 696e 6720 4461 736b 2067 7261 7068  ining Dask graph
+000240b0: 206b 6579 7320 746f 206c 6f61 640a 2020   keys to load.  
+000240c0: 2020 6473 6b5f 7072 653a 204d 6170 7069    dsk_pre: Mappi
+000240d0: 6e67 0a20 2020 2020 2020 2041 2044 6173  ng.        A Das
+000240e0: 6b20 6772 6170 6820 636f 7272 6573 706f  k graph correspo
+000240f0: 6e64 696e 6720 746f 2061 2044 6173 6b20  nding to a Dask 
+00024100: 4172 7261 7920 6265 666f 7265 2063 6f6d  Array before com
+00024110: 7075 7461 7469 6f6e 0a20 2020 2064 736b  putation.    dsk
+00024120: 5f70 6f73 743a 204d 6170 7069 6e67 0a20  _post: Mapping. 
+00024130: 2020 2020 2020 2041 2044 6173 6b20 6772         A Dask gr
+00024140: 6170 6820 636f 7272 6573 706f 6e64 696e  aph correspondin
+00024150: 6720 746f 2061 2044 6173 6b20 4172 7261  g to a Dask Arra
+00024160: 7920 6166 7465 7220 636f 6d70 7574 6174  y after computat
+00024170: 696f 6e0a 0a20 2020 2045 7861 6d70 6c65  ion..    Example
+00024180: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
+00024190: 2020 203e 3e3e 2069 6d70 6f72 7420 6461     >>> import da
+000241a0: 736b 2e61 7272 6179 2061 7320 6461 0a20  sk.array as da. 
+000241b0: 2020 203e 3e3e 2064 203d 2064 612e 6f6e     >>> d = da.on
+000241c0: 6573 2828 352c 2036 292c 2063 6875 6e6b  es((5, 6), chunk
+000241d0: 733d 2832 2c20 3329 290a 2020 2020 3e3e  s=(2, 3)).    >>
+000241e0: 3e20 6120 3d20 6e70 2e65 6d70 7479 2864  > a = np.empty(d
+000241f0: 2e73 6861 7065 290a 2020 2020 3e3e 3e20  .shape).    >>> 
+00024200: 6720 3d20 696e 7365 7274 5f74 6f5f 6f6f  g = insert_to_oo
+00024210: 6328 642e 5f5f 6461 736b 5f6b 6579 735f  c(d.__dask_keys_
+00024220: 5f28 292c 2064 2e63 6875 6e6b 732c 2061  _(), d.chunks, a
+00024230: 2c20 2273 746f 7265 2d31 3233 2229 0a20  , "store-123"). 
+00024240: 2020 203e 3e3e 2072 6574 7269 6576 655f     >>> retrieve_
+00024250: 6672 6f6d 5f6f 6f63 2867 2e6b 6579 7328  from_ooc(g.keys(
+00024260: 292c 2067 2c20 7b6b 3a20 6b20 666f 7220  ), g, {k: k for 
+00024270: 6b20 696e 2067 2e6b 6579 7328 297d 2920  k in g.keys()}) 
+00024280: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+00024290: 500a 2020 2020 2222 220a 2020 2020 6c6f  P.    """.    lo
+000242a0: 6164 5f64 736b 203d 207b 0a20 2020 2020  ad_dsk = {.     
+000242b0: 2020 2028 226c 6f61 642d 2220 2b20 6b5b     ("load-" + k[
+000242c0: 305d 2c29 202b 206b 5b31 3a5d 3a20 286c  0],) + k[1:]: (l
+000242d0: 6f61 645f 6368 756e 6b2c 2064 736b 5f70  oad_chunk, dsk_p
+000242e0: 6f73 745b 6b5d 2920 2b20 6473 6b5f 7072  ost[k]) + dsk_pr
+000242f0: 655b 6b5d 5b33 3a2d 315d 2020 2320 7479  e[k][3:-1]  # ty
+00024300: 7065 3a20 6967 6e6f 7265 0a20 2020 2020  pe: ignore.     
+00024310: 2020 2066 6f72 206b 2069 6e20 6b65 7973     for k in keys
+00024320: 0a20 2020 207d 0a0a 2020 2020 7265 7475  .    }..    retu
+00024330: 726e 206c 6f61 645f 6473 6b0a 0a0a 6465  rn load_dsk...de
+00024340: 6620 6173 6172 7261 7928 0a20 2020 2061  f asarray(.    a
+00024350: 2c20 616c 6c6f 775f 756e 6b6e 6f77 6e5f  , allow_unknown_
+00024360: 6368 756e 6b73 697a 6573 3d46 616c 7365  chunksizes=False
+00024370: 2c20 6474 7970 653d 4e6f 6e65 2c20 6f72  , dtype=None, or
+00024380: 6465 723d 4e6f 6e65 2c20 2a2c 206c 696b  der=None, *, lik
+00024390: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
+000243a0: 0a29 3a0a 2020 2020 2222 2243 6f6e 7665  .):.    """Conve
+000243b0: 7274 2074 6865 2069 6e70 7574 2074 6f20  rt the input to 
+000243c0: 6120 6461 736b 2061 7272 6179 2e0a 0a20  a dask array... 
+000243d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000243e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000243f0: 2061 203a 2061 7272 6179 2d6c 696b 650a   a : array-like.
+00024400: 2020 2020 2020 2020 496e 7075 7420 6461          Input da
+00024410: 7461 2c20 696e 2061 6e79 2066 6f72 6d20  ta, in any form 
+00024420: 7468 6174 2063 616e 2062 6520 636f 6e76  that can be conv
+00024430: 6572 7465 6420 746f 2061 2064 6173 6b20  erted to a dask 
+00024440: 6172 7261 792e 2054 6869 730a 2020 2020  array. This.    
+00024450: 2020 2020 696e 636c 7564 6573 206c 6973      includes lis
+00024460: 7473 2c20 6c69 7374 7320 6f66 2074 7570  ts, lists of tup
+00024470: 6c65 732c 2074 7570 6c65 732c 2074 7570  les, tuples, tup
+00024480: 6c65 7320 6f66 2074 7570 6c65 732c 2074  les of tuples, t
+00024490: 7570 6c65 7320 6f66 0a20 2020 2020 2020  uples of.       
+000244a0: 206c 6973 7473 2061 6e64 206e 6461 7272   lists and ndarr
+000244b0: 6179 732e 0a20 2020 2061 6c6c 6f77 5f75  ays..    allow_u
+000244c0: 6e6b 6e6f 776e 5f63 6875 6e6b 7369 7a65  nknown_chunksize
+000244d0: 733a 2062 6f6f 6c0a 2020 2020 2020 2020  s: bool.        
+000244e0: 416c 6c6f 7720 756e 6b6e 6f77 6e20 6368  Allow unknown ch
+000244f0: 756e 6b73 697a 6573 2c20 7375 6368 2061  unksizes, such a
+00024500: 7320 636f 6d65 2066 726f 6d20 636f 6e76  s come from conv
+00024510: 6572 7469 6e67 2066 726f 6d20 6461 736b  erting from dask
+00024520: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
+00024530: 6d65 732e 2020 4461 736b 2e61 7272 6179  mes.  Dask.array
+00024540: 2069 7320 756e 6162 6c65 2074 6f20 7665   is unable to ve
+00024550: 7269 6679 2074 6861 7420 6368 756e 6b73  rify that chunks
+00024560: 206c 696e 6520 7570 2e20 2049 660a 2020   line up.  If.  
+00024570: 2020 2020 2020 6461 7461 2063 6f6d 6573        data comes
+00024580: 2066 726f 6d20 6469 6666 6572 656e 746c   from differentl
+00024590: 7920 616c 6967 6e65 6420 736f 7572 6365  y aligned source
+000245a0: 7320 7468 656e 2074 6869 7320 6361 6e20  s then this can 
+000245b0: 6361 7573 650a 2020 2020 2020 2020 756e  cause.        un
+000245c0: 6578 7065 6374 6564 2072 6573 756c 7473  expected results
+000245d0: 2e0a 2020 2020 6474 7970 6520 3a20 6461  ..    dtype : da
+000245e0: 7461 2d74 7970 652c 206f 7074 696f 6e61  ta-type, optiona
+000245f0: 6c0a 2020 2020 2020 2020 4279 2064 6566  l.        By def
+00024600: 6175 6c74 2c20 7468 6520 6461 7461 2d74  ault, the data-t
+00024610: 7970 6520 6973 2069 6e66 6572 7265 6420  ype is inferred 
+00024620: 6672 6f6d 2074 6865 2069 6e70 7574 2064  from the input d
+00024630: 6174 612e 0a20 2020 206f 7264 6572 203a  ata..    order :
+00024640: 207b e280 9843 e280 992c 20e2 8098 46e2   {...C..., ...F.
+00024650: 8099 2c20 e280 9841 e280 992c 20e2 8098  .., ...A..., ...
+00024660: 4be2 8099 7d2c 206f 7074 696f 6e61 6c0a  K...}, optional.
+00024670: 2020 2020 2020 2020 4d65 6d6f 7279 206c          Memory l
+00024680: 6179 6f75 742e 20e2 8098 41e2 8099 2061  ayout. ...A... a
+00024690: 6e64 20e2 8098 4be2 8099 2064 6570 656e  nd ...K... depen
+000246a0: 6420 6f6e 2074 6865 206f 7264 6572 206f  d on the order o
+000246b0: 6620 696e 7075 7420 6172 7261 7920 612e  f input array a.
+000246c0: 0a20 2020 2020 2020 20e2 8098 43e2 8099  .        ...C...
+000246d0: 2072 6f77 2d6d 616a 6f72 2028 432d 7374   row-major (C-st
+000246e0: 796c 6529 2c20 e280 9846 e280 9920 636f  yle), ...F... co
+000246f0: 6c75 6d6e 2d6d 616a 6f72 2028 466f 7274  lumn-major (Fort
+00024700: 7261 6e2d 7374 796c 6529 206d 656d 6f72  ran-style) memor
+00024710: 790a 2020 2020 2020 2020 7265 7072 6573  y.        repres
+00024720: 656e 7461 7469 6f6e 2e20 e280 9841 e280  entation. ...A..
+00024730: 9920 2861 6e79 2920 6d65 616e 7320 e280  . (any) means ..
+00024740: 9846 e280 9920 6966 2061 2069 7320 466f  .F... if a is Fo
+00024750: 7274 7261 6e20 636f 6e74 6967 756f 7573  rtran contiguous
+00024760: 2c20 e280 9843 e280 990a 2020 2020 2020  , ...C....      
+00024770: 2020 6f74 6865 7277 6973 6520 e280 984b    otherwise ...K
+00024780: e280 9920 286b 6565 7029 2070 7265 7365  ... (keep) prese
+00024790: 7276 6520 696e 7075 7420 6f72 6465 722e  rve input order.
+000247a0: 2044 6566 6175 6c74 7320 746f 20e2 8098   Defaults to ...
+000247b0: 43e2 8099 2e0a 2020 2020 6c69 6b65 3a20  C.....    like: 
+000247c0: 6172 7261 792d 6c69 6b65 0a20 2020 2020  array-like.     
+000247d0: 2020 2052 6566 6572 656e 6365 206f 626a     Reference obj
+000247e0: 6563 7420 746f 2061 6c6c 6f77 2074 6865  ect to allow the
+000247f0: 2063 7265 6174 696f 6e20 6f66 2044 6173   creation of Das
+00024800: 6b20 6172 7261 7973 2077 6974 6820 6368  k arrays with ch
+00024810: 756e 6b73 0a20 2020 2020 2020 2074 6861  unks.        tha
+00024820: 7420 6172 6520 6e6f 7420 4e75 6d50 7920  t are not NumPy 
+00024830: 6172 7261 7973 2e20 4966 2061 6e20 6172  arrays. If an ar
+00024840: 7261 792d 6c69 6b65 2070 6173 7365 6420  ray-like passed 
+00024850: 696e 2061 7320 6060 6c69 6b65 6060 0a20  in as ``like``. 
+00024860: 2020 2020 2020 2073 7570 706f 7274 7320         supports 
+00024870: 7468 6520 6060 5f5f 6172 7261 795f 6675  the ``__array_fu
+00024880: 6e63 7469 6f6e 5f5f 6060 2070 726f 746f  nction__`` proto
+00024890: 636f 6c2c 2074 6865 2063 6875 6e6b 2074  col, the chunk t
+000248a0: 7970 6520 6f66 2074 6865 0a20 2020 2020  ype of the.     
+000248b0: 2020 2072 6573 756c 7469 6e67 2061 7272     resulting arr
+000248c0: 6179 2077 696c 6c20 6265 2064 6566 696e  ay will be defin
+000248d0: 6465 2062 7920 6974 2e20 496e 2074 6869  de by it. In thi
+000248e0: 7320 6361 7365 2c20 6974 2065 6e73 7572  s case, it ensur
+000248f0: 6573 2074 6865 0a20 2020 2020 2020 2063  es the.        c
+00024900: 7265 6174 696f 6e20 6f66 2061 2044 6173  reation of a Das
+00024910: 6b20 6172 7261 7920 636f 6d70 6174 6962  k array compatib
+00024920: 6c65 2077 6974 6820 7468 6174 2070 6173  le with that pas
+00024930: 7365 6420 696e 2076 6961 2074 6869 730a  sed in via this.
+00024940: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
+00024950: 2e20 4966 2060 606c 696b 6560 6020 6973  . If ``like`` is
+00024960: 2061 2044 6173 6b20 6172 7261 792c 2074   a Dask array, t
+00024970: 6865 2063 6875 6e6b 2074 7970 6520 6f66  he chunk type of
+00024980: 2074 6865 0a20 2020 2020 2020 2072 6573   the.        res
+00024990: 756c 7469 6e67 2061 7272 6179 2077 696c  ulting array wil
+000249a0: 6c20 6265 2064 6566 696e 6564 2062 7920  l be defined by 
+000249b0: 7468 6520 6368 756e 6b20 7479 7065 206f  the chunk type o
+000249c0: 6620 6060 6c69 6b65 6060 2e0a 2020 2020  f ``like``..    
+000249d0: 2020 2020 5265 7175 6972 6573 204e 756d      Requires Num
+000249e0: 5079 2031 2e32 302e 3020 6f72 2068 6967  Py 1.20.0 or hig
+000249f0: 6865 722e 0a0a 2020 2020 5265 7475 726e  her...    Return
+00024a00: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+00024a10: 2020 6f75 7420 3a20 6461 736b 2061 7272    out : dask arr
+00024a20: 6179 0a20 2020 2020 2020 2044 6173 6b20  ay.        Dask 
+00024a30: 6172 7261 7920 696e 7465 7270 7265 7461  array interpreta
+00024a40: 7469 6f6e 206f 6620 612e 0a0a 2020 2020  tion of a...    
+00024a50: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+00024a60: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 696d  -----.    >>> im
+00024a70: 706f 7274 2064 6173 6b2e 6172 7261 7920  port dask.array 
+00024a80: 6173 2064 610a 2020 2020 3e3e 3e20 696d  as da.    >>> im
+00024a90: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
+00024aa0: 0a20 2020 203e 3e3e 2078 203d 206e 702e  .    >>> x = np.
+00024ab0: 6172 616e 6765 2833 290a 2020 2020 3e3e  arange(3).    >>
+00024ac0: 3e20 6461 2e61 7361 7272 6179 2878 290a  > da.asarray(x).
+00024ad0: 2020 2020 6461 736b 2e61 7272 6179 3c61      dask.array<a
+00024ae0: 7272 6179 2c20 7368 6170 653d 2833 2c29  rray, shape=(3,)
+00024af0: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
+00024b00: 6875 6e6b 7369 7a65 3d28 332c 292c 2063  hunksize=(3,), c
+00024b10: 6875 6e6b 7479 7065 3d6e 756d 7079 2e6e  hunktype=numpy.n
+00024b20: 6461 7272 6179 3e0a 0a20 2020 203e 3e3e  darray>..    >>>
+00024b30: 2079 203d 205b 5b31 2c20 322c 2033 5d2c   y = [[1, 2, 3],
+00024b40: 205b 342c 2035 2c20 365d 5d0a 2020 2020   [4, 5, 6]].    
+00024b50: 3e3e 3e20 6461 2e61 7361 7272 6179 2879  >>> da.asarray(y
+00024b60: 290a 2020 2020 6461 736b 2e61 7272 6179  ).    dask.array
+00024b70: 3c61 7272 6179 2c20 7368 6170 653d 2832  <array, shape=(2
+00024b80: 2c20 3329 2c20 6474 7970 653d 696e 7436  , 3), dtype=int6
+00024b90: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
+00024ba0: 2033 292c 2063 6875 6e6b 7479 7065 3d6e   3), chunktype=n
+00024bb0: 756d 7079 2e6e 6461 7272 6179 3e0a 2020  umpy.ndarray>.  
+00024bc0: 2020 2222 220a 2020 2020 6966 206c 696b    """.    if lik
+00024bd0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00024be0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00024bf0: 2861 2c20 4172 7261 7929 3a0a 2020 2020  (a, Array):.    
+00024c00: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00024c10: 0a20 2020 2020 2020 2065 6c69 6620 6861  .        elif ha
+00024c20: 7361 7474 7228 612c 2022 746f 5f64 6173  sattr(a, "to_das
+00024c30: 6b5f 6172 7261 7922 293a 0a20 2020 2020  k_array"):.     
+00024c40: 2020 2020 2020 2072 6574 7572 6e20 612e         return a.
+00024c50: 746f 5f64 6173 6b5f 6172 7261 7928 290a  to_dask_array().
+00024c60: 2020 2020 2020 2020 656c 6966 2074 7970          elif typ
+00024c70: 6528 6129 2e5f 5f6d 6f64 756c 655f 5f2e  e(a).__module__.
+00024c80: 7370 6c69 7428 222e 2229 5b30 5d20 3d3d  split(".")[0] ==
+00024c90: 2022 7861 7272 6179 2220 616e 6420 6861   "xarray" and ha
+00024ca0: 7361 7474 7228 612c 2022 6461 7461 2229  sattr(a, "data")
+00024cb0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00024cc0: 7475 726e 2061 7361 7272 6179 2861 2e64  turn asarray(a.d
+00024cd0: 6174 6129 0a20 2020 2020 2020 2065 6c69  ata).        eli
+00024ce0: 6620 6973 696e 7374 616e 6365 2861 2c20  f isinstance(a, 
+00024cf0: 286c 6973 742c 2074 7570 6c65 2929 2061  (list, tuple)) a
+00024d00: 6e64 2061 6e79 2869 7369 6e73 7461 6e63  nd any(isinstanc
+00024d10: 6528 692c 2041 7272 6179 2920 666f 7220  e(i, Array) for 
+00024d20: 6920 696e 2061 293a 0a20 2020 2020 2020  i in a):.       
+00024d30: 2020 2020 2072 6574 7572 6e20 7374 6163       return stac
+00024d40: 6b28 612c 2061 6c6c 6f77 5f75 6e6b 6e6f  k(a, allow_unkno
+00024d50: 776e 5f63 6875 6e6b 7369 7a65 733d 616c  wn_chunksizes=al
+00024d60: 6c6f 775f 756e 6b6e 6f77 6e5f 6368 756e  low_unknown_chun
+00024d70: 6b73 697a 6573 290a 2020 2020 2020 2020  ksizes).        
+00024d80: 656c 6966 206e 6f74 2069 7369 6e73 7461  elif not isinsta
+00024d90: 6e63 6528 6765 7461 7474 7228 612c 2022  nce(getattr(a, "
+00024da0: 7368 6170 6522 2c20 4e6f 6e65 292c 2049  shape", None), I
+00024db0: 7465 7261 626c 6529 3a0a 2020 2020 2020  terable):.      
+00024dc0: 2020 2020 2020 6120 3d20 6e70 2e61 7361        a = np.asa
+00024dd0: 7272 6179 2861 2c20 6474 7970 653d 6474  rray(a, dtype=dt
+00024de0: 7970 652c 206f 7264 6572 3d6f 7264 6572  ype, order=order
+00024df0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00024e00: 2020 2020 6c69 6b65 5f6d 6574 6120 3d20      like_meta = 
+00024e10: 6d65 7461 5f66 726f 6d5f 6172 7261 7928  meta_from_array(
+00024e20: 6c69 6b65 290a 2020 2020 2020 2020 6966  like).        if
+00024e30: 2069 7369 6e73 7461 6e63 6528 612c 2041   isinstance(a, A
+00024e40: 7272 6179 293a 0a20 2020 2020 2020 2020  rray):.         
+00024e50: 2020 2072 6574 7572 6e20 612e 6d61 705f     return a.map_
+00024e60: 626c 6f63 6b73 286e 702e 6173 6172 7261  blocks(np.asarra
+00024e70: 792c 206c 696b 653d 6c69 6b65 5f6d 6574  y, like=like_met
+00024e80: 612c 2064 7479 7065 3d64 7479 7065 2c20  a, dtype=dtype, 
+00024e90: 6f72 6465 723d 6f72 6465 7229 0a20 2020  order=order).   
+00024ea0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00024eb0: 2020 2020 2020 2061 203d 206e 702e 6173         a = np.as
+00024ec0: 6172 7261 7928 612c 206c 696b 653d 6c69  array(a, like=li
+00024ed0: 6b65 5f6d 6574 612c 2064 7479 7065 3d64  ke_meta, dtype=d
+00024ee0: 7479 7065 2c20 6f72 6465 723d 6f72 6465  type, order=orde
+00024ef0: 7229 0a20 2020 2072 6574 7572 6e20 6672  r).    return fr
+00024f00: 6f6d 5f61 7272 6179 2861 2c20 6765 7469  om_array(a, geti
+00024f10: 7465 6d3d 6765 7474 6572 5f69 6e6c 696e  tem=getter_inlin
+00024f20: 652c 202a 2a6b 7761 7267 7329 0a0a 0a64  e, **kwargs)...d
+00024f30: 6566 2061 7361 6e79 6172 7261 7928 612c  ef asanyarray(a,
+00024f40: 2064 7479 7065 3d4e 6f6e 652c 206f 7264   dtype=None, ord
+00024f50: 6572 3d4e 6f6e 652c 202a 2c20 6c69 6b65  er=None, *, like
+00024f60: 3d4e 6f6e 652c 2069 6e6c 696e 655f 6172  =None, inline_ar
+00024f70: 7261 793d 4661 6c73 6529 3a0a 2020 2020  ray=False):.    
+00024f80: 2222 2243 6f6e 7665 7274 2074 6865 2069  """Convert the i
+00024f90: 6e70 7574 2074 6f20 6120 6461 736b 2061  nput to a dask a
+00024fa0: 7272 6179 2e0a 0a20 2020 2053 7562 636c  rray...    Subcl
+00024fb0: 6173 7365 7320 6f66 2060 606e 702e 6e64  asses of ``np.nd
+00024fc0: 6172 7261 7960 6020 7769 6c6c 2062 6520  array`` will be 
+00024fd0: 7061 7373 6564 2074 6872 6f75 6768 2061  passed through a
+00024fe0: 7320 6368 756e 6b73 2075 6e63 6861 6e67  s chunks unchang
+00024ff0: 6564 2e0a 0a20 2020 2050 6172 616d 6574  ed...    Paramet
+00025000: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00025010: 2d2d 0a20 2020 2061 203a 2061 7272 6179  --.    a : array
+00025020: 2d6c 696b 650a 2020 2020 2020 2020 496e  -like.        In
+00025030: 7075 7420 6461 7461 2c20 696e 2061 6e79  put data, in any
+00025040: 2066 6f72 6d20 7468 6174 2063 616e 2062   form that can b
+00025050: 6520 636f 6e76 6572 7465 6420 746f 2061  e converted to a
+00025060: 2064 6173 6b20 6172 7261 792e 2054 6869   dask array. Thi
+00025070: 730a 2020 2020 2020 2020 696e 636c 7564  s.        includ
+00025080: 6573 206c 6973 7473 2c20 6c69 7374 7320  es lists, lists 
+00025090: 6f66 2074 7570 6c65 732c 2074 7570 6c65  of tuples, tuple
+000250a0: 732c 2074 7570 6c65 7320 6f66 2074 7570  s, tuples of tup
+000250b0: 6c65 732c 2074 7570 6c65 7320 6f66 0a20  les, tuples of. 
+000250c0: 2020 2020 2020 206c 6973 7473 2061 6e64         lists and
+000250d0: 206e 6461 7272 6179 732e 0a20 2020 2064   ndarrays..    d
+000250e0: 7479 7065 203a 2064 6174 612d 7479 7065  type : data-type
+000250f0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00025100: 2020 2042 7920 6465 6661 756c 742c 2074     By default, t
+00025110: 6865 2064 6174 612d 7479 7065 2069 7320  he data-type is 
+00025120: 696e 6665 7272 6564 2066 726f 6d20 7468  inferred from th
+00025130: 6520 696e 7075 7420 6461 7461 2e0a 2020  e input data..  
+00025140: 2020 6f72 6465 7220 3a20 7be2 8098 43e2    order : {...C.
+00025150: 8099 2c20 e280 9846 e280 992c 20e2 8098  .., ...F..., ...
+00025160: 41e2 8099 2c20 e280 984b e280 997d 2c20  A..., ...K...}, 
+00025170: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00025180: 204d 656d 6f72 7920 6c61 796f 7574 2e20   Memory layout. 
+00025190: e280 9841 e280 9920 616e 6420 e280 984b  ...A... and ...K
+000251a0: e280 9920 6465 7065 6e64 206f 6e20 7468  ... depend on th
+000251b0: 6520 6f72 6465 7220 6f66 2069 6e70 7574  e order of input
+000251c0: 2061 7272 6179 2061 2e0a 2020 2020 2020   array a..      
+000251d0: 2020 e280 9843 e280 9920 726f 772d 6d61    ...C... row-ma
+000251e0: 6a6f 7220 2843 2d73 7479 6c65 292c 20e2  jor (C-style), .
+000251f0: 8098 46e2 8099 2063 6f6c 756d 6e2d 6d61  ..F... column-ma
+00025200: 6a6f 7220 2846 6f72 7472 616e 2d73 7479  jor (Fortran-sty
+00025210: 6c65 2920 6d65 6d6f 7279 0a20 2020 2020  le) memory.     
+00025220: 2020 2072 6570 7265 7365 6e74 6174 696f     representatio
+00025230: 6e2e 20e2 8098 41e2 8099 2028 616e 7929  n. ...A... (any)
+00025240: 206d 6561 6e73 20e2 8098 46e2 8099 2069   means ...F... i
+00025250: 6620 6120 6973 2046 6f72 7472 616e 2063  f a is Fortran c
+00025260: 6f6e 7469 6775 6f75 732c 20e2 8098 43e2  ontiguous, ...C.
+00025270: 8099 0a20 2020 2020 2020 206f 7468 6572  ...        other
+00025280: 7769 7365 20e2 8098 4be2 8099 2028 6b65  wise ...K... (ke
+00025290: 6570 2920 7072 6573 6572 7665 2069 6e70  ep) preserve inp
+000252a0: 7574 206f 7264 6572 2e20 4465 6661 756c  ut order. Defaul
+000252b0: 7473 2074 6f20 e280 9843 e280 992e 0a20  ts to ...C..... 
+000252c0: 2020 206c 696b 653a 2061 7272 6179 2d6c     like: array-l
+000252d0: 696b 650a 2020 2020 2020 2020 5265 6665  ike.        Refe
+000252e0: 7265 6e63 6520 6f62 6a65 6374 2074 6f20  rence object to 
+000252f0: 616c 6c6f 7720 7468 6520 6372 6561 7469  allow the creati
+00025300: 6f6e 206f 6620 4461 736b 2061 7272 6179  on of Dask array
+00025310: 7320 7769 7468 2063 6875 6e6b 730a 2020  s with chunks.  
+00025320: 2020 2020 2020 7468 6174 2061 7265 206e        that are n
+00025330: 6f74 204e 756d 5079 2061 7272 6179 732e  ot NumPy arrays.
+00025340: 2049 6620 616e 2061 7272 6179 2d6c 696b   If an array-lik
+00025350: 6520 7061 7373 6564 2069 6e20 6173 2060  e passed in as `
+00025360: 606c 696b 6560 600a 2020 2020 2020 2020  `like``.        
+00025370: 7375 7070 6f72 7473 2074 6865 2060 605f  supports the ``_
+00025380: 5f61 7272 6179 5f66 756e 6374 696f 6e5f  _array_function_
+00025390: 5f60 6020 7072 6f74 6f63 6f6c 2c20 7468  _`` protocol, th
+000253a0: 6520 6368 756e 6b20 7479 7065 206f 6620  e chunk type of 
+000253b0: 7468 650a 2020 2020 2020 2020 7265 7375  the.        resu
+000253c0: 6c74 696e 6720 6172 7261 7920 7769 6c6c  lting array will
+000253d0: 2062 6520 6465 6669 6e64 6520 6279 2069   be definde by i
+000253e0: 742e 2049 6e20 7468 6973 2063 6173 652c  t. In this case,
+000253f0: 2069 7420 656e 7375 7265 7320 7468 650a   it ensures the.
+00025400: 2020 2020 2020 2020 6372 6561 7469 6f6e          creation
+00025410: 206f 6620 6120 4461 736b 2061 7272 6179   of a Dask array
+00025420: 2063 6f6d 7061 7469 626c 6520 7769 7468   compatible with
+00025430: 2074 6861 7420 7061 7373 6564 2069 6e20   that passed in 
+00025440: 7669 6120 7468 6973 0a20 2020 2020 2020  via this.       
+00025450: 2061 7267 756d 656e 742e 2049 6620 6060   argument. If ``
+00025460: 6c69 6b65 6060 2069 7320 6120 4461 736b  like`` is a Dask
+00025470: 2061 7272 6179 2c20 7468 6520 6368 756e   array, the chun
+00025480: 6b20 7479 7065 206f 6620 7468 650a 2020  k type of the.  
+00025490: 2020 2020 2020 7265 7375 6c74 696e 6720        resulting 
+000254a0: 6172 7261 7920 7769 6c6c 2062 6520 6465  array will be de
+000254b0: 6669 6e65 6420 6279 2074 6865 2063 6875  fined by the chu
+000254c0: 6e6b 2074 7970 6520 6f66 2060 606c 696b  nk type of ``lik
+000254d0: 6560 602e 0a20 2020 2020 2020 2052 6571  e``..        Req
+000254e0: 7569 7265 7320 4e75 6d50 7920 312e 3230  uires NumPy 1.20
+000254f0: 2e30 206f 7220 6869 6768 6572 2e0a 2020  .0 or higher..  
+00025500: 2020 696e 6c69 6e65 5f61 7272 6179 3a0a    inline_array:.
+00025510: 2020 2020 2020 2020 5768 6574 6865 7220          Whether 
+00025520: 746f 2069 6e6c 696e 6520 7468 6520 6172  to inline the ar
+00025530: 7261 7920 696e 2074 6865 2072 6573 756c  ray in the resul
+00025540: 7469 6e67 2064 6173 6b20 6772 6170 682e  ting dask graph.
+00025550: 2046 6f72 206d 6f72 6520 696e 666f 726d   For more inform
+00025560: 6174 696f 6e2c 0a20 2020 2020 2020 2073  ation,.        s
+00025570: 6565 2074 6865 2064 6f63 756d 656e 7461  ee the documenta
+00025580: 7469 6f6e 2066 6f72 2060 6064 6173 6b2e  tion for ``dask.
+00025590: 6172 7261 792e 6672 6f6d 5f61 7272 6179  array.from_array
+000255a0: 2829 6060 2e0a 0a20 2020 2052 6574 7572  ()``...    Retur
+000255b0: 6e73 0a20 2020 202d 2d2d 2d2d 2d2d 0a20  ns.    -------. 
+000255c0: 2020 206f 7574 203a 2064 6173 6b20 6172     out : dask ar
+000255d0: 7261 790a 2020 2020 2020 2020 4461 736b  ray.        Dask
+000255e0: 2061 7272 6179 2069 6e74 6572 7072 6574   array interpret
+000255f0: 6174 696f 6e20 6f66 2061 2e0a 0a20 2020  ation of a...   
+00025600: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
+00025610: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2069  ------.    >>> i
+00025620: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
+00025630: 2061 7320 6461 0a20 2020 203e 3e3e 2069   as da.    >>> i
+00025640: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+00025650: 700a 2020 2020 3e3e 3e20 7820 3d20 6e70  p.    >>> x = np
+00025660: 2e61 7261 6e67 6528 3329 0a20 2020 203e  .arange(3).    >
+00025670: 3e3e 2064 612e 6173 616e 7961 7272 6179  >> da.asanyarray
+00025680: 2878 290a 2020 2020 6461 736b 2e61 7272  (x).    dask.arr
+00025690: 6179 3c61 7272 6179 2c20 7368 6170 653d  ay<array, shape=
+000256a0: 2833 2c29 2c20 6474 7970 653d 696e 7436  (3,), dtype=int6
+000256b0: 342c 2063 6875 6e6b 7369 7a65 3d28 332c  4, chunksize=(3,
+000256c0: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
+000256d0: 7079 2e6e 6461 7272 6179 3e0a 0a20 2020  py.ndarray>..   
+000256e0: 203e 3e3e 2079 203d 205b 5b31 2c20 322c   >>> y = [[1, 2,
+000256f0: 2033 5d2c 205b 342c 2035 2c20 365d 5d0a   3], [4, 5, 6]].
+00025700: 2020 2020 3e3e 3e20 6461 2e61 7361 6e79      >>> da.asany
+00025710: 6172 7261 7928 7929 0a20 2020 2064 6173  array(y).    das
+00025720: 6b2e 6172 7261 793c 6172 7261 792c 2073  k.array<array, s
+00025730: 6861 7065 3d28 322c 2033 292c 2064 7479  hape=(2, 3), dty
+00025740: 7065 3d69 6e74 3634 2c20 6368 756e 6b73  pe=int64, chunks
+00025750: 697a 653d 2832 2c20 3329 2c20 6368 756e  ize=(2, 3), chun
+00025760: 6b74 7970 653d 6e75 6d70 792e 6e64 6172  ktype=numpy.ndar
+00025770: 7261 793e 0a20 2020 2022 2222 0a20 2020  ray>.    """.   
+00025780: 2069 6620 6c69 6b65 2069 7320 4e6f 6e65   if like is None
+00025790: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+000257a0: 6e73 7461 6e63 6528 612c 2041 7272 6179  nstance(a, Array
+000257b0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000257c0: 6574 7572 6e20 610a 2020 2020 2020 2020  eturn a.        
+000257d0: 656c 6966 2068 6173 6174 7472 2861 2c20  elif hasattr(a, 
+000257e0: 2274 6f5f 6461 736b 5f61 7272 6179 2229  "to_dask_array")
+000257f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00025800: 7475 726e 2061 2e74 6f5f 6461 736b 5f61  turn a.to_dask_a
+00025810: 7272 6179 2829 0a20 2020 2020 2020 2065  rray().        e
+00025820: 6c69 6620 7479 7065 2861 292e 5f5f 6d6f  lif type(a).__mo
+00025830: 6475 6c65 5f5f 2e73 706c 6974 2822 2e22  dule__.split("."
+00025840: 295b 305d 203d 3d20 2278 6172 7261 7922  )[0] == "xarray"
+00025850: 2061 6e64 2068 6173 6174 7472 2861 2c20   and hasattr(a, 
+00025860: 2264 6174 6122 293a 0a20 2020 2020 2020  "data"):.       
+00025870: 2020 2020 2072 6574 7572 6e20 6173 616e       return asan
+00025880: 7961 7272 6179 2861 2e64 6174 6129 0a20  yarray(a.data). 
+00025890: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+000258a0: 7374 616e 6365 2861 2c20 286c 6973 742c  stance(a, (list,
+000258b0: 2074 7570 6c65 2929 2061 6e64 2061 6e79   tuple)) and any
+000258c0: 2869 7369 6e73 7461 6e63 6528 692c 2041  (isinstance(i, A
+000258d0: 7272 6179 2920 666f 7220 6920 696e 2061  rray) for i in a
+000258e0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000258f0: 6574 7572 6e20 7374 6163 6b28 6129 0a20  eturn stack(a). 
+00025900: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00025910: 6973 696e 7374 616e 6365 2867 6574 6174  isinstance(getat
+00025920: 7472 2861 2c20 2273 6861 7065 222c 204e  tr(a, "shape", N
+00025930: 6f6e 6529 2c20 4974 6572 6162 6c65 293a  one), Iterable):
+00025940: 0a20 2020 2020 2020 2020 2020 2061 203d  .            a =
+00025950: 206e 702e 6173 616e 7961 7272 6179 2861   np.asanyarray(a
+00025960: 2c20 6474 7970 653d 6474 7970 652c 206f  , dtype=dtype, o
+00025970: 7264 6572 3d6f 7264 6572 290a 2020 2020  rder=order).    
+00025980: 656c 7365 3a0a 2020 2020 2020 2020 6c69  else:.        li
+00025990: 6b65 5f6d 6574 6120 3d20 6d65 7461 5f66  ke_meta = meta_f
+000259a0: 726f 6d5f 6172 7261 7928 6c69 6b65 290a  rom_array(like).
+000259b0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000259c0: 7461 6e63 6528 612c 2041 7272 6179 293a  tance(a, Array):
+000259d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000259e0: 7572 6e20 612e 6d61 705f 626c 6f63 6b73  urn a.map_blocks
+000259f0: 286e 702e 6173 616e 7961 7272 6179 2c20  (np.asanyarray, 
+00025a00: 6c69 6b65 3d6c 696b 655f 6d65 7461 2c20  like=like_meta, 
+00025a10: 6474 7970 653d 6474 7970 652c 206f 7264  dtype=dtype, ord
+00025a20: 6572 3d6f 7264 6572 290a 2020 2020 2020  er=order).      
+00025a30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00025a40: 2020 2020 6120 3d20 6e70 2e61 7361 6e79      a = np.asany
+00025a50: 6172 7261 7928 612c 206c 696b 653d 6c69  array(a, like=li
+00025a60: 6b65 5f6d 6574 612c 2064 7479 7065 3d64  ke_meta, dtype=d
+00025a70: 7479 7065 2c20 6f72 6465 723d 6f72 6465  type, order=orde
+00025a80: 7229 0a20 2020 2072 6574 7572 6e20 6672  r).    return fr
+00025a90: 6f6d 5f61 7272 6179 280a 2020 2020 2020  om_array(.      
+00025aa0: 2020 612c 0a20 2020 2020 2020 2063 6875    a,.        chu
+00025ab0: 6e6b 733d 612e 7368 6170 652c 0a20 2020  nks=a.shape,.   
+00025ac0: 2020 2020 2067 6574 6974 656d 3d67 6574       getitem=get
+00025ad0: 7465 725f 696e 6c69 6e65 2c0a 2020 2020  ter_inline,.    
+00025ae0: 2020 2020 6173 6172 7261 793d 4661 6c73      asarray=Fals
+00025af0: 652c 0a20 2020 2020 2020 2069 6e6c 696e  e,.        inlin
+00025b00: 655f 6172 7261 793d 696e 6c69 6e65 5f61  e_array=inline_a
+00025b10: 7272 6179 2c0a 2020 2020 290a 0a0a 6465  rray,.    )...de
+00025b20: 6620 6973 5f73 6361 6c61 725f 666f 725f  f is_scalar_for_
+00025b30: 656c 656d 7769 7365 2861 7267 293a 0a20  elemwise(arg):. 
+00025b40: 2020 2022 2222 0a0a 2020 2020 3e3e 3e20     """..    >>> 
+00025b50: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
+00025b60: 656d 7769 7365 2834 3229 0a20 2020 2054  emwise(42).    T
+00025b70: 7275 650a 2020 2020 3e3e 3e20 6973 5f73  rue.    >>> is_s
+00025b80: 6361 6c61 725f 666f 725f 656c 656d 7769  calar_for_elemwi
+00025b90: 7365 2827 666f 6f27 290a 2020 2020 5472  se('foo').    Tr
+00025ba0: 7565 0a20 2020 203e 3e3e 2069 735f 7363  ue.    >>> is_sc
+00025bb0: 616c 6172 5f66 6f72 5f65 6c65 6d77 6973  alar_for_elemwis
+00025bc0: 6528 5472 7565 290a 2020 2020 5472 7565  e(True).    True
+00025bd0: 0a20 2020 203e 3e3e 2069 735f 7363 616c  .    >>> is_scal
+00025be0: 6172 5f66 6f72 5f65 6c65 6d77 6973 6528  ar_for_elemwise(
+00025bf0: 6e70 2e61 7272 6179 2834 3229 290a 2020  np.array(42)).  
+00025c00: 2020 5472 7565 0a20 2020 203e 3e3e 2069    True.    >>> i
+00025c10: 735f 7363 616c 6172 5f66 6f72 5f65 6c65  s_scalar_for_ele
+00025c20: 6d77 6973 6528 5b31 2c20 322c 2033 5d29  mwise([1, 2, 3])
+00025c30: 0a20 2020 2054 7275 650a 2020 2020 3e3e  .    True.    >>
+00025c40: 3e20 6973 5f73 6361 6c61 725f 666f 725f  > is_scalar_for_
+00025c50: 656c 656d 7769 7365 286e 702e 6172 7261  elemwise(np.arra
+00025c60: 7928 5b31 2c20 322c 2033 5d29 290a 2020  y([1, 2, 3])).  
+00025c70: 2020 4661 6c73 650a 2020 2020 3e3e 3e20    False.    >>> 
+00025c80: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
+00025c90: 656d 7769 7365 2866 726f 6d5f 6172 7261  emwise(from_arra
+00025ca0: 7928 6e70 2e61 7272 6179 2830 292c 2063  y(np.array(0), c
+00025cb0: 6875 6e6b 733d 2829 2929 0a20 2020 2046  hunks=())).    F
+00025cc0: 616c 7365 0a20 2020 203e 3e3e 2069 735f  alse.    >>> is_
+00025cd0: 7363 616c 6172 5f66 6f72 5f65 6c65 6d77  scalar_for_elemw
+00025ce0: 6973 6528 6e70 2e64 7479 7065 2827 6934  ise(np.dtype('i4
+00025cf0: 2729 290a 2020 2020 5472 7565 0a20 2020  ')).    True.   
+00025d00: 2022 2222 0a20 2020 2023 2074 6865 2073   """.    # the s
+00025d10: 6563 6f6e 6420 6861 6c66 206f 6620 7368  econd half of sh
+00025d20: 6170 655f 636f 6e64 6974 696f 6e20 6973  ape_condition is
+00025d30: 2065 7373 656e 7469 616c 6c79 206a 7573   essentially jus
+00025d40: 7420 746f 2065 6e73 7572 6520 7468 6174  t to ensure that
+00025d50: 0a20 2020 2023 2064 6173 6b20 7365 7269  .    # dask seri
+00025d60: 6573 202f 2066 7261 6d65 2061 7265 2074  es / frame are t
+00025d70: 7265 6174 6564 2061 7320 7363 616c 6172  reated as scalar
+00025d80: 7320 696e 2065 6c65 6d77 6973 652e 0a20  s in elemwise.. 
+00025d90: 2020 206d 6179 6265 5f73 6861 7065 203d     maybe_shape =
+00025da0: 2067 6574 6174 7472 2861 7267 2c20 2273   getattr(arg, "s
+00025db0: 6861 7065 222c 204e 6f6e 6529 0a20 2020  hape", None).   
+00025dc0: 2073 6861 7065 5f63 6f6e 6469 7469 6f6e   shape_condition
+00025dd0: 203d 206e 6f74 2069 7369 6e73 7461 6e63   = not isinstanc
+00025de0: 6528 6d61 7962 655f 7368 6170 652c 2049  e(maybe_shape, I
+00025df0: 7465 7261 626c 6529 206f 7220 616e 7928  terable) or any(
+00025e00: 0a20 2020 2020 2020 2069 735f 6461 736b  .        is_dask
+00025e10: 5f63 6f6c 6c65 6374 696f 6e28 7829 2066  _collection(x) f
+00025e20: 6f72 2078 2069 6e20 6d61 7962 655f 7368  or x in maybe_sh
+00025e30: 6170 650a 2020 2020 290a 0a20 2020 2072  ape.    )..    r
+00025e40: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00025e50: 6e70 2e69 7373 6361 6c61 7228 6172 6729  np.isscalar(arg)
+00025e60: 0a20 2020 2020 2020 206f 7220 7368 6170  .        or shap
+00025e70: 655f 636f 6e64 6974 696f 6e0a 2020 2020  e_condition.    
+00025e80: 2020 2020 6f72 2069 7369 6e73 7461 6e63      or isinstanc
+00025e90: 6528 6172 672c 206e 702e 6474 7970 6529  e(arg, np.dtype)
+00025ea0: 0a20 2020 2020 2020 206f 7220 2869 7369  .        or (isi
+00025eb0: 6e73 7461 6e63 6528 6172 672c 206e 702e  nstance(arg, np.
+00025ec0: 6e64 6172 7261 7929 2061 6e64 2061 7267  ndarray) and arg
+00025ed0: 2e6e 6469 6d20 3d3d 2030 290a 2020 2020  .ndim == 0).    
+00025ee0: 290a 0a0a 6465 6620 6272 6f61 6463 6173  )...def broadcas
+00025ef0: 745f 7368 6170 6573 282a 7368 6170 6573  t_shapes(*shapes
+00025f00: 293a 0a20 2020 2022 2222 0a20 2020 2044  ):.    """.    D
+00025f10: 6574 6572 6d69 6e65 7320 6f75 7470 7574  etermines output
+00025f20: 2073 6861 7065 2066 726f 6d20 6272 6f61   shape from broa
+00025f30: 6463 6173 7469 6e67 2061 7272 6179 732e  dcasting arrays.
+00025f40: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
+00025f50: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
+00025f60: 2020 2020 7368 6170 6573 203a 2074 7570      shapes : tup
+00025f70: 6c65 730a 2020 2020 2020 2020 5468 6520  les.        The 
+00025f80: 7368 6170 6573 206f 6620 7468 6520 6172  shapes of the ar
+00025f90: 6775 6d65 6e74 732e 0a0a 2020 2020 5265  guments...    Re
+00025fa0: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00025fb0: 2d0a 2020 2020 6f75 7470 7574 5f73 6861  -.    output_sha
+00025fc0: 7065 203a 2074 7570 6c65 0a0a 2020 2020  pe : tuple..    
+00025fd0: 5261 6973 6573 0a20 2020 202d 2d2d 2d2d  Raises.    -----
+00025fe0: 2d0a 2020 2020 5661 6c75 6545 7272 6f72  -.    ValueError
+00025ff0: 0a20 2020 2020 2020 2049 6620 7468 6520  .        If the 
+00026000: 696e 7075 7420 7368 6170 6573 2063 616e  input shapes can
+00026010: 6e6f 7420 6265 2073 7563 6365 7373 6675  not be successfu
+00026020: 6c6c 7920 6272 6f61 6463 6173 7420 746f  lly broadcast to
+00026030: 6765 7468 6572 2e0a 2020 2020 2222 220a  gether..    """.
+00026040: 2020 2020 6966 206c 656e 2873 6861 7065      if len(shape
+00026050: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
+00026060: 2072 6574 7572 6e20 7368 6170 6573 5b30   return shapes[0
+00026070: 5d0a 2020 2020 6f75 7420 3d20 5b5d 0a20  ].    out = []. 
+00026080: 2020 2066 6f72 2073 697a 6573 2069 6e20     for sizes in 
+00026090: 7a69 705f 6c6f 6e67 6573 7428 2a6d 6170  zip_longest(*map
+000260a0: 2872 6576 6572 7365 642c 2073 6861 7065  (reversed, shape
+000260b0: 7329 2c20 6669 6c6c 7661 6c75 653d 2d31  s), fillvalue=-1
+000260c0: 293a 0a20 2020 2020 2020 2069 6620 6e70  ):.        if np
+000260d0: 2e69 736e 616e 2873 697a 6573 292e 616e  .isnan(sizes).an
+000260e0: 7928 293a 0a20 2020 2020 2020 2020 2020  y():.           
+000260f0: 2064 696d 203d 206e 702e 6e61 6e0a 2020   dim = np.nan.  
+00026100: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00026110: 2020 2020 2020 2020 6469 6d20 3d20 3020          dim = 0 
+00026120: 6966 2030 2069 6e20 7369 7a65 7320 656c  if 0 in sizes el
+00026130: 7365 206e 702e 6d61 7828 7369 7a65 7329  se np.max(sizes)
+00026140: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00026150: 6920 6e6f 7420 696e 205b 2d31 2c20 302c  i not in [-1, 0,
+00026160: 2031 2c20 6469 6d5d 2061 6e64 206e 6f74   1, dim] and not
+00026170: 206e 702e 6973 6e61 6e28 6929 2066 6f72   np.isnan(i) for
+00026180: 2069 2069 6e20 7369 7a65 7329 3a0a 2020   i in sizes):.  
+00026190: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000261a0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000261b0: 2020 2020 2020 2020 2020 2020 226f 7065              "ope
+000261c0: 7261 6e64 7320 636f 756c 6420 6e6f 7420  rands could not 
+000261d0: 6265 2062 726f 6164 6361 7374 2074 6f67  be broadcast tog
+000261e0: 6574 6865 7220 7769 7468 2022 0a20 2020  ether with ".   
+000261f0: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
+00026200: 6170 6573 207b 7d22 2e66 6f72 6d61 7428  apes {}".format(
+00026210: 2220 222e 6a6f 696e 286d 6170 2873 7472  " ".join(map(str
+00026220: 2c20 7368 6170 6573 2929 290a 2020 2020  , shapes))).    
+00026230: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00026240: 2020 6f75 742e 6170 7065 6e64 2864 696d    out.append(dim
+00026250: 290a 2020 2020 7265 7475 726e 2074 7570  ).    return tup
+00026260: 6c65 2872 6576 6572 7365 6428 6f75 7429  le(reversed(out)
+00026270: 290a 0a0a 6465 6620 656c 656d 7769 7365  )...def elemwise
+00026280: 286f 702c 202a 6172 6773 2c20 6f75 743d  (op, *args, out=
+00026290: 4e6f 6e65 2c20 7768 6572 653d 5472 7565  None, where=True
+000262a0: 2c20 6474 7970 653d 4e6f 6e65 2c20 6e61  , dtype=None, na
+000262b0: 6d65 3d4e 6f6e 652c 202a 2a6b 7761 7267  me=None, **kwarg
+000262c0: 7329 3a0a 2020 2020 2222 2241 7070 6c79  s):.    """Apply
+000262d0: 2061 6e20 656c 656d 656e 7477 6973 6520   an elementwise 
+000262e0: 7566 756e 632d 6c69 6b65 2066 756e 6374  ufunc-like funct
+000262f0: 696f 6e20 626c 6f63 6b77 6973 6520 6163  ion blockwise ac
+00026300: 726f 7373 2061 7267 756d 656e 7473 2e0a  ross arguments..
+00026310: 0a20 2020 204c 696b 6520 6e75 6d70 7920  .    Like numpy 
+00026320: 7566 756e 6373 2c20 6272 6f61 6463 6173  ufuncs, broadcas
+00026330: 7469 6e67 2072 756c 6573 2061 7265 2072  ting rules are r
+00026340: 6573 7065 6374 6564 2e0a 0a20 2020 2050  espected...    P
+00026350: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00026360: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206f 7020  --------.    op 
+00026370: 3a20 6361 6c6c 6162 6c65 0a20 2020 2020  : callable.     
+00026380: 2020 2054 6865 2066 756e 6374 696f 6e20     The function 
+00026390: 746f 2061 7070 6c79 2e20 5368 6f75 6c64  to apply. Should
+000263a0: 2062 6520 6e75 6d70 7920 7566 756e 632d   be numpy ufunc-
+000263b0: 6c69 6b65 2069 6e20 7468 6520 7061 7261  like in the para
+000263c0: 6d65 7465 7273 0a20 2020 2020 2020 2074  meters.        t
+000263d0: 6861 7420 6974 2061 6363 6570 7473 2e0a  hat it accepts..
+000263e0: 2020 2020 2a61 7267 7320 3a20 416e 790a      *args : Any.
+000263f0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+00026400: 7320 746f 2070 6173 7320 746f 2060 6f70  s to pass to `op
+00026410: 602e 204e 6f6e 2d64 6173 6b20 6172 7261  `. Non-dask arra
+00026420: 792d 6c69 6b65 206f 626a 6563 7473 2061  y-like objects a
+00026430: 7265 2066 6972 7374 0a20 2020 2020 2020  re first.       
+00026440: 2063 6f6e 7665 7274 6564 2074 6f20 6461   converted to da
+00026450: 736b 2061 7272 6179 732c 2074 6865 6e20  sk arrays, then 
+00026460: 616c 6c20 6172 7261 7973 2061 7265 2062  all arrays are b
+00026470: 726f 6164 6361 7374 2074 6f67 6574 6865  roadcast togethe
+00026480: 7220 6265 666f 7265 0a20 2020 2020 2020  r before.       
+00026490: 2061 7070 6c79 696e 6720 7468 6520 6675   applying the fu
+000264a0: 6e63 7469 6f6e 2062 6c6f 636b 7769 7365  nction blockwise
+000264b0: 2061 6372 6f73 7320 616c 6c20 6172 6775   across all argu
+000264c0: 6d65 6e74 732e 2041 6e79 2073 6361 6c61  ments. Any scala
+000264d0: 720a 2020 2020 2020 2020 6172 6775 6d65  r.        argume
+000264e0: 6e74 7320 6172 6520 7061 7373 6564 2061  nts are passed a
+000264f0: 732d 6973 2066 6f6c 6c6f 7769 6e67 206e  s-is following n
+00026500: 6f72 6d61 6c20 6e75 6d70 7920 7566 756e  ormal numpy ufun
+00026510: 6320 6265 6861 7669 6f72 2e0a 2020 2020  c behavior..    
+00026520: 6f75 7420 3a20 6461 736b 2061 7272 6179  out : dask array
+00026530: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00026540: 2020 2049 6620 6f75 7420 6973 2061 2064     If out is a d
+00026550: 6173 6b2e 6172 7261 7920 7468 656e 2074  ask.array then t
+00026560: 6869 7320 6f76 6572 7772 6974 6573 2074  his overwrites t
+00026570: 6865 2063 6f6e 7465 6e74 7320 6f66 2074  he contents of t
+00026580: 6861 7420 6172 7261 790a 2020 2020 2020  hat array.      
+00026590: 2020 7769 7468 2074 6865 2072 6573 756c    with the resul
+000265a0: 742e 0a20 2020 2077 6865 7265 203a 2061  t..    where : a
+000265b0: 7272 6179 5f6c 696b 652c 206f 7074 696f  rray_like, optio
+000265c0: 6e61 6c0a 2020 2020 2020 2020 416e 206f  nal.        An o
+000265d0: 7074 696f 6e61 6c20 626f 6f6c 6561 6e20  ptional boolean 
+000265e0: 6d61 736b 206d 6172 6b69 6e67 206c 6f63  mask marking loc
+000265f0: 6174 696f 6e73 2077 6865 7265 2074 6865  ations where the
+00026600: 2075 6675 6e63 2073 686f 756c 6420 6265   ufunc should be
+00026610: 0a20 2020 2020 2020 2061 7070 6c69 6564  .        applied
+00026620: 2e20 4361 6e20 6265 2061 2073 6361 6c61  . Can be a scala
+00026630: 722c 2064 6173 6b20 6172 7261 792c 206f  r, dask array, o
+00026640: 7220 616e 7920 6f74 6865 7220 6172 7261  r any other arra
+00026650: 792d 6c69 6b65 206f 626a 6563 742e 0a20  y-like object.. 
+00026660: 2020 2020 2020 204d 6972 726f 7273 2074         Mirrors t
+00026670: 6865 2060 6077 6865 7265 6060 2061 7267  he ``where`` arg
+00026680: 756d 656e 7420 746f 206e 756d 7079 2075  ument to numpy u
+00026690: 6675 6e63 732c 2073 6565 2065 2e67 2e20  funcs, see e.g. 
+000266a0: 6060 6e75 6d70 792e 6164 6460 600a 2020  ``numpy.add``.  
+000266b0: 2020 2020 2020 666f 7220 6d6f 7265 2069        for more i
+000266c0: 6e66 6f72 6d61 7469 6f6e 2e0a 2020 2020  nformation..    
+000266d0: 6474 7970 6520 3a20 6474 7970 652c 206f  dtype : dtype, o
+000266e0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+000266f0: 4966 2070 726f 7669 6465 642c 206f 7665  If provided, ove
+00026700: 7272 6964 6573 2074 6865 206f 7574 7075  rrides the outpu
+00026710: 7420 6172 7261 7920 6474 7970 652e 0a20  t array dtype.. 
+00026720: 2020 206e 616d 6520 3a20 7374 722c 206f     name : str, o
+00026730: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00026740: 4120 756e 6971 7565 206b 6579 206e 616d  A unique key nam
+00026750: 6520 746f 2075 7365 2077 6865 6e20 6275  e to use when bu
+00026760: 696c 6469 6e67 2074 6865 2062 6163 6b69  ilding the backi
+00026770: 6e67 2064 6173 6b20 6772 6170 682e 2049  ng dask graph. I
+00026780: 6620 6e6f 740a 2020 2020 2020 2020 7072  f not.        pr
+00026790: 6f76 6964 6564 2c20 6f6e 6520 7769 6c6c  ovided, one will
+000267a0: 2062 6520 6175 746f 6d61 7469 6361 6c6c   be automaticall
+000267b0: 7920 6765 6e65 7261 7465 6420 6261 7365  y generated base
+000267c0: 6420 6f6e 2074 6865 2069 6e70 7574 0a20  d on the input. 
+000267d0: 2020 2020 2020 2061 7267 756d 656e 7473         arguments
+000267e0: 2e0a 0a20 2020 2045 7861 6d70 6c65 730a  ...    Examples.
+000267f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00026800: 203e 3e3e 2065 6c65 6d77 6973 6528 6164   >>> elemwise(ad
+00026810: 642c 2078 2c20 7929 2020 2320 646f 6374  d, x, y)  # doct
+00026820: 6573 743a 202b 534b 4950 0a20 2020 203e  est: +SKIP.    >
+00026830: 3e3e 2065 6c65 6d77 6973 6528 7369 6e2c  >> elemwise(sin,
+00026840: 2078 2920 2023 2064 6f63 7465 7374 3a20   x)  # doctest: 
+00026850: 2b53 4b49 500a 2020 2020 3e3e 3e20 656c  +SKIP.    >>> el
+00026860: 656d 7769 7365 2873 696e 2c20 782c 206f  emwise(sin, x, o
+00026870: 7574 3d64 6173 6b5f 6172 7261 7929 2020  ut=dask_array)  
+00026880: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+00026890: 0a0a 2020 2020 5365 6520 416c 736f 0a20  ..    See Also. 
+000268a0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+000268b0: 626c 6f63 6b77 6973 650a 2020 2020 2222  blockwise.    ""
+000268c0: 220a 2020 2020 6966 206b 7761 7267 733a  ".    if kwargs:
+000268d0: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
+000268e0: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
+000268f0: 2020 2020 2020 6622 7b6f 702e 5f5f 6e61        f"{op.__na
+00026900: 6d65 5f5f 7d20 646f 6573 206e 6f74 2074  me__} does not t
+00026910: 616b 6520 7468 6520 666f 6c6c 6f77 696e  ake the followin
+00026920: 6720 6b65 7977 6f72 6420 6172 6775 6d65  g keyword argume
+00026930: 6e74 7320 220a 2020 2020 2020 2020 2020  nts ".          
+00026940: 2020 6622 7b73 6f72 7465 6428 6b77 6172    f"{sorted(kwar
+00026950: 6773 297d 220a 2020 2020 2020 2020 290a  gs)}".        ).
+00026960: 0a20 2020 206f 7574 203d 205f 656c 656d  .    out = _elem
+00026970: 7769 7365 5f6e 6f72 6d61 6c69 7a65 5f6f  wise_normalize_o
+00026980: 7574 286f 7574 290a 2020 2020 7768 6572  ut(out).    wher
+00026990: 6520 3d20 5f65 6c65 6d77 6973 655f 6e6f  e = _elemwise_no
+000269a0: 726d 616c 697a 655f 7768 6572 6528 7768  rmalize_where(wh
+000269b0: 6572 6529 0a20 2020 2061 7267 7320 3d20  ere).    args = 
+000269c0: 5b6e 702e 6173 6172 7261 7928 6129 2069  [np.asarray(a) i
+000269d0: 6620 6973 696e 7374 616e 6365 2861 2c20  f isinstance(a, 
+000269e0: 286c 6973 742c 2074 7570 6c65 2929 2065  (list, tuple)) e
+000269f0: 6c73 6520 6120 666f 7220 6120 696e 2061  lse a for a in a
+00026a00: 7267 735d 0a0a 2020 2020 7368 6170 6573  rgs]..    shapes
+00026a10: 203d 205b 5d0a 2020 2020 666f 7220 6172   = [].    for ar
+00026a20: 6720 696e 2061 7267 733a 0a20 2020 2020  g in args:.     
+00026a30: 2020 2073 6861 7065 203d 2067 6574 6174     shape = getat
+00026a40: 7472 2861 7267 2c20 2273 6861 7065 222c  tr(arg, "shape",
+00026a50: 2028 2929 0a20 2020 2020 2020 2069 6620   ()).        if 
+00026a60: 616e 7928 6973 5f64 6173 6b5f 636f 6c6c  any(is_dask_coll
+00026a70: 6563 7469 6f6e 2878 2920 666f 7220 7820  ection(x) for x 
+00026a80: 696e 2073 6861 7065 293a 0a20 2020 2020  in shape):.     
+00026a90: 2020 2020 2020 2023 2057 616e 7420 746f         # Want to
+00026aa0: 2065 7863 6c75 6465 2044 656c 6179 6564   exclude Delayed
+00026ab0: 2073 6861 7065 7320 616e 6420 6464 2e53   shapes and dd.S
+00026ac0: 6361 6c61 720a 2020 2020 2020 2020 2020  calar.          
+00026ad0: 2020 7368 6170 6520 3d20 2829 0a20 2020    shape = ().   
+00026ae0: 2020 2020 2073 6861 7065 732e 6170 7065       shapes.appe
+00026af0: 6e64 2873 6861 7065 290a 2020 2020 6966  nd(shape).    if
+00026b00: 2069 7369 6e73 7461 6e63 6528 7768 6572   isinstance(wher
+00026b10: 652c 2041 7272 6179 293a 0a20 2020 2020  e, Array):.     
+00026b20: 2020 2073 6861 7065 732e 6170 7065 6e64     shapes.append
+00026b30: 2877 6865 7265 2e73 6861 7065 290a 2020  (where.shape).  
+00026b40: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00026b50: 6f75 742c 2041 7272 6179 293a 0a20 2020  out, Array):.   
+00026b60: 2020 2020 2073 6861 7065 732e 6170 7065       shapes.appe
+00026b70: 6e64 286f 7574 2e73 6861 7065 290a 0a20  nd(out.shape).. 
+00026b80: 2020 2073 6861 7065 7320 3d20 5b73 2069     shapes = [s i
+00026b90: 6620 6973 696e 7374 616e 6365 2873 2c20  f isinstance(s, 
+00026ba0: 4974 6572 6162 6c65 2920 656c 7365 2028  Iterable) else (
+00026bb0: 2920 666f 7220 7320 696e 2073 6861 7065  ) for s in shape
+00026bc0: 735d 0a20 2020 206f 7574 5f6e 6469 6d20  s].    out_ndim 
+00026bd0: 3d20 6c65 6e28 0a20 2020 2020 2020 2062  = len(.        b
+00026be0: 726f 6164 6361 7374 5f73 6861 7065 7328  roadcast_shapes(
+00026bf0: 2a73 6861 7065 7329 0a20 2020 2029 2020  *shapes).    )  
+00026c00: 2320 5261 6973 6573 2056 616c 7565 4572  # Raises ValueEr
+00026c10: 726f 7220 6966 2064 696d 656e 7369 6f6e  ror if dimension
+00026c20: 7320 6d69 736d 6174 6368 0a20 2020 2065  s mismatch.    e
+00026c30: 7870 725f 696e 6473 203d 2074 7570 6c65  xpr_inds = tuple
+00026c40: 2872 616e 6765 286f 7574 5f6e 6469 6d29  (range(out_ndim)
+00026c50: 295b 3a3a 2d31 5d0a 0a20 2020 2069 6620  )[::-1]..    if 
+00026c60: 6474 7970 6520 6973 206e 6f74 204e 6f6e  dtype is not Non
+00026c70: 653a 0a20 2020 2020 2020 206e 6565 645f  e:.        need_
+00026c80: 656e 666f 7263 655f 6474 7970 6520 3d20  enforce_dtype = 
+00026c90: 5472 7565 0a20 2020 2065 6c73 653a 0a20  True.    else:. 
+00026ca0: 2020 2020 2020 2023 2057 6520 666f 6c6c         # We foll
+00026cb0: 6f77 204e 756d 5079 2773 2072 756c 6573  ow NumPy's rules
+00026cc0: 2066 6f72 2064 7479 7065 2070 726f 6d6f   for dtype promo
+00026cd0: 7469 6f6e 2c20 7768 6963 6820 7370 6563  tion, which spec
+00026ce0: 6961 6c20 6361 7365 730a 2020 2020 2020  ial cases.      
+00026cf0: 2020 2320 7363 616c 6172 7320 616e 6420    # scalars and 
+00026d00: 3064 206e 6461 7272 6179 7320 2877 6869  0d ndarrays (whi
+00026d10: 6368 2069 7420 636f 6e73 6964 6572 7320  ch it considers 
+00026d20: 6571 7569 7661 6c65 6e74 2920 6279 2075  equivalent) by u
+00026d30: 7369 6e67 0a20 2020 2020 2020 2023 2074  sing.        # t
+00026d40: 6865 6972 2076 616c 7565 7320 746f 2063  heir values to c
+00026d50: 6f6d 7075 7465 2074 6865 2072 6573 756c  ompute the resul
+00026d60: 7420 6474 7970 653a 0a20 2020 2020 2020  t dtype:.       
+00026d70: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+00026d80: 622e 636f 6d2f 6e75 6d70 792f 6e75 6d70  b.com/numpy/nump
+00026d90: 792f 6973 7375 6573 2f36 3234 300a 2020  y/issues/6240.  
+00026da0: 2020 2020 2020 2320 5765 2064 6f6e 2774        # We don't
+00026db0: 2069 6e73 7065 6374 2074 6865 2076 616c   inspect the val
+00026dc0: 7565 7320 6f66 2030 6420 6461 736b 2061  ues of 0d dask a
+00026dd0: 7272 6179 732c 2062 6563 6175 7365 2074  rrays, because t
+00026de0: 6865 7365 2063 6f75 6c64 0a20 2020 2020  hese could.     
+00026df0: 2020 2023 2068 6f6c 6420 706f 7465 6e74     # hold potent
+00026e00: 6961 6c6c 7920 7665 7279 2065 7870 656e  ially very expen
+00026e10: 7369 7665 2063 616c 6375 6c61 7469 6f6e  sive calculation
+00026e20: 732e 2049 6e73 7465 6164 2c20 7765 2074  s. Instead, we t
+00026e30: 7265 6174 0a20 2020 2020 2020 2023 2074  reat.        # t
+00026e40: 6865 6d20 6a75 7374 206c 696b 6520 6f74  hem just like ot
+00026e50: 6865 7220 6172 7261 7973 2c20 616e 6420  her arrays, and 
+00026e60: 6966 206e 6563 6573 7361 7279 2063 6173  if necessary cas
+00026e70: 7420 7468 6520 7265 7375 6c74 206f 6620  t the result of 
+00026e80: 6f70 0a20 2020 2020 2020 2023 2074 6f20  op.        # to 
+00026e90: 6d61 7463 682e 0a20 2020 2020 2020 2076  match..        v
+00026ea0: 616c 7320 3d20 5b0a 2020 2020 2020 2020  als = [.        
+00026eb0: 2020 2020 6e70 2e65 6d70 7479 2828 312c      np.empty((1,
+00026ec0: 2920 2a20 6d61 7828 312c 2061 2e6e 6469  ) * max(1, a.ndi
+00026ed0: 6d29 2c20 6474 7970 653d 612e 6474 7970  m), dtype=a.dtyp
+00026ee0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+00026ef0: 6620 6e6f 7420 6973 5f73 6361 6c61 725f  f not is_scalar_
+00026f00: 666f 725f 656c 656d 7769 7365 2861 290a  for_elemwise(a).
+00026f10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00026f20: 2061 0a20 2020 2020 2020 2020 2020 2066   a.            f
+00026f30: 6f72 2061 2069 6e20 6172 6773 0a20 2020  or a in args.   
+00026f40: 2020 2020 205d 0a20 2020 2020 2020 2074       ].        t
+00026f50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00026f60: 6474 7970 6520 3d20 6170 706c 795f 696e  dtype = apply_in
+00026f70: 6665 725f 6474 7970 6528 6f70 2c20 7661  fer_dtype(op, va
+00026f80: 6c73 2c20 7b7d 2c20 2265 6c65 6d77 6973  ls, {}, "elemwis
+00026f90: 6522 2c20 7375 6767 6573 745f 6474 7970  e", suggest_dtyp
+00026fa0: 653d 4661 6c73 6529 0a20 2020 2020 2020  e=False).       
+00026fb0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00026fc0: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
+00026fd0: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
+00026fe0: 6e74 6564 0a20 2020 2020 2020 206e 6565  nted.        nee
+00026ff0: 645f 656e 666f 7263 655f 6474 7970 6520  d_enforce_dtype 
+00027000: 3d20 616e 7928 0a20 2020 2020 2020 2020  = any(.         
+00027010: 2020 206e 6f74 2069 735f 7363 616c 6172     not is_scalar
+00027020: 5f66 6f72 5f65 6c65 6d77 6973 6528 6129  _for_elemwise(a)
+00027030: 2061 6e64 2061 2e6e 6469 6d20 3d3d 2030   and a.ndim == 0
+00027040: 2066 6f72 2061 2069 6e20 6172 6773 0a20   for a in args. 
+00027050: 2020 2020 2020 2029 0a0a 2020 2020 6966         )..    if
+00027060: 206e 6f74 206e 616d 653a 0a20 2020 2020   not name:.     
+00027070: 2020 206e 616d 6520 3d20 6622 7b66 756e     name = f"{fun
+00027080: 636e 616d 6528 6f70 297d 2d7b 746f 6b65  cname(op)}-{toke
+00027090: 6e69 7a65 286f 702c 2064 7479 7065 2c20  nize(op, dtype, 
+000270a0: 2a61 7267 732c 2077 6865 7265 297d 220a  *args, where)}".
+000270b0: 0a20 2020 2062 6c6f 636b 7769 7365 5f6b  .    blockwise_k
+000270c0: 7761 7267 7320 3d20 6469 6374 2864 7479  wargs = dict(dty
+000270d0: 7065 3d64 7479 7065 2c20 6e61 6d65 3d6e  pe=dtype, name=n
+000270e0: 616d 652c 2074 6f6b 656e 3d66 756e 636e  ame, token=funcn
+000270f0: 616d 6528 6f70 292e 7374 7269 7028 225f  ame(op).strip("_
+00027100: 2229 290a 0a20 2020 2069 6620 7768 6572  "))..    if wher
+00027110: 6520 6973 206e 6f74 2054 7275 653a 0a20  e is not True:. 
+00027120: 2020 2020 2020 2062 6c6f 636b 7769 7365         blockwise
+00027130: 5f6b 7761 7267 735b 2265 6c65 6d77 6973  _kwargs["elemwis
+00027140: 655f 7768 6572 655f 6675 6e63 7469 6f6e  e_where_function
+00027150: 225d 203d 206f 700a 2020 2020 2020 2020  "] = op.        
+00027160: 6f70 203d 205f 656c 656d 7769 7365 5f68  op = _elemwise_h
+00027170: 616e 646c 655f 7768 6572 650a 2020 2020  andle_where.    
+00027180: 2020 2020 6172 6773 2e65 7874 656e 6428      args.extend(
+00027190: 5b77 6865 7265 2c20 6f75 745d 290a 0a20  [where, out]).. 
+000271a0: 2020 2069 6620 6e65 6564 5f65 6e66 6f72     if need_enfor
+000271b0: 6365 5f64 7479 7065 3a0a 2020 2020 2020  ce_dtype:.      
+000271c0: 2020 626c 6f63 6b77 6973 655f 6b77 6172    blockwise_kwar
+000271d0: 6773 5b22 656e 666f 7263 655f 6474 7970  gs["enforce_dtyp
+000271e0: 6522 5d20 3d20 6474 7970 650a 2020 2020  e"] = dtype.    
+000271f0: 2020 2020 626c 6f63 6b77 6973 655f 6b77      blockwise_kw
+00027200: 6172 6773 5b22 656e 666f 7263 655f 6474  args["enforce_dt
+00027210: 7970 655f 6675 6e63 7469 6f6e 225d 203d  ype_function"] =
+00027220: 206f 700a 2020 2020 2020 2020 6f70 203d   op.        op =
+00027230: 205f 656e 666f 7263 655f 6474 7970 650a   _enforce_dtype.
+00027240: 0a20 2020 2072 6573 756c 7420 3d20 626c  .    result = bl
+00027250: 6f63 6b77 6973 6528 0a20 2020 2020 2020  ockwise(.       
+00027260: 206f 702c 0a20 2020 2020 2020 2065 7870   op,.        exp
+00027270: 725f 696e 6473 2c0a 2020 2020 2020 2020  r_inds,.        
+00027280: 2a63 6f6e 6361 7428 0a20 2020 2020 2020  *concat(.       
+00027290: 2020 2020 2028 612c 2074 7570 6c65 2872       (a, tuple(r
+000272a0: 616e 6765 2861 2e6e 6469 6d29 5b3a 3a2d  ange(a.ndim)[::-
+000272b0: 315d 2920 6966 206e 6f74 2069 735f 7363  1]) if not is_sc
+000272c0: 616c 6172 5f66 6f72 5f65 6c65 6d77 6973  alar_for_elemwis
+000272d0: 6528 6129 2065 6c73 6520 4e6f 6e65 290a  e(a) else None).
+000272e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000272f0: 6120 696e 2061 7267 730a 2020 2020 2020  a in args.      
+00027300: 2020 292c 0a20 2020 2020 2020 202a 2a62    ),.        **b
+00027310: 6c6f 636b 7769 7365 5f6b 7761 7267 732c  lockwise_kwargs,
+00027320: 0a20 2020 2029 0a0a 2020 2020 7265 7475  .    )..    retu
+00027330: 726e 2068 616e 646c 655f 6f75 7428 6f75  rn handle_out(ou
+00027340: 742c 2072 6573 756c 7429 0a0a 0a64 6566  t, result)...def
+00027350: 205f 656c 656d 7769 7365 5f6e 6f72 6d61   _elemwise_norma
+00027360: 6c69 7a65 5f77 6865 7265 2877 6865 7265  lize_where(where
+00027370: 293a 0a20 2020 2069 6620 7768 6572 6520  ):.    if where 
+00027380: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+00027390: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000273a0: 2065 6c69 6620 7768 6572 6520 6973 2046   elif where is F
+000273b0: 616c 7365 206f 7220 7768 6572 6520 6973  alse or where is
+000273c0: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
+000273d0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+000273e0: 7265 7475 726e 2061 7361 7272 6179 2877  return asarray(w
+000273f0: 6865 7265 290a 0a0a 6465 6620 5f65 6c65  here)...def _ele
+00027400: 6d77 6973 655f 6861 6e64 6c65 5f77 6865  mwise_handle_whe
+00027410: 7265 282a 6172 6773 2c20 2a2a 6b77 6172  re(*args, **kwar
+00027420: 6773 293a 0a20 2020 2066 756e 6374 696f  gs):.    functio
+00027430: 6e20 3d20 6b77 6172 6773 2e70 6f70 2822  n = kwargs.pop("
+00027440: 656c 656d 7769 7365 5f77 6865 7265 5f66  elemwise_where_f
+00027450: 756e 6374 696f 6e22 290a 2020 2020 2a61  unction").    *a
+00027460: 7267 732c 2077 6865 7265 2c20 6f75 7420  rgs, where, out 
+00027470: 3d20 6172 6773 0a20 2020 2069 6620 6861  = args.    if ha
+00027480: 7361 7474 7228 6f75 742c 2022 636f 7079  sattr(out, "copy
+00027490: 2229 3a0a 2020 2020 2020 2020 6f75 7420  "):.        out 
+000274a0: 3d20 6f75 742e 636f 7079 2829 0a20 2020  = out.copy().   
+000274b0: 2072 6574 7572 6e20 6675 6e63 7469 6f6e   return function
+000274c0: 282a 6172 6773 2c20 7768 6572 653d 7768  (*args, where=wh
+000274d0: 6572 652c 206f 7574 3d6f 7574 2c20 2a2a  ere, out=out, **
+000274e0: 6b77 6172 6773 290a 0a0a 6465 6620 5f65  kwargs)...def _e
+000274f0: 6c65 6d77 6973 655f 6e6f 726d 616c 697a  lemwise_normaliz
+00027500: 655f 6f75 7428 6f75 7429 3a0a 2020 2020  e_out(out):.    
+00027510: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
+00027520: 742c 2074 7570 6c65 293a 0a20 2020 2020  t, tuple):.     
+00027530: 2020 2069 6620 6c65 6e28 6f75 7429 203d     if len(out) =
+00027540: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00027550: 206f 7574 203d 206f 7574 5b30 5d0a 2020   out = out[0].  
+00027560: 2020 2020 2020 656c 6966 206c 656e 286f        elif len(o
+00027570: 7574 2920 3e20 313a 0a20 2020 2020 2020  ut) > 1:.       
+00027580: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+00027590: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
+000275a0: 5468 6520 6f75 7420 7061 7261 6d65 7465  The out paramete
+000275b0: 7220 6973 206e 6f74 2066 756c 6c79 2073  r is not fully s
+000275c0: 7570 706f 7274 6564 2229 0a20 2020 2020  upported").     
+000275d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000275e0: 2020 2020 206f 7574 203d 204e 6f6e 650a       out = None.
+000275f0: 2020 2020 6966 206e 6f74 2028 6f75 7420      if not (out 
+00027600: 6973 204e 6f6e 6520 6f72 2069 7369 6e73  is None or isins
+00027610: 7461 6e63 6528 6f75 742c 2041 7272 6179  tance(out, Array
+00027620: 2929 3a0a 2020 2020 2020 2020 7261 6973  )):.        rais
+00027630: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+00027640: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00027650: 2020 2066 2254 6865 206f 7574 2070 6172     f"The out par
+00027660: 616d 6574 6572 2069 7320 6e6f 7420 6675  ameter is not fu
+00027670: 6c6c 7920 7375 7070 6f72 7465 642e 220a  lly supported.".
+00027680: 2020 2020 2020 2020 2020 2020 6622 2052              f" R
+00027690: 6563 6569 7665 6420 7479 7065 207b 7479  eceived type {ty
+000276a0: 7065 286f 7574 292e 5f5f 6e61 6d65 5f5f  pe(out).__name__
+000276b0: 7d2c 2065 7870 6563 7465 6420 4461 736b  }, expected Dask
+000276c0: 2041 7272 6179 220a 2020 2020 2020 2020   Array".        
+000276d0: 290a 2020 2020 7265 7475 726e 206f 7574  ).    return out
+000276e0: 0a0a 0a64 6566 2068 616e 646c 655f 6f75  ...def handle_ou
+000276f0: 7428 6f75 742c 2072 6573 756c 7429 3a0a  t(out, result):.
+00027700: 2020 2020 2222 2248 616e 646c 6520 6f75      """Handle ou
+00027710: 7420 7061 7261 6d65 7465 7273 0a0a 2020  t parameters..  
+00027720: 2020 4966 206f 7574 2069 7320 6120 6461    If out is a da
+00027730: 736b 2e61 7272 6179 2074 6865 6e20 7468  sk.array then th
+00027740: 6973 206f 7665 7277 7269 7465 7320 7468  is overwrites th
+00027750: 6520 636f 6e74 656e 7473 206f 6620 7468  e contents of th
+00027760: 6174 2061 7272 6179 2077 6974 680a 2020  at array with.  
+00027770: 2020 7468 6520 7265 7375 6c74 0a20 2020    the result.   
+00027780: 2022 2222 0a20 2020 206f 7574 203d 205f   """.    out = _
+00027790: 656c 656d 7769 7365 5f6e 6f72 6d61 6c69  elemwise_normali
+000277a0: 7a65 5f6f 7574 286f 7574 290a 2020 2020  ze_out(out).    
+000277b0: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
+000277c0: 742c 2041 7272 6179 293a 0a20 2020 2020  t, Array):.     
+000277d0: 2020 2069 6620 6f75 742e 7368 6170 6520     if out.shape 
+000277e0: 213d 2072 6573 756c 742e 7368 6170 653a  != result.shape:
+000277f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00027800: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00027810: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00027820: 4d69 736d 6174 6368 6564 2073 6861 7065  Mismatched shape
+00027830: 7320 6265 7477 6565 6e20 7265 7375 6c74  s between result
+00027840: 2061 6e64 206f 7574 2070 6172 616d 6574   and out paramet
+00027850: 6572 2e20 220a 2020 2020 2020 2020 2020  er. ".          
+00027860: 2020 2020 2020 226f 7574 3d25 732c 2072        "out=%s, r
+00027870: 6573 756c 743d 2573 2220 2520 2873 7472  esult=%s" % (str
+00027880: 286f 7574 2e73 6861 7065 292c 2073 7472  (out.shape), str
+00027890: 2872 6573 756c 742e 7368 6170 6529 290a  (result.shape)).
+000278a0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000278b0: 2020 2020 2020 6f75 742e 5f63 6875 6e6b        out._chunk
+000278c0: 7320 3d20 7265 7375 6c74 2e63 6875 6e6b  s = result.chunk
+000278d0: 730a 2020 2020 2020 2020 6f75 742e 6461  s.        out.da
+000278e0: 736b 203d 2072 6573 756c 742e 6461 736b  sk = result.dask
+000278f0: 0a20 2020 2020 2020 206f 7574 2e5f 6d65  .        out._me
+00027900: 7461 203d 2072 6573 756c 742e 5f6d 6574  ta = result._met
+00027910: 610a 2020 2020 2020 2020 6f75 742e 5f6e  a.        out._n
+00027920: 616d 6520 3d20 7265 7375 6c74 2e6e 616d  ame = result.nam
+00027930: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00027940: 206f 7574 0a20 2020 2065 6c73 653a 0a20   out.    else:. 
+00027950: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00027960: 7375 6c74 0a0a 0a64 6566 205f 656e 666f  sult...def _enfo
+00027970: 7263 655f 6474 7970 6528 2a61 7267 732c  rce_dtype(*args,
+00027980: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00027990: 2222 2243 616c 6c73 2061 2066 756e 6374  """Calls a funct
+000279a0: 696f 6e20 616e 6420 636f 6e76 6572 7473  ion and converts
+000279b0: 2069 7473 2072 6573 756c 7420 746f 2074   its result to t
+000279c0: 6865 2067 6976 656e 2064 7479 7065 2e0a  he given dtype..
+000279d0: 0a20 2020 2054 6865 2070 6172 616d 6574  .    The paramet
+000279e0: 6572 7320 6861 7665 2064 656c 6962 6572  ers have deliber
+000279f0: 6174 656c 7920 6265 656e 2067 6976 656e  ately been given
+00027a00: 2075 6e77 6965 6c64 7920 6e61 6d65 7320   unwieldy names 
+00027a10: 746f 2061 766f 6964 0a20 2020 2063 6c61  to avoid.    cla
+00027a20: 7368 6573 2077 6974 6820 6b65 7977 6f72  shes with keywor
+00027a30: 6420 6172 6775 6d65 6e74 7320 636f 6e73  d arguments cons
+00027a40: 756d 6564 2062 7920 626c 6f63 6b77 6973  umed by blockwis
+00027a50: 650a 0a20 2020 2041 2064 7479 7065 206f  e..    A dtype o
+00027a60: 6620 606f 626a 6563 7460 2069 7320 7472  f `object` is tr
+00027a70: 6561 7465 6420 6173 2061 2073 7065 6369  eated as a speci
+00027a80: 616c 2063 6173 6520 616e 6420 6e6f 7420  al case and not 
+00027a90: 656e 666f 7263 6564 2c0a 2020 2020 6265  enforced,.    be
+00027aa0: 6361 7573 6520 6974 2069 7320 7573 6564  cause it is used
+00027ab0: 2061 7320 6120 6475 6d6d 7920 7661 6c75   as a dummy valu
+00027ac0: 6520 696e 2073 6f6d 6520 706c 6163 6573  e in some places
+00027ad0: 2077 6865 6e20 7468 6520 7265 7375 6c74   when the result
+00027ae0: 2077 696c 6c0a 2020 2020 6e6f 7420 6265   will.    not be
+00027af0: 2061 2062 6c6f 636b 2069 6e20 616e 2041   a block in an A
+00027b00: 7272 6179 2e0a 0a20 2020 2050 6172 616d  rray...    Param
+00027b10: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00027b20: 2d2d 2d2d 0a20 2020 2065 6e66 6f72 6365  ----.    enforce
+00027b30: 5f64 7479 7065 203a 2064 7479 7065 0a20  _dtype : dtype. 
+00027b40: 2020 2020 2020 2052 6573 756c 7420 6474         Result dt
+00027b50: 7970 650a 2020 2020 656e 666f 7263 655f  ype.    enforce_
+00027b60: 6474 7970 655f 6675 6e63 7469 6f6e 203a  dtype_function :
+00027b70: 2063 616c 6c61 626c 650a 2020 2020 2020   callable.      
+00027b80: 2020 5468 6520 7772 6170 7065 6420 6675    The wrapped fu
+00027b90: 6e63 7469 6f6e 2c20 7768 6963 6820 7769  nction, which wi
+00027ba0: 6c6c 2062 6520 7061 7373 6564 2074 6865  ll be passed the
+00027bb0: 2072 656d 6169 6e69 6e67 2061 7267 756d   remaining argum
+00027bc0: 656e 7473 0a20 2020 2022 2222 0a20 2020  ents.    """.   
+00027bd0: 2064 7479 7065 203d 206b 7761 7267 732e   dtype = kwargs.
+00027be0: 706f 7028 2265 6e66 6f72 6365 5f64 7479  pop("enforce_dty
+00027bf0: 7065 2229 0a20 2020 2066 756e 6374 696f  pe").    functio
+00027c00: 6e20 3d20 6b77 6172 6773 2e70 6f70 2822  n = kwargs.pop("
+00027c10: 656e 666f 7263 655f 6474 7970 655f 6675  enforce_dtype_fu
+00027c20: 6e63 7469 6f6e 2229 0a0a 2020 2020 7265  nction")..    re
+00027c30: 7375 6c74 203d 2066 756e 6374 696f 6e28  sult = function(
+00027c40: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00027c50: 0a20 2020 2069 6620 6861 7361 7474 7228  .    if hasattr(
+00027c60: 7265 7375 6c74 2c20 2264 7479 7065 2229  result, "dtype")
+00027c70: 2061 6e64 2064 7479 7065 2021 3d20 7265   and dtype != re
+00027c80: 7375 6c74 2e64 7479 7065 2061 6e64 2064  sult.dtype and d
+00027c90: 7479 7065 2021 3d20 6f62 6a65 6374 3a0a  type != object:.
+00027ca0: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
+00027cb0: 702e 6361 6e5f 6361 7374 2872 6573 756c  p.can_cast(resul
+00027cc0: 742c 2064 7479 7065 2c20 6361 7374 696e  t, dtype, castin
+00027cd0: 673d 2273 616d 655f 6b69 6e64 2229 3a0a  g="same_kind"):.
+00027ce0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00027cf0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00027d00: 2020 2020 2020 2020 2020 2020 2020 2249                "I
+00027d10: 6e66 6572 7265 6420 6474 7970 6520 6672  nferred dtype fr
+00027d20: 6f6d 2066 756e 6374 696f 6e20 2572 2077  om function %r w
+00027d30: 6173 2025 7220 220a 2020 2020 2020 2020  as %r ".        
+00027d40: 2020 2020 2020 2020 2262 7574 2067 6f74          "but got
+00027d50: 2025 722c 2077 6869 6368 2063 616e 2774   %r, which can't
+00027d60: 2062 6520 6361 7374 2075 7369 6e67 2022   be cast using "
+00027d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027d80: 2022 6361 7374 696e 673d 2773 616d 655f   "casting='same_
+00027d90: 6b69 6e64 2722 0a20 2020 2020 2020 2020  kind'".         
+00027da0: 2020 2020 2020 2025 2028 6675 6e63 6e61         % (funcna
+00027db0: 6d65 2866 756e 6374 696f 6e29 2c20 7374  me(function), st
+00027dc0: 7228 6474 7970 6529 2c20 7374 7228 7265  r(dtype), str(re
+00027dd0: 7375 6c74 2e64 7479 7065 2929 0a20 2020  sult.dtype)).   
+00027de0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00027df0: 2020 2069 6620 6e70 2e69 7373 6361 6c61     if np.isscala
+00027e00: 7228 7265 7375 6c74 293a 0a20 2020 2020  r(result):.     
+00027e10: 2020 2020 2020 2023 2073 6361 6c61 7220         # scalar 
+00027e20: 6173 7479 7065 206d 6574 686f 6420 646f  astype method do
+00027e30: 6573 6e27 7420 7461 6b65 2074 6865 206b  esn't take the k
+00027e40: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00027e50: 2c20 736f 0a20 2020 2020 2020 2020 2020  , so.           
+00027e60: 2023 2068 6176 6520 746f 2063 6f6e 7665   # have to conve
+00027e70: 7274 2076 6961 2030 2d64 696d 656e 7369  rt via 0-dimensi
+00027e80: 6f6e 616c 2061 7272 6179 2061 6e64 2062  onal array and b
+00027e90: 6163 6b2e 0a20 2020 2020 2020 2020 2020  ack..           
+00027ea0: 2072 6573 756c 7420 3d20 7265 7375 6c74   result = result
+00027eb0: 2e61 7374 7970 6528 6474 7970 6529 0a20  .astype(dtype). 
+00027ec0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00027ed0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00027ee0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00027ef0: 7375 6c74 203d 2072 6573 756c 742e 6173  sult = result.as
+00027f00: 7479 7065 2864 7479 7065 2c20 636f 7079  type(dtype, copy
+00027f10: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00027f20: 2020 2020 6578 6365 7074 2054 7970 6545      except TypeE
+00027f30: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00027f40: 2020 2020 2020 2320 4d69 7373 696e 6720        # Missing 
+00027f50: 636f 7079 206b 7761 7267 0a20 2020 2020  copy kwarg.     
+00027f60: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00027f70: 7420 3d20 7265 7375 6c74 2e61 7374 7970  t = result.astyp
+00027f80: 6528 6474 7970 6529 0a20 2020 2072 6574  e(dtype).    ret
+00027f90: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+00027fa0: 2062 726f 6164 6361 7374 5f74 6f28 782c   broadcast_to(x,
+00027fb0: 2073 6861 7065 2c20 6368 756e 6b73 3d4e   shape, chunks=N
+00027fc0: 6f6e 652c 206d 6574 613d 4e6f 6e65 293a  one, meta=None):
+00027fd0: 0a20 2020 2022 2222 4272 6f61 6463 6173  .    """Broadcas
+00027fe0: 7420 616e 2061 7272 6179 2074 6f20 6120  t an array to a 
+00027ff0: 6e65 7720 7368 6170 652e 0a0a 2020 2020  new shape...    
+00028000: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+00028010: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7820  ---------.    x 
+00028020: 3a20 6172 7261 795f 6c69 6b65 0a20 2020  : array_like.   
+00028030: 2020 2020 2054 6865 2061 7272 6179 2074       The array t
+00028040: 6f20 6272 6f61 6463 6173 742e 0a20 2020  o broadcast..   
+00028050: 2073 6861 7065 203a 2074 7570 6c65 0a20   shape : tuple. 
+00028060: 2020 2020 2020 2054 6865 2073 6861 7065         The shape
+00028070: 206f 6620 7468 6520 6465 7369 7265 6420   of the desired 
+00028080: 6172 7261 792e 0a20 2020 2063 6875 6e6b  array..    chunk
+00028090: 7320 3a20 7475 706c 652c 206f 7074 696f  s : tuple, optio
+000280a0: 6e61 6c0a 2020 2020 2020 2020 4966 2070  nal.        If p
+000280b0: 726f 7669 6465 642c 2074 6865 6e20 7468  rovided, then th
+000280c0: 6520 7265 7375 6c74 2077 696c 6c20 7573  e result will us
+000280d0: 6520 7468 6573 6520 6368 756e 6b73 2069  e these chunks i
+000280e0: 6e73 7465 6164 206f 6620 7468 6520 7361  nstead of the sa
+000280f0: 6d65 0a20 2020 2020 2020 2063 6875 6e6b  me.        chunk
+00028100: 7320 6173 2074 6865 2073 6f75 7263 6520  s as the source 
+00028110: 6172 7261 792e 2053 6574 7469 6e67 2063  array. Setting c
+00028120: 6875 6e6b 7320 6578 706c 6963 6974 6c79  hunks explicitly
+00028130: 2061 7320 7061 7274 206f 660a 2020 2020   as part of.    
+00028140: 2020 2020 6272 6f61 6463 6173 745f 746f      broadcast_to
+00028150: 2069 7320 6d6f 7265 2065 6666 6963 6965   is more efficie
+00028160: 6e74 2074 6861 6e20 7265 6368 756e 6b69  nt than rechunki
+00028170: 6e67 2061 6674 6572 7761 7264 732e 2043  ng afterwards. C
+00028180: 6875 6e6b 7320 6172 650a 2020 2020 2020  hunks are.      
+00028190: 2020 6f6e 6c79 2061 6c6c 6f77 6564 2074    only allowed t
+000281a0: 6f20 6469 6666 6572 2066 726f 6d20 7468  o differ from th
+000281b0: 6520 6f72 6967 696e 616c 2073 6861 7065  e original shape
+000281c0: 2061 6c6f 6e67 2064 696d 656e 7369 6f6e   along dimension
+000281d0: 7320 7468 6174 0a20 2020 2020 2020 2061  s that.        a
+000281e0: 7265 206e 6577 206f 6e20 7468 6520 7265  re new on the re
+000281f0: 7375 6c74 206f 7220 6861 7665 2073 697a  sult or have siz
+00028200: 6520 3120 7468 6520 696e 7075 7420 6172  e 1 the input ar
+00028210: 7261 792e 0a20 2020 206d 6574 6120 3a20  ray..    meta : 
+00028220: 656d 7074 7920 6e64 6172 7261 790a 2020  empty ndarray.  
+00028230: 2020 2020 2020 656d 7074 7920 6e64 6172        empty ndar
+00028240: 7261 7920 6372 6561 7465 6420 7769 7468  ray created with
+00028250: 2073 616d 6520 4e75 6d50 7920 6261 636b   same NumPy back
+00028260: 656e 642c 206e 6469 6d20 616e 6420 6474  end, ndim and dt
+00028270: 7970 6520 6173 2074 6865 0a20 2020 2020  ype as the.     
+00028280: 2020 2044 6173 6b20 4172 7261 7920 6265     Dask Array be
+00028290: 696e 6720 6372 6561 7465 6420 286f 7665  ing created (ove
+000282a0: 7272 6964 6573 2064 7479 7065 290a 0a20  rrides dtype).. 
+000282b0: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
+000282c0: 2d2d 2d2d 2d2d 0a20 2020 2062 726f 6164  ------.    broad
+000282d0: 6361 7374 203a 2064 6173 6b20 6172 7261  cast : dask arra
+000282e0: 790a 0a20 2020 2053 6565 2041 6c73 6f0a  y..    See Also.
+000282f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00028300: 203a 6675 6e63 3a60 6e75 6d70 792e 6272   :func:`numpy.br
+00028310: 6f61 6463 6173 745f 746f 600a 2020 2020  oadcast_to`.    
+00028320: 2222 220a 2020 2020 7820 3d20 6173 6172  """.    x = asar
+00028330: 7261 7928 7829 0a20 2020 2073 6861 7065  ray(x).    shape
+00028340: 203d 2074 7570 6c65 2873 6861 7065 290a   = tuple(shape).
+00028350: 0a20 2020 2069 6620 6d65 7461 2069 7320  .    if meta is 
+00028360: 4e6f 6e65 3a0a 2020 2020 2020 2020 6d65  None:.        me
+00028370: 7461 203d 206d 6574 615f 6672 6f6d 5f61  ta = meta_from_a
+00028380: 7272 6179 2878 290a 0a20 2020 2069 6620  rray(x)..    if 
+00028390: 782e 7368 6170 6520 3d3d 2073 6861 7065  x.shape == shape
+000283a0: 2061 6e64 2028 6368 756e 6b73 2069 7320   and (chunks is 
+000283b0: 4e6f 6e65 206f 7220 6368 756e 6b73 203d  None or chunks =
+000283c0: 3d20 782e 6368 756e 6b73 293a 0a20 2020  = x.chunks):.   
+000283d0: 2020 2020 2072 6574 7572 6e20 780a 0a20       return x.. 
+000283e0: 2020 206e 6469 6d5f 6e65 7720 3d20 6c65     ndim_new = le
+000283f0: 6e28 7368 6170 6529 202d 2078 2e6e 6469  n(shape) - x.ndi
+00028400: 6d0a 2020 2020 6966 206e 6469 6d5f 6e65  m.    if ndim_ne
+00028410: 7720 3c20 3020 6f72 2061 6e79 280a 2020  w < 0 or any(.  
+00028420: 2020 2020 2020 6e65 7720 213d 206f 6c64        new != old
+00028430: 2066 6f72 206e 6577 2c20 6f6c 6420 696e   for new, old in
+00028440: 207a 6970 2873 6861 7065 5b6e 6469 6d5f   zip(shape[ndim_
+00028450: 6e65 773a 5d2c 2078 2e73 6861 7065 2920  new:], x.shape) 
+00028460: 6966 206f 6c64 2021 3d20 310a 2020 2020  if old != 1.    
+00028470: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+00028480: 2056 616c 7565 4572 726f 7228 6622 6361   ValueError(f"ca
+00028490: 6e6e 6f74 2062 726f 6164 6361 7374 2073  nnot broadcast s
+000284a0: 6861 7065 207b 782e 7368 6170 657d 2074  hape {x.shape} t
+000284b0: 6f20 7368 6170 6520 7b73 6861 7065 7d22  o shape {shape}"
+000284c0: 290a 0a20 2020 2069 6620 6368 756e 6b73  )..    if chunks
+000284d0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000284e0: 2020 6368 756e 6b73 203d 2074 7570 6c65    chunks = tuple
+000284f0: 2828 732c 2920 666f 7220 7320 696e 2073  ((s,) for s in s
+00028500: 6861 7065 5b3a 6e64 696d 5f6e 6577 5d29  hape[:ndim_new])
+00028510: 202b 2074 7570 6c65 280a 2020 2020 2020   + tuple(.      
+00028520: 2020 2020 2020 6264 2069 6620 6f6c 6420        bd if old 
+00028530: 3e20 3120 656c 7365 2028 6e65 772c 290a  > 1 else (new,).
+00028540: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00028550: 6264 2c20 6f6c 642c 206e 6577 2069 6e20  bd, old, new in 
+00028560: 7a69 7028 782e 6368 756e 6b73 2c20 782e  zip(x.chunks, x.
+00028570: 7368 6170 652c 2073 6861 7065 5b6e 6469  shape, shape[ndi
+00028580: 6d5f 6e65 773a 5d29 0a20 2020 2020 2020  m_new:]).       
+00028590: 2029 0a20 2020 2065 6c73 653a 0a20 2020   ).    else:.   
+000285a0: 2020 2020 2063 6875 6e6b 7320 3d20 6e6f       chunks = no
+000285b0: 726d 616c 697a 655f 6368 756e 6b73 280a  rmalize_chunks(.
+000285c0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+000285d0: 6b73 2c20 7368 6170 652c 2064 7479 7065  ks, shape, dtype
+000285e0: 3d78 2e64 7479 7065 2c20 7072 6576 696f  =x.dtype, previo
+000285f0: 7573 5f63 6875 6e6b 733d 782e 6368 756e  us_chunks=x.chun
+00028600: 6b73 0a20 2020 2020 2020 2029 0a20 2020  ks.        ).   
+00028610: 2020 2020 2066 6f72 206f 6c64 5f62 642c       for old_bd,
+00028620: 206e 6577 5f62 6420 696e 207a 6970 2878   new_bd in zip(x
+00028630: 2e63 6875 6e6b 732c 2063 6875 6e6b 735b  .chunks, chunks[
+00028640: 6e64 696d 5f6e 6577 3a5d 293a 0a20 2020  ndim_new:]):.   
+00028650: 2020 2020 2020 2020 2069 6620 6f6c 645f           if old_
+00028660: 6264 2021 3d20 6e65 775f 6264 2061 6e64  bd != new_bd and
+00028670: 206f 6c64 5f62 6420 213d 2028 312c 293a   old_bd != (1,):
+00028680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028690: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000286a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+000286b0: 2020 2020 2020 2022 6361 6e6e 6f74 2062         "cannot b
+000286c0: 726f 6164 6361 7374 2063 6875 6e6b 7320  roadcast chunks 
+000286d0: 2573 2074 6f20 6368 756e 6b73 2025 733a  %s to chunks %s:
+000286e0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+000286f0: 2020 2020 2020 2022 6e65 7720 6368 756e         "new chun
+00028700: 6b73 206d 7573 7420 6569 7468 6572 2062  ks must either b
+00028710: 6520 616c 6f6e 6720 6120 6e65 7720 220a  e along a new ".
+00028720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028730: 2020 2020 2264 696d 656e 7369 6f6e 206f      "dimension o
+00028740: 7220 6120 6469 6d65 6e73 696f 6e20 6f66  r a dimension of
+00028750: 2073 697a 6520 3122 2025 2028 782e 6368   size 1" % (x.ch
+00028760: 756e 6b73 2c20 6368 756e 6b73 290a 2020  unks, chunks).  
+00028770: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00028780: 0a20 2020 206e 616d 6520 3d20 2262 726f  .    name = "bro
+00028790: 6164 6361 7374 5f74 6f2d 2220 2b20 746f  adcast_to-" + to
+000287a0: 6b65 6e69 7a65 2878 2c20 7368 6170 652c  kenize(x, shape,
+000287b0: 2063 6875 6e6b 7329 0a20 2020 2064 736b   chunks).    dsk
+000287c0: 203d 207b 7d0a 0a20 2020 2065 6e75 6d65   = {}..    enume
+000287d0: 7261 7465 645f 6368 756e 6b73 203d 2070  rated_chunks = p
+000287e0: 726f 6475 6374 282a 2865 6e75 6d65 7261  roduct(*(enumera
+000287f0: 7465 2862 6473 2920 666f 7220 6264 7320  te(bds) for bds 
+00028800: 696e 2063 6875 6e6b 7329 290a 2020 2020  in chunks)).    
+00028810: 666f 7220 6e65 775f 696e 6465 782c 2063  for new_index, c
+00028820: 6875 6e6b 5f73 6861 7065 2069 6e20 287a  hunk_shape in (z
+00028830: 6970 282a 6563 2920 666f 7220 6563 2069  ip(*ec) for ec i
+00028840: 6e20 656e 756d 6572 6174 6564 5f63 6875  n enumerated_chu
+00028850: 6e6b 7329 3a0a 2020 2020 2020 2020 6f6c  nks):.        ol
+00028860: 645f 696e 6465 7820 3d20 7475 706c 6528  d_index = tuple(
+00028870: 0a20 2020 2020 2020 2020 2020 2030 2069  .            0 i
+00028880: 6620 6264 203d 3d20 2831 2c29 2065 6c73  f bd == (1,) els
+00028890: 6520 6920 666f 7220 6264 2c20 6920 696e  e i for bd, i in
+000288a0: 207a 6970 2878 2e63 6875 6e6b 732c 206e   zip(x.chunks, n
+000288b0: 6577 5f69 6e64 6578 5b6e 6469 6d5f 6e65  ew_index[ndim_ne
+000288c0: 773a 5d29 0a20 2020 2020 2020 2029 0a20  w:]).        ). 
+000288d0: 2020 2020 2020 206f 6c64 5f6b 6579 203d         old_key =
+000288e0: 2028 782e 6e61 6d65 2c29 202b 206f 6c64   (x.name,) + old
+000288f0: 5f69 6e64 6578 0a20 2020 2020 2020 206e  _index.        n
+00028900: 6577 5f6b 6579 203d 2028 6e61 6d65 2c29  ew_key = (name,)
+00028910: 202b 206e 6577 5f69 6e64 6578 0a20 2020   + new_index.   
+00028920: 2020 2020 2064 736b 5b6e 6577 5f6b 6579       dsk[new_key
+00028930: 5d20 3d20 286e 702e 6272 6f61 6463 6173  ] = (np.broadcas
+00028940: 745f 746f 2c20 6f6c 645f 6b65 792c 2071  t_to, old_key, q
+00028950: 756f 7465 2863 6875 6e6b 5f73 6861 7065  uote(chunk_shape
+00028960: 2929 0a0a 2020 2020 6772 6170 6820 3d20  ))..    graph = 
+00028970: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+00028980: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+00028990: 6e61 6d65 2c20 6473 6b2c 2064 6570 656e  name, dsk, depen
+000289a0: 6465 6e63 6965 733d 5b78 5d29 0a20 2020  dencies=[x]).   
+000289b0: 2072 6574 7572 6e20 4172 7261 7928 6772   return Array(gr
+000289c0: 6170 682c 206e 616d 652c 2063 6875 6e6b  aph, name, chunk
+000289d0: 732c 2064 7479 7065 3d78 2e64 7479 7065  s, dtype=x.dtype
+000289e0: 2c20 6d65 7461 3d6d 6574 6129 0a0a 0a40  , meta=meta)...@
+000289f0: 6465 7269 7665 645f 6672 6f6d 286e 7029  derived_from(np)
+00028a00: 0a64 6566 2062 726f 6164 6361 7374 5f61  .def broadcast_a
+00028a10: 7272 6179 7328 2a61 7267 732c 2073 7562  rrays(*args, sub
+00028a20: 6f6b 3d46 616c 7365 293a 0a20 2020 2073  ok=False):.    s
+00028a30: 7562 6f6b 203d 2062 6f6f 6c28 7375 626f  ubok = bool(subo
+00028a40: 6b29 0a0a 2020 2020 746f 5f61 7272 6179  k)..    to_array
+00028a50: 203d 2061 7361 6e79 6172 7261 7920 6966   = asanyarray if
+00028a60: 2073 7562 6f6b 2065 6c73 6520 6173 6172   subok else asar
+00028a70: 7261 790a 2020 2020 6172 6773 203d 2074  ray.    args = t
+00028a80: 7570 6c65 2874 6f5f 6172 7261 7928 6529  uple(to_array(e)
+00028a90: 2066 6f72 2065 2069 6e20 6172 6773 290a   for e in args).
+00028aa0: 0a20 2020 2023 2055 6e69 6679 2075 6e65  .    # Unify une
+00028ab0: 7665 6e20 6368 756e 6b69 6e67 0a20 2020  ven chunking.   
+00028ac0: 2069 6e64 7320 3d20 5b6c 6973 7428 7265   inds = [list(re
+00028ad0: 7665 7273 6564 2872 616e 6765 2878 2e6e  versed(range(x.n
+00028ae0: 6469 6d29 2929 2066 6f72 2078 2069 6e20  dim))) for x in 
+00028af0: 6172 6773 5d0a 2020 2020 7563 5f61 7267  args].    uc_arg
+00028b00: 7320 3d20 636f 6e63 6174 287a 6970 2861  s = concat(zip(a
+00028b10: 7267 732c 2069 6e64 7329 290a 2020 2020  rgs, inds)).    
+00028b20: 5f2c 2061 7267 7320 3d20 756e 6966 795f  _, args = unify_
+00028b30: 6368 756e 6b73 282a 7563 5f61 7267 732c  chunks(*uc_args,
+00028b40: 2077 6172 6e3d 4661 6c73 6529 0a0a 2020   warn=False)..  
+00028b50: 2020 7368 6170 6520 3d20 6272 6f61 6463    shape = broadc
+00028b60: 6173 745f 7368 6170 6573 282a 2865 2e73  ast_shapes(*(e.s
+00028b70: 6861 7065 2066 6f72 2065 2069 6e20 6172  hape for e in ar
+00028b80: 6773 2929 0a20 2020 2063 6875 6e6b 7320  gs)).    chunks 
+00028b90: 3d20 6272 6f61 6463 6173 745f 6368 756e  = broadcast_chun
+00028ba0: 6b73 282a 2865 2e63 6875 6e6b 7320 666f  ks(*(e.chunks fo
+00028bb0: 7220 6520 696e 2061 7267 7329 290a 0a20  r e in args)).. 
+00028bc0: 2020 2072 6573 756c 7420 3d20 5b62 726f     result = [bro
+00028bd0: 6164 6361 7374 5f74 6f28 652c 2073 6861  adcast_to(e, sha
+00028be0: 7065 3d73 6861 7065 2c20 6368 756e 6b73  pe=shape, chunks
+00028bf0: 3d63 6875 6e6b 7329 2066 6f72 2065 2069  =chunks) for e i
+00028c00: 6e20 6172 6773 5d0a 0a20 2020 2072 6574  n args]..    ret
+00028c10: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+00028c20: 206f 6666 7365 745f 6675 6e63 2866 756e   offset_func(fun
+00028c30: 632c 206f 6666 7365 742c 202a 6172 6773  c, offset, *args
+00028c40: 293a 0a20 2020 2022 2222 4f66 6673 6574  ):.    """Offset
+00028c50: 7320 696e 7075 7473 2062 7920 6f66 6673  s inputs by offs
+00028c60: 6574 0a0a 2020 2020 3e3e 3e20 646f 7562  et..    >>> doub
+00028c70: 6c65 203d 206c 616d 6264 6120 783a 2078  le = lambda x: x
+00028c80: 202a 2032 0a20 2020 203e 3e3e 2066 203d   * 2.    >>> f =
+00028c90: 206f 6666 7365 745f 6675 6e63 2864 6f75   offset_func(dou
+00028ca0: 626c 652c 2028 3130 2c29 290a 2020 2020  ble, (10,)).    
+00028cb0: 3e3e 3e20 6628 3129 0a20 2020 2032 320a  >>> f(1).    22.
+00028cc0: 2020 2020 3e3e 3e20 6628 3330 3029 0a20      >>> f(300). 
+00028cd0: 2020 2036 3230 0a20 2020 2022 2222 0a0a     620.    """..
+00028ce0: 2020 2020 6465 6620 5f6f 6666 7365 7428      def _offset(
+00028cf0: 2a61 7267 7329 3a0a 2020 2020 2020 2020  *args):.        
+00028d00: 6172 6773 3220 3d20 6c69 7374 286d 6170  args2 = list(map
+00028d10: 2861 6464 2c20 6172 6773 2c20 6f66 6673  (add, args, offs
+00028d20: 6574 2929 0a20 2020 2020 2020 2072 6574  et)).        ret
+00028d30: 7572 6e20 6675 6e63 282a 6172 6773 3229  urn func(*args2)
+00028d40: 0a0a 2020 2020 7769 7468 2063 6f6e 7465  ..    with conte
+00028d50: 7874 6c69 622e 7375 7070 7265 7373 2845  xtlib.suppress(E
+00028d60: 7863 6570 7469 6f6e 293a 0a20 2020 2020  xception):.     
+00028d70: 2020 205f 6f66 6673 6574 2e5f 5f6e 616d     _offset.__nam
+00028d80: 655f 5f20 3d20 226f 6666 7365 745f 2220  e__ = "offset_" 
+00028d90: 2b20 6675 6e63 2e5f 5f6e 616d 655f 5f0a  + func.__name__.
+00028da0: 0a20 2020 2072 6574 7572 6e20 5f6f 6666  .    return _off
+00028db0: 7365 740a 0a0a 6465 6620 6368 756e 6b73  set...def chunks
+00028dc0: 5f66 726f 6d5f 6172 7261 7973 2861 7272  _from_arrays(arr
+00028dd0: 6179 7329 3a0a 2020 2020 2222 2243 6875  ays):.    """Chu
+00028de0: 6e6b 7320 7475 706c 6520 6672 6f6d 206e  nks tuple from n
+00028df0: 6573 7465 6420 6c69 7374 206f 6620 6172  ested list of ar
+00028e00: 7261 7973 0a0a 2020 2020 3e3e 3e20 7820  rays..    >>> x 
+00028e10: 3d20 6e70 2e61 7272 6179 285b 312c 2032  = np.array([1, 2
+00028e20: 5d29 0a20 2020 203e 3e3e 2063 6875 6e6b  ]).    >>> chunk
+00028e30: 735f 6672 6f6d 5f61 7272 6179 7328 5b78  s_from_arrays([x
+00028e40: 2c20 785d 290a 2020 2020 2828 322c 2032  , x]).    ((2, 2
+00028e50: 292c 290a 0a20 2020 203e 3e3e 2078 203d  ),)..    >>> x =
+00028e60: 206e 702e 6172 7261 7928 5b5b 312c 2032   np.array([[1, 2
+00028e70: 5d5d 290a 2020 2020 3e3e 3e20 6368 756e  ]]).    >>> chun
+00028e80: 6b73 5f66 726f 6d5f 6172 7261 7973 285b  ks_from_arrays([
+00028e90: 5b78 5d2c 205b 785d 5d29 0a20 2020 2028  [x], [x]]).    (
+00028ea0: 2831 2c20 3129 2c20 2832 2c29 290a 0a20  (1, 1), (2,)).. 
+00028eb0: 2020 203e 3e3e 2078 203d 206e 702e 6172     >>> x = np.ar
+00028ec0: 7261 7928 5b5b 312c 2032 5d5d 290a 2020  ray([[1, 2]]).  
+00028ed0: 2020 3e3e 3e20 6368 756e 6b73 5f66 726f    >>> chunks_fro
+00028ee0: 6d5f 6172 7261 7973 285b 5b78 2c20 785d  m_arrays([[x, x]
+00028ef0: 5d29 0a20 2020 2028 2831 2c29 2c20 2832  ]).    ((1,), (2
+00028f00: 2c20 3229 290a 0a20 2020 203e 3e3e 2063  , 2))..    >>> c
+00028f10: 6875 6e6b 735f 6672 6f6d 5f61 7272 6179  hunks_from_array
+00028f20: 7328 5b31 2c20 315d 290a 2020 2020 2828  s([1, 1]).    ((
+00028f30: 312c 2031 292c 290a 2020 2020 2222 220a  1, 1),).    """.
+00028f40: 2020 2020 6966 206e 6f74 2061 7272 6179      if not array
+00028f50: 733a 0a20 2020 2020 2020 2072 6574 7572  s:.        retur
+00028f60: 6e20 2829 0a20 2020 2072 6573 756c 7420  n ().    result 
+00028f70: 3d20 5b5d 0a20 2020 2064 696d 203d 2030  = [].    dim = 0
+00028f80: 0a0a 2020 2020 6465 6620 7368 6170 6528  ..    def shape(
+00028f90: 7829 3a0a 2020 2020 2020 2020 7472 793a  x):.        try:
+00028fa0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00028fb0: 7572 6e20 782e 7368 6170 6520 6966 2078  urn x.shape if x
+00028fc0: 2e73 6861 7065 2065 6c73 6520 2831 2c29  .shape else (1,)
+00028fd0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00028fe0: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+00028ff0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00029000: 726e 2028 312c 290a 0a20 2020 2077 6869  rn (1,)..    whi
+00029010: 6c65 2069 7369 6e73 7461 6e63 6528 6172  le isinstance(ar
+00029020: 7261 7973 2c20 286c 6973 742c 2074 7570  rays, (list, tup
+00029030: 6c65 2929 3a0a 2020 2020 2020 2020 7265  le)):.        re
+00029040: 7375 6c74 2e61 7070 656e 6428 7475 706c  sult.append(tupl
+00029050: 6528 7368 6170 6528 6465 6570 6669 7273  e(shape(deepfirs
+00029060: 7428 6129 295b 6469 6d5d 2066 6f72 2061  t(a))[dim] for a
+00029070: 2069 6e20 6172 7261 7973 2929 0a20 2020   in arrays)).   
+00029080: 2020 2020 2061 7272 6179 7320 3d20 6172       arrays = ar
+00029090: 7261 7973 5b30 5d0a 2020 2020 2020 2020  rays[0].        
+000290a0: 6469 6d20 2b3d 2031 0a20 2020 2072 6574  dim += 1.    ret
+000290b0: 7572 6e20 7475 706c 6528 7265 7375 6c74  urn tuple(result
+000290c0: 290a 0a0a 6465 6620 6465 6570 6669 7273  )...def deepfirs
+000290d0: 7428 7365 7129 3a0a 2020 2020 2222 2246  t(seq):.    """F
+000290e0: 6972 7374 2065 6c65 6d65 6e74 2069 6e20  irst element in 
+000290f0: 6120 6e65 7374 6564 206c 6973 740a 0a20  a nested list.. 
+00029100: 2020 203e 3e3e 2064 6565 7066 6972 7374     >>> deepfirst
+00029110: 285b 5b5b 312c 2032 5d2c 205b 332c 2034  ([[[1, 2], [3, 4
+00029120: 5d5d 2c20 5b35 2c20 365d 2c20 5b37 2c20  ]], [5, 6], [7, 
+00029130: 385d 5d29 0a20 2020 2031 0a20 2020 2022  8]]).    1.    "
+00029140: 2222 0a20 2020 2069 6620 6e6f 7420 6973  "".    if not is
+00029150: 696e 7374 616e 6365 2873 6571 2c20 286c  instance(seq, (l
+00029160: 6973 742c 2074 7570 6c65 2929 3a0a 2020  ist, tuple)):.  
+00029170: 2020 2020 2020 7265 7475 726e 2073 6571        return seq
+00029180: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00029190: 2020 2072 6574 7572 6e20 6465 6570 6669     return deepfi
+000291a0: 7273 7428 7365 715b 305d 290a 0a0a 6465  rst(seq[0])...de
+000291b0: 6620 7368 6170 656c 6973 7428 6129 3a0a  f shapelist(a):.
+000291c0: 2020 2020 2222 2247 6574 2074 6865 2073      """Get the s
+000291d0: 6861 7065 206f 6620 6e65 7374 6564 206c  hape of nested l
+000291e0: 6973 7422 2222 0a20 2020 2069 6620 7479  ist""".    if ty
+000291f0: 7065 2861 2920 6973 206c 6973 743a 0a20  pe(a) is list:. 
+00029200: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
+00029210: 706c 6528 5b6c 656e 2861 295d 202b 206c  ple([len(a)] + l
+00029220: 6973 7428 7368 6170 656c 6973 7428 615b  ist(shapelist(a[
+00029230: 305d 2929 290a 2020 2020 656c 7365 3a0a  0]))).    else:.
+00029240: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00029250: 290a 0a0a 6465 6620 7472 616e 7370 6f73  )...def transpos
+00029260: 656c 6973 7428 6172 7261 7973 2c20 6178  elist(arrays, ax
+00029270: 6573 2c20 6578 7472 6164 696d 733d 3029  es, extradims=0)
+00029280: 3a0a 2020 2020 2222 2250 6572 6d75 7465  :.    """Permute
+00029290: 2061 7865 7320 6f66 206e 6573 7465 6420   axes of nested 
+000292a0: 6c69 7374 0a0a 2020 2020 3e3e 3e20 7472  list..    >>> tr
+000292b0: 616e 7370 6f73 656c 6973 7428 5b5b 312c  ansposelist([[1,
+000292c0: 312c 315d 2c5b 312c 312c 315d 5d2c 205b  1,1],[1,1,1]], [
+000292d0: 322c 315d 290a 2020 2020 5b5b 5b31 2c20  2,1]).    [[[1, 
+000292e0: 315d 2c20 5b31 2c20 315d 2c20 5b31 2c20  1], [1, 1], [1, 
+000292f0: 315d 5d5d 0a0a 2020 2020 3e3e 3e20 7472  1]]]..    >>> tr
+00029300: 616e 7370 6f73 656c 6973 7428 5b5b 312c  ansposelist([[1,
+00029310: 312c 315d 2c5b 312c 312c 315d 5d2c 205b  1,1],[1,1,1]], [
+00029320: 322c 315d 2c20 6578 7472 6164 696d 733d  2,1], extradims=
+00029330: 3129 0a20 2020 205b 5b5b 5b31 5d2c 205b  1).    [[[[1], [
+00029340: 315d 5d2c 205b 5b31 5d2c 205b 315d 5d2c  1]], [[1], [1]],
+00029350: 205b 5b31 5d2c 205b 315d 5d5d 5d0a 2020   [[1], [1]]]].  
+00029360: 2020 2222 220a 2020 2020 6966 206c 656e    """.    if len
+00029370: 2861 7865 7329 2021 3d20 6e64 696d 6c69  (axes) != ndimli
+00029380: 7374 2861 7272 6179 7329 3a0a 2020 2020  st(arrays):.    
+00029390: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000293a0: 7272 6f72 2822 4c65 6e67 7468 206f 6620  rror("Length of 
+000293b0: 6178 6573 2073 686f 756c 6420 6571 7561  axes should equa
+000293c0: 6c20 6465 7074 6820 6f66 206e 6573 7465  l depth of neste
+000293d0: 6420 6172 7261 7973 2229 0a20 2020 2069  d arrays").    i
+000293e0: 6620 6578 7472 6164 696d 7320 3c20 303a  f extradims < 0:
+000293f0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+00029400: 616c 7565 4572 726f 7228 2260 6e65 7764  alueError("`newd
+00029410: 696d 7360 2073 686f 756c 6420 6265 2070  ims` should be p
+00029420: 6f73 6974 6976 6522 290a 2020 2020 6966  ositive").    if
+00029430: 206c 656e 2861 7865 7329 203e 206c 656e   len(axes) > len
+00029440: 2873 6574 2861 7865 7329 293a 0a20 2020  (set(axes)):.   
+00029450: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00029460: 4572 726f 7228 2260 6178 6573 6020 7368  Error("`axes` sh
+00029470: 6f75 6c64 2062 6520 756e 6971 7565 2229  ould be unique")
+00029480: 0a0a 2020 2020 6e64 696d 203d 206d 6178  ..    ndim = max
+00029490: 2861 7865 7329 202b 2031 0a20 2020 2073  (axes) + 1.    s
+000294a0: 6861 7065 203d 2073 6861 7065 6c69 7374  hape = shapelist
+000294b0: 2861 7272 6179 7329 0a20 2020 206e 6577  (arrays).    new
+000294c0: 7368 6170 6520 3d20 5b0a 2020 2020 2020  shape = [.      
+000294d0: 2020 7368 6170 655b 6178 6573 2e69 6e64    shape[axes.ind
+000294e0: 6578 2869 295d 2069 6620 6920 696e 2061  ex(i)] if i in a
+000294f0: 7865 7320 656c 7365 2031 2066 6f72 2069  xes else 1 for i
+00029500: 2069 6e20 7261 6e67 6528 6e64 696d 202b   in range(ndim +
+00029510: 2065 7874 7261 6469 6d73 290a 2020 2020   extradims).    
+00029520: 5d0a 0a20 2020 2072 6573 756c 7420 3d20  ]..    result = 
+00029530: 6c69 7374 2863 6f72 652e 666c 6174 7465  list(core.flatte
+00029540: 6e28 6172 7261 7973 2929 0a20 2020 2072  n(arrays)).    r
+00029550: 6574 7572 6e20 7265 7368 6170 656c 6973  eturn reshapelis
+00029560: 7428 6e65 7773 6861 7065 2c20 7265 7375  t(newshape, resu
+00029570: 6c74 290a 0a0a 6465 6620 7374 6163 6b28  lt)...def stack(
+00029580: 7365 712c 2061 7869 733d 302c 2061 6c6c  seq, axis=0, all
+00029590: 6f77 5f75 6e6b 6e6f 776e 5f63 6875 6e6b  ow_unknown_chunk
+000295a0: 7369 7a65 733d 4661 6c73 6529 3a0a 2020  sizes=False):.  
+000295b0: 2020 2222 220a 2020 2020 5374 6163 6b20    """.    Stack 
+000295c0: 6172 7261 7973 2061 6c6f 6e67 2061 206e  arrays along a n
+000295d0: 6577 2061 7869 730a 0a20 2020 2047 6976  ew axis..    Giv
+000295e0: 656e 2061 2073 6571 7565 6e63 6520 6f66  en a sequence of
+000295f0: 2064 6173 6b20 6172 7261 7973 2c20 666f   dask arrays, fo
+00029600: 726d 2061 206e 6577 2064 6173 6b20 6172  rm a new dask ar
+00029610: 7261 7920 6279 2073 7461 636b 696e 6720  ray by stacking 
+00029620: 7468 656d 0a20 2020 2061 6c6f 6e67 2061  them.    along a
+00029630: 206e 6577 2064 696d 656e 7369 6f6e 2028   new dimension (
+00029640: 6178 6973 3d30 2062 7920 6465 6661 756c  axis=0 by defaul
+00029650: 7429 0a0a 2020 2020 5061 7261 6d65 7465  t)..    Paramete
+00029660: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00029670: 2d0a 2020 2020 7365 713a 206c 6973 7420  -.    seq: list 
+00029680: 6f66 2064 6173 6b2e 6172 7261 7973 0a20  of dask.arrays. 
+00029690: 2020 2061 7869 733a 2069 6e74 0a20 2020     axis: int.   
+000296a0: 2020 2020 2044 696d 656e 7369 6f6e 2061       Dimension a
+000296b0: 6c6f 6e67 2077 6869 6368 2074 6f20 616c  long which to al
+000296c0: 6967 6e20 616c 6c20 6f66 2074 6865 2061  ign all of the a
+000296d0: 7272 6179 730a 2020 2020 616c 6c6f 775f  rrays.    allow_
+000296e0: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
+000296f0: 6573 3a20 626f 6f6c 0a20 2020 2020 2020  es: bool.       
+00029700: 2041 6c6c 6f77 2075 6e6b 6e6f 776e 2063   Allow unknown c
+00029710: 6875 6e6b 7369 7a65 732c 2073 7563 6820  hunksizes, such 
+00029720: 6173 2063 6f6d 6520 6672 6f6d 2063 6f6e  as come from con
+00029730: 7665 7274 696e 6720 6672 6f6d 2064 6173  verting from das
+00029740: 6b0a 2020 2020 2020 2020 6461 7461 6672  k.        datafr
+00029750: 616d 6573 2e20 2044 6173 6b2e 6172 7261  ames.  Dask.arra
+00029760: 7920 6973 2075 6e61 626c 6520 746f 2076  y is unable to v
+00029770: 6572 6966 7920 7468 6174 2063 6875 6e6b  erify that chunk
+00029780: 7320 6c69 6e65 2075 702e 2020 4966 0a20  s line up.  If. 
+00029790: 2020 2020 2020 2064 6174 6120 636f 6d65         data come
+000297a0: 7320 6672 6f6d 2064 6966 6665 7265 6e74  s from different
+000297b0: 6c79 2061 6c69 676e 6564 2073 6f75 7263  ly aligned sourc
+000297c0: 6573 2074 6865 6e20 7468 6973 2063 616e  es then this can
+000297d0: 2063 6175 7365 0a20 2020 2020 2020 2075   cause.        u
+000297e0: 6e65 7870 6563 7465 6420 7265 7375 6c74  nexpected result
+000297f0: 732e 0a0a 2020 2020 4578 616d 706c 6573  s...    Examples
+00029800: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20  .    --------.. 
+00029810: 2020 2043 7265 6174 6520 736c 6963 6573     Create slices
+00029820: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
+00029830: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
+00029840: 610a 2020 2020 3e3e 3e20 696d 706f 7274  a.    >>> import
+00029850: 206e 756d 7079 2061 7320 6e70 0a0a 2020   numpy as np..  
+00029860: 2020 3e3e 3e20 6461 7461 203d 205b 6461    >>> data = [da
+00029870: 2e66 726f 6d5f 6172 7261 7928 6e70 2e6f  .from_array(np.o
+00029880: 6e65 7328 2834 2c20 3429 292c 2063 6875  nes((4, 4)), chu
+00029890: 6e6b 733d 2832 2c20 3229 290a 2020 2020  nks=(2, 2)).    
+000298a0: 2e2e 2e20 2020 2020 2020 2020 666f 7220  ...         for 
+000298b0: 6920 696e 2072 616e 6765 2833 295d 0a0a  i in range(3)]..
+000298c0: 2020 2020 3e3e 3e20 7820 3d20 6461 2e73      >>> x = da.s
+000298d0: 7461 636b 2864 6174 612c 2061 7869 733d  tack(data, axis=
+000298e0: 3029 0a20 2020 203e 3e3e 2078 2e73 6861  0).    >>> x.sha
+000298f0: 7065 0a20 2020 2028 332c 2034 2c20 3429  pe.    (3, 4, 4)
+00029900: 0a0a 2020 2020 3e3e 3e20 6461 2e73 7461  ..    >>> da.sta
+00029910: 636b 2864 6174 612c 2061 7869 733d 3129  ck(data, axis=1)
+00029920: 2e73 6861 7065 0a20 2020 2028 342c 2033  .shape.    (4, 3
+00029930: 2c20 3429 0a0a 2020 2020 3e3e 3e20 6461  , 4)..    >>> da
+00029940: 2e73 7461 636b 2864 6174 612c 2061 7869  .stack(data, axi
+00029950: 733d 2d31 292e 7368 6170 650a 2020 2020  s=-1).shape.    
+00029960: 2834 2c20 342c 2033 290a 0a20 2020 2052  (4, 4, 3)..    R
+00029970: 6573 756c 7420 6973 2061 206e 6577 2064  esult is a new d
+00029980: 6173 6b20 4172 7261 790a 0a20 2020 2053  ask Array..    S
+00029990: 6565 2041 6c73 6f0a 2020 2020 2d2d 2d2d  ee Also.    ----
+000299a0: 2d2d 2d2d 0a20 2020 2063 6f6e 6361 7465  ----.    concate
+000299b0: 6e61 7465 0a20 2020 2022 2222 0a20 2020  nate.    """.   
+000299c0: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+000299d0: 2069 6d70 6f72 7420 7772 6170 0a0a 2020   import wrap..  
+000299e0: 2020 7365 7120 3d20 5b61 7361 7272 6179    seq = [asarray
+000299f0: 2861 2c20 616c 6c6f 775f 756e 6b6e 6f77  (a, allow_unknow
+00029a00: 6e5f 6368 756e 6b73 697a 6573 3d61 6c6c  n_chunksizes=all
+00029a10: 6f77 5f75 6e6b 6e6f 776e 5f63 6875 6e6b  ow_unknown_chunk
+00029a20: 7369 7a65 7329 2066 6f72 2061 2069 6e20  sizes) for a in 
+00029a30: 7365 715d 0a0a 2020 2020 6966 206e 6f74  seq]..    if not
+00029a40: 2073 6571 3a0a 2020 2020 2020 2020 7261   seq:.        ra
+00029a50: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00029a60: 4e65 6564 2061 7272 6179 2873 2920 746f  Need array(s) to
+00029a70: 2073 7461 636b 2229 0a20 2020 2069 6620   stack").    if 
+00029a80: 6e6f 7420 616c 6c6f 775f 756e 6b6e 6f77  not allow_unknow
+00029a90: 6e5f 6368 756e 6b73 697a 6573 2061 6e64  n_chunksizes and
+00029aa0: 206e 6f74 2061 6c6c 2878 2e73 6861 7065   not all(x.shape
+00029ab0: 203d 3d20 7365 715b 305d 2e73 6861 7065   == seq[0].shape
+00029ac0: 2066 6f72 2078 2069 6e20 7365 7129 3a0a   for x in seq):.
+00029ad0: 2020 2020 2020 2020 6964 7820 3d20 6669          idx = fi
+00029ae0: 7273 7428 6920 666f 7220 6920 696e 2065  rst(i for i in e
+00029af0: 6e75 6d65 7261 7465 2873 6571 2920 6966  numerate(seq) if
+00029b00: 2069 5b31 5d2e 7368 6170 6520 213d 2073   i[1].shape != s
+00029b10: 6571 5b30 5d2e 7368 6170 6529 0a20 2020  eq[0].shape).   
+00029b20: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00029b30: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00029b40: 2020 2022 5374 6163 6b65 6420 6172 7261     "Stacked arra
+00029b50: 7973 206d 7573 7420 6861 7665 2074 6865  ys must have the
+00029b60: 2073 616d 6520 7368 6170 652e 2054 6865   same shape. The
+00029b70: 2066 6972 7374 2061 7272 6179 2068 6164   first array had
+00029b80: 2073 6861 7065 2022 0a20 2020 2020 2020   shape ".       
+00029b90: 2020 2020 2066 227b 7365 715b 305d 2e73       f"{seq[0].s
+00029ba0: 6861 7065 7d2c 2077 6869 6c65 2061 7272  hape}, while arr
+00029bb0: 6179 207b 6964 785b 305d 202b 2031 7d20  ay {idx[0] + 1} 
+00029bc0: 6861 7320 7368 6170 6520 7b69 6478 5b31  has shape {idx[1
+00029bd0: 5d2e 7368 6170 657d 2e22 0a20 2020 2020  ].shape}.".     
+00029be0: 2020 2029 0a0a 2020 2020 6d65 7461 203d     )..    meta =
+00029bf0: 206e 702e 7374 6163 6b28 5b6d 6574 615f   np.stack([meta_
+00029c00: 6672 6f6d 5f61 7272 6179 2861 2920 666f  from_array(a) fo
+00029c10: 7220 6120 696e 2073 6571 5d2c 2061 7869  r a in seq], axi
+00029c20: 733d 6178 6973 290a 2020 2020 7365 7120  s=axis).    seq 
+00029c30: 3d20 5b78 2e61 7374 7970 6528 6d65 7461  = [x.astype(meta
+00029c40: 2e64 7479 7065 2920 666f 7220 7820 696e  .dtype) for x in
+00029c50: 2073 6571 5d0a 0a20 2020 206e 6469 6d20   seq]..    ndim 
+00029c60: 3d20 6d65 7461 2e6e 6469 6d20 2d20 310a  = meta.ndim - 1.
+00029c70: 2020 2020 6966 2061 7869 7320 3c20 303a      if axis < 0:
+00029c80: 0a20 2020 2020 2020 2061 7869 7320 3d20  .        axis = 
+00029c90: 6e64 696d 202b 2061 7869 7320 2b20 310a  ndim + axis + 1.
+00029ca0: 2020 2020 7368 6170 6520 3d20 7475 706c      shape = tupl
+00029cb0: 6528 0a20 2020 2020 2020 206c 656e 2873  e(.        len(s
+00029cc0: 6571 290a 2020 2020 2020 2020 6966 2069  eq).        if i
+00029cd0: 203d 3d20 6178 6973 0a20 2020 2020 2020   == axis.       
+00029ce0: 2065 6c73 6520 2873 6571 5b30 5d2e 7368   else (seq[0].sh
+00029cf0: 6170 655b 695d 2069 6620 6920 3c20 6178  ape[i] if i < ax
+00029d00: 6973 2065 6c73 6520 7365 715b 305d 2e73  is else seq[0].s
+00029d10: 6861 7065 5b69 202d 2031 5d29 0a20 2020  hape[i - 1]).   
+00029d20: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00029d30: 6e67 6528 6d65 7461 2e6e 6469 6d29 0a20  nge(meta.ndim). 
+00029d40: 2020 2029 0a0a 2020 2020 7365 7132 203d     )..    seq2 =
+00029d50: 205b 6120 666f 7220 6120 696e 2073 6571   [a for a in seq
+00029d60: 2069 6620 612e 7369 7a65 5d0a 2020 2020   if a.size].    
+00029d70: 6966 206e 6f74 2073 6571 323a 0a20 2020  if not seq2:.   
+00029d80: 2020 2020 2073 6571 3220 3d20 7365 710a       seq2 = seq.
+00029d90: 0a20 2020 206e 203d 206c 656e 2873 6571  .    n = len(seq
+00029da0: 3229 0a20 2020 2069 6620 6e20 3d3d 2030  2).    if n == 0
+00029db0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+00029dc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00029dd0: 6e20 7772 6170 2e65 6d70 7479 5f6c 696b  n wrap.empty_lik
+00029de0: 6528 6d65 7461 2c20 7368 6170 653d 7368  e(meta, shape=sh
+00029df0: 6170 652c 2063 6875 6e6b 733d 7368 6170  ape, chunks=shap
+00029e00: 652c 2064 7479 7065 3d6d 6574 612e 6474  e, dtype=meta.dt
+00029e10: 7970 6529 0a20 2020 2020 2020 2065 7863  ype).        exc
+00029e20: 6570 7420 5479 7065 4572 726f 723a 0a20  ept TypeError:. 
+00029e30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00029e40: 6e20 7772 6170 2e65 6d70 7479 2873 6861  n wrap.empty(sha
+00029e50: 7065 2c20 6368 756e 6b73 3d73 6861 7065  pe, chunks=shape
+00029e60: 2c20 6474 7970 653d 6d65 7461 2e64 7479  , dtype=meta.dty
+00029e70: 7065 290a 0a20 2020 2069 6e64 203d 206c  pe)..    ind = l
+00029e80: 6973 7428 7261 6e67 6528 6e64 696d 2929  ist(range(ndim))
+00029e90: 0a20 2020 2075 635f 6172 6773 203d 206c  .    uc_args = l
+00029ea0: 6973 7428 636f 6e63 6174 2828 782c 2069  ist(concat((x, i
+00029eb0: 6e64 2920 666f 7220 7820 696e 2073 6571  nd) for x in seq
+00029ec0: 3229 290a 2020 2020 5f2c 2073 6571 3220  2)).    _, seq2 
+00029ed0: 3d20 756e 6966 795f 6368 756e 6b73 282a  = unify_chunks(*
+00029ee0: 7563 5f61 7267 7329 0a0a 2020 2020 6173  uc_args)..    as
+00029ef0: 7365 7274 206c 656e 287b 612e 6368 756e  sert len({a.chun
+00029f00: 6b73 2066 6f72 2061 2069 6e20 7365 7132  ks for a in seq2
+00029f10: 7d29 203d 3d20 3120 2023 2073 616d 6520  }) == 1  # same 
+00029f20: 6368 756e 6b73 0a20 2020 2063 6875 6e6b  chunks.    chunk
+00029f30: 7320 3d20 7365 7132 5b30 5d2e 6368 756e  s = seq2[0].chun
+00029f40: 6b73 5b3a 6178 6973 5d20 2b20 2828 312c  ks[:axis] + ((1,
+00029f50: 2920 2a20 6e2c 2920 2b20 7365 7132 5b30  ) * n,) + seq2[0
+00029f60: 5d2e 6368 756e 6b73 5b61 7869 733a 5d0a  ].chunks[axis:].
+00029f70: 0a20 2020 206e 616d 6573 203d 205b 612e  .    names = [a.
+00029f80: 6e61 6d65 2066 6f72 2061 2069 6e20 7365  name for a in se
+00029f90: 7132 5d0a 2020 2020 6e61 6d65 203d 2022  q2].    name = "
+00029fa0: 7374 6163 6b2d 2220 2b20 746f 6b65 6e69  stack-" + tokeni
+00029fb0: 7a65 286e 616d 6573 2c20 6178 6973 290a  ze(names, axis).
+00029fc0: 2020 2020 6b65 7973 203d 206c 6973 7428      keys = list(
+00029fd0: 7072 6f64 7563 7428 5b6e 616d 655d 2c20  product([name], 
+00029fe0: 2a5b 7261 6e67 6528 6c65 6e28 6264 2929  *[range(len(bd))
+00029ff0: 2066 6f72 2062 6420 696e 2063 6875 6e6b   for bd in chunk
+0002a000: 735d 2929 0a0a 2020 2020 696e 7075 7473  s]))..    inputs
+0002a010: 203d 205b 0a20 2020 2020 2020 2028 6e61   = [.        (na
+0002a020: 6d65 735b 6b65 795b 6178 6973 202b 2031  mes[key[axis + 1
+0002a030: 5d5d 2c29 202b 206b 6579 5b31 203a 2061  ]],) + key[1 : a
+0002a040: 7869 7320 2b20 315d 202b 206b 6579 5b61  xis + 1] + key[a
+0002a050: 7869 7320 2b20 3220 3a5d 2066 6f72 206b  xis + 2 :] for k
+0002a060: 6579 2069 6e20 6b65 7973 0a20 2020 205d  ey in keys.    ]
+0002a070: 0a20 2020 2076 616c 7565 7320 3d20 5b0a  .    values = [.
+0002a080: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
+0002a090: 2020 2020 2020 6765 7469 7465 6d2c 0a20        getitem,. 
+0002a0a0: 2020 2020 2020 2020 2020 2069 6e70 2c0a             inp,.
+0002a0b0: 2020 2020 2020 2020 2020 2020 2873 6c69              (sli
+0002a0c0: 6365 284e 6f6e 652c 204e 6f6e 652c 204e  ce(None, None, N
+0002a0d0: 6f6e 6529 2c29 202a 2061 7869 730a 2020  one),) * axis.  
+0002a0e0: 2020 2020 2020 2020 2020 2b20 284e 6f6e            + (Non
+0002a0f0: 652c 290a 2020 2020 2020 2020 2020 2020  e,).            
+0002a100: 2b20 2873 6c69 6365 284e 6f6e 652c 204e  + (slice(None, N
+0002a110: 6f6e 652c 204e 6f6e 6529 2c29 202a 2028  one, None),) * (
+0002a120: 6e64 696d 202d 2061 7869 7329 2c0a 2020  ndim - axis),.  
+0002a130: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002a140: 666f 7220 696e 7020 696e 2069 6e70 7574  for inp in input
+0002a150: 730a 2020 2020 5d0a 0a20 2020 206c 6179  s.    ]..    lay
+0002a160: 6572 203d 2064 6963 7428 7a69 7028 6b65  er = dict(zip(ke
+0002a170: 7973 2c20 7661 6c75 6573 2929 0a20 2020  ys, values)).   
+0002a180: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+0002a190: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+0002a1a0: 6c65 6374 696f 6e73 286e 616d 652c 206c  lections(name, l
+0002a1b0: 6179 6572 2c20 6465 7065 6e64 656e 6369  ayer, dependenci
+0002a1c0: 6573 3d73 6571 3229 0a0a 2020 2020 7265  es=seq2)..    re
+0002a1d0: 7475 726e 2041 7272 6179 2867 7261 7068  turn Array(graph
+0002a1e0: 2c20 6e61 6d65 2c20 6368 756e 6b73 2c20  , name, chunks, 
+0002a1f0: 6d65 7461 3d6d 6574 6129 0a0a 0a64 6566  meta=meta)...def
+0002a200: 2063 6f6e 6361 7465 6e61 7465 3328 6172   concatenate3(ar
+0002a210: 7261 7973 293a 0a20 2020 2022 2222 5265  rays):.    """Re
+0002a220: 6375 7273 6976 6520 6e70 2e63 6f6e 6361  cursive np.conca
+0002a230: 7465 6e61 7465 0a0a 2020 2020 496e 7075  tenate..    Inpu
+0002a240: 7420 7368 6f75 6c64 2062 6520 6120 6e65  t should be a ne
+0002a250: 7374 6564 206c 6973 7420 6f66 206e 756d  sted list of num
+0002a260: 7079 2061 7272 6179 7320 6172 7261 6e67  py arrays arrang
+0002a270: 6564 2069 6e20 7468 6520 6f72 6465 7220  ed in the order 
+0002a280: 7468 6579 0a20 2020 2073 686f 756c 6420  they.    should 
+0002a290: 6170 7065 6172 2069 6e20 7468 6520 6172  appear in the ar
+0002a2a0: 7261 7920 6974 7365 6c66 2e20 2045 6163  ray itself.  Eac
+0002a2b0: 6820 6172 7261 7920 7368 6f75 6c64 2068  h array should h
+0002a2c0: 6176 6520 7468 6520 7361 6d65 206e 756d  ave the same num
+0002a2d0: 6265 720a 2020 2020 6f66 2064 696d 656e  ber.    of dimen
+0002a2e0: 7369 6f6e 7320 6173 2074 6865 2064 6573  sions as the des
+0002a2f0: 6972 6564 206f 7574 7075 7420 616e 6420  ired output and 
+0002a300: 7468 6520 6e65 7374 696e 6720 6f66 2074  the nesting of t
+0002a310: 6865 206c 6973 7473 2e0a 0a20 2020 203e  he lists...    >
+0002a320: 3e3e 2078 203d 206e 702e 6172 7261 7928  >> x = np.array(
+0002a330: 5b5b 312c 2032 5d5d 290a 2020 2020 3e3e  [[1, 2]]).    >>
+0002a340: 3e20 636f 6e63 6174 656e 6174 6533 285b  > concatenate3([
+0002a350: 5b78 2c20 782c 2078 5d2c 205b 782c 2078  [x, x, x], [x, x
+0002a360: 2c20 785d 5d29 0a20 2020 2061 7272 6179  , x]]).    array
+0002a370: 285b 5b31 2c20 322c 2031 2c20 322c 2031  ([[1, 2, 1, 2, 1
+0002a380: 2c20 325d 2c0a 2020 2020 2020 2020 2020  , 2],.          
+0002a390: 205b 312c 2032 2c20 312c 2032 2c20 312c   [1, 2, 1, 2, 1,
+0002a3a0: 2032 5d5d 290a 0a20 2020 203e 3e3e 2063   2]])..    >>> c
+0002a3b0: 6f6e 6361 7465 6e61 7465 3328 5b5b 782c  oncatenate3([[x,
+0002a3c0: 2078 5d2c 205b 782c 2078 5d2c 205b 782c   x], [x, x], [x,
+0002a3d0: 2078 5d5d 290a 2020 2020 6172 7261 7928   x]]).    array(
+0002a3e0: 5b5b 312c 2032 2c20 312c 2032 5d2c 0a20  [[1, 2, 1, 2],. 
+0002a3f0: 2020 2020 2020 2020 2020 5b31 2c20 322c            [1, 2,
+0002a400: 2031 2c20 325d 2c0a 2020 2020 2020 2020   1, 2],.        
+0002a410: 2020 205b 312c 2032 2c20 312c 2032 5d5d     [1, 2, 1, 2]]
+0002a420: 290a 2020 2020 2222 220a 2020 2020 2320  ).    """.    # 
+0002a430: 5765 206e 6565 6420 7468 6973 2061 7320  We need this as 
+0002a440: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
+0002a450: 5f5f 206d 6179 206e 6f74 2065 7869 7374  __ may not exist
+0002a460: 206f 6e20 6f6c 6465 7220 4e75 6d50 7920   on older NumPy 
+0002a470: 7665 7273 696f 6e73 2e0a 2020 2020 2320  versions..    # 
+0002a480: 416e 6420 746f 2072 6564 7563 6520 7665  And to reduce ve
+0002a490: 7262 6f73 6974 792e 0a20 2020 204e 4441  rbosity..    NDA
+0002a4a0: 5252 4159 5f41 5252 4159 5f46 554e 4354  RRAY_ARRAY_FUNCT
+0002a4b0: 494f 4e20 3d20 6765 7461 7474 7228 6e70  ION = getattr(np
+0002a4c0: 2e6e 6461 7272 6179 2c20 225f 5f61 7272  .ndarray, "__arr
+0002a4d0: 6179 5f66 756e 6374 696f 6e5f 5f22 2c20  ay_function__", 
+0002a4e0: 4e6f 6e65 290a 0a20 2020 2061 7272 6179  None)..    array
+0002a4f0: 7320 3d20 636f 6e63 7265 7465 2861 7272  s = concrete(arr
+0002a500: 6179 7329 0a20 2020 2069 6620 6e6f 7420  ays).    if not 
+0002a510: 6172 7261 7973 3a0a 2020 2020 2020 2020  arrays:.        
+0002a520: 7265 7475 726e 206e 702e 656d 7074 7928  return np.empty(
+0002a530: 3029 0a0a 2020 2020 6164 7661 6e63 6564  0)..    advanced
+0002a540: 203d 206d 6178 280a 2020 2020 2020 2020   = max(.        
+0002a550: 636f 7265 2e66 6c61 7474 656e 2861 7272  core.flatten(arr
+0002a560: 6179 732c 2063 6f6e 7461 696e 6572 3d28  ays, container=(
+0002a570: 6c69 7374 2c20 7475 706c 6529 292c 0a20  list, tuple)),. 
+0002a580: 2020 2020 2020 206b 6579 3d6c 616d 6264         key=lambd
+0002a590: 6120 783a 2067 6574 6174 7472 2878 2c20  a x: getattr(x, 
+0002a5a0: 225f 5f61 7272 6179 5f70 7269 6f72 6974  "__array_priorit
+0002a5b0: 795f 5f22 2c20 3029 2c0a 2020 2020 290a  y__", 0),.    ).
+0002a5c0: 0a20 2020 2069 6620 6e6f 7420 616c 6c28  .    if not all(
+0002a5d0: 0a20 2020 2020 2020 204e 4441 5252 4159  .        NDARRAY
+0002a5e0: 5f41 5252 4159 5f46 554e 4354 494f 4e0a  _ARRAY_FUNCTION.
+0002a5f0: 2020 2020 2020 2020 6973 2067 6574 6174          is getat
+0002a600: 7472 2874 7970 6528 6172 7229 2c20 225f  tr(type(arr), "_
+0002a610: 5f61 7272 6179 5f66 756e 6374 696f 6e5f  _array_function_
+0002a620: 5f22 2c20 4e44 4152 5241 595f 4152 5241  _", NDARRAY_ARRA
+0002a630: 595f 4655 4e43 5449 4f4e 290a 2020 2020  Y_FUNCTION).    
+0002a640: 2020 2020 666f 7220 6172 7220 696e 2063      for arr in c
+0002a650: 6f72 652e 666c 6174 7465 6e28 6172 7261  ore.flatten(arra
+0002a660: 7973 2c20 636f 6e74 6169 6e65 723d 286c  ys, container=(l
+0002a670: 6973 742c 2074 7570 6c65 2929 0a20 2020  ist, tuple)).   
+0002a680: 2029 3a0a 2020 2020 2020 2020 7472 793a   ):.        try:
+0002a690: 0a20 2020 2020 2020 2020 2020 2078 203d  .            x =
+0002a6a0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+0002a6b0: 6e28 6172 7261 7973 290a 2020 2020 2020  n(arrays).      
+0002a6c0: 2020 2020 2020 7265 7475 726e 205f 636f        return _co
+0002a6d0: 6e63 6174 656e 6174 6532 2861 7272 6179  ncatenate2(array
+0002a6e0: 732c 2061 7865 733d 7475 706c 6528 7261  s, axes=tuple(ra
+0002a6f0: 6e67 6528 782e 6e64 696d 2929 290a 2020  nge(x.ndim))).  
+0002a700: 2020 2020 2020 6578 6365 7074 2054 7970        except Typ
+0002a710: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+0002a720: 2020 2020 7061 7373 0a0a 2020 2020 6966      pass..    if
+0002a730: 2063 6f6e 6361 7465 6e61 7465 5f6c 6f6f   concatenate_loo
+0002a740: 6b75 702e 6469 7370 6174 6368 2874 7970  kup.dispatch(typ
+0002a750: 6528 6164 7661 6e63 6564 2929 2069 7320  e(advanced)) is 
+0002a760: 6e6f 7420 6e70 2e63 6f6e 6361 7465 6e61  not np.concatena
+0002a770: 7465 3a0a 2020 2020 2020 2020 7820 3d20  te:.        x = 
+0002a780: 756e 7061 636b 5f73 696e 676c 6574 6f6e  unpack_singleton
+0002a790: 2861 7272 6179 7329 0a20 2020 2020 2020  (arrays).       
+0002a7a0: 2072 6574 7572 6e20 5f63 6f6e 6361 7465   return _concate
+0002a7b0: 6e61 7465 3228 6172 7261 7973 2c20 6178  nate2(arrays, ax
+0002a7c0: 6573 3d6c 6973 7428 7261 6e67 6528 782e  es=list(range(x.
+0002a7d0: 6e64 696d 2929 290a 0a20 2020 206e 6469  ndim)))..    ndi
+0002a7e0: 6d20 3d20 6e64 696d 6c69 7374 2861 7272  m = ndimlist(arr
+0002a7f0: 6179 7329 0a20 2020 2069 6620 6e6f 7420  ays).    if not 
+0002a800: 6e64 696d 3a0a 2020 2020 2020 2020 7265  ndim:.        re
+0002a810: 7475 726e 2061 7272 6179 730a 2020 2020  turn arrays.    
+0002a820: 6368 756e 6b73 203d 2063 6875 6e6b 735f  chunks = chunks_
+0002a830: 6672 6f6d 5f61 7272 6179 7328 6172 7261  from_arrays(arra
+0002a840: 7973 290a 2020 2020 7368 6170 6520 3d20  ys).    shape = 
+0002a850: 7475 706c 6528 6d61 7028 7375 6d2c 2063  tuple(map(sum, c
+0002a860: 6875 6e6b 7329 290a 0a20 2020 2064 6566  hunks))..    def
+0002a870: 2064 7479 7065 2878 293a 0a20 2020 2020   dtype(x):.     
+0002a880: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0002a890: 2020 2020 7265 7475 726e 2078 2e64 7479      return x.dty
+0002a8a0: 7065 0a20 2020 2020 2020 2065 7863 6570  pe.        excep
+0002a8b0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
+0002a8c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0002a8d0: 7475 726e 2074 7970 6528 7829 0a0a 2020  turn type(x)..  
+0002a8e0: 2020 7265 7375 6c74 203d 206e 702e 656d    result = np.em
+0002a8f0: 7074 7928 7368 6170 653d 7368 6170 652c  pty(shape=shape,
+0002a900: 2064 7479 7065 3d64 7479 7065 2864 6565   dtype=dtype(dee
+0002a910: 7066 6972 7374 2861 7272 6179 7329 2929  pfirst(arrays)))
+0002a920: 0a0a 2020 2020 666f 7220 6964 782c 2061  ..    for idx, a
+0002a930: 7272 2069 6e20 7a69 7028 0a20 2020 2020  rr in zip(.     
+0002a940: 2020 2073 6c69 6365 735f 6672 6f6d 5f63     slices_from_c
+0002a950: 6875 6e6b 7328 6368 756e 6b73 292c 2063  hunks(chunks), c
+0002a960: 6f72 652e 666c 6174 7465 6e28 6172 7261  ore.flatten(arra
+0002a970: 7973 2c20 636f 6e74 6169 6e65 723d 286c  ys, container=(l
+0002a980: 6973 742c 2074 7570 6c65 2929 0a20 2020  ist, tuple)).   
+0002a990: 2029 3a0a 2020 2020 2020 2020 6966 2068   ):.        if h
+0002a9a0: 6173 6174 7472 2861 7272 2c20 226e 6469  asattr(arr, "ndi
+0002a9b0: 6d22 293a 0a20 2020 2020 2020 2020 2020  m"):.           
+0002a9c0: 2077 6869 6c65 2061 7272 2e6e 6469 6d20   while arr.ndim 
+0002a9d0: 3c20 6e64 696d 3a0a 2020 2020 2020 2020  < ndim:.        
+0002a9e0: 2020 2020 2020 2020 6172 7220 3d20 6172          arr = ar
+0002a9f0: 725b 4e6f 6e65 2c20 2e2e 2e5d 0a20 2020  r[None, ...].   
+0002aa00: 2020 2020 2072 6573 756c 745b 6964 785d       result[idx]
+0002aa10: 203d 2061 7272 0a0a 2020 2020 7265 7475   = arr..    retu
+0002aa20: 726e 2072 6573 756c 740a 0a0a 6465 6620  rn result...def 
+0002aa30: 636f 6e63 6174 656e 6174 655f 6178 6573  concatenate_axes
+0002aa40: 2861 7272 6179 732c 2061 7865 7329 3a0a  (arrays, axes):.
+0002aa50: 2020 2020 2222 2252 6563 7572 7369 7665      """Recursive
+0002aa60: 6c79 2063 616c 6c20 6e70 2e63 6f6e 6361  ly call np.conca
+0002aa70: 7465 6e61 7465 2061 6c6f 6e67 2061 7865  tenate along axe
+0002aa80: 7322 2222 0a20 2020 2069 6620 6c65 6e28  s""".    if len(
+0002aa90: 6178 6573 2920 213d 206e 6469 6d6c 6973  axes) != ndimlis
+0002aaa0: 7428 6172 7261 7973 293a 0a20 2020 2020  t(arrays):.     
+0002aab0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0002aac0: 726f 7228 224c 656e 6774 6820 6f66 2061  ror("Length of a
+0002aad0: 7865 7320 7368 6f75 6c64 2065 7175 616c  xes should equal
+0002aae0: 2064 6570 7468 206f 6620 6e65 7374 6564   depth of nested
+0002aaf0: 2061 7272 6179 7322 290a 0a20 2020 2065   arrays")..    e
+0002ab00: 7874 7261 6469 6d73 203d 206d 6178 2830  xtradims = max(0
+0002ab10: 2c20 6465 6570 6669 7273 7428 6172 7261  , deepfirst(arra
+0002ab20: 7973 292e 6e64 696d 202d 2028 6d61 7828  ys).ndim - (max(
+0002ab30: 6178 6573 2920 2b20 3129 290a 2020 2020  axes) + 1)).    
+0002ab40: 7265 7475 726e 2063 6f6e 6361 7465 6e61  return concatena
+0002ab50: 7465 3328 7472 616e 7370 6f73 656c 6973  te3(transposelis
+0002ab60: 7428 6172 7261 7973 2c20 6178 6573 2c20  t(arrays, axes, 
+0002ab70: 6578 7472 6164 696d 733d 6578 7472 6164  extradims=extrad
+0002ab80: 696d 7329 290a 0a0a 6465 6620 746f 5f68  ims))...def to_h
+0002ab90: 6466 3528 6669 6c65 6e61 6d65 2c20 2a61  df5(filename, *a
+0002aba0: 7267 732c 2063 6875 6e6b 733d 5472 7565  rgs, chunks=True
+0002abb0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0002abc0: 2022 2222 5374 6f72 6520 6172 7261 7973   """Store arrays
+0002abd0: 2069 6e20 4844 4635 2066 696c 650a 0a20   in HDF5 file.. 
+0002abe0: 2020 2054 6869 7320 7361 7665 7320 7365     This saves se
+0002abf0: 7665 7261 6c20 6461 736b 2061 7272 6179  veral dask array
+0002ac00: 7320 696e 746f 2073 6576 6572 616c 2064  s into several d
+0002ac10: 6174 6170 6174 6873 2069 6e20 616e 2048  atapaths in an H
+0002ac20: 4446 3520 6669 6c65 2e0a 2020 2020 4974  DF5 file..    It
+0002ac30: 2063 7265 6174 6573 2074 6865 206e 6563   creates the nec
+0002ac40: 6573 7361 7279 2064 6174 6173 6574 7320  essary datasets 
+0002ac50: 616e 6420 6861 6e64 6c65 7320 636c 6561  and handles clea
+0002ac60: 6e20 6669 6c65 206f 7065 6e69 6e67 2f63  n file opening/c
+0002ac70: 6c6f 7369 6e67 2e0a 0a20 2020 2050 6172  losing...    Par
+0002ac80: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+0002ac90: 2d2d 2d2d 2d2d 0a20 2020 2063 6875 6e6b  ------.    chunk
+0002aca0: 733a 2074 7570 6c65 206f 7220 6060 5472  s: tuple or ``Tr
+0002acb0: 7565 6060 0a20 2020 2020 2020 2043 6875  ue``.        Chu
+0002acc0: 6e6b 2073 6861 7065 2c20 6f72 2060 6054  nk shape, or ``T
+0002acd0: 7275 6560 6020 746f 2070 6173 7320 7468  rue`` to pass th
+0002ace0: 6520 6368 756e 6b73 2066 726f 6d20 7468  e chunks from th
+0002acf0: 6520 6461 736b 2061 7272 6179 2e0a 2020  e dask array..  
+0002ad00: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+0002ad10: 6f20 6060 5472 7565 6060 2e0a 0a20 2020  o ``True``...   
+0002ad20: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
+0002ad30: 2d2d 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20  ------..    >>> 
+0002ad40: 6461 2e74 6f5f 6864 6635 2827 6d79 6669  da.to_hdf5('myfi
+0002ad50: 6c65 2e68 6466 3527 2c20 272f 7827 2c20  le.hdf5', '/x', 
+0002ad60: 7829 2020 2320 646f 6374 6573 743a 202b  x)  # doctest: +
+0002ad70: 534b 4950 0a0a 2020 2020 6f72 0a0a 2020  SKIP..    or..  
+0002ad80: 2020 3e3e 3e20 6461 2e74 6f5f 6864 6635    >>> da.to_hdf5
+0002ad90: 2827 6d79 6669 6c65 2e68 6466 3527 2c20  ('myfile.hdf5', 
+0002ada0: 7b27 2f78 273a 2078 2c20 272f 7927 3a20  {'/x': x, '/y': 
+0002adb0: 797d 2920 2023 2064 6f63 7465 7374 3a20  y})  # doctest: 
+0002adc0: 2b53 4b49 500a 0a20 2020 204f 7074 696f  +SKIP..    Optio
+0002add0: 6e61 6c6c 7920 7072 6f76 6964 6520 6172  nally provide ar
+0002ade0: 6775 6d65 6e74 7320 6173 2074 686f 7567  guments as thoug
+0002adf0: 6820 746f 2060 6068 3570 792e 4669 6c65  h to ``h5py.File
+0002ae00: 2e63 7265 6174 655f 6461 7461 7365 7460  .create_dataset`
+0002ae10: 600a 0a20 2020 203e 3e3e 2064 612e 746f  `..    >>> da.to
+0002ae20: 5f68 6466 3528 276d 7966 696c 652e 6864  _hdf5('myfile.hd
+0002ae30: 6635 272c 2027 2f78 272c 2078 2c20 636f  f5', '/x', x, co
+0002ae40: 6d70 7265 7373 696f 6e3d 276c 7a66 272c  mpression='lzf',
+0002ae50: 2073 6875 6666 6c65 3d54 7275 6529 2020   shuffle=True)  
+0002ae60: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0002ae70: 0a0a 2020 2020 3e3e 3e20 6461 2e74 6f5f  ..    >>> da.to_
+0002ae80: 6864 6635 2827 6d79 6669 6c65 2e68 6466  hdf5('myfile.hdf
+0002ae90: 3527 2c20 272f 7827 2c20 782c 2063 6875  5', '/x', x, chu
+0002aea0: 6e6b 733d 2831 302c 3230 2c33 3029 2920  nks=(10,20,30)) 
+0002aeb0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+0002aec0: 500a 0a20 2020 2054 6869 7320 6361 6e20  P..    This can 
+0002aed0: 616c 736f 2062 6520 7573 6564 2061 7320  also be used as 
+0002aee0: 6120 6d65 7468 6f64 206f 6e20 6120 7369  a method on a si
+0002aef0: 6e67 6c65 2041 7272 6179 0a0a 2020 2020  ngle Array..    
+0002af00: 3e3e 3e20 782e 746f 5f68 6466 3528 276d  >>> x.to_hdf5('m
+0002af10: 7966 696c 652e 6864 6635 272c 2027 2f78  yfile.hdf5', '/x
+0002af20: 2729 2020 2320 646f 6374 6573 743a 202b  ')  # doctest: +
+0002af30: 534b 4950 0a0a 2020 2020 5365 6520 416c  SKIP..    See Al
+0002af40: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
+0002af50: 2020 2020 6461 2e73 746f 7265 0a20 2020      da.store.   
+0002af60: 2068 3570 792e 4669 6c65 2e63 7265 6174   h5py.File.creat
+0002af70: 655f 6461 7461 7365 740a 2020 2020 2222  e_dataset.    ""
+0002af80: 220a 2020 2020 6966 206c 656e 2861 7267  ".    if len(arg
+0002af90: 7329 203d 3d20 3120 616e 6420 6973 696e  s) == 1 and isin
+0002afa0: 7374 616e 6365 2861 7267 735b 305d 2c20  stance(args[0], 
+0002afb0: 6469 6374 293a 0a20 2020 2020 2020 2064  dict):.        d
+0002afc0: 6174 6120 3d20 6172 6773 5b30 5d0a 2020  ata = args[0].  
+0002afd0: 2020 656c 6966 206c 656e 2861 7267 7329    elif len(args)
+0002afe0: 203d 3d20 3220 616e 6420 6973 696e 7374   == 2 and isinst
+0002aff0: 616e 6365 2861 7267 735b 305d 2c20 7374  ance(args[0], st
+0002b000: 7229 2061 6e64 2069 7369 6e73 7461 6e63  r) and isinstanc
+0002b010: 6528 6172 6773 5b31 5d2c 2041 7272 6179  e(args[1], Array
+0002b020: 293a 0a20 2020 2020 2020 2064 6174 6120  ):.        data 
+0002b030: 3d20 7b61 7267 735b 305d 3a20 6172 6773  = {args[0]: args
+0002b040: 5b31 5d7d 0a20 2020 2065 6c73 653a 0a20  [1]}.    else:. 
+0002b050: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0002b060: 7565 4572 726f 7228 2250 6c65 6173 6520  ueError("Please 
+0002b070: 7072 6f76 6964 6520 7b27 2f64 6174 612f  provide {'/data/
+0002b080: 7061 7468 273a 2061 7272 6179 7d20 6469  path': array} di
+0002b090: 6374 696f 6e61 7279 2229 0a0a 2020 2020  ctionary")..    
+0002b0a0: 696d 706f 7274 2068 3570 790a 0a20 2020  import h5py..   
+0002b0b0: 2077 6974 6820 6835 7079 2e46 696c 6528   with h5py.File(
+0002b0c0: 6669 6c65 6e61 6d65 2c20 6d6f 6465 3d22  filename, mode="
+0002b0d0: 6122 2920 6173 2066 3a0a 2020 2020 2020  a") as f:.      
+0002b0e0: 2020 6473 6574 7320 3d20 5b0a 2020 2020    dsets = [.    
+0002b0f0: 2020 2020 2020 2020 662e 7265 7175 6972          f.requir
+0002b100: 655f 6461 7461 7365 7428 0a20 2020 2020  e_dataset(.     
+0002b110: 2020 2020 2020 2020 2020 2064 702c 0a20             dp,. 
+0002b120: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002b130: 6861 7065 3d78 2e73 6861 7065 2c0a 2020  hape=x.shape,.  
+0002b140: 2020 2020 2020 2020 2020 2020 2020 6474                dt
+0002b150: 7970 653d 782e 6474 7970 652c 0a20 2020  ype=x.dtype,.   
+0002b160: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+0002b170: 6e6b 733d 7475 706c 6528 635b 305d 2066  nks=tuple(c[0] f
+0002b180: 6f72 2063 2069 6e20 782e 6368 756e 6b73  or c in x.chunks
+0002b190: 2920 6966 2063 6875 6e6b 7320 6973 2054  ) if chunks is T
+0002b1a0: 7275 6520 656c 7365 2063 6875 6e6b 732c  rue else chunks,
+0002b1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b1c0: 202a 2a6b 7761 7267 732c 0a20 2020 2020   **kwargs,.     
+0002b1d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002b1e0: 2020 2020 2066 6f72 2064 702c 2078 2069       for dp, x i
+0002b1f0: 6e20 6461 7461 2e69 7465 6d73 2829 0a20  n data.items(). 
+0002b200: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0002b210: 2073 746f 7265 286c 6973 7428 6461 7461   store(list(data
+0002b220: 2e76 616c 7565 7328 2929 2c20 6473 6574  .values()), dset
+0002b230: 7329 0a0a 0a64 6566 2069 6e74 6572 6c65  s)...def interle
+0002b240: 6176 655f 6e6f 6e65 2861 2c20 6229 3a0a  ave_none(a, b):.
+0002b250: 2020 2020 2222 220a 0a20 2020 203e 3e3e      """..    >>>
+0002b260: 2069 6e74 6572 6c65 6176 655f 6e6f 6e65   interleave_none
+0002b270: 285b 302c 204e 6f6e 652c 2032 2c20 4e6f  ([0, None, 2, No
+0002b280: 6e65 5d2c 205b 312c 2033 5d29 0a20 2020  ne], [1, 3]).   
+0002b290: 2028 302c 2031 2c20 322c 2033 290a 2020   (0, 1, 2, 3).  
+0002b2a0: 2020 2222 220a 2020 2020 7265 7375 6c74    """.    result
+0002b2b0: 203d 205b 5d0a 2020 2020 6920 3d20 6a20   = [].    i = j 
+0002b2c0: 3d20 300a 2020 2020 6e20 3d20 6c65 6e28  = 0.    n = len(
+0002b2d0: 6129 202b 206c 656e 2862 290a 2020 2020  a) + len(b).    
+0002b2e0: 7768 696c 6520 6920 2b20 6a20 3c20 6e3a  while i + j < n:
+0002b2f0: 0a20 2020 2020 2020 2069 6620 615b 695d  .        if a[i]
+0002b300: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0002b310: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+0002b320: 2e61 7070 656e 6428 615b 695d 290a 2020  .append(a[i]).  
+0002b330: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
+0002b340: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0002b350: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0002b360: 742e 6170 7065 6e64 2862 5b6a 5d29 0a20  t.append(b[j]). 
+0002b370: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
+0002b380: 310a 2020 2020 2020 2020 2020 2020 6a20  1.            j 
+0002b390: 2b3d 2031 0a20 2020 2072 6574 7572 6e20  += 1.    return 
+0002b3a0: 7475 706c 6528 7265 7375 6c74 290a 0a0a  tuple(result)...
+0002b3b0: 6465 6620 6b65 796e 616d 6528 6e61 6d65  def keyname(name
+0002b3c0: 2c20 692c 206f 6b65 7929 3a0a 2020 2020  , i, okey):.    
+0002b3d0: 2222 220a 0a20 2020 203e 3e3e 206b 6579  """..    >>> key
+0002b3e0: 6e61 6d65 2827 7827 2c20 332c 205b 4e6f  name('x', 3, [No
+0002b3f0: 6e65 2c20 4e6f 6e65 2c20 302c 2032 5d29  ne, None, 0, 2])
+0002b400: 0a20 2020 2028 2778 272c 2033 2c20 302c  .    ('x', 3, 0,
+0002b410: 2032 290a 2020 2020 2222 220a 2020 2020   2).    """.    
+0002b420: 7265 7475 726e 2028 6e61 6d65 2c20 6929  return (name, i)
+0002b430: 202b 2074 7570 6c65 286b 2066 6f72 206b   + tuple(k for k
+0002b440: 2069 6e20 6f6b 6579 2069 6620 6b20 6973   in okey if k is
+0002b450: 206e 6f74 204e 6f6e 6529 0a0a 0a64 6566   not None)...def
+0002b460: 205f 7669 6e64 6578 2878 2c20 2a69 6e64   _vindex(x, *ind
+0002b470: 6578 6573 293a 0a20 2020 2022 2222 506f  exes):.    """Po
+0002b480: 696e 7420 7769 7365 2069 6e64 6578 696e  int wise indexin
+0002b490: 6720 7769 7468 2062 726f 6164 6361 7374  g with broadcast
+0002b4a0: 696e 672e 0a0a 2020 2020 3e3e 3e20 7820  ing...    >>> x 
+0002b4b0: 3d20 6e70 2e61 7261 6e67 6528 3536 292e  = np.arange(56).
+0002b4c0: 7265 7368 6170 6528 2837 2c20 3829 290a  reshape((7, 8)).
+0002b4d0: 2020 2020 3e3e 3e20 780a 2020 2020 6172      >>> x.    ar
+0002b4e0: 7261 7928 5b5b 2030 2c20 2031 2c20 2032  ray([[ 0,  1,  2
+0002b4f0: 2c20 2033 2c20 2034 2c20 2035 2c20 2036  ,  3,  4,  5,  6
+0002b500: 2c20 2037 5d2c 0a20 2020 2020 2020 2020  ,  7],.         
+0002b510: 2020 5b20 382c 2020 392c 2031 302c 2031    [ 8,  9, 10, 1
+0002b520: 312c 2031 322c 2031 332c 2031 342c 2031  1, 12, 13, 14, 1
+0002b530: 355d 2c0a 2020 2020 2020 2020 2020 205b  5],.           [
+0002b540: 3136 2c20 3137 2c20 3138 2c20 3139 2c20  16, 17, 18, 19, 
+0002b550: 3230 2c20 3231 2c20 3232 2c20 3233 5d2c  20, 21, 22, 23],
+0002b560: 0a20 2020 2020 2020 2020 2020 5b32 342c  .           [24,
+0002b570: 2032 352c 2032 362c 2032 372c 2032 382c   25, 26, 27, 28,
+0002b580: 2032 392c 2033 302c 2033 315d 2c0a 2020   29, 30, 31],.  
+0002b590: 2020 2020 2020 2020 205b 3332 2c20 3333           [32, 33
+0002b5a0: 2c20 3334 2c20 3335 2c20 3336 2c20 3337  , 34, 35, 36, 37
+0002b5b0: 2c20 3338 2c20 3339 5d2c 0a20 2020 2020  , 38, 39],.     
+0002b5c0: 2020 2020 2020 5b34 302c 2034 312c 2034        [40, 41, 4
+0002b5d0: 322c 2034 332c 2034 342c 2034 352c 2034  2, 43, 44, 45, 4
+0002b5e0: 362c 2034 375d 2c0a 2020 2020 2020 2020  6, 47],.        
+0002b5f0: 2020 205b 3438 2c20 3439 2c20 3530 2c20     [48, 49, 50, 
+0002b600: 3531 2c20 3532 2c20 3533 2c20 3534 2c20  51, 52, 53, 54, 
+0002b610: 3535 5d5d 290a 0a20 2020 203e 3e3e 2064  55]])..    >>> d
+0002b620: 203d 2066 726f 6d5f 6172 7261 7928 782c   = from_array(x,
+0002b630: 2063 6875 6e6b 733d 2833 2c20 3429 290a   chunks=(3, 4)).
+0002b640: 2020 2020 3e3e 3e20 7265 7375 6c74 203d      >>> result =
+0002b650: 205f 7669 6e64 6578 2864 2c20 5b30 2c20   _vindex(d, [0, 
+0002b660: 312c 2036 2c20 305d 2c20 5b30 2c20 312c  1, 6, 0], [0, 1,
+0002b670: 2030 2c20 375d 290a 2020 2020 3e3e 3e20   0, 7]).    >>> 
+0002b680: 7265 7375 6c74 2e63 6f6d 7075 7465 2829  result.compute()
+0002b690: 0a20 2020 2061 7272 6179 285b 2030 2c20  .    array([ 0, 
+0002b6a0: 2039 2c20 3438 2c20 2037 5d29 0a20 2020   9, 48,  7]).   
+0002b6b0: 2022 2222 0a20 2020 2069 6e64 6578 6573   """.    indexes
+0002b6c0: 203d 2072 6570 6c61 6365 5f65 6c6c 6970   = replace_ellip
+0002b6d0: 7369 7328 782e 6e64 696d 2c20 696e 6465  sis(x.ndim, inde
+0002b6e0: 7865 7329 0a0a 2020 2020 6e6f 6e66 616e  xes)..    nonfan
+0002b6f0: 6379 5f69 6e64 6578 6573 203d 205b 5d0a  cy_indexes = [].
+0002b700: 2020 2020 7265 6475 6365 645f 696e 6465      reduced_inde
+0002b710: 7865 7320 3d20 5b5d 0a20 2020 2066 6f72  xes = [].    for
+0002b720: 2069 6e64 2069 6e20 696e 6465 7865 733a   ind in indexes:
+0002b730: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0002b740: 7374 616e 6365 2869 6e64 2c20 4e75 6d62  stance(ind, Numb
+0002b750: 6572 293a 0a20 2020 2020 2020 2020 2020  er):.           
+0002b760: 206e 6f6e 6661 6e63 795f 696e 6465 7865   nonfancy_indexe
+0002b770: 732e 6170 7065 6e64 2869 6e64 290a 2020  s.append(ind).  
+0002b780: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0002b790: 7461 6e63 6528 696e 642c 2073 6c69 6365  tance(ind, slice
+0002b7a0: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
+0002b7b0: 6f6e 6661 6e63 795f 696e 6465 7865 732e  onfancy_indexes.
+0002b7c0: 6170 7065 6e64 2869 6e64 290a 2020 2020  append(ind).    
+0002b7d0: 2020 2020 2020 2020 7265 6475 6365 645f          reduced_
+0002b7e0: 696e 6465 7865 732e 6170 7065 6e64 2873  indexes.append(s
+0002b7f0: 6c69 6365 284e 6f6e 6529 290a 2020 2020  lice(None)).    
+0002b800: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002b810: 2020 2020 2020 6e6f 6e66 616e 6379 5f69        nonfancy_i
+0002b820: 6e64 6578 6573 2e61 7070 656e 6428 736c  ndexes.append(sl
+0002b830: 6963 6528 4e6f 6e65 2929 0a20 2020 2020  ice(None)).     
+0002b840: 2020 2020 2020 2072 6564 7563 6564 5f69         reduced_i
+0002b850: 6e64 6578 6573 2e61 7070 656e 6428 696e  ndexes.append(in
+0002b860: 6429 0a0a 2020 2020 6e6f 6e66 616e 6379  d)..    nonfancy
+0002b870: 5f69 6e64 6578 6573 203d 2074 7570 6c65  _indexes = tuple
+0002b880: 286e 6f6e 6661 6e63 795f 696e 6465 7865  (nonfancy_indexe
+0002b890: 7329 0a20 2020 2072 6564 7563 6564 5f69  s).    reduced_i
+0002b8a0: 6e64 6578 6573 203d 2074 7570 6c65 2872  ndexes = tuple(r
+0002b8b0: 6564 7563 6564 5f69 6e64 6578 6573 290a  educed_indexes).
+0002b8c0: 0a20 2020 2078 203d 2078 5b6e 6f6e 6661  .    x = x[nonfa
+0002b8d0: 6e63 795f 696e 6465 7865 735d 0a0a 2020  ncy_indexes]..  
+0002b8e0: 2020 6172 7261 795f 696e 6465 7865 7320    array_indexes 
+0002b8f0: 3d20 7b7d 0a20 2020 2066 6f72 2069 2c20  = {}.    for i, 
+0002b900: 2869 6e64 2c20 7369 7a65 2920 696e 2065  (ind, size) in e
+0002b910: 6e75 6d65 7261 7465 287a 6970 2872 6564  numerate(zip(red
+0002b920: 7563 6564 5f69 6e64 6578 6573 2c20 782e  uced_indexes, x.
+0002b930: 7368 6170 6529 293a 0a20 2020 2020 2020  shape)):.       
+0002b940: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0002b950: 6365 2869 6e64 2c20 736c 6963 6529 3a0a  ce(ind, slice):.
+0002b960: 2020 2020 2020 2020 2020 2020 696e 6420              ind 
+0002b970: 3d20 6e70 2e61 7272 6179 2869 6e64 2c20  = np.array(ind, 
+0002b980: 636f 7079 3d54 7275 6529 0a20 2020 2020  copy=True).     
+0002b990: 2020 2020 2020 2069 6620 696e 642e 6474         if ind.dt
+0002b9a0: 7970 652e 6b69 6e64 203d 3d20 2262 223a  ype.kind == "b":
+0002b9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b9c0: 2072 6169 7365 2049 6e64 6578 4572 726f   raise IndexErro
+0002b9d0: 7228 2276 696e 6465 7820 646f 6573 206e  r("vindex does n
+0002b9e0: 6f74 2073 7570 706f 7274 2069 6e64 6578  ot support index
+0002b9f0: 696e 6720 7769 7468 2062 6f6f 6c65 616e  ing with boolean
+0002ba00: 2061 7272 6179 7322 290a 2020 2020 2020   arrays").      
+0002ba10: 2020 2020 2020 6966 2028 2869 6e64 203e        if ((ind >
+0002ba20: 3d20 7369 7a65 2920 7c20 2869 6e64 203c  = size) | (ind <
+0002ba30: 202d 7369 7a65 2929 2e61 6e79 2829 3a0a   -size)).any():.
+0002ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba50: 7261 6973 6520 496e 6465 7845 7272 6f72  raise IndexError
+0002ba60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002ba70: 2020 2020 2020 2276 696e 6465 7820 6b65        "vindex ke
+0002ba80: 7920 6861 7320 656e 7472 6965 7320 6f75  y has entries ou
+0002ba90: 7420 6f66 2062 6f75 6e64 7320 666f 7220  t of bounds for 
+0002baa0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002bab0: 2020 2020 2020 2269 6e64 6578 696e 6720        "indexing 
+0002bac0: 616c 6f6e 6720 6178 6973 2025 7320 6f66  along axis %s of
+0002bad0: 2073 697a 6520 2573 3a20 2572 2220 2520   size %s: %r" % 
+0002bae0: 2869 2c20 7369 7a65 2c20 696e 6429 0a20  (i, size, ind). 
+0002baf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0002bb00: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0002bb10: 2025 3d20 7369 7a65 0a20 2020 2020 2020   %= size.       
+0002bb20: 2020 2020 2061 7272 6179 5f69 6e64 6578       array_index
+0002bb30: 6573 5b69 5d20 3d20 696e 640a 0a20 2020  es[i] = ind..   
+0002bb40: 2069 6620 6172 7261 795f 696e 6465 7865   if array_indexe
+0002bb50: 733a 0a20 2020 2020 2020 2078 203d 205f  s:.        x = _
+0002bb60: 7669 6e64 6578 5f61 7272 6179 2878 2c20  vindex_array(x, 
+0002bb70: 6172 7261 795f 696e 6465 7865 7329 0a0a  array_indexes)..
+0002bb80: 2020 2020 7265 7475 726e 2078 0a0a 0a64      return x...d
+0002bb90: 6566 205f 7669 6e64 6578 5f61 7272 6179  ef _vindex_array
+0002bba0: 2878 2c20 6469 6374 5f69 6e64 6578 6573  (x, dict_indexes
+0002bbb0: 293a 0a20 2020 2022 2222 506f 696e 7420  ):.    """Point 
+0002bbc0: 7769 7365 2069 6e64 6578 696e 6720 7769  wise indexing wi
+0002bbd0: 7468 206f 6e6c 7920 4e75 6d50 7920 4172  th only NumPy Ar
+0002bbe0: 7261 7973 2e22 2222 0a0a 2020 2020 7472  rays."""..    tr
+0002bbf0: 793a 0a20 2020 2020 2020 2062 726f 6164  y:.        broad
+0002bc00: 6361 7374 5f69 6e64 6578 6573 203d 206e  cast_indexes = n
+0002bc10: 702e 6272 6f61 6463 6173 745f 6172 7261  p.broadcast_arra
+0002bc20: 7973 282a 6469 6374 5f69 6e64 6578 6573  ys(*dict_indexes
+0002bc30: 2e76 616c 7565 7328 2929 0a20 2020 2065  .values()).    e
+0002bc40: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+0002bc50: 2061 7320 653a 0a20 2020 2020 2020 2023   as e:.        #
+0002bc60: 206e 6f74 653a 2065 7272 6f72 206d 6573   note: error mes
+0002bc70: 7361 6765 2065 7861 6374 6c79 206d 6174  sage exactly mat
+0002bc80: 6368 6573 206e 756d 7079 0a20 2020 2020  ches numpy.     
+0002bc90: 2020 2073 6861 7065 735f 7374 7220 3d20     shapes_str = 
+0002bca0: 2220 222e 6a6f 696e 2873 7472 2861 2e73  " ".join(str(a.s
+0002bcb0: 6861 7065 2920 666f 7220 6120 696e 2064  hape) for a in d
+0002bcc0: 6963 745f 696e 6465 7865 732e 7661 6c75  ict_indexes.valu
+0002bcd0: 6573 2829 290a 2020 2020 2020 2020 7261  es()).        ra
+0002bce0: 6973 6520 496e 6465 7845 7272 6f72 280a  ise IndexError(.
+0002bcf0: 2020 2020 2020 2020 2020 2020 2273 6861              "sha
+0002bd00: 7065 206d 6973 6d61 7463 683a 2069 6e64  pe mismatch: ind
+0002bd10: 6578 696e 6720 6172 7261 7973 2063 6f75  exing arrays cou
+0002bd20: 6c64 206e 6f74 2062 6520 220a 2020 2020  ld not be ".    
+0002bd30: 2020 2020 2020 2020 2262 726f 6164 6361          "broadca
+0002bd40: 7374 2074 6f67 6574 6865 7220 7769 7468  st together with
+0002bd50: 2073 6861 7065 7320 2220 2b20 7368 6170   shapes " + shap
+0002bd60: 6573 5f73 7472 0a20 2020 2020 2020 2029  es_str.        )
+0002bd70: 2066 726f 6d20 650a 2020 2020 6272 6f61   from e.    broa
+0002bd80: 6463 6173 745f 7368 6170 6520 3d20 6272  dcast_shape = br
+0002bd90: 6f61 6463 6173 745f 696e 6465 7865 735b  oadcast_indexes[
+0002bda0: 305d 2e73 6861 7065 0a0a 2020 2020 6c6f  0].shape..    lo
+0002bdb0: 6f6b 7570 203d 2064 6963 7428 7a69 7028  okup = dict(zip(
+0002bdc0: 6469 6374 5f69 6e64 6578 6573 2c20 6272  dict_indexes, br
+0002bdd0: 6f61 6463 6173 745f 696e 6465 7865 7329  oadcast_indexes)
+0002bde0: 290a 2020 2020 666c 6174 5f69 6e64 6578  ).    flat_index
+0002bdf0: 6573 203d 205b 0a20 2020 2020 2020 206c  es = [.        l
+0002be00: 6f6f 6b75 705b 695d 2e72 6176 656c 2829  ookup[i].ravel()
+0002be10: 2e74 6f6c 6973 7428 2920 6966 2069 2069  .tolist() if i i
+0002be20: 6e20 6c6f 6f6b 7570 2065 6c73 6520 4e6f  n lookup else No
+0002be30: 6e65 2066 6f72 2069 2069 6e20 7261 6e67  ne for i in rang
+0002be40: 6528 782e 6e64 696d 290a 2020 2020 5d0a  e(x.ndim).    ].
+0002be50: 2020 2020 666c 6174 5f69 6e64 6578 6573      flat_indexes
+0002be60: 2e65 7874 656e 6428 5b4e 6f6e 655d 202a  .extend([None] *
+0002be70: 2028 782e 6e64 696d 202d 206c 656e 2866   (x.ndim - len(f
+0002be80: 6c61 745f 696e 6465 7865 7329 2929 0a0a  lat_indexes)))..
+0002be90: 2020 2020 666c 6174 5f69 6e64 6578 6573      flat_indexes
+0002bea0: 203d 205b 0a20 2020 2020 2020 206c 6973   = [.        lis
+0002beb0: 7428 696e 6465 7829 2069 6620 696e 6465  t(index) if inde
+0002bec0: 7820 6973 206e 6f74 204e 6f6e 6520 656c  x is not None el
+0002bed0: 7365 2069 6e64 6578 2066 6f72 2069 6e64  se index for ind
+0002bee0: 6578 2069 6e20 666c 6174 5f69 6e64 6578  ex in flat_index
+0002bef0: 6573 0a20 2020 205d 0a20 2020 2062 6f75  es.    ].    bou
+0002bf00: 6e64 7320 3d20 5b6c 6973 7428 6163 6375  nds = [list(accu
+0002bf10: 6d75 6c61 7465 2861 6464 2c20 2830 2c29  mulate(add, (0,)
+0002bf20: 202b 2063 2929 2066 6f72 2063 2069 6e20   + c)) for c in 
+0002bf30: 782e 6368 756e 6b73 5d0a 2020 2020 626f  x.chunks].    bo
+0002bf40: 756e 6473 3220 3d20 5b62 2066 6f72 2069  unds2 = [b for i
+0002bf50: 2c20 6220 696e 207a 6970 2866 6c61 745f  , b in zip(flat_
+0002bf60: 696e 6465 7865 732c 2062 6f75 6e64 7329  indexes, bounds)
+0002bf70: 2069 6620 6920 6973 206e 6f74 204e 6f6e   if i is not Non
+0002bf80: 655d 0a20 2020 2061 7869 7320 3d20 5f67  e].    axis = _g
+0002bf90: 6574 5f61 7869 7328 666c 6174 5f69 6e64  et_axis(flat_ind
+0002bfa0: 6578 6573 290a 2020 2020 746f 6b65 6e20  exes).    token 
+0002bfb0: 3d20 746f 6b65 6e69 7a65 2878 2c20 666c  = tokenize(x, fl
+0002bfc0: 6174 5f69 6e64 6578 6573 290a 2020 2020  at_indexes).    
+0002bfd0: 6f75 745f 6e61 6d65 203d 2022 7669 6e64  out_name = "vind
+0002bfe0: 6578 2d6d 6572 6765 2d22 202b 2074 6f6b  ex-merge-" + tok
+0002bff0: 656e 0a0a 2020 2020 706f 696e 7473 203d  en..    points =
+0002c000: 206c 6973 7428 290a 2020 2020 666f 7220   list().    for 
+0002c010: 692c 2069 6478 2069 6e20 656e 756d 6572  i, idx in enumer
+0002c020: 6174 6528 7a69 7028 2a5b 6920 666f 7220  ate(zip(*[i for 
+0002c030: 6920 696e 2066 6c61 745f 696e 6465 7865  i in flat_indexe
+0002c040: 7320 6966 2069 2069 7320 6e6f 7420 4e6f  s if i is not No
+0002c050: 6e65 5d29 293a 0a20 2020 2020 2020 2062  ne])):.        b
+0002c060: 6c6f 636b 5f69 6478 203d 205b 6269 7365  lock_idx = [bise
+0002c070: 6374 2862 2c20 696e 6429 202d 2031 2066  ct(b, ind) - 1 f
+0002c080: 6f72 2062 2c20 696e 6420 696e 207a 6970  or b, ind in zip
+0002c090: 2862 6f75 6e64 7332 2c20 6964 7829 5d0a  (bounds2, idx)].
+0002c0a0: 2020 2020 2020 2020 696e 626c 6f63 6b5f          inblock_
+0002c0b0: 6964 7820 3d20 5b0a 2020 2020 2020 2020  idx = [.        
+0002c0c0: 2020 2020 696e 6420 2d20 626f 756e 6473      ind - bounds
+0002c0d0: 325b 6b5d 5b6a 5d20 666f 7220 6b2c 2028  2[k][j] for k, (
+0002c0e0: 696e 642c 206a 2920 696e 2065 6e75 6d65  ind, j) in enume
+0002c0f0: 7261 7465 287a 6970 2869 6478 2c20 626c  rate(zip(idx, bl
+0002c100: 6f63 6b5f 6964 7829 290a 2020 2020 2020  ock_idx)).      
+0002c110: 2020 5d0a 2020 2020 2020 2020 706f 696e    ].        poin
+0002c120: 7473 2e61 7070 656e 6428 2869 2c20 7475  ts.append((i, tu
+0002c130: 706c 6528 626c 6f63 6b5f 6964 7829 2c20  ple(block_idx), 
+0002c140: 7475 706c 6528 696e 626c 6f63 6b5f 6964  tuple(inblock_id
+0002c150: 7829 2929 0a0a 2020 2020 6368 756e 6b73  x)))..    chunks
+0002c160: 203d 205b 6320 666f 7220 692c 2063 2069   = [c for i, c i
+0002c170: 6e20 7a69 7028 666c 6174 5f69 6e64 6578  n zip(flat_index
+0002c180: 6573 2c20 782e 6368 756e 6b73 2920 6966  es, x.chunks) if
+0002c190: 2069 2069 7320 4e6f 6e65 5d0a 2020 2020   i is None].    
+0002c1a0: 6368 756e 6b73 2e69 6e73 6572 7428 302c  chunks.insert(0,
+0002c1b0: 2028 6c65 6e28 706f 696e 7473 292c 2920   (len(points),) 
+0002c1c0: 6966 2070 6f69 6e74 7320 656c 7365 2028  if points else (
+0002c1d0: 302c 2929 0a20 2020 2063 6875 6e6b 7320  0,)).    chunks 
+0002c1e0: 3d20 7475 706c 6528 6368 756e 6b73 290a  = tuple(chunks).
+0002c1f0: 0a20 2020 2069 6620 706f 696e 7473 3a0a  .    if points:.
+0002c200: 2020 2020 2020 2020 7065 725f 626c 6f63          per_bloc
+0002c210: 6b20 3d20 6772 6f75 7062 7928 312c 2070  k = groupby(1, p
+0002c220: 6f69 6e74 7329 0a20 2020 2020 2020 2070  oints).        p
+0002c230: 6572 5f62 6c6f 636b 203d 207b 6b3a 2076  er_block = {k: v
+0002c240: 2066 6f72 206b 2c20 7620 696e 2070 6572   for k, v in per
+0002c250: 5f62 6c6f 636b 2e69 7465 6d73 2829 2069  _block.items() i
+0002c260: 6620 767d 0a0a 2020 2020 2020 2020 6f74  f v}..        ot
+0002c270: 6865 725f 626c 6f63 6b73 203d 206c 6973  her_blocks = lis
+0002c280: 7428 0a20 2020 2020 2020 2020 2020 2070  t(.            p
+0002c290: 726f 6475 6374 280a 2020 2020 2020 2020  roduct(.        
+0002c2a0: 2020 2020 2020 2020 2a5b 0a20 2020 2020          *[.     
+0002c2b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0002c2c0: 6973 7428 7261 6e67 6528 6c65 6e28 6329  ist(range(len(c)
+0002c2d0: 2929 2069 6620 6920 6973 204e 6f6e 6520  )) if i is None 
+0002c2e0: 656c 7365 205b 4e6f 6e65 5d0a 2020 2020  else [None].    
+0002c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c300: 666f 7220 692c 2063 2069 6e20 7a69 7028  for i, c in zip(
+0002c310: 666c 6174 5f69 6e64 6578 6573 2c20 782e  flat_indexes, x.
+0002c320: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
+0002c330: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0002c340: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0002c350: 290a 0a20 2020 2020 2020 2066 756c 6c5f  )..        full_
+0002c360: 736c 6963 6573 203d 205b 736c 6963 6528  slices = [slice(
+0002c370: 4e6f 6e65 2c20 4e6f 6e65 2920 6966 2069  None, None) if i
+0002c380: 2069 7320 4e6f 6e65 2065 6c73 6520 4e6f   is None else No
+0002c390: 6e65 2066 6f72 2069 2069 6e20 666c 6174  ne for i in flat
+0002c3a0: 5f69 6e64 6578 6573 5d0a 0a20 2020 2020  _indexes]..     
+0002c3b0: 2020 206e 616d 6520 3d20 2276 696e 6465     name = "vinde
+0002c3c0: 782d 736c 6963 652d 2220 2b20 746f 6b65  x-slice-" + toke
+0002c3d0: 6e0a 2020 2020 2020 2020 7669 6e64 6578  n.        vindex
+0002c3e0: 5f6d 6572 6765 5f6e 616d 6520 3d20 2276  _merge_name = "v
+0002c3f0: 696e 6465 782d 6d65 7267 652d 2220 2b20  index-merge-" + 
+0002c400: 746f 6b65 6e0a 2020 2020 2020 2020 6473  token.        ds
+0002c410: 6b20 3d20 7b7d 0a20 2020 2020 2020 2066  k = {}.        f
+0002c420: 6f72 206f 6b65 7920 696e 206f 7468 6572  or okey in other
+0002c430: 5f62 6c6f 636b 733a 0a20 2020 2020 2020  _blocks:.       
+0002c440: 2020 2020 2066 6f72 2069 2c20 6b65 7920       for i, key 
+0002c450: 696e 2065 6e75 6d65 7261 7465 2870 6572  in enumerate(per
+0002c460: 5f62 6c6f 636b 293a 0a20 2020 2020 2020  _block):.       
+0002c470: 2020 2020 2020 2020 2064 736b 5b6b 6579           dsk[key
+0002c480: 6e61 6d65 286e 616d 652c 2069 2c20 6f6b  name(name, i, ok
+0002c490: 6579 295d 203d 2028 0a20 2020 2020 2020  ey)] = (.       
+0002c4a0: 2020 2020 2020 2020 2020 2020 205f 7669               _vi
+0002c4b0: 6e64 6578 5f74 7261 6e73 706f 7365 2c0a  ndex_transpose,.
+0002c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c4d0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+0002c4e0: 2020 2020 2020 2020 2020 2020 2020 5f76                _v
+0002c4f0: 696e 6465 785f 736c 6963 652c 0a20 2020  index_slice,.   
+0002c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c510: 2020 2020 2028 782e 6e61 6d65 2c29 202b       (x.name,) +
+0002c520: 2069 6e74 6572 6c65 6176 655f 6e6f 6e65   interleave_none
+0002c530: 286f 6b65 792c 206b 6579 292c 0a20 2020  (okey, key),.   
+0002c540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c550: 2020 2020 2069 6e74 6572 6c65 6176 655f       interleave_
+0002c560: 6e6f 6e65 280a 2020 2020 2020 2020 2020  none(.          
+0002c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c580: 2020 6675 6c6c 5f73 6c69 6365 732c 206c    full_slices, l
+0002c590: 6973 7428 7a69 7028 2a70 6c75 636b 2832  ist(zip(*pluck(2
+0002c5a0: 2c20 7065 725f 626c 6f63 6b5b 6b65 795d  , per_block[key]
+0002c5b0: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
+0002c5c0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+0002c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c5e0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+0002c5f0: 2020 2020 2020 2020 2020 6178 6973 2c0a            axis,.
+0002c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c610: 290a 2020 2020 2020 2020 2020 2020 6473  ).            ds
+0002c620: 6b5b 6b65 796e 616d 6528 7669 6e64 6578  k[keyname(vindex
+0002c630: 5f6d 6572 6765 5f6e 616d 652c 2030 2c20  _merge_name, 0, 
+0002c640: 6f6b 6579 295d 203d 2028 0a20 2020 2020  okey)] = (.     
+0002c650: 2020 2020 2020 2020 2020 205f 7669 6e64             _vind
+0002c660: 6578 5f6d 6572 6765 2c0a 2020 2020 2020  ex_merge,.      
+0002c670: 2020 2020 2020 2020 2020 5b6c 6973 7428            [list(
+0002c680: 706c 7563 6b28 302c 2070 6572 5f62 6c6f  pluck(0, per_blo
+0002c690: 636b 5b6b 6579 5d29 2920 666f 7220 6b65  ck[key])) for ke
+0002c6a0: 7920 696e 2070 6572 5f62 6c6f 636b 5d2c  y in per_block],
+0002c6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c6c0: 205b 6b65 796e 616d 6528 6e61 6d65 2c20   [keyname(name, 
+0002c6d0: 692c 206f 6b65 7929 2066 6f72 2069 2069  i, okey) for i i
+0002c6e0: 6e20 7261 6e67 6528 6c65 6e28 7065 725f  n range(len(per_
+0002c6f0: 626c 6f63 6b29 295d 2c0a 2020 2020 2020  block))],.      
+0002c700: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0002c710: 2072 6573 756c 745f 3164 203d 2041 7272   result_1d = Arr
+0002c720: 6179 280a 2020 2020 2020 2020 2020 2020  ay(.            
+0002c730: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+0002c740: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+0002c750: 6f75 745f 6e61 6d65 2c20 6473 6b2c 2064  out_name, dsk, d
+0002c760: 6570 656e 6465 6e63 6965 733d 5b78 5d29  ependencies=[x])
+0002c770: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+0002c780: 745f 6e61 6d65 2c0a 2020 2020 2020 2020  t_name,.        
+0002c790: 2020 2020 6368 756e 6b73 2c0a 2020 2020      chunks,.    
+0002c7a0: 2020 2020 2020 2020 782e 6474 7970 652c          x.dtype,
+0002c7b0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0002c7c0: 613d 782e 5f6d 6574 612c 0a20 2020 2020  a=x._meta,.     
+0002c7d0: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+0002c7e0: 7572 6e20 7265 7375 6c74 5f31 642e 7265  urn result_1d.re
+0002c7f0: 7368 6170 6528 6272 6f61 6463 6173 745f  shape(broadcast_
+0002c800: 7368 6170 6520 2b20 7265 7375 6c74 5f31  shape + result_1
+0002c810: 642e 7368 6170 655b 313a 5d29 0a0a 2020  d.shape[1:])..  
+0002c820: 2020 2320 6f75 7470 7574 2068 6173 2061    # output has a
+0002c830: 207a 6572 6f20 6469 6d65 6e73 696f 6e2c   zero dimension,
+0002c840: 206a 7573 7420 6372 6561 7465 2061 206e   just create a n
+0002c850: 6577 207a 6572 6f2d 7368 6170 6520 6172  ew zero-shape ar
+0002c860: 7261 7920 7769 7468 2074 6865 0a20 2020  ray with the.   
+0002c870: 2023 2073 616d 6520 6474 7970 650a 2020   # same dtype.  
+0002c880: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+0002c890: 792e 7772 6170 2069 6d70 6f72 7420 656d  y.wrap import em
+0002c8a0: 7074 790a 0a20 2020 2072 6573 756c 745f  pty..    result_
+0002c8b0: 3164 203d 2065 6d70 7479 280a 2020 2020  1d = empty(.    
+0002c8c0: 2020 2020 7475 706c 6528 6d61 7028 7375      tuple(map(su
+0002c8d0: 6d2c 2063 6875 6e6b 7329 292c 2063 6875  m, chunks)), chu
+0002c8e0: 6e6b 733d 6368 756e 6b73 2c20 6474 7970  nks=chunks, dtyp
+0002c8f0: 653d 782e 6474 7970 652c 206e 616d 653d  e=x.dtype, name=
+0002c900: 6f75 745f 6e61 6d65 0a20 2020 2029 0a20  out_name.    ). 
+0002c910: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0002c920: 5f31 642e 7265 7368 6170 6528 6272 6f61  _1d.reshape(broa
+0002c930: 6463 6173 745f 7368 6170 6520 2b20 7265  dcast_shape + re
+0002c940: 7375 6c74 5f31 642e 7368 6170 655b 313a  sult_1d.shape[1:
+0002c950: 5d29 0a0a 0a64 6566 205f 6765 745f 6178  ])...def _get_ax
+0002c960: 6973 2869 6e64 6578 6573 293a 0a20 2020  is(indexes):.   
+0002c970: 2022 2222 4765 7420 6178 6973 2061 6c6f   """Get axis alo
+0002c980: 6e67 2077 6869 6368 2070 6f69 6e74 2d77  ng which point-w
+0002c990: 6973 6520 736c 6963 696e 6720 7265 7375  ise slicing resu
+0002c9a0: 6c74 7320 6c69 650a 0a20 2020 2054 6869  lts lie..    Thi
+0002c9b0: 7320 6973 206d 6f73 746c 7920 6120 6861  s is mostly a ha
+0002c9c0: 636b 2062 6563 6175 7365 2049 2063 616e  ck because I can
+0002c9d0: 2774 2066 6967 7572 6520 6f75 7420 4e75  't figure out Nu
+0002c9e0: 6d50 7927 7320 7275 6c65 206f 6e20 7468  mPy's rule on th
+0002c9f0: 6973 2061 6e64 0a20 2020 2063 616e 2774  is and.    can't
+0002ca00: 2062 6520 626f 7468 6572 6564 2074 6f20   be bothered to 
+0002ca10: 676f 2072 6561 6469 6e67 2e0a 0a20 2020  go reading...   
+0002ca20: 203e 3e3e 205f 6765 745f 6178 6973 285b   >>> _get_axis([
+0002ca30: 5b31 2c20 325d 2c20 4e6f 6e65 2c20 5b31  [1, 2], None, [1
+0002ca40: 2c20 325d 2c20 4e6f 6e65 5d29 0a20 2020  , 2], None]).   
+0002ca50: 2030 0a20 2020 203e 3e3e 205f 6765 745f   0.    >>> _get_
+0002ca60: 6178 6973 285b 4e6f 6e65 2c20 5b31 2c20  axis([None, [1, 
+0002ca70: 325d 2c20 5b31 2c20 325d 2c20 4e6f 6e65  2], [1, 2], None
+0002ca80: 5d29 0a20 2020 2031 0a20 2020 203e 3e3e  ]).    1.    >>>
+0002ca90: 205f 6765 745f 6178 6973 285b 4e6f 6e65   _get_axis([None
+0002caa0: 2c20 4e6f 6e65 2c20 5b31 2c20 325d 2c20  , None, [1, 2], 
+0002cab0: 5b31 2c20 325d 5d29 0a20 2020 2032 0a20  [1, 2]]).    2. 
+0002cac0: 2020 2022 2222 0a20 2020 206e 6469 6d20     """.    ndim 
+0002cad0: 3d20 6c65 6e28 696e 6465 7865 7329 0a20  = len(indexes). 
+0002cae0: 2020 2069 6e64 6578 6573 203d 205b 736c     indexes = [sl
+0002caf0: 6963 6528 4e6f 6e65 2c20 4e6f 6e65 2920  ice(None, None) 
+0002cb00: 6966 2069 2069 7320 4e6f 6e65 2065 6c73  if i is None els
+0002cb10: 6520 5b30 5d20 666f 7220 6920 696e 2069  e [0] for i in i
+0002cb20: 6e64 6578 6573 5d0a 2020 2020 7820 3d20  ndexes].    x = 
+0002cb30: 6e70 2e65 6d70 7479 2828 322c 2920 2a20  np.empty((2,) * 
+0002cb40: 6e64 696d 290a 2020 2020 7832 203d 2078  ndim).    x2 = x
+0002cb50: 5b74 7570 6c65 2869 6e64 6578 6573 295d  [tuple(indexes)]
+0002cb60: 0a20 2020 2072 6574 7572 6e20 7832 2e73  .    return x2.s
+0002cb70: 6861 7065 2e69 6e64 6578 2831 290a 0a0a  hape.index(1)...
+0002cb80: 6465 6620 5f76 696e 6465 785f 736c 6963  def _vindex_slic
+0002cb90: 6528 626c 6f63 6b2c 2070 6f69 6e74 7329  e(block, points)
+0002cba0: 3a0a 2020 2020 2222 2250 756c 6c20 6f75  :.    """Pull ou
+0002cbb0: 7420 706f 696e 742d 7769 7365 2073 6c69  t point-wise sli
+0002cbc0: 6365 7320 6672 6f6d 2062 6c6f 636b 2222  ces from block""
+0002cbd0: 220a 2020 2020 706f 696e 7473 203d 205b  ".    points = [
+0002cbe0: 7020 6966 2069 7369 6e73 7461 6e63 6528  p if isinstance(
+0002cbf0: 702c 2073 6c69 6365 2920 656c 7365 206c  p, slice) else l
+0002cc00: 6973 7428 7029 2066 6f72 2070 2069 6e20  ist(p) for p in 
+0002cc10: 706f 696e 7473 5d0a 2020 2020 7265 7475  points].    retu
+0002cc20: 726e 2062 6c6f 636b 5b74 7570 6c65 2870  rn block[tuple(p
+0002cc30: 6f69 6e74 7329 5d0a 0a0a 6465 6620 5f76  oints)]...def _v
+0002cc40: 696e 6465 785f 7472 616e 7370 6f73 6528  index_transpose(
+0002cc50: 626c 6f63 6b2c 2061 7869 7329 3a0a 2020  block, axis):.  
+0002cc60: 2020 2222 2252 6f74 6174 6520 626c 6f63    """Rotate bloc
+0002cc70: 6b20 736f 2074 6861 7420 706f 696e 7473  k so that points
+0002cc80: 2061 7265 206f 6e20 7468 6520 6669 7273   are on the firs
+0002cc90: 7420 6469 6d65 6e73 696f 6e22 2222 0a20  t dimension""". 
+0002cca0: 2020 2061 7865 7320 3d20 5b61 7869 735d     axes = [axis]
+0002ccb0: 202b 206c 6973 7428 7261 6e67 6528 6178   + list(range(ax
+0002ccc0: 6973 2929 202b 206c 6973 7428 7261 6e67  is)) + list(rang
+0002ccd0: 6528 6178 6973 202b 2031 2c20 626c 6f63  e(axis + 1, bloc
+0002cce0: 6b2e 6e64 696d 2929 0a20 2020 2072 6574  k.ndim)).    ret
+0002ccf0: 7572 6e20 626c 6f63 6b2e 7472 616e 7370  urn block.transp
+0002cd00: 6f73 6528 6178 6573 290a 0a0a 6465 6620  ose(axes)...def 
+0002cd10: 5f76 696e 6465 785f 6d65 7267 6528 6c6f  _vindex_merge(lo
+0002cd20: 6361 7469 6f6e 732c 2076 616c 7565 7329  cations, values)
+0002cd30: 3a0a 2020 2020 2222 220a 0a20 2020 203e  :.    """..    >
+0002cd40: 3e3e 206c 6f63 6174 696f 6e73 203d 205b  >> locations = [
+0002cd50: 305d 2c20 5b32 2c20 315d 0a20 2020 203e  0], [2, 1].    >
+0002cd60: 3e3e 2076 616c 7565 7320 3d20 5b6e 702e  >> values = [np.
+0002cd70: 6172 7261 7928 5b5b 312c 2032 2c20 335d  array([[1, 2, 3]
+0002cd80: 5d29 2c0a 2020 2020 2e2e 2e20 2020 2020  ]),.    ...     
+0002cd90: 2020 2020 2020 6e70 2e61 7272 6179 285b        np.array([
+0002cda0: 5b31 302c 2032 302c 2033 305d 2c20 5b34  [10, 20, 30], [4
+0002cdb0: 302c 2035 302c 2036 305d 5d29 5d0a 0a20  0, 50, 60]])].. 
+0002cdc0: 2020 203e 3e3e 205f 7669 6e64 6578 5f6d     >>> _vindex_m
+0002cdd0: 6572 6765 286c 6f63 6174 696f 6e73 2c20  erge(locations, 
+0002cde0: 7661 6c75 6573 290a 2020 2020 6172 7261  values).    arra
+0002cdf0: 7928 5b5b 2031 2c20 2032 2c20 2033 5d2c  y([[ 1,  2,  3],
+0002ce00: 0a20 2020 2020 2020 2020 2020 5b34 302c  .           [40,
+0002ce10: 2035 302c 2036 305d 2c0a 2020 2020 2020   50, 60],.      
+0002ce20: 2020 2020 205b 3130 2c20 3230 2c20 3330       [10, 20, 30
+0002ce30: 5d5d 290a 2020 2020 2222 220a 2020 2020  ]]).    """.    
+0002ce40: 6c6f 6361 7469 6f6e 7320 3d20 6c69 7374  locations = list
+0002ce50: 286d 6170 286c 6973 742c 206c 6f63 6174  (map(list, locat
+0002ce60: 696f 6e73 2929 0a20 2020 2076 616c 7565  ions)).    value
+0002ce70: 7320 3d20 6c69 7374 2876 616c 7565 7329  s = list(values)
+0002ce80: 0a0a 2020 2020 6e20 3d20 7375 6d28 6d61  ..    n = sum(ma
+0002ce90: 7028 6c65 6e2c 206c 6f63 6174 696f 6e73  p(len, locations
+0002cea0: 2929 0a0a 2020 2020 7368 6170 6520 3d20  ))..    shape = 
+0002ceb0: 6c69 7374 2876 616c 7565 735b 305d 2e73  list(values[0].s
+0002cec0: 6861 7065 290a 2020 2020 7368 6170 655b  hape).    shape[
+0002ced0: 305d 203d 206e 0a20 2020 2073 6861 7065  0] = n.    shape
+0002cee0: 203d 2074 7570 6c65 2873 6861 7065 290a   = tuple(shape).
+0002cef0: 0a20 2020 2064 7479 7065 203d 2076 616c  .    dtype = val
+0002cf00: 7565 735b 305d 2e64 7479 7065 0a0a 2020  ues[0].dtype..  
+0002cf10: 2020 7820 3d20 6e70 2e65 6d70 7479 5f6c    x = np.empty_l
+0002cf20: 696b 6528 7661 6c75 6573 5b30 5d2c 2064  ike(values[0], d
+0002cf30: 7479 7065 3d64 7479 7065 2c20 7368 6170  type=dtype, shap
+0002cf40: 653d 7368 6170 6529 0a0a 2020 2020 696e  e=shape)..    in
+0002cf50: 6420 3d20 5b73 6c69 6365 284e 6f6e 652c  d = [slice(None,
+0002cf60: 204e 6f6e 6529 2066 6f72 2069 2069 6e20   None) for i in 
+0002cf70: 7261 6e67 6528 782e 6e64 696d 295d 0a20  range(x.ndim)]. 
+0002cf80: 2020 2066 6f72 206c 6f63 2c20 7661 6c20     for loc, val 
+0002cf90: 696e 207a 6970 286c 6f63 6174 696f 6e73  in zip(locations
+0002cfa0: 2c20 7661 6c75 6573 293a 0a20 2020 2020  , values):.     
+0002cfb0: 2020 2069 6e64 5b30 5d20 3d20 6c6f 630a     ind[0] = loc.
+0002cfc0: 2020 2020 2020 2020 785b 7475 706c 6528          x[tuple(
+0002cfd0: 696e 6429 5d20 3d20 7661 6c0a 0a20 2020  ind)] = val..   
+0002cfe0: 2072 6574 7572 6e20 780a 0a0a 6465 6620   return x...def 
+0002cff0: 746f 5f6e 7079 5f73 7461 636b 2864 6972  to_npy_stack(dir
+0002d000: 6e61 6d65 2c20 782c 2061 7869 733d 3029  name, x, axis=0)
+0002d010: 3a0a 2020 2020 2222 2257 7269 7465 2064  :.    """Write d
+0002d020: 6173 6b20 6172 7261 7920 746f 2061 2073  ask array to a s
+0002d030: 7461 636b 206f 6620 2e6e 7079 2066 696c  tack of .npy fil
+0002d040: 6573 0a0a 2020 2020 5468 6973 2070 6172  es..    This par
+0002d050: 7469 7469 6f6e 7320 7468 6520 6461 736b  titions the dask
+0002d060: 2e61 7272 6179 2061 6c6f 6e67 206f 6e65  .array along one
+0002d070: 2061 7869 7320 616e 6420 7374 6f72 6573   axis and stores
+0002d080: 2065 6163 6820 626c 6f63 6b20 616c 6f6e   each block alon
+0002d090: 670a 2020 2020 7468 6174 2061 7869 7320  g.    that axis 
+0002d0a0: 6173 2061 2073 696e 676c 6520 2e6e 7079  as a single .npy
+0002d0b0: 2066 696c 6520 696e 2074 6865 2073 7065   file in the spe
+0002d0c0: 6369 6669 6564 2064 6972 6563 746f 7279  cified directory
+0002d0d0: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
+0002d0e0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0002d0f0: 3e3e 3e20 7820 3d20 6461 2e6f 6e65 7328  >>> x = da.ones(
+0002d100: 2835 2c20 3130 2c20 3130 292c 2063 6875  (5, 10, 10), chu
+0002d110: 6e6b 733d 2832 2c20 342c 2034 2929 2020  nks=(2, 4, 4))  
+0002d120: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0002d130: 0a20 2020 203e 3e3e 2064 612e 746f 5f6e  .    >>> da.to_n
+0002d140: 7079 5f73 7461 636b 2827 6461 7461 2f27  py_stack('data/'
+0002d150: 2c20 782c 2061 7869 733d 3029 2020 2320  , x, axis=0)  # 
+0002d160: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
+0002d170: 2020 2020 5468 6520 6060 2e6e 7079 6060      The ``.npy``
+0002d180: 2066 696c 6573 2073 746f 7265 206e 756d   files store num
+0002d190: 7079 2061 7272 6179 7320 666f 7220 6060  py arrays for ``
+0002d1a0: 785b 303a 325d 2c20 785b 323a 345d 2c20  x[0:2], x[2:4], 
+0002d1b0: 616e 6420 785b 343a 355d 6060 0a20 2020  and x[4:5]``.   
+0002d1c0: 2072 6573 7065 6374 6976 656c 792c 2061   respectively, a
+0002d1d0: 7320 6973 2073 7065 6369 6669 6564 2062  s is specified b
+0002d1e0: 7920 7468 6520 6368 756e 6b20 7369 7a65  y the chunk size
+0002d1f0: 2061 6c6f 6e67 2074 6865 207a 6572 6f74   along the zerot
+0002d200: 6820 6178 6973 3a3a 0a0a 2020 2020 2020  h axis::..      
+0002d210: 2020 2420 7472 6565 2064 6174 612f 0a20    $ tree data/. 
+0002d220: 2020 2020 2020 2064 6174 612f 0a20 2020         data/.   
+0002d230: 2020 2020 207c 2d2d 2030 2e6e 7079 0a20       |-- 0.npy. 
+0002d240: 2020 2020 2020 207c 2d2d 2031 2e6e 7079         |-- 1.npy
+0002d250: 0a20 2020 2020 2020 207c 2d2d 2032 2e6e  .        |-- 2.n
+0002d260: 7079 0a20 2020 2020 2020 207c 2d2d 2069  py.        |-- i
+0002d270: 6e66 6f0a 0a20 2020 2054 6865 2060 6069  nfo..    The ``i
+0002d280: 6e66 6f60 6020 6669 6c65 2073 746f 7265  nfo`` file store
+0002d290: 7320 7468 6520 6474 7970 652c 2063 6875  s the dtype, chu
+0002d2a0: 6e6b 732c 2061 6e64 2061 7869 7320 696e  nks, and axis in
+0002d2b0: 666f 726d 6174 696f 6e20 6f66 2074 6865  formation of the
+0002d2c0: 2061 7272 6179 2e0a 2020 2020 596f 7520   array..    You 
+0002d2d0: 6361 6e20 6c6f 6164 2074 6865 7365 2073  can load these s
+0002d2e0: 7461 636b 7320 7769 7468 2074 6865 203a  tacks with the :
+0002d2f0: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+0002d300: 2e66 726f 6d5f 6e70 795f 7374 6163 6b60  .from_npy_stack`
+0002d310: 2066 756e 6374 696f 6e2e 0a0a 2020 2020   function...    
+0002d320: 3e3e 3e20 7920 3d20 6461 2e66 726f 6d5f  >>> y = da.from_
+0002d330: 6e70 795f 7374 6163 6b28 2764 6174 612f  npy_stack('data/
+0002d340: 2729 2020 2320 646f 6374 6573 743a 202b  ')  # doctest: +
+0002d350: 534b 4950 0a0a 2020 2020 5365 6520 416c  SKIP..    See Al
+0002d360: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
+0002d370: 2020 2020 6672 6f6d 5f6e 7079 5f73 7461      from_npy_sta
+0002d380: 636b 0a20 2020 2022 2222 0a0a 2020 2020  ck.    """..    
+0002d390: 6368 756e 6b73 203d 2074 7570 6c65 2828  chunks = tuple((
+0002d3a0: 6320 6966 2069 203d 3d20 6178 6973 2065  c if i == axis e
+0002d3b0: 6c73 6520 2873 756d 2863 292c 2929 2066  lse (sum(c),)) f
+0002d3c0: 6f72 2069 2c20 6320 696e 2065 6e75 6d65  or i, c in enume
+0002d3d0: 7261 7465 2878 2e63 6875 6e6b 7329 290a  rate(x.chunks)).
+0002d3e0: 2020 2020 7878 203d 2078 2e72 6563 6875      xx = x.rechu
+0002d3f0: 6e6b 2863 6875 6e6b 7329 0a0a 2020 2020  nk(chunks)..    
+0002d400: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+0002d410: 7869 7374 7328 6469 726e 616d 6529 3a0a  xists(dirname):.
+0002d420: 2020 2020 2020 2020 6f73 2e6d 6b64 6972          os.mkdir
+0002d430: 2864 6972 6e61 6d65 290a 0a20 2020 206d  (dirname)..    m
+0002d440: 6574 6120 3d20 7b22 6368 756e 6b73 223a  eta = {"chunks":
+0002d450: 2063 6875 6e6b 732c 2022 6474 7970 6522   chunks, "dtype"
+0002d460: 3a20 782e 6474 7970 652c 2022 6178 6973  : x.dtype, "axis
+0002d470: 223a 2061 7869 737d 0a0a 2020 2020 7769  ": axis}..    wi
+0002d480: 7468 206f 7065 6e28 6f73 2e70 6174 682e  th open(os.path.
+0002d490: 6a6f 696e 2864 6972 6e61 6d65 2c20 2269  join(dirname, "i
+0002d4a0: 6e66 6f22 292c 2022 7762 2229 2061 7320  nfo"), "wb") as 
+0002d4b0: 663a 0a20 2020 2020 2020 2070 6963 6b6c  f:.        pickl
+0002d4c0: 652e 6475 6d70 286d 6574 612c 2066 290a  e.dump(meta, f).
+0002d4d0: 0a20 2020 206e 616d 6520 3d20 2274 6f2d  .    name = "to-
+0002d4e0: 6e70 792d 7374 6163 6b2d 2220 2b20 7374  npy-stack-" + st
+0002d4f0: 7228 7575 6964 2e75 7569 6431 2829 290a  r(uuid.uuid1()).
+0002d500: 2020 2020 6473 6b20 3d20 7b0a 2020 2020      dsk = {.    
+0002d510: 2020 2020 286e 616d 652c 2069 293a 2028      (name, i): (
+0002d520: 6e70 2e73 6176 652c 206f 732e 7061 7468  np.save, os.path
+0002d530: 2e6a 6f69 6e28 6469 726e 616d 652c 2022  .join(dirname, "
+0002d540: 2564 2e6e 7079 2220 2520 6929 2c20 6b65  %d.npy" % i), ke
+0002d550: 7929 0a20 2020 2020 2020 2066 6f72 2069  y).        for i
+0002d560: 2c20 6b65 7920 696e 2065 6e75 6d65 7261  , key in enumera
+0002d570: 7465 2863 6f72 652e 666c 6174 7465 6e28  te(core.flatten(
+0002d580: 7878 2e5f 5f64 6173 6b5f 6b65 7973 5f5f  xx.__dask_keys__
+0002d590: 2829 2929 0a20 2020 207d 0a0a 2020 2020  ())).    }..    
+0002d5a0: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
+0002d5b0: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
+0002d5c0: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
+0002d5d0: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
+0002d5e0: 5b78 785d 290a 2020 2020 636f 6d70 7574  [xx]).    comput
+0002d5f0: 655f 6173 5f69 665f 636f 6c6c 6563 7469  e_as_if_collecti
+0002d600: 6f6e 2841 7272 6179 2c20 6772 6170 682c  on(Array, graph,
+0002d610: 206c 6973 7428 6473 6b29 290a 0a0a 6465   list(dsk))...de
+0002d620: 6620 6672 6f6d 5f6e 7079 5f73 7461 636b  f from_npy_stack
+0002d630: 2864 6972 6e61 6d65 2c20 6d6d 6170 5f6d  (dirname, mmap_m
+0002d640: 6f64 653d 2272 2229 3a0a 2020 2020 2222  ode="r"):.    ""
+0002d650: 224c 6f61 6420 6461 736b 2061 7272 6179  "Load dask array
+0002d660: 2066 726f 6d20 7374 6163 6b20 6f66 206e   from stack of n
+0002d670: 7079 2066 696c 6573 0a0a 2020 2020 5061  py files..    Pa
+0002d680: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0002d690: 2d2d 2d2d 2d2d 2d0a 2020 2020 6469 726e  -------.    dirn
+0002d6a0: 616d 653a 2073 7472 696e 670a 2020 2020  ame: string.    
+0002d6b0: 2020 2020 4469 7265 6374 6f72 7920 6f66      Directory of
+0002d6c0: 202e 6e70 7920 6669 6c65 730a 2020 2020   .npy files.    
+0002d6d0: 6d6d 6170 5f6d 6f64 653a 2028 4e6f 6e65  mmap_mode: (None
+0002d6e0: 206f 7220 2772 2729 0a20 2020 2020 2020   or 'r').       
+0002d6f0: 2052 6561 6420 6461 7461 2069 6e20 6d65   Read data in me
+0002d700: 6d6f 7279 206d 6170 206d 6f64 650a 0a20  mory map mode.. 
+0002d710: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0002d720: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2074 6f5f  --------.    to_
+0002d730: 6e70 795f 7374 6163 6b0a 2020 2020 2222  npy_stack.    ""
+0002d740: 220a 2020 2020 7769 7468 206f 7065 6e28  ".    with open(
+0002d750: 6f73 2e70 6174 682e 6a6f 696e 2864 6972  os.path.join(dir
+0002d760: 6e61 6d65 2c20 2269 6e66 6f22 292c 2022  name, "info"), "
+0002d770: 7262 2229 2061 7320 663a 0a20 2020 2020  rb") as f:.     
+0002d780: 2020 2069 6e66 6f20 3d20 7069 636b 6c65     info = pickle
+0002d790: 2e6c 6f61 6428 6629 0a0a 2020 2020 6474  .load(f)..    dt
+0002d7a0: 7970 6520 3d20 696e 666f 5b22 6474 7970  ype = info["dtyp
+0002d7b0: 6522 5d0a 2020 2020 6368 756e 6b73 203d  e"].    chunks =
+0002d7c0: 2069 6e66 6f5b 2263 6875 6e6b 7322 5d0a   info["chunks"].
+0002d7d0: 2020 2020 6178 6973 203d 2069 6e66 6f5b      axis = info[
+0002d7e0: 2261 7869 7322 5d0a 0a20 2020 206e 616d  "axis"]..    nam
+0002d7f0: 6520 3d20 2266 726f 6d2d 6e70 792d 7374  e = "from-npy-st
+0002d800: 6163 6b2d 2573 2220 2520 6469 726e 616d  ack-%s" % dirnam
+0002d810: 650a 2020 2020 6b65 7973 203d 206c 6973  e.    keys = lis
+0002d820: 7428 7072 6f64 7563 7428 5b6e 616d 655d  t(product([name]
+0002d830: 2c20 2a5b 7261 6e67 6528 6c65 6e28 6329  , *[range(len(c)
+0002d840: 2920 666f 7220 6320 696e 2063 6875 6e6b  ) for c in chunk
+0002d850: 735d 2929 0a20 2020 2076 616c 7565 7320  s])).    values 
+0002d860: 3d20 5b0a 2020 2020 2020 2020 286e 702e  = [.        (np.
+0002d870: 6c6f 6164 2c20 6f73 2e70 6174 682e 6a6f  load, os.path.jo
+0002d880: 696e 2864 6972 6e61 6d65 2c20 2225 642e  in(dirname, "%d.
+0002d890: 6e70 7922 2025 2069 292c 206d 6d61 705f  npy" % i), mmap_
+0002d8a0: 6d6f 6465 290a 2020 2020 2020 2020 666f  mode).        fo
+0002d8b0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0002d8c0: 2863 6875 6e6b 735b 6178 6973 5d29 290a  (chunks[axis])).
+0002d8d0: 2020 2020 5d0a 2020 2020 6473 6b20 3d20      ].    dsk = 
+0002d8e0: 6469 6374 287a 6970 286b 6579 732c 2076  dict(zip(keys, v
+0002d8f0: 616c 7565 7329 290a 0a20 2020 2072 6574  alues))..    ret
+0002d900: 7572 6e20 4172 7261 7928 6473 6b2c 206e  urn Array(dsk, n
+0002d910: 616d 652c 2063 6875 6e6b 732c 2064 7479  ame, chunks, dty
+0002d920: 7065 290a 0a0a 6465 6620 6e65 775f 6461  pe)...def new_da
+0002d930: 5f6f 626a 6563 7428 6473 6b2c 206e 616d  _object(dsk, nam
+0002d940: 652c 2063 6875 6e6b 732c 206d 6574 613d  e, chunks, meta=
+0002d950: 4e6f 6e65 2c20 6474 7970 653d 4e6f 6e65  None, dtype=None
+0002d960: 293a 0a20 2020 2022 2222 4765 6e65 7269  ):.    """Generi
+0002d970: 6320 636f 6e73 7472 7563 746f 7220 666f  c constructor fo
+0002d980: 7220 6461 736b 2e61 7272 6179 206f 7220  r dask.array or 
+0002d990: 6461 736b 2e64 6174 6166 7261 6d65 206f  dask.dataframe o
+0002d9a0: 626a 6563 7473 2e0a 0a20 2020 2044 6563  bjects...    Dec
+0002d9b0: 6964 6573 2074 6865 2061 7070 726f 7072  ides the appropr
+0002d9c0: 6961 7465 206f 7574 7075 7420 636c 6173  iate output clas
+0002d9d0: 7320 6261 7365 6420 6f6e 2074 6865 2074  s based on the t
+0002d9e0: 7970 6520 6f66 2060 6d65 7461 6020 7072  ype of `meta` pr
+0002d9f0: 6f76 6964 6564 2e0a 2020 2020 2222 220a  ovided..    """.
+0002da00: 2020 2020 6966 2069 735f 6461 7461 6672      if is_datafr
+0002da10: 616d 655f 6c69 6b65 286d 6574 6129 206f  ame_like(meta) o
+0002da20: 7220 6973 5f73 6572 6965 735f 6c69 6b65  r is_series_like
+0002da30: 286d 6574 6129 206f 7220 6973 5f69 6e64  (meta) or is_ind
+0002da40: 6578 5f6c 696b 6528 6d65 7461 293a 0a20  ex_like(meta):. 
+0002da50: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+0002da60: 2e64 6174 6166 7261 6d65 2e63 6f72 6520  .dataframe.core 
+0002da70: 696d 706f 7274 206e 6577 5f64 645f 6f62  import new_dd_ob
+0002da80: 6a65 6374 0a0a 2020 2020 2020 2020 6173  ject..        as
+0002da90: 7365 7274 2061 6c6c 286c 656e 2863 2920  sert all(len(c) 
+0002daa0: 3d3d 2031 2066 6f72 2063 2069 6e20 6368  == 1 for c in ch
+0002dab0: 756e 6b73 5b31 3a5d 290a 2020 2020 2020  unks[1:]).      
+0002dac0: 2020 6469 7669 7369 6f6e 7320 3d20 5b4e    divisions = [N
+0002dad0: 6f6e 655d 202a 2028 6c65 6e28 6368 756e  one] * (len(chun
+0002dae0: 6b73 5b30 5d29 202b 2031 290a 2020 2020  ks[0]) + 1).    
+0002daf0: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
+0002db00: 645f 6f62 6a65 6374 2864 736b 2c20 6e61  d_object(dsk, na
+0002db10: 6d65 2c20 6d65 7461 2c20 6469 7669 7369  me, meta, divisi
+0002db20: 6f6e 7329 0a20 2020 2065 6c73 653a 0a20  ons).    else:. 
+0002db30: 2020 2020 2020 2072 6574 7572 6e20 4172         return Ar
+0002db40: 7261 7928 6473 6b2c 206e 616d 653d 6e61  ray(dsk, name=na
+0002db50: 6d65 2c20 6368 756e 6b73 3d63 6875 6e6b  me, chunks=chunk
+0002db60: 732c 206d 6574 613d 6d65 7461 2c20 6474  s, meta=meta, dt
+0002db70: 7970 653d 6474 7970 6529 0a0a 0a63 6c61  ype=dtype)...cla
+0002db80: 7373 2042 6c6f 636b 5669 6577 3a0a 2020  ss BlockView:.  
+0002db90: 2020 2222 2241 6e20 6172 7261 792d 6c69    """An array-li
+0002dba0: 6b65 2069 6e74 6572 6661 6365 2074 6f20  ke interface to 
+0002dbb0: 7468 6520 626c 6f63 6b73 206f 6620 616e  the blocks of an
+0002dbc0: 2061 7272 6179 2e0a 0a20 2020 2060 6042   array...    ``B
+0002dbd0: 6c6f 636b 5669 6577 6060 2070 726f 7669  lockView`` provi
+0002dbe0: 6465 7320 616e 2061 7272 6179 2d6c 696b  des an array-lik
+0002dbf0: 6520 696e 7465 7266 6163 650a 2020 2020  e interface.    
+0002dc00: 746f 2074 6865 2062 6c6f 636b 7320 6f66  to the blocks of
+0002dc10: 2061 2064 6173 6b20 6172 7261 792e 2020   a dask array.  
+0002dc20: 4e75 6d70 792d 7374 796c 6520 696e 6465  Numpy-style inde
+0002dc30: 7869 6e67 206f 6620 610a 2020 2020 2060  xing of a.     `
+0002dc40: 6042 6c6f 636b 5669 6577 6060 2072 6574  `BlockView`` ret
+0002dc50: 7572 6e73 2061 2073 656c 6563 7469 6f6e  urns a selection
+0002dc60: 206f 6620 626c 6f63 6b73 2061 7320 6120   of blocks as a 
+0002dc70: 6e65 7720 6461 736b 2061 7272 6179 2e0a  new dask array..
+0002dc80: 0a20 2020 2059 6f75 2063 616e 2069 6e64  .    You can ind
+0002dc90: 6578 2060 6042 6c6f 636b 5669 6577 6060  ex ``BlockView``
+0002dca0: 206c 696b 6520 6120 6e75 6d70 7920 6172   like a numpy ar
+0002dcb0: 7261 7920 6f66 2073 6861 7065 0a20 2020  ray of shape.   
+0002dcc0: 2065 7175 616c 2074 6f20 7468 6520 6e75   equal to the nu
+0002dcd0: 6d62 6572 206f 6620 626c 6f63 6b73 2069  mber of blocks i
+0002dce0: 6e20 6561 6368 2064 696d 656e 7369 6f6e  n each dimension
+0002dcf0: 2c20 2861 7661 696c 6162 6c65 2061 730a  , (available as.
+0002dd00: 2020 2020 6172 7261 792e 626c 6f63 6b73      array.blocks
+0002dd10: 2e73 697a 6529 2e20 2054 6865 2064 696d  .size).  The dim
+0002dd20: 656e 7369 6f6e 616c 6974 7920 6f66 2074  ensionality of t
+0002dd30: 6865 206f 7574 7075 7420 6172 7261 7920  he output array 
+0002dd40: 6d61 7463 6865 730a 2020 2020 7468 6520  matches.    the 
+0002dd50: 6469 6d65 6e73 696f 6e20 6f66 2074 6869  dimension of thi
+0002dd60: 7320 6172 7261 792c 2065 7665 6e20 6966  s array, even if
+0002dd70: 2069 6e74 6567 6572 2069 6e64 6963 6573   integer indices
+0002dd80: 2061 7265 2070 6173 7365 642e 0a20 2020   are passed..   
+0002dd90: 2053 6c69 6369 6e67 2077 6974 6820 6060   Slicing with ``
+0002dda0: 6e70 2e6e 6577 6178 6973 6060 206f 7220  np.newaxis`` or 
+0002ddb0: 6d75 6c74 6970 6c65 206c 6973 7473 2069  multiple lists i
+0002ddc0: 7320 6e6f 7420 7375 7070 6f72 7465 642e  s not supported.
+0002ddd0: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
+0002dde0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0002ddf0: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+0002de00: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
+0002de10: 3e3e 3e20 6672 6f6d 2064 6173 6b2e 6172  >>> from dask.ar
+0002de20: 7261 792e 636f 7265 2069 6d70 6f72 7420  ray.core import 
+0002de30: 426c 6f63 6b56 6965 770a 2020 2020 3e3e  BlockView.    >>
+0002de40: 3e20 7820 3d20 6461 2e61 7261 6e67 6528  > x = da.arange(
+0002de50: 382c 2063 6875 6e6b 733d 3229 0a20 2020  8, chunks=2).   
+0002de60: 203e 3e3e 2062 7620 3d20 426c 6f63 6b56   >>> bv = BlockV
+0002de70: 6965 7728 7829 0a20 2020 203e 3e3e 2062  iew(x).    >>> b
+0002de80: 762e 7368 6170 6520 2320 616c 6961 7365  v.shape # aliase
+0002de90: 7320 782e 6e75 6d62 6c6f 636b 730a 2020  s x.numblocks.  
+0002dea0: 2020 2834 2c29 0a20 2020 203e 3e3e 2062    (4,).    >>> b
+0002deb0: 762e 7369 7a65 0a20 2020 2034 0a20 2020  v.size.    4.   
+0002dec0: 203e 3e3e 2062 765b 305d 2e63 6f6d 7075   >>> bv[0].compu
+0002ded0: 7465 2829 0a20 2020 2061 7272 6179 285b  te().    array([
+0002dee0: 302c 2031 5d29 0a20 2020 203e 3e3e 2062  0, 1]).    >>> b
+0002def0: 765b 3a33 5d2e 636f 6d70 7574 6528 290a  v[:3].compute().
+0002df00: 2020 2020 6172 7261 7928 5b30 2c20 312c      array([0, 1,
+0002df10: 2032 2c20 332c 2034 2c20 355d 290a 2020   2, 3, 4, 5]).  
+0002df20: 2020 3e3e 3e20 6276 5b3a 3a32 5d2e 636f    >>> bv[::2].co
+0002df30: 6d70 7574 6528 290a 2020 2020 6172 7261  mpute().    arra
+0002df40: 7928 5b30 2c20 312c 2034 2c20 355d 290a  y([0, 1, 4, 5]).
+0002df50: 2020 2020 3e3e 3e20 6276 5b5b 2d31 2c20      >>> bv[[-1, 
+0002df60: 305d 5d2e 636f 6d70 7574 6528 290a 2020  0]].compute().  
+0002df70: 2020 6172 7261 7928 5b36 2c20 372c 2030    array([6, 7, 0
+0002df80: 2c20 315d 290a 2020 2020 3e3e 3e20 6276  , 1]).    >>> bv
+0002df90: 2e72 6176 656c 2829 2020 2320 646f 6374  .ravel()  # doct
+0002dfa0: 6573 743a 202b 4e4f 524d 414c 495a 455f  est: +NORMALIZE_
+0002dfb0: 5748 4954 4553 5041 4345 0a20 2020 205b  WHITESPACE.    [
+0002dfc0: 6461 736b 2e61 7272 6179 3c62 6c6f 636b  dask.array<block
+0002dfd0: 732c 2073 6861 7065 3d28 322c 292c 2064  s, shape=(2,), d
+0002dfe0: 7479 7065 3d69 6e74 3634 2c20 6368 756e  type=int64, chun
+0002dff0: 6b73 697a 653d 2832 2c29 2c20 6368 756e  ksize=(2,), chun
+0002e000: 6b74 7970 653d 6e75 6d70 792e 6e64 6172  ktype=numpy.ndar
+0002e010: 7261 793e 2c0a 2020 2020 2064 6173 6b2e  ray>,.     dask.
+0002e020: 6172 7261 793c 626c 6f63 6b73 2c20 7368  array<blocks, sh
+0002e030: 6170 653d 2832 2c29 2c20 6474 7970 653d  ape=(2,), dtype=
+0002e040: 696e 7436 342c 2063 6875 6e6b 7369 7a65  int64, chunksize
+0002e050: 3d28 322c 292c 2063 6875 6e6b 7479 7065  =(2,), chunktype
+0002e060: 3d6e 756d 7079 2e6e 6461 7272 6179 3e2c  =numpy.ndarray>,
+0002e070: 0a20 2020 2020 6461 736b 2e61 7272 6179  .     dask.array
+0002e080: 3c62 6c6f 636b 732c 2073 6861 7065 3d28  <blocks, shape=(
+0002e090: 322c 292c 2064 7479 7065 3d69 6e74 3634  2,), dtype=int64
+0002e0a0: 2c20 6368 756e 6b73 697a 653d 2832 2c29  , chunksize=(2,)
+0002e0b0: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
+0002e0c0: 792e 6e64 6172 7261 793e 2c0a 2020 2020  y.ndarray>,.    
+0002e0d0: 2064 6173 6b2e 6172 7261 793c 626c 6f63   dask.array<bloc
+0002e0e0: 6b73 2c20 7368 6170 653d 2832 2c29 2c20  ks, shape=(2,), 
+0002e0f0: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
+0002e100: 6e6b 7369 7a65 3d28 322c 292c 2063 6875  nksize=(2,), chu
+0002e110: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
+0002e120: 7272 6179 3e5d 0a0a 2020 2020 5265 7475  rray>]..    Retu
+0002e130: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
+0002e140: 2020 2020 416e 2069 6e73 7461 6e63 6520      An instance 
+0002e150: 6f66 2060 6064 612e 6172 7261 792e 426c  of ``da.array.Bl
+0002e160: 6f63 6b76 6965 7760 600a 2020 2020 2222  ockview``.    ""
+0002e170: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+0002e180: 745f 5f28 7365 6c66 2c20 6172 7261 793a  t__(self, array:
+0002e190: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
+0002e1a0: 2073 656c 662e 5f61 7272 6179 203d 2061   self._array = a
+0002e1b0: 7272 6179 0a0a 2020 2020 6465 6620 5f5f  rray..    def __
+0002e1c0: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
+0002e1d0: 696e 6465 783a 2041 6e79 2920 2d3e 2041  index: Any) -> A
+0002e1e0: 7272 6179 3a0a 2020 2020 2020 2020 6672  rray:.        fr
+0002e1f0: 6f6d 2064 6173 6b2e 6172 7261 792e 736c  om dask.array.sl
+0002e200: 6963 696e 6720 696d 706f 7274 206e 6f72  icing import nor
+0002e210: 6d61 6c69 7a65 5f69 6e64 6578 0a0a 2020  malize_index..  
+0002e220: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0002e230: 6e73 7461 6e63 6528 696e 6465 782c 2074  nstance(index, t
+0002e240: 7570 6c65 293a 0a20 2020 2020 2020 2020  uple):.         
+0002e250: 2020 2069 6e64 6578 203d 2028 696e 6465     index = (inde
+0002e260: 782c 290a 2020 2020 2020 2020 6966 2073  x,).        if s
+0002e270: 756d 2869 7369 6e73 7461 6e63 6528 696e  um(isinstance(in
+0002e280: 642c 2028 6e70 2e6e 6461 7272 6179 2c20  d, (np.ndarray, 
+0002e290: 6c69 7374 2929 2066 6f72 2069 6e64 2069  list)) for ind i
+0002e2a0: 6e20 696e 6465 7829 203e 2031 3a0a 2020  n index) > 1:.  
+0002e2b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002e2c0: 5661 6c75 6545 7272 6f72 2822 4361 6e20  ValueError("Can 
+0002e2d0: 6f6e 6c79 2073 6c69 6365 2077 6974 6820  only slice with 
+0002e2e0: 6120 7369 6e67 6c65 206c 6973 7422 290a  a single list").
+0002e2f0: 2020 2020 2020 2020 6966 2061 6e79 2869          if any(i
+0002e300: 6e64 2069 7320 4e6f 6e65 2066 6f72 2069  nd is None for i
+0002e310: 6e64 2069 6e20 696e 6465 7829 3a0a 2020  nd in index):.  
+0002e320: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002e330: 5661 6c75 6545 7272 6f72 2822 536c 6963  ValueError("Slic
+0002e340: 696e 6720 7769 7468 206e 702e 6e65 7761  ing with np.newa
+0002e350: 7869 7320 6f72 204e 6f6e 6520 6973 206e  xis or None is n
+0002e360: 6f74 2073 7570 706f 7274 6564 2229 0a20  ot supported"). 
+0002e370: 2020 2020 2020 2069 6e64 6578 203d 206e         index = n
+0002e380: 6f72 6d61 6c69 7a65 5f69 6e64 6578 2869  ormalize_index(i
+0002e390: 6e64 6578 2c20 7365 6c66 2e5f 6172 7261  ndex, self._arra
+0002e3a0: 792e 6e75 6d62 6c6f 636b 7329 0a20 2020  y.numblocks).   
+0002e3b0: 2020 2020 2069 6e64 6578 203d 2074 7570       index = tup
+0002e3c0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0002e3d0: 736c 6963 6528 6b2c 206b 202b 2031 2920  slice(k, k + 1) 
+0002e3e0: 6966 2069 7369 6e73 7461 6e63 6528 6b2c  if isinstance(k,
+0002e3f0: 204e 756d 6265 7229 2065 6c73 6520 6b20   Number) else k 
+0002e400: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
+0002e410: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0002e420: 6b20 696e 2069 6e64 6578 0a20 2020 2020  k in index.     
+0002e430: 2020 2029 0a0a 2020 2020 2020 2020 6e61     )..        na
+0002e440: 6d65 203d 2022 626c 6f63 6b73 2d22 202b  me = "blocks-" +
+0002e450: 2074 6f6b 656e 697a 6528 7365 6c66 2e5f   tokenize(self._
+0002e460: 6172 7261 792c 2069 6e64 6578 290a 0a20  array, index).. 
+0002e470: 2020 2020 2020 206e 6577 5f6b 6579 7320         new_keys 
+0002e480: 3d20 7365 6c66 2e5f 6172 7261 792e 5f6b  = self._array._k
+0002e490: 6579 5f61 7272 6179 5b69 6e64 6578 5d0a  ey_array[index].
+0002e4a0: 0a20 2020 2020 2020 2063 6875 6e6b 7320  .        chunks 
+0002e4b0: 3d20 7475 706c 6528 0a20 2020 2020 2020  = tuple(.       
+0002e4c0: 2020 2020 2074 7570 6c65 286e 702e 6172       tuple(np.ar
+0002e4d0: 7261 7928 6329 5b69 5d2e 746f 6c69 7374  ray(c)[i].tolist
+0002e4e0: 2829 2920 666f 7220 632c 2069 2069 6e20  ()) for c, i in 
+0002e4f0: 7a69 7028 7365 6c66 2e5f 6172 7261 792e  zip(self._array.
+0002e500: 6368 756e 6b73 2c20 696e 6465 7829 0a20  chunks, index). 
+0002e510: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002e520: 2020 6b65 7973 203d 2070 726f 6475 6374    keys = product
+0002e530: 282a 2872 616e 6765 286c 656e 2863 2929  (*(range(len(c))
+0002e540: 2066 6f72 2063 2069 6e20 6368 756e 6b73   for c in chunks
+0002e550: 2929 0a0a 2020 2020 2020 2020 6c61 7965  ))..        laye
+0002e560: 7220 3d20 7b28 6e61 6d65 2c29 202b 206b  r = {(name,) + k
+0002e570: 6579 3a20 7475 706c 6528 6e65 775f 6b65  ey: tuple(new_ke
+0002e580: 7973 5b6b 6579 5d2e 746f 6c69 7374 2829  ys[key].tolist()
+0002e590: 2920 666f 7220 6b65 7920 696e 206b 6579  ) for key in key
+0002e5a0: 737d 0a0a 2020 2020 2020 2020 6772 6170  s}..        grap
+0002e5b0: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
+0002e5c0: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
+0002e5d0: 6f6e 7328 6e61 6d65 2c20 6c61 7965 722c  ons(name, layer,
+0002e5e0: 2064 6570 656e 6465 6e63 6965 733d 5b73   dependencies=[s
+0002e5f0: 656c 662e 5f61 7272 6179 5d29 0a20 2020  elf._array]).   
+0002e600: 2020 2020 2072 6574 7572 6e20 4172 7261       return Arra
+0002e610: 7928 6772 6170 682c 206e 616d 652c 2063  y(graph, name, c
+0002e620: 6875 6e6b 732c 206d 6574 613d 7365 6c66  hunks, meta=self
+0002e630: 2e5f 6172 7261 7929 0a0a 2020 2020 6465  ._array)..    de
+0002e640: 6620 5f5f 6571 5f5f 2873 656c 662c 206f  f __eq__(self, o
+0002e650: 7468 6572 3a20 416e 7929 202d 3e20 626f  ther: Any) -> bo
+0002e660: 6f6c 3a0a 2020 2020 2020 2020 6966 2069  ol:.        if i
+0002e670: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
+0002e680: 2042 6c6f 636b 5669 6577 293a 0a20 2020   BlockView):.   
+0002e690: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002e6a0: 7365 6c66 2e5f 6172 7261 7920 6973 206f  self._array is o
+0002e6b0: 7468 6572 2e5f 6172 7261 790a 2020 2020  ther._array.    
+0002e6c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002e6d0: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
+0002e6e0: 496d 706c 656d 656e 7465 640a 0a20 2020  Implemented..   
+0002e6f0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0002e700: 6566 2073 697a 6528 7365 6c66 2920 2d3e  ef size(self) ->
+0002e710: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+0002e720: 220a 2020 2020 2020 2020 5468 6520 746f  ".        The to
+0002e730: 7461 6c20 6e75 6d62 6572 206f 6620 626c  tal number of bl
+0002e740: 6f63 6b73 2069 6e20 7468 6520 6172 7261  ocks in the arra
+0002e750: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
+0002e760: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+0002e770: 7468 2e70 726f 6428 7365 6c66 2e73 6861  th.prod(self.sha
+0002e780: 7065 290a 0a20 2020 2040 7072 6f70 6572  pe)..    @proper
+0002e790: 7479 0a20 2020 2064 6566 2073 6861 7065  ty.    def shape
+0002e7a0: 2873 656c 6629 202d 3e20 7475 706c 655b  (self) -> tuple[
+0002e7b0: 696e 742c 202e 2e2e 5d3a 0a20 2020 2020  int, ...]:.     
+0002e7c0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+0002e7d0: 6865 206e 756d 6265 7220 6f66 2062 6c6f  he number of blo
+0002e7e0: 636b 7320 7065 7220 6178 6973 2e20 416c  cks per axis. Al
+0002e7f0: 6961 7320 6f66 2060 6064 6173 6b2e 6172  ias of ``dask.ar
+0002e800: 7261 792e 6e75 6d62 6c6f 636b 7360 602e  ray.numblocks``.
+0002e810: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002e820: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0002e830: 2e5f 6172 7261 792e 6e75 6d62 6c6f 636b  ._array.numblock
+0002e840: 730a 0a20 2020 2064 6566 2072 6176 656c  s..    def ravel
+0002e850: 2873 656c 6629 202d 3e20 6c69 7374 5b41  (self) -> list[A
+0002e860: 7272 6179 5d3a 0a20 2020 2020 2020 2022  rray]:.        "
+0002e870: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+0002e880: 6e20 6120 666c 6174 7465 6e65 6420 6c69  n a flattened li
+0002e890: 7374 206f 6620 616c 6c20 7468 6520 626c  st of all the bl
+0002e8a0: 6f63 6b73 2069 6e20 7468 6520 6172 7261  ocks in the arra
+0002e8b0: 7920 696e 2043 206f 7264 6572 2e0a 2020  y in C order..  
+0002e8c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0002e8d0: 2020 7265 7475 726e 205b 7365 6c66 5b69    return [self[i
+0002e8e0: 6478 5d20 666f 7220 6964 7820 696e 206e  dx] for idx in n
+0002e8f0: 702e 6e64 696e 6465 7828 7365 6c66 2e73  p.ndindex(self.s
+0002e900: 6861 7065 295d 0a0a 0a66 726f 6d20 6461  hape)]...from da
+0002e910: 736b 2e61 7272 6179 2e62 6c6f 636b 7769  sk.array.blockwi
+0002e920: 7365 2069 6d70 6f72 7420 626c 6f63 6b77  se import blockw
+0002e930: 6973 650a 6672 6f6d 2064 6173 6b2e 6172  ise.from dask.ar
+0002e940: 7261 792e 7574 696c 7320 696d 706f 7274  ray.utils import
+0002e950: 2063 6f6d 7075 7465 5f6d 6574 612c 206d   compute_meta, m
+0002e960: 6574 615f 6672 6f6d 5f61 7272 6179 0a    eta_from_array.
```

### Comparing `dask-2023.6.0/dask/array/creation.py` & `dask-2023.6.1/dask/array/creation.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/cupy_entry_point.py` & `dask-2023.6.1/dask/array/cupy_entry_point.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/dispatch.py` & `dask-2023.6.1/dask/array/dispatch.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/einsumfuncs.py` & `dask-2023.6.1/dask/array/einsumfuncs.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,10 @@
 from __future__ import annotations
 
 import numpy as np
-from numpy.compat import basestring
 
 from dask.array.core import asarray, blockwise, einsum_lookup
 from dask.utils import derived_from
 
 einsum_symbols = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"
 einsum_symbols_set = set(einsum_symbols)
 
@@ -49,15 +48,15 @@
     >> __parse_einsum_input((a, [Ellipsis, 0], b, [Ellipsis, 0]))
     ('za,xza', 'xz', [a, b])
     """
 
     if len(operands) == 0:
         raise ValueError("No input operands")
 
-    if isinstance(operands[0], basestring):
+    if isinstance(operands[0], str):
         subscripts = operands[0].replace(" ", "")
         operands = [asarray(o) for o in operands[1:]]
 
         # Ensure all characters are valid
         for s in subscripts:
             if s in ".,->":
                 continue
```

### Comparing `dask-2023.6.0/dask/array/fft.py` & `dask-2023.6.1/dask/array/fft.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/gufunc.py` & `dask-2023.6.1/dask/array/gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/image.py` & `dask-2023.6.1/dask/array/image.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/linalg.py` & `dask-2023.6.1/dask/array/linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/ma.py` & `dask-2023.6.1/dask/array/ma.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/numpy_compat.py` & `dask-2023.6.1/dask/array/numpy_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/optimization.py` & `dask-2023.6.1/dask/array/optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/overlap.py` & `dask-2023.6.1/dask/array/overlap.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/percentile.py` & `dask-2023.6.1/dask/array/percentile.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/random.py` & `dask-2023.6.1/dask/array/random.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/rechunk.py` & `dask-2023.6.1/dask/array/rechunk.py`

 * *Files 3% similar despite different names*

```diff
@@ -6,15 +6,15 @@
         of an existing dask array to new chunks or blockshape
 """
 from __future__ import annotations
 
 import heapq
 import math
 from functools import reduce
-from itertools import chain, compress, count, product
+from itertools import chain, count, product
 from operator import add, itemgetter, mul
 from warnings import warn
 
 import numpy as np
 import tlz as toolz
 from tlz import accumulate
 
@@ -156,71 +156,63 @@
 
 def old_to_new(old_chunks, new_chunks):
     """Helper to build old_chunks to new_chunks.
 
     Handles missing values, as long as the dimension with the missing chunk values
     is unchanged.
 
+    Notes
+    -----
     This function expects that the arguments have been pre-processed by
     :func:`dask.array.core.normalize_chunks`. In particular any ``nan`` values should
     have been replaced (and are so by :func:`dask.array.core.normalize_chunks`)
-    by the canonical ``np.nan``.
+    by the canonical ``np.nan``. It also expects that the arguments have been validated
+    with `_validate_rechunk` and rechunking is thus possible.
 
     Examples
     --------
     >>> old = ((10, 10, 10, 10, 10), )
     >>> new = ((25, 5, 20), )
     >>> old_to_new(old, new)  # doctest: +NORMALIZE_WHITESPACE
     [[[(0, slice(0, 10, None)), (1, slice(0, 10, None)), (2, slice(0, 5, None))],
       [(2, slice(5, 10, None))],
       [(3, slice(0, 10, None)), (4, slice(0, 10, None))]]]
     """
 
     def is_unknown(dim):
         return any(math.isnan(chunk) for chunk in dim)
 
-    old_is_unknown = [is_unknown(dim) for dim in old_chunks]
-    new_is_unknown = [is_unknown(dim) for dim in new_chunks]
+    dims_unknown = [is_unknown(dim) for dim in old_chunks]
 
-    if old_is_unknown != new_is_unknown or any(
-        new != old for new, old in compress(zip(old_chunks, new_chunks), old_is_unknown)
-    ):
-        raise ValueError(
-            "Chunks must be unchanging along dimensions with missing values.\n\n"
-            "A possible solution:\n  x.compute_chunk_sizes()"
-        )
+    known_indices = []
+    unknown_indices = []
+    for i, unknown in enumerate(dims_unknown):
+        if unknown:
+            unknown_indices.append(i)
+        else:
+            known_indices.append(i)
 
-    old_known_indices = [i for i, unknown in enumerate(old_is_unknown) if not unknown]
-    old_known = [dim for dim, unknown in zip(old_chunks, old_is_unknown) if not unknown]
-    new_known = [dim for dim, unknown in zip(new_chunks, new_is_unknown) if not unknown]
-
-    old_sizes = [sum(o) for o in old_known]
-    new_sizes = [sum(n) for n in new_known]
-
-    if old_sizes != new_sizes:
-        raise ValueError(
-            f"Cannot change dimensions from {old_sizes!r} to {new_sizes!r}"
-        )
+    old_known = [old_chunks[i] for i in known_indices]
+    new_known = [new_chunks[i] for i in known_indices]
 
     cmos = cumdims_label(old_known, "o")
     cmns = cumdims_label(new_known, "n")
 
     sliced = [None] * len(old_chunks)
-    for i, cmo, cmn in zip(old_known_indices, cmos, cmns):
+    for i, cmo, cmn in zip(known_indices, cmos, cmns):
         sliced[i] = _intersect_1d(_breakpoints(cmo, cmn))
 
-    for i, unknown in enumerate(old_is_unknown):
-        if unknown:
-            dim = old_chunks[i]
-            # Unknown dimensions are always unchanged, so old -> new is everything
-            extra = [
-                [(j, slice(0, size if not math.isnan(size) else None))]
-                for j, size in enumerate(dim)
-            ]
-            sliced[i] = extra
+    for i in unknown_indices:
+        dim = old_chunks[i]
+        # Unknown dimensions are always unchanged, so old -> new is everything
+        extra = [
+            [(j, slice(0, size if not math.isnan(size) else None))]
+            for j, size in enumerate(dim)
+        ]
+        sliced[i] = extra
     assert all(x is not None for x in sliced)
     return sliced
 
 
 def intersect_chunks(old_chunks, new_chunks):
     """
     Make dask.array slices as intersection of old and new chunks.
@@ -242,14 +234,41 @@
         block sizes along each dimension (converts to new_chunks)
     """
     cross1 = product(*old_to_new(old_chunks, new_chunks))
     cross = chain(tuple(product(*cr)) for cr in cross1)
     return cross
 
 
+def _validate_rechunk(old_chunks, new_chunks):
+    """Validates that rechunking an array from ``old_chunks`` to ``new_chunks``
+    is possible, raises an error if otherwise.
+
+    Notes
+    -----
+    This function expects ``old_chunks`` and ``new_chunks`` to have matching
+    dimensionality and will not raise an informative error if they don't.
+    """
+    assert len(old_chunks) == len(new_chunks)
+
+    old_shapes = tuple(map(sum, old_chunks))
+    new_shapes = tuple(map(sum, new_chunks))
+
+    for old_shape, old_dim, new_shape, new_dim in zip(
+        old_shapes, old_chunks, new_shapes, new_chunks
+    ):
+        if old_shape != new_shape:
+            if not (
+                math.isnan(old_shape) and math.isnan(new_shape)
+            ) or not np.array_equal(old_dim, new_dim, equal_nan=True):
+                raise ValueError(
+                    "Chunks must be unchanging along dimensions with missing values.\n\n"
+                    "A possible solution:\n  x.compute_chunk_sizes()"
+                )
+
+
 def rechunk(
     x,
     chunks="auto",
     threshold=None,
     block_size_limit=None,
     balance=False,
     method=None,
@@ -336,19 +355,15 @@
 
     if not balance and (chunks == x.chunks):
         return x
 
     if balance:
         chunks = tuple(_balance_chunksizes(chunk) for chunk in chunks)
 
-    new_shapes = tuple(map(sum, chunks))
-
-    for new, old in zip(new_shapes, x.shape):
-        if new != old and not math.isnan(old) and not math.isnan(new):
-            raise ValueError("Provided chunks are not consistent with shape")
+    _validate_rechunk(x.chunks, chunks)
 
     method = method or config.get("array.rechunk.method")
 
     if method == "tasks":
         steps = plan_rechunk(
             x.chunks, chunks, x.dtype.itemsize, threshold, block_size_limit
         )
@@ -576,15 +591,15 @@
         intermediate step
 
     Notes
     -----
     No intermediate steps will be planned if any dimension of ``old_chunks``
     is unknown.
     """
-    threshold = threshold or config.get("array.rechunk-threshold")
+    threshold = threshold or config.get("array.rechunk.threshold")
     block_size_limit = block_size_limit or config.get("array.chunk-size")
     if isinstance(block_size_limit, str):
         block_size_limit = parse_bytes(block_size_limit)
 
     has_nans = (any(math.isnan(y) for y in x) for x in old_chunks)
 
     if len(new_chunks) <= 1 or not all(new_chunks) or any(has_nans):
```

### Comparing `dask-2023.6.0/dask/array/reductions.py` & `dask-2023.6.1/dask/array/reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/reshape.py` & `dask-2023.6.1/dask/array/reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/routines.py` & `dask-2023.6.1/dask/array/routines.py`

 * *Files 0% similar despite different names*

```diff
@@ -1562,15 +1562,15 @@
         return c / c
     d = diag(c)
     d = d.reshape((d.shape[0], 1))
     sqr_d = sqrt(d)
     return (c / sqr_d) / sqr_d.T
 
 
-@implements(np.round, np.round_)
+@implements(np.round)
 @derived_from(np)
 def round(a, decimals=0):
     return a.map_blocks(np.round, decimals=decimals, dtype=a.dtype)
 
 
 @implements(np.ndim)
 @derived_from(np)
```

### Comparing `dask-2023.6.0/dask/array/slicing.py` & `dask-2023.6.1/dask/array/slicing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/stats.py` & `dask-2023.6.1/dask/array/stats.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/svg.py` & `dask-2023.6.1/dask/array/svg.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_array_core.py` & `dask-2023.6.1/dask/array/tests/test_array_core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_array_function.py` & `dask-2023.6.1/dask/array/tests/test_array_function.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_array_utils.py` & `dask-2023.6.1/dask/array/tests/test_array_utils.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_atop.py` & `dask-2023.6.1/dask/array/tests/test_atop.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_chunk.py` & `dask-2023.6.1/dask/array/tests/test_chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_creation.py` & `dask-2023.6.1/dask/array/tests/test_creation.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_core.py` & `dask-2023.6.1/dask/array/tests/test_cupy_core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_creation.py` & `dask-2023.6.1/dask/array/tests/test_cupy_creation.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_gufunc.py` & `dask-2023.6.1/dask/array/tests/test_cupy_gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_linalg.py` & `dask-2023.6.1/dask/array/tests/test_cupy_linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_overlap.py` & `dask-2023.6.1/dask/array/tests/test_cupy_overlap.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_percentile.py` & `dask-2023.6.1/dask/array/tests/test_cupy_percentile.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_random.py` & `dask-2023.6.1/dask/array/tests/test_cupy_random.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_reductions.py` & `dask-2023.6.1/dask/array/tests/test_cupy_reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_routines.py` & `dask-2023.6.1/dask/array/tests/test_cupy_routines.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_slicing.py` & `dask-2023.6.1/dask/array/tests/test_cupy_slicing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_cupy_sparse.py` & `dask-2023.6.1/dask/array/tests/test_cupy_sparse.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_dispatch.py` & `dask-2023.6.1/dask/array/tests/test_dispatch.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_fft.py` & `dask-2023.6.1/dask/array/tests/test_fft.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_gufunc.py` & `dask-2023.6.1/dask/array/tests/test_gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_image.py` & `dask-2023.6.1/dask/array/tests/test_image.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_linalg.py` & `dask-2023.6.1/dask/array/tests/test_linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_masked.py` & `dask-2023.6.1/dask/array/tests/test_masked.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_numpy_compat.py` & `dask-2023.6.1/dask/array/tests/test_numpy_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_optimization.py` & `dask-2023.6.1/dask/array/tests/test_optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_overlap.py` & `dask-2023.6.1/dask/array/tests/test_overlap.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_percentiles.py` & `dask-2023.6.1/dask/array/tests/test_percentiles.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_random.py` & `dask-2023.6.1/dask/array/tests/test_random.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_rechunk.py` & `dask-2023.6.1/dask/array/tests/test_rechunk.py`

 * *Files 0% similar despite different names*

```diff
@@ -719,14 +719,17 @@
 
     x = da.ones(shape=(10, 10), chunks=(5, 5))
     y = dd.from_array(x).values
     with pytest.raises(ValueError, match="Chunks do not add"):
         y.rechunk((None, (5, 5, 5)))
 
     with pytest.raises(ValueError, match="Chunks must be unchanging"):
+        y.rechunk(((np.nan, np.nan, np.nan), (5, 5)))
+
+    with pytest.raises(ValueError, match="Chunks must be unchanging"):
         y.rechunk(((5, 5), (5, 5)))
 
     with pytest.raises(ValueError, match="Chunks must be unchanging"):
         z = da.concatenate([x, y])
         z.rechunk(((5, 3, 2, np.nan, np.nan), (5, 5)))
 
 
@@ -768,21 +771,14 @@
             [(3, slice(0, None, None))],
         ],
         [[(0, slice(0, 5, None))], [(0, slice(5, 10, None))]],
     ]
     assert result == expected
 
 
-def test_changing_raises():
-    with pytest.raises(ValueError) as record:
-        old_to_new(((np.nan, np.nan), (4, 4)), ((np.nan, np.nan, np.nan), (4, 4)))
-
-    assert "unchanging" in str(record.value)
-
-
 def test_old_to_new_known():
     old = ((10, 10, 10, 10, 10),)
     new = ((25, 5, 20),)
     result = old_to_new(old, new)
     expected = [
         [
             [(0, slice(0, 10, None)), (1, slice(0, 10, None)), (2, slice(0, 5, None))],
```

### Comparing `dask-2023.6.0/dask/array/tests/test_reductions.py` & `dask-2023.6.1/dask/array/tests/test_reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_reshape.py` & `dask-2023.6.1/dask/array/tests/test_reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_routines.py` & `dask-2023.6.1/dask/array/tests/test_routines.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_slicing.py` & `dask-2023.6.1/dask/array/tests/test_slicing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_sparse.py` & `dask-2023.6.1/dask/array/tests/test_sparse.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_stats.py` & `dask-2023.6.1/dask/array/tests/test_stats.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_svg.py` & `dask-2023.6.1/dask/array/tests/test_svg.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_testing.py` & `dask-2023.6.1/dask/array/tests/test_testing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_ufunc.py` & `dask-2023.6.1/dask/array/tests/test_ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_wrap.py` & `dask-2023.6.1/dask/array/tests/test_wrap.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tests/test_xarray.py` & `dask-2023.6.1/dask/array/tests/test_xarray.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/tiledb_io.py` & `dask-2023.6.1/dask/array/tiledb_io.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/ufunc.py` & `dask-2023.6.1/dask/array/ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/utils.py` & `dask-2023.6.1/dask/array/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/array/wrap.py` & `dask-2023.6.1/dask/array/wrap.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/backends.py` & `dask-2023.6.1/dask/backends.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/__init__.py` & `dask-2023.6.1/dask/bag/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/avro.py` & `dask-2023.6.1/dask/bag/avro.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/chunk.py` & `dask-2023.6.1/dask/bag/chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/core.py` & `dask-2023.6.1/dask/bag/core.py`

 * *Files 1% similar despite different names*

```diff
@@ -57,15 +57,15 @@
 from dask.utils import (
     apply,
     digit,
     ensure_bytes,
     ensure_dict,
     ensure_unicode,
     funcname,
-    get_default_shuffle_algorithm,
+    get_default_shuffle_method,
     insert,
     iter_chunks,
     key_split,
     parse_bytes,
     system_encoding,
     takes_multiple_arguments,
 )
@@ -1522,15 +1522,15 @@
         See Also
         --------
         Bag.foldby
         """
         if method is not None:
             raise Exception("The method= keyword has been moved to shuffle=")
         if shuffle is None:
-            shuffle = get_default_shuffle_algorithm()
+            shuffle = get_default_shuffle_method()
             if shuffle == "p2p":
                 # Not implemented for Bags
                 shuffle = "tasks"
         if shuffle == "disk":
             return groupby_disk(
                 self, grouper, npartitions=npartitions, blocksize=blocksize
             )
@@ -2603,19 +2603,18 @@
         nsplits = [div] * bag.npartitions
         nsplits[-1] += mod
         return _split_partitions(bag, nsplits, new_name)
 
 
 def total_mem_usage(partition):
     from copy import deepcopy
-    from itertools import chain
 
     # if repartition is called multiple times prior to calling compute(), the partitions
-    # will be itertools.chain objects. Copy the object to avoid consuming the iterable.
-    if isinstance(partition, chain):
+    # will be an Iterable. Copy the object to avoid consuming the iterable.
+    if isinstance(partition, Iterable):
         partition = reify(deepcopy(partition))
     return sizeof(partition)
 
 
 def repartition_size(bag, size):
     """
     Repartition bag so that new partitions have approximately `size` memory usage each
```

### Comparing `dask-2023.6.0/dask/bag/random.py` & `dask-2023.6.1/dask/bag/random.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/tests/test_avro.py` & `dask-2023.6.1/dask/bag/tests/test_avro.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/tests/test_bag.py` & `dask-2023.6.1/dask/bag/tests/test_bag.py`

 * *Files 1% similar despite different names*

```diff
@@ -1677,7 +1677,16 @@
 @pytest.mark.parametrize("nworkers", [100, 250, 500, 1000])
 def test_npartitions_saturation(nworkers):
     # If npartitions is set the bag should always contain at least that number of tasks
     for nitems in range(nworkers, 10 * nworkers, max(1, math.floor(nworkers / 10))):
         assert (
             len(db.from_sequence(range(nitems), npartitions=nworkers).dask) >= nworkers
         )
+
+
+def test_map_total_mem_usage():
+    """https://github.com/dask/dask/issues/10338"""
+    b = db.from_sequence(range(1, 100), npartitions=3)
+    total_mem_b = sum(b.map_partitions(total_mem_usage).compute())
+    c = b.map(lambda x: x)
+    total_mem_c = sum(c.map_partitions(total_mem_usage).compute())
+    assert total_mem_b == total_mem_c
```

### Comparing `dask-2023.6.0/dask/bag/tests/test_random.py` & `dask-2023.6.1/dask/bag/tests/test_random.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/tests/test_text.py` & `dask-2023.6.1/dask/bag/tests/test_text.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bag/text.py` & `dask-2023.6.1/dask/bag/text.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/base.py` & `dask-2023.6.1/dask/base.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,45 +1,56 @@
 from __future__ import annotations
 
+import atexit
 import dataclasses
 import datetime
 import hashlib
 import inspect
 import os
 import pathlib
 import pickle
+import sys
 import threading
 import uuid
 import warnings
 from collections import OrderedDict
 from collections.abc import Callable, Iterator, Mapping
 from concurrent.futures import Executor
 from contextlib import contextmanager
+from contextvars import ContextVar
 from enum import Enum
-from functools import partial
+from functools import partial, wraps
 from numbers import Integral, Number
 from operator import getitem
-from typing import TYPE_CHECKING, Literal, Protocol
+from typing import TYPE_CHECKING, Any, Literal, Protocol
 
 from tlz import curry, groupby, identity, merge
 from tlz.functoolz import Compose
 
 from dask import config, local
 from dask._compatibility import EMSCRIPTEN
 from dask.core import flatten
 from dask.core import get as simple_get
 from dask.core import literal, quote
 from dask.hashing import hash_buffer_hex
 from dask.system import CPU_COUNT
 from dask.typing import SchedulerGetCallable
-from dask.utils import Dispatch, apply, ensure_dict, is_namedtuple_instance, key_split
+from dask.utils import (
+    Dispatch,
+    apply,
+    ensure_dict,
+    is_namedtuple_instance,
+    key_split,
+    shorten_traceback,
+)
 
 __all__ = (
     "DaskMethodsMixin",
     "annotate",
+    "get_annotations",
     "is_dask_collection",
     "compute",
     "persist",
     "optimize",
     "visualize",
     "tokenize",
     "normalize_token",
@@ -49,16 +60,69 @@
     "clone_key",
 )
 
 if TYPE_CHECKING:
     from _typeshed import ReadableBuffer
 
 
+def _clean_traceback_hook(func):
+    @wraps(func)
+    def wrapper(exc_type, exc, tb):
+        tb = shorten_traceback(tb)
+        return func(exc_type, exc.with_traceback(tb), tb)
+
+    return wrapper
+
+
+def _clean_ipython_traceback(self, etype, value, tb, tb_offset=None):
+    short_tb = shorten_traceback(tb)
+    short_exc = value.with_traceback(short_tb)
+    stb = self.InteractiveTB.structured_traceback(
+        etype, short_exc, short_tb, tb_offset=tb_offset
+    )
+    self._showtraceback(type, short_exc, stb)
+
+
+try:
+    from IPython import get_ipython
+except ImportError:
+    pass
+else:
+    # if we're running in ipython, customize exception handling
+    ip = get_ipython()
+    if ip is not None:
+        ip.set_custom_exc((Exception,), _clean_ipython_traceback)
+
+
+def _restore_excepthook():
+    sys.excepthook = original_excepthook
+
+
+original_excepthook = sys.excepthook
+sys.excepthook = _clean_traceback_hook(sys.excepthook)
+
+_annotations: ContextVar[dict[str, Any]] = ContextVar("annotations", default={})
+
+
+def get_annotations() -> dict[str, Any]:
+    """Get current annotations.
+
+    Returns
+    -------
+    Dict of all current annotations
+
+    See Also
+    --------
+    annotate
+    """
+    return _annotations.get()
+
+
 @contextmanager
-def annotate(**annotations):
+def annotate(**annotations: Any) -> Iterator[None]:
     """Context Manager for setting HighLevelGraph Layer annotations.
 
     Annotations are metadata or soft constraints associated with
     tasks that dask schedulers may choose to respect: They signal intent
     without enforcing hard constraints. As such, they are
     primarily designed for use with the distributed scheduler.
 
@@ -92,14 +156,18 @@
 
     Annotations may be nested.
 
     >>> with dask.annotate(priority=1):
     ...     with dask.annotate(retries=3):
     ...         A = da.ones((1000, 1000))
     ...     B = A + 1
+
+    See Also
+    --------
+    get_annotations
     """
 
     # Sanity check annotations used in place of
     # legacy distributed Client.{submit, persist, compute} keywords
     if "workers" in annotations:
         if isinstance(annotations["workers"], (list, set, tuple)):
             annotations["workers"] = list(annotations["workers"])
@@ -149,16 +217,19 @@
         and not callable(annotations["allow_other_workers"])
     ):
         raise TypeError(
             "'allow_other_workers' annotations must be a bool or a callable, but got %s"
             % annotations["allow_other_workers"]
         )
 
-    with config.set({f"annotations.{k}": v for k, v in annotations.items()}):
+    token = _annotations.set(merge(_annotations.get(), annotations))
+    try:
         yield
+    finally:
+        _annotations.reset(token)
 
 
 def is_dask_collection(x) -> bool:
     """Returns ``True`` if ``x`` is a dask collection.
 
     Parameters
     ----------
@@ -1528,7 +1599,10 @@
     """
     if isinstance(key, tuple) and key and isinstance(key[0], str):
         return (clone_key(key[0], seed),) + key[1:]
     if isinstance(key, str):
         prefix = key_split(key)
         return prefix + "-" + tokenize(key, seed)
     raise TypeError(f"Expected str or tuple[str, Hashable, ...]; got {key}")
+
+
+atexit.register(_restore_excepthook)
```

### Comparing `dask-2023.6.0/dask/blockwise.py` & `dask-2023.6.1/dask/blockwise.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/core.py` & `dask-2023.6.1/dask/bytes/core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/tests/test_bytes_utils.py` & `dask-2023.6.1/dask/bytes/tests/test_bytes_utils.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/tests/test_compression.py` & `dask-2023.6.1/dask/bytes/tests/test_compression.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/tests/test_http.py` & `dask-2023.6.1/dask/bytes/tests/test_http.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/tests/test_local.py` & `dask-2023.6.1/dask/bytes/tests/test_local.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/bytes/tests/test_s3.py` & `dask-2023.6.1/dask/bytes/tests/test_s3.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/cache.py` & `dask-2023.6.1/dask/cache.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/callbacks.py` & `dask-2023.6.1/dask/callbacks.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/cli.py` & `dask-2023.6.1/dask/cli.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/compatibility.py` & `dask-2023.6.1/dask/compatibility.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/config.py` & `dask-2023.6.1/dask/config.py`

 * *Files 1% similar despite different names*

```diff
@@ -648,14 +648,15 @@
     "ucx.nvlink": "distributed.ucx.nvlink",
     "ucx.infiniband": "distributed.ucx.infiniband",
     "ucx.rdmacm": "distributed.ucx.rdmacm",
     "ucx.net-devices": "distributed.ucx.net-devices",
     "ucx.reuse-endpoints": "distributed.ucx.reuse-endpoints",
     "rmm.pool-size": "distributed.rmm.pool-size",
     "shuffle": "dataframe.shuffle.algorithm",
+    "array.rechunk-threshold": "array.rechunk.threshold",
     "dataframe.shuffle.algorithm": "dataframe.shuffle.method",
     "dataframe.shuffle-compression": "dataframe.shuffle.compression",
 }
 
 
 def check_deprecations(key: str, deprecations: dict = deprecations) -> str:
     """Check if the provided value has been renamed or removed
```

### Comparing `dask-2023.6.0/dask/context.py` & `dask-2023.6.1/dask/context.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/core.py` & `dask-2023.6.1/dask/core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dask-schema.yaml` & `dask-2023.6.1/dask/dask-schema.yaml`

 * *Files 2% similar despite different names*

```diff
@@ -98,22 +98,36 @@
         type:
         - string
         - "null"
         description: |
           Backend to use for supported array-creation functions.
           Default is "numpy".
 
+      chunk-size:
+        type:
+        - integer
+        - string
+        description: |
+          The default chunk size to target. Default is "128MiB".
+
       rechunk:
         type: object
         properties:
+          
           method:
             type: string
             description: |
               The method to use for rechunking. Must be either "tasks" or "p2p";
               default is "tasks". Using "p2p" requires a distributed cluster.
+          
+          threshold:
+            type: integer
+            description: |
+              The graph growth factor above which task-based shuffling introduces
+              an intermediate step.
 
       svg:
         type: object
         properties:
 
           size:
             type: integer
@@ -202,7 +216,34 @@
             type: boolean
             description:
               Set to true to rename the fused keys with `default_fused_keys_renamer`.
               Renaming fused keys can keep the graph more understandable and
               comprehensible, but it comes at the cost of additional processing. If
               False, then the top-most key will be used. For advanced usage, a function
               to create the new name is also accepted.
+
+  admin:
+    type: object
+    properties:
+
+      traceback:
+        type: object
+        properties:
+
+          shorten:
+            type: object
+            description:
+              Clean up tracebacks for readability.
+
+              If any of the modules in a traceback matches a regular expression listed
+              in 'when', then remove from it all modules that match a regular expression
+              in 'what'. Always preserve the first and last module.
+            additionalProperties: false
+            properties:
+              when:
+                type: array
+                items:
+                  type: string
+              what:
+                type: array
+                items:
+                  type: string
```

### Comparing `dask-2023.6.0/dask/dask.yaml` & `dask-2023.6.1/dask/dask.yaml`

 * *Files 27% similar despite different names*

```diff
@@ -14,16 +14,18 @@
   parquet:
     metadata-task-size-local: 512  # Number of files per local metadata-processing task
     metadata-task-size-remote: 1  # Number of files per remote metadata-processing task
   convert-string: false  # Whether to convert string-like data to pyarrow strings
 
 array:
   backend: "numpy"  # Backend array library for input IO and data creation
+  chunk-size: "128MiB"
   rechunk:
     method: "tasks"  # Rechunking method to use
+    threshold: 4
   svg:
     size: 120  # pixels
   slicing:
     split-large-chunks: null  # How to handle large output chunks in slicing. Warns by default.
 
 optimization:
   annotations:
@@ -32,7 +34,28 @@
     active: null  # Treat as false for dask.dataframe, true for everything else
     ave-width: 1
     max-width: null  # 1.5 + ave_width * log(ave_width + 1)
     max-height: .inf
     max-depth-new-edges: null  # ave_width * 1.5
     subgraphs: null  # true for dask.dataframe, false for everything else
     rename-keys: true
+
+admin:
+  traceback:
+    shorten:
+      when:
+        - dask[\\\/]base.py
+        - distributed[\\\/]client.py
+      what:
+        - dask[\\\/]base.py
+        - dask[\\\/]core.py
+        - dask[\\\/]array[\\\/]core.py
+        - dask[\\\/]optimization.py
+        - dask[\\\/]dataframe[\\\/]core.py
+        - dask[\\\/]dataframe[\\\/]methods.py
+        - dask[\\\/]utils.py
+        - distributed[\\\/]worker.py
+        - distributed[\\\/]scheduler.py
+        - distributed[\\\/]client.py
+        - distributed[\\\/]utils.py
+        - tornado[\\\/]gen.py
+        - pandas[\\\/]core[\\\/]
```

### Comparing `dask-2023.6.0/dask/dataframe/__init__.py` & `dask-2023.6.1/dask/dataframe/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/_compat.py` & `dask-2023.6.1/dask/dataframe/_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/_dtypes.py` & `dask-2023.6.1/dask/dataframe/_dtypes.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/_pyarrow.py` & `dask-2023.6.1/dask/dataframe/_pyarrow.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/_pyarrow_compat.py` & `dask-2023.6.1/dask/dataframe/_pyarrow_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/accessor.py` & `dask-2023.6.1/dask/dataframe/accessor.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/backends.py` & `dask-2023.6.1/dask/dataframe/backends.py`

 * *Files 3% similar despite different names*

```diff
@@ -13,25 +13,27 @@
 from dask.backends import CreationDispatch, DaskBackendEntrypoint
 from dask.dataframe._compat import is_any_real_numeric_dtype
 from dask.dataframe.core import DataFrame, Index, Scalar, Series, _Frame
 from dask.dataframe.dispatch import (
     categorical_dtype_dispatch,
     concat,
     concat_dispatch,
+    from_pyarrow_table_dispatch,
     get_parallel_type,
     group_split_dispatch,
     grouper_dispatch,
     hash_object_dispatch,
     is_categorical_dtype_dispatch,
     make_meta_dispatch,
     make_meta_obj,
     meta_lib_from_array,
     meta_nonempty,
     pyarrow_schema_dispatch,
     to_pandas_dispatch,
+    to_pyarrow_table_dispatch,
     tolist_dispatch,
     union_categoricals_dispatch,
 )
 from dask.dataframe.extensions import make_array_nonempty, make_scalar
 from dask.dataframe.utils import (
     _empty_series,
     _nonempty_scalar,
@@ -209,14 +211,28 @@
 @pyarrow_schema_dispatch.register((pd.DataFrame,))
 def get_pyarrow_schema_pandas(obj):
     import pyarrow as pa
 
     return pa.Schema.from_pandas(obj)
 
 
+@to_pyarrow_table_dispatch.register((pd.DataFrame,))
+def get_pyarrow_table_from_pandas(obj, **kwargs):
+    # `kwargs` must be supported by `pyarrow.Table.to_pandas`
+    import pyarrow as pa
+
+    return pa.Table.from_pandas(obj, **kwargs)
+
+
+@from_pyarrow_table_dispatch.register((pd.DataFrame,))
+def get_pandas_dataframe_from_pyarrow(_, table, **kwargs):
+    # `kwargs` must be supported by `pyarrow.Table.to_pandas`
+    return table.to_pandas(**kwargs)
+
+
 @meta_nonempty.register(pd.DatetimeTZDtype)
 @make_meta_dispatch.register(pd.DatetimeTZDtype)
 def make_meta_pandas_datetime_tz(x, index=None):
     return _nonempty_scalar(x)
 
 
 @make_meta_obj.register(meta_object_types)
```

### Comparing `dask-2023.6.0/dask/dataframe/categorical.py` & `dask-2023.6.1/dask/dataframe/categorical.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/core.py` & `dask-2023.6.1/dask/dataframe/core.py`

 * *Files 1% similar despite different names*

```diff
@@ -3758,15133 +3758,15121 @@
 0000ead0: 6e63 682c 0a20 2020 2020 2020 2020 2020  nch,.           
 0000eae0: 2073 6875 6666 6c65 3d73 6875 6666 6c65   shuffle=shuffle
 0000eaf0: 2c0a 2020 2020 2020 2020 2020 2020 6967  ,.            ig
 0000eb00: 6e6f 7265 5f69 6e64 6578 3d69 676e 6f72  nore_index=ignor
 0000eb10: 655f 696e 6465 782c 0a20 2020 2020 2020  e_index,.       
 0000eb20: 2020 2020 2063 6f6d 7075 7465 3d63 6f6d       compute=com
 0000eb30: 7075 7465 2c0a 2020 2020 2020 2020 290a  pute,.        ).
-0000eb40: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-0000eb50: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-0000eb60: 0a20 2020 2064 6566 2066 696c 6c6e 6128  .    def fillna(
-0000eb70: 7365 6c66 2c20 7661 6c75 653d 4e6f 6e65  self, value=None
-0000eb80: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 206c  , method=None, l
-0000eb90: 696d 6974 3d4e 6f6e 652c 2061 7869 733d  imit=None, axis=
-0000eba0: 4e6f 6e65 293a 0a20 2020 2020 2020 2061  None):.        a
-0000ebb0: 7869 7320 3d20 7365 6c66 2e5f 7661 6c69  xis = self._vali
-0000ebc0: 6461 7465 5f61 7869 7328 6178 6973 290a  date_axis(axis).
-0000ebd0: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
-0000ebe0: 6420 6973 204e 6f6e 6520 616e 6420 6c69  d is None and li
-0000ebf0: 6d69 7420 6973 206e 6f74 204e 6f6e 653a  mit is not None:
-0000ec00: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000ec10: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-0000ec20: 6445 7272 6f72 2822 6669 6c6c 6e61 2077  dError("fillna w
-0000ec30: 6974 6820 7365 7420 6c69 6d69 7420 616e  ith set limit an
-0000ec40: 6420 6d65 7468 6f64 3d4e 6f6e 6522 290a  d method=None").
-0000ec50: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000ec60: 7461 6e63 6528 7661 6c75 652c 2028 5f46  tance(value, (_F
-0000ec70: 7261 6d65 2c20 5363 616c 6172 2929 3a0a  rame, Scalar)):.
-0000ec80: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000ec90: 5f76 616c 7565 203d 2076 616c 7565 2e5f  _value = value._
-0000eca0: 6d65 7461 5f6e 6f6e 656d 7074 790a 2020  meta_nonempty.  
-0000ecb0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000ecc0: 2020 2020 2020 2020 7465 7374 5f76 616c          test_val
-0000ecd0: 7565 203d 2076 616c 7565 0a20 2020 2020  ue = value.     
-0000ece0: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
-0000ecf0: 6d65 7461 5f6e 6f6e 656d 7074 792e 6669  meta_nonempty.fi
-0000ed00: 6c6c 6e61 280a 2020 2020 2020 2020 2020  llna(.          
-0000ed10: 2020 7661 6c75 653d 7465 7374 5f76 616c    value=test_val
-0000ed20: 7565 2c20 6d65 7468 6f64 3d6d 6574 686f  ue, method=metho
-0000ed30: 642c 206c 696d 6974 3d6c 696d 6974 2c20  d, limit=limit, 
-0000ed40: 6178 6973 3d61 7869 730a 2020 2020 2020  axis=axis.      
-0000ed50: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000ed60: 6178 6973 203d 3d20 3120 6f72 206d 6574  axis == 1 or met
-0000ed70: 686f 6420 6973 204e 6f6e 653a 0a20 2020  hod is None:.   
-0000ed80: 2020 2020 2020 2020 2023 2043 6f6e 7472           # Contr
-0000ed90: 6f6c 2077 6865 7468 6572 206f 7220 6e6f  ol whether or no
-0000eda0: 7420 6461 736b 2773 2070 6172 7469 7469  t dask's partiti
-0000edb0: 6f6e 2061 6c69 676e 6d65 6e74 2068 6170  on alignment hap
-0000edc0: 7065 6e73 2e0a 2020 2020 2020 2020 2020  pens..          
-0000edd0: 2020 2320 5765 2064 6f6e 2774 2077 616e    # We don't wan
-0000ede0: 7420 666f 7220 6120 7061 6e64 6173 2053  t for a pandas S
-0000edf0: 6572 6965 732e 0a20 2020 2020 2020 2020  eries..         
-0000ee00: 2020 2023 2057 6520 646f 2077 616e 7420     # We do want 
-0000ee10: 6974 2066 6f72 2061 2064 6173 6b20 5365  it for a dask Se
-0000ee20: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
-0000ee30: 2069 6620 6973 5f73 6572 6965 735f 6c69   if is_series_li
-0000ee40: 6b65 2876 616c 7565 2920 616e 6420 6e6f  ke(value) and no
-0000ee50: 7420 6973 5f64 6173 6b5f 636f 6c6c 6563  t is_dask_collec
-0000ee60: 7469 6f6e 2876 616c 7565 293a 0a20 2020  tion(value):.   
-0000ee70: 2020 2020 2020 2020 2020 2020 2061 7267               arg
-0000ee80: 7320 3d20 2829 0a20 2020 2020 2020 2020  s = ().         
-0000ee90: 2020 2020 2020 206b 7761 7267 7320 3d20         kwargs = 
-0000eea0: 7b22 7661 6c75 6522 3a20 7661 6c75 657d  {"value": value}
-0000eeb0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000eec0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000eed0: 2020 2061 7267 7320 3d20 2876 616c 7565     args = (value
-0000eee0: 2c29 0a20 2020 2020 2020 2020 2020 2020  ,).             
-0000eef0: 2020 206b 7761 7267 7320 3d20 7b7d 0a20     kwargs = {}. 
-0000ef00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ef10: 6e20 7365 6c66 2e6d 6170 5f70 6172 7469  n self.map_parti
-0000ef20: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
-0000ef30: 2020 2020 2020 204d 2e66 696c 6c6e 612c         M.fillna,
-0000ef40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef50: 202a 6172 6773 2c0a 2020 2020 2020 2020   *args,.        
-0000ef60: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-0000ef70: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-0000ef80: 2020 2020 2020 206c 696d 6974 3d6c 696d         limit=lim
-0000ef90: 6974 2c0a 2020 2020 2020 2020 2020 2020  it,.            
-0000efa0: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000efc0: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
-0000efd0: 2020 2020 2020 2020 2020 656e 666f 7263            enforc
-0000efe0: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
-0000eff0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f000: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-0000f010: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0000f020: 2020 2069 6620 6d65 7468 6f64 2069 6e20     if method in 
-0000f030: 2822 7061 6422 2c20 2266 6669 6c6c 2229  ("pad", "ffill")
-0000f040: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-0000f050: 7468 6f64 203d 2022 6666 696c 6c22 0a20  thod = "ffill". 
-0000f060: 2020 2020 2020 2020 2020 2073 6b69 705f             skip_
-0000f070: 6368 6563 6b20 3d20 300a 2020 2020 2020  check = 0.      
-0000f080: 2020 2020 2020 6265 666f 7265 2c20 6166        before, af
-0000f090: 7465 7220 3d20 3120 6966 206c 696d 6974  ter = 1 if limit
-0000f0a0: 2069 7320 4e6f 6e65 2065 6c73 6520 6c69   is None else li
-0000f0b0: 6d69 742c 2030 0a20 2020 2020 2020 2065  mit, 0.        e
-0000f0c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f0d0: 206d 6574 686f 6420 3d20 2262 6669 6c6c   method = "bfill
-0000f0e0: 220a 2020 2020 2020 2020 2020 2020 736b  ".            sk
-0000f0f0: 6970 5f63 6865 636b 203d 2073 656c 662e  ip_check = self.
-0000f100: 6e70 6172 7469 7469 6f6e 7320 2d20 310a  npartitions - 1.
-0000f110: 2020 2020 2020 2020 2020 2020 6265 666f              befo
-0000f120: 7265 2c20 6166 7465 7220 3d20 302c 2031  re, after = 0, 1
-0000f130: 2069 6620 6c69 6d69 7420 6973 204e 6f6e   if limit is Non
-0000f140: 6520 656c 7365 206c 696d 6974 0a0a 2020  e else limit..  
-0000f150: 2020 2020 2020 6966 206c 696d 6974 2069        if limit i
-0000f160: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000f170: 2020 2020 6e61 6d65 203d 2022 6669 6c6c      name = "fill
-0000f180: 6e61 2d63 6875 6e6b 2d22 202b 2074 6f6b  na-chunk-" + tok
-0000f190: 656e 697a 6528 7365 6c66 2c20 6d65 7468  enize(self, meth
-0000f1a0: 6f64 290a 2020 2020 2020 2020 2020 2020  od).            
-0000f1b0: 6473 6b20 3d20 7b0a 2020 2020 2020 2020  dsk = {.        
-0000f1c0: 2020 2020 2020 2020 286e 616d 652c 2069          (name, i
-0000f1d0: 293a 2028 0a20 2020 2020 2020 2020 2020  ): (.           
-0000f1e0: 2020 2020 2020 2020 206d 6574 686f 6473           methods
-0000f1f0: 2e66 696c 6c6e 615f 6368 6563 6b2c 0a20  .fillna_check,. 
-0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f210: 2020 2028 7365 6c66 2e5f 6e61 6d65 2c20     (self._name, 
-0000f220: 6929 2c0a 2020 2020 2020 2020 2020 2020  i),.            
-0000f230: 2020 2020 2020 2020 6d65 7468 6f64 2c0a          method,.
-0000f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f250: 2020 2020 6920 213d 2073 6b69 705f 6368      i != skip_ch
-0000f260: 6563 6b2c 0a20 2020 2020 2020 2020 2020  eck,.           
-0000f270: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000f280: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000f290: 7261 6e67 6528 7365 6c66 2e6e 7061 7274  range(self.npart
-0000f2a0: 6974 696f 6e73 290a 2020 2020 2020 2020  itions).        
-0000f2b0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0000f2c0: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
-0000f2d0: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
-0000f2e0: 6c6c 6563 7469 6f6e 7328 6e61 6d65 2c20  llections(name, 
-0000f2f0: 6473 6b2c 2064 6570 656e 6465 6e63 6965  dsk, dependencie
-0000f300: 733d 5b73 656c 665d 290a 2020 2020 2020  s=[self]).      
-0000f310: 2020 2020 2020 7061 7274 7320 3d20 6e65        parts = ne
-0000f320: 775f 6464 5f6f 626a 6563 7428 6772 6170  w_dd_object(grap
-0000f330: 682c 206e 616d 652c 206d 6574 612c 2073  h, name, meta, s
-0000f340: 656c 662e 6469 7669 7369 6f6e 7329 0a20  elf.divisions). 
-0000f350: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000f360: 2020 2020 2020 2020 2070 6172 7473 203d           parts =
-0000f370: 2073 656c 660a 0a20 2020 2020 2020 2072   self..        r
-0000f380: 6574 7572 6e20 7061 7274 732e 6d61 705f  eturn parts.map_
-0000f390: 6f76 6572 6c61 7028 0a20 2020 2020 2020  overlap(.       
-0000f3a0: 2020 2020 204d 2e66 696c 6c6e 612c 2062       M.fillna, b
-0000f3b0: 6566 6f72 652c 2061 6674 6572 2c20 6d65  efore, after, me
-0000f3c0: 7468 6f64 3d6d 6574 686f 642c 206c 696d  thod=method, lim
-0000f3d0: 6974 3d6c 696d 6974 2c20 6d65 7461 3d6d  it=limit, meta=m
-0000f3e0: 6574 610a 2020 2020 2020 2020 290a 0a20  eta.        ).. 
-0000f3f0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-0000f400: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-0000f410: 2020 2064 6566 2066 6669 6c6c 2873 656c     def ffill(sel
-0000f420: 662c 2061 7869 733d 4e6f 6e65 2c20 6c69  f, axis=None, li
-0000f430: 6d69 743d 4e6f 6e65 293a 0a20 2020 2020  mit=None):.     
-0000f440: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
-0000f450: 696c 6c6e 6128 6d65 7468 6f64 3d22 6666  illna(method="ff
-0000f460: 696c 6c22 2c20 6c69 6d69 743d 6c69 6d69  ill", limit=limi
-0000f470: 742c 2061 7869 733d 6178 6973 290a 0a20  t, axis=axis).. 
-0000f480: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-0000f490: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-0000f4a0: 2020 2064 6566 2062 6669 6c6c 2873 656c     def bfill(sel
-0000f4b0: 662c 2061 7869 733d 4e6f 6e65 2c20 6c69  f, axis=None, li
-0000f4c0: 6d69 743d 4e6f 6e65 293a 0a20 2020 2020  mit=None):.     
-0000f4d0: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
-0000f4e0: 696c 6c6e 6128 6d65 7468 6f64 3d22 6266  illna(method="bf
-0000f4f0: 696c 6c22 2c20 6c69 6d69 743d 6c69 6d69  ill", limit=limi
-0000f500: 742c 2061 7869 733d 6178 6973 290a 0a20  t, axis=axis).. 
-0000f510: 2020 2064 6566 2073 616d 706c 6528 7365     def sample(se
-0000f520: 6c66 2c20 6e3d 4e6f 6e65 2c20 6672 6163  lf, n=None, frac
-0000f530: 3d4e 6f6e 652c 2072 6570 6c61 6365 3d46  =None, replace=F
-0000f540: 616c 7365 2c20 7261 6e64 6f6d 5f73 7461  alse, random_sta
-0000f550: 7465 3d4e 6f6e 6529 3a0a 2020 2020 2020  te=None):.      
-0000f560: 2020 2222 2252 616e 646f 6d20 7361 6d70    """Random samp
-0000f570: 6c65 206f 6620 6974 656d 730a 0a20 2020  le of items..   
-0000f580: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-0000f590: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000f5a0: 2d2d 0a20 2020 2020 2020 206e 203a 2069  --.        n : i
-0000f5b0: 6e74 2c20 6f70 7469 6f6e 616c 0a20 2020  nt, optional.   
-0000f5c0: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-0000f5d0: 6f66 2069 7465 6d73 2074 6f20 7265 7475  of items to retu
-0000f5e0: 726e 2069 7320 6e6f 7420 7375 7070 6f72  rn is not suppor
-0000f5f0: 7465 6420 6279 2064 6173 6b2e 2055 7365  ted by dask. Use
-0000f600: 2066 7261 630a 2020 2020 2020 2020 2020   frac.          
-0000f610: 2020 696e 7374 6561 642e 0a20 2020 2020    instead..     
-0000f620: 2020 2066 7261 6320 3a20 666c 6f61 742c     frac : float,
-0000f630: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0000f640: 2020 2020 2020 4170 7072 6f78 696d 6174        Approximat
-0000f650: 6520 6672 6163 7469 6f6e 206f 6620 6974  e fraction of it
-0000f660: 656d 7320 746f 2072 6574 7572 6e2e 2054  ems to return. T
-0000f670: 6869 7320 7361 6d70 6c69 6e67 2066 7261  his sampling fra
-0000f680: 6374 696f 6e20 6973 0a20 2020 2020 2020  ction is.       
-0000f690: 2020 2020 2061 7070 6c69 6564 2074 6f20       applied to 
-0000f6a0: 616c 6c20 7061 7274 6974 696f 6e73 2065  all partitions e
-0000f6b0: 7175 616c 6c79 2e20 4e6f 7465 2074 6861  qually. Note tha
-0000f6c0: 7420 7468 6973 2069 7320 616e 0a20 2020  t this is an.   
-0000f6d0: 2020 2020 2020 2020 202a 2a61 7070 726f           **appro
-0000f6e0: 7869 6d61 7465 2066 7261 6374 696f 6e2a  ximate fraction*
-0000f6f0: 2a2e 2059 6f75 2073 686f 756c 6420 6e6f  *. You should no
-0000f700: 7420 6578 7065 6374 2065 7861 6374 6c79  t expect exactly
-0000f710: 2060 606c 656e 2864 6629 202a 2066 7261   ``len(df) * fra
-0000f720: 6360 600a 2020 2020 2020 2020 2020 2020  c``.            
-0000f730: 6974 656d 7320 746f 2062 6520 7265 7475  items to be retu
-0000f740: 726e 6564 2c20 6173 2074 6865 2065 7861  rned, as the exa
-0000f750: 6374 206e 756d 6265 7220 6f66 2065 6c65  ct number of ele
-0000f760: 6d65 6e74 7320 7365 6c65 6374 6564 2077  ments selected w
-0000f770: 696c 6c0a 2020 2020 2020 2020 2020 2020  ill.            
-0000f780: 6465 7065 6e64 206f 6e20 686f 7720 796f  depend on how yo
-0000f790: 7572 2064 6174 6120 6973 2070 6172 7469  ur data is parti
-0000f7a0: 7469 6f6e 6564 2028 6275 7420 7368 6f75  tioned (but shou
-0000f7b0: 6c64 2062 6520 7072 6574 7479 2063 6c6f  ld be pretty clo
-0000f7c0: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-0000f7d0: 6e20 7072 6163 7469 6365 292e 0a20 2020  n practice)..   
-0000f7e0: 2020 2020 2072 6570 6c61 6365 203a 2062       replace : b
-0000f7f0: 6f6f 6c65 616e 2c20 6f70 7469 6f6e 616c  oolean, optional
-0000f800: 0a20 2020 2020 2020 2020 2020 2053 616d  .            Sam
-0000f810: 706c 6520 7769 7468 206f 7220 7769 7468  ple with or with
-0000f820: 6f75 7420 7265 706c 6163 656d 656e 742e  out replacement.
-0000f830: 2044 6566 6175 6c74 203d 2046 616c 7365   Default = False
-0000f840: 2e0a 2020 2020 2020 2020 7261 6e64 6f6d  ..        random
-0000f850: 5f73 7461 7465 203a 2069 6e74 206f 7220  _state : int or 
-0000f860: 6060 6e70 2e72 616e 646f 6d2e 5261 6e64  ``np.random.Rand
-0000f870: 6f6d 5374 6174 6560 600a 2020 2020 2020  omState``.      
-0000f880: 2020 2020 2020 4966 2061 6e20 696e 742c        If an int,
-0000f890: 2077 6520 6372 6561 7465 2061 206e 6577   we create a new
-0000f8a0: 2052 616e 646f 6d53 7461 7465 2077 6974   RandomState wit
-0000f8b0: 6820 7468 6973 2061 7320 7468 6520 7365  h this as the se
-0000f8c0: 6564 3b0a 2020 2020 2020 2020 2020 2020  ed;.            
-0000f8d0: 4f74 6865 7277 6973 6520 7765 2064 7261  Otherwise we dra
-0000f8e0: 7720 6672 6f6d 2074 6865 2070 6173 7365  w from the passe
-0000f8f0: 6420 5261 6e64 6f6d 5374 6174 652e 0a0a  d RandomState...
-0000f900: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0000f910: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000f920: 2d0a 2020 2020 2020 2020 4461 7461 4672  -.        DataFr
-0000f930: 616d 652e 7261 6e64 6f6d 5f73 706c 6974  ame.random_split
-0000f940: 0a20 2020 2020 2020 2070 616e 6461 732e  .        pandas.
-0000f950: 4461 7461 4672 616d 652e 7361 6d70 6c65  DataFrame.sample
-0000f960: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000f970: 2020 2020 2069 6620 6e20 6973 206e 6f74       if n is not
-0000f980: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000f990: 2020 206d 7367 203d 2028 0a20 2020 2020     msg = (.     
-0000f9a0: 2020 2020 2020 2020 2020 2022 7361 6d70             "samp
-0000f9b0: 6c65 2064 6f65 7320 6e6f 7420 7375 7070  le does not supp
-0000f9c0: 6f72 7420 7468 6520 6e75 6d62 6572 206f  ort the number o
-0000f9d0: 6620 7361 6d70 6c65 6420 6974 656d 7320  f sampled items 
-0000f9e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000f9f0: 2020 2270 6172 616d 6574 6572 2c20 276e    "parameter, 'n
-0000fa00: 272e 2050 6c65 6173 6520 7573 6520 7468  '. Please use th
-0000fa10: 6520 2766 7261 6327 2070 6172 616d 6574  e 'frac' paramet
-0000fa20: 6572 2069 6e73 7465 6164 2e22 0a20 2020  er instead.".   
-0000fa30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000fa40: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0000fa50: 616e 6365 286e 2c20 4e75 6d62 6572 2920  ance(n, Number) 
-0000fa60: 616e 6420 3020 3c3d 206e 203c 3d20 313a  and 0 <= n <= 1:
-0000fa70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fa80: 2077 6172 6e69 6e67 732e 7761 726e 286d   warnings.warn(m
-0000fa90: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
-0000faa0: 2020 2020 6672 6163 203d 206e 0a20 2020      frac = n.   
-0000fab0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000fac0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fad0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0000fae0: 6d73 6729 0a0a 2020 2020 2020 2020 6966  msg)..        if
-0000faf0: 2066 7261 6320 6973 204e 6f6e 653a 0a20   frac is None:. 
-0000fb00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000fb10: 2056 616c 7565 4572 726f 7228 2266 7261   ValueError("fra
-0000fb20: 6320 6d75 7374 206e 6f74 2062 6520 4e6f  c must not be No
-0000fb30: 6e65 2229 0a0a 2020 2020 2020 2020 6966  ne")..        if
-0000fb40: 2072 616e 646f 6d5f 7374 6174 6520 6973   random_state is
-0000fb50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000fb60: 2020 2072 616e 646f 6d5f 7374 6174 6520     random_state 
-0000fb70: 3d20 6e70 2e72 616e 646f 6d2e 5261 6e64  = np.random.Rand
-0000fb80: 6f6d 5374 6174 6528 290a 0a20 2020 2020  omState()..     
-0000fb90: 2020 206e 616d 6520 3d20 2273 616d 706c     name = "sampl
-0000fba0: 652d 2220 2b20 746f 6b65 6e69 7a65 2873  e-" + tokenize(s
-0000fbb0: 656c 662c 2066 7261 632c 2072 6570 6c61  elf, frac, repla
-0000fbc0: 6365 2c20 7261 6e64 6f6d 5f73 7461 7465  ce, random_state
-0000fbd0: 290a 0a20 2020 2020 2020 2073 7461 7465  )..        state
-0000fbe0: 5f64 6174 6120 3d20 7261 6e64 6f6d 5f73  _data = random_s
-0000fbf0: 7461 7465 5f64 6174 6128 7365 6c66 2e6e  tate_data(self.n
-0000fc00: 7061 7274 6974 696f 6e73 2c20 7261 6e64  partitions, rand
-0000fc10: 6f6d 5f73 7461 7465 290a 2020 2020 2020  om_state).      
-0000fc20: 2020 6473 6b20 3d20 7b0a 2020 2020 2020    dsk = {.      
-0000fc30: 2020 2020 2020 286e 616d 652c 2069 293a        (name, i):
-0000fc40: 2028 6d65 7468 6f64 732e 7361 6d70 6c65   (methods.sample
-0000fc50: 2c20 2873 656c 662e 5f6e 616d 652c 2069  , (self._name, i
-0000fc60: 292c 2073 7461 7465 2c20 6672 6163 2c20  ), state, frac, 
-0000fc70: 7265 706c 6163 6529 0a20 2020 2020 2020  replace).       
-0000fc80: 2020 2020 2066 6f72 2069 2c20 7374 6174       for i, stat
-0000fc90: 6520 696e 2065 6e75 6d65 7261 7465 2873  e in enumerate(s
-0000fca0: 7461 7465 5f64 6174 6129 0a20 2020 2020  tate_data).     
-0000fcb0: 2020 207d 0a0a 2020 2020 2020 2020 6772     }..        gr
-0000fcc0: 6170 6820 3d20 4869 6768 4c65 7665 6c47  aph = HighLevelG
-0000fcd0: 7261 7068 2e66 726f 6d5f 636f 6c6c 6563  raph.from_collec
-0000fce0: 7469 6f6e 7328 6e61 6d65 2c20 6473 6b2c  tions(name, dsk,
-0000fcf0: 2064 6570 656e 6465 6e63 6965 733d 5b73   dependencies=[s
-0000fd00: 656c 665d 290a 2020 2020 2020 2020 7265  elf]).        re
-0000fd10: 7475 726e 206e 6577 5f64 645f 6f62 6a65  turn new_dd_obje
-0000fd20: 6374 2867 7261 7068 2c20 6e61 6d65 2c20  ct(graph, name, 
-0000fd30: 7365 6c66 2e5f 6d65 7461 2c20 7365 6c66  self._meta, self
-0000fd40: 2e64 6976 6973 696f 6e73 290a 0a20 2020  .divisions)..   
-0000fd50: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-0000fd60: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-0000fd70: 2064 6566 2072 6570 6c61 6365 2873 656c   def replace(sel
-0000fd80: 662c 2074 6f5f 7265 706c 6163 653d 4e6f  f, to_replace=No
-0000fd90: 6e65 2c20 7661 6c75 653d 4e6f 6e65 2c20  ne, value=None, 
-0000fda0: 7265 6765 783d 4661 6c73 6529 3a0a 2020  regex=False):.  
-0000fdb0: 2020 2020 2020 2320 496e 2050 414e 4441        # In PANDA
-0000fdc0: 535f 4754 5f31 3430 2070 616e 6461 7320  S_GT_140 pandas 
-0000fdd0: 7374 6172 7473 2075 7369 6e67 206e 6f5f  starts using no_
-0000fde0: 6465 6661 756c 7420 696e 7374 6561 6420  default instead 
-0000fdf0: 6f66 204e 6f6e 650a 2020 2020 2020 2020  of None.        
-0000fe00: 7661 6c75 655f 6b77 6172 6720 3d20 7b22  value_kwarg = {"
-0000fe10: 7661 6c75 6522 3a20 7661 6c75 657d 2069  value": value} i
-0000fe20: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
-0000fe30: 6f6e 6520 656c 7365 207b 7d0a 2020 2020  one else {}.    
-0000fe40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000fe50: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
-0000fe60: 2020 2020 2020 2020 2020 2020 4d2e 7265              M.re
-0000fe70: 706c 6163 652c 0a20 2020 2020 2020 2020  place,.         
-0000fe80: 2020 2074 6f5f 7265 706c 6163 653d 746f     to_replace=to
-0000fe90: 5f72 6570 6c61 6365 2c0a 2020 2020 2020  _replace,.      
-0000fea0: 2020 2020 2020 2a2a 7661 6c75 655f 6b77        **value_kw
-0000feb0: 6172 672c 0a20 2020 2020 2020 2020 2020  arg,.           
-0000fec0: 2072 6567 6578 3d72 6567 6578 2c0a 2020   regex=regex,.  
-0000fed0: 2020 2020 2020 2020 2020 656e 666f 7263            enforc
-0000fee0: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
-0000fef0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0000ff00: 2064 6566 2074 6f5f 6461 736b 5f61 7272   def to_dask_arr
-0000ff10: 6179 2873 656c 662c 206c 656e 6774 6873  ay(self, lengths
-0000ff20: 3d4e 6f6e 652c 206d 6574 613d 4e6f 6e65  =None, meta=None
-0000ff30: 293a 0a20 2020 2020 2020 2022 2222 436f  ):.        """Co
-0000ff40: 6e76 6572 7420 6120 6461 736b 2044 6174  nvert a dask Dat
-0000ff50: 6146 7261 6d65 2074 6f20 6120 6461 736b  aFrame to a dask
-0000ff60: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
-0000ff70: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0000ff80: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0000ff90: 2020 2020 2020 206c 656e 6774 6873 203a         lengths :
-0000ffa0: 2062 6f6f 6c20 6f72 2053 6571 7565 6e63   bool or Sequenc
-0000ffb0: 6520 6f66 2069 6e74 732c 206f 7074 696f  e of ints, optio
-0000ffc0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0000ffd0: 486f 7720 746f 2064 6574 6572 6d69 6e65  How to determine
-0000ffe0: 2074 6865 2063 6875 6e6b 7320 7369 7a65   the chunks size
-0000fff0: 7320 666f 7220 7468 6520 6f75 7470 7574  s for the output
-00010000: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
-00010010: 2020 2020 4279 2064 6566 6175 6c74 2c20      By default, 
-00010020: 7468 6520 6f75 7470 7574 2061 7272 6179  the output array
-00010030: 2077 696c 6c20 6861 7665 2075 6e6b 6e6f   will have unkno
-00010040: 776e 2063 6875 6e6b 206c 656e 6774 6873  wn chunk lengths
-00010050: 0a20 2020 2020 2020 2020 2020 2061 6c6f  .            alo
-00010060: 6e67 2074 6865 2066 6972 7374 2061 7869  ng the first axi
-00010070: 732c 2077 6869 6368 2063 616e 2063 6175  s, which can cau
-00010080: 7365 2073 6f6d 6520 6c61 7465 7220 6f70  se some later op
-00010090: 6572 6174 696f 6e73 0a20 2020 2020 2020  erations.       
-000100a0: 2020 2020 2074 6f20 6661 696c 2e0a 0a20       to fail... 
-000100b0: 2020 2020 2020 2020 2020 202a 2054 7275             * Tru
-000100c0: 6520 3a20 696d 6d65 6469 6174 656c 7920  e : immediately 
-000100d0: 636f 6d70 7574 6520 7468 6520 6c65 6e67  compute the leng
-000100e0: 7468 206f 6620 6561 6368 2070 6172 7469  th of each parti
-000100f0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00010100: 202a 2053 6571 7565 6e63 6520 3a20 6120   * Sequence : a 
-00010110: 7365 7175 656e 6365 206f 6620 696e 7465  sequence of inte
-00010120: 6765 7273 2074 6f20 7573 6520 666f 7220  gers to use for 
-00010130: 7468 6520 6368 756e 6b20 7369 7a65 730a  the chunk sizes.
-00010140: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-00010150: 2074 6865 2066 6972 7374 2061 7869 732e   the first axis.
-00010160: 2054 6865 7365 2076 616c 7565 7320 6172   These values ar
-00010170: 6520 2a6e 6f74 2a20 7661 6c69 6461 7465  e *not* validate
-00010180: 6420 666f 720a 2020 2020 2020 2020 2020  d for.          
-00010190: 2020 2020 636f 7272 6563 746e 6573 732c      correctness,
-000101a0: 2062 6579 6f6e 6420 656e 7375 7269 6e67   beyond ensuring
-000101b0: 2074 6861 7420 7468 6520 6e75 6d62 6572   that the number
-000101c0: 206f 6620 6974 656d 730a 2020 2020 2020   of items.      
-000101d0: 2020 2020 2020 2020 6d61 7463 6865 7320          matches 
-000101e0: 7468 6520 6e75 6d62 6572 206f 6620 7061  the number of pa
-000101f0: 7274 6974 696f 6e73 2e0a 2020 2020 2020  rtitions..      
-00010200: 2020 6d65 7461 203a 206f 626a 6563 742c    meta : object,
-00010210: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00010220: 2020 2020 2020 416e 206f 7074 696f 6e61        An optiona
-00010230: 6c20 606d 6574 6160 2070 6172 616d 6574  l `meta` paramet
-00010240: 6572 2063 616e 2062 6520 7061 7373 6564  er can be passed
-00010250: 2066 6f72 2064 6173 6b20 746f 206f 7665   for dask to ove
-00010260: 7272 6964 6520 7468 650a 2020 2020 2020  rride the.      
-00010270: 2020 2020 2020 6465 6661 756c 7420 6d65        default me
-00010280: 7461 6461 7461 206f 6e20 7468 6520 756e  tadata on the un
-00010290: 6465 726c 7969 6e67 2064 6173 6b20 6172  derlying dask ar
-000102a0: 7261 792e 0a0a 2020 2020 2020 2020 5265  ray...        Re
-000102b0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
-000102c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2222  -----.        ""
-000102d0: 220a 2020 2020 2020 2020 6966 206c 656e  ".        if len
-000102e0: 6774 6873 2069 7320 5472 7565 3a0a 2020  gths is True:.  
-000102f0: 2020 2020 2020 2020 2020 6c65 6e67 7468            length
-00010300: 7320 3d20 7475 706c 6528 7365 6c66 2e6d  s = tuple(self.m
-00010310: 6170 5f70 6172 7469 7469 6f6e 7328 6c65  ap_partitions(le
-00010320: 6e2c 2065 6e66 6f72 6365 5f6d 6574 6164  n, enforce_metad
-00010330: 6174 613d 4661 6c73 6529 2e63 6f6d 7075  ata=False).compu
-00010340: 7465 2829 290a 0a20 2020 2020 2020 2061  te())..        a
-00010350: 7272 203d 2073 656c 662e 7661 6c75 6573  rr = self.values
-00010360: 0a0a 2020 2020 2020 2020 6368 756e 6b73  ..        chunks
-00010370: 203d 2073 656c 662e 5f76 616c 6964 6174   = self._validat
-00010380: 655f 6368 756e 6b73 2861 7272 2c20 6c65  e_chunks(arr, le
-00010390: 6e67 7468 7329 0a20 2020 2020 2020 2061  ngths).        a
-000103a0: 7272 2e5f 6368 756e 6b73 203d 2063 6875  rr._chunks = chu
-000103b0: 6e6b 730a 0a20 2020 2020 2020 2069 6620  nks..        if 
-000103c0: 6d65 7461 2069 7320 6e6f 7420 4e6f 6e65  meta is not None
-000103d0: 3a0a 2020 2020 2020 2020 2020 2020 6172  :.            ar
-000103e0: 722e 5f6d 6574 6120 3d20 6d65 7461 0a0a  r._meta = meta..
-000103f0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00010400: 7272 0a0a 2020 2020 6465 6620 746f 5f68  rr..    def to_h
-00010410: 6466 2873 656c 662c 2070 6174 685f 6f72  df(self, path_or
-00010420: 5f62 7566 2c20 6b65 792c 206d 6f64 653d  _buf, key, mode=
-00010430: 2261 222c 2061 7070 656e 643d 4661 6c73  "a", append=Fals
-00010440: 652c 202a 2a6b 7761 7267 7329 3a0a 2020  e, **kwargs):.  
-00010450: 2020 2020 2020 2222 2253 6565 2064 642e        """See dd.
-00010460: 746f 5f68 6466 2064 6f63 7374 7269 6e67  to_hdf docstring
-00010470: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
-00010480: 6174 696f 6e22 2222 0a20 2020 2020 2020  ation""".       
-00010490: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-000104a0: 7261 6d65 2e69 6f20 696d 706f 7274 2074  rame.io import t
-000104b0: 6f5f 6864 660a 0a20 2020 2020 2020 2072  o_hdf..        r
-000104c0: 6574 7572 6e20 746f 5f68 6466 2873 656c  eturn to_hdf(sel
-000104d0: 662c 2070 6174 685f 6f72 5f62 7566 2c20  f, path_or_buf, 
-000104e0: 6b65 792c 206d 6f64 652c 2061 7070 656e  key, mode, appen
-000104f0: 642c 202a 2a6b 7761 7267 7329 0a0a 2020  d, **kwargs)..  
-00010500: 2020 6465 6620 746f 5f63 7376 2873 656c    def to_csv(sel
-00010510: 662c 2066 696c 656e 616d 652c 202a 2a6b  f, filename, **k
-00010520: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00010530: 2222 2253 6565 2064 642e 746f 5f63 7376  """See dd.to_csv
-00010540: 2064 6f63 7374 7269 6e67 2066 6f72 206d   docstring for m
-00010550: 6f72 6520 696e 666f 726d 6174 696f 6e22  ore information"
-00010560: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00010570: 6461 736b 2e64 6174 6166 7261 6d65 2e69  dask.dataframe.i
-00010580: 6f20 696d 706f 7274 2074 6f5f 6373 760a  o import to_csv.
-00010590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000105a0: 746f 5f63 7376 2873 656c 662c 2066 696c  to_csv(self, fil
-000105b0: 656e 616d 652c 202a 2a6b 7761 7267 7329  ename, **kwargs)
-000105c0: 0a0a 2020 2020 6465 6620 746f 5f73 716c  ..    def to_sql
-000105d0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-000105e0: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
-000105f0: 722c 0a20 2020 2020 2020 2075 7269 3a20  r,.        uri: 
-00010600: 7374 722c 0a20 2020 2020 2020 2073 6368  str,.        sch
-00010610: 656d 613d 4e6f 6e65 2c0a 2020 2020 2020  ema=None,.      
-00010620: 2020 6966 5f65 7869 7374 733a 2073 7472    if_exists: str
-00010630: 203d 2022 6661 696c 222c 0a20 2020 2020   = "fail",.     
-00010640: 2020 2069 6e64 6578 3a20 626f 6f6c 203d     index: bool =
-00010650: 2054 7275 652c 0a20 2020 2020 2020 2069   True,.        i
-00010660: 6e64 6578 5f6c 6162 656c 3d4e 6f6e 652c  ndex_label=None,
-00010670: 0a20 2020 2020 2020 2063 6875 6e6b 7369  .        chunksi
-00010680: 7a65 3d4e 6f6e 652c 0a20 2020 2020 2020  ze=None,.       
-00010690: 2064 7479 7065 3d4e 6f6e 652c 0a20 2020   dtype=None,.   
-000106a0: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-000106b0: 2c0a 2020 2020 2020 2020 636f 6d70 7574  ,.        comput
-000106c0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-000106d0: 7061 7261 6c6c 656c 3d46 616c 7365 2c0a  parallel=False,.
-000106e0: 2020 2020 2020 2020 656e 6769 6e65 5f6b          engine_k
-000106f0: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
-00010700: 293a 0a20 2020 2020 2020 2022 2222 5365  ):.        """Se
-00010710: 6520 6464 2e74 6f5f 7371 6c20 646f 6373  e dd.to_sql docs
-00010720: 7472 696e 6720 666f 7220 6d6f 7265 2069  tring for more i
-00010730: 6e66 6f72 6d61 7469 6f6e 2222 220a 2020  nformation""".  
-00010740: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00010750: 6461 7461 6672 616d 652e 696f 2069 6d70  dataframe.io imp
-00010760: 6f72 7420 746f 5f73 716c 0a0a 2020 2020  ort to_sql..    
-00010770: 2020 2020 7265 7475 726e 2074 6f5f 7371      return to_sq
-00010780: 6c28 0a20 2020 2020 2020 2020 2020 2073  l(.            s
-00010790: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-000107a0: 206e 616d 653d 6e61 6d65 2c0a 2020 2020   name=name,.    
-000107b0: 2020 2020 2020 2020 7572 693d 7572 692c          uri=uri,
-000107c0: 0a20 2020 2020 2020 2020 2020 2073 6368  .            sch
-000107d0: 656d 613d 7363 6865 6d61 2c0a 2020 2020  ema=schema,.    
-000107e0: 2020 2020 2020 2020 6966 5f65 7869 7374          if_exist
-000107f0: 733d 6966 5f65 7869 7374 732c 0a20 2020  s=if_exists,.   
-00010800: 2020 2020 2020 2020 2069 6e64 6578 3d69           index=i
-00010810: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-00010820: 2020 696e 6465 785f 6c61 6265 6c3d 696e    index_label=in
-00010830: 6465 785f 6c61 6265 6c2c 0a20 2020 2020  dex_label,.     
-00010840: 2020 2020 2020 2063 6875 6e6b 7369 7a65         chunksize
-00010850: 3d63 6875 6e6b 7369 7a65 2c0a 2020 2020  =chunksize,.    
-00010860: 2020 2020 2020 2020 6474 7970 653d 6474          dtype=dt
-00010870: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00010880: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
-00010890: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-000108a0: 7574 653d 636f 6d70 7574 652c 0a20 2020  ute=compute,.   
-000108b0: 2020 2020 2020 2020 2070 6172 616c 6c65           paralle
-000108c0: 6c3d 7061 7261 6c6c 656c 2c0a 2020 2020  l=parallel,.    
-000108d0: 2020 2020 2020 2020 656e 6769 6e65 5f6b          engine_k
-000108e0: 7761 7267 733d 656e 6769 6e65 5f6b 7761  wargs=engine_kwa
-000108f0: 7267 732c 0a20 2020 2020 2020 2029 0a0a  rgs,.        )..
-00010900: 2020 2020 6465 6620 746f 5f6a 736f 6e28      def to_json(
-00010910: 7365 6c66 2c20 6669 6c65 6e61 6d65 2c20  self, filename, 
-00010920: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00010930: 3a0a 2020 2020 2020 2020 2222 2253 6565  :.        """See
-00010940: 2064 642e 746f 5f6a 736f 6e20 646f 6373   dd.to_json docs
-00010950: 7472 696e 6720 666f 7220 6d6f 7265 2069  tring for more i
-00010960: 6e66 6f72 6d61 7469 6f6e 2222 220a 2020  nformation""".  
-00010970: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00010980: 6461 7461 6672 616d 652e 696f 2069 6d70  dataframe.io imp
-00010990: 6f72 7420 746f 5f6a 736f 6e0a 0a20 2020  ort to_json..   
-000109a0: 2020 2020 2072 6574 7572 6e20 746f 5f6a       return to_j
-000109b0: 736f 6e28 7365 6c66 2c20 6669 6c65 6e61  son(self, filena
-000109c0: 6d65 2c20 2a61 7267 732c 202a 2a6b 7761  me, *args, **kwa
-000109d0: 7267 7329 0a0a 2020 2020 6465 6620 746f  rgs)..    def to
-000109e0: 5f64 656c 6179 6564 2873 656c 662c 206f  _delayed(self, o
-000109f0: 7074 696d 697a 655f 6772 6170 683d 5472  ptimize_graph=Tr
-00010a00: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-00010a10: 436f 6e76 6572 7420 696e 746f 2061 206c  Convert into a l
-00010a20: 6973 7420 6f66 2060 6064 6173 6b2e 6465  ist of ``dask.de
-00010a30: 6c61 7965 6460 6020 6f62 6a65 6374 732c  layed`` objects,
-00010a40: 206f 6e65 2070 6572 2070 6172 7469 7469   one per partiti
-00010a50: 6f6e 2e0a 0a20 2020 2020 2020 2050 6172  on...        Par
-00010a60: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00010a70: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00010a80: 2020 206f 7074 696d 697a 655f 6772 6170     optimize_grap
-00010a90: 6820 3a20 626f 6f6c 2c20 6f70 7469 6f6e  h : bool, option
-00010aa0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
-00010ab0: 6620 5472 7565 205b 6465 6661 756c 745d  f True [default]
-00010ac0: 2c20 7468 6520 6772 6170 6820 6973 206f  , the graph is o
-00010ad0: 7074 696d 697a 6564 2062 6566 6f72 6520  ptimized before 
-00010ae0: 636f 6e76 6572 7469 6e67 2069 6e74 6f0a  converting into.
-00010af0: 2020 2020 2020 2020 2020 2020 6060 6461              ``da
-00010b00: 736b 2e64 656c 6179 6564 6060 206f 626a  sk.delayed`` obj
-00010b10: 6563 7473 2e0a 0a20 2020 2020 2020 2045  ects...        E
-00010b20: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
-00010b30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00010b40: 203e 3e3e 2070 6172 7469 7469 6f6e 7320   >>> partitions 
-00010b50: 3d20 6466 2e74 6f5f 6465 6c61 7965 6428  = df.to_delayed(
-00010b60: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00010b70: 4b49 500a 0a20 2020 2020 2020 2053 6565  KIP..        See
-00010b80: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00010b90: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00010ba0: 6173 6b2e 6461 7461 6672 616d 652e 6672  ask.dataframe.fr
-00010bb0: 6f6d 5f64 656c 6179 6564 0a20 2020 2020  om_delayed.     
-00010bc0: 2020 2022 2222 0a20 2020 2020 2020 206b     """.        k
-00010bd0: 6579 7320 3d20 7365 6c66 2e5f 5f64 6173  eys = self.__das
-00010be0: 6b5f 6b65 7973 5f5f 2829 0a20 2020 2020  k_keys__().     
-00010bf0: 2020 2067 7261 7068 203d 2073 656c 662e     graph = self.
-00010c00: 5f5f 6461 736b 5f67 7261 7068 5f5f 2829  __dask_graph__()
-00010c10: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
-00010c20: 2073 656c 662e 5f5f 6461 736b 5f6c 6179   self.__dask_lay
-00010c30: 6572 735f 5f28 295b 305d 0a20 2020 2020  ers__()[0].     
-00010c40: 2020 2069 6620 6f70 7469 6d69 7a65 5f67     if optimize_g
-00010c50: 7261 7068 3a0a 2020 2020 2020 2020 2020  raph:.          
-00010c60: 2020 6772 6170 6820 3d20 7365 6c66 2e5f    graph = self._
-00010c70: 5f64 6173 6b5f 6f70 7469 6d69 7a65 5f5f  _dask_optimize__
-00010c80: 2867 7261 7068 2c20 7365 6c66 2e5f 5f64  (graph, self.__d
-00010c90: 6173 6b5f 6b65 7973 5f5f 2829 290a 2020  ask_keys__()).  
-00010ca0: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-00010cb0: 3d20 2264 656c 6179 6564 2d22 202b 2073  = "delayed-" + s
-00010cc0: 656c 662e 5f6e 616d 650a 2020 2020 2020  elf._name.      
-00010cd0: 2020 2020 2020 6772 6170 6820 3d20 4869        graph = Hi
-00010ce0: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-00010cf0: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6c61  m_collections(la
-00010d00: 7965 722c 2067 7261 7068 2c20 6465 7065  yer, graph, depe
-00010d10: 6e64 656e 6369 6573 3d28 2929 0a20 2020  ndencies=()).   
-00010d20: 2020 2020 2072 6574 7572 6e20 5b44 656c       return [Del
-00010d30: 6179 6564 286b 2c20 6772 6170 682c 206c  ayed(k, graph, l
-00010d40: 6179 6572 3d6c 6179 6572 2920 666f 7220  ayer=layer) for 
-00010d50: 6b20 696e 206b 6579 735d 0a0a 2020 2020  k in keys]..    
-00010d60: 6465 6620 746f 5f62 6163 6b65 6e64 2873  def to_backend(s
-00010d70: 656c 662c 2062 6163 6b65 6e64 3a20 7374  elf, backend: st
-00010d80: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
-00010d90: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00010da0: 2020 2020 2222 224d 6f76 6520 746f 2061      """Move to a
-00010db0: 206e 6577 2044 6174 6146 7261 6d65 2062   new DataFrame b
-00010dc0: 6163 6b65 6e64 0a0a 2020 2020 2020 2020  ackend..        
-00010dd0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00010de0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00010df0: 2020 2020 2020 6261 636b 656e 6420 3a20        backend : 
-00010e00: 7374 722c 204f 7074 696f 6e61 6c0a 2020  str, Optional.  
-00010e10: 2020 2020 2020 2020 2020 5468 6520 6e61            The na
-00010e20: 6d65 206f 6620 7468 6520 6e65 7720 6261  me of the new ba
-00010e30: 636b 656e 6420 746f 206d 6f76 6520 746f  ckend to move to
-00010e40: 2e20 5468 6520 6465 6661 756c 740a 2020  . The default.  
-00010e50: 2020 2020 2020 2020 2020 6973 2074 6865            is the
-00010e60: 2063 7572 7265 6e74 2022 6461 7461 6672   current "datafr
-00010e70: 616d 652e 6261 636b 656e 6422 2063 6f6e  ame.backend" con
-00010e80: 6669 6775 7261 7469 6f6e 2e0a 0a20 2020  figuration...   
-00010e90: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00010ea0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
-00010eb0: 2020 2020 2044 6174 6146 7261 6d65 2c20       DataFrame, 
-00010ec0: 5365 7269 6573 206f 7220 496e 6465 780a  Series or Index.
-00010ed0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010ee0: 2020 2020 6672 6f6d 2064 6173 6b2e 6461      from dask.da
-00010ef0: 7461 6672 616d 652e 696f 2069 6d70 6f72  taframe.io impor
-00010f00: 7420 746f 5f62 6163 6b65 6e64 0a0a 2020  t to_backend..  
-00010f10: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
-00010f20: 6261 636b 656e 6428 7365 6c66 2c20 6261  backend(self, ba
-00010f30: 636b 656e 643d 6261 636b 656e 642c 202a  ckend=backend, *
-00010f40: 2a6b 7761 7267 7329 0a0a 2020 2020 4063  *kwargs)..    @c
-00010f50: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00010f60: 6566 205f 6765 745f 756e 6172 795f 6f70  ef _get_unary_op
-00010f70: 6572 6174 6f72 2863 6c73 2c20 6f70 293a  erator(cls, op):
-00010f80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00010f90: 6c61 6d62 6461 2073 656c 663a 2065 6c65  lambda self: ele
-00010fa0: 6d77 6973 6528 6f70 2c20 7365 6c66 290a  mwise(op, self).
-00010fb0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00010fc0: 640a 2020 2020 6465 6620 5f67 6574 5f62  d.    def _get_b
-00010fd0: 696e 6172 795f 6f70 6572 6174 6f72 2863  inary_operator(c
-00010fe0: 6c73 2c20 6f70 2c20 696e 763d 4661 6c73  ls, op, inv=Fals
-00010ff0: 6529 3a0a 2020 2020 2020 2020 6966 2069  e):.        if i
-00011000: 6e76 3a0a 2020 2020 2020 2020 2020 2020  nv:.            
-00011010: 7265 7475 726e 206c 616d 6264 6120 7365  return lambda se
-00011020: 6c66 2c20 6f74 6865 723a 2065 6c65 6d77  lf, other: elemw
-00011030: 6973 6528 6f70 2c20 6f74 6865 722c 2073  ise(op, other, s
-00011040: 656c 6629 0a20 2020 2020 2020 2065 6c73  elf).        els
-00011050: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00011060: 6574 7572 6e20 6c61 6d62 6461 2073 656c  eturn lambda sel
-00011070: 662c 206f 7468 6572 3a20 656c 656d 7769  f, other: elemwi
-00011080: 7365 286f 702c 2073 656c 662c 206f 7468  se(op, self, oth
-00011090: 6572 290a 0a20 2020 2064 6566 2072 6f6c  er)..    def rol
-000110a0: 6c69 6e67 280a 2020 2020 2020 2020 7365  ling(.        se
-000110b0: 6c66 2c20 7769 6e64 6f77 2c20 6d69 6e5f  lf, window, min_
-000110c0: 7065 7269 6f64 733d 4e6f 6e65 2c20 6365  periods=None, ce
-000110d0: 6e74 6572 3d46 616c 7365 2c20 7769 6e5f  nter=False, win_
-000110e0: 7479 7065 3d4e 6f6e 652c 2061 7869 733d  type=None, axis=
-000110f0: 6e6f 5f64 6566 6175 6c74 0a20 2020 2029  no_default.    )
-00011100: 3a0a 2020 2020 2020 2020 2222 2250 726f  :.        """Pro
-00011110: 7669 6465 7320 726f 6c6c 696e 6720 7472  vides rolling tr
-00011120: 616e 7366 6f72 6d61 7469 6f6e 732e 0a0a  ansformations...
-00011130: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00011140: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-00011150: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7769  -----.        wi
-00011160: 6e64 6f77 203a 2069 6e74 2c20 7374 722c  ndow : int, str,
-00011170: 206f 6666 7365 740a 2020 2020 2020 2020   offset.        
-00011180: 2020 2053 697a 6520 6f66 2074 6865 206d     Size of the m
-00011190: 6f76 696e 6720 7769 6e64 6f77 2e20 5468  oving window. Th
-000111a0: 6973 2069 7320 7468 6520 6e75 6d62 6572  is is the number
-000111b0: 206f 6620 6f62 7365 7276 6174 696f 6e73   of observations
-000111c0: 2075 7365 640a 2020 2020 2020 2020 2020   used.          
-000111d0: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
-000111e0: 2074 6865 2073 7461 7469 7374 6963 2e20   the statistic. 
-000111f0: 5768 656e 206e 6f74 2075 7369 6e67 2061  When not using a
-00011200: 2060 6044 6174 6574 696d 6549 6e64 6578   ``DatetimeIndex
-00011210: 6060 2c0a 2020 2020 2020 2020 2020 2074  ``,.           t
-00011220: 6865 2077 696e 646f 7720 7369 7a65 206d  he window size m
-00011230: 7573 7420 6e6f 7420 6265 2073 6f20 6c61  ust not be so la
-00011240: 7267 6520 6173 2074 6f20 7370 616e 206d  rge as to span m
-00011250: 6f72 6520 7468 616e 206f 6e65 0a20 2020  ore than one.   
-00011260: 2020 2020 2020 2020 6164 6a61 6365 6e74          adjacent
-00011270: 2070 6172 7469 7469 6f6e 2e20 4966 2075   partition. If u
-00011280: 7369 6e67 2061 6e20 6f66 6673 6574 206f  sing an offset o
-00011290: 7220 6f66 6673 6574 2061 6c69 6173 206c  r offset alias l
-000112a0: 696b 6520 2735 4427 2c0a 2020 2020 2020  ike '5D',.      
-000112b0: 2020 2020 2074 6865 2064 6174 6120 6d75       the data mu
-000112c0: 7374 2068 6176 6520 6120 6060 4461 7465  st have a ``Date
-000112d0: 7469 6d65 496e 6465 7860 600a 0a20 2020  timeIndex``..   
-000112e0: 2020 2020 2020 2020 2e2e 2076 6572 7369          .. versi
-000112f0: 6f6e 6368 616e 6765 643a 3a20 302e 3135  onchanged:: 0.15
-00011300: 2e30 0a0a 2020 2020 2020 2020 2020 2020  .0..            
-00011310: 2020 4e6f 7720 6163 6365 7074 7320 6f66    Now accepts of
-00011320: 6673 6574 7320 616e 6420 7374 7269 6e67  fsets and string
-00011330: 206f 6666 7365 7420 616c 6961 7365 730a   offset aliases.
-00011340: 0a20 2020 2020 2020 206d 696e 5f70 6572  .        min_per
-00011350: 696f 6473 203a 2069 6e74 2c20 6465 6661  iods : int, defa
-00011360: 756c 7420 4e6f 6e65 0a20 2020 2020 2020  ult None.       
-00011370: 2020 2020 204d 696e 696d 756d 206e 756d       Minimum num
-00011380: 6265 7220 6f66 206f 6273 6572 7661 7469  ber of observati
-00011390: 6f6e 7320 696e 2077 696e 646f 7720 7265  ons in window re
-000113a0: 7175 6972 6564 2074 6f20 6861 7665 2061  quired to have a
-000113b0: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-000113c0: 2020 2028 6f74 6865 7277 6973 6520 7265     (otherwise re
-000113d0: 7375 6c74 2069 7320 4e41 292e 0a20 2020  sult is NA)..   
-000113e0: 2020 2020 2063 656e 7465 7220 3a20 626f       center : bo
-000113f0: 6f6c 6561 6e2c 2064 6566 6175 6c74 2046  olean, default F
-00011400: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00011410: 2053 6574 2074 6865 206c 6162 656c 7320   Set the labels 
-00011420: 6174 2074 6865 2063 656e 7465 7220 6f66  at the center of
-00011430: 2074 6865 2077 696e 646f 772e 0a20 2020   the window..   
-00011440: 2020 2020 2077 696e 5f74 7970 6520 3a20       win_type : 
-00011450: 7374 7269 6e67 2c20 6465 6661 756c 7420  string, default 
-00011460: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00011470: 2050 726f 7669 6465 2061 2077 696e 646f   Provide a windo
-00011480: 7720 7479 7065 2e20 5468 6520 7265 636f  w type. The reco
-00011490: 676e 697a 6564 2077 696e 646f 7720 7479  gnized window ty
-000114a0: 7065 7320 6172 6520 6964 656e 7469 6361  pes are identica
-000114b0: 6c0a 2020 2020 2020 2020 2020 2020 746f  l.            to
-000114c0: 2070 616e 6461 732e 0a20 2020 2020 2020   pandas..       
-000114d0: 2061 7869 7320 3a20 696e 742c 2073 7472   axis : int, str
-000114e0: 2c20 4e6f 6e65 2c20 6465 6661 756c 7420  , None, default 
-000114f0: 300a 2020 2020 2020 2020 2020 2020 5468  0.            Th
-00011500: 6973 2070 6172 616d 6574 6572 2069 7320  is parameter is 
-00011510: 6465 7072 6563 6174 6564 2077 6974 6820  deprecated with 
-00011520: 6060 7061 6e64 6173 3e3d 322e 3160 602e  ``pandas>=2.1``.
-00011530: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00011540: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00011550: 2d0a 2020 2020 2020 2020 6120 526f 6c6c  -.        a Roll
-00011560: 696e 6720 6f62 6a65 6374 206f 6e20 7768  ing object on wh
-00011570: 6963 6820 746f 2063 616c 6c20 6120 6d65  ich to call a me
-00011580: 7468 6f64 2074 6f20 636f 6d70 7574 6520  thod to compute 
-00011590: 6120 7374 6174 6973 7469 630a 2020 2020  a statistic.    
-000115a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000115b0: 6672 6f6d 2064 6173 6b2e 6461 7461 6672  from dask.datafr
-000115c0: 616d 652e 726f 6c6c 696e 6720 696d 706f  ame.rolling impo
-000115d0: 7274 2052 6f6c 6c69 6e67 0a0a 2020 2020  rt Rolling..    
-000115e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000115f0: 6528 7769 6e64 6f77 2c20 496e 7465 6772  e(window, Integr
-00011600: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
-00011610: 2069 6620 7769 6e64 6f77 203c 2030 3a0a   if window < 0:.
-00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00011640: 2822 7769 6e64 6f77 206d 7573 7420 6265  ("window must be
-00011650: 203e 3d20 3022 290a 0a20 2020 2020 2020   >= 0")..       
-00011660: 2069 6620 6d69 6e5f 7065 7269 6f64 7320   if min_periods 
-00011670: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00011680: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011690: 6973 696e 7374 616e 6365 286d 696e 5f70  isinstance(min_p
-000116a0: 6572 696f 6473 2c20 496e 7465 6772 616c  eriods, Integral
-000116b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000116c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000116d0: 726f 7228 226d 696e 5f70 6572 696f 6473  ror("min_periods
-000116e0: 206d 7573 7420 6265 2061 6e20 696e 7465   must be an inte
-000116f0: 6765 7222 290a 2020 2020 2020 2020 2020  ger").          
-00011700: 2020 6966 206d 696e 5f70 6572 696f 6473    if min_periods
-00011710: 203c 2030 3a0a 2020 2020 2020 2020 2020   < 0:.          
-00011720: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00011730: 6545 7272 6f72 2822 6d69 6e5f 7065 7269  eError("min_peri
-00011740: 6f64 7320 6d75 7374 2062 6520 3e3d 2030  ods must be >= 0
-00011750: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
-00011760: 726e 2052 6f6c 6c69 6e67 280a 2020 2020  rn Rolling(.    
-00011770: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00011780: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-00011790: 3d77 696e 646f 772c 0a20 2020 2020 2020  =window,.       
-000117a0: 2020 2020 206d 696e 5f70 6572 696f 6473       min_periods
-000117b0: 3d6d 696e 5f70 6572 696f 6473 2c0a 2020  =min_periods,.  
-000117c0: 2020 2020 2020 2020 2020 6365 6e74 6572            center
-000117d0: 3d63 656e 7465 722c 0a20 2020 2020 2020  =center,.       
-000117e0: 2020 2020 2077 696e 5f74 7970 653d 7769       win_type=wi
-000117f0: 6e5f 7479 7065 2c0a 2020 2020 2020 2020  n_type,.        
-00011800: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
-00011810: 2020 2020 2020 2029 0a0a 2020 2020 4064         )..    @d
-00011820: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
-00011830: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
-00011840: 6620 6469 6666 2873 656c 662c 2070 6572  f diff(self, per
-00011850: 696f 6473 3d31 2c20 6178 6973 3d30 293a  iods=1, axis=0):
-00011860: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011870: 2020 2020 202e 2e20 6e6f 7465 3a3a 0a0a       .. note::..
-00011880: 2020 2020 2020 2020 2020 2050 616e 6461             Panda
-00011890: 7320 6375 7272 656e 746c 7920 7573 6573  s currently uses
-000118a0: 2061 6e20 6060 6f62 6a65 6374 6060 2d64   an ``object``-d
-000118b0: 7479 7065 2063 6f6c 756d 6e20 746f 2072  type column to r
-000118c0: 6570 7265 7365 6e74 0a20 2020 2020 2020  epresent.       
-000118d0: 2020 2020 626f 6f6c 6561 6e20 6461 7461      boolean data
-000118e0: 2077 6974 6820 6d69 7373 696e 6720 7661   with missing va
-000118f0: 6c75 6573 2e20 5468 6973 2063 616e 2063  lues. This can c
-00011900: 6175 7365 2069 7373 7565 7320 666f 720a  ause issues for.
-00011910: 2020 2020 2020 2020 2020 2062 6f6f 6c65             boole
-00011920: 616e 2d73 7065 6369 6669 6320 6f70 6572  an-specific oper
-00011930: 6174 696f 6e73 2c20 6c69 6b65 2060 607c  ations, like ``|
-00011940: 6060 2e20 546f 2065 6e61 626c 6520 626f  ``. To enable bo
-00011950: 6f6c 6561 6e2d 0a20 2020 2020 2020 2020  olean-.         
-00011960: 2020 7370 6563 6966 6963 206f 7065 7261    specific opera
-00011970: 7469 6f6e 732c 2061 7420 7468 6520 636f  tions, at the co
-00011980: 7374 206f 6620 6d65 7461 6461 7461 2074  st of metadata t
-00011990: 6861 7420 646f 6573 6e27 7420 6d61 7463  hat doesn't matc
-000119a0: 680a 2020 2020 2020 2020 2020 2070 616e  h.           pan
-000119b0: 6461 732c 2075 7365 2060 602e 6173 7479  das, use ``.asty
-000119c0: 7065 2862 6f6f 6c29 6060 2061 6674 6572  pe(bool)`` after
-000119d0: 2074 6865 2060 6073 6869 6674 6060 2e0a   the ``shift``..
-000119e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000119f0: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
-00011a00: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
-00011a10: 7869 7329 0a20 2020 2020 2020 2069 6620  xis).        if 
-00011a20: 6e6f 7420 6973 696e 7374 616e 6365 2870  not isinstance(p
-00011a30: 6572 696f 6473 2c20 496e 7465 6772 616c  eriods, Integral
-00011a40: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00011a50: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-00011a60: 7065 7269 6f64 7320 6d75 7374 2062 6520  periods must be 
-00011a70: 616e 2069 6e74 6567 6572 2229 0a0a 2020  an integer")..  
-00011a80: 2020 2020 2020 6966 2061 7869 7320 3d3d        if axis ==
-00011a90: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00011aa0: 7265 7475 726e 2073 656c 662e 6d61 705f  return self.map_
-00011ab0: 7061 7274 6974 696f 6e73 280a 2020 2020  partitions(.    
-00011ac0: 2020 2020 2020 2020 2020 2020 4d2e 6469              M.di
-00011ad0: 6666 2c20 746f 6b65 6e3d 2264 6966 6622  ff, token="diff"
-00011ae0: 2c20 7065 7269 6f64 733d 7065 7269 6f64  , periods=period
-00011af0: 732c 2061 7869 733d 312c 2065 6e66 6f72  s, axis=1, enfor
-00011b00: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-00011b10: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
-00011b20: 0a20 2020 2020 2020 2062 6566 6f72 652c  .        before,
-00011b30: 2061 6674 6572 203d 2028 7065 7269 6f64   after = (period
-00011b40: 732c 2030 2920 6966 2070 6572 696f 6473  s, 0) if periods
-00011b50: 203e 2030 2065 6c73 6520 2830 2c20 2d70   > 0 else (0, -p
-00011b60: 6572 696f 6473 290a 2020 2020 2020 2020  eriods).        
-00011b70: 7265 7475 726e 2073 656c 662e 6d61 705f  return self.map_
-00011b80: 6f76 6572 6c61 7028 4d2e 6469 6666 2c20  overlap(M.diff, 
-00011b90: 6265 666f 7265 2c20 6166 7465 722c 2074  before, after, t
-00011ba0: 6f6b 656e 3d22 6469 6666 222c 2070 6572  oken="diff", per
-00011bb0: 696f 6473 3d70 6572 696f 6473 290a 0a20  iods=periods).. 
-00011bc0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-00011bd0: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-00011be0: 2020 2064 6566 2073 6869 6674 2873 656c     def shift(sel
-00011bf0: 662c 2070 6572 696f 6473 3d31 2c20 6672  f, periods=1, fr
-00011c00: 6571 3d4e 6f6e 652c 2061 7869 733d 3029  eq=None, axis=0)
-00011c10: 3a0a 2020 2020 2020 2020 6178 6973 203d  :.        axis =
-00011c20: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
-00011c30: 6178 6973 2861 7869 7329 0a20 2020 2020  axis(axis).     
-00011c40: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00011c50: 616e 6365 2870 6572 696f 6473 2c20 496e  ance(periods, In
-00011c60: 7465 6772 616c 293a 0a20 2020 2020 2020  tegral):.       
-00011c70: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00011c80: 7272 6f72 2822 7065 7269 6f64 7320 6d75  rror("periods mu
-00011c90: 7374 2062 6520 616e 2069 6e74 6567 6572  st be an integer
-00011ca0: 2229 0a0a 2020 2020 2020 2020 6966 2061  ")..        if a
-00011cb0: 7869 7320 3d3d 2031 3a0a 2020 2020 2020  xis == 1:.      
-00011cc0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00011cd0: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
-00011ce0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00011cf0: 2020 4d2e 7368 6966 742c 0a20 2020 2020    M.shift,.     
-00011d00: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
-00011d10: 3d22 7368 6966 7422 2c0a 2020 2020 2020  ="shift",.      
-00011d20: 2020 2020 2020 2020 2020 7065 7269 6f64            period
-00011d30: 733d 7065 7269 6f64 732c 0a20 2020 2020  s=periods,.     
-00011d40: 2020 2020 2020 2020 2020 2066 7265 713d             freq=
-00011d50: 6672 6571 2c0a 2020 2020 2020 2020 2020  freq,.          
-00011d60: 2020 2020 2020 6178 6973 3d31 2c0a 2020        axis=1,.  
-00011d70: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00011d80: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-00011d90: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00011da0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-00011db0: 6672 6571 2069 7320 4e6f 6e65 3a0a 2020  freq is None:.  
-00011dc0: 2020 2020 2020 2020 2020 6265 666f 7265            before
-00011dd0: 2c20 6166 7465 7220 3d20 2870 6572 696f  , after = (perio
-00011de0: 6473 2c20 3029 2069 6620 7065 7269 6f64  ds, 0) if period
-00011df0: 7320 3e20 3020 656c 7365 2028 302c 202d  s > 0 else (0, -
-00011e00: 7065 7269 6f64 7329 0a20 2020 2020 2020  periods).       
-00011e10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00011e20: 2e6d 6170 5f6f 7665 726c 6170 280a 2020  .map_overlap(.  
-00011e30: 2020 2020 2020 2020 2020 2020 2020 4d2e                M.
-00011e40: 7368 6966 742c 2062 6566 6f72 652c 2061  shift, before, a
-00011e50: 6674 6572 2c20 746f 6b65 6e3d 2273 6869  fter, token="shi
-00011e60: 6674 222c 2070 6572 696f 6473 3d70 6572  ft", periods=per
-00011e70: 696f 6473 0a20 2020 2020 2020 2020 2020  iods.           
-00011e80: 2029 0a0a 2020 2020 2020 2020 2320 4c65   )..        # Le
-00011e90: 7420 7061 6e64 6173 2065 7272 6f72 206f  t pandas error o
-00011ea0: 6e20 696e 7661 6c69 6420 6172 6775 6d65  n invalid argume
-00011eb0: 6e74 730a 2020 2020 2020 2020 6d65 7461  nts.        meta
-00011ec0: 203d 2073 656c 662e 5f6d 6574 615f 6e6f   = self._meta_no
-00011ed0: 6e65 6d70 7479 2e73 6869 6674 2870 6572  nempty.shift(per
-00011ee0: 696f 6473 2c20 6672 6571 3d66 7265 7129  iods, freq=freq)
-00011ef0: 0a20 2020 2020 2020 206f 7574 203d 2073  .        out = s
-00011f00: 656c 662e 6d61 705f 7061 7274 6974 696f  elf.map_partitio
-00011f10: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
-00011f20: 4d2e 7368 6966 742c 0a20 2020 2020 2020  M.shift,.       
-00011f30: 2020 2020 2074 6f6b 656e 3d22 7368 6966       token="shif
-00011f40: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00011f50: 7065 7269 6f64 733d 7065 7269 6f64 732c  periods=periods,
-00011f60: 0a20 2020 2020 2020 2020 2020 2066 7265  .            fre
-00011f70: 713d 6672 6571 2c0a 2020 2020 2020 2020  q=freq,.        
-00011f80: 2020 2020 6d65 7461 3d6d 6574 612c 0a20      meta=meta,. 
-00011f90: 2020 2020 2020 2020 2020 2065 6e66 6f72             enfor
-00011fa0: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-00011fb0: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
-00011fc0: 7261 6e73 666f 726d 5f64 6976 6973 696f  ransform_divisio
-00011fd0: 6e73 3d46 616c 7365 2c0a 2020 2020 2020  ns=False,.      
-00011fe0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-00011ff0: 726e 206d 6179 6265 5f73 6869 6674 5f64  rn maybe_shift_d
-00012000: 6976 6973 696f 6e73 286f 7574 2c20 7065  ivisions(out, pe
-00012010: 7269 6f64 732c 2066 7265 713d 6672 6571  riods, freq=freq
-00012020: 290a 0a20 2020 2064 6566 205f 7265 6475  )..    def _redu
-00012030: 6374 696f 6e5f 6167 6728 0a20 2020 2020  ction_agg(.     
-00012040: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00012050: 206e 616d 652c 0a20 2020 2020 2020 2061   name,.        a
-00012060: 7869 733d 4e6f 6e65 2c0a 2020 2020 2020  xis=None,.      
-00012070: 2020 736b 6970 6e61 3d54 7275 652c 0a20    skipna=True,. 
-00012080: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
-00012090: 7279 3d46 616c 7365 2c0a 2020 2020 2020  ry=False,.      
-000120a0: 2020 6f75 743d 4e6f 6e65 2c0a 2020 2020    out=None,.    
-000120b0: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
-000120c0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206e  =None,.        n
-000120d0: 6f6e 655f 6973 5f7a 6572 6f3d 5472 7565  one_is_zero=True
-000120e0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-000120f0: 2061 7869 7320 3d20 7365 6c66 2e5f 7661   axis = self._va
-00012100: 6c69 6461 7465 5f61 7869 7328 6178 6973  lidate_axis(axis
-00012110: 2c20 6e6f 6e65 5f69 735f 7a65 726f 3d6e  , none_is_zero=n
-00012120: 6f6e 655f 6973 5f7a 6572 6f29 0a0a 2020  one_is_zero)..  
-00012130: 2020 2020 2020 6966 2068 6173 5f6b 6579        if has_key
-00012140: 776f 7264 2867 6574 6174 7472 2873 656c  word(getattr(sel
-00012150: 662e 5f6d 6574 615f 6e6f 6e65 6d70 7479  f._meta_nonempty
-00012160: 2c20 6e61 6d65 292c 2022 6e75 6d65 7269  , name), "numeri
-00012170: 635f 6f6e 6c79 2229 3a0a 2020 2020 2020  c_only"):.      
-00012180: 2020 2020 2020 6e75 6d65 7269 635f 6f6e        numeric_on
-00012190: 6c79 5f6b 7761 7267 7320 3d20 7b22 6e75  ly_kwargs = {"nu
-000121a0: 6d65 7269 635f 6f6e 6c79 223a 206e 756d  meric_only": num
-000121b0: 6572 6963 5f6f 6e6c 797d 0a20 2020 2020  eric_only}.     
-000121c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000121d0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
-000121e0: 795f 6b77 6172 6773 203d 207b 7d0a 0a20  y_kwargs = {}.. 
-000121f0: 2020 2020 2020 2077 6974 6820 6368 6563         with chec
-00012200: 6b5f 6e75 6d65 7269 635f 6f6e 6c79 5f64  k_numeric_only_d
-00012210: 6570 7265 6361 7469 6f6e 286e 616d 652c  eprecation(name,
-00012220: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
-00012230: 2020 2020 6d65 7461 203d 2067 6574 6174      meta = getat
-00012240: 7472 2873 656c 662e 5f6d 6574 615f 6e6f  tr(self._meta_no
-00012250: 6e65 6d70 7479 2c20 6e61 6d65 2928 0a20  nempty, name)(. 
-00012260: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00012270: 7869 733d 6178 6973 2c20 736b 6970 6e61  xis=axis, skipna
-00012280: 3d73 6b69 706e 612c 202a 2a6e 756d 6572  =skipna, **numer
-00012290: 6963 5f6f 6e6c 795f 6b77 6172 6773 0a20  ic_only_kwargs. 
-000122a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000122b0: 2020 2020 2020 746f 6b65 6e20 3d20 7365        token = se
-000122c0: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
-000122d0: 202b 206e 616d 650a 2020 2020 2020 2020   + name.        
-000122e0: 6966 2061 7869 7320 3d3d 2031 3a0a 2020  if axis == 1:.  
-000122f0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00012300: 203d 2073 656c 662e 6d61 705f 7061 7274   = self.map_part
-00012310: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
-00012320: 2020 2020 2020 2020 5f67 6574 6174 7472          _getattr
-00012330: 5f6e 756d 6572 6963 5f6f 6e6c 792c 0a20  _numeric_only,. 
-00012340: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00012350: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
-00012360: 2020 2020 2020 2020 2020 746f 6b65 6e3d            token=
-00012370: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
-00012380: 2020 2020 2020 2073 6b69 706e 613d 736b         skipna=sk
-00012390: 6970 6e61 2c0a 2020 2020 2020 2020 2020  ipna,.          
-000123a0: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
-000123b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000123c0: 205f 6461 736b 5f6d 6574 686f 645f 6e61   _dask_method_na
-000123d0: 6d65 3d6e 616d 652c 0a20 2020 2020 2020  me=name,.       
-000123e0: 2020 2020 2020 2020 202a 2a6e 756d 6572           **numer
-000123f0: 6963 5f6f 6e6c 795f 6b77 6172 6773 2c0a  ic_only_kwargs,.
-00012400: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00012410: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012420: 2068 616e 646c 655f 6f75 7428 6f75 742c   handle_out(out,
-00012430: 2072 6573 756c 7429 0a20 2020 2020 2020   result).       
-00012440: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00012450: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-00012460: 2e72 6564 7563 7469 6f6e 280a 2020 2020  .reduction(.    
-00012470: 2020 2020 2020 2020 2020 2020 5f67 6574              _get
-00012480: 6174 7472 5f6e 756d 6572 6963 5f6f 6e6c  attr_numeric_onl
-00012490: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-000124a0: 2020 206d 6574 613d 6d65 7461 2c0a 2020     meta=meta,.  
-000124b0: 2020 2020 2020 2020 2020 2020 2020 746f                to
-000124c0: 6b65 6e3d 746f 6b65 6e2c 0a20 2020 2020  ken=token,.     
-000124d0: 2020 2020 2020 2020 2020 2073 6b69 706e             skipn
-000124e0: 613d 736b 6970 6e61 2c0a 2020 2020 2020  a=skipna,.      
-000124f0: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
-00012500: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-00012510: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
-00012520: 3d73 706c 6974 5f65 7665 7279 2c0a 2020  =split_every,.  
-00012530: 2020 2020 2020 2020 2020 2020 2020 5f64                _d
-00012540: 6173 6b5f 6d65 7468 6f64 5f6e 616d 653d  ask_method_name=
-00012550: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00012560: 2020 2020 2020 2a2a 6e75 6d65 7269 635f        **numeric_
-00012570: 6f6e 6c79 5f6b 7761 7267 732c 0a20 2020  only_kwargs,.   
-00012580: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00012590: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000125a0: 616e 6365 2873 656c 662c 2044 6174 6146  ance(self, DataF
-000125b0: 7261 6d65 2920 616e 6420 6973 696e 7374  rame) and isinst
-000125c0: 616e 6365 2872 6573 756c 742c 2053 6572  ance(result, Ser
-000125d0: 6965 7329 3a0a 2020 2020 2020 2020 2020  ies):.          
-000125e0: 2020 2020 2020 7265 7375 6c74 2e64 6976        result.div
-000125f0: 6973 696f 6e73 203d 2028 7365 6c66 2e63  isions = (self.c
-00012600: 6f6c 756d 6e73 2e6d 696e 2829 2c20 7365  olumns.min(), se
-00012610: 6c66 2e63 6f6c 756d 6e73 2e6d 6178 2829  lf.columns.max()
-00012620: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00012630: 7475 726e 2068 616e 646c 655f 6f75 7428  turn handle_out(
-00012640: 6f75 742c 2072 6573 756c 7429 0a0a 2020  out, result)..  
-00012650: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
-00012660: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
-00012670: 2020 6465 6620 6164 645f 7072 6566 6978    def add_prefix
-00012680: 2873 656c 662c 2070 7265 6669 7829 3a0a  (self, prefix):.
-00012690: 2020 2020 2020 2020 7265 7320 3d20 7365          res = se
-000126a0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-000126b0: 7328 4d2e 6164 645f 7072 6566 6978 2c20  s(M.add_prefix, 
-000126c0: 7072 6566 6978 290a 2020 2020 2020 2020  prefix).        
-000126d0: 6966 2073 656c 662e 6b6e 6f77 6e5f 6469  if self.known_di
-000126e0: 7669 7369 6f6e 7320 616e 6420 6973 5f73  visions and is_s
-000126f0: 6572 6965 735f 6c69 6b65 2873 656c 6629  eries_like(self)
+0000eb40: 0a20 2020 2064 6566 205f 6c69 6d69 745f  .    def _limit_
+0000eb50: 6669 6c6c 6e61 2873 656c 662c 206d 6574  fillna(self, met
+0000eb60: 686f 643d 4e6f 6e65 2c20 2a2c 206c 696d  hod=None, *, lim
+0000eb70: 6974 3d4e 6f6e 652c 2073 6b69 705f 6368  it=None, skip_ch
+0000eb80: 6563 6b3d 4e6f 6e65 2c20 6d65 7461 3d4e  eck=None, meta=N
+0000eb90: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+0000eba0: 206c 696d 6974 2069 7320 4e6f 6e65 3a0a   limit is None:.
+0000ebb0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0000ebc0: 203d 2022 6669 6c6c 6e61 2d63 6875 6e6b   = "fillna-chunk
+0000ebd0: 2d22 202b 2074 6f6b 656e 697a 6528 7365  -" + tokenize(se
+0000ebe0: 6c66 2c20 6d65 7468 6f64 290a 2020 2020  lf, method).    
+0000ebf0: 2020 2020 2020 2020 6473 6b20 3d20 7b0a          dsk = {.
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 286e 616d 652c 2069 293a 2028 0a20 2020  (name, i): (.   
+0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec30: 206d 6574 686f 6473 2e66 696c 6c6e 615f   methods.fillna_
+0000ec40: 6368 6563 6b2c 0a20 2020 2020 2020 2020  check,.         
+0000ec50: 2020 2020 2020 2020 2020 2028 7365 6c66             (self
+0000ec60: 2e5f 6e61 6d65 2c20 6929 2c0a 2020 2020  ._name, i),.    
+0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec80: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+0000ec90: 2020 2020 2020 2020 2020 2020 6920 213d              i !=
+0000eca0: 2073 6b69 705f 6368 6563 6b2c 0a20 2020   skip_check,.   
+0000ecb0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ecd0: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
+0000ece0: 6c66 2e6e 7061 7274 6974 696f 6e73 290a  lf.npartitions).
+0000ecf0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+0000ed00: 2020 2020 2020 2020 2020 6772 6170 6820            graph 
+0000ed10: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
+0000ed20: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
+0000ed30: 7328 6e61 6d65 2c20 6473 6b2c 2064 6570  s(name, dsk, dep
+0000ed40: 656e 6465 6e63 6965 733d 5b73 656c 665d  endencies=[self]
+0000ed50: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000ed60: 7475 726e 206e 6577 5f64 645f 6f62 6a65  turn new_dd_obje
+0000ed70: 6374 2867 7261 7068 2c20 6e61 6d65 2c20  ct(graph, name, 
+0000ed80: 6d65 7461 2c20 7365 6c66 2e64 6976 6973  meta, self.divis
+0000ed90: 696f 6e73 290a 2020 2020 2020 2020 656c  ions).        el
+0000eda0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000edb0: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
+0000edc0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+0000edd0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+0000ede0: 2064 6566 2066 696c 6c6e 6128 7365 6c66   def fillna(self
+0000edf0: 2c20 7661 6c75 653d 4e6f 6e65 2c20 6d65  , value=None, me
+0000ee00: 7468 6f64 3d4e 6f6e 652c 206c 696d 6974  thod=None, limit
+0000ee10: 3d4e 6f6e 652c 2061 7869 733d 4e6f 6e65  =None, axis=None
+0000ee20: 293a 0a20 2020 2020 2020 2069 6620 6d65  ):.        if me
+0000ee30: 7468 6f64 2069 7320 4e6f 6e65 2061 6e64  thod is None and
+0000ee40: 206c 696d 6974 2069 7320 6e6f 7420 4e6f   limit is not No
+0000ee50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000ee60: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+0000ee70: 6e74 6564 4572 726f 7228 2266 696c 6c6e  ntedError("filln
+0000ee80: 6120 7769 7468 2073 6574 206c 696d 6974  a with set limit
+0000ee90: 2061 6e64 206d 6574 686f 643d 4e6f 6e65   and method=None
+0000eea0: 2229 0a0a 2020 2020 2020 2020 6178 6973  ")..        axis
+0000eeb0: 203d 2073 656c 662e 5f76 616c 6964 6174   = self._validat
+0000eec0: 655f 6178 6973 2861 7869 7329 0a20 2020  e_axis(axis).   
+0000eed0: 2020 2020 2074 6573 745f 7661 6c75 6520       test_value 
+0000eee0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000eef0: 7661 6c75 652e 5f6d 6574 615f 6e6f 6e65  value._meta_none
+0000ef00: 6d70 7479 2069 6620 6973 696e 7374 616e  mpty if isinstan
+0000ef10: 6365 2876 616c 7565 2c20 285f 4672 616d  ce(value, (_Fram
+0000ef20: 652c 2053 6361 6c61 7229 2920 656c 7365  e, Scalar)) else
+0000ef30: 2076 616c 7565 0a20 2020 2020 2020 2029   value.        )
+0000ef40: 0a0a 2020 2020 2020 2020 2320 6c65 7420  ..        # let 
+0000ef50: 6974 2072 6169 7365 2061 2046 7574 7572  it raise a Futur
+0000ef60: 6557 6172 6e69 6e67 2069 6620 606d 6574  eWarning if `met
+0000ef70: 686f 6460 2069 7320 6e6f 7420 4e6f 6e65  hod` is not None
+0000ef80: 0a20 2020 2020 2020 206d 6574 6120 3d20  .        meta = 
+0000ef90: 7365 6c66 2e5f 6d65 7461 5f6e 6f6e 656d  self._meta_nonem
+0000efa0: 7074 792e 6669 6c6c 6e61 280a 2020 2020  pty.fillna(.    
+0000efb0: 2020 2020 2020 2020 7661 6c75 653d 7465          value=te
+0000efc0: 7374 5f76 616c 7565 2c20 6d65 7468 6f64  st_value, method
+0000efd0: 3d6d 6574 686f 642c 206c 696d 6974 3d6c  =method, limit=l
+0000efe0: 696d 6974 2c20 6178 6973 3d61 7869 730a  imit, axis=axis.
+0000eff0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000f000: 2020 2069 6620 6d65 7468 6f64 2069 7320     if method is 
+0000f010: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000f020: 2020 2320 436f 6e74 726f 6c20 7768 6574    # Control whet
+0000f030: 6865 7220 6f72 206e 6f74 2064 6173 6b27  her or not dask'
+0000f040: 7320 7061 7274 6974 696f 6e20 616c 6967  s partition alig
+0000f050: 6e6d 656e 7420 6861 7070 656e 732e 0a20  nment happens.. 
+0000f060: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
+0000f070: 646f 6e27 7420 7761 6e74 2066 6f72 2061  don't want for a
+0000f080: 2070 616e 6461 7320 5365 7269 6573 2e0a   pandas Series..
+0000f090: 2020 2020 2020 2020 2020 2020 2320 5765              # We
+0000f0a0: 2064 6f20 7761 6e74 2069 7420 666f 7220   do want it for 
+0000f0b0: 6120 6461 736b 2053 6572 6965 730a 2020  a dask Series.  
+0000f0c0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
+0000f0d0: 7365 7269 6573 5f6c 696b 6528 7661 6c75  series_like(valu
+0000f0e0: 6529 2061 6e64 206e 6f74 2069 735f 6461  e) and not is_da
+0000f0f0: 736b 5f63 6f6c 6c65 6374 696f 6e28 7661  sk_collection(va
+0000f100: 6c75 6529 3a0a 2020 2020 2020 2020 2020  lue):.          
+0000f110: 2020 2020 2020 6172 6773 203d 2028 290a        args = ().
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f130: 6b77 6172 6773 203d 207b 2276 616c 7565  kwargs = {"value
+0000f140: 223a 2076 616c 7565 7d0a 2020 2020 2020  ": value}.      
+0000f150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f160: 2020 2020 2020 2020 2020 2020 6172 6773              args
+0000f170: 203d 2028 7661 6c75 652c 290a 2020 2020   = (value,).    
+0000f180: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
+0000f190: 6773 203d 207b 7d0a 0a20 2020 2020 2020  gs = {}..       
+0000f1a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000f1b0: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+0000f1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f1d0: 204d 2e66 696c 6c6e 612c 0a20 2020 2020   M.fillna,.     
+0000f1e0: 2020 2020 2020 2020 2020 202a 6172 6773             *args
+0000f1f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f200: 2020 6c69 6d69 743d 6c69 6d69 742c 0a20    limit=limit,. 
+0000f210: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000f220: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
+0000f230: 2020 2020 2020 2020 2020 6d65 7461 3d6d            meta=m
+0000f240: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
+0000f250: 2020 2020 2065 6e66 6f72 6365 5f6d 6574       enforce_met
+0000f260: 6164 6174 613d 4661 6c73 652c 0a20 2020  adata=False,.   
+0000f270: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
+0000f280: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0000f290: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
+0000f2a0: 6620 6d65 7468 6f64 2069 6e20 2822 7061  f method in ("pa
+0000f2b0: 6422 2c20 2266 6669 6c6c 2229 3a0a 2020  d", "ffill"):.  
+0000f2c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f2d0: 2073 656c 662e 6666 696c 6c28 6c69 6d69   self.ffill(limi
+0000f2e0: 743d 6c69 6d69 742c 2061 7869 733d 6178  t=limit, axis=ax
+0000f2f0: 6973 290a 2020 2020 2020 2020 656c 7365  is).        else
+0000f300: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000f310: 7475 726e 2073 656c 662e 6266 696c 6c28  turn self.bfill(
+0000f320: 6c69 6d69 743d 6c69 6d69 742c 2061 7869  limit=limit, axi
+0000f330: 733d 6178 6973 290a 0a20 2020 2040 6465  s=axis)..    @de
+0000f340: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+0000f350: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+0000f360: 2066 6669 6c6c 2873 656c 662c 2061 7869   ffill(self, axi
+0000f370: 733d 4e6f 6e65 2c20 6c69 6d69 743d 4e6f  s=None, limit=No
+0000f380: 6e65 293a 0a20 2020 2020 2020 2061 7869  ne):.        axi
+0000f390: 7320 3d20 7365 6c66 2e5f 7661 6c69 6461  s = self._valida
+0000f3a0: 7465 5f61 7869 7328 6178 6973 290a 2020  te_axis(axis).  
+0000f3b0: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
+0000f3c0: 662e 5f6d 6574 615f 6e6f 6e65 6d70 7479  f._meta_nonempty
+0000f3d0: 2e66 6669 6c6c 286c 696d 6974 3d6c 696d  .ffill(limit=lim
+0000f3e0: 6974 2c20 6178 6973 3d61 7869 7329 0a0a  it, axis=axis)..
+0000f3f0: 2020 2020 2020 2020 6966 2061 7869 7320          if axis 
+0000f400: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+0000f410: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+0000f420: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
+0000f430: 2020 2020 2020 2020 2020 2020 2020 4d2e                M.
+0000f440: 6666 696c 6c2c 206c 696d 6974 3d6c 696d  ffill, limit=lim
+0000f450: 6974 2c20 6178 6973 3d61 7869 732c 206d  it, axis=axis, m
+0000f460: 6574 613d 6d65 7461 2c20 656e 666f 7263  eta=meta, enforc
+0000f470: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+0000f480: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0000f490: 2020 2020 2020 2020 6265 666f 7265 2c20          before, 
+0000f4a0: 6166 7465 7220 3d20 3120 6966 206c 696d  after = 1 if lim
+0000f4b0: 6974 2069 7320 4e6f 6e65 2065 6c73 6520  it is None else 
+0000f4c0: 6c69 6d69 742c 2030 0a20 2020 2020 2020  limit, 0.       
+0000f4d0: 2070 6172 7473 203d 2073 656c 662e 5f6c   parts = self._l
+0000f4e0: 696d 6974 5f66 696c 6c6e 6128 2266 6669  imit_fillna("ffi
+0000f4f0: 6c6c 222c 206c 696d 6974 3d6c 696d 6974  ll", limit=limit
+0000f500: 2c20 736b 6970 5f63 6865 636b 3d30 2c20  , skip_check=0, 
+0000f510: 6d65 7461 3d6d 6574 6129 0a20 2020 2020  meta=meta).     
+0000f520: 2020 2072 6574 7572 6e20 7061 7274 732e     return parts.
+0000f530: 6d61 705f 6f76 6572 6c61 7028 4d2e 6666  map_overlap(M.ff
+0000f540: 696c 6c2c 2062 6566 6f72 652c 2061 6674  ill, before, aft
+0000f550: 6572 2c20 6c69 6d69 743d 6c69 6d69 742c  er, limit=limit,
+0000f560: 206d 6574 613d 6d65 7461 290a 0a20 2020   meta=meta)..   
+0000f570: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+0000f580: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+0000f590: 2064 6566 2062 6669 6c6c 2873 656c 662c   def bfill(self,
+0000f5a0: 2061 7869 733d 4e6f 6e65 2c20 6c69 6d69   axis=None, limi
+0000f5b0: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
+0000f5c0: 2061 7869 7320 3d20 7365 6c66 2e5f 7661   axis = self._va
+0000f5d0: 6c69 6461 7465 5f61 7869 7328 6178 6973  lidate_axis(axis
+0000f5e0: 290a 2020 2020 2020 2020 6d65 7461 203d  ).        meta =
+0000f5f0: 2073 656c 662e 5f6d 6574 615f 6e6f 6e65   self._meta_none
+0000f600: 6d70 7479 2e62 6669 6c6c 286c 696d 6974  mpty.bfill(limit
+0000f610: 3d6c 696d 6974 2c20 6178 6973 3d61 7869  =limit, axis=axi
+0000f620: 7329 0a0a 2020 2020 2020 2020 6966 2061  s)..        if a
+0000f630: 7869 7320 3d3d 2031 3a0a 2020 2020 2020  xis == 1:.      
+0000f640: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000f650: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
+0000f660: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000f670: 2020 4d2e 6266 696c 6c2c 206c 696d 6974    M.bfill, limit
+0000f680: 3d6c 696d 6974 2c20 6178 6973 3d61 7869  =limit, axis=axi
+0000f690: 732c 206d 6574 613d 6d65 7461 2c20 656e  s, meta=meta, en
+0000f6a0: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
+0000f6b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0000f6c0: 2029 0a0a 2020 2020 2020 2020 6265 666f   )..        befo
+0000f6d0: 7265 2c20 6166 7465 7220 3d20 302c 2031  re, after = 0, 1
+0000f6e0: 2069 6620 6c69 6d69 7420 6973 204e 6f6e   if limit is Non
+0000f6f0: 6520 656c 7365 206c 696d 6974 0a20 2020  e else limit.   
+0000f700: 2020 2020 2070 6172 7473 203d 2073 656c       parts = sel
+0000f710: 662e 5f6c 696d 6974 5f66 696c 6c6e 6128  f._limit_fillna(
+0000f720: 0a20 2020 2020 2020 2020 2020 2022 6266  .            "bf
+0000f730: 696c 6c22 2c20 6c69 6d69 743d 6c69 6d69  ill", limit=limi
+0000f740: 742c 2073 6b69 705f 6368 6563 6b3d 7365  t, skip_check=se
+0000f750: 6c66 2e6e 7061 7274 6974 696f 6e73 202d  lf.npartitions -
+0000f760: 2031 2c20 6d65 7461 3d6d 6574 610a 2020   1, meta=meta.  
+0000f770: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000f780: 7265 7475 726e 2070 6172 7473 2e6d 6170  return parts.map
+0000f790: 5f6f 7665 726c 6170 284d 2e62 6669 6c6c  _overlap(M.bfill
+0000f7a0: 2c20 6265 666f 7265 2c20 6166 7465 722c  , before, after,
+0000f7b0: 206c 696d 6974 3d6c 696d 6974 2c20 6d65   limit=limit, me
+0000f7c0: 7461 3d6d 6574 6129 0a0a 2020 2020 6465  ta=meta)..    de
+0000f7d0: 6620 7361 6d70 6c65 2873 656c 662c 206e  f sample(self, n
+0000f7e0: 3d4e 6f6e 652c 2066 7261 633d 4e6f 6e65  =None, frac=None
+0000f7f0: 2c20 7265 706c 6163 653d 4661 6c73 652c  , replace=False,
+0000f800: 2072 616e 646f 6d5f 7374 6174 653d 4e6f   random_state=No
+0000f810: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0000f820: 5261 6e64 6f6d 2073 616d 706c 6520 6f66  Random sample of
+0000f830: 2069 7465 6d73 0a0a 2020 2020 2020 2020   items..        
+0000f840: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0000f850: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0000f860: 2020 2020 2020 6e20 3a20 696e 742c 206f        n : int, o
+0000f870: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000f880: 2020 2020 4e75 6d62 6572 206f 6620 6974      Number of it
+0000f890: 656d 7320 746f 2072 6574 7572 6e20 6973  ems to return is
+0000f8a0: 206e 6f74 2073 7570 706f 7274 6564 2062   not supported b
+0000f8b0: 7920 6461 736b 2e20 5573 6520 6672 6163  y dask. Use frac
+0000f8c0: 0a20 2020 2020 2020 2020 2020 2069 6e73  .            ins
+0000f8d0: 7465 6164 2e0a 2020 2020 2020 2020 6672  tead..        fr
+0000f8e0: 6163 203a 2066 6c6f 6174 2c20 6f70 7469  ac : float, opti
+0000f8f0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0000f900: 2041 7070 726f 7869 6d61 7465 2066 7261   Approximate fra
+0000f910: 6374 696f 6e20 6f66 2069 7465 6d73 2074  ction of items t
+0000f920: 6f20 7265 7475 726e 2e20 5468 6973 2073  o return. This s
+0000f930: 616d 706c 696e 6720 6672 6163 7469 6f6e  ampling fraction
+0000f940: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
+0000f950: 6170 706c 6965 6420 746f 2061 6c6c 2070  applied to all p
+0000f960: 6172 7469 7469 6f6e 7320 6571 7561 6c6c  artitions equall
+0000f970: 792e 204e 6f74 6520 7468 6174 2074 6869  y. Note that thi
+0000f980: 7320 6973 2061 6e0a 2020 2020 2020 2020  s is an.        
+0000f990: 2020 2020 2a2a 6170 7072 6f78 696d 6174      **approximat
+0000f9a0: 6520 6672 6163 7469 6f6e 2a2a 2e20 596f  e fraction**. Yo
+0000f9b0: 7520 7368 6f75 6c64 206e 6f74 2065 7870  u should not exp
+0000f9c0: 6563 7420 6578 6163 746c 7920 6060 6c65  ect exactly ``le
+0000f9d0: 6e28 6466 2920 2a20 6672 6163 6060 0a20  n(df) * frac``. 
+0000f9e0: 2020 2020 2020 2020 2020 2069 7465 6d73             items
+0000f9f0: 2074 6f20 6265 2072 6574 7572 6e65 642c   to be returned,
+0000fa00: 2061 7320 7468 6520 6578 6163 7420 6e75   as the exact nu
+0000fa10: 6d62 6572 206f 6620 656c 656d 656e 7473  mber of elements
+0000fa20: 2073 656c 6563 7465 6420 7769 6c6c 0a20   selected will. 
+0000fa30: 2020 2020 2020 2020 2020 2064 6570 656e             depen
+0000fa40: 6420 6f6e 2068 6f77 2079 6f75 7220 6461  d on how your da
+0000fa50: 7461 2069 7320 7061 7274 6974 696f 6e65  ta is partitione
+0000fa60: 6420 2862 7574 2073 686f 756c 6420 6265  d (but should be
+0000fa70: 2070 7265 7474 7920 636c 6f73 650a 2020   pretty close.  
+0000fa80: 2020 2020 2020 2020 2020 696e 2070 7261            in pra
+0000fa90: 6374 6963 6529 2e0a 2020 2020 2020 2020  ctice)..        
+0000faa0: 7265 706c 6163 6520 3a20 626f 6f6c 6561  replace : boolea
+0000fab0: 6e2c 206f 7074 696f 6e61 6c0a 2020 2020  n, optional.    
+0000fac0: 2020 2020 2020 2020 5361 6d70 6c65 2077          Sample w
+0000fad0: 6974 6820 6f72 2077 6974 686f 7574 2072  ith or without r
+0000fae0: 6570 6c61 6365 6d65 6e74 2e20 4465 6661  eplacement. Defa
+0000faf0: 756c 7420 3d20 4661 6c73 652e 0a20 2020  ult = False..   
+0000fb00: 2020 2020 2072 616e 646f 6d5f 7374 6174       random_stat
+0000fb10: 6520 3a20 696e 7420 6f72 2060 606e 702e  e : int or ``np.
+0000fb20: 7261 6e64 6f6d 2e52 616e 646f 6d53 7461  random.RandomSta
+0000fb30: 7465 6060 0a20 2020 2020 2020 2020 2020  te``.           
+0000fb40: 2049 6620 616e 2069 6e74 2c20 7765 2063   If an int, we c
+0000fb50: 7265 6174 6520 6120 6e65 7720 5261 6e64  reate a new Rand
+0000fb60: 6f6d 5374 6174 6520 7769 7468 2074 6869  omState with thi
+0000fb70: 7320 6173 2074 6865 2073 6565 643b 0a20  s as the seed;. 
+0000fb80: 2020 2020 2020 2020 2020 204f 7468 6572             Other
+0000fb90: 7769 7365 2077 6520 6472 6177 2066 726f  wise we draw fro
+0000fba0: 6d20 7468 6520 7061 7373 6564 2052 616e  m the passed Ran
+0000fbb0: 646f 6d53 7461 7465 2e0a 0a20 2020 2020  domState...     
+0000fbc0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+0000fbd0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0000fbe0: 2020 2020 2044 6174 6146 7261 6d65 2e72       DataFrame.r
+0000fbf0: 616e 646f 6d5f 7370 6c69 740a 2020 2020  andom_split.    
+0000fc00: 2020 2020 7061 6e64 6173 2e44 6174 6146      pandas.DataF
+0000fc10: 7261 6d65 2e73 616d 706c 650a 2020 2020  rame.sample.    
+0000fc20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000fc30: 6966 206e 2069 7320 6e6f 7420 4e6f 6e65  if n is not None
+0000fc40: 3a0a 2020 2020 2020 2020 2020 2020 6d73  :.            ms
+0000fc50: 6720 3d20 280a 2020 2020 2020 2020 2020  g = (.          
+0000fc60: 2020 2020 2020 2273 616d 706c 6520 646f        "sample do
+0000fc70: 6573 206e 6f74 2073 7570 706f 7274 2074  es not support t
+0000fc80: 6865 206e 756d 6265 7220 6f66 2073 616d  he number of sam
+0000fc90: 706c 6564 2069 7465 6d73 2022 0a20 2020  pled items ".   
+0000fca0: 2020 2020 2020 2020 2020 2020 2022 7061               "pa
+0000fcb0: 7261 6d65 7465 722c 2027 6e27 2e20 506c  rameter, 'n'. Pl
+0000fcc0: 6561 7365 2075 7365 2074 6865 2027 6672  ease use the 'fr
+0000fcd0: 6163 2720 7061 7261 6d65 7465 7220 696e  ac' parameter in
+0000fce0: 7374 6561 642e 220a 2020 2020 2020 2020  stead.".        
+0000fcf0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000fd00: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000fd10: 6e2c 204e 756d 6265 7229 2061 6e64 2030  n, Number) and 0
+0000fd20: 203c 3d20 6e20 3c3d 2031 3a0a 2020 2020   <= n <= 1:.    
+0000fd30: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0000fd40: 696e 6773 2e77 6172 6e28 6d73 6729 0a20  ings.warn(msg). 
+0000fd50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000fd60: 7261 6320 3d20 6e0a 2020 2020 2020 2020  rac = n.        
+0000fd70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000fd80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000fd90: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+0000fda0: 0a20 2020 2020 2020 2069 6620 6672 6163  .        if frac
+0000fdb0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000fdc0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000fdd0: 6545 7272 6f72 2822 6672 6163 206d 7573  eError("frac mus
+0000fde0: 7420 6e6f 7420 6265 204e 6f6e 6522 290a  t not be None").
+0000fdf0: 0a20 2020 2020 2020 2069 6620 7261 6e64  .        if rand
+0000fe00: 6f6d 5f73 7461 7465 2069 7320 4e6f 6e65  om_state is None
+0000fe10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000fe20: 6e64 6f6d 5f73 7461 7465 203d 206e 702e  ndom_state = np.
+0000fe30: 7261 6e64 6f6d 2e52 616e 646f 6d53 7461  random.RandomSta
+0000fe40: 7465 2829 0a0a 2020 2020 2020 2020 6e61  te()..        na
+0000fe50: 6d65 203d 2022 7361 6d70 6c65 2d22 202b  me = "sample-" +
+0000fe60: 2074 6f6b 656e 697a 6528 7365 6c66 2c20   tokenize(self, 
+0000fe70: 6672 6163 2c20 7265 706c 6163 652c 2072  frac, replace, r
+0000fe80: 616e 646f 6d5f 7374 6174 6529 0a0a 2020  andom_state)..  
+0000fe90: 2020 2020 2020 7374 6174 655f 6461 7461        state_data
+0000fea0: 203d 2072 616e 646f 6d5f 7374 6174 655f   = random_state_
+0000feb0: 6461 7461 2873 656c 662e 6e70 6172 7469  data(self.nparti
+0000fec0: 7469 6f6e 732c 2072 616e 646f 6d5f 7374  tions, random_st
+0000fed0: 6174 6529 0a20 2020 2020 2020 2064 736b  ate).        dsk
+0000fee0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0000fef0: 2028 6e61 6d65 2c20 6929 3a20 286d 6574   (name, i): (met
+0000ff00: 686f 6473 2e73 616d 706c 652c 2028 7365  hods.sample, (se
+0000ff10: 6c66 2e5f 6e61 6d65 2c20 6929 2c20 7374  lf._name, i), st
+0000ff20: 6174 652c 2066 7261 632c 2072 6570 6c61  ate, frac, repla
+0000ff30: 6365 290a 2020 2020 2020 2020 2020 2020  ce).            
+0000ff40: 666f 7220 692c 2073 7461 7465 2069 6e20  for i, state in 
+0000ff50: 656e 756d 6572 6174 6528 7374 6174 655f  enumerate(state_
+0000ff60: 6461 7461 290a 2020 2020 2020 2020 7d0a  data).        }.
+0000ff70: 0a20 2020 2020 2020 2067 7261 7068 203d  .        graph =
+0000ff80: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
+0000ff90: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
+0000ffa0: 286e 616d 652c 2064 736b 2c20 6465 7065  (name, dsk, depe
+0000ffb0: 6e64 656e 6369 6573 3d5b 7365 6c66 5d29  ndencies=[self])
+0000ffc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ffd0: 6e65 775f 6464 5f6f 626a 6563 7428 6772  new_dd_object(gr
+0000ffe0: 6170 682c 206e 616d 652c 2073 656c 662e  aph, name, self.
+0000fff0: 5f6d 6574 612c 2073 656c 662e 6469 7669  _meta, self.divi
+00010000: 7369 6f6e 7329 0a0a 2020 2020 4064 6572  sions)..    @der
+00010010: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
+00010020: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
+00010030: 7265 706c 6163 6528 7365 6c66 2c20 746f  replace(self, to
+00010040: 5f72 6570 6c61 6365 3d4e 6f6e 652c 2076  _replace=None, v
+00010050: 616c 7565 3d4e 6f6e 652c 2072 6567 6578  alue=None, regex
+00010060: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00010070: 2023 2049 6e20 5041 4e44 4153 5f47 545f   # In PANDAS_GT_
+00010080: 3134 3020 7061 6e64 6173 2073 7461 7274  140 pandas start
+00010090: 7320 7573 696e 6720 6e6f 5f64 6566 6175  s using no_defau
+000100a0: 6c74 2069 6e73 7465 6164 206f 6620 4e6f  lt instead of No
+000100b0: 6e65 0a20 2020 2020 2020 2076 616c 7565  ne.        value
+000100c0: 5f6b 7761 7267 203d 207b 2276 616c 7565  _kwarg = {"value
+000100d0: 223a 2076 616c 7565 7d20 6966 2076 616c  ": value} if val
+000100e0: 7565 2069 7320 6e6f 7420 4e6f 6e65 2065  ue is not None e
+000100f0: 6c73 6520 7b7d 0a20 2020 2020 2020 2072  lse {}.        r
+00010100: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
+00010110: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
+00010120: 2020 2020 2020 204d 2e72 6570 6c61 6365         M.replace
+00010130: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
+00010140: 5f72 6570 6c61 6365 3d74 6f5f 7265 706c  _replace=to_repl
+00010150: 6163 652c 0a20 2020 2020 2020 2020 2020  ace,.           
+00010160: 202a 2a76 616c 7565 5f6b 7761 7267 2c0a   **value_kwarg,.
+00010170: 2020 2020 2020 2020 2020 2020 7265 6765              rege
+00010180: 783d 7265 6765 782c 0a20 2020 2020 2020  x=regex,.       
+00010190: 2020 2020 2065 6e66 6f72 6365 5f6d 6574       enforce_met
+000101a0: 6164 6174 613d 4661 6c73 652c 0a20 2020  adata=False,.   
+000101b0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+000101c0: 746f 5f64 6173 6b5f 6172 7261 7928 7365  to_dask_array(se
+000101d0: 6c66 2c20 6c65 6e67 7468 733d 4e6f 6e65  lf, lengths=None
+000101e0: 2c20 6d65 7461 3d4e 6f6e 6529 3a0a 2020  , meta=None):.  
+000101f0: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
+00010200: 2061 2064 6173 6b20 4461 7461 4672 616d   a dask DataFram
+00010210: 6520 746f 2061 2064 6173 6b20 6172 7261  e to a dask arra
+00010220: 792e 0a0a 2020 2020 2020 2020 5061 7261  y...        Para
+00010230: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00010240: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00010250: 2020 6c65 6e67 7468 7320 3a20 626f 6f6c    lengths : bool
+00010260: 206f 7220 5365 7175 656e 6365 206f 6620   or Sequence of 
+00010270: 696e 7473 2c20 6f70 7469 6f6e 616c 0a20  ints, optional. 
+00010280: 2020 2020 2020 2020 2020 2048 6f77 2074             How t
+00010290: 6f20 6465 7465 726d 696e 6520 7468 6520  o determine the 
+000102a0: 6368 756e 6b73 2073 697a 6573 2066 6f72  chunks sizes for
+000102b0: 2074 6865 206f 7574 7075 7420 6172 7261   the output arra
+000102c0: 792e 0a20 2020 2020 2020 2020 2020 2042  y..            B
+000102d0: 7920 6465 6661 756c 742c 2074 6865 206f  y default, the o
+000102e0: 7574 7075 7420 6172 7261 7920 7769 6c6c  utput array will
+000102f0: 2068 6176 6520 756e 6b6e 6f77 6e20 6368   have unknown ch
+00010300: 756e 6b20 6c65 6e67 7468 730a 2020 2020  unk lengths.    
+00010310: 2020 2020 2020 2020 616c 6f6e 6720 7468          along th
+00010320: 6520 6669 7273 7420 6178 6973 2c20 7768  e first axis, wh
+00010330: 6963 6820 6361 6e20 6361 7573 6520 736f  ich can cause so
+00010340: 6d65 206c 6174 6572 206f 7065 7261 7469  me later operati
+00010350: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+00010360: 746f 2066 6169 6c2e 0a0a 2020 2020 2020  to fail...      
+00010370: 2020 2020 2020 2a20 5472 7565 203a 2069        * True : i
+00010380: 6d6d 6564 6961 7465 6c79 2063 6f6d 7075  mmediately compu
+00010390: 7465 2074 6865 206c 656e 6774 6820 6f66  te the length of
+000103a0: 2065 6163 6820 7061 7274 6974 696f 6e0a   each partition.
+000103b0: 2020 2020 2020 2020 2020 2020 2a20 5365              * Se
+000103c0: 7175 656e 6365 203a 2061 2073 6571 7565  quence : a seque
+000103d0: 6e63 6520 6f66 2069 6e74 6567 6572 7320  nce of integers 
+000103e0: 746f 2075 7365 2066 6f72 2074 6865 2063  to use for the c
+000103f0: 6875 6e6b 2073 697a 6573 0a20 2020 2020  hunk sizes.     
+00010400: 2020 2020 2020 2020 206f 6e20 7468 6520           on the 
+00010410: 6669 7273 7420 6178 6973 2e20 5468 6573  first axis. Thes
+00010420: 6520 7661 6c75 6573 2061 7265 202a 6e6f  e values are *no
+00010430: 742a 2076 616c 6964 6174 6564 2066 6f72  t* validated for
+00010440: 0a20 2020 2020 2020 2020 2020 2020 2063  .              c
+00010450: 6f72 7265 6374 6e65 7373 2c20 6265 796f  orrectness, beyo
+00010460: 6e64 2065 6e73 7572 696e 6720 7468 6174  nd ensuring that
+00010470: 2074 6865 206e 756d 6265 7220 6f66 2069   the number of i
+00010480: 7465 6d73 0a20 2020 2020 2020 2020 2020  tems.           
+00010490: 2020 206d 6174 6368 6573 2074 6865 206e     matches the n
+000104a0: 756d 6265 7220 6f66 2070 6172 7469 7469  umber of partiti
+000104b0: 6f6e 732e 0a20 2020 2020 2020 206d 6574  ons..        met
+000104c0: 6120 3a20 6f62 6a65 6374 2c20 6f70 7469  a : object, opti
+000104d0: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+000104e0: 2041 6e20 6f70 7469 6f6e 616c 2060 6d65   An optional `me
+000104f0: 7461 6020 7061 7261 6d65 7465 7220 6361  ta` parameter ca
+00010500: 6e20 6265 2070 6173 7365 6420 666f 7220  n be passed for 
+00010510: 6461 736b 2074 6f20 6f76 6572 7269 6465  dask to override
+00010520: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00010530: 2064 6566 6175 6c74 206d 6574 6164 6174   default metadat
+00010540: 6120 6f6e 2074 6865 2075 6e64 6572 6c79  a on the underly
+00010550: 696e 6720 6461 736b 2061 7272 6179 2e0a  ing dask array..
+00010560: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00010570: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010580: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00010590: 2020 2020 2069 6620 6c65 6e67 7468 7320       if lengths 
+000105a0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+000105b0: 2020 2020 206c 656e 6774 6873 203d 2074       lengths = t
+000105c0: 7570 6c65 2873 656c 662e 6d61 705f 7061  uple(self.map_pa
+000105d0: 7274 6974 696f 6e73 286c 656e 2c20 656e  rtitions(len, en
+000105e0: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
+000105f0: 616c 7365 292e 636f 6d70 7574 6528 2929  alse).compute())
+00010600: 0a0a 2020 2020 2020 2020 6172 7220 3d20  ..        arr = 
+00010610: 7365 6c66 2e76 616c 7565 730a 0a20 2020  self.values..   
+00010620: 2020 2020 2063 6875 6e6b 7320 3d20 7365       chunks = se
+00010630: 6c66 2e5f 7661 6c69 6461 7465 5f63 6875  lf._validate_chu
+00010640: 6e6b 7328 6172 722c 206c 656e 6774 6873  nks(arr, lengths
+00010650: 290a 2020 2020 2020 2020 6172 722e 5f63  ).        arr._c
+00010660: 6875 6e6b 7320 3d20 6368 756e 6b73 0a0a  hunks = chunks..
+00010670: 2020 2020 2020 2020 6966 206d 6574 6120          if meta 
+00010680: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00010690: 2020 2020 2020 2020 2061 7272 2e5f 6d65           arr._me
+000106a0: 7461 203d 206d 6574 610a 0a20 2020 2020  ta = meta..     
+000106b0: 2020 2072 6574 7572 6e20 6172 720a 0a20     return arr.. 
+000106c0: 2020 2064 6566 2074 6f5f 6864 6628 7365     def to_hdf(se
+000106d0: 6c66 2c20 7061 7468 5f6f 725f 6275 662c  lf, path_or_buf,
+000106e0: 206b 6579 2c20 6d6f 6465 3d22 6122 2c20   key, mode="a", 
+000106f0: 6170 7065 6e64 3d46 616c 7365 2c20 2a2a  append=False, **
+00010700: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00010710: 2022 2222 5365 6520 6464 2e74 6f5f 6864   """See dd.to_hd
+00010720: 6620 646f 6373 7472 696e 6720 666f 7220  f docstring for 
+00010730: 6d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  more information
+00010740: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00010750: 2064 6173 6b2e 6461 7461 6672 616d 652e   dask.dataframe.
+00010760: 696f 2069 6d70 6f72 7420 746f 5f68 6466  io import to_hdf
+00010770: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00010780: 2074 6f5f 6864 6628 7365 6c66 2c20 7061   to_hdf(self, pa
+00010790: 7468 5f6f 725f 6275 662c 206b 6579 2c20  th_or_buf, key, 
+000107a0: 6d6f 6465 2c20 6170 7065 6e64 2c20 2a2a  mode, append, **
+000107b0: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+000107c0: 2074 6f5f 6373 7628 7365 6c66 2c20 6669   to_csv(self, fi
+000107d0: 6c65 6e61 6d65 2c20 2a2a 6b77 6172 6773  lename, **kwargs
+000107e0: 293a 0a20 2020 2020 2020 2022 2222 5365  ):.        """Se
+000107f0: 6520 6464 2e74 6f5f 6373 7620 646f 6373  e dd.to_csv docs
+00010800: 7472 696e 6720 666f 7220 6d6f 7265 2069  tring for more i
+00010810: 6e66 6f72 6d61 7469 6f6e 2222 220a 2020  nformation""".  
+00010820: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+00010830: 6461 7461 6672 616d 652e 696f 2069 6d70  dataframe.io imp
+00010840: 6f72 7420 746f 5f63 7376 0a0a 2020 2020  ort to_csv..    
+00010850: 2020 2020 7265 7475 726e 2074 6f5f 6373      return to_cs
+00010860: 7628 7365 6c66 2c20 6669 6c65 6e61 6d65  v(self, filename
+00010870: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00010880: 2064 6566 2074 6f5f 7371 6c28 0a20 2020   def to_sql(.   
+00010890: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000108a0: 2020 206e 616d 653a 2073 7472 2c0a 2020     name: str,.  
+000108b0: 2020 2020 2020 7572 693a 2073 7472 2c0a        uri: str,.
+000108c0: 2020 2020 2020 2020 7363 6865 6d61 3d4e          schema=N
+000108d0: 6f6e 652c 0a20 2020 2020 2020 2069 665f  one,.        if_
+000108e0: 6578 6973 7473 3a20 7374 7220 3d20 2266  exists: str = "f
+000108f0: 6169 6c22 2c0a 2020 2020 2020 2020 696e  ail",.        in
+00010900: 6465 783a 2062 6f6f 6c20 3d20 5472 7565  dex: bool = True
+00010910: 2c0a 2020 2020 2020 2020 696e 6465 785f  ,.        index_
+00010920: 6c61 6265 6c3d 4e6f 6e65 2c0a 2020 2020  label=None,.    
+00010930: 2020 2020 6368 756e 6b73 697a 653d 4e6f      chunksize=No
+00010940: 6e65 2c0a 2020 2020 2020 2020 6474 7970  ne,.        dtyp
+00010950: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00010960: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
+00010970: 2020 2020 2063 6f6d 7075 7465 3d54 7275       compute=Tru
+00010980: 652c 0a20 2020 2020 2020 2070 6172 616c  e,.        paral
+00010990: 6c65 6c3d 4661 6c73 652c 0a20 2020 2020  lel=False,.     
+000109a0: 2020 2065 6e67 696e 655f 6b77 6172 6773     engine_kwargs
+000109b0: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
+000109c0: 2020 2020 2020 2222 2253 6565 2064 642e        """See dd.
+000109d0: 746f 5f73 716c 2064 6f63 7374 7269 6e67  to_sql docstring
+000109e0: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+000109f0: 6174 696f 6e22 2222 0a20 2020 2020 2020  ation""".       
+00010a00: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
+00010a10: 7261 6d65 2e69 6f20 696d 706f 7274 2074  rame.io import t
+00010a20: 6f5f 7371 6c0a 0a20 2020 2020 2020 2072  o_sql..        r
+00010a30: 6574 7572 6e20 746f 5f73 716c 280a 2020  eturn to_sql(.  
+00010a40: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00010a50: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00010a60: 3d6e 616d 652c 0a20 2020 2020 2020 2020  =name,.         
+00010a70: 2020 2075 7269 3d75 7269 2c0a 2020 2020     uri=uri,.    
+00010a80: 2020 2020 2020 2020 7363 6865 6d61 3d73          schema=s
+00010a90: 6368 656d 612c 0a20 2020 2020 2020 2020  chema,.         
+00010aa0: 2020 2069 665f 6578 6973 7473 3d69 665f     if_exists=if_
+00010ab0: 6578 6973 7473 2c0a 2020 2020 2020 2020  exists,.        
+00010ac0: 2020 2020 696e 6465 783d 696e 6465 782c      index=index,
+00010ad0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+00010ae0: 6578 5f6c 6162 656c 3d69 6e64 6578 5f6c  ex_label=index_l
+00010af0: 6162 656c 2c0a 2020 2020 2020 2020 2020  abel,.          
+00010b00: 2020 6368 756e 6b73 697a 653d 6368 756e    chunksize=chun
+00010b10: 6b73 697a 652c 0a20 2020 2020 2020 2020  ksize,.         
+00010b20: 2020 2064 7479 7065 3d64 7479 7065 2c0a     dtype=dtype,.
+00010b30: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00010b40: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+00010b50: 2020 2020 2020 2063 6f6d 7075 7465 3d63         compute=c
+00010b60: 6f6d 7075 7465 2c0a 2020 2020 2020 2020  ompute,.        
+00010b70: 2020 2020 7061 7261 6c6c 656c 3d70 6172      parallel=par
+00010b80: 616c 6c65 6c2c 0a20 2020 2020 2020 2020  allel,.         
+00010b90: 2020 2065 6e67 696e 655f 6b77 6172 6773     engine_kwargs
+00010ba0: 3d65 6e67 696e 655f 6b77 6172 6773 2c0a  =engine_kwargs,.
+00010bb0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00010bc0: 6566 2074 6f5f 6a73 6f6e 2873 656c 662c  ef to_json(self,
+00010bd0: 2066 696c 656e 616d 652c 202a 6172 6773   filename, *args
+00010be0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00010bf0: 2020 2020 2022 2222 5365 6520 6464 2e74       """See dd.t
+00010c00: 6f5f 6a73 6f6e 2064 6f63 7374 7269 6e67  o_json docstring
+00010c10: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+00010c20: 6174 696f 6e22 2222 0a20 2020 2020 2020  ation""".       
+00010c30: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
+00010c40: 7261 6d65 2e69 6f20 696d 706f 7274 2074  rame.io import t
+00010c50: 6f5f 6a73 6f6e 0a0a 2020 2020 2020 2020  o_json..        
+00010c60: 7265 7475 726e 2074 6f5f 6a73 6f6e 2873  return to_json(s
+00010c70: 656c 662c 2066 696c 656e 616d 652c 202a  elf, filename, *
+00010c80: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
+00010c90: 0a20 2020 2064 6566 2074 6f5f 6465 6c61  .    def to_dela
+00010ca0: 7965 6428 7365 6c66 2c20 6f70 7469 6d69  yed(self, optimi
+00010cb0: 7a65 5f67 7261 7068 3d54 7275 6529 3a0a  ze_graph=True):.
+00010cc0: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+00010cd0: 7274 2069 6e74 6f20 6120 6c69 7374 206f  rt into a list o
+00010ce0: 6620 6060 6461 736b 2e64 656c 6179 6564  f ``dask.delayed
+00010cf0: 6060 206f 626a 6563 7473 2c20 6f6e 6520  `` objects, one 
+00010d00: 7065 7220 7061 7274 6974 696f 6e2e 0a0a  per partition...
+00010d10: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00010d20: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00010d30: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6f70  -----.        op
+00010d40: 7469 6d69 7a65 5f67 7261 7068 203a 2062  timize_graph : b
+00010d50: 6f6f 6c2c 206f 7074 696f 6e61 6c0a 2020  ool, optional.  
+00010d60: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00010d70: 6520 5b64 6566 6175 6c74 5d2c 2074 6865  e [default], the
+00010d80: 2067 7261 7068 2069 7320 6f70 7469 6d69   graph is optimi
+00010d90: 7a65 6420 6265 666f 7265 2063 6f6e 7665  zed before conve
+00010da0: 7274 696e 6720 696e 746f 0a20 2020 2020  rting into.     
+00010db0: 2020 2020 2020 2060 6064 6173 6b2e 6465         ``dask.de
+00010dc0: 6c61 7965 6460 6020 6f62 6a65 6374 732e  layed`` objects.
+00010dd0: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+00010de0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00010df0: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
+00010e00: 7061 7274 6974 696f 6e73 203d 2064 662e  partitions = df.
+00010e10: 746f 5f64 656c 6179 6564 2829 2020 2320  to_delayed()  # 
+00010e20: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
+00010e30: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+00010e40: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00010e50: 2d0a 2020 2020 2020 2020 6461 736b 2e64  -.        dask.d
+00010e60: 6174 6166 7261 6d65 2e66 726f 6d5f 6465  ataframe.from_de
+00010e70: 6c61 7965 640a 2020 2020 2020 2020 2222  layed.        ""
+00010e80: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
+00010e90: 2073 656c 662e 5f5f 6461 736b 5f6b 6579   self.__dask_key
+00010ea0: 735f 5f28 290a 2020 2020 2020 2020 6772  s__().        gr
+00010eb0: 6170 6820 3d20 7365 6c66 2e5f 5f64 6173  aph = self.__das
+00010ec0: 6b5f 6772 6170 685f 5f28 290a 2020 2020  k_graph__().    
+00010ed0: 2020 2020 6c61 7965 7220 3d20 7365 6c66      layer = self
+00010ee0: 2e5f 5f64 6173 6b5f 6c61 7965 7273 5f5f  .__dask_layers__
+00010ef0: 2829 5b30 5d0a 2020 2020 2020 2020 6966  ()[0].        if
+00010f00: 206f 7074 696d 697a 655f 6772 6170 683a   optimize_graph:
+00010f10: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
+00010f20: 7068 203d 2073 656c 662e 5f5f 6461 736b  ph = self.__dask
+00010f30: 5f6f 7074 696d 697a 655f 5f28 6772 6170  _optimize__(grap
+00010f40: 682c 2073 656c 662e 5f5f 6461 736b 5f6b  h, self.__dask_k
+00010f50: 6579 735f 5f28 2929 0a20 2020 2020 2020  eys__()).       
+00010f60: 2020 2020 206c 6179 6572 203d 2022 6465       layer = "de
+00010f70: 6c61 7965 642d 2220 2b20 7365 6c66 2e5f  layed-" + self._
+00010f80: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+00010f90: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+00010fa0: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+00010fb0: 6c65 6374 696f 6e73 286c 6179 6572 2c20  lections(layer, 
+00010fc0: 6772 6170 682c 2064 6570 656e 6465 6e63  graph, dependenc
+00010fd0: 6965 733d 2829 290a 2020 2020 2020 2020  ies=()).        
+00010fe0: 7265 7475 726e 205b 4465 6c61 7965 6428  return [Delayed(
+00010ff0: 6b2c 2067 7261 7068 2c20 6c61 7965 723d  k, graph, layer=
+00011000: 6c61 7965 7229 2066 6f72 206b 2069 6e20  layer) for k in 
+00011010: 6b65 7973 5d0a 0a20 2020 2064 6566 2074  keys]..    def t
+00011020: 6f5f 6261 636b 656e 6428 7365 6c66 2c20  o_backend(self, 
+00011030: 6261 636b 656e 643a 2073 7472 207c 204e  backend: str | N
+00011040: 6f6e 6520 3d20 4e6f 6e65 2c20 2a2a 6b77  one = None, **kw
+00011050: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+00011060: 2222 4d6f 7665 2074 6f20 6120 6e65 7720  ""Move to a new 
+00011070: 4461 7461 4672 616d 6520 6261 636b 656e  DataFrame backen
+00011080: 640a 0a20 2020 2020 2020 2050 6172 616d  d..        Param
+00011090: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+000110a0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+000110b0: 2062 6163 6b65 6e64 203a 2073 7472 2c20   backend : str, 
+000110c0: 4f70 7469 6f6e 616c 0a20 2020 2020 2020  Optional.       
+000110d0: 2020 2020 2054 6865 206e 616d 6520 6f66       The name of
+000110e0: 2074 6865 206e 6577 2062 6163 6b65 6e64   the new backend
+000110f0: 2074 6f20 6d6f 7665 2074 6f2e 2054 6865   to move to. The
+00011100: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
+00011110: 2020 2020 2069 7320 7468 6520 6375 7272       is the curr
+00011120: 656e 7420 2264 6174 6166 7261 6d65 2e62  ent "dataframe.b
+00011130: 6163 6b65 6e64 2220 636f 6e66 6967 7572  ackend" configur
+00011140: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00011150: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00011160: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00011170: 4461 7461 4672 616d 652c 2053 6572 6965  DataFrame, Serie
+00011180: 7320 6f72 2049 6e64 6578 0a20 2020 2020  s or Index.     
+00011190: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000111a0: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
+000111b0: 6d65 2e69 6f20 696d 706f 7274 2074 6f5f  me.io import to_
+000111c0: 6261 636b 656e 640a 0a20 2020 2020 2020  backend..       
+000111d0: 2072 6574 7572 6e20 746f 5f62 6163 6b65   return to_backe
+000111e0: 6e64 2873 656c 662c 2062 6163 6b65 6e64  nd(self, backend
+000111f0: 3d62 6163 6b65 6e64 2c20 2a2a 6b77 6172  =backend, **kwar
+00011200: 6773 290a 0a20 2020 2040 636c 6173 736d  gs)..    @classm
+00011210: 6574 686f 640a 2020 2020 6465 6620 5f67  ethod.    def _g
+00011220: 6574 5f75 6e61 7279 5f6f 7065 7261 746f  et_unary_operato
+00011230: 7228 636c 732c 206f 7029 3a0a 2020 2020  r(cls, op):.    
+00011240: 2020 2020 7265 7475 726e 206c 616d 6264      return lambd
+00011250: 6120 7365 6c66 3a20 656c 656d 7769 7365  a self: elemwise
+00011260: 286f 702c 2073 656c 6629 0a0a 2020 2020  (op, self)..    
+00011270: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00011280: 2064 6566 205f 6765 745f 6269 6e61 7279   def _get_binary
+00011290: 5f6f 7065 7261 746f 7228 636c 732c 206f  _operator(cls, o
+000112a0: 702c 2069 6e76 3d46 616c 7365 293a 0a20  p, inv=False):. 
+000112b0: 2020 2020 2020 2069 6620 696e 763a 0a20         if inv:. 
+000112c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000112d0: 6e20 6c61 6d62 6461 2073 656c 662c 206f  n lambda self, o
+000112e0: 7468 6572 3a20 656c 656d 7769 7365 286f  ther: elemwise(o
+000112f0: 702c 206f 7468 6572 2c20 7365 6c66 290a  p, other, self).
+00011300: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011310: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011320: 206c 616d 6264 6120 7365 6c66 2c20 6f74   lambda self, ot
+00011330: 6865 723a 2065 6c65 6d77 6973 6528 6f70  her: elemwise(op
+00011340: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
+00011350: 2020 2020 6465 6620 726f 6c6c 696e 6728      def rolling(
+00011360: 0a20 2020 2020 2020 2073 656c 662c 2077  .        self, w
+00011370: 696e 646f 772c 206d 696e 5f70 6572 696f  indow, min_perio
+00011380: 6473 3d4e 6f6e 652c 2063 656e 7465 723d  ds=None, center=
+00011390: 4661 6c73 652c 2077 696e 5f74 7970 653d  False, win_type=
+000113a0: 4e6f 6e65 2c20 6178 6973 3d6e 6f5f 6465  None, axis=no_de
+000113b0: 6661 756c 740a 2020 2020 293a 0a20 2020  fault.    ):.   
+000113c0: 2020 2020 2022 2222 5072 6f76 6964 6573       """Provides
+000113d0: 2072 6f6c 6c69 6e67 2074 7261 6e73 666f   rolling transfo
+000113e0: 726d 6174 696f 6e73 2e0a 0a20 2020 2020  rmations...     
+000113f0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00011400: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00011410: 0a20 2020 2020 2020 2077 696e 646f 7720  .        window 
+00011420: 3a20 696e 742c 2073 7472 2c20 6f66 6673  : int, str, offs
+00011430: 6574 0a20 2020 2020 2020 2020 2020 5369  et.           Si
+00011440: 7a65 206f 6620 7468 6520 6d6f 7669 6e67  ze of the moving
+00011450: 2077 696e 646f 772e 2054 6869 7320 6973   window. This is
+00011460: 2074 6865 206e 756d 6265 7220 6f66 206f   the number of o
+00011470: 6273 6572 7661 7469 6f6e 7320 7573 6564  bservations used
+00011480: 0a20 2020 2020 2020 2020 2020 666f 7220  .           for 
+00011490: 6361 6c63 756c 6174 696e 6720 7468 6520  calculating the 
+000114a0: 7374 6174 6973 7469 632e 2057 6865 6e20  statistic. When 
+000114b0: 6e6f 7420 7573 696e 6720 6120 6060 4461  not using a ``Da
+000114c0: 7465 7469 6d65 496e 6465 7860 602c 0a20  tetimeIndex``,. 
+000114d0: 2020 2020 2020 2020 2020 7468 6520 7769            the wi
+000114e0: 6e64 6f77 2073 697a 6520 6d75 7374 206e  ndow size must n
+000114f0: 6f74 2062 6520 736f 206c 6172 6765 2061  ot be so large a
+00011500: 7320 746f 2073 7061 6e20 6d6f 7265 2074  s to span more t
+00011510: 6861 6e20 6f6e 650a 2020 2020 2020 2020  han one.        
+00011520: 2020 2061 646a 6163 656e 7420 7061 7274     adjacent part
+00011530: 6974 696f 6e2e 2049 6620 7573 696e 6720  ition. If using 
+00011540: 616e 206f 6666 7365 7420 6f72 206f 6666  an offset or off
+00011550: 7365 7420 616c 6961 7320 6c69 6b65 2027  set alias like '
+00011560: 3544 272c 0a20 2020 2020 2020 2020 2020  5D',.           
+00011570: 7468 6520 6461 7461 206d 7573 7420 6861  the data must ha
+00011580: 7665 2061 2060 6044 6174 6574 696d 6549  ve a ``DatetimeI
+00011590: 6e64 6578 6060 0a0a 2020 2020 2020 2020  ndex``..        
+000115a0: 2020 202e 2e20 7665 7273 696f 6e63 6861     .. versioncha
+000115b0: 6e67 6564 3a3a 2030 2e31 352e 300a 0a20  nged:: 0.15.0.. 
+000115c0: 2020 2020 2020 2020 2020 2020 204e 6f77               Now
+000115d0: 2061 6363 6570 7473 206f 6666 7365 7473   accepts offsets
+000115e0: 2061 6e64 2073 7472 696e 6720 6f66 6673   and string offs
+000115f0: 6574 2061 6c69 6173 6573 0a0a 2020 2020  et aliases..    
+00011600: 2020 2020 6d69 6e5f 7065 7269 6f64 7320      min_periods 
+00011610: 3a20 696e 742c 2064 6566 6175 6c74 204e  : int, default N
+00011620: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00011630: 4d69 6e69 6d75 6d20 6e75 6d62 6572 206f  Minimum number o
+00011640: 6620 6f62 7365 7276 6174 696f 6e73 2069  f observations i
+00011650: 6e20 7769 6e64 6f77 2072 6571 7569 7265  n window require
+00011660: 6420 746f 2068 6176 6520 6120 7661 6c75  d to have a valu
+00011670: 650a 2020 2020 2020 2020 2020 2020 286f  e.            (o
+00011680: 7468 6572 7769 7365 2072 6573 756c 7420  therwise result 
+00011690: 6973 204e 4129 2e0a 2020 2020 2020 2020  is NA)..        
+000116a0: 6365 6e74 6572 203a 2062 6f6f 6c65 616e  center : boolean
+000116b0: 2c20 6465 6661 756c 7420 4661 6c73 650a  , default False.
+000116c0: 2020 2020 2020 2020 2020 2020 5365 7420              Set 
+000116d0: 7468 6520 6c61 6265 6c73 2061 7420 7468  the labels at th
+000116e0: 6520 6365 6e74 6572 206f 6620 7468 6520  e center of the 
+000116f0: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
+00011700: 7769 6e5f 7479 7065 203a 2073 7472 696e  win_type : strin
+00011710: 672c 2064 6566 6175 6c74 204e 6f6e 650a  g, default None.
+00011720: 2020 2020 2020 2020 2020 2020 5072 6f76              Prov
+00011730: 6964 6520 6120 7769 6e64 6f77 2074 7970  ide a window typ
+00011740: 652e 2054 6865 2072 6563 6f67 6e69 7a65  e. The recognize
+00011750: 6420 7769 6e64 6f77 2074 7970 6573 2061  d window types a
+00011760: 7265 2069 6465 6e74 6963 616c 0a20 2020  re identical.   
+00011770: 2020 2020 2020 2020 2074 6f20 7061 6e64           to pand
+00011780: 6173 2e0a 2020 2020 2020 2020 6178 6973  as..        axis
+00011790: 203a 2069 6e74 2c20 7374 722c 204e 6f6e   : int, str, Non
+000117a0: 652c 2064 6566 6175 6c74 2030 0a20 2020  e, default 0.   
+000117b0: 2020 2020 2020 2020 2054 6869 7320 7061           This pa
+000117c0: 7261 6d65 7465 7220 6973 2064 6570 7265  rameter is depre
+000117d0: 6361 7465 6420 7769 7468 2060 6070 616e  cated with ``pan
+000117e0: 6461 733e 3d32 2e31 6060 2e0a 0a20 2020  das>=2.1``...   
+000117f0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+00011800: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+00011810: 2020 2020 2061 2052 6f6c 6c69 6e67 206f       a Rolling o
+00011820: 626a 6563 7420 6f6e 2077 6869 6368 2074  bject on which t
+00011830: 6f20 6361 6c6c 2061 206d 6574 686f 6420  o call a method 
+00011840: 746f 2063 6f6d 7075 7465 2061 2073 7461  to compute a sta
+00011850: 7469 7374 6963 0a20 2020 2020 2020 2022  tistic.        "
+00011860: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00011870: 6461 736b 2e64 6174 6166 7261 6d65 2e72  dask.dataframe.r
+00011880: 6f6c 6c69 6e67 2069 6d70 6f72 7420 526f  olling import Ro
+00011890: 6c6c 696e 670a 0a20 2020 2020 2020 2069  lling..        i
+000118a0: 6620 6973 696e 7374 616e 6365 2877 696e  f isinstance(win
+000118b0: 646f 772c 2049 6e74 6567 7261 6c29 3a0a  dow, Integral):.
+000118c0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+000118d0: 696e 646f 7720 3c20 303a 0a20 2020 2020  indow < 0:.     
+000118e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000118f0: 2056 616c 7565 4572 726f 7228 2277 696e   ValueError("win
+00011900: 646f 7720 6d75 7374 2062 6520 3e3d 2030  dow must be >= 0
+00011910: 2229 0a0a 2020 2020 2020 2020 6966 206d  ")..        if m
+00011920: 696e 5f70 6572 696f 6473 2069 7320 6e6f  in_periods is no
+00011930: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00011940: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00011950: 7461 6e63 6528 6d69 6e5f 7065 7269 6f64  tance(min_period
+00011960: 732c 2049 6e74 6567 7261 6c29 3a0a 2020  s, Integral):.  
+00011970: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00011980: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00011990: 6d69 6e5f 7065 7269 6f64 7320 6d75 7374  min_periods must
+000119a0: 2062 6520 616e 2069 6e74 6567 6572 2229   be an integer")
+000119b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000119c0: 6d69 6e5f 7065 7269 6f64 7320 3c20 303a  min_periods < 0:
+000119d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000119e0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000119f0: 7228 226d 696e 5f70 6572 696f 6473 206d  r("min_periods m
+00011a00: 7573 7420 6265 203e 3d20 3022 290a 0a20  ust be >= 0").. 
+00011a10: 2020 2020 2020 2072 6574 7572 6e20 526f         return Ro
+00011a20: 6c6c 696e 6728 0a20 2020 2020 2020 2020  lling(.         
+00011a30: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00011a40: 2020 2020 2077 696e 646f 773d 7769 6e64       window=wind
+00011a50: 6f77 2c0a 2020 2020 2020 2020 2020 2020  ow,.            
+00011a60: 6d69 6e5f 7065 7269 6f64 733d 6d69 6e5f  min_periods=min_
+00011a70: 7065 7269 6f64 732c 0a20 2020 2020 2020  periods,.       
+00011a80: 2020 2020 2063 656e 7465 723d 6365 6e74       center=cent
+00011a90: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00011aa0: 7769 6e5f 7479 7065 3d77 696e 5f74 7970  win_type=win_typ
+00011ab0: 652c 0a20 2020 2020 2020 2020 2020 2061  e,.            a
+00011ac0: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
+00011ad0: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
+00011ae0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
+00011af0: 616d 6529 0a20 2020 2064 6566 2064 6966  ame).    def dif
+00011b00: 6628 7365 6c66 2c20 7065 7269 6f64 733d  f(self, periods=
+00011b10: 312c 2061 7869 733d 3029 3a0a 2020 2020  1, axis=0):.    
+00011b20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00011b30: 2e2e 206e 6f74 653a 3a0a 0a20 2020 2020  .. note::..     
+00011b40: 2020 2020 2020 5061 6e64 6173 2063 7572        Pandas cur
+00011b50: 7265 6e74 6c79 2075 7365 7320 616e 2060  rently uses an `
+00011b60: 606f 626a 6563 7460 602d 6474 7970 6520  `object``-dtype 
+00011b70: 636f 6c75 6d6e 2074 6f20 7265 7072 6573  column to repres
+00011b80: 656e 740a 2020 2020 2020 2020 2020 2062  ent.           b
+00011b90: 6f6f 6c65 616e 2064 6174 6120 7769 7468  oolean data with
+00011ba0: 206d 6973 7369 6e67 2076 616c 7565 732e   missing values.
+00011bb0: 2054 6869 7320 6361 6e20 6361 7573 6520   This can cause 
+00011bc0: 6973 7375 6573 2066 6f72 0a20 2020 2020  issues for.     
+00011bd0: 2020 2020 2020 626f 6f6c 6561 6e2d 7370        boolean-sp
+00011be0: 6563 6966 6963 206f 7065 7261 7469 6f6e  ecific operation
+00011bf0: 732c 206c 696b 6520 6060 7c60 602e 2054  s, like ``|``. T
+00011c00: 6f20 656e 6162 6c65 2062 6f6f 6c65 616e  o enable boolean
+00011c10: 2d0a 2020 2020 2020 2020 2020 2073 7065  -.           spe
+00011c20: 6369 6669 6320 6f70 6572 6174 696f 6e73  cific operations
+00011c30: 2c20 6174 2074 6865 2063 6f73 7420 6f66  , at the cost of
+00011c40: 206d 6574 6164 6174 6120 7468 6174 2064   metadata that d
+00011c50: 6f65 736e 2774 206d 6174 6368 0a20 2020  oesn't match.   
+00011c60: 2020 2020 2020 2020 7061 6e64 6173 2c20          pandas, 
+00011c70: 7573 6520 6060 2e61 7374 7970 6528 626f  use ``.astype(bo
+00011c80: 6f6c 2960 6020 6166 7465 7220 7468 6520  ol)`` after the 
+00011c90: 6060 7368 6966 7460 602e 0a20 2020 2020  ``shift``..     
+00011ca0: 2020 2022 2222 0a20 2020 2020 2020 2061     """.        a
+00011cb0: 7869 7320 3d20 7365 6c66 2e5f 7661 6c69  xis = self._vali
+00011cc0: 6461 7465 5f61 7869 7328 6178 6973 290a  date_axis(axis).
+00011cd0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00011ce0: 7369 6e73 7461 6e63 6528 7065 7269 6f64  sinstance(period
+00011cf0: 732c 2049 6e74 6567 7261 6c29 3a0a 2020  s, Integral):.  
+00011d00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00011d10: 5479 7065 4572 726f 7228 2270 6572 696f  TypeError("perio
+00011d20: 6473 206d 7573 7420 6265 2061 6e20 696e  ds must be an in
+00011d30: 7465 6765 7222 290a 0a20 2020 2020 2020  teger")..       
+00011d40: 2069 6620 6178 6973 203d 3d20 313a 0a20   if axis == 1:. 
+00011d50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011d60: 6e20 7365 6c66 2e6d 6170 5f70 6172 7469  n self.map_parti
+00011d70: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
+00011d80: 2020 2020 2020 204d 2e64 6966 662c 2074         M.diff, t
+00011d90: 6f6b 656e 3d22 6469 6666 222c 2070 6572  oken="diff", per
+00011da0: 696f 6473 3d70 6572 696f 6473 2c20 6178  iods=periods, ax
+00011db0: 6973 3d31 2c20 656e 666f 7263 655f 6d65  is=1, enforce_me
+00011dc0: 7461 6461 7461 3d46 616c 7365 0a20 2020  tadata=False.   
+00011dd0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00011de0: 2020 2020 6265 666f 7265 2c20 6166 7465      before, afte
+00011df0: 7220 3d20 2870 6572 696f 6473 2c20 3029  r = (periods, 0)
+00011e00: 2069 6620 7065 7269 6f64 7320 3e20 3020   if periods > 0 
+00011e10: 656c 7365 2028 302c 202d 7065 7269 6f64  else (0, -period
+00011e20: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+00011e30: 6e20 7365 6c66 2e6d 6170 5f6f 7665 726c  n self.map_overl
+00011e40: 6170 284d 2e64 6966 662c 2062 6566 6f72  ap(M.diff, befor
+00011e50: 652c 2061 6674 6572 2c20 746f 6b65 6e3d  e, after, token=
+00011e60: 2264 6966 6622 2c20 7065 7269 6f64 733d  "diff", periods=
+00011e70: 7065 7269 6f64 7329 0a0a 2020 2020 4064  periods)..    @d
+00011e80: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+00011e90: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+00011ea0: 6620 7368 6966 7428 7365 6c66 2c20 7065  f shift(self, pe
+00011eb0: 7269 6f64 733d 312c 2066 7265 713d 4e6f  riods=1, freq=No
+00011ec0: 6e65 2c20 6178 6973 3d30 293a 0a20 2020  ne, axis=0):.   
+00011ed0: 2020 2020 2061 7869 7320 3d20 7365 6c66       axis = self
+00011ee0: 2e5f 7661 6c69 6461 7465 5f61 7869 7328  ._validate_axis(
+00011ef0: 6178 6973 290a 2020 2020 2020 2020 6966  axis).        if
+00011f00: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00011f10: 7065 7269 6f64 732c 2049 6e74 6567 7261  periods, Integra
+00011f20: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
+00011f30: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00011f40: 2270 6572 696f 6473 206d 7573 7420 6265  "periods must be
+00011f50: 2061 6e20 696e 7465 6765 7222 290a 0a20   an integer").. 
+00011f60: 2020 2020 2020 2069 6620 6178 6973 203d         if axis =
+00011f70: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00011f80: 2072 6574 7572 6e20 7365 6c66 2e6d 6170   return self.map
+00011f90: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
+00011fa0: 2020 2020 2020 2020 2020 2020 204d 2e73               M.s
+00011fb0: 6869 6674 2c0a 2020 2020 2020 2020 2020  hift,.          
+00011fc0: 2020 2020 2020 746f 6b65 6e3d 2273 6869        token="shi
+00011fd0: 6674 222c 0a20 2020 2020 2020 2020 2020  ft",.           
+00011fe0: 2020 2020 2070 6572 696f 6473 3d70 6572       periods=per
+00011ff0: 696f 6473 2c0a 2020 2020 2020 2020 2020  iods,.          
+00012000: 2020 2020 2020 6672 6571 3d66 7265 712c        freq=freq,
+00012010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012020: 2061 7869 733d 312c 0a20 2020 2020 2020   axis=1,.       
+00012030: 2020 2020 2020 2020 2065 6e66 6f72 6365           enforce
+00012040: 5f6d 6574 6164 6174 613d 4661 6c73 652c  _metadata=False,
+00012050: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00012060: 2020 2020 2020 2020 6966 2066 7265 7120          if freq 
+00012070: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00012080: 2020 2020 2062 6566 6f72 652c 2061 6674       before, aft
+00012090: 6572 203d 2028 7065 7269 6f64 732c 2030  er = (periods, 0
+000120a0: 2920 6966 2070 6572 696f 6473 203e 2030  ) if periods > 0
+000120b0: 2065 6c73 6520 2830 2c20 2d70 6572 696f   else (0, -perio
+000120c0: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
+000120d0: 7265 7475 726e 2073 656c 662e 6d61 705f  return self.map_
+000120e0: 6f76 6572 6c61 7028 0a20 2020 2020 2020  overlap(.       
+000120f0: 2020 2020 2020 2020 204d 2e73 6869 6674           M.shift
+00012100: 2c20 6265 666f 7265 2c20 6166 7465 722c  , before, after,
+00012110: 2074 6f6b 656e 3d22 7368 6966 7422 2c20   token="shift", 
+00012120: 7065 7269 6f64 733d 7065 7269 6f64 730a  periods=periods.
+00012130: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00012140: 2020 2020 2020 2023 204c 6574 2070 616e         # Let pan
+00012150: 6461 7320 6572 726f 7220 6f6e 2069 6e76  das error on inv
+00012160: 616c 6964 2061 7267 756d 656e 7473 0a20  alid arguments. 
+00012170: 2020 2020 2020 206d 6574 6120 3d20 7365         meta = se
+00012180: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
+00012190: 792e 7368 6966 7428 7065 7269 6f64 732c  y.shift(periods,
+000121a0: 2066 7265 713d 6672 6571 290a 2020 2020   freq=freq).    
+000121b0: 2020 2020 6f75 7420 3d20 7365 6c66 2e6d      out = self.m
+000121c0: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
+000121d0: 2020 2020 2020 2020 2020 204d 2e73 6869             M.shi
+000121e0: 6674 2c0a 2020 2020 2020 2020 2020 2020  ft,.            
+000121f0: 746f 6b65 6e3d 2273 6869 6674 222c 0a20  token="shift",. 
+00012200: 2020 2020 2020 2020 2020 2070 6572 696f             perio
+00012210: 6473 3d70 6572 696f 6473 2c0a 2020 2020  ds=periods,.    
+00012220: 2020 2020 2020 2020 6672 6571 3d66 7265          freq=fre
+00012230: 712c 0a20 2020 2020 2020 2020 2020 206d  q,.            m
+00012240: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
+00012250: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
+00012260: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
+00012270: 2020 2020 2020 2020 2020 7472 616e 7366            transf
+00012280: 6f72 6d5f 6469 7669 7369 6f6e 733d 4661  orm_divisions=Fa
+00012290: 6c73 652c 0a20 2020 2020 2020 2029 0a20  lse,.        ). 
+000122a0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+000122b0: 7962 655f 7368 6966 745f 6469 7669 7369  ybe_shift_divisi
+000122c0: 6f6e 7328 6f75 742c 2070 6572 696f 6473  ons(out, periods
+000122d0: 2c20 6672 6571 3d66 7265 7129 0a0a 2020  , freq=freq)..  
+000122e0: 2020 6465 6620 5f72 6564 7563 7469 6f6e    def _reduction
+000122f0: 5f61 6767 280a 2020 2020 2020 2020 7365  _agg(.        se
+00012300: 6c66 2c0a 2020 2020 2020 2020 6e61 6d65  lf,.        name
+00012310: 2c0a 2020 2020 2020 2020 6178 6973 3d4e  ,.        axis=N
+00012320: 6f6e 652c 0a20 2020 2020 2020 2073 6b69  one,.        ski
+00012330: 706e 613d 5472 7565 2c0a 2020 2020 2020  pna=True,.      
+00012340: 2020 7370 6c69 745f 6576 6572 793d 4661    split_every=Fa
+00012350: 6c73 652c 0a20 2020 2020 2020 206f 7574  lse,.        out
+00012360: 3d4e 6f6e 652c 0a20 2020 2020 2020 206e  =None,.        n
+00012370: 756d 6572 6963 5f6f 6e6c 793d 4e6f 6e65  umeric_only=None
+00012380: 2c0a 2020 2020 2020 2020 6e6f 6e65 5f69  ,.        none_i
+00012390: 735f 7a65 726f 3d54 7275 652c 0a20 2020  s_zero=True,.   
+000123a0: 2029 3a0a 2020 2020 2020 2020 6178 6973   ):.        axis
+000123b0: 203d 2073 656c 662e 5f76 616c 6964 6174   = self._validat
+000123c0: 655f 6178 6973 2861 7869 732c 206e 6f6e  e_axis(axis, non
+000123d0: 655f 6973 5f7a 6572 6f3d 6e6f 6e65 5f69  e_is_zero=none_i
+000123e0: 735f 7a65 726f 290a 0a20 2020 2020 2020  s_zero)..       
+000123f0: 2069 6620 6861 735f 6b65 7977 6f72 6428   if has_keyword(
+00012400: 6765 7461 7474 7228 7365 6c66 2e5f 6d65  getattr(self._me
+00012410: 7461 5f6e 6f6e 656d 7074 792c 206e 616d  ta_nonempty, nam
+00012420: 6529 2c20 226e 756d 6572 6963 5f6f 6e6c  e), "numeric_onl
+00012430: 7922 293a 0a20 2020 2020 2020 2020 2020  y"):.           
+00012440: 206e 756d 6572 6963 5f6f 6e6c 795f 6b77   numeric_only_kw
+00012450: 6172 6773 203d 207b 226e 756d 6572 6963  args = {"numeric
+00012460: 5f6f 6e6c 7922 3a20 6e75 6d65 7269 635f  _only": numeric_
+00012470: 6f6e 6c79 7d0a 2020 2020 2020 2020 656c  only}.        el
+00012480: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00012490: 6e75 6d65 7269 635f 6f6e 6c79 5f6b 7761  numeric_only_kwa
+000124a0: 7267 7320 3d20 7b7d 0a0a 2020 2020 2020  rgs = {}..      
+000124b0: 2020 7769 7468 2063 6865 636b 5f6e 756d    with check_num
+000124c0: 6572 6963 5f6f 6e6c 795f 6465 7072 6563  eric_only_deprec
+000124d0: 6174 696f 6e28 6e61 6d65 2c20 5472 7565  ation(name, True
+000124e0: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
+000124f0: 6574 6120 3d20 6765 7461 7474 7228 7365  eta = getattr(se
+00012500: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
+00012510: 792c 206e 616d 6529 280a 2020 2020 2020  y, name)(.      
+00012520: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
+00012530: 7869 732c 2073 6b69 706e 613d 736b 6970  xis, skipna=skip
+00012540: 6e61 2c20 2a2a 6e75 6d65 7269 635f 6f6e  na, **numeric_on
+00012550: 6c79 5f6b 7761 7267 730a 2020 2020 2020  ly_kwargs.      
+00012560: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00012570: 2074 6f6b 656e 203d 2073 656c 662e 5f74   token = self._t
+00012580: 6f6b 656e 5f70 7265 6669 7820 2b20 6e61  oken_prefix + na
+00012590: 6d65 0a20 2020 2020 2020 2069 6620 6178  me.        if ax
+000125a0: 6973 203d 3d20 313a 0a20 2020 2020 2020  is == 1:.       
+000125b0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+000125c0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
+000125d0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+000125e0: 2020 205f 6765 7461 7474 725f 6e75 6d65     _getattr_nume
+000125f0: 7269 635f 6f6e 6c79 2c0a 2020 2020 2020  ric_only,.      
+00012600: 2020 2020 2020 2020 2020 6d65 7461 3d6d            meta=m
+00012610: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
+00012620: 2020 2020 2074 6f6b 656e 3d74 6f6b 656e       token=token
+00012630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012640: 2020 736b 6970 6e61 3d73 6b69 706e 612c    skipna=skipna,
+00012650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012660: 2061 7869 733d 6178 6973 2c0a 2020 2020   axis=axis,.    
+00012670: 2020 2020 2020 2020 2020 2020 5f64 6173              _das
+00012680: 6b5f 6d65 7468 6f64 5f6e 616d 653d 6e61  k_method_name=na
+00012690: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000126a0: 2020 2020 2a2a 6e75 6d65 7269 635f 6f6e      **numeric_on
+000126b0: 6c79 5f6b 7761 7267 732c 0a20 2020 2020  ly_kwargs,.     
+000126c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000126d0: 2020 2020 2072 6574 7572 6e20 6861 6e64       return hand
+000126e0: 6c65 5f6f 7574 286f 7574 2c20 7265 7375  le_out(out, resu
+000126f0: 6c74 290a 2020 2020 2020 2020 656c 7365  lt).        else
 00012700: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00012710: 732e 6469 7669 7369 6f6e 7320 3d20 7475  s.divisions = tu
-00012720: 706c 6528 7072 6566 6978 202b 2073 7472  ple(prefix + str
-00012730: 2864 6976 6973 696f 6e29 2066 6f72 2064  (division) for d
-00012740: 6976 6973 696f 6e20 696e 2073 656c 662e  ivision in self.
-00012750: 6469 7669 7369 6f6e 7329 0a20 2020 2020  divisions).     
-00012760: 2020 2072 6574 7572 6e20 7265 730a 0a20     return res.. 
-00012770: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-00012780: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-00012790: 2020 2064 6566 2061 6464 5f73 7566 6669     def add_suffi
-000127a0: 7828 7365 6c66 2c20 7375 6666 6978 293a  x(self, suffix):
-000127b0: 0a20 2020 2020 2020 2072 6573 203d 2073  .        res = s
-000127c0: 656c 662e 6d61 705f 7061 7274 6974 696f  elf.map_partitio
-000127d0: 6e73 284d 2e61 6464 5f73 7566 6669 782c  ns(M.add_suffix,
-000127e0: 2073 7566 6669 7829 0a20 2020 2020 2020   suffix).       
-000127f0: 2069 6620 7365 6c66 2e6b 6e6f 776e 5f64   if self.known_d
-00012800: 6976 6973 696f 6e73 2061 6e64 2069 735f  ivisions and is_
-00012810: 7365 7269 6573 5f6c 696b 6528 7365 6c66  series_like(self
-00012820: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00012830: 6573 2e64 6976 6973 696f 6e73 203d 2074  es.divisions = t
-00012840: 7570 6c65 2873 7472 2864 6976 6973 696f  uple(str(divisio
-00012850: 6e29 202b 2073 7566 6669 7820 666f 7220  n) + suffix for 
-00012860: 6469 7669 7369 6f6e 2069 6e20 7365 6c66  division in self
-00012870: 2e64 6976 6973 696f 6e73 290a 2020 2020  .divisions).    
-00012880: 2020 2020 7265 7475 726e 2072 6573 0a0a      return res..
-00012890: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
-000128a0: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
-000128b0: 2020 2020 6465 6620 6162 7328 7365 6c66      def abs(self
-000128c0: 293a 0a20 2020 2020 2020 205f 7261 6973  ):.        _rais
-000128d0: 655f 6966 5f6f 626a 6563 745f 7365 7269  e_if_object_seri
-000128e0: 6573 2873 656c 662c 2022 6162 7322 290a  es(self, "abs").
-000128f0: 2020 2020 2020 2020 6d65 7461 203d 2073          meta = s
-00012900: 656c 662e 5f6d 6574 615f 6e6f 6e65 6d70  elf._meta_nonemp
-00012910: 7479 2e61 6273 2829 0a20 2020 2020 2020  ty.abs().       
-00012920: 2072 6574 7572 6e20 7365 6c66 2e6d 6170   return self.map
-00012930: 5f70 6172 7469 7469 6f6e 7328 4d2e 6162  _partitions(M.ab
-00012940: 732c 206d 6574 613d 6d65 7461 2c20 656e  s, meta=meta, en
-00012950: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-00012960: 616c 7365 290a 0a20 2020 2040 6465 7269  alse)..    @deri
-00012970: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
-00012980: 4672 616d 6529 0a20 2020 2064 6566 2061  Frame).    def a
-00012990: 6c6c 2873 656c 662c 2061 7869 733d 4e6f  ll(self, axis=No
-000129a0: 6e65 2c20 736b 6970 6e61 3d54 7275 652c  ne, skipna=True,
-000129b0: 2073 706c 6974 5f65 7665 7279 3d46 616c   split_every=Fal
-000129c0: 7365 2c20 6f75 743d 4e6f 6e65 293a 0a20  se, out=None):. 
-000129d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000129e0: 6c66 2e5f 7265 6475 6374 696f 6e5f 6167  lf._reduction_ag
-000129f0: 6728 0a20 2020 2020 2020 2020 2020 2022  g(.            "
-00012a00: 616c 6c22 2c20 6178 6973 3d61 7869 732c  all", axis=axis,
-00012a10: 2073 6b69 706e 613d 736b 6970 6e61 2c20   skipna=skipna, 
-00012a20: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-00012a30: 745f 6576 6572 792c 206f 7574 3d6f 7574  t_every, out=out
-00012a40: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00012a50: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-00012a60: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
-00012a70: 6465 6620 616e 7928 7365 6c66 2c20 6178  def any(self, ax
-00012a80: 6973 3d4e 6f6e 652c 2073 6b69 706e 613d  is=None, skipna=
-00012a90: 5472 7565 2c20 7370 6c69 745f 6576 6572  True, split_ever
-00012aa0: 793d 4661 6c73 652c 206f 7574 3d4e 6f6e  y=False, out=Non
-00012ab0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-00012ac0: 726e 2073 656c 662e 5f72 6564 7563 7469  rn self._reducti
-00012ad0: 6f6e 5f61 6767 280a 2020 2020 2020 2020  on_agg(.        
-00012ae0: 2020 2020 2261 6e79 222c 2061 7869 733d      "any", axis=
-00012af0: 6178 6973 2c20 736b 6970 6e61 3d73 6b69  axis, skipna=ski
-00012b00: 706e 612c 2073 706c 6974 5f65 7665 7279  pna, split_every
-00012b10: 3d73 706c 6974 5f65 7665 7279 2c20 6f75  =split_every, ou
-00012b20: 743d 6f75 740a 2020 2020 2020 2020 290a  t=out.        ).
-00012b30: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-00012b40: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-00012b50: 0a20 2020 2064 6566 2073 756d 280a 2020  .    def sum(.  
-00012b60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00012b70: 2020 2020 6178 6973 3d4e 6f6e 652c 0a20      axis=None,. 
-00012b80: 2020 2020 2020 2073 6b69 706e 613d 5472         skipna=Tr
-00012b90: 7565 2c0a 2020 2020 2020 2020 7370 6c69  ue,.        spli
-00012ba0: 745f 6576 6572 793d 4661 6c73 652c 0a20  t_every=False,. 
-00012bb0: 2020 2020 2020 2064 7479 7065 3d4e 6f6e         dtype=Non
-00012bc0: 652c 0a20 2020 2020 2020 206f 7574 3d4e  e,.        out=N
-00012bd0: 6f6e 652c 0a20 2020 2020 2020 206d 696e  one,.        min
-00012be0: 5f63 6f75 6e74 3d4e 6f6e 652c 0a20 2020  _count=None,.   
-00012bf0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
-00012c00: 793d 4e6f 6e65 2c0a 2020 2020 293a 0a20  y=None,.    ):. 
-00012c10: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00012c20: 7365 6c66 2e5f 7265 6475 6374 696f 6e5f  self._reduction_
-00012c30: 6167 6728 0a20 2020 2020 2020 2020 2020  agg(.           
-00012c40: 2022 7375 6d22 2c0a 2020 2020 2020 2020   "sum",.        
-00012c50: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
-00012c60: 2020 2020 2020 2020 2020 2073 6b69 706e             skipn
-00012c70: 613d 736b 6970 6e61 2c0a 2020 2020 2020  a=skipna,.      
-00012c80: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
-00012c90: 793d 7370 6c69 745f 6576 6572 792c 0a20  y=split_every,. 
-00012ca0: 2020 2020 2020 2020 2020 206f 7574 3d6f             out=o
-00012cb0: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
-00012cc0: 6e75 6d65 7269 635f 6f6e 6c79 3d6e 756d  numeric_only=num
-00012cd0: 6572 6963 5f6f 6e6c 792c 0a20 2020 2020  eric_only,.     
-00012ce0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00012cf0: 6d69 6e5f 636f 756e 743a 0a20 2020 2020  min_count:.     
-00012d00: 2020 2020 2020 2063 6f6e 6420 3d20 7365         cond = se
-00012d10: 6c66 2e6e 6f74 6e75 6c6c 2829 2e73 756d  lf.notnull().sum
-00012d20: 2861 7869 733d 6178 6973 2920 3e3d 206d  (axis=axis) >= m
-00012d30: 696e 5f63 6f75 6e74 0a20 2020 2020 2020  in_count.       
-00012d40: 2020 2020 2069 6620 6973 5f73 6572 6965       if is_serie
-00012d50: 735f 6c69 6b65 2863 6f6e 6429 3a0a 2020  s_like(cond):.  
-00012d60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00012d70: 7475 726e 2072 6573 756c 742e 7768 6572  turn result.wher
-00012d80: 6528 636f 6e64 2c20 6f74 6865 723d 6e70  e(cond, other=np
-00012d90: 2e4e 614e 290a 2020 2020 2020 2020 2020  .NaN).          
-00012da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00012db0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-00012dc0: 7363 616c 6172 5f62 696e 6172 7928 0a20  scalar_binary(. 
-00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012de0: 2020 206c 616d 6264 6120 782c 2079 3a20     lambda x, y: 
-00012df0: 7265 7375 6c74 2069 6620 7820 6973 2079  result if x is y
-00012e00: 2065 6c73 6520 6e70 2e4e 614e 2c20 636f   else np.NaN, co
-00012e10: 6e64 2c20 5472 7565 0a20 2020 2020 2020  nd, True.       
-00012e20: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00012e30: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00012e40: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00012e50: 6c74 0a0a 2020 2020 4064 6572 6976 6564  lt..    @derived
-00012e60: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
-00012e70: 6d65 290a 2020 2020 6465 6620 7072 6f64  me).    def prod
-00012e80: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00012e90: 2020 2020 2020 2020 6178 6973 3d4e 6f6e          axis=Non
-00012ea0: 652c 0a20 2020 2020 2020 2073 6b69 706e  e,.        skipn
-00012eb0: 613d 5472 7565 2c0a 2020 2020 2020 2020  a=True,.        
-00012ec0: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
-00012ed0: 652c 0a20 2020 2020 2020 2064 7479 7065  e,.        dtype
-00012ee0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206f  =None,.        o
-00012ef0: 7574 3d4e 6f6e 652c 0a20 2020 2020 2020  ut=None,.       
-00012f00: 206d 696e 5f63 6f75 6e74 3d4e 6f6e 652c   min_count=None,
-00012f10: 0a20 2020 2020 2020 206e 756d 6572 6963  .        numeric
-00012f20: 5f6f 6e6c 793d 4e6f 6e65 2c0a 2020 2020  _only=None,.    
-00012f30: 293a 0a20 2020 2020 2020 2072 6573 756c  ):.        resul
-00012f40: 7420 3d20 7365 6c66 2e5f 7265 6475 6374  t = self._reduct
-00012f50: 696f 6e5f 6167 6728 0a20 2020 2020 2020  ion_agg(.       
-00012f60: 2020 2020 2022 7072 6f64 222c 0a20 2020       "prod",.   
-00012f70: 2020 2020 2020 2020 2061 7869 733d 6178           axis=ax
-00012f80: 6973 2c0a 2020 2020 2020 2020 2020 2020  is,.            
-00012f90: 736b 6970 6e61 3d73 6b69 706e 612c 0a20  skipna=skipna,. 
-00012fa0: 2020 2020 2020 2020 2020 2073 706c 6974             split
-00012fb0: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00012fc0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00012fd0: 6f75 743d 6f75 742c 0a20 2020 2020 2020  out=out,.       
-00012fe0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
-00012ff0: 793d 6e75 6d65 7269 635f 6f6e 6c79 2c0a  y=numeric_only,.
-00013000: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00013010: 2020 6966 206d 696e 5f63 6f75 6e74 3a0a    if min_count:.
-00013020: 2020 2020 2020 2020 2020 2020 636f 6e64              cond
-00013030: 203d 2073 656c 662e 6e6f 746e 756c 6c28   = self.notnull(
-00013040: 292e 7375 6d28 6178 6973 3d61 7869 7329  ).sum(axis=axis)
-00013050: 203e 3d20 6d69 6e5f 636f 756e 740a 2020   >= min_count.  
-00013060: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
-00013070: 7365 7269 6573 5f6c 696b 6528 636f 6e64  series_like(cond
-00013080: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00013090: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-000130a0: 2e77 6865 7265 2863 6f6e 642c 206f 7468  .where(cond, oth
-000130b0: 6572 3d6e 702e 4e61 4e29 0a20 2020 2020  er=np.NaN).     
-000130c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000130d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000130e0: 7572 6e20 5f73 6361 6c61 725f 6269 6e61  urn _scalar_bina
-000130f0: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
-00013100: 2020 2020 2020 2020 6c61 6d62 6461 2078          lambda x
-00013110: 2c20 793a 2072 6573 756c 7420 6966 2078  , y: result if x
-00013120: 2069 7320 7920 656c 7365 206e 702e 4e61   is y else np.Na
-00013130: 4e2c 2063 6f6e 642c 2054 7275 650a 2020  N, cond, True.  
-00013140: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00013150: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00013160: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013170: 2072 6573 756c 740a 0a20 2020 2070 726f   result..    pro
-00013180: 6475 6374 203d 2070 726f 6420 2023 2061  duct = prod  # a
-00013190: 6c69 6173 6564 2064 642e 7072 6f64 7563  liased dd.produc
-000131a0: 740a 0a20 2020 2040 6465 7269 7665 645f  t..    @derived_
-000131b0: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-000131c0: 6529 0a20 2020 2064 6566 206d 6178 2873  e).    def max(s
-000131d0: 656c 662c 2061 7869 733d 302c 2073 6b69  elf, axis=0, ski
-000131e0: 706e 613d 5472 7565 2c20 7370 6c69 745f  pna=True, split_
-000131f0: 6576 6572 793d 4661 6c73 652c 206f 7574  every=False, out
-00013200: 3d4e 6f6e 652c 206e 756d 6572 6963 5f6f  =None, numeric_o
-00013210: 6e6c 793d 4e6f 6e65 293a 0a20 2020 2020  nly=None):.     
-00013220: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00013230: 2020 2020 5041 4e44 4153 5f47 545f 3134      PANDAS_GT_14
-00013240: 300a 2020 2020 2020 2020 2020 2020 616e  0.            an
-00013250: 6420 6e6f 7420 5041 4e44 4153 5f47 545f  d not PANDAS_GT_
-00013260: 3230 300a 2020 2020 2020 2020 2020 2020  200.            
-00013270: 616e 6420 6178 6973 2069 7320 4e6f 6e65  and axis is None
-00013280: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00013290: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-000132a0: 2c20 4461 7461 4672 616d 6529 0a20 2020  , DataFrame).   
-000132b0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-000132c0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-000132d0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-000132e0: 2020 2022 496e 2061 2066 7574 7572 6520     "In a future 
-000132f0: 7665 7273 696f 6e2c 2044 6174 6146 7261  version, DataFra
-00013300: 6d65 2e6d 6178 2861 7869 733d 4e6f 6e65  me.max(axis=None
-00013310: 2920 7769 6c6c 2072 6574 7572 6e20 6120  ) will return a 
-00013320: 7363 616c 6172 206d 6178 206f 7665 7220  scalar max over 
-00013330: 7468 6520 656e 7469 7265 2044 6174 6146  the entire DataF
-00013340: 7261 6d65 2e20 220a 2020 2020 2020 2020  rame. ".        
-00013350: 2020 2020 2020 2020 2254 6f20 7265 7461          "To reta
-00013360: 696e 2074 6865 206f 6c64 2062 6568 6176  in the old behav
-00013370: 696f 722c 2075 7365 2027 6672 616d 652e  ior, use 'frame.
-00013380: 6d61 7828 6178 6973 3d30 2927 206f 7220  max(axis=0)' or 
-00013390: 6a75 7374 2027 6672 616d 652e 6d61 7828  just 'frame.max(
-000133a0: 2927 222c 0a20 2020 2020 2020 2020 2020  )'",.           
-000133b0: 2020 2020 2046 7574 7572 6557 6172 6e69       FutureWarni
-000133c0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-000133d0: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-000133e0: 6973 203d 2030 0a0a 2020 2020 2020 2020  is = 0..        
-000133f0: 7265 7475 726e 2073 656c 662e 5f72 6564  return self._red
-00013400: 7563 7469 6f6e 5f61 6767 280a 2020 2020  uction_agg(.    
-00013410: 2020 2020 2020 2020 226d 6178 222c 0a20          "max",. 
-00013420: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
-00013430: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
-00013440: 2020 736b 6970 6e61 3d73 6b69 706e 612c    skipna=skipna,
-00013450: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
-00013460: 6974 5f65 7665 7279 3d73 706c 6974 5f65  it_every=split_e
-00013470: 7665 7279 2c0a 2020 2020 2020 2020 2020  very,.          
-00013480: 2020 6f75 743d 6f75 742c 0a20 2020 2020    out=out,.     
-00013490: 2020 2020 2020 2023 2053 7461 7274 696e         # Startin
-000134a0: 6720 696e 2070 616e 6461 7320 322e 302c  g in pandas 2.0,
-000134b0: 2060 6178 6973 3d4e 6f6e 6560 2064 6f65   `axis=None` doe
-000134c0: 7320 6120 6675 6c6c 2061 6767 7265 6761  s a full aggrega
-000134d0: 7469 6f6e 2061 6372 6f73 7320 626f 7468  tion across both
-000134e0: 2061 7865 730a 2020 2020 2020 2020 2020   axes.          
-000134f0: 2020 6e6f 6e65 5f69 735f 7a65 726f 3d6e    none_is_zero=n
-00013500: 6f74 2050 414e 4441 535f 4754 5f32 3030  ot PANDAS_GT_200
-00013510: 2c0a 2020 2020 2020 2020 2020 2020 6e75  ,.            nu
-00013520: 6d65 7269 635f 6f6e 6c79 3d6e 756d 6572  meric_only=numer
-00013530: 6963 5f6f 6e6c 792c 0a20 2020 2020 2020  ic_only,.       
-00013540: 2029 0a0a 2020 2020 4064 6572 6976 6564   )..    @derived
-00013550: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
-00013560: 6d65 290a 2020 2020 6465 6620 6d69 6e28  me).    def min(
-00013570: 7365 6c66 2c20 6178 6973 3d30 2c20 736b  self, axis=0, sk
-00013580: 6970 6e61 3d54 7275 652c 2073 706c 6974  ipna=True, split
-00013590: 5f65 7665 7279 3d46 616c 7365 2c20 6f75  _every=False, ou
-000135a0: 743d 4e6f 6e65 2c20 6e75 6d65 7269 635f  t=None, numeric_
-000135b0: 6f6e 6c79 3d4e 6f6e 6529 3a0a 2020 2020  only=None):.    
-000135c0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-000135d0: 2020 2020 2050 414e 4441 535f 4754 5f31       PANDAS_GT_1
-000135e0: 3430 0a20 2020 2020 2020 2020 2020 2061  40.            a
-000135f0: 6e64 206e 6f74 2050 414e 4441 535f 4754  nd not PANDAS_GT
-00013600: 5f32 3030 0a20 2020 2020 2020 2020 2020  _200.           
-00013610: 2061 6e64 2061 7869 7320 6973 204e 6f6e   and axis is Non
-00013620: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
-00013630: 6420 6973 696e 7374 616e 6365 2873 656c  d isinstance(sel
-00013640: 662c 2044 6174 6146 7261 6d65 290a 2020  f, DataFrame).  
-00013650: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00013660: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00013670: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-00013680: 2020 2020 2249 6e20 6120 6675 7475 7265      "In a future
-00013690: 2076 6572 7369 6f6e 2c20 4461 7461 4672   version, DataFr
-000136a0: 616d 652e 6d69 6e28 6178 6973 3d4e 6f6e  ame.min(axis=Non
-000136b0: 6529 2077 696c 6c20 7265 7475 726e 2061  e) will return a
-000136c0: 2073 6361 6c61 7220 6d69 6e20 6f76 6572   scalar min over
-000136d0: 2074 6865 2065 6e74 6972 6520 4461 7461   the entire Data
-000136e0: 4672 616d 652e 2022 0a20 2020 2020 2020  Frame. ".       
-000136f0: 2020 2020 2020 2020 2022 546f 2072 6574           "To ret
-00013700: 6169 6e20 7468 6520 6f6c 6420 6265 6861  ain the old beha
-00013710: 7669 6f72 2c20 7573 6520 2766 7261 6d65  vior, use 'frame
-00013720: 2e6d 696e 2861 7869 733d 3029 2720 6f72  .min(axis=0)' or
-00013730: 206a 7573 7420 2766 7261 6d65 2e6d 696e   just 'frame.min
-00013740: 2829 2722 2c0a 2020 2020 2020 2020 2020  ()'",.          
-00013750: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
-00013760: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00013770: 2029 0a20 2020 2020 2020 2020 2020 2061   ).            a
-00013780: 7869 7320 3d20 300a 0a20 2020 2020 2020  xis = 0..       
-00013790: 2072 6574 7572 6e20 7365 6c66 2e5f 7265   return self._re
-000137a0: 6475 6374 696f 6e5f 6167 6728 0a20 2020  duction_agg(.   
-000137b0: 2020 2020 2020 2020 2022 6d69 6e22 2c0a           "min",.
-000137c0: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-000137d0: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-000137e0: 2020 2073 6b69 706e 613d 736b 6970 6e61     skipna=skipna
-000137f0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-00013800: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00013810: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
-00013820: 2020 206f 7574 3d6f 7574 2c0a 2020 2020     out=out,.    
-00013830: 2020 2020 2020 2020 2320 5374 6172 7469          # Starti
-00013840: 6e67 2069 6e20 7061 6e64 6173 2032 2e30  ng in pandas 2.0
-00013850: 2c20 6061 7869 733d 4e6f 6e65 6020 646f  , `axis=None` do
-00013860: 6573 2061 2066 756c 6c20 6167 6772 6567  es a full aggreg
-00013870: 6174 696f 6e20 6163 726f 7373 2062 6f74  ation across bot
-00013880: 6820 6178 6573 0a20 2020 2020 2020 2020  h axes.         
-00013890: 2020 206e 6f6e 655f 6973 5f7a 6572 6f3d     none_is_zero=
-000138a0: 6e6f 7420 5041 4e44 4153 5f47 545f 3230  not PANDAS_GT_20
-000138b0: 302c 0a20 2020 2020 2020 2020 2020 206e  0,.            n
-000138c0: 756d 6572 6963 5f6f 6e6c 793d 6e75 6d65  umeric_only=nume
-000138d0: 7269 635f 6f6e 6c79 2c0a 2020 2020 2020  ric_only,.      
-000138e0: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
-000138f0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00013900: 616d 6529 0a20 2020 2064 6566 2069 6478  ame).    def idx
-00013910: 6d61 7828 0a20 2020 2020 2020 2073 656c  max(.        sel
-00013920: 662c 2061 7869 733d 4e6f 6e65 2c20 736b  f, axis=None, sk
-00013930: 6970 6e61 3d54 7275 652c 2073 706c 6974  ipna=True, split
-00013940: 5f65 7665 7279 3d46 616c 7365 2c20 6e75  _every=False, nu
-00013950: 6d65 7269 635f 6f6e 6c79 3d6e 6f5f 6465  meric_only=no_de
-00013960: 6661 756c 740a 2020 2020 293a 0a20 2020  fault.    ):.   
-00013970: 2020 2020 2066 6e20 3d20 2269 6478 6d61       fn = "idxma
-00013980: 7822 0a20 2020 2020 2020 2061 7869 7320  x".        axis 
-00013990: 3d20 7365 6c66 2e5f 7661 6c69 6461 7465  = self._validate
-000139a0: 5f61 7869 7328 6178 6973 290a 2020 2020  _axis(axis).    
-000139b0: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
-000139c0: 5f6b 7761 7267 7320 3d20 6368 6563 6b5f  _kwargs = check_
-000139d0: 6e75 6d65 7269 635f 6f6e 6c79 5f76 616c  numeric_only_val
-000139e0: 6964 286e 756d 6572 6963 5f6f 6e6c 792c  id(numeric_only,
-000139f0: 2022 6964 786d 6178 2229 0a20 2020 2020   "idxmax").     
-00013a00: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
-00013a10: 6d65 7461 5f6e 6f6e 656d 7074 792e 6964  meta_nonempty.id
-00013a20: 786d 6178 280a 2020 2020 2020 2020 2020  xmax(.          
-00013a30: 2020 6178 6973 3d61 7869 732c 2073 6b69    axis=axis, ski
-00013a40: 706e 613d 736b 6970 6e61 2c20 2a2a 6e75  pna=skipna, **nu
-00013a50: 6d65 7269 635f 6f6e 6c79 5f6b 7761 7267  meric_only_kwarg
-00013a60: 730a 2020 2020 2020 2020 290a 2020 2020  s.        ).    
-00013a70: 2020 2020 6966 2061 7869 7320 3d3d 2031      if axis == 1
-00013a80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00013a90: 7475 726e 206d 6170 5f70 6172 7469 7469  turn map_partiti
-00013aa0: 6f6e 7328 0a20 2020 2020 2020 2020 2020  ons(.           
-00013ab0: 2020 2020 204d 2e69 6478 6d61 782c 0a20       M.idxmax,. 
-00013ac0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013ad0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00013ae0: 2020 2020 206d 6574 613d 6d65 7461 2c0a       meta=meta,.
-00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b00: 746f 6b65 6e3d 7365 6c66 2e5f 746f 6b65  token=self._toke
-00013b10: 6e5f 7072 6566 6978 202b 2066 6e2c 0a20  n_prefix + fn,. 
-00013b20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013b30: 6b69 706e 613d 736b 6970 6e61 2c0a 2020  kipna=skipna,.  
-00013b40: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00013b50: 6973 3d61 7869 732c 0a20 2020 2020 2020  is=axis,.       
-00013b60: 2020 2020 2020 2020 2065 6e66 6f72 6365           enforce
-00013b70: 5f6d 6574 6164 6174 613d 4661 6c73 652c  _metadata=False,
-00013b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b90: 202a 2a6e 756d 6572 6963 5f6f 6e6c 795f   **numeric_only_
-00013ba0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
-00013bb0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-00013bc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00013bd0: 7363 616c 6172 203d 206e 6f74 2069 735f  scalar = not is_
-00013be0: 7365 7269 6573 5f6c 696b 6528 6d65 7461  series_like(meta
-00013bf0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00013c00: 7375 6c74 203d 2061 6361 280a 2020 2020  sult = aca(.    
-00013c10: 2020 2020 2020 2020 2020 2020 5b73 656c              [sel
-00013c20: 665d 2c0a 2020 2020 2020 2020 2020 2020  f],.            
-00013c30: 2020 2020 6368 756e 6b3d 6964 786d 6178      chunk=idxmax
-00013c40: 6d69 6e5f 6368 756e 6b2c 0a20 2020 2020  min_chunk,.     
-00013c50: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
-00013c60: 6761 7465 3d69 6478 6d61 786d 696e 5f61  gate=idxmaxmin_a
-00013c70: 6767 2c0a 2020 2020 2020 2020 2020 2020  gg,.            
-00013c80: 2020 2020 636f 6d62 696e 653d 6964 786d      combine=idxm
-00013c90: 6178 6d69 6e5f 636f 6d62 696e 652c 0a20  axmin_combine,. 
-00013ca0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00013cb0: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
-00013cc0: 2020 2020 2020 2020 2020 6167 6772 6567            aggreg
-00013cd0: 6174 655f 6b77 6172 6773 3d7b 2273 6361  ate_kwargs={"sca
-00013ce0: 6c61 7222 3a20 7363 616c 6172 7d2c 0a20  lar": scalar},. 
-00013cf0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00013d00: 6f6b 656e 3d73 656c 662e 5f74 6f6b 656e  oken=self._token
-00013d10: 5f70 7265 6669 7820 2b20 666e 2c0a 2020  _prefix + fn,.  
-00013d20: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00013d30: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00013d40: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
-00013d50: 2020 2020 2020 2073 6b69 706e 613d 736b         skipna=sk
-00013d60: 6970 6e61 2c0a 2020 2020 2020 2020 2020  ipna,.          
-00013d70: 2020 2020 2020 666e 3d66 6e2c 0a20 2020        fn=fn,.   
-00013d80: 2020 2020 2020 2020 2020 2020 202a 2a6e               **n
-00013d90: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
-00013da0: 6773 2c0a 2020 2020 2020 2020 2020 2020  gs,.            
-00013db0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00013dc0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00013dd0: 2c20 4461 7461 4672 616d 6529 3a0a 2020  , DataFrame):.  
-00013de0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013df0: 7375 6c74 2e64 6976 6973 696f 6e73 203d  sult.divisions =
-00013e00: 2028 6d69 6e28 7365 6c66 2e63 6f6c 756d   (min(self.colum
-00013e10: 6e73 292c 206d 6178 2873 656c 662e 636f  ns), max(self.co
-00013e20: 6c75 6d6e 7329 290a 2020 2020 2020 2020  lumns)).        
-00013e30: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-00013e40: 740a 0a20 2020 2040 6465 7269 7665 645f  t..    @derived_
-00013e50: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-00013e60: 6529 0a20 2020 2064 6566 2069 6478 6d69  e).    def idxmi
-00013e70: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
-00013e80: 2061 7869 733d 4e6f 6e65 2c20 736b 6970   axis=None, skip
-00013e90: 6e61 3d54 7275 652c 2073 706c 6974 5f65  na=True, split_e
-00013ea0: 7665 7279 3d46 616c 7365 2c20 6e75 6d65  very=False, nume
-00013eb0: 7269 635f 6f6e 6c79 3d6e 6f5f 6465 6661  ric_only=no_defa
-00013ec0: 756c 740a 2020 2020 293a 0a20 2020 2020  ult.    ):.     
-00013ed0: 2020 2066 6e20 3d20 2269 6478 6d69 6e22     fn = "idxmin"
-00013ee0: 0a20 2020 2020 2020 2061 7869 7320 3d20  .        axis = 
-00013ef0: 7365 6c66 2e5f 7661 6c69 6461 7465 5f61  self._validate_a
-00013f00: 7869 7328 6178 6973 290a 2020 2020 2020  xis(axis).      
-00013f10: 2020 6e75 6d65 7269 635f 6f6e 6c79 5f6b    numeric_only_k
-00013f20: 7761 7267 7320 3d20 6368 6563 6b5f 6e75  wargs = check_nu
-00013f30: 6d65 7269 635f 6f6e 6c79 5f76 616c 6964  meric_only_valid
-00013f40: 286e 756d 6572 6963 5f6f 6e6c 792c 2022  (numeric_only, "
-00013f50: 6964 786d 6178 2229 0a20 2020 2020 2020  idxmax").       
-00013f60: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
-00013f70: 7461 5f6e 6f6e 656d 7074 792e 6964 786d  ta_nonempty.idxm
-00013f80: 6178 280a 2020 2020 2020 2020 2020 2020  ax(.            
-00013f90: 6178 6973 3d61 7869 732c 2073 6b69 706e  axis=axis, skipn
-00013fa0: 613d 736b 6970 6e61 2c20 2a2a 6e75 6d65  a=skipna, **nume
-00013fb0: 7269 635f 6f6e 6c79 5f6b 7761 7267 730a  ric_only_kwargs.
-00013fc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00013fd0: 2020 6966 2061 7869 7320 3d3d 2031 3a0a    if axis == 1:.
-00013fe0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013ff0: 726e 206d 6170 5f70 6172 7469 7469 6f6e  rn map_partition
-00014000: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00014010: 2020 204d 2e69 6478 6d69 6e2c 0a20 2020     M.idxmin,.   
-00014020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00014030: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00014040: 2020 206d 6574 613d 6d65 7461 2c0a 2020     meta=meta,.  
-00014050: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00014060: 6b65 6e3d 7365 6c66 2e5f 746f 6b65 6e5f  ken=self._token_
-00014070: 7072 6566 6978 202b 2066 6e2c 0a20 2020  prefix + fn,.   
-00014080: 2020 2020 2020 2020 2020 2020 2073 6b69               ski
-00014090: 706e 613d 736b 6970 6e61 2c0a 2020 2020  pna=skipna,.    
-000140a0: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-000140b0: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-000140c0: 2020 2020 2020 2065 6e66 6f72 6365 5f6d         enforce_m
-000140d0: 6574 6164 6174 613d 4661 6c73 652c 0a20  etadata=False,. 
-000140e0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000140f0: 2a6e 756d 6572 6963 5f6f 6e6c 795f 6b77  *numeric_only_kw
-00014100: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-00014110: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
-00014120: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-00014130: 616c 6172 203d 206e 6f74 2069 735f 7365  alar = not is_se
-00014140: 7269 6573 5f6c 696b 6528 6d65 7461 290a  ries_like(meta).
-00014150: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00014160: 6c74 203d 2061 6361 280a 2020 2020 2020  lt = aca(.      
-00014170: 2020 2020 2020 2020 2020 5b73 656c 665d            [self]
-00014180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014190: 2020 6368 756e 6b3d 6964 786d 6178 6d69    chunk=idxmaxmi
-000141a0: 6e5f 6368 756e 6b2c 0a20 2020 2020 2020  n_chunk,.       
-000141b0: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-000141c0: 7465 3d69 6478 6d61 786d 696e 5f61 6767  te=idxmaxmin_agg
-000141d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000141e0: 2020 636f 6d62 696e 653d 6964 786d 6178    combine=idxmax
-000141f0: 6d69 6e5f 636f 6d62 696e 652c 0a20 2020  min_combine,.   
-00014200: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00014210: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
-00014220: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-00014230: 655f 6b77 6172 6773 3d7b 2273 6361 6c61  e_kwargs={"scala
-00014240: 7222 3a20 7363 616c 6172 7d2c 0a20 2020  r": scalar},.   
-00014250: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
-00014260: 656e 3d73 656c 662e 5f74 6f6b 656e 5f70  en=self._token_p
-00014270: 7265 6669 7820 2b20 666e 2c0a 2020 2020  refix + fn,.    
-00014280: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00014290: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-000142a0: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
-000142b0: 2020 2020 2073 6b69 706e 613d 736b 6970       skipna=skip
-000142c0: 6e61 2c0a 2020 2020 2020 2020 2020 2020  na,.            
-000142d0: 2020 2020 666e 3d66 6e2c 0a20 2020 2020      fn=fn,.     
-000142e0: 2020 2020 2020 2020 2020 202a 2a6e 756d             **num
-000142f0: 6572 6963 5f6f 6e6c 795f 6b77 6172 6773  eric_only_kwargs
-00014300: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00014310: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00014320: 7369 6e73 7461 6e63 6528 7365 6c66 2c20  sinstance(self, 
-00014330: 4461 7461 4672 616d 6529 3a0a 2020 2020  DataFrame):.    
-00014340: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00014350: 6c74 2e64 6976 6973 696f 6e73 203d 2028  lt.divisions = (
-00014360: 6d69 6e28 7365 6c66 2e63 6f6c 756d 6e73  min(self.columns
-00014370: 292c 206d 6178 2873 656c 662e 636f 6c75  ), max(self.colu
-00014380: 6d6e 7329 290a 2020 2020 2020 2020 2020  mns)).          
-00014390: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-000143a0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-000143b0: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-000143c0: 0a20 2020 2064 6566 2063 6f75 6e74 2873  .    def count(s
-000143d0: 656c 662c 2061 7869 733d 4e6f 6e65 2c20  elf, axis=None, 
-000143e0: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
-000143f0: 652c 206e 756d 6572 6963 5f6f 6e6c 793d  e, numeric_only=
-00014400: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00014410: 2320 5468 6973 206d 6574 686f 6420 6973  # This method is
-00014420: 2073 6861 7265 6420 6279 2044 6174 6146   shared by DataF
-00014430: 7261 6d65 202f 2053 6572 6965 732c 2062  rame / Series, b
-00014440: 7574 206f 6e6c 7920 4461 7461 4672 616d  ut only DataFram
-00014450: 650a 2020 2020 2020 2020 2320 7375 7070  e.        # supp
-00014460: 6f72 7473 2060 6e75 6d65 7269 635f 6f6e  orts `numeric_on
-00014470: 6c79 3d60 2e20 4861 6e64 6c65 2061 6363  ly=`. Handle acc
-00014480: 6f72 6469 6e67 6c79 2068 6572 652e 0a20  ordingly here.. 
-00014490: 2020 2020 2020 206e 756d 6572 6963 5f6f         numeric_o
-000144a0: 6e6c 795f 6b77 6172 6773 203d 207b 7d0a  nly_kwargs = {}.
-000144b0: 2020 2020 2020 2020 6966 2069 735f 6461          if is_da
-000144c0: 7461 6672 616d 655f 6c69 6b65 2873 656c  taframe_like(sel
-000144d0: 6629 3a0a 2020 2020 2020 2020 2020 2020  f):.            
-000144e0: 6e75 6d65 7269 635f 6f6e 6c79 5f6b 7761  numeric_only_kwa
-000144f0: 7267 7320 3d20 6765 745f 6e75 6d65 7269  rgs = get_numeri
-00014500: 635f 6f6e 6c79 5f6b 7761 7267 7328 6e75  c_only_kwargs(nu
-00014510: 6d65 7269 635f 6f6e 6c79 290a 2020 2020  meric_only).    
-00014520: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
-00014530: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
-00014540: 7869 7329 0a20 2020 2020 2020 2074 6f6b  xis).        tok
-00014550: 656e 203d 2073 656c 662e 5f74 6f6b 656e  en = self._token
-00014560: 5f70 7265 6669 7820 2b20 2263 6f75 6e74  _prefix + "count
-00014570: 220a 2020 2020 2020 2020 6966 2061 7869  ".        if axi
-00014580: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
-00014590: 2020 2020 6d65 7461 203d 2073 656c 662e      meta = self.
-000145a0: 5f6d 6574 615f 6e6f 6e65 6d70 7479 2e63  _meta_nonempty.c
-000145b0: 6f75 6e74 2861 7869 733d 6178 6973 2c20  ount(axis=axis, 
-000145c0: 2a2a 6e75 6d65 7269 635f 6f6e 6c79 5f6b  **numeric_only_k
-000145d0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
-000145e0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-000145f0: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
-00014600: 2020 2020 2020 2020 2020 2020 2020 204d                 M
-00014610: 2e63 6f75 6e74 2c0a 2020 2020 2020 2020  .count,.        
-00014620: 2020 2020 2020 2020 6d65 7461 3d6d 6574          meta=met
-00014630: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
-00014640: 2020 2074 6f6b 656e 3d74 6f6b 656e 2c0a     token=token,.
-00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014660: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
-00014670: 2020 2020 2020 2020 2020 2065 6e66 6f72             enfor
-00014680: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-00014690: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000146a0: 2020 202a 2a6e 756d 6572 6963 5f6f 6e6c     **numeric_onl
-000146b0: 795f 6b77 6172 6773 2c0a 2020 2020 2020  y_kwargs,.      
-000146c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000146d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000146e0: 2020 6d65 7461 203d 2073 656c 662e 5f6d    meta = self._m
-000146f0: 6574 615f 6e6f 6e65 6d70 7479 2e63 6f75  eta_nonempty.cou
-00014700: 6e74 2829 0a0a 2020 2020 2020 2020 2020  nt()..          
-00014710: 2020 2320 4e65 6564 2074 6865 2061 7374    # Need the ast
-00014720: 7970 6528 696e 7429 2066 6f72 2065 6d70  ype(int) for emp
-00014730: 7479 2064 6174 6166 7261 6d65 732c 2077  ty dataframes, w
-00014740: 6869 6368 2073 756d 2074 6f20 666c 6f61  hich sum to floa
-00014750: 7420 6474 7970 650a 2020 2020 2020 2020  t dtype.        
-00014760: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00014770: 662e 7265 6475 6374 696f 6e28 0a20 2020  f.reduction(.   
-00014780: 2020 2020 2020 2020 2020 2020 204d 2e63               M.c
-00014790: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
-000147a0: 2020 2020 2020 6167 6772 6567 6174 653d        aggregate=
-000147b0: 5f63 6f75 6e74 5f61 6767 7265 6761 7465  _count_aggregate
-000147c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000147d0: 2020 6d65 7461 3d6d 6574 612c 0a20 2020    meta=meta,.   
-000147e0: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
-000147f0: 656e 3d74 6f6b 656e 2c0a 2020 2020 2020  en=token,.      
-00014800: 2020 2020 2020 2020 2020 7370 6c69 745f            split_
-00014810: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
-00014820: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-00014830: 2020 2063 6875 6e6b 5f6b 7761 7267 733d     chunk_kwargs=
-00014840: 6e75 6d65 7269 635f 6f6e 6c79 5f6b 7761  numeric_only_kwa
-00014850: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
-00014860: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-00014870: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-00014880: 662c 2044 6174 6146 7261 6d65 293a 0a20  f, DataFrame):. 
-00014890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000148a0: 6573 756c 742e 6469 7669 7369 6f6e 7320  esult.divisions 
-000148b0: 3d20 2873 656c 662e 636f 6c75 6d6e 732e  = (self.columns.
-000148c0: 6d69 6e28 292c 2073 656c 662e 636f 6c75  min(), self.colu
-000148d0: 6d6e 732e 6d61 7828 2929 0a20 2020 2020  mns.max()).     
-000148e0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000148f0: 7375 6c74 0a0a 2020 2020 4064 6572 6976  sult..    @deriv
-00014900: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
-00014910: 7261 6d65 290a 2020 2020 6465 6620 6d6f  rame).    def mo
-00014920: 6465 2873 656c 662c 2064 726f 706e 613d  de(self, dropna=
-00014930: 5472 7565 2c20 7370 6c69 745f 6576 6572  True, split_ever
-00014940: 793d 4661 6c73 6529 3a0a 2020 2020 2020  y=False):.      
-00014950: 2020 6d6f 6465 5f73 6572 6965 7320 3d20    mode_series = 
-00014960: 7365 6c66 2e72 6564 7563 7469 6f6e 280a  self.reduction(.
-00014970: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-00014980: 6b3d 4d2e 7661 6c75 655f 636f 756e 7473  k=M.value_counts
-00014990: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-000149a0: 6d62 696e 653d 4d2e 7375 6d2c 0a20 2020  mbine=M.sum,.   
-000149b0: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-000149c0: 7465 3d5f 6d6f 6465 5f61 6767 7265 6761  te=_mode_aggrega
-000149d0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-000149e0: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-000149f0: 745f 6576 6572 792c 0a20 2020 2020 2020  t_every,.       
-00014a00: 2020 2020 2063 6875 6e6b 5f6b 7761 7267       chunk_kwarg
-00014a10: 733d 7b22 6472 6f70 6e61 223a 2064 726f  s={"dropna": dro
-00014a20: 706e 617d 2c0a 2020 2020 2020 2020 2020  pna},.          
-00014a30: 2020 6167 6772 6567 6174 655f 6b77 6172    aggregate_kwar
-00014a40: 6773 3d7b 2264 726f 706e 6122 3a20 6472  gs={"dropna": dr
-00014a50: 6f70 6e61 7d2c 0a20 2020 2020 2020 2029  opna},.        )
-00014a60: 0a20 2020 2020 2020 206d 6f64 655f 7365  .        mode_se
-00014a70: 7269 6573 2e6e 616d 6520 3d20 7365 6c66  ries.name = self
-00014a80: 2e6e 616d 650a 2020 2020 2020 2020 7265  .name.        re
-00014a90: 7475 726e 206d 6f64 655f 7365 7269 6573  turn mode_series
-00014aa0: 0a0a 2020 2020 405f 6e75 6d65 7269 635f  ..    @_numeric_
-00014ab0: 6f6e 6c79 0a20 2020 2040 6465 7269 7665  only.    @derive
-00014ac0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00014ad0: 616d 6529 0a20 2020 2064 6566 206d 6561  ame).    def mea
-00014ae0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
-00014af0: 0a20 2020 2020 2020 2061 7869 733d 302c  .        axis=0,
-00014b00: 0a20 2020 2020 2020 2073 6b69 706e 613d  .        skipna=
-00014b10: 5472 7565 2c0a 2020 2020 2020 2020 7370  True,.        sp
-00014b20: 6c69 745f 6576 6572 793d 4661 6c73 652c  lit_every=False,
-00014b30: 0a20 2020 2020 2020 2064 7479 7065 3d4e  .        dtype=N
-00014b40: 6f6e 652c 0a20 2020 2020 2020 206f 7574  one,.        out
-00014b50: 3d4e 6f6e 652c 0a20 2020 2020 2020 206e  =None,.        n
-00014b60: 756d 6572 6963 5f6f 6e6c 793d 4e6f 6e65  umeric_only=None
-00014b70: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00014b80: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00014b90: 2020 5041 4e44 4153 5f47 545f 3134 300a    PANDAS_GT_140.
-00014ba0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00014bb0: 6e6f 7420 5041 4e44 4153 5f47 545f 3230  not PANDAS_GT_20
-00014bc0: 300a 2020 2020 2020 2020 2020 2020 616e  0.            an
-00014bd0: 6420 6178 6973 2069 7320 4e6f 6e65 0a20  d axis is None. 
-00014be0: 2020 2020 2020 2020 2020 2061 6e64 2069             and i
-00014bf0: 7369 6e73 7461 6e63 6528 7365 6c66 2c20  sinstance(self, 
-00014c00: 4461 7461 4672 616d 6529 0a20 2020 2020  DataFrame).     
-00014c10: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00014c20: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00014c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c40: 2022 496e 2061 2066 7574 7572 6520 7665   "In a future ve
-00014c50: 7273 696f 6e2c 2044 6174 6146 7261 6d65  rsion, DataFrame
-00014c60: 2e6d 6561 6e28 6178 6973 3d4e 6f6e 6529  .mean(axis=None)
-00014c70: 2077 696c 6c20 7265 7475 726e 2061 2073   will return a s
-00014c80: 6361 6c61 7220 6d65 616e 206f 7665 7220  calar mean over 
-00014c90: 7468 6520 656e 7469 7265 2044 6174 6146  the entire DataF
-00014ca0: 7261 6d65 2e20 220a 2020 2020 2020 2020  rame. ".        
-00014cb0: 2020 2020 2020 2020 2254 6f20 7265 7461          "To reta
-00014cc0: 696e 2074 6865 206f 6c64 2062 6568 6176  in the old behav
-00014cd0: 696f 722c 2075 7365 2027 6672 616d 652e  ior, use 'frame.
-00014ce0: 6d65 616e 2861 7869 733d 3029 2720 6f72  mean(axis=0)' or
-00014cf0: 206a 7573 7420 2766 7261 6d65 2e6d 6561   just 'frame.mea
-00014d00: 6e28 2927 222c 0a20 2020 2020 2020 2020  n()'",.         
-00014d10: 2020 2020 2020 2046 7574 7572 6557 6172         FutureWar
-00014d20: 6e69 6e67 2c0a 2020 2020 2020 2020 2020  ning,.          
-00014d30: 2020 290a 2020 2020 2020 2020 6178 6973    ).        axis
-00014d40: 203d 2073 656c 662e 5f76 616c 6964 6174   = self._validat
-00014d50: 655f 6178 6973 2861 7869 732c 206e 6f6e  e_axis(axis, non
-00014d60: 655f 6973 5f7a 6572 6f3d 6e6f 7420 5041  e_is_zero=not PA
-00014d70: 4e44 4153 5f47 545f 3230 3029 0a20 2020  NDAS_GT_200).   
-00014d80: 2020 2020 205f 7261 6973 655f 6966 5f6f       _raise_if_o
-00014d90: 626a 6563 745f 7365 7269 6573 2873 656c  bject_series(sel
-00014da0: 662c 2022 6d65 616e 2229 0a20 2020 2020  f, "mean").     
-00014db0: 2020 2023 204e 4f54 453a 2044 6f20 7765     # NOTE: Do we
-00014dc0: 2077 616e 7420 746f 2077 6172 6e20 6865   want to warn he
-00014dd0: 7265 3f0a 2020 2020 2020 2020 7769 7468  re?.        with
-00014de0: 2063 6865 636b 5f6e 756d 6572 6963 5f6f   check_numeric_o
-00014df0: 6e6c 795f 6465 7072 6563 6174 696f 6e28  nly_deprecation(
-00014e00: 292c 2063 6865 636b 5f6e 7569 7361 6e63  ), check_nuisanc
-00014e10: 655f 636f 6c75 6d6e 735f 7761 726e 696e  e_columns_warnin
-00014e20: 6728 293a 0a20 2020 2020 2020 2020 2020  g():.           
-00014e30: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
-00014e40: 7461 5f6e 6f6e 656d 7074 792e 6d65 616e  ta_nonempty.mean
-00014e50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014e60: 2020 6178 6973 3d61 7869 732c 2073 6b69    axis=axis, ski
-00014e70: 706e 613d 736b 6970 6e61 2c20 6e75 6d65  pna=skipna, nume
-00014e80: 7269 635f 6f6e 6c79 3d6e 756d 6572 6963  ric_only=numeric
-00014e90: 5f6f 6e6c 790a 2020 2020 2020 2020 2020  _only.          
-00014ea0: 2020 290a 2020 2020 2020 2020 6966 2061    ).        if a
-00014eb0: 7869 7320 3d3d 2031 3a0a 2020 2020 2020  xis == 1:.      
-00014ec0: 2020 2020 2020 7265 7375 6c74 203d 206d        result = m
-00014ed0: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
-00014ee0: 2020 2020 2020 2020 2020 2020 2020 204d                 M
-00014ef0: 2e6d 6561 6e2c 0a20 2020 2020 2020 2020  .mean,.         
-00014f00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00014f10: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00014f20: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
-00014f30: 2020 2020 2020 2020 746f 6b65 6e3d 7365          token=se
-00014f40: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
-00014f50: 202b 2022 6d65 616e 222c 0a20 2020 2020   + "mean",.     
-00014f60: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
-00014f70: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
-00014f80: 2020 2020 2020 736b 6970 6e61 3d73 6b69        skipna=ski
-00014f90: 706e 612c 0a20 2020 2020 2020 2020 2020  pna,.           
-00014fa0: 2020 2020 2065 6e66 6f72 6365 5f6d 6574       enforce_met
-00014fb0: 6164 6174 613d 4661 6c73 652c 0a20 2020  adata=False,.   
-00014fc0: 2020 2020 2020 2020 2020 2020 206e 756d               num
-00014fd0: 6572 6963 5f6f 6e6c 793d 6e75 6d65 7269  eric_only=numeri
-00014fe0: 635f 6f6e 6c79 2c0a 2020 2020 2020 2020  c_only,.        
-00014ff0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00015000: 2020 7265 7475 726e 2068 616e 646c 655f    return handle_
-00015010: 6f75 7428 6f75 742c 2072 6573 756c 7429  out(out, result)
-00015020: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015030: 2020 2020 2020 2020 2020 206e 756d 203d             num =
-00015040: 2073 656c 662e 5f67 6574 5f6e 756d 6572   self._get_numer
-00015050: 6963 5f64 6174 6128 290a 2020 2020 2020  ic_data().      
-00015060: 2020 2020 2020 7320 3d20 6e75 6d2e 7375        s = num.su
-00015070: 6d28 736b 6970 6e61 3d73 6b69 706e 612c  m(skipna=skipna,
-00015080: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
-00015090: 6974 5f65 7665 7279 290a 2020 2020 2020  it_every).      
-000150a0: 2020 2020 2020 6e20 3d20 6e75 6d2e 636f        n = num.co
-000150b0: 756e 7428 7370 6c69 745f 6576 6572 793d  unt(split_every=
-000150c0: 7370 6c69 745f 6576 6572 7929 0a20 2020  split_every).   
-000150d0: 2020 2020 2020 2020 2023 2053 7461 7274           # Start
-000150e0: 696e 6720 696e 2070 616e 6461 7320 322e  ing in pandas 2.
-000150f0: 302c 2060 6178 6973 3d4e 6f6e 6560 2064  0, `axis=None` d
-00015100: 6f65 7320 6120 6675 6c6c 2061 6767 7265  oes a full aggre
-00015110: 6761 7469 6f6e 2061 6372 6f73 7320 626f  gation across bo
-00015120: 7468 2061 7865 730a 2020 2020 2020 2020  th axes.        
-00015130: 2020 2020 6966 2050 414e 4441 535f 4754      if PANDAS_GT
-00015140: 5f32 3030 2061 6e64 2061 7869 7320 6973  _200 and axis is
-00015150: 204e 6f6e 6520 616e 6420 6973 696e 7374   None and isinst
-00015160: 616e 6365 2873 656c 662c 2044 6174 6146  ance(self, DataF
-00015170: 7261 6d65 293a 0a20 2020 2020 2020 2020  rame):.         
-00015180: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00015190: 732e 7375 6d28 2920 2f20 6e2e 7375 6d28  s.sum() / n.sum(
-000151a0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-000151b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000151c0: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-000151d0: 5f74 6f6b 656e 5f70 7265 6669 7820 2b20  _token_prefix + 
-000151e0: 226d 6561 6e2d 2573 2220 2520 746f 6b65  "mean-%s" % toke
-000151f0: 6e69 7a65 2873 656c 662c 2061 7869 732c  nize(self, axis,
-00015200: 2073 6b69 706e 6129 0a20 2020 2020 2020   skipna).       
-00015210: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00015220: 3d20 6d61 705f 7061 7274 6974 696f 6e73  = map_partitions
-00015230: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00015240: 2020 2020 2020 6d65 7468 6f64 732e 6d65        methods.me
-00015250: 616e 5f61 6767 7265 6761 7465 2c0a 2020  an_aggregate,.  
-00015260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015270: 2020 732c 0a20 2020 2020 2020 2020 2020    s,.           
-00015280: 2020 2020 2020 2020 206e 2c0a 2020 2020           n,.    
-00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152a0: 746f 6b65 6e3d 6e61 6d65 2c0a 2020 2020  token=name,.    
-000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152c0: 6d65 7461 3d6d 6574 612c 0a20 2020 2020  meta=meta,.     
-000152d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000152e0: 6e66 6f72 6365 5f6d 6574 6164 6174 613d  nforce_metadata=
-000152f0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00015300: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00015310: 745f 6d65 7461 3d73 656c 662e 5f6d 6574  t_meta=self._met
-00015320: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
-00015330: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00015340: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00015350: 6365 2873 656c 662c 2044 6174 6146 7261  ce(self, DataFra
-00015360: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-00015370: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00015380: 6469 7669 7369 6f6e 7320 3d20 2873 656c  divisions = (sel
-00015390: 662e 636f 6c75 6d6e 732e 6d69 6e28 292c  f.columns.min(),
-000153a0: 2073 656c 662e 636f 6c75 6d6e 732e 6d61   self.columns.ma
-000153b0: 7828 2929 0a20 2020 2020 2020 2020 2020  x()).           
-000153c0: 2072 6574 7572 6e20 6861 6e64 6c65 5f6f   return handle_o
-000153d0: 7574 286f 7574 2c20 7265 7375 6c74 290a  ut(out, result).
-000153e0: 0a20 2020 2064 6566 206d 6564 6961 6e5f  .    def median_
-000153f0: 6170 7072 6f78 696d 6174 6528 0a20 2020  approximate(.   
-00015400: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00015410: 2020 2061 7869 733d 4e6f 6e65 2c0a 2020     axis=None,.  
-00015420: 2020 2020 2020 6d65 7468 6f64 3d22 6465        method="de
-00015430: 6661 756c 7422 2c0a 2020 2020 293a 0a20  fault",.    ):. 
-00015440: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00015450: 2074 6865 2061 7070 726f 7869 6d61 7465   the approximate
-00015460: 206d 6564 6961 6e20 6f66 2074 6865 2076   median of the v
-00015470: 616c 7565 7320 6f76 6572 2074 6865 2072  alues over the r
-00015480: 6571 7565 7374 6564 2061 7869 732e 0a0a  equested axis...
-00015490: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000154a0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000154b0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6178  -----.        ax
-000154c0: 6973 203a 207b 302c 2031 2c20 2269 6e64  is : {0, 1, "ind
-000154d0: 6578 222c 2022 636f 6c75 6d6e 7322 7d20  ex", "columns"} 
-000154e0: 2864 6566 6175 6c74 2030 290a 2020 2020  (default 0).    
-000154f0: 2020 2020 2020 2020 3020 6f72 2060 6022          0 or ``"
-00015500: 696e 6465 7822 6060 2066 6f72 2072 6f77  index"`` for row
-00015510: 2d77 6973 652c 2031 206f 7220 6060 2263  -wise, 1 or ``"c
-00015520: 6f6c 756d 6e73 2260 6020 666f 7220 636f  olumns"`` for co
-00015530: 6c75 6d6e 2d77 6973 650a 2020 2020 2020  lumn-wise.      
-00015540: 2020 6d65 7468 6f64 203a 207b 2764 6566    method : {'def
-00015550: 6175 6c74 272c 2027 7464 6967 6573 7427  ault', 'tdigest'
-00015560: 2c20 2764 6173 6b27 7d2c 206f 7074 696f  , 'dask'}, optio
-00015570: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00015580: 5768 6174 206d 6574 686f 6420 746f 2075  What method to u
-00015590: 7365 2e20 4279 2064 6566 6175 6c74 2077  se. By default w
-000155a0: 696c 6c20 7573 6520 4461 736b 2773 2069  ill use Dask's i
-000155b0: 6e74 6572 6e61 6c20 6375 7374 6f6d 0a20  nternal custom. 
-000155c0: 2020 2020 2020 2020 2020 2061 6c67 6f72             algor
-000155d0: 6974 686d 2028 6060 2264 6173 6b22 6060  ithm (``"dask"``
-000155e0: 292e 2020 4966 2073 6574 2074 6f20 6060  ).  If set to ``
-000155f0: 2274 6469 6765 7374 2260 6020 7769 6c6c  "tdigest"`` will
-00015600: 2075 7365 2074 6469 6765 7374 0a20 2020   use tdigest.   
-00015610: 2020 2020 2020 2020 2066 6f72 2066 6c6f           for flo
-00015620: 6174 7320 616e 6420 696e 7473 2061 6e64  ats and ints and
-00015630: 2066 616c 6c62 6163 6b20 746f 2074 6865   fallback to the
-00015640: 2060 6022 6461 736b 2260 6020 6f74 6865   ``"dask"`` othe
-00015650: 7277 6973 652e 0a20 2020 2020 2020 2022  rwise..        "
-00015660: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00015670: 6e20 7365 6c66 2e71 7561 6e74 696c 6528  n self.quantile(
-00015680: 713d 302e 352c 2061 7869 733d 6178 6973  q=0.5, axis=axis
-00015690: 2c20 6d65 7468 6f64 3d6d 6574 686f 6429  , method=method)
-000156a0: 2e72 656e 616d 6528 4e6f 6e65 290a 0a20  .rename(None).. 
-000156b0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-000156c0: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-000156d0: 2020 2064 6566 206d 6564 6961 6e28 7365     def median(se
-000156e0: 6c66 2c20 6178 6973 3d4e 6f6e 652c 206d  lf, axis=None, m
-000156f0: 6574 686f 643d 2264 6566 6175 6c74 2229  ethod="default")
-00015700: 3a0a 2020 2020 2020 2020 6966 2061 7869  :.        if axi
-00015710: 7320 696e 2028 312c 2022 636f 6c75 6d6e  s in (1, "column
-00015720: 7322 2920 6f72 2073 656c 662e 6e70 6172  s") or self.npar
-00015730: 7469 7469 6f6e 7320 3d3d 2031 3a0a 2020  titions == 1:.  
-00015740: 2020 2020 2020 2020 2020 2320 4361 6e20            # Can 
-00015750: 7072 6f76 6964 6520 616e 2065 7861 6374  provide an exact
-00015760: 206d 6564 6961 6e20 696e 2074 6865 7365   median in these
-00015770: 2063 6173 6573 0a20 2020 2020 2020 2020   cases.         
-00015780: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00015790: 6564 6961 6e5f 6170 7072 6f78 696d 6174  edian_approximat
-000157a0: 6528 6178 6973 3d61 7869 732c 206d 6574  e(axis=axis, met
-000157b0: 686f 643d 6d65 7468 6f64 290a 2020 2020  hod=method).    
-000157c0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-000157d0: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
-000157e0: 2020 2020 2020 2020 2020 2022 4461 736b             "Dask
-000157f0: 2064 6f65 736e 2774 2069 6d70 6c65 6d65   doesn't impleme
-00015800: 6e74 2061 6e20 6578 6163 7420 6d65 6469  nt an exact medi
-00015810: 616e 2069 6e20 616c 6c20 6361 7365 7320  an in all cases 
-00015820: 6173 2074 6869 7320 6973 2068 6172 6420  as this is hard 
-00015830: 746f 2064 6f20 696e 2070 6172 616c 6c65  to do in paralle
-00015840: 6c2e 2022 0a20 2020 2020 2020 2020 2020  l. ".           
-00015850: 2022 5365 6520 7468 6520 606d 6564 6961   "See the `media
-00015860: 6e5f 6170 7072 6f78 696d 6174 6560 206d  n_approximate` m
-00015870: 6574 686f 6420 696e 7374 6561 642c 2077  ethod instead, w
-00015880: 6869 6368 2075 7365 7320 616e 2061 7070  hich uses an app
-00015890: 726f 7869 6d61 7465 2061 6c67 6f72 6974  roximate algorit
-000158a0: 686d 2e22 0a20 2020 2020 2020 2029 0a0a  hm.".        )..
-000158b0: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
-000158c0: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
-000158d0: 2020 2020 6465 6620 7661 7228 0a20 2020      def var(.   
-000158e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000158f0: 2020 2061 7869 733d 4e6f 6e65 2c0a 2020     axis=None,.  
-00015900: 2020 2020 2020 736b 6970 6e61 3d54 7275        skipna=Tru
-00015910: 652c 0a20 2020 2020 2020 2064 646f 663d  e,.        ddof=
-00015920: 312c 0a20 2020 2020 2020 2073 706c 6974  1,.        split
-00015930: 5f65 7665 7279 3d46 616c 7365 2c0a 2020  _every=False,.  
-00015940: 2020 2020 2020 6474 7970 653d 4e6f 6e65        dtype=None
-00015950: 2c0a 2020 2020 2020 2020 6f75 743d 4e6f  ,.        out=No
-00015960: 6e65 2c0a 2020 2020 2020 2020 6e75 6d65  ne,.        nume
-00015970: 7269 635f 6f6e 6c79 3d6e 6f5f 6465 6661  ric_only=no_defa
-00015980: 756c 742c 0a20 2020 2029 3a0a 2020 2020  ult,.    ):.    
-00015990: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
-000159a0: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
-000159b0: 7869 7329 0a20 2020 2020 2020 205f 7261  xis).        _ra
-000159c0: 6973 655f 6966 5f6f 626a 6563 745f 7365  ise_if_object_se
-000159d0: 7269 6573 2873 656c 662c 2022 7661 7222  ries(self, "var"
-000159e0: 290a 2020 2020 2020 2020 6e75 6d65 7269  ).        numeri
-000159f0: 635f 6f6e 6c79 5f6b 7761 7267 7320 3d20  c_only_kwargs = 
-00015a00: 6765 745f 6e75 6d65 7269 635f 6f6e 6c79  get_numeric_only
-00015a10: 5f6b 7761 7267 7328 6e75 6d65 7269 635f  _kwargs(numeric_
-00015a20: 6f6e 6c79 290a 2020 2020 2020 2020 7769  only).        wi
-00015a30: 7468 2063 6865 636b 5f6e 756d 6572 6963  th check_numeric
-00015a40: 5f6f 6e6c 795f 6465 7072 6563 6174 696f  _only_deprecatio
-00015a50: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
-00015a60: 7661 7222 2c20 5472 7565 0a20 2020 2020  var", True.     
-00015a70: 2020 2029 2c20 6368 6563 6b5f 7265 6475     ), check_redu
-00015a80: 6374 696f 6e73 5f72 756e 7469 6d65 5f77  ctions_runtime_w
-00015a90: 6172 6e69 6e67 2829 3a0a 2020 2020 2020  arning():.      
-00015aa0: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
-00015ab0: 662e 5f6d 6574 615f 6e6f 6e65 6d70 7479  f._meta_nonempty
-00015ac0: 2e76 6172 280a 2020 2020 2020 2020 2020  .var(.          
-00015ad0: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
-00015ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015af0: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
-00015b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b10: 2a2a 6e75 6d65 7269 635f 6f6e 6c79 5f6b  **numeric_only_k
-00015b20: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
-00015b30: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00015b40: 6178 6973 203d 3d20 313a 0a20 2020 2020  axis == 1:.     
-00015b50: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00015b60: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
-00015b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b80: 4d2e 7661 722c 0a20 2020 2020 2020 2020  M.var,.         
-00015b90: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00015ba0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00015bb0: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
-00015bc0: 2020 2020 2020 2020 746f 6b65 6e3d 7365          token=se
-00015bd0: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
-00015be0: 202b 2022 7661 7222 2c0a 2020 2020 2020   + "var",.      
-00015bf0: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
-00015c00: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-00015c10: 2020 2020 2073 6b69 706e 613d 736b 6970       skipna=skip
-00015c20: 6e61 2c0a 2020 2020 2020 2020 2020 2020  na,.            
-00015c30: 2020 2020 6464 6f66 3d64 646f 662c 0a20      ddof=ddof,. 
-00015c40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00015c50: 6e66 6f72 6365 5f6d 6574 6164 6174 613d  nforce_metadata=
-00015c60: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00015c70: 2020 2020 2020 202a 2a6e 756d 6572 6963         **numeric
-00015c80: 5f6f 6e6c 795f 6b77 6172 6773 2c0a 2020  _only_kwargs,.  
-00015c90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00015ca0: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00015cb0: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
-00015cc0: 6573 756c 7429 0a20 2020 2020 2020 2065  esult).        e
-00015cd0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00015ce0: 2069 6620 7365 6c66 2e6e 6469 6d20 3d3d   if self.ndim ==
-00015cf0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00015d00: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00015d10: 662e 5f76 6172 5f31 6428 7365 6c66 2c20  f._var_1d(self, 
-00015d20: 736b 6970 6e61 2c20 6464 6f66 2c20 7370  skipna, ddof, sp
-00015d30: 6c69 745f 6576 6572 7929 0a20 2020 2020  lit_every).     
-00015d40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00015d50: 6e20 6861 6e64 6c65 5f6f 7574 286f 7574  n handle_out(out
-00015d60: 2c20 7265 7375 6c74 290a 0a20 2020 2020  , result)..     
-00015d70: 2020 2020 2020 2023 2070 616e 6461 7320         # pandas 
-00015d80: 312e 302b 2064 6f65 7320 6e6f 7420 696d  1.0+ does not im
-00015d90: 706c 656d 656e 7420 7661 7220 6f6e 2074  plement var on t
-00015da0: 696d 6564 656c 7461 0a20 2020 2020 2020  imedelta.       
-00015db0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00015dc0: 6c66 2e5f 7661 725f 6e75 6d65 7269 6328  lf._var_numeric(
-00015dd0: 736b 6970 6e61 2c20 6464 6f66 2c20 7370  skipna, ddof, sp
-00015de0: 6c69 745f 6576 6572 7929 0a0a 2020 2020  lit_every)..    
-00015df0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00015e00: 7461 6e63 6528 7365 6c66 2c20 4461 7461  tance(self, Data
-00015e10: 4672 616d 6529 3a0a 2020 2020 2020 2020  Frame):.        
-00015e20: 2020 2020 2020 2020 7265 7375 6c74 2e64          result.d
-00015e30: 6976 6973 696f 6e73 203d 2028 7365 6c66  ivisions = (self
-00015e40: 2e63 6f6c 756d 6e73 2e6d 696e 2829 2c20  .columns.min(), 
-00015e50: 7365 6c66 2e63 6f6c 756d 6e73 2e6d 6178  self.columns.max
-00015e60: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-00015e70: 7265 7475 726e 2068 616e 646c 655f 6f75  return handle_ou
-00015e80: 7428 6f75 742c 2072 6573 756c 7429 0a0a  t(out, result)..
-00015e90: 2020 2020 6465 6620 5f76 6172 5f6e 756d      def _var_num
-00015ea0: 6572 6963 2873 656c 662c 2073 6b69 706e  eric(self, skipn
-00015eb0: 613d 5472 7565 2c20 6464 6f66 3d31 2c20  a=True, ddof=1, 
-00015ec0: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
-00015ed0: 6529 3a0a 2020 2020 2020 2020 6e75 6d20  e):.        num 
-00015ee0: 3d20 7365 6c66 2e73 656c 6563 745f 6474  = self.select_dt
-00015ef0: 7970 6573 2869 6e63 6c75 6465 3d5b 226e  ypes(include=["n
-00015f00: 756d 6265 7222 2c20 2262 6f6f 6c22 5d2c  umber", "bool"],
-00015f10: 2065 7863 6c75 6465 3d5b 6e70 2e74 696d   exclude=[np.tim
-00015f20: 6564 656c 7461 3634 5d29 0a0a 2020 2020  edelta64])..    
-00015f30: 2020 2020 7661 6c75 6573 5f64 7479 7065      values_dtype
-00015f40: 203d 206e 756d 2e76 616c 7565 732e 6474   = num.values.dt
-00015f50: 7970 650a 2020 2020 2020 2020 6172 7261  ype.        arra
-00015f60: 795f 7661 6c75 6573 203d 206e 756d 2e76  y_values = num.v
-00015f70: 616c 7565 730a 0a20 2020 2020 2020 2069  alues..        i
-00015f80: 6620 6e6f 7420 6e70 2e69 7373 7562 6474  f not np.issubdt
-00015f90: 7970 6528 7661 6c75 6573 5f64 7479 7065  ype(values_dtype
-00015fa0: 2c20 6e70 2e6e 756d 6265 7229 3a0a 2020  , np.number):.  
-00015fb0: 2020 2020 2020 2020 2020 6172 7261 795f            array_
-00015fc0: 7661 6c75 6573 203d 206e 756d 2e76 616c  values = num.val
-00015fd0: 7565 732e 6173 7479 7065 2822 6638 2229  ues.astype("f8")
-00015fe0: 0a0a 2020 2020 2020 2020 7661 7220 3d20  ..        var = 
-00015ff0: 6461 2e6e 616e 7661 7220 6966 2073 6b69  da.nanvar if ski
-00016000: 706e 6120 6f72 2073 6b69 706e 6120 6973  pna or skipna is
-00016010: 204e 6f6e 6520 656c 7365 2064 612e 7661   None else da.va
-00016020: 720a 2020 2020 2020 2020 6172 7261 795f  r.        array_
-00016030: 7661 7220 3d20 7661 7228 6172 7261 795f  var = var(array_
-00016040: 7661 6c75 6573 2c20 6178 6973 3d30 2c20  values, axis=0, 
-00016050: 6464 6f66 3d64 646f 662c 2073 706c 6974  ddof=ddof, split
-00016060: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00016070: 7279 290a 0a20 2020 2020 2020 206e 616d  ry)..        nam
-00016080: 6520 3d20 7365 6c66 2e5f 746f 6b65 6e5f  e = self._token_
-00016090: 7072 6566 6978 202b 2022 7661 722d 6e75  prefix + "var-nu
-000160a0: 6d65 7269 6322 202b 2074 6f6b 656e 697a  meric" + tokeniz
-000160b0: 6528 6e75 6d2c 2073 706c 6974 5f65 7665  e(num, split_eve
-000160c0: 7279 290a 2020 2020 2020 2020 636f 6c73  ry).        cols
-000160d0: 203d 206e 756d 2e5f 6d65 7461 2e63 6f6c   = num._meta.col
-000160e0: 756d 6e73 2069 6620 6973 5f64 6174 6166  umns if is_dataf
-000160f0: 7261 6d65 5f6c 696b 6528 6e75 6d29 2065  rame_like(num) e
-00016100: 6c73 6520 4e6f 6e65 0a0a 2020 2020 2020  lse None..      
-00016110: 2020 7769 7468 2063 6865 636b 5f72 6564    with check_red
-00016120: 7563 7469 6f6e 735f 7275 6e74 696d 655f  uctions_runtime_
-00016130: 7761 726e 696e 6728 293a 0a20 2020 2020  warning():.     
-00016140: 2020 2020 2020 206d 6574 615f 636f 6d70         meta_comp
-00016150: 7574 6174 696f 6e20 3d20 6e75 6d2e 5f6d  utation = num._m
-00016160: 6574 615f 6e6f 6e65 6d70 7479 2e76 6172  eta_nonempty.var
-00016170: 2861 7869 733d 3029 0a20 2020 2020 2020  (axis=0).       
-00016180: 2076 6172 5f73 6861 7065 203d 206d 6574   var_shape = met
-00016190: 615f 636f 6d70 7574 6174 696f 6e2e 7368  a_computation.sh
-000161a0: 6170 650a 2020 2020 2020 2020 6172 7261  ape.        arra
-000161b0: 795f 7661 725f 6e61 6d65 203d 2028 6172  y_var_name = (ar
-000161c0: 7261 795f 7661 722e 5f6e 616d 652c 2920  ray_var._name,) 
-000161d0: 2b20 2830 2c29 202a 206c 656e 2876 6172  + (0,) * len(var
-000161e0: 5f73 6861 7065 290a 0a20 2020 2020 2020  _shape)..       
-000161f0: 206c 6179 6572 203d 207b 286e 616d 652c   layer = {(name,
-00016200: 2030 293a 2028 6d65 7468 6f64 732e 7772   0): (methods.wr
-00016210: 6170 5f76 6172 5f72 6564 7563 7469 6f6e  ap_var_reduction
-00016220: 2c20 6172 7261 795f 7661 725f 6e61 6d65  , array_var_name
-00016230: 2c20 636f 6c73 297d 0a20 2020 2020 2020  , cols)}.       
-00016240: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
-00016250: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
-00016260: 6c65 6374 696f 6e73 286e 616d 652c 206c  lections(name, l
-00016270: 6179 6572 2c20 6465 7065 6e64 656e 6369  ayer, dependenci
-00016280: 6573 3d5b 6172 7261 795f 7661 725d 290a  es=[array_var]).
-00016290: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000162a0: 6e65 775f 6464 5f6f 626a 6563 7428 6772  new_dd_object(gr
-000162b0: 6170 682c 206e 616d 652c 206d 6574 615f  aph, name, meta_
-000162c0: 636f 6d70 7574 6174 696f 6e2c 2064 6976  computation, div
-000162d0: 6973 696f 6e73 3d5b 4e6f 6e65 2c20 4e6f  isions=[None, No
-000162e0: 6e65 5d29 0a0a 2020 2020 6465 6620 5f76  ne])..    def _v
-000162f0: 6172 5f31 6428 7365 6c66 2c20 636f 6c75  ar_1d(self, colu
-00016300: 6d6e 2c20 736b 6970 6e61 3d54 7275 652c  mn, skipna=True,
-00016310: 2064 646f 663d 312c 2073 706c 6974 5f65   ddof=1, split_e
-00016320: 7665 7279 3d46 616c 7365 293a 0a20 2020  very=False):.   
-00016330: 2020 2020 2069 735f 7469 6d65 6465 6c74       is_timedelt
-00016340: 6120 3d20 6973 5f74 696d 6564 656c 7461  a = is_timedelta
-00016350: 3634 5f64 7479 7065 2863 6f6c 756d 6e2e  64_dtype(column.
-00016360: 5f6d 6574 6129 0a0a 2020 2020 2020 2020  _meta)..        
-00016370: 6966 2069 735f 7469 6d65 6465 6c74 613a  if is_timedelta:
-00016380: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016390: 6e6f 7420 736b 6970 6e61 3a0a 2020 2020  not skipna:.    
-000163a0: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
-000163b0: 616e 203d 2063 6f6c 756d 6e2e 6973 6e61  an = column.isna
-000163c0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-000163d0: 2020 2063 6f6c 756d 6e20 3d20 636f 6c75     column = colu
-000163e0: 6d6e 2e61 7374 7970 6528 2269 3822 290a  mn.astype("i8").
-000163f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016400: 636f 6c75 6d6e 203d 2063 6f6c 756d 6e2e  column = column.
-00016410: 6d61 736b 2869 735f 6e61 6e29 0a20 2020  mask(is_nan).   
-00016420: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00016430: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00016440: 6f6c 756d 6e20 3d20 636f 6c75 6d6e 2e64  olumn = column.d
-00016450: 726f 706e 6128 292e 6173 7479 7065 2822  ropna().astype("
-00016460: 6938 2229 0a0a 2020 2020 2020 2020 6966  i8")..        if
-00016470: 2070 642e 6170 692e 7479 7065 732e 6973   pd.api.types.is
-00016480: 5f65 7874 656e 7369 6f6e 5f61 7272 6179  _extension_array
-00016490: 5f64 7479 7065 2863 6f6c 756d 6e2e 5f6d  _dtype(column._m
-000164a0: 6574 615f 6e6f 6e65 6d70 7479 293a 0a20  eta_nonempty):. 
-000164b0: 2020 2020 2020 2020 2020 2023 2044 6f6e             # Don
-000164c0: 2774 2068 6176 6520 746f 2077 6f72 7279  't have to worry
-000164d0: 2061 626f 7574 206e 6f6e 2d6e 756d 6572   about non-numer
-000164e0: 6963 2c20 7468 6973 2072 6169 7365 7320  ic, this raises 
-000164f0: 6561 726c 6965 720a 2020 2020 2020 2020  earlier.        
-00016500: 2020 2020 636f 6c75 6d6e 203d 2063 6f6c      column = col
-00016510: 756d 6e2e 6173 7479 7065 2822 6638 2229  umn.astype("f8")
-00016520: 0a0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
-00016530: 6f74 206e 702e 6973 7375 6264 7479 7065  ot np.issubdtype
-00016540: 2863 6f6c 756d 6e2e 6474 7970 652c 206e  (column.dtype, n
-00016550: 702e 6e75 6d62 6572 293a 0a20 2020 2020  p.number):.     
-00016560: 2020 2020 2020 2063 6f6c 756d 6e20 3d20         column = 
-00016570: 636f 6c75 6d6e 2e61 7374 7970 6528 2266  column.astype("f
-00016580: 3822 290a 0a20 2020 2020 2020 206e 616d  8")..        nam
-00016590: 6520 3d20 7365 6c66 2e5f 746f 6b65 6e5f  e = self._token_
-000165a0: 7072 6566 6978 202b 2022 7661 722d 3164  prefix + "var-1d
-000165b0: 2d22 202b 2074 6f6b 656e 697a 6528 636f  -" + tokenize(co
-000165c0: 6c75 6d6e 2c20 7370 6c69 745f 6576 6572  lumn, split_ever
-000165d0: 7929 0a0a 2020 2020 2020 2020 7661 7220  y)..        var 
-000165e0: 3d20 6461 2e6e 616e 7661 7220 6966 2073  = da.nanvar if s
-000165f0: 6b69 706e 6120 6f72 2073 6b69 706e 6120  kipna or skipna 
-00016600: 6973 204e 6f6e 6520 656c 7365 2064 612e  is None else da.
-00016610: 7661 720a 2020 2020 2020 2020 6172 7261  var.        arra
-00016620: 795f 7661 7220 3d20 7661 7228 636f 6c75  y_var = var(colu
-00016630: 6d6e 2e76 616c 7565 732c 2061 7869 733d  mn.values, axis=
-00016640: 302c 2064 646f 663d 6464 6f66 2c20 7370  0, ddof=ddof, sp
-00016650: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00016660: 6576 6572 7929 0a0a 2020 2020 2020 2020  every)..        
-00016670: 6c61 7965 7220 3d20 7b28 6e61 6d65 2c20  layer = {(name, 
-00016680: 3029 3a20 286d 6574 686f 6473 2e77 7261  0): (methods.wra
-00016690: 705f 7661 725f 7265 6475 6374 696f 6e2c  p_var_reduction,
-000166a0: 2028 6172 7261 795f 7661 722e 5f6e 616d   (array_var._nam
-000166b0: 652c 292c 204e 6f6e 6529 7d0a 2020 2020  e,), None)}.    
-000166c0: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-000166d0: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-000166e0: 636f 6c6c 6563 7469 6f6e 7328 6e61 6d65  collections(name
-000166f0: 2c20 6c61 7965 722c 2064 6570 656e 6465  , layer, depende
-00016700: 6e63 6965 733d 5b61 7272 6179 5f76 6172  ncies=[array_var
-00016710: 5d29 0a0a 2020 2020 2020 2020 7265 7475  ])..        retu
-00016720: 726e 206e 6577 5f64 645f 6f62 6a65 6374  rn new_dd_object
-00016730: 280a 2020 2020 2020 2020 2020 2020 6772  (.            gr
-00016740: 6170 682c 206e 616d 652c 2063 6f6c 756d  aph, name, colum
-00016750: 6e2e 5f6d 6574 615f 6e6f 6e65 6d70 7479  n._meta_nonempty
-00016760: 2e76 6172 2829 2c20 6469 7669 7369 6f6e  .var(), division
-00016770: 733d 5b4e 6f6e 652c 204e 6f6e 655d 0a20  s=[None, None]. 
-00016780: 2020 2020 2020 2029 0a0a 2020 2020 405f         )..    @_
-00016790: 6e75 6d65 7269 635f 6461 7461 0a20 2020  numeric_data.   
-000167a0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-000167b0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-000167c0: 2064 6566 2073 7464 280a 2020 2020 2020   def std(.      
-000167d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000167e0: 6178 6973 3d4e 6f6e 652c 0a20 2020 2020  axis=None,.     
-000167f0: 2020 2073 6b69 706e 613d 5472 7565 2c0a     skipna=True,.
-00016800: 2020 2020 2020 2020 6464 6f66 3d31 2c0a          ddof=1,.
-00016810: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
-00016820: 6572 793d 4661 6c73 652c 0a20 2020 2020  ery=False,.     
-00016830: 2020 2064 7479 7065 3d4e 6f6e 652c 0a20     dtype=None,. 
-00016840: 2020 2020 2020 206f 7574 3d4e 6f6e 652c         out=None,
-00016850: 0a20 2020 2020 2020 206e 756d 6572 6963  .        numeric
-00016860: 5f6f 6e6c 793d 6e6f 5f64 6566 6175 6c74  _only=no_default
-00016870: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00016880: 2061 7869 7320 3d20 7365 6c66 2e5f 7661   axis = self._va
-00016890: 6c69 6461 7465 5f61 7869 7328 6178 6973  lidate_axis(axis
-000168a0: 290a 2020 2020 2020 2020 5f72 6169 7365  ).        _raise
-000168b0: 5f69 665f 6f62 6a65 6374 5f73 6572 6965  _if_object_serie
-000168c0: 7328 7365 6c66 2c20 2273 7464 2229 0a20  s(self, "std"). 
-000168d0: 2020 2020 2020 205f 7261 6973 655f 6966         _raise_if
-000168e0: 5f6e 6f74 5f73 6572 6965 735f 6f72 5f64  _not_series_or_d
-000168f0: 6174 6166 7261 6d65 2873 656c 662c 2022  ataframe(self, "
-00016900: 7374 6422 290a 2020 2020 2020 2020 6e75  std").        nu
-00016910: 6d65 7269 635f 6b77 6172 6773 203d 2067  meric_kwargs = g
-00016920: 6574 5f6e 756d 6572 6963 5f6f 6e6c 795f  et_numeric_only_
-00016930: 6b77 6172 6773 286e 756d 6572 6963 5f6f  kwargs(numeric_o
-00016940: 6e6c 7929 0a0a 2020 2020 2020 2020 7769  nly)..        wi
-00016950: 7468 2063 6865 636b 5f6e 756d 6572 6963  th check_numeric
-00016960: 5f6f 6e6c 795f 6465 7072 6563 6174 696f  _only_deprecatio
-00016970: 6e28 0a20 2020 2020 2020 2020 2020 2022  n(.            "
-00016980: 7374 6422 2c20 5472 7565 0a20 2020 2020  std", True.     
-00016990: 2020 2029 2c20 6368 6563 6b5f 7265 6475     ), check_redu
-000169a0: 6374 696f 6e73 5f72 756e 7469 6d65 5f77  ctions_runtime_w
-000169b0: 6172 6e69 6e67 2829 3a0a 2020 2020 2020  arning():.      
-000169c0: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
-000169d0: 662e 5f6d 6574 615f 6e6f 6e65 6d70 7479  f._meta_nonempty
-000169e0: 2e73 7464 2861 7869 733d 6178 6973 2c20  .std(axis=axis, 
-000169f0: 736b 6970 6e61 3d73 6b69 706e 612c 202a  skipna=skipna, *
-00016a00: 2a6e 756d 6572 6963 5f6b 7761 7267 7329  *numeric_kwargs)
-00016a10: 0a20 2020 2020 2020 2069 735f 6466 5f6c  .        is_df_l
-00016a20: 696b 6520 3d20 6973 5f64 6174 6166 7261  ike = is_datafra
-00016a30: 6d65 5f6c 696b 6528 7365 6c66 2e5f 6d65  me_like(self._me
-00016a40: 7461 290a 2020 2020 2020 2020 6e65 6564  ta).        need
-00016a50: 735f 7469 6d65 5f63 6f6e 7665 7273 696f  s_time_conversio
-00016a60: 6e20 3d20 4661 6c73 650a 2020 2020 2020  n = False.      
-00016a70: 2020 6e75 6d65 7269 635f 6464 203d 2073    numeric_dd = s
-00016a80: 656c 660a 0a20 2020 2020 2020 2069 6620  elf..        if 
-00016a90: 6973 5f64 665f 6c69 6b65 3a0a 2020 2020  is_df_like:.    
-00016aa0: 2020 2020 2020 2020 7469 6d65 5f63 6f6c          time_col
-00016ab0: 7320 3d20 7365 6c66 2e5f 6d65 7461 2e73  s = self._meta.s
-00016ac0: 656c 6563 745f 6474 7970 6573 280a 2020  elect_dtypes(.  
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00016ae0: 636c 7564 653d 5b22 6461 7465 7469 6d65  clude=["datetime
-00016af0: 222c 2022 7469 6d65 6465 6c74 6122 5d0a  ", "timedelta"].
-00016b00: 2020 2020 2020 2020 2020 2020 292e 636f              ).co
-00016b10: 6c75 6d6e 730a 2020 2020 2020 2020 2020  lumns.          
-00016b20: 2020 6966 206c 656e 2874 696d 655f 636f    if len(time_co
-00016b30: 6c73 2920 3e20 303a 0a20 2020 2020 2020  ls) > 0:.       
-00016b40: 2020 2020 2020 2020 2028 0a20 2020 2020           (.     
-00016b50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016b60: 756d 6572 6963 5f64 642c 0a20 2020 2020  umeric_dd,.     
-00016b70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00016b80: 6565 6473 5f74 696d 655f 636f 6e76 6572  eeds_time_conver
-00016b90: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
-00016ba0: 2020 2020 2020 2920 3d20 7365 6c66 2e5f        ) = self._
-00016bb0: 636f 6e76 6572 745f 7469 6d65 5f63 6f6c  convert_time_col
-00016bc0: 735f 746f 5f6e 756d 6572 6963 2874 696d  s_to_numeric(tim
-00016bd0: 655f 636f 6c73 2c20 6178 6973 2c20 6d65  e_cols, axis, me
-00016be0: 7461 2c20 736b 6970 6e61 290a 2020 2020  ta, skipna).    
-00016bf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00016c00: 2020 2020 2020 6e65 6564 735f 7469 6d65        needs_time
-00016c10: 5f63 6f6e 7665 7273 696f 6e20 3d20 6973  _conversion = is
-00016c20: 5f64 6174 6574 696d 6536 345f 616e 795f  _datetime64_any_
-00016c30: 6474 7970 6528 7365 6c66 2e5f 6d65 7461  dtype(self._meta
-00016c40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00016c50: 206e 6565 6473 5f74 696d 655f 636f 6e76   needs_time_conv
-00016c60: 6572 7369 6f6e 3a0a 2020 2020 2020 2020  ersion:.        
-00016c70: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
-00016c80: 6464 203d 205f 636f 6e76 6572 745f 746f  dd = _convert_to
-00016c90: 5f6e 756d 6572 6963 2873 656c 662c 2073  _numeric(self, s
-00016ca0: 6b69 706e 6129 0a0a 2020 2020 2020 2020  kipna)..        
-00016cb0: 6966 2061 7869 7320 3d3d 2031 3a0a 2020  if axis == 1:.  
-00016cc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00016cd0: 203d 206d 6170 5f70 6172 7469 7469 6f6e   = map_partition
-00016ce0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00016cf0: 2020 204d 2e73 7464 2069 6620 6e6f 7420     M.std if not 
-00016d00: 6e65 6564 735f 7469 6d65 5f63 6f6e 7665  needs_time_conve
-00016d10: 7273 696f 6e20 656c 7365 205f 7371 7274  rsion else _sqrt
-00016d20: 5f61 6e64 5f63 6f6e 7665 7274 5f74 6f5f  _and_convert_to_
-00016d30: 7469 6d65 6465 6c74 612c 0a20 2020 2020  timedelta,.     
-00016d40: 2020 2020 2020 2020 2020 206e 756d 6572             numer
-00016d50: 6963 5f64 642c 0a20 2020 2020 2020 2020  ic_dd,.         
-00016d60: 2020 2020 2020 206d 6574 613d 6d65 7461         meta=meta
-00016d70: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016d80: 2020 746f 6b65 6e3d 7365 6c66 2e5f 746f    token=self._to
-00016d90: 6b65 6e5f 7072 6566 6978 202b 2022 7374  ken_prefix + "st
-00016da0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00016db0: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
-00016dc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016dd0: 6b69 706e 613d 736b 6970 6e61 2c0a 2020  kipna=skipna,.  
-00016de0: 2020 2020 2020 2020 2020 2020 2020 6464                dd
-00016df0: 6f66 3d64 646f 662c 0a20 2020 2020 2020  of=ddof,.       
-00016e00: 2020 2020 2020 2020 2065 6e66 6f72 6365           enforce
-00016e10: 5f6d 6574 6164 6174 613d 4661 6c73 652c  _metadata=False,
-00016e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016e30: 202a 2a6e 756d 6572 6963 5f6b 7761 7267   **numeric_kwarg
-00016e40: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00016e50: 2020 2070 6172 656e 745f 6d65 7461 3d73     parent_meta=s
-00016e60: 656c 662e 5f6d 6574 612c 0a20 2020 2020  elf._meta,.     
-00016e70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00016e80: 2020 2020 2072 6574 7572 6e20 6861 6e64       return hand
-00016e90: 6c65 5f6f 7574 286f 7574 2c20 7265 7375  le_out(out, resu
-00016ea0: 6c74 290a 0a20 2020 2020 2020 2023 2043  lt)..        # C
-00016eb0: 6173 6520 7768 6572 6520 6178 6973 3d30  ase where axis=0
-00016ec0: 206f 7220 6178 6973 3d4e 6f6e 650a 2020   or axis=None.  
-00016ed0: 2020 2020 2020 7620 3d20 6e75 6d65 7269        v = numeri
-00016ee0: 635f 6464 2e76 6172 2873 6b69 706e 613d  c_dd.var(skipna=
-00016ef0: 736b 6970 6e61 2c20 6464 6f66 3d64 646f  skipna, ddof=ddo
-00016f00: 662c 2073 706c 6974 5f65 7665 7279 3d73  f, split_every=s
-00016f10: 706c 6974 5f65 7665 7279 290a 2020 2020  plit_every).    
-00016f20: 2020 2020 6e61 6d65 203d 2073 656c 662e      name = self.
-00016f30: 5f74 6f6b 656e 5f70 7265 6669 7820 2b20  _token_prefix + 
-00016f40: 2273 7464 220a 0a20 2020 2020 2020 2069  "std"..        i
-00016f50: 6620 6e65 6564 735f 7469 6d65 5f63 6f6e  f needs_time_con
-00016f60: 7665 7273 696f 6e3a 0a20 2020 2020 2020  version:.       
-00016f70: 2020 2020 2073 7172 745f 6675 6e63 5f6b       sqrt_func_k
-00016f80: 7761 7267 7320 3d20 7b0a 2020 2020 2020  wargs = {.      
-00016f90: 2020 2020 2020 2020 2020 2269 735f 6466            "is_df
-00016fa0: 5f6c 696b 6522 3a20 6973 5f64 665f 6c69  _like": is_df_li
-00016fb0: 6b65 2c0a 2020 2020 2020 2020 2020 2020  ke,.            
-00016fc0: 2020 2020 2274 696d 655f 636f 6c73 223a      "time_cols":
-00016fd0: 2074 696d 655f 636f 6c73 2069 6620 6973   time_cols if is
-00016fe0: 5f64 665f 6c69 6b65 2065 6c73 6520 4e6f  _df_like else No
-00016ff0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00017000: 2020 2020 2261 7869 7322 3a20 6178 6973      "axis": axis
+00012710: 7375 6c74 203d 2073 656c 662e 7265 6475  sult = self.redu
+00012720: 6374 696f 6e28 0a20 2020 2020 2020 2020  ction(.         
+00012730: 2020 2020 2020 205f 6765 7461 7474 725f         _getattr_
+00012740: 6e75 6d65 7269 635f 6f6e 6c79 2c0a 2020  numeric_only,.  
+00012750: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00012760: 7461 3d6d 6574 612c 0a20 2020 2020 2020  ta=meta,.       
+00012770: 2020 2020 2020 2020 2074 6f6b 656e 3d74           token=t
+00012780: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
+00012790: 2020 2020 2020 736b 6970 6e61 3d73 6b69        skipna=ski
+000127a0: 706e 612c 0a20 2020 2020 2020 2020 2020  pna,.           
+000127b0: 2020 2020 2061 7869 733d 6178 6973 2c0a       axis=axis,.
+000127c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127d0: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
+000127e0: 745f 6576 6572 792c 0a20 2020 2020 2020  t_every,.       
+000127f0: 2020 2020 2020 2020 205f 6461 736b 5f6d           _dask_m
+00012800: 6574 686f 645f 6e61 6d65 3d6e 616d 652c  ethod_name=name,
+00012810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012820: 202a 2a6e 756d 6572 6963 5f6f 6e6c 795f   **numeric_only_
+00012830: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+00012840: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00012850: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00012860: 7365 6c66 2c20 4461 7461 4672 616d 6529  self, DataFrame)
+00012870: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00012880: 7265 7375 6c74 2c20 5365 7269 6573 293a  result, Series):
+00012890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000128a0: 2072 6573 756c 742e 6469 7669 7369 6f6e   result.division
+000128b0: 7320 3d20 2873 656c 662e 636f 6c75 6d6e  s = (self.column
+000128c0: 732e 6d69 6e28 292c 2073 656c 662e 636f  s.min(), self.co
+000128d0: 6c75 6d6e 732e 6d61 7828 2929 0a20 2020  lumns.max()).   
+000128e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000128f0: 6861 6e64 6c65 5f6f 7574 286f 7574 2c20  handle_out(out, 
+00012900: 7265 7375 6c74 290a 0a20 2020 2040 6465  result)..    @de
+00012910: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+00012920: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+00012930: 2061 6464 5f70 7265 6669 7828 7365 6c66   add_prefix(self
+00012940: 2c20 7072 6566 6978 293a 0a20 2020 2020  , prefix):.     
+00012950: 2020 2072 6573 203d 2073 656c 662e 6d61     res = self.ma
+00012960: 705f 7061 7274 6974 696f 6e73 284d 2e61  p_partitions(M.a
+00012970: 6464 5f70 7265 6669 782c 2070 7265 6669  dd_prefix, prefi
+00012980: 7829 0a20 2020 2020 2020 2069 6620 7365  x).        if se
+00012990: 6c66 2e6b 6e6f 776e 5f64 6976 6973 696f  lf.known_divisio
+000129a0: 6e73 2061 6e64 2069 735f 7365 7269 6573  ns and is_series
+000129b0: 5f6c 696b 6528 7365 6c66 293a 0a20 2020  _like(self):.   
+000129c0: 2020 2020 2020 2020 2072 6573 2e64 6976           res.div
+000129d0: 6973 696f 6e73 203d 2074 7570 6c65 2870  isions = tuple(p
+000129e0: 7265 6669 7820 2b20 7374 7228 6469 7669  refix + str(divi
+000129f0: 7369 6f6e 2920 666f 7220 6469 7669 7369  sion) for divisi
+00012a00: 6f6e 2069 6e20 7365 6c66 2e64 6976 6973  on in self.divis
+00012a10: 696f 6e73 290a 2020 2020 2020 2020 7265  ions).        re
+00012a20: 7475 726e 2072 6573 0a0a 2020 2020 4064  turn res..    @d
+00012a30: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+00012a40: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+00012a50: 6620 6164 645f 7375 6666 6978 2873 656c  f add_suffix(sel
+00012a60: 662c 2073 7566 6669 7829 3a0a 2020 2020  f, suffix):.    
+00012a70: 2020 2020 7265 7320 3d20 7365 6c66 2e6d      res = self.m
+00012a80: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+00012a90: 6164 645f 7375 6666 6978 2c20 7375 6666  add_suffix, suff
+00012aa0: 6978 290a 2020 2020 2020 2020 6966 2073  ix).        if s
+00012ab0: 656c 662e 6b6e 6f77 6e5f 6469 7669 7369  elf.known_divisi
+00012ac0: 6f6e 7320 616e 6420 6973 5f73 6572 6965  ons and is_serie
+00012ad0: 735f 6c69 6b65 2873 656c 6629 3a0a 2020  s_like(self):.  
+00012ae0: 2020 2020 2020 2020 2020 7265 732e 6469            res.di
+00012af0: 7669 7369 6f6e 7320 3d20 7475 706c 6528  visions = tuple(
+00012b00: 7374 7228 6469 7669 7369 6f6e 2920 2b20  str(division) + 
+00012b10: 7375 6666 6978 2066 6f72 2064 6976 6973  suffix for divis
+00012b20: 696f 6e20 696e 2073 656c 662e 6469 7669  ion in self.divi
+00012b30: 7369 6f6e 7329 0a20 2020 2020 2020 2072  sions).        r
+00012b40: 6574 7572 6e20 7265 730a 0a20 2020 2040  eturn res..    @
+00012b50: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+00012b60: 4461 7461 4672 616d 6529 0a20 2020 2064  DataFrame).    d
+00012b70: 6566 2061 6273 2873 656c 6629 3a0a 2020  ef abs(self):.  
+00012b80: 2020 2020 2020 5f72 6169 7365 5f69 665f        _raise_if_
+00012b90: 6f62 6a65 6374 5f73 6572 6965 7328 7365  object_series(se
+00012ba0: 6c66 2c20 2261 6273 2229 0a20 2020 2020  lf, "abs").     
+00012bb0: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
+00012bc0: 6d65 7461 5f6e 6f6e 656d 7074 792e 6162  meta_nonempty.ab
+00012bd0: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
+00012be0: 726e 2073 656c 662e 6d61 705f 7061 7274  rn self.map_part
+00012bf0: 6974 696f 6e73 284d 2e61 6273 2c20 6d65  itions(M.abs, me
+00012c00: 7461 3d6d 6574 612c 2065 6e66 6f72 6365  ta=meta, enforce
+00012c10: 5f6d 6574 6164 6174 613d 4661 6c73 6529  _metadata=False)
+00012c20: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+00012c30: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
+00012c40: 290a 2020 2020 6465 6620 616c 6c28 7365  ).    def all(se
+00012c50: 6c66 2c20 6178 6973 3d4e 6f6e 652c 2073  lf, axis=None, s
+00012c60: 6b69 706e 613d 5472 7565 2c20 7370 6c69  kipna=True, spli
+00012c70: 745f 6576 6572 793d 4661 6c73 652c 206f  t_every=False, o
+00012c80: 7574 3d4e 6f6e 6529 3a0a 2020 2020 2020  ut=None):.      
+00012c90: 2020 7265 7475 726e 2073 656c 662e 5f72    return self._r
+00012ca0: 6564 7563 7469 6f6e 5f61 6767 280a 2020  eduction_agg(.  
+00012cb0: 2020 2020 2020 2020 2020 2261 6c6c 222c            "all",
+00012cc0: 2061 7869 733d 6178 6973 2c20 736b 6970   axis=axis, skip
+00012cd0: 6e61 3d73 6b69 706e 612c 2073 706c 6974  na=skipna, split
+00012ce0: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
+00012cf0: 7279 2c20 6f75 743d 6f75 740a 2020 2020  ry, out=out.    
+00012d00: 2020 2020 290a 0a20 2020 2040 6465 7269      )..    @deri
+00012d10: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
+00012d20: 4672 616d 6529 0a20 2020 2064 6566 2061  Frame).    def a
+00012d30: 6e79 2873 656c 662c 2061 7869 733d 4e6f  ny(self, axis=No
+00012d40: 6e65 2c20 736b 6970 6e61 3d54 7275 652c  ne, skipna=True,
+00012d50: 2073 706c 6974 5f65 7665 7279 3d46 616c   split_every=Fal
+00012d60: 7365 2c20 6f75 743d 4e6f 6e65 293a 0a20  se, out=None):. 
+00012d70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00012d80: 6c66 2e5f 7265 6475 6374 696f 6e5f 6167  lf._reduction_ag
+00012d90: 6728 0a20 2020 2020 2020 2020 2020 2022  g(.            "
+00012da0: 616e 7922 2c20 6178 6973 3d61 7869 732c  any", axis=axis,
+00012db0: 2073 6b69 706e 613d 736b 6970 6e61 2c20   skipna=skipna, 
+00012dc0: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
+00012dd0: 745f 6576 6572 792c 206f 7574 3d6f 7574  t_every, out=out
+00012de0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00012df0: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
+00012e00: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
+00012e10: 6465 6620 7375 6d28 0a20 2020 2020 2020  def sum(.       
+00012e20: 2073 656c 662c 0a20 2020 2020 2020 2061   self,.        a
+00012e30: 7869 733d 4e6f 6e65 2c0a 2020 2020 2020  xis=None,.      
+00012e40: 2020 736b 6970 6e61 3d54 7275 652c 0a20    skipna=True,. 
+00012e50: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
+00012e60: 7279 3d46 616c 7365 2c0a 2020 2020 2020  ry=False,.      
+00012e70: 2020 6474 7970 653d 4e6f 6e65 2c0a 2020    dtype=None,.  
+00012e80: 2020 2020 2020 6f75 743d 4e6f 6e65 2c0a        out=None,.
+00012e90: 2020 2020 2020 2020 6d69 6e5f 636f 756e          min_coun
+00012ea0: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
+00012eb0: 6e75 6d65 7269 635f 6f6e 6c79 3d4e 6f6e  numeric_only=Non
+00012ec0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+00012ed0: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+00012ee0: 5f72 6564 7563 7469 6f6e 5f61 6767 280a  _reduction_agg(.
+00012ef0: 2020 2020 2020 2020 2020 2020 2273 756d              "sum
+00012f00: 222c 0a20 2020 2020 2020 2020 2020 2061  ",.            a
+00012f10: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
+00012f20: 2020 2020 2020 736b 6970 6e61 3d73 6b69        skipna=ski
+00012f30: 706e 612c 0a20 2020 2020 2020 2020 2020  pna,.           
+00012f40: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
+00012f50: 6974 5f65 7665 7279 2c0a 2020 2020 2020  it_every,.      
+00012f60: 2020 2020 2020 6f75 743d 6f75 742c 0a20        out=out,. 
+00012f70: 2020 2020 2020 2020 2020 206e 756d 6572             numer
+00012f80: 6963 5f6f 6e6c 793d 6e75 6d65 7269 635f  ic_only=numeric_
+00012f90: 6f6e 6c79 2c0a 2020 2020 2020 2020 290a  only,.        ).
+00012fa0: 2020 2020 2020 2020 6966 206d 696e 5f63          if min_c
+00012fb0: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
+00012fc0: 2020 636f 6e64 203d 2073 656c 662e 6e6f    cond = self.no
+00012fd0: 746e 756c 6c28 292e 7375 6d28 6178 6973  tnull().sum(axis
+00012fe0: 3d61 7869 7329 203e 3d20 6d69 6e5f 636f  =axis) >= min_co
+00012ff0: 756e 740a 2020 2020 2020 2020 2020 2020  unt.            
+00013000: 6966 2069 735f 7365 7269 6573 5f6c 696b  if is_series_lik
+00013010: 6528 636f 6e64 293a 0a20 2020 2020 2020  e(cond):.       
+00013020: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013030: 7265 7375 6c74 2e77 6865 7265 2863 6f6e  result.where(con
+00013040: 642c 206f 7468 6572 3d6e 702e 4e61 4e29  d, other=np.NaN)
+00013050: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00013060: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00013070: 2020 2072 6574 7572 6e20 5f73 6361 6c61     return _scala
+00013080: 725f 6269 6e61 7279 280a 2020 2020 2020  r_binary(.      
+00013090: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+000130a0: 6d62 6461 2078 2c20 793a 2072 6573 756c  mbda x, y: resul
+000130b0: 7420 6966 2078 2069 7320 7920 656c 7365  t if x is y else
+000130c0: 206e 702e 4e61 4e2c 2063 6f6e 642c 2054   np.NaN, cond, T
+000130d0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000130e0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+000130f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00013100: 7265 7475 726e 2072 6573 756c 740a 0a20  return result.. 
+00013110: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+00013120: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
+00013130: 2020 2064 6566 2070 726f 6428 0a20 2020     def prod(.   
+00013140: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00013150: 2020 2061 7869 733d 4e6f 6e65 2c0a 2020     axis=None,.  
+00013160: 2020 2020 2020 736b 6970 6e61 3d54 7275        skipna=Tru
+00013170: 652c 0a20 2020 2020 2020 2073 706c 6974  e,.        split
+00013180: 5f65 7665 7279 3d46 616c 7365 2c0a 2020  _every=False,.  
+00013190: 2020 2020 2020 6474 7970 653d 4e6f 6e65        dtype=None
+000131a0: 2c0a 2020 2020 2020 2020 6f75 743d 4e6f  ,.        out=No
+000131b0: 6e65 2c0a 2020 2020 2020 2020 6d69 6e5f  ne,.        min_
+000131c0: 636f 756e 743d 4e6f 6e65 2c0a 2020 2020  count=None,.    
+000131d0: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
+000131e0: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
+000131f0: 2020 2020 2020 7265 7375 6c74 203d 2073        result = s
+00013200: 656c 662e 5f72 6564 7563 7469 6f6e 5f61  elf._reduction_a
+00013210: 6767 280a 2020 2020 2020 2020 2020 2020  gg(.            
+00013220: 2270 726f 6422 2c0a 2020 2020 2020 2020  "prod",.        
+00013230: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
+00013240: 2020 2020 2020 2020 2020 2073 6b69 706e             skipn
+00013250: 613d 736b 6970 6e61 2c0a 2020 2020 2020  a=skipna,.      
+00013260: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
+00013270: 793d 7370 6c69 745f 6576 6572 792c 0a20  y=split_every,. 
+00013280: 2020 2020 2020 2020 2020 206f 7574 3d6f             out=o
+00013290: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
+000132a0: 6e75 6d65 7269 635f 6f6e 6c79 3d6e 756d  numeric_only=num
+000132b0: 6572 6963 5f6f 6e6c 792c 0a20 2020 2020  eric_only,.     
+000132c0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+000132d0: 6d69 6e5f 636f 756e 743a 0a20 2020 2020  min_count:.     
+000132e0: 2020 2020 2020 2063 6f6e 6420 3d20 7365         cond = se
+000132f0: 6c66 2e6e 6f74 6e75 6c6c 2829 2e73 756d  lf.notnull().sum
+00013300: 2861 7869 733d 6178 6973 2920 3e3d 206d  (axis=axis) >= m
+00013310: 696e 5f63 6f75 6e74 0a20 2020 2020 2020  in_count.       
+00013320: 2020 2020 2069 6620 6973 5f73 6572 6965       if is_serie
+00013330: 735f 6c69 6b65 2863 6f6e 6429 3a0a 2020  s_like(cond):.  
+00013340: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013350: 7475 726e 2072 6573 756c 742e 7768 6572  turn result.wher
+00013360: 6528 636f 6e64 2c20 6f74 6865 723d 6e70  e(cond, other=np
+00013370: 2e4e 614e 290a 2020 2020 2020 2020 2020  .NaN).          
+00013380: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00013390: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+000133a0: 7363 616c 6172 5f62 696e 6172 7928 0a20  scalar_binary(. 
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 206c 616d 6264 6120 782c 2079 3a20     lambda x, y: 
+000133d0: 7265 7375 6c74 2069 6620 7820 6973 2079  result if x is y
+000133e0: 2065 6c73 6520 6e70 2e4e 614e 2c20 636f   else np.NaN, co
+000133f0: 6e64 2c20 5472 7565 0a20 2020 2020 2020  nd, True.       
+00013400: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00013410: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00013420: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00013430: 6c74 0a0a 2020 2020 7072 6f64 7563 7420  lt..    product 
+00013440: 3d20 7072 6f64 2020 2320 616c 6961 7365  = prod  # aliase
+00013450: 6420 6464 2e70 726f 6475 6374 0a0a 2020  d dd.product..  
+00013460: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+00013470: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
+00013480: 2020 6465 6620 6d61 7828 7365 6c66 2c20    def max(self, 
+00013490: 6178 6973 3d30 2c20 736b 6970 6e61 3d54  axis=0, skipna=T
+000134a0: 7275 652c 2073 706c 6974 5f65 7665 7279  rue, split_every
+000134b0: 3d46 616c 7365 2c20 6f75 743d 4e6f 6e65  =False, out=None
+000134c0: 2c20 6e75 6d65 7269 635f 6f6e 6c79 3d4e  , numeric_only=N
+000134d0: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+000134e0: 2028 0a20 2020 2020 2020 2020 2020 2050   (.            P
+000134f0: 414e 4441 535f 4754 5f31 3430 0a20 2020  ANDAS_GT_140.   
+00013500: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00013510: 2050 414e 4441 535f 4754 5f32 3030 0a20   PANDAS_GT_200. 
+00013520: 2020 2020 2020 2020 2020 2061 6e64 2061             and a
+00013530: 7869 7320 6973 204e 6f6e 650a 2020 2020  xis is None.    
+00013540: 2020 2020 2020 2020 616e 6420 6973 696e          and isin
+00013550: 7374 616e 6365 2873 656c 662c 2044 6174  stance(self, Dat
+00013560: 6146 7261 6d65 290a 2020 2020 2020 2020  aFrame).        
+00013570: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
+00013580: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+00013590: 2020 2020 2020 2020 2020 2020 2020 2249                "I
+000135a0: 6e20 6120 6675 7475 7265 2076 6572 7369  n a future versi
+000135b0: 6f6e 2c20 4461 7461 4672 616d 652e 6d61  on, DataFrame.ma
+000135c0: 7828 6178 6973 3d4e 6f6e 6529 2077 696c  x(axis=None) wil
+000135d0: 6c20 7265 7475 726e 2061 2073 6361 6c61  l return a scala
+000135e0: 7220 6d61 7820 6f76 6572 2074 6865 2065  r max over the e
+000135f0: 6e74 6972 6520 4461 7461 4672 616d 652e  ntire DataFrame.
+00013600: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00013610: 2020 2022 546f 2072 6574 6169 6e20 7468     "To retain th
+00013620: 6520 6f6c 6420 6265 6861 7669 6f72 2c20  e old behavior, 
+00013630: 7573 6520 2766 7261 6d65 2e6d 6178 2861  use 'frame.max(a
+00013640: 7869 733d 3029 2720 6f72 206a 7573 7420  xis=0)' or just 
+00013650: 2766 7261 6d65 2e6d 6178 2829 2722 2c0a  'frame.max()'",.
+00013660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013670: 4675 7475 7265 5761 726e 696e 672c 0a20  FutureWarning,. 
+00013680: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00013690: 2020 2020 2020 2020 2061 7869 7320 3d20           axis = 
+000136a0: 300a 0a20 2020 2020 2020 2072 6574 7572  0..        retur
+000136b0: 6e20 7365 6c66 2e5f 7265 6475 6374 696f  n self._reductio
+000136c0: 6e5f 6167 6728 0a20 2020 2020 2020 2020  n_agg(.         
+000136d0: 2020 2022 6d61 7822 2c0a 2020 2020 2020     "max",.      
+000136e0: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
+000136f0: 0a20 2020 2020 2020 2020 2020 2073 6b69  .            ski
+00013700: 706e 613d 736b 6970 6e61 2c0a 2020 2020  pna=skipna,.    
+00013710: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
+00013720: 6572 793d 7370 6c69 745f 6576 6572 792c  ery=split_every,
+00013730: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00013740: 3d6f 7574 2c0a 2020 2020 2020 2020 2020  =out,.          
+00013750: 2020 2320 5374 6172 7469 6e67 2069 6e20    # Starting in 
+00013760: 7061 6e64 6173 2032 2e30 2c20 6061 7869  pandas 2.0, `axi
+00013770: 733d 4e6f 6e65 6020 646f 6573 2061 2066  s=None` does a f
+00013780: 756c 6c20 6167 6772 6567 6174 696f 6e20  ull aggregation 
+00013790: 6163 726f 7373 2062 6f74 6820 6178 6573  across both axes
+000137a0: 0a20 2020 2020 2020 2020 2020 206e 6f6e  .            non
+000137b0: 655f 6973 5f7a 6572 6f3d 6e6f 7420 5041  e_is_zero=not PA
+000137c0: 4e44 4153 5f47 545f 3230 302c 0a20 2020  NDAS_GT_200,.   
+000137d0: 2020 2020 2020 2020 206e 756d 6572 6963           numeric
+000137e0: 5f6f 6e6c 793d 6e75 6d65 7269 635f 6f6e  _only=numeric_on
+000137f0: 6c79 2c0a 2020 2020 2020 2020 290a 0a20  ly,.        ).. 
+00013800: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+00013810: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
+00013820: 2020 2064 6566 206d 696e 2873 656c 662c     def min(self,
+00013830: 2061 7869 733d 302c 2073 6b69 706e 613d   axis=0, skipna=
+00013840: 5472 7565 2c20 7370 6c69 745f 6576 6572  True, split_ever
+00013850: 793d 4661 6c73 652c 206f 7574 3d4e 6f6e  y=False, out=Non
+00013860: 652c 206e 756d 6572 6963 5f6f 6e6c 793d  e, numeric_only=
+00013870: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+00013880: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+00013890: 5041 4e44 4153 5f47 545f 3134 300a 2020  PANDAS_GT_140.  
+000138a0: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
+000138b0: 7420 5041 4e44 4153 5f47 545f 3230 300a  t PANDAS_GT_200.
+000138c0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000138d0: 6178 6973 2069 7320 4e6f 6e65 0a20 2020  axis is None.   
+000138e0: 2020 2020 2020 2020 2061 6e64 2069 7369           and isi
+000138f0: 6e73 7461 6e63 6528 7365 6c66 2c20 4461  nstance(self, Da
+00013900: 7461 4672 616d 6529 0a20 2020 2020 2020  taFrame).       
+00013910: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00013920: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+00013930: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013940: 496e 2061 2066 7574 7572 6520 7665 7273  In a future vers
+00013950: 696f 6e2c 2044 6174 6146 7261 6d65 2e6d  ion, DataFrame.m
+00013960: 696e 2861 7869 733d 4e6f 6e65 2920 7769  in(axis=None) wi
+00013970: 6c6c 2072 6574 7572 6e20 6120 7363 616c  ll return a scal
+00013980: 6172 206d 696e 206f 7665 7220 7468 6520  ar min over the 
+00013990: 656e 7469 7265 2044 6174 6146 7261 6d65  entire DataFrame
+000139a0: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+000139b0: 2020 2020 2254 6f20 7265 7461 696e 2074      "To retain t
+000139c0: 6865 206f 6c64 2062 6568 6176 696f 722c  he old behavior,
+000139d0: 2075 7365 2027 6672 616d 652e 6d69 6e28   use 'frame.min(
+000139e0: 6178 6973 3d30 2927 206f 7220 6a75 7374  axis=0)' or just
+000139f0: 2027 6672 616d 652e 6d69 6e28 2927 222c   'frame.min()'",
+00013a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013a10: 2046 7574 7572 6557 6172 6e69 6e67 2c0a   FutureWarning,.
+00013a20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00013a30: 2020 2020 2020 2020 2020 6178 6973 203d            axis =
+00013a40: 2030 0a0a 2020 2020 2020 2020 7265 7475   0..        retu
+00013a50: 726e 2073 656c 662e 5f72 6564 7563 7469  rn self._reducti
+00013a60: 6f6e 5f61 6767 280a 2020 2020 2020 2020  on_agg(.        
+00013a70: 2020 2020 226d 696e 222c 0a20 2020 2020      "min",.     
+00013a80: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
+00013a90: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
+00013aa0: 6970 6e61 3d73 6b69 706e 612c 0a20 2020  ipna=skipna,.   
+00013ab0: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
+00013ac0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00013ad0: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00013ae0: 743d 6f75 742c 0a20 2020 2020 2020 2020  t=out,.         
+00013af0: 2020 2023 2053 7461 7274 696e 6720 696e     # Starting in
+00013b00: 2070 616e 6461 7320 322e 302c 2060 6178   pandas 2.0, `ax
+00013b10: 6973 3d4e 6f6e 6560 2064 6f65 7320 6120  is=None` does a 
+00013b20: 6675 6c6c 2061 6767 7265 6761 7469 6f6e  full aggregation
+00013b30: 2061 6372 6f73 7320 626f 7468 2061 7865   across both axe
+00013b40: 730a 2020 2020 2020 2020 2020 2020 6e6f  s.            no
+00013b50: 6e65 5f69 735f 7a65 726f 3d6e 6f74 2050  ne_is_zero=not P
+00013b60: 414e 4441 535f 4754 5f32 3030 2c0a 2020  ANDAS_GT_200,.  
+00013b70: 2020 2020 2020 2020 2020 6e75 6d65 7269            numeri
+00013b80: 635f 6f6e 6c79 3d6e 756d 6572 6963 5f6f  c_only=numeric_o
+00013b90: 6e6c 792c 0a20 2020 2020 2020 2029 0a0a  nly,.        )..
+00013ba0: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+00013bb0: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
+00013bc0: 2020 2020 6465 6620 6964 786d 6178 280a      def idxmax(.
+00013bd0: 2020 2020 2020 2020 7365 6c66 2c20 6178          self, ax
+00013be0: 6973 3d4e 6f6e 652c 2073 6b69 706e 613d  is=None, skipna=
+00013bf0: 5472 7565 2c20 7370 6c69 745f 6576 6572  True, split_ever
+00013c00: 793d 4661 6c73 652c 206e 756d 6572 6963  y=False, numeric
+00013c10: 5f6f 6e6c 793d 6e6f 5f64 6566 6175 6c74  _only=no_default
+00013c20: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00013c30: 666e 203d 2022 6964 786d 6178 220a 2020  fn = "idxmax".  
+00013c40: 2020 2020 2020 6178 6973 203d 2073 656c        axis = sel
+00013c50: 662e 5f76 616c 6964 6174 655f 6178 6973  f._validate_axis
+00013c60: 2861 7869 7329 0a20 2020 2020 2020 206e  (axis).        n
+00013c70: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
+00013c80: 6773 203d 2063 6865 636b 5f6e 756d 6572  gs = check_numer
+00013c90: 6963 5f6f 6e6c 795f 7661 6c69 6428 6e75  ic_only_valid(nu
+00013ca0: 6d65 7269 635f 6f6e 6c79 2c20 2269 6478  meric_only, "idx
+00013cb0: 6d61 7822 290a 2020 2020 2020 2020 6d65  max").        me
+00013cc0: 7461 203d 2073 656c 662e 5f6d 6574 615f  ta = self._meta_
+00013cd0: 6e6f 6e65 6d70 7479 2e69 6478 6d61 7828  nonempty.idxmax(
+00013ce0: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
+00013cf0: 733d 6178 6973 2c20 736b 6970 6e61 3d73  s=axis, skipna=s
+00013d00: 6b69 706e 612c 202a 2a6e 756d 6572 6963  kipna, **numeric
+00013d10: 5f6f 6e6c 795f 6b77 6172 6773 0a20 2020  _only_kwargs.   
+00013d20: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00013d30: 6620 6178 6973 203d 3d20 313a 0a20 2020  f axis == 1:.   
+00013d40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013d50: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
+00013d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d70: 4d2e 6964 786d 6178 2c0a 2020 2020 2020  M.idxmax,.      
+00013d80: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00013d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013da0: 6d65 7461 3d6d 6574 612c 0a20 2020 2020  meta=meta,.     
+00013db0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00013dc0: 3d73 656c 662e 5f74 6f6b 656e 5f70 7265  =self._token_pre
+00013dd0: 6669 7820 2b20 666e 2c0a 2020 2020 2020  fix + fn,.      
+00013de0: 2020 2020 2020 2020 2020 736b 6970 6e61            skipna
+00013df0: 3d73 6b69 706e 612c 0a20 2020 2020 2020  =skipna,.       
+00013e00: 2020 2020 2020 2020 2061 7869 733d 6178           axis=ax
+00013e10: 6973 2c0a 2020 2020 2020 2020 2020 2020  is,.            
+00013e20: 2020 2020 656e 666f 7263 655f 6d65 7461      enforce_meta
+00013e30: 6461 7461 3d46 616c 7365 2c0a 2020 2020  data=False,.    
+00013e40: 2020 2020 2020 2020 2020 2020 2a2a 6e75              **nu
+00013e50: 6d65 7269 635f 6f6e 6c79 5f6b 7761 7267  meric_only_kwarg
+00013e60: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
+00013e70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00013e80: 2020 2020 2020 2020 2020 2073 6361 6c61             scala
+00013e90: 7220 3d20 6e6f 7420 6973 5f73 6572 6965  r = not is_serie
+00013ea0: 735f 6c69 6b65 286d 6574 6129 0a20 2020  s_like(meta).   
+00013eb0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00013ec0: 3d20 6163 6128 0a20 2020 2020 2020 2020  = aca(.         
+00013ed0: 2020 2020 2020 205b 7365 6c66 5d2c 0a20         [self],. 
+00013ee0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00013ef0: 6875 6e6b 3d69 6478 6d61 786d 696e 5f63  hunk=idxmaxmin_c
+00013f00: 6875 6e6b 2c0a 2020 2020 2020 2020 2020  hunk,.          
+00013f10: 2020 2020 2020 6167 6772 6567 6174 653d        aggregate=
+00013f20: 6964 786d 6178 6d69 6e5f 6167 672c 0a20  idxmaxmin_agg,. 
+00013f30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00013f40: 6f6d 6269 6e65 3d69 6478 6d61 786d 696e  ombine=idxmaxmin
+00013f50: 5f63 6f6d 6269 6e65 2c0a 2020 2020 2020  _combine,.      
+00013f60: 2020 2020 2020 2020 2020 6d65 7461 3d6d            meta=m
+00013f70: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
+00013f80: 2020 2020 2061 6767 7265 6761 7465 5f6b       aggregate_k
+00013f90: 7761 7267 733d 7b22 7363 616c 6172 223a  wargs={"scalar":
+00013fa0: 2073 6361 6c61 727d 2c0a 2020 2020 2020   scalar},.      
+00013fb0: 2020 2020 2020 2020 2020 746f 6b65 6e3d            token=
+00013fc0: 7365 6c66 2e5f 746f 6b65 6e5f 7072 6566  self._token_pref
+00013fd0: 6978 202b 2066 6e2c 0a20 2020 2020 2020  ix + fn,.       
+00013fe0: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
+00013ff0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00014000: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014010: 2020 736b 6970 6e61 3d73 6b69 706e 612c    skipna=skipna,
+00014020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014030: 2066 6e3d 666e 2c0a 2020 2020 2020 2020   fn=fn,.        
+00014040: 2020 2020 2020 2020 2a2a 6e75 6d65 7269          **numeri
+00014050: 635f 6f6e 6c79 5f6b 7761 7267 732c 0a20  c_only_kwargs,. 
+00014060: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00014070: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00014080: 7374 616e 6365 2873 656c 662c 2044 6174  stance(self, Dat
+00014090: 6146 7261 6d65 293a 0a20 2020 2020 2020  aFrame):.       
+000140a0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
+000140b0: 6469 7669 7369 6f6e 7320 3d20 286d 696e  divisions = (min
+000140c0: 2873 656c 662e 636f 6c75 6d6e 7329 2c20  (self.columns), 
+000140d0: 6d61 7828 7365 6c66 2e63 6f6c 756d 6e73  max(self.columns
+000140e0: 2929 0a20 2020 2020 2020 2020 2020 2072  )).            r
+000140f0: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
+00014100: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+00014110: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
+00014120: 2020 6465 6620 6964 786d 696e 280a 2020    def idxmin(.  
+00014130: 2020 2020 2020 7365 6c66 2c20 6178 6973        self, axis
+00014140: 3d4e 6f6e 652c 2073 6b69 706e 613d 5472  =None, skipna=Tr
+00014150: 7565 2c20 7370 6c69 745f 6576 6572 793d  ue, split_every=
+00014160: 4661 6c73 652c 206e 756d 6572 6963 5f6f  False, numeric_o
+00014170: 6e6c 793d 6e6f 5f64 6566 6175 6c74 0a20  nly=no_default. 
+00014180: 2020 2029 3a0a 2020 2020 2020 2020 666e     ):.        fn
+00014190: 203d 2022 6964 786d 696e 220a 2020 2020   = "idxmin".    
+000141a0: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
+000141b0: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
+000141c0: 7869 7329 0a20 2020 2020 2020 206e 756d  xis).        num
+000141d0: 6572 6963 5f6f 6e6c 795f 6b77 6172 6773  eric_only_kwargs
+000141e0: 203d 2063 6865 636b 5f6e 756d 6572 6963   = check_numeric
+000141f0: 5f6f 6e6c 795f 7661 6c69 6428 6e75 6d65  _only_valid(nume
+00014200: 7269 635f 6f6e 6c79 2c20 2269 6478 6d61  ric_only, "idxma
+00014210: 7822 290a 2020 2020 2020 2020 6d65 7461  x").        meta
+00014220: 203d 2073 656c 662e 5f6d 6574 615f 6e6f   = self._meta_no
+00014230: 6e65 6d70 7479 2e69 6478 6d61 7828 0a20  nempty.idxmax(. 
+00014240: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+00014250: 6178 6973 2c20 736b 6970 6e61 3d73 6b69  axis, skipna=ski
+00014260: 706e 612c 202a 2a6e 756d 6572 6963 5f6f  pna, **numeric_o
+00014270: 6e6c 795f 6b77 6172 6773 0a20 2020 2020  nly_kwargs.     
+00014280: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+00014290: 6178 6973 203d 3d20 313a 0a20 2020 2020  axis == 1:.     
+000142a0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+000142b0: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
+000142c0: 2020 2020 2020 2020 2020 2020 2020 4d2e                M.
+000142d0: 6964 786d 696e 2c0a 2020 2020 2020 2020  idxmin,.        
+000142e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000142f0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+00014300: 7461 3d6d 6574 612c 0a20 2020 2020 2020  ta=meta,.       
+00014310: 2020 2020 2020 2020 2074 6f6b 656e 3d73           token=s
+00014320: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
+00014330: 7820 2b20 666e 2c0a 2020 2020 2020 2020  x + fn,.        
+00014340: 2020 2020 2020 2020 736b 6970 6e61 3d73          skipna=s
+00014350: 6b69 706e 612c 0a20 2020 2020 2020 2020  kipna,.         
+00014360: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
+00014370: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014380: 2020 656e 666f 7263 655f 6d65 7461 6461    enforce_metada
+00014390: 7461 3d46 616c 7365 2c0a 2020 2020 2020  ta=False,.      
+000143a0: 2020 2020 2020 2020 2020 2a2a 6e75 6d65            **nume
+000143b0: 7269 635f 6f6e 6c79 5f6b 7761 7267 732c  ric_only_kwargs,
+000143c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000143d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000143e0: 2020 2020 2020 2020 2073 6361 6c61 7220           scalar 
+000143f0: 3d20 6e6f 7420 6973 5f73 6572 6965 735f  = not is_series_
+00014400: 6c69 6b65 286d 6574 6129 0a20 2020 2020  like(meta).     
+00014410: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00014420: 6163 6128 0a20 2020 2020 2020 2020 2020  aca(.           
+00014430: 2020 2020 205b 7365 6c66 5d2c 0a20 2020       [self],.   
+00014440: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+00014450: 6e6b 3d69 6478 6d61 786d 696e 5f63 6875  nk=idxmaxmin_chu
+00014460: 6e6b 2c0a 2020 2020 2020 2020 2020 2020  nk,.            
+00014470: 2020 2020 6167 6772 6567 6174 653d 6964      aggregate=id
+00014480: 786d 6178 6d69 6e5f 6167 672c 0a20 2020  xmaxmin_agg,.   
+00014490: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000144a0: 6269 6e65 3d69 6478 6d61 786d 696e 5f63  bine=idxmaxmin_c
+000144b0: 6f6d 6269 6e65 2c0a 2020 2020 2020 2020  ombine,.        
+000144c0: 2020 2020 2020 2020 6d65 7461 3d6d 6574          meta=met
+000144d0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+000144e0: 2020 2061 6767 7265 6761 7465 5f6b 7761     aggregate_kwa
+000144f0: 7267 733d 7b22 7363 616c 6172 223a 2073  rgs={"scalar": s
+00014500: 6361 6c61 727d 2c0a 2020 2020 2020 2020  calar},.        
+00014510: 2020 2020 2020 2020 746f 6b65 6e3d 7365          token=se
+00014520: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
+00014530: 202b 2066 6e2c 0a20 2020 2020 2020 2020   + fn,.         
+00014540: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
+00014550: 7279 3d73 706c 6974 5f65 7665 7279 2c0a  ry=split_every,.
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 736b 6970 6e61 3d73 6b69 706e 612c 0a20  skipna=skipna,. 
+00014580: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014590: 6e3d 666e 2c0a 2020 2020 2020 2020 2020  n=fn,.          
+000145a0: 2020 2020 2020 2a2a 6e75 6d65 7269 635f        **numeric_
+000145b0: 6f6e 6c79 5f6b 7761 7267 732c 0a20 2020  only_kwargs,.   
+000145c0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000145d0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000145e0: 616e 6365 2873 656c 662c 2044 6174 6146  ance(self, DataF
+000145f0: 7261 6d65 293a 0a20 2020 2020 2020 2020  rame):.         
+00014600: 2020 2020 2020 2072 6573 756c 742e 6469         result.di
+00014610: 7669 7369 6f6e 7320 3d20 286d 696e 2873  visions = (min(s
+00014620: 656c 662e 636f 6c75 6d6e 7329 2c20 6d61  elf.columns), ma
+00014630: 7828 7365 6c66 2e63 6f6c 756d 6e73 2929  x(self.columns))
+00014640: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014650: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
+00014660: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
+00014670: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
+00014680: 6465 6620 636f 756e 7428 7365 6c66 2c20  def count(self, 
+00014690: 6178 6973 3d4e 6f6e 652c 2073 706c 6974  axis=None, split
+000146a0: 5f65 7665 7279 3d46 616c 7365 2c20 6e75  _every=False, nu
+000146b0: 6d65 7269 635f 6f6e 6c79 3d46 616c 7365  meric_only=False
+000146c0: 293a 0a20 2020 2020 2020 2023 2054 6869  ):.        # Thi
+000146d0: 7320 6d65 7468 6f64 2069 7320 7368 6172  s method is shar
+000146e0: 6564 2062 7920 4461 7461 4672 616d 6520  ed by DataFrame 
+000146f0: 2f20 5365 7269 6573 2c20 6275 7420 6f6e  / Series, but on
+00014700: 6c79 2044 6174 6146 7261 6d65 0a20 2020  ly DataFrame.   
+00014710: 2020 2020 2023 2073 7570 706f 7274 7320       # supports 
+00014720: 606e 756d 6572 6963 5f6f 6e6c 793d 602e  `numeric_only=`.
+00014730: 2048 616e 646c 6520 6163 636f 7264 696e   Handle accordin
+00014740: 676c 7920 6865 7265 2e0a 2020 2020 2020  gly here..      
+00014750: 2020 6e75 6d65 7269 635f 6f6e 6c79 5f6b    numeric_only_k
+00014760: 7761 7267 7320 3d20 7b7d 0a20 2020 2020  wargs = {}.     
+00014770: 2020 2069 6620 6973 5f64 6174 6166 7261     if is_datafra
+00014780: 6d65 5f6c 696b 6528 7365 6c66 293a 0a20  me_like(self):. 
+00014790: 2020 2020 2020 2020 2020 206e 756d 6572             numer
+000147a0: 6963 5f6f 6e6c 795f 6b77 6172 6773 203d  ic_only_kwargs =
+000147b0: 2067 6574 5f6e 756d 6572 6963 5f6f 6e6c   get_numeric_onl
+000147c0: 795f 6b77 6172 6773 286e 756d 6572 6963  y_kwargs(numeric
+000147d0: 5f6f 6e6c 7929 0a20 2020 2020 2020 2061  _only).        a
+000147e0: 7869 7320 3d20 7365 6c66 2e5f 7661 6c69  xis = self._vali
+000147f0: 6461 7465 5f61 7869 7328 6178 6973 290a  date_axis(axis).
+00014800: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
+00014810: 7365 6c66 2e5f 746f 6b65 6e5f 7072 6566  self._token_pref
+00014820: 6978 202b 2022 636f 756e 7422 0a20 2020  ix + "count".   
+00014830: 2020 2020 2069 6620 6178 6973 203d 3d20       if axis == 
+00014840: 313a 0a20 2020 2020 2020 2020 2020 206d  1:.            m
+00014850: 6574 6120 3d20 7365 6c66 2e5f 6d65 7461  eta = self._meta
+00014860: 5f6e 6f6e 656d 7074 792e 636f 756e 7428  _nonempty.count(
+00014870: 6178 6973 3d61 7869 732c 202a 2a6e 756d  axis=axis, **num
+00014880: 6572 6963 5f6f 6e6c 795f 6b77 6172 6773  eric_only_kwargs
+00014890: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000148a0: 7475 726e 2073 656c 662e 6d61 705f 7061  turn self.map_pa
+000148b0: 7274 6974 696f 6e73 280a 2020 2020 2020  rtitions(.      
+000148c0: 2020 2020 2020 2020 2020 4d2e 636f 756e            M.coun
+000148d0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+000148e0: 2020 206d 6574 613d 6d65 7461 2c0a 2020     meta=meta,.  
+000148f0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00014900: 6b65 6e3d 746f 6b65 6e2c 0a20 2020 2020  ken=token,.     
+00014910: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+00014920: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+00014930: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
+00014940: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
+00014950: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
+00014960: 6e75 6d65 7269 635f 6f6e 6c79 5f6b 7761  numeric_only_kwa
+00014970: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
+00014980: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+00014990: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+000149a0: 6120 3d20 7365 6c66 2e5f 6d65 7461 5f6e  a = self._meta_n
+000149b0: 6f6e 656d 7074 792e 636f 756e 7428 290a  onempty.count().
+000149c0: 0a20 2020 2020 2020 2020 2020 2023 204e  .            # N
+000149d0: 6565 6420 7468 6520 6173 7479 7065 2869  eed the astype(i
+000149e0: 6e74 2920 666f 7220 656d 7074 7920 6461  nt) for empty da
+000149f0: 7461 6672 616d 6573 2c20 7768 6963 6820  taframes, which 
+00014a00: 7375 6d20 746f 2066 6c6f 6174 2064 7479  sum to float dty
+00014a10: 7065 0a20 2020 2020 2020 2020 2020 2072  pe.            r
+00014a20: 6573 756c 7420 3d20 7365 6c66 2e72 6564  esult = self.red
+00014a30: 7563 7469 6f6e 280a 2020 2020 2020 2020  uction(.        
+00014a40: 2020 2020 2020 2020 4d2e 636f 756e 742c          M.count,
+00014a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014a60: 2061 6767 7265 6761 7465 3d5f 636f 756e   aggregate=_coun
+00014a70: 745f 6167 6772 6567 6174 652c 0a20 2020  t_aggregate,.   
+00014a80: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00014a90: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
+00014aa0: 2020 2020 2020 2020 746f 6b65 6e3d 746f          token=to
+00014ab0: 6b65 6e2c 0a20 2020 2020 2020 2020 2020  ken,.           
+00014ac0: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
+00014ad0: 3d73 706c 6974 5f65 7665 7279 2c0a 2020  =split_every,.  
+00014ae0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00014af0: 756e 6b5f 6b77 6172 6773 3d6e 756d 6572  unk_kwargs=numer
+00014b00: 6963 5f6f 6e6c 795f 6b77 6172 6773 2c0a  ic_only_kwargs,.
+00014b10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00014b20: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00014b30: 6e73 7461 6e63 6528 7365 6c66 2c20 4461  nstance(self, Da
+00014b40: 7461 4672 616d 6529 3a0a 2020 2020 2020  taFrame):.      
+00014b50: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00014b60: 2e64 6976 6973 696f 6e73 203d 2028 7365  .divisions = (se
+00014b70: 6c66 2e63 6f6c 756d 6e73 2e6d 696e 2829  lf.columns.min()
+00014b80: 2c20 7365 6c66 2e63 6f6c 756d 6e73 2e6d  , self.columns.m
+00014b90: 6178 2829 290a 2020 2020 2020 2020 2020  ax()).          
+00014ba0: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
+00014bb0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+00014bc0: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
+00014bd0: 0a20 2020 2064 6566 206d 6f64 6528 7365  .    def mode(se
+00014be0: 6c66 2c20 6472 6f70 6e61 3d54 7275 652c  lf, dropna=True,
+00014bf0: 2073 706c 6974 5f65 7665 7279 3d46 616c   split_every=Fal
+00014c00: 7365 293a 0a20 2020 2020 2020 206d 6f64  se):.        mod
+00014c10: 655f 7365 7269 6573 203d 2073 656c 662e  e_series = self.
+00014c20: 7265 6475 6374 696f 6e28 0a20 2020 2020  reduction(.     
+00014c30: 2020 2020 2020 2063 6875 6e6b 3d4d 2e76         chunk=M.v
+00014c40: 616c 7565 5f63 6f75 6e74 732c 0a20 2020  alue_counts,.   
+00014c50: 2020 2020 2020 2020 2063 6f6d 6269 6e65           combine
+00014c60: 3d4d 2e73 756d 2c0a 2020 2020 2020 2020  =M.sum,.        
+00014c70: 2020 2020 6167 6772 6567 6174 653d 5f6d      aggregate=_m
+00014c80: 6f64 655f 6167 6772 6567 6174 652c 0a20  ode_aggregate,. 
+00014c90: 2020 2020 2020 2020 2020 2073 706c 6974             split
+00014ca0: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
+00014cb0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+00014cc0: 6368 756e 6b5f 6b77 6172 6773 3d7b 2264  chunk_kwargs={"d
+00014cd0: 726f 706e 6122 3a20 6472 6f70 6e61 7d2c  ropna": dropna},
+00014ce0: 0a20 2020 2020 2020 2020 2020 2061 6767  .            agg
+00014cf0: 7265 6761 7465 5f6b 7761 7267 733d 7b22  regate_kwargs={"
+00014d00: 6472 6f70 6e61 223a 2064 726f 706e 617d  dropna": dropna}
+00014d10: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00014d20: 2020 2020 6d6f 6465 5f73 6572 6965 732e      mode_series.
+00014d30: 6e61 6d65 203d 2073 656c 662e 6e61 6d65  name = self.name
+00014d40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014d50: 6d6f 6465 5f73 6572 6965 730a 0a20 2020  mode_series..   
+00014d60: 2040 5f6e 756d 6572 6963 5f6f 6e6c 790a   @_numeric_only.
+00014d70: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+00014d80: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
+00014d90: 2020 2020 6465 6620 6d65 616e 280a 2020      def mean(.  
+00014da0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00014db0: 2020 2020 6178 6973 3d30 2c0a 2020 2020      axis=0,.    
+00014dc0: 2020 2020 736b 6970 6e61 3d54 7275 652c      skipna=True,
+00014dd0: 0a20 2020 2020 2020 2073 706c 6974 5f65  .        split_e
+00014de0: 7665 7279 3d46 616c 7365 2c0a 2020 2020  very=False,.    
+00014df0: 2020 2020 6474 7970 653d 4e6f 6e65 2c0a      dtype=None,.
+00014e00: 2020 2020 2020 2020 6f75 743d 4e6f 6e65          out=None
+00014e10: 2c0a 2020 2020 2020 2020 6e75 6d65 7269  ,.        numeri
+00014e20: 635f 6f6e 6c79 3d4e 6f6e 652c 0a20 2020  c_only=None,.   
+00014e30: 2029 3a0a 2020 2020 2020 2020 6966 2028   ):.        if (
+00014e40: 0a20 2020 2020 2020 2020 2020 2050 414e  .            PAN
+00014e50: 4441 535f 4754 5f31 3430 0a20 2020 2020  DAS_GT_140.     
+00014e60: 2020 2020 2020 2061 6e64 206e 6f74 2050         and not P
+00014e70: 414e 4441 535f 4754 5f32 3030 0a20 2020  ANDAS_GT_200.   
+00014e80: 2020 2020 2020 2020 2061 6e64 2061 7869           and axi
+00014e90: 7320 6973 204e 6f6e 650a 2020 2020 2020  s is None.      
+00014ea0: 2020 2020 2020 616e 6420 6973 696e 7374        and isinst
+00014eb0: 616e 6365 2873 656c 662c 2044 6174 6146  ance(self, DataF
+00014ec0: 7261 6d65 290a 2020 2020 2020 2020 293a  rame).        ):
+00014ed0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+00014ee0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+00014ef0: 2020 2020 2020 2020 2020 2020 2249 6e20              "In 
+00014f00: 6120 6675 7475 7265 2076 6572 7369 6f6e  a future version
+00014f10: 2c20 4461 7461 4672 616d 652e 6d65 616e  , DataFrame.mean
+00014f20: 2861 7869 733d 4e6f 6e65 2920 7769 6c6c  (axis=None) will
+00014f30: 2072 6574 7572 6e20 6120 7363 616c 6172   return a scalar
+00014f40: 206d 6561 6e20 6f76 6572 2074 6865 2065   mean over the e
+00014f50: 6e74 6972 6520 4461 7461 4672 616d 652e  ntire DataFrame.
+00014f60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00014f70: 2020 2022 546f 2072 6574 6169 6e20 7468     "To retain th
+00014f80: 6520 6f6c 6420 6265 6861 7669 6f72 2c20  e old behavior, 
+00014f90: 7573 6520 2766 7261 6d65 2e6d 6561 6e28  use 'frame.mean(
+00014fa0: 6178 6973 3d30 2927 206f 7220 6a75 7374  axis=0)' or just
+00014fb0: 2027 6672 616d 652e 6d65 616e 2829 2722   'frame.mean()'"
+00014fc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014fd0: 2020 4675 7475 7265 5761 726e 696e 672c    FutureWarning,
+00014fe0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00014ff0: 2020 2020 2020 2061 7869 7320 3d20 7365         axis = se
+00015000: 6c66 2e5f 7661 6c69 6461 7465 5f61 7869  lf._validate_axi
+00015010: 7328 6178 6973 2c20 6e6f 6e65 5f69 735f  s(axis, none_is_
+00015020: 7a65 726f 3d6e 6f74 2050 414e 4441 535f  zero=not PANDAS_
+00015030: 4754 5f32 3030 290a 2020 2020 2020 2020  GT_200).        
+00015040: 5f72 6169 7365 5f69 665f 6f62 6a65 6374  _raise_if_object
+00015050: 5f73 6572 6965 7328 7365 6c66 2c20 226d  _series(self, "m
+00015060: 6561 6e22 290a 2020 2020 2020 2020 2320  ean").        # 
+00015070: 4e4f 5445 3a20 446f 2077 6520 7761 6e74  NOTE: Do we want
+00015080: 2074 6f20 7761 726e 2068 6572 653f 0a20   to warn here?. 
+00015090: 2020 2020 2020 2077 6974 6820 6368 6563         with chec
+000150a0: 6b5f 6e75 6d65 7269 635f 6f6e 6c79 5f64  k_numeric_only_d
+000150b0: 6570 7265 6361 7469 6f6e 2829 2c20 6368  eprecation(), ch
+000150c0: 6563 6b5f 6e75 6973 616e 6365 5f63 6f6c  eck_nuisance_col
+000150d0: 756d 6e73 5f77 6172 6e69 6e67 2829 3a0a  umns_warning():.
+000150e0: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+000150f0: 203d 2073 656c 662e 5f6d 6574 615f 6e6f   = self._meta_no
+00015100: 6e65 6d70 7479 2e6d 6561 6e28 0a20 2020  nempty.mean(.   
+00015110: 2020 2020 2020 2020 2020 2020 2061 7869               axi
+00015120: 733d 6178 6973 2c20 736b 6970 6e61 3d73  s=axis, skipna=s
+00015130: 6b69 706e 612c 206e 756d 6572 6963 5f6f  kipna, numeric_o
+00015140: 6e6c 793d 6e75 6d65 7269 635f 6f6e 6c79  nly=numeric_only
+00015150: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00015160: 2020 2020 2020 2069 6620 6178 6973 203d         if axis =
+00015170: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00015180: 2072 6573 756c 7420 3d20 6d61 705f 7061   result = map_pa
+00015190: 7274 6974 696f 6e73 280a 2020 2020 2020  rtitions(.      
+000151a0: 2020 2020 2020 2020 2020 4d2e 6d65 616e            M.mean
+000151b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000151c0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000151d0: 2020 2020 2020 2020 6d65 7461 3d6d 6574          meta=met
+000151e0: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+000151f0: 2020 2074 6f6b 656e 3d73 656c 662e 5f74     token=self._t
+00015200: 6f6b 656e 5f70 7265 6669 7820 2b20 226d  oken_prefix + "m
+00015210: 6561 6e22 2c0a 2020 2020 2020 2020 2020  ean",.          
+00015220: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
+00015230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015240: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
+00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015260: 656e 666f 7263 655f 6d65 7461 6461 7461  enforce_metadata
+00015270: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00015280: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
+00015290: 6f6e 6c79 3d6e 756d 6572 6963 5f6f 6e6c  only=numeric_onl
+000152a0: 792c 0a20 2020 2020 2020 2020 2020 2029  y,.            )
+000152b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000152c0: 7572 6e20 6861 6e64 6c65 5f6f 7574 286f  urn handle_out(o
+000152d0: 7574 2c20 7265 7375 6c74 290a 2020 2020  ut, result).    
+000152e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000152f0: 2020 2020 2020 6e75 6d20 3d20 7365 6c66        num = self
+00015300: 2e5f 6765 745f 6e75 6d65 7269 635f 6461  ._get_numeric_da
+00015310: 7461 2829 0a20 2020 2020 2020 2020 2020  ta().           
+00015320: 2073 203d 206e 756d 2e73 756d 2873 6b69   s = num.sum(ski
+00015330: 706e 613d 736b 6970 6e61 2c20 7370 6c69  pna=skipna, spli
+00015340: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
+00015350: 6572 7929 0a20 2020 2020 2020 2020 2020  ery).           
+00015360: 206e 203d 206e 756d 2e63 6f75 6e74 2873   n = num.count(s
+00015370: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+00015380: 5f65 7665 7279 290a 2020 2020 2020 2020  _every).        
+00015390: 2020 2020 2320 5374 6172 7469 6e67 2069      # Starting i
+000153a0: 6e20 7061 6e64 6173 2032 2e30 2c20 6061  n pandas 2.0, `a
+000153b0: 7869 733d 4e6f 6e65 6020 646f 6573 2061  xis=None` does a
+000153c0: 2066 756c 6c20 6167 6772 6567 6174 696f   full aggregatio
+000153d0: 6e20 6163 726f 7373 2062 6f74 6820 6178  n across both ax
+000153e0: 6573 0a20 2020 2020 2020 2020 2020 2069  es.            i
+000153f0: 6620 5041 4e44 4153 5f47 545f 3230 3020  f PANDAS_GT_200 
+00015400: 616e 6420 6178 6973 2069 7320 4e6f 6e65  and axis is None
+00015410: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00015420: 7365 6c66 2c20 4461 7461 4672 616d 6529  self, DataFrame)
+00015430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015440: 2020 7265 7375 6c74 203d 2073 2e73 756d    result = s.sum
+00015450: 2829 202f 206e 2e73 756d 2829 0a20 2020  () / n.sum().   
+00015460: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00015470: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00015480: 616d 6520 3d20 7365 6c66 2e5f 746f 6b65  ame = self._toke
+00015490: 6e5f 7072 6566 6978 202b 2022 6d65 616e  n_prefix + "mean
+000154a0: 2d25 7322 2025 2074 6f6b 656e 697a 6528  -%s" % tokenize(
+000154b0: 7365 6c66 2c20 6178 6973 2c20 736b 6970  self, axis, skip
+000154c0: 6e61 290a 2020 2020 2020 2020 2020 2020  na).            
+000154d0: 2020 2020 7265 7375 6c74 203d 206d 6170      result = map
+000154e0: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 206d 6574 686f 6473 2e6d 6561 6e5f 6167   methods.mean_ag
+00015510: 6772 6567 6174 652c 0a20 2020 2020 2020  gregate,.       
+00015520: 2020 2020 2020 2020 2020 2020 2073 2c0a               s,.
+00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015540: 2020 2020 6e2c 0a20 2020 2020 2020 2020      n,.         
+00015550: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00015560: 3d6e 616d 652c 0a20 2020 2020 2020 2020  =name,.         
+00015570: 2020 2020 2020 2020 2020 206d 6574 613d             meta=
+00015580: 6d65 7461 2c0a 2020 2020 2020 2020 2020  meta,.          
+00015590: 2020 2020 2020 2020 2020 656e 666f 7263            enforc
+000155a0: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+000155b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000155c0: 2020 2020 2020 7061 7265 6e74 5f6d 6574        parent_met
+000155d0: 613d 7365 6c66 2e5f 6d65 7461 2c0a 2020  a=self._meta,.  
+000155e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000155f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015600: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+00015610: 6c66 2c20 4461 7461 4672 616d 6529 3a0a  lf, DataFrame):.
+00015620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015630: 2020 2020 7265 7375 6c74 2e64 6976 6973      result.divis
+00015640: 696f 6e73 203d 2028 7365 6c66 2e63 6f6c  ions = (self.col
+00015650: 756d 6e73 2e6d 696e 2829 2c20 7365 6c66  umns.min(), self
+00015660: 2e63 6f6c 756d 6e73 2e6d 6178 2829 290a  .columns.max()).
+00015670: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015680: 726e 2068 616e 646c 655f 6f75 7428 6f75  rn handle_out(ou
+00015690: 742c 2072 6573 756c 7429 0a0a 2020 2020  t, result)..    
+000156a0: 6465 6620 6d65 6469 616e 5f61 7070 726f  def median_appro
+000156b0: 7869 6d61 7465 280a 2020 2020 2020 2020  ximate(.        
+000156c0: 7365 6c66 2c0a 2020 2020 2020 2020 6178  self,.        ax
+000156d0: 6973 3d4e 6f6e 652c 0a20 2020 2020 2020  is=None,.       
+000156e0: 206d 6574 686f 643d 2264 6566 6175 6c74   method="default
+000156f0: 222c 0a20 2020 2029 3a0a 2020 2020 2020  ",.    ):.      
+00015700: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
+00015710: 6170 7072 6f78 696d 6174 6520 6d65 6469  approximate medi
+00015720: 616e 206f 6620 7468 6520 7661 6c75 6573  an of the values
+00015730: 206f 7665 7220 7468 6520 7265 7175 6573   over the reques
+00015740: 7465 6420 6178 6973 2e0a 0a20 2020 2020  ted axis...     
+00015750: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00015760: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00015770: 0a20 2020 2020 2020 2061 7869 7320 3a20  .        axis : 
+00015780: 7b30 2c20 312c 2022 696e 6465 7822 2c20  {0, 1, "index", 
+00015790: 2263 6f6c 756d 6e73 227d 2028 6465 6661  "columns"} (defa
+000157a0: 756c 7420 3029 0a20 2020 2020 2020 2020  ult 0).         
+000157b0: 2020 2030 206f 7220 6060 2269 6e64 6578     0 or ``"index
+000157c0: 2260 6020 666f 7220 726f 772d 7769 7365  "`` for row-wise
+000157d0: 2c20 3120 6f72 2060 6022 636f 6c75 6d6e  , 1 or ``"column
+000157e0: 7322 6060 2066 6f72 2063 6f6c 756d 6e2d  s"`` for column-
+000157f0: 7769 7365 0a20 2020 2020 2020 206d 6574  wise.        met
+00015800: 686f 6420 3a20 7b27 6465 6661 756c 7427  hod : {'default'
+00015810: 2c20 2774 6469 6765 7374 272c 2027 6461  , 'tdigest', 'da
+00015820: 736b 277d 2c20 6f70 7469 6f6e 616c 0a20  sk'}, optional. 
+00015830: 2020 2020 2020 2020 2020 2057 6861 7420             What 
+00015840: 6d65 7468 6f64 2074 6f20 7573 652e 2042  method to use. B
+00015850: 7920 6465 6661 756c 7420 7769 6c6c 2075  y default will u
+00015860: 7365 2044 6173 6b27 7320 696e 7465 726e  se Dask's intern
+00015870: 616c 2063 7573 746f 6d0a 2020 2020 2020  al custom.      
+00015880: 2020 2020 2020 616c 676f 7269 7468 6d20        algorithm 
+00015890: 2860 6022 6461 736b 2260 6029 2e20 2049  (``"dask"``).  I
+000158a0: 6620 7365 7420 746f 2060 6022 7464 6967  f set to ``"tdig
+000158b0: 6573 7422 6060 2077 696c 6c20 7573 6520  est"`` will use 
+000158c0: 7464 6967 6573 740a 2020 2020 2020 2020  tdigest.        
+000158d0: 2020 2020 666f 7220 666c 6f61 7473 2061      for floats a
+000158e0: 6e64 2069 6e74 7320 616e 6420 6661 6c6c  nd ints and fall
+000158f0: 6261 636b 2074 6f20 7468 6520 6060 2264  back to the ``"d
+00015900: 6173 6b22 6060 206f 7468 6572 7769 7365  ask"`` otherwise
+00015910: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00015920: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00015930: 662e 7175 616e 7469 6c65 2871 3d30 2e35  f.quantile(q=0.5
+00015940: 2c20 6178 6973 3d61 7869 732c 206d 6574  , axis=axis, met
+00015950: 686f 643d 6d65 7468 6f64 292e 7265 6e61  hod=method).rena
+00015960: 6d65 284e 6f6e 6529 0a0a 2020 2020 4064  me(None)..    @d
+00015970: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+00015980: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+00015990: 6620 6d65 6469 616e 2873 656c 662c 2061  f median(self, a
+000159a0: 7869 733d 4e6f 6e65 2c20 6d65 7468 6f64  xis=None, method
+000159b0: 3d22 6465 6661 756c 7422 293a 0a20 2020  ="default"):.   
+000159c0: 2020 2020 2069 6620 6178 6973 2069 6e20       if axis in 
+000159d0: 2831 2c20 2263 6f6c 756d 6e73 2229 206f  (1, "columns") o
+000159e0: 7220 7365 6c66 2e6e 7061 7274 6974 696f  r self.npartitio
+000159f0: 6e73 203d 3d20 313a 0a20 2020 2020 2020  ns == 1:.       
+00015a00: 2020 2020 2023 2043 616e 2070 726f 7669       # Can provi
+00015a10: 6465 2061 6e20 6578 6163 7420 6d65 6469  de an exact medi
+00015a20: 616e 2069 6e20 7468 6573 6520 6361 7365  an in these case
+00015a30: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+00015a40: 7475 726e 2073 656c 662e 6d65 6469 616e  turn self.median
+00015a50: 5f61 7070 726f 7869 6d61 7465 2861 7869  _approximate(axi
+00015a60: 733d 6178 6973 2c20 6d65 7468 6f64 3d6d  s=axis, method=m
+00015a70: 6574 686f 6429 0a20 2020 2020 2020 2072  ethod).        r
+00015a80: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
+00015a90: 7465 6445 7272 6f72 280a 2020 2020 2020  tedError(.      
+00015aa0: 2020 2020 2020 2244 6173 6b20 646f 6573        "Dask does
+00015ab0: 6e27 7420 696d 706c 656d 656e 7420 616e  n't implement an
+00015ac0: 2065 7861 6374 206d 6564 6961 6e20 696e   exact median in
+00015ad0: 2061 6c6c 2063 6173 6573 2061 7320 7468   all cases as th
+00015ae0: 6973 2069 7320 6861 7264 2074 6f20 646f  is is hard to do
+00015af0: 2069 6e20 7061 7261 6c6c 656c 2e20 220a   in parallel. ".
+00015b00: 2020 2020 2020 2020 2020 2020 2253 6565              "See
+00015b10: 2074 6865 2060 6d65 6469 616e 5f61 7070   the `median_app
+00015b20: 726f 7869 6d61 7465 6020 6d65 7468 6f64  roximate` method
+00015b30: 2069 6e73 7465 6164 2c20 7768 6963 6820   instead, which 
+00015b40: 7573 6573 2061 6e20 6170 7072 6f78 696d  uses an approxim
+00015b50: 6174 6520 616c 676f 7269 7468 6d2e 220a  ate algorithm.".
+00015b60: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+00015b70: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+00015b80: 4461 7461 4672 616d 6529 0a20 2020 2064  DataFrame).    d
+00015b90: 6566 2076 6172 280a 2020 2020 2020 2020  ef var(.        
+00015ba0: 7365 6c66 2c0a 2020 2020 2020 2020 6178  self,.        ax
+00015bb0: 6973 3d4e 6f6e 652c 0a20 2020 2020 2020  is=None,.       
+00015bc0: 2073 6b69 706e 613d 5472 7565 2c0a 2020   skipna=True,.  
+00015bd0: 2020 2020 2020 6464 6f66 3d31 2c0a 2020        ddof=1,.  
+00015be0: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
+00015bf0: 793d 4661 6c73 652c 0a20 2020 2020 2020  y=False,.       
+00015c00: 2064 7479 7065 3d4e 6f6e 652c 0a20 2020   dtype=None,.   
+00015c10: 2020 2020 206f 7574 3d4e 6f6e 652c 0a20       out=None,. 
+00015c20: 2020 2020 2020 206e 756d 6572 6963 5f6f         numeric_o
+00015c30: 6e6c 793d 6e6f 5f64 6566 6175 6c74 2c0a  nly=no_default,.
+00015c40: 2020 2020 293a 0a20 2020 2020 2020 2061      ):.        a
+00015c50: 7869 7320 3d20 7365 6c66 2e5f 7661 6c69  xis = self._vali
+00015c60: 6461 7465 5f61 7869 7328 6178 6973 290a  date_axis(axis).
+00015c70: 2020 2020 2020 2020 5f72 6169 7365 5f69          _raise_i
+00015c80: 665f 6f62 6a65 6374 5f73 6572 6965 7328  f_object_series(
+00015c90: 7365 6c66 2c20 2276 6172 2229 0a20 2020  self, "var").   
+00015ca0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
+00015cb0: 795f 6b77 6172 6773 203d 2067 6574 5f6e  y_kwargs = get_n
+00015cc0: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
+00015cd0: 6773 286e 756d 6572 6963 5f6f 6e6c 7929  gs(numeric_only)
+00015ce0: 0a20 2020 2020 2020 2077 6974 6820 6368  .        with ch
+00015cf0: 6563 6b5f 6e75 6d65 7269 635f 6f6e 6c79  eck_numeric_only
+00015d00: 5f64 6570 7265 6361 7469 6f6e 280a 2020  _deprecation(.  
+00015d10: 2020 2020 2020 2020 2020 2276 6172 222c            "var",
+00015d20: 2054 7275 650a 2020 2020 2020 2020 292c   True.        ),
+00015d30: 2063 6865 636b 5f72 6564 7563 7469 6f6e   check_reduction
+00015d40: 735f 7275 6e74 696d 655f 7761 726e 696e  s_runtime_warnin
+00015d50: 6728 293a 0a20 2020 2020 2020 2020 2020  g():.           
+00015d60: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
+00015d70: 7461 5f6e 6f6e 656d 7074 792e 7661 7228  ta_nonempty.var(
+00015d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d90: 2061 7869 733d 6178 6973 2c0a 2020 2020   axis=axis,.    
+00015da0: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+00015db0: 6e61 3d73 6b69 706e 612c 0a20 2020 2020  na=skipna,.     
+00015dc0: 2020 2020 2020 2020 2020 202a 2a6e 756d             **num
+00015dd0: 6572 6963 5f6f 6e6c 795f 6b77 6172 6773  eric_only_kwargs
+00015de0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00015df0: 2020 2020 2020 2020 6966 2061 7869 7320          if axis 
+00015e00: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00015e10: 2020 7265 7375 6c74 203d 206d 6170 5f70    result = map_p
+00015e20: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
+00015e30: 2020 2020 2020 2020 2020 204d 2e76 6172             M.var
+00015e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015e50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00015e60: 2020 2020 2020 2020 6d65 7461 3d6d 6574          meta=met
+00015e70: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00015e80: 2020 2074 6f6b 656e 3d73 656c 662e 5f74     token=self._t
+00015e90: 6f6b 656e 5f70 7265 6669 7820 2b20 2276  oken_prefix + "v
+00015ea0: 6172 222c 0a20 2020 2020 2020 2020 2020  ar",.           
+00015eb0: 2020 2020 2061 7869 733d 6178 6973 2c0a       axis=axis,.
+00015ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ed0: 736b 6970 6e61 3d73 6b69 706e 612c 0a20  skipna=skipna,. 
+00015ee0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00015ef0: 646f 663d 6464 6f66 2c0a 2020 2020 2020  dof=ddof,.      
+00015f00: 2020 2020 2020 2020 2020 656e 666f 7263            enforc
+00015f10: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+00015f20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015f30: 2020 2a2a 6e75 6d65 7269 635f 6f6e 6c79    **numeric_only
+00015f40: 5f6b 7761 7267 732c 0a20 2020 2020 2020  _kwargs,.       
+00015f50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00015f60: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
+00015f70: 5f6f 7574 286f 7574 2c20 7265 7375 6c74  _out(out, result
+00015f80: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00015f90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00015fa0: 656c 662e 6e64 696d 203d 3d20 313a 0a20  elf.ndim == 1:. 
+00015fb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00015fc0: 6573 756c 7420 3d20 7365 6c66 2e5f 7661  esult = self._va
+00015fd0: 725f 3164 2873 656c 662c 2073 6b69 706e  r_1d(self, skipn
+00015fe0: 612c 2064 646f 662c 2073 706c 6974 5f65  a, ddof, split_e
+00015ff0: 7665 7279 290a 2020 2020 2020 2020 2020  very).          
+00016000: 2020 2020 2020 7265 7475 726e 2068 616e        return han
+00016010: 646c 655f 6f75 7428 6f75 742c 2072 6573  dle_out(out, res
+00016020: 756c 7429 0a0a 2020 2020 2020 2020 2020  ult)..          
+00016030: 2020 2320 7061 6e64 6173 2031 2e30 2b20    # pandas 1.0+ 
+00016040: 646f 6573 206e 6f74 2069 6d70 6c65 6d65  does not impleme
+00016050: 6e74 2076 6172 206f 6e20 7469 6d65 6465  nt var on timede
+00016060: 6c74 610a 2020 2020 2020 2020 2020 2020  lta.            
+00016070: 7265 7375 6c74 203d 2073 656c 662e 5f76  result = self._v
+00016080: 6172 5f6e 756d 6572 6963 2873 6b69 706e  ar_numeric(skipn
+00016090: 612c 2064 646f 662c 2073 706c 6974 5f65  a, ddof, split_e
+000160a0: 7665 7279 290a 0a20 2020 2020 2020 2020  very)..         
+000160b0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+000160c0: 2873 656c 662c 2044 6174 6146 7261 6d65  (self, DataFrame
+000160d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000160e0: 2020 2072 6573 756c 742e 6469 7669 7369     result.divisi
+000160f0: 6f6e 7320 3d20 2873 656c 662e 636f 6c75  ons = (self.colu
+00016100: 6d6e 732e 6d69 6e28 292c 2073 656c 662e  mns.min(), self.
+00016110: 636f 6c75 6d6e 732e 6d61 7828 2929 0a20  columns.max()). 
+00016120: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016130: 6e20 6861 6e64 6c65 5f6f 7574 286f 7574  n handle_out(out
+00016140: 2c20 7265 7375 6c74 290a 0a20 2020 2064  , result)..    d
+00016150: 6566 205f 7661 725f 6e75 6d65 7269 6328  ef _var_numeric(
+00016160: 7365 6c66 2c20 736b 6970 6e61 3d54 7275  self, skipna=Tru
+00016170: 652c 2064 646f 663d 312c 2073 706c 6974  e, ddof=1, split
+00016180: 5f65 7665 7279 3d46 616c 7365 293a 0a20  _every=False):. 
+00016190: 2020 2020 2020 206e 756d 203d 2073 656c         num = sel
+000161a0: 662e 7365 6c65 6374 5f64 7479 7065 7328  f.select_dtypes(
+000161b0: 696e 636c 7564 653d 5b22 6e75 6d62 6572  include=["number
+000161c0: 222c 2022 626f 6f6c 225d 2c20 6578 636c  ", "bool"], excl
+000161d0: 7564 653d 5b6e 702e 7469 6d65 6465 6c74  ude=[np.timedelt
+000161e0: 6136 345d 290a 0a20 2020 2020 2020 2076  a64])..        v
+000161f0: 616c 7565 735f 6474 7970 6520 3d20 6e75  alues_dtype = nu
+00016200: 6d2e 7661 6c75 6573 2e64 7479 7065 0a20  m.values.dtype. 
+00016210: 2020 2020 2020 2061 7272 6179 5f76 616c         array_val
+00016220: 7565 7320 3d20 6e75 6d2e 7661 6c75 6573  ues = num.values
+00016230: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00016240: 206e 702e 6973 7375 6264 7479 7065 2876   np.issubdtype(v
+00016250: 616c 7565 735f 6474 7970 652c 206e 702e  alues_dtype, np.
+00016260: 6e75 6d62 6572 293a 0a20 2020 2020 2020  number):.       
+00016270: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
+00016280: 7320 3d20 6e75 6d2e 7661 6c75 6573 2e61  s = num.values.a
+00016290: 7374 7970 6528 2266 3822 290a 0a20 2020  stype("f8")..   
+000162a0: 2020 2020 2076 6172 203d 2064 612e 6e61       var = da.na
+000162b0: 6e76 6172 2069 6620 736b 6970 6e61 206f  nvar if skipna o
+000162c0: 7220 736b 6970 6e61 2069 7320 4e6f 6e65  r skipna is None
+000162d0: 2065 6c73 6520 6461 2e76 6172 0a20 2020   else da.var.   
+000162e0: 2020 2020 2061 7272 6179 5f76 6172 203d       array_var =
+000162f0: 2076 6172 2861 7272 6179 5f76 616c 7565   var(array_value
+00016300: 732c 2061 7869 733d 302c 2064 646f 663d  s, axis=0, ddof=
+00016310: 6464 6f66 2c20 7370 6c69 745f 6576 6572  ddof, split_ever
+00016320: 793d 7370 6c69 745f 6576 6572 7929 0a0a  y=split_every)..
+00016330: 2020 2020 2020 2020 6e61 6d65 203d 2073          name = s
+00016340: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
+00016350: 7820 2b20 2276 6172 2d6e 756d 6572 6963  x + "var-numeric
+00016360: 2220 2b20 746f 6b65 6e69 7a65 286e 756d  " + tokenize(num
+00016370: 2c20 7370 6c69 745f 6576 6572 7929 0a20  , split_every). 
+00016380: 2020 2020 2020 2063 6f6c 7320 3d20 6e75         cols = nu
+00016390: 6d2e 5f6d 6574 612e 636f 6c75 6d6e 7320  m._meta.columns 
+000163a0: 6966 2069 735f 6461 7461 6672 616d 655f  if is_dataframe_
+000163b0: 6c69 6b65 286e 756d 2920 656c 7365 204e  like(num) else N
+000163c0: 6f6e 650a 0a20 2020 2020 2020 2077 6974  one..        wit
+000163d0: 6820 6368 6563 6b5f 7265 6475 6374 696f  h check_reductio
+000163e0: 6e73 5f72 756e 7469 6d65 5f77 6172 6e69  ns_runtime_warni
+000163f0: 6e67 2829 3a0a 2020 2020 2020 2020 2020  ng():.          
+00016400: 2020 6d65 7461 5f63 6f6d 7075 7461 7469    meta_computati
+00016410: 6f6e 203d 206e 756d 2e5f 6d65 7461 5f6e  on = num._meta_n
+00016420: 6f6e 656d 7074 792e 7661 7228 6178 6973  onempty.var(axis
+00016430: 3d30 290a 2020 2020 2020 2020 7661 725f  =0).        var_
+00016440: 7368 6170 6520 3d20 6d65 7461 5f63 6f6d  shape = meta_com
+00016450: 7075 7461 7469 6f6e 2e73 6861 7065 0a20  putation.shape. 
+00016460: 2020 2020 2020 2061 7272 6179 5f76 6172         array_var
+00016470: 5f6e 616d 6520 3d20 2861 7272 6179 5f76  _name = (array_v
+00016480: 6172 2e5f 6e61 6d65 2c29 202b 2028 302c  ar._name,) + (0,
+00016490: 2920 2a20 6c65 6e28 7661 725f 7368 6170  ) * len(var_shap
+000164a0: 6529 0a0a 2020 2020 2020 2020 6c61 7965  e)..        laye
+000164b0: 7220 3d20 7b28 6e61 6d65 2c20 3029 3a20  r = {(name, 0): 
+000164c0: 286d 6574 686f 6473 2e77 7261 705f 7661  (methods.wrap_va
+000164d0: 725f 7265 6475 6374 696f 6e2c 2061 7272  r_reduction, arr
+000164e0: 6179 5f76 6172 5f6e 616d 652c 2063 6f6c  ay_var_name, col
+000164f0: 7329 7d0a 2020 2020 2020 2020 6772 6170  s)}.        grap
+00016500: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
+00016510: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
+00016520: 6f6e 7328 6e61 6d65 2c20 6c61 7965 722c  ons(name, layer,
+00016530: 2064 6570 656e 6465 6e63 6965 733d 5b61   dependencies=[a
+00016540: 7272 6179 5f76 6172 5d29 0a0a 2020 2020  rray_var])..    
+00016550: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
+00016560: 645f 6f62 6a65 6374 2867 7261 7068 2c20  d_object(graph, 
+00016570: 6e61 6d65 2c20 6d65 7461 5f63 6f6d 7075  name, meta_compu
+00016580: 7461 7469 6f6e 2c20 6469 7669 7369 6f6e  tation, division
+00016590: 733d 5b4e 6f6e 652c 204e 6f6e 655d 290a  s=[None, None]).
+000165a0: 0a20 2020 2064 6566 205f 7661 725f 3164  .    def _var_1d
+000165b0: 2873 656c 662c 2063 6f6c 756d 6e2c 2073  (self, column, s
+000165c0: 6b69 706e 613d 5472 7565 2c20 6464 6f66  kipna=True, ddof
+000165d0: 3d31 2c20 7370 6c69 745f 6576 6572 793d  =1, split_every=
+000165e0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+000165f0: 6973 5f74 696d 6564 656c 7461 203d 2069  is_timedelta = i
+00016600: 735f 7469 6d65 6465 6c74 6136 345f 6474  s_timedelta64_dt
+00016610: 7970 6528 636f 6c75 6d6e 2e5f 6d65 7461  ype(column._meta
+00016620: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
+00016630: 5f74 696d 6564 656c 7461 3a0a 2020 2020  _timedelta:.    
+00016640: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00016650: 6b69 706e 613a 0a20 2020 2020 2020 2020  kipna:.         
+00016660: 2020 2020 2020 2069 735f 6e61 6e20 3d20         is_nan = 
+00016670: 636f 6c75 6d6e 2e69 736e 6128 290a 2020  column.isna().  
+00016680: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016690: 6c75 6d6e 203d 2063 6f6c 756d 6e2e 6173  lumn = column.as
+000166a0: 7479 7065 2822 6938 2229 0a20 2020 2020  type("i8").     
+000166b0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+000166c0: 6e20 3d20 636f 6c75 6d6e 2e6d 6173 6b28  n = column.mask(
+000166d0: 6973 5f6e 616e 290a 2020 2020 2020 2020  is_nan).        
+000166e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000166f0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+00016700: 203d 2063 6f6c 756d 6e2e 6472 6f70 6e61   = column.dropna
+00016710: 2829 2e61 7374 7970 6528 2269 3822 290a  ().astype("i8").
+00016720: 0a20 2020 2020 2020 2069 6620 7064 2e61  .        if pd.a
+00016730: 7069 2e74 7970 6573 2e69 735f 6578 7465  pi.types.is_exte
+00016740: 6e73 696f 6e5f 6172 7261 795f 6474 7970  nsion_array_dtyp
+00016750: 6528 636f 6c75 6d6e 2e5f 6d65 7461 5f6e  e(column._meta_n
+00016760: 6f6e 656d 7074 7929 3a0a 2020 2020 2020  onempty):.      
+00016770: 2020 2020 2020 2320 446f 6e27 7420 6861        # Don't ha
+00016780: 7665 2074 6f20 776f 7272 7920 6162 6f75  ve to worry abou
+00016790: 7420 6e6f 6e2d 6e75 6d65 7269 632c 2074  t non-numeric, t
+000167a0: 6869 7320 7261 6973 6573 2065 6172 6c69  his raises earli
+000167b0: 6572 0a20 2020 2020 2020 2020 2020 2063  er.            c
+000167c0: 6f6c 756d 6e20 3d20 636f 6c75 6d6e 2e61  olumn = column.a
+000167d0: 7374 7970 6528 2266 3822 290a 0a20 2020  stype("f8")..   
+000167e0: 2020 2020 2065 6c69 6620 6e6f 7420 6e70       elif not np
+000167f0: 2e69 7373 7562 6474 7970 6528 636f 6c75  .issubdtype(colu
+00016800: 6d6e 2e64 7479 7065 2c20 6e70 2e6e 756d  mn.dtype, np.num
+00016810: 6265 7229 3a0a 2020 2020 2020 2020 2020  ber):.          
+00016820: 2020 636f 6c75 6d6e 203d 2063 6f6c 756d    column = colum
+00016830: 6e2e 6173 7479 7065 2822 6638 2229 0a0a  n.astype("f8")..
+00016840: 2020 2020 2020 2020 6e61 6d65 203d 2073          name = s
+00016850: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
+00016860: 7820 2b20 2276 6172 2d31 642d 2220 2b20  x + "var-1d-" + 
+00016870: 746f 6b65 6e69 7a65 2863 6f6c 756d 6e2c  tokenize(column,
+00016880: 2073 706c 6974 5f65 7665 7279 290a 0a20   split_every).. 
+00016890: 2020 2020 2020 2076 6172 203d 2064 612e         var = da.
+000168a0: 6e61 6e76 6172 2069 6620 736b 6970 6e61  nanvar if skipna
+000168b0: 206f 7220 736b 6970 6e61 2069 7320 4e6f   or skipna is No
+000168c0: 6e65 2065 6c73 6520 6461 2e76 6172 0a20  ne else da.var. 
+000168d0: 2020 2020 2020 2061 7272 6179 5f76 6172         array_var
+000168e0: 203d 2076 6172 2863 6f6c 756d 6e2e 7661   = var(column.va
+000168f0: 6c75 6573 2c20 6178 6973 3d30 2c20 6464  lues, axis=0, dd
+00016900: 6f66 3d64 646f 662c 2073 706c 6974 5f65  of=ddof, split_e
+00016910: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00016920: 290a 0a20 2020 2020 2020 206c 6179 6572  )..        layer
+00016930: 203d 207b 286e 616d 652c 2030 293a 2028   = {(name, 0): (
+00016940: 6d65 7468 6f64 732e 7772 6170 5f76 6172  methods.wrap_var
+00016950: 5f72 6564 7563 7469 6f6e 2c20 2861 7272  _reduction, (arr
+00016960: 6179 5f76 6172 2e5f 6e61 6d65 2c29 2c20  ay_var._name,), 
+00016970: 4e6f 6e65 297d 0a20 2020 2020 2020 2067  None)}.        g
+00016980: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
+00016990: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
+000169a0: 6374 696f 6e73 286e 616d 652c 206c 6179  ctions(name, lay
+000169b0: 6572 2c20 6465 7065 6e64 656e 6369 6573  er, dependencies
+000169c0: 3d5b 6172 7261 795f 7661 725d 290a 0a20  =[array_var]).. 
+000169d0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+000169e0: 775f 6464 5f6f 626a 6563 7428 0a20 2020  w_dd_object(.   
+000169f0: 2020 2020 2020 2020 2067 7261 7068 2c20           graph, 
+00016a00: 6e61 6d65 2c20 636f 6c75 6d6e 2e5f 6d65  name, column._me
+00016a10: 7461 5f6e 6f6e 656d 7074 792e 7661 7228  ta_nonempty.var(
+00016a20: 292c 2064 6976 6973 696f 6e73 3d5b 4e6f  ), divisions=[No
+00016a30: 6e65 2c20 4e6f 6e65 5d0a 2020 2020 2020  ne, None].      
+00016a40: 2020 290a 0a20 2020 2040 5f6e 756d 6572    )..    @_numer
+00016a50: 6963 5f64 6174 610a 2020 2020 4064 6572  ic_data.    @der
+00016a60: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
+00016a70: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
+00016a80: 7374 6428 0a20 2020 2020 2020 2073 656c  std(.        sel
+00016a90: 662c 0a20 2020 2020 2020 2061 7869 733d  f,.        axis=
+00016aa0: 4e6f 6e65 2c0a 2020 2020 2020 2020 736b  None,.        sk
+00016ab0: 6970 6e61 3d54 7275 652c 0a20 2020 2020  ipna=True,.     
+00016ac0: 2020 2064 646f 663d 312c 0a20 2020 2020     ddof=1,.     
+00016ad0: 2020 2073 706c 6974 5f65 7665 7279 3d46     split_every=F
+00016ae0: 616c 7365 2c0a 2020 2020 2020 2020 6474  alse,.        dt
+00016af0: 7970 653d 4e6f 6e65 2c0a 2020 2020 2020  ype=None,.      
+00016b00: 2020 6f75 743d 4e6f 6e65 2c0a 2020 2020    out=None,.    
+00016b10: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
+00016b20: 3d6e 6f5f 6465 6661 756c 742c 0a20 2020  =no_default,.   
+00016b30: 2029 3a0a 2020 2020 2020 2020 6178 6973   ):.        axis
+00016b40: 203d 2073 656c 662e 5f76 616c 6964 6174   = self._validat
+00016b50: 655f 6178 6973 2861 7869 7329 0a20 2020  e_axis(axis).   
+00016b60: 2020 2020 205f 7261 6973 655f 6966 5f6f       _raise_if_o
+00016b70: 626a 6563 745f 7365 7269 6573 2873 656c  bject_series(sel
+00016b80: 662c 2022 7374 6422 290a 2020 2020 2020  f, "std").      
+00016b90: 2020 5f72 6169 7365 5f69 665f 6e6f 745f    _raise_if_not_
+00016ba0: 7365 7269 6573 5f6f 725f 6461 7461 6672  series_or_datafr
+00016bb0: 616d 6528 7365 6c66 2c20 2273 7464 2229  ame(self, "std")
+00016bc0: 0a20 2020 2020 2020 206e 756d 6572 6963  .        numeric
+00016bd0: 5f6b 7761 7267 7320 3d20 6765 745f 6e75  _kwargs = get_nu
+00016be0: 6d65 7269 635f 6f6e 6c79 5f6b 7761 7267  meric_only_kwarg
+00016bf0: 7328 6e75 6d65 7269 635f 6f6e 6c79 290a  s(numeric_only).
+00016c00: 0a20 2020 2020 2020 2077 6974 6820 6368  .        with ch
+00016c10: 6563 6b5f 6e75 6d65 7269 635f 6f6e 6c79  eck_numeric_only
+00016c20: 5f64 6570 7265 6361 7469 6f6e 280a 2020  _deprecation(.  
+00016c30: 2020 2020 2020 2020 2020 2273 7464 222c            "std",
+00016c40: 2054 7275 650a 2020 2020 2020 2020 292c   True.        ),
+00016c50: 2063 6865 636b 5f72 6564 7563 7469 6f6e   check_reduction
+00016c60: 735f 7275 6e74 696d 655f 7761 726e 696e  s_runtime_warnin
+00016c70: 6728 293a 0a20 2020 2020 2020 2020 2020  g():.           
+00016c80: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
+00016c90: 7461 5f6e 6f6e 656d 7074 792e 7374 6428  ta_nonempty.std(
+00016ca0: 6178 6973 3d61 7869 732c 2073 6b69 706e  axis=axis, skipn
+00016cb0: 613d 736b 6970 6e61 2c20 2a2a 6e75 6d65  a=skipna, **nume
+00016cc0: 7269 635f 6b77 6172 6773 290a 2020 2020  ric_kwargs).    
+00016cd0: 2020 2020 6973 5f64 665f 6c69 6b65 203d      is_df_like =
+00016ce0: 2069 735f 6461 7461 6672 616d 655f 6c69   is_dataframe_li
+00016cf0: 6b65 2873 656c 662e 5f6d 6574 6129 0a20  ke(self._meta). 
+00016d00: 2020 2020 2020 206e 6565 6473 5f74 696d         needs_tim
+00016d10: 655f 636f 6e76 6572 7369 6f6e 203d 2046  e_conversion = F
+00016d20: 616c 7365 0a20 2020 2020 2020 206e 756d  alse.        num
+00016d30: 6572 6963 5f64 6420 3d20 7365 6c66 0a0a  eric_dd = self..
+00016d40: 2020 2020 2020 2020 6966 2069 735f 6466          if is_df
+00016d50: 5f6c 696b 653a 0a20 2020 2020 2020 2020  _like:.         
+00016d60: 2020 2074 696d 655f 636f 6c73 203d 2073     time_cols = s
+00016d70: 656c 662e 5f6d 6574 612e 7365 6c65 6374  elf._meta.select
+00016d80: 5f64 7479 7065 7328 0a20 2020 2020 2020  _dtypes(.       
+00016d90: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+00016da0: 3d5b 2264 6174 6574 696d 6522 2c20 2274  =["datetime", "t
+00016db0: 696d 6564 656c 7461 225d 0a20 2020 2020  imedelta"].     
+00016dc0: 2020 2020 2020 2029 2e63 6f6c 756d 6e73         ).columns
+00016dd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016de0: 6c65 6e28 7469 6d65 5f63 6f6c 7329 203e  len(time_cols) >
+00016df0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00016e00: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
+00016e10: 2020 2020 2020 2020 2020 6e75 6d65 7269            numeri
+00016e20: 635f 6464 2c0a 2020 2020 2020 2020 2020  c_dd,.          
+00016e30: 2020 2020 2020 2020 2020 6e65 6564 735f            needs_
+00016e40: 7469 6d65 5f63 6f6e 7665 7273 696f 6e2c  time_conversion,
+00016e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016e60: 2029 203d 2073 656c 662e 5f63 6f6e 7665   ) = self._conve
+00016e70: 7274 5f74 696d 655f 636f 6c73 5f74 6f5f  rt_time_cols_to_
+00016e80: 6e75 6d65 7269 6328 7469 6d65 5f63 6f6c  numeric(time_col
+00016e90: 732c 2061 7869 732c 206d 6574 612c 2073  s, axis, meta, s
+00016ea0: 6b69 706e 6129 0a20 2020 2020 2020 2065  kipna).        e
+00016eb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00016ec0: 206e 6565 6473 5f74 696d 655f 636f 6e76   needs_time_conv
+00016ed0: 6572 7369 6f6e 203d 2069 735f 6461 7465  ersion = is_date
+00016ee0: 7469 6d65 3634 5f61 6e79 5f64 7479 7065  time64_any_dtype
+00016ef0: 2873 656c 662e 5f6d 6574 6129 0a20 2020  (self._meta).   
+00016f00: 2020 2020 2020 2020 2069 6620 6e65 6564           if need
+00016f10: 735f 7469 6d65 5f63 6f6e 7665 7273 696f  s_time_conversio
+00016f20: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00016f30: 2020 206e 756d 6572 6963 5f64 6420 3d20     numeric_dd = 
+00016f40: 5f63 6f6e 7665 7274 5f74 6f5f 6e75 6d65  _convert_to_nume
+00016f50: 7269 6328 7365 6c66 2c20 736b 6970 6e61  ric(self, skipna
+00016f60: 290a 0a20 2020 2020 2020 2069 6620 6178  )..        if ax
+00016f70: 6973 203d 3d20 313a 0a20 2020 2020 2020  is == 1:.       
+00016f80: 2020 2020 2072 6573 756c 7420 3d20 6d61       result = ma
+00016f90: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
+00016fa0: 2020 2020 2020 2020 2020 2020 2020 4d2e                M.
+00016fb0: 7374 6420 6966 206e 6f74 206e 6565 6473  std if not needs
+00016fc0: 5f74 696d 655f 636f 6e76 6572 7369 6f6e  _time_conversion
+00016fd0: 2065 6c73 6520 5f73 7172 745f 616e 645f   else _sqrt_and_
+00016fe0: 636f 6e76 6572 745f 746f 5f74 696d 6564  convert_to_timed
+00016ff0: 656c 7461 2c0a 2020 2020 2020 2020 2020  elta,.          
+00017000: 2020 2020 2020 6e75 6d65 7269 635f 6464        numeric_dd
 00017010: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017020: 2020 2264 7479 7065 223a 2067 6574 6174    "dtype": getat
-00017030: 7472 286d 6574 612c 2022 6474 7970 6522  tr(meta, "dtype"
-00017040: 2c20 4e6f 6e65 292c 0a20 2020 2020 2020  , None),.       
-00017050: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00017060: 2020 2073 7172 745f 6675 6e63 203d 205f     sqrt_func = _
-00017070: 7371 7274 5f61 6e64 5f63 6f6e 7665 7274  sqrt_and_convert
-00017080: 5f74 6f5f 7469 6d65 6465 6c74 610a 2020  _to_timedelta.  
-00017090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000170a0: 2020 2020 2020 2020 7371 7274 5f66 756e          sqrt_fun
-000170b0: 635f 6b77 6172 6773 203d 207b 7d0a 2020  c_kwargs = {}.  
-000170c0: 2020 2020 2020 2020 2020 7371 7274 5f66            sqrt_f
-000170d0: 756e 6320 3d20 6e70 2e73 7172 740a 0a20  unc = np.sqrt.. 
-000170e0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000170f0: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
-00017100: 2020 2020 2020 2020 2020 2020 7371 7274              sqrt
-00017110: 5f66 756e 632c 0a20 2020 2020 2020 2020  _func,.         
-00017120: 2020 2076 2c0a 2020 2020 2020 2020 2020     v,.          
-00017130: 2020 6d65 7461 3d6d 6574 612c 0a20 2020    meta=meta,.   
-00017140: 2020 2020 2020 2020 2074 6f6b 656e 3d6e           token=n
-00017150: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00017160: 2065 6e66 6f72 6365 5f6d 6574 6164 6174   enforce_metadat
-00017170: 613d 4661 6c73 652c 0a20 2020 2020 2020  a=False,.       
-00017180: 2020 2020 2070 6172 656e 745f 6d65 7461       parent_meta
-00017190: 3d73 656c 662e 5f6d 6574 612c 0a20 2020  =self._meta,.   
-000171a0: 2020 2020 2020 2020 202a 2a73 7172 745f           **sqrt_
-000171b0: 6675 6e63 5f6b 7761 7267 732c 0a20 2020  func_kwargs,.   
-000171c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000171d0: 2320 5472 7920 746f 206d 6174 6368 2074  # Try to match t
-000171e0: 6865 2050 616e 6461 7320 7265 7375 6c74  he Pandas result
-000171f0: 2064 7479 7065 0a20 2020 2020 2020 2069   dtype.        i
-00017200: 6620 6973 5f64 665f 6c69 6b65 2061 6e64  f is_df_like and
-00017210: 2068 6173 6174 7472 286d 6574 612c 2022   hasattr(meta, "
-00017220: 6474 7970 6522 293a 0a20 2020 2020 2020  dtype"):.       
-00017230: 2020 2020 2072 6573 756c 7420 3d20 7265       result = re
-00017240: 7375 6c74 2e61 7374 7970 6528 6d65 7461  sult.astype(meta
-00017250: 2e64 7479 7065 290a 0a20 2020 2020 2020  .dtype)..       
-00017260: 2072 6574 7572 6e20 6861 6e64 6c65 5f6f   return handle_o
-00017270: 7574 286f 7574 2c20 7265 7375 6c74 290a  ut(out, result).
-00017280: 0a20 2020 2064 6566 205f 636f 6e76 6572  .    def _conver
-00017290: 745f 7469 6d65 5f63 6f6c 735f 746f 5f6e  t_time_cols_to_n
-000172a0: 756d 6572 6963 2873 656c 662c 2074 696d  umeric(self, tim
-000172b0: 655f 636f 6c73 2c20 6178 6973 2c20 6d65  e_cols, axis, me
-000172c0: 7461 2c20 736b 6970 6e61 293a 0a20 2020  ta, skipna):.   
-000172d0: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
-000172e0: 6174 6166 7261 6d65 2e69 6f20 696d 706f  ataframe.io impo
-000172f0: 7274 2066 726f 6d5f 7061 6e64 6173 0a0a  rt from_pandas..
-00017300: 2020 2020 2020 2020 6e65 6564 735f 7469          needs_ti
-00017310: 6d65 5f63 6f6e 7665 7273 696f 6e20 3d20  me_conversion = 
-00017320: 5472 7565 0a0a 2020 2020 2020 2020 2320  True..        # 
-00017330: 456e 7375 7265 2061 6c6c 2063 6f6c 756d  Ensure all colum
-00017340: 6e73 2061 7265 2063 6f72 7265 6374 2074  ns are correct t
-00017350: 7970 652e 204e 6565 6420 746f 2073 6861  ype. Need to sha
-00017360: 6c6c 6f77 2063 6f70 7920 7369 6e63 6520  llow copy since 
-00017370: 636f 6c73 2077 696c 6c20 6265 206d 6f64  cols will be mod
-00017380: 6966 6965 640a 2020 2020 2020 2020 6966  ified.        if
-00017390: 2061 7869 7320 3d3d 2030 3a0a 2020 2020   axis == 0:.    
-000173a0: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
-000173b0: 6464 203d 2073 656c 665b 6d65 7461 2e69  dd = self[meta.i
-000173c0: 6e64 6578 5d2e 636f 7079 2829 0a20 2020  ndex].copy().   
-000173d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000173e0: 2020 2020 2020 206e 756d 6572 6963 5f64         numeric_d
-000173f0: 6420 3d20 7365 6c66 2e63 6f70 7928 290a  d = self.copy().
-00017400: 0a20 2020 2020 2020 2023 204d 6978 206f  .        # Mix o
-00017410: 6620 6461 7465 7469 6d65 7320 7769 7468  f datetimes with
-00017420: 206f 7468 6572 206e 756d 6572 6963 2074   other numeric t
-00017430: 7970 6573 2070 726f 6475 6365 7320 4e61  ypes produces Na
-00017440: 4e73 2066 6f72 2065 6163 6820 7661 6c75  Ns for each valu
-00017450: 6520 696e 2073 7464 2829 2073 6572 6965  e in std() serie
-00017460: 730a 2020 2020 2020 2020 6966 2061 7869  s.        if axi
-00017470: 7320 3d3d 2031 2061 6e64 206c 656e 2874  s == 1 and len(t
-00017480: 696d 655f 636f 6c73 2920 213d 206c 656e  ime_cols) != len
-00017490: 2873 656c 662e 636f 6c75 6d6e 7329 3a0a  (self.columns):.
-000174a0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-000174b0: 6973 2069 7320 6661 7374 6572 2074 6861  is is faster tha
-000174c0: 6e20 636f 6e76 6572 7469 6e67 2065 6163  n converting eac
-000174d0: 6820 636f 6c75 6d6e 2074 6f20 6e75 6d65  h column to nume
-000174e0: 7269 6320 7768 656e 2069 7427 7320 6e6f  ric when it's no
-000174f0: 7420 6e65 6365 7373 6172 790a 2020 2020  t necessary.    
-00017500: 2020 2020 2020 2020 2320 7369 6e63 6520          # since 
-00017510: 6561 6368 2073 7461 6e64 6172 6420 6465  each standard de
-00017520: 7669 6174 696f 6e20 7769 6c6c 206a 7573  viation will jus
-00017530: 7420 6265 204e 614e 0a20 2020 2020 2020  t be NaN.       
-00017540: 2020 2020 206e 6565 6473 5f74 696d 655f       needs_time_
-00017550: 636f 6e76 6572 7369 6f6e 203d 2046 616c  conversion = Fal
-00017560: 7365 0a20 2020 2020 2020 2020 2020 206e  se.            n
-00017570: 756d 6572 6963 5f64 6420 3d20 6672 6f6d  umeric_dd = from
-00017580: 5f70 616e 6461 7328 0a20 2020 2020 2020  _pandas(.       
-00017590: 2020 2020 2020 2020 206d 6574 615f 6672           meta_fr
-000175a0: 616d 655f 636f 6e73 7472 7563 746f 7228  ame_constructor(
-000175b0: 7365 6c66 2928 0a20 2020 2020 2020 2020  self)(.         
-000175c0: 2020 2020 2020 2020 2020 207b 225f 223a             {"_":
-000175d0: 206d 6574 615f 7365 7269 6573 5f63 6f6e   meta_series_con
-000175e0: 7374 7275 6374 6f72 2873 656c 6629 285b  structor(self)([
-000175f0: 6e70 2e6e 616e 5d29 7d2c 0a20 2020 2020  np.nan])},.     
-00017600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017610: 6e64 6578 3d73 656c 662e 696e 6465 782c  ndex=self.index,
-00017620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017630: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-00017640: 2020 2020 6e70 6172 7469 7469 6f6e 733d      npartitions=
-00017650: 7365 6c66 2e6e 7061 7274 6974 696f 6e73  self.npartitions
-00017660: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00017670: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00017680: 2020 2020 2020 2020 2020 2320 436f 6e76            # Conv
-00017690: 6572 7420 7469 6d65 6465 6c74 6120 616e  ert timedelta an
-000176a0: 6420 6461 7465 7469 6d65 2063 6f6c 756d  d datetime colum
-000176b0: 6e73 2074 6f20 696e 7465 6765 7220 7479  ns to integer ty
-000176c0: 7065 7320 736f 2077 6520 6361 6e20 7573  pes so we can us
-000176d0: 6520 7661 720a 2020 2020 2020 2020 2020  e var.          
-000176e0: 2020 666f 7220 636f 6c20 696e 2074 696d    for col in tim
-000176f0: 655f 636f 6c73 3a0a 2020 2020 2020 2020  e_cols:.        
-00017700: 2020 2020 2020 2020 6e75 6d65 7269 635f          numeric_
-00017710: 6464 5b63 6f6c 5d20 3d20 5f63 6f6e 7665  dd[col] = _conve
-00017720: 7274 5f74 6f5f 6e75 6d65 7269 6328 6e75  rt_to_numeric(nu
-00017730: 6d65 7269 635f 6464 5b63 6f6c 5d2c 2073  meric_dd[col], s
-00017740: 6b69 706e 6129 0a0a 2020 2020 2020 2020  kipna)..        
-00017750: 7265 7475 726e 206e 756d 6572 6963 5f64  return numeric_d
-00017760: 642c 206e 6565 6473 5f74 696d 655f 636f  d, needs_time_co
-00017770: 6e76 6572 7369 6f6e 0a0a 2020 2020 4064  nversion..    @d
-00017780: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
-00017790: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
-000177a0: 6620 736b 6577 280a 2020 2020 2020 2020  f skew(.        
-000177b0: 7365 6c66 2c0a 2020 2020 2020 2020 6178  self,.        ax
-000177c0: 6973 3d30 2c0a 2020 2020 2020 2020 6269  is=0,.        bi
-000177d0: 6173 3d54 7275 652c 0a20 2020 2020 2020  as=True,.       
-000177e0: 206e 616e 5f70 6f6c 6963 793d 2270 726f   nan_policy="pro
-000177f0: 7061 6761 7465 222c 0a20 2020 2020 2020  pagate",.       
-00017800: 206f 7574 3d4e 6f6e 652c 0a20 2020 2020   out=None,.     
-00017810: 2020 206e 756d 6572 6963 5f6f 6e6c 793d     numeric_only=
-00017820: 6e6f 5f64 6566 6175 6c74 2c0a 2020 2020  no_default,.    
-00017830: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00017840: 2020 2020 2020 202e 2e20 6e6f 7465 3a3a         .. note::
-00017850: 0a0a 2020 2020 2020 2020 2020 2054 6869  ..           Thi
-00017860: 7320 696d 706c 656d 656e 7461 7469 6f6e  s implementation
-00017870: 2066 6f6c 6c6f 7773 2074 6865 2064 6173   follows the das
-00017880: 6b2e 6172 7261 792e 7374 6174 7320 696d  k.array.stats im
-00017890: 706c 656d 656e 7461 7469 6f6e 0a20 2020  plementation.   
-000178a0: 2020 2020 2020 2020 6f66 2073 6b65 776e          of skewn
-000178b0: 6573 7320 616e 6420 6361 6c63 756c 6174  ess and calculat
-000178c0: 6573 2073 6b65 776e 6573 7320 7769 7468  es skewness with
-000178d0: 6f75 7420 7461 6b69 6e67 2069 6e74 6f20  out taking into 
-000178e0: 6163 636f 756e 740a 2020 2020 2020 2020  account.        
-000178f0: 2020 2061 2062 6961 7320 7465 726d 2066     a bias term f
-00017900: 6f72 2066 696e 6974 6520 7361 6d70 6c65  or finite sample
-00017910: 2073 697a 652c 2077 6869 6368 2063 6f72   size, which cor
-00017920: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
-00017930: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00017940: 6c74 2073 6574 7469 6e67 7320 6f66 2074  lt settings of t
-00017950: 6865 2073 6369 7079 2e73 7461 7473 2073  he scipy.stats s
-00017960: 6b65 776e 6573 7320 6361 6c63 756c 6174  kewness calculat
-00017970: 696f 6e2e 2048 6f77 6576 6572 2c0a 2020  ion. However,.  
-00017980: 2020 2020 2020 2020 2050 616e 6461 7320           Pandas 
-00017990: 636f 7272 6563 7473 2066 6f72 2074 6869  corrects for thi
-000179a0: 732c 2073 6f20 7468 6520 7661 6c75 6573  s, so the values
-000179b0: 2064 6966 6665 7220 6279 2061 2066 6163   differ by a fac
-000179c0: 746f 7220 6f66 0a20 2020 2020 2020 2020  tor of.         
-000179d0: 2020 286e 202a 2028 6e20 2d20 3129 2920    (n * (n - 1)) 
-000179e0: 2a2a 2030 2e35 202f 2028 6e20 2d20 3229  ** 0.5 / (n - 2)
-000179f0: 2c20 7768 6572 6520 6e20 6973 2074 6865  , where n is the
-00017a00: 206e 756d 6265 7220 6f66 2073 616d 706c   number of sampl
-00017a10: 6573 2e0a 0a20 2020 2020 2020 2020 2020  es...           
-00017a20: 4675 7274 6865 722c 2074 6869 7320 6d65  Further, this me
-00017a30: 7468 6f64 2063 7572 7265 6e74 6c79 2064  thod currently d
-00017a40: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
-00017a50: 6669 6c74 6572 696e 6720 6f75 7420 4e61  filtering out Na
-00017a60: 4e0a 2020 2020 2020 2020 2020 2076 616c  N.           val
-00017a70: 7565 732c 2077 6869 6368 2069 7320 6167  ues, which is ag
-00017a80: 6169 6e20 6120 6469 6666 6572 656e 6365  ain a difference
-00017a90: 2074 6f20 5061 6e64 6173 2e0a 2020 2020   to Pandas..    
-00017aa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00017ab0: 6966 2050 414e 4441 535f 4754 5f32 3030  if PANDAS_GT_200
-00017ac0: 2061 6e64 2061 7869 7320 6973 204e 6f6e   and axis is Non
-00017ad0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00017ae0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00017af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017b00: 2022 6061 7869 733d 4e6f 6e65 6020 6973   "`axis=None` is
-00017b10: 6e27 7420 6375 7272 656e 746c 7920 7375  n't currently su
-00017b20: 7070 6f72 7465 6420 666f 7220 6073 6b65  pported for `ske
-00017b30: 7760 2077 6865 6e20 7573 696e 6720 6070  w` when using `p
-00017b40: 616e 6461 7320 3e3d 3260 2022 0a20 2020  andas >=2` ".   
-00017b50: 2020 2020 2020 2020 2020 2020 2066 2228               f"(
-00017b60: 7061 6e64 6173 3d7b 7374 7228 5041 4e44  pandas={str(PAND
-00017b70: 4153 5f56 4552 5349 4f4e 297d 2069 7320  AS_VERSION)} is 
-00017b80: 696e 7374 616c 6c65 6429 2e22 0a20 2020  installed).".   
-00017b90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00017ba0: 2020 2061 7869 7320 3d20 7365 6c66 2e5f     axis = self._
-00017bb0: 7661 6c69 6461 7465 5f61 7869 7328 6178  validate_axis(ax
-00017bc0: 6973 290a 2020 2020 2020 2020 5f72 6169  is).        _rai
-00017bd0: 7365 5f69 665f 6f62 6a65 6374 5f73 6572  se_if_object_ser
-00017be0: 6965 7328 7365 6c66 2c20 2273 6b65 7722  ies(self, "skew"
-00017bf0: 290a 2020 2020 2020 2020 6e75 6d65 7269  ).        numeri
-00017c00: 635f 6f6e 6c79 5f6b 7761 7267 7320 3d20  c_only_kwargs = 
-00017c10: 6765 745f 6e75 6d65 7269 635f 6f6e 6c79  get_numeric_only
-00017c20: 5f6b 7761 7267 7328 6e75 6d65 7269 635f  _kwargs(numeric_
-00017c30: 6f6e 6c79 290a 0a20 2020 2020 2020 2069  only)..        i
-00017c40: 6620 6973 5f64 6174 6166 7261 6d65 5f6c  f is_dataframe_l
-00017c50: 696b 6528 7365 6c66 293a 0a20 2020 2020  ike(self):.     
-00017c60: 2020 2020 2020 2023 204c 6574 2070 616e         # Let pan
-00017c70: 6461 7320 7261 6973 6520 6572 726f 7273  das raise errors
-00017c80: 2069 6620 6e65 6365 7373 6172 790a 2020   if necessary.  
-00017c90: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
-00017ca0: 2073 656c 662e 5f6d 6574 615f 6e6f 6e65   self._meta_none
-00017cb0: 6d70 7479 2e73 6b65 7728 6178 6973 3d61  mpty.skew(axis=a
-00017cc0: 7869 732c 202a 2a6e 756d 6572 6963 5f6f  xis, **numeric_o
-00017cd0: 6e6c 795f 6b77 6172 6773 290a 2020 2020  nly_kwargs).    
-00017ce0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00017cf0: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
-00017d00: 662e 5f6d 6574 615f 6e6f 6e65 6d70 7479  f._meta_nonempty
-00017d10: 2e73 6b65 7728 290a 0a20 2020 2020 2020  .skew()..       
-00017d20: 2069 6620 6178 6973 203d 3d20 313a 0a20   if axis == 1:. 
-00017d30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-00017d40: 7420 3d20 6d61 705f 7061 7274 6974 696f  t = map_partitio
-00017d50: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
-00017d60: 2020 2020 4d2e 736b 6577 2c0a 2020 2020      M.skew,.    
-00017d70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00017d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017d90: 2020 6d65 7461 3d6d 6574 612c 0a20 2020    meta=meta,.   
-00017da0: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
-00017db0: 656e 3d73 656c 662e 5f74 6f6b 656e 5f70  en=self._token_p
-00017dc0: 7265 6669 7820 2b20 2273 6b65 7722 2c0a  refix + "skew",.
-00017dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017de0: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
-00017df0: 2020 2020 2020 2020 2020 2065 6e66 6f72             enfor
-00017e00: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-00017e10: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-00017e20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00017e30: 7572 6e20 6861 6e64 6c65 5f6f 7574 286f  urn handle_out(o
-00017e40: 7574 2c20 7265 7375 6c74 290a 2020 2020  ut, result).    
-00017e50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00017e60: 2020 2020 2020 6966 2073 656c 662e 6e64        if self.nd
-00017e70: 696d 203d 3d20 313a 0a20 2020 2020 2020  im == 1:.       
-00017e80: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00017e90: 3d20 7365 6c66 2e5f 736b 6577 5f31 6428  = self._skew_1d(
-00017ea0: 7365 6c66 2c20 6269 6173 3d62 6961 732c  self, bias=bias,
-00017eb0: 206e 616e 5f70 6f6c 6963 793d 6e61 6e5f   nan_policy=nan_
-00017ec0: 706f 6c69 6379 290a 2020 2020 2020 2020  policy).        
-00017ed0: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-00017ee0: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
-00017ef0: 6573 756c 7429 0a20 2020 2020 2020 2020  esult).         
-00017f00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00017f10: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00017f20: 3d20 7365 6c66 2e5f 736b 6577 5f6e 756d  = self._skew_num
-00017f30: 6572 6963 2862 6961 733d 6269 6173 2c20  eric(bias=bias, 
-00017f40: 6e61 6e5f 706f 6c69 6379 3d6e 616e 5f70  nan_policy=nan_p
-00017f50: 6f6c 6963 7929 0a0a 2020 2020 2020 2020  olicy)..        
-00017f60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00017f70: 6528 7365 6c66 2c20 4461 7461 4672 616d  e(self, DataFram
-00017f80: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00017f90: 2020 2020 7265 7375 6c74 2e64 6976 6973      result.divis
-00017fa0: 696f 6e73 203d 2028 7365 6c66 2e63 6f6c  ions = (self.col
-00017fb0: 756d 6e73 2e6d 696e 2829 2c20 7365 6c66  umns.min(), self
-00017fc0: 2e63 6f6c 756d 6e73 2e6d 6178 2829 290a  .columns.max()).
-00017fd0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00017fe0: 7572 6e20 6861 6e64 6c65 5f6f 7574 286f  urn handle_out(o
-00017ff0: 7574 2c20 7265 7375 6c74 290a 0a20 2020  ut, result)..   
-00018000: 2064 6566 205f 736b 6577 5f31 6428 7365   def _skew_1d(se
-00018010: 6c66 2c20 636f 6c75 6d6e 2c20 6269 6173  lf, column, bias
-00018020: 3d54 7275 652c 206e 616e 5f70 6f6c 6963  =True, nan_polic
-00018030: 793d 2270 726f 7061 6761 7465 2229 3a0a  y="propagate"):.
-00018040: 2020 2020 2020 2020 2222 2231 4420 7665          """1D ve
-00018050: 7273 696f 6e20 6f66 2074 6865 2073 6b65  rsion of the ske
-00018060: 7720 6361 6c63 756c 6174 696f 6e2e 0a0a  w calculation...
-00018070: 2020 2020 2020 2020 5573 6573 2074 6865          Uses the
-00018080: 2061 7272 6179 2076 6572 7369 6f6e 2066   array version f
-00018090: 726f 6d20 6461 2e73 7461 7473 2069 6e20  rom da.stats in 
-000180a0: 6361 7365 2077 6520 6172 6520 7061 7373  case we are pass
-000180b0: 696e 6720 696e 2061 2073 696e 676c 6520  ing in a single 
-000180c0: 7365 7269 6573 0a20 2020 2020 2020 2022  series.        "
-000180d0: 2222 0a20 2020 2020 2020 2023 2069 6d70  "".        # imp
-000180e0: 6f72 7420 6465 7065 6e64 7320 6f6e 2073  ort depends on s
-000180f0: 6369 7079 2c20 6e6f 7420 696e 7374 616c  cipy, not instal
-00018100: 6c65 6420 6279 2064 6566 6175 6c74 0a20  led by default. 
-00018110: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-00018120: 2e61 7272 6179 2069 6d70 6f72 7420 7374  .array import st
-00018130: 6174 7320 6173 2064 615f 7374 6174 730a  ats as da_stats.
-00018140: 0a20 2020 2020 2020 2069 6620 7064 2e61  .        if pd.a
-00018150: 7069 2e74 7970 6573 2e69 735f 6578 7465  pi.types.is_exte
-00018160: 6e73 696f 6e5f 6172 7261 795f 6474 7970  nsion_array_dtyp
-00018170: 6528 636f 6c75 6d6e 2e5f 6d65 7461 5f6e  e(column._meta_n
-00018180: 6f6e 656d 7074 7929 3a0a 2020 2020 2020  onempty):.      
-00018190: 2020 2020 2020 636f 6c75 6d6e 203d 2063        column = c
-000181a0: 6f6c 756d 6e2e 6173 7479 7065 2822 6638  olumn.astype("f8
-000181b0: 2229 0a0a 2020 2020 2020 2020 656c 6966  ")..        elif
-000181c0: 206e 6f74 206e 702e 6973 7375 6264 7479   not np.issubdty
-000181d0: 7065 2863 6f6c 756d 6e2e 6474 7970 652c  pe(column.dtype,
-000181e0: 206e 702e 6e75 6d62 6572 293a 0a20 2020   np.number):.   
-000181f0: 2020 2020 2020 2020 2063 6f6c 756d 6e20           column 
-00018200: 3d20 636f 6c75 6d6e 2e61 7374 7970 6528  = column.astype(
-00018210: 2266 3822 290a 0a20 2020 2020 2020 206e  "f8")..        n
-00018220: 616d 6520 3d20 7365 6c66 2e5f 746f 6b65  ame = self._toke
-00018230: 6e5f 7072 6566 6978 202b 2022 736b 6577  n_prefix + "skew
-00018240: 2d31 642d 2220 2b20 746f 6b65 6e69 7a65  -1d-" + tokenize
-00018250: 2863 6f6c 756d 6e29 0a0a 2020 2020 2020  (column)..      
-00018260: 2020 6172 7261 795f 736b 6577 203d 2064    array_skew = d
-00018270: 615f 7374 6174 732e 736b 6577 280a 2020  a_stats.skew(.  
-00018280: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00018290: 2e76 616c 7565 732c 2061 7869 733d 302c  .values, axis=0,
-000182a0: 2062 6961 733d 6269 6173 2c20 6e61 6e5f   bias=bias, nan_
-000182b0: 706f 6c69 6379 3d6e 616e 5f70 6f6c 6963  policy=nan_polic
-000182c0: 790a 2020 2020 2020 2020 290a 0a20 2020  y.        )..   
-000182d0: 2020 2020 206c 6179 6572 203d 207b 286e       layer = {(n
-000182e0: 616d 652c 2030 293a 2028 6d65 7468 6f64  ame, 0): (method
-000182f0: 732e 7772 6170 5f73 6b65 775f 7265 6475  s.wrap_skew_redu
-00018300: 6374 696f 6e2c 2028 6172 7261 795f 736b  ction, (array_sk
-00018310: 6577 2e5f 6e61 6d65 2c29 2c20 4e6f 6e65  ew._name,), None
-00018320: 297d 0a20 2020 2020 2020 2067 7261 7068  )}.        graph
-00018330: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
-00018340: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
-00018350: 6e73 286e 616d 652c 206c 6179 6572 2c20  ns(name, layer, 
-00018360: 6465 7065 6e64 656e 6369 6573 3d5b 6172  dependencies=[ar
-00018370: 7261 795f 736b 6577 5d29 0a0a 2020 2020  ray_skew])..    
-00018380: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
-00018390: 645f 6f62 6a65 6374 280a 2020 2020 2020  d_object(.      
-000183a0: 2020 2020 2020 6772 6170 682c 206e 616d        graph, nam
-000183b0: 652c 2063 6f6c 756d 6e2e 5f6d 6574 615f  e, column._meta_
-000183c0: 6e6f 6e65 6d70 7479 2e73 6b65 7728 292c  nonempty.skew(),
-000183d0: 2064 6976 6973 696f 6e73 3d5b 4e6f 6e65   divisions=[None
-000183e0: 2c20 4e6f 6e65 5d0a 2020 2020 2020 2020  , None].        
-000183f0: 290a 0a20 2020 2064 6566 205f 736b 6577  )..    def _skew
-00018400: 5f6e 756d 6572 6963 2873 656c 662c 2062  _numeric(self, b
-00018410: 6961 733d 5472 7565 2c20 6e61 6e5f 706f  ias=True, nan_po
-00018420: 6c69 6379 3d22 7072 6f70 6167 6174 6522  licy="propagate"
-00018430: 293a 0a20 2020 2020 2020 2022 2222 4d65  ):.        """Me
-00018440: 7468 6f64 2066 6f72 2064 6174 6166 7261  thod for datafra
-00018450: 6d65 7320 7769 7468 206e 756d 6572 6963  mes with numeric
-00018460: 2063 6f6c 756d 6e73 2e0a 0a20 2020 2020   columns...     
-00018470: 2020 204d 6170 7320 7468 6520 6172 7261     Maps the arra
-00018480: 7920 7665 7273 696f 6e20 6672 6f6d 2064  y version from d
-00018490: 612e 7374 6174 7320 6f6e 746f 2074 6865  a.stats onto the
-000184a0: 206e 756d 6572 6963 2061 7272 6179 206f   numeric array o
-000184b0: 6620 636f 6c75 6d6e 732e 0a20 2020 2020  f columns..     
-000184c0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-000184d0: 2069 6d70 6f72 7420 6465 7065 6e64 7320   import depends 
-000184e0: 6f6e 2073 6369 7079 2c20 6e6f 7420 696e  on scipy, not in
-000184f0: 7374 616c 6c65 6420 6279 2064 6566 6175  stalled by defau
-00018500: 6c74 0a20 2020 2020 2020 2066 726f 6d20  lt.        from 
-00018510: 6461 736b 2e61 7272 6179 2069 6d70 6f72  dask.array impor
-00018520: 7420 7374 6174 7320 6173 2064 615f 7374  t stats as da_st
-00018530: 6174 730a 0a20 2020 2020 2020 206e 756d  ats..        num
-00018540: 203d 2073 656c 662e 7365 6c65 6374 5f64   = self.select_d
-00018550: 7479 7065 7328 696e 636c 7564 653d 5b22  types(include=["
-00018560: 6e75 6d62 6572 222c 2022 626f 6f6c 225d  number", "bool"]
-00018570: 2c20 6578 636c 7564 653d 5b6e 702e 7469  , exclude=[np.ti
-00018580: 6d65 6465 6c74 6136 345d 290a 0a20 2020  medelta64])..   
-00018590: 2020 2020 2076 616c 7565 735f 6474 7970       values_dtyp
-000185a0: 6520 3d20 6e75 6d2e 7661 6c75 6573 2e64  e = num.values.d
-000185b0: 7479 7065 0a20 2020 2020 2020 2061 7272  type.        arr
-000185c0: 6179 5f76 616c 7565 7320 3d20 6e75 6d2e  ay_values = num.
-000185d0: 7661 6c75 6573 0a0a 2020 2020 2020 2020  values..        
-000185e0: 6966 206e 6f74 206e 702e 6973 7375 6264  if not np.issubd
-000185f0: 7479 7065 2876 616c 7565 735f 6474 7970  type(values_dtyp
-00018600: 652c 206e 702e 6e75 6d62 6572 293a 0a20  e, np.number):. 
-00018610: 2020 2020 2020 2020 2020 2061 7272 6179             array
-00018620: 5f76 616c 7565 7320 3d20 6e75 6d2e 7661  _values = num.va
-00018630: 6c75 6573 2e61 7374 7970 6528 2266 3822  lues.astype("f8"
-00018640: 290a 0a20 2020 2020 2020 2061 7272 6179  )..        array
-00018650: 5f73 6b65 7720 3d20 6461 5f73 7461 7473  _skew = da_stats
-00018660: 2e73 6b65 7728 0a20 2020 2020 2020 2020  .skew(.         
-00018670: 2020 2061 7272 6179 5f76 616c 7565 732c     array_values,
-00018680: 2061 7869 733d 302c 2062 6961 733d 6269   axis=0, bias=bi
-00018690: 6173 2c20 6e61 6e5f 706f 6c69 6379 3d6e  as, nan_policy=n
-000186a0: 616e 5f70 6f6c 6963 790a 2020 2020 2020  an_policy.      
-000186b0: 2020 290a 0a20 2020 2020 2020 206e 616d    )..        nam
-000186c0: 6520 3d20 7365 6c66 2e5f 746f 6b65 6e5f  e = self._token_
-000186d0: 7072 6566 6978 202b 2022 7661 722d 6e75  prefix + "var-nu
-000186e0: 6d65 7269 6322 202b 2074 6f6b 656e 697a  meric" + tokeniz
-000186f0: 6528 6e75 6d29 0a20 2020 2020 2020 2063  e(num).        c
-00018700: 6f6c 7320 3d20 6e75 6d2e 5f6d 6574 612e  ols = num._meta.
-00018710: 636f 6c75 6d6e 7320 6966 2069 735f 6461  columns if is_da
-00018720: 7461 6672 616d 655f 6c69 6b65 286e 756d  taframe_like(num
-00018730: 2920 656c 7365 204e 6f6e 650a 0a20 2020  ) else None..   
-00018740: 2020 2020 2077 6974 6820 6368 6563 6b5f       with check_
-00018750: 7265 6475 6374 696f 6e73 5f72 756e 7469  reductions_runti
-00018760: 6d65 5f77 6172 6e69 6e67 2829 3a0a 2020  me_warning():.  
-00018770: 2020 2020 2020 2020 2020 736b 6577 5f73            skew_s
-00018780: 6861 7065 203d 206e 756d 2e5f 6d65 7461  hape = num._meta
-00018790: 5f6e 6f6e 656d 7074 792e 7661 7228 6178  _nonempty.var(ax
-000187a0: 6973 3d30 292e 7368 6170 650a 2020 2020  is=0).shape.    
-000187b0: 2020 2020 6172 7261 795f 736b 6577 5f6e      array_skew_n
-000187c0: 616d 6520 3d20 2861 7272 6179 5f73 6b65  ame = (array_ske
-000187d0: 772e 5f6e 616d 652c 2920 2b20 2830 2c29  w._name,) + (0,)
-000187e0: 202a 206c 656e 2873 6b65 775f 7368 6170   * len(skew_shap
-000187f0: 6529 0a0a 2020 2020 2020 2020 6c61 7965  e)..        laye
-00018800: 7220 3d20 7b28 6e61 6d65 2c20 3029 3a20  r = {(name, 0): 
-00018810: 286d 6574 686f 6473 2e77 7261 705f 736b  (methods.wrap_sk
-00018820: 6577 5f72 6564 7563 7469 6f6e 2c20 6172  ew_reduction, ar
-00018830: 7261 795f 736b 6577 5f6e 616d 652c 2063  ray_skew_name, c
-00018840: 6f6c 7329 7d0a 2020 2020 2020 2020 6772  ols)}.        gr
-00018850: 6170 6820 3d20 4869 6768 4c65 7665 6c47  aph = HighLevelG
-00018860: 7261 7068 2e66 726f 6d5f 636f 6c6c 6563  raph.from_collec
-00018870: 7469 6f6e 7328 6e61 6d65 2c20 6c61 7965  tions(name, laye
-00018880: 722c 2064 6570 656e 6465 6e63 6965 733d  r, dependencies=
-00018890: 5b61 7272 6179 5f73 6b65 775d 290a 0a20  [array_skew]).. 
-000188a0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
-000188b0: 775f 6464 5f6f 626a 6563 7428 0a20 2020  w_dd_object(.   
-000188c0: 2020 2020 2020 2020 2067 7261 7068 2c20           graph, 
-000188d0: 6e61 6d65 2c20 6e75 6d2e 5f6d 6574 615f  name, num._meta_
-000188e0: 6e6f 6e65 6d70 7479 2e73 6b65 7728 292c  nonempty.skew(),
-000188f0: 2064 6976 6973 696f 6e73 3d5b 4e6f 6e65   divisions=[None
-00018900: 2c20 4e6f 6e65 5d0a 2020 2020 2020 2020  , None].        
-00018910: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-00018920: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-00018930: 6529 0a20 2020 2064 6566 206b 7572 746f  e).    def kurto
-00018940: 7369 7328 0a20 2020 2020 2020 2073 656c  sis(.        sel
-00018950: 662c 0a20 2020 2020 2020 2061 7869 733d  f,.        axis=
-00018960: 302c 0a20 2020 2020 2020 2066 6973 6865  0,.        fishe
-00018970: 723d 5472 7565 2c0a 2020 2020 2020 2020  r=True,.        
-00018980: 6269 6173 3d54 7275 652c 0a20 2020 2020  bias=True,.     
-00018990: 2020 206e 616e 5f70 6f6c 6963 793d 2270     nan_policy="p
-000189a0: 726f 7061 6761 7465 222c 0a20 2020 2020  ropagate",.     
-000189b0: 2020 206f 7574 3d4e 6f6e 652c 0a20 2020     out=None,.   
-000189c0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
-000189d0: 793d 6e6f 5f64 6566 6175 6c74 2c0a 2020  y=no_default,.  
-000189e0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-000189f0: 0a20 2020 2020 2020 202e 2e20 6e6f 7465  .        .. note
-00018a00: 3a3a 0a0a 2020 2020 2020 2020 2020 2054  ::..           T
-00018a10: 6869 7320 696d 706c 656d 656e 7461 7469  his implementati
-00018a20: 6f6e 2066 6f6c 6c6f 7773 2074 6865 2064  on follows the d
-00018a30: 6173 6b2e 6172 7261 792e 7374 6174 7320  ask.array.stats 
-00018a40: 696d 706c 656d 656e 7461 7469 6f6e 0a20  implementation. 
-00018a50: 2020 2020 2020 2020 2020 6f66 206b 7572            of kur
-00018a60: 746f 7369 7320 616e 6420 6361 6c63 756c  tosis and calcul
-00018a70: 6174 6573 206b 7572 746f 7369 7320 7769  ates kurtosis wi
-00018a80: 7468 6f75 7420 7461 6b69 6e67 2069 6e74  thout taking int
-00018a90: 6f20 6163 636f 756e 740a 2020 2020 2020  o account.      
-00018aa0: 2020 2020 2061 2062 6961 7320 7465 726d       a bias term
-00018ab0: 2066 6f72 2066 696e 6974 6520 7361 6d70   for finite samp
-00018ac0: 6c65 2073 697a 652c 2077 6869 6368 2063  le size, which c
-00018ad0: 6f72 7265 7370 6f6e 6473 2074 6f20 7468  orresponds to th
-00018ae0: 650a 2020 2020 2020 2020 2020 2064 6566  e.           def
-00018af0: 6175 6c74 2073 6574 7469 6e67 7320 6f66  ault settings of
-00018b00: 2074 6865 2073 6369 7079 2e73 7461 7473   the scipy.stats
-00018b10: 206b 7572 746f 7369 7320 6361 6c63 756c   kurtosis calcul
-00018b20: 6174 696f 6e2e 2054 6869 7320 6469 6666  ation. This diff
-00018b30: 6572 730a 2020 2020 2020 2020 2020 2066  ers.           f
-00018b40: 726f 6d20 7061 6e64 6173 2e0a 0a20 2020  rom pandas...   
-00018b50: 2020 2020 2020 2020 4675 7274 6865 722c          Further,
-00018b60: 2074 6869 7320 6d65 7468 6f64 2063 7572   this method cur
-00018b70: 7265 6e74 6c79 2064 6f65 7320 6e6f 7420  rently does not 
-00018b80: 7375 7070 6f72 7420 6669 6c74 6572 696e  support filterin
-00018b90: 6720 6f75 7420 4e61 4e0a 2020 2020 2020  g out NaN.      
-00018ba0: 2020 2020 2076 616c 7565 732c 2077 6869       values, whi
-00018bb0: 6368 2069 7320 6167 6169 6e20 6120 6469  ch is again a di
-00018bc0: 6666 6572 656e 6365 2074 6f20 5061 6e64  fference to Pand
-00018bd0: 6173 2e0a 2020 2020 2020 2020 2222 220a  as..        """.
-00018be0: 2020 2020 2020 2020 6966 2050 414e 4441          if PANDA
-00018bf0: 535f 4754 5f32 3030 2061 6e64 2061 7869  S_GT_200 and axi
-00018c00: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00018c10: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00018c20: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-00018c30: 2020 2020 2020 2020 2022 6061 7869 733d           "`axis=
-00018c40: 4e6f 6e65 6020 6973 6e27 7420 6375 7272  None` isn't curr
-00018c50: 656e 746c 7920 7375 7070 6f72 7465 6420  ently supported 
-00018c60: 666f 7220 606b 7572 746f 7369 7360 2077  for `kurtosis` w
-00018c70: 6865 6e20 7573 696e 6720 6070 616e 6461  hen using `panda
-00018c80: 7320 3e3d 3260 2022 0a20 2020 2020 2020  s >=2` ".       
-00018c90: 2020 2020 2020 2020 2066 2228 7061 6e64           f"(pand
-00018ca0: 6173 3d7b 7374 7228 5041 4e44 4153 5f56  as={str(PANDAS_V
-00018cb0: 4552 5349 4f4e 297d 2069 7320 696e 7374  ERSION)} is inst
-00018cc0: 616c 6c65 6429 2e22 0a20 2020 2020 2020  alled).".       
-00018cd0: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-00018ce0: 7869 7320 3d20 7365 6c66 2e5f 7661 6c69  xis = self._vali
-00018cf0: 6461 7465 5f61 7869 7328 6178 6973 290a  date_axis(axis).
-00018d00: 2020 2020 2020 2020 5f72 6169 7365 5f69          _raise_i
-00018d10: 665f 6f62 6a65 6374 5f73 6572 6965 7328  f_object_series(
-00018d20: 7365 6c66 2c20 226b 7572 746f 7369 7322  self, "kurtosis"
-00018d30: 290a 2020 2020 2020 2020 6e75 6d65 7269  ).        numeri
-00018d40: 635f 6f6e 6c79 5f6b 7761 7267 7320 3d20  c_only_kwargs = 
-00018d50: 6765 745f 6e75 6d65 7269 635f 6f6e 6c79  get_numeric_only
-00018d60: 5f6b 7761 7267 7328 6e75 6d65 7269 635f  _kwargs(numeric_
-00018d70: 6f6e 6c79 290a 0a20 2020 2020 2020 2069  only)..        i
-00018d80: 6620 6973 5f64 6174 6166 7261 6d65 5f6c  f is_dataframe_l
-00018d90: 696b 6528 7365 6c66 293a 0a20 2020 2020  ike(self):.     
-00018da0: 2020 2020 2020 2023 204c 6574 2070 616e         # Let pan
-00018db0: 6461 7320 7261 6973 6520 6572 726f 7273  das raise errors
-00018dc0: 2069 6620 6e65 6365 7373 6172 790a 2020   if necessary.  
-00018dd0: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
-00018de0: 2073 656c 662e 5f6d 6574 615f 6e6f 6e65   self._meta_none
-00018df0: 6d70 7479 2e6b 7572 746f 7369 7328 6178  mpty.kurtosis(ax
-00018e00: 6973 3d61 7869 732c 202a 2a6e 756d 6572  is=axis, **numer
-00018e10: 6963 5f6f 6e6c 795f 6b77 6172 6773 290a  ic_only_kwargs).
-00018e20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00018e30: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
-00018e40: 2073 656c 662e 5f6d 6574 615f 6e6f 6e65   self._meta_none
-00018e50: 6d70 7479 2e6b 7572 746f 7369 7328 290a  mpty.kurtosis().
-00018e60: 0a20 2020 2020 2020 2069 6620 6178 6973  .        if axis
-00018e70: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00018e80: 2020 2072 6573 756c 7420 3d20 6d61 705f     result = map_
-00018e90: 7061 7274 6974 696f 6e73 280a 2020 2020  partitions(.    
-00018ea0: 2020 2020 2020 2020 2020 2020 4d2e 6b75              M.ku
-00018eb0: 7274 6f73 6973 2c0a 2020 2020 2020 2020  rtosis,.        
-00018ec0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00018ed0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00018ee0: 7461 3d6d 6574 612c 0a20 2020 2020 2020  ta=meta,.       
-00018ef0: 2020 2020 2020 2020 2074 6f6b 656e 3d73           token=s
-00018f00: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
-00018f10: 7820 2b20 226b 7572 746f 7369 7322 2c0a  x + "kurtosis",.
-00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f30: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
-00018f40: 2020 2020 2020 2020 2020 2065 6e66 6f72             enfor
-00018f50: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-00018f60: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
-00018f70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00018f80: 7572 6e20 6861 6e64 6c65 5f6f 7574 286f  urn handle_out(o
-00018f90: 7574 2c20 7265 7375 6c74 290a 2020 2020  ut, result).    
-00018fa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018fb0: 2020 2020 2020 6966 2073 656c 662e 6e64        if self.nd
-00018fc0: 696d 203d 3d20 313a 0a20 2020 2020 2020  im == 1:.       
-00018fd0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00018fe0: 3d20 7365 6c66 2e5f 6b75 7274 6f73 6973  = self._kurtosis
-00018ff0: 5f31 6428 0a20 2020 2020 2020 2020 2020  _1d(.           
-00019000: 2020 2020 2020 2020 2073 656c 662c 2066           self, f
-00019010: 6973 6865 723d 6669 7368 6572 2c20 6269  isher=fisher, bi
-00019020: 6173 3d62 6961 732c 206e 616e 5f70 6f6c  as=bias, nan_pol
-00019030: 6963 793d 6e61 6e5f 706f 6c69 6379 0a20  icy=nan_policy. 
-00019040: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00019050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019060: 2072 6574 7572 6e20 6861 6e64 6c65 5f6f   return handle_o
-00019070: 7574 286f 7574 2c20 7265 7375 6c74 290a  ut(out, result).
-00019080: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019090: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000190a0: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
-000190b0: 5f6b 7572 746f 7369 735f 6e75 6d65 7269  _kurtosis_numeri
-000190c0: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
-000190d0: 2020 2020 2020 2066 6973 6865 723d 6669         fisher=fi
-000190e0: 7368 6572 2c20 6269 6173 3d62 6961 732c  sher, bias=bias,
-000190f0: 206e 616e 5f70 6f6c 6963 793d 6e61 6e5f   nan_policy=nan_
-00019100: 706f 6c69 6379 0a20 2020 2020 2020 2020  policy.         
-00019110: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00019120: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00019130: 6e63 6528 7365 6c66 2c20 4461 7461 4672  nce(self, DataFr
-00019140: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
-00019150: 2020 2020 2020 7265 7375 6c74 2e64 6976        result.div
-00019160: 6973 696f 6e73 203d 2028 7365 6c66 2e63  isions = (self.c
-00019170: 6f6c 756d 6e73 2e6d 696e 2829 2c20 7365  olumns.min(), se
-00019180: 6c66 2e63 6f6c 756d 6e73 2e6d 6178 2829  lf.columns.max()
-00019190: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-000191a0: 6574 7572 6e20 6861 6e64 6c65 5f6f 7574  eturn handle_out
-000191b0: 286f 7574 2c20 7265 7375 6c74 290a 0a20  (out, result).. 
-000191c0: 2020 2064 6566 205f 6b75 7274 6f73 6973     def _kurtosis
-000191d0: 5f31 6428 7365 6c66 2c20 636f 6c75 6d6e  _1d(self, column
-000191e0: 2c20 6669 7368 6572 3d54 7275 652c 2062  , fisher=True, b
-000191f0: 6961 733d 5472 7565 2c20 6e61 6e5f 706f  ias=True, nan_po
-00019200: 6c69 6379 3d22 7072 6f70 6167 6174 6522  licy="propagate"
-00019210: 293a 0a20 2020 2020 2020 2022 2222 3144  ):.        """1D
-00019220: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
-00019230: 6b75 7274 6f73 6973 2063 616c 6375 6c61  kurtosis calcula
-00019240: 7469 6f6e 2e0a 0a20 2020 2020 2020 2055  tion...        U
-00019250: 7365 7320 7468 6520 6172 7261 7920 7665  ses the array ve
-00019260: 7273 696f 6e20 6672 6f6d 2064 612e 7374  rsion from da.st
-00019270: 6174 7320 696e 2063 6173 6520 7765 2061  ats in case we a
-00019280: 7265 2070 6173 7369 6e67 2069 6e20 6120  re passing in a 
-00019290: 7369 6e67 6c65 2073 6572 6965 730a 2020  single series.  
-000192a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000192b0: 2020 2320 696d 706f 7274 2064 6570 656e    # import depen
-000192c0: 6473 206f 6e20 7363 6970 792c 206e 6f74  ds on scipy, not
-000192d0: 2069 6e73 7461 6c6c 6564 2062 7920 6465   installed by de
-000192e0: 6661 756c 740a 2020 2020 2020 2020 6672  fault.        fr
-000192f0: 6f6d 2064 6173 6b2e 6172 7261 7920 696d  om dask.array im
-00019300: 706f 7274 2073 7461 7473 2061 7320 6461  port stats as da
-00019310: 5f73 7461 7473 0a0a 2020 2020 2020 2020  _stats..        
-00019320: 6966 2070 642e 6170 692e 7479 7065 732e  if pd.api.types.
-00019330: 6973 5f65 7874 656e 7369 6f6e 5f61 7272  is_extension_arr
-00019340: 6179 5f64 7479 7065 2863 6f6c 756d 6e2e  ay_dtype(column.
-00019350: 5f6d 6574 615f 6e6f 6e65 6d70 7479 293a  _meta_nonempty):
-00019360: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00019370: 756d 6e20 3d20 636f 6c75 6d6e 2e61 7374  umn = column.ast
-00019380: 7970 6528 2266 3822 290a 0a20 2020 2020  ype("f8")..     
-00019390: 2020 2065 6c69 6620 6e6f 7420 6e70 2e69     elif not np.i
-000193a0: 7373 7562 6474 7970 6528 636f 6c75 6d6e  ssubdtype(column
-000193b0: 2e64 7479 7065 2c20 6e70 2e6e 756d 6265  .dtype, np.numbe
-000193c0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000193d0: 636f 6c75 6d6e 203d 2063 6f6c 756d 6e2e  column = column.
-000193e0: 6173 7479 7065 2822 6638 2229 0a0a 2020  astype("f8")..  
-000193f0: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
-00019400: 662e 5f74 6f6b 656e 5f70 7265 6669 7820  f._token_prefix 
-00019410: 2b20 226b 7572 746f 7369 732d 3164 2d22  + "kurtosis-1d-"
-00019420: 202b 2074 6f6b 656e 697a 6528 636f 6c75   + tokenize(colu
-00019430: 6d6e 290a 0a20 2020 2020 2020 2061 7272  mn)..        arr
-00019440: 6179 5f6b 7572 746f 7369 7320 3d20 6461  ay_kurtosis = da
-00019450: 5f73 7461 7473 2e6b 7572 746f 7369 7328  _stats.kurtosis(
-00019460: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00019470: 756d 6e2e 7661 6c75 6573 2c20 6178 6973  umn.values, axis
-00019480: 3d30 2c20 6669 7368 6572 3d66 6973 6865  =0, fisher=fishe
-00019490: 722c 2062 6961 733d 6269 6173 2c20 6e61  r, bias=bias, na
-000194a0: 6e5f 706f 6c69 6379 3d6e 616e 5f70 6f6c  n_policy=nan_pol
-000194b0: 6963 790a 2020 2020 2020 2020 290a 0a20  icy.        ).. 
-000194c0: 2020 2020 2020 206c 6179 6572 203d 207b         layer = {
-000194d0: 0a20 2020 2020 2020 2020 2020 2028 6e61  .            (na
-000194e0: 6d65 2c20 3029 3a20 286d 6574 686f 6473  me, 0): (methods
-000194f0: 2e77 7261 705f 6b75 7274 6f73 6973 5f72  .wrap_kurtosis_r
-00019500: 6564 7563 7469 6f6e 2c20 2861 7272 6179  eduction, (array
-00019510: 5f6b 7572 746f 7369 732e 5f6e 616d 652c  _kurtosis._name,
-00019520: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
-00019530: 207d 0a20 2020 2020 2020 2067 7261 7068   }.        graph
-00019540: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
-00019550: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
-00019560: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
-00019570: 6e61 6d65 2c20 6c61 7965 722c 2064 6570  name, layer, dep
-00019580: 656e 6465 6e63 6965 733d 5b61 7272 6179  endencies=[array
-00019590: 5f6b 7572 746f 7369 735d 0a20 2020 2020  _kurtosis].     
-000195a0: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
-000195b0: 7475 726e 206e 6577 5f64 645f 6f62 6a65  turn new_dd_obje
-000195c0: 6374 280a 2020 2020 2020 2020 2020 2020  ct(.            
-000195d0: 6772 6170 682c 206e 616d 652c 2063 6f6c  graph, name, col
-000195e0: 756d 6e2e 5f6d 6574 615f 6e6f 6e65 6d70  umn._meta_nonemp
-000195f0: 7479 2e6b 7572 746f 7369 7328 292c 2064  ty.kurtosis(), d
-00019600: 6976 6973 696f 6e73 3d5b 4e6f 6e65 2c20  ivisions=[None, 
-00019610: 4e6f 6e65 5d0a 2020 2020 2020 2020 290a  None].        ).
-00019620: 0a20 2020 2064 6566 205f 6b75 7274 6f73  .    def _kurtos
-00019630: 6973 5f6e 756d 6572 6963 2873 656c 662c  is_numeric(self,
-00019640: 2066 6973 6865 723d 5472 7565 2c20 6269   fisher=True, bi
-00019650: 6173 3d54 7275 652c 206e 616e 5f70 6f6c  as=True, nan_pol
-00019660: 6963 793d 2270 726f 7061 6761 7465 2229  icy="propagate")
-00019670: 3a0a 2020 2020 2020 2020 2222 224d 6574  :.        """Met
-00019680: 686f 6420 666f 7220 6461 7461 6672 616d  hod for datafram
-00019690: 6573 2077 6974 6820 6e75 6d65 7269 6320  es with numeric 
-000196a0: 636f 6c75 6d6e 732e 0a0a 2020 2020 2020  columns...      
-000196b0: 2020 4d61 7073 2074 6865 2061 7272 6179    Maps the array
-000196c0: 2076 6572 7369 6f6e 2066 726f 6d20 6461   version from da
-000196d0: 2e73 7461 7473 206f 6e74 6f20 7468 6520  .stats onto the 
-000196e0: 6e75 6d65 7269 6320 6172 7261 7920 6f66  numeric array of
-000196f0: 2063 6f6c 756d 6e73 2e0a 2020 2020 2020   columns..      
-00019700: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
-00019710: 696d 706f 7274 2064 6570 656e 6473 206f  import depends o
-00019720: 6e20 7363 6970 792c 206e 6f74 2069 6e73  n scipy, not ins
-00019730: 7461 6c6c 6564 2062 7920 6465 6661 756c  talled by defaul
-00019740: 740a 2020 2020 2020 2020 6672 6f6d 2064  t.        from d
-00019750: 6173 6b2e 6172 7261 7920 696d 706f 7274  ask.array import
-00019760: 2073 7461 7473 2061 7320 6461 5f73 7461   stats as da_sta
-00019770: 7473 0a0a 2020 2020 2020 2020 6e75 6d20  ts..        num 
-00019780: 3d20 7365 6c66 2e73 656c 6563 745f 6474  = self.select_dt
-00019790: 7970 6573 2869 6e63 6c75 6465 3d5b 226e  ypes(include=["n
-000197a0: 756d 6265 7222 2c20 2262 6f6f 6c22 5d2c  umber", "bool"],
-000197b0: 2065 7863 6c75 6465 3d5b 6e70 2e74 696d   exclude=[np.tim
-000197c0: 6564 656c 7461 3634 5d29 0a0a 2020 2020  edelta64])..    
-000197d0: 2020 2020 7661 6c75 6573 5f64 7479 7065      values_dtype
-000197e0: 203d 206e 756d 2e76 616c 7565 732e 6474   = num.values.dt
-000197f0: 7970 650a 2020 2020 2020 2020 6172 7261  ype.        arra
-00019800: 795f 7661 6c75 6573 203d 206e 756d 2e76  y_values = num.v
-00019810: 616c 7565 730a 0a20 2020 2020 2020 2069  alues..        i
-00019820: 6620 6e6f 7420 6e70 2e69 7373 7562 6474  f not np.issubdt
-00019830: 7970 6528 7661 6c75 6573 5f64 7479 7065  ype(values_dtype
-00019840: 2c20 6e70 2e6e 756d 6265 7229 3a0a 2020  , np.number):.  
-00019850: 2020 2020 2020 2020 2020 6172 7261 795f            array_
-00019860: 7661 6c75 6573 203d 206e 756d 2e76 616c  values = num.val
-00019870: 7565 732e 6173 7479 7065 2822 6638 2229  ues.astype("f8")
-00019880: 0a0a 2020 2020 2020 2020 6172 7261 795f  ..        array_
-00019890: 6b75 7274 6f73 6973 203d 2064 615f 7374  kurtosis = da_st
-000198a0: 6174 732e 6b75 7274 6f73 6973 280a 2020  ats.kurtosis(.  
-000198b0: 2020 2020 2020 2020 2020 6172 7261 795f            array_
-000198c0: 7661 6c75 6573 2c20 6178 6973 3d30 2c20  values, axis=0, 
-000198d0: 6669 7368 6572 3d66 6973 6865 722c 2062  fisher=fisher, b
-000198e0: 6961 733d 6269 6173 2c20 6e61 6e5f 706f  ias=bias, nan_po
-000198f0: 6c69 6379 3d6e 616e 5f70 6f6c 6963 790a  licy=nan_policy.
-00019900: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00019910: 2020 206e 616d 6520 3d20 7365 6c66 2e5f     name = self._
-00019920: 746f 6b65 6e5f 7072 6566 6978 202b 2022  token_prefix + "
-00019930: 6b75 7274 6f73 6973 2d6e 756d 6572 6963  kurtosis-numeric
-00019940: 2220 2b20 746f 6b65 6e69 7a65 286e 756d  " + tokenize(num
-00019950: 290a 2020 2020 2020 2020 636f 6c73 203d  ).        cols =
-00019960: 206e 756d 2e5f 6d65 7461 2e63 6f6c 756d   num._meta.colum
-00019970: 6e73 2069 6620 6973 5f64 6174 6166 7261  ns if is_datafra
-00019980: 6d65 5f6c 696b 6528 6e75 6d29 2065 6c73  me_like(num) els
-00019990: 6520 4e6f 6e65 0a0a 2020 2020 2020 2020  e None..        
-000199a0: 7769 7468 2063 6865 636b 5f72 6564 7563  with check_reduc
-000199b0: 7469 6f6e 735f 7275 6e74 696d 655f 7761  tions_runtime_wa
-000199c0: 726e 696e 6728 293a 0a20 2020 2020 2020  rning():.       
-000199d0: 2020 2020 206b 7572 746f 7369 735f 7368       kurtosis_sh
-000199e0: 6170 6520 3d20 6e75 6d2e 5f6d 6574 615f  ape = num._meta_
-000199f0: 6e6f 6e65 6d70 7479 2e76 6172 2861 7869  nonempty.var(axi
-00019a00: 733d 3029 2e73 6861 7065 0a20 2020 2020  s=0).shape.     
-00019a10: 2020 2061 7272 6179 5f6b 7572 746f 7369     array_kurtosi
-00019a20: 735f 6e61 6d65 203d 2028 6172 7261 795f  s_name = (array_
-00019a30: 6b75 7274 6f73 6973 2e5f 6e61 6d65 2c29  kurtosis._name,)
-00019a40: 202b 2028 302c 2920 2a20 6c65 6e28 6b75   + (0,) * len(ku
-00019a50: 7274 6f73 6973 5f73 6861 7065 290a 0a20  rtosis_shape).. 
-00019a60: 2020 2020 2020 206c 6179 6572 203d 207b         layer = {
-00019a70: 0a20 2020 2020 2020 2020 2020 2028 6e61  .            (na
-00019a80: 6d65 2c20 3029 3a20 286d 6574 686f 6473  me, 0): (methods
-00019a90: 2e77 7261 705f 6b75 7274 6f73 6973 5f72  .wrap_kurtosis_r
-00019aa0: 6564 7563 7469 6f6e 2c20 6172 7261 795f  eduction, array_
-00019ab0: 6b75 7274 6f73 6973 5f6e 616d 652c 2063  kurtosis_name, c
-00019ac0: 6f6c 7329 0a20 2020 2020 2020 207d 0a20  ols).        }. 
-00019ad0: 2020 2020 2020 2067 7261 7068 203d 2048         graph = H
-00019ae0: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
-00019af0: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 280a  om_collections(.
-00019b00: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00019b10: 2c20 6c61 7965 722c 2064 6570 656e 6465  , layer, depende
-00019b20: 6e63 6965 733d 5b61 7272 6179 5f6b 7572  ncies=[array_kur
-00019b30: 746f 7369 735d 0a20 2020 2020 2020 2029  tosis].        )
-00019b40: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00019b50: 206e 6577 5f64 645f 6f62 6a65 6374 280a   new_dd_object(.
-00019b60: 2020 2020 2020 2020 2020 2020 6772 6170              grap
-00019b70: 682c 206e 616d 652c 206e 756d 2e5f 6d65  h, name, num._me
-00019b80: 7461 5f6e 6f6e 656d 7074 792e 6b75 7274  ta_nonempty.kurt
-00019b90: 6f73 6973 2829 2c20 6469 7669 7369 6f6e  osis(), division
-00019ba0: 733d 5b4e 6f6e 652c 204e 6f6e 655d 0a20  s=[None, None]. 
-00019bb0: 2020 2020 2020 2029 0a0a 2020 2020 405f         )..    @_
-00019bc0: 6e75 6d65 7269 635f 6f6e 6c79 0a20 2020  numeric_only.   
-00019bd0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00019be0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-00019bf0: 2064 6566 2073 656d 2873 656c 662c 2061   def sem(self, a
-00019c00: 7869 733d 4e6f 6e65 2c20 736b 6970 6e61  xis=None, skipna
-00019c10: 3d54 7275 652c 2064 646f 663d 312c 2073  =True, ddof=1, s
-00019c20: 706c 6974 5f65 7665 7279 3d46 616c 7365  plit_every=False
-00019c30: 2c20 6e75 6d65 7269 635f 6f6e 6c79 3d4e  , numeric_only=N
-00019c40: 6f6e 6529 3a0a 2020 2020 2020 2020 6178  one):.        ax
-00019c50: 6973 203d 2073 656c 662e 5f76 616c 6964  is = self._valid
-00019c60: 6174 655f 6178 6973 2861 7869 7329 0a20  ate_axis(axis). 
-00019c70: 2020 2020 2020 205f 7261 6973 655f 6966         _raise_if
-00019c80: 5f6f 626a 6563 745f 7365 7269 6573 2873  _object_series(s
-00019c90: 656c 662c 2022 7365 6d22 290a 2020 2020  elf, "sem").    
-00019ca0: 2020 2020 7769 7468 2063 6865 636b 5f6e      with check_n
-00019cb0: 756d 6572 6963 5f6f 6e6c 795f 6465 7072  umeric_only_depr
-00019cc0: 6563 6174 696f 6e28 293a 0a20 2020 2020  ecation():.     
-00019cd0: 2020 2020 2020 206d 6574 6120 3d20 7365         meta = se
-00019ce0: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
-00019cf0: 792e 7365 6d28 0a20 2020 2020 2020 2020  y.sem(.         
-00019d00: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
-00019d10: 2c20 736b 6970 6e61 3d73 6b69 706e 612c  , skipna=skipna,
-00019d20: 2064 646f 663d 6464 6f66 2c20 6e75 6d65   ddof=ddof, nume
-00019d30: 7269 635f 6f6e 6c79 3d6e 756d 6572 6963  ric_only=numeric
-00019d40: 5f6f 6e6c 790a 2020 2020 2020 2020 2020  _only.          
-00019d50: 2020 290a 2020 2020 2020 2020 6966 2061    ).        if a
-00019d60: 7869 7320 3d3d 2031 3a0a 2020 2020 2020  xis == 1:.      
-00019d70: 2020 2020 2020 7265 7475 726e 206d 6170        return map
-00019d80: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
-00019d90: 2020 2020 2020 2020 2020 2020 204d 2e73               M.s
-00019da0: 656d 2c0a 2020 2020 2020 2020 2020 2020  em,.            
-00019db0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00019dc0: 2020 2020 2020 2020 2020 6d65 7461 3d6d            meta=m
-00019dd0: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
-00019de0: 2020 2020 2074 6f6b 656e 3d73 656c 662e       token=self.
-00019df0: 5f74 6f6b 656e 5f70 7265 6669 7820 2b20  _token_prefix + 
-00019e00: 2273 656d 222c 0a20 2020 2020 2020 2020  "sem",.         
-00019e10: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
-00019e20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019e30: 2020 736b 6970 6e61 3d73 6b69 706e 612c    skipna=skipna,
-00019e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019e50: 2064 646f 663d 6464 6f66 2c0a 2020 2020   ddof=ddof,.    
-00019e60: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00019e70: 6e74 5f6d 6574 613d 7365 6c66 2e5f 6d65  nt_meta=self._me
-00019e80: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-00019e90: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
-00019ea0: 3d6e 756d 6572 6963 5f6f 6e6c 792c 0a20  =numeric_only,. 
-00019eb0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00019ec0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00019ed0: 2020 2020 2020 206e 756d 203d 2073 656c         num = sel
-00019ee0: 662e 5f67 6574 5f6e 756d 6572 6963 5f64  f._get_numeric_d
-00019ef0: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
-00019f00: 2020 7620 3d20 6e75 6d2e 7661 7228 736b    v = num.var(sk
-00019f10: 6970 6e61 3d73 6b69 706e 612c 2064 646f  ipna=skipna, ddo
-00019f20: 663d 6464 6f66 2c20 7370 6c69 745f 6576  f=ddof, split_ev
-00019f30: 6572 793d 7370 6c69 745f 6576 6572 7929  ery=split_every)
-00019f40: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-00019f50: 206e 756d 2e63 6f75 6e74 2873 706c 6974   num.count(split
-00019f60: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00019f70: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
-00019f80: 6e61 6d65 203d 2073 656c 662e 5f74 6f6b  name = self._tok
-00019f90: 656e 5f70 7265 6669 7820 2b20 2273 656d  en_prefix + "sem
-00019fa0: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
-00019fb0: 7375 6c74 203d 206d 6170 5f70 6172 7469  sult = map_parti
-00019fc0: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
-00019fd0: 2020 2020 2020 206e 702e 7371 7274 2c0a         np.sqrt,.
-00019fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ff0: 7620 2f20 6e2c 0a20 2020 2020 2020 2020  v / n,.         
-0001a000: 2020 2020 2020 206d 6574 613d 6d65 7461         meta=meta
-0001a010: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a020: 2020 746f 6b65 6e3d 6e61 6d65 2c0a 2020    token=name,.  
-0001a030: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0001a040: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-0001a050: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-0001a060: 2020 2020 2020 7061 7265 6e74 5f6d 6574        parent_met
-0001a070: 613d 7365 6c66 2e5f 6d65 7461 2c0a 2020  a=self._meta,.  
-0001a080: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0001a090: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0001a0a0: 7374 616e 6365 2873 656c 662c 2044 6174  stance(self, Dat
-0001a0b0: 6146 7261 6d65 293a 0a20 2020 2020 2020  aFrame):.       
-0001a0c0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-0001a0d0: 6469 7669 7369 6f6e 7320 3d20 2873 656c  divisions = (sel
-0001a0e0: 662e 636f 6c75 6d6e 732e 6d69 6e28 292c  f.columns.min(),
-0001a0f0: 2073 656c 662e 636f 6c75 6d6e 732e 6d61   self.columns.ma
-0001a100: 7828 2929 0a20 2020 2020 2020 2020 2020  x()).           
-0001a110: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
-0001a120: 2020 2020 6465 6620 7175 616e 7469 6c65      def quantile
-0001a130: 2873 656c 662c 2071 3d30 2e35 2c20 6178  (self, q=0.5, ax
-0001a140: 6973 3d30 2c20 6e75 6d65 7269 635f 6f6e  is=0, numeric_on
-0001a150: 6c79 3d6e 6f5f 6465 6661 756c 742c 206d  ly=no_default, m
-0001a160: 6574 686f 643d 2264 6566 6175 6c74 2229  ethod="default")
-0001a170: 3a0a 2020 2020 2020 2020 2222 2241 7070  :.        """App
-0001a180: 726f 7869 6d61 7465 2072 6f77 2d77 6973  roximate row-wis
-0001a190: 6520 616e 6420 7072 6563 6973 6520 636f  e and precise co
-0001a1a0: 6c75 6d6e 2d77 6973 6520 7175 616e 7469  lumn-wise quanti
-0001a1b0: 6c65 7320 6f66 2044 6174 6146 7261 6d65  les of DataFrame
-0001a1c0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0001a1d0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0001a1e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001a1f0: 7120 3a20 6c69 7374 2f61 7272 6179 206f  q : list/array o
-0001a200: 6620 666c 6f61 7473 2c20 6465 6661 756c  f floats, defaul
-0001a210: 7420 302e 3520 2835 3025 290a 2020 2020  t 0.5 (50%).    
-0001a220: 2020 2020 2020 2020 4974 6572 6162 6c65          Iterable
-0001a230: 206f 6620 6e75 6d62 6572 7320 7261 6e67   of numbers rang
-0001a240: 696e 6720 6672 6f6d 2030 2074 6f20 3120  ing from 0 to 1 
-0001a250: 666f 7220 7468 6520 6465 7369 7265 6420  for the desired 
-0001a260: 7175 616e 7469 6c65 730a 2020 2020 2020  quantiles.      
-0001a270: 2020 6178 6973 203a 207b 302c 2031 2c20    axis : {0, 1, 
-0001a280: 2769 6e64 6578 272c 2027 636f 6c75 6d6e  'index', 'column
-0001a290: 7327 7d20 2864 6566 6175 6c74 2030 290a  s'} (default 0).
-0001a2a0: 2020 2020 2020 2020 2020 2020 3020 6f72              0 or
-0001a2b0: 2027 696e 6465 7827 2066 6f72 2072 6f77   'index' for row
-0001a2c0: 2d77 6973 652c 2031 206f 7220 2763 6f6c  -wise, 1 or 'col
-0001a2d0: 756d 6e73 2720 666f 7220 636f 6c75 6d6e  umns' for column
-0001a2e0: 2d77 6973 650a 2020 2020 2020 2020 6d65  -wise.        me
-0001a2f0: 7468 6f64 203a 207b 2764 6566 6175 6c74  thod : {'default
-0001a300: 272c 2027 7464 6967 6573 7427 2c20 2764  ', 'tdigest', 'd
-0001a310: 6173 6b27 7d2c 206f 7074 696f 6e61 6c0a  ask'}, optional.
-0001a320: 2020 2020 2020 2020 2020 2020 5768 6174              What
-0001a330: 206d 6574 686f 6420 746f 2075 7365 2e20   method to use. 
-0001a340: 4279 2064 6566 6175 6c74 2077 696c 6c20  By default will 
-0001a350: 7573 6520 6461 736b 2773 2069 6e74 6572  use dask's inter
-0001a360: 6e61 6c20 6375 7374 6f6d 0a20 2020 2020  nal custom.     
-0001a370: 2020 2020 2020 2061 6c67 6f72 6974 686d         algorithm
-0001a380: 2028 6060 2764 6173 6b27 6060 292e 2020   (``'dask'``).  
-0001a390: 4966 2073 6574 2074 6f20 6060 2774 6469  If set to ``'tdi
-0001a3a0: 6765 7374 2760 6020 7769 6c6c 2075 7365  gest'`` will use
-0001a3b0: 2074 6469 6765 7374 0a20 2020 2020 2020   tdigest.       
-0001a3c0: 2020 2020 2066 6f72 2066 6c6f 6174 7320       for floats 
-0001a3d0: 616e 6420 696e 7473 2061 6e64 2066 616c  and ints and fal
-0001a3e0: 6c62 6163 6b20 746f 2074 6865 2060 6027  lback to the ``'
-0001a3f0: 6461 736b 2760 6020 6f74 6865 7277 6973  dask'`` otherwis
-0001a400: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-0001a410: 2020 2020 2020 2061 7869 7320 3d20 7365         axis = se
-0001a420: 6c66 2e5f 7661 6c69 6461 7465 5f61 7869  lf._validate_axi
-0001a430: 7328 6178 6973 290a 2020 2020 2020 2020  s(axis).        
-0001a440: 6b65 796e 616d 6520 3d20 2271 7561 6e74  keyname = "quant
-0001a450: 696c 6573 2d63 6f6e 6361 742d 2d22 202b  iles-concat--" +
-0001a460: 2074 6f6b 656e 697a 6528 7365 6c66 2c20   tokenize(self, 
-0001a470: 712c 2061 7869 7329 0a20 2020 2020 2020  q, axis).       
-0001a480: 206e 756d 6572 6963 5f6b 7761 7267 7320   numeric_kwargs 
-0001a490: 3d20 6765 745f 6e75 6d65 7269 635f 6f6e  = get_numeric_on
-0001a4a0: 6c79 5f6b 7761 7267 7328 6e75 6d65 7269  ly_kwargs(numeri
-0001a4b0: 635f 6f6e 6c79 290a 0a20 2020 2020 2020  c_only)..       
-0001a4c0: 2077 6974 6820 6368 6563 6b5f 6e75 6d65   with check_nume
-0001a4d0: 7269 635f 6f6e 6c79 5f64 6570 7265 6361  ric_only_depreca
-0001a4e0: 7469 6f6e 2822 7175 616e 7469 6c65 222c  tion("quantile",
-0001a4f0: 2054 7275 6529 3a0a 2020 2020 2020 2020   True):.        
-0001a500: 2020 2020 6d65 7461 203d 2073 656c 662e      meta = self.
-0001a510: 5f6d 6574 612e 7175 616e 7469 6c65 2871  _meta.quantile(q
-0001a520: 2c20 6178 6973 3d61 7869 732c 202a 2a6e  , axis=axis, **n
-0001a530: 756d 6572 6963 5f6b 7761 7267 7329 0a0a  umeric_kwargs)..
-0001a540: 2020 2020 2020 2020 6966 2061 7869 7320          if axis 
-0001a550: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-0001a560: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0001a570: 712c 206c 6973 7429 3a0a 2020 2020 2020  q, list):.      
-0001a580: 2020 2020 2020 2020 2020 2320 4e6f 7420            # Not 
-0001a590: 7375 7070 6f72 7465 642c 2074 6865 2072  supported, the r
-0001a5a0: 6573 756c 7420 7769 6c6c 2068 6176 6520  esult will have 
-0001a5b0: 6375 7272 656e 7420 696e 6465 7820 6173  current index as
-0001a5c0: 2063 6f6c 756d 6e73 0a20 2020 2020 2020   columns.       
-0001a5d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0001a5e0: 616c 7565 4572 726f 7228 2227 7127 206d  alueError("'q' m
-0001a5f0: 7573 7420 6265 2073 6361 6c61 7220 7768  ust be scalar wh
-0001a600: 656e 2061 7869 733d 3120 6973 2073 7065  en axis=1 is spe
-0001a610: 6369 6669 6564 2229 0a0a 2020 2020 2020  cified")..      
-0001a620: 2020 2020 2020 7265 7475 726e 206d 6170        return map
-0001a630: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
-0001a640: 2020 2020 2020 2020 2020 2020 205f 6765               _ge
-0001a650: 7461 7474 725f 6e75 6d65 7269 635f 6f6e  tattr_numeric_on
-0001a660: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
-0001a670: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001a680: 2020 2020 2020 2020 2020 712c 0a20 2020            q,.   
-0001a690: 2020 2020 2020 2020 2020 2020 2061 7869               axi
-0001a6a0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001a6b0: 2020 2074 6f6b 656e 3d6b 6579 6e61 6d65     token=keyname
-0001a6c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a6d0: 2020 656e 666f 7263 655f 6d65 7461 6461    enforce_metada
-0001a6e0: 7461 3d46 616c 7365 2c0a 2020 2020 2020  ta=False,.      
-0001a6f0: 2020 2020 2020 2020 2020 2a2a 6e75 6d65            **nume
-0001a700: 7269 635f 6b77 6172 6773 2c0a 2020 2020  ric_kwargs,.    
-0001a710: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
-0001a720: 3d28 712c 2022 6638 2229 2c0a 2020 2020  =(q, "f8"),.    
-0001a730: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-0001a740: 6e74 5f6d 6574 613d 7365 6c66 2e5f 6d65  nt_meta=self._me
-0001a750: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-0001a760: 2020 2020 5f64 6173 6b5f 6d65 7468 6f64      _dask_method
-0001a770: 5f6e 616d 653d 2271 7561 6e74 696c 6522  _name="quantile"
-0001a780: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0001a790: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001a7a0: 2020 2020 2020 2020 2020 5f72 6169 7365            _raise
-0001a7b0: 5f69 665f 6f62 6a65 6374 5f73 6572 6965  _if_object_serie
-0001a7c0: 7328 7365 6c66 2c20 2271 7561 6e74 696c  s(self, "quantil
-0001a7d0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-0001a7e0: 6e75 6d20 3d20 280a 2020 2020 2020 2020  num = (.        
-0001a7f0: 2020 2020 2020 2020 7365 6c66 2e5f 6765          self._ge
-0001a800: 745f 6e75 6d65 7269 635f 6461 7461 2829  t_numeric_data()
-0001a810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a820: 2069 6620 6e75 6d65 7269 635f 6f6e 6c79   if numeric_only
-0001a830: 2069 7320 5472 7565 0a20 2020 2020 2020   is True.       
-0001a840: 2020 2020 2020 2020 206f 7220 286e 6f74           or (not
-0001a850: 2050 414e 4441 535f 4754 5f32 3030 2061   PANDAS_GT_200 a
-0001a860: 6e64 206e 756d 6572 6963 5f6f 6e6c 7920  nd numeric_only 
-0001a870: 6973 206e 6f5f 6465 6661 756c 7429 0a20  is no_default). 
-0001a880: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001a890: 6c73 6520 7365 6c66 0a20 2020 2020 2020  lse self.       
-0001a8a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001a8b0: 2020 2071 7561 6e74 696c 6573 203d 2074     quantiles = t
-0001a8c0: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
-0001a8d0: 2020 2020 2020 7175 616e 7469 6c65 286e        quantile(n
-0001a8e0: 756d 2e69 6c6f 635b 3a2c 2069 5d2c 2071  um.iloc[:, i], q
-0001a8f0: 2c20 6d65 7468 6f64 2920 666f 7220 6920  , method) for i 
-0001a900: 696e 2072 616e 6765 286c 656e 286e 756d  in range(len(num
-0001a910: 2e63 6f6c 756d 6e73 2929 0a20 2020 2020  .columns)).     
-0001a920: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0001a930: 2020 2020 2020 716e 616d 6573 203d 205b        qnames = [
-0001a940: 285f 712e 5f6e 616d 652c 2030 2920 666f  (_q._name, 0) fo
-0001a950: 7220 5f71 2069 6e20 7175 616e 7469 6c65  r _q in quantile
-0001a960: 735d 0a0a 2020 2020 2020 2020 2020 2020  s]..            
-0001a970: 6966 2069 7369 6e73 7461 6e63 6528 7175  if isinstance(qu
-0001a980: 616e 7469 6c65 735b 305d 2c20 5363 616c  antiles[0], Scal
-0001a990: 6172 293a 0a20 2020 2020 2020 2020 2020  ar):.           
-0001a9a0: 2020 2020 206c 6179 6572 203d 207b 0a20       layer = {. 
-0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2028 6b65 796e 616d 652c 2030 293a     (keyname, 0):
-0001a9d0: 2028 7479 7065 286d 6574 6129 2c20 716e   (type(meta), qn
-0001a9e0: 616d 6573 2c20 6e75 6d2e 636f 6c75 6d6e  ames, num.column
-0001a9f0: 732c 204e 6f6e 652c 206d 6574 612e 6e61  s, None, meta.na
-0001aa00: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0001aa10: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-0001aa20: 2020 2020 2020 6772 6170 6820 3d20 4869        graph = Hi
-0001aa30: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-0001aa40: 6d5f 636f 6c6c 6563 7469 6f6e 7328 0a20  m_collections(. 
-0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa60: 2020 206b 6579 6e61 6d65 2c20 6c61 7965     keyname, laye
-0001aa70: 722c 2064 6570 656e 6465 6e63 6965 733d  r, dependencies=
-0001aa80: 7175 616e 7469 6c65 730a 2020 2020 2020  quantiles.      
-0001aa90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001aaa0: 2020 2020 2020 2020 2020 2020 6469 7669              divi
-0001aab0: 7369 6f6e 7320 3d20 286d 696e 286e 756d  sions = (min(num
-0001aac0: 2e63 6f6c 756d 6e73 292c 206d 6178 286e  .columns), max(n
-0001aad0: 756d 2e63 6f6c 756d 6e73 2929 0a20 2020  um.columns)).   
-0001aae0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001aaf0: 7572 6e20 5365 7269 6573 2867 7261 7068  urn Series(graph
-0001ab00: 2c20 6b65 796e 616d 652c 206d 6574 612c  , keyname, meta,
-0001ab10: 2064 6976 6973 696f 6e73 290a 2020 2020   divisions).    
-0001ab20: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001ab30: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001ab40: 7965 7220 3d20 7b28 6b65 796e 616d 652c  yer = {(keyname,
-0001ab50: 2030 293a 2028 6d65 7468 6f64 732e 636f   0): (methods.co
-0001ab60: 6e63 6174 2c20 716e 616d 6573 2c20 3129  ncat, qnames, 1)
-0001ab70: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0001ab80: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
-0001ab90: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
-0001aba0: 6c6c 6563 7469 6f6e 7328 0a20 2020 2020  llections(.     
-0001abb0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001abc0: 6579 6e61 6d65 2c20 6c61 7965 722c 2064  eyname, layer, d
-0001abd0: 6570 656e 6465 6e63 6965 733d 7175 616e  ependencies=quan
-0001abe0: 7469 6c65 730a 2020 2020 2020 2020 2020  tiles.          
-0001abf0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001ac00: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0001ac10: 6577 5f64 645f 6f62 6a65 6374 2867 7261  ew_dd_object(gra
-0001ac20: 7068 2c20 6b65 796e 616d 652c 206d 6574  ph, keyname, met
-0001ac30: 612c 2071 7561 6e74 696c 6573 5b30 5d2e  a, quantiles[0].
-0001ac40: 6469 7669 7369 6f6e 7329 0a0a 2020 2020  divisions)..    
-0001ac50: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-0001ac60: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
-0001ac70: 6465 6620 6465 7363 7269 6265 280a 2020  def describe(.  
-0001ac80: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001ac90: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
-0001aca0: 4661 6c73 652c 0a20 2020 2020 2020 2070  False,.        p
-0001acb0: 6572 6365 6e74 696c 6573 3d4e 6f6e 652c  ercentiles=None,
-0001acc0: 0a20 2020 2020 2020 2070 6572 6365 6e74  .        percent
-0001acd0: 696c 6573 5f6d 6574 686f 643d 2264 6566  iles_method="def
-0001ace0: 6175 6c74 222c 0a20 2020 2020 2020 2069  ault",.        i
-0001acf0: 6e63 6c75 6465 3d4e 6f6e 652c 0a20 2020  nclude=None,.   
-0001ad00: 2020 2020 2065 7863 6c75 6465 3d4e 6f6e       exclude=Non
-0001ad10: 652c 0a20 2020 2020 2020 2064 6174 6574  e,.        datet
-0001ad20: 696d 655f 6973 5f6e 756d 6572 6963 3d6e  ime_is_numeric=n
-0001ad30: 6f5f 6465 6661 756c 742c 0a20 2020 2029  o_default,.    )
-0001ad40: 3a0a 2020 2020 2020 2020 6966 2050 414e  :.        if PAN
-0001ad50: 4441 535f 4754 5f32 3030 3a0a 2020 2020  DAS_GT_200:.    
-0001ad60: 2020 2020 2020 2020 6966 2064 6174 6574          if datet
-0001ad70: 696d 655f 6973 5f6e 756d 6572 6963 2069  ime_is_numeric i
-0001ad80: 7320 6e6f 5f64 6566 6175 6c74 3a0a 2020  s no_default:.  
-0001ad90: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001ada0: 7465 7469 6d65 5f69 735f 6e75 6d65 7269  tetime_is_numeri
-0001adb0: 6320 3d20 5472 7565 0a20 2020 2020 2020  c = True.       
-0001adc0: 2020 2020 2020 2020 2064 6174 6574 696d           datetim
-0001add0: 655f 6973 5f6e 756d 6572 6963 5f6b 7761  e_is_numeric_kwa
-0001ade0: 7267 203d 207b 7d0a 2020 2020 2020 2020  rg = {}.        
-0001adf0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001ae00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001ae10: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
-0001ae20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001ae30: 6461 7465 7469 6d65 5f69 735f 6e75 6d65  datetime_is_nume
-0001ae40: 7269 6320 6973 2072 656d 6f76 6564 2069  ric is removed i
-0001ae50: 6e20 7061 6e64 6173 3e3d 322e 302e 302c  n pandas>=2.0.0,
-0001ae60: 2064 6174 6574 696d 6520 6461 7461 2077   datetime data w
-0001ae70: 696c 6c20 616c 7761 7973 2062 6520 220a  ill always be ".
-0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 2020 2020 2273 756d 6d61 7269 7a65 6420      "summarized 
-0001aea0: 6173 206e 756d 6572 6963 220a 2020 2020  as numeric".    
-0001aeb0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001aec0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001aed0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-0001aee0: 5f69 735f 6e75 6d65 7269 6320 3d20 280a  _is_numeric = (.
-0001aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af00: 4661 6c73 6520 6966 2064 6174 6574 696d  False if datetim
-0001af10: 655f 6973 5f6e 756d 6572 6963 2069 7320  e_is_numeric is 
-0001af20: 6e6f 5f64 6566 6175 6c74 2065 6c73 6520  no_default else 
-0001af30: 6461 7465 7469 6d65 5f69 735f 6e75 6d65  datetime_is_nume
-0001af40: 7269 630a 2020 2020 2020 2020 2020 2020  ric.            
-0001af50: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-0001af60: 7465 7469 6d65 5f69 735f 6e75 6d65 7269  tetime_is_numeri
-0001af70: 635f 6b77 6172 6720 3d20 7b22 6461 7465  c_kwarg = {"date
-0001af80: 7469 6d65 5f69 735f 6e75 6d65 7269 6322  time_is_numeric"
-0001af90: 3a20 6461 7465 7469 6d65 5f69 735f 6e75  : datetime_is_nu
-0001afa0: 6d65 7269 637d 0a0a 2020 2020 2020 2020  meric}..        
-0001afb0: 6966 2073 656c 662e 5f6d 6574 612e 6e64  if self._meta.nd
-0001afc0: 696d 203d 3d20 313a 0a20 2020 2020 2020  im == 1:.       
-0001afd0: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
-0001afe0: 2e5f 6d65 7461 5f6e 6f6e 656d 7074 792e  ._meta_nonempty.
-0001aff0: 6465 7363 7269 6265 280a 2020 2020 2020  describe(.      
-0001b000: 2020 2020 2020 2020 2020 7065 7263 656e            percen
-0001b010: 7469 6c65 733d 7065 7263 656e 7469 6c65  tiles=percentile
-0001b020: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001b030: 2020 2069 6e63 6c75 6465 3d69 6e63 6c75     include=inclu
-0001b040: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
-0001b050: 2020 2020 6578 636c 7564 653d 6578 636c      exclude=excl
-0001b060: 7564 652c 0a20 2020 2020 2020 2020 2020  ude,.           
-0001b070: 2020 2020 202a 2a64 6174 6574 696d 655f       **datetime_
-0001b080: 6973 5f6e 756d 6572 6963 5f6b 7761 7267  is_numeric_kwarg
-0001b090: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0001b0a0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-0001b0b0: 7574 203d 2073 656c 662e 5f64 6573 6372  ut = self._descr
-0001b0c0: 6962 655f 3164 280a 2020 2020 2020 2020  ibe_1d(.        
-0001b0d0: 2020 2020 2020 2020 7365 6c66 2c20 7370          self, sp
-0001b0e0: 6c69 745f 6576 6572 792c 2070 6572 6365  lit_every, perce
-0001b0f0: 6e74 696c 6573 2c20 7065 7263 656e 7469  ntiles, percenti
-0001b100: 6c65 735f 6d65 7468 6f64 2c20 6461 7465  les_method, date
-0001b110: 7469 6d65 5f69 735f 6e75 6d65 7269 630a  time_is_numeric.
-0001b120: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001b130: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0001b140: 2e5f 6d65 7461 203d 206d 6574 610a 2020  ._meta = meta.  
-0001b150: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001b160: 206f 7574 7075 740a 2020 2020 2020 2020   output.        
-0001b170: 656c 6966 2028 696e 636c 7564 6520 6973  elif (include is
-0001b180: 204e 6f6e 6529 2061 6e64 2028 6578 636c   None) and (excl
-0001b190: 7564 6520 6973 204e 6f6e 6529 3a0a 2020  ude is None):.  
-0001b1a0: 2020 2020 2020 2020 2020 5f69 6e63 6c75            _inclu
-0001b1b0: 6465 203d 205b 6e70 2e6e 756d 6265 722c  de = [np.number,
-0001b1c0: 206e 702e 7469 6d65 6465 6c74 6136 345d   np.timedelta64]
-0001b1d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001b1e0: 6461 7465 7469 6d65 5f69 735f 6e75 6d65  datetime_is_nume
-0001b1f0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
-0001b200: 2020 2020 205f 696e 636c 7564 652e 6170       _include.ap
-0001b210: 7065 6e64 286e 702e 6461 7465 7469 6d65  pend(np.datetime
-0001b220: 3634 290a 2020 2020 2020 2020 2020 2020  64).            
-0001b230: 6461 7461 203d 2073 656c 662e 5f6d 6574  data = self._met
-0001b240: 612e 7365 6c65 6374 5f64 7479 7065 7328  a.select_dtypes(
-0001b250: 696e 636c 7564 653d 5f69 6e63 6c75 6465  include=_include
-0001b260: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0001b270: 2077 6865 6e20 736f 6d65 206e 756d 6572   when some numer
-0001b280: 6963 732f 7469 6d65 6465 6c74 6173 2061  ics/timedeltas a
-0001b290: 7265 2066 6f75 6e64 2c20 6279 2064 6566  re found, by def
-0001b2a0: 6175 6c74 206b 6565 7020 7468 656d 0a20  ault keep them. 
-0001b2b0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0001b2c0: 6e28 6461 7461 2e63 6f6c 756d 6e73 2920  n(data.columns) 
-0001b2d0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0001b2e0: 2020 2020 2020 6368 6f73 656e 5f63 6f6c        chosen_col
-0001b2f0: 756d 6e73 5f69 6e64 6578 6573 203d 206c  umns_indexes = l
-0001b300: 6973 7428 7261 6e67 6528 6c65 6e28 7365  ist(range(len(se
-0001b310: 6c66 2e5f 6d65 7461 2e63 6f6c 756d 6e73  lf._meta.columns
-0001b320: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-0001b330: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b340: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-0001b350: 2074 6865 7265 2061 7265 2074 696d 6564   there are timed
-0001b360: 656c 7461 2c20 626f 6f6c 6561 6e2c 206f  elta, boolean, o
-0001b370: 7220 6461 7465 7469 6d65 2063 6f6c 756d  r datetime colum
-0001b380: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
-0001b390: 2020 205f 696e 636c 7564 6520 3d20 5b6e     _include = [n
-0001b3a0: 702e 7469 6d65 6465 6c74 6136 342c 2062  p.timedelta64, b
-0001b3b0: 6f6f 6c5d 0a20 2020 2020 2020 2020 2020  ool].           
-0001b3c0: 2020 2020 2069 6620 6461 7465 7469 6d65       if datetime
-0001b3d0: 5f69 735f 6e75 6d65 7269 633a 0a20 2020  _is_numeric:.   
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3f0: 205f 696e 636c 7564 652e 6170 7065 6e64   _include.append
-0001b400: 286e 702e 6461 7465 7469 6d65 3634 290a  (np.datetime64).
-0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b420: 626f 6f6c 735f 616e 645f 7469 6d65 7320  bools_and_times 
-0001b430: 3d20 7365 6c66 2e5f 6d65 7461 2e73 656c  = self._meta.sel
-0001b440: 6563 745f 6474 7970 6573 2869 6e63 6c75  ect_dtypes(inclu
-0001b450: 6465 3d5f 696e 636c 7564 6529 0a20 2020  de=_include).   
-0001b460: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b470: 6c65 6e28 626f 6f6c 735f 616e 645f 7469  len(bools_and_ti
-0001b480: 6d65 732e 636f 6c75 6d6e 7329 203d 3d20  mes.columns) == 
-0001b490: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001b4a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001b4b0: 6c66 2e5f 6465 7363 7269 6265 5f6e 756d  lf._describe_num
-0001b4c0: 6572 6963 280a 2020 2020 2020 2020 2020  eric(.          
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001b4e0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-0001b4f0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-0001b500: 745f 6576 6572 792c 0a20 2020 2020 2020  t_every,.       
-0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b520: 2070 6572 6365 6e74 696c 6573 2c0a 2020   percentiles,.  
-0001b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b540: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-0001b550: 735f 6d65 7468 6f64 2c0a 2020 2020 2020  s_method,.      
-0001b560: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b580: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b590: 2020 2020 2020 2020 2020 6368 6f73 656e            chosen
-0001b5a0: 5f63 6f6c 756d 6e73 5f69 6e64 6578 6573  _columns_indexes
-0001b5b0: 203d 2073 656c 662e 5f67 6574 5f63 6f6c   = self._get_col
-0001b5c0: 756d 6e73 5f69 6e64 6578 6573 5f62 6173  umns_indexes_bas
-0001b5d0: 6564 5f6f 6e5f 6474 7970 6573 280a 2020  ed_on_dtypes(.  
-0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5f0: 2020 2020 2020 6461 7461 0a20 2020 2020        data.     
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001b610: 0a20 2020 2020 2020 2065 6c69 6620 696e  .        elif in
-0001b620: 636c 7564 6520 3d3d 2022 616c 6c22 3a0a  clude == "all":.
-0001b630: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-0001b640: 7863 6c75 6465 2069 7320 6e6f 7420 4e6f  xclude is not No
-0001b650: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001b660: 2020 2020 6d73 6720 3d20 2265 7863 6c75      msg = "exclu
-0001b670: 6465 206d 7573 7420 6265 204e 6f6e 6520  de must be None 
-0001b680: 7768 656e 2069 6e63 6c75 6465 2069 7320  when include is 
-0001b690: 2761 6c6c 2722 0a20 2020 2020 2020 2020  'all'".         
-0001b6a0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0001b6b0: 7565 4572 726f 7228 6d73 6729 0a20 2020  ueError(msg).   
-0001b6c0: 2020 2020 2020 2020 2063 686f 7365 6e5f           chosen_
-0001b6d0: 636f 6c75 6d6e 735f 696e 6465 7865 7320  columns_indexes 
-0001b6e0: 3d20 6c69 7374 2872 616e 6765 286c 656e  = list(range(len
-0001b6f0: 2873 656c 662e 5f6d 6574 612e 636f 6c75  (self._meta.colu
-0001b700: 6d6e 7329 2929 0a20 2020 2020 2020 2065  mns))).        e
-0001b710: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001b720: 2064 6174 6120 3d20 7365 6c66 2e5f 6d65   data = self._me
-0001b730: 7461 2e73 656c 6563 745f 6474 7970 6573  ta.select_dtypes
-0001b740: 2869 6e63 6c75 6465 3d69 6e63 6c75 6465  (include=include
-0001b750: 2c20 6578 636c 7564 653d 6578 636c 7564  , exclude=exclud
-0001b760: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-0001b770: 686f 7365 6e5f 636f 6c75 6d6e 735f 696e  hosen_columns_in
-0001b780: 6465 7865 7320 3d20 7365 6c66 2e5f 6765  dexes = self._ge
-0001b790: 745f 636f 6c75 6d6e 735f 696e 6465 7865  t_columns_indexe
-0001b7a0: 735f 6261 7365 645f 6f6e 5f64 7479 7065  s_based_on_dtype
-0001b7b0: 7328 6461 7461 290a 0a20 2020 2020 2020  s(data)..       
-0001b7c0: 2073 7461 7473 203d 205b 0a20 2020 2020   stats = [.     
-0001b7d0: 2020 2020 2020 2073 656c 662e 5f64 6573         self._des
-0001b7e0: 6372 6962 655f 3164 280a 2020 2020 2020  cribe_1d(.      
-0001b7f0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-0001b800: 6c6f 635b 3a2c 2063 6f6c 5f69 6478 5d2c  loc[:, col_idx],
-0001b810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b820: 2073 706c 6974 5f65 7665 7279 2c0a 2020   split_every,.  
-0001b830: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-0001b840: 7263 656e 7469 6c65 732c 0a20 2020 2020  rcentiles,.     
-0001b850: 2020 2020 2020 2020 2020 2070 6572 6365             perce
-0001b860: 6e74 696c 6573 5f6d 6574 686f 642c 0a20  ntiles_method,. 
-0001b870: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001b880: 6174 6574 696d 655f 6973 5f6e 756d 6572  atetime_is_numer
-0001b890: 6963 2c0a 2020 2020 2020 2020 2020 2020  ic,.            
-0001b8a0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0001b8b0: 7220 636f 6c5f 6964 7820 696e 2063 686f  r col_idx in cho
-0001b8c0: 7365 6e5f 636f 6c75 6d6e 735f 696e 6465  sen_columns_inde
-0001b8d0: 7865 730a 2020 2020 2020 2020 5d0a 2020  xes.        ].  
-0001b8e0: 2020 2020 2020 7374 6174 735f 6e61 6d65        stats_name
-0001b8f0: 7320 3d20 5b28 732e 5f6e 616d 652c 2030  s = [(s._name, 0
-0001b900: 2920 666f 7220 7320 696e 2073 7461 7473  ) for s in stats
-0001b910: 5d0a 0a20 2020 2020 2020 206e 616d 6520  ]..        name 
-0001b920: 3d20 2264 6573 6372 6962 652d 2d22 202b  = "describe--" +
-0001b930: 2074 6f6b 656e 697a 6528 7365 6c66 2c20   tokenize(self, 
-0001b940: 7370 6c69 745f 6576 6572 7929 0a20 2020  split_every).   
-0001b950: 2020 2020 206c 6179 6572 203d 207b 286e       layer = {(n
-0001b960: 616d 652c 2030 293a 2028 6d65 7468 6f64  ame, 0): (method
-0001b970: 732e 6465 7363 7269 6265 5f61 6767 7265  s.describe_aggre
-0001b980: 6761 7465 2c20 7374 6174 735f 6e61 6d65  gate, stats_name
-0001b990: 7329 7d0a 2020 2020 2020 2020 6772 6170  s)}.        grap
-0001b9a0: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
-0001b9b0: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
-0001b9c0: 6f6e 7328 6e61 6d65 2c20 6c61 7965 722c  ons(name, layer,
-0001b9d0: 2064 6570 656e 6465 6e63 6965 733d 7374   dependencies=st
-0001b9e0: 6174 7329 0a20 2020 2020 2020 206d 6574  ats).        met
-0001b9f0: 6120 3d20 7365 6c66 2e5f 6d65 7461 5f6e  a = self._meta_n
-0001ba00: 6f6e 656d 7074 792e 6465 7363 7269 6265  onempty.describe
-0001ba10: 280a 2020 2020 2020 2020 2020 2020 696e  (.            in
-0001ba20: 636c 7564 653d 696e 636c 7564 652c 2065  clude=include, e
-0001ba30: 7863 6c75 6465 3d65 7863 6c75 6465 2c20  xclude=exclude, 
-0001ba40: 2a2a 6461 7465 7469 6d65 5f69 735f 6e75  **datetime_is_nu
-0001ba50: 6d65 7269 635f 6b77 6172 670a 2020 2020  meric_kwarg.    
-0001ba60: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-0001ba70: 7475 726e 206e 6577 5f64 645f 6f62 6a65  turn new_dd_obje
-0001ba80: 6374 2867 7261 7068 2c20 6e61 6d65 2c20  ct(graph, name, 
-0001ba90: 6d65 7461 2c20 6469 7669 7369 6f6e 733d  meta, divisions=
-0001baa0: 5b4e 6f6e 652c 204e 6f6e 655d 290a 0a20  [None, None]).. 
-0001bab0: 2020 2064 6566 205f 6765 745f 636f 6c75     def _get_colu
-0001bac0: 6d6e 735f 696e 6465 7865 735f 6261 7365  mns_indexes_base
-0001bad0: 645f 6f6e 5f64 7479 7065 7328 7365 6c66  d_on_dtypes(self
-0001bae0: 2c20 7375 6273 6574 293a 0a20 2020 2020  , subset):.     
-0001baf0: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
-0001bb00: 6d65 7461 2e64 7479 7065 732e 7265 7365  meta.dtypes.rese
-0001bb10: 745f 696e 6465 7828 290a 2020 2020 2020  t_index().      
-0001bb20: 2020 6d65 7461 2e69 6e64 6578 2e6e 616d    meta.index.nam
-0001bb30: 6520 3d20 2269 6e64 6578 6572 220a 2020  e = "indexer".  
-0001bb40: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
-0001bb50: 2020 2020 2020 2020 2020 206d 6574 612e             meta.
-0001bb60: 7265 7365 745f 696e 6465 7828 290a 2020  reset_index().  
-0001bb70: 2020 2020 2020 2020 2020 2e6d 6572 6765            .merge
-0001bb80: 2873 7562 7365 742e 6474 7970 6573 2e72  (subset.dtypes.r
-0001bb90: 6573 6574 5f69 6e64 6578 2829 2c20 686f  eset_index(), ho
-0001bba0: 773d 2269 6e6e 6572 2229 5b22 696e 6465  w="inner")["inde
-0001bbb0: 7865 7222 5d0a 2020 2020 2020 2020 2020  xer"].          
-0001bbc0: 2020 2e76 616c 7565 730a 2020 2020 2020    .values.      
-0001bbd0: 2020 290a 0a20 2020 2064 6566 205f 6465    )..    def _de
-0001bbe0: 7363 7269 6265 5f31 6428 0a20 2020 2020  scribe_1d(.     
-0001bbf0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0001bc00: 2064 6174 612c 0a20 2020 2020 2020 2073   data,.        s
-0001bc10: 706c 6974 5f65 7665 7279 3d46 616c 7365  plit_every=False
-0001bc20: 2c0a 2020 2020 2020 2020 7065 7263 656e  ,.        percen
-0001bc30: 7469 6c65 733d 4e6f 6e65 2c0a 2020 2020  tiles=None,.    
-0001bc40: 2020 2020 7065 7263 656e 7469 6c65 735f      percentiles_
-0001bc50: 6d65 7468 6f64 3d22 6465 6661 756c 7422  method="default"
-0001bc60: 2c0a 2020 2020 2020 2020 6461 7465 7469  ,.        dateti
-0001bc70: 6d65 5f69 735f 6e75 6d65 7269 633d 4661  me_is_numeric=Fa
-0001bc80: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-0001bc90: 2020 2020 6966 2069 735f 626f 6f6c 5f64      if is_bool_d
-0001bca0: 7479 7065 2864 6174 612e 5f6d 6574 6129  type(data._meta)
-0001bcb0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001bcc0: 7475 726e 2073 656c 662e 5f64 6573 6372  turn self._descr
-0001bcd0: 6962 655f 6e6f 6e6e 756d 6572 6963 5f31  ibe_nonnumeric_1
-0001bce0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-0001bcf0: 2020 2064 6174 612c 2073 706c 6974 5f65     data, split_e
-0001bd00: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
-0001bd10: 2c20 6461 7465 7469 6d65 5f69 735f 6e75  , datetime_is_nu
-0001bd20: 6d65 7269 633d 6461 7465 7469 6d65 5f69  meric=datetime_i
-0001bd30: 735f 6e75 6d65 7269 630a 2020 2020 2020  s_numeric.      
-0001bd40: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001bd50: 656c 6966 2069 735f 6e75 6d65 7269 635f  elif is_numeric_
-0001bd60: 6474 7970 6528 6461 7461 2e5f 6d65 7461  dtype(data._meta
-0001bd70: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0001bd80: 6574 7572 6e20 7365 6c66 2e5f 6465 7363  eturn self._desc
-0001bd90: 7269 6265 5f6e 756d 6572 6963 280a 2020  ribe_numeric(.  
-0001bda0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001bdb0: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-0001bdc0: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
-0001bdd0: 7370 6c69 745f 6576 6572 792c 0a20 2020  split_every,.   
-0001bde0: 2020 2020 2020 2020 2020 2020 2070 6572               per
-0001bdf0: 6365 6e74 696c 6573 3d70 6572 6365 6e74  centiles=percent
-0001be00: 696c 6573 2c0a 2020 2020 2020 2020 2020  iles,.          
-0001be10: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-0001be20: 735f 6d65 7468 6f64 3d70 6572 6365 6e74  s_method=percent
-0001be30: 696c 6573 5f6d 6574 686f 642c 0a20 2020  iles_method,.   
-0001be40: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001be50: 2020 2065 6c69 6620 6973 5f74 696d 6564     elif is_timed
-0001be60: 656c 7461 3634 5f64 7479 7065 2864 6174  elta64_dtype(dat
-0001be70: 612e 5f6d 6574 6129 3a0a 2020 2020 2020  a._meta):.      
-0001be80: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001be90: 662e 5f64 6573 6372 6962 655f 6e75 6d65  f._describe_nume
-0001bea0: 7269 6328 0a20 2020 2020 2020 2020 2020  ric(.           
-0001beb0: 2020 2020 2064 6174 612e 6472 6f70 6e61       data.dropna
-0001bec0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-0001bed0: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
-0001bee0: 7370 6c69 745f 6576 6572 792c 0a20 2020  split_every,.   
-0001bef0: 2020 2020 2020 2020 2020 2020 2070 6572               per
-0001bf00: 6365 6e74 696c 6573 3d70 6572 6365 6e74  centiles=percent
-0001bf10: 696c 6573 2c0a 2020 2020 2020 2020 2020  iles,.          
-0001bf20: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-0001bf30: 735f 6d65 7468 6f64 3d70 6572 6365 6e74  s_method=percent
-0001bf40: 696c 6573 5f6d 6574 686f 642c 0a20 2020  iles_method,.   
-0001bf50: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-0001bf60: 7469 6d65 6465 6c74 615f 636f 6c75 6d6e  timedelta_column
-0001bf70: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-0001bf80: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-0001bf90: 6620 6973 5f64 6174 6574 696d 6536 345f  f is_datetime64_
-0001bfa0: 616e 795f 6474 7970 6528 6461 7461 2e5f  any_dtype(data._
-0001bfb0: 6d65 7461 2920 616e 6420 6461 7465 7469  meta) and dateti
-0001bfc0: 6d65 5f69 735f 6e75 6d65 7269 633a 0a20  me_is_numeric:. 
-0001bfd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001bfe0: 6e20 7365 6c66 2e5f 6465 7363 7269 6265  n self._describe
-0001bff0: 5f6e 756d 6572 6963 280a 2020 2020 2020  _numeric(.      
-0001c000: 2020 2020 2020 2020 2020 6461 7461 2e64            data.d
-0001c010: 726f 706e 6128 292c 0a20 2020 2020 2020  ropna(),.       
-0001c020: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
-0001c030: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
-0001c040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c050: 2020 7065 7263 656e 7469 6c65 733d 7065    percentiles=pe
-0001c060: 7263 656e 7469 6c65 732c 0a20 2020 2020  rcentiles,.     
-0001c070: 2020 2020 2020 2020 2020 2070 6572 6365             perce
-0001c080: 6e74 696c 6573 5f6d 6574 686f 643d 7065  ntiles_method=pe
-0001c090: 7263 656e 7469 6c65 735f 6d65 7468 6f64  rcentiles_method
-0001c0a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c0b0: 2020 6973 5f64 6174 6574 696d 655f 636f    is_datetime_co
-0001c0c0: 6c75 6d6e 3d54 7275 652c 0a20 2020 2020  lumn=True,.     
-0001c0d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001c0e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001c0f0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001c100: 6465 7363 7269 6265 5f6e 6f6e 6e75 6d65  describe_nonnume
-0001c110: 7269 635f 3164 280a 2020 2020 2020 2020  ric_1d(.        
-0001c120: 2020 2020 2020 2020 6461 7461 2c20 7370          data, sp
-0001c130: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-0001c140: 6576 6572 792c 2064 6174 6574 696d 655f  every, datetime_
-0001c150: 6973 5f6e 756d 6572 6963 3d64 6174 6574  is_numeric=datet
-0001c160: 696d 655f 6973 5f6e 756d 6572 6963 0a20  ime_is_numeric. 
-0001c170: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001c180: 2020 6465 6620 5f64 6573 6372 6962 655f    def _describe_
-0001c190: 6e75 6d65 7269 6328 0a20 2020 2020 2020  numeric(.       
-0001c1a0: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
-0001c1b0: 6174 612c 0a20 2020 2020 2020 2073 706c  ata,.        spl
-0001c1c0: 6974 5f65 7665 7279 3d46 616c 7365 2c0a  it_every=False,.
-0001c1d0: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
-0001c1e0: 6c65 733d 4e6f 6e65 2c0a 2020 2020 2020  les=None,.      
-0001c1f0: 2020 7065 7263 656e 7469 6c65 735f 6d65    percentiles_me
-0001c200: 7468 6f64 3d22 6465 6661 756c 7422 2c0a  thod="default",.
+00017020: 2020 6d65 7461 3d6d 6574 612c 0a20 2020    meta=meta,.   
+00017030: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
+00017040: 656e 3d73 656c 662e 5f74 6f6b 656e 5f70  en=self._token_p
+00017050: 7265 6669 7820 2b20 2273 7464 222c 0a20  refix + "std",. 
+00017060: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00017070: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
+00017080: 2020 2020 2020 2020 2020 736b 6970 6e61            skipna
+00017090: 3d73 6b69 706e 612c 0a20 2020 2020 2020  =skipna,.       
+000170a0: 2020 2020 2020 2020 2064 646f 663d 6464           ddof=dd
+000170b0: 6f66 2c0a 2020 2020 2020 2020 2020 2020  of,.            
+000170c0: 2020 2020 656e 666f 7263 655f 6d65 7461      enforce_meta
+000170d0: 6461 7461 3d46 616c 7365 2c0a 2020 2020  data=False,.    
+000170e0: 2020 2020 2020 2020 2020 2020 2a2a 6e75              **nu
+000170f0: 6d65 7269 635f 6b77 6172 6773 2c0a 2020  meric_kwargs,.  
+00017100: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00017110: 7265 6e74 5f6d 6574 613d 7365 6c66 2e5f  rent_meta=self._
+00017120: 6d65 7461 2c0a 2020 2020 2020 2020 2020  meta,.          
+00017130: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00017140: 7265 7475 726e 2068 616e 646c 655f 6f75  return handle_ou
+00017150: 7428 6f75 742c 2072 6573 756c 7429 0a0a  t(out, result)..
+00017160: 2020 2020 2020 2020 2320 4361 7365 2077          # Case w
+00017170: 6865 7265 2061 7869 733d 3020 6f72 2061  here axis=0 or a
+00017180: 7869 733d 4e6f 6e65 0a20 2020 2020 2020  xis=None.       
+00017190: 2076 203d 206e 756d 6572 6963 5f64 642e   v = numeric_dd.
+000171a0: 7661 7228 736b 6970 6e61 3d73 6b69 706e  var(skipna=skipn
+000171b0: 612c 2064 646f 663d 6464 6f66 2c20 7370  a, ddof=ddof, sp
+000171c0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+000171d0: 6576 6572 7929 0a20 2020 2020 2020 206e  every).        n
+000171e0: 616d 6520 3d20 7365 6c66 2e5f 746f 6b65  ame = self._toke
+000171f0: 6e5f 7072 6566 6978 202b 2022 7374 6422  n_prefix + "std"
+00017200: 0a0a 2020 2020 2020 2020 6966 206e 6565  ..        if nee
+00017210: 6473 5f74 696d 655f 636f 6e76 6572 7369  ds_time_conversi
+00017220: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00017230: 7371 7274 5f66 756e 635f 6b77 6172 6773  sqrt_func_kwargs
+00017240: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00017250: 2020 2020 2022 6973 5f64 665f 6c69 6b65       "is_df_like
+00017260: 223a 2069 735f 6466 5f6c 696b 652c 0a20  ": is_df_like,. 
+00017270: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00017280: 7469 6d65 5f63 6f6c 7322 3a20 7469 6d65  time_cols": time
+00017290: 5f63 6f6c 7320 6966 2069 735f 6466 5f6c  _cols if is_df_l
+000172a0: 696b 6520 656c 7365 204e 6f6e 652c 0a20  ike else None,. 
+000172b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000172c0: 6178 6973 223a 2061 7869 732c 0a20 2020  axis": axis,.   
+000172d0: 2020 2020 2020 2020 2020 2020 2022 6474               "dt
+000172e0: 7970 6522 3a20 6765 7461 7474 7228 6d65  ype": getattr(me
+000172f0: 7461 2c20 2264 7479 7065 222c 204e 6f6e  ta, "dtype", Non
+00017300: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00017310: 7d0a 2020 2020 2020 2020 2020 2020 7371  }.            sq
+00017320: 7274 5f66 756e 6320 3d20 5f73 7172 745f  rt_func = _sqrt_
+00017330: 616e 645f 636f 6e76 6572 745f 746f 5f74  and_convert_to_t
+00017340: 696d 6564 656c 7461 0a20 2020 2020 2020  imedelta.       
+00017350: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00017360: 2020 2073 7172 745f 6675 6e63 5f6b 7761     sqrt_func_kwa
+00017370: 7267 7320 3d20 7b7d 0a20 2020 2020 2020  rgs = {}.       
+00017380: 2020 2020 2073 7172 745f 6675 6e63 203d       sqrt_func =
+00017390: 206e 702e 7371 7274 0a0a 2020 2020 2020   np.sqrt..      
+000173a0: 2020 7265 7375 6c74 203d 206d 6170 5f70    result = map_p
+000173b0: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
+000173c0: 2020 2020 2020 2073 7172 745f 6675 6e63         sqrt_func
+000173d0: 2c0a 2020 2020 2020 2020 2020 2020 762c  ,.            v,
+000173e0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+000173f0: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
+00017400: 2020 2020 746f 6b65 6e3d 6e61 6d65 2c0a      token=name,.
+00017410: 2020 2020 2020 2020 2020 2020 656e 666f              enfo
+00017420: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
+00017430: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+00017440: 7061 7265 6e74 5f6d 6574 613d 7365 6c66  parent_meta=self
+00017450: 2e5f 6d65 7461 2c0a 2020 2020 2020 2020  ._meta,.        
+00017460: 2020 2020 2a2a 7371 7274 5f66 756e 635f      **sqrt_func_
+00017470: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+00017480: 290a 0a20 2020 2020 2020 2023 2054 7279  )..        # Try
+00017490: 2074 6f20 6d61 7463 6820 7468 6520 5061   to match the Pa
+000174a0: 6e64 6173 2072 6573 756c 7420 6474 7970  ndas result dtyp
+000174b0: 650a 2020 2020 2020 2020 6966 2069 735f  e.        if is_
+000174c0: 6466 5f6c 696b 6520 616e 6420 6861 7361  df_like and hasa
+000174d0: 7474 7228 6d65 7461 2c20 2264 7479 7065  ttr(meta, "dtype
+000174e0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+000174f0: 7265 7375 6c74 203d 2072 6573 756c 742e  result = result.
+00017500: 6173 7479 7065 286d 6574 612e 6474 7970  astype(meta.dtyp
+00017510: 6529 0a0a 2020 2020 2020 2020 7265 7475  e)..        retu
+00017520: 726e 2068 616e 646c 655f 6f75 7428 6f75  rn handle_out(ou
+00017530: 742c 2072 6573 756c 7429 0a0a 2020 2020  t, result)..    
+00017540: 6465 6620 5f63 6f6e 7665 7274 5f74 696d  def _convert_tim
+00017550: 655f 636f 6c73 5f74 6f5f 6e75 6d65 7269  e_cols_to_numeri
+00017560: 6328 7365 6c66 2c20 7469 6d65 5f63 6f6c  c(self, time_col
+00017570: 732c 2061 7869 732c 206d 6574 612c 2073  s, axis, meta, s
+00017580: 6b69 706e 6129 3a0a 2020 2020 2020 2020  kipna):.        
+00017590: 6672 6f6d 2064 6173 6b2e 6461 7461 6672  from dask.datafr
+000175a0: 616d 652e 696f 2069 6d70 6f72 7420 6672  ame.io import fr
+000175b0: 6f6d 5f70 616e 6461 730a 0a20 2020 2020  om_pandas..     
+000175c0: 2020 206e 6565 6473 5f74 696d 655f 636f     needs_time_co
+000175d0: 6e76 6572 7369 6f6e 203d 2054 7275 650a  nversion = True.
+000175e0: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
+000175f0: 6520 616c 6c20 636f 6c75 6d6e 7320 6172  e all columns ar
+00017600: 6520 636f 7272 6563 7420 7479 7065 2e20  e correct type. 
+00017610: 4e65 6564 2074 6f20 7368 616c 6c6f 7720  Need to shallow 
+00017620: 636f 7079 2073 696e 6365 2063 6f6c 7320  copy since cols 
+00017630: 7769 6c6c 2062 6520 6d6f 6469 6669 6564  will be modified
+00017640: 0a20 2020 2020 2020 2069 6620 6178 6973  .        if axis
+00017650: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00017660: 2020 206e 756d 6572 6963 5f64 6420 3d20     numeric_dd = 
+00017670: 7365 6c66 5b6d 6574 612e 696e 6465 785d  self[meta.index]
+00017680: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+00017690: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000176a0: 2020 6e75 6d65 7269 635f 6464 203d 2073    numeric_dd = s
+000176b0: 656c 662e 636f 7079 2829 0a0a 2020 2020  elf.copy()..    
+000176c0: 2020 2020 2320 4d69 7820 6f66 2064 6174      # Mix of dat
+000176d0: 6574 696d 6573 2077 6974 6820 6f74 6865  etimes with othe
+000176e0: 7220 6e75 6d65 7269 6320 7479 7065 7320  r numeric types 
+000176f0: 7072 6f64 7563 6573 204e 614e 7320 666f  produces NaNs fo
+00017700: 7220 6561 6368 2076 616c 7565 2069 6e20  r each value in 
+00017710: 7374 6428 2920 7365 7269 6573 0a20 2020  std() series.   
+00017720: 2020 2020 2069 6620 6178 6973 203d 3d20       if axis == 
+00017730: 3120 616e 6420 6c65 6e28 7469 6d65 5f63  1 and len(time_c
+00017740: 6f6c 7329 2021 3d20 6c65 6e28 7365 6c66  ols) != len(self
+00017750: 2e63 6f6c 756d 6e73 293a 0a20 2020 2020  .columns):.     
+00017760: 2020 2020 2020 2023 2054 6869 7320 6973         # This is
+00017770: 2066 6173 7465 7220 7468 616e 2063 6f6e   faster than con
+00017780: 7665 7274 696e 6720 6561 6368 2063 6f6c  verting each col
+00017790: 756d 6e20 746f 206e 756d 6572 6963 2077  umn to numeric w
+000177a0: 6865 6e20 6974 2773 206e 6f74 206e 6563  hen it's not nec
+000177b0: 6573 7361 7279 0a20 2020 2020 2020 2020  essary.         
+000177c0: 2020 2023 2073 696e 6365 2065 6163 6820     # since each 
+000177d0: 7374 616e 6461 7264 2064 6576 6961 7469  standard deviati
+000177e0: 6f6e 2077 696c 6c20 6a75 7374 2062 6520  on will just be 
+000177f0: 4e61 4e0a 2020 2020 2020 2020 2020 2020  NaN.            
+00017800: 6e65 6564 735f 7469 6d65 5f63 6f6e 7665  needs_time_conve
+00017810: 7273 696f 6e20 3d20 4661 6c73 650a 2020  rsion = False.  
+00017820: 2020 2020 2020 2020 2020 6e75 6d65 7269            numeri
+00017830: 635f 6464 203d 2066 726f 6d5f 7061 6e64  c_dd = from_pand
+00017840: 6173 280a 2020 2020 2020 2020 2020 2020  as(.            
+00017850: 2020 2020 6d65 7461 5f66 7261 6d65 5f63      meta_frame_c
+00017860: 6f6e 7374 7275 6374 6f72 2873 656c 6629  onstructor(self)
+00017870: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017880: 2020 2020 2020 7b22 5f22 3a20 6d65 7461        {"_": meta
+00017890: 5f73 6572 6965 735f 636f 6e73 7472 7563  _series_construc
+000178a0: 746f 7228 7365 6c66 2928 5b6e 702e 6e61  tor(self)([np.na
+000178b0: 6e5d 297d 2c0a 2020 2020 2020 2020 2020  n])},.          
+000178c0: 2020 2020 2020 2020 2020 696e 6465 783d            index=
+000178d0: 7365 6c66 2e69 6e64 6578 2c0a 2020 2020  self.index,.    
+000178e0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+000178f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00017900: 7061 7274 6974 696f 6e73 3d73 656c 662e  partitions=self.
+00017910: 6e70 6172 7469 7469 6f6e 732c 0a20 2020  npartitions,.   
+00017920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00017930: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017940: 2020 2020 2023 2043 6f6e 7665 7274 2074       # Convert t
+00017950: 696d 6564 656c 7461 2061 6e64 2064 6174  imedelta and dat
+00017960: 6574 696d 6520 636f 6c75 6d6e 7320 746f  etime columns to
+00017970: 2069 6e74 6567 6572 2074 7970 6573 2073   integer types s
+00017980: 6f20 7765 2063 616e 2075 7365 2076 6172  o we can use var
+00017990: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000179a0: 2063 6f6c 2069 6e20 7469 6d65 5f63 6f6c   col in time_col
+000179b0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000179c0: 2020 206e 756d 6572 6963 5f64 645b 636f     numeric_dd[co
+000179d0: 6c5d 203d 205f 636f 6e76 6572 745f 746f  l] = _convert_to
+000179e0: 5f6e 756d 6572 6963 286e 756d 6572 6963  _numeric(numeric
+000179f0: 5f64 645b 636f 6c5d 2c20 736b 6970 6e61  _dd[col], skipna
+00017a00: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00017a10: 6e20 6e75 6d65 7269 635f 6464 2c20 6e65  n numeric_dd, ne
+00017a20: 6564 735f 7469 6d65 5f63 6f6e 7665 7273  eds_time_convers
+00017a30: 696f 6e0a 0a20 2020 2040 6465 7269 7665  ion..    @derive
+00017a40: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
+00017a50: 616d 6529 0a20 2020 2064 6566 2073 6b65  ame).    def ske
+00017a60: 7728 0a20 2020 2020 2020 2073 656c 662c  w(.        self,
+00017a70: 0a20 2020 2020 2020 2061 7869 733d 302c  .        axis=0,
+00017a80: 0a20 2020 2020 2020 2062 6961 733d 5472  .        bias=Tr
+00017a90: 7565 2c0a 2020 2020 2020 2020 6e61 6e5f  ue,.        nan_
+00017aa0: 706f 6c69 6379 3d22 7072 6f70 6167 6174  policy="propagat
+00017ab0: 6522 2c0a 2020 2020 2020 2020 6f75 743d  e",.        out=
+00017ac0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e75  None,.        nu
+00017ad0: 6d65 7269 635f 6f6e 6c79 3d6e 6f5f 6465  meric_only=no_de
+00017ae0: 6661 756c 742c 0a20 2020 2029 3a0a 2020  fault,.    ):.  
+00017af0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017b00: 2020 2e2e 206e 6f74 653a 3a0a 0a20 2020    .. note::..   
+00017b10: 2020 2020 2020 2020 5468 6973 2069 6d70          This imp
+00017b20: 6c65 6d65 6e74 6174 696f 6e20 666f 6c6c  lementation foll
+00017b30: 6f77 7320 7468 6520 6461 736b 2e61 7272  ows the dask.arr
+00017b40: 6179 2e73 7461 7473 2069 6d70 6c65 6d65  ay.stats impleme
+00017b50: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
+00017b60: 2020 206f 6620 736b 6577 6e65 7373 2061     of skewness a
+00017b70: 6e64 2063 616c 6375 6c61 7465 7320 736b  nd calculates sk
+00017b80: 6577 6e65 7373 2077 6974 686f 7574 2074  ewness without t
+00017b90: 616b 696e 6720 696e 746f 2061 6363 6f75  aking into accou
+00017ba0: 6e74 0a20 2020 2020 2020 2020 2020 6120  nt.           a 
+00017bb0: 6269 6173 2074 6572 6d20 666f 7220 6669  bias term for fi
+00017bc0: 6e69 7465 2073 616d 706c 6520 7369 7a65  nite sample size
+00017bd0: 2c20 7768 6963 6820 636f 7272 6573 706f  , which correspo
+00017be0: 6e64 7320 746f 2074 6865 0a20 2020 2020  nds to the.     
+00017bf0: 2020 2020 2020 6465 6661 756c 7420 7365        default se
+00017c00: 7474 696e 6773 206f 6620 7468 6520 7363  ttings of the sc
+00017c10: 6970 792e 7374 6174 7320 736b 6577 6e65  ipy.stats skewne
+00017c20: 7373 2063 616c 6375 6c61 7469 6f6e 2e20  ss calculation. 
+00017c30: 486f 7765 7665 722c 0a20 2020 2020 2020  However,.       
+00017c40: 2020 2020 5061 6e64 6173 2063 6f72 7265      Pandas corre
+00017c50: 6374 7320 666f 7220 7468 6973 2c20 736f  cts for this, so
+00017c60: 2074 6865 2076 616c 7565 7320 6469 6666   the values diff
+00017c70: 6572 2062 7920 6120 6661 6374 6f72 206f  er by a factor o
+00017c80: 660a 2020 2020 2020 2020 2020 2028 6e20  f.           (n 
+00017c90: 2a20 286e 202d 2031 2929 202a 2a20 302e  * (n - 1)) ** 0.
+00017ca0: 3520 2f20 286e 202d 2032 292c 2077 6865  5 / (n - 2), whe
+00017cb0: 7265 206e 2069 7320 7468 6520 6e75 6d62  re n is the numb
+00017cc0: 6572 206f 6620 7361 6d70 6c65 732e 0a0a  er of samples...
+00017cd0: 2020 2020 2020 2020 2020 2046 7572 7468             Furth
+00017ce0: 6572 2c20 7468 6973 206d 6574 686f 6420  er, this method 
+00017cf0: 6375 7272 656e 746c 7920 646f 6573 206e  currently does n
+00017d00: 6f74 2073 7570 706f 7274 2066 696c 7465  ot support filte
+00017d10: 7269 6e67 206f 7574 204e 614e 0a20 2020  ring out NaN.   
+00017d20: 2020 2020 2020 2020 7661 6c75 6573 2c20          values, 
+00017d30: 7768 6963 6820 6973 2061 6761 696e 2061  which is again a
+00017d40: 2064 6966 6665 7265 6e63 6520 746f 2050   difference to P
+00017d50: 616e 6461 732e 0a20 2020 2020 2020 2022  andas..        "
+00017d60: 2222 0a20 2020 2020 2020 2069 6620 5041  "".        if PA
+00017d70: 4e44 4153 5f47 545f 3230 3020 616e 6420  NDAS_GT_200 and 
+00017d80: 6178 6973 2069 7320 4e6f 6e65 3a0a 2020  axis is None:.  
+00017d90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00017da0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00017db0: 2020 2020 2020 2020 2020 2020 2260 6178              "`ax
+00017dc0: 6973 3d4e 6f6e 6560 2069 736e 2774 2063  is=None` isn't c
+00017dd0: 7572 7265 6e74 6c79 2073 7570 706f 7274  urrently support
+00017de0: 6564 2066 6f72 2060 736b 6577 6020 7768  ed for `skew` wh
+00017df0: 656e 2075 7369 6e67 2060 7061 6e64 6173  en using `pandas
+00017e00: 203e 3d32 6020 220a 2020 2020 2020 2020   >=2` ".        
+00017e10: 2020 2020 2020 2020 6622 2870 616e 6461          f"(panda
+00017e20: 733d 7b73 7472 2850 414e 4441 535f 5645  s={str(PANDAS_VE
+00017e30: 5253 494f 4e29 7d20 6973 2069 6e73 7461  RSION)} is insta
+00017e40: 6c6c 6564 292e 220a 2020 2020 2020 2020  lled).".        
+00017e50: 2020 2020 290a 2020 2020 2020 2020 6178      ).        ax
+00017e60: 6973 203d 2073 656c 662e 5f76 616c 6964  is = self._valid
+00017e70: 6174 655f 6178 6973 2861 7869 7329 0a20  ate_axis(axis). 
+00017e80: 2020 2020 2020 205f 7261 6973 655f 6966         _raise_if
+00017e90: 5f6f 626a 6563 745f 7365 7269 6573 2873  _object_series(s
+00017ea0: 656c 662c 2022 736b 6577 2229 0a20 2020  elf, "skew").   
+00017eb0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
+00017ec0: 795f 6b77 6172 6773 203d 2067 6574 5f6e  y_kwargs = get_n
+00017ed0: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
+00017ee0: 6773 286e 756d 6572 6963 5f6f 6e6c 7929  gs(numeric_only)
+00017ef0: 0a0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
+00017f00: 6461 7461 6672 616d 655f 6c69 6b65 2873  dataframe_like(s
+00017f10: 656c 6629 3a0a 2020 2020 2020 2020 2020  elf):.          
+00017f20: 2020 2320 4c65 7420 7061 6e64 6173 2072    # Let pandas r
+00017f30: 6169 7365 2065 7272 6f72 7320 6966 206e  aise errors if n
+00017f40: 6563 6573 7361 7279 0a20 2020 2020 2020  ecessary.       
+00017f50: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
+00017f60: 2e5f 6d65 7461 5f6e 6f6e 656d 7074 792e  ._meta_nonempty.
+00017f70: 736b 6577 2861 7869 733d 6178 6973 2c20  skew(axis=axis, 
+00017f80: 2a2a 6e75 6d65 7269 635f 6f6e 6c79 5f6b  **numeric_only_k
+00017f90: 7761 7267 7329 0a20 2020 2020 2020 2065  wargs).        e
+00017fa0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00017fb0: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
+00017fc0: 7461 5f6e 6f6e 656d 7074 792e 736b 6577  ta_nonempty.skew
+00017fd0: 2829 0a0a 2020 2020 2020 2020 6966 2061  ()..        if a
+00017fe0: 7869 7320 3d3d 2031 3a0a 2020 2020 2020  xis == 1:.      
+00017ff0: 2020 2020 2020 7265 7375 6c74 203d 206d        result = m
+00018000: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
+00018010: 2020 2020 2020 2020 2020 2020 2020 204d                 M
+00018020: 2e73 6b65 772c 0a20 2020 2020 2020 2020  .skew,.         
+00018030: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00018040: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00018050: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
+00018060: 2020 2020 2020 2020 746f 6b65 6e3d 7365          token=se
+00018070: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
+00018080: 202b 2022 736b 6577 222c 0a20 2020 2020   + "skew",.     
+00018090: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+000180a0: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+000180b0: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
+000180c0: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
+000180d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000180e0: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+000180f0: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
+00018100: 6573 756c 7429 0a20 2020 2020 2020 2065  esult).        e
+00018110: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00018120: 2069 6620 7365 6c66 2e6e 6469 6d20 3d3d   if self.ndim ==
+00018130: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00018140: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+00018150: 662e 5f73 6b65 775f 3164 2873 656c 662c  f._skew_1d(self,
+00018160: 2062 6961 733d 6269 6173 2c20 6e61 6e5f   bias=bias, nan_
+00018170: 706f 6c69 6379 3d6e 616e 5f70 6f6c 6963  policy=nan_polic
+00018180: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
+00018190: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
+000181a0: 5f6f 7574 286f 7574 2c20 7265 7375 6c74  _out(out, result
+000181b0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000181c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000181d0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+000181e0: 662e 5f73 6b65 775f 6e75 6d65 7269 6328  f._skew_numeric(
+000181f0: 6269 6173 3d62 6961 732c 206e 616e 5f70  bias=bias, nan_p
+00018200: 6f6c 6963 793d 6e61 6e5f 706f 6c69 6379  olicy=nan_policy
+00018210: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00018220: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+00018230: 662c 2044 6174 6146 7261 6d65 293a 0a20  f, DataFrame):. 
+00018240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018250: 6573 756c 742e 6469 7669 7369 6f6e 7320  esult.divisions 
+00018260: 3d20 2873 656c 662e 636f 6c75 6d6e 732e  = (self.columns.
+00018270: 6d69 6e28 292c 2073 656c 662e 636f 6c75  min(), self.colu
+00018280: 6d6e 732e 6d61 7828 2929 0a0a 2020 2020  mns.max())..    
+00018290: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+000182a0: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
+000182b0: 6573 756c 7429 0a0a 2020 2020 6465 6620  esult)..    def 
+000182c0: 5f73 6b65 775f 3164 2873 656c 662c 2063  _skew_1d(self, c
+000182d0: 6f6c 756d 6e2c 2062 6961 733d 5472 7565  olumn, bias=True
+000182e0: 2c20 6e61 6e5f 706f 6c69 6379 3d22 7072  , nan_policy="pr
+000182f0: 6f70 6167 6174 6522 293a 0a20 2020 2020  opagate"):.     
+00018300: 2020 2022 2222 3144 2076 6572 7369 6f6e     """1D version
+00018310: 206f 6620 7468 6520 736b 6577 2063 616c   of the skew cal
+00018320: 6375 6c61 7469 6f6e 2e0a 0a20 2020 2020  culation...     
+00018330: 2020 2055 7365 7320 7468 6520 6172 7261     Uses the arra
+00018340: 7920 7665 7273 696f 6e20 6672 6f6d 2064  y version from d
+00018350: 612e 7374 6174 7320 696e 2063 6173 6520  a.stats in case 
+00018360: 7765 2061 7265 2070 6173 7369 6e67 2069  we are passing i
+00018370: 6e20 6120 7369 6e67 6c65 2073 6572 6965  n a single serie
+00018380: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+00018390: 2020 2020 2020 2320 696d 706f 7274 2064        # import d
+000183a0: 6570 656e 6473 206f 6e20 7363 6970 792c  epends on scipy,
+000183b0: 206e 6f74 2069 6e73 7461 6c6c 6564 2062   not installed b
+000183c0: 7920 6465 6661 756c 740a 2020 2020 2020  y default.      
+000183d0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+000183e0: 7920 696d 706f 7274 2073 7461 7473 2061  y import stats a
+000183f0: 7320 6461 5f73 7461 7473 0a0a 2020 2020  s da_stats..    
+00018400: 2020 2020 6966 2070 642e 6170 692e 7479      if pd.api.ty
+00018410: 7065 732e 6973 5f65 7874 656e 7369 6f6e  pes.is_extension
+00018420: 5f61 7272 6179 5f64 7479 7065 2863 6f6c  _array_dtype(col
+00018430: 756d 6e2e 5f6d 6574 615f 6e6f 6e65 6d70  umn._meta_nonemp
+00018440: 7479 293a 0a20 2020 2020 2020 2020 2020  ty):.           
+00018450: 2063 6f6c 756d 6e20 3d20 636f 6c75 6d6e   column = column
+00018460: 2e61 7374 7970 6528 2266 3822 290a 0a20  .astype("f8").. 
+00018470: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00018480: 6e70 2e69 7373 7562 6474 7970 6528 636f  np.issubdtype(co
+00018490: 6c75 6d6e 2e64 7479 7065 2c20 6e70 2e6e  lumn.dtype, np.n
+000184a0: 756d 6265 7229 3a0a 2020 2020 2020 2020  umber):.        
+000184b0: 2020 2020 636f 6c75 6d6e 203d 2063 6f6c      column = col
+000184c0: 756d 6e2e 6173 7479 7065 2822 6638 2229  umn.astype("f8")
+000184d0: 0a0a 2020 2020 2020 2020 6e61 6d65 203d  ..        name =
+000184e0: 2073 656c 662e 5f74 6f6b 656e 5f70 7265   self._token_pre
+000184f0: 6669 7820 2b20 2273 6b65 772d 3164 2d22  fix + "skew-1d-"
+00018500: 202b 2074 6f6b 656e 697a 6528 636f 6c75   + tokenize(colu
+00018510: 6d6e 290a 0a20 2020 2020 2020 2061 7272  mn)..        arr
+00018520: 6179 5f73 6b65 7720 3d20 6461 5f73 7461  ay_skew = da_sta
+00018530: 7473 2e73 6b65 7728 0a20 2020 2020 2020  ts.skew(.       
+00018540: 2020 2020 2063 6f6c 756d 6e2e 7661 6c75       column.valu
+00018550: 6573 2c20 6178 6973 3d30 2c20 6269 6173  es, axis=0, bias
+00018560: 3d62 6961 732c 206e 616e 5f70 6f6c 6963  =bias, nan_polic
+00018570: 793d 6e61 6e5f 706f 6c69 6379 0a20 2020  y=nan_policy.   
+00018580: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00018590: 6c61 7965 7220 3d20 7b28 6e61 6d65 2c20  layer = {(name, 
+000185a0: 3029 3a20 286d 6574 686f 6473 2e77 7261  0): (methods.wra
+000185b0: 705f 736b 6577 5f72 6564 7563 7469 6f6e  p_skew_reduction
+000185c0: 2c20 2861 7272 6179 5f73 6b65 772e 5f6e  , (array_skew._n
+000185d0: 616d 652c 292c 204e 6f6e 6529 7d0a 2020  ame,), None)}.  
+000185e0: 2020 2020 2020 6772 6170 6820 3d20 4869        graph = Hi
+000185f0: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
+00018600: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6e61  m_collections(na
+00018610: 6d65 2c20 6c61 7965 722c 2064 6570 656e  me, layer, depen
+00018620: 6465 6e63 6965 733d 5b61 7272 6179 5f73  dencies=[array_s
+00018630: 6b65 775d 290a 0a20 2020 2020 2020 2072  kew])..        r
+00018640: 6574 7572 6e20 6e65 775f 6464 5f6f 626a  eturn new_dd_obj
+00018650: 6563 7428 0a20 2020 2020 2020 2020 2020  ect(.           
+00018660: 2067 7261 7068 2c20 6e61 6d65 2c20 636f   graph, name, co
+00018670: 6c75 6d6e 2e5f 6d65 7461 5f6e 6f6e 656d  lumn._meta_nonem
+00018680: 7074 792e 736b 6577 2829 2c20 6469 7669  pty.skew(), divi
+00018690: 7369 6f6e 733d 5b4e 6f6e 652c 204e 6f6e  sions=[None, Non
+000186a0: 655d 0a20 2020 2020 2020 2029 0a0a 2020  e].        )..  
+000186b0: 2020 6465 6620 5f73 6b65 775f 6e75 6d65    def _skew_nume
+000186c0: 7269 6328 7365 6c66 2c20 6269 6173 3d54  ric(self, bias=T
+000186d0: 7275 652c 206e 616e 5f70 6f6c 6963 793d  rue, nan_policy=
+000186e0: 2270 726f 7061 6761 7465 2229 3a0a 2020  "propagate"):.  
+000186f0: 2020 2020 2020 2222 224d 6574 686f 6420        """Method 
+00018700: 666f 7220 6461 7461 6672 616d 6573 2077  for dataframes w
+00018710: 6974 6820 6e75 6d65 7269 6320 636f 6c75  ith numeric colu
+00018720: 6d6e 732e 0a0a 2020 2020 2020 2020 4d61  mns...        Ma
+00018730: 7073 2074 6865 2061 7272 6179 2076 6572  ps the array ver
+00018740: 7369 6f6e 2066 726f 6d20 6461 2e73 7461  sion from da.sta
+00018750: 7473 206f 6e74 6f20 7468 6520 6e75 6d65  ts onto the nume
+00018760: 7269 6320 6172 7261 7920 6f66 2063 6f6c  ric array of col
+00018770: 756d 6e73 2e0a 2020 2020 2020 2020 2222  umns..        ""
+00018780: 220a 2020 2020 2020 2020 2320 696d 706f  ".        # impo
+00018790: 7274 2064 6570 656e 6473 206f 6e20 7363  rt depends on sc
+000187a0: 6970 792c 206e 6f74 2069 6e73 7461 6c6c  ipy, not install
+000187b0: 6564 2062 7920 6465 6661 756c 740a 2020  ed by default.  
+000187c0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+000187d0: 6172 7261 7920 696d 706f 7274 2073 7461  array import sta
+000187e0: 7473 2061 7320 6461 5f73 7461 7473 0a0a  ts as da_stats..
+000187f0: 2020 2020 2020 2020 6e75 6d20 3d20 7365          num = se
+00018800: 6c66 2e73 656c 6563 745f 6474 7970 6573  lf.select_dtypes
+00018810: 2869 6e63 6c75 6465 3d5b 226e 756d 6265  (include=["numbe
+00018820: 7222 2c20 2262 6f6f 6c22 5d2c 2065 7863  r", "bool"], exc
+00018830: 6c75 6465 3d5b 6e70 2e74 696d 6564 656c  lude=[np.timedel
+00018840: 7461 3634 5d29 0a0a 2020 2020 2020 2020  ta64])..        
+00018850: 7661 6c75 6573 5f64 7479 7065 203d 206e  values_dtype = n
+00018860: 756d 2e76 616c 7565 732e 6474 7970 650a  um.values.dtype.
+00018870: 2020 2020 2020 2020 6172 7261 795f 7661          array_va
+00018880: 6c75 6573 203d 206e 756d 2e76 616c 7565  lues = num.value
+00018890: 730a 0a20 2020 2020 2020 2069 6620 6e6f  s..        if no
+000188a0: 7420 6e70 2e69 7373 7562 6474 7970 6528  t np.issubdtype(
+000188b0: 7661 6c75 6573 5f64 7479 7065 2c20 6e70  values_dtype, np
+000188c0: 2e6e 756d 6265 7229 3a0a 2020 2020 2020  .number):.      
+000188d0: 2020 2020 2020 6172 7261 795f 7661 6c75        array_valu
+000188e0: 6573 203d 206e 756d 2e76 616c 7565 732e  es = num.values.
+000188f0: 6173 7479 7065 2822 6638 2229 0a0a 2020  astype("f8")..  
+00018900: 2020 2020 2020 6172 7261 795f 736b 6577        array_skew
+00018910: 203d 2064 615f 7374 6174 732e 736b 6577   = da_stats.skew
+00018920: 280a 2020 2020 2020 2020 2020 2020 6172  (.            ar
+00018930: 7261 795f 7661 6c75 6573 2c20 6178 6973  ray_values, axis
+00018940: 3d30 2c20 6269 6173 3d62 6961 732c 206e  =0, bias=bias, n
+00018950: 616e 5f70 6f6c 6963 793d 6e61 6e5f 706f  an_policy=nan_po
+00018960: 6c69 6379 0a20 2020 2020 2020 2029 0a0a  licy.        )..
+00018970: 2020 2020 2020 2020 6e61 6d65 203d 2073          name = s
+00018980: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
+00018990: 7820 2b20 2276 6172 2d6e 756d 6572 6963  x + "var-numeric
+000189a0: 2220 2b20 746f 6b65 6e69 7a65 286e 756d  " + tokenize(num
+000189b0: 290a 2020 2020 2020 2020 636f 6c73 203d  ).        cols =
+000189c0: 206e 756d 2e5f 6d65 7461 2e63 6f6c 756d   num._meta.colum
+000189d0: 6e73 2069 6620 6973 5f64 6174 6166 7261  ns if is_datafra
+000189e0: 6d65 5f6c 696b 6528 6e75 6d29 2065 6c73  me_like(num) els
+000189f0: 6520 4e6f 6e65 0a0a 2020 2020 2020 2020  e None..        
+00018a00: 7769 7468 2063 6865 636b 5f72 6564 7563  with check_reduc
+00018a10: 7469 6f6e 735f 7275 6e74 696d 655f 7761  tions_runtime_wa
+00018a20: 726e 696e 6728 293a 0a20 2020 2020 2020  rning():.       
+00018a30: 2020 2020 2073 6b65 775f 7368 6170 6520       skew_shape 
+00018a40: 3d20 6e75 6d2e 5f6d 6574 615f 6e6f 6e65  = num._meta_none
+00018a50: 6d70 7479 2e76 6172 2861 7869 733d 3029  mpty.var(axis=0)
+00018a60: 2e73 6861 7065 0a20 2020 2020 2020 2061  .shape.        a
+00018a70: 7272 6179 5f73 6b65 775f 6e61 6d65 203d  rray_skew_name =
+00018a80: 2028 6172 7261 795f 736b 6577 2e5f 6e61   (array_skew._na
+00018a90: 6d65 2c29 202b 2028 302c 2920 2a20 6c65  me,) + (0,) * le
+00018aa0: 6e28 736b 6577 5f73 6861 7065 290a 0a20  n(skew_shape).. 
+00018ab0: 2020 2020 2020 206c 6179 6572 203d 207b         layer = {
+00018ac0: 286e 616d 652c 2030 293a 2028 6d65 7468  (name, 0): (meth
+00018ad0: 6f64 732e 7772 6170 5f73 6b65 775f 7265  ods.wrap_skew_re
+00018ae0: 6475 6374 696f 6e2c 2061 7272 6179 5f73  duction, array_s
+00018af0: 6b65 775f 6e61 6d65 2c20 636f 6c73 297d  kew_name, cols)}
+00018b00: 0a20 2020 2020 2020 2067 7261 7068 203d  .        graph =
+00018b10: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
+00018b20: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
+00018b30: 286e 616d 652c 206c 6179 6572 2c20 6465  (name, layer, de
+00018b40: 7065 6e64 656e 6369 6573 3d5b 6172 7261  pendencies=[arra
+00018b50: 795f 736b 6577 5d29 0a0a 2020 2020 2020  y_skew])..      
+00018b60: 2020 7265 7475 726e 206e 6577 5f64 645f    return new_dd_
+00018b70: 6f62 6a65 6374 280a 2020 2020 2020 2020  object(.        
+00018b80: 2020 2020 6772 6170 682c 206e 616d 652c      graph, name,
+00018b90: 206e 756d 2e5f 6d65 7461 5f6e 6f6e 656d   num._meta_nonem
+00018ba0: 7074 792e 736b 6577 2829 2c20 6469 7669  pty.skew(), divi
+00018bb0: 7369 6f6e 733d 5b4e 6f6e 652c 204e 6f6e  sions=[None, Non
+00018bc0: 655d 0a20 2020 2020 2020 2029 0a0a 2020  e].        )..  
+00018bd0: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+00018be0: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
+00018bf0: 2020 6465 6620 6b75 7274 6f73 6973 280a    def kurtosis(.
+00018c00: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00018c10: 2020 2020 2020 6178 6973 3d30 2c0a 2020        axis=0,.  
+00018c20: 2020 2020 2020 6669 7368 6572 3d54 7275        fisher=Tru
+00018c30: 652c 0a20 2020 2020 2020 2062 6961 733d  e,.        bias=
+00018c40: 5472 7565 2c0a 2020 2020 2020 2020 6e61  True,.        na
+00018c50: 6e5f 706f 6c69 6379 3d22 7072 6f70 6167  n_policy="propag
+00018c60: 6174 6522 2c0a 2020 2020 2020 2020 6f75  ate",.        ou
+00018c70: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
+00018c80: 6e75 6d65 7269 635f 6f6e 6c79 3d6e 6f5f  numeric_only=no_
+00018c90: 6465 6661 756c 742c 0a20 2020 2029 3a0a  default,.    ):.
+00018ca0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00018cb0: 2020 2020 2e2e 206e 6f74 653a 3a0a 0a20      .. note::.. 
+00018cc0: 2020 2020 2020 2020 2020 5468 6973 2069            This i
+00018cd0: 6d70 6c65 6d65 6e74 6174 696f 6e20 666f  mplementation fo
+00018ce0: 6c6c 6f77 7320 7468 6520 6461 736b 2e61  llows the dask.a
+00018cf0: 7272 6179 2e73 7461 7473 2069 6d70 6c65  rray.stats imple
+00018d00: 6d65 6e74 6174 696f 6e0a 2020 2020 2020  mentation.      
+00018d10: 2020 2020 206f 6620 6b75 7274 6f73 6973       of kurtosis
+00018d20: 2061 6e64 2063 616c 6375 6c61 7465 7320   and calculates 
+00018d30: 6b75 7274 6f73 6973 2077 6974 686f 7574  kurtosis without
+00018d40: 2074 616b 696e 6720 696e 746f 2061 6363   taking into acc
+00018d50: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
+00018d60: 6120 6269 6173 2074 6572 6d20 666f 7220  a bias term for 
+00018d70: 6669 6e69 7465 2073 616d 706c 6520 7369  finite sample si
+00018d80: 7a65 2c20 7768 6963 6820 636f 7272 6573  ze, which corres
+00018d90: 706f 6e64 7320 746f 2074 6865 0a20 2020  ponds to the.   
+00018da0: 2020 2020 2020 2020 6465 6661 756c 7420          default 
+00018db0: 7365 7474 696e 6773 206f 6620 7468 6520  settings of the 
+00018dc0: 7363 6970 792e 7374 6174 7320 6b75 7274  scipy.stats kurt
+00018dd0: 6f73 6973 2063 616c 6375 6c61 7469 6f6e  osis calculation
+00018de0: 2e20 5468 6973 2064 6966 6665 7273 0a20  . This differs. 
+00018df0: 2020 2020 2020 2020 2020 6672 6f6d 2070            from p
+00018e00: 616e 6461 732e 0a0a 2020 2020 2020 2020  andas...        
+00018e10: 2020 2046 7572 7468 6572 2c20 7468 6973     Further, this
+00018e20: 206d 6574 686f 6420 6375 7272 656e 746c   method currentl
+00018e30: 7920 646f 6573 206e 6f74 2073 7570 706f  y does not suppo
+00018e40: 7274 2066 696c 7465 7269 6e67 206f 7574  rt filtering out
+00018e50: 204e 614e 0a20 2020 2020 2020 2020 2020   NaN.           
+00018e60: 7661 6c75 6573 2c20 7768 6963 6820 6973  values, which is
+00018e70: 2061 6761 696e 2061 2064 6966 6665 7265   again a differe
+00018e80: 6e63 6520 746f 2050 616e 6461 732e 0a20  nce to Pandas.. 
+00018e90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00018ea0: 2020 2069 6620 5041 4e44 4153 5f47 545f     if PANDAS_GT_
+00018eb0: 3230 3020 616e 6420 6178 6973 2069 7320  200 and axis is 
+00018ec0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00018ed0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00018ee0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00018ef0: 2020 2020 2260 6178 6973 3d4e 6f6e 6560      "`axis=None`
+00018f00: 2069 736e 2774 2063 7572 7265 6e74 6c79   isn't currently
+00018f10: 2073 7570 706f 7274 6564 2066 6f72 2060   supported for `
+00018f20: 6b75 7274 6f73 6973 6020 7768 656e 2075  kurtosis` when u
+00018f30: 7369 6e67 2060 7061 6e64 6173 203e 3d32  sing `pandas >=2
+00018f40: 6020 220a 2020 2020 2020 2020 2020 2020  ` ".            
+00018f50: 2020 2020 6622 2870 616e 6461 733d 7b73      f"(pandas={s
+00018f60: 7472 2850 414e 4441 535f 5645 5253 494f  tr(PANDAS_VERSIO
+00018f70: 4e29 7d20 6973 2069 6e73 7461 6c6c 6564  N)} is installed
+00018f80: 292e 220a 2020 2020 2020 2020 2020 2020  ).".            
+00018f90: 290a 2020 2020 2020 2020 6178 6973 203d  ).        axis =
+00018fa0: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
+00018fb0: 6178 6973 2861 7869 7329 0a20 2020 2020  axis(axis).     
+00018fc0: 2020 205f 7261 6973 655f 6966 5f6f 626a     _raise_if_obj
+00018fd0: 6563 745f 7365 7269 6573 2873 656c 662c  ect_series(self,
+00018fe0: 2022 6b75 7274 6f73 6973 2229 0a20 2020   "kurtosis").   
+00018ff0: 2020 2020 206e 756d 6572 6963 5f6f 6e6c       numeric_onl
+00019000: 795f 6b77 6172 6773 203d 2067 6574 5f6e  y_kwargs = get_n
+00019010: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
+00019020: 6773 286e 756d 6572 6963 5f6f 6e6c 7929  gs(numeric_only)
+00019030: 0a0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
+00019040: 6461 7461 6672 616d 655f 6c69 6b65 2873  dataframe_like(s
+00019050: 656c 6629 3a0a 2020 2020 2020 2020 2020  elf):.          
+00019060: 2020 2320 4c65 7420 7061 6e64 6173 2072    # Let pandas r
+00019070: 6169 7365 2065 7272 6f72 7320 6966 206e  aise errors if n
+00019080: 6563 6573 7361 7279 0a20 2020 2020 2020  ecessary.       
+00019090: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
+000190a0: 2e5f 6d65 7461 5f6e 6f6e 656d 7074 792e  ._meta_nonempty.
+000190b0: 6b75 7274 6f73 6973 2861 7869 733d 6178  kurtosis(axis=ax
+000190c0: 6973 2c20 2a2a 6e75 6d65 7269 635f 6f6e  is, **numeric_on
+000190d0: 6c79 5f6b 7761 7267 7329 0a20 2020 2020  ly_kwargs).     
+000190e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000190f0: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
+00019100: 2e5f 6d65 7461 5f6e 6f6e 656d 7074 792e  ._meta_nonempty.
+00019110: 6b75 7274 6f73 6973 2829 0a0a 2020 2020  kurtosis()..    
+00019120: 2020 2020 6966 2061 7869 7320 3d3d 2031      if axis == 1
+00019130: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00019140: 7375 6c74 203d 206d 6170 5f70 6172 7469  sult = map_parti
+00019150: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
+00019160: 2020 2020 2020 204d 2e6b 7572 746f 7369         M.kurtosi
+00019170: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00019180: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00019190: 2020 2020 2020 2020 206d 6574 613d 6d65           meta=me
+000191a0: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
+000191b0: 2020 2020 746f 6b65 6e3d 7365 6c66 2e5f      token=self._
+000191c0: 746f 6b65 6e5f 7072 6566 6978 202b 2022  token_prefix + "
+000191d0: 6b75 7274 6f73 6973 222c 0a20 2020 2020  kurtosis",.     
+000191e0: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+000191f0: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+00019200: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
+00019210: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
+00019220: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00019230: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+00019240: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
+00019250: 6573 756c 7429 0a20 2020 2020 2020 2065  esult).        e
+00019260: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00019270: 2069 6620 7365 6c66 2e6e 6469 6d20 3d3d   if self.ndim ==
+00019280: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00019290: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+000192a0: 662e 5f6b 7572 746f 7369 735f 3164 280a  f._kurtosis_1d(.
+000192b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192c0: 2020 2020 7365 6c66 2c20 6669 7368 6572      self, fisher
+000192d0: 3d66 6973 6865 722c 2062 6961 733d 6269  =fisher, bias=bi
+000192e0: 6173 2c20 6e61 6e5f 706f 6c69 6379 3d6e  as, nan_policy=n
+000192f0: 616e 5f70 6f6c 6963 790a 2020 2020 2020  an_policy.      
+00019300: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00019310: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00019320: 726e 2068 616e 646c 655f 6f75 7428 6f75  rn handle_out(ou
+00019330: 742c 2072 6573 756c 7429 0a20 2020 2020  t, result).     
+00019340: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00019350: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00019360: 756c 7420 3d20 7365 6c66 2e5f 6b75 7274  ult = self._kurt
+00019370: 6f73 6973 5f6e 756d 6572 6963 280a 2020  osis_numeric(.  
+00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019390: 2020 6669 7368 6572 3d66 6973 6865 722c    fisher=fisher,
+000193a0: 2062 6961 733d 6269 6173 2c20 6e61 6e5f   bias=bias, nan_
+000193b0: 706f 6c69 6379 3d6e 616e 5f70 6f6c 6963  policy=nan_polic
+000193c0: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+000193d0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+000193e0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+000193f0: 656c 662c 2044 6174 6146 7261 6d65 293a  elf, DataFrame):
+00019400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019410: 2072 6573 756c 742e 6469 7669 7369 6f6e   result.division
+00019420: 7320 3d20 2873 656c 662e 636f 6c75 6d6e  s = (self.column
+00019430: 732e 6d69 6e28 292c 2073 656c 662e 636f  s.min(), self.co
+00019440: 6c75 6d6e 732e 6d61 7828 2929 0a0a 2020  lumns.max())..  
+00019450: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019460: 2068 616e 646c 655f 6f75 7428 6f75 742c   handle_out(out,
+00019470: 2072 6573 756c 7429 0a0a 2020 2020 6465   result)..    de
+00019480: 6620 5f6b 7572 746f 7369 735f 3164 2873  f _kurtosis_1d(s
+00019490: 656c 662c 2063 6f6c 756d 6e2c 2066 6973  elf, column, fis
+000194a0: 6865 723d 5472 7565 2c20 6269 6173 3d54  her=True, bias=T
+000194b0: 7275 652c 206e 616e 5f70 6f6c 6963 793d  rue, nan_policy=
+000194c0: 2270 726f 7061 6761 7465 2229 3a0a 2020  "propagate"):.  
+000194d0: 2020 2020 2020 2222 2231 4420 7665 7273        """1D vers
+000194e0: 696f 6e20 6f66 2074 6865 206b 7572 746f  ion of the kurto
+000194f0: 7369 7320 6361 6c63 756c 6174 696f 6e2e  sis calculation.
+00019500: 0a0a 2020 2020 2020 2020 5573 6573 2074  ..        Uses t
+00019510: 6865 2061 7272 6179 2076 6572 7369 6f6e  he array version
+00019520: 2066 726f 6d20 6461 2e73 7461 7473 2069   from da.stats i
+00019530: 6e20 6361 7365 2077 6520 6172 6520 7061  n case we are pa
+00019540: 7373 696e 6720 696e 2061 2073 696e 676c  ssing in a singl
+00019550: 6520 7365 7269 6573 0a20 2020 2020 2020  e series.       
+00019560: 2022 2222 0a20 2020 2020 2020 2023 2069   """.        # i
+00019570: 6d70 6f72 7420 6465 7065 6e64 7320 6f6e  mport depends on
+00019580: 2073 6369 7079 2c20 6e6f 7420 696e 7374   scipy, not inst
+00019590: 616c 6c65 6420 6279 2064 6566 6175 6c74  alled by default
+000195a0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+000195b0: 736b 2e61 7272 6179 2069 6d70 6f72 7420  sk.array import 
+000195c0: 7374 6174 7320 6173 2064 615f 7374 6174  stats as da_stat
+000195d0: 730a 0a20 2020 2020 2020 2069 6620 7064  s..        if pd
+000195e0: 2e61 7069 2e74 7970 6573 2e69 735f 6578  .api.types.is_ex
+000195f0: 7465 6e73 696f 6e5f 6172 7261 795f 6474  tension_array_dt
+00019600: 7970 6528 636f 6c75 6d6e 2e5f 6d65 7461  ype(column._meta
+00019610: 5f6e 6f6e 656d 7074 7929 3a0a 2020 2020  _nonempty):.    
+00019620: 2020 2020 2020 2020 636f 6c75 6d6e 203d          column =
+00019630: 2063 6f6c 756d 6e2e 6173 7479 7065 2822   column.astype("
+00019640: 6638 2229 0a0a 2020 2020 2020 2020 656c  f8")..        el
+00019650: 6966 206e 6f74 206e 702e 6973 7375 6264  if not np.issubd
+00019660: 7479 7065 2863 6f6c 756d 6e2e 6474 7970  type(column.dtyp
+00019670: 652c 206e 702e 6e75 6d62 6572 293a 0a20  e, np.number):. 
+00019680: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+00019690: 6e20 3d20 636f 6c75 6d6e 2e61 7374 7970  n = column.astyp
+000196a0: 6528 2266 3822 290a 0a20 2020 2020 2020  e("f8")..       
+000196b0: 206e 616d 6520 3d20 7365 6c66 2e5f 746f   name = self._to
+000196c0: 6b65 6e5f 7072 6566 6978 202b 2022 6b75  ken_prefix + "ku
+000196d0: 7274 6f73 6973 2d31 642d 2220 2b20 746f  rtosis-1d-" + to
+000196e0: 6b65 6e69 7a65 2863 6f6c 756d 6e29 0a0a  kenize(column)..
+000196f0: 2020 2020 2020 2020 6172 7261 795f 6b75          array_ku
+00019700: 7274 6f73 6973 203d 2064 615f 7374 6174  rtosis = da_stat
+00019710: 732e 6b75 7274 6f73 6973 280a 2020 2020  s.kurtosis(.    
+00019720: 2020 2020 2020 2020 636f 6c75 6d6e 2e76          column.v
+00019730: 616c 7565 732c 2061 7869 733d 302c 2066  alues, axis=0, f
+00019740: 6973 6865 723d 6669 7368 6572 2c20 6269  isher=fisher, bi
+00019750: 6173 3d62 6961 732c 206e 616e 5f70 6f6c  as=bias, nan_pol
+00019760: 6963 793d 6e61 6e5f 706f 6c69 6379 0a20  icy=nan_policy. 
+00019770: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00019780: 2020 6c61 7965 7220 3d20 7b0a 2020 2020    layer = {.    
+00019790: 2020 2020 2020 2020 286e 616d 652c 2030          (name, 0
+000197a0: 293a 2028 6d65 7468 6f64 732e 7772 6170  ): (methods.wrap
+000197b0: 5f6b 7572 746f 7369 735f 7265 6475 6374  _kurtosis_reduct
+000197c0: 696f 6e2c 2028 6172 7261 795f 6b75 7274  ion, (array_kurt
+000197d0: 6f73 6973 2e5f 6e61 6d65 2c29 2c20 4e6f  osis._name,), No
+000197e0: 6e65 290a 2020 2020 2020 2020 7d0a 2020  ne).        }.  
+000197f0: 2020 2020 2020 6772 6170 6820 3d20 4869        graph = Hi
+00019800: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
+00019810: 6d5f 636f 6c6c 6563 7469 6f6e 7328 0a20  m_collections(. 
+00019820: 2020 2020 2020 2020 2020 206e 616d 652c             name,
+00019830: 206c 6179 6572 2c20 6465 7065 6e64 656e   layer, dependen
+00019840: 6369 6573 3d5b 6172 7261 795f 6b75 7274  cies=[array_kurt
+00019850: 6f73 6973 5d0a 2020 2020 2020 2020 290a  osis].        ).
+00019860: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019870: 6e65 775f 6464 5f6f 626a 6563 7428 0a20  new_dd_object(. 
+00019880: 2020 2020 2020 2020 2020 2067 7261 7068             graph
+00019890: 2c20 6e61 6d65 2c20 636f 6c75 6d6e 2e5f  , name, column._
+000198a0: 6d65 7461 5f6e 6f6e 656d 7074 792e 6b75  meta_nonempty.ku
+000198b0: 7274 6f73 6973 2829 2c20 6469 7669 7369  rtosis(), divisi
+000198c0: 6f6e 733d 5b4e 6f6e 652c 204e 6f6e 655d  ons=[None, None]
+000198d0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000198e0: 6465 6620 5f6b 7572 746f 7369 735f 6e75  def _kurtosis_nu
+000198f0: 6d65 7269 6328 7365 6c66 2c20 6669 7368  meric(self, fish
+00019900: 6572 3d54 7275 652c 2062 6961 733d 5472  er=True, bias=Tr
+00019910: 7565 2c20 6e61 6e5f 706f 6c69 6379 3d22  ue, nan_policy="
+00019920: 7072 6f70 6167 6174 6522 293a 0a20 2020  propagate"):.   
+00019930: 2020 2020 2022 2222 4d65 7468 6f64 2066       """Method f
+00019940: 6f72 2064 6174 6166 7261 6d65 7320 7769  or dataframes wi
+00019950: 7468 206e 756d 6572 6963 2063 6f6c 756d  th numeric colum
+00019960: 6e73 2e0a 0a20 2020 2020 2020 204d 6170  ns...        Map
+00019970: 7320 7468 6520 6172 7261 7920 7665 7273  s the array vers
+00019980: 696f 6e20 6672 6f6d 2064 612e 7374 6174  ion from da.stat
+00019990: 7320 6f6e 746f 2074 6865 206e 756d 6572  s onto the numer
+000199a0: 6963 2061 7272 6179 206f 6620 636f 6c75  ic array of colu
+000199b0: 6d6e 732e 0a20 2020 2020 2020 2022 2222  mns..        """
+000199c0: 0a20 2020 2020 2020 2023 2069 6d70 6f72  .        # impor
+000199d0: 7420 6465 7065 6e64 7320 6f6e 2073 6369  t depends on sci
+000199e0: 7079 2c20 6e6f 7420 696e 7374 616c 6c65  py, not installe
+000199f0: 6420 6279 2064 6566 6175 6c74 0a20 2020  d by default.   
+00019a00: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+00019a10: 7272 6179 2069 6d70 6f72 7420 7374 6174  rray import stat
+00019a20: 7320 6173 2064 615f 7374 6174 730a 0a20  s as da_stats.. 
+00019a30: 2020 2020 2020 206e 756d 203d 2073 656c         num = sel
+00019a40: 662e 7365 6c65 6374 5f64 7479 7065 7328  f.select_dtypes(
+00019a50: 696e 636c 7564 653d 5b22 6e75 6d62 6572  include=["number
+00019a60: 222c 2022 626f 6f6c 225d 2c20 6578 636c  ", "bool"], excl
+00019a70: 7564 653d 5b6e 702e 7469 6d65 6465 6c74  ude=[np.timedelt
+00019a80: 6136 345d 290a 0a20 2020 2020 2020 2076  a64])..        v
+00019a90: 616c 7565 735f 6474 7970 6520 3d20 6e75  alues_dtype = nu
+00019aa0: 6d2e 7661 6c75 6573 2e64 7479 7065 0a20  m.values.dtype. 
+00019ab0: 2020 2020 2020 2061 7272 6179 5f76 616c         array_val
+00019ac0: 7565 7320 3d20 6e75 6d2e 7661 6c75 6573  ues = num.values
+00019ad0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00019ae0: 206e 702e 6973 7375 6264 7479 7065 2876   np.issubdtype(v
+00019af0: 616c 7565 735f 6474 7970 652c 206e 702e  alues_dtype, np.
+00019b00: 6e75 6d62 6572 293a 0a20 2020 2020 2020  number):.       
+00019b10: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
+00019b20: 7320 3d20 6e75 6d2e 7661 6c75 6573 2e61  s = num.values.a
+00019b30: 7374 7970 6528 2266 3822 290a 0a20 2020  stype("f8")..   
+00019b40: 2020 2020 2061 7272 6179 5f6b 7572 746f       array_kurto
+00019b50: 7369 7320 3d20 6461 5f73 7461 7473 2e6b  sis = da_stats.k
+00019b60: 7572 746f 7369 7328 0a20 2020 2020 2020  urtosis(.       
+00019b70: 2020 2020 2061 7272 6179 5f76 616c 7565       array_value
+00019b80: 732c 2061 7869 733d 302c 2066 6973 6865  s, axis=0, fishe
+00019b90: 723d 6669 7368 6572 2c20 6269 6173 3d62  r=fisher, bias=b
+00019ba0: 6961 732c 206e 616e 5f70 6f6c 6963 793d  ias, nan_policy=
+00019bb0: 6e61 6e5f 706f 6c69 6379 0a20 2020 2020  nan_policy.     
+00019bc0: 2020 2029 0a0a 2020 2020 2020 2020 6e61     )..        na
+00019bd0: 6d65 203d 2073 656c 662e 5f74 6f6b 656e  me = self._token
+00019be0: 5f70 7265 6669 7820 2b20 226b 7572 746f  _prefix + "kurto
+00019bf0: 7369 732d 6e75 6d65 7269 6322 202b 2074  sis-numeric" + t
+00019c00: 6f6b 656e 697a 6528 6e75 6d29 0a20 2020  okenize(num).   
+00019c10: 2020 2020 2063 6f6c 7320 3d20 6e75 6d2e       cols = num.
+00019c20: 5f6d 6574 612e 636f 6c75 6d6e 7320 6966  _meta.columns if
+00019c30: 2069 735f 6461 7461 6672 616d 655f 6c69   is_dataframe_li
+00019c40: 6b65 286e 756d 2920 656c 7365 204e 6f6e  ke(num) else Non
+00019c50: 650a 0a20 2020 2020 2020 2077 6974 6820  e..        with 
+00019c60: 6368 6563 6b5f 7265 6475 6374 696f 6e73  check_reductions
+00019c70: 5f72 756e 7469 6d65 5f77 6172 6e69 6e67  _runtime_warning
+00019c80: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00019c90: 6b75 7274 6f73 6973 5f73 6861 7065 203d  kurtosis_shape =
+00019ca0: 206e 756d 2e5f 6d65 7461 5f6e 6f6e 656d   num._meta_nonem
+00019cb0: 7074 792e 7661 7228 6178 6973 3d30 292e  pty.var(axis=0).
+00019cc0: 7368 6170 650a 2020 2020 2020 2020 6172  shape.        ar
+00019cd0: 7261 795f 6b75 7274 6f73 6973 5f6e 616d  ray_kurtosis_nam
+00019ce0: 6520 3d20 2861 7272 6179 5f6b 7572 746f  e = (array_kurto
+00019cf0: 7369 732e 5f6e 616d 652c 2920 2b20 2830  sis._name,) + (0
+00019d00: 2c29 202a 206c 656e 286b 7572 746f 7369  ,) * len(kurtosi
+00019d10: 735f 7368 6170 6529 0a0a 2020 2020 2020  s_shape)..      
+00019d20: 2020 6c61 7965 7220 3d20 7b0a 2020 2020    layer = {.    
+00019d30: 2020 2020 2020 2020 286e 616d 652c 2030          (name, 0
+00019d40: 293a 2028 6d65 7468 6f64 732e 7772 6170  ): (methods.wrap
+00019d50: 5f6b 7572 746f 7369 735f 7265 6475 6374  _kurtosis_reduct
+00019d60: 696f 6e2c 2061 7272 6179 5f6b 7572 746f  ion, array_kurto
+00019d70: 7369 735f 6e61 6d65 2c20 636f 6c73 290a  sis_name, cols).
+00019d80: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00019d90: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
+00019da0: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
+00019db0: 6c6c 6563 7469 6f6e 7328 0a20 2020 2020  llections(.     
+00019dc0: 2020 2020 2020 206e 616d 652c 206c 6179         name, lay
+00019dd0: 6572 2c20 6465 7065 6e64 656e 6369 6573  er, dependencies
+00019de0: 3d5b 6172 7261 795f 6b75 7274 6f73 6973  =[array_kurtosis
+00019df0: 5d0a 2020 2020 2020 2020 290a 0a20 2020  ].        )..   
+00019e00: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+00019e10: 6464 5f6f 626a 6563 7428 0a20 2020 2020  dd_object(.     
+00019e20: 2020 2020 2020 2067 7261 7068 2c20 6e61         graph, na
+00019e30: 6d65 2c20 6e75 6d2e 5f6d 6574 615f 6e6f  me, num._meta_no
+00019e40: 6e65 6d70 7479 2e6b 7572 746f 7369 7328  nempty.kurtosis(
+00019e50: 292c 2064 6976 6973 696f 6e73 3d5b 4e6f  ), divisions=[No
+00019e60: 6e65 2c20 4e6f 6e65 5d0a 2020 2020 2020  ne, None].      
+00019e70: 2020 290a 0a20 2020 2040 5f6e 756d 6572    )..    @_numer
+00019e80: 6963 5f6f 6e6c 790a 2020 2020 4064 6572  ic_only.    @der
+00019e90: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
+00019ea0: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
+00019eb0: 7365 6d28 7365 6c66 2c20 6178 6973 3d4e  sem(self, axis=N
+00019ec0: 6f6e 652c 2073 6b69 706e 613d 5472 7565  one, skipna=True
+00019ed0: 2c20 6464 6f66 3d31 2c20 7370 6c69 745f  , ddof=1, split_
+00019ee0: 6576 6572 793d 4661 6c73 652c 206e 756d  every=False, num
+00019ef0: 6572 6963 5f6f 6e6c 793d 4e6f 6e65 293a  eric_only=None):
+00019f00: 0a20 2020 2020 2020 2061 7869 7320 3d20  .        axis = 
+00019f10: 7365 6c66 2e5f 7661 6c69 6461 7465 5f61  self._validate_a
+00019f20: 7869 7328 6178 6973 290a 2020 2020 2020  xis(axis).      
+00019f30: 2020 5f72 6169 7365 5f69 665f 6f62 6a65    _raise_if_obje
+00019f40: 6374 5f73 6572 6965 7328 7365 6c66 2c20  ct_series(self, 
+00019f50: 2273 656d 2229 0a20 2020 2020 2020 2077  "sem").        w
+00019f60: 6974 6820 6368 6563 6b5f 6e75 6d65 7269  ith check_numeri
+00019f70: 635f 6f6e 6c79 5f64 6570 7265 6361 7469  c_only_deprecati
+00019f80: 6f6e 2829 3a0a 2020 2020 2020 2020 2020  on():.          
+00019f90: 2020 6d65 7461 203d 2073 656c 662e 5f6d    meta = self._m
+00019fa0: 6574 615f 6e6f 6e65 6d70 7479 2e73 656d  eta_nonempty.sem
+00019fb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019fc0: 2020 6178 6973 3d61 7869 732c 2073 6b69    axis=axis, ski
+00019fd0: 706e 613d 736b 6970 6e61 2c20 6464 6f66  pna=skipna, ddof
+00019fe0: 3d64 646f 662c 206e 756d 6572 6963 5f6f  =ddof, numeric_o
+00019ff0: 6e6c 793d 6e75 6d65 7269 635f 6f6e 6c79  nly=numeric_only
+0001a000: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001a010: 2020 2020 2020 2069 6620 6178 6973 203d         if axis =
+0001a020: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0001a030: 2072 6574 7572 6e20 6d61 705f 7061 7274   return map_part
+0001a040: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
+0001a050: 2020 2020 2020 2020 4d2e 7365 6d2c 0a20          M.sem,. 
+0001a060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a070: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0001a080: 2020 2020 206d 6574 613d 6d65 7461 2c0a       meta=meta,.
+0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0a0: 746f 6b65 6e3d 7365 6c66 2e5f 746f 6b65  token=self._toke
+0001a0b0: 6e5f 7072 6566 6978 202b 2022 7365 6d22  n_prefix + "sem"
+0001a0c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a0d0: 2020 6178 6973 3d61 7869 732c 0a20 2020    axis=axis,.   
+0001a0e0: 2020 2020 2020 2020 2020 2020 2073 6b69               ski
+0001a0f0: 706e 613d 736b 6970 6e61 2c0a 2020 2020  pna=skipna,.    
+0001a100: 2020 2020 2020 2020 2020 2020 6464 6f66              ddof
+0001a110: 3d64 646f 662c 0a20 2020 2020 2020 2020  =ddof,.         
+0001a120: 2020 2020 2020 2070 6172 656e 745f 6d65         parent_me
+0001a130: 7461 3d73 656c 662e 5f6d 6574 612c 0a20  ta=self._meta,. 
+0001a140: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001a150: 756d 6572 6963 5f6f 6e6c 793d 6e75 6d65  umeric_only=nume
+0001a160: 7269 635f 6f6e 6c79 2c0a 2020 2020 2020  ric_only,.      
+0001a170: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001a180: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001a190: 2020 6e75 6d20 3d20 7365 6c66 2e5f 6765    num = self._ge
+0001a1a0: 745f 6e75 6d65 7269 635f 6461 7461 2829  t_numeric_data()
+0001a1b0: 0a20 2020 2020 2020 2020 2020 2076 203d  .            v =
+0001a1c0: 206e 756d 2e76 6172 2873 6b69 706e 613d   num.var(skipna=
+0001a1d0: 736b 6970 6e61 2c20 6464 6f66 3d64 646f  skipna, ddof=ddo
+0001a1e0: 662c 2073 706c 6974 5f65 7665 7279 3d73  f, split_every=s
+0001a1f0: 706c 6974 5f65 7665 7279 290a 2020 2020  plit_every).    
+0001a200: 2020 2020 2020 2020 6e20 3d20 6e75 6d2e          n = num.
+0001a210: 636f 756e 7428 7370 6c69 745f 6576 6572  count(split_ever
+0001a220: 793d 7370 6c69 745f 6576 6572 7929 0a20  y=split_every). 
+0001a230: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0001a240: 3d20 7365 6c66 2e5f 746f 6b65 6e5f 7072  = self._token_pr
+0001a250: 6566 6978 202b 2022 7365 6d22 0a20 2020  efix + "sem".   
+0001a260: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0001a270: 3d20 6d61 705f 7061 7274 6974 696f 6e73  = map_partitions
+0001a280: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001a290: 2020 6e70 2e73 7172 742c 0a20 2020 2020    np.sqrt,.     
+0001a2a0: 2020 2020 2020 2020 2020 2076 202f 206e             v / n
+0001a2b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a2c0: 2020 6d65 7461 3d6d 6574 612c 0a20 2020    meta=meta,.   
+0001a2d0: 2020 2020 2020 2020 2020 2020 2074 6f6b               tok
+0001a2e0: 656e 3d6e 616d 652c 0a20 2020 2020 2020  en=name,.       
+0001a2f0: 2020 2020 2020 2020 2065 6e66 6f72 6365           enforce
+0001a300: 5f6d 6574 6164 6174 613d 4661 6c73 652c  _metadata=False,
+0001a310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a320: 2070 6172 656e 745f 6d65 7461 3d73 656c   parent_meta=sel
+0001a330: 662e 5f6d 6574 612c 0a20 2020 2020 2020  f._meta,.       
+0001a340: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001a350: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001a360: 6528 7365 6c66 2c20 4461 7461 4672 616d  e(self, DataFram
+0001a370: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0001a380: 2020 2020 7265 7375 6c74 2e64 6976 6973      result.divis
+0001a390: 696f 6e73 203d 2028 7365 6c66 2e63 6f6c  ions = (self.col
+0001a3a0: 756d 6e73 2e6d 696e 2829 2c20 7365 6c66  umns.min(), self
+0001a3b0: 2e63 6f6c 756d 6e73 2e6d 6178 2829 290a  .columns.max()).
+0001a3c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001a3d0: 726e 2072 6573 756c 740a 0a20 2020 2064  rn result..    d
+0001a3e0: 6566 2071 7561 6e74 696c 6528 7365 6c66  ef quantile(self
+0001a3f0: 2c20 713d 302e 352c 2061 7869 733d 302c  , q=0.5, axis=0,
+0001a400: 206e 756d 6572 6963 5f6f 6e6c 793d 6e6f   numeric_only=no
+0001a410: 5f64 6566 6175 6c74 2c20 6d65 7468 6f64  _default, method
+0001a420: 3d22 6465 6661 756c 7422 293a 0a20 2020  ="default"):.   
+0001a430: 2020 2020 2022 2222 4170 7072 6f78 696d       """Approxim
+0001a440: 6174 6520 726f 772d 7769 7365 2061 6e64  ate row-wise and
+0001a450: 2070 7265 6369 7365 2063 6f6c 756d 6e2d   precise column-
+0001a460: 7769 7365 2071 7561 6e74 696c 6573 206f  wise quantiles o
+0001a470: 6620 4461 7461 4672 616d 650a 0a20 2020  f DataFrame..   
+0001a480: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0001a490: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0001a4a0: 2d2d 0a20 2020 2020 2020 2071 203a 206c  --.        q : l
+0001a4b0: 6973 742f 6172 7261 7920 6f66 2066 6c6f  ist/array of flo
+0001a4c0: 6174 732c 2064 6566 6175 6c74 2030 2e35  ats, default 0.5
+0001a4d0: 2028 3530 2529 0a20 2020 2020 2020 2020   (50%).         
+0001a4e0: 2020 2049 7465 7261 626c 6520 6f66 206e     Iterable of n
+0001a4f0: 756d 6265 7273 2072 616e 6769 6e67 2066  umbers ranging f
+0001a500: 726f 6d20 3020 746f 2031 2066 6f72 2074  rom 0 to 1 for t
+0001a510: 6865 2064 6573 6972 6564 2071 7561 6e74  he desired quant
+0001a520: 696c 6573 0a20 2020 2020 2020 2061 7869  iles.        axi
+0001a530: 7320 3a20 7b30 2c20 312c 2027 696e 6465  s : {0, 1, 'inde
+0001a540: 7827 2c20 2763 6f6c 756d 6e73 277d 2028  x', 'columns'} (
+0001a550: 6465 6661 756c 7420 3029 0a20 2020 2020  default 0).     
+0001a560: 2020 2020 2020 2030 206f 7220 2769 6e64         0 or 'ind
+0001a570: 6578 2720 666f 7220 726f 772d 7769 7365  ex' for row-wise
+0001a580: 2c20 3120 6f72 2027 636f 6c75 6d6e 7327  , 1 or 'columns'
+0001a590: 2066 6f72 2063 6f6c 756d 6e2d 7769 7365   for column-wise
+0001a5a0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+0001a5b0: 3a20 7b27 6465 6661 756c 7427 2c20 2774  : {'default', 't
+0001a5c0: 6469 6765 7374 272c 2027 6461 736b 277d  digest', 'dask'}
+0001a5d0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001a5e0: 2020 2020 2020 2057 6861 7420 6d65 7468         What meth
+0001a5f0: 6f64 2074 6f20 7573 652e 2042 7920 6465  od to use. By de
+0001a600: 6661 756c 7420 7769 6c6c 2075 7365 2064  fault will use d
+0001a610: 6173 6b27 7320 696e 7465 726e 616c 2063  ask's internal c
+0001a620: 7573 746f 6d0a 2020 2020 2020 2020 2020  ustom.          
+0001a630: 2020 616c 676f 7269 7468 6d20 2860 6027    algorithm (``'
+0001a640: 6461 736b 2760 6029 2e20 2049 6620 7365  dask'``).  If se
+0001a650: 7420 746f 2060 6027 7464 6967 6573 7427  t to ``'tdigest'
+0001a660: 6060 2077 696c 6c20 7573 6520 7464 6967  `` will use tdig
+0001a670: 6573 740a 2020 2020 2020 2020 2020 2020  est.            
+0001a680: 666f 7220 666c 6f61 7473 2061 6e64 2069  for floats and i
+0001a690: 6e74 7320 616e 6420 6661 6c6c 6261 636b  nts and fallback
+0001a6a0: 2074 6f20 7468 6520 6060 2764 6173 6b27   to the ``'dask'
+0001a6b0: 6060 206f 7468 6572 7769 7365 2e0a 2020  `` otherwise..  
+0001a6c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001a6d0: 2020 6178 6973 203d 2073 656c 662e 5f76    axis = self._v
+0001a6e0: 616c 6964 6174 655f 6178 6973 2861 7869  alidate_axis(axi
+0001a6f0: 7329 0a20 2020 2020 2020 206b 6579 6e61  s).        keyna
+0001a700: 6d65 203d 2022 7175 616e 7469 6c65 732d  me = "quantiles-
+0001a710: 636f 6e63 6174 2d2d 2220 2b20 746f 6b65  concat--" + toke
+0001a720: 6e69 7a65 2873 656c 662c 2071 2c20 6178  nize(self, q, ax
+0001a730: 6973 290a 2020 2020 2020 2020 6e75 6d65  is).        nume
+0001a740: 7269 635f 6b77 6172 6773 203d 2067 6574  ric_kwargs = get
+0001a750: 5f6e 756d 6572 6963 5f6f 6e6c 795f 6b77  _numeric_only_kw
+0001a760: 6172 6773 286e 756d 6572 6963 5f6f 6e6c  args(numeric_onl
+0001a770: 7929 0a0a 2020 2020 2020 2020 7769 7468  y)..        with
+0001a780: 2063 6865 636b 5f6e 756d 6572 6963 5f6f   check_numeric_o
+0001a790: 6e6c 795f 6465 7072 6563 6174 696f 6e28  nly_deprecation(
+0001a7a0: 2271 7561 6e74 696c 6522 2c20 5472 7565  "quantile", True
+0001a7b0: 293a 0a20 2020 2020 2020 2020 2020 206d  ):.            m
+0001a7c0: 6574 6120 3d20 7365 6c66 2e5f 6d65 7461  eta = self._meta
+0001a7d0: 2e71 7561 6e74 696c 6528 712c 2061 7869  .quantile(q, axi
+0001a7e0: 733d 6178 6973 2c20 2a2a 6e75 6d65 7269  s=axis, **numeri
+0001a7f0: 635f 6b77 6172 6773 290a 0a20 2020 2020  c_kwargs)..     
+0001a800: 2020 2069 6620 6178 6973 203d 3d20 313a     if axis == 1:
+0001a810: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001a820: 6973 696e 7374 616e 6365 2871 2c20 6c69  isinstance(q, li
+0001a830: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+0001a840: 2020 2020 2023 204e 6f74 2073 7570 706f       # Not suppo
+0001a850: 7274 6564 2c20 7468 6520 7265 7375 6c74  rted, the result
+0001a860: 2077 696c 6c20 6861 7665 2063 7572 7265   will have curre
+0001a870: 6e74 2069 6e64 6578 2061 7320 636f 6c75  nt index as colu
+0001a880: 6d6e 730a 2020 2020 2020 2020 2020 2020  mns.            
+0001a890: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001a8a0: 7272 6f72 2822 2771 2720 6d75 7374 2062  rror("'q' must b
+0001a8b0: 6520 7363 616c 6172 2077 6865 6e20 6178  e scalar when ax
+0001a8c0: 6973 3d31 2069 7320 7370 6563 6966 6965  is=1 is specifie
+0001a8d0: 6422 290a 0a20 2020 2020 2020 2020 2020  d")..           
+0001a8e0: 2072 6574 7572 6e20 6d61 705f 7061 7274   return map_part
+0001a8f0: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
+0001a900: 2020 2020 2020 2020 5f67 6574 6174 7472          _getattr
+0001a910: 5f6e 756d 6572 6963 5f6f 6e6c 792c 0a20  _numeric_only,. 
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a930: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0001a940: 2020 2020 2071 2c0a 2020 2020 2020 2020       q,.        
+0001a950: 2020 2020 2020 2020 6178 6973 2c0a 2020          axis,.  
+0001a960: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0001a970: 6b65 6e3d 6b65 796e 616d 652c 0a20 2020  ken=keyname,.   
+0001a980: 2020 2020 2020 2020 2020 2020 2065 6e66               enf
+0001a990: 6f72 6365 5f6d 6574 6164 6174 613d 4661  orce_metadata=Fa
+0001a9a0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0001a9b0: 2020 2020 202a 2a6e 756d 6572 6963 5f6b       **numeric_k
+0001a9c0: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+0001a9d0: 2020 2020 2020 206d 6574 613d 2871 2c20         meta=(q, 
+0001a9e0: 2266 3822 292c 0a20 2020 2020 2020 2020  "f8"),.         
+0001a9f0: 2020 2020 2020 2070 6172 656e 745f 6d65         parent_me
+0001aa00: 7461 3d73 656c 662e 5f6d 6574 612c 0a20  ta=self._meta,. 
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0001aa20: 6461 736b 5f6d 6574 686f 645f 6e61 6d65  dask_method_name
+0001aa30: 3d22 7175 616e 7469 6c65 222c 0a20 2020  ="quantile",.   
+0001aa40: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001aa50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001aa60: 2020 2020 205f 7261 6973 655f 6966 5f6f       _raise_if_o
+0001aa70: 626a 6563 745f 7365 7269 6573 2873 656c  bject_series(sel
+0001aa80: 662c 2022 7175 616e 7469 6c65 2229 0a20  f, "quantile"). 
+0001aa90: 2020 2020 2020 2020 2020 206e 756d 203d             num =
+0001aaa0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001aab0: 2020 2073 656c 662e 5f67 6574 5f6e 756d     self._get_num
+0001aac0: 6572 6963 5f64 6174 6128 290a 2020 2020  eric_data().    
+0001aad0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001aae0: 756d 6572 6963 5f6f 6e6c 7920 6973 2054  umeric_only is T
+0001aaf0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001ab00: 2020 2020 6f72 2028 6e6f 7420 5041 4e44      or (not PAND
+0001ab10: 4153 5f47 545f 3230 3020 616e 6420 6e75  AS_GT_200 and nu
+0001ab20: 6d65 7269 635f 6f6e 6c79 2069 7320 6e6f  meric_only is no
+0001ab30: 5f64 6566 6175 6c74 290a 2020 2020 2020  _default).      
+0001ab40: 2020 2020 2020 2020 2020 656c 7365 2073            else s
+0001ab50: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
+0001ab60: 290a 2020 2020 2020 2020 2020 2020 7175  ).            qu
+0001ab70: 616e 7469 6c65 7320 3d20 7475 706c 6528  antiles = tuple(
+0001ab80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ab90: 2071 7561 6e74 696c 6528 6e75 6d2e 696c   quantile(num.il
+0001aba0: 6f63 5b3a 2c20 695d 2c20 712c 206d 6574  oc[:, i], q, met
+0001abb0: 686f 6429 2066 6f72 2069 2069 6e20 7261  hod) for i in ra
+0001abc0: 6e67 6528 6c65 6e28 6e75 6d2e 636f 6c75  nge(len(num.colu
+0001abd0: 6d6e 7329 290a 2020 2020 2020 2020 2020  mns)).          
+0001abe0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0001abf0: 2071 6e61 6d65 7320 3d20 5b28 5f71 2e5f   qnames = [(_q._
+0001ac00: 6e61 6d65 2c20 3029 2066 6f72 205f 7120  name, 0) for _q 
+0001ac10: 696e 2071 7561 6e74 696c 6573 5d0a 0a20  in quantiles].. 
+0001ac20: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001ac30: 696e 7374 616e 6365 2871 7561 6e74 696c  instance(quantil
+0001ac40: 6573 5b30 5d2c 2053 6361 6c61 7229 3a0a  es[0], Scalar):.
+0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac60: 6c61 7965 7220 3d20 7b0a 2020 2020 2020  layer = {.      
+0001ac70: 2020 2020 2020 2020 2020 2020 2020 286b                (k
+0001ac80: 6579 6e61 6d65 2c20 3029 3a20 2874 7970  eyname, 0): (typ
+0001ac90: 6528 6d65 7461 292c 2071 6e61 6d65 732c  e(meta), qnames,
+0001aca0: 206e 756d 2e63 6f6c 756d 6e73 2c20 4e6f   num.columns, No
+0001acb0: 6e65 2c20 6d65 7461 2e6e 616d 6529 0a20  ne, meta.name). 
+0001acc0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+0001acd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ace0: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+0001acf0: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+0001ad00: 6c65 6374 696f 6e73 280a 2020 2020 2020  lections(.      
+0001ad10: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001ad20: 796e 616d 652c 206c 6179 6572 2c20 6465  yname, layer, de
+0001ad30: 7065 6e64 656e 6369 6573 3d71 7561 6e74  pendencies=quant
+0001ad40: 696c 6573 0a20 2020 2020 2020 2020 2020  iles.           
+0001ad50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001ad60: 2020 2020 2020 2064 6976 6973 696f 6e73         divisions
+0001ad70: 203d 2028 6d69 6e28 6e75 6d2e 636f 6c75   = (min(num.colu
+0001ad80: 6d6e 7329 2c20 6d61 7828 6e75 6d2e 636f  mns), max(num.co
+0001ad90: 6c75 6d6e 7329 290a 2020 2020 2020 2020  lumns)).        
+0001ada0: 2020 2020 2020 2020 7265 7475 726e 2053          return S
+0001adb0: 6572 6965 7328 6772 6170 682c 206b 6579  eries(graph, key
+0001adc0: 6e61 6d65 2c20 6d65 7461 2c20 6469 7669  name, meta, divi
+0001add0: 7369 6f6e 7329 0a20 2020 2020 2020 2020  sions).         
+0001ade0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001adf0: 2020 2020 2020 2020 206c 6179 6572 203d           layer =
+0001ae00: 207b 286b 6579 6e61 6d65 2c20 3029 3a20   {(keyname, 0): 
+0001ae10: 286d 6574 686f 6473 2e63 6f6e 6361 742c  (methods.concat,
+0001ae20: 2071 6e61 6d65 732c 2031 297d 0a20 2020   qnames, 1)}.   
+0001ae30: 2020 2020 2020 2020 2020 2020 2067 7261               gra
+0001ae40: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
+0001ae50: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
+0001ae60: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
+0001ae70: 2020 2020 2020 2020 2020 6b65 796e 616d            keynam
+0001ae80: 652c 206c 6179 6572 2c20 6465 7065 6e64  e, layer, depend
+0001ae90: 656e 6369 6573 3d71 7561 6e74 696c 6573  encies=quantiles
+0001aea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aeb0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0001aec0: 2020 2072 6574 7572 6e20 6e65 775f 6464     return new_dd
+0001aed0: 5f6f 626a 6563 7428 6772 6170 682c 206b  _object(graph, k
+0001aee0: 6579 6e61 6d65 2c20 6d65 7461 2c20 7175  eyname, meta, qu
+0001aef0: 616e 7469 6c65 735b 305d 2e64 6976 6973  antiles[0].divis
+0001af00: 696f 6e73 290a 0a20 2020 2040 6465 7269  ions)..    @deri
+0001af10: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
+0001af20: 4672 616d 6529 0a20 2020 2064 6566 2064  Frame).    def d
+0001af30: 6573 6372 6962 6528 0a20 2020 2020 2020  escribe(.       
+0001af40: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+0001af50: 706c 6974 5f65 7665 7279 3d46 616c 7365  plit_every=False
+0001af60: 2c0a 2020 2020 2020 2020 7065 7263 656e  ,.        percen
+0001af70: 7469 6c65 733d 4e6f 6e65 2c0a 2020 2020  tiles=None,.    
+0001af80: 2020 2020 7065 7263 656e 7469 6c65 735f      percentiles_
+0001af90: 6d65 7468 6f64 3d22 6465 6661 756c 7422  method="default"
+0001afa0: 2c0a 2020 2020 2020 2020 696e 636c 7564  ,.        includ
+0001afb0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001afc0: 6578 636c 7564 653d 4e6f 6e65 2c0a 2020  exclude=None,.  
+0001afd0: 2020 2020 2020 6461 7465 7469 6d65 5f69        datetime_i
+0001afe0: 735f 6e75 6d65 7269 633d 6e6f 5f64 6566  s_numeric=no_def
+0001aff0: 6175 6c74 2c0a 2020 2020 293a 0a20 2020  ault,.    ):.   
+0001b000: 2020 2020 2069 6620 5041 4e44 4153 5f47       if PANDAS_G
+0001b010: 545f 3230 303a 0a20 2020 2020 2020 2020  T_200:.         
+0001b020: 2020 2069 6620 6461 7465 7469 6d65 5f69     if datetime_i
+0001b030: 735f 6e75 6d65 7269 6320 6973 206e 6f5f  s_numeric is no_
+0001b040: 6465 6661 756c 743a 0a20 2020 2020 2020  default:.       
+0001b050: 2020 2020 2020 2020 2064 6174 6574 696d           datetim
+0001b060: 655f 6973 5f6e 756d 6572 6963 203d 2054  e_is_numeric = T
+0001b070: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001b080: 2020 2020 6461 7465 7469 6d65 5f69 735f      datetime_is_
+0001b090: 6e75 6d65 7269 635f 6b77 6172 6720 3d20  numeric_kwarg = 
+0001b0a0: 7b7d 0a20 2020 2020 2020 2020 2020 2065  {}.            e
+0001b0b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001b0c0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+0001b0d0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0001b0e0: 2020 2020 2020 2020 2020 2264 6174 6574            "datet
+0001b0f0: 696d 655f 6973 5f6e 756d 6572 6963 2069  ime_is_numeric i
+0001b100: 7320 7265 6d6f 7665 6420 696e 2070 616e  s removed in pan
+0001b110: 6461 733e 3d32 2e30 2e30 2c20 6461 7465  das>=2.0.0, date
+0001b120: 7469 6d65 2064 6174 6120 7769 6c6c 2061  time data will a
+0001b130: 6c77 6179 7320 6265 2022 0a20 2020 2020  lways be ".     
+0001b140: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001b150: 7375 6d6d 6172 697a 6564 2061 7320 6e75  summarized as nu
+0001b160: 6d65 7269 6322 0a20 2020 2020 2020 2020  meric".         
+0001b170: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001b180: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001b190: 2020 2064 6174 6574 696d 655f 6973 5f6e     datetime_is_n
+0001b1a0: 756d 6572 6963 203d 2028 0a20 2020 2020  umeric = (.     
+0001b1b0: 2020 2020 2020 2020 2020 2046 616c 7365             False
+0001b1c0: 2069 6620 6461 7465 7469 6d65 5f69 735f   if datetime_is_
+0001b1d0: 6e75 6d65 7269 6320 6973 206e 6f5f 6465  numeric is no_de
+0001b1e0: 6661 756c 7420 656c 7365 2064 6174 6574  fault else datet
+0001b1f0: 696d 655f 6973 5f6e 756d 6572 6963 0a20  ime_is_numeric. 
+0001b200: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001b210: 2020 2020 2020 2020 2064 6174 6574 696d           datetim
+0001b220: 655f 6973 5f6e 756d 6572 6963 5f6b 7761  e_is_numeric_kwa
+0001b230: 7267 203d 207b 2264 6174 6574 696d 655f  rg = {"datetime_
+0001b240: 6973 5f6e 756d 6572 6963 223a 2064 6174  is_numeric": dat
+0001b250: 6574 696d 655f 6973 5f6e 756d 6572 6963  etime_is_numeric
+0001b260: 7d0a 0a20 2020 2020 2020 2069 6620 7365  }..        if se
+0001b270: 6c66 2e5f 6d65 7461 2e6e 6469 6d20 3d3d  lf._meta.ndim ==
+0001b280: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0001b290: 6d65 7461 203d 2073 656c 662e 5f6d 6574  meta = self._met
+0001b2a0: 615f 6e6f 6e65 6d70 7479 2e64 6573 6372  a_nonempty.descr
+0001b2b0: 6962 6528 0a20 2020 2020 2020 2020 2020  ibe(.           
+0001b2c0: 2020 2020 2070 6572 6365 6e74 696c 6573       percentiles
+0001b2d0: 3d70 6572 6365 6e74 696c 6573 2c0a 2020  =percentiles,.  
+0001b2e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001b2f0: 636c 7564 653d 696e 636c 7564 652c 0a20  clude=include,. 
+0001b300: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001b310: 7863 6c75 6465 3d65 7863 6c75 6465 2c0a  xclude=exclude,.
+0001b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b330: 2a2a 6461 7465 7469 6d65 5f69 735f 6e75  **datetime_is_nu
+0001b340: 6d65 7269 635f 6b77 6172 672c 0a20 2020  meric_kwarg,.   
+0001b350: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001b360: 2020 2020 2020 206f 7574 7075 7420 3d20         output = 
+0001b370: 7365 6c66 2e5f 6465 7363 7269 6265 5f31  self._describe_1
+0001b380: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+0001b390: 2020 2073 656c 662c 2073 706c 6974 5f65     self, split_e
+0001b3a0: 7665 7279 2c20 7065 7263 656e 7469 6c65  very, percentile
+0001b3b0: 732c 2070 6572 6365 6e74 696c 6573 5f6d  s, percentiles_m
+0001b3c0: 6574 686f 642c 2064 6174 6574 696d 655f  ethod, datetime_
+0001b3d0: 6973 5f6e 756d 6572 6963 0a20 2020 2020  is_numeric.     
+0001b3e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001b3f0: 2020 2020 206f 7574 7075 742e 5f6d 6574       output._met
+0001b400: 6120 3d20 6d65 7461 0a20 2020 2020 2020  a = meta.       
+0001b410: 2020 2020 2072 6574 7572 6e20 6f75 7470       return outp
+0001b420: 7574 0a20 2020 2020 2020 2065 6c69 6620  ut.        elif 
+0001b430: 2869 6e63 6c75 6465 2069 7320 4e6f 6e65  (include is None
+0001b440: 2920 616e 6420 2865 7863 6c75 6465 2069  ) and (exclude i
+0001b450: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
+0001b460: 2020 2020 205f 696e 636c 7564 6520 3d20       _include = 
+0001b470: 5b6e 702e 6e75 6d62 6572 2c20 6e70 2e74  [np.number, np.t
+0001b480: 696d 6564 656c 7461 3634 5d0a 2020 2020  imedelta64].    
+0001b490: 2020 2020 2020 2020 6966 2064 6174 6574          if datet
+0001b4a0: 696d 655f 6973 5f6e 756d 6572 6963 3a0a  ime_is_numeric:.
+0001b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4c0: 5f69 6e63 6c75 6465 2e61 7070 656e 6428  _include.append(
+0001b4d0: 6e70 2e64 6174 6574 696d 6536 3429 0a20  np.datetime64). 
+0001b4e0: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+0001b4f0: 3d20 7365 6c66 2e5f 6d65 7461 2e73 656c  = self._meta.sel
+0001b500: 6563 745f 6474 7970 6573 2869 6e63 6c75  ect_dtypes(inclu
+0001b510: 6465 3d5f 696e 636c 7564 6529 0a0a 2020  de=_include)..  
+0001b520: 2020 2020 2020 2020 2020 2320 7768 656e            # when
+0001b530: 2073 6f6d 6520 6e75 6d65 7269 6373 2f74   some numerics/t
+0001b540: 696d 6564 656c 7461 7320 6172 6520 666f  imedeltas are fo
+0001b550: 756e 642c 2062 7920 6465 6661 756c 7420  und, by default 
+0001b560: 6b65 6570 2074 6865 6d0a 2020 2020 2020  keep them.      
+0001b570: 2020 2020 2020 6966 206c 656e 2864 6174        if len(dat
+0001b580: 612e 636f 6c75 6d6e 7329 203d 3d20 303a  a.columns) == 0:
+0001b590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b5a0: 2063 686f 7365 6e5f 636f 6c75 6d6e 735f   chosen_columns_
+0001b5b0: 696e 6465 7865 7320 3d20 6c69 7374 2872  indexes = list(r
+0001b5c0: 616e 6765 286c 656e 2873 656c 662e 5f6d  ange(len(self._m
+0001b5d0: 6574 612e 636f 6c75 6d6e 7329 2929 0a20  eta.columns))). 
+0001b5e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b600: 2023 2063 6865 636b 2069 6620 7468 6572   # check if ther
+0001b610: 6520 6172 6520 7469 6d65 6465 6c74 612c  e are timedelta,
+0001b620: 2062 6f6f 6c65 616e 2c20 6f72 2064 6174   boolean, or dat
+0001b630: 6574 696d 6520 636f 6c75 6d6e 730a 2020  etime columns.  
+0001b640: 2020 2020 2020 2020 2020 2020 2020 5f69                _i
+0001b650: 6e63 6c75 6465 203d 205b 6e70 2e74 696d  nclude = [np.tim
+0001b660: 6564 656c 7461 3634 2c20 626f 6f6c 5d0a  edelta64, bool].
+0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b680: 6966 2064 6174 6574 696d 655f 6973 5f6e  if datetime_is_n
+0001b690: 756d 6572 6963 3a0a 2020 2020 2020 2020  umeric:.        
+0001b6a0: 2020 2020 2020 2020 2020 2020 5f69 6e63              _inc
+0001b6b0: 6c75 6465 2e61 7070 656e 6428 6e70 2e64  lude.append(np.d
+0001b6c0: 6174 6574 696d 6536 3429 0a20 2020 2020  atetime64).     
+0001b6d0: 2020 2020 2020 2020 2020 2062 6f6f 6c73             bools
+0001b6e0: 5f61 6e64 5f74 696d 6573 203d 2073 656c  _and_times = sel
+0001b6f0: 662e 5f6d 6574 612e 7365 6c65 6374 5f64  f._meta.select_d
+0001b700: 7479 7065 7328 696e 636c 7564 653d 5f69  types(include=_i
+0001b710: 6e63 6c75 6465 290a 2020 2020 2020 2020  nclude).        
+0001b720: 2020 2020 2020 2020 6966 206c 656e 2862          if len(b
+0001b730: 6f6f 6c73 5f61 6e64 5f74 696d 6573 2e63  ools_and_times.c
+0001b740: 6f6c 756d 6e73 2920 3d3d 2030 3a0a 2020  olumns) == 0:.  
+0001b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b760: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
+0001b770: 6573 6372 6962 655f 6e75 6d65 7269 6328  escribe_numeric(
+0001b780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b790: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+0001b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7b0: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
+0001b7c0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
+0001b7d0: 2020 2020 2020 2020 2020 2020 7065 7263              perc
+0001b7e0: 656e 7469 6c65 732c 0a20 2020 2020 2020  entiles,.       
+0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b800: 2070 6572 6365 6e74 696c 6573 5f6d 6574   percentiles_met
+0001b810: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+0001b820: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001b830: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001b840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b850: 2020 2020 2063 686f 7365 6e5f 636f 6c75       chosen_colu
+0001b860: 6d6e 735f 696e 6465 7865 7320 3d20 7365  mns_indexes = se
+0001b870: 6c66 2e5f 6765 745f 636f 6c75 6d6e 735f  lf._get_columns_
+0001b880: 696e 6465 7865 735f 6261 7365 645f 6f6e  indexes_based_on
+0001b890: 5f64 7479 7065 7328 0a20 2020 2020 2020  _dtypes(.       
+0001b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8b0: 2064 6174 610a 2020 2020 2020 2020 2020   data.          
+0001b8c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001b8d0: 2020 2020 656c 6966 2069 6e63 6c75 6465      elif include
+0001b8e0: 203d 3d20 2261 6c6c 223a 0a20 2020 2020   == "all":.     
+0001b8f0: 2020 2020 2020 2069 6620 6578 636c 7564         if exclud
+0001b900: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0001b910: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001b920: 7367 203d 2022 6578 636c 7564 6520 6d75  sg = "exclude mu
+0001b930: 7374 2062 6520 4e6f 6e65 2077 6865 6e20  st be None when 
+0001b940: 696e 636c 7564 6520 6973 2027 616c 6c27  include is 'all'
+0001b950: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001b960: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001b970: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
+0001b980: 2020 2020 6368 6f73 656e 5f63 6f6c 756d      chosen_colum
+0001b990: 6e73 5f69 6e64 6578 6573 203d 206c 6973  ns_indexes = lis
+0001b9a0: 7428 7261 6e67 6528 6c65 6e28 7365 6c66  t(range(len(self
+0001b9b0: 2e5f 6d65 7461 2e63 6f6c 756d 6e73 2929  ._meta.columns))
+0001b9c0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0001b9d0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0001b9e0: 203d 2073 656c 662e 5f6d 6574 612e 7365   = self._meta.se
+0001b9f0: 6c65 6374 5f64 7479 7065 7328 696e 636c  lect_dtypes(incl
+0001ba00: 7564 653d 696e 636c 7564 652c 2065 7863  ude=include, exc
+0001ba10: 6c75 6465 3d65 7863 6c75 6465 290a 2020  lude=exclude).  
+0001ba20: 2020 2020 2020 2020 2020 6368 6f73 656e            chosen
+0001ba30: 5f63 6f6c 756d 6e73 5f69 6e64 6578 6573  _columns_indexes
+0001ba40: 203d 2073 656c 662e 5f67 6574 5f63 6f6c   = self._get_col
+0001ba50: 756d 6e73 5f69 6e64 6578 6573 5f62 6173  umns_indexes_bas
+0001ba60: 6564 5f6f 6e5f 6474 7970 6573 2864 6174  ed_on_dtypes(dat
+0001ba70: 6129 0a0a 2020 2020 2020 2020 7374 6174  a)..        stat
+0001ba80: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0001ba90: 2020 7365 6c66 2e5f 6465 7363 7269 6265    self._describe
+0001baa0: 5f31 6428 0a20 2020 2020 2020 2020 2020  _1d(.           
+0001bab0: 2020 2020 2073 656c 662e 696c 6f63 5b3a       self.iloc[:
+0001bac0: 2c20 636f 6c5f 6964 785d 2c0a 2020 2020  , col_idx],.    
+0001bad0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+0001bae0: 745f 6576 6572 792c 0a20 2020 2020 2020  t_every,.       
+0001baf0: 2020 2020 2020 2020 2070 6572 6365 6e74           percent
+0001bb00: 696c 6573 2c0a 2020 2020 2020 2020 2020  iles,.          
+0001bb10: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
+0001bb20: 735f 6d65 7468 6f64 2c0a 2020 2020 2020  s_method,.      
+0001bb30: 2020 2020 2020 2020 2020 6461 7465 7469            dateti
+0001bb40: 6d65 5f69 735f 6e75 6d65 7269 632c 0a20  me_is_numeric,. 
+0001bb50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001bb60: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
+0001bb70: 5f69 6478 2069 6e20 6368 6f73 656e 5f63  _idx in chosen_c
+0001bb80: 6f6c 756d 6e73 5f69 6e64 6578 6573 0a20  olumns_indexes. 
+0001bb90: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0001bba0: 2073 7461 7473 5f6e 616d 6573 203d 205b   stats_names = [
+0001bbb0: 2873 2e5f 6e61 6d65 2c20 3029 2066 6f72  (s._name, 0) for
+0001bbc0: 2073 2069 6e20 7374 6174 735d 0a0a 2020   s in stats]..  
+0001bbd0: 2020 2020 2020 6e61 6d65 203d 2022 6465        name = "de
+0001bbe0: 7363 7269 6265 2d2d 2220 2b20 746f 6b65  scribe--" + toke
+0001bbf0: 6e69 7a65 2873 656c 662c 2073 706c 6974  nize(self, split
+0001bc00: 5f65 7665 7279 290a 2020 2020 2020 2020  _every).        
+0001bc10: 6c61 7965 7220 3d20 7b28 6e61 6d65 2c20  layer = {(name, 
+0001bc20: 3029 3a20 286d 6574 686f 6473 2e64 6573  0): (methods.des
+0001bc30: 6372 6962 655f 6167 6772 6567 6174 652c  cribe_aggregate,
+0001bc40: 2073 7461 7473 5f6e 616d 6573 297d 0a20   stats_names)}. 
+0001bc50: 2020 2020 2020 2067 7261 7068 203d 2048         graph = H
+0001bc60: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
+0001bc70: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 286e  om_collections(n
+0001bc80: 616d 652c 206c 6179 6572 2c20 6465 7065  ame, layer, depe
+0001bc90: 6e64 656e 6369 6573 3d73 7461 7473 290a  ndencies=stats).
+0001bca0: 2020 2020 2020 2020 6d65 7461 203d 2073          meta = s
+0001bcb0: 656c 662e 5f6d 6574 615f 6e6f 6e65 6d70  elf._meta_nonemp
+0001bcc0: 7479 2e64 6573 6372 6962 6528 0a20 2020  ty.describe(.   
+0001bcd0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
+0001bce0: 3d69 6e63 6c75 6465 2c20 6578 636c 7564  =include, exclud
+0001bcf0: 653d 6578 636c 7564 652c 202a 2a64 6174  e=exclude, **dat
+0001bd00: 6574 696d 655f 6973 5f6e 756d 6572 6963  etime_is_numeric
+0001bd10: 5f6b 7761 7267 0a20 2020 2020 2020 2029  _kwarg.        )
+0001bd20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001bd30: 6e65 775f 6464 5f6f 626a 6563 7428 6772  new_dd_object(gr
+0001bd40: 6170 682c 206e 616d 652c 206d 6574 612c  aph, name, meta,
+0001bd50: 2064 6976 6973 696f 6e73 3d5b 4e6f 6e65   divisions=[None
+0001bd60: 2c20 4e6f 6e65 5d29 0a0a 2020 2020 6465  , None])..    de
+0001bd70: 6620 5f67 6574 5f63 6f6c 756d 6e73 5f69  f _get_columns_i
+0001bd80: 6e64 6578 6573 5f62 6173 6564 5f6f 6e5f  ndexes_based_on_
+0001bd90: 6474 7970 6573 2873 656c 662c 2073 7562  dtypes(self, sub
+0001bda0: 7365 7429 3a0a 2020 2020 2020 2020 6d65  set):.        me
+0001bdb0: 7461 203d 2073 656c 662e 5f6d 6574 612e  ta = self._meta.
+0001bdc0: 6474 7970 6573 2e72 6573 6574 5f69 6e64  dtypes.reset_ind
+0001bdd0: 6578 2829 0a20 2020 2020 2020 206d 6574  ex().        met
+0001bde0: 612e 696e 6465 782e 6e61 6d65 203d 2022  a.index.name = "
+0001bdf0: 696e 6465 7865 7222 0a20 2020 2020 2020  indexer".       
+0001be00: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
+0001be10: 2020 2020 2020 6d65 7461 2e72 6573 6574        meta.reset
+0001be20: 5f69 6e64 6578 2829 0a20 2020 2020 2020  _index().       
+0001be30: 2020 2020 202e 6d65 7267 6528 7375 6273       .merge(subs
+0001be40: 6574 2e64 7479 7065 732e 7265 7365 745f  et.dtypes.reset_
+0001be50: 696e 6465 7828 292c 2068 6f77 3d22 696e  index(), how="in
+0001be60: 6e65 7222 295b 2269 6e64 6578 6572 225d  ner")["indexer"]
+0001be70: 0a20 2020 2020 2020 2020 2020 202e 7661  .            .va
+0001be80: 6c75 6573 0a20 2020 2020 2020 2029 0a0a  lues.        )..
+0001be90: 2020 2020 6465 6620 5f64 6573 6372 6962      def _describ
+0001bea0: 655f 3164 280a 2020 2020 2020 2020 7365  e_1d(.        se
+0001beb0: 6c66 2c0a 2020 2020 2020 2020 6461 7461  lf,.        data
+0001bec0: 2c0a 2020 2020 2020 2020 7370 6c69 745f  ,.        split_
+0001bed0: 6576 6572 793d 4661 6c73 652c 0a20 2020  every=False,.   
+0001bee0: 2020 2020 2070 6572 6365 6e74 696c 6573       percentiles
+0001bef0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2070  =None,.        p
+0001bf00: 6572 6365 6e74 696c 6573 5f6d 6574 686f  ercentiles_metho
+0001bf10: 643d 2264 6566 6175 6c74 222c 0a20 2020  d="default",.   
+0001bf20: 2020 2020 2064 6174 6574 696d 655f 6973       datetime_is
+0001bf30: 5f6e 756d 6572 6963 3d46 616c 7365 2c0a  _numeric=False,.
+0001bf40: 2020 2020 293a 0a20 2020 2020 2020 2069      ):.        i
+0001bf50: 6620 6973 5f62 6f6f 6c5f 6474 7970 6528  f is_bool_dtype(
+0001bf60: 6461 7461 2e5f 6d65 7461 293a 0a20 2020  data._meta):.   
+0001bf70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bf80: 7365 6c66 2e5f 6465 7363 7269 6265 5f6e  self._describe_n
+0001bf90: 6f6e 6e75 6d65 7269 635f 3164 280a 2020  onnumeric_1d(.  
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001bfb0: 7461 2c20 7370 6c69 745f 6576 6572 793d  ta, split_every=
+0001bfc0: 7370 6c69 745f 6576 6572 792c 2064 6174  split_every, dat
+0001bfd0: 6574 696d 655f 6973 5f6e 756d 6572 6963  etime_is_numeric
+0001bfe0: 3d64 6174 6574 696d 655f 6973 5f6e 756d  =datetime_is_num
+0001bff0: 6572 6963 0a20 2020 2020 2020 2020 2020  eric.           
+0001c000: 2029 0a20 2020 2020 2020 2065 6c69 6620   ).        elif 
+0001c010: 6973 5f6e 756d 6572 6963 5f64 7479 7065  is_numeric_dtype
+0001c020: 2864 6174 612e 5f6d 6574 6129 3a0a 2020  (data._meta):.  
+0001c030: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001c040: 2073 656c 662e 5f64 6573 6372 6962 655f   self._describe_
+0001c050: 6e75 6d65 7269 6328 0a20 2020 2020 2020  numeric(.       
+0001c060: 2020 2020 2020 2020 2064 6174 612c 0a20           data,. 
+0001c070: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c080: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+0001c090: 5f65 7665 7279 2c0a 2020 2020 2020 2020  _every,.        
+0001c0a0: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
+0001c0b0: 6c65 733d 7065 7263 656e 7469 6c65 732c  les=percentiles,
+0001c0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c0d0: 2070 6572 6365 6e74 696c 6573 5f6d 6574   percentiles_met
+0001c0e0: 686f 643d 7065 7263 656e 7469 6c65 735f  hod=percentiles_
+0001c0f0: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+0001c100: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+0001c110: 6966 2069 735f 7469 6d65 6465 6c74 6136  if is_timedelta6
+0001c120: 345f 6474 7970 6528 6461 7461 2e5f 6d65  4_dtype(data._me
+0001c130: 7461 293a 0a20 2020 2020 2020 2020 2020  ta):.           
+0001c140: 2072 6574 7572 6e20 7365 6c66 2e5f 6465   return self._de
+0001c150: 7363 7269 6265 5f6e 756d 6572 6963 280a  scribe_numeric(.
+0001c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c170: 6461 7461 2e64 726f 706e 6128 292c 0a20  data.dropna(),. 
+0001c180: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c190: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+0001c1a0: 5f65 7665 7279 2c0a 2020 2020 2020 2020  _every,.        
+0001c1b0: 2020 2020 2020 2020 7065 7263 656e 7469          percenti
+0001c1c0: 6c65 733d 7065 7263 656e 7469 6c65 732c  les=percentiles,
+0001c1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c1e0: 2070 6572 6365 6e74 696c 6573 5f6d 6574   percentiles_met
+0001c1f0: 686f 643d 7065 7263 656e 7469 6c65 735f  hod=percentiles_
+0001c200: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
 0001c210: 2020 2020 2020 2020 6973 5f74 696d 6564          is_timed
-0001c220: 656c 7461 5f63 6f6c 756d 6e3d 4661 6c73  elta_column=Fals
-0001c230: 652c 0a20 2020 2020 2020 2069 735f 6461  e,.        is_da
-0001c240: 7465 7469 6d65 5f63 6f6c 756d 6e3d 4661  tetime_column=Fa
-0001c250: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-0001c260: 2020 2020 6672 6f6d 2064 6173 6b2e 6461      from dask.da
-0001c270: 7461 6672 616d 652e 6e75 6d65 7269 6320  taframe.numeric 
-0001c280: 696d 706f 7274 2074 6f5f 6e75 6d65 7269  import to_numeri
-0001c290: 630a 0a20 2020 2020 2020 2069 6620 6973  c..        if is
-0001c2a0: 5f74 696d 6564 656c 7461 5f63 6f6c 756d  _timedelta_colum
-0001c2b0: 6e20 6f72 2069 735f 6461 7465 7469 6d65  n or is_datetime
-0001c2c0: 5f63 6f6c 756d 6e3a 0a20 2020 2020 2020  _column:.       
-0001c2d0: 2020 2020 206e 756d 203d 2074 6f5f 6e75       num = to_nu
-0001c2e0: 6d65 7269 6328 6461 7461 290a 2020 2020  meric(data).    
-0001c2f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001c300: 2020 2020 2020 6e75 6d20 3d20 6461 7461        num = data
-0001c310: 2e5f 6765 745f 6e75 6d65 7269 635f 6461  ._get_numeric_da
-0001c320: 7461 2829 0a0a 2020 2020 2020 2020 6966  ta()..        if
-0001c330: 2064 6174 612e 6e64 696d 203d 3d20 3220   data.ndim == 2 
-0001c340: 616e 6420 6c65 6e28 6e75 6d2e 636f 6c75  and len(num.colu
-0001c350: 6d6e 7329 203d 3d20 303a 0a20 2020 2020  mns) == 0:.     
-0001c360: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0001c370: 7565 4572 726f 7228 2244 6174 6146 7261  ueError("DataFra
-0001c380: 6d65 2063 6f6e 7461 696e 7320 6f6e 6c79  me contains only
-0001c390: 206e 6f6e 2d6e 756d 6572 6963 2064 6174   non-numeric dat
-0001c3a0: 612e 2229 0a20 2020 2020 2020 2065 6c69  a.").        eli
-0001c3b0: 6620 6461 7461 2e6e 6469 6d20 3d3d 2031  f data.ndim == 1
-0001c3c0: 2061 6e64 2064 6174 612e 6474 7970 6520   and data.dtype 
-0001c3d0: 3d3d 2022 6f62 6a65 6374 223a 0a20 2020  == "object":.   
-0001c3e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0001c3f0: 616c 7565 4572 726f 7228 2243 616e 6e6f  alueError("Canno
-0001c400: 7420 636f 6d70 7574 6520 6060 6465 7363  t compute ``desc
-0001c410: 7269 6265 6060 206f 6e20 6f62 6a65 6374  ribe`` on object
-0001c420: 2064 7479 7065 2e22 290a 2020 2020 2020   dtype.").      
-0001c430: 2020 6966 2070 6572 6365 6e74 696c 6573    if percentiles
-0001c440: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001c450: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-0001c460: 7320 3d20 5b30 2e32 352c 2030 2e35 2c20  s = [0.25, 0.5, 
-0001c470: 302e 3735 5d0a 2020 2020 2020 2020 656c  0.75].        el
-0001c480: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001c490: 2320 616c 7761 7973 2069 6e63 6c75 6465  # always include
-0001c4a0: 2074 6865 2074 6865 2035 3025 746c 6520   the the 50%tle 
-0001c4b0: 746f 2063 616c 6375 6c61 7465 2074 6865  to calculate the
-0001c4c0: 206d 6564 6961 6e0a 2020 2020 2020 2020   median.        
-0001c4d0: 2020 2020 2320 756e 6971 7565 2072 656d      # unique rem
-0001c4e0: 6f76 6573 2064 7570 6c69 6361 7465 7320  oves duplicates 
-0001c4f0: 616e 6420 736f 7274 7320 7175 616e 7469  and sorts quanti
-0001c500: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
-0001c510: 7065 7263 656e 7469 6c65 7320 3d20 6e70  percentiles = np
-0001c520: 2e61 7272 6179 2870 6572 6365 6e74 696c  .array(percentil
-0001c530: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0001c540: 7065 7263 656e 7469 6c65 7320 3d20 6e70  percentiles = np
-0001c550: 2e61 7070 656e 6428 7065 7263 656e 7469  .append(percenti
-0001c560: 6c65 732c 2030 2e35 290a 2020 2020 2020  les, 0.5).      
-0001c570: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
-0001c580: 7320 3d20 6e70 2e75 6e69 7175 6528 7065  s = np.unique(pe
-0001c590: 7263 656e 7469 6c65 7329 0a20 2020 2020  rcentiles).     
-0001c5a0: 2020 2020 2020 2070 6572 6365 6e74 696c         percentil
-0001c5b0: 6573 203d 206c 6973 7428 7065 7263 656e  es = list(percen
-0001c5c0: 7469 6c65 7329 0a20 2020 2020 2020 2073  tiles).        s
-0001c5d0: 7461 7473 203d 205b 0a20 2020 2020 2020  tats = [.       
-0001c5e0: 2020 2020 206e 756d 2e63 6f75 6e74 2873       num.count(s
-0001c5f0: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
-0001c600: 5f65 7665 7279 292c 0a20 2020 2020 2020  _every),.       
-0001c610: 2020 2020 206e 756d 2e6d 6561 6e28 7370       num.mean(sp
-0001c620: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-0001c630: 6576 6572 7929 2c0a 2020 2020 2020 2020  every),.        
-0001c640: 2020 2020 6e75 6d2e 7374 6428 7370 6c69      num.std(spli
-0001c650: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-0001c660: 6572 7929 2c0a 2020 2020 2020 2020 2020  ery),.          
-0001c670: 2020 6e75 6d2e 6d69 6e28 7370 6c69 745f    num.min(split_
-0001c680: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
-0001c690: 7929 2c0a 2020 2020 2020 2020 2020 2020  y),.            
-0001c6a0: 6e75 6d2e 7175 616e 7469 6c65 2870 6572  num.quantile(per
-0001c6b0: 6365 6e74 696c 6573 2c20 6d65 7468 6f64  centiles, method
-0001c6c0: 3d70 6572 6365 6e74 696c 6573 5f6d 6574  =percentiles_met
-0001c6d0: 686f 6429 2c0a 2020 2020 2020 2020 2020  hod),.          
-0001c6e0: 2020 6e75 6d2e 6d61 7828 7370 6c69 745f    num.max(split_
-0001c6f0: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
-0001c700: 7929 2c0a 2020 2020 2020 2020 5d0a 2020  y),.        ].  
-0001c710: 2020 2020 2020 7374 6174 735f 6e61 6d65        stats_name
-0001c720: 7320 3d20 5b28 732e 5f6e 616d 652c 2030  s = [(s._name, 0
-0001c730: 2920 666f 7220 7320 696e 2073 7461 7473  ) for s in stats
-0001c740: 5d0a 0a20 2020 2020 2020 2063 6f6c 6e61  ]..        colna
-0001c750: 6d65 203d 2064 6174 612e 5f6d 6574 612e  me = data._meta.
-0001c760: 6e61 6d65 2069 6620 6973 5f73 6572 6965  name if is_serie
-0001c770: 735f 6c69 6b65 2864 6174 612e 5f6d 6574  s_like(data._met
-0001c780: 6129 2065 6c73 6520 4e6f 6e65 0a0a 2020  a) else None..  
-0001c790: 2020 2020 2020 6e61 6d65 203d 2022 6465        name = "de
-0001c7a0: 7363 7269 6265 2d6e 756d 6572 6963 2d2d  scribe-numeric--
-0001c7b0: 2220 2b20 746f 6b65 6e69 7a65 286e 756d  " + tokenize(num
-0001c7c0: 2c20 7370 6c69 745f 6576 6572 7929 0a20  , split_every). 
-0001c7d0: 2020 2020 2020 206c 6179 6572 203d 207b         layer = {
-0001c7e0: 0a20 2020 2020 2020 2020 2020 2028 6e61  .            (na
-0001c7f0: 6d65 2c20 3029 3a20 280a 2020 2020 2020  me, 0): (.      
-0001c800: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001c810: 732e 6465 7363 7269 6265 5f6e 756d 6572  s.describe_numer
-0001c820: 6963 5f61 6767 7265 6761 7465 2c0a 2020  ic_aggregate,.  
-0001c830: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001c840: 6174 735f 6e61 6d65 732c 0a20 2020 2020  ats_names,.     
-0001c850: 2020 2020 2020 2020 2020 2063 6f6c 6e61             colna
-0001c860: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-0001c870: 2020 2020 6973 5f74 696d 6564 656c 7461      is_timedelta
-0001c880: 5f63 6f6c 756d 6e2c 0a20 2020 2020 2020  _column,.       
-0001c890: 2020 2020 2020 2020 2069 735f 6461 7465           is_date
-0001c8a0: 7469 6d65 5f63 6f6c 756d 6e2c 0a20 2020  time_column,.   
-0001c8b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001c8c0: 2020 207d 0a20 2020 2020 2020 2067 7261     }.        gra
-0001c8d0: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
-0001c8e0: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-0001c8f0: 696f 6e73 286e 616d 652c 206c 6179 6572  ions(name, layer
-0001c900: 2c20 6465 7065 6e64 656e 6369 6573 3d73  , dependencies=s
-0001c910: 7461 7473 290a 2020 2020 2020 2020 6d65  tats).        me
-0001c920: 7461 203d 206e 756d 2e5f 6d65 7461 5f6e  ta = num._meta_n
-0001c930: 6f6e 656d 7074 792e 6465 7363 7269 6265  onempty.describe
-0001c940: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0001c950: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-0001c960: 6772 6170 682c 206e 616d 652c 206d 6574  graph, name, met
-0001c970: 612c 2064 6976 6973 696f 6e73 3d5b 4e6f  a, divisions=[No
-0001c980: 6e65 2c20 4e6f 6e65 5d29 0a0a 2020 2020  ne, None])..    
-0001c990: 6465 6620 5f64 6573 6372 6962 655f 6e6f  def _describe_no
-0001c9a0: 6e6e 756d 6572 6963 5f31 6428 0a20 2020  nnumeric_1d(.   
-0001c9b0: 2020 2020 2073 656c 662c 2064 6174 612c       self, data,
-0001c9c0: 2073 706c 6974 5f65 7665 7279 3d46 616c   split_every=Fal
-0001c9d0: 7365 2c20 6461 7465 7469 6d65 5f69 735f  se, datetime_is_
-0001c9e0: 6e75 6d65 7269 633d 4661 6c73 650a 2020  numeric=False.  
-0001c9f0: 2020 293a 0a20 2020 2020 2020 2066 726f    ):.        fro
-0001ca00: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
-0001ca10: 2e6e 756d 6572 6963 2069 6d70 6f72 7420  .numeric import 
-0001ca20: 746f 5f6e 756d 6572 6963 0a0a 2020 2020  to_numeric..    
-0001ca30: 2020 2020 7663 6f75 6e74 7320 3d20 6461      vcounts = da
-0001ca40: 7461 2e76 616c 7565 5f63 6f75 6e74 7328  ta.value_counts(
-0001ca50: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-0001ca60: 745f 6576 6572 7929 0a20 2020 2020 2020  t_every).       
-0001ca70: 2063 6f75 6e74 5f6e 6f6e 7a65 726f 203d   count_nonzero =
-0001ca80: 2076 636f 756e 7473 5b76 636f 756e 7473   vcounts[vcounts
-0001ca90: 2021 3d20 305d 0a20 2020 2020 2020 2063   != 0].        c
-0001caa0: 6f75 6e74 5f75 6e69 7175 6520 3d20 636f  ount_unique = co
-0001cab0: 756e 745f 6e6f 6e7a 6572 6f2e 7369 7a65  unt_nonzero.size
-0001cac0: 0a0a 2020 2020 2020 2020 7374 6174 7320  ..        stats 
-0001cad0: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-0001cae0: 2320 6e75 6e69 7175 650a 2020 2020 2020  # nunique.      
-0001caf0: 2020 2020 2020 636f 756e 745f 756e 6971        count_uniq
-0001cb00: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-0001cb10: 2320 636f 756e 740a 2020 2020 2020 2020  # count.        
-0001cb20: 2020 2020 6461 7461 2e63 6f75 6e74 2873      data.count(s
-0001cb30: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
-0001cb40: 5f65 7665 7279 292c 0a20 2020 2020 2020  _every),.       
-0001cb50: 2020 2020 2023 206d 6f73 7420 636f 6d6d       # most comm
-0001cb60: 6f6e 2076 616c 7565 0a20 2020 2020 2020  on value.       
-0001cb70: 2020 2020 2076 636f 756e 7473 2e5f 6865       vcounts._he
-0001cb80: 6164 2831 2c20 6e70 6172 7469 7469 6f6e  ad(1, npartition
-0001cb90: 733d 312c 2063 6f6d 7075 7465 3d46 616c  s=1, compute=Fal
-0001cba0: 7365 2c20 7361 6665 3d46 616c 7365 292c  se, safe=False),
-0001cbb0: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
-0001cbc0: 2020 2020 6966 2069 735f 6461 7465 7469      if is_dateti
-0001cbd0: 6d65 3634 5f61 6e79 5f64 7479 7065 2864  me64_any_dtype(d
-0001cbe0: 6174 612e 5f6d 6574 6129 2061 6e64 206e  ata._meta) and n
-0001cbf0: 6f74 2064 6174 6574 696d 655f 6973 5f6e  ot datetime_is_n
-0001cc00: 756d 6572 6963 3a0a 2020 2020 2020 2020  umeric:.        
-0001cc10: 2020 2020 6d69 6e5f 7473 203d 2074 6f5f      min_ts = to_
-0001cc20: 6e75 6d65 7269 6328 6461 7461 2e64 726f  numeric(data.dro
-0001cc30: 706e 6128 2929 2e6d 696e 2873 706c 6974  pna()).min(split
-0001cc40: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-0001cc50: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
-0001cc60: 6d61 785f 7473 203d 2074 6f5f 6e75 6d65  max_ts = to_nume
-0001cc70: 7269 6328 6461 7461 2e64 726f 706e 6128  ric(data.dropna(
-0001cc80: 2929 2e6d 6178 2873 706c 6974 5f65 7665  )).max(split_eve
-0001cc90: 7279 3d73 706c 6974 5f65 7665 7279 290a  ry=split_every).
-0001cca0: 2020 2020 2020 2020 2020 2020 7374 6174              stat
-0001ccb0: 732e 6578 7465 6e64 285b 6d69 6e5f 7473  s.extend([min_ts
-0001ccc0: 2c20 6d61 785f 7473 5d29 0a0a 2020 2020  , max_ts])..    
-0001ccd0: 2020 2020 7374 6174 735f 6e61 6d65 7320      stats_names 
-0001cce0: 3d20 5b28 732e 5f6e 616d 652c 2030 2920  = [(s._name, 0) 
-0001ccf0: 666f 7220 7320 696e 2073 7461 7473 5d0a  for s in stats].
-0001cd00: 2020 2020 2020 2020 636f 6c6e 616d 6520          colname 
-0001cd10: 3d20 6461 7461 2e5f 6d65 7461 2e6e 616d  = data._meta.nam
-0001cd20: 650a 0a20 2020 2020 2020 206e 616d 6520  e..        name 
-0001cd30: 3d20 2264 6573 6372 6962 652d 6e6f 6e6e  = "describe-nonn
-0001cd40: 756d 6572 6963 2d31 642d 2d22 202b 2074  umeric-1d--" + t
-0001cd50: 6f6b 656e 697a 6528 6461 7461 2c20 7370  okenize(data, sp
-0001cd60: 6c69 745f 6576 6572 7929 0a20 2020 2020  lit_every).     
-0001cd70: 2020 206c 6179 6572 203d 207b 0a20 2020     layer = {.   
-0001cd80: 2020 2020 2020 2020 2028 6e61 6d65 2c20           (name, 
-0001cd90: 3029 3a20 286d 6574 686f 6473 2e64 6573  0): (methods.des
-0001cda0: 6372 6962 655f 6e6f 6e6e 756d 6572 6963  cribe_nonnumeric
-0001cdb0: 5f61 6767 7265 6761 7465 2c20 7374 6174  _aggregate, stat
-0001cdc0: 735f 6e61 6d65 732c 2063 6f6c 6e61 6d65  s_names, colname
-0001cdd0: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
-0001cde0: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-0001cdf0: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-0001ce00: 636f 6c6c 6563 7469 6f6e 7328 6e61 6d65  collections(name
-0001ce10: 2c20 6c61 7965 722c 2064 6570 656e 6465  , layer, depende
-0001ce20: 6e63 6965 733d 7374 6174 7329 0a0a 2020  ncies=stats)..  
-0001ce30: 2020 2020 2020 6966 206e 6f74 2050 414e        if not PAN
-0001ce40: 4441 535f 4754 5f32 3030 3a0a 2020 2020  DAS_GT_200:.    
-0001ce50: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
-0001ce60: 5f69 735f 6e75 6d65 7269 635f 6b77 6172  _is_numeric_kwar
-0001ce70: 6720 3d20 7b22 6461 7465 7469 6d65 5f69  g = {"datetime_i
-0001ce80: 735f 6e75 6d65 7269 6322 3a20 6461 7465  s_numeric": date
-0001ce90: 7469 6d65 5f69 735f 6e75 6d65 7269 637d  time_is_numeric}
-0001cea0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001ceb0: 2020 2020 2020 2020 2020 2064 6174 6574             datet
-0001cec0: 696d 655f 6973 5f6e 756d 6572 6963 5f6b  ime_is_numeric_k
-0001ced0: 7761 7267 203d 207b 7d0a 2020 2020 2020  warg = {}.      
-0001cee0: 2020 6d65 7461 203d 2064 6174 612e 5f6d    meta = data._m
-0001cef0: 6574 615f 6e6f 6e65 6d70 7479 2e64 6573  eta_nonempty.des
-0001cf00: 6372 6962 6528 2a2a 6461 7465 7469 6d65  cribe(**datetime
-0001cf10: 5f69 735f 6e75 6d65 7269 635f 6b77 6172  _is_numeric_kwar
-0001cf20: 6729 0a20 2020 2020 2020 2072 6574 7572  g).        retur
-0001cf30: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-0001cf40: 6772 6170 682c 206e 616d 652c 206d 6574  graph, name, met
-0001cf50: 612c 2064 6976 6973 696f 6e73 3d5b 4e6f  a, divisions=[No
-0001cf60: 6e65 2c20 4e6f 6e65 5d29 0a0a 2020 2020  ne, None])..    
-0001cf70: 6465 6620 5f63 756d 5f61 6767 280a 2020  def _cum_agg(.  
-0001cf80: 2020 2020 2020 7365 6c66 2c20 6f70 5f6e        self, op_n
-0001cf90: 616d 652c 2063 6875 6e6b 2c20 6167 6772  ame, chunk, aggr
-0001cfa0: 6567 6174 652c 2061 7869 732c 2073 6b69  egate, axis, ski
-0001cfb0: 706e 613d 5472 7565 2c20 6368 756e 6b5f  pna=True, chunk_
-0001cfc0: 6b77 6172 6773 3d4e 6f6e 652c 206f 7574  kwargs=None, out
-0001cfd0: 3d4e 6f6e 650a 2020 2020 293a 0a20 2020  =None.    ):.   
-0001cfe0: 2020 2020 2022 2222 5772 6170 7065 7220       """Wrapper 
-0001cff0: 666f 7220 6375 6d75 6c61 7469 7665 206f  for cumulative o
-0001d000: 7065 7261 7469 6f6e 2222 220a 0a20 2020  peration"""..   
-0001d010: 2020 2020 2061 7869 7320 3d20 7365 6c66       axis = self
-0001d020: 2e5f 7661 6c69 6461 7465 5f61 7869 7328  ._validate_axis(
-0001d030: 6178 6973 290a 0a20 2020 2020 2020 2069  axis)..        i
-0001d040: 6620 6178 6973 203d 3d20 313a 0a20 2020  f axis == 1:.   
-0001d050: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0001d060: 6622 7b73 656c 662e 5f74 6f6b 656e 5f70  f"{self._token_p
-0001d070: 7265 6669 787d 7b6f 705f 6e61 6d65 7d28  refix}{op_name}(
-0001d080: 6178 6973 3d31 2922 0a20 2020 2020 2020  axis=1)".       
-0001d090: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-0001d0a0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-0001d0b0: 7328 6368 756e 6b2c 2074 6f6b 656e 3d6e  s(chunk, token=n
-0001d0c0: 616d 652c 202a 2a63 6875 6e6b 5f6b 7761  ame, **chunk_kwa
-0001d0d0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-0001d0e0: 2072 6574 7572 6e20 6861 6e64 6c65 5f6f   return handle_o
-0001d0f0: 7574 286f 7574 2c20 7265 7375 6c74 290a  ut(out, result).
-0001d100: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001d110: 2020 2020 2020 2020 2020 2320 6375 6d75            # cumu
-0001d120: 6c61 7465 2065 6163 6820 7061 7274 6974  late each partit
-0001d130: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0001d140: 206e 616d 6531 203d 2066 227b 7365 6c66   name1 = f"{self
-0001d150: 2e5f 746f 6b65 6e5f 7072 6566 6978 7d7b  ._token_prefix}{
-0001d160: 6f70 5f6e 616d 657d 2d6d 6170 220a 2020  op_name}-map".  
-0001d170: 2020 2020 2020 2020 2020 6375 6d70 6172            cumpar
-0001d180: 7420 3d20 6d61 705f 7061 7274 6974 696f  t = map_partitio
-0001d190: 6e73 280a 2020 2020 2020 2020 2020 2020  ns(.            
-0001d1a0: 2020 2020 6368 756e 6b2c 2073 656c 662c      chunk, self,
-0001d1b0: 2074 6f6b 656e 3d6e 616d 6531 2c20 6d65   token=name1, me
-0001d1c0: 7461 3d73 656c 662c 202a 2a63 6875 6e6b  ta=self, **chunk
-0001d1d0: 5f6b 7761 7267 730a 2020 2020 2020 2020  _kwargs.        
-0001d1e0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
-0001d1f0: 2020 206e 616d 6532 203d 2066 227b 7365     name2 = f"{se
-0001d200: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
-0001d210: 7d7b 6f70 5f6e 616d 657d 2d74 616b 652d  }{op_name}-take-
-0001d220: 6c61 7374 220a 2020 2020 2020 2020 2020  last".          
-0001d230: 2020 6375 6d6c 6173 7420 3d20 6d61 705f    cumlast = map_
-0001d240: 7061 7274 6974 696f 6e73 280a 2020 2020  partitions(.    
-0001d250: 2020 2020 2020 2020 2020 2020 5f74 616b              _tak
-0001d260: 655f 6c61 7374 2c0a 2020 2020 2020 2020  e_last,.        
-0001d270: 2020 2020 2020 2020 6375 6d70 6172 742c          cumpart,
-0001d280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d290: 2073 6b69 706e 612c 0a20 2020 2020 2020   skipna,.       
-0001d2a0: 2020 2020 2020 2020 206d 6574 613d 6d65           meta=me
-0001d2b0: 7461 5f73 6572 6965 735f 636f 6e73 7472  ta_series_constr
-0001d2c0: 7563 746f 7228 7365 6c66 2928 5b5d 2c20  uctor(self)([], 
-0001d2d0: 6474 7970 653d 2266 6c6f 6174 2229 2c0a  dtype="float"),.
-0001d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2f0: 746f 6b65 6e3d 6e61 6d65 322c 0a20 2020  token=name2,.   
-0001d300: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001d310: 2020 2020 2020 2020 7375 6666 6978 203d          suffix =
-0001d320: 2074 6f6b 656e 697a 6528 7365 6c66 290a   tokenize(self).
-0001d330: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0001d340: 203d 2066 227b 7365 6c66 2e5f 746f 6b65   = f"{self._toke
-0001d350: 6e5f 7072 6566 6978 7d7b 6f70 5f6e 616d  n_prefix}{op_nam
-0001d360: 657d 2d7b 7375 6666 6978 7d22 0a20 2020  e}-{suffix}".   
-0001d370: 2020 2020 2020 2020 2063 6e61 6d65 203d           cname =
-0001d380: 2066 227b 7365 6c66 2e5f 746f 6b65 6e5f   f"{self._token_
-0001d390: 7072 6566 6978 7d7b 6f70 5f6e 616d 657d  prefix}{op_name}
-0001d3a0: 2d63 756d 2d6c 6173 742d 7b73 7566 6669  -cum-last-{suffi
-0001d3b0: 787d 220a 0a20 2020 2020 2020 2020 2020  x}"..           
-0001d3c0: 2023 2061 6767 7265 6761 7465 2063 756d   # aggregate cum
-0001d3d0: 756c 6174 6564 2070 6172 7469 7369 6f6e  ulated partision
-0001d3e0: 7320 616e 6420 6974 7320 7072 6576 696f  s and its previo
-0001d3f0: 7573 206c 6173 7420 656c 656d 656e 740a  us last element.
-0001d400: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0001d410: 7220 3d20 7b7d 0a20 2020 2020 2020 2020  r = {}.         
-0001d420: 2020 206c 6179 6572 5b28 6e61 6d65 2c20     layer[(name, 
-0001d430: 3029 5d20 3d20 2863 756d 7061 7274 2e5f  0)] = (cumpart._
-0001d440: 6e61 6d65 2c20 3029 0a0a 2020 2020 2020  name, 0)..      
-0001d450: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-0001d460: 616e 6765 2831 2c20 7365 6c66 2e6e 7061  ange(1, self.npa
-0001d470: 7274 6974 696f 6e73 293a 0a20 2020 2020  rtitions):.     
-0001d480: 2020 2020 2020 2020 2020 2023 2073 746f             # sto
-0001d490: 7265 2065 6163 6820 6375 6d75 6c61 7469  re each cumulati
-0001d4a0: 7665 2073 7465 7020 746f 2067 7261 7068  ve step to graph
-0001d4b0: 2074 6f20 7265 6475 6365 2063 6f6d 7075   to reduce compu
-0001d4c0: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
-0001d4d0: 2020 2020 2020 2069 6620 6920 3d3d 2031         if i == 1
-0001d4e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d4f0: 2020 2020 2020 6c61 7965 725b 2863 6e61        layer[(cna
-0001d500: 6d65 2c20 6929 5d20 3d20 2863 756d 6c61  me, i)] = (cumla
-0001d510: 7374 2e5f 6e61 6d65 2c20 6920 2d20 3129  st._name, i - 1)
-0001d520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d530: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001d540: 2020 2020 2020 2020 2020 2023 2061 6767             # agg
-0001d550: 7265 6761 7465 2077 6974 6820 7072 6576  regate with prev
-0001d560: 696f 7573 2063 756d 756c 6174 696f 6e20  ious cumulation 
-0001d570: 7265 7375 6c74 730a 2020 2020 2020 2020  results.        
-0001d580: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0001d590: 725b 2863 6e61 6d65 2c20 6929 5d20 3d20  r[(cname, i)] = 
-0001d5a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001d5b0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001d5c0: 732e 5f63 756d 5f61 6767 7265 6761 7465  s._cum_aggregate
-0001d5d0: 5f61 7070 6c79 2c0a 2020 2020 2020 2020  _apply,.        
-0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5f0: 6167 6772 6567 6174 652c 0a20 2020 2020  aggregate,.     
-0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d610: 2020 2028 636e 616d 652c 2069 202d 2031     (cname, i - 1
-0001d620: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001d630: 2020 2020 2020 2020 2020 2028 6375 6d6c             (cuml
-0001d640: 6173 742e 5f6e 616d 652c 2069 202d 2031  ast._name, i - 1
-0001d650: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001d660: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001d670: 2020 2020 2020 2020 206c 6179 6572 5b28           layer[(
-0001d680: 6e61 6d65 2c20 6929 5d20 3d20 2861 6767  name, i)] = (agg
-0001d690: 7265 6761 7465 2c20 2863 756d 7061 7274  regate, (cumpart
-0001d6a0: 2e5f 6e61 6d65 2c20 6929 2c20 2863 6e61  ._name, i), (cna
-0001d6b0: 6d65 2c20 6929 290a 2020 2020 2020 2020  me, i)).        
-0001d6c0: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-0001d6d0: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-0001d6e0: 636f 6c6c 6563 7469 6f6e 7328 0a20 2020  collections(.   
-0001d6f0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-0001d700: 652c 206c 6179 6572 2c20 6465 7065 6e64  e, layer, depend
-0001d710: 656e 6369 6573 3d5b 6375 6d70 6172 742c  encies=[cumpart,
-0001d720: 2063 756d 6c61 7374 5d0a 2020 2020 2020   cumlast].      
-0001d730: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001d740: 2020 2020 7265 7375 6c74 203d 206e 6577      result = new
-0001d750: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
-0001d760: 2c20 6e61 6d65 2c20 6368 756e 6b28 7365  , name, chunk(se
-0001d770: 6c66 2e5f 6d65 7461 292c 2073 656c 662e  lf._meta), self.
-0001d780: 6469 7669 7369 6f6e 7329 0a20 2020 2020  divisions).     
-0001d790: 2020 2020 2020 2072 6574 7572 6e20 6861         return ha
-0001d7a0: 6e64 6c65 5f6f 7574 286f 7574 2c20 7265  ndle_out(out, re
-0001d7b0: 7375 6c74 290a 0a20 2020 2040 6465 7269  sult)..    @deri
-0001d7c0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
-0001d7d0: 4672 616d 6529 0a20 2020 2064 6566 2063  Frame).    def c
-0001d7e0: 756d 7375 6d28 7365 6c66 2c20 6178 6973  umsum(self, axis
-0001d7f0: 3d4e 6f6e 652c 2073 6b69 706e 613d 5472  =None, skipna=Tr
-0001d800: 7565 2c20 6474 7970 653d 4e6f 6e65 2c20  ue, dtype=None, 
-0001d810: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
-0001d820: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001d830: 6375 6d5f 6167 6728 0a20 2020 2020 2020  cum_agg(.       
-0001d840: 2020 2020 2022 6375 6d73 756d 222c 0a20       "cumsum",. 
-0001d850: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-0001d860: 3d4d 2e63 756d 7375 6d2c 0a20 2020 2020  =M.cumsum,.     
-0001d870: 2020 2020 2020 2061 6767 7265 6761 7465         aggregate
-0001d880: 3d6d 6574 686f 6473 2e63 756d 7375 6d5f  =methods.cumsum_
-0001d890: 6167 6772 6567 6174 652c 0a20 2020 2020  aggregate,.     
-0001d8a0: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
-0001d8b0: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
-0001d8c0: 6970 6e61 3d73 6b69 706e 612c 0a20 2020  ipna=skipna,.   
-0001d8d0: 2020 2020 2020 2020 2063 6875 6e6b 5f6b           chunk_k
-0001d8e0: 7761 7267 733d 6469 6374 2861 7869 733d  wargs=dict(axis=
-0001d8f0: 6178 6973 2c20 736b 6970 6e61 3d73 6b69  axis, skipna=ski
-0001d900: 706e 6129 2c0a 2020 2020 2020 2020 2020  pna),.          
-0001d910: 2020 6f75 743d 6f75 742c 0a20 2020 2020    out=out,.     
-0001d920: 2020 2029 0a0a 2020 2020 4064 6572 6976     )..    @deriv
-0001d930: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
-0001d940: 7261 6d65 290a 2020 2020 6465 6620 6375  rame).    def cu
-0001d950: 6d70 726f 6428 7365 6c66 2c20 6178 6973  mprod(self, axis
-0001d960: 3d4e 6f6e 652c 2073 6b69 706e 613d 5472  =None, skipna=Tr
-0001d970: 7565 2c20 6474 7970 653d 4e6f 6e65 2c20  ue, dtype=None, 
-0001d980: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
-0001d990: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001d9a0: 6375 6d5f 6167 6728 0a20 2020 2020 2020  cum_agg(.       
-0001d9b0: 2020 2020 2022 6375 6d70 726f 6422 2c0a       "cumprod",.
-0001d9c0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-0001d9d0: 6b3d 4d2e 6375 6d70 726f 642c 0a20 2020  k=M.cumprod,.   
-0001d9e0: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-0001d9f0: 7465 3d6d 6574 686f 6473 2e63 756d 7072  te=methods.cumpr
-0001da00: 6f64 5f61 6767 7265 6761 7465 2c0a 2020  od_aggregate,.  
-0001da10: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
-0001da20: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-0001da30: 2073 6b69 706e 613d 736b 6970 6e61 2c0a   skipna=skipna,.
-0001da40: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-0001da50: 6b5f 6b77 6172 6773 3d64 6963 7428 6178  k_kwargs=dict(ax
-0001da60: 6973 3d61 7869 732c 2073 6b69 706e 613d  is=axis, skipna=
-0001da70: 736b 6970 6e61 292c 0a20 2020 2020 2020  skipna),.       
-0001da80: 2020 2020 206f 7574 3d6f 7574 2c0a 2020       out=out,.  
-0001da90: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
-0001daa0: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-0001dab0: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
-0001dac0: 2063 756d 6d61 7828 7365 6c66 2c20 6178   cummax(self, ax
-0001dad0: 6973 3d4e 6f6e 652c 2073 6b69 706e 613d  is=None, skipna=
-0001dae0: 5472 7565 2c20 6f75 743d 4e6f 6e65 293a  True, out=None):
-0001daf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001db00: 7365 6c66 2e5f 6375 6d5f 6167 6728 0a20  self._cum_agg(. 
-0001db10: 2020 2020 2020 2020 2020 2022 6375 6d6d             "cumm
-0001db20: 6178 222c 0a20 2020 2020 2020 2020 2020  ax",.           
-0001db30: 2063 6875 6e6b 3d4d 2e63 756d 6d61 782c   chunk=M.cummax,
-0001db40: 0a20 2020 2020 2020 2020 2020 2061 6767  .            agg
-0001db50: 7265 6761 7465 3d6d 6574 686f 6473 2e63  regate=methods.c
-0001db60: 756d 6d61 785f 6167 6772 6567 6174 652c  ummax_aggregate,
-0001db70: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
-0001db80: 733d 6178 6973 2c0a 2020 2020 2020 2020  s=axis,.        
-0001db90: 2020 2020 736b 6970 6e61 3d73 6b69 706e      skipna=skipn
-0001dba0: 612c 0a20 2020 2020 2020 2020 2020 2063  a,.            c
-0001dbb0: 6875 6e6b 5f6b 7761 7267 733d 6469 6374  hunk_kwargs=dict
-0001dbc0: 2861 7869 733d 6178 6973 2c20 736b 6970  (axis=axis, skip
-0001dbd0: 6e61 3d73 6b69 706e 6129 2c0a 2020 2020  na=skipna),.    
-0001dbe0: 2020 2020 2020 2020 6f75 743d 6f75 742c          out=out,
-0001dbf0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001dc00: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-0001dc10: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
-0001dc20: 6465 6620 6375 6d6d 696e 2873 656c 662c  def cummin(self,
-0001dc30: 2061 7869 733d 4e6f 6e65 2c20 736b 6970   axis=None, skip
-0001dc40: 6e61 3d54 7275 652c 206f 7574 3d4e 6f6e  na=True, out=Non
-0001dc50: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-0001dc60: 726e 2073 656c 662e 5f63 756d 5f61 6767  rn self._cum_agg
-0001dc70: 280a 2020 2020 2020 2020 2020 2020 2263  (.            "c
-0001dc80: 756d 6d69 6e22 2c0a 2020 2020 2020 2020  ummin",.        
-0001dc90: 2020 2020 6368 756e 6b3d 4d2e 6375 6d6d      chunk=M.cumm
-0001dca0: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-0001dcb0: 6167 6772 6567 6174 653d 6d65 7468 6f64  aggregate=method
-0001dcc0: 732e 6375 6d6d 696e 5f61 6767 7265 6761  s.cummin_aggrega
-0001dcd0: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
-0001dce0: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
-0001dcf0: 2020 2020 2020 2073 6b69 706e 613d 736b         skipna=sk
-0001dd00: 6970 6e61 2c0a 2020 2020 2020 2020 2020  ipna,.          
-0001dd10: 2020 6368 756e 6b5f 6b77 6172 6773 3d64    chunk_kwargs=d
-0001dd20: 6963 7428 6178 6973 3d61 7869 732c 2073  ict(axis=axis, s
-0001dd30: 6b69 706e 613d 736b 6970 6e61 292c 0a20  kipna=skipna),. 
-0001dd40: 2020 2020 2020 2020 2020 206f 7574 3d6f             out=o
-0001dd50: 7574 2c0a 2020 2020 2020 2020 290a 0a20  ut,.        ).. 
-0001dd60: 2020 2064 6566 205f 7661 6c69 6461 7465     def _validate
-0001dd70: 5f63 6f6e 6469 7469 6f6e 2873 656c 662c  _condition(self,
-0001dd80: 2063 6f6e 6429 3a0a 2020 2020 2020 2020   cond):.        
-0001dd90: 636f 6e64 5f72 6573 203d 2063 6f6e 6428  cond_res = cond(
-0001dda0: 7365 6c66 2e5f 6d65 7461 2920 6966 2063  self._meta) if c
-0001ddb0: 616c 6c61 626c 6528 636f 6e64 2920 656c  allable(cond) el
-0001ddc0: 7365 2063 6f6e 640a 2020 2020 2020 2020  se cond.        
-0001ddd0: 6966 206e 6f74 2028 0a20 2020 2020 2020  if not (.       
-0001dde0: 2020 2020 2069 735f 6461 736b 5f63 6f6c       is_dask_col
-0001ddf0: 6c65 6374 696f 6e28 636f 6e64 5f72 6573  lection(cond_res
-0001de00: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0001de10: 2069 735f 6461 7461 6672 616d 655f 6c69   is_dataframe_li
-0001de20: 6b65 2863 6f6e 645f 7265 7329 0a20 2020  ke(cond_res).   
-0001de30: 2020 2020 2020 2020 206f 7220 6973 5f73           or is_s
-0001de40: 6572 6965 735f 6c69 6b65 2863 6f6e 645f  eries_like(cond_
-0001de50: 7265 7329 0a20 2020 2020 2020 2020 2020  res).           
-0001de60: 206f 7220 6973 5f69 6e64 6578 5f6c 696b   or is_index_lik
-0001de70: 6528 636f 6e64 5f72 6573 290a 2020 2020  e(cond_res).    
-0001de80: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0001de90: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0001dea0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001deb0: 2020 2020 2066 2243 6f6e 6469 7469 6f6e       f"Condition
-0001dec0: 2073 686f 756c 6420 6265 2061 6e20 6f62   should be an ob
-0001ded0: 6a65 6374 2074 6861 7420 6361 6e20 6265  ject that can be
-0001dee0: 2061 6c69 676e 6564 2077 6974 6820 7b73   aligned with {s
-0001def0: 656c 662e 5f5f 636c 6173 735f 5f7d 2c20  elf.__class__}, 
-0001df00: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001df10: 2020 6622 2077 6869 6368 2069 6e63 6c75    f" which inclu
-0001df20: 6465 7320 4461 736b 206f 7220 7061 6e64  des Dask or pand
-0001df30: 6173 2063 6f6c 6c65 6374 696f 6e73 2c20  as collections, 
-0001df40: 4461 7461 4672 616d 6573 206f 7220 5365  DataFrames or Se
-0001df50: 7269 6573 2c20 6f72 2061 2043 616c 6c61  ries, or a Calla
-0001df60: 626c 652e 220a 2020 2020 2020 2020 2020  ble.".          
-0001df70: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
-0001df80: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-0001df90: 616d 6529 0a20 2020 2064 6566 2077 6865  ame).    def whe
-0001dfa0: 7265 2873 656c 662c 2063 6f6e 642c 206f  re(self, cond, o
-0001dfb0: 7468 6572 3d6e 702e 6e61 6e29 3a0a 2020  ther=np.nan):.  
-0001dfc0: 2020 2020 2020 2320 636f 6e64 2061 6e64        # cond and
-0001dfd0: 206f 7468 6572 206d 6179 2062 6520 6461   other may be da
-0001dfe0: 736b 2069 6e73 7461 6e63 652c 0a20 2020  sk instance,.   
-0001dff0: 2020 2020 2023 2070 6173 7369 6e67 206d       # passing m
-0001e000: 6170 5f70 6172 7469 7469 6f6e 7320 7669  ap_partitions vi
-0001e010: 6120 6b65 7977 6f72 6420 7769 6c6c 206e  a keyword will n
-0001e020: 6f74 2062 6520 616c 6967 6e65 640a 2020  ot be aligned.  
-0001e030: 2020 2020 2020 7365 6c66 2e5f 7661 6c69        self._vali
-0001e040: 6461 7465 5f63 6f6e 6469 7469 6f6e 2863  date_condition(c
-0001e050: 6f6e 6429 0a20 2020 2020 2020 2072 6574  ond).        ret
-0001e060: 7572 6e20 6d61 705f 7061 7274 6974 696f  urn map_partitio
-0001e070: 6e73 284d 2e77 6865 7265 2c20 7365 6c66  ns(M.where, self
-0001e080: 2c20 636f 6e64 2c20 6f74 6865 722c 2065  , cond, other, e
-0001e090: 6e66 6f72 6365 5f6d 6574 6164 6174 613d  nforce_metadata=
-0001e0a0: 4661 6c73 6529 0a0a 2020 2020 4064 6572  False)..    @der
-0001e0b0: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
-0001e0c0: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
-0001e0d0: 6d61 736b 2873 656c 662c 2063 6f6e 642c  mask(self, cond,
-0001e0e0: 206f 7468 6572 3d6e 702e 6e61 6e29 3a0a   other=np.nan):.
-0001e0f0: 2020 2020 2020 2020 7365 6c66 2e5f 7661          self._va
-0001e100: 6c69 6461 7465 5f63 6f6e 6469 7469 6f6e  lidate_condition
-0001e110: 2863 6f6e 6429 0a20 2020 2020 2020 2072  (cond).        r
-0001e120: 6574 7572 6e20 6d61 705f 7061 7274 6974  eturn map_partit
-0001e130: 696f 6e73 284d 2e6d 6173 6b2c 2073 656c  ions(M.mask, sel
-0001e140: 662c 2063 6f6e 642c 206f 7468 6572 2c20  f, cond, other, 
-0001e150: 656e 666f 7263 655f 6d65 7461 6461 7461  enforce_metadata
-0001e160: 3d46 616c 7365 290a 0a20 2020 2040 6465  =False)..    @de
-0001e170: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-0001e180: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
-0001e190: 206e 6f74 6e75 6c6c 2873 656c 6629 3a0a   notnull(self):.
-0001e1a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001e1b0: 656c 662e 6d61 705f 7061 7274 6974 696f  elf.map_partitio
-0001e1c0: 6e73 284d 2e6e 6f74 6e75 6c6c 2c20 656e  ns(M.notnull, en
-0001e1d0: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-0001e1e0: 616c 7365 290a 0a20 2020 2040 6465 7269  alse)..    @deri
-0001e1f0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
-0001e200: 4672 616d 6529 0a20 2020 2064 6566 2069  Frame).    def i
-0001e210: 736e 756c 6c28 7365 6c66 293a 0a20 2020  snull(self):.   
-0001e220: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001e230: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
-0001e240: 4d2e 6973 6e75 6c6c 2c20 656e 666f 7263  M.isnull, enforc
-0001e250: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
-0001e260: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-0001e270: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-0001e280: 6529 0a20 2020 2064 6566 2069 736e 6128  e).    def isna(
-0001e290: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-0001e2a0: 6620 6861 7361 7474 7228 7064 2c20 2269  f hasattr(pd, "i
-0001e2b0: 736e 6122 293a 0a20 2020 2020 2020 2020  sna"):.         
-0001e2c0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-0001e2d0: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
-0001e2e0: 6973 6e61 2c20 656e 666f 7263 655f 6d65  isna, enforce_me
-0001e2f0: 7461 6461 7461 3d46 616c 7365 290a 2020  tadata=False).  
-0001e300: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001e310: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
-0001e320: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-0001e330: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0001e340: 2020 2022 4e65 6564 206d 6f72 6520 7265     "Need more re
-0001e350: 6365 6e74 2076 6572 7369 6f6e 206f 6620  cent version of 
-0001e360: 5061 6e64 6173 2022 0a20 2020 2020 2020  Pandas ".       
-0001e370: 2020 2020 2020 2020 2022 746f 2073 7570           "to sup
-0001e380: 706f 7274 2069 736e 612e 2022 0a20 2020  port isna. ".   
-0001e390: 2020 2020 2020 2020 2020 2020 2022 506c               "Pl
-0001e3a0: 6561 7365 2075 7365 2069 736e 756c 6c20  ease use isnull 
-0001e3b0: 696e 7374 6561 642e 220a 2020 2020 2020  instead.".      
-0001e3c0: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
-0001e3d0: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-0001e3e0: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
-0001e3f0: 2069 7369 6e28 7365 6c66 2c20 7661 6c75   isin(self, valu
-0001e400: 6573 293a 0a20 2020 2020 2020 2069 6620  es):.        if 
-0001e410: 6973 5f64 6174 6166 7261 6d65 5f6c 696b  is_dataframe_lik
-0001e420: 6528 7365 6c66 2e5f 6d65 7461 293a 0a20  e(self._meta):. 
-0001e430: 2020 2020 2020 2020 2020 2023 2044 6174             # Dat
-0001e440: 6146 7261 6d65 2e69 7369 6e20 646f 6573  aFrame.isin does
-0001e450: 2077 6569 7264 2061 6c69 676e 6d65 6e74   weird alignment
-0001e460: 2073 7475 6666 0a20 2020 2020 2020 2020   stuff.         
-0001e470: 2020 2062 6164 5f74 7970 6573 203d 2028     bad_types = (
-0001e480: 5f46 7261 6d65 2c20 7064 2e53 6572 6965  _Frame, pd.Serie
-0001e490: 732c 2070 642e 4461 7461 4672 616d 6529  s, pd.DataFrame)
-0001e4a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001e4b0: 2020 2020 2020 2020 2020 2062 6164 5f74             bad_t
-0001e4c0: 7970 6573 203d 2028 5f46 7261 6d65 2c29  ypes = (_Frame,)
-0001e4d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-0001e4e0: 7374 616e 6365 2876 616c 7565 732c 2062  stance(values, b
-0001e4f0: 6164 5f74 7970 6573 293a 0a20 2020 2020  ad_types):.     
-0001e500: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-0001e510: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-0001e520: 2822 5061 7373 696e 6720 6120 2572 2074  ("Passing a %r t
-0001e530: 6f20 6069 7369 6e60 2220 2520 7479 7065  o `isin`" % type
-0001e540: 6e61 6d65 2874 7970 6528 7661 6c75 6573  name(type(values
-0001e550: 2929 290a 2020 2020 2020 2020 6d65 7461  ))).        meta
-0001e560: 203d 2073 656c 662e 5f6d 6574 615f 6e6f   = self._meta_no
-0001e570: 6e65 6d70 7479 2e69 7369 6e28 7661 6c75  nempty.isin(valu
-0001e580: 6573 290a 2020 2020 2020 2020 2320 5765  es).        # We
-0001e590: 2077 7261 7020 7661 6c75 6573 2069 6e20   wrap values in 
-0001e5a0: 6120 6465 6c61 7965 6420 666f 7220 7477  a delayed for tw
-0001e5b0: 6f20 7265 6173 6f6e 733a 0a20 2020 2020  o reasons:.     
-0001e5c0: 2020 2023 202d 2061 766f 6964 2073 6572     # - avoid ser
-0001e5d0: 6961 6c69 7a69 6e67 2064 6174 6120 696e  ializing data in
-0001e5e0: 2065 7665 7279 2074 6173 6b0a 2020 2020   every task.    
-0001e5f0: 2020 2020 2320 2d20 6176 6f69 6420 636f      # - avoid co
-0001e600: 7374 206f 6620 7472 6176 6572 7361 6c20  st of traversal 
-0001e610: 6f66 206c 6172 6765 206c 6973 7420 696e  of large list in
-0001e620: 206f 7074 696d 697a 6174 696f 6e73 0a20   optimizations. 
-0001e630: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0001e640: 616e 6365 2876 616c 7565 732c 206c 6973  ance(values, lis
-0001e650: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001e660: 2320 4d6f 7469 7661 7465 6420 6279 2068  # Motivated by h
-0001e670: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
-0001e680: 6d2f 6461 736b 2f64 6173 6b2f 6973 7375  m/dask/dask/issu
-0001e690: 6573 2f39 3431 312e 2020 5468 6973 2061  es/9411.  This a
-0001e6a0: 7070 6561 7273 2074 6f20 6265 0a20 2020  ppears to be.   
-0001e6b0: 2020 2020 2020 2020 2023 2063 6175 7365           # cause
-0001e6c0: 6420 6279 2068 7474 7073 3a2f 2f67 6974  d by https://git
-0001e6d0: 6875 622e 636f 6d2f 6461 736b 2f64 6973  hub.com/dask/dis
-0001e6e0: 7472 6962 7574 6564 2f69 7373 7565 732f  tributed/issues/
-0001e6f0: 3633 3638 2c20 616e 6420 6675 7274 6865  6368, and furthe
-0001e700: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
-0001e710: 6578 6163 6572 6261 7465 6420 6279 2074  exacerbated by t
-0001e720: 6865 2066 6163 7420 7468 6174 2074 6865  he fact that the
-0001e730: 206c 6973 7420 636f 6e74 6169 6e73 2064   list contains d
-0001e740: 7570 6c69 6361 7465 732e 2020 5468 6973  uplicates.  This
-0001e750: 2069 7320 6120 7061 7463 6820 756e 7469   is a patch unti
-0001e760: 6c0a 2020 2020 2020 2020 2020 2020 2320  l.            # 
-0001e770: 7765 2063 616e 2063 7265 6174 6520 6120  we can create a 
-0001e780: 6265 7474 6572 2066 6978 2066 6f72 2053  better fix for S
-0001e790: 6572 6961 6c69 7a61 7469 6f6e 2e0a 2020  erialization..  
-0001e7a0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0001e7b0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001e7c0: 616c 7565 7320 3d20 6c69 7374 2873 6574  alues = list(set
-0001e7d0: 2876 616c 7565 7329 290a 2020 2020 2020  (values)).      
-0001e7e0: 2020 2020 2020 6578 6365 7074 2054 7970        except Typ
-0001e7f0: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0001e800: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0001e810: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001e820: 616e 7928 6973 5f64 6173 6b5f 636f 6c6c  any(is_dask_coll
-0001e830: 6563 7469 6f6e 2876 2920 666f 7220 7620  ection(v) for v 
-0001e840: 696e 2076 616c 7565 7329 3a0a 2020 2020  in values):.    
-0001e850: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0001e860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e870: 2020 2020 2076 616c 7565 7320 3d20 6e70       values = np
-0001e880: 2e66 726f 6d69 7465 7228 7661 6c75 6573  .fromiter(values
-0001e890: 2c20 6474 7970 653d 6f62 6a65 6374 290a  , dtype=object).
-0001e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e8b0: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
-0001e8c0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-0001e8d0: 2020 2020 2020 2023 204e 756d 7079 2031         # Numpy 1
-0001e8e0: 2e32 3320 7375 7070 6f72 7473 2063 7265  .23 supports cre
-0001e8f0: 6174 696e 6720 6172 7261 7973 206f 6620  ating arrays of 
-0001e900: 6974 6572 6162 6c65 732c 2077 6869 6c65  iterables, while
-0001e910: 206c 6f77 6572 0a20 2020 2020 2020 2020   lower.         
-0001e920: 2020 2020 2020 2020 2020 2023 2076 6572             # ver
-0001e930: 7369 6f6e 2031 2e32 312e 7820 616e 6420  sion 1.21.x and 
-0001e940: 312e 3232 2e78 2064 6f20 6e6f 740a 2020  1.22.x do not.  
-0001e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e960: 2020 7061 7373 0a20 2020 2020 2020 2072    pass.        r
-0001e970: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
-0001e980: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
-0001e990: 2020 2020 2020 204d 2e69 7369 6e2c 2064         M.isin, d
-0001e9a0: 656c 6179 6564 2876 616c 7565 7329 2c20  elayed(values), 
-0001e9b0: 6d65 7461 3d6d 6574 612c 2065 6e66 6f72  meta=meta, enfor
-0001e9c0: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
-0001e9d0: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-0001e9e0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-0001e9f0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-0001ea00: 2064 6566 2061 7374 7970 6528 7365 6c66   def astype(self
-0001ea10: 2c20 6474 7970 6529 3a0a 2020 2020 2020  , dtype):.      
-0001ea20: 2020 2320 5858 583a 2050 616e 6461 7320    # XXX: Pandas 
-0001ea30: 7769 6c6c 2073 6567 6661 756c 7420 666f  will segfault fo
-0001ea40: 7220 656d 7074 7920 6461 7461 6672 616d  r empty datafram
-0001ea50: 6573 2077 6865 6e20 7365 7474 696e 670a  es when setting.
-0001ea60: 2020 2020 2020 2020 2320 6361 7465 676f          # catego
-0001ea70: 7269 6361 6c20 6474 7970 6573 2e20 5468  rical dtypes. Th
-0001ea80: 6973 206f 7065 7261 7469 6f6e 2069 736e  is operation isn
-0001ea90: 2774 2061 6c6c 6f77 6564 2063 7572 7265  't allowed curre
-0001eaa0: 6e74 6c79 2061 6e79 7761 792e 2057 650a  ntly anyway. We.
-0001eab0: 2020 2020 2020 2020 2320 6765 7420 7468          # get th
-0001eac0: 6520 6d65 7461 6461 7461 2077 6974 6820  e metadata with 
-0001ead0: 6120 6e6f 6e2d 656d 7074 7920 6672 616d  a non-empty fram
-0001eae0: 6520 746f 2074 6872 6f77 2074 6865 2065  e to throw the e
-0001eaf0: 7272 6f72 2069 6e73 7465 6164 206f 660a  rror instead of.
-0001eb00: 2020 2020 2020 2020 2320 7365 6766 6175          # segfau
-0001eb10: 6c74 696e 672e 0a20 2020 2020 2020 2069  lting..        i
-0001eb20: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-0001eb30: 6973 5f64 6174 6166 7261 6d65 5f6c 696b  is_dataframe_lik
-0001eb40: 6528 7365 6c66 2e5f 6d65 7461 290a 2020  e(self._meta).  
-0001eb50: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
-0001eb60: 7420 6861 7361 7474 7228 6474 7970 652c  t hasattr(dtype,
-0001eb70: 2022 6974 656d 7322 290a 2020 2020 2020   "items").      
-0001eb80: 2020 2020 2020 616e 6420 6973 696e 7374        and isinst
-0001eb90: 616e 6365 2870 642e 6170 692e 7479 7065  ance(pd.api.type
-0001eba0: 732e 7061 6e64 6173 5f64 7479 7065 2864  s.pandas_dtype(d
-0001ebb0: 7479 7065 292c 2070 642e 4361 7465 676f  type), pd.Catego
-0001ebc0: 7269 6361 6c44 7479 7065 290a 2020 2020  ricalDtype).    
-0001ebd0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0001ebe0: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
-0001ebf0: 6d65 7461 5f6e 6f6e 656d 7074 792e 6173  meta_nonempty.as
-0001ec00: 7479 7065 2864 7479 7065 290a 2020 2020  type(dtype).    
-0001ec10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001ec20: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
-0001ec30: 662e 5f6d 6574 612e 6173 7479 7065 2864  f._meta.astype(d
-0001ec40: 7479 7065 290a 2020 2020 2020 2020 6966  type).        if
-0001ec50: 2068 6173 6174 7472 2864 7479 7065 2c20   hasattr(dtype, 
-0001ec60: 2269 7465 6d73 2229 3a0a 2020 2020 2020  "items"):.      
-0001ec70: 2020 2020 2020 7365 745f 756e 6b6e 6f77        set_unknow
-0001ec80: 6e20 3d20 5b0a 2020 2020 2020 2020 2020  n = [.          
-0001ec90: 2020 2020 2020 6b0a 2020 2020 2020 2020        k.        
-0001eca0: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-0001ecb0: 2069 6e20 6474 7970 652e 6974 656d 7328   in dtype.items(
-0001ecc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ecd0: 2020 6966 2028 6973 696e 7374 616e 6365    if (isinstance
-0001ece0: 2870 642e 6170 692e 7479 7065 732e 7061  (pd.api.types.pa
-0001ecf0: 6e64 6173 5f64 7479 7065 2876 292c 2070  ndas_dtype(v), p
-0001ed00: 642e 4361 7465 676f 7269 6361 6c44 7479  d.CategoricalDty
-0001ed10: 7065 2929 0a20 2020 2020 2020 2020 2020  pe)).           
-0001ed20: 2020 2020 2061 6e64 2067 6574 6174 7472       and getattr
-0001ed30: 2876 2c20 2263 6174 6567 6f72 6965 7322  (v, "categories"
-0001ed40: 2c20 4e6f 6e65 2920 6973 204e 6f6e 650a  , None) is None.
-0001ed50: 2020 2020 2020 2020 2020 2020 5d0a 2020              ].  
-0001ed60: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
-0001ed70: 2063 6c65 6172 5f6b 6e6f 776e 5f63 6174   clear_known_cat
-0001ed80: 6567 6f72 6965 7328 6d65 7461 2c20 636f  egories(meta, co
-0001ed90: 6c73 3d73 6574 5f75 6e6b 6e6f 776e 290a  ls=set_unknown).
-0001eda0: 2020 2020 2020 2020 656c 6966 2028 0a20          elif (. 
-0001edb0: 2020 2020 2020 2020 2020 2069 7369 6e73             isins
-0001edc0: 7461 6e63 6528 7064 2e61 7069 2e74 7970  tance(pd.api.typ
-0001edd0: 6573 2e70 616e 6461 735f 6474 7970 6528  es.pandas_dtype(
-0001ede0: 6474 7970 6529 2c20 7064 2e43 6174 6567  dtype), pd.Categ
-0001edf0: 6f72 6963 616c 4474 7970 6529 0a20 2020  oricalDtype).   
-0001ee00: 2020 2020 2029 2061 6e64 2067 6574 6174       ) and getat
-0001ee10: 7472 2864 7479 7065 2c20 2263 6174 6567  tr(dtype, "categ
-0001ee20: 6f72 6965 7322 2c20 4e6f 6e65 2920 6973  ories", None) is
-0001ee30: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0001ee40: 2020 206d 6574 6120 3d20 636c 6561 725f     meta = clear_
-0001ee50: 6b6e 6f77 6e5f 6361 7465 676f 7269 6573  known_categories
-0001ee60: 286d 6574 6129 0a20 2020 2020 2020 2072  (meta).        r
-0001ee70: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
-0001ee80: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
-0001ee90: 2020 2020 2020 204d 2e61 7374 7970 652c         M.astype,
-0001eea0: 2064 7479 7065 3d64 7479 7065 2c20 6d65   dtype=dtype, me
-0001eeb0: 7461 3d6d 6574 612c 2065 6e66 6f72 6365  ta=meta, enforce
-0001eec0: 5f6d 6574 6164 6174 613d 4661 6c73 650a  _metadata=False.
-0001eed0: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
-0001eee0: 6620 6e6f 7420 5041 4e44 4153 5f47 545f  f not PANDAS_GT_
-0001eef0: 3230 303a 0a0a 2020 2020 2020 2020 4064  200:..        @d
-0001ef00: 6572 6976 6564 5f66 726f 6d28 7064 2e53  erived_from(pd.S
-0001ef10: 6572 6965 7329 0a20 2020 2020 2020 2064  eries).        d
-0001ef20: 6566 2061 7070 656e 6428 7365 6c66 2c20  ef append(self, 
-0001ef30: 6f74 6865 722c 2069 6e74 6572 6c65 6176  other, interleav
-0001ef40: 655f 7061 7274 6974 696f 6e73 3d46 616c  e_partitions=Fal
-0001ef50: 7365 293a 0a20 2020 2020 2020 2020 2020  se):.           
-0001ef60: 2069 6620 5041 4e44 4153 5f47 545f 3134   if PANDAS_GT_14
-0001ef70: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0001ef80: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-0001ef90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001efa0: 2020 2020 2020 2254 6865 2066 7261 6d65        "The frame
-0001efb0: 2e61 7070 656e 6420 6d65 7468 6f64 2069  .append method i
-0001efc0: 7320 6465 7072 6563 6174 6564 2061 6e64  s deprecated and
-0001efd0: 2077 696c 6c20 6265 2072 656d 6f76 6564   will be removed
-0001efe0: 2066 726f 6d22 0a20 2020 2020 2020 2020   from".         
-0001eff0: 2020 2020 2020 2020 2020 2022 6461 736b             "dask
-0001f000: 2069 6e20 6120 6675 7475 7265 2076 6572   in a future ver
-0001f010: 7369 6f6e 2e20 5573 6520 6461 736b 2e64  sion. Use dask.d
-0001f020: 6174 6166 7261 6d65 2e63 6f6e 6361 7420  ataframe.concat 
-0001f030: 696e 7374 6561 642e 222c 0a20 2020 2020  instead.",.     
-0001f040: 2020 2020 2020 2020 2020 2020 2020 2046                 F
-0001f050: 7574 7572 6557 6172 6e69 6e67 2c0a 2020  utureWarning,.  
-0001f060: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001f070: 2020 2020 2020 2020 2020 2020 2320 6265              # be
-0001f080: 6361 7573 6520 4461 7461 4672 616d 652e  cause DataFrame.
-0001f090: 6170 7065 6e64 2077 696c 6c20 6f76 6572  append will over
-0001f0a0: 7269 6465 2074 6865 206d 6574 686f 642c  ride the method,
-0001f0b0: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
-0001f0c0: 7261 7020 6279 2070 642e 5365 7269 6573  rap by pd.Series
-0001f0d0: 2e61 7070 656e 6420 646f 6373 7472 696e  .append docstrin
-0001f0e0: 670a 2020 2020 2020 2020 2020 2020 6672  g.            fr
-0001f0f0: 6f6d 2064 6173 6b2e 6461 7461 6672 616d  om dask.datafram
-0001f100: 652e 6d75 6c74 6920 696d 706f 7274 2063  e.multi import c
-0001f110: 6f6e 6361 740a 0a20 2020 2020 2020 2020  oncat..         
-0001f120: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0001f130: 286f 7468 6572 2c20 286c 6973 742c 2064  (other, (list, d
-0001f140: 6963 7429 293a 0a20 2020 2020 2020 2020  ict)):.         
-0001f150: 2020 2020 2020 206d 7367 203d 2022 6170         msg = "ap
-0001f160: 7065 6e64 2064 6f65 736e 2774 2073 7570  pend doesn't sup
-0001f170: 706f 7274 206c 6973 7420 6f72 2064 6963  port list or dic
-0001f180: 7420 696e 7075 7422 0a20 2020 2020 2020  t input".       
-0001f190: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-0001f1a0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-0001f1b0: 6f72 286d 7367 290a 0a20 2020 2020 2020  or(msg)..       
-0001f1c0: 2020 2020 2072 6574 7572 6e20 636f 6e63       return conc
-0001f1d0: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-0001f1e0: 2020 2020 5b73 656c 662c 206f 7468 6572      [self, other
-0001f1f0: 5d2c 206a 6f69 6e3d 226f 7574 6572 222c  ], join="outer",
-0001f200: 2069 6e74 6572 6c65 6176 655f 7061 7274   interleave_part
-0001f210: 6974 696f 6e73 3d69 6e74 6572 6c65 6176  itions=interleav
-0001f220: 655f 7061 7274 6974 696f 6e73 0a20 2020  e_partitions.   
-0001f230: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001f240: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-0001f250: 2e53 6572 6965 7329 0a20 2020 2064 6566  .Series).    def
-0001f260: 2064 6f74 2873 656c 662c 206f 7468 6572   dot(self, other
-0001f270: 2c20 6d65 7461 3d6e 6f5f 6465 6661 756c  , meta=no_defaul
-0001f280: 7429 3a0a 2020 2020 2020 2020 6966 206e  t):.        if n
-0001f290: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
-0001f2a0: 6865 722c 205f 4672 616d 6529 3a0a 2020  her, _Frame):.  
-0001f2b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001f2c0: 5479 7065 4572 726f 7228 2254 6865 2073  TypeError("The s
-0001f2d0: 6563 6f6e 6420 6f70 6572 616e 6420 6d75  econd operand mu
-0001f2e0: 7374 2062 6520 6120 6461 736b 2061 7272  st be a dask arr
-0001f2f0: 6179 206f 7220 6461 736b 2064 6174 6166  ay or dask dataf
-0001f300: 7261 6d65 2229 0a0a 2020 2020 2020 2020  rame")..        
-0001f310: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
-0001f320: 6865 722c 2044 6174 6146 7261 6d65 293a  her, DataFrame):
-0001f330: 0a20 2020 2020 2020 2020 2020 2073 203d  .            s =
-0001f340: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
-0001f350: 696f 6e73 284d 2e64 6f74 2c20 6f74 6865  ions(M.dot, othe
-0001f360: 722c 2074 6f6b 656e 3d22 646f 7422 2c20  r, token="dot", 
-0001f370: 6d65 7461 3d6d 6574 6129 0a20 2020 2020  meta=meta).     
-0001f380: 2020 2020 2020 2072 6574 7572 6e20 732e         return s.
-0001f390: 6772 6f75 7062 7928 6279 3d73 2e69 6e64  groupby(by=s.ind
-0001f3a0: 6578 292e 6170 706c 7928 0a20 2020 2020  ex).apply(.     
-0001f3b0: 2020 2020 2020 2020 2020 206c 616d 6264             lambd
-0001f3c0: 6120 783a 2078 2e73 756d 2873 6b69 706e  a x: x.sum(skipn
-0001f3d0: 613d 4661 6c73 6529 2c20 6d65 7461 3d73  a=False), meta=s
-0001f3e0: 2e5f 6d65 7461 5f6e 6f6e 656d 7074 790a  ._meta_nonempty.
-0001f3f0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0001f400: 2020 2020 2020 2064 6566 205f 646f 745f         def _dot_
-0001f410: 7365 7269 6573 282a 6172 6773 2c20 2a2a  series(*args, **
-0001f420: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0001f430: 2020 2020 2023 202e 7375 6d28 2920 6973       # .sum() is
-0001f440: 2069 6e76 6f6b 6564 206f 6e20 6561 6368   invoked on each
-0001f450: 2070 6172 7469 7469 6f6e 2062 6566 6f72   partition befor
-0001f460: 6520 6265 696e 6720 6170 706c 6965 6420  e being applied 
-0001f470: 746f 2061 6c6c 0a20 2020 2020 2020 2020  to all.         
-0001f480: 2020 2023 2070 6172 7469 7469 6f6e 732e     # partitions.
-0001f490: 2054 6865 2072 6574 7572 6e20 7479 7065   The return type
-0001f4a0: 2069 7320 6578 7065 6374 6564 2074 6f20   is expected to 
-0001f4b0: 6265 2061 2073 6572 6965 732c 206e 6f74  be a series, not
-0001f4c0: 2061 206e 756d 7079 206f 626a 6563 740a   a numpy object.
-0001f4d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001f4e0: 726e 206d 6574 615f 7365 7269 6573 5f63  rn meta_series_c
-0001f4f0: 6f6e 7374 7275 6374 6f72 2873 656c 6629  onstructor(self)
-0001f500: 284d 2e64 6f74 282a 6172 6773 2c20 2a2a  (M.dot(*args, **
-0001f510: 6b77 6172 6773 2929 0a0a 2020 2020 2020  kwargs))..      
-0001f520: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-0001f530: 705f 7061 7274 6974 696f 6e73 285f 646f  p_partitions(_do
-0001f540: 745f 7365 7269 6573 2c20 6f74 6865 722c  t_series, other,
-0001f550: 2074 6f6b 656e 3d22 646f 7422 2c20 6d65   token="dot", me
-0001f560: 7461 3d6d 6574 6129 2e73 756d 280a 2020  ta=meta).sum(.  
-0001f570: 2020 2020 2020 2020 2020 736b 6970 6e61            skipna
-0001f580: 3d46 616c 7365 0a20 2020 2020 2020 2029  =False.        )
-0001f590: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-0001f5a0: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
-0001f5b0: 290a 2020 2020 6465 6620 616c 6967 6e28  ).    def align(
-0001f5c0: 7365 6c66 2c20 6f74 6865 722c 206a 6f69  self, other, joi
-0001f5d0: 6e3d 226f 7574 6572 222c 2061 7869 733d  n="outer", axis=
-0001f5e0: 4e6f 6e65 2c20 6669 6c6c 5f76 616c 7565  None, fill_value
-0001f5f0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001f600: 6d65 7461 312c 206d 6574 6132 203d 205f  meta1, meta2 = _
-0001f610: 656d 756c 6174 6528 0a20 2020 2020 2020  emulate(.       
-0001f620: 2020 2020 204d 2e61 6c69 676e 2c20 7365       M.align, se
-0001f630: 6c66 2c20 6f74 6865 722c 206a 6f69 6e2c  lf, other, join,
-0001f640: 2061 7869 733d 6178 6973 2c20 6669 6c6c   axis=axis, fill
-0001f650: 5f76 616c 7565 3d66 696c 6c5f 7661 6c75  _value=fill_valu
-0001f660: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
-0001f670: 2020 2020 616c 6967 6e65 6420 3d20 7365      aligned = se
-0001f680: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-0001f690: 7328 0a20 2020 2020 2020 2020 2020 204d  s(.            M
-0001f6a0: 2e61 6c69 676e 2c0a 2020 2020 2020 2020  .align,.        
-0001f6b0: 2020 2020 6f74 6865 722c 0a20 2020 2020      other,.     
-0001f6c0: 2020 2020 2020 206a 6f69 6e3d 6a6f 696e         join=join
-0001f6d0: 2c0a 2020 2020 2020 2020 2020 2020 6178  ,.            ax
-0001f6e0: 6973 3d61 7869 732c 0a20 2020 2020 2020  is=axis,.       
-0001f6f0: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
-0001f700: 6669 6c6c 5f76 616c 7565 2c0a 2020 2020  fill_value,.    
-0001f710: 2020 2020 2020 2020 656e 666f 7263 655f          enforce_
-0001f720: 6d65 7461 6461 7461 3d46 616c 7365 2c0a  metadata=False,.
-0001f730: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001f740: 2020 2074 6f6b 656e 203d 2074 6f6b 656e     token = token
-0001f750: 697a 6528 7365 6c66 2c20 6f74 6865 722c  ize(self, other,
-0001f760: 206a 6f69 6e2c 2061 7869 732c 2066 696c   join, axis, fil
-0001f770: 6c5f 7661 6c75 6529 0a0a 2020 2020 2020  l_value)..      
-0001f780: 2020 6e61 6d65 3120 3d20 2261 6c69 676e    name1 = "align
-0001f790: 312d 2220 2b20 746f 6b65 6e0a 2020 2020  1-" + token.    
-0001f7a0: 2020 2020 6473 6b31 203d 207b 0a20 2020      dsk1 = {.   
-0001f7b0: 2020 2020 2020 2020 2028 6e61 6d65 312c           (name1,
-0001f7c0: 2069 293a 2028 6765 7469 7465 6d2c 206b   i): (getitem, k
-0001f7d0: 6579 2c20 3029 0a20 2020 2020 2020 2020  ey, 0).         
-0001f7e0: 2020 2066 6f72 2069 2c20 6b65 7920 696e     for i, key in
-0001f7f0: 2065 6e75 6d65 7261 7465 2861 6c69 676e   enumerate(align
-0001f800: 6564 2e5f 5f64 6173 6b5f 6b65 7973 5f5f  ed.__dask_keys__
-0001f810: 2829 290a 2020 2020 2020 2020 7d0a 2020  ()).        }.  
-0001f820: 2020 2020 2020 6473 6b31 2e75 7064 6174        dsk1.updat
-0001f830: 6528 616c 6967 6e65 642e 6461 736b 290a  e(aligned.dask).
-0001f840: 2020 2020 2020 2020 7265 7375 6c74 3120          result1 
-0001f850: 3d20 6e65 775f 6464 5f6f 626a 6563 7428  = new_dd_object(
-0001f860: 6473 6b31 2c20 6e61 6d65 312c 206d 6574  dsk1, name1, met
-0001f870: 6131 2c20 616c 6967 6e65 642e 6469 7669  a1, aligned.divi
-0001f880: 7369 6f6e 7329 0a0a 2020 2020 2020 2020  sions)..        
-0001f890: 6e61 6d65 3220 3d20 2261 6c69 676e 322d  name2 = "align2-
-0001f8a0: 2220 2b20 746f 6b65 6e0a 2020 2020 2020  " + token.      
-0001f8b0: 2020 6473 6b32 203d 207b 0a20 2020 2020    dsk2 = {.     
-0001f8c0: 2020 2020 2020 2028 6e61 6d65 322c 2069         (name2, i
-0001f8d0: 293a 2028 6765 7469 7465 6d2c 206b 6579  ): (getitem, key
-0001f8e0: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-0001f8f0: 2066 6f72 2069 2c20 6b65 7920 696e 2065   for i, key in e
-0001f900: 6e75 6d65 7261 7465 2861 6c69 676e 6564  numerate(aligned
-0001f910: 2e5f 5f64 6173 6b5f 6b65 7973 5f5f 2829  .__dask_keys__()
-0001f920: 290a 2020 2020 2020 2020 7d0a 2020 2020  ).        }.    
-0001f930: 2020 2020 6473 6b32 2e75 7064 6174 6528      dsk2.update(
-0001f940: 616c 6967 6e65 642e 6461 736b 290a 2020  aligned.dask).  
-0001f950: 2020 2020 2020 7265 7375 6c74 3220 3d20        result2 = 
-0001f960: 6e65 775f 6464 5f6f 626a 6563 7428 6473  new_dd_object(ds
-0001f970: 6b32 2c20 6e61 6d65 322c 206d 6574 6132  k2, name2, meta2
-0001f980: 2c20 616c 6967 6e65 642e 6469 7669 7369  , aligned.divisi
-0001f990: 6f6e 7329 0a0a 2020 2020 2020 2020 7265  ons)..        re
-0001f9a0: 7475 726e 2072 6573 756c 7431 2c20 7265  turn result1, re
-0001f9b0: 7375 6c74 320a 0a20 2020 2040 6465 7269  sult2..    @deri
-0001f9c0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
-0001f9d0: 4672 616d 6529 0a20 2020 2064 6566 2063  Frame).    def c
-0001f9e0: 6f6d 6269 6e65 2873 656c 662c 206f 7468  ombine(self, oth
-0001f9f0: 6572 2c20 6675 6e63 2c20 6669 6c6c 5f76  er, func, fill_v
-0001fa00: 616c 7565 3d4e 6f6e 652c 206f 7665 7277  alue=None, overw
-0001fa10: 7269 7465 3d54 7275 6529 3a0a 2020 2020  rite=True):.    
-0001fa20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001fa30: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
-0001fa40: 2020 2020 2020 2020 2020 2020 4d2e 636f              M.co
-0001fa50: 6d62 696e 652c 206f 7468 6572 2c20 6675  mbine, other, fu
-0001fa60: 6e63 2c20 6669 6c6c 5f76 616c 7565 3d66  nc, fill_value=f
-0001fa70: 696c 6c5f 7661 6c75 652c 206f 7665 7277  ill_value, overw
-0001fa80: 7269 7465 3d6f 7665 7277 7269 7465 0a20  rite=overwrite. 
-0001fa90: 2020 2020 2020 2029 0a0a 2020 2020 4064         )..    @d
-0001faa0: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
-0001fab0: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
-0001fac0: 6620 636f 6d62 696e 655f 6669 7273 7428  f combine_first(
-0001fad0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-0001fae0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001faf0: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
-0001fb00: 284d 2e63 6f6d 6269 6e65 5f66 6972 7374  (M.combine_first
-0001fb10: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-0001fb20: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0001fb30: 6566 205f 6269 6e64 5f6f 7065 7261 746f  ef _bind_operato
-0001fb40: 725f 6d65 7468 6f64 2863 6c73 2c20 6e61  r_method(cls, na
-0001fb50: 6d65 2c20 6f70 2c20 6f72 6967 696e 616c  me, op, original
-0001fb60: 3d70 642e 4461 7461 4672 616d 6529 3a0a  =pd.DataFrame):.
-0001fb70: 2020 2020 2020 2020 2222 2262 696e 6420          """bind 
-0001fb80: 6f70 6572 6174 6f72 206d 6574 686f 6420  operator method 
-0001fb90: 6c69 6b65 2044 6174 6146 7261 6d65 2e61  like DataFrame.a
-0001fba0: 6464 2074 6f20 7468 6973 2063 6c61 7373  dd to this class
-0001fbb0: 2222 220a 2020 2020 2020 2020 7261 6973  """.        rais
-0001fbc0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-0001fbd0: 4572 726f 720a 0a20 2020 2040 6465 7269  Error..    @deri
-0001fbe0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
-0001fbf0: 4672 616d 6529 0a20 2020 2064 6566 2072  Frame).    def r
-0001fc00: 6573 616d 706c 6528 7365 6c66 2c20 7275  esample(self, ru
-0001fc10: 6c65 2c20 636c 6f73 6564 3d4e 6f6e 652c  le, closed=None,
-0001fc20: 206c 6162 656c 3d4e 6f6e 6529 3a0a 2020   label=None):.  
-0001fc30: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-0001fc40: 6461 7461 6672 616d 652e 7473 6572 6965  dataframe.tserie
-0001fc50: 732e 7265 7361 6d70 6c65 2069 6d70 6f72  s.resample impor
-0001fc60: 7420 5265 7361 6d70 6c65 720a 0a20 2020  t Resampler..   
-0001fc70: 2020 2020 2072 6574 7572 6e20 5265 7361       return Resa
-0001fc80: 6d70 6c65 7228 7365 6c66 2c20 7275 6c65  mpler(self, rule
-0001fc90: 2c20 636c 6f73 6564 3d63 6c6f 7365 642c  , closed=closed,
-0001fca0: 206c 6162 656c 3d6c 6162 656c 290a 0a20   label=label).. 
-0001fcb0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-0001fcc0: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-0001fcd0: 2020 2064 6566 2066 6972 7374 2873 656c     def first(sel
-0001fce0: 662c 206f 6666 7365 7429 3a0a 2020 2020  f, offset):.    
-0001fcf0: 2020 2020 2320 4c65 7420 7061 6e64 6173      # Let pandas
-0001fd00: 2065 7272 6f72 206f 6e20 6261 6420 6172   error on bad ar
-0001fd10: 6773 0a20 2020 2020 2020 2073 656c 662e  gs.        self.
-0001fd20: 5f6d 6574 615f 6e6f 6e65 6d70 7479 2e66  _meta_nonempty.f
-0001fd30: 6972 7374 286f 6666 7365 7429 0a0a 2020  irst(offset)..  
-0001fd40: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0001fd50: 662e 6b6e 6f77 6e5f 6469 7669 7369 6f6e  f.known_division
-0001fd60: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0001fd70: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0001fd80: 2260 6669 7273 7460 2069 7320 6e6f 7420  "`first` is not 
-0001fd90: 696d 706c 656d 656e 7465 6420 666f 7220  implemented for 
-0001fda0: 756e 6b6e 6f77 6e20 6469 7669 7369 6f6e  unknown division
-0001fdb0: 7322 290a 0a20 2020 2020 2020 206f 6666  s")..        off
-0001fdc0: 7365 7420 3d20 7064 2e74 7365 7269 6573  set = pd.tseries
-0001fdd0: 2e66 7265 7175 656e 6369 6573 2e74 6f5f  .frequencies.to_
-0001fde0: 6f66 6673 6574 286f 6666 7365 7429 0a20  offset(offset). 
-0001fdf0: 2020 2020 2020 2064 6174 6520 3d20 7365         date = se
-0001fe00: 6c66 2e64 6976 6973 696f 6e73 5b30 5d20  lf.divisions[0] 
-0001fe10: 2b20 6f66 6673 6574 0a20 2020 2020 2020  + offset.       
-0001fe20: 2065 6e64 203d 2073 656c 662e 6c6f 632e   end = self.loc.
-0001fe30: 5f67 6574 5f70 6172 7469 7469 6f6e 7328  _get_partitions(
-0001fe40: 6461 7465 290a 0a20 2020 2020 2020 2069  date)..        i
-0001fe50: 735f 616e 6368 6f72 6564 203d 206f 6666  s_anchored = off
-0001fe60: 7365 742e 6973 5f61 6e63 686f 7265 6428  set.is_anchored(
-0001fe70: 290a 0a20 2020 2020 2020 2069 6e63 6c75  )..        inclu
-0001fe80: 6465 5f72 6967 6874 203d 2069 735f 616e  de_right = is_an
-0001fe90: 6368 6f72 6564 206f 7220 6e6f 7420 6861  chored or not ha
-0001fea0: 7361 7474 7228 6f66 6673 6574 2c20 2264  sattr(offset, "d
-0001feb0: 656c 7461 2229 0a0a 2020 2020 2020 2020  elta")..        
-0001fec0: 6966 2065 6e64 203d 3d20 7365 6c66 2e6e  if end == self.n
-0001fed0: 7061 7274 6974 696f 6e73 202d 2031 3a0a  partitions - 1:.
-0001fee0: 2020 2020 2020 2020 2020 2020 6469 7673              divs
-0001fef0: 203d 2073 656c 662e 6469 7669 7369 6f6e   = self.division
-0001ff00: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
-0001ff10: 2020 2020 2020 2020 2020 2020 6469 7673              divs
-0001ff20: 203d 2073 656c 662e 6469 7669 7369 6f6e   = self.division
-0001ff30: 735b 3a20 656e 6420 2b20 315d 202b 2028  s[: end + 1] + (
-0001ff40: 6461 7465 2c29 0a0a 2020 2020 2020 2020  date,)..        
-0001ff50: 6e61 6d65 203d 2022 6669 7273 742d 2220  name = "first-" 
-0001ff60: 2b20 746f 6b65 6e69 7a65 2873 656c 662c  + tokenize(self,
-0001ff70: 206f 6666 7365 7429 0a20 2020 2020 2020   offset).       
-0001ff80: 2064 736b 203d 207b 286e 616d 652c 2069   dsk = {(name, i
-0001ff90: 293a 2028 7365 6c66 2e5f 6e61 6d65 2c20  ): (self._name, 
-0001ffa0: 6929 2066 6f72 2069 2069 6e20 7261 6e67  i) for i in rang
-0001ffb0: 6528 656e 6429 7d0a 2020 2020 2020 2020  e(end)}.        
-0001ffc0: 6473 6b5b 286e 616d 652c 2065 6e64 295d  dsk[(name, end)]
-0001ffd0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0001ffe0: 206d 6574 686f 6473 2e62 6f75 6e64 6172   methods.boundar
-0001fff0: 795f 736c 6963 652c 0a20 2020 2020 2020  y_slice,.       
-00020000: 2020 2020 2028 7365 6c66 2e5f 6e61 6d65       (self._name
-00020010: 2c20 656e 6429 2c0a 2020 2020 2020 2020  , end),.        
-00020020: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
-00020030: 2020 2020 2020 6461 7465 2c0a 2020 2020        date,.    
+0001c220: 656c 7461 5f63 6f6c 756d 6e3d 5472 7565  elta_column=True
+0001c230: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001c240: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+0001c250: 6461 7465 7469 6d65 3634 5f61 6e79 5f64  datetime64_any_d
+0001c260: 7479 7065 2864 6174 612e 5f6d 6574 6129  type(data._meta)
+0001c270: 2061 6e64 2064 6174 6574 696d 655f 6973   and datetime_is
+0001c280: 5f6e 756d 6572 6963 3a0a 2020 2020 2020  _numeric:.      
+0001c290: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001c2a0: 662e 5f64 6573 6372 6962 655f 6e75 6d65  f._describe_nume
+0001c2b0: 7269 6328 0a20 2020 2020 2020 2020 2020  ric(.           
+0001c2c0: 2020 2020 2064 6174 612e 6472 6f70 6e61       data.dropna
+0001c2d0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
+0001c2e0: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
+0001c2f0: 7370 6c69 745f 6576 6572 792c 0a20 2020  split_every,.   
+0001c300: 2020 2020 2020 2020 2020 2020 2070 6572               per
+0001c310: 6365 6e74 696c 6573 3d70 6572 6365 6e74  centiles=percent
+0001c320: 696c 6573 2c0a 2020 2020 2020 2020 2020  iles,.          
+0001c330: 2020 2020 2020 7065 7263 656e 7469 6c65        percentile
+0001c340: 735f 6d65 7468 6f64 3d70 6572 6365 6e74  s_method=percent
+0001c350: 696c 6573 5f6d 6574 686f 642c 0a20 2020  iles_method,.   
+0001c360: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+0001c370: 6461 7465 7469 6d65 5f63 6f6c 756d 6e3d  datetime_column=
+0001c380: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0001c390: 2020 290a 2020 2020 2020 2020 656c 7365    ).        else
+0001c3a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c3b0: 7475 726e 2073 656c 662e 5f64 6573 6372  turn self._descr
+0001c3c0: 6962 655f 6e6f 6e6e 756d 6572 6963 5f31  ibe_nonnumeric_1
+0001c3d0: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+0001c3e0: 2020 2064 6174 612c 2073 706c 6974 5f65     data, split_e
+0001c3f0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+0001c400: 2c20 6461 7465 7469 6d65 5f69 735f 6e75  , datetime_is_nu
+0001c410: 6d65 7269 633d 6461 7465 7469 6d65 5f69  meric=datetime_i
+0001c420: 735f 6e75 6d65 7269 630a 2020 2020 2020  s_numeric.      
+0001c430: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0001c440: 205f 6465 7363 7269 6265 5f6e 756d 6572   _describe_numer
+0001c450: 6963 280a 2020 2020 2020 2020 7365 6c66  ic(.        self
+0001c460: 2c0a 2020 2020 2020 2020 6461 7461 2c0a  ,.        data,.
+0001c470: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
+0001c480: 6572 793d 4661 6c73 652c 0a20 2020 2020  ery=False,.     
+0001c490: 2020 2070 6572 6365 6e74 696c 6573 3d4e     percentiles=N
+0001c4a0: 6f6e 652c 0a20 2020 2020 2020 2070 6572  one,.        per
+0001c4b0: 6365 6e74 696c 6573 5f6d 6574 686f 643d  centiles_method=
+0001c4c0: 2264 6566 6175 6c74 222c 0a20 2020 2020  "default",.     
+0001c4d0: 2020 2069 735f 7469 6d65 6465 6c74 615f     is_timedelta_
+0001c4e0: 636f 6c75 6d6e 3d46 616c 7365 2c0a 2020  column=False,.  
+0001c4f0: 2020 2020 2020 6973 5f64 6174 6574 696d        is_datetim
+0001c500: 655f 636f 6c75 6d6e 3d46 616c 7365 2c0a  e_column=False,.
+0001c510: 2020 2020 293a 0a20 2020 2020 2020 2066      ):.        f
+0001c520: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
+0001c530: 6d65 2e6e 756d 6572 6963 2069 6d70 6f72  me.numeric impor
+0001c540: 7420 746f 5f6e 756d 6572 6963 0a0a 2020  t to_numeric..  
+0001c550: 2020 2020 2020 6966 2069 735f 7469 6d65        if is_time
+0001c560: 6465 6c74 615f 636f 6c75 6d6e 206f 7220  delta_column or 
+0001c570: 6973 5f64 6174 6574 696d 655f 636f 6c75  is_datetime_colu
+0001c580: 6d6e 3a0a 2020 2020 2020 2020 2020 2020  mn:.            
+0001c590: 6e75 6d20 3d20 746f 5f6e 756d 6572 6963  num = to_numeric
+0001c5a0: 2864 6174 6129 0a20 2020 2020 2020 2065  (data).        e
+0001c5b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001c5c0: 206e 756d 203d 2064 6174 612e 5f67 6574   num = data._get
+0001c5d0: 5f6e 756d 6572 6963 5f64 6174 6128 290a  _numeric_data().
+0001c5e0: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
+0001c5f0: 2e6e 6469 6d20 3d3d 2032 2061 6e64 206c  .ndim == 2 and l
+0001c600: 656e 286e 756d 2e63 6f6c 756d 6e73 2920  en(num.columns) 
+0001c610: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0001c620: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001c630: 6f72 2822 4461 7461 4672 616d 6520 636f  or("DataFrame co
+0001c640: 6e74 6169 6e73 206f 6e6c 7920 6e6f 6e2d  ntains only non-
+0001c650: 6e75 6d65 7269 6320 6461 7461 2e22 290a  numeric data.").
+0001c660: 2020 2020 2020 2020 656c 6966 2064 6174          elif dat
+0001c670: 612e 6e64 696d 203d 3d20 3120 616e 6420  a.ndim == 1 and 
+0001c680: 6461 7461 2e64 7479 7065 203d 3d20 226f  data.dtype == "o
+0001c690: 626a 6563 7422 3a0a 2020 2020 2020 2020  bject":.        
+0001c6a0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001c6b0: 7272 6f72 2822 4361 6e6e 6f74 2063 6f6d  rror("Cannot com
+0001c6c0: 7075 7465 2060 6064 6573 6372 6962 6560  pute ``describe`
+0001c6d0: 6020 6f6e 206f 626a 6563 7420 6474 7970  ` on object dtyp
+0001c6e0: 652e 2229 0a20 2020 2020 2020 2069 6620  e.").        if 
+0001c6f0: 7065 7263 656e 7469 6c65 7320 6973 204e  percentiles is N
+0001c700: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001c710: 2070 6572 6365 6e74 696c 6573 203d 205b   percentiles = [
+0001c720: 302e 3235 2c20 302e 352c 2030 2e37 355d  0.25, 0.5, 0.75]
+0001c730: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0001c740: 2020 2020 2020 2020 2020 2023 2061 6c77             # alw
+0001c750: 6179 7320 696e 636c 7564 6520 7468 6520  ays include the 
+0001c760: 7468 6520 3530 2574 6c65 2074 6f20 6361  the 50%tle to ca
+0001c770: 6c63 756c 6174 6520 7468 6520 6d65 6469  lculate the medi
+0001c780: 616e 0a20 2020 2020 2020 2020 2020 2023  an.            #
+0001c790: 2075 6e69 7175 6520 7265 6d6f 7665 7320   unique removes 
+0001c7a0: 6475 706c 6963 6174 6573 2061 6e64 2073  duplicates and s
+0001c7b0: 6f72 7473 2071 7561 6e74 696c 6573 0a20  orts quantiles. 
+0001c7c0: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+0001c7d0: 6e74 696c 6573 203d 206e 702e 6172 7261  ntiles = np.arra
+0001c7e0: 7928 7065 7263 656e 7469 6c65 7329 0a20  y(percentiles). 
+0001c7f0: 2020 2020 2020 2020 2020 2070 6572 6365             perce
+0001c800: 6e74 696c 6573 203d 206e 702e 6170 7065  ntiles = np.appe
+0001c810: 6e64 2870 6572 6365 6e74 696c 6573 2c20  nd(percentiles, 
+0001c820: 302e 3529 0a20 2020 2020 2020 2020 2020  0.5).           
+0001c830: 2070 6572 6365 6e74 696c 6573 203d 206e   percentiles = n
+0001c840: 702e 756e 6971 7565 2870 6572 6365 6e74  p.unique(percent
+0001c850: 696c 6573 290a 2020 2020 2020 2020 2020  iles).          
+0001c860: 2020 7065 7263 656e 7469 6c65 7320 3d20    percentiles = 
+0001c870: 6c69 7374 2870 6572 6365 6e74 696c 6573  list(percentiles
+0001c880: 290a 2020 2020 2020 2020 7374 6174 7320  ).        stats 
+0001c890: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+0001c8a0: 6e75 6d2e 636f 756e 7428 7370 6c69 745f  num.count(split_
+0001c8b0: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
+0001c8c0: 7929 2c0a 2020 2020 2020 2020 2020 2020  y),.            
+0001c8d0: 6e75 6d2e 6d65 616e 2873 706c 6974 5f65  num.mean(split_e
+0001c8e0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+0001c8f0: 292c 0a20 2020 2020 2020 2020 2020 206e  ),.            n
+0001c900: 756d 2e73 7464 2873 706c 6974 5f65 7665  um.std(split_eve
+0001c910: 7279 3d73 706c 6974 5f65 7665 7279 292c  ry=split_every),
+0001c920: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0001c930: 2e6d 696e 2873 706c 6974 5f65 7665 7279  .min(split_every
+0001c940: 3d73 706c 6974 5f65 7665 7279 292c 0a20  =split_every),. 
+0001c950: 2020 2020 2020 2020 2020 206e 756d 2e71             num.q
+0001c960: 7561 6e74 696c 6528 7065 7263 656e 7469  uantile(percenti
+0001c970: 6c65 732c 206d 6574 686f 643d 7065 7263  les, method=perc
+0001c980: 656e 7469 6c65 735f 6d65 7468 6f64 292c  entiles_method),
+0001c990: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0001c9a0: 2e6d 6178 2873 706c 6974 5f65 7665 7279  .max(split_every
+0001c9b0: 3d73 706c 6974 5f65 7665 7279 292c 0a20  =split_every),. 
+0001c9c0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0001c9d0: 2073 7461 7473 5f6e 616d 6573 203d 205b   stats_names = [
+0001c9e0: 2873 2e5f 6e61 6d65 2c20 3029 2066 6f72  (s._name, 0) for
+0001c9f0: 2073 2069 6e20 7374 6174 735d 0a0a 2020   s in stats]..  
+0001ca00: 2020 2020 2020 636f 6c6e 616d 6520 3d20        colname = 
+0001ca10: 6461 7461 2e5f 6d65 7461 2e6e 616d 6520  data._meta.name 
+0001ca20: 6966 2069 735f 7365 7269 6573 5f6c 696b  if is_series_lik
+0001ca30: 6528 6461 7461 2e5f 6d65 7461 2920 656c  e(data._meta) el
+0001ca40: 7365 204e 6f6e 650a 0a20 2020 2020 2020  se None..       
+0001ca50: 206e 616d 6520 3d20 2264 6573 6372 6962   name = "describ
+0001ca60: 652d 6e75 6d65 7269 632d 2d22 202b 2074  e-numeric--" + t
+0001ca70: 6f6b 656e 697a 6528 6e75 6d2c 2073 706c  okenize(num, spl
+0001ca80: 6974 5f65 7665 7279 290a 2020 2020 2020  it_every).      
+0001ca90: 2020 6c61 7965 7220 3d20 7b0a 2020 2020    layer = {.    
+0001caa0: 2020 2020 2020 2020 286e 616d 652c 2030          (name, 0
+0001cab0: 293a 2028 0a20 2020 2020 2020 2020 2020  ): (.           
+0001cac0: 2020 2020 206d 6574 686f 6473 2e64 6573       methods.des
+0001cad0: 6372 6962 655f 6e75 6d65 7269 635f 6167  cribe_numeric_ag
+0001cae0: 6772 6567 6174 652c 0a20 2020 2020 2020  gregate,.       
+0001caf0: 2020 2020 2020 2020 2073 7461 7473 5f6e           stats_n
+0001cb00: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
+0001cb10: 2020 2020 2020 636f 6c6e 616d 652c 0a20        colname,. 
+0001cb20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001cb30: 735f 7469 6d65 6465 6c74 615f 636f 6c75  s_timedelta_colu
+0001cb40: 6d6e 2c0a 2020 2020 2020 2020 2020 2020  mn,.            
+0001cb50: 2020 2020 6973 5f64 6174 6574 696d 655f      is_datetime_
+0001cb60: 636f 6c75 6d6e 2c0a 2020 2020 2020 2020  column,.        
+0001cb70: 2020 2020 290a 2020 2020 2020 2020 7d0a      ).        }.
+0001cb80: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
+0001cb90: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+0001cba0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+0001cbb0: 6e61 6d65 2c20 6c61 7965 722c 2064 6570  name, layer, dep
+0001cbc0: 656e 6465 6e63 6965 733d 7374 6174 7329  endencies=stats)
+0001cbd0: 0a20 2020 2020 2020 206d 6574 6120 3d20  .        meta = 
+0001cbe0: 6e75 6d2e 5f6d 6574 615f 6e6f 6e65 6d70  num._meta_nonemp
+0001cbf0: 7479 2e64 6573 6372 6962 6528 290a 2020  ty.describe().  
+0001cc00: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+0001cc10: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
+0001cc20: 2c20 6e61 6d65 2c20 6d65 7461 2c20 6469  , name, meta, di
+0001cc30: 7669 7369 6f6e 733d 5b4e 6f6e 652c 204e  visions=[None, N
+0001cc40: 6f6e 655d 290a 0a20 2020 2064 6566 205f  one])..    def _
+0001cc50: 6465 7363 7269 6265 5f6e 6f6e 6e75 6d65  describe_nonnume
+0001cc60: 7269 635f 3164 280a 2020 2020 2020 2020  ric_1d(.        
+0001cc70: 7365 6c66 2c20 6461 7461 2c20 7370 6c69  self, data, spli
+0001cc80: 745f 6576 6572 793d 4661 6c73 652c 2064  t_every=False, d
+0001cc90: 6174 6574 696d 655f 6973 5f6e 756d 6572  atetime_is_numer
+0001cca0: 6963 3d46 616c 7365 0a20 2020 2029 3a0a  ic=False.    ):.
+0001ccb0: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+0001ccc0: 6b2e 6461 7461 6672 616d 652e 6e75 6d65  k.dataframe.nume
+0001ccd0: 7269 6320 696d 706f 7274 2074 6f5f 6e75  ric import to_nu
+0001cce0: 6d65 7269 630a 0a20 2020 2020 2020 2076  meric..        v
+0001ccf0: 636f 756e 7473 203d 2064 6174 612e 7661  counts = data.va
+0001cd00: 6c75 655f 636f 756e 7473 2873 706c 6974  lue_counts(split
+0001cd10: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
+0001cd20: 7279 290a 2020 2020 2020 2020 636f 756e  ry).        coun
+0001cd30: 745f 6e6f 6e7a 6572 6f20 3d20 7663 6f75  t_nonzero = vcou
+0001cd40: 6e74 735b 7663 6f75 6e74 7320 213d 2030  nts[vcounts != 0
+0001cd50: 5d0a 2020 2020 2020 2020 636f 756e 745f  ].        count_
+0001cd60: 756e 6971 7565 203d 2063 6f75 6e74 5f6e  unique = count_n
+0001cd70: 6f6e 7a65 726f 2e73 697a 650a 0a20 2020  onzero.size..   
+0001cd80: 2020 2020 2073 7461 7473 203d 205b 0a20       stats = [. 
+0001cd90: 2020 2020 2020 2020 2020 2023 206e 756e             # nun
+0001cda0: 6971 7565 0a20 2020 2020 2020 2020 2020  ique.           
+0001cdb0: 2063 6f75 6e74 5f75 6e69 7175 652c 0a20   count_unique,. 
+0001cdc0: 2020 2020 2020 2020 2020 2023 2063 6f75             # cou
+0001cdd0: 6e74 0a20 2020 2020 2020 2020 2020 2064  nt.            d
+0001cde0: 6174 612e 636f 756e 7428 7370 6c69 745f  ata.count(split_
+0001cdf0: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
+0001ce00: 7929 2c0a 2020 2020 2020 2020 2020 2020  y),.            
+0001ce10: 2320 6d6f 7374 2063 6f6d 6d6f 6e20 7661  # most common va
+0001ce20: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+0001ce30: 7663 6f75 6e74 732e 5f68 6561 6428 312c  vcounts._head(1,
+0001ce40: 206e 7061 7274 6974 696f 6e73 3d31 2c20   npartitions=1, 
+0001ce50: 636f 6d70 7574 653d 4661 6c73 652c 2073  compute=False, s
+0001ce60: 6166 653d 4661 6c73 6529 2c0a 2020 2020  afe=False),.    
+0001ce70: 2020 2020 5d0a 0a20 2020 2020 2020 2069      ]..        i
+0001ce80: 6620 6973 5f64 6174 6574 696d 6536 345f  f is_datetime64_
+0001ce90: 616e 795f 6474 7970 6528 6461 7461 2e5f  any_dtype(data._
+0001cea0: 6d65 7461 2920 616e 6420 6e6f 7420 6461  meta) and not da
+0001ceb0: 7465 7469 6d65 5f69 735f 6e75 6d65 7269  tetime_is_numeri
+0001cec0: 633a 0a20 2020 2020 2020 2020 2020 206d  c:.            m
+0001ced0: 696e 5f74 7320 3d20 746f 5f6e 756d 6572  in_ts = to_numer
+0001cee0: 6963 2864 6174 612e 6472 6f70 6e61 2829  ic(data.dropna()
+0001cef0: 292e 6d69 6e28 7370 6c69 745f 6576 6572  ).min(split_ever
+0001cf00: 793d 7370 6c69 745f 6576 6572 7929 0a20  y=split_every). 
+0001cf10: 2020 2020 2020 2020 2020 206d 6178 5f74             max_t
+0001cf20: 7320 3d20 746f 5f6e 756d 6572 6963 2864  s = to_numeric(d
+0001cf30: 6174 612e 6472 6f70 6e61 2829 292e 6d61  ata.dropna()).ma
+0001cf40: 7828 7370 6c69 745f 6576 6572 793d 7370  x(split_every=sp
+0001cf50: 6c69 745f 6576 6572 7929 0a20 2020 2020  lit_every).     
+0001cf60: 2020 2020 2020 2073 7461 7473 2e65 7874         stats.ext
+0001cf70: 656e 6428 5b6d 696e 5f74 732c 206d 6178  end([min_ts, max
+0001cf80: 5f74 735d 290a 0a20 2020 2020 2020 2073  _ts])..        s
+0001cf90: 7461 7473 5f6e 616d 6573 203d 205b 2873  tats_names = [(s
+0001cfa0: 2e5f 6e61 6d65 2c20 3029 2066 6f72 2073  ._name, 0) for s
+0001cfb0: 2069 6e20 7374 6174 735d 0a20 2020 2020   in stats].     
+0001cfc0: 2020 2063 6f6c 6e61 6d65 203d 2064 6174     colname = dat
+0001cfd0: 612e 5f6d 6574 612e 6e61 6d65 0a0a 2020  a._meta.name..  
+0001cfe0: 2020 2020 2020 6e61 6d65 203d 2022 6465        name = "de
+0001cff0: 7363 7269 6265 2d6e 6f6e 6e75 6d65 7269  scribe-nonnumeri
+0001d000: 632d 3164 2d2d 2220 2b20 746f 6b65 6e69  c-1d--" + tokeni
+0001d010: 7a65 2864 6174 612c 2073 706c 6974 5f65  ze(data, split_e
+0001d020: 7665 7279 290a 2020 2020 2020 2020 6c61  very).        la
+0001d030: 7965 7220 3d20 7b0a 2020 2020 2020 2020  yer = {.        
+0001d040: 2020 2020 286e 616d 652c 2030 293a 2028      (name, 0): (
+0001d050: 6d65 7468 6f64 732e 6465 7363 7269 6265  methods.describe
+0001d060: 5f6e 6f6e 6e75 6d65 7269 635f 6167 6772  _nonnumeric_aggr
+0001d070: 6567 6174 652c 2073 7461 7473 5f6e 616d  egate, stats_nam
+0001d080: 6573 2c20 636f 6c6e 616d 6529 0a20 2020  es, colname).   
+0001d090: 2020 2020 207d 0a20 2020 2020 2020 2067       }.        g
+0001d0a0: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
+0001d0b0: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
+0001d0c0: 6374 696f 6e73 286e 616d 652c 206c 6179  ctions(name, lay
+0001d0d0: 6572 2c20 6465 7065 6e64 656e 6369 6573  er, dependencies
+0001d0e0: 3d73 7461 7473 290a 0a20 2020 2020 2020  =stats)..       
+0001d0f0: 2069 6620 6e6f 7420 5041 4e44 4153 5f47   if not PANDAS_G
+0001d100: 545f 3230 303a 0a20 2020 2020 2020 2020  T_200:.         
+0001d110: 2020 2064 6174 6574 696d 655f 6973 5f6e     datetime_is_n
+0001d120: 756d 6572 6963 5f6b 7761 7267 203d 207b  umeric_kwarg = {
+0001d130: 2264 6174 6574 696d 655f 6973 5f6e 756d  "datetime_is_num
+0001d140: 6572 6963 223a 2064 6174 6574 696d 655f  eric": datetime_
+0001d150: 6973 5f6e 756d 6572 6963 7d0a 2020 2020  is_numeric}.    
+0001d160: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001d170: 2020 2020 2020 6461 7465 7469 6d65 5f69        datetime_i
+0001d180: 735f 6e75 6d65 7269 635f 6b77 6172 6720  s_numeric_kwarg 
+0001d190: 3d20 7b7d 0a20 2020 2020 2020 206d 6574  = {}.        met
+0001d1a0: 6120 3d20 6461 7461 2e5f 6d65 7461 5f6e  a = data._meta_n
+0001d1b0: 6f6e 656d 7074 792e 6465 7363 7269 6265  onempty.describe
+0001d1c0: 282a 2a64 6174 6574 696d 655f 6973 5f6e  (**datetime_is_n
+0001d1d0: 756d 6572 6963 5f6b 7761 7267 290a 2020  umeric_kwarg).  
+0001d1e0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+0001d1f0: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
+0001d200: 2c20 6e61 6d65 2c20 6d65 7461 2c20 6469  , name, meta, di
+0001d210: 7669 7369 6f6e 733d 5b4e 6f6e 652c 204e  visions=[None, N
+0001d220: 6f6e 655d 290a 0a20 2020 2064 6566 205f  one])..    def _
+0001d230: 6375 6d5f 6167 6728 0a20 2020 2020 2020  cum_agg(.       
+0001d240: 2073 656c 662c 206f 705f 6e61 6d65 2c20   self, op_name, 
+0001d250: 6368 756e 6b2c 2061 6767 7265 6761 7465  chunk, aggregate
+0001d260: 2c20 6178 6973 2c20 736b 6970 6e61 3d54  , axis, skipna=T
+0001d270: 7275 652c 2063 6875 6e6b 5f6b 7761 7267  rue, chunk_kwarg
+0001d280: 733d 4e6f 6e65 2c20 6f75 743d 4e6f 6e65  s=None, out=None
+0001d290: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0001d2a0: 2222 2257 7261 7070 6572 2066 6f72 2063  """Wrapper for c
+0001d2b0: 756d 756c 6174 6976 6520 6f70 6572 6174  umulative operat
+0001d2c0: 696f 6e22 2222 0a0a 2020 2020 2020 2020  ion"""..        
+0001d2d0: 6178 6973 203d 2073 656c 662e 5f76 616c  axis = self._val
+0001d2e0: 6964 6174 655f 6178 6973 2861 7869 7329  idate_axis(axis)
+0001d2f0: 0a0a 2020 2020 2020 2020 6966 2061 7869  ..        if axi
+0001d300: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
+0001d310: 2020 2020 6e61 6d65 203d 2066 227b 7365      name = f"{se
+0001d320: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
+0001d330: 7d7b 6f70 5f6e 616d 657d 2861 7869 733d  }{op_name}(axis=
+0001d340: 3129 220a 2020 2020 2020 2020 2020 2020  1)".            
+0001d350: 7265 7375 6c74 203d 2073 656c 662e 6d61  result = self.ma
+0001d360: 705f 7061 7274 6974 696f 6e73 2863 6875  p_partitions(chu
+0001d370: 6e6b 2c20 746f 6b65 6e3d 6e61 6d65 2c20  nk, token=name, 
+0001d380: 2a2a 6368 756e 6b5f 6b77 6172 6773 290a  **chunk_kwargs).
+0001d390: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001d3a0: 726e 2068 616e 646c 655f 6f75 7428 6f75  rn handle_out(ou
+0001d3b0: 742c 2072 6573 756c 7429 0a20 2020 2020  t, result).     
+0001d3c0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001d3d0: 2020 2020 2023 2063 756d 756c 6174 6520       # cumulate 
+0001d3e0: 6561 6368 2070 6172 7469 7469 6f6e 730a  each partitions.
+0001d3f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0001d400: 3120 3d20 6622 7b73 656c 662e 5f74 6f6b  1 = f"{self._tok
+0001d410: 656e 5f70 7265 6669 787d 7b6f 705f 6e61  en_prefix}{op_na
+0001d420: 6d65 7d2d 6d61 7022 0a20 2020 2020 2020  me}-map".       
+0001d430: 2020 2020 2063 756d 7061 7274 203d 206d       cumpart = m
+0001d440: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
+0001d450: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001d460: 6875 6e6b 2c20 7365 6c66 2c20 746f 6b65  hunk, self, toke
+0001d470: 6e3d 6e61 6d65 312c 206d 6574 613d 7365  n=name1, meta=se
+0001d480: 6c66 2c20 2a2a 6368 756e 6b5f 6b77 6172  lf, **chunk_kwar
+0001d490: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
+0001d4a0: 0a0a 2020 2020 2020 2020 2020 2020 6e61  ..            na
+0001d4b0: 6d65 3220 3d20 6622 7b73 656c 662e 5f74  me2 = f"{self._t
+0001d4c0: 6f6b 656e 5f70 7265 6669 787d 7b6f 705f  oken_prefix}{op_
+0001d4d0: 6e61 6d65 7d2d 7461 6b65 2d6c 6173 7422  name}-take-last"
+0001d4e0: 0a20 2020 2020 2020 2020 2020 2063 756d  .            cum
+0001d4f0: 6c61 7374 203d 206d 6170 5f70 6172 7469  last = map_parti
+0001d500: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
+0001d510: 2020 2020 2020 205f 7461 6b65 5f6c 6173         _take_las
+0001d520: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001d530: 2020 2063 756d 7061 7274 2c0a 2020 2020     cumpart,.    
+0001d540: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+0001d550: 6e61 2c0a 2020 2020 2020 2020 2020 2020  na,.            
+0001d560: 2020 2020 6d65 7461 3d6d 6574 615f 7365      meta=meta_se
+0001d570: 7269 6573 5f63 6f6e 7374 7275 6374 6f72  ries_constructor
+0001d580: 2873 656c 6629 285b 5d2c 2064 7479 7065  (self)([], dtype
+0001d590: 3d22 666c 6f61 7422 292c 0a20 2020 2020  ="float"),.     
+0001d5a0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+0001d5b0: 3d6e 616d 6532 2c0a 2020 2020 2020 2020  =name2,.        
+0001d5c0: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0001d5d0: 2020 2073 7566 6669 7820 3d20 746f 6b65     suffix = toke
+0001d5e0: 6e69 7a65 2873 656c 6629 0a20 2020 2020  nize(self).     
+0001d5f0: 2020 2020 2020 206e 616d 6520 3d20 6622         name = f"
+0001d600: 7b73 656c 662e 5f74 6f6b 656e 5f70 7265  {self._token_pre
+0001d610: 6669 787d 7b6f 705f 6e61 6d65 7d2d 7b73  fix}{op_name}-{s
+0001d620: 7566 6669 787d 220a 2020 2020 2020 2020  uffix}".        
+0001d630: 2020 2020 636e 616d 6520 3d20 6622 7b73      cname = f"{s
+0001d640: 656c 662e 5f74 6f6b 656e 5f70 7265 6669  elf._token_prefi
+0001d650: 787d 7b6f 705f 6e61 6d65 7d2d 6375 6d2d  x}{op_name}-cum-
+0001d660: 6c61 7374 2d7b 7375 6666 6978 7d22 0a0a  last-{suffix}"..
+0001d670: 2020 2020 2020 2020 2020 2020 2320 6167              # ag
+0001d680: 6772 6567 6174 6520 6375 6d75 6c61 7465  gregate cumulate
+0001d690: 6420 7061 7274 6973 696f 6e73 2061 6e64  d partisions and
+0001d6a0: 2069 7473 2070 7265 7669 6f75 7320 6c61   its previous la
+0001d6b0: 7374 2065 6c65 6d65 6e74 0a20 2020 2020  st element.     
+0001d6c0: 2020 2020 2020 206c 6179 6572 203d 207b         layer = {
+0001d6d0: 7d0a 2020 2020 2020 2020 2020 2020 6c61  }.            la
+0001d6e0: 7965 725b 286e 616d 652c 2030 295d 203d  yer[(name, 0)] =
+0001d6f0: 2028 6375 6d70 6172 742e 5f6e 616d 652c   (cumpart._name,
+0001d700: 2030 290a 0a20 2020 2020 2020 2020 2020   0)..           
+0001d710: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0001d720: 312c 2073 656c 662e 6e70 6172 7469 7469  1, self.npartiti
+0001d730: 6f6e 7329 3a0a 2020 2020 2020 2020 2020  ons):.          
+0001d740: 2020 2020 2020 2320 7374 6f72 6520 6561        # store ea
+0001d750: 6368 2063 756d 756c 6174 6976 6520 7374  ch cumulative st
+0001d760: 6570 2074 6f20 6772 6170 6820 746f 2072  ep to graph to r
+0001d770: 6564 7563 6520 636f 6d70 7574 6174 696f  educe computatio
+0001d780: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+0001d790: 2020 6966 2069 203d 3d20 313a 0a20 2020    if i == 1:.   
+0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7b0: 206c 6179 6572 5b28 636e 616d 652c 2069   layer[(cname, i
+0001d7c0: 295d 203d 2028 6375 6d6c 6173 742e 5f6e  )] = (cumlast._n
+0001d7d0: 616d 652c 2069 202d 2031 290a 2020 2020  ame, i - 1).    
+0001d7e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001d7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d800: 2020 2020 2020 2320 6167 6772 6567 6174        # aggregat
+0001d810: 6520 7769 7468 2070 7265 7669 6f75 7320  e with previous 
+0001d820: 6375 6d75 6c61 7469 6f6e 2072 6573 756c  cumulation resul
+0001d830: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+0001d840: 2020 2020 2020 206c 6179 6572 5b28 636e         layer[(cn
+0001d850: 616d 652c 2069 295d 203d 2028 0a20 2020  ame, i)] = (.   
+0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d870: 2020 2020 206d 6574 686f 6473 2e5f 6375       methods._cu
+0001d880: 6d5f 6167 6772 6567 6174 655f 6170 706c  m_aggregate_appl
+0001d890: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0001d8a0: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
+0001d8b0: 6761 7465 2c0a 2020 2020 2020 2020 2020  gate,.          
+0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2863                (c
+0001d8d0: 6e61 6d65 2c20 6920 2d20 3129 2c0a 2020  name, i - 1),.  
+0001d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8f0: 2020 2020 2020 2863 756d 6c61 7374 2e5f        (cumlast._
+0001d900: 6e61 6d65 2c20 6920 2d20 3129 2c0a 2020  name, i - 1),.  
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0001d930: 2020 2020 6c61 7965 725b 286e 616d 652c      layer[(name,
+0001d940: 2069 295d 203d 2028 6167 6772 6567 6174   i)] = (aggregat
+0001d950: 652c 2028 6375 6d70 6172 742e 5f6e 616d  e, (cumpart._nam
+0001d960: 652c 2069 292c 2028 636e 616d 652c 2069  e, i), (cname, i
+0001d970: 2929 0a20 2020 2020 2020 2020 2020 2067  )).            g
+0001d980: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
+0001d990: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
+0001d9a0: 6374 696f 6e73 280a 2020 2020 2020 2020  ctions(.        
+0001d9b0: 2020 2020 2020 2020 6e61 6d65 2c20 6c61          name, la
+0001d9c0: 7965 722c 2064 6570 656e 6465 6e63 6965  yer, dependencie
+0001d9d0: 733d 5b63 756d 7061 7274 2c20 6375 6d6c  s=[cumpart, cuml
+0001d9e0: 6173 745d 0a20 2020 2020 2020 2020 2020  ast].           
+0001d9f0: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0001da00: 6573 756c 7420 3d20 6e65 775f 6464 5f6f  esult = new_dd_o
+0001da10: 626a 6563 7428 6772 6170 682c 206e 616d  bject(graph, nam
+0001da20: 652c 2063 6875 6e6b 2873 656c 662e 5f6d  e, chunk(self._m
+0001da30: 6574 6129 2c20 7365 6c66 2e64 6976 6973  eta), self.divis
+0001da40: 696f 6e73 290a 2020 2020 2020 2020 2020  ions).          
+0001da50: 2020 7265 7475 726e 2068 616e 646c 655f    return handle_
+0001da60: 6f75 7428 6f75 742c 2072 6573 756c 7429  out(out, result)
+0001da70: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+0001da80: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
+0001da90: 290a 2020 2020 6465 6620 6375 6d73 756d  ).    def cumsum
+0001daa0: 2873 656c 662c 2061 7869 733d 4e6f 6e65  (self, axis=None
+0001dab0: 2c20 736b 6970 6e61 3d54 7275 652c 2064  , skipna=True, d
+0001dac0: 7479 7065 3d4e 6f6e 652c 206f 7574 3d4e  type=None, out=N
+0001dad0: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+0001dae0: 7475 726e 2073 656c 662e 5f63 756d 5f61  turn self._cum_a
+0001daf0: 6767 280a 2020 2020 2020 2020 2020 2020  gg(.            
+0001db00: 2263 756d 7375 6d22 2c0a 2020 2020 2020  "cumsum",.      
+0001db10: 2020 2020 2020 6368 756e 6b3d 4d2e 6375        chunk=M.cu
+0001db20: 6d73 756d 2c0a 2020 2020 2020 2020 2020  msum,.          
+0001db30: 2020 6167 6772 6567 6174 653d 6d65 7468    aggregate=meth
+0001db40: 6f64 732e 6375 6d73 756d 5f61 6767 7265  ods.cumsum_aggre
+0001db50: 6761 7465 2c0a 2020 2020 2020 2020 2020  gate,.          
+0001db60: 2020 6178 6973 3d61 7869 732c 0a20 2020    axis=axis,.   
+0001db70: 2020 2020 2020 2020 2073 6b69 706e 613d           skipna=
+0001db80: 736b 6970 6e61 2c0a 2020 2020 2020 2020  skipna,.        
+0001db90: 2020 2020 6368 756e 6b5f 6b77 6172 6773      chunk_kwargs
+0001dba0: 3d64 6963 7428 6178 6973 3d61 7869 732c  =dict(axis=axis,
+0001dbb0: 2073 6b69 706e 613d 736b 6970 6e61 292c   skipna=skipna),
+0001dbc0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+0001dbd0: 3d6f 7574 2c0a 2020 2020 2020 2020 290a  =out,.        ).
+0001dbe0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+0001dbf0: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
+0001dc00: 0a20 2020 2064 6566 2063 756d 7072 6f64  .    def cumprod
+0001dc10: 2873 656c 662c 2061 7869 733d 4e6f 6e65  (self, axis=None
+0001dc20: 2c20 736b 6970 6e61 3d54 7275 652c 2064  , skipna=True, d
+0001dc30: 7479 7065 3d4e 6f6e 652c 206f 7574 3d4e  type=None, out=N
+0001dc40: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
+0001dc50: 7475 726e 2073 656c 662e 5f63 756d 5f61  turn self._cum_a
+0001dc60: 6767 280a 2020 2020 2020 2020 2020 2020  gg(.            
+0001dc70: 2263 756d 7072 6f64 222c 0a20 2020 2020  "cumprod",.     
+0001dc80: 2020 2020 2020 2063 6875 6e6b 3d4d 2e63         chunk=M.c
+0001dc90: 756d 7072 6f64 2c0a 2020 2020 2020 2020  umprod,.        
+0001dca0: 2020 2020 6167 6772 6567 6174 653d 6d65      aggregate=me
+0001dcb0: 7468 6f64 732e 6375 6d70 726f 645f 6167  thods.cumprod_ag
+0001dcc0: 6772 6567 6174 652c 0a20 2020 2020 2020  gregate,.       
+0001dcd0: 2020 2020 2061 7869 733d 6178 6973 2c0a       axis=axis,.
+0001dce0: 2020 2020 2020 2020 2020 2020 736b 6970              skip
+0001dcf0: 6e61 3d73 6b69 706e 612c 0a20 2020 2020  na=skipna,.     
+0001dd00: 2020 2020 2020 2063 6875 6e6b 5f6b 7761         chunk_kwa
+0001dd10: 7267 733d 6469 6374 2861 7869 733d 6178  rgs=dict(axis=ax
+0001dd20: 6973 2c20 736b 6970 6e61 3d73 6b69 706e  is, skipna=skipn
+0001dd30: 6129 2c0a 2020 2020 2020 2020 2020 2020  a),.            
+0001dd40: 6f75 743d 6f75 742c 0a20 2020 2020 2020  out=out,.       
+0001dd50: 2029 0a0a 2020 2020 4064 6572 6976 6564   )..    @derived
+0001dd60: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
+0001dd70: 6d65 290a 2020 2020 6465 6620 6375 6d6d  me).    def cumm
+0001dd80: 6178 2873 656c 662c 2061 7869 733d 4e6f  ax(self, axis=No
+0001dd90: 6e65 2c20 736b 6970 6e61 3d54 7275 652c  ne, skipna=True,
+0001dda0: 206f 7574 3d4e 6f6e 6529 3a0a 2020 2020   out=None):.    
+0001ddb0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001ddc0: 5f63 756d 5f61 6767 280a 2020 2020 2020  _cum_agg(.      
+0001ddd0: 2020 2020 2020 2263 756d 6d61 7822 2c0a        "cummax",.
+0001dde0: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+0001ddf0: 6b3d 4d2e 6375 6d6d 6178 2c0a 2020 2020  k=M.cummax,.    
+0001de00: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+0001de10: 653d 6d65 7468 6f64 732e 6375 6d6d 6178  e=methods.cummax
+0001de20: 5f61 6767 7265 6761 7465 2c0a 2020 2020  _aggregate,.    
+0001de30: 2020 2020 2020 2020 6178 6973 3d61 7869          axis=axi
+0001de40: 732c 0a20 2020 2020 2020 2020 2020 2073  s,.            s
+0001de50: 6b69 706e 613d 736b 6970 6e61 2c0a 2020  kipna=skipna,.  
+0001de60: 2020 2020 2020 2020 2020 6368 756e 6b5f            chunk_
+0001de70: 6b77 6172 6773 3d64 6963 7428 6178 6973  kwargs=dict(axis
+0001de80: 3d61 7869 732c 2073 6b69 706e 613d 736b  =axis, skipna=sk
+0001de90: 6970 6e61 292c 0a20 2020 2020 2020 2020  ipna),.         
+0001dea0: 2020 206f 7574 3d6f 7574 2c0a 2020 2020     out=out,.    
+0001deb0: 2020 2020 290a 0a20 2020 2040 6465 7269      )..    @deri
+0001dec0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
+0001ded0: 4672 616d 6529 0a20 2020 2064 6566 2063  Frame).    def c
+0001dee0: 756d 6d69 6e28 7365 6c66 2c20 6178 6973  ummin(self, axis
+0001def0: 3d4e 6f6e 652c 2073 6b69 706e 613d 5472  =None, skipna=Tr
+0001df00: 7565 2c20 6f75 743d 4e6f 6e65 293a 0a20  ue, out=None):. 
+0001df10: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001df20: 6c66 2e5f 6375 6d5f 6167 6728 0a20 2020  lf._cum_agg(.   
+0001df30: 2020 2020 2020 2020 2022 6375 6d6d 696e           "cummin
+0001df40: 222c 0a20 2020 2020 2020 2020 2020 2063  ",.            c
+0001df50: 6875 6e6b 3d4d 2e63 756d 6d69 6e2c 0a20  hunk=M.cummin,. 
+0001df60: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
+0001df70: 6761 7465 3d6d 6574 686f 6473 2e63 756d  gate=methods.cum
+0001df80: 6d69 6e5f 6167 6772 6567 6174 652c 0a20  min_aggregate,. 
+0001df90: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+0001dfa0: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+0001dfb0: 2020 736b 6970 6e61 3d73 6b69 706e 612c    skipna=skipna,
+0001dfc0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+0001dfd0: 6e6b 5f6b 7761 7267 733d 6469 6374 2861  nk_kwargs=dict(a
+0001dfe0: 7869 733d 6178 6973 2c20 736b 6970 6e61  xis=axis, skipna
+0001dff0: 3d73 6b69 706e 6129 2c0a 2020 2020 2020  =skipna),.      
+0001e000: 2020 2020 2020 6f75 743d 6f75 742c 0a20        out=out,. 
+0001e010: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0001e020: 6620 5f76 616c 6964 6174 655f 636f 6e64  f _validate_cond
+0001e030: 6974 696f 6e28 7365 6c66 2c20 636f 6e64  ition(self, cond
+0001e040: 293a 0a20 2020 2020 2020 2063 6f6e 645f  ):.        cond_
+0001e050: 7265 7320 3d20 636f 6e64 2873 656c 662e  res = cond(self.
+0001e060: 5f6d 6574 6129 2069 6620 6361 6c6c 6162  _meta) if callab
+0001e070: 6c65 2863 6f6e 6429 2065 6c73 6520 636f  le(cond) else co
+0001e080: 6e64 0a20 2020 2020 2020 2069 6620 6e6f  nd.        if no
+0001e090: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+0001e0a0: 6973 5f64 6173 6b5f 636f 6c6c 6563 7469  is_dask_collecti
+0001e0b0: 6f6e 2863 6f6e 645f 7265 7329 0a20 2020  on(cond_res).   
+0001e0c0: 2020 2020 2020 2020 206f 7220 6973 5f64           or is_d
+0001e0d0: 6174 6166 7261 6d65 5f6c 696b 6528 636f  ataframe_like(co
+0001e0e0: 6e64 5f72 6573 290a 2020 2020 2020 2020  nd_res).        
+0001e0f0: 2020 2020 6f72 2069 735f 7365 7269 6573      or is_series
+0001e100: 5f6c 696b 6528 636f 6e64 5f72 6573 290a  _like(cond_res).
+0001e110: 2020 2020 2020 2020 2020 2020 6f72 2069              or i
+0001e120: 735f 696e 6465 785f 6c69 6b65 2863 6f6e  s_index_like(con
+0001e130: 645f 7265 7329 0a20 2020 2020 2020 2029  d_res).        )
+0001e140: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001e150: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0001e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e170: 6622 436f 6e64 6974 696f 6e20 7368 6f75  f"Condition shou
+0001e180: 6c64 2062 6520 616e 206f 626a 6563 7420  ld be an object 
+0001e190: 7468 6174 2063 616e 2062 6520 616c 6967  that can be alig
+0001e1a0: 6e65 6420 7769 7468 207b 7365 6c66 2e5f  ned with {self._
+0001e1b0: 5f63 6c61 7373 5f5f 7d2c 2022 0a20 2020  _class__}, ".   
+0001e1c0: 2020 2020 2020 2020 2020 2020 2066 2220               f" 
+0001e1d0: 7768 6963 6820 696e 636c 7564 6573 2044  which includes D
+0001e1e0: 6173 6b20 6f72 2070 616e 6461 7320 636f  ask or pandas co
+0001e1f0: 6c6c 6563 7469 6f6e 732c 2044 6174 6146  llections, DataF
+0001e200: 7261 6d65 7320 6f72 2053 6572 6965 732c  rames or Series,
+0001e210: 206f 7220 6120 4361 6c6c 6162 6c65 2e22   or a Callable."
+0001e220: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0001e230: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+0001e240: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
+0001e250: 2020 2020 6465 6620 7768 6572 6528 7365      def where(se
+0001e260: 6c66 2c20 636f 6e64 2c20 6f74 6865 723d  lf, cond, other=
+0001e270: 6e70 2e6e 616e 293a 0a20 2020 2020 2020  np.nan):.       
+0001e280: 2023 2063 6f6e 6420 616e 6420 6f74 6865   # cond and othe
+0001e290: 7220 6d61 7920 6265 2064 6173 6b20 696e  r may be dask in
+0001e2a0: 7374 616e 6365 2c0a 2020 2020 2020 2020  stance,.        
+0001e2b0: 2320 7061 7373 696e 6720 6d61 705f 7061  # passing map_pa
+0001e2c0: 7274 6974 696f 6e73 2076 6961 206b 6579  rtitions via key
+0001e2d0: 776f 7264 2077 696c 6c20 6e6f 7420 6265  word will not be
+0001e2e0: 2061 6c69 676e 6564 0a20 2020 2020 2020   aligned.       
+0001e2f0: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
+0001e300: 636f 6e64 6974 696f 6e28 636f 6e64 290a  condition(cond).
+0001e310: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0001e320: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+0001e330: 7768 6572 652c 2073 656c 662c 2063 6f6e  where, self, con
+0001e340: 642c 206f 7468 6572 2c20 656e 666f 7263  d, other, enforc
+0001e350: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+0001e360: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
+0001e370: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
+0001e380: 6529 0a20 2020 2064 6566 206d 6173 6b28  e).    def mask(
+0001e390: 7365 6c66 2c20 636f 6e64 2c20 6f74 6865  self, cond, othe
+0001e3a0: 723d 6e70 2e6e 616e 293a 0a20 2020 2020  r=np.nan):.     
+0001e3b0: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
+0001e3c0: 655f 636f 6e64 6974 696f 6e28 636f 6e64  e_condition(cond
+0001e3d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001e3e0: 206d 6170 5f70 6172 7469 7469 6f6e 7328   map_partitions(
+0001e3f0: 4d2e 6d61 736b 2c20 7365 6c66 2c20 636f  M.mask, self, co
+0001e400: 6e64 2c20 6f74 6865 722c 2065 6e66 6f72  nd, other, enfor
+0001e410: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
+0001e420: 6529 0a0a 2020 2020 4064 6572 6976 6564  e)..    @derived
+0001e430: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
+0001e440: 6d65 290a 2020 2020 6465 6620 6e6f 746e  me).    def notn
+0001e450: 756c 6c28 7365 6c66 293a 0a20 2020 2020  ull(self):.     
+0001e460: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+0001e470: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+0001e480: 6e6f 746e 756c 6c2c 2065 6e66 6f72 6365  notnull, enforce
+0001e490: 5f6d 6574 6164 6174 613d 4661 6c73 6529  _metadata=False)
+0001e4a0: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+0001e4b0: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
+0001e4c0: 290a 2020 2020 6465 6620 6973 6e75 6c6c  ).    def isnull
+0001e4d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001e4e0: 7265 7475 726e 2073 656c 662e 6d61 705f  return self.map_
+0001e4f0: 7061 7274 6974 696f 6e73 284d 2e69 736e  partitions(M.isn
+0001e500: 756c 6c2c 2065 6e66 6f72 6365 5f6d 6574  ull, enforce_met
+0001e510: 6164 6174 613d 4661 6c73 6529 0a0a 2020  adata=False)..  
+0001e520: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+0001e530: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
+0001e540: 2020 6465 6620 6973 6e61 2873 656c 6629    def isna(self)
+0001e550: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001e560: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
+0001e570: 696f 6e73 284d 2e69 736e 612c 2065 6e66  ions(M.isna, enf
+0001e580: 6f72 6365 5f6d 6574 6164 6174 613d 4661  orce_metadata=Fa
+0001e590: 6c73 6529 0a0a 2020 2020 4064 6572 6976  lse)..    @deriv
+0001e5a0: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
+0001e5b0: 7261 6d65 290a 2020 2020 6465 6620 6973  rame).    def is
+0001e5c0: 696e 2873 656c 662c 2076 616c 7565 7329  in(self, values)
+0001e5d0: 3a0a 2020 2020 2020 2020 6966 2069 735f  :.        if is_
+0001e5e0: 6461 7461 6672 616d 655f 6c69 6b65 2873  dataframe_like(s
+0001e5f0: 656c 662e 5f6d 6574 6129 3a0a 2020 2020  elf._meta):.    
+0001e600: 2020 2020 2020 2020 2320 4461 7461 4672          # DataFr
+0001e610: 616d 652e 6973 696e 2064 6f65 7320 7765  ame.isin does we
+0001e620: 6972 6420 616c 6967 6e6d 656e 7420 7374  ird alignment st
+0001e630: 7566 660a 2020 2020 2020 2020 2020 2020  uff.            
+0001e640: 6261 645f 7479 7065 7320 3d20 285f 4672  bad_types = (_Fr
+0001e650: 616d 652c 2070 642e 5365 7269 6573 2c20  ame, pd.Series, 
+0001e660: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
+0001e670: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001e680: 2020 2020 2020 2020 6261 645f 7479 7065          bad_type
+0001e690: 7320 3d20 285f 4672 616d 652c 290a 2020  s = (_Frame,).  
+0001e6a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0001e6b0: 6e63 6528 7661 6c75 6573 2c20 6261 645f  nce(values, bad_
+0001e6c0: 7479 7065 7329 3a0a 2020 2020 2020 2020  types):.        
+0001e6d0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+0001e6e0: 6c65 6d65 6e74 6564 4572 726f 7228 2250  lementedError("P
+0001e6f0: 6173 7369 6e67 2061 2025 7220 746f 2060  assing a %r to `
+0001e700: 6973 696e 6022 2025 2074 7970 656e 616d  isin`" % typenam
+0001e710: 6528 7479 7065 2876 616c 7565 7329 2929  e(type(values)))
+0001e720: 0a20 2020 2020 2020 206d 6574 6120 3d20  .        meta = 
+0001e730: 7365 6c66 2e5f 6d65 7461 5f6e 6f6e 656d  self._meta_nonem
+0001e740: 7074 792e 6973 696e 2876 616c 7565 7329  pty.isin(values)
+0001e750: 0a20 2020 2020 2020 2023 2057 6520 7772  .        # We wr
+0001e760: 6170 2076 616c 7565 7320 696e 2061 2064  ap values in a d
+0001e770: 656c 6179 6564 2066 6f72 2074 776f 2072  elayed for two r
+0001e780: 6561 736f 6e73 3a0a 2020 2020 2020 2020  easons:.        
+0001e790: 2320 2d20 6176 6f69 6420 7365 7269 616c  # - avoid serial
+0001e7a0: 697a 696e 6720 6461 7461 2069 6e20 6576  izing data in ev
+0001e7b0: 6572 7920 7461 736b 0a20 2020 2020 2020  ery task.       
+0001e7c0: 2023 202d 2061 766f 6964 2063 6f73 7420   # - avoid cost 
+0001e7d0: 6f66 2074 7261 7665 7273 616c 206f 6620  of traversal of 
+0001e7e0: 6c61 7267 6520 6c69 7374 2069 6e20 6f70  large list in op
+0001e7f0: 7469 6d69 7a61 7469 6f6e 730a 2020 2020  timizations.    
+0001e800: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001e810: 6528 7661 6c75 6573 2c20 6c69 7374 293a  e(values, list):
+0001e820: 0a20 2020 2020 2020 2020 2020 2023 204d  .            # M
+0001e830: 6f74 6976 6174 6564 2062 7920 6874 7470  otivated by http
+0001e840: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f64  s://github.com/d
+0001e850: 6173 6b2f 6461 736b 2f69 7373 7565 732f  ask/dask/issues/
+0001e860: 3934 3131 2e20 2054 6869 7320 6170 7065  9411.  This appe
+0001e870: 6172 7320 746f 2062 650a 2020 2020 2020  ars to be.      
+0001e880: 2020 2020 2020 2320 6361 7573 6564 2062        # caused b
+0001e890: 7920 6874 7470 733a 2f2f 6769 7468 7562  y https://github
+0001e8a0: 2e63 6f6d 2f64 6173 6b2f 6469 7374 7269  .com/dask/distri
+0001e8b0: 6275 7465 642f 6973 7375 6573 2f36 3336  buted/issues/636
+0001e8c0: 382c 2061 6e64 2066 7572 7468 6572 0a20  8, and further. 
+0001e8d0: 2020 2020 2020 2020 2020 2023 2065 7861             # exa
+0001e8e0: 6365 7262 6174 6564 2062 7920 7468 6520  cerbated by the 
+0001e8f0: 6661 6374 2074 6861 7420 7468 6520 6c69  fact that the li
+0001e900: 7374 2063 6f6e 7461 696e 7320 6475 706c  st contains dupl
+0001e910: 6963 6174 6573 2e20 2054 6869 7320 6973  icates.  This is
+0001e920: 2061 2070 6174 6368 2075 6e74 696c 0a20   a patch until. 
+0001e930: 2020 2020 2020 2020 2020 2023 2077 6520             # we 
+0001e940: 6361 6e20 6372 6561 7465 2061 2062 6574  can create a bet
+0001e950: 7465 7220 6669 7820 666f 7220 5365 7269  ter fix for Seri
+0001e960: 616c 697a 6174 696f 6e2e 0a20 2020 2020  alization..     
+0001e970: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001e980: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001e990: 6573 203d 206c 6973 7428 7365 7428 7661  es = list(set(va
+0001e9a0: 6c75 6573 2929 0a20 2020 2020 2020 2020  lues)).         
+0001e9b0: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+0001e9c0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0001e9d0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001e9e0: 2020 2020 2020 6966 206e 6f74 2061 6e79        if not any
+0001e9f0: 2869 735f 6461 736b 5f63 6f6c 6c65 6374  (is_dask_collect
+0001ea00: 696f 6e28 7629 2066 6f72 2076 2069 6e20  ion(v) for v in 
+0001ea10: 7661 6c75 6573 293a 0a20 2020 2020 2020  values):.       
+0001ea20: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea40: 2020 7661 6c75 6573 203d 206e 702e 6672    values = np.fr
+0001ea50: 6f6d 6974 6572 2876 616c 7565 732c 2064  omiter(values, d
+0001ea60: 7479 7065 3d6f 626a 6563 7429 0a20 2020  type=object).   
+0001ea70: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001ea80: 6570 7420 5661 6c75 6545 7272 6f72 3a0a  ept ValueError:.
+0001ea90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eaa0: 2020 2020 2320 4e75 6d70 7920 312e 3233      # Numpy 1.23
+0001eab0: 2073 7570 706f 7274 7320 6372 6561 7469   supports creati
+0001eac0: 6e67 2061 7272 6179 7320 6f66 2069 7465  ng arrays of ite
+0001ead0: 7261 626c 6573 2c20 7768 696c 6520 6c6f  rables, while lo
+0001eae0: 7765 720a 2020 2020 2020 2020 2020 2020  wer.            
+0001eaf0: 2020 2020 2020 2020 2320 7665 7273 696f          # versio
+0001eb00: 6e20 312e 3231 2e78 2061 6e64 2031 2e32  n 1.21.x and 1.2
+0001eb10: 322e 7820 646f 206e 6f74 0a20 2020 2020  2.x do not.     
+0001eb20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001eb30: 6173 730a 2020 2020 2020 2020 7265 7475  ass.        retu
+0001eb40: 726e 2073 656c 662e 6d61 705f 7061 7274  rn self.map_part
+0001eb50: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
+0001eb60: 2020 2020 4d2e 6973 696e 2c20 6465 6c61      M.isin, dela
+0001eb70: 7965 6428 7661 6c75 6573 292c 206d 6574  yed(values), met
+0001eb80: 613d 6d65 7461 2c20 656e 666f 7263 655f  a=meta, enforce_
+0001eb90: 6d65 7461 6461 7461 3d46 616c 7365 0a20  metadata=False. 
+0001eba0: 2020 2020 2020 2029 0a0a 2020 2020 4064         )..    @d
+0001ebb0: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+0001ebc0: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+0001ebd0: 6620 6173 7479 7065 2873 656c 662c 2064  f astype(self, d
+0001ebe0: 7479 7065 293a 0a20 2020 2020 2020 2023  type):.        #
+0001ebf0: 2058 5858 3a20 5061 6e64 6173 2077 696c   XXX: Pandas wil
+0001ec00: 6c20 7365 6766 6175 6c74 2066 6f72 2065  l segfault for e
+0001ec10: 6d70 7479 2064 6174 6166 7261 6d65 7320  mpty dataframes 
+0001ec20: 7768 656e 2073 6574 7469 6e67 0a20 2020  when setting.   
+0001ec30: 2020 2020 2023 2063 6174 6567 6f72 6963       # categoric
+0001ec40: 616c 2064 7479 7065 732e 2054 6869 7320  al dtypes. This 
+0001ec50: 6f70 6572 6174 696f 6e20 6973 6e27 7420  operation isn't 
+0001ec60: 616c 6c6f 7765 6420 6375 7272 656e 746c  allowed currentl
+0001ec70: 7920 616e 7977 6179 2e20 5765 0a20 2020  y anyway. We.   
+0001ec80: 2020 2020 2023 2067 6574 2074 6865 206d       # get the m
+0001ec90: 6574 6164 6174 6120 7769 7468 2061 206e  etadata with a n
+0001eca0: 6f6e 2d65 6d70 7479 2066 7261 6d65 2074  on-empty frame t
+0001ecb0: 6f20 7468 726f 7720 7468 6520 6572 726f  o throw the erro
+0001ecc0: 7220 696e 7374 6561 6420 6f66 0a20 2020  r instead of.   
+0001ecd0: 2020 2020 2023 2073 6567 6661 756c 7469       # segfaulti
+0001ece0: 6e67 2e0a 2020 2020 2020 2020 6966 2028  ng..        if (
+0001ecf0: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+0001ed00: 6461 7461 6672 616d 655f 6c69 6b65 2873  dataframe_like(s
+0001ed10: 656c 662e 5f6d 6574 6129 0a20 2020 2020  elf._meta).     
+0001ed20: 2020 2020 2020 2061 6e64 206e 6f74 2068         and not h
+0001ed30: 6173 6174 7472 2864 7479 7065 2c20 2269  asattr(dtype, "i
+0001ed40: 7465 6d73 2229 0a20 2020 2020 2020 2020  tems").         
+0001ed50: 2020 2061 6e64 2069 7369 6e73 7461 6e63     and isinstanc
+0001ed60: 6528 7064 2e61 7069 2e74 7970 6573 2e70  e(pd.api.types.p
+0001ed70: 616e 6461 735f 6474 7970 6528 6474 7970  andas_dtype(dtyp
+0001ed80: 6529 2c20 7064 2e43 6174 6567 6f72 6963  e), pd.Categoric
+0001ed90: 616c 4474 7970 6529 0a20 2020 2020 2020  alDtype).       
+0001eda0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0001edb0: 6d65 7461 203d 2073 656c 662e 5f6d 6574  meta = self._met
+0001edc0: 615f 6e6f 6e65 6d70 7479 2e61 7374 7970  a_nonempty.astyp
+0001edd0: 6528 6474 7970 6529 0a20 2020 2020 2020  e(dtype).       
+0001ede0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001edf0: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
+0001ee00: 6d65 7461 2e61 7374 7970 6528 6474 7970  meta.astype(dtyp
+0001ee10: 6529 0a20 2020 2020 2020 2069 6620 6861  e).        if ha
+0001ee20: 7361 7474 7228 6474 7970 652c 2022 6974  sattr(dtype, "it
+0001ee30: 656d 7322 293a 0a20 2020 2020 2020 2020  ems"):.         
+0001ee40: 2020 2073 6574 5f75 6e6b 6e6f 776e 203d     set_unknown =
+0001ee50: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0001ee60: 2020 206b 0a20 2020 2020 2020 2020 2020     k.           
+0001ee70: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+0001ee80: 2064 7479 7065 2e69 7465 6d73 2829 0a20   dtype.items(). 
+0001ee90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001eea0: 6620 2869 7369 6e73 7461 6e63 6528 7064  f (isinstance(pd
+0001eeb0: 2e61 7069 2e74 7970 6573 2e70 616e 6461  .api.types.panda
+0001eec0: 735f 6474 7970 6528 7629 2c20 7064 2e43  s_dtype(v), pd.C
+0001eed0: 6174 6567 6f72 6963 616c 4474 7970 6529  ategoricalDtype)
+0001eee0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001eef0: 2020 616e 6420 6765 7461 7474 7228 762c    and getattr(v,
+0001ef00: 2022 6361 7465 676f 7269 6573 222c 204e   "categories", N
+0001ef10: 6f6e 6529 2069 7320 4e6f 6e65 0a20 2020  one) is None.   
+0001ef20: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0001ef30: 2020 2020 2020 206d 6574 6120 3d20 636c         meta = cl
+0001ef40: 6561 725f 6b6e 6f77 6e5f 6361 7465 676f  ear_known_catego
+0001ef50: 7269 6573 286d 6574 612c 2063 6f6c 733d  ries(meta, cols=
+0001ef60: 7365 745f 756e 6b6e 6f77 6e29 0a20 2020  set_unknown).   
+0001ef70: 2020 2020 2065 6c69 6620 280a 2020 2020       elif (.    
+0001ef80: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
+0001ef90: 6365 2870 642e 6170 692e 7479 7065 732e  ce(pd.api.types.
+0001efa0: 7061 6e64 6173 5f64 7479 7065 2864 7479  pandas_dtype(dty
+0001efb0: 7065 292c 2070 642e 4361 7465 676f 7269  pe), pd.Categori
+0001efc0: 6361 6c44 7479 7065 290a 2020 2020 2020  calDtype).      
+0001efd0: 2020 2920 616e 6420 6765 7461 7474 7228    ) and getattr(
+0001efe0: 6474 7970 652c 2022 6361 7465 676f 7269  dtype, "categori
+0001eff0: 6573 222c 204e 6f6e 6529 2069 7320 4e6f  es", None) is No
+0001f000: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001f010: 6d65 7461 203d 2063 6c65 6172 5f6b 6e6f  meta = clear_kno
+0001f020: 776e 5f63 6174 6567 6f72 6965 7328 6d65  wn_categories(me
+0001f030: 7461 290a 2020 2020 2020 2020 7265 7475  ta).        retu
+0001f040: 726e 2073 656c 662e 6d61 705f 7061 7274  rn self.map_part
+0001f050: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
+0001f060: 2020 2020 4d2e 6173 7479 7065 2c20 6474      M.astype, dt
+0001f070: 7970 653d 6474 7970 652c 206d 6574 613d  ype=dtype, meta=
+0001f080: 6d65 7461 2c20 656e 666f 7263 655f 6d65  meta, enforce_me
+0001f090: 7461 6461 7461 3d46 616c 7365 0a20 2020  tadata=False.   
+0001f0a0: 2020 2020 2029 0a0a 2020 2020 6966 206e       )..    if n
+0001f0b0: 6f74 2050 414e 4441 535f 4754 5f32 3030  ot PANDAS_GT_200
+0001f0c0: 3a0a 0a20 2020 2020 2020 2040 6465 7269  :..        @deri
+0001f0d0: 7665 645f 6672 6f6d 2870 642e 5365 7269  ved_from(pd.Seri
+0001f0e0: 6573 290a 2020 2020 2020 2020 6465 6620  es).        def 
+0001f0f0: 6170 7065 6e64 2873 656c 662c 206f 7468  append(self, oth
+0001f100: 6572 2c20 696e 7465 726c 6561 7665 5f70  er, interleave_p
+0001f110: 6172 7469 7469 6f6e 733d 4661 6c73 6529  artitions=False)
+0001f120: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001f130: 2050 414e 4441 535f 4754 5f31 3430 3a0a   PANDAS_GT_140:.
+0001f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f150: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+0001f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f170: 2020 2022 5468 6520 6672 616d 652e 6170     "The frame.ap
+0001f180: 7065 6e64 206d 6574 686f 6420 6973 2064  pend method is d
+0001f190: 6570 7265 6361 7465 6420 616e 6420 7769  eprecated and wi
+0001f1a0: 6c6c 2062 6520 7265 6d6f 7665 6420 6672  ll be removed fr
+0001f1b0: 6f6d 220a 2020 2020 2020 2020 2020 2020  om".            
+0001f1c0: 2020 2020 2020 2020 2264 6173 6b20 696e          "dask in
+0001f1d0: 2061 2066 7574 7572 6520 7665 7273 696f   a future versio
+0001f1e0: 6e2e 2055 7365 2064 6173 6b2e 6461 7461  n. Use dask.data
+0001f1f0: 6672 616d 652e 636f 6e63 6174 2069 6e73  frame.concat ins
+0001f200: 7465 6164 2e22 2c0a 2020 2020 2020 2020  tead.",.        
+0001f210: 2020 2020 2020 2020 2020 2020 4675 7475              Futu
+0001f220: 7265 5761 726e 696e 672c 0a20 2020 2020  reWarning,.     
+0001f230: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001f240: 2020 2020 2020 2020 2023 2062 6563 6175           # becau
+0001f250: 7365 2044 6174 6146 7261 6d65 2e61 7070  se DataFrame.app
+0001f260: 656e 6420 7769 6c6c 206f 7665 7272 6964  end will overrid
+0001f270: 6520 7468 6520 6d65 7468 6f64 2c0a 2020  e the method,.  
+0001f280: 2020 2020 2020 2020 2020 2320 7772 6170            # wrap
+0001f290: 2062 7920 7064 2e53 6572 6965 732e 6170   by pd.Series.ap
+0001f2a0: 7065 6e64 2064 6f63 7374 7269 6e67 0a20  pend docstring. 
+0001f2b0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0001f2c0: 6461 736b 2e64 6174 6166 7261 6d65 2e6d  dask.dataframe.m
+0001f2d0: 756c 7469 2069 6d70 6f72 7420 636f 6e63  ulti import conc
+0001f2e0: 6174 0a0a 2020 2020 2020 2020 2020 2020  at..            
+0001f2f0: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
+0001f300: 6865 722c 2028 6c69 7374 2c20 6469 6374  her, (list, dict
+0001f310: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0001f320: 2020 2020 6d73 6720 3d20 2261 7070 656e      msg = "appen
+0001f330: 6420 646f 6573 6e27 7420 7375 7070 6f72  d doesn't suppor
+0001f340: 7420 6c69 7374 206f 7220 6469 6374 2069  t list or dict i
+0001f350: 6e70 7574 220a 2020 2020 2020 2020 2020  nput".          
+0001f360: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+0001f370: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0001f380: 6d73 6729 0a0a 2020 2020 2020 2020 2020  msg)..          
+0001f390: 2020 7265 7475 726e 2063 6f6e 6361 7428    return concat(
+0001f3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f3b0: 205b 7365 6c66 2c20 6f74 6865 725d 2c20   [self, other], 
+0001f3c0: 6a6f 696e 3d22 6f75 7465 7222 2c20 696e  join="outer", in
+0001f3d0: 7465 726c 6561 7665 5f70 6172 7469 7469  terleave_partiti
+0001f3e0: 6f6e 733d 696e 7465 726c 6561 7665 5f70  ons=interleave_p
+0001f3f0: 6172 7469 7469 6f6e 730a 2020 2020 2020  artitions.      
+0001f400: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
+0001f410: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
+0001f420: 7269 6573 290a 2020 2020 6465 6620 646f  ries).    def do
+0001f430: 7428 7365 6c66 2c20 6f74 6865 722c 206d  t(self, other, m
+0001f440: 6574 613d 6e6f 5f64 6566 6175 6c74 293a  eta=no_default):
+0001f450: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001f460: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
+0001f470: 2c20 5f46 7261 6d65 293a 0a20 2020 2020  , _Frame):.     
+0001f480: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0001f490: 6545 7272 6f72 2822 5468 6520 7365 636f  eError("The seco
+0001f4a0: 6e64 206f 7065 7261 6e64 206d 7573 7420  nd operand must 
+0001f4b0: 6265 2061 2064 6173 6b20 6172 7261 7920  be a dask array 
+0001f4c0: 6f72 2064 6173 6b20 6461 7461 6672 616d  or dask datafram
+0001f4d0: 6522 290a 0a20 2020 2020 2020 2069 6620  e")..        if 
+0001f4e0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
+0001f4f0: 2c20 4461 7461 4672 616d 6529 3a0a 2020  , DataFrame):.  
+0001f500: 2020 2020 2020 2020 2020 7320 3d20 7365            s = se
+0001f510: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
+0001f520: 7328 4d2e 646f 742c 206f 7468 6572 2c20  s(M.dot, other, 
+0001f530: 746f 6b65 6e3d 2264 6f74 222c 206d 6574  token="dot", met
+0001f540: 613d 6d65 7461 290a 2020 2020 2020 2020  a=meta).        
+0001f550: 2020 2020 7265 7475 726e 2073 2e67 726f      return s.gro
+0001f560: 7570 6279 2862 793d 732e 696e 6465 7829  upby(by=s.index)
+0001f570: 2e61 7070 6c79 280a 2020 2020 2020 2020  .apply(.        
+0001f580: 2020 2020 2020 2020 6c61 6d62 6461 2078          lambda x
+0001f590: 3a20 782e 7375 6d28 736b 6970 6e61 3d46  : x.sum(skipna=F
+0001f5a0: 616c 7365 292c 206d 6574 613d 732e 5f6d  alse), meta=s._m
+0001f5b0: 6574 615f 6e6f 6e65 6d70 7479 0a20 2020  eta_nonempty.   
+0001f5c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001f5d0: 2020 2020 6465 6620 5f64 6f74 5f73 6572      def _dot_ser
+0001f5e0: 6965 7328 2a61 7267 732c 202a 2a6b 7761  ies(*args, **kwa
+0001f5f0: 7267 7329 3a0a 2020 2020 2020 2020 2020  rgs):.          
+0001f600: 2020 2320 2e73 756d 2829 2069 7320 696e    # .sum() is in
+0001f610: 766f 6b65 6420 6f6e 2065 6163 6820 7061  voked on each pa
+0001f620: 7274 6974 696f 6e20 6265 666f 7265 2062  rtition before b
+0001f630: 6569 6e67 2061 7070 6c69 6564 2074 6f20  eing applied to 
+0001f640: 616c 6c0a 2020 2020 2020 2020 2020 2020  all.            
+0001f650: 2320 7061 7274 6974 696f 6e73 2e20 5468  # partitions. Th
+0001f660: 6520 7265 7475 726e 2074 7970 6520 6973  e return type is
+0001f670: 2065 7870 6563 7465 6420 746f 2062 6520   expected to be 
+0001f680: 6120 7365 7269 6573 2c20 6e6f 7420 6120  a series, not a 
+0001f690: 6e75 6d70 7920 6f62 6a65 6374 0a20 2020  numpy object.   
+0001f6a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001f6b0: 6d65 7461 5f73 6572 6965 735f 636f 6e73  meta_series_cons
+0001f6c0: 7472 7563 746f 7228 7365 6c66 2928 4d2e  tructor(self)(M.
+0001f6d0: 646f 7428 2a61 7267 732c 202a 2a6b 7761  dot(*args, **kwa
+0001f6e0: 7267 7329 290a 0a20 2020 2020 2020 2072  rgs))..        r
+0001f6f0: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
+0001f700: 6172 7469 7469 6f6e 7328 5f64 6f74 5f73  artitions(_dot_s
+0001f710: 6572 6965 732c 206f 7468 6572 2c20 746f  eries, other, to
+0001f720: 6b65 6e3d 2264 6f74 222c 206d 6574 613d  ken="dot", meta=
+0001f730: 6d65 7461 292e 7375 6d28 0a20 2020 2020  meta).sum(.     
+0001f740: 2020 2020 2020 2073 6b69 706e 613d 4661         skipna=Fa
+0001f750: 6c73 650a 2020 2020 2020 2020 290a 0a20  lse.        ).. 
+0001f760: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+0001f770: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
+0001f780: 2020 2064 6566 2061 6c69 676e 2873 656c     def align(sel
+0001f790: 662c 206f 7468 6572 2c20 6a6f 696e 3d22  f, other, join="
+0001f7a0: 6f75 7465 7222 2c20 6178 6973 3d4e 6f6e  outer", axis=Non
+0001f7b0: 652c 2066 696c 6c5f 7661 6c75 653d 4e6f  e, fill_value=No
+0001f7c0: 6e65 293a 0a20 2020 2020 2020 206d 6574  ne):.        met
+0001f7d0: 6131 2c20 6d65 7461 3220 3d20 5f65 6d75  a1, meta2 = _emu
+0001f7e0: 6c61 7465 280a 2020 2020 2020 2020 2020  late(.          
+0001f7f0: 2020 4d2e 616c 6967 6e2c 2073 656c 662c    M.align, self,
+0001f800: 206f 7468 6572 2c20 6a6f 696e 2c20 6178   other, join, ax
+0001f810: 6973 3d61 7869 732c 2066 696c 6c5f 7661  is=axis, fill_va
+0001f820: 6c75 653d 6669 6c6c 5f76 616c 7565 0a20  lue=fill_value. 
+0001f830: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001f840: 2061 6c69 676e 6564 203d 2073 656c 662e   aligned = self.
+0001f850: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
+0001f860: 2020 2020 2020 2020 2020 2020 4d2e 616c              M.al
+0001f870: 6967 6e2c 0a20 2020 2020 2020 2020 2020  ign,.           
+0001f880: 206f 7468 6572 2c0a 2020 2020 2020 2020   other,.        
+0001f890: 2020 2020 6a6f 696e 3d6a 6f69 6e2c 0a20      join=join,. 
+0001f8a0: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+0001f8b0: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+0001f8c0: 2020 6669 6c6c 5f76 616c 7565 3d66 696c    fill_value=fil
+0001f8d0: 6c5f 7661 6c75 652c 0a20 2020 2020 2020  l_value,.       
+0001f8e0: 2020 2020 2065 6e66 6f72 6365 5f6d 6574       enforce_met
+0001f8f0: 6164 6174 613d 4661 6c73 652c 0a20 2020  adata=False,.   
+0001f900: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001f910: 746f 6b65 6e20 3d20 746f 6b65 6e69 7a65  token = tokenize
+0001f920: 2873 656c 662c 206f 7468 6572 2c20 6a6f  (self, other, jo
+0001f930: 696e 2c20 6178 6973 2c20 6669 6c6c 5f76  in, axis, fill_v
+0001f940: 616c 7565 290a 0a20 2020 2020 2020 206e  alue)..        n
+0001f950: 616d 6531 203d 2022 616c 6967 6e31 2d22  ame1 = "align1-"
+0001f960: 202b 2074 6f6b 656e 0a20 2020 2020 2020   + token.       
+0001f970: 2064 736b 3120 3d20 7b0a 2020 2020 2020   dsk1 = {.      
+0001f980: 2020 2020 2020 286e 616d 6531 2c20 6929        (name1, i)
+0001f990: 3a20 2867 6574 6974 656d 2c20 6b65 792c  : (getitem, key,
+0001f9a0: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0001f9b0: 666f 7220 692c 206b 6579 2069 6e20 656e  for i, key in en
+0001f9c0: 756d 6572 6174 6528 616c 6967 6e65 642e  umerate(aligned.
+0001f9d0: 5f5f 6461 736b 5f6b 6579 735f 5f28 2929  __dask_keys__())
+0001f9e0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+0001f9f0: 2020 2064 736b 312e 7570 6461 7465 2861     dsk1.update(a
+0001fa00: 6c69 676e 6564 2e64 6173 6b29 0a20 2020  ligned.dask).   
+0001fa10: 2020 2020 2072 6573 756c 7431 203d 206e       result1 = n
+0001fa20: 6577 5f64 645f 6f62 6a65 6374 2864 736b  ew_dd_object(dsk
+0001fa30: 312c 206e 616d 6531 2c20 6d65 7461 312c  1, name1, meta1,
+0001fa40: 2061 6c69 676e 6564 2e64 6976 6973 696f   aligned.divisio
+0001fa50: 6e73 290a 0a20 2020 2020 2020 206e 616d  ns)..        nam
+0001fa60: 6532 203d 2022 616c 6967 6e32 2d22 202b  e2 = "align2-" +
+0001fa70: 2074 6f6b 656e 0a20 2020 2020 2020 2064   token.        d
+0001fa80: 736b 3220 3d20 7b0a 2020 2020 2020 2020  sk2 = {.        
+0001fa90: 2020 2020 286e 616d 6532 2c20 6929 3a20      (name2, i): 
+0001faa0: 2867 6574 6974 656d 2c20 6b65 792c 2031  (getitem, key, 1
+0001fab0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0001fac0: 7220 692c 206b 6579 2069 6e20 656e 756d  r i, key in enum
+0001fad0: 6572 6174 6528 616c 6967 6e65 642e 5f5f  erate(aligned.__
+0001fae0: 6461 736b 5f6b 6579 735f 5f28 2929 0a20  dask_keys__()). 
+0001faf0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0001fb00: 2064 736b 322e 7570 6461 7465 2861 6c69   dsk2.update(ali
+0001fb10: 676e 6564 2e64 6173 6b29 0a20 2020 2020  gned.dask).     
+0001fb20: 2020 2072 6573 756c 7432 203d 206e 6577     result2 = new
+0001fb30: 5f64 645f 6f62 6a65 6374 2864 736b 322c  _dd_object(dsk2,
+0001fb40: 206e 616d 6532 2c20 6d65 7461 322c 2061   name2, meta2, a
+0001fb50: 6c69 676e 6564 2e64 6976 6973 696f 6e73  ligned.divisions
+0001fb60: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0001fb70: 6e20 7265 7375 6c74 312c 2072 6573 756c  n result1, resul
+0001fb80: 7432 0a0a 2020 2020 4064 6572 6976 6564  t2..    @derived
+0001fb90: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
+0001fba0: 6d65 290a 2020 2020 6465 6620 636f 6d62  me).    def comb
+0001fbb0: 696e 6528 7365 6c66 2c20 6f74 6865 722c  ine(self, other,
+0001fbc0: 2066 756e 632c 2066 696c 6c5f 7661 6c75   func, fill_valu
+0001fbd0: 653d 4e6f 6e65 2c20 6f76 6572 7772 6974  e=None, overwrit
+0001fbe0: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
+0001fbf0: 2072 6574 7572 6e20 7365 6c66 2e6d 6170   return self.map
+0001fc00: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
+0001fc10: 2020 2020 2020 2020 204d 2e63 6f6d 6269           M.combi
+0001fc20: 6e65 2c20 6f74 6865 722c 2066 756e 632c  ne, other, func,
+0001fc30: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
+0001fc40: 5f76 616c 7565 2c20 6f76 6572 7772 6974  _value, overwrit
+0001fc50: 653d 6f76 6572 7772 6974 650a 2020 2020  e=overwrite.    
+0001fc60: 2020 2020 290a 0a20 2020 2040 6465 7269      )..    @deri
+0001fc70: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
+0001fc80: 4672 616d 6529 0a20 2020 2064 6566 2063  Frame).    def c
+0001fc90: 6f6d 6269 6e65 5f66 6972 7374 2873 656c  ombine_first(sel
+0001fca0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+0001fcb0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+0001fcc0: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+0001fcd0: 636f 6d62 696e 655f 6669 7273 742c 206f  combine_first, o
+0001fce0: 7468 6572 290a 0a20 2020 2040 636c 6173  ther)..    @clas
+0001fcf0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0001fd00: 5f62 696e 645f 6f70 6572 6174 6f72 5f6d  _bind_operator_m
+0001fd10: 6574 686f 6428 636c 732c 206e 616d 652c  ethod(cls, name,
+0001fd20: 206f 702c 206f 7269 6769 6e61 6c3d 7064   op, original=pd
+0001fd30: 2e44 6174 6146 7261 6d65 293a 0a20 2020  .DataFrame):.   
+0001fd40: 2020 2020 2022 2222 6269 6e64 206f 7065       """bind ope
+0001fd50: 7261 746f 7220 6d65 7468 6f64 206c 696b  rator method lik
+0001fd60: 6520 4461 7461 4672 616d 652e 6164 6420  e DataFrame.add 
+0001fd70: 746f 2074 6869 7320 636c 6173 7322 2222  to this class"""
+0001fd80: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
+0001fd90: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+0001fda0: 6f72 0a0a 2020 2020 4064 6572 6976 6564  or..    @derived
+0001fdb0: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
+0001fdc0: 6d65 290a 2020 2020 6465 6620 7265 7361  me).    def resa
+0001fdd0: 6d70 6c65 2873 656c 662c 2072 756c 652c  mple(self, rule,
+0001fde0: 2063 6c6f 7365 643d 4e6f 6e65 2c20 6c61   closed=None, la
+0001fdf0: 6265 6c3d 4e6f 6e65 293a 0a20 2020 2020  bel=None):.     
+0001fe00: 2020 2066 726f 6d20 6461 736b 2e64 6174     from dask.dat
+0001fe10: 6166 7261 6d65 2e74 7365 7269 6573 2e72  aframe.tseries.r
+0001fe20: 6573 616d 706c 6520 696d 706f 7274 2052  esample import R
+0001fe30: 6573 616d 706c 6572 0a0a 2020 2020 2020  esampler..      
+0001fe40: 2020 7265 7475 726e 2052 6573 616d 706c    return Resampl
+0001fe50: 6572 2873 656c 662c 2072 756c 652c 2063  er(self, rule, c
+0001fe60: 6c6f 7365 643d 636c 6f73 6564 2c20 6c61  losed=closed, la
+0001fe70: 6265 6c3d 6c61 6265 6c29 0a0a 2020 2020  bel=label)..    
+0001fe80: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
+0001fe90: 2e44 6174 6146 7261 6d65 290a 2020 2020  .DataFrame).    
+0001fea0: 6465 6620 6669 7273 7428 7365 6c66 2c20  def first(self, 
+0001feb0: 6f66 6673 6574 293a 0a20 2020 2020 2020  offset):.       
+0001fec0: 2023 204c 6574 2070 616e 6461 7320 6572   # Let pandas er
+0001fed0: 726f 7220 6f6e 2062 6164 2061 7267 730a  ror on bad args.
+0001fee0: 2020 2020 2020 2020 7365 6c66 2e5f 6d65          self._me
+0001fef0: 7461 5f6e 6f6e 656d 7074 792e 6669 7273  ta_nonempty.firs
+0001ff00: 7428 6f66 6673 6574 290a 0a20 2020 2020  t(offset)..     
+0001ff10: 2020 2069 6620 6e6f 7420 7365 6c66 2e6b     if not self.k
+0001ff20: 6e6f 776e 5f64 6976 6973 696f 6e73 3a0a  nown_divisions:.
+0001ff30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001ff40: 6520 5661 6c75 6545 7272 6f72 2822 6066  e ValueError("`f
+0001ff50: 6972 7374 6020 6973 206e 6f74 2069 6d70  irst` is not imp
+0001ff60: 6c65 6d65 6e74 6564 2066 6f72 2075 6e6b  lemented for unk
+0001ff70: 6e6f 776e 2064 6976 6973 696f 6e73 2229  nown divisions")
+0001ff80: 0a0a 2020 2020 2020 2020 6f66 6673 6574  ..        offset
+0001ff90: 203d 2070 642e 7473 6572 6965 732e 6672   = pd.tseries.fr
+0001ffa0: 6571 7565 6e63 6965 732e 746f 5f6f 6666  equencies.to_off
+0001ffb0: 7365 7428 6f66 6673 6574 290a 2020 2020  set(offset).    
+0001ffc0: 2020 2020 6461 7465 203d 2073 656c 662e      date = self.
+0001ffd0: 6469 7669 7369 6f6e 735b 305d 202b 206f  divisions[0] + o
+0001ffe0: 6666 7365 740a 2020 2020 2020 2020 656e  ffset.        en
+0001fff0: 6420 3d20 7365 6c66 2e6c 6f63 2e5f 6765  d = self.loc._ge
+00020000: 745f 7061 7274 6974 696f 6e73 2864 6174  t_partitions(dat
+00020010: 6529 0a0a 2020 2020 2020 2020 6973 5f61  e)..        is_a
+00020020: 6e63 686f 7265 6420 3d20 6f66 6673 6574  nchored = offset
+00020030: 2e69 735f 616e 6368 6f72 6564 2829 0a0a  .is_anchored()..
 00020040: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-00020050: 7269 6768 742c 0a20 2020 2020 2020 2020  right,.         
-00020060: 2020 2054 7275 652c 0a20 2020 2020 2020     True,.       
-00020070: 2029 0a20 2020 2020 2020 2067 7261 7068   ).        graph
-00020080: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
-00020090: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
-000200a0: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
-000200b0: 7065 6e64 656e 6369 6573 3d5b 7365 6c66  pendencies=[self
-000200c0: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-000200d0: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-000200e0: 6772 6170 682c 206e 616d 652c 2073 656c  graph, name, sel
-000200f0: 662c 2064 6976 7329 0a0a 2020 2020 4064  f, divs)..    @d
-00020100: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
-00020110: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
-00020120: 6620 6c61 7374 2873 656c 662c 206f 6666  f last(self, off
-00020130: 7365 7429 3a0a 2020 2020 2020 2020 2320  set):.        # 
-00020140: 4c65 7420 7061 6e64 6173 2065 7272 6f72  Let pandas error
-00020150: 206f 6e20 6261 6420 6172 6773 0a20 2020   on bad args.   
-00020160: 2020 2020 2073 656c 662e 5f6d 6574 615f       self._meta_
-00020170: 6e6f 6e65 6d70 7479 2e66 6972 7374 286f  nonempty.first(o
-00020180: 6666 7365 7429 0a0a 2020 2020 2020 2020  ffset)..        
-00020190: 6966 206e 6f74 2073 656c 662e 6b6e 6f77  if not self.know
-000201a0: 6e5f 6469 7669 7369 6f6e 733a 0a20 2020  n_divisions:.   
-000201b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000201c0: 616c 7565 4572 726f 7228 2260 6c61 7374  alueError("`last
-000201d0: 6020 6973 206e 6f74 2069 6d70 6c65 6d65  ` is not impleme
-000201e0: 6e74 6564 2066 6f72 2075 6e6b 6e6f 776e  nted for unknown
-000201f0: 2064 6976 6973 696f 6e73 2229 0a0a 2020   divisions")..  
-00020200: 2020 2020 2020 6f66 6673 6574 203d 2070        offset = p
-00020210: 642e 7473 6572 6965 732e 6672 6571 7565  d.tseries.freque
-00020220: 6e63 6965 732e 746f 5f6f 6666 7365 7428  ncies.to_offset(
-00020230: 6f66 6673 6574 290a 2020 2020 2020 2020  offset).        
-00020240: 6461 7465 203d 2073 656c 662e 6469 7669  date = self.divi
-00020250: 7369 6f6e 735b 2d31 5d20 2d20 6f66 6673  sions[-1] - offs
-00020260: 6574 0a20 2020 2020 2020 2073 7461 7274  et.        start
-00020270: 203d 2073 656c 662e 6c6f 632e 5f67 6574   = self.loc._get
-00020280: 5f70 6172 7469 7469 6f6e 7328 6461 7465  _partitions(date
-00020290: 290a 0a20 2020 2020 2020 2069 6620 7374  )..        if st
-000202a0: 6172 7420 3d3d 2030 3a0a 2020 2020 2020  art == 0:.      
-000202b0: 2020 2020 2020 6469 7673 203d 2073 656c        divs = sel
-000202c0: 662e 6469 7669 7369 6f6e 730a 2020 2020  f.divisions.    
-000202d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000202e0: 2020 2020 2020 6469 7673 203d 2028 6461        divs = (da
-000202f0: 7465 2c29 202b 2073 656c 662e 6469 7669  te,) + self.divi
-00020300: 7369 6f6e 735b 7374 6172 7420 2b20 3120  sions[start + 1 
-00020310: 3a5d 0a0a 2020 2020 2020 2020 6e61 6d65  :]..        name
-00020320: 203d 2022 6c61 7374 2d22 202b 2074 6f6b   = "last-" + tok
-00020330: 656e 697a 6528 7365 6c66 2c20 6f66 6673  enize(self, offs
-00020340: 6574 290a 2020 2020 2020 2020 6473 6b20  et).        dsk 
-00020350: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-00020360: 286e 616d 652c 2069 202b 2031 293a 2028  (name, i + 1): (
-00020370: 7365 6c66 2e5f 6e61 6d65 2c20 6a20 2b20  self._name, j + 
-00020380: 3129 0a20 2020 2020 2020 2020 2020 2066  1).            f
-00020390: 6f72 2069 2c20 6a20 696e 2065 6e75 6d65  or i, j in enume
-000203a0: 7261 7465 2872 616e 6765 2873 7461 7274  rate(range(start
-000203b0: 2c20 7365 6c66 2e6e 7061 7274 6974 696f  , self.npartitio
-000203c0: 6e73 2929 0a20 2020 2020 2020 207d 0a20  ns)).        }. 
-000203d0: 2020 2020 2020 2064 736b 5b28 6e61 6d65         dsk[(name
-000203e0: 2c20 3029 5d20 3d20 280a 2020 2020 2020  , 0)] = (.      
-000203f0: 2020 2020 2020 6d65 7468 6f64 732e 626f        methods.bo
-00020400: 756e 6461 7279 5f73 6c69 6365 2c0a 2020  undary_slice,.  
-00020410: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
-00020420: 5f6e 616d 652c 2073 7461 7274 292c 0a20  _name, start),. 
-00020430: 2020 2020 2020 2020 2020 2064 6174 652c             date,
-00020440: 0a20 2020 2020 2020 2020 2020 204e 6f6e  .            Non
-00020450: 652c 0a20 2020 2020 2020 2020 2020 2054  e,.            T
-00020460: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00020470: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00020480: 290a 2020 2020 2020 2020 6772 6170 6820  ).        graph 
-00020490: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
-000204a0: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
-000204b0: 7328 6e61 6d65 2c20 6473 6b2c 2064 6570  s(name, dsk, dep
-000204c0: 656e 6465 6e63 6965 733d 5b73 656c 665d  endencies=[self]
-000204d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000204e0: 206e 6577 5f64 645f 6f62 6a65 6374 2867   new_dd_object(g
-000204f0: 7261 7068 2c20 6e61 6d65 2c20 7365 6c66  raph, name, self
-00020500: 2c20 6469 7673 290a 0a20 2020 2064 6566  , divs)..    def
-00020510: 206e 756e 6971 7565 5f61 7070 726f 7828   nunique_approx(
-00020520: 7365 6c66 2c20 7370 6c69 745f 6576 6572  self, split_ever
-00020530: 793d 4e6f 6e65 293a 0a20 2020 2020 2020  y=None):.       
-00020540: 2022 2222 4170 7072 6f78 696d 6174 6520   """Approximate 
-00020550: 6e75 6d62 6572 206f 6620 756e 6971 7565  number of unique
-00020560: 2072 6f77 732e 0a0a 2020 2020 2020 2020   rows...        
-00020570: 5468 6973 206d 6574 686f 6420 7573 6573  This method uses
-00020580: 2074 6865 2048 7970 6572 4c6f 674c 6f67   the HyperLogLog
-00020590: 2061 6c67 6f72 6974 686d 2066 6f72 2063   algorithm for c
-000205a0: 6172 6469 6e61 6c69 7479 0a20 2020 2020  ardinality.     
-000205b0: 2020 2065 7374 696d 6174 696f 6e20 746f     estimation to
-000205c0: 2063 6f6d 7075 7465 2074 6865 2061 7070   compute the app
-000205d0: 726f 7869 6d61 7465 206e 756d 6265 7220  roximate number 
-000205e0: 6f66 2075 6e69 7175 6520 726f 7773 2e0a  of unique rows..
-000205f0: 2020 2020 2020 2020 5468 6520 6170 7072          The appr
-00020600: 6f78 696d 6174 6520 6572 726f 7220 6973  oximate error is
-00020610: 2030 2e34 3036 252e 0a0a 2020 2020 2020   0.406%...      
-00020620: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00020630: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00020640: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
-00020650: 6572 7920 3a20 696e 742c 206f 7074 696f  ery : int, optio
-00020660: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-00020670: 4772 6f75 7020 7061 7274 6974 696f 6e73  Group partitions
-00020680: 2069 6e74 6f20 6772 6f75 7073 206f 6620   into groups of 
-00020690: 7468 6973 2073 697a 6520 7768 696c 6520  this size while 
-000206a0: 7065 7266 6f72 6d69 6e67 2061 0a20 2020  performing a.   
-000206b0: 2020 2020 2020 2020 2074 7265 652d 7265           tree-re
-000206c0: 6475 6374 696f 6e2e 2049 6620 7365 7420  duction. If set 
-000206d0: 746f 2046 616c 7365 2c20 6e6f 2074 7265  to False, no tre
-000206e0: 652d 7265 6475 6374 696f 6e20 7769 6c6c  e-reduction will
-000206f0: 2062 6520 7573 6564 2e0a 2020 2020 2020   be used..      
-00020700: 2020 2020 2020 4465 6661 756c 7420 6973        Default is
-00020710: 2038 2e0a 0a20 2020 2020 2020 2052 6574   8...        Ret
-00020720: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-00020730: 2d2d 2d2d 0a20 2020 2020 2020 2061 2066  ----.        a f
-00020740: 6c6f 6174 2072 6570 7265 7365 6e74 696e  loat representin
-00020750: 6720 7468 6520 6170 7072 6f78 696d 6174  g the approximat
-00020760: 6520 6e75 6d62 6572 206f 6620 656c 656d  e number of elem
-00020770: 656e 7473 0a20 2020 2020 2020 2022 2222  ents.        """
-00020780: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00020790: 736b 2e64 6174 6166 7261 6d65 2069 6d70  sk.dataframe imp
-000207a0: 6f72 7420 6879 7065 726c 6f67 6c6f 6720  ort hyperloglog 
-000207b0: 2023 2068 6572 6520 746f 2061 766f 6964   # here to avoid
-000207c0: 2063 6972 6375 6c61 7220 696d 706f 7274   circular import
-000207d0: 2069 7373 7565 730a 0a20 2020 2020 2020   issues..       
-000207e0: 2072 6574 7572 6e20 6163 6128 0a20 2020   return aca(.   
-000207f0: 2020 2020 2020 2020 205b 7365 6c66 5d2c           [self],
-00020800: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-00020810: 6e6b 3d68 7970 6572 6c6f 676c 6f67 2e63  nk=hyperloglog.c
-00020820: 6f6d 7075 7465 5f68 6c6c 5f61 7272 6179  ompute_hll_array
-00020830: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
-00020840: 6d62 696e 653d 6879 7065 726c 6f67 6c6f  mbine=hyperloglo
-00020850: 672e 7265 6475 6365 5f73 7461 7465 2c0a  g.reduce_state,.
-00020860: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
-00020870: 6567 6174 653d 6879 7065 726c 6f67 6c6f  egate=hyperloglo
-00020880: 672e 6573 7469 6d61 7465 5f63 6f75 6e74  g.estimate_count
-00020890: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-000208a0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-000208b0: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
-000208c0: 2020 2062 3d31 362c 0a20 2020 2020 2020     b=16,.       
-000208d0: 2020 2020 206d 6574 613d 666c 6f61 742c       meta=float,
-000208e0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000208f0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00020900: 6620 7661 6c75 6573 2873 656c 6629 3a0a  f values(self):.
-00020910: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00020920: 6e20 6120 6461 736b 2e61 7272 6179 206f  n a dask.array o
-00020930: 6620 7468 6520 7661 6c75 6573 206f 6620  f the values of 
-00020940: 7468 6973 2064 6174 6166 7261 6d65 0a0a  this dataframe..
-00020950: 2020 2020 2020 2020 5761 726e 696e 673a          Warning:
-00020960: 2054 6869 7320 6372 6561 7465 7320 6120   This creates a 
-00020970: 6461 736b 2e61 7272 6179 2077 6974 686f  dask.array witho
-00020980: 7574 2070 7265 6369 7365 2073 6861 7065  ut precise shape
-00020990: 2069 6e66 6f72 6d61 7469 6f6e 2e0a 2020   information..  
-000209a0: 2020 2020 2020 4f70 6572 6174 696f 6e73        Operations
-000209b0: 2074 6861 7420 6465 7065 6e64 206f 6e20   that depend on 
-000209c0: 7368 6170 6520 696e 666f 726d 6174 696f  shape informatio
-000209d0: 6e2c 206c 696b 6520 736c 6963 696e 6720  n, like slicing 
-000209e0: 6f72 2072 6573 6861 7069 6e67 2c0a 2020  or reshaping,.  
-000209f0: 2020 2020 2020 7769 6c6c 206e 6f74 2077        will not w
-00020a00: 6f72 6b2e 0a20 2020 2020 2020 2022 2222  ork..        """
-00020a10: 0a20 2020 2020 2020 2069 6620 6973 5f65  .        if is_e
-00020a20: 7874 656e 7369 6f6e 5f61 7272 6179 5f64  xtension_array_d
-00020a30: 7479 7065 2873 656c 662e 5f6d 6574 612e  type(self._meta.
-00020a40: 7661 6c75 6573 293a 0a20 2020 2020 2020  values):.       
-00020a50: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00020a60: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-00020a70: 2020 2020 2244 6173 6b20 6375 7272 656e      "Dask curren
-00020a80: 746c 7920 6861 7320 6c69 6d69 7465 6420  tly has limited 
-00020a90: 7375 7070 6f72 7420 666f 7220 636f 6e76  support for conv
-00020aa0: 6572 7469 6e67 2070 616e 6461 7320 6578  erting pandas ex
-00020ab0: 7465 6e73 696f 6e20 6474 7970 6573 2022  tension dtypes "
-00020ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020ad0: 2066 2274 6f20 6172 7261 7973 2e20 436f   f"to arrays. Co
-00020ae0: 6e76 6572 7469 6e67 207b 7365 6c66 2e5f  nverting {self._
-00020af0: 6d65 7461 2e76 616c 7565 732e 6474 7970  meta.values.dtyp
-00020b00: 657d 2074 6f20 6f62 6a65 6374 2064 7479  e} to object dty
-00020b10: 7065 2e22 2c0a 2020 2020 2020 2020 2020  pe.",.          
-00020b20: 2020 2020 2020 5573 6572 5761 726e 696e        UserWarnin
-00020b30: 672c 0a20 2020 2020 2020 2020 2020 2029  g,.            )
-00020b40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020b50: 7365 6c66 2e6d 6170 5f70 6172 7469 7469  self.map_partiti
-00020b60: 6f6e 7328 6d65 7468 6f64 732e 7661 6c75  ons(methods.valu
-00020b70: 6573 290a 0a20 2020 2064 6566 205f 7661  es)..    def _va
-00020b80: 6c69 6461 7465 5f63 6875 6e6b 7328 7365  lidate_chunks(se
-00020b90: 6c66 2c20 6172 722c 206c 656e 6774 6873  lf, arr, lengths
-00020ba0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
-00020bb0: 6461 736b 2e61 7272 6179 2e63 6f72 6520  dask.array.core 
-00020bc0: 696d 706f 7274 206e 6f72 6d61 6c69 7a65  import normalize
-00020bd0: 5f63 6875 6e6b 730a 0a20 2020 2020 2020  _chunks..       
-00020be0: 2069 6620 6973 696e 7374 616e 6365 286c   if isinstance(l
-00020bf0: 656e 6774 6873 2c20 5365 7175 656e 6365  engths, Sequence
-00020c00: 293a 0a20 2020 2020 2020 2020 2020 206c  ):.            l
-00020c10: 656e 6774 6873 203d 2074 7570 6c65 286c  engths = tuple(l
-00020c20: 656e 6774 6873 290a 0a20 2020 2020 2020  engths)..       
-00020c30: 2020 2020 2069 6620 6c65 6e28 6c65 6e67       if len(leng
-00020c40: 7468 7329 2021 3d20 7365 6c66 2e6e 7061  ths) != self.npa
-00020c50: 7274 6974 696f 6e73 3a0a 2020 2020 2020  rtitions:.      
-00020c60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00020c70: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00020c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c90: 2254 6865 206e 756d 6265 7220 6f66 2069  "The number of i
-00020ca0: 7465 6d73 2069 6e20 276c 656e 6774 6873  tems in 'lengths
-00020cb0: 2720 646f 6573 206e 6f74 206d 6174 6368  ' does not match
-00020cc0: 2074 6865 206e 756d 6265 7220 6f66 2022   the number of "
-00020cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020ce0: 2020 2020 2066 2270 6172 7469 7469 6f6e       f"partition
-00020cf0: 732e 207b 6c65 6e28 6c65 6e67 7468 7329  s. {len(lengths)
-00020d00: 7d20 213d 207b 7365 6c66 2e6e 7061 7274  } != {self.npart
-00020d10: 6974 696f 6e73 7d22 0a20 2020 2020 2020  itions}".       
-00020d20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00020d30: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00020d40: 6e64 696d 203d 3d20 313a 0a20 2020 2020  ndim == 1:.     
-00020d50: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-00020d60: 7320 3d20 6e6f 726d 616c 697a 655f 6368  s = normalize_ch
-00020d70: 756e 6b73 2828 6c65 6e67 7468 732c 2929  unks((lengths,))
-00020d80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00020d90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00020da0: 2020 2063 6875 6e6b 7320 3d20 6e6f 726d     chunks = norm
-00020db0: 616c 697a 655f 6368 756e 6b73 2828 6c65  alize_chunks((le
-00020dc0: 6e67 7468 732c 2028 6c65 6e28 7365 6c66  ngths, (len(self
-00020dd0: 2e63 6f6c 756d 6e73 292c 2929 290a 0a20  .columns),))).. 
-00020de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020df0: 6e20 6368 756e 6b73 0a20 2020 2020 2020  n chunks.       
-00020e00: 2065 6c69 6620 6c65 6e67 7468 7320 6973   elif lengths is
-00020e10: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00020e20: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00020e30: 7565 4572 726f 7228 6622 556e 6578 7065  ueError(f"Unexpe
-00020e40: 6374 6564 2076 616c 7565 2066 6f72 2027  cted value for '
-00020e50: 6c65 6e67 7468 7327 3a20 277b 6c65 6e67  lengths': '{leng
-00020e60: 7468 737d 2722 290a 0a20 2020 2020 2020  ths}'")..       
-00020e70: 2072 6574 7572 6e20 6172 722e 5f63 6875   return arr._chu
-00020e80: 6e6b 730a 0a20 2020 2064 6566 205f 6973  nks..    def _is
-00020e90: 5f69 6e64 6578 5f6c 6576 656c 5f72 6566  _index_level_ref
-00020ea0: 6572 656e 6365 2873 656c 662c 206b 6579  erence(self, key
-00020eb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00020ec0: 2020 2020 2020 2054 6573 7420 7768 6574         Test whet
-00020ed0: 6865 7220 6120 6b65 7920 6973 2061 6e20  her a key is an 
-00020ee0: 696e 6465 7820 6c65 7665 6c20 7265 6665  index level refe
-00020ef0: 7265 6e63 650a 0a20 2020 2020 2020 2054  rence..        T
-00020f00: 6f20 6265 2063 6f6e 7369 6465 7265 6420  o be considered 
-00020f10: 616e 2069 6e64 6578 206c 6576 656c 2072  an index level r
-00020f20: 6566 6572 656e 6365 2c20 606b 6579 6020  eference, `key` 
-00020f30: 6d75 7374 206d 6174 6368 2074 6865 2069  must match the i
-00020f40: 6e64 6578 206e 616d 650a 2020 2020 2020  ndex name.      
-00020f50: 2020 616e 6420 6d75 7374 204e 4f54 206d    and must NOT m
-00020f60: 6174 6368 2074 6865 206e 616d 6520 6f66  atch the name of
-00020f70: 2061 6e79 2063 6f6c 756d 6e20 2869 6620   any column (if 
-00020f80: 6120 6461 7461 6672 616d 6529 2e0a 2020  a dataframe)..  
-00020f90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00020fa0: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00020fb0: 2020 2020 2020 2073 656c 662e 696e 6465         self.inde
-00020fc0: 782e 6e61 6d65 2069 7320 6e6f 7420 4e6f  x.name is not No
-00020fd0: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
-00020fe0: 6e64 206e 6f74 2069 735f 6461 736b 5f63  nd not is_dask_c
-00020ff0: 6f6c 6c65 6374 696f 6e28 6b65 7929 0a20  ollection(key). 
-00021000: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-00021010: 6e70 2e69 7373 6361 6c61 7228 6b65 7929  np.isscalar(key)
-00021020: 206f 7220 6973 696e 7374 616e 6365 286b   or isinstance(k
-00021030: 6579 2c20 7475 706c 6529 290a 2020 2020  ey, tuple)).    
-00021040: 2020 2020 2020 2020 616e 6420 6b65 7920          and key 
-00021050: 3d3d 2073 656c 662e 696e 6465 782e 6e61  == self.index.na
-00021060: 6d65 0a20 2020 2020 2020 2020 2020 2061  me.            a
-00021070: 6e64 206b 6579 206e 6f74 2069 6e20 6765  nd key not in ge
-00021080: 7461 7474 7228 7365 6c66 2c20 2263 6f6c  tattr(self, "col
-00021090: 756d 6e73 222c 2028 2929 0a20 2020 2020  umns", ()).     
-000210a0: 2020 2029 0a0a 2020 2020 6465 6620 5f63     )..    def _c
-000210b0: 6f6e 7461 696e 735f 696e 6465 785f 6e61  ontains_index_na
-000210c0: 6d65 2873 656c 662c 2063 6f6c 756d 6e73  me(self, columns
-000210d0: 5f6f 725f 696e 6465 7829 3a0a 2020 2020  _or_index):.    
-000210e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000210f0: 5465 7374 2077 6865 7468 6572 2074 6865  Test whether the
-00021100: 2069 6e70 7574 2063 6f6e 7461 696e 7320   input contains 
-00021110: 6120 7265 6665 7265 6e63 6520 746f 2074  a reference to t
-00021120: 6865 2069 6e64 6578 206f 6620 7468 6520  he index of the 
-00021130: 4461 7461 4672 616d 652f 5365 7269 6573  DataFrame/Series
-00021140: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021150: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00021160: 6365 2863 6f6c 756d 6e73 5f6f 725f 696e  ce(columns_or_in
-00021170: 6465 782c 206c 6973 7429 3a0a 2020 2020  dex, list):.    
-00021180: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00021190: 6e79 2873 656c 662e 5f69 735f 696e 6465  ny(self._is_inde
-000211a0: 785f 6c65 7665 6c5f 7265 6665 7265 6e63  x_level_referenc
-000211b0: 6528 6e29 2066 6f72 206e 2069 6e20 636f  e(n) for n in co
-000211c0: 6c75 6d6e 735f 6f72 5f69 6e64 6578 290a  lumns_or_index).
-000211d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000211e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000211f0: 2073 656c 662e 5f69 735f 696e 6465 785f   self._is_index_
-00021200: 6c65 7665 6c5f 7265 6665 7265 6e63 6528  level_reference(
-00021210: 636f 6c75 6d6e 735f 6f72 5f69 6e64 6578  columns_or_index
-00021220: 290a 0a0a 6465 6620 5f72 6169 7365 5f69  )...def _raise_i
-00021230: 665f 6f62 6a65 6374 5f73 6572 6965 7328  f_object_series(
-00021240: 782c 2066 756e 636e 616d 6529 3a0a 2020  x, funcname):.  
-00021250: 2020 2222 220a 2020 2020 5574 696c 6974    """.    Utilit
-00021260: 7920 6675 6e63 7469 6f6e 2074 6f20 7261  y function to ra
-00021270: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
-00021280: 616e 206f 626a 6563 7420 636f 6c75 6d6e  an object column
-00021290: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-000212a0: 740a 2020 2020 6120 6365 7274 6169 6e20  t.    a certain 
-000212b0: 6f70 6572 6174 696f 6e20 6c69 6b65 2060  operation like `
-000212c0: 6d65 616e 602e 0a20 2020 2022 2222 0a20  mean`..    """. 
-000212d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-000212e0: 2878 2c20 5365 7269 6573 2920 616e 6420  (x, Series) and 
-000212f0: 6861 7361 7474 7228 782c 2022 6474 7970  hasattr(x, "dtyp
-00021300: 6522 293a 0a20 2020 2020 2020 2069 6620  e"):.        if 
-00021310: 782e 6474 7970 6520 3d3d 206f 626a 6563  x.dtype == objec
-00021320: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
-00021330: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00021340: 2260 2573 6020 6e6f 7420 7375 7070 6f72  "`%s` not suppor
-00021350: 7465 6420 7769 7468 206f 626a 6563 7420  ted with object 
-00021360: 7365 7269 6573 2220 2520 6675 6e63 6e61  series" % funcna
-00021370: 6d65 290a 2020 2020 2020 2020 656c 6966  me).        elif
-00021380: 2069 735f 7374 7269 6e67 5f64 7479 7065   is_string_dtype
-00021390: 2878 293a 0a20 2020 2020 2020 2020 2020  (x):.           
-000213a0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000213b0: 7228 2260 2573 6020 6e6f 7420 7375 7070  r("`%s` not supp
-000213c0: 6f72 7465 6420 7769 7468 2073 7472 696e  orted with strin
-000213d0: 6720 7365 7269 6573 2220 2520 6675 6e63  g series" % func
-000213e0: 6e61 6d65 290a 0a0a 636c 6173 7320 5365  name)...class Se
-000213f0: 7269 6573 285f 4672 616d 6529 3a0a 2020  ries(_Frame):.  
-00021400: 2020 2222 2250 6172 616c 6c65 6c20 5061    """Parallel Pa
-00021410: 6e64 6173 2053 6572 6965 730a 0a20 2020  ndas Series..   
-00021420: 2044 6f20 6e6f 7420 7573 6520 7468 6973   Do not use this
-00021430: 2063 6c61 7373 2064 6972 6563 746c 792e   class directly.
-00021440: 2020 496e 7374 6561 6420 7573 6520 6675    Instead use fu
-00021450: 6e63 7469 6f6e 7320 6c69 6b65 0a20 2020  nctions like.   
-00021460: 2060 6064 642e 7265 6164 5f63 7376 6060   ``dd.read_csv``
-00021470: 2c20 6060 6464 2e72 6561 645f 7061 7271  , ``dd.read_parq
-00021480: 7565 7460 602c 206f 7220 6060 6464 2e66  uet``, or ``dd.f
-00021490: 726f 6d5f 7061 6e64 6173 6060 2e0a 0a20  rom_pandas``... 
-000214a0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-000214b0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a0a 2020    ----------..  
-000214c0: 2020 6473 6b3a 2064 6963 740a 2020 2020    dsk: dict.    
-000214d0: 2020 2020 5468 6520 6461 736b 2067 7261      The dask gra
-000214e0: 7068 2074 6f20 636f 6d70 7574 6520 7468  ph to compute th
-000214f0: 6973 2053 6572 6965 730a 2020 2020 5f6e  is Series.    _n
-00021500: 616d 653a 2073 7472 0a20 2020 2020 2020  ame: str.       
-00021510: 2054 6865 206b 6579 2070 7265 6669 7820   The key prefix 
-00021520: 7468 6174 2073 7065 6369 6669 6573 2077  that specifies w
-00021530: 6869 6368 206b 6579 7320 696e 2074 6865  hich keys in the
-00021540: 2064 6173 6b20 636f 6d70 7269 7365 2074   dask comprise t
-00021550: 6869 730a 2020 2020 2020 2020 7061 7274  his.        part
-00021560: 6963 756c 6172 2053 6572 6965 730a 2020  icular Series.  
-00021570: 2020 6d65 7461 3a20 7061 6e64 6173 2e53    meta: pandas.S
-00021580: 6572 6965 730a 2020 2020 2020 2020 416e  eries.        An
-00021590: 2065 6d70 7479 2060 6070 616e 6461 732e   empty ``pandas.
-000215a0: 5365 7269 6573 6060 2077 6974 6820 6e61  Series`` with na
-000215b0: 6d65 732c 2064 7479 7065 732c 2061 6e64  mes, dtypes, and
-000215c0: 2069 6e64 6578 206d 6174 6368 696e 6720   index matching 
-000215d0: 7468 650a 2020 2020 2020 2020 6578 7065  the.        expe
-000215e0: 6374 6564 206f 7574 7075 742e 0a20 2020  cted output..   
-000215f0: 2064 6976 6973 696f 6e73 3a20 7475 706c   divisions: tupl
-00021600: 6520 6f66 2069 6e64 6578 2076 616c 7565  e of index value
-00021610: 730a 2020 2020 2020 2020 5661 6c75 6573  s.        Values
-00021620: 2061 6c6f 6e67 2077 6869 6368 2077 6520   along which we 
-00021630: 7061 7274 6974 696f 6e20 6f75 7220 626c  partition our bl
-00021640: 6f63 6b73 206f 6e20 7468 6520 696e 6465  ocks on the inde
-00021650: 780a 0a20 2020 2053 6565 2041 6c73 6f0a  x..    See Also.
-00021660: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00021670: 2064 6173 6b2e 6461 7461 6672 616d 652e   dask.dataframe.
-00021680: 4461 7461 4672 616d 650a 2020 2020 2222  DataFrame.    ""
-00021690: 220a 0a20 2020 205f 7061 7274 6974 696f  "..    _partitio
-000216a0: 6e5f 7479 7065 203d 2070 642e 5365 7269  n_type = pd.Seri
-000216b0: 6573 0a20 2020 205f 6973 5f70 6172 7469  es.    _is_parti
-000216c0: 7469 6f6e 5f74 7970 6520 3d20 7374 6174  tion_type = stat
-000216d0: 6963 6d65 7468 6f64 2869 735f 7365 7269  icmethod(is_seri
-000216e0: 6573 5f6c 696b 6529 0a20 2020 205f 746f  es_like).    _to
-000216f0: 6b65 6e5f 7072 6566 6978 203d 2022 7365  ken_prefix = "se
-00021700: 7269 6573 2d22 0a20 2020 205f 6163 6365  ries-".    _acce
-00021710: 7373 6f72 733a 2043 6c61 7373 5661 725b  ssors: ClassVar[
-00021720: 7365 745b 7374 725d 5d20 3d20 7365 7428  set[str]] = set(
-00021730: 290a 0a20 2020 2064 6566 205f 5f61 7272  )..    def __arr
-00021740: 6179 5f77 7261 705f 5f28 7365 6c66 2c20  ay_wrap__(self, 
-00021750: 6172 7261 792c 2063 6f6e 7465 7874 3d4e  array, context=N
-00021760: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
-00021770: 2069 7369 6e73 7461 6e63 6528 636f 6e74   isinstance(cont
-00021780: 6578 742c 2074 7570 6c65 2920 616e 6420  ext, tuple) and 
-00021790: 6c65 6e28 636f 6e74 6578 7429 203e 2030  len(context) > 0
-000217a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000217b0: 2069 7369 6e73 7461 6e63 6528 636f 6e74   isinstance(cont
-000217c0: 6578 745b 315d 5b30 5d2c 206e 702e 6e64  ext[1][0], np.nd
-000217d0: 6172 7261 7929 2061 6e64 2063 6f6e 7465  array) and conte
-000217e0: 7874 5b31 5d5b 305d 2e73 6861 7065 203d  xt[1][0].shape =
-000217f0: 3d20 2829 3a0a 2020 2020 2020 2020 2020  = ():.          
-00021800: 2020 2020 2020 696e 6465 7820 3d20 4e6f        index = No
-00021810: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-00021820: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00021830: 2020 2020 2069 6e64 6578 203d 2063 6f6e       index = con
-00021840: 7465 7874 5b31 5d5b 305d 2e69 6e64 6578  text[1][0].index
-00021850: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00021860: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00021870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021880: 696d 706f 7274 2069 6e73 7065 6374 0a0a  import inspect..
-00021890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218a0: 6d65 7468 6f64 5f6e 616d 6520 3d20 6622  method_name = f"
-000218b0: 607b 696e 7370 6563 742e 7374 6163 6b28  `{inspect.stack(
-000218c0: 295b 335d 5b33 5d7d 6022 0a20 2020 2020  )[3][3]}`".     
-000218d0: 2020 2020 2020 2065 7863 6570 7420 496e         except In
-000218e0: 6465 7845 7272 6f72 3a0a 2020 2020 2020  dexError:.      
-000218f0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00021900: 5f6e 616d 6520 3d20 2254 6869 7320 6d65  _name = "This me
-00021910: 7468 6f64 220a 2020 2020 2020 2020 2020  thod".          
-00021920: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-00021930: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
-00021940: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-00021950: 6d65 7468 6f64 5f6e 616d 657d 2069 7320  method_name} is 
-00021960: 6e6f 7420 696d 706c 656d 656e 7465 6420  not implemented 
-00021970: 666f 7220 6064 6173 6b2e 6461 7461 6672  for `dask.datafr
-00021980: 616d 652e 5365 7269 6573 602e 220a 2020  ame.Series`.".  
-00021990: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000219a0: 2020 2020 2072 6574 7572 6e20 6d65 7461       return meta
-000219b0: 5f73 6572 6965 735f 636f 6e73 7472 7563  _series_construc
-000219c0: 746f 7228 7365 6c66 2928 6172 7261 792c  tor(self)(array,
-000219d0: 2069 6e64 6578 3d69 6e64 6578 2c20 6e61   index=index, na
-000219e0: 6d65 3d73 656c 662e 6e61 6d65 290a 0a20  me=self.name).. 
-000219f0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00021a00: 2064 6566 2061 7865 7328 7365 6c66 293a   def axes(self):
-00021a10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00021a20: 5b73 656c 662e 696e 6465 785d 0a0a 2020  [self.index]..  
-00021a30: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00021a40: 6465 6620 6e61 6d65 2873 656c 6629 3a0a  def name(self):.
-00021a50: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00021a60: 656c 662e 5f6d 6574 612e 6e61 6d65 0a0a  elf._meta.name..
-00021a70: 2020 2020 406e 616d 652e 7365 7474 6572      @name.setter
-00021a80: 0a20 2020 2064 6566 206e 616d 6528 7365  .    def name(se
-00021a90: 6c66 2c20 6e61 6d65 293a 0a20 2020 2020  lf, name):.     
-00021aa0: 2020 2073 656c 662e 5f6d 6574 612e 6e61     self._meta.na
-00021ab0: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
-00021ac0: 2020 7265 6e61 6d65 6420 3d20 5f72 656e    renamed = _ren
-00021ad0: 616d 655f 6461 736b 2873 656c 662c 206e  ame_dask(self, n
-00021ae0: 616d 6529 0a20 2020 2020 2020 2023 2075  ame).        # u
-00021af0: 7064 6174 6520 6d79 7365 6c66 0a20 2020  pdate myself.   
-00021b00: 2020 2020 2073 656c 662e 6461 736b 203d       self.dask =
-00021b10: 2072 656e 616d 6564 2e64 6173 6b0a 2020   renamed.dask.  
-00021b20: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
-00021b30: 203d 2072 656e 616d 6564 2e5f 6e61 6d65   = renamed._name
-00021b40: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00021b50: 2020 2020 6465 6620 6e64 696d 2873 656c      def ndim(sel
-00021b60: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
-00021b70: 6574 7572 6e20 6469 6d65 6e73 696f 6e61  eturn dimensiona
-00021b80: 6c69 7479 2222 220a 2020 2020 2020 2020  lity""".        
-00021b90: 7265 7475 726e 2031 0a0a 2020 2020 4070  return 1..    @p
-00021ba0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00021bb0: 7368 6170 6528 7365 6c66 293a 0a20 2020  shape(self):.   
-00021bc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00021bd0: 2052 6574 7572 6e20 6120 7475 706c 6520   Return a tuple 
-00021be0: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
-00021bf0: 2064 696d 656e 7369 6f6e 616c 6974 7920   dimensionality 
-00021c00: 6f66 2061 2053 6572 6965 732e 0a0a 2020  of a Series...  
-00021c10: 2020 2020 2020 5468 6520 7369 6e67 6c65        The single
-00021c20: 2065 6c65 6d65 6e74 206f 6620 7468 6520   element of the 
-00021c30: 7475 706c 6520 6973 2061 2044 656c 6179  tuple is a Delay
-00021c40: 6564 2072 6573 756c 742e 0a0a 2020 2020  ed result...    
-00021c50: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-00021c60: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00021c70: 2020 2020 2020 3e3e 3e20 7365 7269 6573        >>> series
-00021c80: 2e73 6861 7065 2020 2320 646f 6374 6573  .shape  # doctes
-00021c90: 743a 202b 534b 4950 0a20 2020 2020 2020  t: +SKIP.       
-00021ca0: 2028 6464 2e53 6361 6c61 723c 7369 7a65   (dd.Scalar<size
-00021cb0: 2d61 672e 2e2e 2c20 6474 7970 653d 696e  -ag..., dtype=in
-00021cc0: 7436 343e 2c29 0a20 2020 2020 2020 2022  t64>,).        "
-00021cd0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00021ce0: 6e20 2873 656c 662e 7369 7a65 2c29 0a0a  n (self.size,)..
-00021cf0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00021d00: 2020 6465 6620 6474 7970 6528 7365 6c66    def dtype(self
-00021d10: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00021d20: 7475 726e 2064 6174 6120 7479 7065 2222  turn data type""
-00021d30: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00021d40: 2073 656c 662e 5f6d 6574 612e 6474 7970   self._meta.dtyp
-00021d50: 650a 0a20 2020 2064 7420 3d20 4361 6368  e..    dt = Cach
-00021d60: 6564 4163 6365 7373 6f72 2822 6474 222c  edAccessor("dt",
-00021d70: 2044 6174 6574 696d 6541 6363 6573 736f   DatetimeAccesso
-00021d80: 7229 0a0a 2020 2020 6361 7420 3d20 4361  r)..    cat = Ca
-00021d90: 6368 6564 4163 6365 7373 6f72 2822 6361  chedAccessor("ca
-00021da0: 7422 2c20 4361 7465 676f 7269 6361 6c41  t", CategoricalA
-00021db0: 6363 6573 736f 7229 0a0a 2020 2020 7374  ccessor)..    st
-00021dc0: 7220 3d20 4361 6368 6564 4163 6365 7373  r = CachedAccess
-00021dd0: 6f72 2822 7374 7222 2c20 5374 7269 6e67  or("str", String
-00021de0: 4163 6365 7373 6f72 290a 0a20 2020 2064  Accessor)..    d
-00021df0: 6566 205f 5f64 6972 5f5f 2873 656c 6629  ef __dir__(self)
-00021e00: 3a0a 2020 2020 2020 2020 6f20 3d20 7365  :.        o = se
-00021e10: 7428 6469 7228 7479 7065 2873 656c 6629  t(dir(type(self)
-00021e20: 2929 0a20 2020 2020 2020 206f 2e75 7064  )).        o.upd
-00021e30: 6174 6528 7365 6c66 2e5f 5f64 6963 745f  ate(self.__dict_
-00021e40: 5f29 0a20 2020 2020 2020 2023 2052 656d  _).        # Rem
-00021e50: 6f76 6520 7468 6520 6063 6174 6020 616e  ove the `cat` an
-00021e60: 6420 6073 7472 6020 6163 6365 7373 6f72  d `str` accessor
-00021e70: 7320 6966 206e 6f74 2061 7661 696c 6162  s if not availab
-00021e80: 6c65 2e20 5765 2063 616e 2774 0a20 2020  le. We can't.   
-00021e90: 2020 2020 2023 2064 6563 6964 6520 7468       # decide th
-00021ea0: 6973 2073 7461 7469 6361 6c6c 7920 666f  is statically fo
-00021eb0: 7220 7468 6520 6064 7460 2061 6363 6573  r the `dt` acces
-00021ec0: 736f 722c 2061 7320 6974 2077 6f72 6b73  sor, as it works
-00021ed0: 206f 6e0a 2020 2020 2020 2020 2320 6461   on.        # da
-00021ee0: 7465 7469 6d65 2d6c 696b 6520 7468 696e  tetime-like thin
-00021ef0: 6773 2061 7320 7765 6c6c 2e0a 2020 2020  gs as well..    
-00021f00: 2020 2020 666f 7220 6163 6365 7373 6f72      for accessor
-00021f10: 2069 6e20 5b22 6361 7422 2c20 2273 7472   in ["cat", "str
-00021f20: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00021f30: 6966 206e 6f74 2068 6173 6174 7472 2873  if not hasattr(s
-00021f40: 656c 662e 5f6d 6574 612c 2061 6363 6573  elf._meta, acces
-00021f50: 736f 7229 3a0a 2020 2020 2020 2020 2020  sor):.          
-00021f60: 2020 2020 2020 6f2e 7265 6d6f 7665 2861        o.remove(a
-00021f70: 6363 6573 736f 7229 0a20 2020 2020 2020  ccessor).       
-00021f80: 2072 6574 7572 6e20 6c69 7374 286f 290a   return list(o).
-00021f90: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00021fa0: 2020 2064 6566 206e 6279 7465 7328 7365     def nbytes(se
-00021fb0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00021fc0: 4e75 6d62 6572 206f 6620 6279 7465 7322  Number of bytes"
-00021fd0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00021fe0: 6e20 7365 6c66 2e72 6564 7563 7469 6f6e  n self.reduction
-00021ff0: 280a 2020 2020 2020 2020 2020 2020 6d65  (.            me
-00022000: 7468 6f64 732e 6e62 7974 6573 2c20 6e70  thods.nbytes, np
-00022010: 2e73 756d 2c20 746f 6b65 6e3d 226e 6279  .sum, token="nby
-00022020: 7465 7322 2c20 6d65 7461 3d69 6e74 2c20  tes", meta=int, 
-00022030: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
-00022040: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-00022050: 2064 6566 205f 7265 7072 5f64 6174 6128   def _repr_data(
-00022060: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00022070: 6574 7572 6e20 5f72 6570 725f 6461 7461  eturn _repr_data
-00022080: 5f73 6572 6965 7328 7365 6c66 2e5f 6d65  _series(self._me
-00022090: 7461 2c20 7365 6c66 2e5f 7265 7072 5f64  ta, self._repr_d
-000220a0: 6976 6973 696f 6e73 290a 0a20 2020 2064  ivisions)..    d
-000220b0: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-000220c0: 293a 0a20 2020 2020 2020 2022 2222 6861  ):.        """ha
-000220d0: 7665 2074 6f20 6f76 6572 7772 6974 6520  ve to overwrite 
-000220e0: 666f 6f74 6572 2222 220a 2020 2020 2020  footer""".      
-000220f0: 2020 6966 2073 656c 662e 6e61 6d65 2069    if self.name i
-00022100: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00022110: 2020 2020 2020 2020 666f 6f74 6572 203d          footer =
-00022120: 2066 224e 616d 653a 207b 7365 6c66 2e6e   f"Name: {self.n
-00022130: 616d 657d 2c20 6474 7970 653a 207b 7365  ame}, dtype: {se
-00022140: 6c66 2e64 7479 7065 7d22 0a20 2020 2020  lf.dtype}".     
-00022150: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00022160: 2020 2020 2066 6f6f 7465 7220 3d20 6622       footer = f"
-00022170: 6474 7970 653a 207b 7365 6c66 2e64 7479  dtype: {self.dty
-00022180: 7065 7d22 0a0a 2020 2020 2020 2020 7265  pe}"..        re
-00022190: 7475 726e 2022 2222 4461 736b 207b 6b6c  turn """Dask {kl
-000221a0: 6173 737d 2053 7472 7563 7475 7265 3a0a  ass} Structure:.
-000221b0: 7b64 6174 617d 0a7b 666f 6f74 6572 7d0a  {data}.{footer}.
-000221c0: 4461 736b 204e 616d 653a 207b 6e61 6d65  Dask Name: {name
-000221d0: 7d2c 207b 6c61 7965 7273 7d22 2222 2e66  }, {layers}""".f
-000221e0: 6f72 6d61 7428 0a20 2020 2020 2020 2020  ormat(.         
-000221f0: 2020 206b 6c61 7373 3d73 656c 662e 5f5f     klass=self.__
-00022200: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00022210: 2c0a 2020 2020 2020 2020 2020 2020 6461  ,.            da
-00022220: 7461 3d73 656c 662e 746f 5f73 7472 696e  ta=self.to_strin
-00022230: 6728 292c 0a20 2020 2020 2020 2020 2020  g(),.           
-00022240: 2066 6f6f 7465 723d 666f 6f74 6572 2c0a   footer=footer,.
-00022250: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00022260: 3d6b 6579 5f73 706c 6974 2873 656c 662e  =key_split(self.
-00022270: 5f6e 616d 6529 2c0a 2020 2020 2020 2020  _name),.        
-00022280: 2020 2020 6c61 7965 7273 3d6d 6179 6265      layers=maybe
-00022290: 5f70 6c75 7261 6c69 7a65 286c 656e 2873  _pluralize(len(s
-000222a0: 656c 662e 6461 736b 2e6c 6179 6572 7329  elf.dask.layers)
-000222b0: 2c20 2267 7261 7068 206c 6179 6572 2229  , "graph layer")
-000222c0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-000222d0: 2064 6566 2072 656e 616d 6528 7365 6c66   def rename(self
-000222e0: 2c20 696e 6465 783d 4e6f 6e65 2c20 696e  , index=None, in
-000222f0: 706c 6163 653d 4661 6c73 652c 2073 6f72  place=False, sor
-00022300: 7465 645f 696e 6465 783d 4661 6c73 6529  ted_index=False)
-00022310: 3a0a 2020 2020 2020 2020 2222 2241 6c74  :.        """Alt
-00022320: 6572 2053 6572 6965 7320 696e 6465 7820  er Series index 
-00022330: 6c61 6265 6c73 206f 7220 6e61 6d65 0a0a  labels or name..
-00022340: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
-00022350: 202f 2064 6963 7420 7661 6c75 6573 206d   / dict values m
-00022360: 7573 7420 6265 2075 6e69 7175 6520 2831  ust be unique (1
-00022370: 2d74 6f2d 3129 2e20 4c61 6265 6c73 206e  -to-1). Labels n
-00022380: 6f74 2063 6f6e 7461 696e 6564 2069 6e0a  ot contained in.
-00022390: 2020 2020 2020 2020 6120 6469 6374 202f          a dict /
-000223a0: 2053 6572 6965 7320 7769 6c6c 2062 6520   Series will be 
-000223b0: 6c65 6674 2061 732d 6973 2e20 4578 7472  left as-is. Extr
-000223c0: 6120 6c61 6265 6c73 206c 6973 7465 6420  a labels listed 
-000223d0: 646f 6e27 7420 7468 726f 7720 616e 0a20  don't throw an. 
-000223e0: 2020 2020 2020 2065 7272 6f72 2e0a 0a20         error... 
-000223f0: 2020 2020 2020 2041 6c74 6572 6e61 7469         Alternati
-00022400: 7665 6c79 2c20 6368 616e 6765 2060 6053  vely, change ``S
-00022410: 6572 6965 732e 6e61 6d65 6060 2077 6974  eries.name`` wit
-00022420: 6820 6120 7363 616c 6172 2076 616c 7565  h a scalar value
-00022430: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00022440: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-00022450: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00022460: 2069 6e64 6578 203a 2073 6361 6c61 722c   index : scalar,
-00022470: 2068 6173 6861 626c 6520 7365 7175 656e   hashable sequen
-00022480: 6365 2c20 6469 6374 2d6c 696b 6520 6f72  ce, dict-like or
-00022490: 2063 616c 6c61 626c 652c 206f 7074 696f   callable, optio
-000224a0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-000224b0: 4966 2064 6963 742d 6c69 6b65 206f 7220  If dict-like or 
-000224c0: 6361 6c6c 6162 6c65 2c20 7468 6520 7472  callable, the tr
-000224d0: 616e 7366 6f72 6d61 7469 6f6e 2069 7320  ansformation is 
-000224e0: 6170 706c 6965 6420 746f 2074 6865 0a20  applied to the. 
-000224f0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00022500: 2e20 5363 616c 6172 206f 7220 6861 7368  . Scalar or hash
-00022510: 6162 6c65 2073 6571 7565 6e63 652d 6c69  able sequence-li
-00022520: 6b65 2077 696c 6c20 616c 7465 7220 7468  ke will alter th
-00022530: 650a 2020 2020 2020 2020 2020 2020 6060  e.            ``
-00022540: 5365 7269 6573 2e6e 616d 6560 6020 6174  Series.name`` at
-00022550: 7472 6962 7574 652e 0a20 2020 2020 2020  tribute..       
-00022560: 2069 6e70 6c61 6365 203a 2062 6f6f 6c65   inplace : boole
-00022570: 616e 2c20 6465 6661 756c 7420 4661 6c73  an, default Fals
-00022580: 650a 2020 2020 2020 2020 2020 2020 5768  e.            Wh
-00022590: 6574 6865 7220 746f 2072 6574 7572 6e20  ether to return 
-000225a0: 6120 6e65 7720 5365 7269 6573 206f 7220  a new Series or 
-000225b0: 6d6f 6469 6679 2074 6869 7320 6f6e 6520  modify this one 
-000225c0: 696e 706c 6163 652e 0a20 2020 2020 2020  inplace..       
-000225d0: 2073 6f72 7465 645f 696e 6465 7820 3a20   sorted_index : 
-000225e0: 626f 6f6c 2c20 6465 6661 756c 7420 4661  bool, default Fa
-000225f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00022600: 4966 2074 7275 652c 2074 6865 206f 7574  If true, the out
-00022610: 7075 7420 6060 5365 7269 6573 6060 2077  put ``Series`` w
-00022620: 696c 6c20 6861 7665 206b 6e6f 776e 2064  ill have known d
-00022630: 6976 6973 696f 6e73 2069 6e66 6572 7265  ivisions inferre
-00022640: 640a 2020 2020 2020 2020 2020 2020 6672  d.            fr
-00022650: 6f6d 2074 6865 2069 6e70 7574 2073 6572  om the input ser
-00022660: 6965 7320 616e 6420 7468 6520 7472 616e  ies and the tran
-00022670: 7366 6f72 6d61 7469 6f6e 2e20 4967 6e6f  sformation. Igno
-00022680: 7265 6420 666f 720a 2020 2020 2020 2020  red for.        
-00022690: 2020 2020 6e6f 6e2d 6361 6c6c 6162 6c65      non-callable
-000226a0: 2f64 6963 742d 6c69 6b65 2060 6069 6e64  /dict-like ``ind
-000226b0: 6578 6060 206f 7220 7768 656e 2074 6865  ex`` or when the
-000226c0: 2069 6e70 7574 2073 6572 6965 7320 6861   input series ha
-000226d0: 730a 2020 2020 2020 2020 2020 2020 756e  s.            un
-000226e0: 6b6e 6f77 6e20 6469 7669 7369 6f6e 732e  known divisions.
-000226f0: 204e 6f74 6520 7468 6174 2074 6869 7320   Note that this 
-00022700: 6d61 7920 6f6e 6c79 2062 6520 7365 7420  may only be set 
-00022710: 746f 2060 6054 7275 6560 6020 6966 0a20  to ``True`` if. 
-00022720: 2020 2020 2020 2020 2020 2079 6f75 206b             you k
-00022730: 6e6f 7720 7468 6174 2074 6865 2074 7261  now that the tra
-00022740: 6e73 666f 726d 6564 2069 6e64 6578 2069  nsformed index i
-00022750: 7320 6d6f 6e6f 746f 6e69 6361 6c6c 7920  s monotonically 
-00022760: 696e 6372 6561 7369 6e67 2e20 4461 736b  increasing. Dask
-00022770: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00022780: 6c20 6368 6563 6b20 7468 6174 2074 7261  l check that tra
-00022790: 6e73 666f 726d 6564 2064 6976 6973 696f  nsformed divisio
-000227a0: 6e73 2061 7265 206d 6f6e 6f74 6f6e 6963  ns are monotonic
-000227b0: 2c20 6275 7420 6361 6e6e 6f74 0a20 2020  , but cannot.   
-000227c0: 2020 2020 2020 2020 2063 6865 636b 2061           check a
-000227d0: 6c6c 2074 6865 2076 616c 7565 7320 6265  ll the values be
-000227e0: 7477 6565 6e20 6469 7669 7369 6f6e 732c  tween divisions,
-000227f0: 2073 6f20 696e 636f 7272 6563 746c 7920   so incorrectly 
-00022800: 7365 7474 696e 6720 7468 6973 0a20 2020  setting this.   
-00022810: 2020 2020 2020 2020 2063 616e 2072 6573           can res
-00022820: 756c 7420 696e 2062 7567 732e 0a0a 2020  ult in bugs...  
-00022830: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00022840: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-00022850: 2020 2020 2020 7265 6e61 6d65 6420 3a20        renamed : 
-00022860: 5365 7269 6573 0a0a 2020 2020 2020 2020  Series..        
-00022870: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00022880: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00022890: 2020 7061 6e64 6173 2e53 6572 6965 732e    pandas.Series.
-000228a0: 7265 6e61 6d65 0a20 2020 2020 2020 2022  rename.        "
-000228b0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-000228c0: 7061 6e64 6173 2e61 7069 2e74 7970 6573  pandas.api.types
-000228d0: 2069 6d70 6f72 7420 6973 5f64 6963 745f   import is_dict_
-000228e0: 6c69 6b65 2c20 6973 5f6c 6973 745f 6c69  like, is_list_li
-000228f0: 6b65 2c20 6973 5f73 6361 6c61 720a 0a20  ke, is_scalar.. 
-00022900: 2020 2020 2020 2069 6d70 6f72 7420 6461         import da
-00022910: 736b 2e64 6174 6166 7261 6d65 2061 7320  sk.dataframe as 
-00022920: 6464 0a0a 2020 2020 2020 2020 6966 2069  dd..        if i
-00022930: 735f 7363 616c 6172 2869 6e64 6578 2920  s_scalar(index) 
-00022940: 6f72 2028 0a20 2020 2020 2020 2020 2020  or (.           
-00022950: 2069 735f 6c69 7374 5f6c 696b 6528 696e   is_list_like(in
-00022960: 6465 7829 0a20 2020 2020 2020 2020 2020  dex).           
-00022970: 2061 6e64 206e 6f74 2069 735f 6469 6374   and not is_dict
-00022980: 5f6c 696b 6528 696e 6465 7829 0a20 2020  _like(index).   
-00022990: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-000229a0: 2069 7369 6e73 7461 6e63 6528 696e 6465   isinstance(inde
-000229b0: 782c 2064 642e 5365 7269 6573 290a 2020  x, dd.Series).  
-000229c0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-000229d0: 2020 2020 2069 6620 696e 706c 6163 653a       if inplace:
-000229e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000229f0: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-00022a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a10: 2020 2020 2227 696e 706c 6163 6527 2061      "'inplace' a
-00022a20: 7267 756d 656e 7420 666f 7220 6461 736b  rgument for dask
-00022a30: 2073 6572 6965 7320 7769 6c6c 2062 6520   series will be 
-00022a40: 7265 6d6f 7665 6420 696e 2066 7574 7572  removed in futur
-00022a50: 6520 7665 7273 696f 6e73 222c 0a20 2020  e versions",.   
-00022a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a70: 2050 656e 6469 6e67 4465 7072 6563 6174   PendingDeprecat
-00022a80: 696f 6e57 6172 6e69 6e67 2c0a 2020 2020  ionWarning,.    
-00022a90: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00022aa0: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-00022ab0: 7365 6c66 2069 6620 696e 706c 6163 6520  self if inplace 
-00022ac0: 656c 7365 2073 656c 662e 636f 7079 2829  else self.copy()
-00022ad0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00022ae0: 2e6e 616d 6520 3d20 696e 6465 780a 2020  .name = index.  
-00022af0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00022b00: 2020 2020 2020 2020 7265 7320 3d20 7365          res = se
-00022b10: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-00022b20: 7328 4d2e 7265 6e61 6d65 2c20 696e 6465  s(M.rename, inde
-00022b30: 782c 2065 6e66 6f72 6365 5f6d 6574 6164  x, enforce_metad
-00022b40: 6174 613d 4661 6c73 6529 0a20 2020 2020  ata=False).     
-00022b50: 2020 2020 2020 2069 6620 7365 6c66 2e6b         if self.k
-00022b60: 6e6f 776e 5f64 6976 6973 696f 6e73 3a0a  nown_divisions:.
-00022b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022b80: 6966 2073 6f72 7465 645f 696e 6465 7820  if sorted_index 
-00022b90: 616e 6420 2863 616c 6c61 626c 6528 696e  and (callable(in
-00022ba0: 6465 7829 206f 7220 6973 5f64 6963 745f  dex) or is_dict_
-00022bb0: 6c69 6b65 2869 6e64 6578 2929 3a0a 2020  like(index)):.  
-00022bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022bd0: 2020 6f6c 6420 3d20 7064 2e53 6572 6965    old = pd.Serie
-00022be0: 7328 7261 6e67 6528 7365 6c66 2e6e 7061  s(range(self.npa
-00022bf0: 7274 6974 696f 6e73 202b 2031 292c 2069  rtitions + 1), i
-00022c00: 6e64 6578 3d73 656c 662e 6469 7669 7369  ndex=self.divisi
-00022c10: 6f6e 7329 0a20 2020 2020 2020 2020 2020  ons).           
-00022c20: 2020 2020 2020 2020 206e 6577 203d 206f           new = o
-00022c30: 6c64 2e72 656e 616d 6528 696e 6465 7829  ld.rename(index)
-00022c40: 2e69 6e64 6578 0a20 2020 2020 2020 2020  .index.         
-00022c50: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00022c60: 7420 6e65 772e 6973 5f6d 6f6e 6f74 6f6e  t new.is_monoton
-00022c70: 6963 5f69 6e63 7265 6173 696e 673a 0a20  ic_increasing:. 
-00022c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022c90: 2020 2020 2020 206d 7367 203d 2028 0a20         msg = (. 
-00022ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022cb0: 2020 2020 2020 2020 2020 2022 736f 7274             "sort
-00022cc0: 6564 5f69 6e64 6578 3d54 7275 652c 2062  ed_index=True, b
-00022cd0: 7574 2074 6865 2074 7261 6e73 666f 726d  ut the transform
-00022ce0: 6564 2069 6e64 6578 2022 0a20 2020 2020  ed index ".     
-00022cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d00: 2020 2020 2020 2022 6973 6e27 7420 6d6f         "isn't mo
-00022d10: 6e6f 746f 6e69 635f 696e 6372 6561 7369  notonic_increasi
-00022d20: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
-00022d30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00022d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00022d60: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-00022d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022d80: 7265 732e 5f64 6976 6973 696f 6e73 203d  res._divisions =
-00022d90: 2074 7570 6c65 286d 6574 686f 6473 2e74   tuple(methods.t
-00022da0: 6f6c 6973 7428 6e65 7729 290a 2020 2020  olist(new)).    
-00022db0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00022dc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022dd0: 2020 2020 2020 7265 7320 3d20 7265 732e        res = res.
-00022de0: 636c 6561 725f 6469 7669 7369 6f6e 7328  clear_divisions(
-00022df0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00022e00: 2069 6e70 6c61 6365 3a0a 2020 2020 2020   inplace:.      
-00022e10: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00022e20: 6173 6b20 3d20 7265 732e 6461 736b 0a20  ask = res.dask. 
-00022e30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00022e40: 656c 662e 5f6e 616d 6520 3d20 7265 732e  elf._name = res.
-00022e50: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
-00022e60: 2020 2020 2020 7365 6c66 2e5f 6469 7669        self._divi
-00022e70: 7369 6f6e 7320 3d20 7265 732e 6469 7669  sions = res.divi
-00022e80: 7369 6f6e 730a 2020 2020 2020 2020 2020  sions.          
-00022e90: 2020 2020 2020 7365 6c66 2e5f 6d65 7461        self._meta
-00022ea0: 203d 2072 6573 2e5f 6d65 7461 0a20 2020   = res._meta.   
-00022eb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00022ec0: 203d 2073 656c 660a 2020 2020 2020 2020   = self.        
-00022ed0: 7265 7475 726e 2072 6573 0a0a 2020 2020  return res..    
-00022ee0: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-00022ef0: 2e53 6572 6965 7329 0a20 2020 2064 6566  .Series).    def
-00022f00: 2072 6f75 6e64 2873 656c 662c 2064 6563   round(self, dec
-00022f10: 696d 616c 733d 3029 3a0a 2020 2020 2020  imals=0):.      
-00022f20: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
-00022f30: 6528 4d2e 726f 756e 642c 2073 656c 662c  e(M.round, self,
-00022f40: 2064 6563 696d 616c 7329 0a0a 2020 2020   decimals)..    
-00022f50: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-00022f60: 2e53 6572 6965 7329 0a20 2020 2064 6566  .Series).    def
-00022f70: 2074 6f5f 7469 6d65 7374 616d 7028 7365   to_timestamp(se
-00022f80: 6c66 2c20 6672 6571 3d4e 6f6e 652c 2068  lf, freq=None, h
-00022f90: 6f77 3d22 7374 6172 7422 2c20 6178 6973  ow="start", axis
-00022fa0: 3d30 293a 0a20 2020 2020 2020 2064 6620  =0):.        df 
-00022fb0: 3d20 656c 656d 7769 7365 284d 2e74 6f5f  = elemwise(M.to_
-00022fc0: 7469 6d65 7374 616d 702c 2073 656c 662c  timestamp, self,
-00022fd0: 2066 7265 712c 2068 6f77 2c20 6178 6973   freq, how, axis
-00022fe0: 290a 2020 2020 2020 2020 6466 2e64 6976  ).        df.div
-00022ff0: 6973 696f 6e73 203d 2074 7570 6c65 2870  isions = tuple(p
-00023000: 642e 496e 6465 7828 7365 6c66 2e64 6976  d.Index(self.div
-00023010: 6973 696f 6e73 292e 746f 5f74 696d 6573  isions).to_times
-00023020: 7461 6d70 2866 7265 713d 6672 6571 2c20  tamp(freq=freq, 
-00023030: 686f 773d 686f 7729 290a 2020 2020 2020  how=how)).      
-00023040: 2020 7265 7475 726e 2064 660a 0a20 2020    return df..   
-00023050: 2064 6566 2071 7561 6e74 696c 6528 7365   def quantile(se
-00023060: 6c66 2c20 713d 302e 352c 206d 6574 686f  lf, q=0.5, metho
-00023070: 643d 2264 6566 6175 6c74 2229 3a0a 2020  d="default"):.  
-00023080: 2020 2020 2020 2222 2241 7070 726f 7869        """Approxi
-00023090: 6d61 7465 2071 7561 6e74 696c 6573 206f  mate quantiles o
-000230a0: 6620 5365 7269 6573 0a0a 2020 2020 2020  f Series..      
-000230b0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-000230c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-000230d0: 2020 2020 2020 2020 7120 3a20 6c69 7374          q : list
-000230e0: 2f61 7272 6179 206f 6620 666c 6f61 7473  /array of floats
-000230f0: 2c20 6465 6661 756c 7420 302e 3520 2835  , default 0.5 (5
-00023100: 3025 290a 2020 2020 2020 2020 2020 2020  0%).            
-00023110: 4974 6572 6162 6c65 206f 6620 6e75 6d62  Iterable of numb
-00023120: 6572 7320 7261 6e67 696e 6720 6672 6f6d  ers ranging from
-00023130: 2030 2074 6f20 3120 666f 7220 7468 6520   0 to 1 for the 
-00023140: 6465 7369 7265 6420 7175 616e 7469 6c65  desired quantile
-00023150: 730a 2020 2020 2020 2020 6d65 7468 6f64  s.        method
-00023160: 203a 207b 2764 6566 6175 6c74 272c 2027   : {'default', '
-00023170: 7464 6967 6573 7427 2c20 2764 6173 6b27  tdigest', 'dask'
-00023180: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
-00023190: 2020 2020 2020 2020 5768 6174 206d 6574          What met
-000231a0: 686f 6420 746f 2075 7365 2e20 4279 2064  hod to use. By d
-000231b0: 6566 6175 6c74 2077 696c 6c20 7573 6520  efault will use 
-000231c0: 6461 736b 2773 2069 6e74 6572 6e61 6c20  dask's internal 
-000231d0: 6375 7374 6f6d 0a20 2020 2020 2020 2020  custom.         
-000231e0: 2020 2061 6c67 6f72 6974 686d 2028 6060     algorithm (``
-000231f0: 2764 6173 6b27 6060 292e 2020 4966 2073  'dask'``).  If s
-00023200: 6574 2074 6f20 6060 2774 6469 6765 7374  et to ``'tdigest
-00023210: 2760 6020 7769 6c6c 2075 7365 2074 6469  '`` will use tdi
-00023220: 6765 7374 0a20 2020 2020 2020 2020 2020  gest.           
-00023230: 2066 6f72 2066 6c6f 6174 7320 616e 6420   for floats and 
-00023240: 696e 7473 2061 6e64 2066 616c 6c62 6163  ints and fallbac
-00023250: 6b20 746f 2074 6865 2060 6027 6461 736b  k to the ``'dask
-00023260: 2760 6020 6f74 6865 7277 6973 652e 0a20  '`` otherwise.. 
-00023270: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00023280: 2020 2072 6574 7572 6e20 7175 616e 7469     return quanti
-00023290: 6c65 2873 656c 662c 2071 2c20 6d65 7468  le(self, q, meth
-000232a0: 6f64 3d6d 6574 686f 6429 0a0a 2020 2020  od=method)..    
-000232b0: 6465 6620 6d65 6469 616e 5f61 7070 726f  def median_appro
-000232c0: 7869 6d61 7465 2873 656c 662c 206d 6574  ximate(self, met
-000232d0: 686f 643d 2264 6566 6175 6c74 2229 3a0a  hod="default"):.
-000232e0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-000232f0: 6e20 7468 6520 6170 7072 6f78 696d 6174  n the approximat
-00023300: 6520 6d65 6469 616e 206f 6620 7468 6520  e median of the 
-00023310: 7661 6c75 6573 206f 7665 7220 7468 6520  values over the 
-00023320: 7265 7175 6573 7465 6420 6178 6973 2e0a  requested axis..
-00023330: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00023340: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00023350: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206d  ------.        m
-00023360: 6574 686f 6420 3a20 7b27 6465 6661 756c  ethod : {'defaul
-00023370: 7427 2c20 2774 6469 6765 7374 272c 2027  t', 'tdigest', '
-00023380: 6461 736b 277d 2c20 6f70 7469 6f6e 616c  dask'}, optional
-00023390: 0a20 2020 2020 2020 2020 2020 2057 6861  .            Wha
-000233a0: 7420 6d65 7468 6f64 2074 6f20 7573 652e  t method to use.
-000233b0: 2042 7920 6465 6661 756c 7420 7769 6c6c   By default will
-000233c0: 2075 7365 2044 6173 6b27 7320 696e 7465   use Dask's inte
-000233d0: 726e 616c 2063 7573 746f 6d0a 2020 2020  rnal custom.    
-000233e0: 2020 2020 2020 2020 616c 676f 7269 7468          algorith
-000233f0: 6d20 2860 6022 6461 736b 2260 6029 2e20  m (``"dask"``). 
-00023400: 2049 6620 7365 7420 746f 2060 6022 7464   If set to ``"td
-00023410: 6967 6573 7422 6060 2077 696c 6c20 7573  igest"`` will us
-00023420: 6520 7464 6967 6573 740a 2020 2020 2020  e tdigest.      
-00023430: 2020 2020 2020 666f 7220 666c 6f61 7473        for floats
-00023440: 2061 6e64 2069 6e74 7320 616e 6420 6661   and ints and fa
-00023450: 6c6c 6261 636b 2074 6f20 7468 6520 6060  llback to the ``
-00023460: 2264 6173 6b22 6060 206f 7468 6572 7769  "dask"`` otherwi
-00023470: 7365 2e0a 2020 2020 2020 2020 2222 220a  se..        """.
-00023480: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00023490: 656c 662e 7175 616e 7469 6c65 2871 3d30  elf.quantile(q=0
-000234a0: 2e35 2c20 6d65 7468 6f64 3d6d 6574 686f  .5, method=metho
-000234b0: 6429 0a0a 2020 2020 4064 6572 6976 6564  d)..    @derived
-000234c0: 5f66 726f 6d28 7064 2e53 6572 6965 7329  _from(pd.Series)
-000234d0: 0a20 2020 2064 6566 206d 6564 6961 6e28  .    def median(
-000234e0: 7365 6c66 2c20 6d65 7468 6f64 3d22 6465  self, method="de
-000234f0: 6661 756c 7422 293a 0a20 2020 2020 2020  fault"):.       
-00023500: 2069 6620 7365 6c66 2e6e 7061 7274 6974   if self.npartit
-00023510: 696f 6e73 203d 3d20 313a 0a20 2020 2020  ions == 1:.     
-00023520: 2020 2020 2020 2023 2043 616e 2070 726f         # Can pro
-00023530: 7669 6465 2061 6e20 6578 6163 7420 6d65  vide an exact me
-00023540: 6469 616e 2069 6e20 7468 6573 6520 6361  dian in these ca
-00023550: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
-00023560: 7265 7475 726e 2073 656c 662e 6d65 6469  return self.medi
-00023570: 616e 5f61 7070 726f 7869 6d61 7465 286d  an_approximate(m
-00023580: 6574 686f 643d 6d65 7468 6f64 290a 2020  ethod=method).  
-00023590: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
-000235a0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
-000235b0: 0a20 2020 2020 2020 2020 2020 2022 4461  .            "Da
-000235c0: 736b 2064 6f65 736e 2774 2069 6d70 6c65  sk doesn't imple
-000235d0: 6d65 6e74 2061 6e20 6578 6163 7420 6d65  ment an exact me
-000235e0: 6469 616e 2069 6e20 616c 6c20 6361 7365  dian in all case
-000235f0: 7320 6173 2074 6869 7320 6973 2068 6172  s as this is har
-00023600: 6420 746f 2064 6f20 696e 2070 6172 616c  d to do in paral
-00023610: 6c65 6c2e 2022 0a20 2020 2020 2020 2020  lel. ".         
-00023620: 2020 2022 5365 6520 7468 6520 606d 6564     "See the `med
-00023630: 6961 6e5f 6170 7072 6f78 696d 6174 6560  ian_approximate`
-00023640: 206d 6574 686f 6420 696e 7374 6561 642c   method instead,
-00023650: 2077 6869 6368 2075 7365 7320 616e 2061   which uses an a
-00023660: 7070 726f 7869 6d61 7465 2061 6c67 6f72  pproximate algor
-00023670: 6974 686d 2e22 0a20 2020 2020 2020 2029  ithm.".        )
-00023680: 0a0a 2020 2020 6465 6620 5f72 6570 6172  ..    def _repar
-00023690: 7469 7469 6f6e 5f71 7561 6e74 696c 6573  tition_quantiles
-000236a0: 2873 656c 662c 206e 7061 7274 6974 696f  (self, npartitio
-000236b0: 6e73 2c20 7570 7361 6d70 6c65 3d31 2e30  ns, upsample=1.0
-000236c0: 293a 0a20 2020 2020 2020 2022 2222 4170  ):.        """Ap
-000236d0: 7072 6f78 696d 6174 6520 7175 616e 7469  proximate quanti
-000236e0: 6c65 7320 6f66 2053 6572 6965 7320 7573  les of Series us
-000236f0: 6564 2066 6f72 2072 6570 6172 7469 7469  ed for repartiti
-00023700: 6f6e 696e 6722 2222 0a20 2020 2020 2020  oning""".       
-00023710: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-00023720: 7261 6d65 2e70 6172 7469 7469 6f6e 7175  rame.partitionqu
-00023730: 616e 7469 6c65 7320 696d 706f 7274 2070  antiles import p
-00023740: 6172 7469 7469 6f6e 5f71 7561 6e74 696c  artition_quantil
-00023750: 6573 0a0a 2020 2020 2020 2020 7265 7475  es..        retu
-00023760: 726e 2070 6172 7469 7469 6f6e 5f71 7561  rn partition_qua
-00023770: 6e74 696c 6573 2873 656c 662c 206e 7061  ntiles(self, npa
-00023780: 7274 6974 696f 6e73 2c20 7570 7361 6d70  rtitions, upsamp
-00023790: 6c65 3d75 7073 616d 706c 6529 0a0a 2020  le=upsample)..  
-000237a0: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
-000237b0: 5f28 7365 6c66 2c20 6b65 7929 3a0a 2020  _(self, key):.  
-000237c0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000237d0: 6e63 6528 6b65 792c 2053 6572 6965 7329  nce(key, Series)
-000237e0: 2061 6e64 2073 656c 662e 6469 7669 7369   and self.divisi
-000237f0: 6f6e 7320 3d3d 206b 6579 2e64 6976 6973  ons == key.divis
-00023800: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
-00023810: 2020 6e61 6d65 203d 2022 696e 6465 782d    name = "index-
-00023820: 2573 2220 2520 746f 6b65 6e69 7a65 2873  %s" % tokenize(s
-00023830: 656c 662c 206b 6579 290a 2020 2020 2020  elf, key).      
-00023840: 2020 2020 2020 6473 6b20 3d20 7061 7274        dsk = part
-00023850: 6974 696f 6e77 6973 655f 6772 6170 6828  itionwise_graph(
-00023860: 6f70 6572 6174 6f72 2e67 6574 6974 656d  operator.getitem
-00023870: 2c20 6e61 6d65 2c20 7365 6c66 2c20 6b65  , name, self, ke
-00023880: 7929 0a20 2020 2020 2020 2020 2020 2067  y).            g
-00023890: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
-000238a0: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-000238b0: 6374 696f 6e73 286e 616d 652c 2064 736b  ctions(name, dsk
-000238c0: 2c20 6465 7065 6e64 656e 6369 6573 3d5b  , dependencies=[
-000238d0: 7365 6c66 2c20 6b65 795d 290a 2020 2020  self, key]).    
-000238e0: 2020 2020 2020 2020 7265 7475 726e 2053          return S
-000238f0: 6572 6965 7328 6772 6170 682c 206e 616d  eries(graph, nam
-00023900: 652c 2073 656c 662e 5f6d 6574 612c 2073  e, self._meta, s
-00023910: 656c 662e 6469 7669 7369 6f6e 7329 0a20  elf.divisions). 
-00023920: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00023930: 6c66 2e6c 6f63 5b6b 6579 5d0a 0a20 2020  lf.loc[key]..   
-00023940: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00023950: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-00023960: 2064 6566 205f 6765 745f 6e75 6d65 7269   def _get_numeri
-00023970: 635f 6461 7461 2873 656c 662c 2068 6f77  c_data(self, how
-00023980: 3d22 616e 7922 2c20 7375 6273 6574 3d4e  ="any", subset=N
-00023990: 6f6e 6529 3a0a 2020 2020 2020 2020 7265  one):.        re
-000239a0: 7475 726e 2073 656c 660a 0a20 2020 2069  turn self..    i
-000239b0: 6620 6e6f 7420 5041 4e44 4153 5f47 545f  f not PANDAS_GT_
-000239c0: 3230 303a 0a0a 2020 2020 2020 2020 4064  200:..        @d
-000239d0: 6572 6976 6564 5f66 726f 6d28 7064 2e53  erived_from(pd.S
-000239e0: 6572 6965 7329 0a20 2020 2020 2020 2064  eries).        d
-000239f0: 6566 2069 7465 7269 7465 6d73 2873 656c  ef iteritems(sel
-00023a00: 6629 3a0a 2020 2020 2020 2020 2020 2020  f):.            
-00023a10: 6966 2050 414e 4441 535f 4754 5f31 3530  if PANDAS_GT_150
-00023a20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023a30: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00023a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023a50: 2020 2020 2022 6974 6572 6974 656d 7320       "iteritems 
-00023a60: 6973 2064 6570 7265 6361 7465 6420 616e  is deprecated an
-00023a70: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
-00023a80: 6420 696e 2061 2066 7574 7572 6520 7665  d in a future ve
-00023a90: 7273 696f 6e2e 2022 0a20 2020 2020 2020  rsion. ".       
-00023aa0: 2020 2020 2020 2020 2020 2020 2022 5573               "Us
-00023ab0: 6520 2e69 7465 6d73 2069 6e73 7465 6164  e .items instead
-00023ac0: 2e22 2c0a 2020 2020 2020 2020 2020 2020  .",.            
-00023ad0: 2020 2020 2020 2020 4675 7475 7265 5761          FutureWa
-00023ae0: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
-00023af0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00023b00: 2020 2020 2023 2057 6520 7573 6520 7468       # We use th
-00023b10: 6520 605f 6020 6765 6e65 7261 746f 7220  e `_` generator 
-00023b20: 6265 6c6f 7720 746f 2065 6e73 7572 6520  below to ensure 
-00023b30: 7468 6520 6465 7072 6563 6174 696f 6e20  the deprecation 
-00023b40: 7761 726e 696e 6720 6162 6f76 650a 2020  warning above.  
-00023b50: 2020 2020 2020 2020 2020 2320 6973 2072            # is r
-00023b60: 6169 7365 6420 7768 656e 2060 2e69 7465  aised when `.ite
-00023b70: 7269 7465 6d73 2829 6020 6973 2063 616c  ritems()` is cal
-00023b80: 6c65 642c 206e 6f74 2077 6865 6e20 7468  led, not when th
-00023b90: 6520 6669 7273 7420 606e 6578 7428 3c67  e first `next(<g
-00023ba0: 656e 6572 6174 6f72 3e29 600a 2020 2020  enerator>)`.    
-00023bb0: 2020 2020 2020 2020 2320 6974 6572 6174          # iterat
-00023bc0: 696f 6e20 6861 7070 656e 730a 0a20 2020  ion happens..   
-00023bd0: 2020 2020 2020 2020 2064 6566 205f 2873           def _(s
-00023be0: 656c 6629 3a0a 2020 2020 2020 2020 2020  elf):.          
-00023bf0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00023c00: 616e 6765 2873 656c 662e 6e70 6172 7469  ange(self.nparti
-00023c10: 7469 6f6e 7329 3a0a 2020 2020 2020 2020  tions):.        
-00023c20: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
-00023c30: 7365 6c66 2e67 6574 5f70 6172 7469 7469  self.get_partiti
-00023c40: 6f6e 2869 292e 636f 6d70 7574 6528 290a  on(i).compute().
-00023c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023c60: 2020 2020 7969 656c 6420 6672 6f6d 2073      yield from s
-00023c70: 2e69 7465 6d73 2829 0a0a 2020 2020 2020  .items()..      
-00023c80: 2020 2020 2020 7265 7475 726e 205f 2873        return _(s
-00023c90: 656c 6629 0a0a 2020 2020 4064 6572 6976  elf)..    @deriv
-00023ca0: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
-00023cb0: 7329 0a20 2020 2064 6566 205f 5f69 7465  s).    def __ite
-00023cc0: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00023cd0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00023ce0: 6528 7365 6c66 2e6e 7061 7274 6974 696f  e(self.npartitio
-00023cf0: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-00023d00: 2073 203d 2073 656c 662e 6765 745f 7061   s = self.get_pa
-00023d10: 7274 6974 696f 6e28 6929 2e63 6f6d 7075  rtition(i).compu
-00023d20: 7465 2829 0a20 2020 2020 2020 2020 2020  te().           
-00023d30: 2079 6965 6c64 2066 726f 6d20 730a 0a20   yield from s.. 
-00023d40: 2020 2040 5f64 6570 7265 6361 7465 6428     @_deprecated(
-00023d50: 0a20 2020 2020 2020 206d 6573 7361 6765  .        message
-00023d60: 3d28 0a20 2020 2020 2020 2020 2020 2022  =(.            "
-00023d70: 5573 696e 6720 7468 6520 6060 696e 6060  Using the ``in``
-00023d80: 206f 7065 7261 746f 7220 746f 2074 6573   operator to tes
-00023d90: 7420 666f 7220 6d65 6d62 6572 7368 6970  t for membership
-00023da0: 2069 6e20 5365 7269 6573 2069 7320 220a   in Series is ".
-00023db0: 2020 2020 2020 2020 2020 2020 2264 6570              "dep
-00023dc0: 7265 6361 7465 642e 2054 6f20 7465 7374  recated. To test
-00023dd0: 2066 6f72 206d 656d 6265 7273 6869 7020   for membership 
-00023de0: 696e 2074 6865 2069 6e64 6578 2075 7365  in the index use
-00023df0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-00023e00: 6060 2873 2e69 6e64 6578 203d 3d20 6b65  ``(s.index == ke
-00023e10: 7929 2e61 6e79 2829 6060 2e20 5369 6d69  y).any()``. Simi
-00023e20: 6c61 726c 7920 746f 2074 6573 7420 666f  larly to test fo
-00023e30: 7220 6d65 6d62 6572 7368 6970 2069 6e20  r membership in 
-00023e40: 220a 2020 2020 2020 2020 2020 2020 2274  ".            "t
-00023e50: 6865 2076 616c 7565 7320 7573 6520 6060  he values use ``
-00023e60: 2873 203d 3d20 6b65 7929 2e61 6e79 2829  (s == key).any()
-00023e70: 6060 220a 2020 2020 2020 2020 290a 2020  ``".        ).  
-00023e80: 2020 290a 2020 2020 6465 6620 5f5f 636f    ).    def __co
-00023e90: 6e74 6169 6e73 5f5f 2873 656c 662c 206b  ntains__(self, k
-00023ea0: 6579 293a 0a20 2020 2020 2020 2072 6574  ey):.        ret
-00023eb0: 7572 6e20 2873 656c 6620 3d3d 206b 6579  urn (self == key
-00023ec0: 292e 616e 7928 292e 636f 6d70 7574 6528  ).any().compute(
-00023ed0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00023ee0: 686f 640a 2020 2020 6465 6620 5f76 616c  hod.    def _val
-00023ef0: 6964 6174 655f 6178 6973 2863 6c73 2c20  idate_axis(cls, 
-00023f00: 6178 6973 3d30 2c20 6e6f 6e65 5f69 735f  axis=0, none_is_
-00023f10: 7a65 726f 3a20 626f 6f6c 203d 2054 7275  zero: bool = Tru
-00023f20: 6529 202d 3e20 4e6f 6e65 207c 204c 6974  e) -> None | Lit
-00023f30: 6572 616c 5b30 2c20 315d 3a0a 2020 2020  eral[0, 1]:.    
-00023f40: 2020 2020 6966 2061 7869 7320 6e6f 7420      if axis not 
-00023f50: 696e 2028 302c 2022 696e 6465 7822 2c20  in (0, "index", 
-00023f60: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
-00023f70: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00023f80: 726f 7228 6622 4e6f 2061 7869 7320 6e61  ror(f"No axis na
-00023f90: 6d65 6420 7b61 7869 737d 2229 0a20 2020  med {axis}").   
-00023fa0: 2020 2020 2023 2063 6f6e 7665 7274 2074       # convert t
-00023fb0: 6f20 6e75 6d65 7269 6320 6178 6973 0a20  o numeric axis. 
-00023fc0: 2020 2020 2020 206e 756d 6572 6963 5f61         numeric_a
-00023fd0: 7869 733a 2064 6963 745b 7374 7220 7c20  xis: dict[str | 
-00023fe0: 4e6f 6e65 2c20 4c69 7465 7261 6c5b 302c  None, Literal[0,
-00023ff0: 2031 5d5d 203d 207b 2269 6e64 6578 223a   1]] = {"index":
-00024000: 2030 7d0a 2020 2020 2020 2020 6966 206e   0}.        if n
-00024010: 6f6e 655f 6973 5f7a 6572 6f3a 0a20 2020  one_is_zero:.   
-00024020: 2020 2020 2020 2020 206e 756d 6572 6963           numeric
-00024030: 5f61 7869 735b 4e6f 6e65 5d20 3d20 300a  _axis[None] = 0.
-00024040: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00024050: 756d 6572 6963 5f61 7869 732e 6765 7428  umeric_axis.get(
-00024060: 6178 6973 2c20 6178 6973 290a 0a20 2020  axis, axis)..   
-00024070: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00024080: 642e 5365 7269 6573 290a 2020 2020 6465  d.Series).    de
-00024090: 6620 6772 6f75 7062 7928 0a20 2020 2020  f groupby(.     
-000240a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000240b0: 2062 793d 4e6f 6e65 2c0a 2020 2020 2020   by=None,.      
-000240c0: 2020 6772 6f75 705f 6b65 7973 3d47 524f    group_keys=GRO
-000240d0: 5550 5f4b 4559 535f 4445 4641 554c 542c  UP_KEYS_DEFAULT,
-000240e0: 0a20 2020 2020 2020 2073 6f72 743d 4e6f  .        sort=No
-000240f0: 6e65 2c0a 2020 2020 2020 2020 6f62 7365  ne,.        obse
-00024100: 7276 6564 3d4e 6f6e 652c 0a20 2020 2020  rved=None,.     
-00024110: 2020 2064 726f 706e 613d 4e6f 6e65 2c0a     dropna=None,.
-00024120: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-00024130: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00024140: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-00024150: 7261 6d65 2e67 726f 7570 6279 2069 6d70  rame.groupby imp
-00024160: 6f72 7420 5365 7269 6573 4772 6f75 7042  ort SeriesGroupB
-00024170: 790a 0a20 2020 2020 2020 2072 6574 7572  y..        retur
-00024180: 6e20 5365 7269 6573 4772 6f75 7042 7928  n SeriesGroupBy(
-00024190: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000241a0: 662c 0a20 2020 2020 2020 2020 2020 2062  f,.            b
-000241b0: 793d 6279 2c0a 2020 2020 2020 2020 2020  y=by,.          
-000241c0: 2020 6772 6f75 705f 6b65 7973 3d67 726f    group_keys=gro
-000241d0: 7570 5f6b 6579 732c 0a20 2020 2020 2020  up_keys,.       
-000241e0: 2020 2020 2073 6f72 743d 736f 7274 2c0a       sort=sort,.
-000241f0: 2020 2020 2020 2020 2020 2020 6f62 7365              obse
-00024200: 7276 6564 3d6f 6273 6572 7665 642c 0a20  rved=observed,. 
-00024210: 2020 2020 2020 2020 2020 2064 726f 706e             dropn
-00024220: 613d 6472 6f70 6e61 2c0a 2020 2020 2020  a=dropna,.      
-00024230: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-00024240: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-00024250: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
-00024260: 5365 7269 6573 290a 2020 2020 6465 6620  Series).    def 
-00024270: 636f 756e 7428 7365 6c66 2c20 7370 6c69  count(self, spli
-00024280: 745f 6576 6572 793d 4661 6c73 6529 3a0a  t_every=False):.
-00024290: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000242a0: 7570 6572 2829 2e63 6f75 6e74 2873 706c  uper().count(spl
-000242b0: 6974 5f65 7665 7279 3d73 706c 6974 5f65  it_every=split_e
-000242c0: 7665 7279 290a 0a20 2020 2040 6465 7269  very)..    @deri
-000242d0: 7665 645f 6672 6f6d 2870 642e 5365 7269  ved_from(pd.Seri
-000242e0: 6573 290a 2020 2020 6465 6620 6d6f 6465  es).    def mode
-000242f0: 2873 656c 662c 2064 726f 706e 613d 5472  (self, dropna=Tr
-00024300: 7565 2c20 7370 6c69 745f 6576 6572 793d  ue, split_every=
-00024310: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00024320: 7265 7475 726e 2073 7570 6572 2829 2e6d  return super().m
-00024330: 6f64 6528 6472 6f70 6e61 3d64 726f 706e  ode(dropna=dropn
-00024340: 612c 2073 706c 6974 5f65 7665 7279 3d73  a, split_every=s
-00024350: 706c 6974 5f65 7665 7279 290a 0a20 2020  plit_every)..   
-00024360: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00024370: 642e 5365 7269 6573 290a 2020 2020 6465  d.Series).    de
-00024380: 6620 6578 706c 6f64 6528 7365 6c66 293a  f explode(self):
-00024390: 0a20 2020 2020 2020 206d 6574 6120 3d20  .        meta = 
-000243a0: 7365 6c66 2e5f 6d65 7461 2e65 7870 6c6f  self._meta.explo
-000243b0: 6465 2829 0a20 2020 2020 2020 2072 6574  de().        ret
-000243c0: 7572 6e20 7365 6c66 2e6d 6170 5f70 6172  urn self.map_par
-000243d0: 7469 7469 6f6e 7328 4d2e 6578 706c 6f64  titions(M.explod
-000243e0: 652c 206d 6574 613d 6d65 7461 2c20 656e  e, meta=meta, en
-000243f0: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-00024400: 616c 7365 290a 0a20 2020 2064 6566 2075  alse)..    def u
-00024410: 6e69 7175 6528 7365 6c66 2c20 7370 6c69  nique(self, spli
-00024420: 745f 6576 6572 793d 4e6f 6e65 2c20 7370  t_every=None, sp
-00024430: 6c69 745f 6f75 743d 3129 3a0a 2020 2020  lit_out=1):.    
-00024440: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00024450: 5265 7475 726e 2053 6572 6965 7320 6f66  Return Series of
-00024460: 2075 6e69 7175 6520 7661 6c75 6573 2069   unique values i
-00024470: 6e20 7468 6520 6f62 6a65 6374 2e20 496e  n the object. In
-00024480: 636c 7564 6573 204e 4120 7661 6c75 6573  cludes NA values
-00024490: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-000244a0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
-000244b0: 2d2d 0a20 2020 2020 2020 2075 6e69 7175  --.        uniqu
-000244c0: 6573 203a 2053 6572 6965 730a 2020 2020  es : Series.    
-000244d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000244e0: 7265 7475 726e 2061 6361 280a 2020 2020  return aca(.    
-000244f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00024500: 2020 2020 2020 2020 2020 6368 756e 6b3d            chunk=
-00024510: 6d65 7468 6f64 732e 756e 6971 7565 2c0a  methods.unique,.
-00024520: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
-00024530: 6567 6174 653d 6d65 7468 6f64 732e 756e  egate=methods.un
-00024540: 6971 7565 2c0a 2020 2020 2020 2020 2020  ique,.          
-00024550: 2020 6d65 7461 3d73 656c 662e 5f6d 6574    meta=self._met
-00024560: 612c 0a20 2020 2020 2020 2020 2020 2074  a,.            t
-00024570: 6f6b 656e 3d22 756e 6971 7565 222c 0a20  oken="unique",. 
-00024580: 2020 2020 2020 2020 2020 2073 706c 6974             split
-00024590: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-000245a0: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-000245b0: 7365 7269 6573 5f6e 616d 653d 7365 6c66  series_name=self
-000245c0: 2e6e 616d 652c 0a20 2020 2020 2020 2020  .name,.         
-000245d0: 2020 2073 706c 6974 5f6f 7574 3d73 706c     split_out=spl
-000245e0: 6974 5f6f 7574 2c0a 2020 2020 2020 2020  it_out,.        
-000245f0: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-00024600: 6672 6f6d 2870 642e 5365 7269 6573 290a  from(pd.Series).
-00024610: 2020 2020 6465 6620 6e75 6e69 7175 6528      def nunique(
-00024620: 7365 6c66 2c20 7370 6c69 745f 6576 6572  self, split_ever
-00024630: 793d 4e6f 6e65 2c20 6472 6f70 6e61 3d54  y=None, dropna=T
-00024640: 7275 6529 3a0a 2020 2020 2020 2020 756e  rue):.        un
-00024650: 6971 7320 3d20 7365 6c66 2e64 726f 705f  iqs = self.drop_
-00024660: 6475 706c 6963 6174 6573 2873 706c 6974  duplicates(split
-00024670: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00024680: 7279 290a 2020 2020 2020 2020 6966 2064  ry).        if d
-00024690: 726f 706e 613a 0a20 2020 2020 2020 2020  ropna:.         
-000246a0: 2020 2023 2063 6f75 6e74 206d 696d 6963     # count mimic
-000246b0: 7320 7061 6e64 6173 2062 6568 6176 696f  s pandas behavio
-000246c0: 7220 616e 6420 6578 636c 7564 6573 204e  r and excludes N
-000246d0: 4120 7661 6c75 6573 0a20 2020 2020 2020  A values.       
-000246e0: 2020 2020 2072 6574 7572 6e20 756e 6971       return uniq
-000246f0: 732e 636f 756e 7428 290a 2020 2020 2020  s.count().      
-00024700: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00024710: 2020 2020 7265 7475 726e 2075 6e69 7173      return uniqs
-00024720: 2e73 697a 650a 0a20 2020 2040 6465 7269  .size..    @deri
-00024730: 7665 645f 6672 6f6d 2870 642e 5365 7269  ved_from(pd.Seri
-00024740: 6573 290a 2020 2020 6465 6620 7661 6c75  es).    def valu
-00024750: 655f 636f 756e 7473 280a 2020 2020 2020  e_counts(.      
-00024760: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00024770: 736f 7274 3d4e 6f6e 652c 0a20 2020 2020  sort=None,.     
-00024780: 2020 2061 7363 656e 6469 6e67 3d46 616c     ascending=Fal
-00024790: 7365 2c0a 2020 2020 2020 2020 6472 6f70  se,.        drop
-000247a0: 6e61 3d54 7275 652c 0a20 2020 2020 2020  na=True,.       
-000247b0: 206e 6f72 6d61 6c69 7a65 3d46 616c 7365   normalize=False
-000247c0: 2c0a 2020 2020 2020 2020 7370 6c69 745f  ,.        split_
-000247d0: 6576 6572 793d 4e6f 6e65 2c0a 2020 2020  every=None,.    
-000247e0: 2020 2020 7370 6c69 745f 6f75 743d 312c      split_out=1,
-000247f0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00024800: 6b77 6172 6773 203d 207b 2273 6f72 7422  kwargs = {"sort"
-00024810: 3a20 736f 7274 2c20 2261 7363 656e 6469  : sort, "ascendi
-00024820: 6e67 223a 2061 7363 656e 6469 6e67 2c20  ng": ascending, 
-00024830: 2264 726f 706e 6122 3a20 6472 6f70 6e61  "dropna": dropna
-00024840: 7d0a 2020 2020 2020 2020 6167 6772 6567  }.        aggreg
-00024850: 6174 655f 6b77 6172 6773 203d 207b 226e  ate_kwargs = {"n
-00024860: 6f72 6d61 6c69 7a65 223a 206e 6f72 6d61  ormalize": norma
-00024870: 6c69 7a65 7d0a 2020 2020 2020 2020 6966  lize}.        if
-00024880: 2073 706c 6974 5f6f 7574 203e 2031 3a0a   split_out > 1:.
-00024890: 2020 2020 2020 2020 2020 2020 6167 6772              aggr
-000248a0: 6567 6174 655f 6b77 6172 6773 5b22 746f  egate_kwargs["to
-000248b0: 7461 6c5f 6c65 6e67 7468 225d 203d 2028  tal_length"] = (
-000248c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000248d0: 206c 656e 2873 656c 6629 2069 6620 6472   len(self) if dr
-000248e0: 6f70 6e61 2069 7320 4661 6c73 6520 656c  opna is False el
-000248f0: 7365 206c 656e 2873 656c 662e 6472 6f70  se len(self.drop
-00024900: 6e61 2829 290a 2020 2020 2020 2020 2020  na()).          
-00024910: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
-00024920: 7572 6e20 6163 6128 0a20 2020 2020 2020  urn aca(.       
-00024930: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00024940: 2020 2020 2020 2063 6875 6e6b 3d4d 2e76         chunk=M.v
-00024950: 616c 7565 5f63 6f75 6e74 732c 0a20 2020  alue_counts,.   
-00024960: 2020 2020 2020 2020 2061 6767 7265 6761           aggrega
-00024970: 7465 3d6d 6574 686f 6473 2e76 616c 7565  te=methods.value
-00024980: 5f63 6f75 6e74 735f 6167 6772 6567 6174  _counts_aggregat
-00024990: 652c 0a20 2020 2020 2020 2020 2020 2063  e,.            c
-000249a0: 6f6d 6269 6e65 3d6d 6574 686f 6473 2e76  ombine=methods.v
-000249b0: 616c 7565 5f63 6f75 6e74 735f 636f 6d62  alue_counts_comb
-000249c0: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
-000249d0: 206d 6574 613d 7365 6c66 2e5f 6d65 7461   meta=self._meta
-000249e0: 2e76 616c 7565 5f63 6f75 6e74 7328 6e6f  .value_counts(no
-000249f0: 726d 616c 697a 653d 6e6f 726d 616c 697a  rmalize=normaliz
-00024a00: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00024a10: 746f 6b65 6e3d 2276 616c 7565 2d63 6f75  token="value-cou
-00024a20: 6e74 7322 2c0a 2020 2020 2020 2020 2020  nts",.          
-00024a30: 2020 7370 6c69 745f 6576 6572 793d 7370    split_every=sp
-00024a40: 6c69 745f 6576 6572 792c 0a20 2020 2020  lit_every,.     
-00024a50: 2020 2020 2020 2073 706c 6974 5f6f 7574         split_out
-00024a60: 3d73 706c 6974 5f6f 7574 2c0a 2020 2020  =split_out,.    
-00024a70: 2020 2020 2020 2020 7370 6c69 745f 6f75          split_ou
-00024a80: 745f 7365 7475 703d 7370 6c69 745f 6f75  t_setup=split_ou
-00024a90: 745f 6f6e 5f69 6e64 6578 2c0a 2020 2020  t_on_index,.    
-00024aa0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-00024ab0: 655f 6b77 6172 6773 3d61 6767 7265 6761  e_kwargs=aggrega
-00024ac0: 7465 5f6b 7761 7267 732c 0a20 2020 2020  te_kwargs,.     
-00024ad0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00024ae0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00024af0: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-00024b00: 2e53 6572 6965 7329 0a20 2020 2064 6566  .Series).    def
-00024b10: 206e 6c61 7267 6573 7428 7365 6c66 2c20   nlargest(self, 
-00024b20: 6e3d 352c 2073 706c 6974 5f65 7665 7279  n=5, split_every
-00024b30: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00024b40: 7265 7475 726e 2061 6361 280a 2020 2020  return aca(.    
-00024b50: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00024b60: 2020 2020 2020 2020 2020 6368 756e 6b3d            chunk=
-00024b70: 4d2e 6e6c 6172 6765 7374 2c0a 2020 2020  M.nlargest,.    
-00024b80: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-00024b90: 653d 4d2e 6e6c 6172 6765 7374 2c0a 2020  e=M.nlargest,.  
-00024ba0: 2020 2020 2020 2020 2020 6d65 7461 3d73            meta=s
-00024bb0: 656c 662e 5f6d 6574 612c 0a20 2020 2020  elf._meta,.     
-00024bc0: 2020 2020 2020 2074 6f6b 656e 3d22 7365         token="se
-00024bd0: 7269 6573 2d6e 6c61 7267 6573 7422 2c0a  ries-nlargest",.
-00024be0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00024bf0: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-00024c00: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
-00024c10: 206e 3d6e 2c0a 2020 2020 2020 2020 290a   n=n,.        ).
-00024c20: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-00024c30: 6f6d 2870 642e 5365 7269 6573 290a 2020  om(pd.Series).  
-00024c40: 2020 6465 6620 6e73 6d61 6c6c 6573 7428    def nsmallest(
-00024c50: 7365 6c66 2c20 6e3d 352c 2073 706c 6974  self, n=5, split
-00024c60: 5f65 7665 7279 3d4e 6f6e 6529 3a0a 2020  _every=None):.  
-00024c70: 2020 2020 2020 7265 7475 726e 2061 6361        return aca
-00024c80: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00024c90: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00024ca0: 6368 756e 6b3d 4d2e 6e73 6d61 6c6c 6573  chunk=M.nsmalles
-00024cb0: 742c 0a20 2020 2020 2020 2020 2020 2061  t,.            a
-00024cc0: 6767 7265 6761 7465 3d4d 2e6e 736d 616c  ggregate=M.nsmal
-00024cd0: 6c65 7374 2c0a 2020 2020 2020 2020 2020  lest,.          
-00024ce0: 2020 6d65 7461 3d73 656c 662e 5f6d 6574    meta=self._met
-00024cf0: 612c 0a20 2020 2020 2020 2020 2020 2074  a,.            t
-00024d00: 6f6b 656e 3d22 7365 7269 6573 2d6e 736d  oken="series-nsm
-00024d10: 616c 6c65 7374 222c 0a20 2020 2020 2020  allest",.       
-00024d20: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
-00024d30: 3d73 706c 6974 5f65 7665 7279 2c0a 2020  =split_every,.  
-00024d40: 2020 2020 2020 2020 2020 6e3d 6e2c 0a20            n=n,. 
-00024d50: 2020 2020 2020 2029 0a0a 2020 2020 4064         )..    @d
-00024d60: 6572 6976 6564 5f66 726f 6d28 7064 2e53  erived_from(pd.S
-00024d70: 6572 6965 7329 0a20 2020 2064 6566 2069  eries).    def i
-00024d80: 7369 6e28 7365 6c66 2c20 7661 6c75 6573  sin(self, values
-00024d90: 293a 0a20 2020 2020 2020 2023 2041 6464  ):.        # Add
-00024da0: 6564 206a 7573 7420 746f 2067 6574 2074  ed just to get t
-00024db0: 6865 2064 6966 6665 7265 6e74 2064 6f63  he different doc
-00024dc0: 7374 7269 6e67 2066 6f72 2053 6572 6965  string for Serie
-00024dd0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-00024de0: 2073 7570 6572 2829 2e69 7369 6e28 7661   super().isin(va
-00024df0: 6c75 6573 290a 0a20 2020 2040 696e 7365  lues)..    @inse
-00024e00: 7274 5f6d 6574 615f 7061 7261 6d5f 6465  rt_meta_param_de
-00024e10: 7363 7269 7074 696f 6e28 7061 643d 3132  scription(pad=12
-00024e20: 290a 2020 2020 4064 6572 6976 6564 5f66  ).    @derived_f
-00024e30: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
-00024e40: 2020 2064 6566 206d 6170 2873 656c 662c     def map(self,
-00024e50: 2061 7267 2c20 6e61 5f61 6374 696f 6e3d   arg, na_action=
-00024e60: 4e6f 6e65 2c20 6d65 7461 3d6e 6f5f 6465  None, meta=no_de
-00024e70: 6661 756c 7429 3a0a 2020 2020 2020 2020  fault):.        
-00024e80: 6966 2069 735f 7365 7269 6573 5f6c 696b  if is_series_lik
-00024e90: 6528 6172 6729 2061 6e64 2069 735f 6461  e(arg) and is_da
-00024ea0: 736b 5f63 6f6c 6c65 6374 696f 6e28 6172  sk_collection(ar
-00024eb0: 6729 3a0a 2020 2020 2020 2020 2020 2020  g):.            
-00024ec0: 7265 7475 726e 2073 6572 6965 735f 6d61  return series_ma
-00024ed0: 7028 7365 6c66 2c20 6172 6729 0a20 2020  p(self, arg).   
-00024ee0: 2020 2020 2069 6620 6e6f 7420 280a 2020       if not (.  
-00024ef0: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-00024f00: 616e 6365 2861 7267 2c20 6469 6374 290a  ance(arg, dict).
-00024f10: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
-00024f20: 616c 6c61 626c 6528 6172 6729 0a20 2020  allable(arg).   
-00024f30: 2020 2020 2020 2020 206f 7220 6973 5f73           or is_s
-00024f40: 6572 6965 735f 6c69 6b65 2861 7267 290a  eries_like(arg).
-00024f50: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00024f60: 6e6f 7420 6973 5f64 6173 6b5f 636f 6c6c  not is_dask_coll
-00024f70: 6563 7469 6f6e 2861 7267 290a 2020 2020  ection(arg).    
-00024f80: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00024f90: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00024fa0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00024fb0: 2020 2020 6622 6172 6720 6d75 7374 2062      f"arg must b
-00024fc0: 6520 7061 6e64 6173 2e53 6572 6965 732c  e pandas.Series,
-00024fd0: 2064 6963 7420 6f72 2063 616c 6c61 626c   dict or callabl
-00024fe0: 652e 2047 6f74 207b 7479 7065 2861 7267  e. Got {type(arg
-00024ff0: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
-00025000: 290a 2020 2020 2020 2020 6e61 6d65 203d  ).        name =
-00025010: 2022 6d61 702d 2220 2b20 746f 6b65 6e69   "map-" + tokeni
-00025020: 7a65 2873 656c 662c 2061 7267 2c20 6e61  ze(self, arg, na
-00025030: 5f61 6374 696f 6e29 0a20 2020 2020 2020  _action).       
-00025040: 2064 736b 203d 207b 0a20 2020 2020 2020   dsk = {.       
-00025050: 2020 2020 2028 6e61 6d65 2c20 6929 3a20       (name, i): 
-00025060: 284d 2e6d 6170 2c20 6b2c 2061 7267 2c20  (M.map, k, arg, 
-00025070: 6e61 5f61 6374 696f 6e29 0a20 2020 2020  na_action).     
-00025080: 2020 2020 2020 2066 6f72 2069 2c20 6b20         for i, k 
-00025090: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-000250a0: 662e 5f5f 6461 736b 5f6b 6579 735f 5f28  f.__dask_keys__(
-000250b0: 2929 0a20 2020 2020 2020 207d 0a20 2020  )).        }.   
-000250c0: 2020 2020 2067 7261 7068 203d 2048 6967       graph = Hig
-000250d0: 684c 6576 656c 4772 6170 682e 6672 6f6d  hLevelGraph.from
-000250e0: 5f63 6f6c 6c65 6374 696f 6e73 286e 616d  _collections(nam
-000250f0: 652c 2064 736b 2c20 6465 7065 6e64 656e  e, dsk, dependen
-00025100: 6369 6573 3d5b 7365 6c66 5d29 0a20 2020  cies=[self]).   
-00025110: 2020 2020 2069 6620 6d65 7461 2069 7320       if meta is 
-00025120: 6e6f 5f64 6566 6175 6c74 3a0a 2020 2020  no_default:.    
-00025130: 2020 2020 2020 2020 6d65 7461 203d 205f          meta = _
-00025140: 656d 756c 6174 6528 4d2e 6d61 702c 2073  emulate(M.map, s
-00025150: 656c 662c 2061 7267 2c20 6e61 5f61 6374  elf, arg, na_act
-00025160: 696f 6e3d 6e61 5f61 6374 696f 6e2c 2075  ion=na_action, u
-00025170: 6466 3d54 7275 6529 0a20 2020 2020 2020  df=True).       
-00025180: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00025190: 2020 206d 6574 6120 3d20 6d61 6b65 5f6d     meta = make_m
-000251a0: 6574 6128 0a20 2020 2020 2020 2020 2020  eta(.           
-000251b0: 2020 2020 206d 6574 612c 0a20 2020 2020       meta,.     
-000251c0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000251d0: 3d67 6574 6174 7472 286d 616b 655f 6d65  =getattr(make_me
-000251e0: 7461 2873 656c 6629 2c20 2269 6e64 6578  ta(self), "index
-000251f0: 222c 204e 6f6e 6529 2c0a 2020 2020 2020  ", None),.      
-00025200: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-00025210: 5f6d 6574 613d 7365 6c66 2e5f 6d65 7461  _meta=self._meta
-00025220: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00025230: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00025240: 7479 7065 2873 656c 6629 2867 7261 7068  type(self)(graph
-00025250: 2c20 6e61 6d65 2c20 6d65 7461 2c20 7365  , name, meta, se
-00025260: 6c66 2e64 6976 6973 696f 6e73 290a 0a20  lf.divisions).. 
-00025270: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-00025280: 2870 642e 5365 7269 6573 290a 2020 2020  (pd.Series).    
-00025290: 6465 6620 6472 6f70 6e61 2873 656c 6629  def dropna(self)
-000252a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000252b0: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
-000252c0: 696f 6e73 284d 2e64 726f 706e 612c 2065  ions(M.dropna, e
-000252d0: 6e66 6f72 6365 5f6d 6574 6164 6174 613d  nforce_metadata=
-000252e0: 4661 6c73 6529 0a0a 2020 2020 4064 6572  False)..    @der
-000252f0: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
-00025300: 6965 7329 0a20 2020 2064 6566 2062 6574  ies).    def bet
-00025310: 7765 656e 2873 656c 662c 206c 6566 742c  ween(self, left,
-00025320: 2072 6967 6874 2c20 696e 636c 7573 6976   right, inclusiv
-00025330: 653d 2262 6f74 6822 293a 0a20 2020 2020  e="both"):.     
-00025340: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00025350: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
-00025360: 2020 2020 2020 2020 2020 204d 2e62 6574             M.bet
-00025370: 7765 656e 2c20 6c65 6674 3d6c 6566 742c  ween, left=left,
-00025380: 2072 6967 6874 3d72 6967 6874 2c20 696e   right=right, in
-00025390: 636c 7573 6976 653d 696e 636c 7573 6976  clusive=inclusiv
-000253a0: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-000253b0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-000253c0: 642e 5365 7269 6573 290a 2020 2020 6465  d.Series).    de
-000253d0: 6620 636c 6970 2873 656c 662c 206c 6f77  f clip(self, low
-000253e0: 6572 3d4e 6f6e 652c 2075 7070 6572 3d4e  er=None, upper=N
-000253f0: 6f6e 652c 206f 7574 3d4e 6f6e 6529 3a0a  one, out=None):.
-00025400: 2020 2020 2020 2020 6966 206f 7574 2069          if out i
-00025410: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00025420: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00025430: 6c75 6545 7272 6f72 2822 276f 7574 2720  lueError("'out' 
-00025440: 6d75 7374 2062 6520 4e6f 6e65 2229 0a20  must be None"). 
-00025450: 2020 2020 2020 2023 206e 702e 636c 6970         # np.clip
-00025460: 206d 6179 2070 6173 7320 6f75 740a 2020   may pass out.  
+00020050: 7269 6768 7420 3d20 6973 5f61 6e63 686f  right = is_ancho
+00020060: 7265 6420 6f72 206e 6f74 2068 6173 6174  red or not hasat
+00020070: 7472 286f 6666 7365 742c 2022 6465 6c74  tr(offset, "delt
+00020080: 6122 290a 0a20 2020 2020 2020 2069 6620  a")..        if 
+00020090: 656e 6420 3d3d 2073 656c 662e 6e70 6172  end == self.npar
+000200a0: 7469 7469 6f6e 7320 2d20 313a 0a20 2020  titions - 1:.   
+000200b0: 2020 2020 2020 2020 2064 6976 7320 3d20           divs = 
+000200c0: 7365 6c66 2e64 6976 6973 696f 6e73 0a20  self.divisions. 
+000200d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000200e0: 2020 2020 2020 2020 2064 6976 7320 3d20           divs = 
+000200f0: 7365 6c66 2e64 6976 6973 696f 6e73 5b3a  self.divisions[:
+00020100: 2065 6e64 202b 2031 5d20 2b20 2864 6174   end + 1] + (dat
+00020110: 652c 290a 0a20 2020 2020 2020 206e 616d  e,)..        nam
+00020120: 6520 3d20 2266 6972 7374 2d22 202b 2074  e = "first-" + t
+00020130: 6f6b 656e 697a 6528 7365 6c66 2c20 6f66  okenize(self, of
+00020140: 6673 6574 290a 2020 2020 2020 2020 6473  fset).        ds
+00020150: 6b20 3d20 7b28 6e61 6d65 2c20 6929 3a20  k = {(name, i): 
+00020160: 2873 656c 662e 5f6e 616d 652c 2069 2920  (self._name, i) 
+00020170: 666f 7220 6920 696e 2072 616e 6765 2865  for i in range(e
+00020180: 6e64 297d 0a20 2020 2020 2020 2064 736b  nd)}.        dsk
+00020190: 5b28 6e61 6d65 2c20 656e 6429 5d20 3d20  [(name, end)] = 
+000201a0: 280a 2020 2020 2020 2020 2020 2020 6d65  (.            me
+000201b0: 7468 6f64 732e 626f 756e 6461 7279 5f73  thods.boundary_s
+000201c0: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
+000201d0: 2020 2873 656c 662e 5f6e 616d 652c 2065    (self._name, e
+000201e0: 6e64 292c 0a20 2020 2020 2020 2020 2020  nd),.           
+000201f0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00020200: 2020 2064 6174 652c 0a20 2020 2020 2020     date,.       
+00020210: 2020 2020 2069 6e63 6c75 6465 5f72 6967       include_rig
+00020220: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+00020230: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
+00020240: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
+00020250: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+00020260: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+00020270: 6e61 6d65 2c20 6473 6b2c 2064 6570 656e  name, dsk, depen
+00020280: 6465 6e63 6965 733d 5b73 656c 665d 290a  dencies=[self]).
+00020290: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+000202a0: 6577 5f64 645f 6f62 6a65 6374 2867 7261  ew_dd_object(gra
+000202b0: 7068 2c20 6e61 6d65 2c20 7365 6c66 2c20  ph, name, self, 
+000202c0: 6469 7673 290a 0a20 2020 2040 6465 7269  divs)..    @deri
+000202d0: 7665 645f 6672 6f6d 2870 642e 4461 7461  ved_from(pd.Data
+000202e0: 4672 616d 6529 0a20 2020 2064 6566 206c  Frame).    def l
+000202f0: 6173 7428 7365 6c66 2c20 6f66 6673 6574  ast(self, offset
+00020300: 293a 0a20 2020 2020 2020 2023 204c 6574  ):.        # Let
+00020310: 2070 616e 6461 7320 6572 726f 7220 6f6e   pandas error on
+00020320: 2062 6164 2061 7267 730a 2020 2020 2020   bad args.      
+00020330: 2020 7365 6c66 2e5f 6d65 7461 5f6e 6f6e    self._meta_non
+00020340: 656d 7074 792e 6c61 7374 286f 6666 7365  empty.last(offse
+00020350: 7429 0a0a 2020 2020 2020 2020 6966 206e  t)..        if n
+00020360: 6f74 2073 656c 662e 6b6e 6f77 6e5f 6469  ot self.known_di
+00020370: 7669 7369 6f6e 733a 0a20 2020 2020 2020  visions:.       
+00020380: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00020390: 4572 726f 7228 2260 6c61 7374 6020 6973  Error("`last` is
+000203a0: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
+000203b0: 2066 6f72 2075 6e6b 6e6f 776e 2064 6976   for unknown div
+000203c0: 6973 696f 6e73 2229 0a0a 2020 2020 2020  isions")..      
+000203d0: 2020 6f66 6673 6574 203d 2070 642e 7473    offset = pd.ts
+000203e0: 6572 6965 732e 6672 6571 7565 6e63 6965  eries.frequencie
+000203f0: 732e 746f 5f6f 6666 7365 7428 6f66 6673  s.to_offset(offs
+00020400: 6574 290a 2020 2020 2020 2020 6461 7465  et).        date
+00020410: 203d 2073 656c 662e 6469 7669 7369 6f6e   = self.division
+00020420: 735b 2d31 5d20 2d20 6f66 6673 6574 0a20  s[-1] - offset. 
+00020430: 2020 2020 2020 2073 7461 7274 203d 2073         start = s
+00020440: 656c 662e 6c6f 632e 5f67 6574 5f70 6172  elf.loc._get_par
+00020450: 7469 7469 6f6e 7328 6461 7465 290a 0a20  titions(date).. 
+00020460: 2020 2020 2020 2069 6620 7374 6172 7420         if start 
+00020470: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00020480: 2020 6469 7673 203d 2073 656c 662e 6469    divs = self.di
+00020490: 7669 7369 6f6e 730a 2020 2020 2020 2020  visions.        
+000204a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000204b0: 2020 6469 7673 203d 2028 6461 7465 2c29    divs = (date,)
+000204c0: 202b 2073 656c 662e 6469 7669 7369 6f6e   + self.division
+000204d0: 735b 7374 6172 7420 2b20 3120 3a5d 0a0a  s[start + 1 :]..
+000204e0: 2020 2020 2020 2020 6e61 6d65 203d 2022          name = "
+000204f0: 6c61 7374 2d22 202b 2074 6f6b 656e 697a  last-" + tokeniz
+00020500: 6528 7365 6c66 2c20 6f66 6673 6574 290a  e(self, offset).
+00020510: 2020 2020 2020 2020 6473 6b20 3d20 7b0a          dsk = {.
+00020520: 2020 2020 2020 2020 2020 2020 286e 616d              (nam
+00020530: 652c 2069 202b 2031 293a 2028 7365 6c66  e, i + 1): (self
+00020540: 2e5f 6e61 6d65 2c20 6a20 2b20 3129 0a20  ._name, j + 1). 
+00020550: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00020560: 2c20 6a20 696e 2065 6e75 6d65 7261 7465  , j in enumerate
+00020570: 2872 616e 6765 2873 7461 7274 2c20 7365  (range(start, se
+00020580: 6c66 2e6e 7061 7274 6974 696f 6e73 2929  lf.npartitions))
+00020590: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
+000205a0: 2020 2064 736b 5b28 6e61 6d65 2c20 3029     dsk[(name, 0)
+000205b0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+000205c0: 2020 6d65 7468 6f64 732e 626f 756e 6461    methods.bounda
+000205d0: 7279 5f73 6c69 6365 2c0a 2020 2020 2020  ry_slice,.      
+000205e0: 2020 2020 2020 2873 656c 662e 5f6e 616d        (self._nam
+000205f0: 652c 2073 7461 7274 292c 0a20 2020 2020  e, start),.     
+00020600: 2020 2020 2020 2064 6174 652c 0a20 2020         date,.   
+00020610: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00020620: 2020 2020 2020 2020 2020 2054 7275 652c             True,
+00020630: 0a20 2020 2020 2020 2020 2020 2046 616c  .            Fal
+00020640: 7365 2c0a 2020 2020 2020 2020 290a 2020  se,.        ).  
+00020650: 2020 2020 2020 6772 6170 6820 3d20 4869        graph = Hi
+00020660: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
+00020670: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6e61  m_collections(na
+00020680: 6d65 2c20 6473 6b2c 2064 6570 656e 6465  me, dsk, depende
+00020690: 6e63 6965 733d 5b73 656c 665d 290a 2020  ncies=[self]).  
+000206a0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+000206b0: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
+000206c0: 2c20 6e61 6d65 2c20 7365 6c66 2c20 6469  , name, self, di
+000206d0: 7673 290a 0a20 2020 2064 6566 206e 756e  vs)..    def nun
+000206e0: 6971 7565 5f61 7070 726f 7828 7365 6c66  ique_approx(self
+000206f0: 2c20 7370 6c69 745f 6576 6572 793d 4e6f  , split_every=No
+00020700: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00020710: 4170 7072 6f78 696d 6174 6520 6e75 6d62  Approximate numb
+00020720: 6572 206f 6620 756e 6971 7565 2072 6f77  er of unique row
+00020730: 732e 0a0a 2020 2020 2020 2020 5468 6973  s...        This
+00020740: 206d 6574 686f 6420 7573 6573 2074 6865   method uses the
+00020750: 2048 7970 6572 4c6f 674c 6f67 2061 6c67   HyperLogLog alg
+00020760: 6f72 6974 686d 2066 6f72 2063 6172 6469  orithm for cardi
+00020770: 6e61 6c69 7479 0a20 2020 2020 2020 2065  nality.        e
+00020780: 7374 696d 6174 696f 6e20 746f 2063 6f6d  stimation to com
+00020790: 7075 7465 2074 6865 2061 7070 726f 7869  pute the approxi
+000207a0: 6d61 7465 206e 756d 6265 7220 6f66 2075  mate number of u
+000207b0: 6e69 7175 6520 726f 7773 2e0a 2020 2020  nique rows..    
+000207c0: 2020 2020 5468 6520 6170 7072 6f78 696d      The approxim
+000207d0: 6174 6520 6572 726f 7220 6973 2030 2e34  ate error is 0.4
+000207e0: 3036 252e 0a0a 2020 2020 2020 2020 5061  06%...        Pa
+000207f0: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00020800: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00020810: 2020 2020 7370 6c69 745f 6576 6572 7920      split_every 
+00020820: 3a20 696e 742c 206f 7074 696f 6e61 6c0a  : int, optional.
+00020830: 2020 2020 2020 2020 2020 2020 4772 6f75              Grou
+00020840: 7020 7061 7274 6974 696f 6e73 2069 6e74  p partitions int
+00020850: 6f20 6772 6f75 7073 206f 6620 7468 6973  o groups of this
+00020860: 2073 697a 6520 7768 696c 6520 7065 7266   size while perf
+00020870: 6f72 6d69 6e67 2061 0a20 2020 2020 2020  orming a.       
+00020880: 2020 2020 2074 7265 652d 7265 6475 6374       tree-reduct
+00020890: 696f 6e2e 2049 6620 7365 7420 746f 2046  ion. If set to F
+000208a0: 616c 7365 2c20 6e6f 2074 7265 652d 7265  alse, no tree-re
+000208b0: 6475 6374 696f 6e20 7769 6c6c 2062 6520  duction will be 
+000208c0: 7573 6564 2e0a 2020 2020 2020 2020 2020  used..          
+000208d0: 2020 4465 6661 756c 7420 6973 2038 2e0a    Default is 8..
+000208e0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000208f0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00020900: 0a20 2020 2020 2020 2061 2066 6c6f 6174  .        a float
+00020910: 2072 6570 7265 7365 6e74 696e 6720 7468   representing th
+00020920: 6520 6170 7072 6f78 696d 6174 6520 6e75  e approximate nu
+00020930: 6d62 6572 206f 6620 656c 656d 656e 7473  mber of elements
+00020940: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00020950: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
+00020960: 6174 6166 7261 6d65 2069 6d70 6f72 7420  ataframe import 
+00020970: 6879 7065 726c 6f67 6c6f 6720 2023 2068  hyperloglog  # h
+00020980: 6572 6520 746f 2061 766f 6964 2063 6972  ere to avoid cir
+00020990: 6375 6c61 7220 696d 706f 7274 2069 7373  cular import iss
+000209a0: 7565 730a 0a20 2020 2020 2020 2072 6574  ues..        ret
+000209b0: 7572 6e20 6163 6128 0a20 2020 2020 2020  urn aca(.       
+000209c0: 2020 2020 205b 7365 6c66 5d2c 0a20 2020       [self],.   
+000209d0: 2020 2020 2020 2020 2063 6875 6e6b 3d68           chunk=h
+000209e0: 7970 6572 6c6f 676c 6f67 2e63 6f6d 7075  yperloglog.compu
+000209f0: 7465 5f68 6c6c 5f61 7272 6179 2c0a 2020  te_hll_array,.  
+00020a00: 2020 2020 2020 2020 2020 636f 6d62 696e            combin
+00020a10: 653d 6879 7065 726c 6f67 6c6f 672e 7265  e=hyperloglog.re
+00020a20: 6475 6365 5f73 7461 7465 2c0a 2020 2020  duce_state,.    
+00020a30: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+00020a40: 653d 6879 7065 726c 6f67 6c6f 672e 6573  e=hyperloglog.es
+00020a50: 7469 6d61 7465 5f63 6f75 6e74 2c0a 2020  timate_count,.  
+00020a60: 2020 2020 2020 2020 2020 7370 6c69 745f            split_
+00020a70: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
+00020a80: 792c 0a20 2020 2020 2020 2020 2020 2062  y,.            b
+00020a90: 3d31 362c 0a20 2020 2020 2020 2020 2020  =16,.           
+00020aa0: 206d 6574 613d 666c 6f61 742c 0a20 2020   meta=float,.   
+00020ab0: 2020 2020 2029 0a0a 2020 2020 4070 726f       )..    @pro
+00020ac0: 7065 7274 790a 2020 2020 6465 6620 7661  perty.    def va
+00020ad0: 6c75 6573 2873 656c 6629 3a0a 2020 2020  lues(self):.    
+00020ae0: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
+00020af0: 6461 736b 2e61 7272 6179 206f 6620 7468  dask.array of th
+00020b00: 6520 7661 6c75 6573 206f 6620 7468 6973  e values of this
+00020b10: 2064 6174 6166 7261 6d65 0a0a 2020 2020   dataframe..    
+00020b20: 2020 2020 5761 726e 696e 673a 2054 6869      Warning: Thi
+00020b30: 7320 6372 6561 7465 7320 6120 6461 736b  s creates a dask
+00020b40: 2e61 7272 6179 2077 6974 686f 7574 2070  .array without p
+00020b50: 7265 6369 7365 2073 6861 7065 2069 6e66  recise shape inf
+00020b60: 6f72 6d61 7469 6f6e 2e0a 2020 2020 2020  ormation..      
+00020b70: 2020 4f70 6572 6174 696f 6e73 2074 6861    Operations tha
+00020b80: 7420 6465 7065 6e64 206f 6e20 7368 6170  t depend on shap
+00020b90: 6520 696e 666f 726d 6174 696f 6e2c 206c  e information, l
+00020ba0: 696b 6520 736c 6963 696e 6720 6f72 2072  ike slicing or r
+00020bb0: 6573 6861 7069 6e67 2c0a 2020 2020 2020  eshaping,.      
+00020bc0: 2020 7769 6c6c 206e 6f74 2077 6f72 6b2e    will not work.
+00020bd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00020be0: 2020 2020 2069 6620 6973 5f65 7874 656e       if is_exten
+00020bf0: 7369 6f6e 5f61 7272 6179 5f64 7479 7065  sion_array_dtype
+00020c00: 2873 656c 662e 5f6d 6574 612e 7661 6c75  (self._meta.valu
+00020c10: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+00020c20: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+00020c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c40: 2244 6173 6b20 6375 7272 656e 746c 7920  "Dask currently 
+00020c50: 6861 7320 6c69 6d69 7465 6420 7375 7070  has limited supp
+00020c60: 6f72 7420 666f 7220 636f 6e76 6572 7469  ort for converti
+00020c70: 6e67 2070 616e 6461 7320 6578 7465 6e73  ng pandas extens
+00020c80: 696f 6e20 6474 7970 6573 2022 0a20 2020  ion dtypes ".   
+00020c90: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+00020ca0: 6f20 6172 7261 7973 2e20 436f 6e76 6572  o arrays. Conver
+00020cb0: 7469 6e67 207b 7365 6c66 2e5f 6d65 7461  ting {self._meta
+00020cc0: 2e76 616c 7565 732e 6474 7970 657d 2074  .values.dtype} t
+00020cd0: 6f20 6f62 6a65 6374 2064 7479 7065 2e22  o object dtype."
+00020ce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020cf0: 2020 5573 6572 5761 726e 696e 672c 0a20    UserWarning,. 
+00020d00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00020d10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00020d20: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+00020d30: 6d65 7468 6f64 732e 7661 6c75 6573 290a  methods.values).
+00020d40: 0a20 2020 2064 6566 205f 7661 6c69 6461  .    def _valida
+00020d50: 7465 5f63 6875 6e6b 7328 7365 6c66 2c20  te_chunks(self, 
+00020d60: 6172 722c 206c 656e 6774 6873 293a 0a20  arr, lengths):. 
+00020d70: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+00020d80: 2e61 7272 6179 2e63 6f72 6520 696d 706f  .array.core impo
+00020d90: 7274 206e 6f72 6d61 6c69 7a65 5f63 6875  rt normalize_chu
+00020da0: 6e6b 730a 0a20 2020 2020 2020 2069 6620  nks..        if 
+00020db0: 6973 696e 7374 616e 6365 286c 656e 6774  isinstance(lengt
+00020dc0: 6873 2c20 5365 7175 656e 6365 293a 0a20  hs, Sequence):. 
+00020dd0: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
+00020de0: 6873 203d 2074 7570 6c65 286c 656e 6774  hs = tuple(lengt
+00020df0: 6873 290a 0a20 2020 2020 2020 2020 2020  hs)..           
+00020e00: 2069 6620 6c65 6e28 6c65 6e67 7468 7329   if len(lengths)
+00020e10: 2021 3d20 7365 6c66 2e6e 7061 7274 6974   != self.npartit
+00020e20: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
+00020e30: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00020e40: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00020e50: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00020e60: 206e 756d 6265 7220 6f66 2069 7465 6d73   number of items
+00020e70: 2069 6e20 276c 656e 6774 6873 2720 646f   in 'lengths' do
+00020e80: 6573 206e 6f74 206d 6174 6368 2074 6865  es not match the
+00020e90: 206e 756d 6265 7220 6f66 2022 0a20 2020   number of ".   
+00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020eb0: 2066 2270 6172 7469 7469 6f6e 732e 207b   f"partitions. {
+00020ec0: 6c65 6e28 6c65 6e67 7468 7329 7d20 213d  len(lengths)} !=
+00020ed0: 207b 7365 6c66 2e6e 7061 7274 6974 696f   {self.npartitio
+00020ee0: 6e73 7d22 0a20 2020 2020 2020 2020 2020  ns}".           
+00020ef0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00020f00: 2020 2020 6966 2073 656c 662e 6e64 696d      if self.ndim
+00020f10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00020f20: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
+00020f30: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
+00020f40: 2828 6c65 6e67 7468 732c 2929 0a20 2020  ((lengths,)).   
+00020f50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00020f60: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00020f70: 6875 6e6b 7320 3d20 6e6f 726d 616c 697a  hunks = normaliz
+00020f80: 655f 6368 756e 6b73 2828 6c65 6e67 7468  e_chunks((length
+00020f90: 732c 2028 6c65 6e28 7365 6c66 2e63 6f6c  s, (len(self.col
+00020fa0: 756d 6e73 292c 2929 290a 0a20 2020 2020  umns),)))..     
+00020fb0: 2020 2020 2020 2072 6574 7572 6e20 6368         return ch
+00020fc0: 756e 6b73 0a20 2020 2020 2020 2065 6c69  unks.        eli
+00020fd0: 6620 6c65 6e67 7468 7320 6973 206e 6f74  f lengths is not
+00020fe0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00020ff0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00021000: 726f 7228 6622 556e 6578 7065 6374 6564  ror(f"Unexpected
+00021010: 2076 616c 7565 2066 6f72 2027 6c65 6e67   value for 'leng
+00021020: 7468 7327 3a20 277b 6c65 6e67 7468 737d  ths': '{lengths}
+00021030: 2722 290a 0a20 2020 2020 2020 2072 6574  '")..        ret
+00021040: 7572 6e20 6172 722e 5f63 6875 6e6b 730a  urn arr._chunks.
+00021050: 0a20 2020 2064 6566 205f 6973 5f69 6e64  .    def _is_ind
+00021060: 6578 5f6c 6576 656c 5f72 6566 6572 656e  ex_level_referen
+00021070: 6365 2873 656c 662c 206b 6579 293a 0a20  ce(self, key):. 
+00021080: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00021090: 2020 2054 6573 7420 7768 6574 6865 7220     Test whether 
+000210a0: 6120 6b65 7920 6973 2061 6e20 696e 6465  a key is an inde
+000210b0: 7820 6c65 7665 6c20 7265 6665 7265 6e63  x level referenc
+000210c0: 650a 0a20 2020 2020 2020 2054 6f20 6265  e..        To be
+000210d0: 2063 6f6e 7369 6465 7265 6420 616e 2069   considered an i
+000210e0: 6e64 6578 206c 6576 656c 2072 6566 6572  ndex level refer
+000210f0: 656e 6365 2c20 606b 6579 6020 6d75 7374  ence, `key` must
+00021100: 206d 6174 6368 2074 6865 2069 6e64 6578   match the index
+00021110: 206e 616d 650a 2020 2020 2020 2020 616e   name.        an
+00021120: 6420 6d75 7374 204e 4f54 206d 6174 6368  d must NOT match
+00021130: 2074 6865 206e 616d 6520 6f66 2061 6e79   the name of any
+00021140: 2063 6f6c 756d 6e20 2869 6620 6120 6461   column (if a da
+00021150: 7461 6672 616d 6529 2e0a 2020 2020 2020  taframe)..      
+00021160: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00021170: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+00021180: 2020 2073 656c 662e 696e 6465 782e 6e61     self.index.na
+00021190: 6d65 2069 7320 6e6f 7420 4e6f 6e65 0a20  me is not None. 
+000211a0: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+000211b0: 6f74 2069 735f 6461 736b 5f63 6f6c 6c65  ot is_dask_colle
+000211c0: 6374 696f 6e28 6b65 7929 0a20 2020 2020  ction(key).     
+000211d0: 2020 2020 2020 2061 6e64 2028 6e70 2e69         and (np.i
+000211e0: 7373 6361 6c61 7228 6b65 7929 206f 7220  sscalar(key) or 
+000211f0: 6973 696e 7374 616e 6365 286b 6579 2c20  isinstance(key, 
+00021200: 7475 706c 6529 290a 2020 2020 2020 2020  tuple)).        
+00021210: 2020 2020 616e 6420 6b65 7920 3d3d 2073      and key == s
+00021220: 656c 662e 696e 6465 782e 6e61 6d65 0a20  elf.index.name. 
+00021230: 2020 2020 2020 2020 2020 2061 6e64 206b             and k
+00021240: 6579 206e 6f74 2069 6e20 6765 7461 7474  ey not in getatt
+00021250: 7228 7365 6c66 2c20 2263 6f6c 756d 6e73  r(self, "columns
+00021260: 222c 2028 2929 0a20 2020 2020 2020 2029  ", ()).        )
+00021270: 0a0a 2020 2020 6465 6620 5f63 6f6e 7461  ..    def _conta
+00021280: 696e 735f 696e 6465 785f 6e61 6d65 2873  ins_index_name(s
+00021290: 656c 662c 2063 6f6c 756d 6e73 5f6f 725f  elf, columns_or_
+000212a0: 696e 6465 7829 3a0a 2020 2020 2020 2020  index):.        
+000212b0: 2222 220a 2020 2020 2020 2020 5465 7374  """.        Test
+000212c0: 2077 6865 7468 6572 2074 6865 2069 6e70   whether the inp
+000212d0: 7574 2063 6f6e 7461 696e 7320 6120 7265  ut contains a re
+000212e0: 6665 7265 6e63 6520 746f 2074 6865 2069  ference to the i
+000212f0: 6e64 6578 206f 6620 7468 6520 4461 7461  ndex of the Data
+00021300: 4672 616d 652f 5365 7269 6573 0a20 2020  Frame/Series.   
+00021310: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00021320: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
+00021330: 6f6c 756d 6e73 5f6f 725f 696e 6465 782c  olumns_or_index,
+00021340: 206c 6973 7429 3a0a 2020 2020 2020 2020   list):.        
+00021350: 2020 2020 7265 7475 726e 2061 6e79 2873      return any(s
+00021360: 656c 662e 5f69 735f 696e 6465 785f 6c65  elf._is_index_le
+00021370: 7665 6c5f 7265 6665 7265 6e63 6528 6e29  vel_reference(n)
+00021380: 2066 6f72 206e 2069 6e20 636f 6c75 6d6e   for n in column
+00021390: 735f 6f72 5f69 6e64 6578 290a 2020 2020  s_or_index).    
+000213a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000213b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000213c0: 662e 5f69 735f 696e 6465 785f 6c65 7665  f._is_index_leve
+000213d0: 6c5f 7265 6665 7265 6e63 6528 636f 6c75  l_reference(colu
+000213e0: 6d6e 735f 6f72 5f69 6e64 6578 290a 0a0a  mns_or_index)...
+000213f0: 6465 6620 5f72 6169 7365 5f69 665f 6f62  def _raise_if_ob
+00021400: 6a65 6374 5f73 6572 6965 7328 782c 2066  ject_series(x, f
+00021410: 756e 636e 616d 6529 3a0a 2020 2020 2222  uncname):.    ""
+00021420: 220a 2020 2020 5574 696c 6974 7920 6675  ".    Utility fu
+00021430: 6e63 7469 6f6e 2074 6f20 7261 6973 6520  nction to raise 
+00021440: 616e 2065 7272 6f72 2069 6620 616e 206f  an error if an o
+00021450: 626a 6563 7420 636f 6c75 6d6e 2064 6f65  bject column doe
+00021460: 7320 6e6f 7420 7375 7070 6f72 740a 2020  s not support.  
+00021470: 2020 6120 6365 7274 6169 6e20 6f70 6572    a certain oper
+00021480: 6174 696f 6e20 6c69 6b65 2060 6d65 616e  ation like `mean
+00021490: 602e 0a20 2020 2022 2222 0a20 2020 2069  `..    """.    i
+000214a0: 6620 6973 696e 7374 616e 6365 2878 2c20  f isinstance(x, 
+000214b0: 5365 7269 6573 2920 616e 6420 6861 7361  Series) and hasa
+000214c0: 7474 7228 782c 2022 6474 7970 6522 293a  ttr(x, "dtype"):
+000214d0: 0a20 2020 2020 2020 2069 6620 782e 6474  .        if x.dt
+000214e0: 7970 6520 3d3d 206f 626a 6563 743a 0a20  ype == object:. 
+000214f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00021500: 2056 616c 7565 4572 726f 7228 2260 2573   ValueError("`%s
+00021510: 6020 6e6f 7420 7375 7070 6f72 7465 6420  ` not supported 
+00021520: 7769 7468 206f 626a 6563 7420 7365 7269  with object seri
+00021530: 6573 2220 2520 6675 6e63 6e61 6d65 290a  es" % funcname).
+00021540: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+00021550: 7374 7269 6e67 5f64 7479 7065 2878 293a  string_dtype(x):
+00021560: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00021570: 7365 2056 616c 7565 4572 726f 7228 2260  se ValueError("`
+00021580: 2573 6020 6e6f 7420 7375 7070 6f72 7465  %s` not supporte
+00021590: 6420 7769 7468 2073 7472 696e 6720 7365  d with string se
+000215a0: 7269 6573 2220 2520 6675 6e63 6e61 6d65  ries" % funcname
+000215b0: 290a 0a0a 636c 6173 7320 5365 7269 6573  )...class Series
+000215c0: 285f 4672 616d 6529 3a0a 2020 2020 2222  (_Frame):.    ""
+000215d0: 2250 6172 616c 6c65 6c20 5061 6e64 6173  "Parallel Pandas
+000215e0: 2053 6572 6965 730a 0a20 2020 2044 6f20   Series..    Do 
+000215f0: 6e6f 7420 7573 6520 7468 6973 2063 6c61  not use this cla
+00021600: 7373 2064 6972 6563 746c 792e 2020 496e  ss directly.  In
+00021610: 7374 6561 6420 7573 6520 6675 6e63 7469  stead use functi
+00021620: 6f6e 7320 6c69 6b65 0a20 2020 2060 6064  ons like.    ``d
+00021630: 642e 7265 6164 5f63 7376 6060 2c20 6060  d.read_csv``, ``
+00021640: 6464 2e72 6561 645f 7061 7271 7565 7460  dd.read_parquet`
+00021650: 602c 206f 7220 6060 6464 2e66 726f 6d5f  `, or ``dd.from_
+00021660: 7061 6e64 6173 6060 2e0a 0a20 2020 2050  pandas``...    P
+00021670: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00021680: 2d2d 2d2d 2d2d 2d2d 0a0a 2020 2020 6473  --------..    ds
+00021690: 6b3a 2064 6963 740a 2020 2020 2020 2020  k: dict.        
+000216a0: 5468 6520 6461 736b 2067 7261 7068 2074  The dask graph t
+000216b0: 6f20 636f 6d70 7574 6520 7468 6973 2053  o compute this S
+000216c0: 6572 6965 730a 2020 2020 5f6e 616d 653a  eries.    _name:
+000216d0: 2073 7472 0a20 2020 2020 2020 2054 6865   str.        The
+000216e0: 206b 6579 2070 7265 6669 7820 7468 6174   key prefix that
+000216f0: 2073 7065 6369 6669 6573 2077 6869 6368   specifies which
+00021700: 206b 6579 7320 696e 2074 6865 2064 6173   keys in the das
+00021710: 6b20 636f 6d70 7269 7365 2074 6869 730a  k comprise this.
+00021720: 2020 2020 2020 2020 7061 7274 6963 756c          particul
+00021730: 6172 2053 6572 6965 730a 2020 2020 6d65  ar Series.    me
+00021740: 7461 3a20 7061 6e64 6173 2e53 6572 6965  ta: pandas.Serie
+00021750: 730a 2020 2020 2020 2020 416e 2065 6d70  s.        An emp
+00021760: 7479 2060 6070 616e 6461 732e 5365 7269  ty ``pandas.Seri
+00021770: 6573 6060 2077 6974 6820 6e61 6d65 732c  es`` with names,
+00021780: 2064 7479 7065 732c 2061 6e64 2069 6e64   dtypes, and ind
+00021790: 6578 206d 6174 6368 696e 6720 7468 650a  ex matching the.
+000217a0: 2020 2020 2020 2020 6578 7065 6374 6564          expected
+000217b0: 206f 7574 7075 742e 0a20 2020 2064 6976   output..    div
+000217c0: 6973 696f 6e73 3a20 7475 706c 6520 6f66  isions: tuple of
+000217d0: 2069 6e64 6578 2076 616c 7565 730a 2020   index values.  
+000217e0: 2020 2020 2020 5661 6c75 6573 2061 6c6f        Values alo
+000217f0: 6e67 2077 6869 6368 2077 6520 7061 7274  ng which we part
+00021800: 6974 696f 6e20 6f75 7220 626c 6f63 6b73  ition our blocks
+00021810: 206f 6e20 7468 6520 696e 6465 780a 0a20   on the index.. 
+00021820: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00021830: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6173  --------.    das
+00021840: 6b2e 6461 7461 6672 616d 652e 4461 7461  k.dataframe.Data
+00021850: 4672 616d 650a 2020 2020 2222 220a 0a20  Frame.    """.. 
+00021860: 2020 205f 7061 7274 6974 696f 6e5f 7479     _partition_ty
+00021870: 7065 203d 2070 642e 5365 7269 6573 0a20  pe = pd.Series. 
+00021880: 2020 205f 6973 5f70 6172 7469 7469 6f6e     _is_partition
+00021890: 5f74 7970 6520 3d20 7374 6174 6963 6d65  _type = staticme
+000218a0: 7468 6f64 2869 735f 7365 7269 6573 5f6c  thod(is_series_l
+000218b0: 696b 6529 0a20 2020 205f 746f 6b65 6e5f  ike).    _token_
+000218c0: 7072 6566 6978 203d 2022 7365 7269 6573  prefix = "series
+000218d0: 2d22 0a20 2020 205f 6163 6365 7373 6f72  -".    _accessor
+000218e0: 733a 2043 6c61 7373 5661 725b 7365 745b  s: ClassVar[set[
+000218f0: 7374 725d 5d20 3d20 7365 7428 290a 0a20  str]] = set().. 
+00021900: 2020 2064 6566 205f 5f61 7272 6179 5f77     def __array_w
+00021910: 7261 705f 5f28 7365 6c66 2c20 6172 7261  rap__(self, arra
+00021920: 792c 2063 6f6e 7465 7874 3d4e 6f6e 6529  y, context=None)
+00021930: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+00021940: 6e73 7461 6e63 6528 636f 6e74 6578 742c  nstance(context,
+00021950: 2074 7570 6c65 2920 616e 6420 6c65 6e28   tuple) and len(
+00021960: 636f 6e74 6578 7429 203e 2030 3a0a 2020  context) > 0:.  
+00021970: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00021980: 6e73 7461 6e63 6528 636f 6e74 6578 745b  nstance(context[
+00021990: 315d 5b30 5d2c 206e 702e 6e64 6172 7261  1][0], np.ndarra
+000219a0: 7929 2061 6e64 2063 6f6e 7465 7874 5b31  y) and context[1
+000219b0: 5d5b 305d 2e73 6861 7065 203d 3d20 2829  ][0].shape == ()
+000219c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000219d0: 2020 696e 6465 7820 3d20 4e6f 6e65 0a20    index = None. 
+000219e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000219f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021a00: 2069 6e64 6578 203d 2063 6f6e 7465 7874   index = context
+00021a10: 5b31 5d5b 305d 2e69 6e64 6578 0a20 2020  [1][0].index.   
+00021a20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00021a30: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00021a40: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00021a50: 7274 2069 6e73 7065 6374 0a0a 2020 2020  rt inspect..    
+00021a60: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00021a70: 6f64 5f6e 616d 6520 3d20 6622 607b 696e  od_name = f"`{in
+00021a80: 7370 6563 742e 7374 6163 6b28 295b 335d  spect.stack()[3]
+00021a90: 5b33 5d7d 6022 0a20 2020 2020 2020 2020  [3]}`".         
+00021aa0: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
+00021ab0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00021ac0: 2020 2020 2020 6d65 7468 6f64 5f6e 616d        method_nam
+00021ad0: 6520 3d20 2254 6869 7320 6d65 7468 6f64  e = "This method
+00021ae0: 220a 2020 2020 2020 2020 2020 2020 7261  ".            ra
+00021af0: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
+00021b00: 6564 4572 726f 7228 0a20 2020 2020 2020  edError(.       
+00021b10: 2020 2020 2020 2020 2066 227b 6d65 7468           f"{meth
+00021b20: 6f64 5f6e 616d 657d 2069 7320 6e6f 7420  od_name} is not 
+00021b30: 696d 706c 656d 656e 7465 6420 666f 7220  implemented for 
+00021b40: 6064 6173 6b2e 6461 7461 6672 616d 652e  `dask.dataframe.
+00021b50: 5365 7269 6573 602e 220a 2020 2020 2020  Series`.".      
+00021b60: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00021b70: 2072 6574 7572 6e20 6d65 7461 5f73 6572   return meta_ser
+00021b80: 6965 735f 636f 6e73 7472 7563 746f 7228  ies_constructor(
+00021b90: 7365 6c66 2928 6172 7261 792c 2069 6e64  self)(array, ind
+00021ba0: 6578 3d69 6e64 6578 2c20 6e61 6d65 3d73  ex=index, name=s
+00021bb0: 656c 662e 6e61 6d65 290a 0a20 2020 2040  elf.name)..    @
+00021bc0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00021bd0: 2061 7865 7328 7365 6c66 293a 0a20 2020   axes(self):.   
+00021be0: 2020 2020 2072 6574 7572 6e20 5b73 656c       return [sel
+00021bf0: 662e 696e 6465 785d 0a0a 2020 2020 4070  f.index]..    @p
+00021c00: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00021c10: 6e61 6d65 2873 656c 6629 3a0a 2020 2020  name(self):.    
+00021c20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00021c30: 5f6d 6574 612e 6e61 6d65 0a0a 2020 2020  _meta.name..    
+00021c40: 406e 616d 652e 7365 7474 6572 0a20 2020  @name.setter.   
+00021c50: 2064 6566 206e 616d 6528 7365 6c66 2c20   def name(self, 
+00021c60: 6e61 6d65 293a 0a20 2020 2020 2020 2073  name):.        s
+00021c70: 656c 662e 5f6d 6574 612e 6e61 6d65 203d  elf._meta.name =
+00021c80: 206e 616d 650a 2020 2020 2020 2020 7265   name.        re
+00021c90: 6e61 6d65 6420 3d20 5f72 656e 616d 655f  named = _rename_
+00021ca0: 6461 736b 2873 656c 662c 206e 616d 6529  dask(self, name)
+00021cb0: 0a20 2020 2020 2020 2023 2075 7064 6174  .        # updat
+00021cc0: 6520 6d79 7365 6c66 0a20 2020 2020 2020  e myself.       
+00021cd0: 2073 656c 662e 6461 736b 203d 2072 656e   self.dask = ren
+00021ce0: 616d 6564 2e64 6173 6b0a 2020 2020 2020  amed.dask.      
+00021cf0: 2020 7365 6c66 2e5f 6e61 6d65 203d 2072    self._name = r
+00021d00: 656e 616d 6564 2e5f 6e61 6d65 0a0a 2020  enamed._name..  
+00021d10: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00021d20: 6465 6620 6e64 696d 2873 656c 6629 3a0a  def ndim(self):.
+00021d30: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00021d40: 6e20 6469 6d65 6e73 696f 6e61 6c69 7479  n dimensionality
+00021d50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00021d60: 726e 2031 0a0a 2020 2020 4070 726f 7065  rn 1..    @prope
+00021d70: 7274 790a 2020 2020 6465 6620 7368 6170  rty.    def shap
+00021d80: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00021d90: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+00021da0: 7572 6e20 6120 7475 706c 6520 7265 7072  urn a tuple repr
+00021db0: 6573 656e 7469 6e67 2074 6865 2064 696d  esenting the dim
+00021dc0: 656e 7369 6f6e 616c 6974 7920 6f66 2061  ensionality of a
+00021dd0: 2053 6572 6965 732e 0a0a 2020 2020 2020   Series...      
+00021de0: 2020 5468 6520 7369 6e67 6c65 2065 6c65    The single ele
+00021df0: 6d65 6e74 206f 6620 7468 6520 7475 706c  ment of the tupl
+00021e00: 6520 6973 2061 2044 656c 6179 6564 2072  e is a Delayed r
+00021e10: 6573 756c 742e 0a0a 2020 2020 2020 2020  esult...        
+00021e20: 4578 616d 706c 6573 0a20 2020 2020 2020  Examples.       
+00021e30: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00021e40: 2020 3e3e 3e20 7365 7269 6573 2e73 6861    >>> series.sha
+00021e50: 7065 2020 2320 646f 6374 6573 743a 202b  pe  # doctest: +
+00021e60: 534b 4950 0a20 2020 2020 2020 2028 6464  SKIP.        (dd
+00021e70: 2e53 6361 6c61 723c 7369 7a65 2d61 672e  .Scalar<size-ag.
+00021e80: 2e2e 2c20 6474 7970 653d 696e 7436 343e  .., dtype=int64>
+00021e90: 2c29 0a20 2020 2020 2020 2022 2222 0a20  ,).        """. 
+00021ea0: 2020 2020 2020 2072 6574 7572 6e20 2873         return (s
+00021eb0: 656c 662e 7369 7a65 2c29 0a0a 2020 2020  elf.size,)..    
+00021ec0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00021ed0: 6620 6474 7970 6528 7365 6c66 293a 0a20  f dtype(self):. 
+00021ee0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00021ef0: 2064 6174 6120 7479 7065 2222 220a 2020   data type""".  
+00021f00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00021f10: 662e 5f6d 6574 612e 6474 7970 650a 0a20  f._meta.dtype.. 
+00021f20: 2020 2064 7420 3d20 4361 6368 6564 4163     dt = CachedAc
+00021f30: 6365 7373 6f72 2822 6474 222c 2044 6174  cessor("dt", Dat
+00021f40: 6574 696d 6541 6363 6573 736f 7229 0a0a  etimeAccessor)..
+00021f50: 2020 2020 6361 7420 3d20 4361 6368 6564      cat = Cached
+00021f60: 4163 6365 7373 6f72 2822 6361 7422 2c20  Accessor("cat", 
+00021f70: 4361 7465 676f 7269 6361 6c41 6363 6573  CategoricalAcces
+00021f80: 736f 7229 0a0a 2020 2020 7374 7220 3d20  sor)..    str = 
+00021f90: 4361 6368 6564 4163 6365 7373 6f72 2822  CachedAccessor("
+00021fa0: 7374 7222 2c20 5374 7269 6e67 4163 6365  str", StringAcce
+00021fb0: 7373 6f72 290a 0a20 2020 2064 6566 205f  ssor)..    def _
+00021fc0: 5f64 6972 5f5f 2873 656c 6629 3a0a 2020  _dir__(self):.  
+00021fd0: 2020 2020 2020 6f20 3d20 7365 7428 6469        o = set(di
+00021fe0: 7228 7479 7065 2873 656c 6629 2929 0a20  r(type(self))). 
+00021ff0: 2020 2020 2020 206f 2e75 7064 6174 6528         o.update(
+00022000: 7365 6c66 2e5f 5f64 6963 745f 5f29 0a20  self.__dict__). 
+00022010: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+00022020: 7468 6520 6063 6174 6020 616e 6420 6073  the `cat` and `s
+00022030: 7472 6020 6163 6365 7373 6f72 7320 6966  tr` accessors if
+00022040: 206e 6f74 2061 7661 696c 6162 6c65 2e20   not available. 
+00022050: 5765 2063 616e 2774 0a20 2020 2020 2020  We can't.       
+00022060: 2023 2064 6563 6964 6520 7468 6973 2073   # decide this s
+00022070: 7461 7469 6361 6c6c 7920 666f 7220 7468  tatically for th
+00022080: 6520 6064 7460 2061 6363 6573 736f 722c  e `dt` accessor,
+00022090: 2061 7320 6974 2077 6f72 6b73 206f 6e0a   as it works on.
+000220a0: 2020 2020 2020 2020 2320 6461 7465 7469          # dateti
+000220b0: 6d65 2d6c 696b 6520 7468 696e 6773 2061  me-like things a
+000220c0: 7320 7765 6c6c 2e0a 2020 2020 2020 2020  s well..        
+000220d0: 666f 7220 6163 6365 7373 6f72 2069 6e20  for accessor in 
+000220e0: 5b22 6361 7422 2c20 2273 7472 225d 3a0a  ["cat", "str"]:.
+000220f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00022100: 6f74 2068 6173 6174 7472 2873 656c 662e  ot hasattr(self.
+00022110: 5f6d 6574 612c 2061 6363 6573 736f 7229  _meta, accessor)
+00022120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00022130: 2020 6f2e 7265 6d6f 7665 2861 6363 6573    o.remove(acces
+00022140: 736f 7229 0a20 2020 2020 2020 2072 6574  sor).        ret
+00022150: 7572 6e20 6c69 7374 286f 290a 0a20 2020  urn list(o)..   
+00022160: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00022170: 6566 206e 6279 7465 7328 7365 6c66 293a  ef nbytes(self):
+00022180: 0a20 2020 2020 2020 2022 2222 4e75 6d62  .        """Numb
+00022190: 6572 206f 6620 6279 7465 7322 2222 0a20  er of bytes""". 
+000221a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000221b0: 6c66 2e72 6564 7563 7469 6f6e 280a 2020  lf.reduction(.  
+000221c0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+000221d0: 732e 6e62 7974 6573 2c20 6e70 2e73 756d  s.nbytes, np.sum
+000221e0: 2c20 746f 6b65 6e3d 226e 6279 7465 7322  , token="nbytes"
+000221f0: 2c20 6d65 7461 3d69 6e74 2c20 7370 6c69  , meta=int, spli
+00022200: 745f 6576 6572 793d 4661 6c73 650a 2020  t_every=False.  
+00022210: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00022220: 205f 7265 7072 5f64 6174 6128 7365 6c66   _repr_data(self
+00022230: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00022240: 6e20 5f72 6570 725f 6461 7461 5f73 6572  n _repr_data_ser
+00022250: 6965 7328 7365 6c66 2e5f 6d65 7461 2c20  ies(self._meta, 
+00022260: 7365 6c66 2e5f 7265 7072 5f64 6976 6973  self._repr_divis
+00022270: 696f 6e73 290a 0a20 2020 2064 6566 205f  ions)..    def _
+00022280: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
+00022290: 2020 2020 2020 2022 2222 6861 7665 2074         """have t
+000222a0: 6f20 6f76 6572 7772 6974 6520 666f 6f74  o overwrite foot
+000222b0: 6572 2222 220a 2020 2020 2020 2020 6966  er""".        if
+000222c0: 2073 656c 662e 6e61 6d65 2069 7320 6e6f   self.name is no
+000222d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000222e0: 2020 2020 666f 6f74 6572 203d 2066 224e      footer = f"N
+000222f0: 616d 653a 207b 7365 6c66 2e6e 616d 657d  ame: {self.name}
+00022300: 2c20 6474 7970 653a 207b 7365 6c66 2e64  , dtype: {self.d
+00022310: 7479 7065 7d22 0a20 2020 2020 2020 2065  type}".        e
+00022320: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022330: 2066 6f6f 7465 7220 3d20 6622 6474 7970   footer = f"dtyp
+00022340: 653a 207b 7365 6c66 2e64 7479 7065 7d22  e: {self.dtype}"
+00022350: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00022360: 2022 2222 4461 736b 207b 6b6c 6173 737d   """Dask {klass}
+00022370: 2053 7472 7563 7475 7265 3a0a 7b64 6174   Structure:.{dat
+00022380: 617d 0a7b 666f 6f74 6572 7d0a 4461 736b  a}.{footer}.Dask
+00022390: 204e 616d 653a 207b 6e61 6d65 7d2c 207b   Name: {name}, {
+000223a0: 6c61 7965 7273 7d22 2222 2e66 6f72 6d61  layers}""".forma
+000223b0: 7428 0a20 2020 2020 2020 2020 2020 206b  t(.            k
+000223c0: 6c61 7373 3d73 656c 662e 5f5f 636c 6173  lass=self.__clas
+000223d0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c0a 2020  s__.__name__,.  
+000223e0: 2020 2020 2020 2020 2020 6461 7461 3d73            data=s
+000223f0: 656c 662e 746f 5f73 7472 696e 6728 292c  elf.to_string(),
+00022400: 0a20 2020 2020 2020 2020 2020 2066 6f6f  .            foo
+00022410: 7465 723d 666f 6f74 6572 2c0a 2020 2020  ter=footer,.    
+00022420: 2020 2020 2020 2020 6e61 6d65 3d6b 6579          name=key
+00022430: 5f73 706c 6974 2873 656c 662e 5f6e 616d  _split(self._nam
+00022440: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00022450: 6c61 7965 7273 3d6d 6179 6265 5f70 6c75  layers=maybe_plu
+00022460: 7261 6c69 7a65 286c 656e 2873 656c 662e  ralize(len(self.
+00022470: 6461 736b 2e6c 6179 6572 7329 2c20 2267  dask.layers), "g
+00022480: 7261 7068 206c 6179 6572 2229 2c0a 2020  raph layer"),.  
+00022490: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+000224a0: 2072 656e 616d 6528 7365 6c66 2c20 696e   rename(self, in
+000224b0: 6465 783d 4e6f 6e65 2c20 696e 706c 6163  dex=None, inplac
+000224c0: 653d 4661 6c73 652c 2073 6f72 7465 645f  e=False, sorted_
+000224d0: 696e 6465 783d 4661 6c73 6529 3a0a 2020  index=False):.  
+000224e0: 2020 2020 2020 2222 2241 6c74 6572 2053        """Alter S
+000224f0: 6572 6965 7320 696e 6465 7820 6c61 6265  eries index labe
+00022500: 6c73 206f 7220 6e61 6d65 0a0a 2020 2020  ls or name..    
+00022510: 2020 2020 4675 6e63 7469 6f6e 202f 2064      Function / d
+00022520: 6963 7420 7661 6c75 6573 206d 7573 7420  ict values must 
+00022530: 6265 2075 6e69 7175 6520 2831 2d74 6f2d  be unique (1-to-
+00022540: 3129 2e20 4c61 6265 6c73 206e 6f74 2063  1). Labels not c
+00022550: 6f6e 7461 696e 6564 2069 6e0a 2020 2020  ontained in.    
+00022560: 2020 2020 6120 6469 6374 202f 2053 6572      a dict / Ser
+00022570: 6965 7320 7769 6c6c 2062 6520 6c65 6674  ies will be left
+00022580: 2061 732d 6973 2e20 4578 7472 6120 6c61   as-is. Extra la
+00022590: 6265 6c73 206c 6973 7465 6420 646f 6e27  bels listed don'
+000225a0: 7420 7468 726f 7720 616e 0a20 2020 2020  t throw an.     
+000225b0: 2020 2065 7272 6f72 2e0a 0a20 2020 2020     error...     
+000225c0: 2020 2041 6c74 6572 6e61 7469 7665 6c79     Alternatively
+000225d0: 2c20 6368 616e 6765 2060 6053 6572 6965  , change ``Serie
+000225e0: 732e 6e61 6d65 6060 2077 6974 6820 6120  s.name`` with a 
+000225f0: 7363 616c 6172 2076 616c 7565 2e0a 0a20  scalar value... 
+00022600: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00022610: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00022620: 2d2d 2d2d 0a20 2020 2020 2020 2069 6e64  ----.        ind
+00022630: 6578 203a 2073 6361 6c61 722c 2068 6173  ex : scalar, has
+00022640: 6861 626c 6520 7365 7175 656e 6365 2c20  hable sequence, 
+00022650: 6469 6374 2d6c 696b 6520 6f72 2063 616c  dict-like or cal
+00022660: 6c61 626c 652c 206f 7074 696f 6e61 6c0a  lable, optional.
+00022670: 2020 2020 2020 2020 2020 2020 4966 2064              If d
+00022680: 6963 742d 6c69 6b65 206f 7220 6361 6c6c  ict-like or call
+00022690: 6162 6c65 2c20 7468 6520 7472 616e 7366  able, the transf
+000226a0: 6f72 6d61 7469 6f6e 2069 7320 6170 706c  ormation is appl
+000226b0: 6965 6420 746f 2074 6865 0a20 2020 2020  ied to the.     
+000226c0: 2020 2020 2020 2069 6e64 6578 2e20 5363         index. Sc
+000226d0: 616c 6172 206f 7220 6861 7368 6162 6c65  alar or hashable
+000226e0: 2073 6571 7565 6e63 652d 6c69 6b65 2077   sequence-like w
+000226f0: 696c 6c20 616c 7465 7220 7468 650a 2020  ill alter the.  
+00022700: 2020 2020 2020 2020 2020 6060 5365 7269            ``Seri
+00022710: 6573 2e6e 616d 6560 6020 6174 7472 6962  es.name`` attrib
+00022720: 7574 652e 0a20 2020 2020 2020 2069 6e70  ute..        inp
+00022730: 6c61 6365 203a 2062 6f6f 6c65 616e 2c20  lace : boolean, 
+00022740: 6465 6661 756c 7420 4661 6c73 650a 2020  default False.  
+00022750: 2020 2020 2020 2020 2020 5768 6574 6865            Whethe
+00022760: 7220 746f 2072 6574 7572 6e20 6120 6e65  r to return a ne
+00022770: 7720 5365 7269 6573 206f 7220 6d6f 6469  w Series or modi
+00022780: 6679 2074 6869 7320 6f6e 6520 696e 706c  fy this one inpl
+00022790: 6163 652e 0a20 2020 2020 2020 2073 6f72  ace..        sor
+000227a0: 7465 645f 696e 6465 7820 3a20 626f 6f6c  ted_index : bool
+000227b0: 2c20 6465 6661 756c 7420 4661 6c73 650a  , default False.
+000227c0: 2020 2020 2020 2020 2020 2020 4966 2074              If t
+000227d0: 7275 652c 2074 6865 206f 7574 7075 7420  rue, the output 
+000227e0: 6060 5365 7269 6573 6060 2077 696c 6c20  ``Series`` will 
+000227f0: 6861 7665 206b 6e6f 776e 2064 6976 6973  have known divis
+00022800: 696f 6e73 2069 6e66 6572 7265 640a 2020  ions inferred.  
+00022810: 2020 2020 2020 2020 2020 6672 6f6d 2074            from t
+00022820: 6865 2069 6e70 7574 2073 6572 6965 7320  he input series 
+00022830: 616e 6420 7468 6520 7472 616e 7366 6f72  and the transfor
+00022840: 6d61 7469 6f6e 2e20 4967 6e6f 7265 6420  mation. Ignored 
+00022850: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00022860: 6e6f 6e2d 6361 6c6c 6162 6c65 2f64 6963  non-callable/dic
+00022870: 742d 6c69 6b65 2060 6069 6e64 6578 6060  t-like ``index``
+00022880: 206f 7220 7768 656e 2074 6865 2069 6e70   or when the inp
+00022890: 7574 2073 6572 6965 7320 6861 730a 2020  ut series has.  
+000228a0: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
+000228b0: 6e20 6469 7669 7369 6f6e 732e 204e 6f74  n divisions. Not
+000228c0: 6520 7468 6174 2074 6869 7320 6d61 7920  e that this may 
+000228d0: 6f6e 6c79 2062 6520 7365 7420 746f 2060  only be set to `
+000228e0: 6054 7275 6560 6020 6966 0a20 2020 2020  `True`` if.     
+000228f0: 2020 2020 2020 2079 6f75 206b 6e6f 7720         you know 
+00022900: 7468 6174 2074 6865 2074 7261 6e73 666f  that the transfo
+00022910: 726d 6564 2069 6e64 6578 2069 7320 6d6f  rmed index is mo
+00022920: 6e6f 746f 6e69 6361 6c6c 7920 696e 6372  notonically incr
+00022930: 6561 7369 6e67 2e20 4461 736b 0a20 2020  easing. Dask.   
+00022940: 2020 2020 2020 2020 2077 696c 6c20 6368           will ch
+00022950: 6563 6b20 7468 6174 2074 7261 6e73 666f  eck that transfo
+00022960: 726d 6564 2064 6976 6973 696f 6e73 2061  rmed divisions a
+00022970: 7265 206d 6f6e 6f74 6f6e 6963 2c20 6275  re monotonic, bu
+00022980: 7420 6361 6e6e 6f74 0a20 2020 2020 2020  t cannot.       
+00022990: 2020 2020 2063 6865 636b 2061 6c6c 2074       check all t
+000229a0: 6865 2076 616c 7565 7320 6265 7477 6565  he values betwee
+000229b0: 6e20 6469 7669 7369 6f6e 732c 2073 6f20  n divisions, so 
+000229c0: 696e 636f 7272 6563 746c 7920 7365 7474  incorrectly sett
+000229d0: 696e 6720 7468 6973 0a20 2020 2020 2020  ing this.       
+000229e0: 2020 2020 2063 616e 2072 6573 756c 7420       can result 
+000229f0: 696e 2062 7567 732e 0a0a 2020 2020 2020  in bugs...      
+00022a00: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00022a10: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 2020    -------.      
+00022a20: 2020 7265 6e61 6d65 6420 3a20 5365 7269    renamed : Seri
+00022a30: 6573 0a0a 2020 2020 2020 2020 5365 6520  es..        See 
+00022a40: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00022a50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7061  -----.        pa
+00022a60: 6e64 6173 2e53 6572 6965 732e 7265 6e61  ndas.Series.rena
+00022a70: 6d65 0a20 2020 2020 2020 2022 2222 0a20  me.        """. 
+00022a80: 2020 2020 2020 2066 726f 6d20 7061 6e64         from pand
+00022a90: 6173 2e61 7069 2e74 7970 6573 2069 6d70  as.api.types imp
+00022aa0: 6f72 7420 6973 5f64 6963 745f 6c69 6b65  ort is_dict_like
+00022ab0: 2c20 6973 5f6c 6973 745f 6c69 6b65 2c20  , is_list_like, 
+00022ac0: 6973 5f73 6361 6c61 720a 0a20 2020 2020  is_scalar..     
+00022ad0: 2020 2069 6d70 6f72 7420 6461 736b 2e64     import dask.d
+00022ae0: 6174 6166 7261 6d65 2061 7320 6464 0a0a  ataframe as dd..
+00022af0: 2020 2020 2020 2020 6966 2069 735f 7363          if is_sc
+00022b00: 616c 6172 2869 6e64 6578 2920 6f72 2028  alar(index) or (
+00022b10: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
+00022b20: 6c69 7374 5f6c 696b 6528 696e 6465 7829  list_like(index)
+00022b30: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00022b40: 206e 6f74 2069 735f 6469 6374 5f6c 696b   not is_dict_lik
+00022b50: 6528 696e 6465 7829 0a20 2020 2020 2020  e(index).       
+00022b60: 2020 2020 2061 6e64 206e 6f74 2069 7369       and not isi
+00022b70: 6e73 7461 6e63 6528 696e 6465 782c 2064  nstance(index, d
+00022b80: 642e 5365 7269 6573 290a 2020 2020 2020  d.Series).      
+00022b90: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00022ba0: 2069 6620 696e 706c 6163 653a 0a20 2020   if inplace:.   
+00022bb0: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00022bc0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+00022bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022be0: 2227 696e 706c 6163 6527 2061 7267 756d  "'inplace' argum
+00022bf0: 656e 7420 666f 7220 6461 736b 2073 6572  ent for dask ser
+00022c00: 6965 7320 7769 6c6c 2062 6520 7265 6d6f  ies will be remo
+00022c10: 7665 6420 696e 2066 7574 7572 6520 7665  ved in future ve
+00022c20: 7273 696f 6e73 222c 0a20 2020 2020 2020  rsions",.       
+00022c30: 2020 2020 2020 2020 2020 2020 2050 656e               Pen
+00022c40: 6469 6e67 4465 7072 6563 6174 696f 6e57  dingDeprecationW
+00022c50: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+00022c60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022c70: 2020 2020 2020 7265 7320 3d20 7365 6c66        res = self
+00022c80: 2069 6620 696e 706c 6163 6520 656c 7365   if inplace else
+00022c90: 2073 656c 662e 636f 7079 2829 0a20 2020   self.copy().   
+00022ca0: 2020 2020 2020 2020 2072 6573 2e6e 616d           res.nam
+00022cb0: 6520 3d20 696e 6465 780a 2020 2020 2020  e = index.      
+00022cc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00022cd0: 2020 2020 7265 7320 3d20 7365 6c66 2e6d      res = self.m
+00022ce0: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+00022cf0: 7265 6e61 6d65 2c20 696e 6465 782c 2065  rename, index, e
+00022d00: 6e66 6f72 6365 5f6d 6574 6164 6174 613d  nforce_metadata=
+00022d10: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00022d20: 2020 2069 6620 7365 6c66 2e6b 6e6f 776e     if self.known
+00022d30: 5f64 6976 6973 696f 6e73 3a0a 2020 2020  _divisions:.    
+00022d40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00022d50: 6f72 7465 645f 696e 6465 7820 616e 6420  orted_index and 
+00022d60: 2863 616c 6c61 626c 6528 696e 6465 7829  (callable(index)
+00022d70: 206f 7220 6973 5f64 6963 745f 6c69 6b65   or is_dict_like
+00022d80: 2869 6e64 6578 2929 3a0a 2020 2020 2020  (index)):.      
+00022d90: 2020 2020 2020 2020 2020 2020 2020 6f6c                ol
+00022da0: 6420 3d20 7064 2e53 6572 6965 7328 7261  d = pd.Series(ra
+00022db0: 6e67 6528 7365 6c66 2e6e 7061 7274 6974  nge(self.npartit
+00022dc0: 696f 6e73 202b 2031 292c 2069 6e64 6578  ions + 1), index
+00022dd0: 3d73 656c 662e 6469 7669 7369 6f6e 7329  =self.divisions)
+00022de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022df0: 2020 2020 206e 6577 203d 206f 6c64 2e72       new = old.r
+00022e00: 656e 616d 6528 696e 6465 7829 2e69 6e64  ename(index).ind
+00022e10: 6578 0a20 2020 2020 2020 2020 2020 2020  ex.             
+00022e20: 2020 2020 2020 2069 6620 6e6f 7420 6e65         if not ne
+00022e30: 772e 6973 5f6d 6f6e 6f74 6f6e 6963 5f69  w.is_monotonic_i
+00022e40: 6e63 7265 6173 696e 673a 0a20 2020 2020  ncreasing:.     
+00022e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e60: 2020 206d 7367 203d 2028 0a20 2020 2020     msg = (.     
+00022e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022e80: 2020 2020 2020 2022 736f 7274 6564 5f69         "sorted_i
+00022e90: 6e64 6578 3d54 7275 652c 2062 7574 2074  ndex=True, but t
+00022ea0: 6865 2074 7261 6e73 666f 726d 6564 2069  he transformed i
+00022eb0: 6e64 6578 2022 0a20 2020 2020 2020 2020  ndex ".         
+00022ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ed0: 2020 2022 6973 6e27 7420 6d6f 6e6f 746f     "isn't monoto
+00022ee0: 6e69 635f 696e 6372 6561 7369 6e67 220a  nic_increasing".
+00022ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f00: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00022f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022f20: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00022f30: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
+00022f40: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00022f50: 5f64 6976 6973 696f 6e73 203d 2074 7570  _divisions = tup
+00022f60: 6c65 286d 6574 686f 6473 2e74 6f6c 6973  le(methods.tolis
+00022f70: 7428 6e65 7729 290a 2020 2020 2020 2020  t(new)).        
+00022f80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00022f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022fa0: 2020 7265 7320 3d20 7265 732e 636c 6561    res = res.clea
+00022fb0: 725f 6469 7669 7369 6f6e 7328 290a 2020  r_divisions().  
+00022fc0: 2020 2020 2020 2020 2020 6966 2069 6e70            if inp
+00022fd0: 6c61 6365 3a0a 2020 2020 2020 2020 2020  lace:.          
+00022fe0: 2020 2020 2020 7365 6c66 2e64 6173 6b20        self.dask 
+00022ff0: 3d20 7265 732e 6461 736b 0a20 2020 2020  = res.dask.     
+00023000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00023010: 5f6e 616d 6520 3d20 7265 732e 5f6e 616d  _name = res._nam
+00023020: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00023030: 2020 7365 6c66 2e5f 6469 7669 7369 6f6e    self._division
+00023040: 7320 3d20 7265 732e 6469 7669 7369 6f6e  s = res.division
+00023050: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00023060: 2020 7365 6c66 2e5f 6d65 7461 203d 2072    self._meta = r
+00023070: 6573 2e5f 6d65 7461 0a20 2020 2020 2020  es._meta.       
+00023080: 2020 2020 2020 2020 2072 6573 203d 2073           res = s
+00023090: 656c 660a 2020 2020 2020 2020 7265 7475  elf.        retu
+000230a0: 726e 2072 6573 0a0a 2020 2020 4064 6572  rn res..    @der
+000230b0: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
+000230c0: 6965 7329 0a20 2020 2064 6566 2072 6f75  ies).    def rou
+000230d0: 6e64 2873 656c 662c 2064 6563 696d 616c  nd(self, decimal
+000230e0: 733d 3029 3a0a 2020 2020 2020 2020 7265  s=0):.        re
+000230f0: 7475 726e 2065 6c65 6d77 6973 6528 4d2e  turn elemwise(M.
+00023100: 726f 756e 642c 2073 656c 662c 2064 6563  round, self, dec
+00023110: 696d 616c 7329 0a0a 2020 2020 4064 6572  imals)..    @der
+00023120: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
+00023130: 6965 7329 0a20 2020 2064 6566 2074 6f5f  ies).    def to_
+00023140: 7469 6d65 7374 616d 7028 7365 6c66 2c20  timestamp(self, 
+00023150: 6672 6571 3d4e 6f6e 652c 2068 6f77 3d22  freq=None, how="
+00023160: 7374 6172 7422 2c20 6178 6973 3d30 293a  start", axis=0):
+00023170: 0a20 2020 2020 2020 2064 6620 3d20 656c  .        df = el
+00023180: 656d 7769 7365 284d 2e74 6f5f 7469 6d65  emwise(M.to_time
+00023190: 7374 616d 702c 2073 656c 662c 2066 7265  stamp, self, fre
+000231a0: 712c 2068 6f77 2c20 6178 6973 290a 2020  q, how, axis).  
+000231b0: 2020 2020 2020 6466 2e64 6976 6973 696f        df.divisio
+000231c0: 6e73 203d 2074 7570 6c65 2870 642e 496e  ns = tuple(pd.In
+000231d0: 6465 7828 7365 6c66 2e64 6976 6973 696f  dex(self.divisio
+000231e0: 6e73 292e 746f 5f74 696d 6573 7461 6d70  ns).to_timestamp
+000231f0: 2866 7265 713d 6672 6571 2c20 686f 773d  (freq=freq, how=
+00023200: 686f 7729 290a 2020 2020 2020 2020 7265  how)).        re
+00023210: 7475 726e 2064 660a 0a20 2020 2064 6566  turn df..    def
+00023220: 2071 7561 6e74 696c 6528 7365 6c66 2c20   quantile(self, 
+00023230: 713d 302e 352c 206d 6574 686f 643d 2264  q=0.5, method="d
+00023240: 6566 6175 6c74 2229 3a0a 2020 2020 2020  efault"):.      
+00023250: 2020 2222 2241 7070 726f 7869 6d61 7465    """Approximate
+00023260: 2071 7561 6e74 696c 6573 206f 6620 5365   quantiles of Se
+00023270: 7269 6573 0a0a 2020 2020 2020 2020 5061  ries..        Pa
+00023280: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00023290: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+000232a0: 2020 2020 7120 3a20 6c69 7374 2f61 7272      q : list/arr
+000232b0: 6179 206f 6620 666c 6f61 7473 2c20 6465  ay of floats, de
+000232c0: 6661 756c 7420 302e 3520 2835 3025 290a  fault 0.5 (50%).
+000232d0: 2020 2020 2020 2020 2020 2020 4974 6572              Iter
+000232e0: 6162 6c65 206f 6620 6e75 6d62 6572 7320  able of numbers 
+000232f0: 7261 6e67 696e 6720 6672 6f6d 2030 2074  ranging from 0 t
+00023300: 6f20 3120 666f 7220 7468 6520 6465 7369  o 1 for the desi
+00023310: 7265 6420 7175 616e 7469 6c65 730a 2020  red quantiles.  
+00023320: 2020 2020 2020 6d65 7468 6f64 203a 207b        method : {
+00023330: 2764 6566 6175 6c74 272c 2027 7464 6967  'default', 'tdig
+00023340: 6573 7427 2c20 2764 6173 6b27 7d2c 206f  est', 'dask'}, o
+00023350: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00023360: 2020 2020 5768 6174 206d 6574 686f 6420      What method 
+00023370: 746f 2075 7365 2e20 4279 2064 6566 6175  to use. By defau
+00023380: 6c74 2077 696c 6c20 7573 6520 6461 736b  lt will use dask
+00023390: 2773 2069 6e74 6572 6e61 6c20 6375 7374  's internal cust
+000233a0: 6f6d 0a20 2020 2020 2020 2020 2020 2061  om.            a
+000233b0: 6c67 6f72 6974 686d 2028 6060 2764 6173  lgorithm (``'das
+000233c0: 6b27 6060 292e 2020 4966 2073 6574 2074  k'``).  If set t
+000233d0: 6f20 6060 2774 6469 6765 7374 2760 6020  o ``'tdigest'`` 
+000233e0: 7769 6c6c 2075 7365 2074 6469 6765 7374  will use tdigest
+000233f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00023400: 2066 6c6f 6174 7320 616e 6420 696e 7473   floats and ints
+00023410: 2061 6e64 2066 616c 6c62 6163 6b20 746f   and fallback to
+00023420: 2074 6865 2060 6027 6461 736b 2760 6020   the ``'dask'`` 
+00023430: 6f74 6865 7277 6973 652e 0a20 2020 2020  otherwise..     
+00023440: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00023450: 6574 7572 6e20 7175 616e 7469 6c65 2873  eturn quantile(s
+00023460: 656c 662c 2071 2c20 6d65 7468 6f64 3d6d  elf, q, method=m
+00023470: 6574 686f 6429 0a0a 2020 2020 6465 6620  ethod)..    def 
+00023480: 6d65 6469 616e 5f61 7070 726f 7869 6d61  median_approxima
+00023490: 7465 2873 656c 662c 206d 6574 686f 643d  te(self, method=
+000234a0: 2264 6566 6175 6c74 2229 3a0a 2020 2020  "default"):.    
+000234b0: 2020 2020 2222 2252 6574 7572 6e20 7468      """Return th
+000234c0: 6520 6170 7072 6f78 696d 6174 6520 6d65  e approximate me
+000234d0: 6469 616e 206f 6620 7468 6520 7661 6c75  dian of the valu
+000234e0: 6573 206f 7665 7220 7468 6520 7265 7175  es over the requ
+000234f0: 6573 7465 6420 6178 6973 2e0a 0a20 2020  ested axis...   
+00023500: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00023510: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00023520: 2d2d 0a20 2020 2020 2020 206d 6574 686f  --.        metho
+00023530: 6420 3a20 7b27 6465 6661 756c 7427 2c20  d : {'default', 
+00023540: 2774 6469 6765 7374 272c 2027 6461 736b  'tdigest', 'dask
+00023550: 277d 2c20 6f70 7469 6f6e 616c 0a20 2020  '}, optional.   
+00023560: 2020 2020 2020 2020 2057 6861 7420 6d65           What me
+00023570: 7468 6f64 2074 6f20 7573 652e 2042 7920  thod to use. By 
+00023580: 6465 6661 756c 7420 7769 6c6c 2075 7365  default will use
+00023590: 2044 6173 6b27 7320 696e 7465 726e 616c   Dask's internal
+000235a0: 2063 7573 746f 6d0a 2020 2020 2020 2020   custom.        
+000235b0: 2020 2020 616c 676f 7269 7468 6d20 2860      algorithm (`
+000235c0: 6022 6461 736b 2260 6029 2e20 2049 6620  `"dask"``).  If 
+000235d0: 7365 7420 746f 2060 6022 7464 6967 6573  set to ``"tdiges
+000235e0: 7422 6060 2077 696c 6c20 7573 6520 7464  t"`` will use td
+000235f0: 6967 6573 740a 2020 2020 2020 2020 2020  igest.          
+00023600: 2020 666f 7220 666c 6f61 7473 2061 6e64    for floats and
+00023610: 2069 6e74 7320 616e 6420 6661 6c6c 6261   ints and fallba
+00023620: 636b 2074 6f20 7468 6520 6060 2264 6173  ck to the ``"das
+00023630: 6b22 6060 206f 7468 6572 7769 7365 2e0a  k"`` otherwise..
+00023640: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00023650: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00023660: 7175 616e 7469 6c65 2871 3d30 2e35 2c20  quantile(q=0.5, 
+00023670: 6d65 7468 6f64 3d6d 6574 686f 6429 0a0a  method=method)..
+00023680: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+00023690: 6d28 7064 2e53 6572 6965 7329 0a20 2020  m(pd.Series).   
+000236a0: 2064 6566 206d 6564 6961 6e28 7365 6c66   def median(self
+000236b0: 2c20 6d65 7468 6f64 3d22 6465 6661 756c  , method="defaul
+000236c0: 7422 293a 0a20 2020 2020 2020 2069 6620  t"):.        if 
+000236d0: 7365 6c66 2e6e 7061 7274 6974 696f 6e73  self.npartitions
+000236e0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+000236f0: 2020 2023 2043 616e 2070 726f 7669 6465     # Can provide
+00023700: 2061 6e20 6578 6163 7420 6d65 6469 616e   an exact median
+00023710: 2069 6e20 7468 6573 6520 6361 7365 730a   in these cases.
+00023720: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00023730: 726e 2073 656c 662e 6d65 6469 616e 5f61  rn self.median_a
+00023740: 7070 726f 7869 6d61 7465 286d 6574 686f  pproximate(metho
+00023750: 643d 6d65 7468 6f64 290a 2020 2020 2020  d=method).      
+00023760: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00023770: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
+00023780: 2020 2020 2020 2020 2022 4461 736b 2064           "Dask d
+00023790: 6f65 736e 2774 2069 6d70 6c65 6d65 6e74  oesn't implement
+000237a0: 2061 6e20 6578 6163 7420 6d65 6469 616e   an exact median
+000237b0: 2069 6e20 616c 6c20 6361 7365 7320 6173   in all cases as
+000237c0: 2074 6869 7320 6973 2068 6172 6420 746f   this is hard to
+000237d0: 2064 6f20 696e 2070 6172 616c 6c65 6c2e   do in parallel.
+000237e0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+000237f0: 5365 6520 7468 6520 606d 6564 6961 6e5f  See the `median_
+00023800: 6170 7072 6f78 696d 6174 6560 206d 6574  approximate` met
+00023810: 686f 6420 696e 7374 6561 642c 2077 6869  hod instead, whi
+00023820: 6368 2075 7365 7320 616e 2061 7070 726f  ch uses an appro
+00023830: 7869 6d61 7465 2061 6c67 6f72 6974 686d  ximate algorithm
+00023840: 2e22 0a20 2020 2020 2020 2029 0a0a 2020  .".        )..  
+00023850: 2020 6465 6620 5f72 6570 6172 7469 7469    def _repartiti
+00023860: 6f6e 5f71 7561 6e74 696c 6573 2873 656c  on_quantiles(sel
+00023870: 662c 206e 7061 7274 6974 696f 6e73 2c20  f, npartitions, 
+00023880: 7570 7361 6d70 6c65 3d31 2e30 293a 0a20  upsample=1.0):. 
+00023890: 2020 2020 2020 2022 2222 4170 7072 6f78         """Approx
+000238a0: 696d 6174 6520 7175 616e 7469 6c65 7320  imate quantiles 
+000238b0: 6f66 2053 6572 6965 7320 7573 6564 2066  of Series used f
+000238c0: 6f72 2072 6570 6172 7469 7469 6f6e 696e  or repartitionin
+000238d0: 6722 2222 0a20 2020 2020 2020 2066 726f  g""".        fro
+000238e0: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+000238f0: 2e70 6172 7469 7469 6f6e 7175 616e 7469  .partitionquanti
+00023900: 6c65 7320 696d 706f 7274 2070 6172 7469  les import parti
+00023910: 7469 6f6e 5f71 7561 6e74 696c 6573 0a0a  tion_quantiles..
+00023920: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+00023930: 6172 7469 7469 6f6e 5f71 7561 6e74 696c  artition_quantil
+00023940: 6573 2873 656c 662c 206e 7061 7274 6974  es(self, npartit
+00023950: 696f 6e73 2c20 7570 7361 6d70 6c65 3d75  ions, upsample=u
+00023960: 7073 616d 706c 6529 0a0a 2020 2020 6465  psample)..    de
+00023970: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
+00023980: 6c66 2c20 6b65 7929 3a0a 2020 2020 2020  lf, key):.      
+00023990: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000239a0: 6b65 792c 2053 6572 6965 7329 2061 6e64  key, Series) and
+000239b0: 2073 656c 662e 6469 7669 7369 6f6e 7320   self.divisions 
+000239c0: 3d3d 206b 6579 2e64 6976 6973 696f 6e73  == key.divisions
+000239d0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+000239e0: 6d65 203d 2022 696e 6465 782d 2573 2220  me = "index-%s" 
+000239f0: 2520 746f 6b65 6e69 7a65 2873 656c 662c  % tokenize(self,
+00023a00: 206b 6579 290a 2020 2020 2020 2020 2020   key).          
+00023a10: 2020 6473 6b20 3d20 7061 7274 6974 696f    dsk = partitio
+00023a20: 6e77 6973 655f 6772 6170 6828 6f70 6572  nwise_graph(oper
+00023a30: 6174 6f72 2e67 6574 6974 656d 2c20 6e61  ator.getitem, na
+00023a40: 6d65 2c20 7365 6c66 2c20 6b65 7929 0a20  me, self, key). 
+00023a50: 2020 2020 2020 2020 2020 2067 7261 7068             graph
+00023a60: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+00023a70: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+00023a80: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
+00023a90: 7065 6e64 656e 6369 6573 3d5b 7365 6c66  pendencies=[self
+00023aa0: 2c20 6b65 795d 290a 2020 2020 2020 2020  , key]).        
+00023ab0: 2020 2020 7265 7475 726e 2053 6572 6965      return Serie
+00023ac0: 7328 6772 6170 682c 206e 616d 652c 2073  s(graph, name, s
+00023ad0: 656c 662e 5f6d 6574 612c 2073 656c 662e  elf._meta, self.
+00023ae0: 6469 7669 7369 6f6e 7329 0a20 2020 2020  divisions).     
+00023af0: 2020 2072 6574 7572 6e20 7365 6c66 2e6c     return self.l
+00023b00: 6f63 5b6b 6579 5d0a 0a20 2020 2040 6465  oc[key]..    @de
+00023b10: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+00023b20: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+00023b30: 205f 6765 745f 6e75 6d65 7269 635f 6461   _get_numeric_da
+00023b40: 7461 2873 656c 662c 2068 6f77 3d22 616e  ta(self, how="an
+00023b50: 7922 2c20 7375 6273 6574 3d4e 6f6e 6529  y", subset=None)
+00023b60: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00023b70: 2073 656c 660a 0a20 2020 2069 6620 6e6f   self..    if no
+00023b80: 7420 5041 4e44 4153 5f47 545f 3230 303a  t PANDAS_GT_200:
+00023b90: 0a0a 2020 2020 2020 2020 4064 6572 6976  ..        @deriv
+00023ba0: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
+00023bb0: 7329 0a20 2020 2020 2020 2064 6566 2069  s).        def i
+00023bc0: 7465 7269 7465 6d73 2873 656c 6629 3a0a  teritems(self):.
+00023bd0: 2020 2020 2020 2020 2020 2020 6966 2050              if P
+00023be0: 414e 4441 535f 4754 5f31 3530 3a0a 2020  ANDAS_GT_150:.  
+00023bf0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00023c00: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+00023c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023c20: 2022 6974 6572 6974 656d 7320 6973 2064   "iteritems is d
+00023c30: 6570 7265 6361 7465 6420 616e 6420 7769  eprecated and wi
+00023c40: 6c6c 2062 6520 7265 6d6f 7665 6420 696e  ll be removed in
+00023c50: 2061 2066 7574 7572 6520 7665 7273 696f   a future versio
+00023c60: 6e2e 2022 0a20 2020 2020 2020 2020 2020  n. ".           
+00023c70: 2020 2020 2020 2020 2022 5573 6520 2e69           "Use .i
+00023c80: 7465 6d73 2069 6e73 7465 6164 2e22 2c0a  tems instead.",.
+00023c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ca0: 2020 2020 4675 7475 7265 5761 726e 696e      FutureWarnin
+00023cb0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00023cc0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00023cd0: 2023 2057 6520 7573 6520 7468 6520 605f   # We use the `_
+00023ce0: 6020 6765 6e65 7261 746f 7220 6265 6c6f  ` generator belo
+00023cf0: 7720 746f 2065 6e73 7572 6520 7468 6520  w to ensure the 
+00023d00: 6465 7072 6563 6174 696f 6e20 7761 726e  deprecation warn
+00023d10: 696e 6720 6162 6f76 650a 2020 2020 2020  ing above.      
+00023d20: 2020 2020 2020 2320 6973 2072 6169 7365        # is raise
+00023d30: 6420 7768 656e 2060 2e69 7465 7269 7465  d when `.iterite
+00023d40: 6d73 2829 6020 6973 2063 616c 6c65 642c  ms()` is called,
+00023d50: 206e 6f74 2077 6865 6e20 7468 6520 6669   not when the fi
+00023d60: 7273 7420 606e 6578 7428 3c67 656e 6572  rst `next(<gener
+00023d70: 6174 6f72 3e29 600a 2020 2020 2020 2020  ator>)`.        
+00023d80: 2020 2020 2320 6974 6572 6174 696f 6e20      # iteration 
+00023d90: 6861 7070 656e 730a 0a20 2020 2020 2020  happens..       
+00023da0: 2020 2020 2064 6566 205f 2873 656c 6629       def _(self)
+00023db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00023dc0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00023dd0: 2873 656c 662e 6e70 6172 7469 7469 6f6e  (self.npartition
+00023de0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00023df0: 2020 2020 2020 2020 7320 3d20 7365 6c66          s = self
+00023e00: 2e67 6574 5f70 6172 7469 7469 6f6e 2869  .get_partition(i
+00023e10: 292e 636f 6d70 7574 6528 290a 2020 2020  ).compute().    
+00023e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e30: 7969 656c 6420 6672 6f6d 2073 2e69 7465  yield from s.ite
+00023e40: 6d73 2829 0a0a 2020 2020 2020 2020 2020  ms()..          
+00023e50: 2020 7265 7475 726e 205f 2873 656c 6629    return _(self)
+00023e60: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+00023e70: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
+00023e80: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
+00023e90: 7365 6c66 293a 0a20 2020 2020 2020 2066  self):.        f
+00023ea0: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
+00023eb0: 6c66 2e6e 7061 7274 6974 696f 6e73 293a  lf.npartitions):
+00023ec0: 0a20 2020 2020 2020 2020 2020 2073 203d  .            s =
+00023ed0: 2073 656c 662e 6765 745f 7061 7274 6974   self.get_partit
+00023ee0: 696f 6e28 6929 2e63 6f6d 7075 7465 2829  ion(i).compute()
+00023ef0: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
+00023f00: 6c64 2066 726f 6d20 730a 0a20 2020 2040  ld from s..    @
+00023f10: 5f64 6570 7265 6361 7465 6428 0a20 2020  _deprecated(.   
+00023f20: 2020 2020 206d 6573 7361 6765 3d28 0a20       message=(. 
+00023f30: 2020 2020 2020 2020 2020 2022 5573 696e             "Usin
+00023f40: 6720 7468 6520 6060 696e 6060 206f 7065  g the ``in`` ope
+00023f50: 7261 746f 7220 746f 2074 6573 7420 666f  rator to test fo
+00023f60: 7220 6d65 6d62 6572 7368 6970 2069 6e20  r membership in 
+00023f70: 5365 7269 6573 2069 7320 220a 2020 2020  Series is ".    
+00023f80: 2020 2020 2020 2020 2264 6570 7265 6361          "depreca
+00023f90: 7465 642e 2054 6f20 7465 7374 2066 6f72  ted. To test for
+00023fa0: 206d 656d 6265 7273 6869 7020 696e 2074   membership in t
+00023fb0: 6865 2069 6e64 6578 2075 7365 2022 0a20  he index use ". 
+00023fc0: 2020 2020 2020 2020 2020 2022 6060 2873             "``(s
+00023fd0: 2e69 6e64 6578 203d 3d20 6b65 7929 2e61  .index == key).a
+00023fe0: 6e79 2829 6060 2e20 5369 6d69 6c61 726c  ny()``. Similarl
+00023ff0: 7920 746f 2074 6573 7420 666f 7220 6d65  y to test for me
+00024000: 6d62 6572 7368 6970 2069 6e20 220a 2020  mbership in ".  
+00024010: 2020 2020 2020 2020 2020 2274 6865 2076            "the v
+00024020: 616c 7565 7320 7573 6520 6060 2873 203d  alues use ``(s =
+00024030: 3d20 6b65 7929 2e61 6e79 2829 6060 220a  = key).any()``".
+00024040: 2020 2020 2020 2020 290a 2020 2020 290a          ).    ).
+00024050: 2020 2020 6465 6620 5f5f 636f 6e74 6169      def __contai
+00024060: 6e73 5f5f 2873 656c 662c 206b 6579 293a  ns__(self, key):
+00024070: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00024080: 2873 656c 6620 3d3d 206b 6579 292e 616e  (self == key).an
+00024090: 7928 292e 636f 6d70 7574 6528 290a 0a20  y().compute().. 
+000240a0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000240b0: 2020 2020 6465 6620 5f76 616c 6964 6174      def _validat
+000240c0: 655f 6178 6973 2863 6c73 2c20 6178 6973  e_axis(cls, axis
+000240d0: 3d30 2c20 6e6f 6e65 5f69 735f 7a65 726f  =0, none_is_zero
+000240e0: 3a20 626f 6f6c 203d 2054 7275 6529 202d  : bool = True) -
+000240f0: 3e20 4e6f 6e65 207c 204c 6974 6572 616c  > None | Literal
+00024100: 5b30 2c20 315d 3a0a 2020 2020 2020 2020  [0, 1]:.        
+00024110: 6966 2061 7869 7320 6e6f 7420 696e 2028  if axis not in (
+00024120: 302c 2022 696e 6465 7822 2c20 4e6f 6e65  0, "index", None
+00024130: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00024140: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00024150: 6622 4e6f 2061 7869 7320 6e61 6d65 6420  f"No axis named 
+00024160: 7b61 7869 737d 2229 0a20 2020 2020 2020  {axis}").       
+00024170: 2023 2063 6f6e 7665 7274 2074 6f20 6e75   # convert to nu
+00024180: 6d65 7269 6320 6178 6973 0a20 2020 2020  meric axis.     
+00024190: 2020 206e 756d 6572 6963 5f61 7869 733a     numeric_axis:
+000241a0: 2064 6963 745b 7374 7220 7c20 4e6f 6e65   dict[str | None
+000241b0: 2c20 4c69 7465 7261 6c5b 302c 2031 5d5d  , Literal[0, 1]]
+000241c0: 203d 207b 2269 6e64 6578 223a 2030 7d0a   = {"index": 0}.
+000241d0: 2020 2020 2020 2020 6966 206e 6f6e 655f          if none_
+000241e0: 6973 5f7a 6572 6f3a 0a20 2020 2020 2020  is_zero:.       
+000241f0: 2020 2020 206e 756d 6572 6963 5f61 7869       numeric_axi
+00024200: 735b 4e6f 6e65 5d20 3d20 300a 2020 2020  s[None] = 0.    
+00024210: 2020 2020 7265 7475 726e 206e 756d 6572      return numer
+00024220: 6963 5f61 7869 732e 6765 7428 6178 6973  ic_axis.get(axis
+00024230: 2c20 6178 6973 290a 0a20 2020 2040 6465  , axis)..    @de
+00024240: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
+00024250: 7269 6573 290a 2020 2020 6465 6620 6772  ries).    def gr
+00024260: 6f75 7062 7928 0a20 2020 2020 2020 2073  oupby(.        s
+00024270: 656c 662c 0a20 2020 2020 2020 2062 793d  elf,.        by=
+00024280: 4e6f 6e65 2c0a 2020 2020 2020 2020 6772  None,.        gr
+00024290: 6f75 705f 6b65 7973 3d47 524f 5550 5f4b  oup_keys=GROUP_K
+000242a0: 4559 535f 4445 4641 554c 542c 0a20 2020  EYS_DEFAULT,.   
+000242b0: 2020 2020 2073 6f72 743d 4e6f 6e65 2c0a       sort=None,.
+000242c0: 2020 2020 2020 2020 6f62 7365 7276 6564          observed
+000242d0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2064  =None,.        d
+000242e0: 726f 706e 613d 4e6f 6e65 2c0a 2020 2020  ropna=None,.    
+000242f0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00024300: 2020 293a 0a20 2020 2020 2020 2066 726f    ):.        fro
+00024310: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+00024320: 2e67 726f 7570 6279 2069 6d70 6f72 7420  .groupby import 
+00024330: 5365 7269 6573 4772 6f75 7042 790a 0a20  SeriesGroupBy.. 
+00024340: 2020 2020 2020 2072 6574 7572 6e20 5365         return Se
+00024350: 7269 6573 4772 6f75 7042 7928 0a20 2020  riesGroupBy(.   
+00024360: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00024370: 2020 2020 2020 2020 2020 2062 793d 6279             by=by
+00024380: 2c0a 2020 2020 2020 2020 2020 2020 6772  ,.            gr
+00024390: 6f75 705f 6b65 7973 3d67 726f 7570 5f6b  oup_keys=group_k
+000243a0: 6579 732c 0a20 2020 2020 2020 2020 2020  eys,.           
+000243b0: 2073 6f72 743d 736f 7274 2c0a 2020 2020   sort=sort,.    
+000243c0: 2020 2020 2020 2020 6f62 7365 7276 6564          observed
+000243d0: 3d6f 6273 6572 7665 642c 0a20 2020 2020  =observed,.     
+000243e0: 2020 2020 2020 2064 726f 706e 613d 6472         dropna=dr
+000243f0: 6f70 6e61 2c0a 2020 2020 2020 2020 2020  opna,.          
+00024400: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+00024410: 2020 2020 290a 0a20 2020 2040 6465 7269      )..    @deri
+00024420: 7665 645f 6672 6f6d 2870 642e 5365 7269  ved_from(pd.Seri
+00024430: 6573 290a 2020 2020 6465 6620 636f 756e  es).    def coun
+00024440: 7428 7365 6c66 2c20 7370 6c69 745f 6576  t(self, split_ev
+00024450: 6572 793d 4661 6c73 6529 3a0a 2020 2020  ery=False):.    
+00024460: 2020 2020 7265 7475 726e 2073 7570 6572      return super
+00024470: 2829 2e63 6f75 6e74 2873 706c 6974 5f65  ().count(split_e
+00024480: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+00024490: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
+000244a0: 6672 6f6d 2870 642e 5365 7269 6573 290a  from(pd.Series).
+000244b0: 2020 2020 6465 6620 6d6f 6465 2873 656c      def mode(sel
+000244c0: 662c 2064 726f 706e 613d 5472 7565 2c20  f, dropna=True, 
+000244d0: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
+000244e0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+000244f0: 726e 2073 7570 6572 2829 2e6d 6f64 6528  rn super().mode(
+00024500: 6472 6f70 6e61 3d64 726f 706e 612c 2073  dropna=dropna, s
+00024510: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+00024520: 5f65 7665 7279 290a 0a20 2020 2040 6465  _every)..    @de
+00024530: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
+00024540: 7269 6573 290a 2020 2020 6465 6620 6578  ries).    def ex
+00024550: 706c 6f64 6528 7365 6c66 293a 0a20 2020  plode(self):.   
+00024560: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
+00024570: 2e5f 6d65 7461 2e65 7870 6c6f 6465 2829  ._meta.explode()
+00024580: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00024590: 7365 6c66 2e6d 6170 5f70 6172 7469 7469  self.map_partiti
+000245a0: 6f6e 7328 4d2e 6578 706c 6f64 652c 206d  ons(M.explode, m
+000245b0: 6574 613d 6d65 7461 2c20 656e 666f 7263  eta=meta, enforc
+000245c0: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+000245d0: 290a 0a20 2020 2064 6566 2075 6e69 7175  )..    def uniqu
+000245e0: 6528 7365 6c66 2c20 7370 6c69 745f 6576  e(self, split_ev
+000245f0: 6572 793d 4e6f 6e65 2c20 7370 6c69 745f  ery=None, split_
+00024600: 6f75 743d 3129 3a0a 2020 2020 2020 2020  out=1):.        
+00024610: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+00024620: 726e 2053 6572 6965 7320 6f66 2075 6e69  rn Series of uni
+00024630: 7175 6520 7661 6c75 6573 2069 6e20 7468  que values in th
+00024640: 6520 6f62 6a65 6374 2e20 496e 636c 7564  e object. Includ
+00024650: 6573 204e 4120 7661 6c75 6573 2e0a 0a20  es NA values... 
+00024660: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00024670: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00024680: 2020 2020 2020 2075 6e69 7175 6573 203a         uniques :
+00024690: 2053 6572 6965 730a 2020 2020 2020 2020   Series.        
+000246a0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+000246b0: 726e 2061 6361 280a 2020 2020 2020 2020  rn aca(.        
+000246c0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000246d0: 2020 2020 2020 6368 756e 6b3d 6d65 7468        chunk=meth
+000246e0: 6f64 732e 756e 6971 7565 2c0a 2020 2020  ods.unique,.    
+000246f0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+00024700: 653d 6d65 7468 6f64 732e 756e 6971 7565  e=methods.unique
+00024710: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+00024720: 7461 3d73 656c 662e 5f6d 6574 612c 0a20  ta=self._meta,. 
+00024730: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00024740: 3d22 756e 6971 7565 222c 0a20 2020 2020  ="unique",.     
+00024750: 2020 2020 2020 2073 706c 6974 5f65 7665         split_eve
+00024760: 7279 3d73 706c 6974 5f65 7665 7279 2c0a  ry=split_every,.
+00024770: 2020 2020 2020 2020 2020 2020 7365 7269              seri
+00024780: 6573 5f6e 616d 653d 7365 6c66 2e6e 616d  es_name=self.nam
+00024790: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+000247a0: 706c 6974 5f6f 7574 3d73 706c 6974 5f6f  plit_out=split_o
+000247b0: 7574 2c0a 2020 2020 2020 2020 290a 0a20  ut,.        ).. 
+000247c0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+000247d0: 2870 642e 5365 7269 6573 290a 2020 2020  (pd.Series).    
+000247e0: 6465 6620 6e75 6e69 7175 6528 7365 6c66  def nunique(self
+000247f0: 2c20 7370 6c69 745f 6576 6572 793d 4e6f  , split_every=No
+00024800: 6e65 2c20 6472 6f70 6e61 3d54 7275 6529  ne, dropna=True)
+00024810: 3a0a 2020 2020 2020 2020 756e 6971 7320  :.        uniqs 
+00024820: 3d20 7365 6c66 2e64 726f 705f 6475 706c  = self.drop_dupl
+00024830: 6963 6174 6573 2873 706c 6974 5f65 7665  icates(split_eve
+00024840: 7279 3d73 706c 6974 5f65 7665 7279 290a  ry=split_every).
+00024850: 2020 2020 2020 2020 6966 2064 726f 706e          if dropn
+00024860: 613a 0a20 2020 2020 2020 2020 2020 2023  a:.            #
+00024870: 2063 6f75 6e74 206d 696d 6963 7320 7061   count mimics pa
+00024880: 6e64 6173 2062 6568 6176 696f 7220 616e  ndas behavior an
+00024890: 6420 6578 636c 7564 6573 204e 4120 7661  d excludes NA va
+000248a0: 6c75 6573 0a20 2020 2020 2020 2020 2020  lues.           
+000248b0: 2072 6574 7572 6e20 756e 6971 732e 636f   return uniqs.co
+000248c0: 756e 7428 290a 2020 2020 2020 2020 656c  unt().        el
+000248d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000248e0: 7265 7475 726e 2075 6e69 7173 2e73 697a  return uniqs.siz
+000248f0: 650a 0a20 2020 2040 6465 7269 7665 645f  e..    @derived_
+00024900: 6672 6f6d 2870 642e 5365 7269 6573 290a  from(pd.Series).
+00024910: 2020 2020 6465 6620 7661 6c75 655f 636f      def value_co
+00024920: 756e 7473 280a 2020 2020 2020 2020 7365  unts(.        se
+00024930: 6c66 2c0a 2020 2020 2020 2020 736f 7274  lf,.        sort
+00024940: 3d4e 6f6e 652c 0a20 2020 2020 2020 2061  =None,.        a
+00024950: 7363 656e 6469 6e67 3d46 616c 7365 2c0a  scending=False,.
+00024960: 2020 2020 2020 2020 6472 6f70 6e61 3d54          dropna=T
+00024970: 7275 652c 0a20 2020 2020 2020 206e 6f72  rue,.        nor
+00024980: 6d61 6c69 7a65 3d46 616c 7365 2c0a 2020  malize=False,.  
+00024990: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
+000249a0: 793d 4e6f 6e65 2c0a 2020 2020 2020 2020  y=None,.        
+000249b0: 7370 6c69 745f 6f75 743d 312c 0a20 2020  split_out=1,.   
+000249c0: 2029 3a0a 2020 2020 2020 2020 6b77 6172   ):.        kwar
+000249d0: 6773 203d 207b 2273 6f72 7422 3a20 736f  gs = {"sort": so
+000249e0: 7274 2c20 2261 7363 656e 6469 6e67 223a  rt, "ascending":
+000249f0: 2061 7363 656e 6469 6e67 2c20 2264 726f   ascending, "dro
+00024a00: 706e 6122 3a20 6472 6f70 6e61 7d0a 2020  pna": dropna}.  
+00024a10: 2020 2020 2020 6167 6772 6567 6174 655f        aggregate_
+00024a20: 6b77 6172 6773 203d 207b 226e 6f72 6d61  kwargs = {"norma
+00024a30: 6c69 7a65 223a 206e 6f72 6d61 6c69 7a65  lize": normalize
+00024a40: 7d0a 2020 2020 2020 2020 6966 2073 706c  }.        if spl
+00024a50: 6974 5f6f 7574 203e 2031 3a0a 2020 2020  it_out > 1:.    
+00024a60: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
+00024a70: 655f 6b77 6172 6773 5b22 746f 7461 6c5f  e_kwargs["total_
+00024a80: 6c65 6e67 7468 225d 203d 2028 0a20 2020  length"] = (.   
+00024a90: 2020 2020 2020 2020 2020 2020 206c 656e               len
+00024aa0: 2873 656c 6629 2069 6620 6472 6f70 6e61  (self) if dropna
+00024ab0: 2069 7320 4661 6c73 6520 656c 7365 206c   is False else l
+00024ac0: 656e 2873 656c 662e 6472 6f70 6e61 2829  en(self.dropna()
+00024ad0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00024ae0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00024af0: 6163 6128 0a20 2020 2020 2020 2020 2020  aca(.           
+00024b00: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00024b10: 2020 2063 6875 6e6b 3d4d 2e76 616c 7565     chunk=M.value
+00024b20: 5f63 6f75 6e74 732c 0a20 2020 2020 2020  _counts,.       
+00024b30: 2020 2020 2061 6767 7265 6761 7465 3d6d       aggregate=m
+00024b40: 6574 686f 6473 2e76 616c 7565 5f63 6f75  ethods.value_cou
+00024b50: 6e74 735f 6167 6772 6567 6174 652c 0a20  nts_aggregate,. 
+00024b60: 2020 2020 2020 2020 2020 2063 6f6d 6269             combi
+00024b70: 6e65 3d6d 6574 686f 6473 2e76 616c 7565  ne=methods.value
+00024b80: 5f63 6f75 6e74 735f 636f 6d62 696e 652c  _counts_combine,
+00024b90: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+00024ba0: 613d 7365 6c66 2e5f 6d65 7461 2e76 616c  a=self._meta.val
+00024bb0: 7565 5f63 6f75 6e74 7328 6e6f 726d 616c  ue_counts(normal
+00024bc0: 697a 653d 6e6f 726d 616c 697a 6529 2c0a  ize=normalize),.
+00024bd0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+00024be0: 6e3d 2276 616c 7565 2d63 6f75 6e74 7322  n="value-counts"
+00024bf0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
+00024c00: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+00024c10: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
+00024c20: 2020 2073 706c 6974 5f6f 7574 3d73 706c     split_out=spl
+00024c30: 6974 5f6f 7574 2c0a 2020 2020 2020 2020  it_out,.        
+00024c40: 2020 2020 7370 6c69 745f 6f75 745f 7365      split_out_se
+00024c50: 7475 703d 7370 6c69 745f 6f75 745f 6f6e  tup=split_out_on
+00024c60: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
+00024c70: 2020 2020 6167 6772 6567 6174 655f 6b77      aggregate_kw
+00024c80: 6172 6773 3d61 6767 7265 6761 7465 5f6b  args=aggregate_k
+00024c90: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00024ca0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+00024cb0: 2020 2020 2029 0a0a 2020 2020 4064 6572       )..    @der
+00024cc0: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
+00024cd0: 6965 7329 0a20 2020 2064 6566 206e 6c61  ies).    def nla
+00024ce0: 7267 6573 7428 7365 6c66 2c20 6e3d 352c  rgest(self, n=5,
+00024cf0: 2073 706c 6974 5f65 7665 7279 3d4e 6f6e   split_every=Non
+00024d00: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+00024d10: 726e 2061 6361 280a 2020 2020 2020 2020  rn aca(.        
+00024d20: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00024d30: 2020 2020 2020 6368 756e 6b3d 4d2e 6e6c        chunk=M.nl
+00024d40: 6172 6765 7374 2c0a 2020 2020 2020 2020  argest,.        
+00024d50: 2020 2020 6167 6772 6567 6174 653d 4d2e      aggregate=M.
+00024d60: 6e6c 6172 6765 7374 2c0a 2020 2020 2020  nlargest,.      
+00024d70: 2020 2020 2020 6d65 7461 3d73 656c 662e        meta=self.
+00024d80: 5f6d 6574 612c 0a20 2020 2020 2020 2020  _meta,.         
+00024d90: 2020 2074 6f6b 656e 3d22 7365 7269 6573     token="series
+00024da0: 2d6e 6c61 7267 6573 7422 2c0a 2020 2020  -nlargest",.    
+00024db0: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
+00024dc0: 6572 793d 7370 6c69 745f 6576 6572 792c  ery=split_every,
+00024dd0: 0a20 2020 2020 2020 2020 2020 206e 3d6e  .            n=n
+00024de0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00024df0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+00024e00: 642e 5365 7269 6573 290a 2020 2020 6465  d.Series).    de
+00024e10: 6620 6e73 6d61 6c6c 6573 7428 7365 6c66  f nsmallest(self
+00024e20: 2c20 6e3d 352c 2073 706c 6974 5f65 7665  , n=5, split_eve
+00024e30: 7279 3d4e 6f6e 6529 3a0a 2020 2020 2020  ry=None):.      
+00024e40: 2020 7265 7475 726e 2061 6361 280a 2020    return aca(.  
+00024e50: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00024e60: 2020 2020 2020 2020 2020 2020 6368 756e              chun
+00024e70: 6b3d 4d2e 6e73 6d61 6c6c 6573 742c 0a20  k=M.nsmallest,. 
+00024e80: 2020 2020 2020 2020 2020 2061 6767 7265             aggre
+00024e90: 6761 7465 3d4d 2e6e 736d 616c 6c65 7374  gate=M.nsmallest
+00024ea0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+00024eb0: 7461 3d73 656c 662e 5f6d 6574 612c 0a20  ta=self._meta,. 
+00024ec0: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00024ed0: 3d22 7365 7269 6573 2d6e 736d 616c 6c65  ="series-nsmalle
+00024ee0: 7374 222c 0a20 2020 2020 2020 2020 2020  st",.           
+00024ef0: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
+00024f00: 6974 5f65 7665 7279 2c0a 2020 2020 2020  it_every,.      
+00024f10: 2020 2020 2020 6e3d 6e2c 0a20 2020 2020        n=n,.     
+00024f20: 2020 2029 0a0a 2020 2020 4064 6572 6976     )..    @deriv
+00024f30: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
+00024f40: 7329 0a20 2020 2064 6566 2069 7369 6e28  s).    def isin(
+00024f50: 7365 6c66 2c20 7661 6c75 6573 293a 0a20  self, values):. 
+00024f60: 2020 2020 2020 2023 2041 6464 6564 206a         # Added j
+00024f70: 7573 7420 746f 2067 6574 2074 6865 2064  ust to get the d
+00024f80: 6966 6665 7265 6e74 2064 6f63 7374 7269  ifferent docstri
+00024f90: 6e67 2066 6f72 2053 6572 6965 730a 2020  ng for Series.  
+00024fa0: 2020 2020 2020 7265 7475 726e 2073 7570        return sup
+00024fb0: 6572 2829 2e69 7369 6e28 7661 6c75 6573  er().isin(values
+00024fc0: 290a 0a20 2020 2040 696e 7365 7274 5f6d  )..    @insert_m
+00024fd0: 6574 615f 7061 7261 6d5f 6465 7363 7269  eta_param_descri
+00024fe0: 7074 696f 6e28 7061 643d 3132 290a 2020  ption(pad=12).  
+00024ff0: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+00025000: 7064 2e53 6572 6965 7329 0a20 2020 2064  pd.Series).    d
+00025010: 6566 206d 6170 2873 656c 662c 2061 7267  ef map(self, arg
+00025020: 2c20 6e61 5f61 6374 696f 6e3d 4e6f 6e65  , na_action=None
+00025030: 2c20 6d65 7461 3d6e 6f5f 6465 6661 756c  , meta=no_defaul
+00025040: 7429 3a0a 2020 2020 2020 2020 6966 2069  t):.        if i
+00025050: 735f 7365 7269 6573 5f6c 696b 6528 6172  s_series_like(ar
+00025060: 6729 2061 6e64 2069 735f 6461 736b 5f63  g) and is_dask_c
+00025070: 6f6c 6c65 6374 696f 6e28 6172 6729 3a0a  ollection(arg):.
+00025080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00025090: 726e 2073 6572 6965 735f 6d61 7028 7365  rn series_map(se
+000250a0: 6c66 2c20 6172 6729 0a20 2020 2020 2020  lf, arg).       
+000250b0: 2069 6620 6e6f 7420 280a 2020 2020 2020   if not (.      
+000250c0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
+000250d0: 2861 7267 2c20 6469 6374 290a 2020 2020  (arg, dict).    
+000250e0: 2020 2020 2020 2020 6f72 2063 616c 6c61          or calla
+000250f0: 626c 6528 6172 6729 0a20 2020 2020 2020  ble(arg).       
+00025100: 2020 2020 206f 7220 6973 5f73 6572 6965       or is_serie
+00025110: 735f 6c69 6b65 2861 7267 290a 2020 2020  s_like(arg).    
+00025120: 2020 2020 2020 2020 616e 6420 6e6f 7420          and not 
+00025130: 6973 5f64 6173 6b5f 636f 6c6c 6563 7469  is_dask_collecti
+00025140: 6f6e 2861 7267 290a 2020 2020 2020 2020  on(arg).        
+00025150: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00025160: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
+00025170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025180: 6622 6172 6720 6d75 7374 2062 6520 7061  f"arg must be pa
+00025190: 6e64 6173 2e53 6572 6965 732c 2064 6963  ndas.Series, dic
+000251a0: 7420 6f72 2063 616c 6c61 626c 652e 2047  t or callable. G
+000251b0: 6f74 207b 7479 7065 2861 7267 297d 220a  ot {type(arg)}".
+000251c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000251d0: 2020 2020 2020 6e61 6d65 203d 2022 6d61        name = "ma
+000251e0: 702d 2220 2b20 746f 6b65 6e69 7a65 2873  p-" + tokenize(s
+000251f0: 656c 662c 2061 7267 2c20 6e61 5f61 6374  elf, arg, na_act
+00025200: 696f 6e29 0a20 2020 2020 2020 2064 736b  ion).        dsk
+00025210: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00025220: 2028 6e61 6d65 2c20 6929 3a20 284d 2e6d   (name, i): (M.m
+00025230: 6170 2c20 6b2c 2061 7267 2c20 6e61 5f61  ap, k, arg, na_a
+00025240: 6374 696f 6e29 0a20 2020 2020 2020 2020  ction).         
+00025250: 2020 2066 6f72 2069 2c20 6b20 696e 2065     for i, k in e
+00025260: 6e75 6d65 7261 7465 2873 656c 662e 5f5f  numerate(self.__
+00025270: 6461 736b 5f6b 6579 735f 5f28 2929 0a20  dask_keys__()). 
+00025280: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00025290: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+000252a0: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+000252b0: 6c65 6374 696f 6e73 286e 616d 652c 2064  lections(name, d
+000252c0: 736b 2c20 6465 7065 6e64 656e 6369 6573  sk, dependencies
+000252d0: 3d5b 7365 6c66 5d29 0a20 2020 2020 2020  =[self]).       
+000252e0: 2069 6620 6d65 7461 2069 7320 6e6f 5f64   if meta is no_d
+000252f0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+00025300: 2020 2020 6d65 7461 203d 205f 656d 756c      meta = _emul
+00025310: 6174 6528 4d2e 6d61 702c 2073 656c 662c  ate(M.map, self,
+00025320: 2061 7267 2c20 6e61 5f61 6374 696f 6e3d   arg, na_action=
+00025330: 6e61 5f61 6374 696f 6e2c 2075 6466 3d54  na_action, udf=T
+00025340: 7275 6529 0a20 2020 2020 2020 2065 6c73  rue).        els
+00025350: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+00025360: 6574 6120 3d20 6d61 6b65 5f6d 6574 6128  eta = make_meta(
+00025370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025380: 206d 6574 612c 0a20 2020 2020 2020 2020   meta,.         
+00025390: 2020 2020 2020 2069 6e64 6578 3d67 6574         index=get
+000253a0: 6174 7472 286d 616b 655f 6d65 7461 2873  attr(make_meta(s
+000253b0: 656c 6629 2c20 2269 6e64 6578 222c 204e  elf), "index", N
+000253c0: 6f6e 6529 2c0a 2020 2020 2020 2020 2020  one),.          
+000253d0: 2020 2020 2020 7061 7265 6e74 5f6d 6574        parent_met
+000253e0: 613d 7365 6c66 2e5f 6d65 7461 2c0a 2020  a=self._meta,.  
+000253f0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00025400: 2020 2020 2072 6574 7572 6e20 7479 7065       return type
+00025410: 2873 656c 6629 2867 7261 7068 2c20 6e61  (self)(graph, na
+00025420: 6d65 2c20 6d65 7461 2c20 7365 6c66 2e64  me, meta, self.d
+00025430: 6976 6973 696f 6e73 290a 0a20 2020 2040  ivisions)..    @
+00025440: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+00025450: 5365 7269 6573 290a 2020 2020 6465 6620  Series).    def 
+00025460: 6472 6f70 6e61 2873 656c 6629 3a0a 2020  dropna(self):.  
 00025470: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
 00025480: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
-00025490: 280a 2020 2020 2020 2020 2020 2020 4d2e  (.            M.
-000254a0: 636c 6970 2c20 6c6f 7765 723d 6c6f 7765  clip, lower=lowe
-000254b0: 722c 2075 7070 6572 3d75 7070 6572 2c20  r, upper=upper, 
-000254c0: 656e 666f 7263 655f 6d65 7461 6461 7461  enforce_metadata
-000254d0: 3d46 616c 7365 0a20 2020 2020 2020 2029  =False.        )
-000254e0: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-000254f0: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
-00025500: 2020 2064 6566 2063 6c69 705f 6c6f 7765     def clip_lowe
-00025510: 7228 7365 6c66 2c20 7468 7265 7368 6f6c  r(self, threshol
-00025520: 6429 3a0a 2020 2020 2020 2020 7265 7475  d):.        retu
-00025530: 726e 2073 656c 662e 6d61 705f 7061 7274  rn self.map_part
-00025540: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
-00025550: 2020 2020 4d2e 636c 6970 5f6c 6f77 6572      M.clip_lower
-00025560: 2c20 7468 7265 7368 6f6c 643d 7468 7265  , threshold=thre
-00025570: 7368 6f6c 642c 2065 6e66 6f72 6365 5f6d  shold, enforce_m
-00025580: 6574 6164 6174 613d 4661 6c73 650a 2020  etadata=False.  
-00025590: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
-000255a0: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
-000255b0: 7269 6573 290a 2020 2020 6465 6620 636c  ries).    def cl
-000255c0: 6970 5f75 7070 6572 2873 656c 662c 2074  ip_upper(self, t
-000255d0: 6872 6573 686f 6c64 293a 0a20 2020 2020  hreshold):.     
-000255e0: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-000255f0: 6170 5f70 6172 7469 7469 6f6e 7328 0a20  ap_partitions(. 
-00025600: 2020 2020 2020 2020 2020 204d 2e63 6c69             M.cli
-00025610: 705f 7570 7065 722c 2074 6872 6573 686f  p_upper, thresho
-00025620: 6c64 3d74 6872 6573 686f 6c64 2c20 656e  ld=threshold, en
-00025630: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
-00025640: 616c 7365 0a20 2020 2020 2020 2029 0a0a  alse.        )..
-00025650: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
-00025660: 6d28 7064 2e53 6572 6965 7329 0a20 2020  m(pd.Series).   
-00025670: 2064 6566 2061 6c69 676e 2873 656c 662c   def align(self,
-00025680: 206f 7468 6572 2c20 6a6f 696e 3d22 6f75   other, join="ou
-00025690: 7465 7222 2c20 6178 6973 3d4e 6f6e 652c  ter", axis=None,
-000256a0: 2066 696c 6c5f 7661 6c75 653d 4e6f 6e65   fill_value=None
-000256b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000256c0: 6e20 7375 7065 7228 292e 616c 6967 6e28  n super().align(
-000256d0: 6f74 6865 722c 206a 6f69 6e3d 6a6f 696e  other, join=join
-000256e0: 2c20 6178 6973 3d61 7869 732c 2066 696c  , axis=axis, fil
-000256f0: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
-00025700: 7565 290a 0a20 2020 2040 6465 7269 7665  ue)..    @derive
-00025710: 645f 6672 6f6d 2870 642e 5365 7269 6573  d_from(pd.Series
-00025720: 290a 2020 2020 6465 6620 636f 6d62 696e  ).    def combin
-00025730: 6528 7365 6c66 2c20 6f74 6865 722c 2066  e(self, other, f
-00025740: 756e 632c 2066 696c 6c5f 7661 6c75 653d  unc, fill_value=
-00025750: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-00025760: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
-00025770: 6172 7469 7469 6f6e 7328 4d2e 636f 6d62  artitions(M.comb
-00025780: 696e 652c 206f 7468 6572 2c20 6675 6e63  ine, other, func
-00025790: 2c20 6669 6c6c 5f76 616c 7565 3d66 696c  , fill_value=fil
-000257a0: 6c5f 7661 6c75 6529 0a0a 2020 2020 4064  l_value)..    @d
-000257b0: 6572 6976 6564 5f66 726f 6d28 7064 2e53  erived_from(pd.S
-000257c0: 6572 6965 7329 0a20 2020 2064 6566 2073  eries).    def s
-000257d0: 7175 6565 7a65 2873 656c 6629 3a0a 2020  queeze(self):.  
-000257e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000257f0: 660a 0a20 2020 2040 6465 7269 7665 645f  f..    @derived_
-00025800: 6672 6f6d 2870 642e 5365 7269 6573 290a  from(pd.Series).
-00025810: 2020 2020 6465 6620 636f 6d62 696e 655f      def combine_
-00025820: 6669 7273 7428 7365 6c66 2c20 6f74 6865  first(self, othe
-00025830: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-00025840: 726e 2073 656c 662e 6d61 705f 7061 7274  rn self.map_part
-00025850: 6974 696f 6e73 284d 2e63 6f6d 6269 6e65  itions(M.combine
-00025860: 5f66 6972 7374 2c20 6f74 6865 7229 0a0a  _first, other)..
-00025870: 2020 2020 6465 6620 746f 5f62 6167 2873      def to_bag(s
-00025880: 656c 662c 2069 6e64 6578 3d46 616c 7365  elf, index=False
-00025890: 2c20 666f 726d 6174 3d22 7475 706c 6522  , format="tuple"
-000258a0: 293a 0a20 2020 2020 2020 2022 2222 4372  ):.        """Cr
-000258b0: 6561 7465 2061 2044 6173 6b20 4261 6720  eate a Dask Bag 
-000258c0: 6672 6f6d 2061 2053 6572 6965 7322 2222  from a Series"""
-000258d0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-000258e0: 736b 2e64 6174 6166 7261 6d65 2e69 6f20  sk.dataframe.io 
-000258f0: 696d 706f 7274 2074 6f5f 6261 670a 0a20  import to_bag.. 
-00025900: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
-00025910: 5f62 6167 2873 656c 662c 2069 6e64 6578  _bag(self, index
-00025920: 2c20 666f 726d 6174 3d66 6f72 6d61 7429  , format=format)
-00025930: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-00025940: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
-00025950: 2020 2064 6566 2074 6f5f 6672 616d 6528     def to_frame(
-00025960: 7365 6c66 2c20 6e61 6d65 3d4e 6f6e 6529  self, name=None)
-00025970: 3a0a 2020 2020 2020 2020 6172 6773 203d  :.        args =
-00025980: 205b 5d20 6966 206e 616d 6520 6973 204e   [] if name is N
-00025990: 6f6e 6520 656c 7365 205b 6e61 6d65 5d0a  one else [name].
-000259a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000259b0: 656c 662e 6d61 705f 7061 7274 6974 696f  elf.map_partitio
-000259c0: 6e73 284d 2e74 6f5f 6672 616d 652c 202a  ns(M.to_frame, *
-000259d0: 6172 6773 2c20 6d65 7461 3d73 656c 662e  args, meta=self.
-000259e0: 5f6d 6574 612e 746f 5f66 7261 6d65 282a  _meta.to_frame(*
-000259f0: 6172 6773 2929 0a0a 2020 2020 4064 6572  args))..    @der
-00025a00: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
-00025a10: 6965 7329 0a20 2020 2064 6566 2074 6f5f  ies).    def to_
-00025a20: 7374 7269 6e67 2873 656c 662c 206d 6178  string(self, max
-00025a30: 5f72 6f77 733d 3529 3a0a 2020 2020 2020  _rows=5):.      
-00025a40: 2020 2320 6f70 7469 6f6e 5f63 6f6e 7465    # option_conte
-00025a50: 7874 2064 6f65 736e 2774 2061 6666 6563  xt doesn't affec
-00025a60: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-00025a70: 2073 656c 662e 5f72 6570 725f 6461 7461   self._repr_data
-00025a80: 2829 2e74 6f5f 7374 7269 6e67 286d 6178  ().to_string(max
-00025a90: 5f72 6f77 733d 6d61 785f 726f 7773 290a  _rows=max_rows).
-00025aa0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00025ab0: 640a 2020 2020 6465 6620 5f62 696e 645f  d.    def _bind_
-00025ac0: 6f70 6572 6174 6f72 5f6d 6574 686f 6428  operator_method(
-00025ad0: 636c 732c 206e 616d 652c 206f 702c 206f  cls, name, op, o
-00025ae0: 7269 6769 6e61 6c3d 7064 2e53 6572 6965  riginal=pd.Serie
-00025af0: 7329 3a0a 2020 2020 2020 2020 2222 2262  s):.        """b
-00025b00: 696e 6420 6f70 6572 6174 6f72 206d 6574  ind operator met
-00025b10: 686f 6420 6c69 6b65 2053 6572 6965 732e  hod like Series.
-00025b20: 6164 6420 746f 2074 6869 7320 636c 6173  add to this clas
-00025b30: 7322 2222 0a0a 2020 2020 2020 2020 6465  s"""..        de
-00025b40: 6620 6d65 7468 2873 656c 662c 206f 7468  f meth(self, oth
-00025b50: 6572 2c20 6c65 7665 6c3d 4e6f 6e65 2c20  er, level=None, 
-00025b60: 6669 6c6c 5f76 616c 7565 3d4e 6f6e 652c  fill_value=None,
-00025b70: 2061 7869 733d 3029 3a0a 2020 2020 2020   axis=0):.      
-00025b80: 2020 2020 2020 6966 206c 6576 656c 2069        if level i
-00025b90: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00025ba0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00025bb0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
-00025bc0: 4572 726f 7228 226c 6576 656c 206d 7573  Error("level mus
-00025bd0: 7420 6265 204e 6f6e 6522 290a 2020 2020  t be None").    
-00025be0: 2020 2020 2020 2020 6178 6973 203d 2073          axis = s
-00025bf0: 656c 662e 5f76 616c 6964 6174 655f 6178  elf._validate_ax
-00025c00: 6973 2861 7869 7329 0a20 2020 2020 2020  is(axis).       
-00025c10: 2020 2020 206d 6574 6120 3d20 5f65 6d75       meta = _emu
-00025c20: 6c61 7465 286f 702c 2073 656c 662c 206f  late(op, self, o
-00025c30: 7468 6572 2c20 6178 6973 3d61 7869 732c  ther, axis=axis,
-00025c40: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
-00025c50: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
-00025c60: 2020 2020 7265 7475 726e 206d 6170 5f70      return map_p
-00025c70: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
-00025c80: 2020 2020 2020 2020 2020 206f 702c 2073             op, s
-00025c90: 656c 662c 206f 7468 6572 2c20 6d65 7461  elf, other, meta
-00025ca0: 3d6d 6574 612c 2061 7869 733d 6178 6973  =meta, axis=axis
-00025cb0: 2c20 6669 6c6c 5f76 616c 7565 3d66 696c  , fill_value=fil
-00025cc0: 6c5f 7661 6c75 650a 2020 2020 2020 2020  l_value.        
-00025cd0: 2020 2020 290a 0a20 2020 2020 2020 206d      )..        m
-00025ce0: 6574 682e 5f5f 6e61 6d65 5f5f 203d 206e  eth.__name__ = n
-00025cf0: 616d 650a 2020 2020 2020 2020 7365 7461  ame.        seta
-00025d00: 7474 7228 636c 732c 206e 616d 652c 2064  ttr(cls, name, d
-00025d10: 6572 6976 6564 5f66 726f 6d28 6f72 6967  erived_from(orig
-00025d20: 696e 616c 2928 6d65 7468 2929 0a0a 2020  inal)(meth))..  
-00025d30: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00025d40: 2020 2064 6566 205f 6269 6e64 5f63 6f6d     def _bind_com
-00025d50: 7061 7269 736f 6e5f 6d65 7468 6f64 2863  parison_method(c
-00025d60: 6c73 2c20 6e61 6d65 2c20 636f 6d70 6172  ls, name, compar
-00025d70: 6973 6f6e 2c20 6f72 6967 696e 616c 3d70  ison, original=p
-00025d80: 642e 5365 7269 6573 293a 0a20 2020 2020  d.Series):.     
-00025d90: 2020 2022 2222 6269 6e64 2063 6f6d 7061     """bind compa
-00025da0: 7269 736f 6e20 6d65 7468 6f64 206c 696b  rison method lik
-00025db0: 6520 5365 7269 6573 2e65 7120 746f 2074  e Series.eq to t
-00025dc0: 6869 7320 636c 6173 7322 2222 0a0a 2020  his class"""..  
-00025dd0: 2020 2020 2020 6465 6620 6d65 7468 2873        def meth(s
-00025de0: 656c 662c 206f 7468 6572 2c20 6c65 7665  elf, other, leve
-00025df0: 6c3d 4e6f 6e65 2c20 6669 6c6c 5f76 616c  l=None, fill_val
-00025e00: 7565 3d4e 6f6e 652c 2061 7869 733d 3029  ue=None, axis=0)
-00025e10: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00025e20: 206c 6576 656c 2069 7320 6e6f 7420 4e6f   level is not No
-00025e30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00025e40: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-00025e50: 6c65 6d65 6e74 6564 4572 726f 7228 226c  lementedError("l
-00025e60: 6576 656c 206d 7573 7420 6265 204e 6f6e  evel must be Non
-00025e70: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00025e80: 6178 6973 203d 2073 656c 662e 5f76 616c  axis = self._val
-00025e90: 6964 6174 655f 6178 6973 2861 7869 7329  idate_axis(axis)
-00025ea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00025eb0: 6669 6c6c 5f76 616c 7565 2069 7320 4e6f  fill_value is No
-00025ec0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00025ed0: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-00025ee0: 6973 6528 636f 6d70 6172 6973 6f6e 2c20  ise(comparison, 
-00025ef0: 7365 6c66 2c20 6f74 6865 722c 2061 7869  self, other, axi
-00025f00: 733d 6178 6973 290a 2020 2020 2020 2020  s=axis).        
-00025f10: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025f20: 2020 2020 2020 2020 2020 6f70 203d 2070            op = p
-00025f30: 6172 7469 616c 2863 6f6d 7061 7269 736f  artial(compariso
-00025f40: 6e2c 2066 696c 6c5f 7661 6c75 653d 6669  n, fill_value=fi
-00025f50: 6c6c 5f76 616c 7565 290a 2020 2020 2020  ll_value).      
-00025f60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00025f70: 2065 6c65 6d77 6973 6528 6f70 2c20 7365   elemwise(op, se
-00025f80: 6c66 2c20 6f74 6865 722c 2061 7869 733d  lf, other, axis=
-00025f90: 6178 6973 290a 0a20 2020 2020 2020 206d  axis)..        m
-00025fa0: 6574 682e 5f5f 6e61 6d65 5f5f 203d 206e  eth.__name__ = n
-00025fb0: 616d 650a 2020 2020 2020 2020 7365 7461  ame.        seta
-00025fc0: 7474 7228 636c 732c 206e 616d 652c 2064  ttr(cls, name, d
-00025fd0: 6572 6976 6564 5f66 726f 6d28 6f72 6967  erived_from(orig
-00025fe0: 696e 616c 2928 6d65 7468 2929 0a0a 2020  inal)(meth))..  
-00025ff0: 2020 4069 6e73 6572 745f 6d65 7461 5f70    @insert_meta_p
-00026000: 6172 616d 5f64 6573 6372 6970 7469 6f6e  aram_description
-00026010: 2870 6164 3d31 3229 0a20 2020 2064 6566  (pad=12).    def
-00026020: 2061 7070 6c79 2873 656c 662c 2066 756e   apply(self, fun
-00026030: 632c 2063 6f6e 7665 7274 5f64 7479 7065  c, convert_dtype
-00026040: 3d6e 6f5f 6465 6661 756c 742c 206d 6574  =no_default, met
-00026050: 613d 6e6f 5f64 6566 6175 6c74 2c20 6172  a=no_default, ar
-00026060: 6773 3d28 292c 202a 2a6b 7764 7329 3a0a  gs=(), **kwds):.
-00026070: 2020 2020 2020 2020 2222 2250 6172 616c          """Paral
-00026080: 6c65 6c20 7665 7273 696f 6e20 6f66 2070  lel version of p
-00026090: 616e 6461 732e 5365 7269 6573 2e61 7070  andas.Series.app
-000260a0: 6c79 0a0a 2020 2020 2020 2020 5061 7261  ly..        Para
-000260b0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-000260c0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-000260d0: 2020 6675 6e63 203a 2066 756e 6374 696f    func : functio
-000260e0: 6e0a 2020 2020 2020 2020 2020 2020 4675  n.            Fu
-000260f0: 6e63 7469 6f6e 2074 6f20 6170 706c 790a  nction to apply.
-00026100: 2020 2020 2020 2020 636f 6e76 6572 745f          convert_
-00026110: 6474 7970 6520 3a20 626f 6f6c 6561 6e2c  dtype : boolean,
-00026120: 2064 6566 6175 6c74 2054 7275 650a 2020   default True.  
-00026130: 2020 2020 2020 2020 2020 5472 7920 746f            Try to
-00026140: 2066 696e 6420 6265 7474 6572 2064 7479   find better dty
-00026150: 7065 2066 6f72 2065 6c65 6d65 6e74 7769  pe for elementwi
-00026160: 7365 2066 756e 6374 696f 6e20 7265 7375  se function resu
-00026170: 6c74 732e 0a20 2020 2020 2020 2020 2020  lts..           
-00026180: 2049 6620 4661 6c73 652c 206c 6561 7665   If False, leave
-00026190: 2061 7320 6474 7970 653d 6f62 6a65 6374   as dtype=object
-000261a0: 2e0a 2020 2020 2020 2020 244d 4554 410a  ..        $META.
-000261b0: 2020 2020 2020 2020 6172 6773 203a 2074          args : t
-000261c0: 7570 6c65 0a20 2020 2020 2020 2020 2020  uple.           
-000261d0: 2050 6f73 6974 696f 6e61 6c20 6172 6775   Positional argu
-000261e0: 6d65 6e74 7320 746f 2070 6173 7320 746f  ments to pass to
-000261f0: 2066 756e 6374 696f 6e20 696e 2061 6464   function in add
-00026200: 6974 696f 6e20 746f 2074 6865 2076 616c  ition to the val
-00026210: 7565 2e0a 0a20 2020 2020 2020 2041 6464  ue...        Add
-00026220: 6974 696f 6e61 6c20 6b65 7977 6f72 6420  itional keyword 
-00026230: 6172 6775 6d65 6e74 7320 7769 6c6c 2062  arguments will b
-00026240: 6520 7061 7373 6564 2061 7320 6b65 7977  e passed as keyw
-00026250: 6f72 6473 2074 6f20 7468 6520 6675 6e63  ords to the func
-00026260: 7469 6f6e 2e0a 0a20 2020 2020 2020 2052  tion...        R
-00026270: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00026280: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2061  ------.        a
-00026290: 7070 6c69 6564 203a 2053 6572 6965 7320  pplied : Series 
-000262a0: 6f72 2044 6174 6146 7261 6d65 2069 6620  or DataFrame if 
-000262b0: 6675 6e63 2072 6574 7572 6e73 2061 2053  func returns a S
-000262c0: 6572 6965 732e 0a0a 2020 2020 2020 2020  eries...        
-000262d0: 4578 616d 706c 6573 0a20 2020 2020 2020  Examples.       
-000262e0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000262f0: 2020 3e3e 3e20 696d 706f 7274 2064 6173    >>> import das
-00026300: 6b2e 6461 7461 6672 616d 6520 6173 2064  k.dataframe as d
-00026310: 640a 2020 2020 2020 2020 3e3e 3e20 7320  d.        >>> s 
-00026320: 3d20 7064 2e53 6572 6965 7328 7261 6e67  = pd.Series(rang
-00026330: 6528 3529 2c20 6e61 6d65 3d27 7827 290a  e(5), name='x').
-00026340: 2020 2020 2020 2020 3e3e 3e20 6473 203d          >>> ds =
-00026350: 2064 642e 6672 6f6d 5f70 616e 6461 7328   dd.from_pandas(
-00026360: 732c 206e 7061 7274 6974 696f 6e73 3d32  s, npartitions=2
-00026370: 290a 0a20 2020 2020 2020 2041 7070 6c79  )..        Apply
-00026380: 2061 2066 756e 6374 696f 6e20 656c 656d   a function elem
-00026390: 656e 7477 6973 6520 6163 726f 7373 2074  entwise across t
-000263a0: 6865 2053 6572 6965 732c 2070 6173 7369  he Series, passi
-000263b0: 6e67 2069 6e20 6578 7472 610a 2020 2020  ng in extra.    
-000263c0: 2020 2020 6172 6775 6d65 6e74 7320 696e      arguments in
-000263d0: 2060 6061 7267 7360 6020 616e 6420 6060   ``args`` and ``
-000263e0: 6b77 6172 6773 6060 3a0a 0a20 2020 2020  kwargs``:..     
-000263f0: 2020 203e 3e3e 2064 6566 206d 7961 6464     >>> def myadd
-00026400: 2878 2c20 612c 2062 3d31 293a 0a20 2020  (x, a, b=1):.   
-00026410: 2020 2020 202e 2e2e 2020 2020 2072 6574       ...     ret
-00026420: 7572 6e20 7820 2b20 6120 2b20 620a 2020  urn x + a + b.  
-00026430: 2020 2020 2020 3e3e 3e20 7265 7320 3d20        >>> res = 
-00026440: 6473 2e61 7070 6c79 286d 7961 6464 2c20  ds.apply(myadd, 
-00026450: 6172 6773 3d28 322c 292c 2062 3d31 2e35  args=(2,), b=1.5
-00026460: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00026470: 4b49 500a 0a20 2020 2020 2020 2042 7920  KIP..        By 
-00026480: 6465 6661 756c 742c 2064 6173 6b20 7472  default, dask tr
-00026490: 6965 7320 746f 2069 6e66 6572 2074 6865  ies to infer the
-000264a0: 206f 7574 7075 7420 6d65 7461 6461 7461   output metadata
-000264b0: 2062 7920 7275 6e6e 696e 6720 796f 7572   by running your
-000264c0: 0a20 2020 2020 2020 2070 726f 7669 6465  .        provide
-000264d0: 6420 6675 6e63 7469 6f6e 206f 6e20 736f  d function on so
-000264e0: 6d65 2066 616b 6520 6461 7461 2e20 5468  me fake data. Th
-000264f0: 6973 2077 6f72 6b73 2077 656c 6c20 696e  is works well in
-00026500: 206d 616e 7920 6361 7365 732c 2062 7574   many cases, but
-00026510: 0a20 2020 2020 2020 2063 616e 2073 6f6d  .        can som
-00026520: 6574 696d 6573 2062 6520 6578 7065 6e73  etimes be expens
-00026530: 6976 652c 206f 7220 6576 656e 2066 6169  ive, or even fai
-00026540: 6c2e 2054 6f20 6176 6f69 6420 7468 6973  l. To avoid this
-00026550: 2c20 796f 7520 6361 6e0a 2020 2020 2020  , you can.      
-00026560: 2020 6d61 6e75 616c 6c79 2073 7065 6369    manually speci
-00026570: 6679 2074 6865 206f 7574 7075 7420 6d65  fy the output me
-00026580: 7461 6461 7461 2077 6974 6820 7468 6520  tadata with the 
-00026590: 6060 6d65 7461 6060 206b 6579 776f 7264  ``meta`` keyword
-000265a0: 2e20 5468 6973 0a20 2020 2020 2020 2063  . This.        c
-000265b0: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-000265c0: 696e 206d 616e 7920 666f 726d 732c 2066  in many forms, f
-000265d0: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
-000265e0: 696f 6e20 7365 650a 2020 2020 2020 2020  ion see.        
-000265f0: 6060 6461 736b 2e64 6174 6166 7261 6d65  ``dask.dataframe
-00026600: 2e75 7469 6c73 2e6d 616b 655f 6d65 7461  .utils.make_meta
-00026610: 6060 2e0a 0a20 2020 2020 2020 2048 6572  ``...        Her
-00026620: 6520 7765 2073 7065 6369 6679 2074 6865  e we specify the
-00026630: 206f 7574 7075 7420 6973 2061 2053 6572   output is a Ser
-00026640: 6965 7320 7769 7468 206e 616d 6520 6060  ies with name ``
-00026650: 2778 2760 602c 2061 6e64 2064 7479 7065  'x'``, and dtype
-00026660: 0a20 2020 2020 2020 2060 6066 6c6f 6174  .        ``float
-00026670: 3634 6060 3a0a 0a20 2020 2020 2020 203e  64``:..        >
-00026680: 3e3e 2072 6573 203d 2064 732e 6170 706c  >> res = ds.appl
-00026690: 7928 6d79 6164 642c 2061 7267 733d 2832  y(myadd, args=(2
-000266a0: 2c29 2c20 623d 312e 352c 206d 6574 613d  ,), b=1.5, meta=
-000266b0: 2827 7827 2c20 2766 3827 2929 0a0a 2020  ('x', 'f8'))..  
-000266c0: 2020 2020 2020 496e 2074 6865 2063 6173        In the cas
-000266d0: 6520 7768 6572 6520 7468 6520 6d65 7461  e where the meta
-000266e0: 6461 7461 2064 6f65 736e 2774 2063 6861  data doesn't cha
-000266f0: 6e67 652c 2079 6f75 2063 616e 2061 6c73  nge, you can als
-00026700: 6f20 7061 7373 2069 6e0a 2020 2020 2020  o pass in.      
-00026710: 2020 7468 6520 6f62 6a65 6374 2069 7473    the object its
-00026720: 656c 6620 6469 7265 6374 6c79 3a0a 0a20  elf directly:.. 
-00026730: 2020 2020 2020 203e 3e3e 2072 6573 203d         >>> res =
-00026740: 2064 732e 6170 706c 7928 6c61 6d62 6461   ds.apply(lambda
-00026750: 2078 3a20 7820 2b20 312c 206d 6574 613d   x: x + 1, meta=
-00026760: 6473 290a 0a20 2020 2020 2020 2053 6565  ds)..        See
-00026770: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
-00026780: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
-00026790: 6173 6b2e 5365 7269 6573 2e6d 6170 5f70  ask.Series.map_p
-000267a0: 6172 7469 7469 6f6e 730a 2020 2020 2020  artitions.      
-000267b0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000267c0: 2063 6f6e 7665 7274 5f64 7479 7065 2069   convert_dtype i
-000267d0: 7320 6e6f 7420 6e6f 5f64 6566 6175 6c74  s not no_default
-000267e0: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
-000267f0: 6473 5b22 636f 6e76 6572 745f 6474 7970  ds["convert_dtyp
-00026800: 6522 5d20 3d20 636f 6e76 6572 745f 6474  e"] = convert_dt
-00026810: 7970 650a 0a20 2020 2020 2020 2023 206c  ype..        # l
-00026820: 6574 2070 616e 6461 7320 7472 6967 6765  et pandas trigge
-00026830: 7220 616e 7920 7761 726e 696e 6773 2c20  r any warnings, 
-00026840: 7375 6368 2061 7320 636f 6e76 6572 745f  such as convert_
-00026850: 6474 7970 6520 7761 726e 696e 670a 2020  dtype warning.  
-00026860: 2020 2020 2020 7365 6c66 2e5f 6d65 7461        self._meta
-00026870: 2e61 7070 6c79 2866 756e 632c 2061 7267  .apply(func, arg
-00026880: 733d 6172 6773 2c20 2a2a 6b77 6473 290a  s=args, **kwds).
-00026890: 0a20 2020 2020 2020 2069 6620 6d65 7461  .        if meta
-000268a0: 2069 7320 6e6f 5f64 6566 6175 6c74 3a0a   is no_default:.
-000268b0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000268c0: 2063 6865 636b 5f63 6f6e 7665 7274 5f64   check_convert_d
-000268d0: 7479 7065 5f64 6570 7265 6361 7469 6f6e  type_deprecation
-000268e0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000268f0: 2020 2020 6d65 7461 203d 205f 656d 756c      meta = _emul
-00026900: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00026910: 2020 2020 2020 2020 204d 2e61 7070 6c79           M.apply
-00026920: 2c20 7365 6c66 2e5f 6d65 7461 5f6e 6f6e  , self._meta_non
-00026930: 656d 7074 792c 2066 756e 632c 2061 7267  empty, func, arg
-00026940: 733d 6172 6773 2c20 7564 663d 5472 7565  s=args, udf=True
-00026950: 2c20 2a2a 6b77 6473 0a20 2020 2020 2020  , **kwds.       
-00026960: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00026970: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-00026980: 7761 726e 286d 6574 615f 7761 726e 696e  warn(meta_warnin
-00026990: 6728 6d65 7461 2929 0a20 2020 2020 2020  g(meta)).       
-000269a0: 2065 6c69 6620 5041 4e44 4153 5f47 545f   elif PANDAS_GT_
-000269b0: 3231 303a 0a20 2020 2020 2020 2020 2020  210:.           
-000269c0: 2074 6573 745f 6d65 7461 203d 206d 616b   test_meta = mak
-000269d0: 655f 6d65 7461 286d 6574 6129 0a20 2020  e_meta(meta).   
-000269e0: 2020 2020 2020 2020 2069 6620 6973 5f64           if is_d
-000269f0: 6174 6166 7261 6d65 5f6c 696b 6528 7465  ataframe_like(te
-00026a00: 7374 5f6d 6574 6129 3a0a 2020 2020 2020  st_meta):.      
-00026a10: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00026a20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-00026a30: 2020 2020 2020 2020 2020 2020 2022 5265               "Re
-00026a40: 7475 726e 696e 6720 6120 4461 7461 4672  turning a DataFr
-00026a50: 616d 6520 6672 6f6d 2053 6572 6965 732e  ame from Series.
-00026a60: 6170 706c 7920 7768 656e 2074 6865 2073  apply when the s
-00026a70: 7570 706c 6965 6420 6675 6e63 7469 6f6e  upplied function
-00026a80: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00026a90: 2020 2020 2020 2022 7265 7475 726e 7320         "returns 
-00026aa0: 6120 5365 7269 6573 2069 7320 6465 7072  a Series is depr
-00026ab0: 6563 6174 6564 2061 6e64 2077 696c 6c20  ecated and will 
-00026ac0: 6265 2072 656d 6f76 6564 2069 6e20 6120  be removed in a 
-00026ad0: 6675 7475 7265 2076 6572 7369 6f6e 2e22  future version."
-00026ae0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00026af0: 2020 2020 2020 4675 7475 7265 5761 726e        FutureWarn
-00026b00: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00026b10: 2020 2020 2020 2020 2073 7461 636b 6c65           stackle
-00026b20: 7665 6c3d 322c 0a20 2020 2020 2020 2020  vel=2,.         
-00026b30: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00026b40: 2020 7265 7475 726e 206d 6170 5f70 6172    return map_par
-00026b50: 7469 7469 6f6e 7328 6d65 7468 6f64 732e  titions(methods.
-00026b60: 6170 706c 792c 2073 656c 662c 2066 756e  apply, self, fun
-00026b70: 632c 2061 7267 733d 6172 6773 2c20 6d65  c, args=args, me
-00026b80: 7461 3d6d 6574 612c 202a 2a6b 7764 7329  ta=meta, **kwds)
-00026b90: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-00026ba0: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
-00026bb0: 2020 2064 6566 2063 6f76 2873 656c 662c     def cov(self,
-00026bc0: 206f 7468 6572 2c20 6d69 6e5f 7065 7269   other, min_peri
-00026bd0: 6f64 733d 4e6f 6e65 2c20 7370 6c69 745f  ods=None, split_
-00026be0: 6576 6572 793d 4661 6c73 6529 3a0a 2020  every=False):.  
-00026bf0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00026c00: 6461 7461 6672 616d 652e 6d75 6c74 6920  dataframe.multi 
-00026c10: 696d 706f 7274 2063 6f6e 6361 740a 0a20  import concat.. 
-00026c20: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00026c30: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
-00026c40: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
-00026c50: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00026c60: 7272 6f72 2822 6f74 6865 7220 6d75 7374  rror("other must
-00026c70: 2062 6520 6120 6461 736b 2e64 6174 6166   be a dask.dataf
-00026c80: 7261 6d65 2e53 6572 6965 7322 290a 2020  rame.Series").  
-00026c90: 2020 2020 2020 6466 203d 2063 6f6e 6361        df = conca
-00026ca0: 7428 5b73 656c 662c 206f 7468 6572 5d2c  t([self, other],
-00026cb0: 2061 7869 733d 3129 0a20 2020 2020 2020   axis=1).       
-00026cc0: 2072 6574 7572 6e20 5f63 6f76 5f63 6f72   return _cov_cor
-00026cd0: 7228 0a20 2020 2020 2020 2020 2020 2064  r(.            d
-00026ce0: 662c 206d 696e 5f70 6572 696f 6473 2c20  f, min_periods, 
-00026cf0: 7363 616c 6172 3d54 7275 652c 206e 756d  scalar=True, num
-00026d00: 6572 6963 5f6f 6e6c 793d 4661 6c73 652c  eric_only=False,
-00026d10: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
-00026d20: 6974 5f65 7665 7279 0a20 2020 2020 2020  it_every.       
-00026d30: 2029 0a0a 2020 2020 4064 6572 6976 6564   )..    @derived
-00026d40: 5f66 726f 6d28 7064 2e53 6572 6965 7329  _from(pd.Series)
-00026d50: 0a20 2020 2064 6566 2063 6f72 7228 7365  .    def corr(se
-00026d60: 6c66 2c20 6f74 6865 722c 206d 6574 686f  lf, other, metho
-00026d70: 643d 2270 6561 7273 6f6e 222c 206d 696e  d="pearson", min
-00026d80: 5f70 6572 696f 6473 3d4e 6f6e 652c 2073  _periods=None, s
-00026d90: 706c 6974 5f65 7665 7279 3d46 616c 7365  plit_every=False
-00026da0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
-00026db0: 6461 736b 2e64 6174 6166 7261 6d65 2e6d  dask.dataframe.m
-00026dc0: 756c 7469 2069 6d70 6f72 7420 636f 6e63  ulti import conc
-00026dd0: 6174 0a0a 2020 2020 2020 2020 6966 206e  at..        if n
-00026de0: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
-00026df0: 6865 722c 2053 6572 6965 7329 3a0a 2020  her, Series):.  
-00026e00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00026e10: 5479 7065 4572 726f 7228 226f 7468 6572  TypeError("other
-00026e20: 206d 7573 7420 6265 2061 2064 6173 6b2e   must be a dask.
-00026e30: 6461 7461 6672 616d 652e 5365 7269 6573  dataframe.Series
-00026e40: 2229 0a20 2020 2020 2020 2069 6620 6d65  ").        if me
-00026e50: 7468 6f64 2021 3d20 2270 6561 7273 6f6e  thod != "pearson
-00026e60: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00026e70: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00026e80: 7465 6445 7272 6f72 2822 4f6e 6c79 2050  tedError("Only P
-00026e90: 6561 7273 6f6e 2063 6f72 7265 6c61 7469  earson correlati
-00026ea0: 6f6e 2068 6173 2062 6565 6e20 696d 706c  on has been impl
-00026eb0: 656d 656e 7465 6422 290a 2020 2020 2020  emented").      
-00026ec0: 2020 6466 203d 2063 6f6e 6361 7428 5b73    df = concat([s
-00026ed0: 656c 662c 206f 7468 6572 5d2c 2061 7869  elf, other], axi
-00026ee0: 733d 3129 0a20 2020 2020 2020 2072 6574  s=1).        ret
-00026ef0: 7572 6e20 5f63 6f76 5f63 6f72 7228 0a20  urn _cov_corr(. 
-00026f00: 2020 2020 2020 2020 2020 2064 662c 0a20             df,. 
-00026f10: 2020 2020 2020 2020 2020 206d 696e 5f70             min_p
-00026f20: 6572 696f 6473 2c0a 2020 2020 2020 2020  eriods,.        
-00026f30: 2020 2020 636f 7272 3d54 7275 652c 0a20      corr=True,. 
-00026f40: 2020 2020 2020 2020 2020 2073 6361 6c61             scala
-00026f50: 723d 5472 7565 2c0a 2020 2020 2020 2020  r=True,.        
-00026f60: 2020 2020 6e75 6d65 7269 635f 6f6e 6c79      numeric_only
-00026f70: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00026f80: 2020 2020 7370 6c69 745f 6576 6572 793d      split_every=
-00026f90: 7370 6c69 745f 6576 6572 792c 0a20 2020  split_every,.   
-00026fa0: 2020 2020 2029 0a0a 2020 2020 4064 6572       )..    @der
-00026fb0: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
-00026fc0: 6965 7329 0a20 2020 2064 6566 2061 7574  ies).    def aut
-00026fd0: 6f63 6f72 7228 7365 6c66 2c20 6c61 673d  ocorr(self, lag=
-00026fe0: 312c 2073 706c 6974 5f65 7665 7279 3d46  1, split_every=F
-00026ff0: 616c 7365 293a 0a20 2020 2020 2020 2069  alse):.        i
-00027000: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00027010: 286c 6167 2c20 496e 7465 6772 616c 293a  (lag, Integral):
-00027020: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00027030: 7365 2054 7970 6545 7272 6f72 2822 6c61  se TypeError("la
-00027040: 6720 6d75 7374 2062 6520 616e 2069 6e74  g must be an int
-00027050: 6567 6572 2229 0a20 2020 2020 2020 2072  eger").        r
-00027060: 6574 7572 6e20 7365 6c66 2e63 6f72 7228  eturn self.corr(
-00027070: 7365 6c66 2069 6620 6c61 6720 3d3d 2030  self if lag == 0
-00027080: 2065 6c73 6520 7365 6c66 2e73 6869 6674   else self.shift
-00027090: 286c 6167 292c 2073 706c 6974 5f65 7665  (lag), split_eve
-000270a0: 7279 3d73 706c 6974 5f65 7665 7279 290a  ry=split_every).
-000270b0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-000270c0: 6f6d 2870 642e 5365 7269 6573 290a 2020  om(pd.Series).  
-000270d0: 2020 6465 6620 6d65 6d6f 7279 5f75 7361    def memory_usa
-000270e0: 6765 2873 656c 662c 2069 6e64 6578 3d54  ge(self, index=T
-000270f0: 7275 652c 2064 6565 703d 4661 6c73 6529  rue, deep=False)
-00027100: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00027110: 2073 656c 662e 7265 6475 6374 696f 6e28   self.reduction(
-00027120: 0a20 2020 2020 2020 2020 2020 204d 2e6d  .            M.m
-00027130: 656d 6f72 795f 7573 6167 652c 0a20 2020  emory_usage,.   
-00027140: 2020 2020 2020 2020 204d 2e73 756d 2c0a           M.sum,.
-00027150: 2020 2020 2020 2020 2020 2020 6368 756e              chun
-00027160: 6b5f 6b77 6172 6773 3d7b 2269 6e64 6578  k_kwargs={"index
-00027170: 223a 2069 6e64 6578 2c20 2264 6565 7022  ": index, "deep"
-00027180: 3a20 6465 6570 7d2c 0a20 2020 2020 2020  : deep},.       
-00027190: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
-000271a0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-000271b0: 2020 2020 746f 6b65 6e3d 7365 6c66 2e5f      token=self._
-000271c0: 746f 6b65 6e5f 7072 6566 6978 202b 2022  token_prefix + "
-000271d0: 6d65 6d6f 7279 2d75 7361 6765 222c 0a20  memory-usage",. 
-000271e0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000271f0: 6620 5f5f 6469 766d 6f64 5f5f 2873 656c  f __divmod__(sel
-00027200: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00027210: 2020 2072 6573 3120 3d20 7365 6c66 202f     res1 = self /
-00027220: 2f20 6f74 6865 720a 2020 2020 2020 2020  / other.        
-00027230: 7265 7332 203d 2073 656c 6620 2520 6f74  res2 = self % ot
-00027240: 6865 720a 2020 2020 2020 2020 7265 7475  her.        retu
-00027250: 726e 2072 6573 312c 2072 6573 320a 0a20  rn res1, res2.. 
-00027260: 2020 2064 6566 205f 5f72 6469 766d 6f64     def __rdivmod
-00027270: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-00027280: 0a20 2020 2020 2020 2072 6573 3120 3d20  .        res1 = 
-00027290: 6f74 6865 7220 2f2f 2073 656c 660a 2020  other // self.  
-000272a0: 2020 2020 2020 7265 7332 203d 206f 7468        res2 = oth
-000272b0: 6572 2025 2073 656c 660a 2020 2020 2020  er % self.      
-000272c0: 2020 7265 7475 726e 2072 6573 312c 2072    return res1, r
-000272d0: 6573 320a 0a20 2020 2069 6620 6e6f 7420  es2..    if not 
-000272e0: 5041 4e44 4153 5f47 545f 3230 303a 0a0a  PANDAS_GT_200:..
-000272f0: 2020 2020 2020 2020 4070 726f 7065 7274          @propert
-00027300: 790a 2020 2020 2020 2020 4064 6572 6976  y.        @deriv
-00027310: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
-00027320: 7329 0a20 2020 2020 2020 2064 6566 2069  s).        def i
-00027330: 735f 6d6f 6e6f 746f 6e69 6328 7365 6c66  s_monotonic(self
-00027340: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00027350: 6620 5041 4e44 4153 5f47 545f 3135 303a  f PANDAS_GT_150:
-00027360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027370: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-00027380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027390: 2020 2020 2269 735f 6d6f 6e6f 746f 6e69      "is_monotoni
-000273a0: 6320 6973 2064 6570 7265 6361 7465 6420  c is deprecated 
-000273b0: 616e 6420 7769 6c6c 2062 6520 7265 6d6f  and will be remo
-000273c0: 7665 6420 696e 2061 2066 7574 7572 6520  ved in a future 
-000273d0: 7665 7273 696f 6e2e 2022 0a20 2020 2020  version. ".     
-000273e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000273f0: 5573 6520 6973 5f6d 6f6e 6f74 6f6e 6963  Use is_monotonic
-00027400: 5f69 6e63 7265 6173 696e 6720 696e 7374  _increasing inst
-00027410: 6561 642e 222c 0a20 2020 2020 2020 2020  ead.",.         
-00027420: 2020 2020 2020 2020 2020 2046 7574 7572             Futur
-00027430: 6557 6172 6e69 6e67 2c0a 2020 2020 2020  eWarning,.      
-00027440: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00027450: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00027460: 656c 662e 6973 5f6d 6f6e 6f74 6f6e 6963  elf.is_monotonic
-00027470: 5f69 6e63 7265 6173 696e 670a 0a20 2020  _increasing..   
-00027480: 2040 7072 6f70 6572 7479 0a20 2020 2040   @property.    @
-00027490: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
-000274a0: 5365 7269 6573 290a 2020 2020 6465 6620  Series).    def 
-000274b0: 6973 5f6d 6f6e 6f74 6f6e 6963 5f69 6e63  is_monotonic_inc
-000274c0: 7265 6173 696e 6728 7365 6c66 293a 0a20  reasing(self):. 
-000274d0: 2020 2020 2020 2072 6574 7572 6e20 6163         return ac
-000274e0: 6128 0a20 2020 2020 2020 2020 2020 2073  a(.            s
-000274f0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00027500: 2063 6875 6e6b 3d6d 6574 686f 6473 2e6d   chunk=methods.m
-00027510: 6f6e 6f74 6f6e 6963 5f69 6e63 7265 6173  onotonic_increas
-00027520: 696e 675f 6368 756e 6b2c 0a20 2020 2020  ing_chunk,.     
-00027530: 2020 2020 2020 2063 6f6d 6269 6e65 3d6d         combine=m
-00027540: 6574 686f 6473 2e6d 6f6e 6f74 6f6e 6963  ethods.monotonic
-00027550: 5f69 6e63 7265 6173 696e 675f 636f 6d62  _increasing_comb
-00027560: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
-00027570: 2061 6767 7265 6761 7465 3d6d 6574 686f   aggregate=metho
-00027580: 6473 2e6d 6f6e 6f74 6f6e 6963 5f69 6e63  ds.monotonic_inc
-00027590: 7265 6173 696e 675f 6167 6772 6567 6174  reasing_aggregat
-000275a0: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-000275b0: 6574 613d 626f 6f6c 2c0a 2020 2020 2020  eta=bool,.      
-000275c0: 2020 2020 2020 746f 6b65 6e3d 226d 6f6e        token="mon
-000275d0: 6f74 6f6e 6963 5f69 6e63 7265 6173 696e  otonic_increasin
-000275e0: 6722 2c0a 2020 2020 2020 2020 290a 0a20  g",.        ).. 
-000275f0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00027600: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00027610: 642e 5365 7269 6573 290a 2020 2020 6465  d.Series).    de
-00027620: 6620 6973 5f6d 6f6e 6f74 6f6e 6963 5f64  f is_monotonic_d
-00027630: 6563 7265 6173 696e 6728 7365 6c66 293a  ecreasing(self):
-00027640: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00027650: 6163 6128 0a20 2020 2020 2020 2020 2020  aca(.           
-00027660: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00027670: 2020 2063 6875 6e6b 3d6d 6574 686f 6473     chunk=methods
-00027680: 2e6d 6f6e 6f74 6f6e 6963 5f64 6563 7265  .monotonic_decre
-00027690: 6173 696e 675f 6368 756e 6b2c 0a20 2020  asing_chunk,.   
-000276a0: 2020 2020 2020 2020 2063 6f6d 6269 6e65           combine
-000276b0: 3d6d 6574 686f 6473 2e6d 6f6e 6f74 6f6e  =methods.monoton
-000276c0: 6963 5f64 6563 7265 6173 696e 675f 636f  ic_decreasing_co
-000276d0: 6d62 696e 652c 0a20 2020 2020 2020 2020  mbine,.         
-000276e0: 2020 2061 6767 7265 6761 7465 3d6d 6574     aggregate=met
-000276f0: 686f 6473 2e6d 6f6e 6f74 6f6e 6963 5f64  hods.monotonic_d
-00027700: 6563 7265 6173 696e 675f 6167 6772 6567  ecreasing_aggreg
-00027710: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00027720: 206d 6574 613d 626f 6f6c 2c0a 2020 2020   meta=bool,.    
-00027730: 2020 2020 2020 2020 746f 6b65 6e3d 226d          token="m
-00027740: 6f6e 6f74 6f6e 6963 5f64 6563 7265 6173  onotonic_decreas
-00027750: 696e 6722 2c0a 2020 2020 2020 2020 290a  ing",.        ).
-00027760: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-00027770: 6f6d 2870 642e 5365 7269 6573 290a 2020  om(pd.Series).  
-00027780: 2020 6465 6620 7669 6577 2873 656c 662c    def view(self,
-00027790: 2064 7479 7065 293a 0a20 2020 2020 2020   dtype):.       
-000277a0: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
-000277b0: 7461 2e76 6965 7728 6474 7970 6529 0a20  ta.view(dtype). 
-000277c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000277d0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-000277e0: 7328 4d2e 7669 6577 2c20 6474 7970 652c  s(M.view, dtype,
-000277f0: 206d 6574 613d 6d65 7461 290a 0a0a 636c   meta=meta)...cl
-00027800: 6173 7320 496e 6465 7828 5365 7269 6573  ass Index(Series
-00027810: 293a 0a20 2020 205f 7061 7274 6974 696f  ):.    _partitio
-00027820: 6e5f 7479 7065 203d 2070 642e 496e 6465  n_type = pd.Inde
-00027830: 780a 2020 2020 5f69 735f 7061 7274 6974  x.    _is_partit
-00027840: 696f 6e5f 7479 7065 203d 2073 7461 7469  ion_type = stati
-00027850: 636d 6574 686f 6428 6973 5f69 6e64 6578  cmethod(is_index
-00027860: 5f6c 696b 6529 0a20 2020 205f 746f 6b65  _like).    _toke
-00027870: 6e5f 7072 6566 6978 203d 2022 696e 6465  n_prefix = "inde
-00027880: 782d 220a 2020 2020 5f61 6363 6573 736f  x-".    _accesso
-00027890: 7273 3a20 436c 6173 7356 6172 5b73 6574  rs: ClassVar[set
-000278a0: 5b73 7472 5d5d 203d 2073 6574 2829 0a0a  [str]] = set()..
-000278b0: 2020 2020 5f64 745f 6174 7472 6962 7574      _dt_attribut
-000278c0: 6573 203d 207b 0a20 2020 2020 2020 2022  es = {.        "
-000278d0: 6e61 6e6f 7365 636f 6e64 222c 0a20 2020  nanosecond",.   
-000278e0: 2020 2020 2022 6d69 6372 6f73 6563 6f6e       "microsecon
-000278f0: 6422 2c0a 2020 2020 2020 2020 226d 696c  d",.        "mil
-00027900: 6c69 7365 636f 6e64 222c 0a20 2020 2020  lisecond",.     
-00027910: 2020 2022 6461 796f 6679 6561 7222 2c0a     "dayofyear",.
-00027920: 2020 2020 2020 2020 226d 696e 7574 6522          "minute"
-00027930: 2c0a 2020 2020 2020 2020 2268 6f75 7222  ,.        "hour"
-00027940: 2c0a 2020 2020 2020 2020 2264 6179 222c  ,.        "day",
-00027950: 0a20 2020 2020 2020 2022 6461 796f 6677  .        "dayofw
-00027960: 6565 6b22 2c0a 2020 2020 2020 2020 2273  eek",.        "s
-00027970: 6563 6f6e 6422 2c0a 2020 2020 2020 2020  econd",.        
-00027980: 2277 6565 6b22 2c0a 2020 2020 2020 2020  "week",.        
-00027990: 2277 6565 6b64 6179 222c 0a20 2020 2020  "weekday",.     
-000279a0: 2020 2022 7765 656b 6f66 7965 6172 222c     "weekofyear",
-000279b0: 0a20 2020 2020 2020 2022 6d6f 6e74 6822  .        "month"
-000279c0: 2c0a 2020 2020 2020 2020 2271 7561 7274  ,.        "quart
-000279d0: 6572 222c 0a20 2020 2020 2020 2022 7965  er",.        "ye
-000279e0: 6172 222c 0a20 2020 207d 0a0a 2020 2020  ar",.    }..    
-000279f0: 5f63 6174 5f61 7474 7269 6275 7465 7320  _cat_attributes 
-00027a00: 3d20 7b0a 2020 2020 2020 2020 226b 6e6f  = {.        "kno
-00027a10: 776e 222c 0a20 2020 2020 2020 2022 6173  wn",.        "as
-00027a20: 5f6b 6e6f 776e 222c 0a20 2020 2020 2020  _known",.       
-00027a30: 2022 6173 5f75 6e6b 6e6f 776e 222c 0a20   "as_unknown",. 
-00027a40: 2020 2020 2020 2022 6164 645f 6361 7465         "add_cate
-00027a50: 676f 7269 6573 222c 0a20 2020 2020 2020  gories",.       
-00027a60: 2022 6361 7465 676f 7269 6573 222c 0a20   "categories",. 
-00027a70: 2020 2020 2020 2022 7265 6d6f 7665 5f63         "remove_c
-00027a80: 6174 6567 6f72 6965 7322 2c0a 2020 2020  ategories",.    
-00027a90: 2020 2020 2272 656f 7264 6572 5f63 6174      "reorder_cat
-00027aa0: 6567 6f72 6965 7322 2c0a 2020 2020 2020  egories",.      
-00027ab0: 2020 2261 735f 6f72 6465 7265 6422 2c0a    "as_ordered",.
-00027ac0: 2020 2020 2020 2020 2263 6f64 6573 222c          "codes",
-00027ad0: 0a20 2020 2020 2020 2022 7265 6d6f 7665  .        "remove
-00027ae0: 5f75 6e75 7365 645f 6361 7465 676f 7269  _unused_categori
-00027af0: 6573 222c 0a20 2020 2020 2020 2022 7365  es",.        "se
-00027b00: 745f 6361 7465 676f 7269 6573 222c 0a20  t_categories",. 
-00027b10: 2020 2020 2020 2022 6173 5f75 6e6f 7264         "as_unord
-00027b20: 6572 6564 222c 0a20 2020 2020 2020 2022  ered",.        "
-00027b30: 6f72 6465 7265 6422 2c0a 2020 2020 2020  ordered",.      
-00027b40: 2020 2272 656e 616d 655f 6361 7465 676f    "rename_catego
-00027b50: 7269 6573 222c 0a20 2020 207d 0a0a 2020  ries",.    }..  
-00027b60: 2020 5f6d 6f6e 6f74 6f6e 6963 5f61 7474    _monotonic_att
-00027b70: 7269 6275 7465 7320 3d20 7b0a 2020 2020  ributes = {.    
-00027b80: 2020 2020 2269 735f 6d6f 6e6f 746f 6e69      "is_monotoni
-00027b90: 6322 2c0a 2020 2020 2020 2020 2269 735f  c",.        "is_
-00027ba0: 6d6f 6e6f 746f 6e69 635f 696e 6372 6561  monotonic_increa
-00027bb0: 7369 6e67 222c 0a20 2020 2020 2020 2022  sing",.        "
-00027bc0: 6973 5f6d 6f6e 6f74 6f6e 6963 5f64 6563  is_monotonic_dec
-00027bd0: 7265 6173 696e 6722 2c0a 2020 2020 7d0a  reasing",.    }.
-00027be0: 0a20 2020 2064 6566 205f 5f67 6574 6174  .    def __getat
-00027bf0: 7472 5f5f 2873 656c 662c 206b 6579 293a  tr__(self, key):
-00027c00: 0a20 2020 2020 2020 2069 6620 280a 2020  .        if (.  
-00027c10: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
-00027c20: 616e 6365 2873 656c 662e 5f6d 6574 612e  ance(self._meta.
-00027c30: 6474 7970 652c 2070 642e 4361 7465 676f  dtype, pd.Catego
-00027c40: 7269 6361 6c44 7479 7065 290a 2020 2020  ricalDtype).    
-00027c50: 2020 2020 2020 2020 616e 6420 6b65 7920          and key 
-00027c60: 696e 2073 656c 662e 5f63 6174 5f61 7474  in self._cat_att
-00027c70: 7269 6275 7465 730a 2020 2020 2020 2020  ributes.        
-00027c80: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00027c90: 6574 7572 6e20 6765 7461 7474 7228 7365  eturn getattr(se
-00027ca0: 6c66 2e63 6174 2c20 6b65 7929 0a20 2020  lf.cat, key).   
-00027cb0: 2020 2020 2065 6c69 6620 6b65 7920 696e       elif key in
-00027cc0: 2073 656c 662e 5f64 745f 6174 7472 6962   self._dt_attrib
-00027cd0: 7574 6573 3a0a 2020 2020 2020 2020 2020  utes:.          
-00027ce0: 2020 7265 7475 726e 2067 6574 6174 7472    return getattr
-00027cf0: 2873 656c 662e 6474 2c20 6b65 7929 0a20  (self.dt, key). 
-00027d00: 2020 2020 2020 2065 6c69 6620 6b65 7920         elif key 
-00027d10: 696e 2073 656c 662e 5f6d 6f6e 6f74 6f6e  in self._monoton
-00027d20: 6963 5f61 7474 7269 6275 7465 733a 0a20  ic_attributes:. 
-00027d30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00027d40: 6e20 6765 7461 7474 7228 7365 6c66 2c20  n getattr(self, 
-00027d50: 6b65 7929 0a20 2020 2020 2020 2072 6169  key).        rai
-00027d60: 7365 2041 7474 7269 6275 7465 4572 726f  se AttributeErro
-00027d70: 7228 2227 496e 6465 7827 206f 626a 6563  r("'Index' objec
-00027d80: 7420 6861 7320 6e6f 2061 7474 7269 6275  t has no attribu
-00027d90: 7465 2025 7222 2025 206b 6579 290a 0a20  te %r" % key).. 
-00027da0: 2020 2064 6566 205f 5f64 6972 5f5f 2873     def __dir__(s
-00027db0: 656c 6629 3a0a 2020 2020 2020 2020 6f75  elf):.        ou
-00027dc0: 7420 3d20 7375 7065 7228 292e 5f5f 6469  t = super().__di
-00027dd0: 725f 5f28 290a 2020 2020 2020 2020 6f75  r__().        ou
-00027de0: 742e 6578 7465 6e64 2873 656c 662e 5f64  t.extend(self._d
-00027df0: 745f 6174 7472 6962 7574 6573 290a 2020  t_attributes).  
-00027e00: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00027e10: 6e63 6528 7365 6c66 2e64 7479 7065 2c20  nce(self.dtype, 
-00027e20: 7064 2e43 6174 6567 6f72 6963 616c 4474  pd.CategoricalDt
-00027e30: 7970 6529 3a0a 2020 2020 2020 2020 2020  ype):.          
-00027e40: 2020 6f75 742e 6578 7465 6e64 2873 656c    out.extend(sel
-00027e50: 662e 5f63 6174 5f61 7474 7269 6275 7465  f._cat_attribute
-00027e60: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00027e70: 6e20 6f75 740a 0a20 2020 2023 2054 7970  n out..    # Typ
-00027e80: 696e 673a 2068 7474 7073 3a2f 2f67 6974  ing: https://git
-00027e90: 6875 622e 636f 6d2f 7079 7468 6f6e 2f6d  hub.com/python/m
-00027ea0: 7970 792f 6973 7375 6573 2f34 3132 350a  ypy/issues/4125.
-00027eb0: 2020 2020 4070 726f 7065 7274 7920 2023      @property  #
-00027ec0: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
-00027ed0: 2020 6465 6620 696e 6465 7828 7365 6c66    def index(self
-00027ee0: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
-00027ef0: 2041 7474 7269 6275 7465 4572 726f 7228   AttributeError(
-00027f00: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
-00027f10: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
-00027f20: 5f6e 616d 655f 5f21 727d 206f 626a 6563  _name__!r} objec
-00027f30: 7420 6861 7320 6e6f 2061 7474 7269 6275  t has no attribu
-00027f40: 7465 2027 696e 6465 7827 220a 2020 2020  te 'index'".    
-00027f50: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00027f60: 5f61 7272 6179 5f77 7261 705f 5f28 7365  _array_wrap__(se
-00027f70: 6c66 2c20 6172 7261 792c 2063 6f6e 7465  lf, array, conte
-00027f80: 7874 3d4e 6f6e 6529 3a0a 2020 2020 2020  xt=None):.      
-00027f90: 2020 7265 7475 726e 2070 642e 496e 6465    return pd.Inde
-00027fa0: 7828 6172 7261 792c 206e 616d 653d 7365  x(array, name=se
-00027fb0: 6c66 2e6e 616d 6529 0a0a 2020 2020 6465  lf.name)..    de
-00027fc0: 6620 6865 6164 2873 656c 662c 206e 3d35  f head(self, n=5
-00027fd0: 2c20 636f 6d70 7574 653d 5472 7565 293a  , compute=True):
-00027fe0: 0a20 2020 2020 2020 2022 2222 4669 7273  .        """Firs
-00027ff0: 7420 6e20 6974 656d 7320 6f66 2074 6865  t n items of the
-00028000: 2049 6e64 6578 2e0a 0a20 2020 2020 2020   Index...       
-00028010: 2043 6176 6561 742c 2074 6869 7320 6f6e   Caveat, this on
-00028020: 6c79 2063 6865 636b 7320 7468 6520 6669  ly checks the fi
-00028030: 7273 7420 7061 7274 6974 696f 6e2e 0a20  rst partition.. 
-00028040: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00028050: 2020 206e 616d 6520 3d20 2268 6561 642d     name = "head-
-00028060: 2564 2d25 7322 2025 2028 6e2c 2073 656c  %d-%s" % (n, sel
-00028070: 662e 5f6e 616d 6529 0a20 2020 2020 2020  f._name).       
-00028080: 2064 736b 203d 207b 286e 616d 652c 2030   dsk = {(name, 0
-00028090: 293a 2028 6f70 6572 6174 6f72 2e67 6574  ): (operator.get
-000280a0: 6974 656d 2c20 2873 656c 662e 5f6e 616d  item, (self._nam
-000280b0: 652c 2030 292c 2073 6c69 6365 2830 2c20  e, 0), slice(0, 
-000280c0: 6e29 297d 0a20 2020 2020 2020 2067 7261  n))}.        gra
-000280d0: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
-000280e0: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
-000280f0: 696f 6e73 286e 616d 652c 2064 736b 2c20  ions(name, dsk, 
-00028100: 6465 7065 6e64 656e 6369 6573 3d5b 7365  dependencies=[se
-00028110: 6c66 5d29 0a0a 2020 2020 2020 2020 7265  lf])..        re
-00028120: 7375 6c74 203d 206e 6577 5f64 645f 6f62  sult = new_dd_ob
-00028130: 6a65 6374 2867 7261 7068 2c20 6e61 6d65  ject(graph, name
-00028140: 2c20 7365 6c66 2e5f 6d65 7461 2c20 7365  , self._meta, se
-00028150: 6c66 2e64 6976 6973 696f 6e73 5b3a 325d  lf.divisions[:2]
-00028160: 290a 0a20 2020 2020 2020 2069 6620 636f  )..        if co
-00028170: 6d70 7574 653a 0a20 2020 2020 2020 2020  mpute:.         
-00028180: 2020 2072 6573 756c 7420 3d20 7265 7375     result = resu
-00028190: 6c74 2e63 6f6d 7075 7465 2829 0a20 2020  lt.compute().   
-000281a0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-000281b0: 6c74 0a0a 2020 2020 4064 6572 6976 6564  lt..    @derived
-000281c0: 5f66 726f 6d28 7064 2e49 6e64 6578 290a  _from(pd.Index).
-000281d0: 2020 2020 6465 6620 6d61 7828 7365 6c66      def max(self
-000281e0: 2c20 7370 6c69 745f 6576 6572 793d 4661  , split_every=Fa
-000281f0: 6c73 6529 3a0a 2020 2020 2020 2020 7265  lse):.        re
-00028200: 7475 726e 2073 656c 662e 7265 6475 6374  turn self.reduct
-00028210: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-00028220: 204d 2e6d 6178 2c0a 2020 2020 2020 2020   M.max,.        
-00028230: 2020 2020 6d65 7461 3d73 656c 662e 5f6d      meta=self._m
-00028240: 6574 615f 6e6f 6e65 6d70 7479 2e6d 6178  eta_nonempty.max
-00028250: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-00028260: 746f 6b65 6e3d 7365 6c66 2e5f 746f 6b65  token=self._toke
-00028270: 6e5f 7072 6566 6978 202b 2022 6d61 7822  n_prefix + "max"
-00028280: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
-00028290: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-000282a0: 6576 6572 792c 0a20 2020 2020 2020 2029  every,.        )
-000282b0: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-000282c0: 726f 6d28 7064 2e49 6e64 6578 290a 2020  rom(pd.Index).  
-000282d0: 2020 6465 6620 6d69 6e28 7365 6c66 2c20    def min(self, 
-000282e0: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
-000282f0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-00028300: 726e 2073 656c 662e 7265 6475 6374 696f  rn self.reductio
-00028310: 6e28 0a20 2020 2020 2020 2020 2020 204d  n(.            M
-00028320: 2e6d 696e 2c0a 2020 2020 2020 2020 2020  .min,.          
-00028330: 2020 6d65 7461 3d73 656c 662e 5f6d 6574    meta=self._met
-00028340: 615f 6e6f 6e65 6d70 7479 2e6d 696e 2829  a_nonempty.min()
-00028350: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
-00028360: 6b65 6e3d 7365 6c66 2e5f 746f 6b65 6e5f  ken=self._token_
-00028370: 7072 6566 6978 202b 2022 6d69 6e22 2c0a  prefix + "min",.
-00028380: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00028390: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-000283a0: 6572 792c 0a20 2020 2020 2020 2029 0a0a  ery,.        )..
-000283b0: 2020 2020 6465 6620 636f 756e 7428 7365      def count(se
-000283c0: 6c66 2c20 7370 6c69 745f 6576 6572 793d  lf, split_every=
-000283d0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-000283e0: 7265 7475 726e 2073 656c 662e 7265 6475  return self.redu
-000283f0: 6374 696f 6e28 0a20 2020 2020 2020 2020  ction(.         
-00028400: 2020 206d 6574 686f 6473 2e69 6e64 6578     methods.index
-00028410: 5f63 6f75 6e74 2c0a 2020 2020 2020 2020  _count,.        
-00028420: 2020 2020 6e70 2e73 756d 2c0a 2020 2020      np.sum,.    
-00028430: 2020 2020 2020 2020 746f 6b65 6e3d 2269          token="i
-00028440: 6e64 6578 2d63 6f75 6e74 222c 0a20 2020  ndex-count",.   
-00028450: 2020 2020 2020 2020 206d 6574 613d 696e           meta=in
-00028460: 742c 0a20 2020 2020 2020 2020 2020 2073  t,.            s
-00028470: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
-00028480: 5f65 7665 7279 2c0a 2020 2020 2020 2020  _every,.        
-00028490: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-000284a0: 6672 6f6d 2870 642e 496e 6465 7829 0a20  from(pd.Index). 
-000284b0: 2020 2064 6566 2073 6869 6674 2873 656c     def shift(sel
-000284c0: 662c 2070 6572 696f 6473 3d31 2c20 6672  f, periods=1, fr
-000284d0: 6571 3d4e 6f6e 6529 3a0a 2020 2020 2020  eq=None):.      
-000284e0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000284f0: 7365 6c66 2e5f 6d65 7461 2c20 7064 2e50  self._meta, pd.P
-00028500: 6572 696f 6449 6e64 6578 293a 0a20 2020  eriodIndex):.   
-00028510: 2020 2020 2020 2020 2069 6620 6672 6571           if freq
-00028520: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00028530: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00028540: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-00028550: 5065 7269 6f64 496e 6465 7820 646f 6573  PeriodIndex does
-00028560: 6e27 7420 6163 6365 7074 2060 6672 6571  n't accept `freq
-00028570: 6020 6172 6775 6d65 6e74 2229 0a20 2020  ` argument").   
-00028580: 2020 2020 2020 2020 206d 6574 6120 3d20           meta = 
-00028590: 7365 6c66 2e5f 6d65 7461 5f6e 6f6e 656d  self._meta_nonem
-000285a0: 7074 792e 7368 6966 7428 7065 7269 6f64  pty.shift(period
-000285b0: 7329 0a20 2020 2020 2020 2020 2020 206f  s).            o
-000285c0: 7574 203d 2073 656c 662e 6d61 705f 7061  ut = self.map_pa
-000285d0: 7274 6974 696f 6e73 280a 2020 2020 2020  rtitions(.      
-000285e0: 2020 2020 2020 2020 2020 4d2e 7368 6966            M.shif
-000285f0: 742c 2070 6572 696f 6473 2c20 6d65 7461  t, periods, meta
-00028600: 3d6d 6574 612c 2074 6f6b 656e 3d22 7368  =meta, token="sh
-00028610: 6966 7422 2c20 7472 616e 7366 6f72 6d5f  ift", transform_
-00028620: 6469 7669 7369 6f6e 733d 4661 6c73 650a  divisions=False.
-00028630: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00028640: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00028650: 2020 2020 2020 2020 2320 5061 6e64 6173          # Pandas
-00028660: 2077 696c 6c20 7261 6973 6520 666f 7220   will raise for 
-00028670: 6f74 6865 7220 696e 6465 7820 7479 7065  other index type
-00028680: 7320 7468 6174 2064 6f6e 2774 2069 6d70  s that don't imp
-00028690: 6c65 6d65 6e74 2073 6869 6674 0a20 2020  lement shift.   
-000286a0: 2020 2020 2020 2020 206d 6574 6120 3d20           meta = 
-000286b0: 7365 6c66 2e5f 6d65 7461 5f6e 6f6e 656d  self._meta_nonem
-000286c0: 7074 792e 7368 6966 7428 7065 7269 6f64  pty.shift(period
-000286d0: 732c 2066 7265 713d 6672 6571 290a 2020  s, freq=freq).  
-000286e0: 2020 2020 2020 2020 2020 6f75 7420 3d20            out = 
-000286f0: 7365 6c66 2e6d 6170 5f70 6172 7469 7469  self.map_partiti
-00028700: 6f6e 7328 0a20 2020 2020 2020 2020 2020  ons(.           
-00028710: 2020 2020 204d 2e73 6869 6674 2c0a 2020       M.shift,.  
-00028720: 2020 2020 2020 2020 2020 2020 2020 7065                pe
-00028730: 7269 6f64 732c 0a20 2020 2020 2020 2020  riods,.         
-00028740: 2020 2020 2020 2074 6f6b 656e 3d22 7368         token="sh
-00028750: 6966 7422 2c0a 2020 2020 2020 2020 2020  ift",.          
-00028760: 2020 2020 2020 6d65 7461 3d6d 6574 612c        meta=meta,
-00028770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028780: 2066 7265 713d 6672 6571 2c0a 2020 2020   freq=freq,.    
-00028790: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-000287a0: 7366 6f72 6d5f 6469 7669 7369 6f6e 733d  sform_divisions=
-000287b0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000287c0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-000287d0: 6672 6571 2069 7320 4e6f 6e65 3a0a 2020  freq is None:.  
-000287e0: 2020 2020 2020 2020 2020 6672 6571 203d            freq =
-000287f0: 206d 6574 612e 6672 6571 0a20 2020 2020   meta.freq.     
-00028800: 2020 2072 6574 7572 6e20 6d61 7962 655f     return maybe_
-00028810: 7368 6966 745f 6469 7669 7369 6f6e 7328  shift_divisions(
-00028820: 6f75 742c 2070 6572 696f 6473 2c20 6672  out, periods, fr
-00028830: 6571 3d66 7265 7129 0a0a 2020 2020 4064  eq=freq)..    @d
-00028840: 6572 6976 6564 5f66 726f 6d28 7064 2e49  erived_from(pd.I
-00028850: 6e64 6578 290a 2020 2020 6465 6620 746f  ndex).    def to
-00028860: 5f73 6572 6965 7328 7365 6c66 293a 0a20  _series(self):. 
-00028870: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00028880: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-00028890: 7328 0a20 2020 2020 2020 2020 2020 204d  s(.            M
-000288a0: 2e74 6f5f 7365 7269 6573 2c0a 2020 2020  .to_series,.    
-000288b0: 2020 2020 2020 2020 6d65 7461 3d73 656c          meta=sel
-000288c0: 662e 5f6d 6574 612e 746f 5f73 6572 6965  f._meta.to_serie
-000288d0: 7328 292c 0a20 2020 2020 2020 2020 2020  s(),.           
-000288e0: 2074 7261 6e73 666f 726d 5f64 6976 6973   transform_divis
-000288f0: 696f 6e73 3d46 616c 7365 2c0a 2020 2020  ions=False,.    
-00028900: 2020 2020 290a 0a20 2020 2040 6465 7269      )..    @deri
-00028910: 7665 645f 6672 6f6d 2870 642e 496e 6465  ved_from(pd.Inde
-00028920: 782c 2075 615f 6172 6773 3d5b 2269 6e64  x, ua_args=["ind
-00028930: 6578 225d 290a 2020 2020 6465 6620 746f  ex"]).    def to
-00028940: 5f66 7261 6d65 2873 656c 662c 2069 6e64  _frame(self, ind
-00028950: 6578 3d54 7275 652c 206e 616d 653d 4e6f  ex=True, name=No
-00028960: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
-00028970: 6e6f 7420 696e 6465 783a 0a20 2020 2020  not index:.     
-00028980: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00028990: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-000289a0: 2829 0a20 2020 2020 2020 2061 7267 7320  ().        args 
-000289b0: 3d20 5b69 6e64 6578 5d20 6966 206e 616d  = [index] if nam
-000289c0: 6520 6973 204e 6f6e 6520 656c 7365 205b  e is None else [
-000289d0: 696e 6465 782c 206e 616d 655d 0a0a 2020  index, name]..  
-000289e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000289f0: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
-00028a00: 280a 2020 2020 2020 2020 2020 2020 4d2e  (.            M.
-00028a10: 746f 5f66 7261 6d65 2c0a 2020 2020 2020  to_frame,.      
-00028a20: 2020 2020 2020 2a61 7267 732c 0a20 2020        *args,.   
-00028a30: 2020 2020 2020 2020 206d 6574 613d 7365           meta=se
-00028a40: 6c66 2e5f 6d65 7461 2e74 6f5f 6672 616d  lf._meta.to_fram
-00028a50: 6528 2a61 7267 7329 2c0a 2020 2020 2020  e(*args),.      
-00028a60: 2020 2020 2020 7472 616e 7366 6f72 6d5f        transform_
-00028a70: 6469 7669 7369 6f6e 733d 4661 6c73 652c  divisions=False,
-00028a80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00028a90: 4069 6e73 6572 745f 6d65 7461 5f70 6172  @insert_meta_par
-00028aa0: 616d 5f64 6573 6372 6970 7469 6f6e 2870  am_description(p
-00028ab0: 6164 3d31 3229 0a20 2020 2040 6465 7269  ad=12).    @deri
-00028ac0: 7665 645f 6672 6f6d 2870 642e 496e 6465  ved_from(pd.Inde
-00028ad0: 7829 0a20 2020 2064 6566 206d 6170 2873  x).    def map(s
-00028ae0: 656c 662c 2061 7267 2c20 6e61 5f61 6374  elf, arg, na_act
-00028af0: 696f 6e3d 4e6f 6e65 2c20 6d65 7461 3d6e  ion=None, meta=n
-00028b00: 6f5f 6465 6661 756c 742c 2069 735f 6d6f  o_default, is_mo
-00028b10: 6e6f 746f 6e69 633d 4661 6c73 6529 3a0a  notonic=False):.
-00028b20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00028b30: 2020 2020 4e6f 7465 2074 6861 7420 7468      Note that th
-00028b40: 6973 206d 6574 686f 6420 636c 6561 7273  is method clears
-00028b50: 2061 6e79 206b 6e6f 776e 2064 6976 6973   any known divis
-00028b60: 696f 6e73 2e0a 0a20 2020 2020 2020 2049  ions...        I
-00028b70: 6620 796f 7572 206d 6170 7069 6e67 2066  f your mapping f
-00028b80: 756e 6374 696f 6e20 6973 206d 6f6e 6f74  unction is monot
-00028b90: 6f6e 6963 616c 6c79 2069 6e63 7265 6173  onically increas
-00028ba0: 696e 6720 7468 656e 2075 7365 2060 6973  ing then use `is
-00028bb0: 5f6d 6f6e 6f74 6f6e 6963 600a 2020 2020  _monotonic`.    
-00028bc0: 2020 2020 746f 2061 7070 6c79 2074 6865      to apply the
-00028bd0: 206d 6170 696e 6720 6675 6e63 7469 6f6e   maping function
-00028be0: 2074 6f20 7468 6520 6f6c 6420 6469 7669   to the old divi
-00028bf0: 7369 6f6e 7320 616e 6420 6173 7369 676e  sions and assign
-00028c00: 2074 6865 206e 6577 0a20 2020 2020 2020   the new.       
-00028c10: 2064 6976 6973 696f 6e73 2074 6f20 7468   divisions to th
-00028c20: 6520 6f75 7470 7574 2e0a 0a20 2020 2020  e output...     
-00028c30: 2020 2022 2222 0a20 2020 2020 2020 2061     """.        a
-00028c40: 7070 6c69 6564 203d 2073 7570 6572 2829  pplied = super()
-00028c50: 2e6d 6170 2861 7267 2c20 6e61 5f61 6374  .map(arg, na_act
-00028c60: 696f 6e3d 6e61 5f61 6374 696f 6e2c 206d  ion=na_action, m
-00028c70: 6574 613d 6d65 7461 290a 2020 2020 2020  eta=meta).      
-00028c80: 2020 6966 2069 735f 6d6f 6e6f 746f 6e69    if is_monotoni
-00028c90: 6320 616e 6420 7365 6c66 2e6b 6e6f 776e  c and self.known
-00028ca0: 5f64 6976 6973 696f 6e73 3a0a 2020 2020  _divisions:.    
-00028cb0: 2020 2020 2020 2020 6170 706c 6965 642e          applied.
-00028cc0: 6469 7669 7369 6f6e 7320 3d20 7475 706c  divisions = tupl
-00028cd0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00028ce0: 2020 2070 642e 5365 7269 6573 2873 656c     pd.Series(sel
-00028cf0: 662e 6469 7669 7369 6f6e 7329 2e6d 6170  f.divisions).map
-00028d00: 2861 7267 2c20 6e61 5f61 6374 696f 6e3d  (arg, na_action=
-00028d10: 6e61 5f61 6374 696f 6e29 0a20 2020 2020  na_action).     
-00028d20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00028d30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00028d40: 2020 2061 7070 6c69 6564 203d 2061 7070     applied = app
-00028d50: 6c69 6564 2e63 6c65 6172 5f64 6976 6973  lied.clear_divis
-00028d60: 696f 6e73 2829 0a20 2020 2020 2020 2072  ions().        r
-00028d70: 6574 7572 6e20 6170 706c 6965 640a 0a20  eturn applied.. 
-00028d80: 2020 2069 6620 6e6f 7420 5041 4e44 4153     if not PANDAS
-00028d90: 5f47 545f 3230 303a 0a0a 2020 2020 2020  _GT_200:..      
-00028da0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00028db0: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
-00028dc0: 6d28 7064 2e49 6e64 6578 290a 2020 2020  m(pd.Index).    
-00028dd0: 2020 2020 6465 6620 6973 5f6d 6f6e 6f74      def is_monot
-00028de0: 6f6e 6963 2873 656c 6629 3a0a 2020 2020  onic(self):.    
-00028df0: 2020 2020 2020 2020 6966 2050 414e 4441          if PANDA
-00028e00: 535f 4754 5f31 3530 3a0a 2020 2020 2020  S_GT_150:.      
-00028e10: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00028e20: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-00028e30: 2020 2020 2020 2020 2020 2020 2022 6973               "is
-00028e40: 5f6d 6f6e 6f74 6f6e 6963 2069 7320 6465  _monotonic is de
-00028e50: 7072 6563 6174 6564 2061 6e64 2077 696c  precated and wil
-00028e60: 6c20 6265 2072 656d 6f76 6564 2069 6e20  l be removed in 
-00028e70: 6120 6675 7475 7265 2076 6572 7369 6f6e  a future version
-00028e80: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-00028e90: 2020 2020 2020 2020 2255 7365 2069 735f          "Use is_
-00028ea0: 6d6f 6e6f 746f 6e69 635f 696e 6372 6561  monotonic_increa
-00028eb0: 7369 6e67 2069 6e73 7465 6164 2e22 2c0a  sing instead.",.
-00028ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ed0: 2020 2020 4675 7475 7265 5761 726e 696e      FutureWarnin
-00028ee0: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-00028ef0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00028f00: 2072 6574 7572 6e20 7375 7065 7228 292e   return super().
-00028f10: 6973 5f6d 6f6e 6f74 6f6e 6963 5f69 6e63  is_monotonic_inc
-00028f20: 7265 6173 696e 670a 0a20 2020 2040 7072  reasing..    @pr
-00028f30: 6f70 6572 7479 0a20 2020 2040 6465 7269  operty.    @deri
-00028f40: 7665 645f 6672 6f6d 2870 642e 496e 6465  ved_from(pd.Inde
-00028f50: 7829 0a20 2020 2064 6566 2069 735f 6d6f  x).    def is_mo
-00028f60: 6e6f 746f 6e69 635f 696e 6372 6561 7369  notonic_increasi
-00028f70: 6e67 2873 656c 6629 3a0a 2020 2020 2020  ng(self):.      
-00028f80: 2020 7265 7475 726e 2073 7570 6572 2829    return super()
-00028f90: 2e69 735f 6d6f 6e6f 746f 6e69 635f 696e  .is_monotonic_in
-00028fa0: 6372 6561 7369 6e67 0a0a 2020 2020 4070  creasing..    @p
-00028fb0: 726f 7065 7274 790a 2020 2020 4064 6572  roperty.    @der
-00028fc0: 6976 6564 5f66 726f 6d28 7064 2e49 6e64  ived_from(pd.Ind
-00028fd0: 6578 290a 2020 2020 6465 6620 6973 5f6d  ex).    def is_m
-00028fe0: 6f6e 6f74 6f6e 6963 5f64 6563 7265 6173  onotonic_decreas
-00028ff0: 696e 6728 7365 6c66 293a 0a20 2020 2020  ing(self):.     
-00029000: 2020 2072 6574 7572 6e20 7375 7065 7228     return super(
-00029010: 292e 6973 5f6d 6f6e 6f74 6f6e 6963 5f64  ).is_monotonic_d
-00029020: 6563 7265 6173 696e 670a 0a20 2020 2040  ecreasing..    @
-00029030: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
-00029040: 496e 6465 7829 0a20 2020 2064 6566 206d  Index).    def m
-00029050: 656d 6f72 795f 7573 6167 6528 7365 6c66  emory_usage(self
-00029060: 2c20 6465 6570 3d46 616c 7365 293a 0a20  , deep=False):. 
-00029070: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00029080: 6c66 2e72 6564 7563 7469 6f6e 280a 2020  lf.reduction(.  
-00029090: 2020 2020 2020 2020 2020 4d2e 6d65 6d6f            M.memo
-000290a0: 7279 5f75 7361 6765 2c0a 2020 2020 2020  ry_usage,.      
-000290b0: 2020 2020 2020 4d2e 7375 6d2c 0a20 2020        M.sum,.   
-000290c0: 2020 2020 2020 2020 2063 6875 6e6b 5f6b           chunk_k
-000290d0: 7761 7267 733d 7b22 6465 6570 223a 2064  wargs={"deep": d
-000290e0: 6565 707d 2c0a 2020 2020 2020 2020 2020  eep},.          
-000290f0: 2020 7370 6c69 745f 6576 6572 793d 4661    split_every=Fa
-00029100: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00029110: 2074 6f6b 656e 3d73 656c 662e 5f74 6f6b   token=self._tok
-00029120: 656e 5f70 7265 6669 7820 2b20 226d 656d  en_prefix + "mem
-00029130: 6f72 792d 7573 6167 6522 2c0a 2020 2020  ory-usage",.    
-00029140: 2020 2020 290a 0a0a 636c 6173 7320 4461      )...class Da
-00029150: 7461 4672 616d 6528 5f46 7261 6d65 293a  taFrame(_Frame):
-00029160: 0a20 2020 2022 2222 0a20 2020 2050 6172  .    """.    Par
-00029170: 616c 6c65 6c20 5061 6e64 6173 2044 6174  allel Pandas Dat
-00029180: 6146 7261 6d65 0a0a 2020 2020 446f 206e  aFrame..    Do n
-00029190: 6f74 2075 7365 2074 6869 7320 636c 6173  ot use this clas
-000291a0: 7320 6469 7265 6374 6c79 2e20 2049 6e73  s directly.  Ins
-000291b0: 7465 6164 2075 7365 2066 756e 6374 696f  tead use functio
-000291c0: 6e73 206c 696b 650a 2020 2020 6060 6464  ns like.    ``dd
-000291d0: 2e72 6561 645f 6373 7660 602c 2060 6064  .read_csv``, ``d
-000291e0: 642e 7265 6164 5f70 6172 7175 6574 6060  d.read_parquet``
-000291f0: 2c20 6f72 2060 6064 642e 6672 6f6d 5f70  , or ``dd.from_p
-00029200: 616e 6461 7360 602e 0a0a 2020 2020 5061  andas``...    Pa
-00029210: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-00029220: 2d2d 2d2d 2d2d 2d0a 2020 2020 6473 6b3a  -------.    dsk:
-00029230: 2064 6963 740a 2020 2020 2020 2020 5468   dict.        Th
-00029240: 6520 6461 736b 2067 7261 7068 2074 6f20  e dask graph to 
-00029250: 636f 6d70 7574 6520 7468 6973 2044 6174  compute this Dat
-00029260: 6146 7261 6d65 0a20 2020 206e 616d 653a  aFrame.    name:
-00029270: 2073 7472 0a20 2020 2020 2020 2054 6865   str.        The
-00029280: 206b 6579 2070 7265 6669 7820 7468 6174   key prefix that
-00029290: 2073 7065 6369 6669 6573 2077 6869 6368   specifies which
-000292a0: 206b 6579 7320 696e 2074 6865 2064 6173   keys in the das
-000292b0: 6b20 636f 6d70 7269 7365 2074 6869 730a  k comprise this.
-000292c0: 2020 2020 2020 2020 7061 7274 6963 756c          particul
-000292d0: 6172 2044 6174 6146 7261 6d65 0a20 2020  ar DataFrame.   
-000292e0: 206d 6574 613a 2070 616e 6461 732e 4461   meta: pandas.Da
-000292f0: 7461 4672 616d 650a 2020 2020 2020 2020  taFrame.        
-00029300: 416e 2065 6d70 7479 2060 6070 616e 6461  An empty ``panda
-00029310: 732e 4461 7461 4672 616d 6560 6020 7769  s.DataFrame`` wi
-00029320: 7468 206e 616d 6573 2c20 6474 7970 6573  th names, dtypes
-00029330: 2c20 616e 6420 696e 6465 7820 6d61 7463  , and index matc
-00029340: 6869 6e67 0a20 2020 2020 2020 2074 6865  hing.        the
-00029350: 2065 7870 6563 7465 6420 6f75 7470 7574   expected output
-00029360: 2e0a 2020 2020 6469 7669 7369 6f6e 733a  ..    divisions:
-00029370: 2074 7570 6c65 206f 6620 696e 6465 7820   tuple of index 
-00029380: 7661 6c75 6573 0a20 2020 2020 2020 2056  values.        V
-00029390: 616c 7565 7320 616c 6f6e 6720 7768 6963  alues along whic
-000293a0: 6820 7765 2070 6172 7469 7469 6f6e 206f  h we partition o
-000293b0: 7572 2062 6c6f 636b 7320 6f6e 2074 6865  ur blocks on the
-000293c0: 2069 6e64 6578 0a20 2020 2022 2222 0a0a   index.    """..
-000293d0: 2020 2020 5f70 6172 7469 7469 6f6e 5f74      _partition_t
-000293e0: 7970 6520 3d20 7064 2e44 6174 6146 7261  ype = pd.DataFra
-000293f0: 6d65 0a20 2020 205f 6973 5f70 6172 7469  me.    _is_parti
-00029400: 7469 6f6e 5f74 7970 6520 3d20 7374 6174  tion_type = stat
-00029410: 6963 6d65 7468 6f64 2869 735f 6461 7461  icmethod(is_data
-00029420: 6672 616d 655f 6c69 6b65 290a 2020 2020  frame_like).    
-00029430: 5f74 6f6b 656e 5f70 7265 6669 7820 3d20  _token_prefix = 
-00029440: 2264 6174 6166 7261 6d65 2d22 0a20 2020  "dataframe-".   
-00029450: 205f 6163 6365 7373 6f72 733a 2043 6c61   _accessors: Cla
-00029460: 7373 5661 725b 7365 745b 7374 725d 5d20  ssVar[set[str]] 
-00029470: 3d20 7365 7428 290a 0a20 2020 2064 6566  = set()..    def
-00029480: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00029490: 6473 6b2c 206e 616d 652c 206d 6574 612c  dsk, name, meta,
-000294a0: 2064 6976 6973 696f 6e73 293a 0a20 2020   divisions):.   
-000294b0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-000294c0: 6e69 745f 5f28 6473 6b2c 206e 616d 652c  nit__(dsk, name,
-000294d0: 206d 6574 612c 2064 6976 6973 696f 6e73   meta, divisions
-000294e0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-000294f0: 662e 6461 736b 2e6c 6179 6572 735b 6e61  f.dask.layers[na
-00029500: 6d65 5d2e 636f 6c6c 6563 7469 6f6e 5f61  me].collection_a
-00029510: 6e6e 6f74 6174 696f 6e73 2069 7320 4e6f  nnotations is No
-00029520: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00029530: 7365 6c66 2e64 6173 6b2e 6c61 7965 7273  self.dask.layers
-00029540: 5b6e 616d 655d 2e63 6f6c 6c65 6374 696f  [name].collectio
-00029550: 6e5f 616e 6e6f 7461 7469 6f6e 7320 3d20  n_annotations = 
-00029560: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-00029570: 2020 226e 7061 7274 6974 696f 6e73 223a    "npartitions":
-00029580: 2073 656c 662e 6e70 6172 7469 7469 6f6e   self.npartition
-00029590: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000295a0: 2020 2022 636f 6c75 6d6e 7322 3a20 5b63     "columns": [c
-000295b0: 6f6c 2066 6f72 2063 6f6c 2069 6e20 7365  ol for col in se
-000295c0: 6c66 2e63 6f6c 756d 6e73 5d2c 0a20 2020  lf.columns],.   
-000295d0: 2020 2020 2020 2020 2020 2020 2022 7479               "ty
-000295e0: 7065 223a 2074 7970 656e 616d 6528 7479  pe": typename(ty
-000295f0: 7065 2873 656c 6629 292c 0a20 2020 2020  pe(self)),.     
-00029600: 2020 2020 2020 2020 2020 2022 6461 7461             "data
-00029610: 6672 616d 655f 7479 7065 223a 2074 7970  frame_type": typ
-00029620: 656e 616d 6528 7479 7065 2873 656c 662e  ename(type(self.
-00029630: 5f6d 6574 6129 292c 0a20 2020 2020 2020  _meta)),.       
-00029640: 2020 2020 2020 2020 2022 7365 7269 6573           "series
-00029650: 5f64 7479 7065 7322 3a20 7b0a 2020 2020  _dtypes": {.    
-00029660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029670: 636f 6c3a 2073 656c 662e 5f6d 6574 615b  col: self._meta[
-00029680: 636f 6c5d 2e64 7479 7065 0a20 2020 2020  col].dtype.     
-00029690: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000296a0: 6620 6861 7361 7474 7228 7365 6c66 2e5f  f hasattr(self._
-000296b0: 6d65 7461 5b63 6f6c 5d2c 2022 6474 7970  meta[col], "dtyp
-000296c0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-000296d0: 2020 2020 2020 2020 656c 7365 204e 6f6e          else Non
-000296e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000296f0: 2020 2020 2020 666f 7220 636f 6c20 696e        for col in
-00029700: 2073 656c 662e 5f6d 6574 612e 636f 6c75   self._meta.colu
-00029710: 6d6e 730a 2020 2020 2020 2020 2020 2020  mns.            
-00029720: 2020 2020 7d2c 0a20 2020 2020 2020 2020      },.         
-00029730: 2020 207d 0a20 2020 2020 2020 2065 6c73     }.        els
-00029740: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00029750: 656c 662e 6461 736b 2e6c 6179 6572 735b  elf.dask.layers[
-00029760: 6e61 6d65 5d2e 636f 6c6c 6563 7469 6f6e  name].collection
-00029770: 5f61 6e6e 6f74 6174 696f 6e73 2e75 7064  _annotations.upd
-00029780: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00029790: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-000297a0: 2020 2020 2020 2020 2020 2022 6e70 6172             "npar
-000297b0: 7469 7469 6f6e 7322 3a20 7365 6c66 2e6e  titions": self.n
-000297c0: 7061 7274 6974 696f 6e73 2c0a 2020 2020  partitions,.    
-000297d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000297e0: 2263 6f6c 756d 6e73 223a 205b 636f 6c20  "columns": [col 
-000297f0: 666f 7220 636f 6c20 696e 2073 656c 662e  for col in self.
-00029800: 636f 6c75 6d6e 735d 2c0a 2020 2020 2020  columns],.      
-00029810: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-00029820: 7970 6522 3a20 7479 7065 6e61 6d65 2874  ype": typename(t
-00029830: 7970 6528 7365 6c66 2929 2c0a 2020 2020  ype(self)),.    
-00029840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029850: 2264 6174 6166 7261 6d65 5f74 7970 6522  "dataframe_type"
-00029860: 3a20 7479 7065 6e61 6d65 2874 7970 6528  : typename(type(
-00029870: 7365 6c66 2e5f 6d65 7461 2929 2c0a 2020  self._meta)),.  
-00029880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029890: 2020 2273 6572 6965 735f 6474 7970 6573    "series_dtypes
-000298a0: 223a 207b 0a20 2020 2020 2020 2020 2020  ": {.           
-000298b0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-000298c0: 3a20 7365 6c66 2e5f 6d65 7461 5b63 6f6c  : self._meta[col
-000298d0: 5d2e 6474 7970 650a 2020 2020 2020 2020  ].dtype.        
+00025490: 284d 2e64 726f 706e 612c 2065 6e66 6f72  (M.dropna, enfor
+000254a0: 6365 5f6d 6574 6164 6174 613d 4661 6c73  ce_metadata=Fals
+000254b0: 6529 0a0a 2020 2020 4064 6572 6976 6564  e)..    @derived
+000254c0: 5f66 726f 6d28 7064 2e53 6572 6965 7329  _from(pd.Series)
+000254d0: 0a20 2020 2064 6566 2062 6574 7765 656e  .    def between
+000254e0: 2873 656c 662c 206c 6566 742c 2072 6967  (self, left, rig
+000254f0: 6874 2c20 696e 636c 7573 6976 653d 2262  ht, inclusive="b
+00025500: 6f74 6822 293a 0a20 2020 2020 2020 2072  oth"):.        r
+00025510: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
+00025520: 6172 7469 7469 6f6e 7328 0a20 2020 2020  artitions(.     
+00025530: 2020 2020 2020 204d 2e62 6574 7765 656e         M.between
+00025540: 2c20 6c65 6674 3d6c 6566 742c 2072 6967  , left=left, rig
+00025550: 6874 3d72 6967 6874 2c20 696e 636c 7573  ht=right, inclus
+00025560: 6976 653d 696e 636c 7573 6976 650a 2020  ive=inclusive.  
+00025570: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
+00025580: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
+00025590: 7269 6573 290a 2020 2020 6465 6620 636c  ries).    def cl
+000255a0: 6970 2873 656c 662c 206c 6f77 6572 3d4e  ip(self, lower=N
+000255b0: 6f6e 652c 2075 7070 6572 3d4e 6f6e 652c  one, upper=None,
+000255c0: 206f 7574 3d4e 6f6e 6529 3a0a 2020 2020   out=None):.    
+000255d0: 2020 2020 6966 206f 7574 2069 7320 6e6f      if out is no
+000255e0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000255f0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00025600: 7272 6f72 2822 276f 7574 2720 6d75 7374  rror("'out' must
+00025610: 2062 6520 4e6f 6e65 2229 0a20 2020 2020   be None").     
+00025620: 2020 2023 206e 702e 636c 6970 206d 6179     # np.clip may
+00025630: 2070 6173 7320 6f75 740a 2020 2020 2020   pass out.      
+00025640: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+00025650: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
+00025660: 2020 2020 2020 2020 2020 4d2e 636c 6970            M.clip
+00025670: 2c20 6c6f 7765 723d 6c6f 7765 722c 2075  , lower=lower, u
+00025680: 7070 6572 3d75 7070 6572 2c20 656e 666f  pper=upper, enfo
+00025690: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
+000256a0: 7365 0a20 2020 2020 2020 2029 0a0a 2020  se.        )..  
+000256b0: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+000256c0: 7064 2e53 6572 6965 7329 0a20 2020 2064  pd.Series).    d
+000256d0: 6566 2061 6c69 676e 2873 656c 662c 206f  ef align(self, o
+000256e0: 7468 6572 2c20 6a6f 696e 3d22 6f75 7465  ther, join="oute
+000256f0: 7222 2c20 6178 6973 3d4e 6f6e 652c 2066  r", axis=None, f
+00025700: 696c 6c5f 7661 6c75 653d 4e6f 6e65 293a  ill_value=None):
+00025710: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00025720: 7375 7065 7228 292e 616c 6967 6e28 6f74  super().align(ot
+00025730: 6865 722c 206a 6f69 6e3d 6a6f 696e 2c20  her, join=join, 
+00025740: 6178 6973 3d61 7869 732c 2066 696c 6c5f  axis=axis, fill_
+00025750: 7661 6c75 653d 6669 6c6c 5f76 616c 7565  value=fill_value
+00025760: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
+00025770: 6672 6f6d 2870 642e 5365 7269 6573 290a  from(pd.Series).
+00025780: 2020 2020 6465 6620 636f 6d62 696e 6528      def combine(
+00025790: 7365 6c66 2c20 6f74 6865 722c 2066 756e  self, other, fun
+000257a0: 632c 2066 696c 6c5f 7661 6c75 653d 4e6f  c, fill_value=No
+000257b0: 6e65 293a 0a20 2020 2020 2020 2072 6574  ne):.        ret
+000257c0: 7572 6e20 7365 6c66 2e6d 6170 5f70 6172  urn self.map_par
+000257d0: 7469 7469 6f6e 7328 4d2e 636f 6d62 696e  titions(M.combin
+000257e0: 652c 206f 7468 6572 2c20 6675 6e63 2c20  e, other, func, 
+000257f0: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
+00025800: 7661 6c75 6529 0a0a 2020 2020 4064 6572  value)..    @der
+00025810: 6976 6564 5f66 726f 6d28 7064 2e53 6572  ived_from(pd.Ser
+00025820: 6965 7329 0a20 2020 2064 6566 2073 7175  ies).    def squ
+00025830: 6565 7a65 2873 656c 6629 3a0a 2020 2020  eeze(self):.    
+00025840: 2020 2020 7265 7475 726e 2073 656c 660a      return self.
+00025850: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+00025860: 6f6d 2870 642e 5365 7269 6573 290a 2020  om(pd.Series).  
+00025870: 2020 6465 6620 636f 6d62 696e 655f 6669    def combine_fi
+00025880: 7273 7428 7365 6c66 2c20 6f74 6865 7229  rst(self, other)
+00025890: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000258a0: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
+000258b0: 696f 6e73 284d 2e63 6f6d 6269 6e65 5f66  ions(M.combine_f
+000258c0: 6972 7374 2c20 6f74 6865 7229 0a0a 2020  irst, other)..  
+000258d0: 2020 6465 6620 746f 5f62 6167 2873 656c    def to_bag(sel
+000258e0: 662c 2069 6e64 6578 3d46 616c 7365 2c20  f, index=False, 
+000258f0: 666f 726d 6174 3d22 7475 706c 6522 293a  format="tuple"):
+00025900: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00025910: 7465 2061 2044 6173 6b20 4261 6720 6672  te a Dask Bag fr
+00025920: 6f6d 2061 2053 6572 6965 7322 2222 0a20  om a Series""". 
+00025930: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+00025940: 2e64 6174 6166 7261 6d65 2e69 6f20 696d  .dataframe.io im
+00025950: 706f 7274 2074 6f5f 6261 670a 0a20 2020  port to_bag..   
+00025960: 2020 2020 2072 6574 7572 6e20 746f 5f62       return to_b
+00025970: 6167 2873 656c 662c 2069 6e64 6578 2c20  ag(self, index, 
+00025980: 666f 726d 6174 3d66 6f72 6d61 7429 0a0a  format=format)..
+00025990: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+000259a0: 6d28 7064 2e53 6572 6965 7329 0a20 2020  m(pd.Series).   
+000259b0: 2064 6566 2074 6f5f 6672 616d 6528 7365   def to_frame(se
+000259c0: 6c66 2c20 6e61 6d65 3d4e 6f6e 6529 3a0a  lf, name=None):.
+000259d0: 2020 2020 2020 2020 6172 6773 203d 205b          args = [
+000259e0: 5d20 6966 206e 616d 6520 6973 204e 6f6e  ] if name is Non
+000259f0: 6520 656c 7365 205b 6e61 6d65 5d0a 2020  e else [name].  
+00025a00: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00025a10: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
+00025a20: 284d 2e74 6f5f 6672 616d 652c 202a 6172  (M.to_frame, *ar
+00025a30: 6773 2c20 6d65 7461 3d73 656c 662e 5f6d  gs, meta=self._m
+00025a40: 6574 612e 746f 5f66 7261 6d65 282a 6172  eta.to_frame(*ar
+00025a50: 6773 2929 0a0a 2020 2020 4064 6572 6976  gs))..    @deriv
+00025a60: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
+00025a70: 7329 0a20 2020 2064 6566 2074 6f5f 7374  s).    def to_st
+00025a80: 7269 6e67 2873 656c 662c 206d 6178 5f72  ring(self, max_r
+00025a90: 6f77 733d 3529 3a0a 2020 2020 2020 2020  ows=5):.        
+00025aa0: 2320 6f70 7469 6f6e 5f63 6f6e 7465 7874  # option_context
+00025ab0: 2064 6f65 736e 2774 2061 6666 6563 740a   doesn't affect.
+00025ac0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00025ad0: 656c 662e 5f72 6570 725f 6461 7461 2829  elf._repr_data()
+00025ae0: 2e74 6f5f 7374 7269 6e67 286d 6178 5f72  .to_string(max_r
+00025af0: 6f77 733d 6d61 785f 726f 7773 290a 0a20  ows=max_rows).. 
+00025b00: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00025b10: 2020 2020 6465 6620 5f62 696e 645f 6f70      def _bind_op
+00025b20: 6572 6174 6f72 5f6d 6574 686f 6428 636c  erator_method(cl
+00025b30: 732c 206e 616d 652c 206f 702c 206f 7269  s, name, op, ori
+00025b40: 6769 6e61 6c3d 7064 2e53 6572 6965 7329  ginal=pd.Series)
+00025b50: 3a0a 2020 2020 2020 2020 2222 2262 696e  :.        """bin
+00025b60: 6420 6f70 6572 6174 6f72 206d 6574 686f  d operator metho
+00025b70: 6420 6c69 6b65 2053 6572 6965 732e 6164  d like Series.ad
+00025b80: 6420 746f 2074 6869 7320 636c 6173 7322  d to this class"
+00025b90: 2222 0a0a 2020 2020 2020 2020 6465 6620  ""..        def 
+00025ba0: 6d65 7468 2873 656c 662c 206f 7468 6572  meth(self, other
+00025bb0: 2c20 6c65 7665 6c3d 4e6f 6e65 2c20 6669  , level=None, fi
+00025bc0: 6c6c 5f76 616c 7565 3d4e 6f6e 652c 2061  ll_value=None, a
+00025bd0: 7869 733d 3029 3a0a 2020 2020 2020 2020  xis=0):.        
+00025be0: 2020 2020 6966 206c 6576 656c 2069 7320      if level is 
+00025bf0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00025c00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00025c10: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
+00025c20: 726f 7228 226c 6576 656c 206d 7573 7420  ror("level must 
+00025c30: 6265 204e 6f6e 6522 290a 2020 2020 2020  be None").      
+00025c40: 2020 2020 2020 6178 6973 203d 2073 656c        axis = sel
+00025c50: 662e 5f76 616c 6964 6174 655f 6178 6973  f._validate_axis
+00025c60: 2861 7869 7329 0a20 2020 2020 2020 2020  (axis).         
+00025c70: 2020 206d 6574 6120 3d20 5f65 6d75 6c61     meta = _emula
+00025c80: 7465 286f 702c 2073 656c 662c 206f 7468  te(op, self, oth
+00025c90: 6572 2c20 6178 6973 3d61 7869 732c 2066  er, axis=axis, f
+00025ca0: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
+00025cb0: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
+00025cc0: 2020 7265 7475 726e 206d 6170 5f70 6172    return map_par
+00025cd0: 7469 7469 6f6e 7328 0a20 2020 2020 2020  titions(.       
+00025ce0: 2020 2020 2020 2020 206f 702c 2073 656c           op, sel
+00025cf0: 662c 206f 7468 6572 2c20 6d65 7461 3d6d  f, other, meta=m
+00025d00: 6574 612c 2061 7869 733d 6178 6973 2c20  eta, axis=axis, 
+00025d10: 6669 6c6c 5f76 616c 7565 3d66 696c 6c5f  fill_value=fill_
+00025d20: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+00025d30: 2020 290a 0a20 2020 2020 2020 206d 6574    )..        met
+00025d40: 682e 5f5f 6e61 6d65 5f5f 203d 206e 616d  h.__name__ = nam
+00025d50: 650a 2020 2020 2020 2020 7365 7461 7474  e.        setatt
+00025d60: 7228 636c 732c 206e 616d 652c 2064 6572  r(cls, name, der
+00025d70: 6976 6564 5f66 726f 6d28 6f72 6967 696e  ived_from(origin
+00025d80: 616c 2928 6d65 7468 2929 0a0a 2020 2020  al)(meth))..    
+00025d90: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00025da0: 2064 6566 205f 6269 6e64 5f63 6f6d 7061   def _bind_compa
+00025db0: 7269 736f 6e5f 6d65 7468 6f64 2863 6c73  rison_method(cls
+00025dc0: 2c20 6e61 6d65 2c20 636f 6d70 6172 6973  , name, comparis
+00025dd0: 6f6e 2c20 6f72 6967 696e 616c 3d70 642e  on, original=pd.
+00025de0: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
+00025df0: 2022 2222 6269 6e64 2063 6f6d 7061 7269   """bind compari
+00025e00: 736f 6e20 6d65 7468 6f64 206c 696b 6520  son method like 
+00025e10: 5365 7269 6573 2e65 7120 746f 2074 6869  Series.eq to thi
+00025e20: 7320 636c 6173 7322 2222 0a0a 2020 2020  s class"""..    
+00025e30: 2020 2020 6465 6620 6d65 7468 2873 656c      def meth(sel
+00025e40: 662c 206f 7468 6572 2c20 6c65 7665 6c3d  f, other, level=
+00025e50: 4e6f 6e65 2c20 6669 6c6c 5f76 616c 7565  None, fill_value
+00025e60: 3d4e 6f6e 652c 2061 7869 733d 3029 3a0a  =None, axis=0):.
+00025e70: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00025e80: 6576 656c 2069 7320 6e6f 7420 4e6f 6e65  evel is not None
+00025e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025ea0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00025eb0: 6d65 6e74 6564 4572 726f 7228 226c 6576  mentedError("lev
+00025ec0: 656c 206d 7573 7420 6265 204e 6f6e 6522  el must be None"
+00025ed0: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
+00025ee0: 6973 203d 2073 656c 662e 5f76 616c 6964  is = self._valid
+00025ef0: 6174 655f 6178 6973 2861 7869 7329 0a20  ate_axis(axis). 
+00025f00: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00025f10: 6c6c 5f76 616c 7565 2069 7320 4e6f 6e65  ll_value is None
+00025f20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025f30: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+00025f40: 6528 636f 6d70 6172 6973 6f6e 2c20 7365  e(comparison, se
+00025f50: 6c66 2c20 6f74 6865 722c 2061 7869 733d  lf, other, axis=
+00025f60: 6178 6973 290a 2020 2020 2020 2020 2020  axis).          
+00025f70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00025f80: 2020 2020 2020 2020 6f70 203d 2070 6172          op = par
+00025f90: 7469 616c 2863 6f6d 7061 7269 736f 6e2c  tial(comparison,
+00025fa0: 2066 696c 6c5f 7661 6c75 653d 6669 6c6c   fill_value=fill
+00025fb0: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
+00025fc0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00025fd0: 6c65 6d77 6973 6528 6f70 2c20 7365 6c66  lemwise(op, self
+00025fe0: 2c20 6f74 6865 722c 2061 7869 733d 6178  , other, axis=ax
+00025ff0: 6973 290a 0a20 2020 2020 2020 206d 6574  is)..        met
+00026000: 682e 5f5f 6e61 6d65 5f5f 203d 206e 616d  h.__name__ = nam
+00026010: 650a 2020 2020 2020 2020 7365 7461 7474  e.        setatt
+00026020: 7228 636c 732c 206e 616d 652c 2064 6572  r(cls, name, der
+00026030: 6976 6564 5f66 726f 6d28 6f72 6967 696e  ived_from(origin
+00026040: 616c 2928 6d65 7468 2929 0a0a 2020 2020  al)(meth))..    
+00026050: 4069 6e73 6572 745f 6d65 7461 5f70 6172  @insert_meta_par
+00026060: 616d 5f64 6573 6372 6970 7469 6f6e 2870  am_description(p
+00026070: 6164 3d31 3229 0a20 2020 2064 6566 2061  ad=12).    def a
+00026080: 7070 6c79 2873 656c 662c 2066 756e 632c  pply(self, func,
+00026090: 2063 6f6e 7665 7274 5f64 7479 7065 3d6e   convert_dtype=n
+000260a0: 6f5f 6465 6661 756c 742c 206d 6574 613d  o_default, meta=
+000260b0: 6e6f 5f64 6566 6175 6c74 2c20 6172 6773  no_default, args
+000260c0: 3d28 292c 202a 2a6b 7764 7329 3a0a 2020  =(), **kwds):.  
+000260d0: 2020 2020 2020 2222 2250 6172 616c 6c65        """Paralle
+000260e0: 6c20 7665 7273 696f 6e20 6f66 2070 616e  l version of pan
+000260f0: 6461 732e 5365 7269 6573 2e61 7070 6c79  das.Series.apply
+00026100: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00026110: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
+00026120: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00026130: 6675 6e63 203a 2066 756e 6374 696f 6e0a  func : function.
+00026140: 2020 2020 2020 2020 2020 2020 4675 6e63              Func
+00026150: 7469 6f6e 2074 6f20 6170 706c 790a 2020  tion to apply.  
+00026160: 2020 2020 2020 636f 6e76 6572 745f 6474        convert_dt
+00026170: 7970 6520 3a20 626f 6f6c 6561 6e2c 2064  ype : boolean, d
+00026180: 6566 6175 6c74 2054 7275 650a 2020 2020  efault True.    
+00026190: 2020 2020 2020 2020 5472 7920 746f 2066          Try to f
+000261a0: 696e 6420 6265 7474 6572 2064 7479 7065  ind better dtype
+000261b0: 2066 6f72 2065 6c65 6d65 6e74 7769 7365   for elementwise
+000261c0: 2066 756e 6374 696f 6e20 7265 7375 6c74   function result
+000261d0: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
+000261e0: 6620 4661 6c73 652c 206c 6561 7665 2061  f False, leave a
+000261f0: 7320 6474 7970 653d 6f62 6a65 6374 2e0a  s dtype=object..
+00026200: 2020 2020 2020 2020 244d 4554 410a 2020          $META.  
+00026210: 2020 2020 2020 6172 6773 203a 2074 7570        args : tup
+00026220: 6c65 0a20 2020 2020 2020 2020 2020 2050  le.            P
+00026230: 6f73 6974 696f 6e61 6c20 6172 6775 6d65  ositional argume
+00026240: 6e74 7320 746f 2070 6173 7320 746f 2066  nts to pass to f
+00026250: 756e 6374 696f 6e20 696e 2061 6464 6974  unction in addit
+00026260: 696f 6e20 746f 2074 6865 2076 616c 7565  ion to the value
+00026270: 2e0a 0a20 2020 2020 2020 2041 6464 6974  ...        Addit
+00026280: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
+00026290: 6775 6d65 6e74 7320 7769 6c6c 2062 6520  guments will be 
+000262a0: 7061 7373 6564 2061 7320 6b65 7977 6f72  passed as keywor
+000262b0: 6473 2074 6f20 7468 6520 6675 6e63 7469  ds to the functi
+000262c0: 6f6e 2e0a 0a20 2020 2020 2020 2052 6574  on...        Ret
+000262d0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+000262e0: 2d2d 2d2d 0a20 2020 2020 2020 2061 7070  ----.        app
+000262f0: 6c69 6564 203a 2053 6572 6965 7320 6f72  lied : Series or
+00026300: 2044 6174 6146 7261 6d65 2069 6620 6675   DataFrame if fu
+00026310: 6e63 2072 6574 7572 6e73 2061 2053 6572  nc returns a Ser
+00026320: 6965 732e 0a0a 2020 2020 2020 2020 4578  ies...        Ex
+00026330: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
+00026340: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00026350: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+00026360: 6461 7461 6672 616d 6520 6173 2064 640a  dataframe as dd.
+00026370: 2020 2020 2020 2020 3e3e 3e20 7320 3d20          >>> s = 
+00026380: 7064 2e53 6572 6965 7328 7261 6e67 6528  pd.Series(range(
+00026390: 3529 2c20 6e61 6d65 3d27 7827 290a 2020  5), name='x').  
+000263a0: 2020 2020 2020 3e3e 3e20 6473 203d 2064        >>> ds = d
+000263b0: 642e 6672 6f6d 5f70 616e 6461 7328 732c  d.from_pandas(s,
+000263c0: 206e 7061 7274 6974 696f 6e73 3d32 290a   npartitions=2).
+000263d0: 0a20 2020 2020 2020 2041 7070 6c79 2061  .        Apply a
+000263e0: 2066 756e 6374 696f 6e20 656c 656d 656e   function elemen
+000263f0: 7477 6973 6520 6163 726f 7373 2074 6865  twise across the
+00026400: 2053 6572 6965 732c 2070 6173 7369 6e67   Series, passing
+00026410: 2069 6e20 6578 7472 610a 2020 2020 2020   in extra.      
+00026420: 2020 6172 6775 6d65 6e74 7320 696e 2060    arguments in `
+00026430: 6061 7267 7360 6020 616e 6420 6060 6b77  `args`` and ``kw
+00026440: 6172 6773 6060 3a0a 0a20 2020 2020 2020  args``:..       
+00026450: 203e 3e3e 2064 6566 206d 7961 6464 2878   >>> def myadd(x
+00026460: 2c20 612c 2062 3d31 293a 0a20 2020 2020  , a, b=1):.     
+00026470: 2020 202e 2e2e 2020 2020 2072 6574 7572     ...     retur
+00026480: 6e20 7820 2b20 6120 2b20 620a 2020 2020  n x + a + b.    
+00026490: 2020 2020 3e3e 3e20 7265 7320 3d20 6473      >>> res = ds
+000264a0: 2e61 7070 6c79 286d 7961 6464 2c20 6172  .apply(myadd, ar
+000264b0: 6773 3d28 322c 292c 2062 3d31 2e35 2920  gs=(2,), b=1.5) 
+000264c0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+000264d0: 500a 0a20 2020 2020 2020 2042 7920 6465  P..        By de
+000264e0: 6661 756c 742c 2064 6173 6b20 7472 6965  fault, dask trie
+000264f0: 7320 746f 2069 6e66 6572 2074 6865 206f  s to infer the o
+00026500: 7574 7075 7420 6d65 7461 6461 7461 2062  utput metadata b
+00026510: 7920 7275 6e6e 696e 6720 796f 7572 0a20  y running your. 
+00026520: 2020 2020 2020 2070 726f 7669 6465 6420         provided 
+00026530: 6675 6e63 7469 6f6e 206f 6e20 736f 6d65  function on some
+00026540: 2066 616b 6520 6461 7461 2e20 5468 6973   fake data. This
+00026550: 2077 6f72 6b73 2077 656c 6c20 696e 206d   works well in m
+00026560: 616e 7920 6361 7365 732c 2062 7574 0a20  any cases, but. 
+00026570: 2020 2020 2020 2063 616e 2073 6f6d 6574         can somet
+00026580: 696d 6573 2062 6520 6578 7065 6e73 6976  imes be expensiv
+00026590: 652c 206f 7220 6576 656e 2066 6169 6c2e  e, or even fail.
+000265a0: 2054 6f20 6176 6f69 6420 7468 6973 2c20   To avoid this, 
+000265b0: 796f 7520 6361 6e0a 2020 2020 2020 2020  you can.        
+000265c0: 6d61 6e75 616c 6c79 2073 7065 6369 6679  manually specify
+000265d0: 2074 6865 206f 7574 7075 7420 6d65 7461   the output meta
+000265e0: 6461 7461 2077 6974 6820 7468 6520 6060  data with the ``
+000265f0: 6d65 7461 6060 206b 6579 776f 7264 2e20  meta`` keyword. 
+00026600: 5468 6973 0a20 2020 2020 2020 2063 616e  This.        can
+00026610: 2062 6520 7370 6563 6966 6965 6420 696e   be specified in
+00026620: 206d 616e 7920 666f 726d 732c 2066 6f72   many forms, for
+00026630: 206d 6f72 6520 696e 666f 726d 6174 696f   more informatio
+00026640: 6e20 7365 650a 2020 2020 2020 2020 6060  n see.        ``
+00026650: 6461 736b 2e64 6174 6166 7261 6d65 2e75  dask.dataframe.u
+00026660: 7469 6c73 2e6d 616b 655f 6d65 7461 6060  tils.make_meta``
+00026670: 2e0a 0a20 2020 2020 2020 2048 6572 6520  ...        Here 
+00026680: 7765 2073 7065 6369 6679 2074 6865 206f  we specify the o
+00026690: 7574 7075 7420 6973 2061 2053 6572 6965  utput is a Serie
+000266a0: 7320 7769 7468 206e 616d 6520 6060 2778  s with name ``'x
+000266b0: 2760 602c 2061 6e64 2064 7479 7065 0a20  '``, and dtype. 
+000266c0: 2020 2020 2020 2060 6066 6c6f 6174 3634         ``float64
+000266d0: 6060 3a0a 0a20 2020 2020 2020 203e 3e3e  ``:..        >>>
+000266e0: 2072 6573 203d 2064 732e 6170 706c 7928   res = ds.apply(
+000266f0: 6d79 6164 642c 2061 7267 733d 2832 2c29  myadd, args=(2,)
+00026700: 2c20 623d 312e 352c 206d 6574 613d 2827  , b=1.5, meta=('
+00026710: 7827 2c20 2766 3827 2929 0a0a 2020 2020  x', 'f8'))..    
+00026720: 2020 2020 496e 2074 6865 2063 6173 6520      In the case 
+00026730: 7768 6572 6520 7468 6520 6d65 7461 6461  where the metada
+00026740: 7461 2064 6f65 736e 2774 2063 6861 6e67  ta doesn't chang
+00026750: 652c 2079 6f75 2063 616e 2061 6c73 6f20  e, you can also 
+00026760: 7061 7373 2069 6e0a 2020 2020 2020 2020  pass in.        
+00026770: 7468 6520 6f62 6a65 6374 2069 7473 656c  the object itsel
+00026780: 6620 6469 7265 6374 6c79 3a0a 0a20 2020  f directly:..   
+00026790: 2020 2020 203e 3e3e 2072 6573 203d 2064       >>> res = d
+000267a0: 732e 6170 706c 7928 6c61 6d62 6461 2078  s.apply(lambda x
+000267b0: 3a20 7820 2b20 312c 206d 6574 613d 6473  : x + 1, meta=ds
+000267c0: 290a 0a20 2020 2020 2020 2053 6565 2041  )..        See A
+000267d0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+000267e0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+000267f0: 6b2e 5365 7269 6573 2e6d 6170 5f70 6172  k.Series.map_par
+00026800: 7469 7469 6f6e 730a 2020 2020 2020 2020  titions.        
+00026810: 2222 220a 2020 2020 2020 2020 6966 2063  """.        if c
+00026820: 6f6e 7665 7274 5f64 7479 7065 2069 7320  onvert_dtype is 
+00026830: 6e6f 7420 6e6f 5f64 6566 6175 6c74 3a0a  not no_default:.
+00026840: 2020 2020 2020 2020 2020 2020 6b77 6473              kwds
+00026850: 5b22 636f 6e76 6572 745f 6474 7970 6522  ["convert_dtype"
+00026860: 5d20 3d20 636f 6e76 6572 745f 6474 7970  ] = convert_dtyp
+00026870: 650a 0a20 2020 2020 2020 2023 206c 6574  e..        # let
+00026880: 2070 616e 6461 7320 7472 6967 6765 7220   pandas trigger 
+00026890: 616e 7920 7761 726e 696e 6773 2c20 7375  any warnings, su
+000268a0: 6368 2061 7320 636f 6e76 6572 745f 6474  ch as convert_dt
+000268b0: 7970 6520 7761 726e 696e 670a 2020 2020  ype warning.    
+000268c0: 2020 2020 7365 6c66 2e5f 6d65 7461 2e61      self._meta.a
+000268d0: 7070 6c79 2866 756e 632c 2061 7267 733d  pply(func, args=
+000268e0: 6172 6773 2c20 2a2a 6b77 6473 290a 0a20  args, **kwds).. 
+000268f0: 2020 2020 2020 2069 6620 6d65 7461 2069         if meta i
+00026900: 7320 6e6f 5f64 6566 6175 6c74 3a0a 2020  s no_default:.  
+00026910: 2020 2020 2020 2020 2020 7769 7468 2063            with c
+00026920: 6865 636b 5f63 6f6e 7665 7274 5f64 7479  heck_convert_dty
+00026930: 7065 5f64 6570 7265 6361 7469 6f6e 2829  pe_deprecation()
+00026940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026950: 2020 6d65 7461 203d 205f 656d 756c 6174    meta = _emulat
+00026960: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00026970: 2020 2020 2020 204d 2e61 7070 6c79 2c20         M.apply, 
+00026980: 7365 6c66 2e5f 6d65 7461 5f6e 6f6e 656d  self._meta_nonem
+00026990: 7074 792c 2066 756e 632c 2061 7267 733d  pty, func, args=
+000269a0: 6172 6773 2c20 7564 663d 5472 7565 2c20  args, udf=True, 
+000269b0: 2a2a 6b77 6473 0a20 2020 2020 2020 2020  **kwds.         
+000269c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000269d0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+000269e0: 726e 286d 6574 615f 7761 726e 696e 6728  rn(meta_warning(
+000269f0: 6d65 7461 2929 0a20 2020 2020 2020 2065  meta)).        e
+00026a00: 6c69 6620 5041 4e44 4153 5f47 545f 3231  lif PANDAS_GT_21
+00026a10: 303a 0a20 2020 2020 2020 2020 2020 2074  0:.            t
+00026a20: 6573 745f 6d65 7461 203d 206d 616b 655f  est_meta = make_
+00026a30: 6d65 7461 286d 6574 6129 0a20 2020 2020  meta(meta).     
+00026a40: 2020 2020 2020 2069 6620 6973 5f64 6174         if is_dat
+00026a50: 6166 7261 6d65 5f6c 696b 6528 7465 7374  aframe_like(test
+00026a60: 5f6d 6574 6129 3a0a 2020 2020 2020 2020  _meta):.        
+00026a70: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00026a80: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+00026a90: 2020 2020 2020 2020 2020 2022 5265 7475             "Retu
+00026aa0: 726e 696e 6720 6120 4461 7461 4672 616d  rning a DataFram
+00026ab0: 6520 6672 6f6d 2053 6572 6965 732e 6170  e from Series.ap
+00026ac0: 706c 7920 7768 656e 2074 6865 2073 7570  ply when the sup
+00026ad0: 706c 6965 6420 6675 6e63 7469 6f6e 2022  plied function "
+00026ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026af0: 2020 2020 2022 7265 7475 726e 7320 6120       "returns a 
+00026b00: 5365 7269 6573 2069 7320 6465 7072 6563  Series is deprec
+00026b10: 6174 6564 2061 6e64 2077 696c 6c20 6265  ated and will be
+00026b20: 2072 656d 6f76 6564 2069 6e20 6120 6675   removed in a fu
+00026b30: 7475 7265 2076 6572 7369 6f6e 2e22 2c0a  ture version.",.
+00026b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b50: 2020 2020 4675 7475 7265 5761 726e 696e      FutureWarnin
+00026b60: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
+00026b70: 2020 2020 2020 2073 7461 636b 6c65 7665         stackleve
+00026b80: 6c3d 322c 0a20 2020 2020 2020 2020 2020  l=2,.           
+00026b90: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00026ba0: 7265 7475 726e 206d 6170 5f70 6172 7469  return map_parti
+00026bb0: 7469 6f6e 7328 6d65 7468 6f64 732e 6170  tions(methods.ap
+00026bc0: 706c 792c 2073 656c 662c 2066 756e 632c  ply, self, func,
+00026bd0: 2061 7267 733d 6172 6773 2c20 6d65 7461   args=args, meta
+00026be0: 3d6d 6574 612c 202a 2a6b 7764 7329 0a0a  =meta, **kwds)..
+00026bf0: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+00026c00: 6d28 7064 2e53 6572 6965 7329 0a20 2020  m(pd.Series).   
+00026c10: 2064 6566 2063 6f76 2873 656c 662c 206f   def cov(self, o
+00026c20: 7468 6572 2c20 6d69 6e5f 7065 7269 6f64  ther, min_period
+00026c30: 733d 4e6f 6e65 2c20 7370 6c69 745f 6576  s=None, split_ev
+00026c40: 6572 793d 4661 6c73 6529 3a0a 2020 2020  ery=False):.    
+00026c50: 2020 2020 6672 6f6d 2064 6173 6b2e 6461      from dask.da
+00026c60: 7461 6672 616d 652e 6d75 6c74 6920 696d  taframe.multi im
+00026c70: 706f 7274 2063 6f6e 6361 740a 0a20 2020  port concat..   
+00026c80: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00026c90: 7374 616e 6365 286f 7468 6572 2c20 5365  stance(other, Se
+00026ca0: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
+00026cb0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00026cc0: 6f72 2822 6f74 6865 7220 6d75 7374 2062  or("other must b
+00026cd0: 6520 6120 6461 736b 2e64 6174 6166 7261  e a dask.datafra
+00026ce0: 6d65 2e53 6572 6965 7322 290a 2020 2020  me.Series").    
+00026cf0: 2020 2020 6466 203d 2063 6f6e 6361 7428      df = concat(
+00026d00: 5b73 656c 662c 206f 7468 6572 5d2c 2061  [self, other], a
+00026d10: 7869 733d 3129 0a20 2020 2020 2020 2072  xis=1).        r
+00026d20: 6574 7572 6e20 5f63 6f76 5f63 6f72 7228  eturn _cov_corr(
+00026d30: 0a20 2020 2020 2020 2020 2020 2064 662c  .            df,
+00026d40: 206d 696e 5f70 6572 696f 6473 2c20 7363   min_periods, sc
+00026d50: 616c 6172 3d54 7275 652c 206e 756d 6572  alar=True, numer
+00026d60: 6963 5f6f 6e6c 793d 4661 6c73 652c 2073  ic_only=False, s
+00026d70: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+00026d80: 5f65 7665 7279 0a20 2020 2020 2020 2029  _every.        )
+00026d90: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+00026da0: 726f 6d28 7064 2e53 6572 6965 7329 0a20  rom(pd.Series). 
+00026db0: 2020 2064 6566 2063 6f72 7228 7365 6c66     def corr(self
+00026dc0: 2c20 6f74 6865 722c 206d 6574 686f 643d  , other, method=
+00026dd0: 2270 6561 7273 6f6e 222c 206d 696e 5f70  "pearson", min_p
+00026de0: 6572 696f 6473 3d4e 6f6e 652c 2073 706c  eriods=None, spl
+00026df0: 6974 5f65 7665 7279 3d46 616c 7365 293a  it_every=False):
+00026e00: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00026e10: 736b 2e64 6174 6166 7261 6d65 2e6d 756c  sk.dataframe.mul
+00026e20: 7469 2069 6d70 6f72 7420 636f 6e63 6174  ti import concat
+00026e30: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00026e40: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+00026e50: 722c 2053 6572 6965 7329 3a0a 2020 2020  r, Series):.    
+00026e60: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+00026e70: 7065 4572 726f 7228 226f 7468 6572 206d  peError("other m
+00026e80: 7573 7420 6265 2061 2064 6173 6b2e 6461  ust be a dask.da
+00026e90: 7461 6672 616d 652e 5365 7269 6573 2229  taframe.Series")
+00026ea0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+00026eb0: 6f64 2021 3d20 2270 6561 7273 6f6e 223a  od != "pearson":
+00026ec0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00026ed0: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00026ee0: 6445 7272 6f72 2822 4f6e 6c79 2050 6561  dError("Only Pea
+00026ef0: 7273 6f6e 2063 6f72 7265 6c61 7469 6f6e  rson correlation
+00026f00: 2068 6173 2062 6565 6e20 696d 706c 656d   has been implem
+00026f10: 656e 7465 6422 290a 2020 2020 2020 2020  ented").        
+00026f20: 6466 203d 2063 6f6e 6361 7428 5b73 656c  df = concat([sel
+00026f30: 662c 206f 7468 6572 5d2c 2061 7869 733d  f, other], axis=
+00026f40: 3129 0a20 2020 2020 2020 2072 6574 7572  1).        retur
+00026f50: 6e20 5f63 6f76 5f63 6f72 7228 0a20 2020  n _cov_corr(.   
+00026f60: 2020 2020 2020 2020 2064 662c 0a20 2020           df,.   
+00026f70: 2020 2020 2020 2020 206d 696e 5f70 6572           min_per
+00026f80: 696f 6473 2c0a 2020 2020 2020 2020 2020  iods,.          
+00026f90: 2020 636f 7272 3d54 7275 652c 0a20 2020    corr=True,.   
+00026fa0: 2020 2020 2020 2020 2073 6361 6c61 723d           scalar=
+00026fb0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00026fc0: 2020 6e75 6d65 7269 635f 6f6e 6c79 3d46    numeric_only=F
+00026fd0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00026fe0: 2020 7370 6c69 745f 6576 6572 793d 7370    split_every=sp
+00026ff0: 6c69 745f 6576 6572 792c 0a20 2020 2020  lit_every,.     
+00027000: 2020 2029 0a0a 2020 2020 4064 6572 6976     )..    @deriv
+00027010: 6564 5f66 726f 6d28 7064 2e53 6572 6965  ed_from(pd.Serie
+00027020: 7329 0a20 2020 2064 6566 2061 7574 6f63  s).    def autoc
+00027030: 6f72 7228 7365 6c66 2c20 6c61 673d 312c  orr(self, lag=1,
+00027040: 2073 706c 6974 5f65 7665 7279 3d46 616c   split_every=Fal
+00027050: 7365 293a 0a20 2020 2020 2020 2069 6620  se):.        if 
+00027060: 6e6f 7420 6973 696e 7374 616e 6365 286c  not isinstance(l
+00027070: 6167 2c20 496e 7465 6772 616c 293a 0a20  ag, Integral):. 
+00027080: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00027090: 2054 7970 6545 7272 6f72 2822 6c61 6720   TypeError("lag 
+000270a0: 6d75 7374 2062 6520 616e 2069 6e74 6567  must be an integ
+000270b0: 6572 2229 0a20 2020 2020 2020 2072 6574  er").        ret
+000270c0: 7572 6e20 7365 6c66 2e63 6f72 7228 7365  urn self.corr(se
+000270d0: 6c66 2069 6620 6c61 6720 3d3d 2030 2065  lf if lag == 0 e
+000270e0: 6c73 6520 7365 6c66 2e73 6869 6674 286c  lse self.shift(l
+000270f0: 6167 292c 2073 706c 6974 5f65 7665 7279  ag), split_every
+00027100: 3d73 706c 6974 5f65 7665 7279 290a 0a20  =split_every).. 
+00027110: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+00027120: 2870 642e 5365 7269 6573 290a 2020 2020  (pd.Series).    
+00027130: 6465 6620 6d65 6d6f 7279 5f75 7361 6765  def memory_usage
+00027140: 2873 656c 662c 2069 6e64 6578 3d54 7275  (self, index=Tru
+00027150: 652c 2064 6565 703d 4661 6c73 6529 3a0a  e, deep=False):.
+00027160: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00027170: 656c 662e 7265 6475 6374 696f 6e28 0a20  elf.reduction(. 
+00027180: 2020 2020 2020 2020 2020 204d 2e6d 656d             M.mem
+00027190: 6f72 795f 7573 6167 652c 0a20 2020 2020  ory_usage,.     
+000271a0: 2020 2020 2020 204d 2e73 756d 2c0a 2020         M.sum,.  
+000271b0: 2020 2020 2020 2020 2020 6368 756e 6b5f            chunk_
+000271c0: 6b77 6172 6773 3d7b 2269 6e64 6578 223a  kwargs={"index":
+000271d0: 2069 6e64 6578 2c20 2264 6565 7022 3a20   index, "deep": 
+000271e0: 6465 6570 7d2c 0a20 2020 2020 2020 2020  deep},.         
+000271f0: 2020 2073 706c 6974 5f65 7665 7279 3d46     split_every=F
+00027200: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00027210: 2020 746f 6b65 6e3d 7365 6c66 2e5f 746f    token=self._to
+00027220: 6b65 6e5f 7072 6566 6978 202b 2022 6d65  ken_prefix + "me
+00027230: 6d6f 7279 2d75 7361 6765 222c 0a20 2020  mory-usage",.   
+00027240: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00027250: 5f5f 6469 766d 6f64 5f5f 2873 656c 662c  __divmod__(self,
+00027260: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00027270: 2072 6573 3120 3d20 7365 6c66 202f 2f20   res1 = self // 
+00027280: 6f74 6865 720a 2020 2020 2020 2020 7265  other.        re
+00027290: 7332 203d 2073 656c 6620 2520 6f74 6865  s2 = self % othe
+000272a0: 720a 2020 2020 2020 2020 7265 7475 726e  r.        return
+000272b0: 2072 6573 312c 2072 6573 320a 0a20 2020   res1, res2..   
+000272c0: 2064 6566 205f 5f72 6469 766d 6f64 5f5f   def __rdivmod__
+000272d0: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+000272e0: 2020 2020 2020 2072 6573 3120 3d20 6f74         res1 = ot
+000272f0: 6865 7220 2f2f 2073 656c 660a 2020 2020  her // self.    
+00027300: 2020 2020 7265 7332 203d 206f 7468 6572      res2 = other
+00027310: 2025 2073 656c 660a 2020 2020 2020 2020   % self.        
+00027320: 7265 7475 726e 2072 6573 312c 2072 6573  return res1, res
+00027330: 320a 0a20 2020 2069 6620 6e6f 7420 5041  2..    if not PA
+00027340: 4e44 4153 5f47 545f 3230 303a 0a0a 2020  NDAS_GT_200:..  
+00027350: 2020 2020 2020 4070 726f 7065 7274 790a        @property.
+00027360: 2020 2020 2020 2020 4064 6572 6976 6564          @derived
+00027370: 5f66 726f 6d28 7064 2e53 6572 6965 7329  _from(pd.Series)
+00027380: 0a20 2020 2020 2020 2064 6566 2069 735f  .        def is_
+00027390: 6d6f 6e6f 746f 6e69 6328 7365 6c66 293a  monotonic(self):
+000273a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000273b0: 5041 4e44 4153 5f47 545f 3135 303a 0a20  PANDAS_GT_150:. 
+000273c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+000273d0: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
+000273e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000273f0: 2020 2269 735f 6d6f 6e6f 746f 6e69 6320    "is_monotonic 
+00027400: 6973 2064 6570 7265 6361 7465 6420 616e  is deprecated an
+00027410: 6420 7769 6c6c 2062 6520 7265 6d6f 7665  d will be remove
+00027420: 6420 696e 2061 2066 7574 7572 6520 7665  d in a future ve
+00027430: 7273 696f 6e2e 2022 0a20 2020 2020 2020  rsion. ".       
+00027440: 2020 2020 2020 2020 2020 2020 2022 5573               "Us
+00027450: 6520 6973 5f6d 6f6e 6f74 6f6e 6963 5f69  e is_monotonic_i
+00027460: 6e63 7265 6173 696e 6720 696e 7374 6561  ncreasing instea
+00027470: 642e 222c 0a20 2020 2020 2020 2020 2020  d.",.           
+00027480: 2020 2020 2020 2020 2046 7574 7572 6557           FutureW
+00027490: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+000274a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000274b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000274c0: 662e 6973 5f6d 6f6e 6f74 6f6e 6963 5f69  f.is_monotonic_i
+000274d0: 6e63 7265 6173 696e 670a 0a20 2020 2040  ncreasing..    @
+000274e0: 7072 6f70 6572 7479 0a20 2020 2040 6465  property.    @de
+000274f0: 7269 7665 645f 6672 6f6d 2870 642e 5365  rived_from(pd.Se
+00027500: 7269 6573 290a 2020 2020 6465 6620 6973  ries).    def is
+00027510: 5f6d 6f6e 6f74 6f6e 6963 5f69 6e63 7265  _monotonic_incre
+00027520: 6173 696e 6728 7365 6c66 293a 0a20 2020  asing(self):.   
+00027530: 2020 2020 2072 6574 7572 6e20 6163 6128       return aca(
+00027540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00027550: 662c 0a20 2020 2020 2020 2020 2020 2063  f,.            c
+00027560: 6875 6e6b 3d6d 6574 686f 6473 2e6d 6f6e  hunk=methods.mon
+00027570: 6f74 6f6e 6963 5f69 6e63 7265 6173 696e  otonic_increasin
+00027580: 675f 6368 756e 6b2c 0a20 2020 2020 2020  g_chunk,.       
+00027590: 2020 2020 2063 6f6d 6269 6e65 3d6d 6574       combine=met
+000275a0: 686f 6473 2e6d 6f6e 6f74 6f6e 6963 5f69  hods.monotonic_i
+000275b0: 6e63 7265 6173 696e 675f 636f 6d62 696e  ncreasing_combin
+000275c0: 652c 0a20 2020 2020 2020 2020 2020 2061  e,.            a
+000275d0: 6767 7265 6761 7465 3d6d 6574 686f 6473  ggregate=methods
+000275e0: 2e6d 6f6e 6f74 6f6e 6963 5f69 6e63 7265  .monotonic_incre
+000275f0: 6173 696e 675f 6167 6772 6567 6174 652c  asing_aggregate,
+00027600: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+00027610: 613d 626f 6f6c 2c0a 2020 2020 2020 2020  a=bool,.        
+00027620: 2020 2020 746f 6b65 6e3d 226d 6f6e 6f74      token="monot
+00027630: 6f6e 6963 5f69 6e63 7265 6173 696e 6722  onic_increasing"
+00027640: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00027650: 2040 7072 6f70 6572 7479 0a20 2020 2040   @property.    @
+00027660: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+00027670: 5365 7269 6573 290a 2020 2020 6465 6620  Series).    def 
+00027680: 6973 5f6d 6f6e 6f74 6f6e 6963 5f64 6563  is_monotonic_dec
+00027690: 7265 6173 696e 6728 7365 6c66 293a 0a20  reasing(self):. 
+000276a0: 2020 2020 2020 2072 6574 7572 6e20 6163         return ac
+000276b0: 6128 0a20 2020 2020 2020 2020 2020 2073  a(.            s
+000276c0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+000276d0: 2063 6875 6e6b 3d6d 6574 686f 6473 2e6d   chunk=methods.m
+000276e0: 6f6e 6f74 6f6e 6963 5f64 6563 7265 6173  onotonic_decreas
+000276f0: 696e 675f 6368 756e 6b2c 0a20 2020 2020  ing_chunk,.     
+00027700: 2020 2020 2020 2063 6f6d 6269 6e65 3d6d         combine=m
+00027710: 6574 686f 6473 2e6d 6f6e 6f74 6f6e 6963  ethods.monotonic
+00027720: 5f64 6563 7265 6173 696e 675f 636f 6d62  _decreasing_comb
+00027730: 696e 652c 0a20 2020 2020 2020 2020 2020  ine,.           
+00027740: 2061 6767 7265 6761 7465 3d6d 6574 686f   aggregate=metho
+00027750: 6473 2e6d 6f6e 6f74 6f6e 6963 5f64 6563  ds.monotonic_dec
+00027760: 7265 6173 696e 675f 6167 6772 6567 6174  reasing_aggregat
+00027770: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00027780: 6574 613d 626f 6f6c 2c0a 2020 2020 2020  eta=bool,.      
+00027790: 2020 2020 2020 746f 6b65 6e3d 226d 6f6e        token="mon
+000277a0: 6f74 6f6e 6963 5f64 6563 7265 6173 696e  otonic_decreasin
+000277b0: 6722 2c0a 2020 2020 2020 2020 290a 0a20  g",.        ).. 
+000277c0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
+000277d0: 2870 642e 5365 7269 6573 290a 2020 2020  (pd.Series).    
+000277e0: 6465 6620 7669 6577 2873 656c 662c 2064  def view(self, d
+000277f0: 7479 7065 293a 0a20 2020 2020 2020 206d  type):.        m
+00027800: 6574 6120 3d20 7365 6c66 2e5f 6d65 7461  eta = self._meta
+00027810: 2e76 6965 7728 6474 7970 6529 0a20 2020  .view(dtype).   
+00027820: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00027830: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+00027840: 4d2e 7669 6577 2c20 6474 7970 652c 206d  M.view, dtype, m
+00027850: 6574 613d 6d65 7461 290a 0a0a 636c 6173  eta=meta)...clas
+00027860: 7320 496e 6465 7828 5365 7269 6573 293a  s Index(Series):
+00027870: 0a20 2020 205f 7061 7274 6974 696f 6e5f  .    _partition_
+00027880: 7479 7065 203d 2070 642e 496e 6465 780a  type = pd.Index.
+00027890: 2020 2020 5f69 735f 7061 7274 6974 696f      _is_partitio
+000278a0: 6e5f 7479 7065 203d 2073 7461 7469 636d  n_type = staticm
+000278b0: 6574 686f 6428 6973 5f69 6e64 6578 5f6c  ethod(is_index_l
+000278c0: 696b 6529 0a20 2020 205f 746f 6b65 6e5f  ike).    _token_
+000278d0: 7072 6566 6978 203d 2022 696e 6465 782d  prefix = "index-
+000278e0: 220a 2020 2020 5f61 6363 6573 736f 7273  ".    _accessors
+000278f0: 3a20 436c 6173 7356 6172 5b73 6574 5b73  : ClassVar[set[s
+00027900: 7472 5d5d 203d 2073 6574 2829 0a0a 2020  tr]] = set()..  
+00027910: 2020 5f64 745f 6174 7472 6962 7574 6573    _dt_attributes
+00027920: 203d 207b 0a20 2020 2020 2020 2022 6e61   = {.        "na
+00027930: 6e6f 7365 636f 6e64 222c 0a20 2020 2020  nosecond",.     
+00027940: 2020 2022 6d69 6372 6f73 6563 6f6e 6422     "microsecond"
+00027950: 2c0a 2020 2020 2020 2020 226d 696c 6c69  ,.        "milli
+00027960: 7365 636f 6e64 222c 0a20 2020 2020 2020  second",.       
+00027970: 2022 6461 796f 6679 6561 7222 2c0a 2020   "dayofyear",.  
+00027980: 2020 2020 2020 226d 696e 7574 6522 2c0a        "minute",.
+00027990: 2020 2020 2020 2020 2268 6f75 7222 2c0a          "hour",.
+000279a0: 2020 2020 2020 2020 2264 6179 222c 0a20          "day",. 
+000279b0: 2020 2020 2020 2022 6461 796f 6677 6565         "dayofwee
+000279c0: 6b22 2c0a 2020 2020 2020 2020 2273 6563  k",.        "sec
+000279d0: 6f6e 6422 2c0a 2020 2020 2020 2020 2277  ond",.        "w
+000279e0: 6565 6b22 2c0a 2020 2020 2020 2020 2277  eek",.        "w
+000279f0: 6565 6b64 6179 222c 0a20 2020 2020 2020  eekday",.       
+00027a00: 2022 7765 656b 6f66 7965 6172 222c 0a20   "weekofyear",. 
+00027a10: 2020 2020 2020 2022 6d6f 6e74 6822 2c0a         "month",.
+00027a20: 2020 2020 2020 2020 2271 7561 7274 6572          "quarter
+00027a30: 222c 0a20 2020 2020 2020 2022 7965 6172  ",.        "year
+00027a40: 222c 0a20 2020 207d 0a0a 2020 2020 5f63  ",.    }..    _c
+00027a50: 6174 5f61 7474 7269 6275 7465 7320 3d20  at_attributes = 
+00027a60: 7b0a 2020 2020 2020 2020 226b 6e6f 776e  {.        "known
+00027a70: 222c 0a20 2020 2020 2020 2022 6173 5f6b  ",.        "as_k
+00027a80: 6e6f 776e 222c 0a20 2020 2020 2020 2022  nown",.        "
+00027a90: 6173 5f75 6e6b 6e6f 776e 222c 0a20 2020  as_unknown",.   
+00027aa0: 2020 2020 2022 6164 645f 6361 7465 676f       "add_catego
+00027ab0: 7269 6573 222c 0a20 2020 2020 2020 2022  ries",.        "
+00027ac0: 6361 7465 676f 7269 6573 222c 0a20 2020  categories",.   
+00027ad0: 2020 2020 2022 7265 6d6f 7665 5f63 6174       "remove_cat
+00027ae0: 6567 6f72 6965 7322 2c0a 2020 2020 2020  egories",.      
+00027af0: 2020 2272 656f 7264 6572 5f63 6174 6567    "reorder_categ
+00027b00: 6f72 6965 7322 2c0a 2020 2020 2020 2020  ories",.        
+00027b10: 2261 735f 6f72 6465 7265 6422 2c0a 2020  "as_ordered",.  
+00027b20: 2020 2020 2020 2263 6f64 6573 222c 0a20        "codes",. 
+00027b30: 2020 2020 2020 2022 7265 6d6f 7665 5f75         "remove_u
+00027b40: 6e75 7365 645f 6361 7465 676f 7269 6573  nused_categories
+00027b50: 222c 0a20 2020 2020 2020 2022 7365 745f  ",.        "set_
+00027b60: 6361 7465 676f 7269 6573 222c 0a20 2020  categories",.   
+00027b70: 2020 2020 2022 6173 5f75 6e6f 7264 6572       "as_unorder
+00027b80: 6564 222c 0a20 2020 2020 2020 2022 6f72  ed",.        "or
+00027b90: 6465 7265 6422 2c0a 2020 2020 2020 2020  dered",.        
+00027ba0: 2272 656e 616d 655f 6361 7465 676f 7269  "rename_categori
+00027bb0: 6573 222c 0a20 2020 207d 0a0a 2020 2020  es",.    }..    
+00027bc0: 5f6d 6f6e 6f74 6f6e 6963 5f61 7474 7269  _monotonic_attri
+00027bd0: 6275 7465 7320 3d20 7b0a 2020 2020 2020  butes = {.      
+00027be0: 2020 2269 735f 6d6f 6e6f 746f 6e69 6322    "is_monotonic"
+00027bf0: 2c0a 2020 2020 2020 2020 2269 735f 6d6f  ,.        "is_mo
+00027c00: 6e6f 746f 6e69 635f 696e 6372 6561 7369  notonic_increasi
+00027c10: 6e67 222c 0a20 2020 2020 2020 2022 6973  ng",.        "is
+00027c20: 5f6d 6f6e 6f74 6f6e 6963 5f64 6563 7265  _monotonic_decre
+00027c30: 6173 696e 6722 2c0a 2020 2020 7d0a 0a20  asing",.    }.. 
+00027c40: 2020 2064 6566 205f 5f67 6574 6174 7472     def __getattr
+00027c50: 5f5f 2873 656c 662c 206b 6579 293a 0a20  __(self, key):. 
+00027c60: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00027c70: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
+00027c80: 6365 2873 656c 662e 5f6d 6574 612e 6474  ce(self._meta.dt
+00027c90: 7970 652c 2070 642e 4361 7465 676f 7269  ype, pd.Categori
+00027ca0: 6361 6c44 7479 7065 290a 2020 2020 2020  calDtype).      
+00027cb0: 2020 2020 2020 616e 6420 6b65 7920 696e        and key in
+00027cc0: 2073 656c 662e 5f63 6174 5f61 7474 7269   self._cat_attri
+00027cd0: 6275 7465 730a 2020 2020 2020 2020 293a  butes.        ):
+00027ce0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00027cf0: 7572 6e20 6765 7461 7474 7228 7365 6c66  urn getattr(self
+00027d00: 2e63 6174 2c20 6b65 7929 0a20 2020 2020  .cat, key).     
+00027d10: 2020 2065 6c69 6620 6b65 7920 696e 2073     elif key in s
+00027d20: 656c 662e 5f64 745f 6174 7472 6962 7574  elf._dt_attribut
+00027d30: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00027d40: 7265 7475 726e 2067 6574 6174 7472 2873  return getattr(s
+00027d50: 656c 662e 6474 2c20 6b65 7929 0a20 2020  elf.dt, key).   
+00027d60: 2020 2020 2065 6c69 6620 6b65 7920 696e       elif key in
+00027d70: 2073 656c 662e 5f6d 6f6e 6f74 6f6e 6963   self._monotonic
+00027d80: 5f61 7474 7269 6275 7465 733a 0a20 2020  _attributes:.   
+00027d90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00027da0: 6765 7461 7474 7228 7365 6c66 2c20 6b65  getattr(self, ke
+00027db0: 7929 0a20 2020 2020 2020 2072 6169 7365  y).        raise
+00027dc0: 2041 7474 7269 6275 7465 4572 726f 7228   AttributeError(
+00027dd0: 2227 496e 6465 7827 206f 626a 6563 7420  "'Index' object 
+00027de0: 6861 7320 6e6f 2061 7474 7269 6275 7465  has no attribute
+00027df0: 2025 7222 2025 206b 6579 290a 0a20 2020   %r" % key)..   
+00027e00: 2064 6566 205f 5f64 6972 5f5f 2873 656c   def __dir__(sel
+00027e10: 6629 3a0a 2020 2020 2020 2020 6f75 7420  f):.        out 
+00027e20: 3d20 7375 7065 7228 292e 5f5f 6469 725f  = super().__dir_
+00027e30: 5f28 290a 2020 2020 2020 2020 6f75 742e  _().        out.
+00027e40: 6578 7465 6e64 2873 656c 662e 5f64 745f  extend(self._dt_
+00027e50: 6174 7472 6962 7574 6573 290a 2020 2020  attributes).    
+00027e60: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00027e70: 6528 7365 6c66 2e64 7479 7065 2c20 7064  e(self.dtype, pd
+00027e80: 2e43 6174 6567 6f72 6963 616c 4474 7970  .CategoricalDtyp
+00027e90: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00027ea0: 6f75 742e 6578 7465 6e64 2873 656c 662e  out.extend(self.
+00027eb0: 5f63 6174 5f61 7474 7269 6275 7465 7329  _cat_attributes)
+00027ec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00027ed0: 6f75 740a 0a20 2020 2023 2054 7970 696e  out..    # Typin
+00027ee0: 673a 2068 7474 7073 3a2f 2f67 6974 6875  g: https://githu
+00027ef0: 622e 636f 6d2f 7079 7468 6f6e 2f6d 7970  b.com/python/myp
+00027f00: 792f 6973 7375 6573 2f34 3132 350a 2020  y/issues/4125.  
+00027f10: 2020 4070 726f 7065 7274 7920 2023 2074    @property  # t
+00027f20: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+00027f30: 6465 6620 696e 6465 7828 7365 6c66 293a  def index(self):
+00027f40: 0a20 2020 2020 2020 2072 6169 7365 2041  .        raise A
+00027f50: 7474 7269 6275 7465 4572 726f 7228 0a20  ttributeError(. 
+00027f60: 2020 2020 2020 2020 2020 2066 227b 7365             f"{se
+00027f70: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
+00027f80: 616d 655f 5f21 727d 206f 626a 6563 7420  ame__!r} object 
+00027f90: 6861 7320 6e6f 2061 7474 7269 6275 7465  has no attribute
+00027fa0: 2027 696e 6465 7827 220a 2020 2020 2020   'index'".      
+00027fb0: 2020 290a 0a20 2020 2064 6566 205f 5f61    )..    def __a
+00027fc0: 7272 6179 5f77 7261 705f 5f28 7365 6c66  rray_wrap__(self
+00027fd0: 2c20 6172 7261 792c 2063 6f6e 7465 7874  , array, context
+00027fe0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00027ff0: 7265 7475 726e 2070 642e 496e 6465 7828  return pd.Index(
+00028000: 6172 7261 792c 206e 616d 653d 7365 6c66  array, name=self
+00028010: 2e6e 616d 6529 0a0a 2020 2020 6465 6620  .name)..    def 
+00028020: 6865 6164 2873 656c 662c 206e 3d35 2c20  head(self, n=5, 
+00028030: 636f 6d70 7574 653d 5472 7565 293a 0a20  compute=True):. 
+00028040: 2020 2020 2020 2022 2222 4669 7273 7420         """First 
+00028050: 6e20 6974 656d 7320 6f66 2074 6865 2049  n items of the I
+00028060: 6e64 6578 2e0a 0a20 2020 2020 2020 2043  ndex...        C
+00028070: 6176 6561 742c 2074 6869 7320 6f6e 6c79  aveat, this only
+00028080: 2063 6865 636b 7320 7468 6520 6669 7273   checks the firs
+00028090: 7420 7061 7274 6974 696f 6e2e 0a20 2020  t partition..   
+000280a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000280b0: 206e 616d 6520 3d20 2268 6561 642d 2564   name = "head-%d
+000280c0: 2d25 7322 2025 2028 6e2c 2073 656c 662e  -%s" % (n, self.
+000280d0: 5f6e 616d 6529 0a20 2020 2020 2020 2064  _name).        d
+000280e0: 736b 203d 207b 286e 616d 652c 2030 293a  sk = {(name, 0):
+000280f0: 2028 6f70 6572 6174 6f72 2e67 6574 6974   (operator.getit
+00028100: 656d 2c20 2873 656c 662e 5f6e 616d 652c  em, (self._name,
+00028110: 2030 292c 2073 6c69 6365 2830 2c20 6e29   0), slice(0, n)
+00028120: 297d 0a20 2020 2020 2020 2067 7261 7068  )}.        graph
+00028130: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+00028140: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+00028150: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
+00028160: 7065 6e64 656e 6369 6573 3d5b 7365 6c66  pendencies=[self
+00028170: 5d29 0a0a 2020 2020 2020 2020 7265 7375  ])..        resu
+00028180: 6c74 203d 206e 6577 5f64 645f 6f62 6a65  lt = new_dd_obje
+00028190: 6374 2867 7261 7068 2c20 6e61 6d65 2c20  ct(graph, name, 
+000281a0: 7365 6c66 2e5f 6d65 7461 2c20 7365 6c66  self._meta, self
+000281b0: 2e64 6976 6973 696f 6e73 5b3a 325d 290a  .divisions[:2]).
+000281c0: 0a20 2020 2020 2020 2069 6620 636f 6d70  .        if comp
+000281d0: 7574 653a 0a20 2020 2020 2020 2020 2020  ute:.           
+000281e0: 2072 6573 756c 7420 3d20 7265 7375 6c74   result = result
+000281f0: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
+00028200: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00028210: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+00028220: 726f 6d28 7064 2e49 6e64 6578 290a 2020  rom(pd.Index).  
+00028230: 2020 6465 6620 6d61 7828 7365 6c66 2c20    def max(self, 
+00028240: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
+00028250: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
+00028260: 726e 2073 656c 662e 7265 6475 6374 696f  rn self.reductio
+00028270: 6e28 0a20 2020 2020 2020 2020 2020 204d  n(.            M
+00028280: 2e6d 6178 2c0a 2020 2020 2020 2020 2020  .max,.          
+00028290: 2020 6d65 7461 3d73 656c 662e 5f6d 6574    meta=self._met
+000282a0: 615f 6e6f 6e65 6d70 7479 2e6d 6178 2829  a_nonempty.max()
+000282b0: 2c0a 2020 2020 2020 2020 2020 2020 746f  ,.            to
+000282c0: 6b65 6e3d 7365 6c66 2e5f 746f 6b65 6e5f  ken=self._token_
+000282d0: 7072 6566 6978 202b 2022 6d61 7822 2c0a  prefix + "max",.
+000282e0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+000282f0: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
+00028300: 6572 792c 0a20 2020 2020 2020 2029 0a0a  ery,.        )..
+00028310: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+00028320: 6d28 7064 2e49 6e64 6578 290a 2020 2020  m(pd.Index).    
+00028330: 6465 6620 6d69 6e28 7365 6c66 2c20 7370  def min(self, sp
+00028340: 6c69 745f 6576 6572 793d 4661 6c73 6529  lit_every=False)
+00028350: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00028360: 2073 656c 662e 7265 6475 6374 696f 6e28   self.reduction(
+00028370: 0a20 2020 2020 2020 2020 2020 204d 2e6d  .            M.m
+00028380: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00028390: 6d65 7461 3d73 656c 662e 5f6d 6574 615f  meta=self._meta_
+000283a0: 6e6f 6e65 6d70 7479 2e6d 696e 2829 2c0a  nonempty.min(),.
+000283b0: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+000283c0: 6e3d 7365 6c66 2e5f 746f 6b65 6e5f 7072  n=self._token_pr
+000283d0: 6566 6978 202b 2022 6d69 6e22 2c0a 2020  efix + "min",.  
+000283e0: 2020 2020 2020 2020 2020 7370 6c69 745f            split_
+000283f0: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
+00028400: 792c 0a20 2020 2020 2020 2029 0a0a 2020  y,.        )..  
+00028410: 2020 6465 6620 636f 756e 7428 7365 6c66    def count(self
+00028420: 2c20 7370 6c69 745f 6576 6572 793d 4661  , split_every=Fa
+00028430: 6c73 6529 3a0a 2020 2020 2020 2020 7265  lse):.        re
+00028440: 7475 726e 2073 656c 662e 7265 6475 6374  turn self.reduct
+00028450: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00028460: 206d 6574 686f 6473 2e69 6e64 6578 5f63   methods.index_c
+00028470: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
+00028480: 2020 6e70 2e73 756d 2c0a 2020 2020 2020    np.sum,.      
+00028490: 2020 2020 2020 746f 6b65 6e3d 2269 6e64        token="ind
+000284a0: 6578 2d63 6f75 6e74 222c 0a20 2020 2020  ex-count",.     
+000284b0: 2020 2020 2020 206d 6574 613d 696e 742c         meta=int,
+000284c0: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
+000284d0: 6974 5f65 7665 7279 3d73 706c 6974 5f65  it_every=split_e
+000284e0: 7665 7279 2c0a 2020 2020 2020 2020 290a  very,.        ).
+000284f0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+00028500: 6f6d 2870 642e 496e 6465 7829 0a20 2020  om(pd.Index).   
+00028510: 2064 6566 2073 6869 6674 2873 656c 662c   def shift(self,
+00028520: 2070 6572 696f 6473 3d31 2c20 6672 6571   periods=1, freq
+00028530: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00028540: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+00028550: 6c66 2e5f 6d65 7461 2c20 7064 2e50 6572  lf._meta, pd.Per
+00028560: 696f 6449 6e64 6578 293a 0a20 2020 2020  iodIndex):.     
+00028570: 2020 2020 2020 2069 6620 6672 6571 2069         if freq i
+00028580: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00028590: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000285a0: 6520 5661 6c75 6545 7272 6f72 2822 5065  e ValueError("Pe
+000285b0: 7269 6f64 496e 6465 7820 646f 6573 6e27  riodIndex doesn'
+000285c0: 7420 6163 6365 7074 2060 6672 6571 6020  t accept `freq` 
+000285d0: 6172 6775 6d65 6e74 2229 0a20 2020 2020  argument").     
+000285e0: 2020 2020 2020 206d 6574 6120 3d20 7365         meta = se
+000285f0: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
+00028600: 792e 7368 6966 7428 7065 7269 6f64 7329  y.shift(periods)
+00028610: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00028620: 203d 2073 656c 662e 6d61 705f 7061 7274   = self.map_part
+00028630: 6974 696f 6e73 280a 2020 2020 2020 2020  itions(.        
+00028640: 2020 2020 2020 2020 4d2e 7368 6966 742c          M.shift,
+00028650: 2070 6572 696f 6473 2c20 6d65 7461 3d6d   periods, meta=m
+00028660: 6574 612c 2074 6f6b 656e 3d22 7368 6966  eta, token="shif
+00028670: 7422 2c20 7472 616e 7366 6f72 6d5f 6469  t", transform_di
+00028680: 7669 7369 6f6e 733d 4661 6c73 650a 2020  visions=False.  
+00028690: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000286a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000286b0: 2020 2020 2020 2320 5061 6e64 6173 2077        # Pandas w
+000286c0: 696c 6c20 7261 6973 6520 666f 7220 6f74  ill raise for ot
+000286d0: 6865 7220 696e 6465 7820 7479 7065 7320  her index types 
+000286e0: 7468 6174 2064 6f6e 2774 2069 6d70 6c65  that don't imple
+000286f0: 6d65 6e74 2073 6869 6674 0a20 2020 2020  ment shift.     
+00028700: 2020 2020 2020 206d 6574 6120 3d20 7365         meta = se
+00028710: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
+00028720: 792e 7368 6966 7428 7065 7269 6f64 732c  y.shift(periods,
+00028730: 2066 7265 713d 6672 6571 290a 2020 2020   freq=freq).    
+00028740: 2020 2020 2020 2020 6f75 7420 3d20 7365          out = se
+00028750: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
+00028760: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
+00028770: 2020 204d 2e73 6869 6674 2c0a 2020 2020     M.shift,.    
+00028780: 2020 2020 2020 2020 2020 2020 7065 7269              peri
+00028790: 6f64 732c 0a20 2020 2020 2020 2020 2020  ods,.           
+000287a0: 2020 2020 2074 6f6b 656e 3d22 7368 6966       token="shif
+000287b0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+000287c0: 2020 2020 6d65 7461 3d6d 6574 612c 0a20      meta=meta,. 
+000287d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000287e0: 7265 713d 6672 6571 2c0a 2020 2020 2020  req=freq,.      
+000287f0: 2020 2020 2020 2020 2020 7472 616e 7366            transf
+00028800: 6f72 6d5f 6469 7669 7369 6f6e 733d 4661  orm_divisions=Fa
+00028810: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00028820: 2029 0a20 2020 2020 2020 2069 6620 6672   ).        if fr
+00028830: 6571 2069 7320 4e6f 6e65 3a0a 2020 2020  eq is None:.    
+00028840: 2020 2020 2020 2020 6672 6571 203d 206d          freq = m
+00028850: 6574 612e 6672 6571 0a20 2020 2020 2020  eta.freq.       
+00028860: 2072 6574 7572 6e20 6d61 7962 655f 7368   return maybe_sh
+00028870: 6966 745f 6469 7669 7369 6f6e 7328 6f75  ift_divisions(ou
+00028880: 742c 2070 6572 696f 6473 2c20 6672 6571  t, periods, freq
+00028890: 3d66 7265 7129 0a0a 2020 2020 4064 6572  =freq)..    @der
+000288a0: 6976 6564 5f66 726f 6d28 7064 2e49 6e64  ived_from(pd.Ind
+000288b0: 6578 290a 2020 2020 6465 6620 746f 5f73  ex).    def to_s
+000288c0: 6572 6965 7328 7365 6c66 293a 0a20 2020  eries(self):.   
+000288d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000288e0: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+000288f0: 0a20 2020 2020 2020 2020 2020 204d 2e74  .            M.t
+00028900: 6f5f 7365 7269 6573 2c0a 2020 2020 2020  o_series,.      
+00028910: 2020 2020 2020 6d65 7461 3d73 656c 662e        meta=self.
+00028920: 5f6d 6574 612e 746f 5f73 6572 6965 7328  _meta.to_series(
+00028930: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
+00028940: 7261 6e73 666f 726d 5f64 6976 6973 696f  ransform_divisio
+00028950: 6e73 3d46 616c 7365 2c0a 2020 2020 2020  ns=False,.      
+00028960: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
+00028970: 645f 6672 6f6d 2870 642e 496e 6465 782c  d_from(pd.Index,
+00028980: 2075 615f 6172 6773 3d5b 2269 6e64 6578   ua_args=["index
+00028990: 225d 290a 2020 2020 6465 6620 746f 5f66  "]).    def to_f
+000289a0: 7261 6d65 2873 656c 662c 2069 6e64 6578  rame(self, index
+000289b0: 3d54 7275 652c 206e 616d 653d 4e6f 6e65  =True, name=None
+000289c0: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
+000289d0: 7420 696e 6465 783a 0a20 2020 2020 2020  t index:.       
+000289e0: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+000289f0: 706c 656d 656e 7465 6445 7272 6f72 2829  plementedError()
+00028a00: 0a20 2020 2020 2020 2061 7267 7320 3d20  .        args = 
+00028a10: 5b69 6e64 6578 5d20 6966 206e 616d 6520  [index] if name 
+00028a20: 6973 204e 6f6e 6520 656c 7365 205b 696e  is None else [in
+00028a30: 6465 782c 206e 616d 655d 0a0a 2020 2020  dex, name]..    
+00028a40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00028a50: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
+00028a60: 2020 2020 2020 2020 2020 2020 4d2e 746f              M.to
+00028a70: 5f66 7261 6d65 2c0a 2020 2020 2020 2020  _frame,.        
+00028a80: 2020 2020 2a61 7267 732c 0a20 2020 2020      *args,.     
+00028a90: 2020 2020 2020 206d 6574 613d 7365 6c66         meta=self
+00028aa0: 2e5f 6d65 7461 2e74 6f5f 6672 616d 6528  ._meta.to_frame(
+00028ab0: 2a61 7267 7329 2c0a 2020 2020 2020 2020  *args),.        
+00028ac0: 2020 2020 7472 616e 7366 6f72 6d5f 6469      transform_di
+00028ad0: 7669 7369 6f6e 733d 4661 6c73 652c 0a20  visions=False,. 
+00028ae0: 2020 2020 2020 2029 0a0a 2020 2020 4069         )..    @i
+00028af0: 6e73 6572 745f 6d65 7461 5f70 6172 616d  nsert_meta_param
+00028b00: 5f64 6573 6372 6970 7469 6f6e 2870 6164  _description(pad
+00028b10: 3d31 3229 0a20 2020 2040 6465 7269 7665  =12).    @derive
+00028b20: 645f 6672 6f6d 2870 642e 496e 6465 7829  d_from(pd.Index)
+00028b30: 0a20 2020 2064 6566 206d 6170 2873 656c  .    def map(sel
+00028b40: 662c 2061 7267 2c20 6e61 5f61 6374 696f  f, arg, na_actio
+00028b50: 6e3d 4e6f 6e65 2c20 6d65 7461 3d6e 6f5f  n=None, meta=no_
+00028b60: 6465 6661 756c 742c 2069 735f 6d6f 6e6f  default, is_mono
+00028b70: 746f 6e69 633d 4661 6c73 6529 3a0a 2020  tonic=False):.  
+00028b80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00028b90: 2020 4e6f 7465 2074 6861 7420 7468 6973    Note that this
+00028ba0: 206d 6574 686f 6420 636c 6561 7273 2061   method clears a
+00028bb0: 6e79 206b 6e6f 776e 2064 6976 6973 696f  ny known divisio
+00028bc0: 6e73 2e0a 0a20 2020 2020 2020 2049 6620  ns...        If 
+00028bd0: 796f 7572 206d 6170 7069 6e67 2066 756e  your mapping fun
+00028be0: 6374 696f 6e20 6973 206d 6f6e 6f74 6f6e  ction is monoton
+00028bf0: 6963 616c 6c79 2069 6e63 7265 6173 696e  ically increasin
+00028c00: 6720 7468 656e 2075 7365 2060 6973 5f6d  g then use `is_m
+00028c10: 6f6e 6f74 6f6e 6963 600a 2020 2020 2020  onotonic`.      
+00028c20: 2020 746f 2061 7070 6c79 2074 6865 206d    to apply the m
+00028c30: 6170 696e 6720 6675 6e63 7469 6f6e 2074  aping function t
+00028c40: 6f20 7468 6520 6f6c 6420 6469 7669 7369  o the old divisi
+00028c50: 6f6e 7320 616e 6420 6173 7369 676e 2074  ons and assign t
+00028c60: 6865 206e 6577 0a20 2020 2020 2020 2064  he new.        d
+00028c70: 6976 6973 696f 6e73 2074 6f20 7468 6520  ivisions to the 
+00028c80: 6f75 7470 7574 2e0a 0a20 2020 2020 2020  output...       
+00028c90: 2022 2222 0a20 2020 2020 2020 2061 7070   """.        app
+00028ca0: 6c69 6564 203d 2073 7570 6572 2829 2e6d  lied = super().m
+00028cb0: 6170 2861 7267 2c20 6e61 5f61 6374 696f  ap(arg, na_actio
+00028cc0: 6e3d 6e61 5f61 6374 696f 6e2c 206d 6574  n=na_action, met
+00028cd0: 613d 6d65 7461 290a 2020 2020 2020 2020  a=meta).        
+00028ce0: 6966 2069 735f 6d6f 6e6f 746f 6e69 6320  if is_monotonic 
+00028cf0: 616e 6420 7365 6c66 2e6b 6e6f 776e 5f64  and self.known_d
+00028d00: 6976 6973 696f 6e73 3a0a 2020 2020 2020  ivisions:.      
+00028d10: 2020 2020 2020 6170 706c 6965 642e 6469        applied.di
+00028d20: 7669 7369 6f6e 7320 3d20 7475 706c 6528  visions = tuple(
+00028d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028d40: 2070 642e 5365 7269 6573 2873 656c 662e   pd.Series(self.
+00028d50: 6469 7669 7369 6f6e 7329 2e6d 6170 2861  divisions).map(a
+00028d60: 7267 2c20 6e61 5f61 6374 696f 6e3d 6e61  rg, na_action=na
+00028d70: 5f61 6374 696f 6e29 0a20 2020 2020 2020  _action).       
+00028d80: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00028d90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00028da0: 2061 7070 6c69 6564 203d 2061 7070 6c69   applied = appli
+00028db0: 6564 2e63 6c65 6172 5f64 6976 6973 696f  ed.clear_divisio
+00028dc0: 6e73 2829 0a20 2020 2020 2020 2072 6574  ns().        ret
+00028dd0: 7572 6e20 6170 706c 6965 640a 0a20 2020  urn applied..   
+00028de0: 2069 6620 6e6f 7420 5041 4e44 4153 5f47   if not PANDAS_G
+00028df0: 545f 3230 303a 0a0a 2020 2020 2020 2020  T_200:..        
+00028e00: 4070 726f 7065 7274 790a 2020 2020 2020  @property.      
+00028e10: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
+00028e20: 7064 2e49 6e64 6578 290a 2020 2020 2020  pd.Index).      
+00028e30: 2020 6465 6620 6973 5f6d 6f6e 6f74 6f6e    def is_monoton
+00028e40: 6963 2873 656c 6629 3a0a 2020 2020 2020  ic(self):.      
+00028e50: 2020 2020 2020 6966 2050 414e 4441 535f        if PANDAS_
+00028e60: 4754 5f31 3530 3a0a 2020 2020 2020 2020  GT_150:.        
+00028e70: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00028e80: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+00028e90: 2020 2020 2020 2020 2020 2022 6973 5f6d             "is_m
+00028ea0: 6f6e 6f74 6f6e 6963 2069 7320 6465 7072  onotonic is depr
+00028eb0: 6563 6174 6564 2061 6e64 2077 696c 6c20  ecated and will 
+00028ec0: 6265 2072 656d 6f76 6564 2069 6e20 6120  be removed in a 
+00028ed0: 6675 7475 7265 2076 6572 7369 6f6e 2e20  future version. 
+00028ee0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00028ef0: 2020 2020 2020 2255 7365 2069 735f 6d6f        "Use is_mo
+00028f00: 6e6f 746f 6e69 635f 696e 6372 6561 7369  notonic_increasi
+00028f10: 6e67 2069 6e73 7465 6164 2e22 2c0a 2020  ng instead.",.  
+00028f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f30: 2020 4675 7475 7265 5761 726e 696e 672c    FutureWarning,
+00028f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028f50: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+00028f60: 6574 7572 6e20 7375 7065 7228 292e 6973  eturn super().is
+00028f70: 5f6d 6f6e 6f74 6f6e 6963 5f69 6e63 7265  _monotonic_incre
+00028f80: 6173 696e 670a 0a20 2020 2040 7072 6f70  asing..    @prop
+00028f90: 6572 7479 0a20 2020 2040 6465 7269 7665  erty.    @derive
+00028fa0: 645f 6672 6f6d 2870 642e 496e 6465 7829  d_from(pd.Index)
+00028fb0: 0a20 2020 2064 6566 2069 735f 6d6f 6e6f  .    def is_mono
+00028fc0: 746f 6e69 635f 696e 6372 6561 7369 6e67  tonic_increasing
+00028fd0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00028fe0: 7265 7475 726e 2073 7570 6572 2829 2e69  return super().i
+00028ff0: 735f 6d6f 6e6f 746f 6e69 635f 696e 6372  s_monotonic_incr
+00029000: 6561 7369 6e67 0a0a 2020 2020 4070 726f  easing..    @pro
+00029010: 7065 7274 790a 2020 2020 4064 6572 6976  perty.    @deriv
+00029020: 6564 5f66 726f 6d28 7064 2e49 6e64 6578  ed_from(pd.Index
+00029030: 290a 2020 2020 6465 6620 6973 5f6d 6f6e  ).    def is_mon
+00029040: 6f74 6f6e 6963 5f64 6563 7265 6173 696e  otonic_decreasin
+00029050: 6728 7365 6c66 293a 0a20 2020 2020 2020  g(self):.       
+00029060: 2072 6574 7572 6e20 7375 7065 7228 292e   return super().
+00029070: 6973 5f6d 6f6e 6f74 6f6e 6963 5f64 6563  is_monotonic_dec
+00029080: 7265 6173 696e 670a 0a20 2020 2040 6465  reasing..    @de
+00029090: 7269 7665 645f 6672 6f6d 2870 642e 496e  rived_from(pd.In
+000290a0: 6465 7829 0a20 2020 2064 6566 206d 656d  dex).    def mem
+000290b0: 6f72 795f 7573 6167 6528 7365 6c66 2c20  ory_usage(self, 
+000290c0: 6465 6570 3d46 616c 7365 293a 0a20 2020  deep=False):.   
+000290d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000290e0: 2e72 6564 7563 7469 6f6e 280a 2020 2020  .reduction(.    
+000290f0: 2020 2020 2020 2020 4d2e 6d65 6d6f 7279          M.memory
+00029100: 5f75 7361 6765 2c0a 2020 2020 2020 2020  _usage,.        
+00029110: 2020 2020 4d2e 7375 6d2c 0a20 2020 2020      M.sum,.     
+00029120: 2020 2020 2020 2063 6875 6e6b 5f6b 7761         chunk_kwa
+00029130: 7267 733d 7b22 6465 6570 223a 2064 6565  rgs={"deep": dee
+00029140: 707d 2c0a 2020 2020 2020 2020 2020 2020  p},.            
+00029150: 7370 6c69 745f 6576 6572 793d 4661 6c73  split_every=Fals
+00029160: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
+00029170: 6f6b 656e 3d73 656c 662e 5f74 6f6b 656e  oken=self._token
+00029180: 5f70 7265 6669 7820 2b20 226d 656d 6f72  _prefix + "memor
+00029190: 792d 7573 6167 6522 2c0a 2020 2020 2020  y-usage",.      
+000291a0: 2020 290a 0a0a 636c 6173 7320 4461 7461    )...class Data
+000291b0: 4672 616d 6528 5f46 7261 6d65 293a 0a20  Frame(_Frame):. 
+000291c0: 2020 2022 2222 0a20 2020 2050 6172 616c     """.    Paral
+000291d0: 6c65 6c20 5061 6e64 6173 2044 6174 6146  lel Pandas DataF
+000291e0: 7261 6d65 0a0a 2020 2020 446f 206e 6f74  rame..    Do not
+000291f0: 2075 7365 2074 6869 7320 636c 6173 7320   use this class 
+00029200: 6469 7265 6374 6c79 2e20 2049 6e73 7465  directly.  Inste
+00029210: 6164 2075 7365 2066 756e 6374 696f 6e73  ad use functions
+00029220: 206c 696b 650a 2020 2020 6060 6464 2e72   like.    ``dd.r
+00029230: 6561 645f 6373 7660 602c 2060 6064 642e  ead_csv``, ``dd.
+00029240: 7265 6164 5f70 6172 7175 6574 6060 2c20  read_parquet``, 
+00029250: 6f72 2060 6064 642e 6672 6f6d 5f70 616e  or ``dd.from_pan
+00029260: 6461 7360 602e 0a0a 2020 2020 5061 7261  das``...    Para
+00029270: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00029280: 2d2d 2d2d 2d0a 2020 2020 6473 6b3a 2064  -----.    dsk: d
+00029290: 6963 740a 2020 2020 2020 2020 5468 6520  ict.        The 
+000292a0: 6461 736b 2067 7261 7068 2074 6f20 636f  dask graph to co
+000292b0: 6d70 7574 6520 7468 6973 2044 6174 6146  mpute this DataF
+000292c0: 7261 6d65 0a20 2020 206e 616d 653a 2073  rame.    name: s
+000292d0: 7472 0a20 2020 2020 2020 2054 6865 206b  tr.        The k
+000292e0: 6579 2070 7265 6669 7820 7468 6174 2073  ey prefix that s
+000292f0: 7065 6369 6669 6573 2077 6869 6368 206b  pecifies which k
+00029300: 6579 7320 696e 2074 6865 2064 6173 6b20  eys in the dask 
+00029310: 636f 6d70 7269 7365 2074 6869 730a 2020  comprise this.  
+00029320: 2020 2020 2020 7061 7274 6963 756c 6172        particular
+00029330: 2044 6174 6146 7261 6d65 0a20 2020 206d   DataFrame.    m
+00029340: 6574 613a 2070 616e 6461 732e 4461 7461  eta: pandas.Data
+00029350: 4672 616d 650a 2020 2020 2020 2020 416e  Frame.        An
+00029360: 2065 6d70 7479 2060 6070 616e 6461 732e   empty ``pandas.
+00029370: 4461 7461 4672 616d 6560 6020 7769 7468  DataFrame`` with
+00029380: 206e 616d 6573 2c20 6474 7970 6573 2c20   names, dtypes, 
+00029390: 616e 6420 696e 6465 7820 6d61 7463 6869  and index matchi
+000293a0: 6e67 0a20 2020 2020 2020 2074 6865 2065  ng.        the e
+000293b0: 7870 6563 7465 6420 6f75 7470 7574 2e0a  xpected output..
+000293c0: 2020 2020 6469 7669 7369 6f6e 733a 2074      divisions: t
+000293d0: 7570 6c65 206f 6620 696e 6465 7820 7661  uple of index va
+000293e0: 6c75 6573 0a20 2020 2020 2020 2056 616c  lues.        Val
+000293f0: 7565 7320 616c 6f6e 6720 7768 6963 6820  ues along which 
+00029400: 7765 2070 6172 7469 7469 6f6e 206f 7572  we partition our
+00029410: 2062 6c6f 636b 7320 6f6e 2074 6865 2069   blocks on the i
+00029420: 6e64 6578 0a20 2020 2022 2222 0a0a 2020  ndex.    """..  
+00029430: 2020 5f70 6172 7469 7469 6f6e 5f74 7970    _partition_typ
+00029440: 6520 3d20 7064 2e44 6174 6146 7261 6d65  e = pd.DataFrame
+00029450: 0a20 2020 205f 6973 5f70 6172 7469 7469  .    _is_partiti
+00029460: 6f6e 5f74 7970 6520 3d20 7374 6174 6963  on_type = static
+00029470: 6d65 7468 6f64 2869 735f 6461 7461 6672  method(is_datafr
+00029480: 616d 655f 6c69 6b65 290a 2020 2020 5f74  ame_like).    _t
+00029490: 6f6b 656e 5f70 7265 6669 7820 3d20 2264  oken_prefix = "d
+000294a0: 6174 6166 7261 6d65 2d22 0a20 2020 205f  ataframe-".    _
+000294b0: 6163 6365 7373 6f72 733a 2043 6c61 7373  accessors: Class
+000294c0: 5661 725b 7365 745b 7374 725d 5d20 3d20  Var[set[str]] = 
+000294d0: 7365 7428 290a 0a20 2020 2064 6566 205f  set()..    def _
+000294e0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6473  _init__(self, ds
+000294f0: 6b2c 206e 616d 652c 206d 6574 612c 2064  k, name, meta, d
+00029500: 6976 6973 696f 6e73 293a 0a20 2020 2020  ivisions):.     
+00029510: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+00029520: 745f 5f28 6473 6b2c 206e 616d 652c 206d  t__(dsk, name, m
+00029530: 6574 612c 2064 6976 6973 696f 6e73 290a  eta, divisions).
+00029540: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00029550: 6461 736b 2e6c 6179 6572 735b 6e61 6d65  dask.layers[name
+00029560: 5d2e 636f 6c6c 6563 7469 6f6e 5f61 6e6e  ].collection_ann
+00029570: 6f74 6174 696f 6e73 2069 7320 4e6f 6e65  otations is None
+00029580: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00029590: 6c66 2e64 6173 6b2e 6c61 7965 7273 5b6e  lf.dask.layers[n
+000295a0: 616d 655d 2e63 6f6c 6c65 6374 696f 6e5f  ame].collection_
+000295b0: 616e 6e6f 7461 7469 6f6e 7320 3d20 7b0a  annotations = {.
+000295c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000295d0: 226e 7061 7274 6974 696f 6e73 223a 2073  "npartitions": s
+000295e0: 656c 662e 6e70 6172 7469 7469 6f6e 732c  elf.npartitions,
+000295f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029600: 2022 636f 6c75 6d6e 7322 3a20 5b63 6f6c   "columns": [col
+00029610: 2066 6f72 2063 6f6c 2069 6e20 7365 6c66   for col in self
+00029620: 2e63 6f6c 756d 6e73 5d2c 0a20 2020 2020  .columns],.     
+00029630: 2020 2020 2020 2020 2020 2022 7479 7065             "type
+00029640: 223a 2074 7970 656e 616d 6528 7479 7065  ": typename(type
+00029650: 2873 656c 6629 292c 0a20 2020 2020 2020  (self)),.       
+00029660: 2020 2020 2020 2020 2022 6461 7461 6672           "datafr
+00029670: 616d 655f 7479 7065 223a 2074 7970 656e  ame_type": typen
+00029680: 616d 6528 7479 7065 2873 656c 662e 5f6d  ame(type(self._m
+00029690: 6574 6129 292c 0a20 2020 2020 2020 2020  eta)),.         
+000296a0: 2020 2020 2020 2022 7365 7269 6573 5f64         "series_d
+000296b0: 7479 7065 7322 3a20 7b0a 2020 2020 2020  types": {.      
+000296c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000296d0: 6c3a 2073 656c 662e 5f6d 6574 615b 636f  l: self._meta[co
+000296e0: 6c5d 2e64 7479 7065 0a20 2020 2020 2020  l].dtype.       
+000296f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00029700: 6861 7361 7474 7228 7365 6c66 2e5f 6d65  hasattr(self._me
+00029710: 7461 5b63 6f6c 5d2c 2022 6474 7970 6522  ta[col], "dtype"
+00029720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00029730: 2020 2020 2020 656c 7365 204e 6f6e 650a        else None.
+00029740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029750: 2020 2020 666f 7220 636f 6c20 696e 2073      for col in s
+00029760: 656c 662e 5f6d 6574 612e 636f 6c75 6d6e  elf._meta.column
+00029770: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00029780: 2020 7d2c 0a20 2020 2020 2020 2020 2020    },.           
+00029790: 207d 0a20 2020 2020 2020 2065 6c73 653a   }.        else:
+000297a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000297b0: 662e 6461 736b 2e6c 6179 6572 735b 6e61  f.dask.layers[na
+000297c0: 6d65 5d2e 636f 6c6c 6563 7469 6f6e 5f61  me].collection_a
+000297d0: 6e6e 6f74 6174 696f 6e73 2e75 7064 6174  nnotations.updat
+000297e0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000297f0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00029800: 2020 2020 2020 2020 2022 6e70 6172 7469           "nparti
+00029810: 7469 6f6e 7322 3a20 7365 6c66 2e6e 7061  tions": self.npa
+00029820: 7274 6974 696f 6e73 2c0a 2020 2020 2020  rtitions,.      
+00029830: 2020 2020 2020 2020 2020 2020 2020 2263                "c
+00029840: 6f6c 756d 6e73 223a 205b 636f 6c20 666f  olumns": [col fo
+00029850: 7220 636f 6c20 696e 2073 656c 662e 636f  r col in self.co
+00029860: 6c75 6d6e 735d 2c0a 2020 2020 2020 2020  lumns],.        
+00029870: 2020 2020 2020 2020 2020 2020 2274 7970              "typ
+00029880: 6522 3a20 7479 7065 6e61 6d65 2874 7970  e": typename(typ
+00029890: 6528 7365 6c66 2929 2c0a 2020 2020 2020  e(self)),.      
+000298a0: 2020 2020 2020 2020 2020 2020 2020 2264                "d
+000298b0: 6174 6166 7261 6d65 5f74 7970 6522 3a20  ataframe_type": 
+000298c0: 7479 7065 6e61 6d65 2874 7970 6528 7365  typename(type(se
+000298d0: 6c66 2e5f 6d65 7461 2929 2c0a 2020 2020  lf._meta)),.    
 000298e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000298f0: 6966 2068 6173 6174 7472 2873 656c 662e  if hasattr(self.
-00029900: 5f6d 6574 615b 636f 6c5d 2c20 2264 7479  _meta[col], "dty
-00029910: 7065 2229 0a20 2020 2020 2020 2020 2020  pe").           
-00029920: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00029930: 6520 4e6f 6e65 0a20 2020 2020 2020 2020  e None.         
-00029940: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00029950: 6f72 2063 6f6c 2069 6e20 7365 6c66 2e5f  or col in self._
-00029960: 6d65 7461 2e63 6f6c 756d 6e73 0a20 2020  meta.columns.   
-00029970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029980: 207d 2c0a 2020 2020 2020 2020 2020 2020   },.            
-00029990: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
-000299a0: 2020 290a 0a20 2020 2064 6566 205f 5f61    )..    def __a
-000299b0: 7272 6179 5f77 7261 705f 5f28 7365 6c66  rray_wrap__(self
-000299c0: 2c20 6172 7261 792c 2063 6f6e 7465 7874  , array, context
-000299d0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000299e0: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
-000299f0: 6e74 6578 742c 2074 7570 6c65 2920 616e  ntext, tuple) an
-00029a00: 6420 6c65 6e28 636f 6e74 6578 7429 203e  d len(context) >
-00029a10: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00029a20: 6966 2069 7369 6e73 7461 6e63 6528 636f  if isinstance(co
-00029a30: 6e74 6578 745b 315d 5b30 5d2c 206e 702e  ntext[1][0], np.
-00029a40: 6e64 6172 7261 7929 2061 6e64 2063 6f6e  ndarray) and con
-00029a50: 7465 7874 5b31 5d5b 305d 2e73 6861 7065  text[1][0].shape
-00029a60: 203d 3d20 2829 3a0a 2020 2020 2020 2020   == ():.        
-00029a70: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-00029a80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00029a90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00029aa0: 2020 2020 2020 2069 6e64 6578 203d 2063         index = c
-00029ab0: 6f6e 7465 7874 5b31 5d5b 305d 2e69 6e64  ontext[1][0].ind
-00029ac0: 6578 0a20 2020 2020 2020 2065 6c73 653a  ex.        else:
-00029ad0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00029ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029af0: 2020 696d 706f 7274 2069 6e73 7065 6374    import inspect
-00029b00: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029b10: 2020 6d65 7468 6f64 5f6e 616d 6520 3d20    method_name = 
-00029b20: 6622 607b 696e 7370 6563 742e 7374 6163  f"`{inspect.stac
-00029b30: 6b28 295b 335d 5b33 5d7d 6022 0a20 2020  k()[3][3]}`".   
-00029b40: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00029b50: 496e 6465 7845 7272 6f72 3a0a 2020 2020  IndexError:.    
-00029b60: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00029b70: 6f64 5f6e 616d 6520 3d20 2254 6869 7320  od_name = "This 
-00029b80: 6d65 7468 6f64 220a 0a20 2020 2020 2020  method"..       
-00029b90: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-00029ba0: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
-00029bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029bc0: 6622 7b6d 6574 686f 645f 6e61 6d65 7d20  f"{method_name} 
-00029bd0: 6973 206e 6f74 2069 6d70 6c65 6d65 6e74  is not implement
-00029be0: 6564 2066 6f72 2060 6461 736b 2e64 6174  ed for `dask.dat
-00029bf0: 6166 7261 6d65 2e44 6174 6146 7261 6d65  aframe.DataFrame
-00029c00: 602e 220a 2020 2020 2020 2020 2020 2020  `.".            
-00029c10: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00029c20: 6e20 6d65 7461 5f66 7261 6d65 5f63 6f6e  n meta_frame_con
-00029c30: 7374 7275 6374 6f72 2873 656c 6629 2861  structor(self)(a
-00029c40: 7272 6179 2c20 696e 6465 783d 696e 6465  rray, index=inde
-00029c50: 782c 2063 6f6c 756d 6e73 3d73 656c 662e  x, columns=self.
-00029c60: 636f 6c75 6d6e 7329 0a0a 2020 2020 4070  columns)..    @p
-00029c70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00029c80: 6178 6573 2873 656c 6629 3a0a 2020 2020  axes(self):.    
-00029c90: 2020 2020 7265 7475 726e 205b 7365 6c66      return [self
-00029ca0: 2e69 6e64 6578 2c20 7365 6c66 2e63 6f6c  .index, self.col
-00029cb0: 756d 6e73 5d0a 0a20 2020 2040 7072 6f70  umns]..    @prop
-00029cc0: 6572 7479 0a20 2020 2064 6566 2063 6f6c  erty.    def col
-00029cd0: 756d 6e73 2873 656c 6629 3a0a 2020 2020  umns(self):.    
-00029ce0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00029cf0: 5f6d 6574 612e 636f 6c75 6d6e 730a 0a20  _meta.columns.. 
-00029d00: 2020 2040 636f 6c75 6d6e 732e 7365 7474     @columns.sett
-00029d10: 6572 0a20 2020 2064 6566 2063 6f6c 756d  er.    def colum
-00029d20: 6e73 2873 656c 662c 2063 6f6c 756d 6e73  ns(self, columns
-00029d30: 293a 0a20 2020 2020 2020 2072 656e 616d  ):.        renam
-00029d40: 6564 203d 205f 7265 6e61 6d65 5f64 6173  ed = _rename_das
-00029d50: 6b28 7365 6c66 2c20 636f 6c75 6d6e 7329  k(self, columns)
-00029d60: 0a20 2020 2020 2020 2073 656c 662e 5f6d  .        self._m
-00029d70: 6574 6120 3d20 7265 6e61 6d65 642e 5f6d  eta = renamed._m
-00029d80: 6574 610a 2020 2020 2020 2020 7365 6c66  eta.        self
-00029d90: 2e5f 6e61 6d65 203d 2072 656e 616d 6564  ._name = renamed
-00029da0: 2e5f 6e61 6d65 0a20 2020 2020 2020 2073  ._name.        s
-00029db0: 656c 662e 6461 736b 203d 2072 656e 616d  elf.dask = renam
-00029dc0: 6564 2e64 6173 6b0a 0a20 2020 2040 7072  ed.dask..    @pr
-00029dd0: 6f70 6572 7479 0a20 2020 2064 6566 2069  operty.    def i
-00029de0: 6c6f 6328 7365 6c66 293a 0a20 2020 2020  loc(self):.     
-00029df0: 2020 2022 2222 5075 7265 6c79 2069 6e74     """Purely int
-00029e00: 6567 6572 2d6c 6f63 6174 696f 6e20 6261  eger-location ba
-00029e10: 7365 6420 696e 6465 7869 6e67 2066 6f72  sed indexing for
-00029e20: 2073 656c 6563 7469 6f6e 2062 7920 706f   selection by po
-00029e30: 7369 7469 6f6e 2e0a 0a20 2020 2020 2020  sition...       
-00029e40: 204f 6e6c 7920 696e 6465 7869 6e67 2074   Only indexing t
-00029e50: 6865 2063 6f6c 756d 6e20 706f 7369 7469  he column positi
-00029e60: 6f6e 7320 6973 2073 7570 706f 7274 6564  ons is supported
-00029e70: 2e20 5472 7969 6e67 2074 6f20 7365 6c65  . Trying to sele
-00029e80: 6374 0a20 2020 2020 2020 2072 6f77 2070  ct.        row p
-00029e90: 6f73 6974 696f 6e73 2077 696c 6c20 7261  ositions will ra
-00029ea0: 6973 6520 6120 5661 6c75 6545 7272 6f72  ise a ValueError
-00029eb0: 2e0a 0a20 2020 2020 2020 2053 6565 203a  ...        See :
-00029ec0: 7265 663a 6064 6174 6166 7261 6d65 2e69  ref:`dataframe.i
-00029ed0: 6e64 6578 696e 6760 2066 6f72 206d 6f72  ndexing` for mor
-00029ee0: 652e 0a0a 2020 2020 2020 2020 4578 616d  e...        Exam
-00029ef0: 706c 6573 0a20 2020 2020 2020 202d 2d2d  ples.        ---
-00029f00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3e3e  -----.        >>
-00029f10: 3e20 6466 2e69 6c6f 635b 3a2c 205b 322c  > df.iloc[:, [2,
-00029f20: 2030 2c20 315d 5d20 2023 2064 6f63 7465   0, 1]]  # docte
-00029f30: 7374 3a20 2b53 4b49 500a 2020 2020 2020  st: +SKIP.      
-00029f40: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00029f50: 6f6d 2064 6173 6b2e 6461 7461 6672 616d  om dask.datafram
-00029f60: 652e 696e 6465 7869 6e67 2069 6d70 6f72  e.indexing impor
-00029f70: 7420 5f69 4c6f 6349 6e64 6578 6572 0a0a  t _iLocIndexer..
-00029f80: 2020 2020 2020 2020 2320 466f 7220 6461          # For da
-00029f90: 7461 6672 616d 6573 2077 6974 6820 756e  taframes with un
-00029fa0: 6971 7565 2063 6f6c 756d 6e20 6e61 6d65  ique column name
-00029fb0: 732c 2074 6869 7320 7769 6c6c 2062 6520  s, this will be 
-00029fc0: 7472 616e 7366 6f72 6d65 6420 696e 746f  transformed into
-00029fd0: 2061 205f 5f67 6574 6974 656d 5f5f 2063   a __getitem__ c
-00029fe0: 616c 6c0a 2020 2020 2020 2020 7265 7475  all.        retu
-00029ff0: 726e 205f 694c 6f63 496e 6465 7865 7228  rn _iLocIndexer(
-0002a000: 7365 6c66 290a 0a20 2020 2064 6566 205f  self)..    def _
-0002a010: 5f6c 656e 5f5f 2873 656c 6629 3a0a 2020  _len__(self):.  
-0002a020: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0002a030: 2020 2020 2020 2073 203d 2073 656c 662e         s = self.
-0002a040: 696c 6f63 5b3a 2c20 305d 0a20 2020 2020  iloc[:, 0].     
-0002a050: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
-0002a060: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0002a070: 2020 7265 7475 726e 2073 7570 6572 2829    return super()
-0002a080: 2e5f 5f6c 656e 5f5f 2829 0a20 2020 2020  .__len__().     
-0002a090: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002a0a0: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
-0002a0b0: 7329 0a0a 2020 2020 6465 6620 5f5f 636f  s)..    def __co
-0002a0c0: 6e74 6169 6e73 5f5f 2873 656c 662c 206b  ntains__(self, k
-0002a0d0: 6579 293a 0a20 2020 2020 2020 2072 6574  ey):.        ret
-0002a0e0: 7572 6e20 6b65 7920 696e 2073 656c 662e  urn key in self.
-0002a0f0: 5f6d 6574 610a 0a20 2020 2040 7072 6f70  _meta..    @prop
-0002a100: 6572 7479 0a20 2020 2064 6566 2065 6d70  erty.    def emp
-0002a110: 7479 2873 656c 6629 3a0a 2020 2020 2020  ty(self):.      
-0002a120: 2020 2320 5f5f 6765 7461 7474 725f 5f20    # __getattr__ 
-0002a130: 7769 6c6c 2062 6520 6361 6c6c 6564 2061  will be called a
-0002a140: 6674 6572 2077 6520 7261 6973 6520 7468  fter we raise th
-0002a150: 6973 2c20 736f 2077 6527 6c6c 2072 6169  is, so we'll rai
-0002a160: 7365 2069 7420 6167 6169 6e20 6672 6f6d  se it again from
-0002a170: 2074 6865 7265 0a20 2020 2020 2020 2072   there.        r
-0002a180: 6169 7365 2041 7474 7269 6275 7465 4e6f  aise AttributeNo
-0002a190: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
-0002a1a0: 7228 0a20 2020 2020 2020 2020 2020 2022  r(.            "
-0002a1b0: 4368 6563 6b69 6e67 2077 6865 7468 6572  Checking whether
-0002a1c0: 2061 2044 6173 6b20 4461 7461 4672 616d   a Dask DataFram
-0002a1d0: 6520 6861 7320 616e 7920 726f 7773 206d  e has any rows m
-0002a1e0: 6179 2062 6520 6578 7065 6e73 6976 652e  ay be expensive.
-0002a1f0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0002a200: 486f 7765 7665 722c 2063 6865 636b 696e  However, checkin
-0002a210: 6720 7468 6520 6e75 6d62 6572 206f 6620  g the number of 
-0002a220: 636f 6c75 6d6e 7320 6973 2066 6173 742e  columns is fast.
-0002a230: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-0002a240: 4465 7065 6e64 696e 6720 6f6e 2077 6869  Depending on whi
-0002a250: 6368 206f 6620 7468 6573 6520 7265 7375  ch of these resu
-0002a260: 6c74 7320 796f 7520 6e65 6564 2c20 7573  lts you need, us
-0002a270: 6520 6569 7468 6572 2022 0a20 2020 2020  e either ".     
-0002a280: 2020 2020 2020 2022 606c 656e 2864 662e         "`len(df.
-0002a290: 696e 6465 7829 203d 3d20 3060 206f 7220  index) == 0` or 
-0002a2a0: 606c 656e 2864 662e 636f 6c75 6d6e 7329  `len(df.columns)
-0002a2b0: 203d 3d20 3060 220a 2020 2020 2020 2020   == 0`".        
-0002a2c0: 290a 0a20 2020 2064 6566 205f 5f67 6574  )..    def __get
-0002a2d0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-0002a2e0: 293a 0a20 2020 2020 2020 206e 616d 6520  ):.        name 
-0002a2f0: 3d20 2267 6574 6974 656d 2d25 7322 2025  = "getitem-%s" %
-0002a300: 2074 6f6b 656e 697a 6528 7365 6c66 2c20   tokenize(self, 
-0002a310: 6b65 7929 0a20 2020 2020 2020 2069 6620  key).        if 
-0002a320: 6e70 2e69 7373 6361 6c61 7228 6b65 7929  np.isscalar(key)
-0002a330: 206f 7220 6973 696e 7374 616e 6365 286b   or isinstance(k
-0002a340: 6579 2c20 2874 7570 6c65 2c20 7374 7229  ey, (tuple, str)
-0002a350: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0002a360: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-0002a370: 662e 5f6d 6574 612e 696e 6465 782c 2028  f._meta.index, (
-0002a380: 7064 2e44 6174 6574 696d 6549 6e64 6578  pd.DatetimeIndex
-0002a390: 2c20 7064 2e50 6572 696f 6449 6e64 6578  , pd.PeriodIndex
-0002a3a0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0002a3b0: 2020 2020 6966 206b 6579 206e 6f74 2069      if key not i
-0002a3c0: 6e20 7365 6c66 2e5f 6d65 7461 2e63 6f6c  n self._meta.col
-0002a3d0: 756d 6e73 3a0a 2020 2020 2020 2020 2020  umns:.          
-0002a3e0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0002a3f0: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0002a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a410: 2022 496e 6465 7869 6e67 2061 2044 6174   "Indexing a Dat
-0002a420: 6146 7261 6d65 2077 6974 6820 6120 6461  aFrame with a da
-0002a430: 7465 7469 6d65 6c69 6b65 2069 6e64 6578  tetimelike index
-0002a440: 2075 7369 6e67 2061 2073 696e 676c 6520   using a single 
-0002a450: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002a460: 2020 2020 2020 2020 2020 2273 7472 696e            "strin
-0002a470: 6720 746f 2073 6c69 6365 2074 6865 2072  g to slice the r
-0002a480: 6f77 732c 206c 696b 6520 6066 7261 6d65  ows, like `frame
-0002a490: 5b73 7472 696e 675d 602c 2069 7320 6465  [string]`, is de
-0002a4a0: 7072 6563 6174 6564 2022 0a20 2020 2020  precated ".     
+000298f0: 2273 6572 6965 735f 6474 7970 6573 223a  "series_dtypes":
+00029900: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00029910: 2020 2020 2020 2020 2020 2063 6f6c 3a20             col: 
+00029920: 7365 6c66 2e5f 6d65 7461 5b63 6f6c 5d2e  self._meta[col].
+00029930: 6474 7970 650a 2020 2020 2020 2020 2020  dtype.          
+00029940: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00029950: 2068 6173 6174 7472 2873 656c 662e 5f6d   hasattr(self._m
+00029960: 6574 615b 636f 6c5d 2c20 2264 7479 7065  eta[col], "dtype
+00029970: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00029980: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00029990: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000299a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000299b0: 2063 6f6c 2069 6e20 7365 6c66 2e5f 6d65   col in self._me
+000299c0: 7461 2e63 6f6c 756d 6e73 0a20 2020 2020  ta.columns.     
+000299d0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+000299e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000299f0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00029a00: 290a 0a20 2020 2064 6566 205f 5f61 7272  )..    def __arr
+00029a10: 6179 5f77 7261 705f 5f28 7365 6c66 2c20  ay_wrap__(self, 
+00029a20: 6172 7261 792c 2063 6f6e 7465 7874 3d4e  array, context=N
+00029a30: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+00029a40: 2069 7369 6e73 7461 6e63 6528 636f 6e74   isinstance(cont
+00029a50: 6578 742c 2074 7570 6c65 2920 616e 6420  ext, tuple) and 
+00029a60: 6c65 6e28 636f 6e74 6578 7429 203e 2030  len(context) > 0
+00029a70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00029a80: 2069 7369 6e73 7461 6e63 6528 636f 6e74   isinstance(cont
+00029a90: 6578 745b 315d 5b30 5d2c 206e 702e 6e64  ext[1][0], np.nd
+00029aa0: 6172 7261 7929 2061 6e64 2063 6f6e 7465  array) and conte
+00029ab0: 7874 5b31 5d5b 305d 2e73 6861 7065 203d  xt[1][0].shape =
+00029ac0: 3d20 2829 3a0a 2020 2020 2020 2020 2020  = ():.          
+00029ad0: 2020 2020 2020 696e 6465 7820 3d20 4e6f        index = No
+00029ae0: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
+00029af0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00029b00: 2020 2020 2069 6e64 6578 203d 2063 6f6e       index = con
+00029b10: 7465 7874 5b31 5d5b 305d 2e69 6e64 6578  text[1][0].index
+00029b20: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00029b30: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00029b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b50: 696d 706f 7274 2069 6e73 7065 6374 0a0a  import inspect..
+00029b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b70: 6d65 7468 6f64 5f6e 616d 6520 3d20 6622  method_name = f"
+00029b80: 607b 696e 7370 6563 742e 7374 6163 6b28  `{inspect.stack(
+00029b90: 295b 335d 5b33 5d7d 6022 0a20 2020 2020  )[3][3]}`".     
+00029ba0: 2020 2020 2020 2065 7863 6570 7420 496e         except In
+00029bb0: 6465 7845 7272 6f72 3a0a 2020 2020 2020  dexError:.      
+00029bc0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00029bd0: 5f6e 616d 6520 3d20 2254 6869 7320 6d65  _name = "This me
+00029be0: 7468 6f64 220a 0a20 2020 2020 2020 2020  thod"..         
+00029bf0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
+00029c00: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
+00029c10: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00029c20: 7b6d 6574 686f 645f 6e61 6d65 7d20 6973  {method_name} is
+00029c30: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
+00029c40: 2066 6f72 2060 6461 736b 2e64 6174 6166   for `dask.dataf
+00029c50: 7261 6d65 2e44 6174 6146 7261 6d65 602e  rame.DataFrame`.
+00029c60: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+00029c70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00029c80: 6d65 7461 5f66 7261 6d65 5f63 6f6e 7374  meta_frame_const
+00029c90: 7275 6374 6f72 2873 656c 6629 2861 7272  ructor(self)(arr
+00029ca0: 6179 2c20 696e 6465 783d 696e 6465 782c  ay, index=index,
+00029cb0: 2063 6f6c 756d 6e73 3d73 656c 662e 636f   columns=self.co
+00029cc0: 6c75 6d6e 7329 0a0a 2020 2020 4070 726f  lumns)..    @pro
+00029cd0: 7065 7274 790a 2020 2020 6465 6620 6178  perty.    def ax
+00029ce0: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
+00029cf0: 2020 7265 7475 726e 205b 7365 6c66 2e69    return [self.i
+00029d00: 6e64 6578 2c20 7365 6c66 2e63 6f6c 756d  ndex, self.colum
+00029d10: 6e73 5d0a 0a20 2020 2040 7072 6f70 6572  ns]..    @proper
+00029d20: 7479 0a20 2020 2064 6566 2063 6f6c 756d  ty.    def colum
+00029d30: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
+00029d40: 2020 7265 7475 726e 2073 656c 662e 5f6d    return self._m
+00029d50: 6574 612e 636f 6c75 6d6e 730a 0a20 2020  eta.columns..   
+00029d60: 2040 636f 6c75 6d6e 732e 7365 7474 6572   @columns.setter
+00029d70: 0a20 2020 2064 6566 2063 6f6c 756d 6e73  .    def columns
+00029d80: 2873 656c 662c 2063 6f6c 756d 6e73 293a  (self, columns):
+00029d90: 0a20 2020 2020 2020 2072 656e 616d 6564  .        renamed
+00029da0: 203d 205f 7265 6e61 6d65 5f64 6173 6b28   = _rename_dask(
+00029db0: 7365 6c66 2c20 636f 6c75 6d6e 7329 0a20  self, columns). 
+00029dc0: 2020 2020 2020 2073 656c 662e 5f6d 6574         self._met
+00029dd0: 6120 3d20 7265 6e61 6d65 642e 5f6d 6574  a = renamed._met
+00029de0: 610a 2020 2020 2020 2020 7365 6c66 2e5f  a.        self._
+00029df0: 6e61 6d65 203d 2072 656e 616d 6564 2e5f  name = renamed._
+00029e00: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
+00029e10: 662e 6461 736b 203d 2072 656e 616d 6564  f.dask = renamed
+00029e20: 2e64 6173 6b0a 0a20 2020 2040 7072 6f70  .dask..    @prop
+00029e30: 6572 7479 0a20 2020 2064 6566 2069 6c6f  erty.    def ilo
+00029e40: 6328 7365 6c66 293a 0a20 2020 2020 2020  c(self):.       
+00029e50: 2022 2222 5075 7265 6c79 2069 6e74 6567   """Purely integ
+00029e60: 6572 2d6c 6f63 6174 696f 6e20 6261 7365  er-location base
+00029e70: 6420 696e 6465 7869 6e67 2066 6f72 2073  d indexing for s
+00029e80: 656c 6563 7469 6f6e 2062 7920 706f 7369  election by posi
+00029e90: 7469 6f6e 2e0a 0a20 2020 2020 2020 204f  tion...        O
+00029ea0: 6e6c 7920 696e 6465 7869 6e67 2074 6865  nly indexing the
+00029eb0: 2063 6f6c 756d 6e20 706f 7369 7469 6f6e   column position
+00029ec0: 7320 6973 2073 7570 706f 7274 6564 2e20  s is supported. 
+00029ed0: 5472 7969 6e67 2074 6f20 7365 6c65 6374  Trying to select
+00029ee0: 0a20 2020 2020 2020 2072 6f77 2070 6f73  .        row pos
+00029ef0: 6974 696f 6e73 2077 696c 6c20 7261 6973  itions will rais
+00029f00: 6520 6120 5661 6c75 6545 7272 6f72 2e0a  e a ValueError..
+00029f10: 0a20 2020 2020 2020 2053 6565 203a 7265  .        See :re
+00029f20: 663a 6064 6174 6166 7261 6d65 2e69 6e64  f:`dataframe.ind
+00029f30: 6578 696e 6760 2066 6f72 206d 6f72 652e  exing` for more.
+00029f40: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+00029f50: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+00029f60: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
+00029f70: 6466 2e69 6c6f 635b 3a2c 205b 322c 2030  df.iloc[:, [2, 0
+00029f80: 2c20 315d 5d20 2023 2064 6f63 7465 7374  , 1]]  # doctest
+00029f90: 3a20 2b53 4b49 500a 2020 2020 2020 2020  : +SKIP.        
+00029fa0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00029fb0: 2064 6173 6b2e 6461 7461 6672 616d 652e   dask.dataframe.
+00029fc0: 696e 6465 7869 6e67 2069 6d70 6f72 7420  indexing import 
+00029fd0: 5f69 4c6f 6349 6e64 6578 6572 0a0a 2020  _iLocIndexer..  
+00029fe0: 2020 2020 2020 2320 466f 7220 6461 7461        # For data
+00029ff0: 6672 616d 6573 2077 6974 6820 756e 6971  frames with uniq
+0002a000: 7565 2063 6f6c 756d 6e20 6e61 6d65 732c  ue column names,
+0002a010: 2074 6869 7320 7769 6c6c 2062 6520 7472   this will be tr
+0002a020: 616e 7366 6f72 6d65 6420 696e 746f 2061  ansformed into a
+0002a030: 205f 5f67 6574 6974 656d 5f5f 2063 616c   __getitem__ cal
+0002a040: 6c0a 2020 2020 2020 2020 7265 7475 726e  l.        return
+0002a050: 205f 694c 6f63 496e 6465 7865 7228 7365   _iLocIndexer(se
+0002a060: 6c66 290a 0a20 2020 2064 6566 205f 5f6c  lf)..    def __l
+0002a070: 656e 5f5f 2873 656c 6629 3a0a 2020 2020  en__(self):.    
+0002a080: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0002a090: 2020 2020 2073 203d 2073 656c 662e 696c       s = self.il
+0002a0a0: 6f63 5b3a 2c20 305d 0a20 2020 2020 2020  oc[:, 0].       
+0002a0b0: 2065 7863 6570 7420 496e 6465 7845 7272   except IndexErr
+0002a0c0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0002a0d0: 7265 7475 726e 2073 7570 6572 2829 2e5f  return super()._
+0002a0e0: 5f6c 656e 5f5f 2829 0a20 2020 2020 2020  _len__().       
+0002a0f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002a100: 2020 2072 6574 7572 6e20 6c65 6e28 7329     return len(s)
+0002a110: 0a0a 2020 2020 6465 6620 5f5f 636f 6e74  ..    def __cont
+0002a120: 6169 6e73 5f5f 2873 656c 662c 206b 6579  ains__(self, key
+0002a130: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0002a140: 6e20 6b65 7920 696e 2073 656c 662e 5f6d  n key in self._m
+0002a150: 6574 610a 0a20 2020 2040 7072 6f70 6572  eta..    @proper
+0002a160: 7479 0a20 2020 2064 6566 2065 6d70 7479  ty.    def empty
+0002a170: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0002a180: 2320 5f5f 6765 7461 7474 725f 5f20 7769  # __getattr__ wi
+0002a190: 6c6c 2062 6520 6361 6c6c 6564 2061 6674  ll be called aft
+0002a1a0: 6572 2077 6520 7261 6973 6520 7468 6973  er we raise this
+0002a1b0: 2c20 736f 2077 6527 6c6c 2072 6169 7365  , so we'll raise
+0002a1c0: 2069 7420 6167 6169 6e20 6672 6f6d 2074   it again from t
+0002a1d0: 6865 7265 0a20 2020 2020 2020 2072 6169  here.        rai
+0002a1e0: 7365 2041 7474 7269 6275 7465 4e6f 7449  se AttributeNotI
+0002a1f0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0002a200: 0a20 2020 2020 2020 2020 2020 2022 4368  .            "Ch
+0002a210: 6563 6b69 6e67 2077 6865 7468 6572 2061  ecking whether a
+0002a220: 2044 6173 6b20 4461 7461 4672 616d 6520   Dask DataFrame 
+0002a230: 6861 7320 616e 7920 726f 7773 206d 6179  has any rows may
+0002a240: 2062 6520 6578 7065 6e73 6976 652e 2022   be expensive. "
+0002a250: 0a20 2020 2020 2020 2020 2020 2022 486f  .            "Ho
+0002a260: 7765 7665 722c 2063 6865 636b 696e 6720  wever, checking 
+0002a270: 7468 6520 6e75 6d62 6572 206f 6620 636f  the number of co
+0002a280: 6c75 6d6e 7320 6973 2066 6173 742e 2022  lumns is fast. "
+0002a290: 0a20 2020 2020 2020 2020 2020 2022 4465  .            "De
+0002a2a0: 7065 6e64 696e 6720 6f6e 2077 6869 6368  pending on which
+0002a2b0: 206f 6620 7468 6573 6520 7265 7375 6c74   of these result
+0002a2c0: 7320 796f 7520 6e65 6564 2c20 7573 6520  s you need, use 
+0002a2d0: 6569 7468 6572 2022 0a20 2020 2020 2020  either ".       
+0002a2e0: 2020 2020 2022 606c 656e 2864 662e 696e       "`len(df.in
+0002a2f0: 6465 7829 203d 3d20 3060 206f 7220 606c  dex) == 0` or `l
+0002a300: 656e 2864 662e 636f 6c75 6d6e 7329 203d  en(df.columns) =
+0002a310: 3d20 3060 220a 2020 2020 2020 2020 290a  = 0`".        ).
+0002a320: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
+0002a330: 656d 5f5f 2873 656c 662c 206b 6579 293a  em__(self, key):
+0002a340: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
+0002a350: 2267 6574 6974 656d 2d25 7322 2025 2074  "getitem-%s" % t
+0002a360: 6f6b 656e 697a 6528 7365 6c66 2c20 6b65  okenize(self, ke
+0002a370: 7929 0a20 2020 2020 2020 2069 6620 6e70  y).        if np
+0002a380: 2e69 7373 6361 6c61 7228 6b65 7929 206f  .isscalar(key) o
+0002a390: 7220 6973 696e 7374 616e 6365 286b 6579  r isinstance(key
+0002a3a0: 2c20 2874 7570 6c65 2c20 7374 7229 293a  , (tuple, str)):
+0002a3b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002a3c0: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0002a3d0: 5f6d 6574 612e 696e 6465 782c 2028 7064  _meta.index, (pd
+0002a3e0: 2e44 6174 6574 696d 6549 6e64 6578 2c20  .DatetimeIndex, 
+0002a3f0: 7064 2e50 6572 696f 6449 6e64 6578 2929  pd.PeriodIndex))
+0002a400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a410: 2020 6966 206b 6579 206e 6f74 2069 6e20    if key not in 
+0002a420: 7365 6c66 2e5f 6d65 7461 2e63 6f6c 756d  self._meta.colum
+0002a430: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0002a440: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0002a450: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+0002a460: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002a470: 496e 6465 7869 6e67 2061 2044 6174 6146  Indexing a DataF
+0002a480: 7261 6d65 2077 6974 6820 6120 6461 7465  rame with a date
+0002a490: 7469 6d65 6c69 6b65 2069 6e64 6578 2075  timelike index u
+0002a4a0: 7369 6e67 2061 2073 696e 676c 6520 220a  sing a single ".
 0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4c0: 2020 2022 616e 6420 7769 6c6c 2062 6520     "and will be 
-0002a4d0: 7265 6d6f 7665 6420 696e 2061 2066 7574  removed in a fut
-0002a4e0: 7572 6520 7665 7273 696f 6e2e 2055 7365  ure version. Use
-0002a4f0: 2060 6672 616d 652e 6c6f 635b 7374 7269   `frame.loc[stri
-0002a500: 6e67 5d60 2022 0a20 2020 2020 2020 2020  ng]` ".         
-0002a510: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0002a520: 696e 7374 6561 642e 222c 0a20 2020 2020  instead.",.     
-0002a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a540: 2020 2046 7574 7572 6557 6172 6e69 6e67     FutureWarning
-0002a550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002a560: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0002a570: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002a580: 726e 2073 656c 662e 6c6f 635b 6b65 795d  rn self.loc[key]
-0002a590: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0002a5a0: 6572 726f 7220 6973 2072 6169 7365 6420  error is raised 
-0002a5b0: 6672 6f6d 2070 616e 6461 730a 2020 2020  from pandas.    
-0002a5c0: 2020 2020 2020 2020 6d65 7461 203d 2073          meta = s
-0002a5d0: 656c 662e 5f6d 6574 615b 5f65 7874 7261  elf._meta[_extra
-0002a5e0: 6374 5f6d 6574 6128 6b65 7929 5d0a 2020  ct_meta(key)].  
-0002a5f0: 2020 2020 2020 2020 2020 6473 6b20 3d20            dsk = 
-0002a600: 7061 7274 6974 696f 6e77 6973 655f 6772  partitionwise_gr
-0002a610: 6170 6828 6f70 6572 6174 6f72 2e67 6574  aph(operator.get
-0002a620: 6974 656d 2c20 6e61 6d65 2c20 7365 6c66  item, name, self
-0002a630: 2c20 6b65 7929 0a20 2020 2020 2020 2020  , key).         
-0002a640: 2020 2067 7261 7068 203d 2048 6967 684c     graph = HighL
-0002a650: 6576 656c 4772 6170 682e 6672 6f6d 5f63  evelGraph.from_c
-0002a660: 6f6c 6c65 6374 696f 6e73 286e 616d 652c  ollections(name,
-0002a670: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
-0002a680: 6573 3d5b 7365 6c66 5d29 0a20 2020 2020  es=[self]).     
-0002a690: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
-0002a6a0: 775f 6464 5f6f 626a 6563 7428 6772 6170  w_dd_object(grap
-0002a6b0: 682c 206e 616d 652c 206d 6574 612c 2073  h, name, meta, s
-0002a6c0: 656c 662e 6469 7669 7369 6f6e 7329 0a20  elf.divisions). 
-0002a6d0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-0002a6e0: 7374 616e 6365 286b 6579 2c20 736c 6963  stance(key, slic
-0002a6f0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0002a700: 6672 6f6d 2070 616e 6461 732e 6170 692e  from pandas.api.
-0002a710: 7479 7065 7320 696d 706f 7274 2069 735f  types import is_
-0002a720: 666c 6f61 745f 6474 7970 650a 0a20 2020  float_dtype..   
-0002a730: 2020 2020 2020 2020 2069 735f 696e 7465           is_inte
-0002a740: 6765 725f 736c 6963 6520 3d20 616e 7928  ger_slice = any(
-0002a750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a760: 2069 7369 6e73 7461 6e63 6528 692c 2049   isinstance(i, I
-0002a770: 6e74 6567 7261 6c29 2066 6f72 2069 2069  ntegral) for i i
-0002a780: 6e20 286b 6579 2e73 7461 7274 2c20 6b65  n (key.start, ke
-0002a790: 792e 7374 6570 2c20 6b65 792e 7374 6f70  y.step, key.stop
-0002a7a0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0002a7b0: 2020 2020 2020 2020 2020 2020 2320 536c              # Sl
-0002a7c0: 6963 696e 6720 7769 7468 2069 6e74 6567  icing with integ
-0002a7d0: 6572 206c 6162 656c 7320 6973 2061 6c77  er labels is alw
-0002a7e0: 6179 7320 696c 6f63 2062 6173 6564 2065  ays iloc based e
-0002a7f0: 7863 6570 7420 666f 7220 610a 2020 2020  xcept for a.    
-0002a800: 2020 2020 2020 2020 2320 666c 6f61 7420          # float 
-0002a810: 696e 6465 7865 7220 666f 7220 736f 6d65  indexer for some
-0002a820: 2072 6561 736f 6e0a 2020 2020 2020 2020   reason.        
-0002a830: 2020 2020 6966 2069 735f 696e 7465 6765      if is_intege
-0002a840: 725f 736c 6963 6520 616e 6420 6e6f 7420  r_slice and not 
-0002a850: 6973 5f66 6c6f 6174 5f64 7479 7065 2873  is_float_dtype(s
-0002a860: 656c 662e 696e 6465 782e 6474 7970 6529  elf.index.dtype)
-0002a870: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a880: 2020 2320 4e4f 5445 3a20 7468 6973 2061    # NOTE: this a
-0002a890: 6c77 6179 7320 6661 696c 7320 6375 7272  lways fails curr
-0002a8a0: 656e 746c 792c 2061 7320 696c 6f63 2069  ently, as iloc i
-0002a8b0: 7320 6d6f 7374 6c79 0a20 2020 2020 2020  s mostly.       
-0002a8c0: 2020 2020 2020 2020 2023 2075 6e73 7570           # unsup
-0002a8d0: 706f 7274 6564 2c20 6275 7420 7765 2063  ported, but we c
-0002a8e0: 616c 6c20 6974 2061 6e79 7761 7920 6865  all it anyway he
-0002a8f0: 7265 2066 6f72 2066 7574 7572 652d 7072  re for future-pr
-0002a900: 6f6f 6669 6e67 0a20 2020 2020 2020 2020  oofing.         
-0002a910: 2020 2020 2020 2023 2061 6e64 2065 7272         # and err
-0002a920: 6f72 2d61 7474 7269 6275 7469 6f6e 2070  or-attribution p
-0002a930: 7572 706f 7365 730a 2020 2020 2020 2020  urposes.        
-0002a940: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002a950: 656c 662e 696c 6f63 5b6b 6579 5d0a 2020  elf.iloc[key].  
-0002a960: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002a970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a980: 7265 7475 726e 2073 656c 662e 6c6f 635b  return self.loc[
-0002a990: 6b65 795d 0a0a 2020 2020 2020 2020 6966  key]..        if
-0002a9a0: 2069 7369 6e73 7461 6e63 6528 6b65 792c   isinstance(key,
-0002a9b0: 2028 6e70 2e6e 6461 7272 6179 2c20 6c69   (np.ndarray, li
-0002a9c0: 7374 2929 206f 7220 280a 2020 2020 2020  st)) or (.      
-0002a9d0: 2020 2020 2020 6e6f 7420 6973 5f64 6173        not is_das
-0002a9e0: 6b5f 636f 6c6c 6563 7469 6f6e 286b 6579  k_collection(key
-0002a9f0: 2920 616e 6420 2869 735f 7365 7269 6573  ) and (is_series
-0002aa00: 5f6c 696b 6528 6b65 7929 206f 7220 6973  _like(key) or is
-0002aa10: 5f69 6e64 6578 5f6c 696b 6528 6b65 7929  _index_like(key)
-0002aa20: 290a 2020 2020 2020 2020 293a 0a20 2020  ).        ):.   
-0002aa30: 2020 2020 2020 2020 2023 2065 7272 6f72           # error
-0002aa40: 2069 7320 7261 6973 6564 2066 726f 6d20   is raised from 
-0002aa50: 7061 6e64 6173 0a20 2020 2020 2020 2020  pandas.         
-0002aa60: 2020 206d 6574 6120 3d20 7365 6c66 2e5f     meta = self._
-0002aa70: 6d65 7461 5b5f 6578 7472 6163 745f 6d65  meta[_extract_me
-0002aa80: 7461 286b 6579 295d 0a0a 2020 2020 2020  ta(key)]..      
-0002aa90: 2020 2020 2020 6473 6b20 3d20 7061 7274        dsk = part
-0002aaa0: 6974 696f 6e77 6973 655f 6772 6170 6828  itionwise_graph(
-0002aab0: 6f70 6572 6174 6f72 2e67 6574 6974 656d  operator.getitem
-0002aac0: 2c20 6e61 6d65 2c20 7365 6c66 2c20 6b65  , name, self, ke
-0002aad0: 7929 0a20 2020 2020 2020 2020 2020 2067  y).            g
-0002aae0: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
-0002aaf0: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-0002ab00: 6374 696f 6e73 286e 616d 652c 2064 736b  ctions(name, dsk
-0002ab10: 2c20 6465 7065 6e64 656e 6369 6573 3d5b  , dependencies=[
-0002ab20: 7365 6c66 5d29 0a20 2020 2020 2020 2020  self]).         
-0002ab30: 2020 2072 6574 7572 6e20 6e65 775f 6464     return new_dd
-0002ab40: 5f6f 626a 6563 7428 6772 6170 682c 206e  _object(graph, n
-0002ab50: 616d 652c 206d 6574 612c 2073 656c 662e  ame, meta, self.
-0002ab60: 6469 7669 7369 6f6e 7329 0a20 2020 2020  divisions).     
-0002ab70: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002ab80: 286b 6579 2c20 5365 7269 6573 293a 0a20  (key, Series):. 
-0002ab90: 2020 2020 2020 2020 2020 2023 2064 6f20             # do 
-0002aba0: 6e6f 7420 7065 7266 6f72 6d20 6475 6d6d  not perform dumm
-0002abb0: 7920 6361 6c63 756c 6174 696f 6e2c 2061  y calculation, a
-0002abc0: 7320 636f 6c75 6d6e 7320 7769 6c6c 206e  s columns will n
-0002abd0: 6f74 2062 6520 6368 616e 6765 642e 0a20  ot be changed.. 
-0002abe0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0002abf0: 6c66 2e64 6976 6973 696f 6e73 2021 3d20  lf.divisions != 
-0002ac00: 6b65 792e 6469 7669 7369 6f6e 733a 0a20  key.divisions:. 
-0002ac10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0002ac20: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
-0002ac30: 6d65 2e6d 756c 7469 2069 6d70 6f72 7420  me.multi import 
-0002ac40: 5f6d 6179 6265 5f61 6c69 676e 5f70 6172  _maybe_align_par
-0002ac50: 7469 7469 6f6e 730a 0a20 2020 2020 2020  titions..       
-0002ac60: 2020 2020 2020 2020 2073 656c 662c 206b           self, k
-0002ac70: 6579 203d 205f 6d61 7962 655f 616c 6967  ey = _maybe_alig
-0002ac80: 6e5f 7061 7274 6974 696f 6e73 285b 7365  n_partitions([se
-0002ac90: 6c66 2c20 6b65 795d 290a 2020 2020 2020  lf, key]).      
-0002aca0: 2020 2020 2020 6473 6b20 3d20 7061 7274        dsk = part
-0002acb0: 6974 696f 6e77 6973 655f 6772 6170 6828  itionwise_graph(
-0002acc0: 6f70 6572 6174 6f72 2e67 6574 6974 656d  operator.getitem
-0002acd0: 2c20 6e61 6d65 2c20 7365 6c66 2c20 6b65  , name, self, ke
-0002ace0: 7929 0a20 2020 2020 2020 2020 2020 2067  y).            g
-0002acf0: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
-0002ad00: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-0002ad10: 6374 696f 6e73 286e 616d 652c 2064 736b  ctions(name, dsk
-0002ad20: 2c20 6465 7065 6e64 656e 6369 6573 3d5b  , dependencies=[
-0002ad30: 7365 6c66 2c20 6b65 795d 290a 2020 2020  self, key]).    
-0002ad40: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0002ad50: 6577 5f64 645f 6f62 6a65 6374 2867 7261  ew_dd_object(gra
-0002ad60: 7068 2c20 6e61 6d65 2c20 7365 6c66 2c20  ph, name, self, 
-0002ad70: 7365 6c66 2e64 6976 6973 696f 6e73 290a  self.divisions).
-0002ad80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0002ad90: 7461 6e63 6528 6b65 792c 2044 6174 6146  tance(key, DataF
-0002ada0: 7261 6d65 293a 0a20 2020 2020 2020 2020  rame):.         
-0002adb0: 2020 2072 6574 7572 6e20 7365 6c66 2e77     return self.w
-0002adc0: 6865 7265 286b 6579 2c20 6e70 2e6e 616e  here(key, np.nan
-0002add0: 290a 0a20 2020 2020 2020 2072 6169 7365  )..        raise
-0002ade0: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-0002adf0: 7272 6f72 286b 6579 290a 0a20 2020 2064  rror(key)..    d
-0002ae00: 6566 205f 5f73 6574 6974 656d 5f5f 2873  ef __setitem__(s
-0002ae10: 656c 662c 206b 6579 2c20 7661 6c75 6529  elf, key, value)
-0002ae20: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
-0002ae30: 6e73 7461 6e63 6528 6b65 792c 2028 7475  nstance(key, (tu
-0002ae40: 706c 652c 206c 6973 7429 2920 616e 6420  ple, list)) and 
-0002ae50: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-0002ae60: 2c20 4461 7461 4672 616d 6529 3a0a 2020  , DataFrame):.  
-0002ae70: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-0002ae80: 656c 662e 6173 7369 676e 282a 2a7b 6b3a  elf.assign(**{k:
-0002ae90: 2076 616c 7565 5b63 5d20 666f 7220 6b2c   value[c] for k,
-0002aea0: 2063 2069 6e20 7a69 7028 6b65 792c 2076   c in zip(key, v
-0002aeb0: 616c 7565 2e63 6f6c 756d 6e73 297d 290a  alue.columns)}).
-0002aec0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0002aed0: 696e 7374 616e 6365 286b 6579 2c20 7064  instance(key, pd
-0002aee0: 2e49 6e64 6578 2920 616e 6420 6e6f 7420  .Index) and not 
-0002aef0: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
-0002af00: 2c20 4461 7461 4672 616d 6529 3a0a 2020  , DataFrame):.  
-0002af10: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-0002af20: 6c69 7374 286b 6579 290a 2020 2020 2020  list(key).      
-0002af30: 2020 2020 2020 6466 203d 2073 656c 662e        df = self.
-0002af40: 6173 7369 676e 282a 2a7b 6b3a 2076 616c  assign(**{k: val
-0002af50: 7565 2066 6f72 206b 2069 6e20 6b65 797d  ue for k in key}
-0002af60: 290a 2020 2020 2020 2020 656c 6966 2028  ).        elif (
-0002af70: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
-0002af80: 6461 7461 6672 616d 655f 6c69 6b65 286b  dataframe_like(k
-0002af90: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
-0002afa0: 6f72 2069 735f 7365 7269 6573 5f6c 696b  or is_series_lik
-0002afb0: 6528 6b65 7929 0a20 2020 2020 2020 2020  e(key).         
-0002afc0: 2020 206f 7220 6973 696e 7374 616e 6365     or isinstance
-0002afd0: 286b 6579 2c20 2844 6174 6146 7261 6d65  (key, (DataFrame
-0002afe0: 2c20 5365 7269 6573 2929 0a20 2020 2020  , Series)).     
-0002aff0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-0002b000: 2020 6466 203d 2073 656c 662e 7768 6572    df = self.wher
-0002b010: 6528 7e6b 6579 2c20 7661 6c75 6529 0a20  e(~key, value). 
-0002b020: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-0002b030: 6973 696e 7374 616e 6365 286b 6579 2c20  isinstance(key, 
-0002b040: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-0002b050: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0002b060: 6d65 6e74 6564 4572 726f 7228 6622 4974  mentedError(f"It
-0002b070: 656d 2061 7373 6967 6e6d 656e 7420 7769  em assignment wi
-0002b080: 7468 207b 7479 7065 286b 6579 297d 206e  th {type(key)} n
-0002b090: 6f74 2073 7570 706f 7274 6564 2229 0a20  ot supported"). 
-0002b0a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002b0b0: 2020 2020 2020 2020 2064 6620 3d20 7365           df = se
-0002b0c0: 6c66 2e61 7373 6967 6e28 2a2a 7b6b 6579  lf.assign(**{key
-0002b0d0: 3a20 7661 6c75 657d 290a 0a20 2020 2020  : value})..     
-0002b0e0: 2020 2073 656c 662e 6461 736b 203d 2064     self.dask = d
-0002b0f0: 662e 6461 736b 0a20 2020 2020 2020 2073  f.dask.        s
-0002b100: 656c 662e 5f6e 616d 6520 3d20 6466 2e5f  elf._name = df._
-0002b110: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
-0002b120: 662e 5f6d 6574 6120 3d20 6466 2e5f 6d65  f._meta = df._me
-0002b130: 7461 0a20 2020 2020 2020 2073 656c 662e  ta.        self.
-0002b140: 5f64 6976 6973 696f 6e73 203d 2064 662e  _divisions = df.
-0002b150: 6469 7669 7369 6f6e 730a 0a20 2020 2064  divisions..    d
-0002b160: 6566 205f 5f64 656c 6974 656d 5f5f 2873  ef __delitem__(s
-0002b170: 656c 662c 206b 6579 293a 0a20 2020 2020  elf, key):.     
-0002b180: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-0002b190: 2e64 726f 7028 5b6b 6579 5d2c 2061 7869  .drop([key], axi
-0002b1a0: 733d 3129 0a20 2020 2020 2020 2073 656c  s=1).        sel
-0002b1b0: 662e 6461 736b 203d 2072 6573 756c 742e  f.dask = result.
-0002b1c0: 6461 736b 0a20 2020 2020 2020 2073 656c  dask.        sel
-0002b1d0: 662e 5f6e 616d 6520 3d20 7265 7375 6c74  f._name = result
-0002b1e0: 2e5f 6e61 6d65 0a20 2020 2020 2020 2073  ._name.        s
-0002b1f0: 656c 662e 5f6d 6574 6120 3d20 7265 7375  elf._meta = resu
-0002b200: 6c74 2e5f 6d65 7461 0a0a 2020 2020 6465  lt._meta..    de
-0002b210: 6620 5f5f 7365 7461 7474 725f 5f28 7365  f __setattr__(se
-0002b220: 6c66 2c20 6b65 792c 2076 616c 7565 293a  lf, key, value):
-0002b230: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0002b240: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-0002b250: 7320 3d20 6f62 6a65 6374 2e5f 5f67 6574  s = object.__get
-0002b260: 6174 7472 6962 7574 655f 5f28 7365 6c66  attribute__(self
-0002b270: 2c20 225f 6d65 7461 2229 2e63 6f6c 756d  , "_meta").colum
-0002b280: 6e73 0a20 2020 2020 2020 2065 7863 6570  ns.        excep
-0002b290: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-0002b2a0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002b2b0: 6c75 6d6e 7320 3d20 2829 0a0a 2020 2020  lumns = ()..    
-0002b2c0: 2020 2020 2320 6578 636c 7564 6520 7072      # exclude pr
-0002b2d0: 6f74 6563 7465 6420 6174 7472 6962 7574  otected attribut
-0002b2e0: 6573 2066 726f 6d20 7365 7469 7465 6d0a  es from setitem.
-0002b2f0: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-0002b300: 6e20 636f 6c75 6d6e 7320 616e 6420 6b65  n columns and ke
-0002b310: 7920 6e6f 7420 696e 205b 2264 6976 6973  y not in ["divis
-0002b320: 696f 6e73 222c 2022 6461 736b 222c 2022  ions", "dask", "
-0002b330: 5f6e 616d 6522 2c20 225f 6d65 7461 225d  _name", "_meta"]
-0002b340: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0002b350: 6c66 5b6b 6579 5d20 3d20 7661 6c75 650a  lf[key] = value.
-0002b360: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002b370: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
-0002b380: 2e5f 5f73 6574 6174 7472 5f5f 2873 656c  .__setattr__(sel
-0002b390: 662c 206b 6579 2c20 7661 6c75 6529 0a0a  f, key, value)..
-0002b3a0: 2020 2020 6465 6620 5f5f 6765 7461 7474      def __getatt
-0002b3b0: 725f 5f28 7365 6c66 2c20 6b65 7929 3a0a  r__(self, key):.
-0002b3c0: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-0002b3d0: 6e20 7365 6c66 2e63 6f6c 756d 6e73 3a0a  n self.columns:.
-0002b3e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002b3f0: 726e 2073 656c 665b 6b65 795d 0a20 2020  rn self[key].   
-0002b400: 2020 2020 2065 6c69 6620 6b65 7920 3d3d       elif key ==
-0002b410: 2022 656d 7074 7922 3a0a 2020 2020 2020   "empty":.      
-0002b420: 2020 2020 2020 2320 7365 6c66 2e65 6d70        # self.emp
-0002b430: 7479 2072 6169 7365 7320 4174 7472 6962  ty raises Attrib
-0002b440: 7574 654e 6f74 496d 706c 656d 656e 7465  uteNotImplemente
-0002b450: 6445 7272 6f72 2c20 7768 6963 6820 696e  dError, which in
-0002b460: 636c 7564 6573 0a20 2020 2020 2020 2020  cludes.         
-0002b470: 2020 2023 2041 7474 7269 6275 7465 4572     # AttributeEr
-0002b480: 726f 722c 2077 6869 6368 206d 6561 6e73  ror, which means
-0002b490: 2077 6520 656e 6420 7570 2068 6572 6520   we end up here 
-0002b4a0: 696e 2073 656c 662e 5f5f 6765 7461 7474  in self.__getatt
-0002b4b0: 725f 5f2c 0a20 2020 2020 2020 2020 2020  r__,.           
-0002b4c0: 2023 2062 6563 6175 7365 2044 6174 6146   # because DataF
-0002b4d0: 7261 6d65 2e5f 5f67 6574 6174 7472 6962  rame.__getattrib
-0002b4e0: 7574 655f 5f20 646f 6573 6e27 7420 7468  ute__ doesn't th
-0002b4f0: 696e 6b20 7468 6520 6174 7472 6962 7574  ink the attribut
-0002b500: 6520 6578 6973 7473 0a20 2020 2020 2020  e exists.       
-0002b510: 2020 2020 2023 2061 6e64 2075 7365 7320       # and uses 
-0002b520: 5f5f 6765 7461 7474 725f 5f20 6173 2074  __getattr__ as t
-0002b530: 6865 2066 616c 6c62 6163 6b2e 2053 6f2c  he fallback. So,
-0002b540: 2067 6574 2060 7365 6c66 2e65 6d70 7479   get `self.empty
-0002b550: 6020 6d6f 7265 0a20 2020 2020 2020 2020  ` more.         
-0002b560: 2020 2023 2066 6f72 6365 6675 6c6c 7920     # forcefully 
-0002b570: 7669 6120 6f62 6a65 6374 2e5f 5f67 6574  via object.__get
-0002b580: 6174 7472 6962 7574 655f 5f20 746f 2072  attribute__ to r
-0002b590: 6169 7365 2069 6e66 6f72 6d61 7469 7665  aise informative
-0002b5a0: 2065 7272 6f72 2e0a 2020 2020 2020 2020   error..        
-0002b5b0: 2020 2020 6f62 6a65 6374 2e5f 5f67 6574      object.__get
-0002b5c0: 6174 7472 6962 7574 655f 5f28 7365 6c66  attribute__(self
-0002b5d0: 2c20 6b65 7929 0a20 2020 2020 2020 2065  , key).        e
-0002b5e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002b5f0: 2072 6169 7365 2041 7474 7269 6275 7465   raise Attribute
-0002b600: 4572 726f 7228 2227 4461 7461 4672 616d  Error("'DataFram
-0002b610: 6527 206f 626a 6563 7420 6861 7320 6e6f  e' object has no
-0002b620: 2061 7474 7269 6275 7465 2025 7222 2025   attribute %r" %
-0002b630: 206b 6579 290a 0a20 2020 2064 6566 205f   key)..    def _
-0002b640: 5f64 6972 5f5f 2873 656c 6629 3a0a 2020  _dir__(self):.  
-0002b650: 2020 2020 2020 6f20 3d20 7365 7428 6469        o = set(di
-0002b660: 7228 7479 7065 2873 656c 6629 2929 0a20  r(type(self))). 
-0002b670: 2020 2020 2020 206f 2e75 7064 6174 6528         o.update(
-0002b680: 7365 6c66 2e5f 5f64 6963 745f 5f29 0a20  self.__dict__). 
-0002b690: 2020 2020 2020 206f 2e75 7064 6174 6528         o.update(
-0002b6a0: 6320 666f 7220 6320 696e 2073 656c 662e  c for c in self.
-0002b6b0: 636f 6c75 6d6e 7320 6966 2028 6973 696e  columns if (isin
-0002b6c0: 7374 616e 6365 2863 2c20 7374 7229 2061  stance(c, str) a
-0002b6d0: 6e64 2063 2e69 7369 6465 6e74 6966 6965  nd c.isidentifie
-0002b6e0: 7228 2929 290a 2020 2020 2020 2020 7265  r())).        re
-0002b6f0: 7475 726e 206c 6973 7428 6f29 0a0a 2020  turn list(o)..  
-0002b700: 2020 6465 6620 5f5f 6974 6572 5f5f 2873    def __iter__(s
-0002b710: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0002b720: 7475 726e 2069 7465 7228 7365 6c66 2e5f  turn iter(self._
-0002b730: 6d65 7461 290a 0a20 2020 2064 6566 205f  meta)..    def _
-0002b740: 6970 7974 686f 6e5f 6b65 795f 636f 6d70  ipython_key_comp
-0002b750: 6c65 7469 6f6e 735f 2873 656c 6629 3a0a  letions_(self):.
-0002b760: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0002b770: 6574 686f 6473 2e74 6f6c 6973 7428 7365  ethods.tolist(se
-0002b780: 6c66 2e63 6f6c 756d 6e73 290a 0a20 2020  lf.columns)..   
-0002b790: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-0002b7a0: 6566 206e 6469 6d28 7365 6c66 293a 0a20  ef ndim(self):. 
-0002b7b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-0002b7c0: 2064 696d 656e 7369 6f6e 616c 6974 7922   dimensionality"
-0002b7d0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0002b7e0: 6e20 320a 0a20 2020 2040 7072 6f70 6572  n 2..    @proper
-0002b7f0: 7479 0a20 2020 2064 6566 2073 6861 7065  ty.    def shape
-0002b800: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0002b810: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0002b820: 726e 2061 2074 7570 6c65 2072 6570 7265  rn a tuple repre
-0002b830: 7365 6e74 696e 6720 7468 6520 6469 6d65  senting the dime
-0002b840: 6e73 696f 6e61 6c69 7479 206f 6620 7468  nsionality of th
-0002b850: 6520 4461 7461 4672 616d 652e 0a0a 2020  e DataFrame...  
-0002b860: 2020 2020 2020 5468 6520 6e75 6d62 6572        The number
-0002b870: 206f 6620 726f 7773 2069 7320 6120 4465   of rows is a De
-0002b880: 6c61 7965 6420 7265 7375 6c74 2e20 5468  layed result. Th
-0002b890: 6520 6e75 6d62 6572 206f 6620 636f 6c75  e number of colu
-0002b8a0: 6d6e 730a 2020 2020 2020 2020 6973 2061  mns.        is a
-0002b8b0: 2063 6f6e 6372 6574 6520 696e 7465 6765   concrete intege
-0002b8c0: 722e 0a0a 2020 2020 2020 2020 4578 616d  r...        Exam
-0002b8d0: 706c 6573 0a20 2020 2020 2020 202d 2d2d  ples.        ---
-0002b8e0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 3e3e  -----.        >>
-0002b8f0: 3e20 6466 2e73 697a 6520 2023 2064 6f63  > df.size  # doc
-0002b900: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-0002b910: 2020 2020 2844 656c 6179 6564 2827 696e      (Delayed('in
-0002b920: 742d 3037 6630 3630 3735 2d35 6563 632d  t-07f06075-5ecc-
-0002b930: 3464 3737 2d38 3137 652d 3633 6336 3961  4d77-817e-63c69a
-0002b940: 3931 3838 6138 2729 2c20 3229 0a20 2020  9188a8'), 2).   
-0002b950: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0002b960: 2063 6f6c 5f73 697a 6520 3d20 6c65 6e28   col_size = len(
-0002b970: 7365 6c66 2e63 6f6c 756d 6e73 290a 2020  self.columns).  
-0002b980: 2020 2020 2020 6966 2063 6f6c 5f73 697a        if col_siz
-0002b990: 6520 3d3d 2030 3a0a 2020 2020 2020 2020  e == 0:.        
-0002b9a0: 2020 2020 7265 7475 726e 2028 7365 6c66      return (self
-0002b9b0: 2e69 6e64 6578 2e73 6861 7065 5b30 5d2c  .index.shape[0],
-0002b9c0: 2030 290a 2020 2020 2020 2020 726f 775f   0).        row_
-0002b9d0: 7369 7a65 203d 2064 656c 6179 6564 2869  size = delayed(i
-0002b9e0: 6e74 2928 7365 6c66 2e73 697a 6520 2f20  nt)(self.size / 
-0002b9f0: 636f 6c5f 7369 7a65 290a 2020 2020 2020  col_size).      
-0002ba00: 2020 7265 7475 726e 2028 726f 775f 7369    return (row_si
-0002ba10: 7a65 2c20 636f 6c5f 7369 7a65 290a 0a20  ze, col_size).. 
-0002ba20: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0002ba30: 2064 6566 2064 7479 7065 7328 7365 6c66   def dtypes(self
-0002ba40: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-0002ba50: 7475 726e 2064 6174 6120 7479 7065 7322  turn data types"
-0002ba60: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0002ba70: 6e20 7365 6c66 2e5f 6d65 7461 2e64 7479  n self._meta.dty
-0002ba80: 7065 730a 0a20 2020 2040 6465 7269 7665  pes..    @derive
-0002ba90: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-0002baa0: 616d 6529 0a20 2020 2064 6566 2067 6574  ame).    def get
-0002bab0: 5f64 7479 7065 5f63 6f75 6e74 7328 7365  _dtype_counts(se
-0002bac0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0002bad0: 7572 6e20 7365 6c66 2e5f 6d65 7461 2e67  urn self._meta.g
-0002bae0: 6574 5f64 7479 7065 5f63 6f75 6e74 7328  et_dtype_counts(
-0002baf0: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-0002bb00: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-0002bb10: 6529 0a20 2020 2064 6566 2067 6574 5f66  e).    def get_f
-0002bb20: 7479 7065 5f63 6f75 6e74 7328 7365 6c66  type_counts(self
-0002bb30: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0002bb40: 6e20 7365 6c66 2e5f 6d65 7461 2e67 6574  n self._meta.get
-0002bb50: 5f66 7479 7065 5f63 6f75 6e74 7328 290a  _ftype_counts().
-0002bb60: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-0002bb70: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-0002bb80: 0a20 2020 2064 6566 2073 656c 6563 745f  .    def select_
-0002bb90: 6474 7970 6573 2873 656c 662c 2069 6e63  dtypes(self, inc
-0002bba0: 6c75 6465 3d4e 6f6e 652c 2065 7863 6c75  lude=None, exclu
-0002bbb0: 6465 3d4e 6f6e 6529 3a0a 2020 2020 2020  de=None):.      
-0002bbc0: 2020 6373 203d 2073 656c 662e 5f6d 6574    cs = self._met
-0002bbd0: 612e 7365 6c65 6374 5f64 7479 7065 7328  a.select_dtypes(
-0002bbe0: 696e 636c 7564 653d 696e 636c 7564 652c  include=include,
-0002bbf0: 2065 7863 6c75 6465 3d65 7863 6c75 6465   exclude=exclude
-0002bc00: 290a 2020 2020 2020 2020 696e 6465 7865  ).        indexe
-0002bc10: 7220 3d20 7365 6c66 2e5f 6765 745f 636f  r = self._get_co
-0002bc20: 6c75 6d6e 735f 696e 6465 7865 735f 6261  lumns_indexes_ba
-0002bc30: 7365 645f 6f6e 5f64 7479 7065 7328 6373  sed_on_dtypes(cs
-0002bc40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002bc50: 2073 656c 662e 696c 6f63 5b3a 2c20 696e   self.iloc[:, in
-0002bc60: 6465 7865 725d 0a0a 2020 2020 6465 6620  dexer]..    def 
-0002bc70: 736f 7274 5f76 616c 7565 7328 0a20 2020  sort_values(.   
-0002bc80: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0002bc90: 2020 2062 793a 2073 7472 207c 206c 6973     by: str | lis
-0002bca0: 745b 7374 725d 2c0a 2020 2020 2020 2020  t[str],.        
-0002bcb0: 6e70 6172 7469 7469 6f6e 733a 2069 6e74  npartitions: int
-0002bcc0: 207c 204c 6974 6572 616c 5b22 6175 746f   | Literal["auto
-0002bcd0: 225d 207c 204e 6f6e 6520 3d20 4e6f 6e65  "] | None = None
-0002bce0: 2c0a 2020 2020 2020 2020 6173 6365 6e64  ,.        ascend
-0002bcf0: 696e 673a 2062 6f6f 6c20 3d20 5472 7565  ing: bool = True
-0002bd00: 2c0a 2020 2020 2020 2020 6e61 5f70 6f73  ,.        na_pos
-0002bd10: 6974 696f 6e3a 204c 6974 6572 616c 5b22  ition: Literal["
-0002bd20: 6669 7273 7422 5d20 7c20 4c69 7465 7261  first"] | Litera
-0002bd30: 6c5b 226c 6173 7422 5d20 3d20 226c 6173  l["last"] = "las
-0002bd40: 7422 2c0a 2020 2020 2020 2020 736f 7274  t",.        sort
-0002bd50: 5f66 756e 6374 696f 6e3a 2043 616c 6c61  _function: Calla
-0002bd60: 626c 655b 5b70 642e 4461 7461 4672 616d  ble[[pd.DataFram
-0002bd70: 655d 2c20 7064 2e44 6174 6146 7261 6d65  e], pd.DataFrame
-0002bd80: 5d20 7c20 4e6f 6e65 203d 204e 6f6e 652c  ] | None = None,
-0002bd90: 0a20 2020 2020 2020 2073 6f72 745f 6675  .        sort_fu
-0002bda0: 6e63 7469 6f6e 5f6b 7761 7267 733a 204d  nction_kwargs: M
-0002bdb0: 6170 7069 6e67 5b73 7472 2c20 416e 795d  apping[str, Any]
-0002bdc0: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
-0002bdd0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-0002bde0: 2c0a 2020 2020 2920 2d3e 2044 6174 6146  ,.    ) -> DataF
-0002bdf0: 7261 6d65 3a0a 2020 2020 2020 2020 2222  rame:.        ""
-0002be00: 2253 6f72 7420 7468 6520 6461 7461 7365  "Sort the datase
-0002be10: 7420 6279 2061 2073 696e 676c 6520 636f  t by a single co
-0002be20: 6c75 6d6e 2e0a 0a20 2020 2020 2020 2053  lumn...        S
-0002be30: 6f72 7469 6e67 2061 2070 6172 616c 6c65  orting a paralle
-0002be40: 6c20 6461 7461 7365 7420 7265 7175 6972  l dataset requir
-0002be50: 6573 2065 7870 656e 7369 7665 2073 6875  es expensive shu
-0002be60: 6666 6c65 7320 616e 6420 6973 2067 656e  ffles and is gen
-0002be70: 6572 616c 6c79 0a20 2020 2020 2020 206e  erally.        n
-0002be80: 6f74 2072 6563 6f6d 6d65 6e64 6564 2e20  ot recommended. 
-0002be90: 5365 6520 6060 7365 745f 696e 6465 7860  See ``set_index`
-0002bea0: 6020 666f 7220 696d 706c 656d 656e 7461  ` for implementa
-0002beb0: 7469 6f6e 2064 6574 6169 6c73 2e0a 0a20  tion details... 
-0002bec0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0002bed0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0002bee0: 2d2d 2d2d 0a20 2020 2020 2020 2062 793a  ----.        by:
-0002bef0: 2073 7472 206f 7220 6c69 7374 5b73 7472   str or list[str
-0002bf00: 5d0a 2020 2020 2020 2020 2020 2020 436f  ].            Co
-0002bf10: 6c75 6d6e 2873 2920 746f 2073 6f72 7420  lumn(s) to sort 
-0002bf20: 6279 2e0a 2020 2020 2020 2020 6e70 6172  by..        npar
-0002bf30: 7469 7469 6f6e 733a 2069 6e74 2c20 4e6f  titions: int, No
-0002bf40: 6e65 2c20 6f72 2027 6175 746f 270a 2020  ne, or 'auto'.  
-0002bf50: 2020 2020 2020 2020 2020 5468 6520 6964            The id
-0002bf60: 6561 6c20 6e75 6d62 6572 206f 6620 6f75  eal number of ou
-0002bf70: 7470 7574 2070 6172 7469 7469 6f6e 732e  tput partitions.
-0002bf80: 2049 6620 4e6f 6e65 2c20 7573 6520 7468   If None, use th
-0002bf90: 6520 7361 6d65 2061 730a 2020 2020 2020  e same as.      
-0002bfa0: 2020 2020 2020 7468 6520 696e 7075 742e        the input.
-0002bfb0: 2049 6620 2761 7574 6f27 2074 6865 6e20   If 'auto' then 
-0002bfc0: 6465 6369 6465 2062 7920 6d65 6d6f 7279  decide by memory
-0002bfd0: 2075 7365 2e0a 2020 2020 2020 2020 6173   use..        as
-0002bfe0: 6365 6e64 696e 673a 2062 6f6f 6c2c 206f  cending: bool, o
-0002bff0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-0002c000: 2020 2020 536f 7274 2061 7363 656e 6469      Sort ascendi
-0002c010: 6e67 2076 732e 2064 6573 6365 6e64 696e  ng vs. descendin
-0002c020: 672e 0a20 2020 2020 2020 2020 2020 2044  g..            D
-0002c030: 6566 6175 6c74 7320 746f 2054 7275 652e  efaults to True.
-0002c040: 0a20 2020 2020 2020 206e 615f 706f 7369  .        na_posi
-0002c050: 7469 6f6e 3a20 7b27 6c61 7374 272c 2027  tion: {'last', '
-0002c060: 6669 7273 7427 7d2c 206f 7074 696f 6e61  first'}, optiona
-0002c070: 6c0a 2020 2020 2020 2020 2020 2020 5075  l.            Pu
-0002c080: 7473 204e 614e 7320 6174 2074 6865 2062  ts NaNs at the b
-0002c090: 6567 696e 6e69 6e67 2069 6620 2766 6972  eginning if 'fir
-0002c0a0: 7374 272c 2070 7574 7320 4e61 4e20 6174  st', puts NaN at
-0002c0b0: 2074 6865 2065 6e64 2069 6620 276c 6173   the end if 'las
-0002c0c0: 7427 2e0a 2020 2020 2020 2020 2020 2020  t'..            
-0002c0d0: 4465 6661 756c 7473 2074 6f20 276c 6173  Defaults to 'las
-0002c0e0: 7427 2e0a 2020 2020 2020 2020 736f 7274  t'..        sort
-0002c0f0: 5f66 756e 6374 696f 6e3a 2066 756e 6374  _function: funct
-0002c100: 696f 6e2c 206f 7074 696f 6e61 6c0a 2020  ion, optional.  
-0002c110: 2020 2020 2020 2020 2020 536f 7274 696e            Sortin
-0002c120: 6720 6675 6e63 7469 6f6e 2074 6f20 7573  g function to us
-0002c130: 6520 7768 656e 2073 6f72 7469 6e67 2075  e when sorting u
-0002c140: 6e64 6572 6c79 696e 6720 7061 7274 6974  nderlying partit
-0002c150: 696f 6e73 2e0a 2020 2020 2020 2020 2020  ions..          
-0002c160: 2020 4966 204e 6f6e 652c 2064 6566 6175    If None, defau
-0002c170: 6c74 7320 746f 2060 604d 2e73 6f72 745f  lts to ``M.sort_
-0002c180: 7661 6c75 6573 6060 2028 7468 6520 7061  values`` (the pa
-0002c190: 7274 6974 696f 6e20 6c69 6272 6172 7927  rtition library'
-0002c1a0: 730a 2020 2020 2020 2020 2020 2020 696d  s.            im
-0002c1b0: 706c 656d 656e 7461 7469 6f6e 206f 6620  plementation of 
-0002c1c0: 6060 736f 7274 5f76 616c 7565 7360 6029  ``sort_values``)
-0002c1d0: 2e0a 2020 2020 2020 2020 736f 7274 5f66  ..        sort_f
-0002c1e0: 756e 6374 696f 6e5f 6b77 6172 6773 3a20  unction_kwargs: 
-0002c1f0: 6469 6374 2c20 6f70 7469 6f6e 616c 0a20  dict, optional. 
-0002c200: 2020 2020 2020 2020 2020 2041 6464 6974             Addit
-0002c210: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
-0002c220: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
-0002c230: 746f 2074 6865 2070 6172 7469 7469 6f6e  to the partition
-0002c240: 2073 6f72 7469 6e67 2066 756e 6374 696f   sorting functio
-0002c250: 6e2e 0a20 2020 2020 2020 2020 2020 2042  n..            B
-0002c260: 7920 6465 6661 756c 742c 2060 6062 7960  y default, ``by`
-0002c270: 602c 2060 6061 7363 656e 6469 6e67 6060  `, ``ascending``
-0002c280: 2c20 616e 6420 6060 6e61 5f70 6f73 6974  , and ``na_posit
-0002c290: 696f 6e60 6020 6172 6520 7072 6f76 6964  ion`` are provid
-0002c2a0: 6564 2e0a 0a20 2020 2020 2020 2045 7861  ed...        Exa
-0002c2b0: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-0002c2c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-0002c2d0: 3e3e 2064 6632 203d 2064 662e 736f 7274  >> df2 = df.sort
-0002c2e0: 5f76 616c 7565 7328 2778 2729 2020 2320  _values('x')  # 
-0002c2f0: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
-0002c300: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002c310: 2020 2066 726f 6d20 6461 736b 2e64 6174     from dask.dat
-0002c320: 6166 7261 6d65 2e73 6875 6666 6c65 2069  aframe.shuffle i
-0002c330: 6d70 6f72 7420 736f 7274 5f76 616c 7565  mport sort_value
-0002c340: 730a 0a20 2020 2020 2020 2072 6574 7572  s..        retur
-0002c350: 6e20 736f 7274 5f76 616c 7565 7328 0a20  n sort_values(. 
-0002c360: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-0002c370: 0a20 2020 2020 2020 2020 2020 2062 792c  .            by,
-0002c380: 0a20 2020 2020 2020 2020 2020 2061 7363  .            asc
-0002c390: 656e 6469 6e67 3d61 7363 656e 6469 6e67  ending=ascending
-0002c3a0: 2c0a 2020 2020 2020 2020 2020 2020 6e70  ,.            np
-0002c3b0: 6172 7469 7469 6f6e 733d 6e70 6172 7469  artitions=nparti
-0002c3c0: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
-0002c3d0: 2020 206e 615f 706f 7369 7469 6f6e 3d6e     na_position=n
-0002c3e0: 615f 706f 7369 7469 6f6e 2c0a 2020 2020  a_position,.    
-0002c3f0: 2020 2020 2020 2020 736f 7274 5f66 756e          sort_fun
-0002c400: 6374 696f 6e3d 736f 7274 5f66 756e 6374  ction=sort_funct
-0002c410: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0002c420: 2073 6f72 745f 6675 6e63 7469 6f6e 5f6b   sort_function_k
-0002c430: 7761 7267 733d 736f 7274 5f66 756e 6374  wargs=sort_funct
-0002c440: 696f 6e5f 6b77 6172 6773 2c0a 2020 2020  ion_kwargs,.    
-0002c450: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-0002c460: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-0002c470: 2064 6566 2073 6574 5f69 6e64 6578 280a   def set_index(.
-0002c480: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0002c490: 2020 2020 2020 6f74 6865 723a 2073 7472        other: str
-0002c4a0: 207c 2053 6572 6965 732c 0a20 2020 2020   | Series,.     
-0002c4b0: 2020 2064 726f 703a 2062 6f6f 6c20 3d20     drop: bool = 
-0002c4c0: 5472 7565 2c0a 2020 2020 2020 2020 736f  True,.        so
-0002c4d0: 7274 6564 3a20 626f 6f6c 203d 2046 616c  rted: bool = Fal
-0002c4e0: 7365 2c0a 2020 2020 2020 2020 6e70 6172  se,.        npar
-0002c4f0: 7469 7469 6f6e 733a 2069 6e74 207c 204c  titions: int | L
-0002c500: 6974 6572 616c 5b22 6175 746f 225d 207c  iteral["auto"] |
-0002c510: 204e 6f6e 6520 3d20 4e6f 6e65 2c0a 2020   None = None,.  
-0002c520: 2020 2020 2020 6469 7669 7369 6f6e 733a        divisions:
-0002c530: 2053 6571 7565 6e63 6520 7c20 4e6f 6e65   Sequence | None
-0002c540: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0002c550: 2069 6e70 6c61 6365 3a20 626f 6f6c 203d   inplace: bool =
-0002c560: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0002c570: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
-0002c580: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
-0002c590: 7468 6520 4461 7461 4672 616d 6520 696e  the DataFrame in
-0002c5a0: 6465 7820 2872 6f77 206c 6162 656c 7329  dex (row labels)
-0002c5b0: 2075 7369 6e67 2061 6e20 6578 6973 7469   using an existi
-0002c5c0: 6e67 2063 6f6c 756d 6e2e 0a0a 2020 2020  ng column...    
-0002c5d0: 2020 2020 5468 6973 2072 6561 6c69 676e      This realign
-0002c5e0: 7320 7468 6520 6461 7461 7365 7420 746f  s the dataset to
-0002c5f0: 2062 6520 736f 7274 6564 2062 7920 6120   be sorted by a 
-0002c600: 6e65 7720 636f 6c75 6d6e 2e20 5468 6973  new column. This
-0002c610: 2063 616e 2068 6176 6520 610a 2020 2020   can have a.    
-0002c620: 2020 2020 7369 676e 6966 6963 616e 7420      significant 
-0002c630: 696d 7061 6374 206f 6e20 7065 7266 6f72  impact on perfor
-0002c640: 6d61 6e63 652c 2062 6563 6175 7365 206a  mance, because j
-0002c650: 6f69 6e73 2c20 6772 6f75 7062 7973 2c20  oins, groupbys, 
-0002c660: 6c6f 6f6b 7570 732c 2065 7463 2e0a 2020  lookups, etc..  
-0002c670: 2020 2020 2020 6172 6520 616c 6c20 6d75        are all mu
-0002c680: 6368 2066 6173 7465 7220 6f6e 2074 6861  ch faster on tha
-0002c690: 7420 636f 6c75 6d6e 2e20 486f 7765 7665  t column. Howeve
-0002c6a0: 722c 2074 6869 7320 7065 7266 6f72 6d61  r, this performa
-0002c6b0: 6e63 6520 696e 6372 6561 7365 0a20 2020  nce increase.   
-0002c6c0: 2020 2020 2063 6f6d 6573 2077 6974 6820       comes with 
-0002c6d0: 6120 636f 7374 2c20 736f 7274 696e 6720  a cost, sorting 
-0002c6e0: 6120 7061 7261 6c6c 656c 2064 6174 6173  a parallel datas
-0002c6f0: 6574 2072 6571 7569 7265 7320 6578 7065  et requires expe
-0002c700: 6e73 6976 6520 7368 7566 666c 6573 2e0a  nsive shuffles..
-0002c710: 2020 2020 2020 2020 4f66 7465 6e20 7765          Often we
-0002c720: 2060 6073 6574 5f69 6e64 6578 6060 206f   ``set_index`` o
-0002c730: 6e63 6520 6469 7265 6374 6c79 2061 6674  nce directly aft
-0002c740: 6572 2064 6174 6120 696e 6765 7374 2061  er data ingest a
-0002c750: 6e64 2066 696c 7465 7269 6e67 2061 6e64  nd filtering and
-0002c760: 0a20 2020 2020 2020 2074 6865 6e20 7065  .        then pe
-0002c770: 7266 6f72 6d20 6d61 6e79 2063 6865 6170  rform many cheap
-0002c780: 2063 6f6d 7075 7461 7469 6f6e 7320 6f66   computations of
-0002c790: 6620 6f66 2074 6865 2073 6f72 7465 6420  f of the sorted 
-0002c7a0: 6461 7461 7365 742e 0a0a 2020 2020 2020  dataset...      
-0002c7b0: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-0002c7c0: 6f70 6572 6174 6573 2065 7861 6374 6c79  operates exactly
-0002c7d0: 206c 696b 6520 6060 7061 6e64 6173 2e73   like ``pandas.s
-0002c7e0: 6574 5f69 6e64 6578 6060 2065 7863 6570  et_index`` excep
-0002c7f0: 7420 7769 7468 0a20 2020 2020 2020 2064  t with.        d
-0002c800: 6966 6665 7265 6e74 2070 6572 666f 726d  ifferent perform
-0002c810: 616e 6365 2063 6f73 7473 2028 6461 736b  ance costs (dask
-0002c820: 2064 6174 6166 7261 6d65 2060 6073 6574   dataframe ``set
-0002c830: 5f69 6e64 6578 6060 2069 7320 6d75 6368  _index`` is much
-0002c840: 206d 6f72 6520 6578 7065 6e73 6976 6529   more expensive)
-0002c850: 2e0a 2020 2020 2020 2020 556e 6465 7220  ..        Under 
-0002c860: 6e6f 726d 616c 206f 7065 7261 7469 6f6e  normal operation
-0002c870: 2074 6869 7320 6675 6e63 7469 6f6e 2064   this function d
-0002c880: 6f65 7320 616e 2069 6e69 7469 616c 2070  oes an initial p
-0002c890: 6173 7320 6f76 6572 2074 6865 2069 6e64  ass over the ind
-0002c8a0: 6578 2063 6f6c 756d 6e0a 2020 2020 2020  ex column.      
-0002c8b0: 2020 746f 2063 6f6d 7075 7465 2061 7070    to compute app
-0002c8c0: 726f 7869 6d61 7465 2071 7561 6e74 696c  roximate quantil
-0002c8d0: 6573 2074 6f20 7365 7276 6520 6173 2066  es to serve as f
-0002c8e0: 7574 7572 6520 6469 7669 7369 6f6e 732e  uture divisions.
-0002c8f0: 2049 7420 7468 656e 2070 6173 7365 730a   It then passes.
-0002c900: 2020 2020 2020 2020 6f76 6572 2074 6865          over the
-0002c910: 2064 6174 6120 6120 7365 636f 6e64 2074   data a second t
-0002c920: 696d 652c 2073 706c 6974 7469 6e67 2075  ime, splitting u
-0002c930: 7020 6561 6368 2069 6e70 7574 2070 6172  p each input par
-0002c940: 7469 7469 6f6e 2069 6e74 6f20 7365 7665  tition into seve
-0002c950: 7261 6c0a 2020 2020 2020 2020 7069 6563  ral.        piec
-0002c960: 6573 2061 6e64 2073 6861 7269 6e67 2074  es and sharing t
-0002c970: 686f 7365 2070 6965 6365 7320 746f 2061  hose pieces to a
-0002c980: 6c6c 206f 6620 7468 6520 6f75 7470 7574  ll of the output
-0002c990: 2070 6172 7469 7469 6f6e 7320 6e6f 7720   partitions now 
-0002c9a0: 696e 0a20 2020 2020 2020 2073 6f72 7465  in.        sorte
-0002c9b0: 6420 6f72 6465 722e 0a0a 2020 2020 2020  d order...      
-0002c9c0: 2020 496e 2073 6f6d 6520 6361 7365 7320    In some cases 
-0002c9d0: 7765 2063 616e 2061 6c6c 6576 6961 7465  we can alleviate
-0002c9e0: 2074 686f 7365 2063 6f73 7473 2c20 666f   those costs, fo
-0002c9f0: 7220 6578 616d 706c 6520 6966 2079 6f75  r example if you
-0002ca00: 7220 6461 7461 7365 7420 6973 0a20 2020  r dataset is.   
-0002ca10: 2020 2020 2073 6f72 7465 6420 616c 7265       sorted alre
-0002ca20: 6164 7920 7468 656e 2077 6520 6361 6e20  ady then we can 
-0002ca30: 6176 6f69 6420 6d61 6b69 6e67 206d 616e  avoid making man
-0002ca40: 7920 736d 616c 6c20 7069 6563 6573 206f  y small pieces o
-0002ca50: 7220 6966 2079 6f75 206b 6e6f 770a 2020  r if you know.  
-0002ca60: 2020 2020 2020 676f 6f64 2076 616c 7565        good value
-0002ca70: 7320 746f 2073 706c 6974 2074 6865 206e  s to split the n
-0002ca80: 6577 2069 6e64 6578 2063 6f6c 756d 6e20  ew index column 
-0002ca90: 7468 656e 2077 6520 6361 6e20 6176 6f69  then we can avoi
-0002caa0: 6420 7468 6520 696e 6974 6961 6c0a 2020  d the initial.  
-0002cab0: 2020 2020 2020 7061 7373 206f 7665 7220        pass over 
-0002cac0: 7468 6520 6461 7461 2e20 466f 7220 6578  the data. For ex
-0002cad0: 616d 706c 6520 6966 2079 6f75 7220 6e65  ample if your ne
-0002cae0: 7720 696e 6465 7820 6973 2061 2064 6174  w index is a dat
-0002caf0: 6574 696d 6520 696e 6465 7820 616e 640a  etime index and.
-0002cb00: 2020 2020 2020 2020 796f 7572 2064 6174          your dat
-0002cb10: 6120 6973 2061 6c72 6561 6479 2073 6f72  a is already sor
-0002cb20: 7465 6420 6279 2064 6179 2074 6865 6e20  ted by day then 
-0002cb30: 7468 6973 2065 6e74 6972 6520 6f70 6572  this entire oper
-0002cb40: 6174 696f 6e20 6361 6e20 6265 2064 6f6e  ation can be don
-0002cb50: 650a 2020 2020 2020 2020 666f 7220 6672  e.        for fr
-0002cb60: 6565 2e20 596f 7520 6361 6e20 636f 6e74  ee. You can cont
-0002cb70: 726f 6c20 7468 6573 6520 6f70 7469 6f6e  rol these option
-0002cb80: 7320 7769 7468 2074 6865 2066 6f6c 6c6f  s with the follo
-0002cb90: 7769 6e67 2070 6172 616d 6574 6572 732e  wing parameters.
-0002cba0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0002cbb0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0002cbc0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0002cbd0: 6f74 6865 723a 2073 7472 696e 6720 6f72  other: string or
-0002cbe0: 2044 6173 6b20 5365 7269 6573 0a20 2020   Dask Series.   
-0002cbf0: 2020 2020 2020 2020 2043 6f6c 756d 6e20           Column 
-0002cc00: 746f 2075 7365 2061 7320 696e 6465 782e  to use as index.
-0002cc10: 0a20 2020 2020 2020 2064 726f 703a 2062  .        drop: b
-0002cc20: 6f6f 6c65 616e 2c20 6465 6661 756c 7420  oolean, default 
-0002cc30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0002cc40: 2044 656c 6574 6520 636f 6c75 6d6e 2074   Delete column t
-0002cc50: 6f20 6265 2075 7365 6420 6173 2074 6865  o be used as the
-0002cc60: 206e 6577 2069 6e64 6578 2e0a 2020 2020   new index..    
-0002cc70: 2020 2020 736f 7274 6564 3a20 626f 6f6c      sorted: bool
-0002cc80: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0002cc90: 2020 2020 2020 2049 6620 7468 6520 696e         If the in
-0002cca0: 6465 7820 636f 6c75 6d6e 2069 7320 616c  dex column is al
-0002ccb0: 7265 6164 7920 736f 7274 6564 2069 6e20  ready sorted in 
-0002ccc0: 696e 6372 6561 7369 6e67 206f 7264 6572  increasing order
-0002ccd0: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-0002cce0: 6661 756c 7473 2074 6f20 4661 6c73 650a  faults to False.
-0002ccf0: 2020 2020 2020 2020 6e70 6172 7469 7469          npartiti
-0002cd00: 6f6e 733a 2069 6e74 2c20 4e6f 6e65 2c20  ons: int, None, 
-0002cd10: 6f72 2027 6175 746f 270a 2020 2020 2020  or 'auto'.      
-0002cd20: 2020 2020 2020 5468 6520 6964 6561 6c20        The ideal 
-0002cd30: 6e75 6d62 6572 206f 6620 6f75 7470 7574  number of output
-0002cd40: 2070 6172 7469 7469 6f6e 732e 2049 6620   partitions. If 
-0002cd50: 4e6f 6e65 2c20 7573 6520 7468 6520 7361  None, use the sa
-0002cd60: 6d65 2061 730a 2020 2020 2020 2020 2020  me as.          
-0002cd70: 2020 7468 6520 696e 7075 742e 2049 6620    the input. If 
-0002cd80: 2761 7574 6f27 2074 6865 6e20 6465 6369  'auto' then deci
-0002cd90: 6465 2062 7920 6d65 6d6f 7279 2075 7365  de by memory use
-0002cda0: 2e0a 2020 2020 2020 2020 2020 2020 4f6e  ..            On
-0002cdb0: 6c79 2075 7365 6420 7768 656e 2060 6064  ly used when ``d
-0002cdc0: 6976 6973 696f 6e73 6060 2069 7320 6e6f  ivisions`` is no
-0002cdd0: 7420 6769 7665 6e2e 2049 6620 6060 6469  t given. If ``di
-0002cde0: 7669 7369 6f6e 7360 6020 6973 2067 6976  visions`` is giv
-0002cdf0: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
-0002ce00: 7468 6520 6e75 6d62 6572 206f 6620 6f75  the number of ou
-0002ce10: 7470 7574 2070 6172 7469 7469 6f6e 7320  tput partitions 
-0002ce20: 7769 6c6c 2062 6520 6060 6c65 6e28 6469  will be ``len(di
-0002ce30: 7669 7369 6f6e 7329 202d 2031 6060 2e0a  visions) - 1``..
-0002ce40: 2020 2020 2020 2020 6469 7669 7369 6f6e          division
-0002ce50: 733a 206c 6973 742c 206f 7074 696f 6e61  s: list, optiona
-0002ce60: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
-0002ce70: 6520 2264 6976 6964 696e 6720 6c69 6e65  e "dividing line
-0002ce80: 7322 2075 7365 6420 746f 2073 706c 6974  s" used to split
-0002ce90: 2074 6865 206e 6577 2069 6e64 6578 2069   the new index i
-0002cea0: 6e74 6f20 7061 7274 6974 696f 6e73 2e0a  nto partitions..
-0002ceb0: 2020 2020 2020 2020 2020 2020 466f 7220              For 
-0002cec0: 6060 6469 7669 7369 6f6e 733d 5b30 2c20  ``divisions=[0, 
-0002ced0: 3130 2c20 3530 2c20 3130 305d 6060 2c20  10, 50, 100]``, 
-0002cee0: 7468 6572 6520 776f 756c 6420 6265 2074  there would be t
-0002cef0: 6872 6565 206f 7574 7075 7420 7061 7274  hree output part
-0002cf00: 6974 696f 6e73 2c0a 2020 2020 2020 2020  itions,.        
-0002cf10: 2020 2020 7768 6572 6520 7468 6520 6e65      where the ne
-0002cf20: 7720 696e 6465 7820 636f 6e74 6169 6e65  w index containe
-0002cf30: 6420 5b30 2c20 3130 292c 205b 3130 2c20  d [0, 10), [10, 
-0002cf40: 3530 292c 2061 6e64 205b 3530 2c20 3130  50), and [50, 10
-0002cf50: 3029 2c20 7265 7370 6563 7469 7665 6c79  0), respectively
-0002cf60: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-0002cf70: 6520 6874 7470 733a 2f2f 646f 6373 2e64  e https://docs.d
-0002cf80: 6173 6b2e 6f72 672f 656e 2f6c 6174 6573  ask.org/en/lates
-0002cf90: 742f 6461 7461 6672 616d 652d 6465 7369  t/dataframe-desi
-0002cfa0: 676e 2e68 746d 6c23 7061 7274 6974 696f  gn.html#partitio
-0002cfb0: 6e73 2e0a 2020 2020 2020 2020 2020 2020  ns..            
-0002cfc0: 4966 206e 6f74 2067 6976 656e 2028 6465  If not given (de
-0002cfd0: 6661 756c 7429 2c20 676f 6f64 2064 6976  fault), good div
-0002cfe0: 6973 696f 6e73 2061 7265 2063 616c 6375  isions are calcu
-0002cff0: 6c61 7465 6420 6279 2069 6d6d 6564 6961  lated by immedia
-0002d000: 7465 6c79 2063 6f6d 7075 7469 6e67 0a20  tely computing. 
-0002d010: 2020 2020 2020 2020 2020 2074 6865 2064             the d
-0002d020: 6174 6120 616e 6420 6c6f 6f6b 696e 6720  ata and looking 
-0002d030: 6174 2074 6865 2064 6973 7472 6962 7574  at the distribut
-0002d040: 696f 6e20 6f66 2069 7473 2076 616c 7565  ion of its value
-0002d050: 732e 2046 6f72 206c 6172 6765 2064 6174  s. For large dat
-0002d060: 6173 6574 732c 0a20 2020 2020 2020 2020  asets,.         
-0002d070: 2020 2074 6869 7320 6361 6e20 6265 2065     this can be e
-0002d080: 7870 656e 7369 7665 2e0a 2020 2020 2020  xpensive..      
-0002d090: 2020 2020 2020 4e6f 7465 2074 6861 7420        Note that 
-0002d0a0: 6966 2060 6073 6f72 7465 643d 5472 7565  if ``sorted=True
-0002d0b0: 6060 2c20 7370 6563 6966 6965 6420 6469  ``, specified di
-0002d0c0: 7669 7369 6f6e 7320 6172 6520 6173 7375  visions are assu
-0002d0d0: 6d65 6420 746f 206d 6174 6368 0a20 2020  med to match.   
-0002d0e0: 2020 2020 2020 2020 2074 6865 2065 7869           the exi
-0002d0f0: 7374 696e 6720 7061 7274 6974 696f 6e73  sting partitions
-0002d100: 2069 6e20 7468 6520 6461 7461 3b20 6966   in the data; if
-0002d110: 2074 6869 7320 6973 2075 6e74 7275 6520   this is untrue 
-0002d120: 796f 7520 7368 6f75 6c64 0a20 2020 2020  you should.     
-0002d130: 2020 2020 2020 206c 6561 7665 2064 6976         leave div
-0002d140: 6973 696f 6e73 2065 6d70 7479 2061 6e64  isions empty and
-0002d150: 2063 616c 6c20 6060 7265 7061 7274 6974   call ``repartit
-0002d160: 696f 6e60 6020 6166 7465 7220 6060 7365  ion`` after ``se
-0002d170: 745f 696e 6465 7860 602e 0a20 2020 2020  t_index``..     
-0002d180: 2020 2069 6e70 6c61 6365 3a20 626f 6f6c     inplace: bool
-0002d190: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0002d1a0: 2020 2020 2020 204d 6f64 6966 7969 6e67         Modifying
-0002d1b0: 2074 6865 2044 6174 6146 7261 6d65 2069   the DataFrame i
-0002d1c0: 6e20 706c 6163 6520 6973 206e 6f74 2073  n place is not s
-0002d1d0: 7570 706f 7274 6564 2062 7920 4461 736b  upported by Dask
-0002d1e0: 2e0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-0002d1f0: 6661 756c 7473 2074 6f20 4661 6c73 652e  faults to False.
-0002d200: 0a20 2020 2020 2020 2073 6875 6666 6c65  .        shuffle
-0002d210: 3a20 7374 7269 6e67 2c20 2764 6973 6b27  : string, 'disk'
-0002d220: 206f 7220 2774 6173 6b73 272c 206f 7074   or 'tasks', opt
-0002d230: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-0002d240: 2020 4569 7468 6572 2060 6027 6469 736b    Either ``'disk
-0002d250: 2760 6020 666f 7220 7369 6e67 6c65 2d6e  '`` for single-n
-0002d260: 6f64 6520 6f70 6572 6174 696f 6e20 6f72  ode operation or
-0002d270: 2060 6027 7461 736b 7327 6060 2066 6f72   ``'tasks'`` for
-0002d280: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
-0002d290: 7472 6962 7574 6564 206f 7065 7261 7469  tributed operati
-0002d2a0: 6f6e 2e20 2057 696c 6c20 6265 2069 6e66  on.  Will be inf
-0002d2b0: 6572 7265 6420 6279 2079 6f75 7220 6375  erred by your cu
-0002d2c0: 7272 656e 7420 7363 6865 6475 6c65 722e  rrent scheduler.
-0002d2d0: 0a20 2020 2020 2020 2063 6f6d 7075 7465  .        compute
-0002d2e0: 3a20 626f 6f6c 2c20 6465 6661 756c 7420  : bool, default 
-0002d2f0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0002d300: 2020 5768 6574 6865 7220 6f72 206e 6f74    Whether or not
-0002d310: 2074 6f20 7472 6967 6765 7220 616e 2069   to trigger an i
-0002d320: 6d6d 6564 6961 7465 2063 6f6d 7075 7461  mmediate computa
-0002d330: 7469 6f6e 2e20 4465 6661 756c 7473 2074  tion. Defaults t
-0002d340: 6f20 4661 6c73 652e 0a20 2020 2020 2020  o False..       
-0002d350: 2020 2020 204e 6f74 652c 2074 6861 7420       Note, that 
-0002d360: 6576 656e 2069 6620 796f 7520 7365 7420  even if you set 
-0002d370: 6060 636f 6d70 7574 653d 4661 6c73 6560  ``compute=False`
-0002d380: 602c 2061 6e20 696d 6d65 6469 6174 6520  `, an immediate 
-0002d390: 636f 6d70 7574 6174 696f 6e0a 2020 2020  computation.    
-0002d3a0: 2020 2020 2020 2020 7769 6c6c 2073 7469          will sti
-0002d3b0: 6c6c 2062 6520 7472 6967 6765 7265 6420  ll be triggered 
-0002d3c0: 6966 2060 6064 6976 6973 696f 6e73 6060  if ``divisions``
-0002d3d0: 2069 7320 6060 4e6f 6e65 6060 2e0a 2020   is ``None``..  
-0002d3e0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
-0002d3f0: 7369 7a65 3a20 696e 742c 206f 7074 696f  size: int, optio
-0002d400: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0002d410: 4465 7369 7265 6420 7369 7a65 206f 6620  Desired size of 
-0002d420: 6561 6368 2070 6172 7469 7469 6f6e 7320  each partitions 
-0002d430: 696e 2062 7974 6573 2e0a 2020 2020 2020  in bytes..      
-0002d440: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
-0002d450: 7768 656e 2060 606e 7061 7274 6974 696f  when ``npartitio
-0002d460: 6e73 3d27 6175 746f 2760 600a 0a20 2020  ns='auto'``..   
-0002d470: 2020 2020 2045 7861 6d70 6c65 730a 2020       Examples.  
-0002d480: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-0002d490: 2020 2020 2020 203e 3e3e 2069 6d70 6f72         >>> impor
-0002d4a0: 7420 6461 736b 0a20 2020 2020 2020 203e  t dask.        >
-0002d4b0: 3e3e 2064 6466 203d 2064 6173 6b2e 6461  >> ddf = dask.da
-0002d4c0: 7461 7365 7473 2e74 696d 6573 6572 6965  tasets.timeserie
-0002d4d0: 7328 7374 6172 743d 2232 3032 312d 3031  s(start="2021-01
-0002d4e0: 2d30 3122 2c20 656e 643d 2232 3032 312d  -01", end="2021-
-0002d4f0: 3031 2d30 3722 2c20 6672 6571 3d22 3148  01-07", freq="1H
-0002d500: 2229 2e72 6573 6574 5f69 6e64 6578 2829  ").reset_index()
-0002d510: 0a20 2020 2020 2020 203e 3e3e 2064 6466  .        >>> ddf
-0002d520: 3220 3d20 6464 662e 7365 745f 696e 6465  2 = ddf.set_inde
-0002d530: 7828 2278 2229 0a20 2020 2020 2020 203e  x("x").        >
-0002d540: 3e3e 2064 6466 3220 3d20 6464 662e 7365  >> ddf2 = ddf.se
-0002d550: 745f 696e 6465 7828 6464 662e 7829 0a20  t_index(ddf.x). 
-0002d560: 2020 2020 2020 203e 3e3e 2064 6466 3220         >>> ddf2 
-0002d570: 3d20 6464 662e 7365 745f 696e 6465 7828  = ddf.set_index(
-0002d580: 6464 662e 7469 6d65 7374 616d 702c 2073  ddf.timestamp, s
-0002d590: 6f72 7465 643d 5472 7565 290a 0a20 2020  orted=True)..   
-0002d5a0: 2020 2020 2041 2063 6f6d 6d6f 6e20 6361       A common ca
-0002d5b0: 7365 2069 7320 7768 656e 2077 6520 6861  se is when we ha
-0002d5c0: 7665 2061 2064 6174 6574 696d 6520 636f  ve a datetime co
-0002d5d0: 6c75 6d6e 2074 6861 7420 7765 206b 6e6f  lumn that we kno
-0002d5e0: 7720 746f 2062 650a 2020 2020 2020 2020  w to be.        
-0002d5f0: 736f 7274 6564 2061 6e64 2069 7320 636c  sorted and is cl
-0002d600: 6561 6e6c 7920 6469 7669 6465 6420 6279  eanly divided by
-0002d610: 2064 6179 2e20 2057 6520 6361 6e20 7365   day.  We can se
-0002d620: 7420 7468 6973 2069 6e64 6578 2066 6f72  t this index for
-0002d630: 2066 7265 650a 2020 2020 2020 2020 6279   free.        by
-0002d640: 2073 7065 6369 6679 696e 6720 626f 7468   specifying both
-0002d650: 2074 6861 7420 7468 6520 636f 6c75 6d6e   that the column
-0002d660: 2069 7320 7072 652d 736f 7274 6564 2061   is pre-sorted a
-0002d670: 6e64 2074 6865 2070 6172 7469 6375 6c61  nd the particula
-0002d680: 720a 2020 2020 2020 2020 6469 7669 7369  r.        divisi
-0002d690: 6f6e 7320 616c 6f6e 6720 7768 6963 6820  ons along which 
-0002d6a0: 6973 2069 7320 7365 7061 7261 7465 640a  is is separated.
-0002d6b0: 0a20 2020 2020 2020 203e 3e3e 2069 6d70  .        >>> imp
-0002d6c0: 6f72 7420 7061 6e64 6173 2061 7320 7064  ort pandas as pd
-0002d6d0: 0a20 2020 2020 2020 203e 3e3e 2064 6976  .        >>> div
-0002d6e0: 6973 696f 6e73 203d 2070 642e 6461 7465  isions = pd.date
-0002d6f0: 5f72 616e 6765 2873 7461 7274 3d22 3230  _range(start="20
-0002d700: 3231 2d30 312d 3031 222c 2065 6e64 3d22  21-01-01", end="
-0002d710: 3230 3231 2d30 312d 3037 222c 2066 7265  2021-01-07", fre
-0002d720: 713d 2731 4427 290a 2020 2020 2020 2020  q='1D').        
-0002d730: 3e3e 3e20 6469 7669 7369 6f6e 730a 2020  >>> divisions.  
-0002d740: 2020 2020 2020 4461 7465 7469 6d65 496e        DatetimeIn
-0002d750: 6465 7828 5b27 3230 3231 2d30 312d 3031  dex(['2021-01-01
-0002d760: 272c 2027 3230 3231 2d30 312d 3032 272c  ', '2021-01-02',
-0002d770: 2027 3230 3231 2d30 312d 3033 272c 2027   '2021-01-03', '
-0002d780: 3230 3231 2d30 312d 3034 272c 0a20 2020  2021-01-04',.   
-0002d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7a0: 2020 2020 2732 3032 312d 3031 2d30 3527      '2021-01-05'
-0002d7b0: 2c20 2732 3032 312d 3031 2d30 3627 2c20  , '2021-01-06', 
-0002d7c0: 2732 3032 312d 3031 2d30 3727 5d2c 0a20  '2021-01-07'],. 
-0002d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d7e0: 2020 2020 2064 7479 7065 3d27 6461 7465       dtype='date
-0002d7f0: 7469 6d65 3634 5b6e 735d 272c 2066 7265  time64[ns]', fre
-0002d800: 713d 2744 2729 0a0a 2020 2020 2020 2020  q='D')..        
-0002d810: 4e6f 7465 2074 6861 7420 6060 6c65 6e28  Note that ``len(
-0002d820: 6469 7669 736f 6e73 2960 6020 6973 2065  divisons)`` is e
-0002d830: 7175 616c 2074 6f20 6060 6e70 6172 7469  qual to ``nparti
-0002d840: 7469 6f6e 7320 2b20 3160 602e 2054 6869  tions + 1``. Thi
-0002d850: 7320 6973 2062 6563 6175 7365 2060 6064  s is because ``d
-0002d860: 6976 6973 696f 6e73 6060 0a20 2020 2020  ivisions``.     
-0002d870: 2020 2072 6570 7265 7365 6e74 7320 7468     represents th
-0002d880: 6520 7570 7065 7220 616e 6420 6c6f 7765  e upper and lowe
-0002d890: 7220 626f 756e 6473 206f 6620 6561 6368  r bounds of each
-0002d8a0: 2070 6172 7469 7469 6f6e 2e20 5468 6520   partition. The 
-0002d8b0: 6669 7273 7420 6974 656d 2069 7320 7468  first item is th
-0002d8c0: 650a 2020 2020 2020 2020 6c6f 7765 7220  e.        lower 
-0002d8d0: 626f 756e 6420 6f66 2074 6865 2066 6972  bound of the fir
-0002d8e0: 7374 2070 6172 7469 7469 6f6e 2c20 7468  st partition, th
-0002d8f0: 6520 7365 636f 6e64 2069 7465 6d20 6973  e second item is
-0002d900: 2074 6865 206c 6f77 6572 2062 6f75 6e64   the lower bound
-0002d910: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-0002d920: 7365 636f 6e64 2070 6172 7469 7469 6f6e  second partition
-0002d930: 2061 6e64 2074 6865 2075 7070 6572 2062   and the upper b
-0002d940: 6f75 6e64 206f 6620 7468 6520 6669 7273  ound of the firs
-0002d950: 7420 7061 7274 6974 696f 6e2c 2061 6e64  t partition, and
-0002d960: 2073 6f20 6f6e 2e0a 2020 2020 2020 2020   so on..        
-0002d970: 5468 6520 7365 636f 6e64 2d74 6f2d 6c61  The second-to-la
-0002d980: 7374 2069 7465 6d20 6973 2074 6865 206c  st item is the l
-0002d990: 6f77 6572 2062 6f75 6e64 206f 6620 7468  ower bound of th
-0002d9a0: 6520 6c61 7374 2070 6172 7469 7469 6f6e  e last partition
-0002d9b0: 2c20 616e 6420 7468 6520 6c61 7374 0a20  , and the last. 
-0002d9c0: 2020 2020 2020 2028 6578 7472 6129 2069         (extra) i
-0002d9d0: 7465 6d20 6973 2074 6865 2075 7070 6572  tem is the upper
-0002d9e0: 2062 6f75 6e64 206f 6620 7468 6520 6c61   bound of the la
-0002d9f0: 7374 2070 6172 7469 7469 6f6e 2e0a 0a20  st partition... 
-0002da00: 2020 2020 2020 203e 3e3e 2064 6466 3220         >>> ddf2 
-0002da10: 3d20 6464 662e 7365 745f 696e 6465 7828  = ddf.set_index(
-0002da20: 2274 696d 6573 7461 6d70 222c 2073 6f72  "timestamp", sor
-0002da30: 7465 643d 5472 7565 2c20 6469 7669 7369  ted=True, divisi
-0002da40: 6f6e 733d 6469 7669 7369 6f6e 732e 746f  ons=divisions.to
-0002da50: 6c69 7374 2829 290a 0a20 2020 2020 2020  list())..       
-0002da60: 2049 6620 796f 7527 6c6c 2062 6520 7275   If you'll be ru
-0002da70: 6e6e 696e 6720 6073 6574 5f69 6e64 6578  nning `set_index
-0002da80: 6020 6f6e 2074 6865 2073 616d 6520 286f  ` on the same (o
-0002da90: 7220 7369 6d69 6c61 7229 2064 6174 6173  r similar) datas
-0002daa0: 6574 7320 7265 7065 6174 6564 6c79 2c0a  ets repeatedly,.
-0002dab0: 2020 2020 2020 2020 796f 7520 636f 756c          you coul
-0002dac0: 6420 7361 7665 2074 696d 6520 6279 206c  d save time by l
-0002dad0: 6574 7469 6e67 2044 6173 6b20 6361 6c63  etting Dask calc
-0002dae0: 756c 6174 6520 676f 6f64 2064 6976 6973  ulate good divis
-0002daf0: 696f 6e73 206f 6e63 652c 2074 6865 6e20  ions once, then 
-0002db00: 636f 7079 2d70 6173 7469 6e67 0a20 2020  copy-pasting.   
-0002db10: 2020 2020 2074 6865 6d20 746f 2072 6575       them to reu
-0002db20: 7365 2e20 5468 6973 2069 7320 6573 7065  se. This is espe
-0002db30: 6369 616c 6c79 2068 656c 7066 756c 2072  cially helpful r
-0002db40: 756e 6e69 6e67 2069 6e20 6120 4a75 7079  unning in a Jupy
-0002db50: 7465 7220 6e6f 7465 626f 6f6b 3a0a 0a20  ter notebook:.. 
-0002db60: 2020 2020 2020 203e 3e3e 2064 6466 3220         >>> ddf2 
-0002db70: 3d20 6464 662e 7365 745f 696e 6465 7828  = ddf.set_index(
-0002db80: 226e 616d 6522 2920 2023 2073 6c6f 772c  "name")  # slow,
-0002db90: 2063 616c 6375 6c61 7465 7320 6461 7461   calculates data
-0002dba0: 2064 6973 7472 6962 7574 696f 6e0a 2020   distribution.  
-0002dbb0: 2020 2020 2020 3e3e 3e20 6464 6632 2e64        >>> ddf2.d
-0002dbc0: 6976 6973 696f 6e73 2020 2320 646f 6374  ivisions  # doct
-0002dbd0: 6573 743a 202b 534b 4950 0a20 2020 2020  est: +SKIP.     
-0002dbe0: 2020 205b 2241 6c69 6365 222c 2022 4c61     ["Alice", "La
-0002dbf0: 7572 6122 2c20 2255 7273 756c 6122 2c20  ura", "Ursula", 
-0002dc00: 225a 656c 6461 225d 0a20 2020 2020 2020  "Zelda"].       
-0002dc10: 203e 3e3e 2023 205e 204e 6f77 2063 6f70   >>> # ^ Now cop
-0002dc20: 792d 7061 7374 6520 7468 6973 2061 6e64  y-paste this and
-0002dc30: 2065 6469 7420 7468 6520 6c69 6e65 2061   edit the line a
-0002dc40: 626f 7665 2074 6f3a 0a20 2020 2020 2020  bove to:.       
-0002dc50: 203e 3e3e 2023 2064 6466 3220 3d20 6464   >>> # ddf2 = dd
-0002dc60: 662e 7365 745f 696e 6465 7828 226e 616d  f.set_index("nam
-0002dc70: 6522 2c20 6469 7669 7369 6f6e 733d 5b22  e", divisions=["
-0002dc80: 416c 6963 6522 2c20 224c 6175 7261 222c  Alice", "Laura",
-0002dc90: 2022 5572 7375 6c61 222c 2022 5a65 6c64   "Ursula", "Zeld
-0002dca0: 6122 5d29 0a20 2020 2020 2020 2022 2222  a"]).        """
-0002dcb0: 0a0a 2020 2020 2020 2020 6966 2069 6e70  ..        if inp
-0002dcc0: 6c61 6365 3a0a 2020 2020 2020 2020 2020  lace:.          
-0002dcd0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-0002dce0: 6d65 6e74 6564 4572 726f 7228 2254 6865  mentedError("The
-0002dcf0: 2069 6e70 6c61 6365 3d20 6b65 7977 6f72   inplace= keywor
-0002dd00: 6420 6973 206e 6f74 2073 7570 706f 7274  d is not support
-0002dd10: 6564 2229 0a20 2020 2020 2020 2070 7265  ed").        pre
-0002dd20: 5f73 6f72 7465 6420 3d20 736f 7274 6564  _sorted = sorted
-0002dd30: 0a20 2020 2020 2020 2064 656c 2073 6f72  .        del sor
-0002dd40: 7465 640a 0a20 2020 2020 2020 2023 2043  ted..        # C
-0002dd50: 6865 636b 206f 7468 6572 2063 616e 2062  heck other can b
-0002dd60: 6520 7472 616e 736c 6174 6564 2074 6f20  e translated to 
-0002dd70: 636f 6c75 6d6e 206e 616d 6520 6f72 2063  column name or c
-0002dd80: 6f6c 756d 6e20 6f62 6a65 6374 2c20 706f  olumn object, po
-0002dd90: 7373 6962 6c79 2066 6c61 7474 656e 696e  ssibly flattenin
-0002dda0: 6720 6974 0a20 2020 2020 2020 2069 6620  g it.        if 
-0002ddb0: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
-0002ddc0: 7468 6572 2c20 7374 7229 3a0a 2020 2020  ther, str):.    
-0002ddd0: 2020 2020 2020 2020 2320 4974 206d 6179          # It may
-0002dde0: 2072 6566 6572 2074 6f20 7365 7665 7261   refer to severa
-0002ddf0: 6c20 636f 6c75 6d6e 730a 2020 2020 2020  l columns.      
-0002de00: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002de10: 6e63 6528 6f74 6865 722c 2053 6571 7565  nce(other, Seque
-0002de20: 6e63 6529 3a20 2023 2074 7970 653a 2069  nce):  # type: i
-0002de30: 676e 6f72 655b 756e 7265 6163 6861 626c  gnore[unreachabl
-0002de40: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
-0002de50: 2020 2023 2041 6363 6570 7420 5b22 6122     # Accept ["a"
-0002de60: 5d2c 2062 7574 206e 6f74 205b 5b22 6122  ], but not [["a"
-0002de70: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-0002de80: 2020 2069 6620 6c65 6e28 6f74 6865 7229     if len(other)
-0002de90: 203d 3d20 3120 616e 6420 2820 2023 2074   == 1 and (  # t
-0002dea0: 7970 653a 2069 676e 6f72 655b 756e 7265  ype: ignore[unre
-0002deb0: 6163 6861 626c 655d 0a20 2020 2020 2020  achable].       
-0002dec0: 2020 2020 2020 2020 2020 2020 2069 7369               isi
-0002ded0: 6e73 7461 6e63 6528 6f74 6865 725b 305d  nstance(other[0]
-0002dee0: 2c20 7374 7229 206f 7220 6e6f 7420 6973  , str) or not is
-0002def0: 696e 7374 616e 6365 286f 7468 6572 5b30  instance(other[0
-0002df00: 5d2c 2053 6571 7565 6e63 6529 0a20 2020  ], Sequence).   
-0002df10: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-0002df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df30: 2020 2020 6f74 6865 7220 3d20 6f74 6865      other = othe
-0002df40: 725b 305d 0a20 2020 2020 2020 2020 2020  r[0].           
-0002df50: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002df60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002df70: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-0002df80: 7465 6445 7272 6f72 280a 2020 2020 2020  tedError(.      
-0002df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dfa0: 2020 2244 6173 6b20 6461 7461 6672 616d    "Dask datafram
-0002dfb0: 6520 646f 6573 206e 6f74 2079 6574 2073  e does not yet s
-0002dfc0: 7570 706f 7274 206d 756c 7469 2d69 6e64  upport multi-ind
-0002dfd0: 6578 6573 2e5c 6e22 0a20 2020 2020 2020  exes.\n".       
-0002dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dff0: 2066 2259 6f75 2074 7269 6564 2074 6f20   f"You tried to 
-0002e000: 696e 6465 7820 7769 7468 2074 6869 7320  index with this 
-0002e010: 696e 6465 783a 207b 6f74 6865 727d 5c6e  index: {other}\n
-0002e020: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002e030: 2020 2020 2020 2020 2020 2249 6e64 6578            "Index
-0002e040: 6573 206d 7573 7420 6265 2073 696e 676c  es must be singl
-0002e050: 6520 636f 6c75 6d6e 7320 6f6e 6c79 2e22  e columns only."
-0002e060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e070: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002e080: 2020 2020 2320 4f72 2062 6520 6120 6672      # Or be a fr
-0002e090: 616d 6520 6469 7265 6374 6c79 0a20 2020  ame directly.   
-0002e0a0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-0002e0b0: 696e 7374 616e 6365 286f 7468 6572 2c20  instance(other, 
-0002e0c0: 4461 7461 4672 616d 6529 3a20 2023 2074  DataFrame):  # t
-0002e0d0: 7970 653a 2069 676e 6f72 655b 756e 7265  ype: ignore[unre
-0002e0e0: 6163 6861 626c 655d 0a20 2020 2020 2020  achable].       
-0002e0f0: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-0002e100: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-0002e110: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0002e120: 2020 2020 2020 2020 2244 6173 6b20 6461          "Dask da
-0002e130: 7461 6672 616d 6520 646f 6573 206e 6f74  taframe does not
-0002e140: 2079 6574 2073 7570 706f 7274 206d 756c   yet support mul
-0002e150: 7469 2d69 6e64 6578 6573 2e5c 6e22 0a20  ti-indexes.\n". 
-0002e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e170: 2020 2066 2259 6f75 2074 7269 6564 2074     f"You tried t
-0002e180: 6f20 696e 6465 7820 7769 7468 2061 2066  o index with a f
-0002e190: 7261 6d65 2077 6974 6820 7468 6573 6520  rame with these 
-0002e1a0: 636f 6c75 6d6e 733a 207b 6c69 7374 286f  columns: {list(o
-0002e1b0: 7468 6572 2e63 6f6c 756d 6e73 297d 5c6e  ther.columns)}\n
-0002e1c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002e1d0: 2020 2020 2020 2249 6e64 6578 6573 206d        "Indexes m
-0002e1e0: 7573 7420 6265 2073 696e 676c 6520 636f  ust be single co
-0002e1f0: 6c75 6d6e 7320 6f6e 6c79 2e22 0a20 2020  lumns only.".   
-0002e200: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0002e210: 2020 2020 2020 2020 2320 4966 2061 6c72          # If alr
-0002e220: 6561 6479 2061 2073 6572 6965 730a 2020  eady a series.  
-0002e230: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0002e240: 6e63 6528 6f74 6865 722c 2053 6572 6965  nce(other, Serie
-0002e250: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0002e260: 2320 4966 2069 7427 7320 616c 7265 6164  # If it's alread
-0002e270: 7920 7468 6520 696e 6465 782c 2074 6865  y the index, the
-0002e280: 7265 2773 206e 6f74 6869 6e67 2074 6f20  re's nothing to 
-0002e290: 646f 0a20 2020 2020 2020 2020 2020 2069  do.            i
-0002e2a0: 6620 6f74 6865 722e 5f6e 616d 6520 3d3d  f other._name ==
-0002e2b0: 2073 656c 662e 696e 6465 782e 5f6e 616d   self.index._nam
-0002e2c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002e2d0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-0002e2e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002e2f0: 2020 2020 2020 224e 6577 2069 6e64 6578        "New index
-0002e300: 2068 6173 2073 616d 6520 6e61 6d65 2061   has same name a
-0002e310: 7320 6578 6973 7469 6e67 2c20 7468 6973  s existing, this
-0002e320: 2069 7320 6120 6e6f 2d6f 702e 222c 2055   is a no-op.", U
-0002e330: 7365 7257 6172 6e69 6e67 0a20 2020 2020  serWarning.     
-0002e340: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0002e350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0002e360: 7572 6e20 7365 6c66 0a0a 2020 2020 2020  urn self..      
-0002e370: 2020 2320 4966 2074 6865 206e 616d 6520    # If the name 
-0002e380: 6f66 2061 2063 6f6c 756d 6e2f 696e 6465  of a column/inde
-0002e390: 780a 2020 2020 2020 2020 656c 7365 3a0a  x.        else:.
-0002e3a0: 2020 2020 2020 2020 2020 2020 2320 5769              # Wi
-0002e3b0: 7468 2074 6865 2073 616d 6520 6e61 6d65  th the same name
-0002e3c0: 2061 7320 7468 6520 696e 6465 782c 2074   as the index, t
-0002e3d0: 6865 7265 2773 206e 6f74 6869 6e67 2074  here's nothing t
-0002e3e0: 6f20 646f 2065 6974 6865 720a 2020 2020  o do either.    
-0002e3f0: 2020 2020 2020 2020 6966 206f 7468 6572          if other
-0002e400: 203d 3d20 7365 6c66 2e69 6e64 6578 2e6e   == self.index.n
-0002e410: 616d 653a 0a20 2020 2020 2020 2020 2020  ame:.           
-0002e420: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-0002e430: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
-0002e440: 2020 2020 2020 2020 224e 6577 2069 6e64          "New ind
-0002e450: 6578 2068 6173 2073 616d 6520 6e61 6d65  ex has same name
-0002e460: 2061 7320 6578 6973 7469 6e67 2c20 7468   as existing, th
-0002e470: 6973 2069 7320 6120 6e6f 2d6f 702e 222c  is is a no-op.",
-0002e480: 2055 7365 7257 6172 6e69 6e67 0a20 2020   UserWarning.   
-0002e490: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002e4a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002e4b0: 6574 7572 6e20 7365 6c66 0a0a 2020 2020  eturn self..    
-0002e4c0: 2020 2020 2020 2020 2320 4966 2061 206d          # If a m
-0002e4d0: 6973 7369 6e67 2063 6f6c 756d 6e2c 204b  issing column, K
-0002e4e0: 6579 4572 726f 720a 2020 2020 2020 2020  eyError.        
-0002e4f0: 2020 2020 6966 206f 7468 6572 206e 6f74      if other not
-0002e500: 2069 6e20 7365 6c66 2e63 6f6c 756d 6e73   in self.columns
-0002e510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002e520: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-0002e530: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002e540: 2020 2020 2020 6622 4461 7461 2068 6173        f"Data has
-0002e550: 206e 6f20 636f 6c75 6d6e 2027 7b6f 7468   no column '{oth
-0002e560: 6572 7d27 3a20 7573 6520 616e 7920 636f  er}': use any co
-0002e570: 6c75 6d6e 206f 6620 7b6c 6973 7428 7365  lumn of {list(se
-0002e580: 6c66 2e63 6f6c 756d 6e73 297d 220a 2020  lf.columns)}".  
-0002e590: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0002e5a0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0002e5b0: 2064 6976 6973 696f 6e73 0a20 2020 2020   divisions.     
-0002e5c0: 2020 2069 6620 6469 7669 7369 6f6e 7320     if divisions 
-0002e5d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0002e5e0: 2020 2020 2020 2020 2063 6865 636b 5f64           check_d
-0002e5f0: 6976 6973 696f 6e73 2864 6976 6973 696f  ivisions(divisio
-0002e600: 6e73 290a 2020 2020 2020 2020 656c 6966  ns).        elif
-0002e610: 2028 0a20 2020 2020 2020 2020 2020 2069   (.            i
-0002e620: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
-0002e630: 2049 6e64 6578 290a 2020 2020 2020 2020   Index).        
-0002e640: 2020 2020 616e 6420 6f74 6865 722e 6b6e      and other.kn
-0002e650: 6f77 6e5f 6469 7669 7369 6f6e 730a 2020  own_divisions.  
-0002e660: 2020 2020 2020 2020 2020 616e 6420 6f74            and ot
-0002e670: 6865 722e 6e70 6172 7469 7469 6f6e 7320  her.npartitions 
-0002e680: 3d3d 2073 656c 662e 6e70 6172 7469 7469  == self.npartiti
-0002e690: 6f6e 730a 2020 2020 2020 2020 293a 0a20  ons.        ):. 
-0002e6a0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0002e6b0: 7468 6520 696e 6465 7820 6861 7320 7468  the index has th
-0002e6c0: 6520 7361 6d65 206e 756d 6265 7220 6f66  e same number of
-0002e6d0: 2070 6172 7469 7469 6f6e 7320 616e 6420   partitions and 
-0002e6e0: 6b6e 6f77 6e0a 2020 2020 2020 2020 2020  known.          
-0002e6f0: 2020 2320 6469 7669 7369 6f6e 732c 2074    # divisions, t
-0002e700: 6865 6e20 7765 2063 616e 2074 7265 6174  hen we can treat
-0002e710: 2069 7420 6173 2070 7265 2d73 6f72 7465   it as pre-sorte
-0002e720: 6420 7769 7468 206b 6e6f 776e 0a20 2020  d with known.   
-0002e730: 2020 2020 2020 2020 2023 2064 6976 6973           # divis
-0002e740: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0002e750: 2070 7265 5f73 6f72 7465 6420 3d20 5472   pre_sorted = Tr
-0002e760: 7565 0a20 2020 2020 2020 2020 2020 2064  ue.            d
-0002e770: 6976 6973 696f 6e73 203d 206f 7468 6572  ivisions = other
-0002e780: 2e64 6976 6973 696f 6e73 0a0a 2020 2020  .divisions..    
-0002e790: 2020 2020 2320 4966 2069 6e64 6578 2069      # If index i
-0002e7a0: 7320 616c 7265 6164 7920 736f 7274 6564  s already sorted
-0002e7b0: 2c20 7461 6b65 2061 6476 616e 7461 6765  , take advantage
-0002e7c0: 206f 6620 7468 6174 2077 6974 6820 7365   of that with se
-0002e7d0: 745f 736f 7274 6564 5f69 6e64 6578 0a20  t_sorted_index. 
-0002e7e0: 2020 2020 2020 2069 6620 7072 655f 736f         if pre_so
-0002e7f0: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
-0002e800: 2020 6672 6f6d 2064 6173 6b2e 6461 7461    from dask.data
-0002e810: 6672 616d 652e 7368 7566 666c 6520 696d  frame.shuffle im
-0002e820: 706f 7274 2073 6574 5f73 6f72 7465 645f  port set_sorted_
-0002e830: 696e 6465 780a 0a20 2020 2020 2020 2020  index..         
-0002e840: 2020 2072 6574 7572 6e20 7365 745f 736f     return set_so
-0002e850: 7274 6564 5f69 6e64 6578 280a 2020 2020  rted_index(.    
-0002e860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002e870: 2c20 6f74 6865 722c 2064 726f 703d 6472  , other, drop=dr
-0002e880: 6f70 2c20 6469 7669 7369 6f6e 733d 6469  op, divisions=di
-0002e890: 7669 7369 6f6e 732c 202a 2a6b 7761 7267  visions, **kwarg
-0002e8a0: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
-0002e8b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002e8c0: 2020 2020 2020 2020 2020 6672 6f6d 2064            from d
-0002e8d0: 6173 6b2e 6461 7461 6672 616d 652e 7368  ask.dataframe.sh
-0002e8e0: 7566 666c 6520 696d 706f 7274 2073 6574  uffle import set
-0002e8f0: 5f69 6e64 6578 0a0a 2020 2020 2020 2020  _index..        
-0002e900: 2020 2020 7265 7475 726e 2073 6574 5f69      return set_i
-0002e910: 6e64 6578 280a 2020 2020 2020 2020 2020  ndex(.          
-0002e920: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0002e930: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-0002e940: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0002e950: 2020 2064 726f 703d 6472 6f70 2c0a 2020     drop=drop,.  
-0002e960: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-0002e970: 6172 7469 7469 6f6e 733d 6e70 6172 7469  artitions=nparti
-0002e980: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
-0002e990: 2020 2020 2020 2064 6976 6973 696f 6e73         divisions
-0002e9a0: 3d64 6976 6973 696f 6e73 2c0a 2020 2020  =divisions,.    
-0002e9b0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-0002e9c0: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-0002e9d0: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
-0002e9e0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-0002e9f0: 616d 6529 0a20 2020 2064 6566 2070 6f70  ame).    def pop
-0002ea00: 2873 656c 662c 2069 7465 6d29 3a0a 2020  (self, item):.  
-0002ea10: 2020 2020 2020 6f75 7420 3d20 7365 6c66        out = self
-0002ea20: 5b69 7465 6d5d 0a20 2020 2020 2020 2064  [item].        d
-0002ea30: 656c 2073 656c 665b 6974 656d 5d0a 2020  el self[item].  
-0002ea40: 2020 2020 2020 7265 7475 726e 206f 7574        return out
-0002ea50: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-0002ea60: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
-0002ea70: 290a 2020 2020 6465 6620 6e6c 6172 6765  ).    def nlarge
-0002ea80: 7374 2873 656c 662c 206e 3d35 2c20 636f  st(self, n=5, co
-0002ea90: 6c75 6d6e 733d 6e6f 5f64 6566 6175 6c74  lumns=no_default
-0002eaa0: 2c20 7370 6c69 745f 6576 6572 793d 4e6f  , split_every=No
-0002eab0: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
-0002eac0: 636f 6c75 6d6e 7320 6973 206e 6f5f 6465  columns is no_de
-0002ead0: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
-0002eae0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-0002eaf0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0002eb00: 2020 2020 2244 6174 6146 7261 6d65 2e6e      "DataFrame.n
-0002eb10: 6c61 7267 6573 7428 2920 6d69 7373 696e  largest() missin
-0002eb20: 6720 7265 7175 6972 6564 2070 6f73 6974  g required posit
-0002eb30: 696f 6e61 6c20 6172 6775 6d65 6e74 3a20  ional argument: 
-0002eb40: 2763 6f6c 756d 6e73 2722 0a20 2020 2020  'columns'".     
-0002eb50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0002eb60: 2074 6f6b 656e 203d 2022 6461 7461 6672   token = "datafr
-0002eb70: 616d 652d 6e6c 6172 6765 7374 220a 2020  ame-nlargest".  
-0002eb80: 2020 2020 2020 7265 7475 726e 2061 6361        return aca
-0002eb90: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0002eba0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-0002ebb0: 6368 756e 6b3d 4d2e 6e6c 6172 6765 7374  chunk=M.nlargest
-0002ebc0: 2c0a 2020 2020 2020 2020 2020 2020 6167  ,.            ag
-0002ebd0: 6772 6567 6174 653d 4d2e 6e6c 6172 6765  gregate=M.nlarge
-0002ebe0: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
-0002ebf0: 6d65 7461 3d73 656c 662e 5f6d 6574 612c  meta=self._meta,
-0002ec00: 0a20 2020 2020 2020 2020 2020 2074 6f6b  .            tok
-0002ec10: 656e 3d74 6f6b 656e 2c0a 2020 2020 2020  en=token,.      
-0002ec20: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
-0002ec30: 793d 7370 6c69 745f 6576 6572 792c 0a20  y=split_every,. 
-0002ec40: 2020 2020 2020 2020 2020 206e 3d6e 2c0a             n=n,.
-0002ec50: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0002ec60: 6d6e 733d 636f 6c75 6d6e 732c 0a20 2020  mns=columns,.   
-0002ec70: 2020 2020 2029 0a0a 2020 2020 4064 6572       )..    @der
-0002ec80: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
-0002ec90: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
-0002eca0: 6e73 6d61 6c6c 6573 7428 7365 6c66 2c20  nsmallest(self, 
-0002ecb0: 6e3d 352c 2063 6f6c 756d 6e73 3d6e 6f5f  n=5, columns=no_
-0002ecc0: 6465 6661 756c 742c 2073 706c 6974 5f65  default, split_e
-0002ecd0: 7665 7279 3d4e 6f6e 6529 3a0a 2020 2020  very=None):.    
-0002ece0: 2020 2020 6966 2063 6f6c 756d 6e73 2069      if columns i
-0002ecf0: 7320 6e6f 5f64 6566 6175 6c74 3a0a 2020  s no_default:.  
-0002ed00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0002ed10: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
-0002ed20: 2020 2020 2020 2020 2020 2022 4461 7461             "Data
-0002ed30: 4672 616d 652e 6e73 6d61 6c6c 6573 7428  Frame.nsmallest(
-0002ed40: 2920 6d69 7373 696e 6720 7265 7175 6972  ) missing requir
-0002ed50: 6564 2070 6f73 6974 696f 6e61 6c20 6172  ed positional ar
-0002ed60: 6775 6d65 6e74 3a20 2763 6f6c 756d 6e73  gument: 'columns
-0002ed70: 2722 0a20 2020 2020 2020 2020 2020 2029  '".            )
-0002ed80: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
-0002ed90: 2022 6461 7461 6672 616d 652d 6e73 6d61   "dataframe-nsma
-0002eda0: 6c6c 6573 7422 0a20 2020 2020 2020 2072  llest".        r
-0002edb0: 6574 7572 6e20 6163 6128 0a20 2020 2020  eturn aca(.     
-0002edc0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0002edd0: 2020 2020 2020 2020 2063 6875 6e6b 3d4d           chunk=M
-0002ede0: 2e6e 736d 616c 6c65 7374 2c0a 2020 2020  .nsmallest,.    
-0002edf0: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-0002ee00: 653d 4d2e 6e73 6d61 6c6c 6573 742c 0a20  e=M.nsmallest,. 
-0002ee10: 2020 2020 2020 2020 2020 206d 6574 613d             meta=
-0002ee20: 7365 6c66 2e5f 6d65 7461 2c0a 2020 2020  self._meta,.    
-0002ee30: 2020 2020 2020 2020 746f 6b65 6e3d 746f          token=to
-0002ee40: 6b65 6e2c 0a20 2020 2020 2020 2020 2020  ken,.           
-0002ee50: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
-0002ee60: 6974 5f65 7665 7279 2c0a 2020 2020 2020  it_every,.      
-0002ee70: 2020 2020 2020 6e3d 6e2c 0a20 2020 2020        n=n,.     
-0002ee80: 2020 2020 2020 2063 6f6c 756d 6e73 3d63         columns=c
-0002ee90: 6f6c 756d 6e73 2c0a 2020 2020 2020 2020  olumns,.        
-0002eea0: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-0002eeb0: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-0002eec0: 6529 0a20 2020 2064 6566 2067 726f 7570  e).    def group
-0002eed0: 6279 280a 2020 2020 2020 2020 7365 6c66  by(.        self
-0002eee0: 2c0a 2020 2020 2020 2020 6279 3d4e 6f6e  ,.        by=Non
-0002eef0: 652c 0a20 2020 2020 2020 2067 726f 7570  e,.        group
-0002ef00: 5f6b 6579 733d 4752 4f55 505f 4b45 5953  _keys=GROUP_KEYS
-0002ef10: 5f44 4546 4155 4c54 2c0a 2020 2020 2020  _DEFAULT,.      
-0002ef20: 2020 736f 7274 3d4e 6f6e 652c 0a20 2020    sort=None,.   
-0002ef30: 2020 2020 206f 6273 6572 7665 643d 4e6f       observed=No
-0002ef40: 6e65 2c0a 2020 2020 2020 2020 6472 6f70  ne,.        drop
-0002ef50: 6e61 3d4e 6f6e 652c 0a20 2020 2020 2020  na=None,.       
-0002ef60: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-0002ef70: 3a0a 2020 2020 2020 2020 6672 6f6d 2064  :.        from d
-0002ef80: 6173 6b2e 6461 7461 6672 616d 652e 6772  ask.dataframe.gr
-0002ef90: 6f75 7062 7920 696d 706f 7274 2044 6174  oupby import Dat
-0002efa0: 6146 7261 6d65 4772 6f75 7042 790a 0a20  aFrameGroupBy.. 
-0002efb0: 2020 2020 2020 2072 6574 7572 6e20 4461         return Da
-0002efc0: 7461 4672 616d 6547 726f 7570 4279 280a  taFrameGroupBy(.
-0002efd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002efe0: 2c0a 2020 2020 2020 2020 2020 2020 6279  ,.            by
-0002eff0: 3d62 792c 0a20 2020 2020 2020 2020 2020  =by,.           
-0002f000: 2067 726f 7570 5f6b 6579 733d 6772 6f75   group_keys=grou
-0002f010: 705f 6b65 7973 2c0a 2020 2020 2020 2020  p_keys,.        
-0002f020: 2020 2020 736f 7274 3d73 6f72 742c 0a20      sort=sort,. 
-0002f030: 2020 2020 2020 2020 2020 206f 6273 6572             obser
-0002f040: 7665 643d 6f62 7365 7276 6564 2c0a 2020  ved=observed,.  
-0002f050: 2020 2020 2020 2020 2020 6472 6f70 6e61            dropna
-0002f060: 3d64 726f 706e 612c 0a20 2020 2020 2020  =dropna,.       
-0002f070: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-0002f080: 2020 2020 2020 2029 0a0a 2020 2020 4077         )..    @w
-0002f090: 7261 7073 2863 6174 6567 6f72 697a 6529  raps(categorize)
-0002f0a0: 0a20 2020 2064 6566 2063 6174 6567 6f72  .    def categor
-0002f0b0: 697a 6528 7365 6c66 2c20 636f 6c75 6d6e  ize(self, column
-0002f0c0: 733d 4e6f 6e65 2c20 696e 6465 783d 4e6f  s=None, index=No
-0002f0d0: 6e65 2c20 7370 6c69 745f 6576 6572 793d  ne, split_every=
-0002f0e0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-0002f0f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002f100: 6361 7465 676f 7269 7a65 280a 2020 2020  categorize(.    
-0002f110: 2020 2020 2020 2020 7365 6c66 2c20 636f          self, co
-0002f120: 6c75 6d6e 733d 636f 6c75 6d6e 732c 2069  lumns=columns, i
-0002f130: 6e64 6578 3d69 6e64 6578 2c20 7370 6c69  ndex=index, spli
-0002f140: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
-0002f150: 6572 792c 202a 2a6b 7761 7267 730a 2020  ery, **kwargs.  
-0002f160: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
-0002f170: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-0002f180: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
-0002f190: 2061 7373 6967 6e28 7365 6c66 2c20 2a2a   assign(self, **
+0002a4c0: 2020 2020 2020 2020 2273 7472 696e 6720          "string 
+0002a4d0: 746f 2073 6c69 6365 2074 6865 2072 6f77  to slice the row
+0002a4e0: 732c 206c 696b 6520 6066 7261 6d65 5b73  s, like `frame[s
+0002a4f0: 7472 696e 675d 602c 2069 7320 6465 7072  tring]`, is depr
+0002a500: 6563 6174 6564 2022 0a20 2020 2020 2020  ecated ".       
+0002a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a520: 2022 616e 6420 7769 6c6c 2062 6520 7265   "and will be re
+0002a530: 6d6f 7665 6420 696e 2061 2066 7574 7572  moved in a futur
+0002a540: 6520 7665 7273 696f 6e2e 2055 7365 2060  e version. Use `
+0002a550: 6672 616d 652e 6c6f 635b 7374 7269 6e67  frame.loc[string
+0002a560: 5d60 2022 0a20 2020 2020 2020 2020 2020  ]` ".           
+0002a570: 2020 2020 2020 2020 2020 2020 2022 696e               "in
+0002a580: 7374 6561 642e 222c 0a20 2020 2020 2020  stead.",.       
+0002a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a5a0: 2046 7574 7572 6557 6172 6e69 6e67 2c0a   FutureWarning,.
+0002a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a5c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0002a5d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002a5e0: 2073 656c 662e 6c6f 635b 6b65 795d 0a0a   self.loc[key]..
+0002a5f0: 2020 2020 2020 2020 2020 2020 2320 6572              # er
+0002a600: 726f 7220 6973 2072 6169 7365 6420 6672  ror is raised fr
+0002a610: 6f6d 2070 616e 6461 730a 2020 2020 2020  om pandas.      
+0002a620: 2020 2020 2020 6d65 7461 203d 2073 656c        meta = sel
+0002a630: 662e 5f6d 6574 615b 5f65 7874 7261 6374  f._meta[_extract
+0002a640: 5f6d 6574 6128 6b65 7929 5d0a 2020 2020  _meta(key)].    
+0002a650: 2020 2020 2020 2020 6473 6b20 3d20 7061          dsk = pa
+0002a660: 7274 6974 696f 6e77 6973 655f 6772 6170  rtitionwise_grap
+0002a670: 6828 6f70 6572 6174 6f72 2e67 6574 6974  h(operator.getit
+0002a680: 656d 2c20 6e61 6d65 2c20 7365 6c66 2c20  em, name, self, 
+0002a690: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
+0002a6a0: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+0002a6b0: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+0002a6c0: 6c65 6374 696f 6e73 286e 616d 652c 2064  lections(name, d
+0002a6d0: 736b 2c20 6465 7065 6e64 656e 6369 6573  sk, dependencies
+0002a6e0: 3d5b 7365 6c66 5d29 0a20 2020 2020 2020  =[self]).       
+0002a6f0: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+0002a700: 6464 5f6f 626a 6563 7428 6772 6170 682c  dd_object(graph,
+0002a710: 206e 616d 652c 206d 6574 612c 2073 656c   name, meta, sel
+0002a720: 662e 6469 7669 7369 6f6e 7329 0a20 2020  f.divisions).   
+0002a730: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0002a740: 616e 6365 286b 6579 2c20 736c 6963 6529  ance(key, slice)
+0002a750: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
+0002a760: 6f6d 2070 616e 6461 732e 6170 692e 7479  om pandas.api.ty
+0002a770: 7065 7320 696d 706f 7274 2069 735f 666c  pes import is_fl
+0002a780: 6f61 745f 6474 7970 650a 0a20 2020 2020  oat_dtype..     
+0002a790: 2020 2020 2020 2069 735f 696e 7465 6765         is_intege
+0002a7a0: 725f 736c 6963 6520 3d20 616e 7928 0a20  r_slice = any(. 
+0002a7b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002a7c0: 7369 6e73 7461 6e63 6528 692c 2049 6e74  sinstance(i, Int
+0002a7d0: 6567 7261 6c29 2066 6f72 2069 2069 6e20  egral) for i in 
+0002a7e0: 286b 6579 2e73 7461 7274 2c20 6b65 792e  (key.start, key.
+0002a7f0: 7374 6570 2c20 6b65 792e 7374 6f70 290a  step, key.stop).
+0002a800: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0002a810: 2020 2020 2020 2020 2020 2320 536c 6963            # Slic
+0002a820: 696e 6720 7769 7468 2069 6e74 6567 6572  ing with integer
+0002a830: 206c 6162 656c 7320 6973 2061 6c77 6179   labels is alway
+0002a840: 7320 696c 6f63 2062 6173 6564 2065 7863  s iloc based exc
+0002a850: 6570 7420 666f 7220 610a 2020 2020 2020  ept for a.      
+0002a860: 2020 2020 2020 2320 666c 6f61 7420 696e        # float in
+0002a870: 6465 7865 7220 666f 7220 736f 6d65 2072  dexer for some r
+0002a880: 6561 736f 6e0a 2020 2020 2020 2020 2020  eason.          
+0002a890: 2020 6966 2069 735f 696e 7465 6765 725f    if is_integer_
+0002a8a0: 736c 6963 6520 616e 6420 6e6f 7420 6973  slice and not is
+0002a8b0: 5f66 6c6f 6174 5f64 7479 7065 2873 656c  _float_dtype(sel
+0002a8c0: 662e 696e 6465 782e 6474 7970 6529 3a0a  f.index.dtype):.
+0002a8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8e0: 2320 4e4f 5445 3a20 7468 6973 2061 6c77  # NOTE: this alw
+0002a8f0: 6179 7320 6661 696c 7320 6375 7272 656e  ays fails curren
+0002a900: 746c 792c 2061 7320 696c 6f63 2069 7320  tly, as iloc is 
+0002a910: 6d6f 7374 6c79 0a20 2020 2020 2020 2020  mostly.         
+0002a920: 2020 2020 2020 2023 2075 6e73 7570 706f         # unsuppo
+0002a930: 7274 6564 2c20 6275 7420 7765 2063 616c  rted, but we cal
+0002a940: 6c20 6974 2061 6e79 7761 7920 6865 7265  l it anyway here
+0002a950: 2066 6f72 2066 7574 7572 652d 7072 6f6f   for future-proo
+0002a960: 6669 6e67 0a20 2020 2020 2020 2020 2020  fing.           
+0002a970: 2020 2020 2023 2061 6e64 2065 7272 6f72       # and error
+0002a980: 2d61 7474 7269 6275 7469 6f6e 2070 7572  -attribution pur
+0002a990: 706f 7365 730a 2020 2020 2020 2020 2020  poses.          
+0002a9a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002a9b0: 662e 696c 6f63 5b6b 6579 5d0a 2020 2020  f.iloc[key].    
+0002a9c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002a9d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0002a9e0: 7475 726e 2073 656c 662e 6c6f 635b 6b65  turn self.loc[ke
+0002a9f0: 795d 0a0a 2020 2020 2020 2020 6966 2069  y]..        if i
+0002aa00: 7369 6e73 7461 6e63 6528 6b65 792c 2028  sinstance(key, (
+0002aa10: 6e70 2e6e 6461 7272 6179 2c20 6c69 7374  np.ndarray, list
+0002aa20: 2929 206f 7220 280a 2020 2020 2020 2020  )) or (.        
+0002aa30: 2020 2020 6e6f 7420 6973 5f64 6173 6b5f      not is_dask_
+0002aa40: 636f 6c6c 6563 7469 6f6e 286b 6579 2920  collection(key) 
+0002aa50: 616e 6420 2869 735f 7365 7269 6573 5f6c  and (is_series_l
+0002aa60: 696b 6528 6b65 7929 206f 7220 6973 5f69  ike(key) or is_i
+0002aa70: 6e64 6578 5f6c 696b 6528 6b65 7929 290a  ndex_like(key)).
+0002aa80: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+0002aa90: 2020 2020 2020 2023 2065 7272 6f72 2069         # error i
+0002aaa0: 7320 7261 6973 6564 2066 726f 6d20 7061  s raised from pa
+0002aab0: 6e64 6173 0a20 2020 2020 2020 2020 2020  ndas.           
+0002aac0: 206d 6574 6120 3d20 7365 6c66 2e5f 6d65   meta = self._me
+0002aad0: 7461 5b5f 6578 7472 6163 745f 6d65 7461  ta[_extract_meta
+0002aae0: 286b 6579 295d 0a0a 2020 2020 2020 2020  (key)]..        
+0002aaf0: 2020 2020 6473 6b20 3d20 7061 7274 6974      dsk = partit
+0002ab00: 696f 6e77 6973 655f 6772 6170 6828 6f70  ionwise_graph(op
+0002ab10: 6572 6174 6f72 2e67 6574 6974 656d 2c20  erator.getitem, 
+0002ab20: 6e61 6d65 2c20 7365 6c66 2c20 6b65 7929  name, self, key)
+0002ab30: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
+0002ab40: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
+0002ab50: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
+0002ab60: 696f 6e73 286e 616d 652c 2064 736b 2c20  ions(name, dsk, 
+0002ab70: 6465 7065 6e64 656e 6369 6573 3d5b 7365  dependencies=[se
+0002ab80: 6c66 5d29 0a20 2020 2020 2020 2020 2020  lf]).           
+0002ab90: 2072 6574 7572 6e20 6e65 775f 6464 5f6f   return new_dd_o
+0002aba0: 626a 6563 7428 6772 6170 682c 206e 616d  bject(graph, nam
+0002abb0: 652c 206d 6574 612c 2073 656c 662e 6469  e, meta, self.di
+0002abc0: 7669 7369 6f6e 7329 0a20 2020 2020 2020  visions).       
+0002abd0: 2069 6620 6973 696e 7374 616e 6365 286b   if isinstance(k
+0002abe0: 6579 2c20 5365 7269 6573 293a 0a20 2020  ey, Series):.   
+0002abf0: 2020 2020 2020 2020 2023 2064 6f20 6e6f           # do no
+0002ac00: 7420 7065 7266 6f72 6d20 6475 6d6d 7920  t perform dummy 
+0002ac10: 6361 6c63 756c 6174 696f 6e2c 2061 7320  calculation, as 
+0002ac20: 636f 6c75 6d6e 7320 7769 6c6c 206e 6f74  columns will not
+0002ac30: 2062 6520 6368 616e 6765 642e 0a20 2020   be changed..   
+0002ac40: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0002ac50: 2e64 6976 6973 696f 6e73 2021 3d20 6b65  .divisions != ke
+0002ac60: 792e 6469 7669 7369 6f6e 733a 0a20 2020  y.divisions:.   
+0002ac70: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+0002ac80: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+0002ac90: 2e6d 756c 7469 2069 6d70 6f72 7420 5f6d  .multi import _m
+0002aca0: 6179 6265 5f61 6c69 676e 5f70 6172 7469  aybe_align_parti
+0002acb0: 7469 6f6e 730a 0a20 2020 2020 2020 2020  tions..         
+0002acc0: 2020 2020 2020 2073 656c 662c 206b 6579         self, key
+0002acd0: 203d 205f 6d61 7962 655f 616c 6967 6e5f   = _maybe_align_
+0002ace0: 7061 7274 6974 696f 6e73 285b 7365 6c66  partitions([self
+0002acf0: 2c20 6b65 795d 290a 2020 2020 2020 2020  , key]).        
+0002ad00: 2020 2020 6473 6b20 3d20 7061 7274 6974      dsk = partit
+0002ad10: 696f 6e77 6973 655f 6772 6170 6828 6f70  ionwise_graph(op
+0002ad20: 6572 6174 6f72 2e67 6574 6974 656d 2c20  erator.getitem, 
+0002ad30: 6e61 6d65 2c20 7365 6c66 2c20 6b65 7929  name, self, key)
+0002ad40: 0a20 2020 2020 2020 2020 2020 2067 7261  .            gra
+0002ad50: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
+0002ad60: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
+0002ad70: 696f 6e73 286e 616d 652c 2064 736b 2c20  ions(name, dsk, 
+0002ad80: 6465 7065 6e64 656e 6369 6573 3d5b 7365  dependencies=[se
+0002ad90: 6c66 2c20 6b65 795d 290a 2020 2020 2020  lf, key]).      
+0002ada0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+0002adb0: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
+0002adc0: 2c20 6e61 6d65 2c20 7365 6c66 2c20 7365  , name, self, se
+0002add0: 6c66 2e64 6976 6973 696f 6e73 290a 2020  lf.divisions).  
+0002ade0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0002adf0: 6e63 6528 6b65 792c 2044 6174 6146 7261  nce(key, DataFra
+0002ae00: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
+0002ae10: 2072 6574 7572 6e20 7365 6c66 2e77 6865   return self.whe
+0002ae20: 7265 286b 6579 2c20 6e70 2e6e 616e 290a  re(key, np.nan).
+0002ae30: 0a20 2020 2020 2020 2072 6169 7365 204e  .        raise N
+0002ae40: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
+0002ae50: 6f72 286b 6579 290a 0a20 2020 2064 6566  or(key)..    def
+0002ae60: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
+0002ae70: 662c 206b 6579 2c20 7661 6c75 6529 3a0a  f, key, value):.
+0002ae80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0002ae90: 7461 6e63 6528 6b65 792c 2028 7475 706c  tance(key, (tupl
+0002aea0: 652c 206c 6973 7429 2920 616e 6420 6973  e, list)) and is
+0002aeb0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+0002aec0: 4461 7461 4672 616d 6529 3a0a 2020 2020  DataFrame):.    
+0002aed0: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
+0002aee0: 662e 6173 7369 676e 282a 2a7b 6b3a 2076  f.assign(**{k: v
+0002aef0: 616c 7565 5b63 5d20 666f 7220 6b2c 2063  alue[c] for k, c
+0002af00: 2069 6e20 7a69 7028 6b65 792c 2076 616c   in zip(key, val
+0002af10: 7565 2e63 6f6c 756d 6e73 297d 290a 0a20  ue.columns)}).. 
+0002af20: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0002af30: 7374 616e 6365 286b 6579 2c20 7064 2e49  stance(key, pd.I
+0002af40: 6e64 6578 2920 616e 6420 6e6f 7420 6973  ndex) and not is
+0002af50: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
+0002af60: 4461 7461 4672 616d 6529 3a0a 2020 2020  DataFrame):.    
+0002af70: 2020 2020 2020 2020 6b65 7920 3d20 6c69          key = li
+0002af80: 7374 286b 6579 290a 2020 2020 2020 2020  st(key).        
+0002af90: 2020 2020 6466 203d 2073 656c 662e 6173      df = self.as
+0002afa0: 7369 676e 282a 2a7b 6b3a 2076 616c 7565  sign(**{k: value
+0002afb0: 2066 6f72 206b 2069 6e20 6b65 797d 290a   for k in key}).
+0002afc0: 2020 2020 2020 2020 656c 6966 2028 0a20          elif (. 
+0002afd0: 2020 2020 2020 2020 2020 2069 735f 6461             is_da
+0002afe0: 7461 6672 616d 655f 6c69 6b65 286b 6579  taframe_like(key
+0002aff0: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0002b000: 2069 735f 7365 7269 6573 5f6c 696b 6528   is_series_like(
+0002b010: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
+0002b020: 206f 7220 6973 696e 7374 616e 6365 286b   or isinstance(k
+0002b030: 6579 2c20 2844 6174 6146 7261 6d65 2c20  ey, (DataFrame, 
+0002b040: 5365 7269 6573 2929 0a20 2020 2020 2020  Series)).       
+0002b050: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0002b060: 6466 203d 2073 656c 662e 7768 6572 6528  df = self.where(
+0002b070: 7e6b 6579 2c20 7661 6c75 6529 0a20 2020  ~key, value).   
+0002b080: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
+0002b090: 696e 7374 616e 6365 286b 6579 2c20 7374  instance(key, st
+0002b0a0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0002b0b0: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+0002b0c0: 6e74 6564 4572 726f 7228 6622 4974 656d  ntedError(f"Item
+0002b0d0: 2061 7373 6967 6e6d 656e 7420 7769 7468   assignment with
+0002b0e0: 207b 7479 7065 286b 6579 297d 206e 6f74   {type(key)} not
+0002b0f0: 2073 7570 706f 7274 6564 2229 0a20 2020   supported").   
+0002b100: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002b110: 2020 2020 2020 2064 6620 3d20 7365 6c66         df = self
+0002b120: 2e61 7373 6967 6e28 2a2a 7b6b 6579 3a20  .assign(**{key: 
+0002b130: 7661 6c75 657d 290a 0a20 2020 2020 2020  value})..       
+0002b140: 2073 656c 662e 6461 736b 203d 2064 662e   self.dask = df.
+0002b150: 6461 736b 0a20 2020 2020 2020 2073 656c  dask.        sel
+0002b160: 662e 5f6e 616d 6520 3d20 6466 2e5f 6e61  f._name = df._na
+0002b170: 6d65 0a20 2020 2020 2020 2073 656c 662e  me.        self.
+0002b180: 5f6d 6574 6120 3d20 6466 2e5f 6d65 7461  _meta = df._meta
+0002b190: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+0002b1a0: 6976 6973 696f 6e73 203d 2064 662e 6469  ivisions = df.di
+0002b1b0: 7669 7369 6f6e 730a 0a20 2020 2064 6566  visions..    def
+0002b1c0: 205f 5f64 656c 6974 656d 5f5f 2873 656c   __delitem__(sel
+0002b1d0: 662c 206b 6579 293a 0a20 2020 2020 2020  f, key):.       
+0002b1e0: 2072 6573 756c 7420 3d20 7365 6c66 2e64   result = self.d
+0002b1f0: 726f 7028 5b6b 6579 5d2c 2061 7869 733d  rop([key], axis=
+0002b200: 3129 0a20 2020 2020 2020 2073 656c 662e  1).        self.
+0002b210: 6461 736b 203d 2072 6573 756c 742e 6461  dask = result.da
+0002b220: 736b 0a20 2020 2020 2020 2073 656c 662e  sk.        self.
+0002b230: 5f6e 616d 6520 3d20 7265 7375 6c74 2e5f  _name = result._
+0002b240: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
+0002b250: 662e 5f6d 6574 6120 3d20 7265 7375 6c74  f._meta = result
+0002b260: 2e5f 6d65 7461 0a0a 2020 2020 6465 6620  ._meta..    def 
+0002b270: 5f5f 7365 7461 7474 725f 5f28 7365 6c66  __setattr__(self
+0002b280: 2c20 6b65 792c 2076 616c 7565 293a 0a20  , key, value):. 
+0002b290: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0002b2a0: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
+0002b2b0: 3d20 6f62 6a65 6374 2e5f 5f67 6574 6174  = object.__getat
+0002b2c0: 7472 6962 7574 655f 5f28 7365 6c66 2c20  tribute__(self, 
+0002b2d0: 225f 6d65 7461 2229 2e63 6f6c 756d 6e73  "_meta").columns
+0002b2e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0002b2f0: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+0002b300: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0002b310: 6d6e 7320 3d20 2829 0a0a 2020 2020 2020  mns = ()..      
+0002b320: 2020 2320 6578 636c 7564 6520 7072 6f74    # exclude prot
+0002b330: 6563 7465 6420 6174 7472 6962 7574 6573  ected attributes
+0002b340: 2066 726f 6d20 7365 7469 7465 6d0a 2020   from setitem.  
+0002b350: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+0002b360: 636f 6c75 6d6e 7320 616e 6420 6b65 7920  columns and key 
+0002b370: 6e6f 7420 696e 205b 2264 6976 6973 696f  not in ["divisio
+0002b380: 6e73 222c 2022 6461 736b 222c 2022 5f6e  ns", "dask", "_n
+0002b390: 616d 6522 2c20 225f 6d65 7461 225d 3a0a  ame", "_meta"]:.
+0002b3a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002b3b0: 5b6b 6579 5d20 3d20 7661 6c75 650a 2020  [key] = value.  
+0002b3c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002b3d0: 2020 2020 2020 2020 6f62 6a65 6374 2e5f          object._
+0002b3e0: 5f73 6574 6174 7472 5f5f 2873 656c 662c  _setattr__(self,
+0002b3f0: 206b 6579 2c20 7661 6c75 6529 0a0a 2020   key, value)..  
+0002b400: 2020 6465 6620 5f5f 6765 7461 7474 725f    def __getattr_
+0002b410: 5f28 7365 6c66 2c20 6b65 7929 3a0a 2020  _(self, key):.  
+0002b420: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+0002b430: 7365 6c66 2e63 6f6c 756d 6e73 3a0a 2020  self.columns:.  
+0002b440: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002b450: 2073 656c 665b 6b65 795d 0a20 2020 2020   self[key].     
+0002b460: 2020 2065 6c69 6620 6b65 7920 3d3d 2022     elif key == "
+0002b470: 656d 7074 7922 3a0a 2020 2020 2020 2020  empty":.        
+0002b480: 2020 2020 2320 7365 6c66 2e65 6d70 7479      # self.empty
+0002b490: 2072 6169 7365 7320 4174 7472 6962 7574   raises Attribut
+0002b4a0: 654e 6f74 496d 706c 656d 656e 7465 6445  eNotImplementedE
+0002b4b0: 7272 6f72 2c20 7768 6963 6820 696e 636c  rror, which incl
+0002b4c0: 7564 6573 0a20 2020 2020 2020 2020 2020  udes.           
+0002b4d0: 2023 2041 7474 7269 6275 7465 4572 726f   # AttributeErro
+0002b4e0: 722c 2077 6869 6368 206d 6561 6e73 2077  r, which means w
+0002b4f0: 6520 656e 6420 7570 2068 6572 6520 696e  e end up here in
+0002b500: 2073 656c 662e 5f5f 6765 7461 7474 725f   self.__getattr_
+0002b510: 5f2c 0a20 2020 2020 2020 2020 2020 2023  _,.            #
+0002b520: 2062 6563 6175 7365 2044 6174 6146 7261   because DataFra
+0002b530: 6d65 2e5f 5f67 6574 6174 7472 6962 7574  me.__getattribut
+0002b540: 655f 5f20 646f 6573 6e27 7420 7468 696e  e__ doesn't thin
+0002b550: 6b20 7468 6520 6174 7472 6962 7574 6520  k the attribute 
+0002b560: 6578 6973 7473 0a20 2020 2020 2020 2020  exists.         
+0002b570: 2020 2023 2061 6e64 2075 7365 7320 5f5f     # and uses __
+0002b580: 6765 7461 7474 725f 5f20 6173 2074 6865  getattr__ as the
+0002b590: 2066 616c 6c62 6163 6b2e 2053 6f2c 2067   fallback. So, g
+0002b5a0: 6574 2060 7365 6c66 2e65 6d70 7479 6020  et `self.empty` 
+0002b5b0: 6d6f 7265 0a20 2020 2020 2020 2020 2020  more.           
+0002b5c0: 2023 2066 6f72 6365 6675 6c6c 7920 7669   # forcefully vi
+0002b5d0: 6120 6f62 6a65 6374 2e5f 5f67 6574 6174  a object.__getat
+0002b5e0: 7472 6962 7574 655f 5f20 746f 2072 6169  tribute__ to rai
+0002b5f0: 7365 2069 6e66 6f72 6d61 7469 7665 2065  se informative e
+0002b600: 7272 6f72 2e0a 2020 2020 2020 2020 2020  rror..          
+0002b610: 2020 6f62 6a65 6374 2e5f 5f67 6574 6174    object.__getat
+0002b620: 7472 6962 7574 655f 5f28 7365 6c66 2c20  tribute__(self, 
+0002b630: 6b65 7929 0a20 2020 2020 2020 2065 6c73  key).        els
+0002b640: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0002b650: 6169 7365 2041 7474 7269 6275 7465 4572  aise AttributeEr
+0002b660: 726f 7228 2227 4461 7461 4672 616d 6527  ror("'DataFrame'
+0002b670: 206f 626a 6563 7420 6861 7320 6e6f 2061   object has no a
+0002b680: 7474 7269 6275 7465 2025 7222 2025 206b  ttribute %r" % k
+0002b690: 6579 290a 0a20 2020 2064 6566 205f 5f64  ey)..    def __d
+0002b6a0: 6972 5f5f 2873 656c 6629 3a0a 2020 2020  ir__(self):.    
+0002b6b0: 2020 2020 6f20 3d20 7365 7428 6469 7228      o = set(dir(
+0002b6c0: 7479 7065 2873 656c 6629 2929 0a20 2020  type(self))).   
+0002b6d0: 2020 2020 206f 2e75 7064 6174 6528 7365       o.update(se
+0002b6e0: 6c66 2e5f 5f64 6963 745f 5f29 0a20 2020  lf.__dict__).   
+0002b6f0: 2020 2020 206f 2e75 7064 6174 6528 6320       o.update(c 
+0002b700: 666f 7220 6320 696e 2073 656c 662e 636f  for c in self.co
+0002b710: 6c75 6d6e 7320 6966 2028 6973 696e 7374  lumns if (isinst
+0002b720: 616e 6365 2863 2c20 7374 7229 2061 6e64  ance(c, str) and
+0002b730: 2063 2e69 7369 6465 6e74 6966 6965 7228   c.isidentifier(
+0002b740: 2929 290a 2020 2020 2020 2020 7265 7475  ))).        retu
+0002b750: 726e 206c 6973 7428 6f29 0a0a 2020 2020  rn list(o)..    
+0002b760: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
+0002b770: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0002b780: 726e 2069 7465 7228 7365 6c66 2e5f 6d65  rn iter(self._me
+0002b790: 7461 290a 0a20 2020 2064 6566 205f 6970  ta)..    def _ip
+0002b7a0: 7974 686f 6e5f 6b65 795f 636f 6d70 6c65  ython_key_comple
+0002b7b0: 7469 6f6e 735f 2873 656c 6629 3a0a 2020  tions_(self):.  
+0002b7c0: 2020 2020 2020 7265 7475 726e 206d 6574        return met
+0002b7d0: 686f 6473 2e74 6f6c 6973 7428 7365 6c66  hods.tolist(self
+0002b7e0: 2e63 6f6c 756d 6e73 290a 0a20 2020 2040  .columns)..    @
+0002b7f0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+0002b800: 206e 6469 6d28 7365 6c66 293a 0a20 2020   ndim(self):.   
+0002b810: 2020 2020 2022 2222 5265 7475 726e 2064       """Return d
+0002b820: 696d 656e 7369 6f6e 616c 6974 7922 2222  imensionality"""
+0002b830: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002b840: 320a 0a20 2020 2040 7072 6f70 6572 7479  2..    @property
+0002b850: 0a20 2020 2064 6566 2073 6861 7065 2873  .    def shape(s
+0002b860: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0002b870: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0002b880: 2061 2074 7570 6c65 2072 6570 7265 7365   a tuple represe
+0002b890: 6e74 696e 6720 7468 6520 6469 6d65 6e73  nting the dimens
+0002b8a0: 696f 6e61 6c69 7479 206f 6620 7468 6520  ionality of the 
+0002b8b0: 4461 7461 4672 616d 652e 0a0a 2020 2020  DataFrame...    
+0002b8c0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
+0002b8d0: 6620 726f 7773 2069 7320 6120 4465 6c61  f rows is a Dela
+0002b8e0: 7965 6420 7265 7375 6c74 2e20 5468 6520  yed result. The 
+0002b8f0: 6e75 6d62 6572 206f 6620 636f 6c75 6d6e  number of column
+0002b900: 730a 2020 2020 2020 2020 6973 2061 2063  s.        is a c
+0002b910: 6f6e 6372 6574 6520 696e 7465 6765 722e  oncrete integer.
+0002b920: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0002b930: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+0002b940: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
+0002b950: 6466 2e73 697a 6520 2023 2064 6f63 7465  df.size  # docte
+0002b960: 7374 3a20 2b53 4b49 500a 2020 2020 2020  st: +SKIP.      
+0002b970: 2020 2844 656c 6179 6564 2827 696e 742d    (Delayed('int-
+0002b980: 3037 6630 3630 3735 2d35 6563 632d 3464  07f06075-5ecc-4d
+0002b990: 3737 2d38 3137 652d 3633 6336 3961 3931  77-817e-63c69a91
+0002b9a0: 3838 6138 2729 2c20 3229 0a20 2020 2020  88a8'), 2).     
+0002b9b0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+0002b9c0: 6f6c 5f73 697a 6520 3d20 6c65 6e28 7365  ol_size = len(se
+0002b9d0: 6c66 2e63 6f6c 756d 6e73 290a 2020 2020  lf.columns).    
+0002b9e0: 2020 2020 6966 2063 6f6c 5f73 697a 6520      if col_size 
+0002b9f0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0002ba00: 2020 7265 7475 726e 2028 7365 6c66 2e69    return (self.i
+0002ba10: 6e64 6578 2e73 6861 7065 5b30 5d2c 2030  ndex.shape[0], 0
+0002ba20: 290a 2020 2020 2020 2020 726f 775f 7369  ).        row_si
+0002ba30: 7a65 203d 2064 656c 6179 6564 2869 6e74  ze = delayed(int
+0002ba40: 2928 7365 6c66 2e73 697a 6520 2f20 636f  )(self.size / co
+0002ba50: 6c5f 7369 7a65 290a 2020 2020 2020 2020  l_size).        
+0002ba60: 7265 7475 726e 2028 726f 775f 7369 7a65  return (row_size
+0002ba70: 2c20 636f 6c5f 7369 7a65 290a 0a20 2020  , col_size)..   
+0002ba80: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0002ba90: 6566 2064 7479 7065 7328 7365 6c66 293a  ef dtypes(self):
+0002baa0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+0002bab0: 726e 2064 6174 6120 7479 7065 7322 2222  rn data types"""
+0002bac0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002bad0: 7365 6c66 2e5f 6d65 7461 2e64 7479 7065  self._meta.dtype
+0002bae0: 730a 0a20 2020 2040 6465 7269 7665 645f  s..    @derived_
+0002baf0: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
+0002bb00: 6529 0a20 2020 2064 6566 2073 656c 6563  e).    def selec
+0002bb10: 745f 6474 7970 6573 2873 656c 662c 2069  t_dtypes(self, i
+0002bb20: 6e63 6c75 6465 3d4e 6f6e 652c 2065 7863  nclude=None, exc
+0002bb30: 6c75 6465 3d4e 6f6e 6529 3a0a 2020 2020  lude=None):.    
+0002bb40: 2020 2020 6373 203d 2073 656c 662e 5f6d      cs = self._m
+0002bb50: 6574 612e 7365 6c65 6374 5f64 7479 7065  eta.select_dtype
+0002bb60: 7328 696e 636c 7564 653d 696e 636c 7564  s(include=includ
+0002bb70: 652c 2065 7863 6c75 6465 3d65 7863 6c75  e, exclude=exclu
+0002bb80: 6465 290a 2020 2020 2020 2020 696e 6465  de).        inde
+0002bb90: 7865 7220 3d20 7365 6c66 2e5f 6765 745f  xer = self._get_
+0002bba0: 636f 6c75 6d6e 735f 696e 6465 7865 735f  columns_indexes_
+0002bbb0: 6261 7365 645f 6f6e 5f64 7479 7065 7328  based_on_dtypes(
+0002bbc0: 6373 290a 2020 2020 2020 2020 7265 7475  cs).        retu
+0002bbd0: 726e 2073 656c 662e 696c 6f63 5b3a 2c20  rn self.iloc[:, 
+0002bbe0: 696e 6465 7865 725d 0a0a 2020 2020 6465  indexer]..    de
+0002bbf0: 6620 736f 7274 5f76 616c 7565 7328 0a20  f sort_values(. 
+0002bc00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0002bc10: 2020 2020 2062 793a 2073 7472 207c 206c       by: str | l
+0002bc20: 6973 745b 7374 725d 2c0a 2020 2020 2020  ist[str],.      
+0002bc30: 2020 6e70 6172 7469 7469 6f6e 733a 2069    npartitions: i
+0002bc40: 6e74 207c 204c 6974 6572 616c 5b22 6175  nt | Literal["au
+0002bc50: 746f 225d 207c 204e 6f6e 6520 3d20 4e6f  to"] | None = No
+0002bc60: 6e65 2c0a 2020 2020 2020 2020 6173 6365  ne,.        asce
+0002bc70: 6e64 696e 673a 2062 6f6f 6c20 3d20 5472  nding: bool = Tr
+0002bc80: 7565 2c0a 2020 2020 2020 2020 6e61 5f70  ue,.        na_p
+0002bc90: 6f73 6974 696f 6e3a 204c 6974 6572 616c  osition: Literal
+0002bca0: 5b22 6669 7273 7422 5d20 7c20 4c69 7465  ["first"] | Lite
+0002bcb0: 7261 6c5b 226c 6173 7422 5d20 3d20 226c  ral["last"] = "l
+0002bcc0: 6173 7422 2c0a 2020 2020 2020 2020 736f  ast",.        so
+0002bcd0: 7274 5f66 756e 6374 696f 6e3a 2043 616c  rt_function: Cal
+0002bce0: 6c61 626c 655b 5b70 642e 4461 7461 4672  lable[[pd.DataFr
+0002bcf0: 616d 655d 2c20 7064 2e44 6174 6146 7261  ame], pd.DataFra
+0002bd00: 6d65 5d20 7c20 4e6f 6e65 203d 204e 6f6e  me] | None = Non
+0002bd10: 652c 0a20 2020 2020 2020 2073 6f72 745f  e,.        sort_
+0002bd20: 6675 6e63 7469 6f6e 5f6b 7761 7267 733a  function_kwargs:
+0002bd30: 204d 6170 7069 6e67 5b73 7472 2c20 416e   Mapping[str, An
+0002bd40: 795d 207c 204e 6f6e 6520 3d20 4e6f 6e65  y] | None = None
+0002bd50: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+0002bd60: 6773 2c0a 2020 2020 2920 2d3e 2044 6174  gs,.    ) -> Dat
+0002bd70: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+0002bd80: 2222 2253 6f72 7420 7468 6520 6461 7461  """Sort the data
+0002bd90: 7365 7420 6279 2061 2073 696e 676c 6520  set by a single 
+0002bda0: 636f 6c75 6d6e 2e0a 0a20 2020 2020 2020  column...       
+0002bdb0: 2053 6f72 7469 6e67 2061 2070 6172 616c   Sorting a paral
+0002bdc0: 6c65 6c20 6461 7461 7365 7420 7265 7175  lel dataset requ
+0002bdd0: 6972 6573 2065 7870 656e 7369 7665 2073  ires expensive s
+0002bde0: 6875 6666 6c65 7320 616e 6420 6973 2067  huffles and is g
+0002bdf0: 656e 6572 616c 6c79 0a20 2020 2020 2020  enerally.       
+0002be00: 206e 6f74 2072 6563 6f6d 6d65 6e64 6564   not recommended
+0002be10: 2e20 5365 6520 6060 7365 745f 696e 6465  . See ``set_inde
+0002be20: 7860 6020 666f 7220 696d 706c 656d 656e  x`` for implemen
+0002be30: 7461 7469 6f6e 2064 6574 6169 6c73 2e0a  tation details..
+0002be40: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0002be50: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0002be60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2062  ------.        b
+0002be70: 793a 2073 7472 206f 7220 6c69 7374 5b73  y: str or list[s
+0002be80: 7472 5d0a 2020 2020 2020 2020 2020 2020  tr].            
+0002be90: 436f 6c75 6d6e 2873 2920 746f 2073 6f72  Column(s) to sor
+0002bea0: 7420 6279 2e0a 2020 2020 2020 2020 6e70  t by..        np
+0002beb0: 6172 7469 7469 6f6e 733a 2069 6e74 2c20  artitions: int, 
+0002bec0: 4e6f 6e65 2c20 6f72 2027 6175 746f 270a  None, or 'auto'.
+0002bed0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0002bee0: 6964 6561 6c20 6e75 6d62 6572 206f 6620  ideal number of 
+0002bef0: 6f75 7470 7574 2070 6172 7469 7469 6f6e  output partition
+0002bf00: 732e 2049 6620 4e6f 6e65 2c20 7573 6520  s. If None, use 
+0002bf10: 7468 6520 7361 6d65 2061 730a 2020 2020  the same as.    
+0002bf20: 2020 2020 2020 2020 7468 6520 696e 7075          the inpu
+0002bf30: 742e 2049 6620 2761 7574 6f27 2074 6865  t. If 'auto' the
+0002bf40: 6e20 6465 6369 6465 2062 7920 6d65 6d6f  n decide by memo
+0002bf50: 7279 2075 7365 2e0a 2020 2020 2020 2020  ry use..        
+0002bf60: 6173 6365 6e64 696e 673a 2062 6f6f 6c2c  ascending: bool,
+0002bf70: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0002bf80: 2020 2020 2020 536f 7274 2061 7363 656e        Sort ascen
+0002bf90: 6469 6e67 2076 732e 2064 6573 6365 6e64  ding vs. descend
+0002bfa0: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+0002bfb0: 2044 6566 6175 6c74 7320 746f 2054 7275   Defaults to Tru
+0002bfc0: 652e 0a20 2020 2020 2020 206e 615f 706f  e..        na_po
+0002bfd0: 7369 7469 6f6e 3a20 7b27 6c61 7374 272c  sition: {'last',
+0002bfe0: 2027 6669 7273 7427 7d2c 206f 7074 696f   'first'}, optio
+0002bff0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+0002c000: 5075 7473 204e 614e 7320 6174 2074 6865  Puts NaNs at the
+0002c010: 2062 6567 696e 6e69 6e67 2069 6620 2766   beginning if 'f
+0002c020: 6972 7374 272c 2070 7574 7320 4e61 4e20  irst', puts NaN 
+0002c030: 6174 2074 6865 2065 6e64 2069 6620 276c  at the end if 'l
+0002c040: 6173 7427 2e0a 2020 2020 2020 2020 2020  ast'..          
+0002c050: 2020 4465 6661 756c 7473 2074 6f20 276c    Defaults to 'l
+0002c060: 6173 7427 2e0a 2020 2020 2020 2020 736f  ast'..        so
+0002c070: 7274 5f66 756e 6374 696f 6e3a 2066 756e  rt_function: fun
+0002c080: 6374 696f 6e2c 206f 7074 696f 6e61 6c0a  ction, optional.
+0002c090: 2020 2020 2020 2020 2020 2020 536f 7274              Sort
+0002c0a0: 696e 6720 6675 6e63 7469 6f6e 2074 6f20  ing function to 
+0002c0b0: 7573 6520 7768 656e 2073 6f72 7469 6e67  use when sorting
+0002c0c0: 2075 6e64 6572 6c79 696e 6720 7061 7274   underlying part
+0002c0d0: 6974 696f 6e73 2e0a 2020 2020 2020 2020  itions..        
+0002c0e0: 2020 2020 4966 204e 6f6e 652c 2064 6566      If None, def
+0002c0f0: 6175 6c74 7320 746f 2060 604d 2e73 6f72  aults to ``M.sor
+0002c100: 745f 7661 6c75 6573 6060 2028 7468 6520  t_values`` (the 
+0002c110: 7061 7274 6974 696f 6e20 6c69 6272 6172  partition librar
+0002c120: 7927 730a 2020 2020 2020 2020 2020 2020  y's.            
+0002c130: 696d 706c 656d 656e 7461 7469 6f6e 206f  implementation o
+0002c140: 6620 6060 736f 7274 5f76 616c 7565 7360  f ``sort_values`
+0002c150: 6029 2e0a 2020 2020 2020 2020 736f 7274  `)..        sort
+0002c160: 5f66 756e 6374 696f 6e5f 6b77 6172 6773  _function_kwargs
+0002c170: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+0002c180: 0a20 2020 2020 2020 2020 2020 2041 6464  .            Add
+0002c190: 6974 696f 6e61 6c20 6b65 7977 6f72 6420  itional keyword 
+0002c1a0: 6172 6775 6d65 6e74 7320 746f 2070 6173  arguments to pas
+0002c1b0: 7320 746f 2074 6865 2070 6172 7469 7469  s to the partiti
+0002c1c0: 6f6e 2073 6f72 7469 6e67 2066 756e 6374  on sorting funct
+0002c1d0: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+0002c1e0: 2042 7920 6465 6661 756c 742c 2060 6062   By default, ``b
+0002c1f0: 7960 602c 2060 6061 7363 656e 6469 6e67  y``, ``ascending
+0002c200: 6060 2c20 616e 6420 6060 6e61 5f70 6f73  ``, and ``na_pos
+0002c210: 6974 696f 6e60 6020 6172 6520 7072 6f76  ition`` are prov
+0002c220: 6964 6564 2e0a 0a20 2020 2020 2020 2045  ided...        E
+0002c230: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
+0002c240: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0002c250: 203e 3e3e 2064 6632 203d 2064 662e 736f   >>> df2 = df.so
+0002c260: 7274 5f76 616c 7565 7328 2778 2729 2020  rt_values('x')  
+0002c270: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0002c280: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0002c290: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
+0002c2a0: 6174 6166 7261 6d65 2e73 6875 6666 6c65  ataframe.shuffle
+0002c2b0: 2069 6d70 6f72 7420 736f 7274 5f76 616c   import sort_val
+0002c2c0: 7565 730a 0a20 2020 2020 2020 2072 6574  ues..        ret
+0002c2d0: 7572 6e20 736f 7274 5f76 616c 7565 7328  urn sort_values(
+0002c2e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002c2f0: 662c 0a20 2020 2020 2020 2020 2020 2062  f,.            b
+0002c300: 792c 0a20 2020 2020 2020 2020 2020 2061  y,.            a
+0002c310: 7363 656e 6469 6e67 3d61 7363 656e 6469  scending=ascendi
+0002c320: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
+0002c330: 6e70 6172 7469 7469 6f6e 733d 6e70 6172  npartitions=npar
+0002c340: 7469 7469 6f6e 732c 0a20 2020 2020 2020  titions,.       
+0002c350: 2020 2020 206e 615f 706f 7369 7469 6f6e       na_position
+0002c360: 3d6e 615f 706f 7369 7469 6f6e 2c0a 2020  =na_position,.  
+0002c370: 2020 2020 2020 2020 2020 736f 7274 5f66            sort_f
+0002c380: 756e 6374 696f 6e3d 736f 7274 5f66 756e  unction=sort_fun
+0002c390: 6374 696f 6e2c 0a20 2020 2020 2020 2020  ction,.         
+0002c3a0: 2020 2073 6f72 745f 6675 6e63 7469 6f6e     sort_function
+0002c3b0: 5f6b 7761 7267 733d 736f 7274 5f66 756e  _kwargs=sort_fun
+0002c3c0: 6374 696f 6e5f 6b77 6172 6773 2c0a 2020  ction_kwargs,.  
+0002c3d0: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
+0002c3e0: 6773 2c0a 2020 2020 2020 2020 290a 0a20  gs,.        ).. 
+0002c3f0: 2020 2064 6566 2073 6574 5f69 6e64 6578     def set_index
+0002c400: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0002c410: 2020 2020 2020 2020 6f74 6865 723a 2073          other: s
+0002c420: 7472 207c 2053 6572 6965 732c 0a20 2020  tr | Series,.   
+0002c430: 2020 2020 2064 726f 703a 2062 6f6f 6c20       drop: bool 
+0002c440: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+0002c450: 736f 7274 6564 3a20 626f 6f6c 203d 2046  sorted: bool = F
+0002c460: 616c 7365 2c0a 2020 2020 2020 2020 6e70  alse,.        np
+0002c470: 6172 7469 7469 6f6e 733a 2069 6e74 207c  artitions: int |
+0002c480: 204c 6974 6572 616c 5b22 6175 746f 225d   Literal["auto"]
+0002c490: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+0002c4a0: 2020 2020 2020 2020 6469 7669 7369 6f6e          division
+0002c4b0: 733a 2053 6571 7565 6e63 6520 7c20 4e6f  s: Sequence | No
+0002c4c0: 6e65 203d 204e 6f6e 652c 0a20 2020 2020  ne = None,.     
+0002c4d0: 2020 2069 6e70 6c61 6365 3a20 626f 6f6c     inplace: bool
+0002c4e0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0002c4f0: 2020 736f 7274 3a20 626f 6f6c 203d 2054    sort: bool = T
+0002c500: 7275 652c 0a20 2020 2020 2020 202a 2a6b  rue,.        **k
+0002c510: 7761 7267 732c 0a20 2020 2029 3a0a 2020  wargs,.    ):.  
+0002c520: 2020 2020 2020 2222 2253 6574 2074 6865        """Set the
+0002c530: 2044 6174 6146 7261 6d65 2069 6e64 6578   DataFrame index
+0002c540: 2028 726f 7720 6c61 6265 6c73 2920 7573   (row labels) us
+0002c550: 696e 6720 616e 2065 7869 7374 696e 6720  ing an existing 
+0002c560: 636f 6c75 6d6e 2e0a 0a20 2020 2020 2020  column...       
+0002c570: 2049 6620 6060 736f 7274 3d46 616c 7365   If ``sort=False
+0002c580: 6060 2c20 7468 6973 2066 756e 6374 696f  ``, this functio
+0002c590: 6e20 6f70 6572 6174 6573 2065 7861 6374  n operates exact
+0002c5a0: 6c79 206c 696b 6520 6060 7061 6e64 6173  ly like ``pandas
+0002c5b0: 2e73 6574 5f69 6e64 6578 6060 0a20 2020  .set_index``.   
+0002c5c0: 2020 2020 2061 6e64 2073 6574 7320 7468       and sets th
+0002c5d0: 6520 696e 6465 7820 6f6e 2074 6865 2044  e index on the D
+0002c5e0: 6174 6146 7261 6d65 2e20 4966 2060 6073  ataFrame. If ``s
+0002c5f0: 6f72 743d 5472 7565 6060 2028 6465 6661  ort=True`` (defa
+0002c600: 756c 7429 2c0a 2020 2020 2020 2020 7468  ult),.        th
+0002c610: 6973 2066 756e 6374 696f 6e20 616c 736f  is function also
+0002c620: 2073 6f72 7473 2074 6865 2044 6174 6146   sorts the DataF
+0002c630: 7261 6d65 2062 7920 7468 6520 6e65 7720  rame by the new 
+0002c640: 696e 6465 782e 2054 6869 7320 6361 6e20  index. This can 
+0002c650: 6861 7665 2061 0a20 2020 2020 2020 2073  have a.        s
+0002c660: 6967 6e69 6669 6361 6e74 2069 6d70 6163  ignificant impac
+0002c670: 7420 6f6e 2070 6572 666f 726d 616e 6365  t on performance
+0002c680: 2c20 6265 6361 7573 6520 6a6f 696e 732c  , because joins,
+0002c690: 2067 726f 7570 6279 732c 206c 6f6f 6b75   groupbys, looku
+0002c6a0: 7073 2c20 6574 632e 0a20 2020 2020 2020  ps, etc..       
+0002c6b0: 2061 7265 2061 6c6c 206d 7563 6820 6661   are all much fa
+0002c6c0: 7374 6572 206f 6e20 7468 6174 2063 6f6c  ster on that col
+0002c6d0: 756d 6e2e 2048 6f77 6576 6572 2c20 7468  umn. However, th
+0002c6e0: 6973 2070 6572 666f 726d 616e 6365 2069  is performance i
+0002c6f0: 6e63 7265 6173 650a 2020 2020 2020 2020  ncrease.        
+0002c700: 636f 6d65 7320 7769 7468 2061 2063 6f73  comes with a cos
+0002c710: 742c 2073 6f72 7469 6e67 2061 2070 6172  t, sorting a par
+0002c720: 616c 6c65 6c20 6461 7461 7365 7420 7265  allel dataset re
+0002c730: 7175 6972 6573 2065 7870 656e 7369 7665  quires expensive
+0002c740: 2073 6875 6666 6c65 732e 0a20 2020 2020   shuffles..     
+0002c750: 2020 204f 6674 656e 2077 6520 6060 7365     Often we ``se
+0002c760: 745f 696e 6465 7860 6020 6f6e 6365 2064  t_index`` once d
+0002c770: 6972 6563 746c 7920 6166 7465 7220 6461  irectly after da
+0002c780: 7461 2069 6e67 6573 7420 616e 6420 6669  ta ingest and fi
+0002c790: 6c74 6572 696e 6720 616e 640a 2020 2020  ltering and.    
+0002c7a0: 2020 2020 7468 656e 2070 6572 666f 726d      then perform
+0002c7b0: 206d 616e 7920 6368 6561 7020 636f 6d70   many cheap comp
+0002c7c0: 7574 6174 696f 6e73 206f 6666 206f 6620  utations off of 
+0002c7d0: 7468 6520 736f 7274 6564 2064 6174 6173  the sorted datas
+0002c7e0: 6574 2e0a 0a20 2020 2020 2020 2057 6974  et...        Wit
+0002c7f0: 6820 6060 736f 7274 3d54 7275 6560 602c  h ``sort=True``,
+0002c800: 2074 6869 7320 6675 6e63 7469 6f6e 2069   this function i
+0002c810: 7320 6d75 6368 206d 6f72 6520 6578 7065  s much more expe
+0002c820: 6e73 6976 652e 2055 6e64 6572 206e 6f72  nsive. Under nor
+0002c830: 6d61 6c0a 2020 2020 2020 2020 6f70 6572  mal.        oper
+0002c840: 6174 696f 6e20 7468 6973 2066 756e 6374  ation this funct
+0002c850: 696f 6e20 646f 6573 2061 6e20 696e 6974  ion does an init
+0002c860: 6961 6c20 7061 7373 206f 7665 7220 7468  ial pass over th
+0002c870: 6520 696e 6465 7820 636f 6c75 6d6e 2074  e index column t
+0002c880: 6f0a 2020 2020 2020 2020 636f 6d70 7574  o.        comput
+0002c890: 6520 6170 7072 6f78 696d 6174 6520 7175  e approximate qu
+0002c8a0: 616e 7469 6c65 7320 746f 2073 6572 7665  antiles to serve
+0002c8b0: 2061 7320 6675 7475 7265 2064 6976 6973   as future divis
+0002c8c0: 696f 6e73 2e20 4974 2074 6865 6e20 7061  ions. It then pa
+0002c8d0: 7373 6573 0a20 2020 2020 2020 206f 7665  sses.        ove
+0002c8e0: 7220 7468 6520 6461 7461 2061 2073 6563  r the data a sec
+0002c8f0: 6f6e 6420 7469 6d65 2c20 7370 6c69 7474  ond time, splitt
+0002c900: 696e 6720 7570 2065 6163 6820 696e 7075  ing up each inpu
+0002c910: 7420 7061 7274 6974 696f 6e20 696e 746f  t partition into
+0002c920: 2073 6576 6572 616c 0a20 2020 2020 2020   several.       
+0002c930: 2070 6965 6365 7320 616e 6420 7368 6172   pieces and shar
+0002c940: 696e 6720 7468 6f73 6520 7069 6563 6573  ing those pieces
+0002c950: 2074 6f20 616c 6c20 6f66 2074 6865 206f   to all of the o
+0002c960: 7574 7075 7420 7061 7274 6974 696f 6e73  utput partitions
+0002c970: 206e 6f77 2069 6e0a 2020 2020 2020 2020   now in.        
+0002c980: 736f 7274 6564 206f 7264 6572 2e0a 0a20  sorted order... 
+0002c990: 2020 2020 2020 2049 6e20 736f 6d65 2063         In some c
+0002c9a0: 6173 6573 2077 6520 6361 6e20 616c 6c65  ases we can alle
+0002c9b0: 7669 6174 6520 7468 6f73 6520 636f 7374  viate those cost
+0002c9c0: 732c 2066 6f72 2065 7861 6d70 6c65 2069  s, for example i
+0002c9d0: 6620 796f 7572 2064 6174 6173 6574 2069  f your dataset i
+0002c9e0: 730a 2020 2020 2020 2020 736f 7274 6564  s.        sorted
+0002c9f0: 2061 6c72 6561 6479 2074 6865 6e20 7765   already then we
+0002ca00: 2063 616e 2061 766f 6964 206d 616b 696e   can avoid makin
+0002ca10: 6720 6d61 6e79 2073 6d61 6c6c 2070 6965  g many small pie
+0002ca20: 6365 7320 6f72 2069 6620 796f 7520 6b6e  ces or if you kn
+0002ca30: 6f77 0a20 2020 2020 2020 2067 6f6f 6420  ow.        good 
+0002ca40: 7661 6c75 6573 2074 6f20 7370 6c69 7420  values to split 
+0002ca50: 7468 6520 6e65 7720 696e 6465 7820 636f  the new index co
+0002ca60: 6c75 6d6e 2074 6865 6e20 7765 2063 616e  lumn then we can
+0002ca70: 2061 766f 6964 2074 6865 2069 6e69 7469   avoid the initi
+0002ca80: 616c 0a20 2020 2020 2020 2070 6173 7320  al.        pass 
+0002ca90: 6f76 6572 2074 6865 2064 6174 612e 2046  over the data. F
+0002caa0: 6f72 2065 7861 6d70 6c65 2069 6620 796f  or example if yo
+0002cab0: 7572 206e 6577 2069 6e64 6578 2069 7320  ur new index is 
+0002cac0: 6120 6461 7465 7469 6d65 2069 6e64 6578  a datetime index
+0002cad0: 2061 6e64 0a20 2020 2020 2020 2079 6f75   and.        you
+0002cae0: 7220 6461 7461 2069 7320 616c 7265 6164  r data is alread
+0002caf0: 7920 736f 7274 6564 2062 7920 6461 7920  y sorted by day 
+0002cb00: 7468 656e 2074 6869 7320 656e 7469 7265  then this entire
+0002cb10: 206f 7065 7261 7469 6f6e 2063 616e 2062   operation can b
+0002cb20: 6520 646f 6e65 0a20 2020 2020 2020 2066  e done.        f
+0002cb30: 6f72 2066 7265 652e 2059 6f75 2063 616e  or free. You can
+0002cb40: 2063 6f6e 7472 6f6c 2074 6865 7365 206f   control these o
+0002cb50: 7074 696f 6e73 2077 6974 6820 7468 6520  ptions with the 
+0002cb60: 666f 6c6c 6f77 696e 6720 7061 7261 6d65  following parame
+0002cb70: 7465 7273 2e0a 0a20 2020 2020 2020 2050  ters...        P
+0002cb80: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0002cb90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0002cba0: 2020 2020 206f 7468 6572 3a20 7374 7269       other: stri
+0002cbb0: 6e67 206f 7220 4461 736b 2053 6572 6965  ng or Dask Serie
+0002cbc0: 730a 2020 2020 2020 2020 2020 2020 436f  s.            Co
+0002cbd0: 6c75 6d6e 2074 6f20 7573 6520 6173 2069  lumn to use as i
+0002cbe0: 6e64 6578 2e0a 2020 2020 2020 2020 6472  ndex..        dr
+0002cbf0: 6f70 3a20 626f 6f6c 6561 6e2c 2064 6566  op: boolean, def
+0002cc00: 6175 6c74 2054 7275 650a 2020 2020 2020  ault True.      
+0002cc10: 2020 2020 2020 4465 6c65 7465 2063 6f6c        Delete col
+0002cc20: 756d 6e20 746f 2062 6520 7573 6564 2061  umn to be used a
+0002cc30: 7320 7468 6520 6e65 7720 696e 6465 782e  s the new index.
+0002cc40: 0a20 2020 2020 2020 2073 6f72 7465 643a  .        sorted:
+0002cc50: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
+0002cc60: 2020 2020 2020 2020 2020 2020 4966 2074              If t
+0002cc70: 6865 2069 6e64 6578 2063 6f6c 756d 6e20  he index column 
+0002cc80: 6973 2061 6c72 6561 6479 2073 6f72 7465  is already sorte
+0002cc90: 6420 696e 2069 6e63 7265 6173 696e 6720  d in increasing 
+0002cca0: 6f72 6465 722e 0a20 2020 2020 2020 2020  order..         
+0002ccb0: 2020 2044 6566 6175 6c74 7320 746f 2046     Defaults to F
+0002ccc0: 616c 7365 0a20 2020 2020 2020 206e 7061  alse.        npa
+0002ccd0: 7274 6974 696f 6e73 3a20 696e 742c 204e  rtitions: int, N
+0002cce0: 6f6e 652c 206f 7220 2761 7574 6f27 0a20  one, or 'auto'. 
+0002ccf0: 2020 2020 2020 2020 2020 2054 6865 2069             The i
+0002cd00: 6465 616c 206e 756d 6265 7220 6f66 206f  deal number of o
+0002cd10: 7574 7075 7420 7061 7274 6974 696f 6e73  utput partitions
+0002cd20: 2e20 4966 204e 6f6e 652c 2075 7365 2074  . If None, use t
+0002cd30: 6865 2073 616d 6520 6173 0a20 2020 2020  he same as.     
+0002cd40: 2020 2020 2020 2074 6865 2069 6e70 7574         the input
+0002cd50: 2e20 4966 2027 6175 746f 2720 7468 656e  . If 'auto' then
+0002cd60: 2064 6563 6964 6520 6279 206d 656d 6f72   decide by memor
+0002cd70: 7920 7573 652e 0a20 2020 2020 2020 2020  y use..         
+0002cd80: 2020 204f 6e6c 7920 7573 6564 2077 6865     Only used whe
+0002cd90: 6e20 6060 6469 7669 7369 6f6e 7360 6020  n ``divisions`` 
+0002cda0: 6973 206e 6f74 2067 6976 656e 2e20 4966  is not given. If
+0002cdb0: 2060 6064 6976 6973 696f 6e73 6060 2069   ``divisions`` i
+0002cdc0: 7320 6769 7665 6e2c 0a20 2020 2020 2020  s given,.       
+0002cdd0: 2020 2020 2074 6865 206e 756d 6265 7220       the number 
+0002cde0: 6f66 206f 7574 7075 7420 7061 7274 6974  of output partit
+0002cdf0: 696f 6e73 2077 696c 6c20 6265 2060 606c  ions will be ``l
+0002ce00: 656e 2864 6976 6973 696f 6e73 2920 2d20  en(divisions) - 
+0002ce10: 3160 602e 0a20 2020 2020 2020 2064 6976  1``..        div
+0002ce20: 6973 696f 6e73 3a20 6c69 7374 2c20 6f70  isions: list, op
+0002ce30: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+0002ce40: 2020 2054 6865 2022 6469 7669 6469 6e67     The "dividing
+0002ce50: 206c 696e 6573 2220 7573 6564 2074 6f20   lines" used to 
+0002ce60: 7370 6c69 7420 7468 6520 6e65 7720 696e  split the new in
+0002ce70: 6465 7820 696e 746f 2070 6172 7469 7469  dex into partiti
+0002ce80: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
+0002ce90: 2046 6f72 2060 6064 6976 6973 696f 6e73   For ``divisions
+0002cea0: 3d5b 302c 2031 302c 2035 302c 2031 3030  =[0, 10, 50, 100
+0002ceb0: 5d60 602c 2074 6865 7265 2077 6f75 6c64  ]``, there would
+0002cec0: 2062 6520 7468 7265 6520 6f75 7470 7574   be three output
+0002ced0: 2070 6172 7469 7469 6f6e 732c 0a20 2020   partitions,.   
+0002cee0: 2020 2020 2020 2020 2077 6865 7265 2074           where t
+0002cef0: 6865 206e 6577 2069 6e64 6578 2063 6f6e  he new index con
+0002cf00: 7461 696e 6564 205b 302c 2031 3029 2c20  tained [0, 10), 
+0002cf10: 5b31 302c 2035 3029 2c20 616e 6420 5b35  [10, 50), and [5
+0002cf20: 302c 2031 3030 292c 2072 6573 7065 6374  0, 100), respect
+0002cf30: 6976 656c 792e 0a20 2020 2020 2020 2020  ively..         
+0002cf40: 2020 2053 6565 2068 7474 7073 3a2f 2f64     See https://d
+0002cf50: 6f63 732e 6461 736b 2e6f 7267 2f65 6e2f  ocs.dask.org/en/
+0002cf60: 6c61 7465 7374 2f64 6174 6166 7261 6d65  latest/dataframe
+0002cf70: 2d64 6573 6967 6e2e 6874 6d6c 2370 6172  -design.html#par
+0002cf80: 7469 7469 6f6e 732e 0a20 2020 2020 2020  titions..       
+0002cf90: 2020 2020 2049 6620 6e6f 7420 6769 7665       If not give
+0002cfa0: 6e20 2864 6566 6175 6c74 292c 2067 6f6f  n (default), goo
+0002cfb0: 6420 6469 7669 7369 6f6e 7320 6172 6520  d divisions are 
+0002cfc0: 6361 6c63 756c 6174 6564 2062 7920 696d  calculated by im
+0002cfd0: 6d65 6469 6174 656c 7920 636f 6d70 7574  mediately comput
+0002cfe0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0002cff0: 7468 6520 6461 7461 2061 6e64 206c 6f6f  the data and loo
+0002d000: 6b69 6e67 2061 7420 7468 6520 6469 7374  king at the dist
+0002d010: 7269 6275 7469 6f6e 206f 6620 6974 7320  ribution of its 
+0002d020: 7661 6c75 6573 2e20 466f 7220 6c61 7267  values. For larg
+0002d030: 6520 6461 7461 7365 7473 2c0a 2020 2020  e datasets,.    
+0002d040: 2020 2020 2020 2020 7468 6973 2063 616e          this can
+0002d050: 2062 6520 6578 7065 6e73 6976 652e 0a20   be expensive.. 
+0002d060: 2020 2020 2020 2020 2020 204e 6f74 6520             Note 
+0002d070: 7468 6174 2069 6620 6060 736f 7274 6564  that if ``sorted
+0002d080: 3d54 7275 6560 602c 2073 7065 6369 6669  =True``, specifi
+0002d090: 6564 2064 6976 6973 696f 6e73 2061 7265  ed divisions are
+0002d0a0: 2061 7373 756d 6564 2074 6f20 6d61 7463   assumed to matc
+0002d0b0: 680a 2020 2020 2020 2020 2020 2020 7468  h.            th
+0002d0c0: 6520 6578 6973 7469 6e67 2070 6172 7469  e existing parti
+0002d0d0: 7469 6f6e 7320 696e 2074 6865 2064 6174  tions in the dat
+0002d0e0: 613b 2069 6620 7468 6973 2069 7320 756e  a; if this is un
+0002d0f0: 7472 7565 2079 6f75 2073 686f 756c 640a  true you should.
+0002d100: 2020 2020 2020 2020 2020 2020 6c65 6176              leav
+0002d110: 6520 6469 7669 7369 6f6e 7320 656d 7074  e divisions empt
+0002d120: 7920 616e 6420 6361 6c6c 2060 6072 6570  y and call ``rep
+0002d130: 6172 7469 7469 6f6e 6060 2061 6674 6572  artition`` after
+0002d140: 2060 6073 6574 5f69 6e64 6578 6060 2e0a   ``set_index``..
+0002d150: 2020 2020 2020 2020 696e 706c 6163 653a          inplace:
+0002d160: 2062 6f6f 6c2c 206f 7074 696f 6e61 6c0a   bool, optional.
+0002d170: 2020 2020 2020 2020 2020 2020 4d6f 6469              Modi
+0002d180: 6679 696e 6720 7468 6520 4461 7461 4672  fying the DataFr
+0002d190: 616d 6520 696e 2070 6c61 6365 2069 7320  ame in place is 
+0002d1a0: 6e6f 7420 7375 7070 6f72 7465 6420 6279  not supported by
+0002d1b0: 2044 6173 6b2e 0a20 2020 2020 2020 2020   Dask..         
+0002d1c0: 2020 2044 6566 6175 6c74 7320 746f 2046     Defaults to F
+0002d1d0: 616c 7365 2e0a 2020 2020 2020 2020 736f  alse..        so
+0002d1e0: 7274 3a20 626f 6f6c 2c20 6f70 7469 6f6e  rt: bool, option
+0002d1f0: 616c 0a20 2020 2020 2020 2020 2020 2049  al.            I
+0002d200: 6620 6060 5472 7565 6060 2c20 736f 7274  f ``True``, sort
+0002d210: 2074 6865 2044 6174 6146 7261 6d65 2062   the DataFrame b
+0002d220: 7920 7468 6520 6e65 7720 696e 6465 782e  y the new index.
+0002d230: 204f 7468 6572 7769 7365 0a20 2020 2020   Otherwise.     
+0002d240: 2020 2020 2020 2073 6574 2074 6865 2069         set the i
+0002d250: 6e64 6578 206f 6e20 7468 6520 696e 6469  ndex on the indi
+0002d260: 7669 6475 616c 2065 7869 7374 696e 6720  vidual existing 
+0002d270: 7061 7274 6974 696f 6e73 2e0a 2020 2020  partitions..    
+0002d280: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+0002d290: 2074 6f20 6060 5472 7565 6060 2e0a 2020   to ``True``..  
+0002d2a0: 2020 2020 2020 7368 7566 666c 653a 2073        shuffle: s
+0002d2b0: 7472 696e 672c 2027 6469 736b 2720 6f72  tring, 'disk' or
+0002d2c0: 2027 7461 736b 7327 2c20 6f70 7469 6f6e   'tasks', option
+0002d2d0: 616c 0a20 2020 2020 2020 2020 2020 2045  al.            E
+0002d2e0: 6974 6865 7220 6060 2764 6973 6b27 6060  ither ``'disk'``
+0002d2f0: 2066 6f72 2073 696e 676c 652d 6e6f 6465   for single-node
+0002d300: 206f 7065 7261 7469 6f6e 206f 7220 6060   operation or ``
+0002d310: 2774 6173 6b73 2760 6020 666f 720a 2020  'tasks'`` for.  
+0002d320: 2020 2020 2020 2020 2020 6469 7374 7269            distri
+0002d330: 6275 7465 6420 6f70 6572 6174 696f 6e2e  buted operation.
+0002d340: 2020 5769 6c6c 2062 6520 696e 6665 7272    Will be inferr
+0002d350: 6564 2062 7920 796f 7572 2063 7572 7265  ed by your curre
+0002d360: 6e74 2073 6368 6564 756c 6572 2e0a 2020  nt scheduler..  
+0002d370: 2020 2020 2020 636f 6d70 7574 653a 2062        compute: b
+0002d380: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
+0002d390: 7365 0a20 2020 2020 2020 2020 2020 2057  se.            W
+0002d3a0: 6865 7468 6572 206f 7220 6e6f 7420 746f  hether or not to
+0002d3b0: 2074 7269 6767 6572 2061 6e20 696d 6d65   trigger an imme
+0002d3c0: 6469 6174 6520 636f 6d70 7574 6174 696f  diate computatio
+0002d3d0: 6e2e 2044 6566 6175 6c74 7320 746f 2046  n. Defaults to F
+0002d3e0: 616c 7365 2e0a 2020 2020 2020 2020 2020  alse..          
+0002d3f0: 2020 4e6f 7465 2c20 7468 6174 2065 7665    Note, that eve
+0002d400: 6e20 6966 2079 6f75 2073 6574 2060 6063  n if you set ``c
+0002d410: 6f6d 7075 7465 3d46 616c 7365 6060 2c20  ompute=False``, 
+0002d420: 616e 2069 6d6d 6564 6961 7465 2063 6f6d  an immediate com
+0002d430: 7075 7461 7469 6f6e 0a20 2020 2020 2020  putation.       
+0002d440: 2020 2020 2077 696c 6c20 7374 696c 6c20       will still 
+0002d450: 6265 2074 7269 6767 6572 6564 2069 6620  be triggered if 
+0002d460: 6060 6469 7669 7369 6f6e 7360 6020 6973  ``divisions`` is
+0002d470: 2060 604e 6f6e 6560 602e 0a20 2020 2020   ``None``..     
+0002d480: 2020 2070 6172 7469 7469 6f6e 5f73 697a     partition_siz
+0002d490: 653a 2069 6e74 2c20 6f70 7469 6f6e 616c  e: int, optional
+0002d4a0: 0a20 2020 2020 2020 2020 2020 2044 6573  .            Des
+0002d4b0: 6972 6564 2073 697a 6520 6f66 2065 6163  ired size of eac
+0002d4c0: 6820 7061 7274 6974 696f 6e73 2069 6e20  h partitions in 
+0002d4d0: 6279 7465 732e 0a20 2020 2020 2020 2020  bytes..         
+0002d4e0: 2020 204f 6e6c 7920 7573 6564 2077 6865     Only used whe
+0002d4f0: 6e20 6060 6e70 6172 7469 7469 6f6e 733d  n ``npartitions=
+0002d500: 2761 7574 6f27 6060 0a0a 2020 2020 2020  'auto'``..      
+0002d510: 2020 4578 616d 706c 6573 0a20 2020 2020    Examples.     
+0002d520: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+0002d530: 2020 2020 3e3e 3e20 696d 706f 7274 2064      >>> import d
+0002d540: 6173 6b0a 2020 2020 2020 2020 3e3e 3e20  ask.        >>> 
+0002d550: 6464 6620 3d20 6461 736b 2e64 6174 6173  ddf = dask.datas
+0002d560: 6574 732e 7469 6d65 7365 7269 6573 2873  ets.timeseries(s
+0002d570: 7461 7274 3d22 3230 3231 2d30 312d 3031  tart="2021-01-01
+0002d580: 222c 2065 6e64 3d22 3230 3231 2d30 312d  ", end="2021-01-
+0002d590: 3037 222c 2066 7265 713d 2231 4822 292e  07", freq="1H").
+0002d5a0: 7265 7365 745f 696e 6465 7828 290a 2020  reset_index().  
+0002d5b0: 2020 2020 2020 3e3e 3e20 6464 6632 203d        >>> ddf2 =
+0002d5c0: 2064 6466 2e73 6574 5f69 6e64 6578 2822   ddf.set_index("
+0002d5d0: 7822 290a 2020 2020 2020 2020 3e3e 3e20  x").        >>> 
+0002d5e0: 6464 6632 203d 2064 6466 2e73 6574 5f69  ddf2 = ddf.set_i
+0002d5f0: 6e64 6578 2864 6466 2e78 290a 2020 2020  ndex(ddf.x).    
+0002d600: 2020 2020 3e3e 3e20 6464 6632 203d 2064      >>> ddf2 = d
+0002d610: 6466 2e73 6574 5f69 6e64 6578 2864 6466  df.set_index(ddf
+0002d620: 2e74 696d 6573 7461 6d70 2c20 736f 7274  .timestamp, sort
+0002d630: 6564 3d54 7275 6529 0a0a 2020 2020 2020  ed=True)..      
+0002d640: 2020 4120 636f 6d6d 6f6e 2063 6173 6520    A common case 
+0002d650: 6973 2077 6865 6e20 7765 2068 6176 6520  is when we have 
+0002d660: 6120 6461 7465 7469 6d65 2063 6f6c 756d  a datetime colum
+0002d670: 6e20 7468 6174 2077 6520 6b6e 6f77 2074  n that we know t
+0002d680: 6f20 6265 0a20 2020 2020 2020 2073 6f72  o be.        sor
+0002d690: 7465 6420 616e 6420 6973 2063 6c65 616e  ted and is clean
+0002d6a0: 6c79 2064 6976 6964 6564 2062 7920 6461  ly divided by da
+0002d6b0: 792e 2020 5765 2063 616e 2073 6574 2074  y.  We can set t
+0002d6c0: 6869 7320 696e 6465 7820 666f 7220 6672  his index for fr
+0002d6d0: 6565 0a20 2020 2020 2020 2062 7920 7370  ee.        by sp
+0002d6e0: 6563 6966 7969 6e67 2062 6f74 6820 7468  ecifying both th
+0002d6f0: 6174 2074 6865 2063 6f6c 756d 6e20 6973  at the column is
+0002d700: 2070 7265 2d73 6f72 7465 6420 616e 6420   pre-sorted and 
+0002d710: 7468 6520 7061 7274 6963 756c 6172 0a20  the particular. 
+0002d720: 2020 2020 2020 2064 6976 6973 696f 6e73         divisions
+0002d730: 2061 6c6f 6e67 2077 6869 6368 2069 7320   along which is 
+0002d740: 6973 2073 6570 6172 6174 6564 0a0a 2020  is separated..  
+0002d750: 2020 2020 2020 3e3e 3e20 696d 706f 7274        >>> import
+0002d760: 2070 616e 6461 7320 6173 2070 640a 2020   pandas as pd.  
+0002d770: 2020 2020 2020 3e3e 3e20 6469 7669 7369        >>> divisi
+0002d780: 6f6e 7320 3d20 7064 2e64 6174 655f 7261  ons = pd.date_ra
+0002d790: 6e67 6528 7374 6172 743d 2232 3032 312d  nge(start="2021-
+0002d7a0: 3031 2d30 3122 2c20 656e 643d 2232 3032  01-01", end="202
+0002d7b0: 312d 3031 2d30 3722 2c20 6672 6571 3d27  1-01-07", freq='
+0002d7c0: 3144 2729 0a20 2020 2020 2020 203e 3e3e  1D').        >>>
+0002d7d0: 2064 6976 6973 696f 6e73 0a20 2020 2020   divisions.     
+0002d7e0: 2020 2044 6174 6574 696d 6549 6e64 6578     DatetimeIndex
+0002d7f0: 285b 2732 3032 312d 3031 2d30 3127 2c20  (['2021-01-01', 
+0002d800: 2732 3032 312d 3031 2d30 3227 2c20 2732  '2021-01-02', '2
+0002d810: 3032 312d 3031 2d30 3327 2c20 2732 3032  021-01-03', '202
+0002d820: 312d 3031 2d30 3427 2c0a 2020 2020 2020  1-01-04',.      
+0002d830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d840: 2027 3230 3231 2d30 312d 3035 272c 2027   '2021-01-05', '
+0002d850: 3230 3231 2d30 312d 3036 272c 2027 3230  2021-01-06', '20
+0002d860: 3231 2d30 312d 3037 275d 2c0a 2020 2020  21-01-07'],.    
+0002d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d880: 2020 6474 7970 653d 2764 6174 6574 696d    dtype='datetim
+0002d890: 6536 345b 6e73 5d27 2c20 6672 6571 3d27  e64[ns]', freq='
+0002d8a0: 4427 290a 0a20 2020 2020 2020 204e 6f74  D')..        Not
+0002d8b0: 6520 7468 6174 2060 606c 656e 2864 6976  e that ``len(div
+0002d8c0: 6973 6f6e 7329 6060 2069 7320 6571 7561  isons)`` is equa
+0002d8d0: 6c20 746f 2060 606e 7061 7274 6974 696f  l to ``npartitio
+0002d8e0: 6e73 202b 2031 6060 2e20 5468 6973 2069  ns + 1``. This i
+0002d8f0: 7320 6265 6361 7573 6520 6060 6469 7669  s because ``divi
+0002d900: 7369 6f6e 7360 600a 2020 2020 2020 2020  sions``.        
+0002d910: 7265 7072 6573 656e 7473 2074 6865 2075  represents the u
+0002d920: 7070 6572 2061 6e64 206c 6f77 6572 2062  pper and lower b
+0002d930: 6f75 6e64 7320 6f66 2065 6163 6820 7061  ounds of each pa
+0002d940: 7274 6974 696f 6e2e 2054 6865 2066 6972  rtition. The fir
+0002d950: 7374 2069 7465 6d20 6973 2074 6865 0a20  st item is the. 
+0002d960: 2020 2020 2020 206c 6f77 6572 2062 6f75         lower bou
+0002d970: 6e64 206f 6620 7468 6520 6669 7273 7420  nd of the first 
+0002d980: 7061 7274 6974 696f 6e2c 2074 6865 2073  partition, the s
+0002d990: 6563 6f6e 6420 6974 656d 2069 7320 7468  econd item is th
+0002d9a0: 6520 6c6f 7765 7220 626f 756e 6420 6f66  e lower bound of
+0002d9b0: 2074 6865 0a20 2020 2020 2020 2073 6563   the.        sec
+0002d9c0: 6f6e 6420 7061 7274 6974 696f 6e20 616e  ond partition an
+0002d9d0: 6420 7468 6520 7570 7065 7220 626f 756e  d the upper boun
+0002d9e0: 6420 6f66 2074 6865 2066 6972 7374 2070  d of the first p
+0002d9f0: 6172 7469 7469 6f6e 2c20 616e 6420 736f  artition, and so
+0002da00: 206f 6e2e 0a20 2020 2020 2020 2054 6865   on..        The
+0002da10: 2073 6563 6f6e 642d 746f 2d6c 6173 7420   second-to-last 
+0002da20: 6974 656d 2069 7320 7468 6520 6c6f 7765  item is the lowe
+0002da30: 7220 626f 756e 6420 6f66 2074 6865 206c  r bound of the l
+0002da40: 6173 7420 7061 7274 6974 696f 6e2c 2061  ast partition, a
+0002da50: 6e64 2074 6865 206c 6173 740a 2020 2020  nd the last.    
+0002da60: 2020 2020 2865 7874 7261 2920 6974 656d      (extra) item
+0002da70: 2069 7320 7468 6520 7570 7065 7220 626f   is the upper bo
+0002da80: 756e 6420 6f66 2074 6865 206c 6173 7420  und of the last 
+0002da90: 7061 7274 6974 696f 6e2e 0a0a 2020 2020  partition...    
+0002daa0: 2020 2020 3e3e 3e20 6464 6632 203d 2064      >>> ddf2 = d
+0002dab0: 6466 2e73 6574 5f69 6e64 6578 2822 7469  df.set_index("ti
+0002dac0: 6d65 7374 616d 7022 2c20 736f 7274 6564  mestamp", sorted
+0002dad0: 3d54 7275 652c 2064 6976 6973 696f 6e73  =True, divisions
+0002dae0: 3d64 6976 6973 696f 6e73 2e74 6f6c 6973  =divisions.tolis
+0002daf0: 7428 2929 0a0a 2020 2020 2020 2020 4966  t())..        If
+0002db00: 2079 6f75 276c 6c20 6265 2072 756e 6e69   you'll be runni
+0002db10: 6e67 2060 7365 745f 696e 6465 7860 206f  ng `set_index` o
+0002db20: 6e20 7468 6520 7361 6d65 2028 6f72 2073  n the same (or s
+0002db30: 696d 696c 6172 2920 6461 7461 7365 7473  imilar) datasets
+0002db40: 2072 6570 6561 7465 646c 792c 0a20 2020   repeatedly,.   
+0002db50: 2020 2020 2079 6f75 2063 6f75 6c64 2073       you could s
+0002db60: 6176 6520 7469 6d65 2062 7920 6c65 7474  ave time by lett
+0002db70: 696e 6720 4461 736b 2063 616c 6375 6c61  ing Dask calcula
+0002db80: 7465 2067 6f6f 6420 6469 7669 7369 6f6e  te good division
+0002db90: 7320 6f6e 6365 2c20 7468 656e 2063 6f70  s once, then cop
+0002dba0: 792d 7061 7374 696e 670a 2020 2020 2020  y-pasting.      
+0002dbb0: 2020 7468 656d 2074 6f20 7265 7573 652e    them to reuse.
+0002dbc0: 2054 6869 7320 6973 2065 7370 6563 6961   This is especia
+0002dbd0: 6c6c 7920 6865 6c70 6675 6c20 7275 6e6e  lly helpful runn
+0002dbe0: 696e 6720 696e 2061 204a 7570 7974 6572  ing in a Jupyter
+0002dbf0: 206e 6f74 6562 6f6f 6b3a 0a0a 2020 2020   notebook:..    
+0002dc00: 2020 2020 3e3e 3e20 6464 6632 203d 2064      >>> ddf2 = d
+0002dc10: 6466 2e73 6574 5f69 6e64 6578 2822 6e61  df.set_index("na
+0002dc20: 6d65 2229 2020 2320 736c 6f77 2c20 6361  me")  # slow, ca
+0002dc30: 6c63 756c 6174 6573 2064 6174 6120 6469  lculates data di
+0002dc40: 7374 7269 6275 7469 6f6e 0a20 2020 2020  stribution.     
+0002dc50: 2020 203e 3e3e 2064 6466 322e 6469 7669     >>> ddf2.divi
+0002dc60: 7369 6f6e 7320 2023 2064 6f63 7465 7374  sions  # doctest
+0002dc70: 3a20 2b53 4b49 500a 2020 2020 2020 2020  : +SKIP.        
+0002dc80: 5b22 416c 6963 6522 2c20 224c 6175 7261  ["Alice", "Laura
+0002dc90: 222c 2022 5572 7375 6c61 222c 2022 5a65  ", "Ursula", "Ze
+0002dca0: 6c64 6122 5d0a 2020 2020 2020 2020 3e3e  lda"].        >>
+0002dcb0: 3e20 2320 5e20 4e6f 7720 636f 7079 2d70  > # ^ Now copy-p
+0002dcc0: 6173 7465 2074 6869 7320 616e 6420 6564  aste this and ed
+0002dcd0: 6974 2074 6865 206c 696e 6520 6162 6f76  it the line abov
+0002dce0: 6520 746f 3a0a 2020 2020 2020 2020 3e3e  e to:.        >>
+0002dcf0: 3e20 2320 6464 6632 203d 2064 6466 2e73  > # ddf2 = ddf.s
+0002dd00: 6574 5f69 6e64 6578 2822 6e61 6d65 222c  et_index("name",
+0002dd10: 2064 6976 6973 696f 6e73 3d5b 2241 6c69   divisions=["Ali
+0002dd20: 6365 222c 2022 4c61 7572 6122 2c20 2255  ce", "Laura", "U
+0002dd30: 7273 756c 6122 2c20 225a 656c 6461 225d  rsula", "Zelda"]
+0002dd40: 290a 2020 2020 2020 2020 2222 220a 0a20  ).        """.. 
+0002dd50: 2020 2020 2020 2069 6620 696e 706c 6163         if inplac
+0002dd60: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0002dd70: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
+0002dd80: 7465 6445 7272 6f72 2822 5468 6520 696e  tedError("The in
+0002dd90: 706c 6163 653d 206b 6579 776f 7264 2069  place= keyword i
+0002dda0: 7320 6e6f 7420 7375 7070 6f72 7465 6422  s not supported"
+0002ddb0: 290a 2020 2020 2020 2020 7072 655f 736f  ).        pre_so
+0002ddc0: 7274 6564 203d 2073 6f72 7465 640a 2020  rted = sorted.  
+0002ddd0: 2020 2020 2020 6465 6c20 736f 7274 6564        del sorted
+0002dde0: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+0002ddf0: 6b20 6f74 6865 7220 6361 6e20 6265 2074  k other can be t
+0002de00: 7261 6e73 6c61 7465 6420 746f 2063 6f6c  ranslated to col
+0002de10: 756d 6e20 6e61 6d65 206f 7220 636f 6c75  umn name or colu
+0002de20: 6d6e 206f 626a 6563 742c 2070 6f73 7369  mn object, possi
+0002de30: 626c 7920 666c 6174 7465 6e69 6e67 2069  bly flattening i
+0002de40: 740a 2020 2020 2020 2020 6966 206e 6f74  t.        if not
+0002de50: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
+0002de60: 722c 2073 7472 293a 0a20 2020 2020 2020  r, str):.       
+0002de70: 2020 2020 2023 2049 7420 6d61 7920 7265       # It may re
+0002de80: 6665 7220 746f 2073 6576 6572 616c 2063  fer to several c
+0002de90: 6f6c 756d 6e73 0a20 2020 2020 2020 2020  olumns.         
+0002dea0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0002deb0: 286f 7468 6572 2c20 5365 7175 656e 6365  (other, Sequence
+0002dec0: 293a 2020 2320 7479 7065 3a20 6967 6e6f  ):  # type: igno
+0002ded0: 7265 5b75 6e72 6561 6368 6162 6c65 5d0a  re[unreachable].
+0002dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002def0: 2320 4163 6365 7074 205b 2261 225d 2c20  # Accept ["a"], 
+0002df00: 6275 7420 6e6f 7420 5b5b 2261 225d 5d0a  but not [["a"]].
+0002df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002df20: 6966 206c 656e 286f 7468 6572 2920 3d3d  if len(other) ==
+0002df30: 2031 2061 6e64 2028 2020 2320 7479 7065   1 and (  # type
+0002df40: 3a20 6967 6e6f 7265 5b75 6e72 6561 6368  : ignore[unreach
+0002df50: 6162 6c65 5d0a 2020 2020 2020 2020 2020  able].          
+0002df60: 2020 2020 2020 2020 2020 6973 696e 7374            isinst
+0002df70: 616e 6365 286f 7468 6572 5b30 5d2c 2073  ance(other[0], s
+0002df80: 7472 2920 6f72 206e 6f74 2069 7369 6e73  tr) or not isins
+0002df90: 7461 6e63 6528 6f74 6865 725b 305d 2c20  tance(other[0], 
+0002dfa0: 5365 7175 656e 6365 290a 2020 2020 2020  Sequence).      
+0002dfb0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+0002dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dfd0: 206f 7468 6572 203d 206f 7468 6572 5b30   other = other[0
+0002dfe0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0002dff0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002e000: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0002e010: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+0002e020: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0002e030: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0002e040: 4461 736b 2064 6174 6166 7261 6d65 2064  Dask dataframe d
+0002e050: 6f65 7320 6e6f 7420 7965 7420 7375 7070  oes not yet supp
+0002e060: 6f72 7420 6d75 6c74 692d 696e 6465 7865  ort multi-indexe
+0002e070: 732e 5c6e 220a 2020 2020 2020 2020 2020  s.\n".          
+0002e080: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0002e090: 596f 7520 7472 6965 6420 746f 2069 6e64  You tried to ind
+0002e0a0: 6578 2077 6974 6820 7468 6973 2069 6e64  ex with this ind
+0002e0b0: 6578 3a20 7b6f 7468 6572 7d5c 6e22 0a20  ex: {other}\n". 
+0002e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0d0: 2020 2020 2020 2022 496e 6465 7865 7320         "Indexes 
+0002e0e0: 6d75 7374 2062 6520 7369 6e67 6c65 2063  must be single c
+0002e0f0: 6f6c 756d 6e73 206f 6e6c 792e 220a 2020  olumns only.".  
+0002e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e110: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0002e120: 2023 204f 7220 6265 2061 2066 7261 6d65   # Or be a frame
+0002e130: 2064 6972 6563 746c 790a 2020 2020 2020   directly.      
+0002e140: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0002e150: 7461 6e63 6528 6f74 6865 722c 2044 6174  tance(other, Dat
+0002e160: 6146 7261 6d65 293a 2020 2320 7479 7065  aFrame):  # type
+0002e170: 3a20 6967 6e6f 7265 5b75 6e72 6561 6368  : ignore[unreach
+0002e180: 6162 6c65 5d0a 2020 2020 2020 2020 2020  able].          
+0002e190: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+0002e1a0: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+0002e1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e1c0: 2020 2020 2022 4461 736b 2064 6174 6166       "Dask dataf
+0002e1d0: 7261 6d65 2064 6f65 7320 6e6f 7420 7965  rame does not ye
+0002e1e0: 7420 7375 7070 6f72 7420 6d75 6c74 692d  t support multi-
+0002e1f0: 696e 6465 7865 732e 5c6e 220a 2020 2020  indexes.\n".    
+0002e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e210: 6622 596f 7520 7472 6965 6420 746f 2069  f"You tried to i
+0002e220: 6e64 6578 2077 6974 6820 6120 6672 616d  ndex with a fram
+0002e230: 6520 7769 7468 2074 6865 7365 2063 6f6c  e with these col
+0002e240: 756d 6e73 3a20 7b6c 6973 7428 6f74 6865  umns: {list(othe
+0002e250: 722e 636f 6c75 6d6e 7329 7d5c 6e22 0a20  r.columns)}\n". 
+0002e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e270: 2020 2022 496e 6465 7865 7320 6d75 7374     "Indexes must
+0002e280: 2062 6520 7369 6e67 6c65 2063 6f6c 756d   be single colum
+0002e290: 6e73 206f 6e6c 792e 220a 2020 2020 2020  ns only.".      
+0002e2a0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0002e2b0: 2020 2020 2023 2049 6620 616c 7265 6164       # If alread
+0002e2c0: 7920 6120 7365 7269 6573 0a20 2020 2020  y a series.     
+0002e2d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0002e2e0: 286f 7468 6572 2c20 5365 7269 6573 293a  (other, Series):
+0002e2f0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+0002e300: 6620 6974 2773 2061 6c72 6561 6479 2074  f it's already t
+0002e310: 6865 2069 6e64 6578 2c20 7468 6572 6527  he index, there'
+0002e320: 7320 6e6f 7468 696e 6720 746f 2064 6f0a  s nothing to do.
+0002e330: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0002e340: 7468 6572 2e5f 6e61 6d65 203d 3d20 7365  ther._name == se
+0002e350: 6c66 2e69 6e64 6578 2e5f 6e61 6d65 3a0a  lf.index._name:.
+0002e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e370: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+0002e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e390: 2020 2022 4e65 7720 696e 6465 7820 6861     "New index ha
+0002e3a0: 7320 7361 6d65 206e 616d 6520 6173 2065  s same name as e
+0002e3b0: 7869 7374 696e 672c 2074 6869 7320 6973  xisting, this is
+0002e3c0: 2061 206e 6f2d 6f70 2e22 2c20 5573 6572   a no-op.", User
+0002e3d0: 5761 726e 696e 670a 2020 2020 2020 2020  Warning.        
+0002e3e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002e3f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002e400: 2073 656c 660a 0a20 2020 2020 2020 2023   self..        #
+0002e410: 2049 6620 7468 6520 6e61 6d65 206f 6620   If the name of 
+0002e420: 6120 636f 6c75 6d6e 2f69 6e64 6578 0a20  a column/index. 
+0002e430: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002e440: 2020 2020 2020 2020 2023 2057 6974 6820           # With 
+0002e450: 7468 6520 7361 6d65 206e 616d 6520 6173  the same name as
+0002e460: 2074 6865 2069 6e64 6578 2c20 7468 6572   the index, ther
+0002e470: 6527 7320 6e6f 7468 696e 6720 746f 2064  e's nothing to d
+0002e480: 6f20 6569 7468 6572 0a20 2020 2020 2020  o either.       
+0002e490: 2020 2020 2069 6620 6f74 6865 7220 3d3d       if other ==
+0002e4a0: 2073 656c 662e 696e 6465 782e 6e61 6d65   self.index.name
+0002e4b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002e4c0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+0002e4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e4e0: 2020 2020 2022 4e65 7720 696e 6465 7820       "New index 
+0002e4f0: 6861 7320 7361 6d65 206e 616d 6520 6173  has same name as
+0002e500: 2065 7869 7374 696e 672c 2074 6869 7320   existing, this 
+0002e510: 6973 2061 206e 6f2d 6f70 2e22 2c20 5573  is a no-op.", Us
+0002e520: 6572 5761 726e 696e 670a 2020 2020 2020  erWarning.      
+0002e530: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002e540: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002e550: 726e 2073 656c 660a 0a20 2020 2020 2020  rn self..       
+0002e560: 2020 2020 2023 2049 6620 6120 6d69 7373       # If a miss
+0002e570: 696e 6720 636f 6c75 6d6e 2c20 4b65 7945  ing column, KeyE
+0002e580: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
+0002e590: 2069 6620 6f74 6865 7220 6e6f 7420 696e   if other not in
+0002e5a0: 2073 656c 662e 636f 6c75 6d6e 733a 0a20   self.columns:. 
+0002e5b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0002e5c0: 6169 7365 204b 6579 4572 726f 7228 0a20  aise KeyError(. 
+0002e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e5e0: 2020 2066 2244 6174 6120 6861 7320 6e6f     f"Data has no
+0002e5f0: 2063 6f6c 756d 6e20 277b 6f74 6865 727d   column '{other}
+0002e600: 273a 2075 7365 2061 6e79 2063 6f6c 756d  ': use any colum
+0002e610: 6e20 6f66 207b 6c69 7374 2873 656c 662e  n of {list(self.
+0002e620: 636f 6c75 6d6e 7329 7d22 0a20 2020 2020  columns)}".     
+0002e630: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002e640: 2020 2020 2020 2320 4368 6563 6b20 6469        # Check di
+0002e650: 7669 7369 6f6e 730a 2020 2020 2020 2020  visions.        
+0002e660: 6966 2064 6976 6973 696f 6e73 2069 7320  if divisions is 
+0002e670: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0002e680: 2020 2020 2020 6368 6563 6b5f 6469 7669        check_divi
+0002e690: 7369 6f6e 7328 6469 7669 7369 6f6e 7329  sions(divisions)
+0002e6a0: 0a20 2020 2020 2020 2065 6c69 6620 280a  .        elif (.
+0002e6b0: 2020 2020 2020 2020 2020 2020 6973 696e              isin
+0002e6c0: 7374 616e 6365 286f 7468 6572 2c20 496e  stance(other, In
+0002e6d0: 6465 7829 0a20 2020 2020 2020 2020 2020  dex).           
+0002e6e0: 2061 6e64 206f 7468 6572 2e6b 6e6f 776e   and other.known
+0002e6f0: 5f64 6976 6973 696f 6e73 0a20 2020 2020  _divisions.     
+0002e700: 2020 2020 2020 2061 6e64 206f 7468 6572         and other
+0002e710: 2e6e 7061 7274 6974 696f 6e73 203d 3d20  .npartitions == 
+0002e720: 7365 6c66 2e6e 7061 7274 6974 696f 6e73  self.npartitions
+0002e730: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
+0002e740: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+0002e750: 2069 6e64 6578 2068 6173 2074 6865 2073   index has the s
+0002e760: 616d 6520 6e75 6d62 6572 206f 6620 7061  ame number of pa
+0002e770: 7274 6974 696f 6e73 2061 6e64 206b 6e6f  rtitions and kno
+0002e780: 776e 0a20 2020 2020 2020 2020 2020 2023  wn.            #
+0002e790: 2064 6976 6973 696f 6e73 2c20 7468 656e   divisions, then
+0002e7a0: 2077 6520 6361 6e20 7472 6561 7420 6974   we can treat it
+0002e7b0: 2061 7320 7072 652d 736f 7274 6564 2077   as pre-sorted w
+0002e7c0: 6974 6820 6b6e 6f77 6e0a 2020 2020 2020  ith known.      
+0002e7d0: 2020 2020 2020 2320 6469 7669 7369 6f6e        # division
+0002e7e0: 730a 2020 2020 2020 2020 2020 2020 7072  s.            pr
+0002e7f0: 655f 736f 7274 6564 203d 2054 7275 650a  e_sorted = True.
+0002e800: 2020 2020 2020 2020 2020 2020 6469 7669              divi
+0002e810: 7369 6f6e 7320 3d20 6f74 6865 722e 6469  sions = other.di
+0002e820: 7669 7369 6f6e 730a 0a20 2020 2020 2020  visions..       
+0002e830: 2023 2049 6620 696e 6465 7820 6973 2061   # If index is a
+0002e840: 6c72 6561 6479 2073 6f72 7465 642c 2074  lready sorted, t
+0002e850: 616b 6520 6164 7661 6e74 6167 6520 6f66  ake advantage of
+0002e860: 2074 6861 7420 7769 7468 2073 6574 5f73   that with set_s
+0002e870: 6f72 7465 645f 696e 6465 780a 2020 2020  orted_index.    
+0002e880: 2020 2020 6966 2070 7265 5f73 6f72 7465      if pre_sorte
+0002e890: 643a 0a20 2020 2020 2020 2020 2020 2066  d:.            f
+0002e8a0: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
+0002e8b0: 6d65 2e73 6875 6666 6c65 2069 6d70 6f72  me.shuffle impor
+0002e8c0: 7420 7365 745f 736f 7274 6564 5f69 6e64  t set_sorted_ind
+0002e8d0: 6578 0a0a 2020 2020 2020 2020 2020 2020  ex..            
+0002e8e0: 7265 7475 726e 2073 6574 5f73 6f72 7465  return set_sorte
+0002e8f0: 645f 696e 6465 7828 0a20 2020 2020 2020  d_index(.       
+0002e900: 2020 2020 2020 2020 2073 656c 662c 206f           self, o
+0002e910: 7468 6572 2c20 6472 6f70 3d64 726f 702c  ther, drop=drop,
+0002e920: 2064 6976 6973 696f 6e73 3d64 6976 6973   divisions=divis
+0002e930: 696f 6e73 2c20 2a2a 6b77 6172 6773 0a20  ions, **kwargs. 
+0002e940: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0002e950: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002e960: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+0002e970: 2e64 6174 6166 7261 6d65 2e73 6875 6666  .dataframe.shuff
+0002e980: 6c65 2069 6d70 6f72 7420 7365 745f 696e  le import set_in
+0002e990: 6465 780a 0a20 2020 2020 2020 2020 2020  dex..           
+0002e9a0: 2072 6574 7572 6e20 7365 745f 696e 6465   return set_inde
+0002e9b0: 7828 0a20 2020 2020 2020 2020 2020 2020  x(.             
+0002e9c0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0002e9d0: 2020 2020 2020 2020 206f 7468 6572 2c0a           other,.
+0002e9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e9f0: 6472 6f70 3d64 726f 702c 0a20 2020 2020  drop=drop,.     
+0002ea00: 2020 2020 2020 2020 2020 206e 7061 7274             npart
+0002ea10: 6974 696f 6e73 3d6e 7061 7274 6974 696f  itions=npartitio
+0002ea20: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+0002ea30: 2020 2020 6469 7669 7369 6f6e 733d 6469      divisions=di
+0002ea40: 7669 7369 6f6e 732c 0a20 2020 2020 2020  visions,.       
+0002ea50: 2020 2020 2020 2020 2073 6f72 743d 736f           sort=so
+0002ea60: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+0002ea70: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+0002ea80: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0002ea90: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+0002eaa0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+0002eab0: 2064 6566 2070 6f70 2873 656c 662c 2069   def pop(self, i
+0002eac0: 7465 6d29 3a0a 2020 2020 2020 2020 6f75  tem):.        ou
+0002ead0: 7420 3d20 7365 6c66 5b69 7465 6d5d 0a20  t = self[item]. 
+0002eae0: 2020 2020 2020 2064 656c 2073 656c 665b         del self[
+0002eaf0: 6974 656d 5d0a 2020 2020 2020 2020 7265  item].        re
+0002eb00: 7475 726e 206f 7574 0a0a 2020 2020 4064  turn out..    @d
+0002eb10: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+0002eb20: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+0002eb30: 6620 6e6c 6172 6765 7374 2873 656c 662c  f nlargest(self,
+0002eb40: 206e 3d35 2c20 636f 6c75 6d6e 733d 6e6f   n=5, columns=no
+0002eb50: 5f64 6566 6175 6c74 2c20 7370 6c69 745f  _default, split_
+0002eb60: 6576 6572 793d 4e6f 6e65 293a 0a20 2020  every=None):.   
+0002eb70: 2020 2020 2069 6620 636f 6c75 6d6e 7320       if columns 
+0002eb80: 6973 206e 6f5f 6465 6661 756c 743a 0a20  is no_default:. 
+0002eb90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002eba0: 2054 7970 6545 7272 6f72 280a 2020 2020   TypeError(.    
+0002ebb0: 2020 2020 2020 2020 2020 2020 2244 6174              "Dat
+0002ebc0: 6146 7261 6d65 2e6e 6c61 7267 6573 7428  aFrame.nlargest(
+0002ebd0: 2920 6d69 7373 696e 6720 7265 7175 6972  ) missing requir
+0002ebe0: 6564 2070 6f73 6974 696f 6e61 6c20 6172  ed positional ar
+0002ebf0: 6775 6d65 6e74 3a20 2763 6f6c 756d 6e73  gument: 'columns
+0002ec00: 2722 0a20 2020 2020 2020 2020 2020 2029  '".            )
+0002ec10: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
+0002ec20: 2022 6461 7461 6672 616d 652d 6e6c 6172   "dataframe-nlar
+0002ec30: 6765 7374 220a 2020 2020 2020 2020 7265  gest".        re
+0002ec40: 7475 726e 2061 6361 280a 2020 2020 2020  turn aca(.      
+0002ec50: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0002ec60: 2020 2020 2020 2020 6368 756e 6b3d 4d2e          chunk=M.
+0002ec70: 6e6c 6172 6765 7374 2c0a 2020 2020 2020  nlargest,.      
+0002ec80: 2020 2020 2020 6167 6772 6567 6174 653d        aggregate=
+0002ec90: 4d2e 6e6c 6172 6765 7374 2c0a 2020 2020  M.nlargest,.    
+0002eca0: 2020 2020 2020 2020 6d65 7461 3d73 656c          meta=sel
+0002ecb0: 662e 5f6d 6574 612c 0a20 2020 2020 2020  f._meta,.       
+0002ecc0: 2020 2020 2074 6f6b 656e 3d74 6f6b 656e       token=token
+0002ecd0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
+0002ece0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+0002ecf0: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
+0002ed00: 2020 206e 3d6e 2c0a 2020 2020 2020 2020     n=n,.        
+0002ed10: 2020 2020 636f 6c75 6d6e 733d 636f 6c75      columns=colu
+0002ed20: 6d6e 732c 0a20 2020 2020 2020 2029 0a0a  mns,.        )..
+0002ed30: 2020 2020 4064 6572 6976 6564 5f66 726f      @derived_fro
+0002ed40: 6d28 7064 2e44 6174 6146 7261 6d65 290a  m(pd.DataFrame).
+0002ed50: 2020 2020 6465 6620 6e73 6d61 6c6c 6573      def nsmalles
+0002ed60: 7428 7365 6c66 2c20 6e3d 352c 2063 6f6c  t(self, n=5, col
+0002ed70: 756d 6e73 3d6e 6f5f 6465 6661 756c 742c  umns=no_default,
+0002ed80: 2073 706c 6974 5f65 7665 7279 3d4e 6f6e   split_every=Non
+0002ed90: 6529 3a0a 2020 2020 2020 2020 6966 2063  e):.        if c
+0002eda0: 6f6c 756d 6e73 2069 7320 6e6f 5f64 6566  olumns is no_def
+0002edb0: 6175 6c74 3a0a 2020 2020 2020 2020 2020  ault:.          
+0002edc0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0002edd0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0002ede0: 2020 2022 4461 7461 4672 616d 652e 6e73     "DataFrame.ns
+0002edf0: 6d61 6c6c 6573 7428 2920 6d69 7373 696e  mallest() missin
+0002ee00: 6720 7265 7175 6972 6564 2070 6f73 6974  g required posit
+0002ee10: 696f 6e61 6c20 6172 6775 6d65 6e74 3a20  ional argument: 
+0002ee20: 2763 6f6c 756d 6e73 2722 0a20 2020 2020  'columns'".     
+0002ee30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002ee40: 2074 6f6b 656e 203d 2022 6461 7461 6672   token = "datafr
+0002ee50: 616d 652d 6e73 6d61 6c6c 6573 7422 0a20  ame-nsmallest". 
+0002ee60: 2020 2020 2020 2072 6574 7572 6e20 6163         return ac
+0002ee70: 6128 0a20 2020 2020 2020 2020 2020 2073  a(.            s
+0002ee80: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0002ee90: 2063 6875 6e6b 3d4d 2e6e 736d 616c 6c65   chunk=M.nsmalle
+0002eea0: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
+0002eeb0: 6167 6772 6567 6174 653d 4d2e 6e73 6d61  aggregate=M.nsma
+0002eec0: 6c6c 6573 742c 0a20 2020 2020 2020 2020  llest,.         
+0002eed0: 2020 206d 6574 613d 7365 6c66 2e5f 6d65     meta=self._me
+0002eee0: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
+0002eef0: 746f 6b65 6e3d 746f 6b65 6e2c 0a20 2020  token=token,.   
+0002ef00: 2020 2020 2020 2020 2073 706c 6974 5f65           split_e
+0002ef10: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+0002ef20: 2c0a 2020 2020 2020 2020 2020 2020 6e3d  ,.            n=
+0002ef30: 6e2c 0a20 2020 2020 2020 2020 2020 2063  n,.            c
+0002ef40: 6f6c 756d 6e73 3d63 6f6c 756d 6e73 2c0a  olumns=columns,.
+0002ef50: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+0002ef60: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+0002ef70: 4461 7461 4672 616d 6529 0a20 2020 2064  DataFrame).    d
+0002ef80: 6566 2067 726f 7570 6279 280a 2020 2020  ef groupby(.    
+0002ef90: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0002efa0: 2020 6279 3d4e 6f6e 652c 0a20 2020 2020    by=None,.     
+0002efb0: 2020 2067 726f 7570 5f6b 6579 733d 4752     group_keys=GR
+0002efc0: 4f55 505f 4b45 5953 5f44 4546 4155 4c54  OUP_KEYS_DEFAULT
+0002efd0: 2c0a 2020 2020 2020 2020 736f 7274 3d4e  ,.        sort=N
+0002efe0: 6f6e 652c 0a20 2020 2020 2020 206f 6273  one,.        obs
+0002eff0: 6572 7665 643d 4e6f 6e65 2c0a 2020 2020  erved=None,.    
+0002f000: 2020 2020 6472 6f70 6e61 3d4e 6f6e 652c      dropna=None,
+0002f010: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
+0002f020: 732c 0a20 2020 2029 3a0a 2020 2020 2020  s,.    ):.      
+0002f030: 2020 6672 6f6d 2064 6173 6b2e 6461 7461    from dask.data
+0002f040: 6672 616d 652e 6772 6f75 7062 7920 696d  frame.groupby im
+0002f050: 706f 7274 2044 6174 6146 7261 6d65 4772  port DataFrameGr
+0002f060: 6f75 7042 790a 0a20 2020 2020 2020 2072  oupBy..        r
+0002f070: 6574 7572 6e20 4461 7461 4672 616d 6547  eturn DataFrameG
+0002f080: 726f 7570 4279 280a 2020 2020 2020 2020  roupBy(.        
+0002f090: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0002f0a0: 2020 2020 2020 6279 3d62 792c 0a20 2020        by=by,.   
+0002f0b0: 2020 2020 2020 2020 2067 726f 7570 5f6b           group_k
+0002f0c0: 6579 733d 6772 6f75 705f 6b65 7973 2c0a  eys=group_keys,.
+0002f0d0: 2020 2020 2020 2020 2020 2020 736f 7274              sort
+0002f0e0: 3d73 6f72 742c 0a20 2020 2020 2020 2020  =sort,.         
+0002f0f0: 2020 206f 6273 6572 7665 643d 6f62 7365     observed=obse
+0002f100: 7276 6564 2c0a 2020 2020 2020 2020 2020  rved,.          
+0002f110: 2020 6472 6f70 6e61 3d64 726f 706e 612c    dropna=dropna,
+0002f120: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+0002f130: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+0002f140: 0a0a 2020 2020 4077 7261 7073 2863 6174  ..    @wraps(cat
+0002f150: 6567 6f72 697a 6529 0a20 2020 2064 6566  egorize).    def
+0002f160: 2063 6174 6567 6f72 697a 6528 7365 6c66   categorize(self
+0002f170: 2c20 636f 6c75 6d6e 733d 4e6f 6e65 2c20  , columns=None, 
+0002f180: 696e 6465 783d 4e6f 6e65 2c20 7370 6c69  index=None, spli
+0002f190: 745f 6576 6572 793d 4e6f 6e65 2c20 2a2a  t_every=None, **
 0002f1a0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0002f1b0: 2064 6174 6120 3d20 7365 6c66 2e63 6f70   data = self.cop
-0002f1c0: 7928 290a 2020 2020 2020 2020 666f 7220  y().        for 
-0002f1d0: 6b2c 2076 2069 6e20 6b77 6172 6773 2e69  k, v in kwargs.i
-0002f1e0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0002f1f0: 2020 2020 6966 206e 6f74 2028 0a20 2020      if not (.   
-0002f200: 2020 2020 2020 2020 2020 2020 2069 7369               isi
-0002f210: 6e73 7461 6e63 6528 762c 2053 6361 6c61  nstance(v, Scala
-0002f220: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-0002f230: 2020 206f 7220 6973 5f73 6572 6965 735f     or is_series_
-0002f240: 6c69 6b65 2876 290a 2020 2020 2020 2020  like(v).        
-0002f250: 2020 2020 2020 2020 6f72 2063 616c 6c61          or calla
-0002f260: 626c 6528 7629 0a20 2020 2020 2020 2020  ble(v).         
-0002f270: 2020 2020 2020 206f 7220 7064 2e61 7069         or pd.api
-0002f280: 2e74 7970 6573 2e69 735f 7363 616c 6172  .types.is_scalar
-0002f290: 2876 290a 2020 2020 2020 2020 2020 2020  (v).            
-0002f2a0: 2020 2020 6f72 2069 735f 696e 6465 785f      or is_index_
-0002f2b0: 6c69 6b65 2876 290a 2020 2020 2020 2020  like(v).        
-0002f2c0: 2020 2020 2020 2020 6f72 2069 7369 6e73          or isins
-0002f2d0: 7461 6e63 6528 762c 2041 7272 6179 290a  tance(v, Array).
-0002f2e0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-0002f2f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002f300: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
-0002f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f320: 2020 2020 6622 436f 6c75 6d6e 2061 7373      f"Column ass
-0002f330: 6967 6e6d 656e 7420 646f 6573 6e27 7420  ignment doesn't 
-0002f340: 7375 7070 6f72 7420 7479 7065 207b 7479  support type {ty
-0002f350: 7065 6e61 6d65 2874 7970 6528 7629 297d  pename(type(v))}
-0002f360: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002f370: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0002f380: 6966 2063 616c 6c61 626c 6528 7629 3a0a  if callable(v):.
-0002f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f3a0: 6b77 6172 6773 5b6b 5d20 3d20 7628 6461  kwargs[k] = v(da
-0002f3b0: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
-0002f3c0: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
-0002f3d0: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
-0002f3e0: 2020 2020 2020 2020 2066 726f 6d20 6461           from da
-0002f3f0: 736b 2e64 6174 6166 7261 6d65 2e69 6f20  sk.dataframe.io 
-0002f400: 696d 706f 7274 2066 726f 6d5f 6461 736b  import from_dask
-0002f410: 5f61 7272 6179 0a0a 2020 2020 2020 2020  _array..        
-0002f420: 2020 2020 2020 2020 6966 206c 656e 2876          if len(v
-0002f430: 2e73 6861 7065 2920 3e20 313a 0a20 2020  .shape) > 1:.   
-0002f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f450: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002f460: 7228 2241 7272 6179 2061 7373 6967 6e6d  r("Array assignm
-0002f470: 656e 7420 6f6e 6c79 2073 7570 706f 7274  ent only support
-0002f480: 7320 312d 4420 6172 7261 7973 2229 0a20  s 1-D arrays"). 
-0002f490: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002f4a0: 6620 762e 6e70 6172 7469 7469 6f6e 7320  f v.npartitions 
-0002f4b0: 213d 2064 6174 612e 6e70 6172 7469 7469  != data.npartiti
-0002f4c0: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
-0002f4d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0002f4e0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0002f4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f500: 2020 2022 4e75 6d62 6572 206f 6620 7061     "Number of pa
-0002f510: 7274 6974 696f 6e73 2064 6f20 6e6f 7420  rtitions do not 
-0002f520: 6d61 7463 6820 220a 2020 2020 2020 2020  match ".        
-0002f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f540: 6622 287b 762e 6e70 6172 7469 7469 6f6e  f"({v.npartition
-0002f550: 737d 2021 3d20 7b64 6174 612e 6e70 6172  s} != {data.npar
-0002f560: 7469 7469 6f6e 737d 2922 0a20 2020 2020  titions})".     
-0002f570: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0002f580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f590: 206b 7761 7267 735b 6b5d 203d 2066 726f   kwargs[k] = fro
-0002f5a0: 6d5f 6461 736b 5f61 7272 6179 2876 2c20  m_dask_array(v, 
-0002f5b0: 696e 6465 783d 6461 7461 2e69 6e64 6578  index=data.index
-0002f5c0: 2c20 6d65 7461 3d64 6174 612e 5f6d 6574  , meta=data._met
-0002f5d0: 6129 0a0a 2020 2020 2020 2020 2020 2020  a)..            
-0002f5e0: 7061 6972 7320 3d20 5b6b 2c20 6b77 6172  pairs = [k, kwar
-0002f5f0: 6773 5b6b 5d5d 0a0a 2020 2020 2020 2020  gs[k]]..        
-0002f600: 2020 2020 2320 4669 6775 7265 206f 7574      # Figure out
-0002f610: 2063 6f6c 756d 6e73 206f 6620 7468 6520   columns of the 
-0002f620: 6f75 7470 7574 0a20 2020 2020 2020 2020  output.         
-0002f630: 2020 2064 6632 203d 2064 6174 612e 5f6d     df2 = data._m
-0002f640: 6574 615f 6e6f 6e65 6d70 7479 2e61 7373  eta_nonempty.ass
-0002f650: 6967 6e28 0a20 2020 2020 2020 2020 2020  ign(.           
-0002f660: 2020 2020 202a 2a5f 6578 7472 6163 745f       **_extract_
-0002f670: 6d65 7461 287b 6b3a 206b 7761 7267 735b  meta({k: kwargs[
-0002f680: 6b5d 7d2c 206e 6f6e 656d 7074 793d 5472  k]}, nonempty=Tr
-0002f690: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0002f6a0: 290a 2020 2020 2020 2020 2020 2020 6461  ).            da
-0002f6b0: 7461 203d 2065 6c65 6d77 6973 6528 6d65  ta = elemwise(me
-0002f6c0: 7468 6f64 732e 6173 7369 676e 2c20 6461  thods.assign, da
-0002f6d0: 7461 2c20 2a70 6169 7273 2c20 6d65 7461  ta, *pairs, meta
-0002f6e0: 3d64 6632 290a 0a20 2020 2020 2020 2072  =df2)..        r
-0002f6f0: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
-0002f700: 4064 6572 6976 6564 5f66 726f 6d28 7064  @derived_from(pd
-0002f710: 2e44 6174 6146 7261 6d65 2c20 7561 5f61  .DataFrame, ua_a
-0002f720: 7267 733d 5b22 696e 6465 7822 5d29 0a20  rgs=["index"]). 
-0002f730: 2020 2064 6566 2072 656e 616d 6528 7365     def rename(se
-0002f740: 6c66 2c20 696e 6465 783d 4e6f 6e65 2c20  lf, index=None, 
-0002f750: 636f 6c75 6d6e 733d 4e6f 6e65 293a 0a20  columns=None):. 
-0002f760: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
-0002f770: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0002f780: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0002f790: 616c 7565 4572 726f 7228 2243 616e 6e6f  alueError("Canno
-0002f7a0: 7420 7265 6e61 6d65 2069 6e64 6578 2e22  t rename index."
-0002f7b0: 290a 0a20 2020 2020 2020 2023 202a 6172  )..        # *ar
-0002f7c0: 6773 2068 6572 6520 6973 2069 6e64 6578  gs here is index
-0002f7d0: 2c20 636f 6c75 6d6e 7320 6275 7420 636f  , columns but co
-0002f7e0: 6c75 6d6e 7320 6172 6720 6973 2061 6c72  lumns arg is alr
-0002f7f0: 6561 6479 2075 7365 640a 2020 2020 2020  eady used.      
-0002f800: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-0002f810: 705f 7061 7274 6974 696f 6e73 284d 2e72  p_partitions(M.r
-0002f820: 656e 616d 652c 204e 6f6e 652c 2063 6f6c  ename, None, col
-0002f830: 756d 6e73 3d63 6f6c 756d 6e73 290a 0a20  umns=columns).. 
-0002f840: 2020 2064 6566 2071 7565 7279 2873 656c     def query(sel
-0002f850: 662c 2065 7870 722c 202a 2a6b 7761 7267  f, expr, **kwarg
-0002f860: 7329 3a0a 2020 2020 2020 2020 2222 2246  s):.        """F
-0002f870: 696c 7465 7220 6461 7461 6672 616d 6520  ilter dataframe 
-0002f880: 7769 7468 2063 6f6d 706c 6578 2065 7870  with complex exp
-0002f890: 7265 7373 696f 6e0a 0a20 2020 2020 2020  ression..       
-0002f8a0: 2042 6c6f 636b 6564 2076 6572 7369 6f6e   Blocked version
-0002f8b0: 206f 6620 7064 2e44 6174 6146 7261 6d65   of pd.DataFrame
-0002f8c0: 2e71 7565 7279 0a0a 2020 2020 2020 2020  .query..        
-0002f8d0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0002f8e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0002f8f0: 2020 2020 2020 6578 7072 3a20 7374 720a        expr: str.
-0002f900: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0002f910: 7175 6572 7920 7374 7269 6e67 2074 6f20  query string to 
-0002f920: 6576 616c 7561 7465 2e0a 2020 2020 2020  evaluate..      
-0002f930: 2020 2020 2020 596f 7520 6361 6e20 7265        You can re
-0002f940: 6665 7220 746f 2063 6f6c 756d 6e20 6e61  fer to column na
-0002f950: 6d65 7320 7468 6174 2061 7265 206e 6f74  mes that are not
-0002f960: 2076 616c 6964 2050 7974 686f 6e20 7661   valid Python va
-0002f970: 7269 6162 6c65 206e 616d 6573 0a20 2020  riable names.   
-0002f980: 2020 2020 2020 2020 2062 7920 7375 7272           by surr
-0002f990: 6f75 6e64 696e 6720 7468 656d 2069 6e20  ounding them in 
-0002f9a0: 6261 636b 7469 636b 732e 0a20 2020 2020  backticks..     
-0002f9b0: 2020 2020 2020 2044 6173 6b20 646f 6573         Dask does
-0002f9c0: 206e 6f74 2066 756c 6c79 2073 7570 706f   not fully suppo
-0002f9d0: 7274 2072 6566 6572 7269 6e67 2074 6f20  rt referring to 
-0002f9e0: 7661 7269 6162 6c65 7320 7573 696e 6720  variables using 
-0002f9f0: 7468 6520 2740 2720 6368 6172 6163 7465  the '@' characte
-0002fa00: 722c 0a20 2020 2020 2020 2020 2020 2075  r,.            u
-0002fa10: 7365 2066 2d73 7472 696e 6773 206f 7220  se f-strings or 
-0002fa20: 7468 6520 6060 6c6f 6361 6c5f 6469 6374  the ``local_dict
-0002fa30: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
-0002fa40: 656e 7420 696e 7374 6561 642e 0a0a 2020  ent instead...  
-0002fa50: 2020 2020 2020 4e6f 7465 730a 2020 2020        Notes.    
-0002fa60: 2020 2020 2d2d 2d2d 2d0a 2020 2020 2020      -----.      
-0002fa70: 2020 5468 6973 2069 7320 6c69 6b65 2074    This is like t
-0002fa80: 6865 2073 6571 7565 6e74 6961 6c20 7665  he sequential ve
-0002fa90: 7273 696f 6e20 6578 6365 7074 2074 6861  rsion except tha
-0002faa0: 7420 7468 6973 2077 696c 6c20 616c 736f  t this will also
-0002fab0: 2068 6170 7065 6e0a 2020 2020 2020 2020   happen.        
-0002fac0: 696e 206d 616e 7920 7468 7265 6164 732e  in many threads.
-0002fad0: 2020 5468 6973 206d 6179 2063 6f6e 666c    This may confl
-0002fae0: 6963 7420 7769 7468 2060 606e 756d 6578  ict with ``numex
-0002faf0: 7072 6060 2077 6869 6368 2077 696c 6c20  pr`` which will 
-0002fb00: 7573 650a 2020 2020 2020 2020 6d75 6c74  use.        mult
-0002fb10: 6970 6c65 2074 6872 6561 6473 2069 7473  iple threads its
-0002fb20: 656c 662e 2020 5765 2072 6563 6f6d 6d65  elf.  We recomme
-0002fb30: 6e64 2074 6861 7420 796f 7520 7365 7420  nd that you set 
-0002fb40: 6060 6e75 6d65 7870 7260 6020 746f 2075  ``numexpr`` to u
-0002fb50: 7365 2061 0a20 2020 2020 2020 2073 696e  se a.        sin
-0002fb60: 676c 6520 7468 7265 6164 3a0a 0a20 2020  gle thread:..   
-0002fb70: 2020 2020 202e 2e20 636f 6465 2d62 6c6f       .. code-blo
-0002fb80: 636b 3a3a 2070 7974 686f 6e0a 0a20 2020  ck:: python..   
-0002fb90: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
-0002fba0: 6e75 6d65 7870 720a 2020 2020 2020 2020  numexpr.        
-0002fbb0: 2020 2020 6e75 6d65 7870 722e 7365 745f      numexpr.set_
-0002fbc0: 6e75 6d5f 7468 7265 6164 7328 3129 0a0a  num_threads(1)..
-0002fbd0: 2020 2020 2020 2020 5365 6520 616c 736f          See also
-0002fbe0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0002fbf0: 2d0a 2020 2020 2020 2020 7061 6e64 6173  -.        pandas
-0002fc00: 2e44 6174 6146 7261 6d65 2e71 7565 7279  .DataFrame.query
-0002fc10: 0a20 2020 2020 2020 2070 616e 6461 732e  .        pandas.
-0002fc20: 6576 616c 0a0a 2020 2020 2020 2020 4578  eval..        Ex
-0002fc30: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
-0002fc40: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0002fc50: 3e3e 3e20 696d 706f 7274 2070 616e 6461  >>> import panda
-0002fc60: 7320 6173 2070 640a 2020 2020 2020 2020  s as pd.        
-0002fc70: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
-0002fc80: 6461 7461 6672 616d 6520 6173 2064 640a  dataframe as dd.
-0002fc90: 2020 2020 2020 2020 3e3e 3e20 6466 203d          >>> df =
-0002fca0: 2070 642e 4461 7461 4672 616d 6528 7b27   pd.DataFrame({'
-0002fcb0: 7827 3a20 5b31 2c20 322c 2031 2c20 325d  x': [1, 2, 1, 2]
-0002fcc0: 2c0a 2020 2020 2020 2020 2e2e 2e20 2020  ,.        ...   
-0002fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fce0: 2027 7927 3a20 5b31 2c20 322c 2033 2c20   'y': [1, 2, 3, 
-0002fcf0: 345d 2c0a 2020 2020 2020 2020 2e2e 2e20  4],.        ... 
-0002fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd10: 2020 2027 7a20 7a27 3a20 5b34 2c20 332c     'z z': [4, 3,
-0002fd20: 2032 2c20 315d 7d29 0a20 2020 2020 2020   2, 1]}).       
-0002fd30: 203e 3e3e 2064 6466 203d 2064 642e 6672   >>> ddf = dd.fr
-0002fd40: 6f6d 5f70 616e 6461 7328 6466 2c20 6e70  om_pandas(df, np
-0002fd50: 6172 7469 7469 6f6e 733d 3229 0a0a 2020  artitions=2)..  
-0002fd60: 2020 2020 2020 5265 6665 7220 746f 2063        Refer to c
-0002fd70: 6f6c 756d 6e20 6e61 6d65 7320 6469 7265  olumn names dire
-0002fd80: 6374 6c79 3a0a 0a20 2020 2020 2020 203e  ctly:..        >
-0002fd90: 3e3e 2064 6466 2e71 7565 7279 2827 7920  >> ddf.query('y 
-0002fda0: 3e20 7827 292e 636f 6d70 7574 6528 290a  > x').compute().
-0002fdb0: 2020 2020 2020 2020 2020 2078 2020 7920             x  y 
-0002fdc0: 207a 207a 0a20 2020 2020 2020 2032 2020   z z.        2  
-0002fdd0: 3120 2033 2020 2020 320a 2020 2020 2020  1  3    2.      
-0002fde0: 2020 3320 2032 2020 3420 2020 2031 0a0a    3  2  4    1..
-0002fdf0: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-0002fe00: 2063 6f6c 756d 6e20 6e61 6d65 2075 7369   column name usi
-0002fe10: 6e67 2062 6163 6b74 6963 6b73 3a0a 0a20  ng backticks:.. 
-0002fe20: 2020 2020 2020 203e 3e3e 2064 6466 2e71         >>> ddf.q
-0002fe30: 7565 7279 2827 607a 207a 6020 3e20 7827  uery('`z z` > x'
-0002fe40: 292e 636f 6d70 7574 6528 290a 2020 2020  ).compute().    
-0002fe50: 2020 2020 2020 2078 2020 7920 207a 207a         x  y  z z
-0002fe60: 0a20 2020 2020 2020 2030 2020 3120 2031  .        0  1  1
-0002fe70: 2020 2020 340a 2020 2020 2020 2020 3120      4.        1 
-0002fe80: 2032 2020 3220 2020 2033 0a20 2020 2020   2  2    3.     
-0002fe90: 2020 2032 2020 3120 2033 2020 2020 320a     2  1  3    2.
-0002fea0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-0002feb0: 6f20 7661 7269 6162 6c65 206e 616d 6520  o variable name 
-0002fec0: 7573 696e 6720 662d 7374 7269 6e67 733a  using f-strings:
-0002fed0: 0a0a 2020 2020 2020 2020 3e3e 3e20 7661  ..        >>> va
-0002fee0: 6c75 6520 3d20 310a 2020 2020 2020 2020  lue = 1.        
-0002fef0: 3e3e 3e20 6464 662e 7175 6572 7928 6627  >>> ddf.query(f'
-0002ff00: 7820 3d3d 207b 7661 6c75 657d 2729 2e63  x == {value}').c
-0002ff10: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
-0002ff20: 2020 2020 7820 2079 2020 7a20 7a0a 2020      x  y  z z.  
-0002ff30: 2020 2020 2020 3020 2031 2020 3120 2020        0  1  1   
-0002ff40: 2034 0a20 2020 2020 2020 2032 2020 3120   4.        2  1 
+0002f1b0: 2072 6574 7572 6e20 6361 7465 676f 7269   return categori
+0002f1c0: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+0002f1d0: 7365 6c66 2c20 636f 6c75 6d6e 733d 636f  self, columns=co
+0002f1e0: 6c75 6d6e 732c 2069 6e64 6578 3d69 6e64  lumns, index=ind
+0002f1f0: 6578 2c20 7370 6c69 745f 6576 6572 793d  ex, split_every=
+0002f200: 7370 6c69 745f 6576 6572 792c 202a 2a6b  split_every, **k
+0002f210: 7761 7267 730a 2020 2020 2020 2020 290a  wargs.        ).
+0002f220: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+0002f230: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
+0002f240: 0a20 2020 2064 6566 2061 7373 6967 6e28  .    def assign(
+0002f250: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
+0002f260: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0002f270: 7365 6c66 2e63 6f70 7928 290a 2020 2020  self.copy().    
+0002f280: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+0002f290: 6b77 6172 6773 2e69 7465 6d73 2829 3a0a  kwargs.items():.
+0002f2a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002f2b0: 6f74 2028 0a20 2020 2020 2020 2020 2020  ot (.           
+0002f2c0: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
+0002f2d0: 762c 2053 6361 6c61 7229 0a20 2020 2020  v, Scalar).     
+0002f2e0: 2020 2020 2020 2020 2020 206f 7220 6973             or is
+0002f2f0: 5f73 6572 6965 735f 6c69 6b65 2876 290a  _series_like(v).
+0002f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f310: 6f72 2063 616c 6c61 626c 6528 7629 0a20  or callable(v). 
+0002f320: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0002f330: 7220 7064 2e61 7069 2e74 7970 6573 2e69  r pd.api.types.i
+0002f340: 735f 7363 616c 6172 2876 290a 2020 2020  s_scalar(v).    
+0002f350: 2020 2020 2020 2020 2020 2020 6f72 2069              or i
+0002f360: 735f 696e 6465 785f 6c69 6b65 2876 290a  s_index_like(v).
+0002f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f380: 6f72 2069 7369 6e73 7461 6e63 6528 762c  or isinstance(v,
+0002f390: 2041 7272 6179 290a 2020 2020 2020 2020   Array).        
+0002f3a0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0002f3b0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0002f3c0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0002f3d0: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
+0002f3e0: 6c75 6d6e 2061 7373 6967 6e6d 656e 7420  lumn assignment 
+0002f3f0: 646f 6573 6e27 7420 7375 7070 6f72 7420  doesn't support 
+0002f400: 7479 7065 207b 7479 7065 6e61 6d65 2874  type {typename(t
+0002f410: 7970 6528 7629 297d 220a 2020 2020 2020  ype(v))}".      
+0002f420: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002f430: 2020 2020 2020 2020 6966 2063 616c 6c61          if calla
+0002f440: 626c 6528 7629 3a0a 2020 2020 2020 2020  ble(v):.        
+0002f450: 2020 2020 2020 2020 6b77 6172 6773 5b6b          kwargs[k
+0002f460: 5d20 3d20 7628 6461 7461 290a 2020 2020  ] = v(data).    
+0002f470: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0002f480: 7461 6e63 6528 762c 2041 7272 6179 293a  tance(v, Array):
+0002f490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f4a0: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
+0002f4b0: 7261 6d65 2e69 6f20 696d 706f 7274 2066  rame.io import f
+0002f4c0: 726f 6d5f 6461 736b 5f61 7272 6179 0a0a  rom_dask_array..
+0002f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f4e0: 6966 206c 656e 2876 2e73 6861 7065 2920  if len(v.shape) 
+0002f4f0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+0002f500: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0002f510: 616c 7565 4572 726f 7228 2241 7272 6179  alueError("Array
+0002f520: 2061 7373 6967 6e6d 656e 7420 6f6e 6c79   assignment only
+0002f530: 2073 7570 706f 7274 7320 312d 4420 6172   supports 1-D ar
+0002f540: 7261 7973 2229 0a20 2020 2020 2020 2020  rays").         
+0002f550: 2020 2020 2020 2069 6620 762e 6e70 6172         if v.npar
+0002f560: 7469 7469 6f6e 7320 213d 2064 6174 612e  titions != data.
+0002f570: 6e70 6172 7469 7469 6f6e 733a 0a20 2020  npartitions:.   
+0002f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f590: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0002f5a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0002f5b0: 2020 2020 2020 2020 2020 2022 4e75 6d62             "Numb
+0002f5c0: 6572 206f 6620 7061 7274 6974 696f 6e73  er of partitions
+0002f5d0: 2064 6f20 6e6f 7420 6d61 7463 6820 220a   do not match ".
+0002f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f5f0: 2020 2020 2020 2020 6622 287b 762e 6e70          f"({v.np
+0002f600: 6172 7469 7469 6f6e 737d 2021 3d20 7b64  artitions} != {d
+0002f610: 6174 612e 6e70 6172 7469 7469 6f6e 737d  ata.npartitions}
+0002f620: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
+0002f630: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002f640: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+0002f650: 6b5d 203d 2066 726f 6d5f 6461 736b 5f61  k] = from_dask_a
+0002f660: 7272 6179 2876 2c20 696e 6465 783d 6461  rray(v, index=da
+0002f670: 7461 2e69 6e64 6578 2c20 6d65 7461 3d64  ta.index, meta=d
+0002f680: 6174 612e 5f6d 6574 6129 0a0a 2020 2020  ata._meta)..    
+0002f690: 2020 2020 2020 2020 7061 6972 7320 3d20          pairs = 
+0002f6a0: 5b6b 2c20 6b77 6172 6773 5b6b 5d5d 0a0a  [k, kwargs[k]]..
+0002f6b0: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+0002f6c0: 6775 7265 206f 7574 2063 6f6c 756d 6e73  gure out columns
+0002f6d0: 206f 6620 7468 6520 6f75 7470 7574 0a20   of the output. 
+0002f6e0: 2020 2020 2020 2020 2020 2064 6632 203d             df2 =
+0002f6f0: 2064 6174 612e 5f6d 6574 615f 6e6f 6e65   data._meta_none
+0002f700: 6d70 7479 2e61 7373 6967 6e28 0a20 2020  mpty.assign(.   
+0002f710: 2020 2020 2020 2020 2020 2020 202a 2a5f               **_
+0002f720: 6578 7472 6163 745f 6d65 7461 287b 6b3a  extract_meta({k:
+0002f730: 206b 7761 7267 735b 6b5d 7d2c 206e 6f6e   kwargs[k]}, non
+0002f740: 656d 7074 793d 5472 7565 290a 2020 2020  empty=True).    
+0002f750: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002f760: 2020 2020 2020 6461 7461 203d 2065 6c65        data = ele
+0002f770: 6d77 6973 6528 6d65 7468 6f64 732e 6173  mwise(methods.as
+0002f780: 7369 676e 2c20 6461 7461 2c20 2a70 6169  sign, data, *pai
+0002f790: 7273 2c20 6d65 7461 3d64 6632 290a 0a20  rs, meta=df2).. 
+0002f7a0: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+0002f7b0: 7461 0a0a 2020 2020 4064 6572 6976 6564  ta..    @derived
+0002f7c0: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
+0002f7d0: 6d65 2c20 7561 5f61 7267 733d 5b22 696e  me, ua_args=["in
+0002f7e0: 6465 7822 5d29 0a20 2020 2064 6566 2072  dex"]).    def r
+0002f7f0: 656e 616d 6528 7365 6c66 2c20 696e 6465  ename(self, inde
+0002f800: 783d 4e6f 6e65 2c20 636f 6c75 6d6e 733d  x=None, columns=
+0002f810: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+0002f820: 6620 696e 6465 7820 6973 206e 6f74 204e  f index is not N
+0002f830: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002f840: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0002f850: 7228 2243 616e 6e6f 7420 7265 6e61 6d65  r("Cannot rename
+0002f860: 2069 6e64 6578 2e22 290a 0a20 2020 2020   index.")..     
+0002f870: 2020 2023 202a 6172 6773 2068 6572 6520     # *args here 
+0002f880: 6973 2069 6e64 6578 2c20 636f 6c75 6d6e  is index, column
+0002f890: 7320 6275 7420 636f 6c75 6d6e 7320 6172  s but columns ar
+0002f8a0: 6720 6973 2061 6c72 6561 6479 2075 7365  g is already use
+0002f8b0: 640a 2020 2020 2020 2020 7265 7475 726e  d.        return
+0002f8c0: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
+0002f8d0: 696f 6e73 284d 2e72 656e 616d 652c 204e  ions(M.rename, N
+0002f8e0: 6f6e 652c 2063 6f6c 756d 6e73 3d63 6f6c  one, columns=col
+0002f8f0: 756d 6e73 290a 0a20 2020 2064 6566 2071  umns)..    def q
+0002f900: 7565 7279 2873 656c 662c 2065 7870 722c  uery(self, expr,
+0002f910: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0002f920: 2020 2020 2222 2246 696c 7465 7220 6461      """Filter da
+0002f930: 7461 6672 616d 6520 7769 7468 2063 6f6d  taframe with com
+0002f940: 706c 6578 2065 7870 7265 7373 696f 6e0a  plex expression.
+0002f950: 0a20 2020 2020 2020 2042 6c6f 636b 6564  .        Blocked
+0002f960: 2076 6572 7369 6f6e 206f 6620 7064 2e44   version of pd.D
+0002f970: 6174 6146 7261 6d65 2e71 7565 7279 0a0a  ataFrame.query..
+0002f980: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0002f990: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0002f9a0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6578  -----.        ex
+0002f9b0: 7072 3a20 7374 720a 2020 2020 2020 2020  pr: str.        
+0002f9c0: 2020 2020 5468 6520 7175 6572 7920 7374      The query st
+0002f9d0: 7269 6e67 2074 6f20 6576 616c 7561 7465  ring to evaluate
+0002f9e0: 2e0a 2020 2020 2020 2020 2020 2020 596f  ..            Yo
+0002f9f0: 7520 6361 6e20 7265 6665 7220 746f 2063  u can refer to c
+0002fa00: 6f6c 756d 6e20 6e61 6d65 7320 7468 6174  olumn names that
+0002fa10: 2061 7265 206e 6f74 2076 616c 6964 2050   are not valid P
+0002fa20: 7974 686f 6e20 7661 7269 6162 6c65 206e  ython variable n
+0002fa30: 616d 6573 0a20 2020 2020 2020 2020 2020  ames.           
+0002fa40: 2062 7920 7375 7272 6f75 6e64 696e 6720   by surrounding 
+0002fa50: 7468 656d 2069 6e20 6261 636b 7469 636b  them in backtick
+0002fa60: 732e 0a20 2020 2020 2020 2020 2020 2044  s..            D
+0002fa70: 6173 6b20 646f 6573 206e 6f74 2066 756c  ask does not ful
+0002fa80: 6c79 2073 7570 706f 7274 2072 6566 6572  ly support refer
+0002fa90: 7269 6e67 2074 6f20 7661 7269 6162 6c65  ring to variable
+0002faa0: 7320 7573 696e 6720 7468 6520 2740 2720  s using the '@' 
+0002fab0: 6368 6172 6163 7465 722c 0a20 2020 2020  character,.     
+0002fac0: 2020 2020 2020 2075 7365 2066 2d73 7472         use f-str
+0002fad0: 696e 6773 206f 7220 7468 6520 6060 6c6f  ings or the ``lo
+0002fae0: 6361 6c5f 6469 6374 6060 206b 6579 776f  cal_dict`` keywo
+0002faf0: 7264 2061 7267 756d 656e 7420 696e 7374  rd argument inst
+0002fb00: 6561 642e 0a0a 2020 2020 2020 2020 4e6f  ead...        No
+0002fb10: 7465 730a 2020 2020 2020 2020 2d2d 2d2d  tes.        ----
+0002fb20: 2d0a 2020 2020 2020 2020 5468 6973 2069  -.        This i
+0002fb30: 7320 6c69 6b65 2074 6865 2073 6571 7565  s like the seque
+0002fb40: 6e74 6961 6c20 7665 7273 696f 6e20 6578  ntial version ex
+0002fb50: 6365 7074 2074 6861 7420 7468 6973 2077  cept that this w
+0002fb60: 696c 6c20 616c 736f 2068 6170 7065 6e0a  ill also happen.
+0002fb70: 2020 2020 2020 2020 696e 206d 616e 7920          in many 
+0002fb80: 7468 7265 6164 732e 2020 5468 6973 206d  threads.  This m
+0002fb90: 6179 2063 6f6e 666c 6963 7420 7769 7468  ay conflict with
+0002fba0: 2060 606e 756d 6578 7072 6060 2077 6869   ``numexpr`` whi
+0002fbb0: 6368 2077 696c 6c20 7573 650a 2020 2020  ch will use.    
+0002fbc0: 2020 2020 6d75 6c74 6970 6c65 2074 6872      multiple thr
+0002fbd0: 6561 6473 2069 7473 656c 662e 2020 5765  eads itself.  We
+0002fbe0: 2072 6563 6f6d 6d65 6e64 2074 6861 7420   recommend that 
+0002fbf0: 796f 7520 7365 7420 6060 6e75 6d65 7870  you set ``numexp
+0002fc00: 7260 6020 746f 2075 7365 2061 0a20 2020  r`` to use a.   
+0002fc10: 2020 2020 2073 696e 676c 6520 7468 7265       single thre
+0002fc20: 6164 3a0a 0a20 2020 2020 2020 202e 2e20  ad:..        .. 
+0002fc30: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
+0002fc40: 686f 6e0a 0a20 2020 2020 2020 2020 2020  hon..           
+0002fc50: 2069 6d70 6f72 7420 6e75 6d65 7870 720a   import numexpr.
+0002fc60: 2020 2020 2020 2020 2020 2020 6e75 6d65              nume
+0002fc70: 7870 722e 7365 745f 6e75 6d5f 7468 7265  xpr.set_num_thre
+0002fc80: 6164 7328 3129 0a0a 2020 2020 2020 2020  ads(1)..        
+0002fc90: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
+0002fca0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+0002fcb0: 2020 7061 6e64 6173 2e44 6174 6146 7261    pandas.DataFra
+0002fcc0: 6d65 2e71 7565 7279 0a20 2020 2020 2020  me.query.       
+0002fcd0: 2070 616e 6461 732e 6576 616c 0a0a 2020   pandas.eval..  
+0002fce0: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
+0002fcf0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+0002fd00: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+0002fd10: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
+0002fd20: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
+0002fd30: 7274 2064 6173 6b2e 6461 7461 6672 616d  rt dask.datafram
+0002fd40: 6520 6173 2064 640a 2020 2020 2020 2020  e as dd.        
+0002fd50: 3e3e 3e20 6466 203d 2070 642e 4461 7461  >>> df = pd.Data
+0002fd60: 4672 616d 6528 7b27 7827 3a20 5b31 2c20  Frame({'x': [1, 
+0002fd70: 322c 2031 2c20 325d 2c0a 2020 2020 2020  2, 1, 2],.      
+0002fd80: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+0002fd90: 2020 2020 2020 2020 2027 7927 3a20 5b31           'y': [1
+0002fda0: 2c20 322c 2033 2c20 345d 2c0a 2020 2020  , 2, 3, 4],.    
+0002fdb0: 2020 2020 2e2e 2e20 2020 2020 2020 2020      ...         
+0002fdc0: 2020 2020 2020 2020 2020 2027 7a20 7a27             'z z'
+0002fdd0: 3a20 5b34 2c20 332c 2032 2c20 315d 7d29  : [4, 3, 2, 1]})
+0002fde0: 0a20 2020 2020 2020 203e 3e3e 2064 6466  .        >>> ddf
+0002fdf0: 203d 2064 642e 6672 6f6d 5f70 616e 6461   = dd.from_panda
+0002fe00: 7328 6466 2c20 6e70 6172 7469 7469 6f6e  s(df, npartition
+0002fe10: 733d 3229 0a0a 2020 2020 2020 2020 5265  s=2)..        Re
+0002fe20: 6665 7220 746f 2063 6f6c 756d 6e20 6e61  fer to column na
+0002fe30: 6d65 7320 6469 7265 6374 6c79 3a0a 0a20  mes directly:.. 
+0002fe40: 2020 2020 2020 203e 3e3e 2064 6466 2e71         >>> ddf.q
+0002fe50: 7565 7279 2827 7920 3e20 7827 292e 636f  uery('y > x').co
+0002fe60: 6d70 7574 6528 290a 2020 2020 2020 2020  mpute().        
+0002fe70: 2020 2078 2020 7920 207a 207a 0a20 2020     x  y  z z.   
+0002fe80: 2020 2020 2032 2020 3120 2033 2020 2020       2  1  3    
+0002fe90: 320a 2020 2020 2020 2020 3320 2032 2020  2.        3  2  
+0002fea0: 3420 2020 2031 0a0a 2020 2020 2020 2020  4    1..        
+0002feb0: 5265 6665 7220 746f 2063 6f6c 756d 6e20  Refer to column 
+0002fec0: 6e61 6d65 2075 7369 6e67 2062 6163 6b74  name using backt
+0002fed0: 6963 6b73 3a0a 0a20 2020 2020 2020 203e  icks:..        >
+0002fee0: 3e3e 2064 6466 2e71 7565 7279 2827 607a  >> ddf.query('`z
+0002fef0: 207a 6020 3e20 7827 292e 636f 6d70 7574   z` > x').comput
+0002ff00: 6528 290a 2020 2020 2020 2020 2020 2078  e().           x
+0002ff10: 2020 7920 207a 207a 0a20 2020 2020 2020    y  z z.       
+0002ff20: 2030 2020 3120 2031 2020 2020 340a 2020   0  1  1    4.  
+0002ff30: 2020 2020 2020 3120 2032 2020 3220 2020        1  2  2   
+0002ff40: 2033 0a20 2020 2020 2020 2032 2020 3120   3.        2  1 
 0002ff50: 2033 2020 2020 320a 0a20 2020 2020 2020   3    2..       
 0002ff60: 2052 6566 6572 2074 6f20 7661 7269 6162   Refer to variab
-0002ff70: 6c65 206e 616d 6520 7573 696e 6720 6060  le name using ``
-0002ff80: 6c6f 6361 6c5f 6469 6374 6060 3a0a 0a20  local_dict``:.. 
-0002ff90: 2020 2020 2020 203e 3e3e 2064 6466 2e71         >>> ddf.q
-0002ffa0: 7565 7279 2827 7820 3d3d 2040 7661 6c75  uery('x == @valu
-0002ffb0: 6527 2c20 6c6f 6361 6c5f 6469 6374 3d7b  e', local_dict={
-0002ffc0: 2276 616c 7565 223a 2076 616c 7565 7d29  "value": value})
-0002ffd0: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
-0002ffe0: 2020 2020 2020 7820 2079 2020 7a20 7a0a        x  y  z z.
-0002fff0: 2020 2020 2020 2020 3020 2031 2020 3120          0  1  1 
-00030000: 2020 2034 0a20 2020 2020 2020 2032 2020     4.        2  
-00030010: 3120 2033 2020 2020 320a 2020 2020 2020  1  3    2.      
-00030020: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00030030: 7475 726e 2073 656c 662e 6d61 705f 7061  turn self.map_pa
-00030040: 7274 6974 696f 6e73 284d 2e71 7565 7279  rtitions(M.query
-00030050: 2c20 6578 7072 2c20 2a2a 6b77 6172 6773  , expr, **kwargs
-00030060: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
-00030070: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
-00030080: 6529 0a20 2020 2064 6566 2065 7661 6c28  e).    def eval(
-00030090: 7365 6c66 2c20 6578 7072 2c20 696e 706c  self, expr, inpl
-000300a0: 6163 653d 4e6f 6e65 2c20 2a2a 6b77 6172  ace=None, **kwar
-000300b0: 6773 293a 0a20 2020 2020 2020 2069 6620  gs):.        if 
-000300c0: 696e 706c 6163 6520 6973 204e 6f6e 653a  inplace is None:
-000300d0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
-000300e0: 6c61 6365 203d 2046 616c 7365 0a20 2020  lace = False.   
-000300f0: 2020 2020 2069 6620 223d 2220 696e 2065       if "=" in e
-00030100: 7870 7220 616e 6420 696e 706c 6163 6520  xpr and inplace 
-00030110: 696e 2028 5472 7565 2c20 4e6f 6e65 293a  in (True, None):
-00030120: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00030130: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
-00030140: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
-00030150: 2020 2020 2020 2020 2249 6e70 6c61 6365          "Inplace
-00030160: 2065 7661 6c20 6e6f 7420 7375 7070 6f72   eval not suppor
-00030170: 7465 642e 2050 6c65 6173 6520 7573 6520  ted. Please use 
-00030180: 696e 706c 6163 653d 4661 6c73 6522 0a20  inplace=False". 
-00030190: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000301a0: 2020 2020 206d 6574 6120 3d20 7365 6c66       meta = self
-000301b0: 2e5f 6d65 7461 2e65 7661 6c28 6578 7072  ._meta.eval(expr
-000301c0: 2c20 696e 706c 6163 653d 696e 706c 6163  , inplace=inplac
-000301d0: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
-000301e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000301f0: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
-00030200: 4d2e 6576 616c 2c20 6578 7072 2c20 6d65  M.eval, expr, me
-00030210: 7461 3d6d 6574 612c 2069 6e70 6c61 6365  ta=meta, inplace
-00030220: 3d69 6e70 6c61 6365 2c20 2a2a 6b77 6172  =inplace, **kwar
-00030230: 6773 290a 0a20 2020 2040 6465 7269 7665  gs)..    @derive
-00030240: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00030250: 616d 6529 0a20 2020 2064 6566 2064 726f  ame).    def dro
-00030260: 706e 6128 7365 6c66 2c20 686f 773d 6e6f  pna(self, how=no
-00030270: 5f64 6566 6175 6c74 2c20 7375 6273 6574  _default, subset
-00030280: 3d4e 6f6e 652c 2074 6872 6573 683d 6e6f  =None, thresh=no
-00030290: 5f64 6566 6175 6c74 293a 0a20 2020 2020  _default):.     
-000302a0: 2020 2023 2054 6865 7365 206b 6579 776f     # These keywo
-000302b0: 7264 7320 6172 6520 696e 636f 6d70 6174  rds are incompat
-000302c0: 6962 6c65 2077 6974 6820 6561 6368 206f  ible with each o
-000302d0: 7468 6572 2e0a 2020 2020 2020 2020 2320  ther..        # 
-000302e0: 446f 6e27 7420 616c 6c6f 7720 7468 656d  Don't allow them
-000302f0: 2062 6f74 6820 746f 2062 6520 7365 742e   both to be set.
-00030300: 0a20 2020 2020 2020 2069 6620 686f 7720  .        if how 
-00030310: 6973 206e 6f74 206e 6f5f 6465 6661 756c  is not no_defaul
-00030320: 7420 616e 6420 7468 7265 7368 2069 7320  t and thresh is 
-00030330: 6e6f 7420 6e6f 5f64 6566 6175 6c74 3a0a  not no_default:.
-00030340: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00030350: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
-00030360: 2020 2020 2020 2020 2020 2020 2022 596f               "Yo
-00030370: 7520 6361 6e6e 6f74 2073 6574 2062 6f74  u cannot set bot
-00030380: 6820 7468 6520 686f 7720 616e 6420 7468  h the how and th
-00030390: 7265 7368 2061 7267 756d 656e 7473 2061  resh arguments a
-000303a0: 7420 7468 6520 7361 6d65 2074 696d 652e  t the same time.
-000303b0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-000303c0: 0a20 2020 2020 2020 2023 204f 6e6c 7920  .        # Only 
-000303d0: 7370 6563 6966 7920 6068 6f77 6020 6f72  specify `how` or
-000303e0: 2060 7468 7265 7368 6020 6b65 7977 6f72   `thresh` keywor
-000303f0: 6420 6966 2073 7065 6369 6669 6564 2062  d if specified b
-00030400: 7920 7468 6520 7573 6572 0a20 2020 2020  y the user.     
-00030410: 2020 2023 2073 6f20 7765 2075 7469 6c69     # so we utili
-00030420: 7a65 206f 7468 6572 2060 6472 6f70 6e61  ze other `dropna
-00030430: 6020 6b65 7977 6f72 6420 6465 6661 756c  ` keyword defaul
-00030440: 7473 2061 7070 726f 7072 6961 7465 6c79  ts appropriately
-00030450: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
-00030460: 3d20 7b22 7375 6273 6574 223a 2073 7562  = {"subset": sub
-00030470: 7365 747d 0a20 2020 2020 2020 2069 6620  set}.        if 
-00030480: 686f 7720 6973 206e 6f74 206e 6f5f 6465  how is not no_de
-00030490: 6661 756c 743a 0a20 2020 2020 2020 2020  fault:.         
-000304a0: 2020 206b 7761 7267 735b 2268 6f77 225d     kwargs["how"]
-000304b0: 203d 2068 6f77 0a20 2020 2020 2020 2065   = how.        e
-000304c0: 6c69 6620 7468 7265 7368 2069 7320 6e6f  lif thresh is no
-000304d0: 7420 6e6f 5f64 6566 6175 6c74 3a0a 2020  t no_default:.  
-000304e0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-000304f0: 5b22 7468 7265 7368 225d 203d 2074 6872  ["thresh"] = thr
-00030500: 6573 680a 0a20 2020 2020 2020 2072 6574  esh..        ret
-00030510: 7572 6e20 7365 6c66 2e6d 6170 5f70 6172  urn self.map_par
-00030520: 7469 7469 6f6e 7328 4d2e 6472 6f70 6e61  titions(M.dropna
-00030530: 2c20 2a2a 6b77 6172 6773 2c20 656e 666f  , **kwargs, enfo
-00030540: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
-00030550: 7365 290a 0a20 2020 2040 6465 7269 7665  se)..    @derive
-00030560: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00030570: 616d 6529 0a20 2020 2064 6566 2063 6c69  ame).    def cli
-00030580: 7028 7365 6c66 2c20 6c6f 7765 723d 4e6f  p(self, lower=No
-00030590: 6e65 2c20 7570 7065 723d 4e6f 6e65 2c20  ne, upper=None, 
-000305a0: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
-000305b0: 2020 2069 6620 6f75 7420 6973 206e 6f74     if out is not
-000305c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000305d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000305e0: 726f 7228 2227 6f75 7427 206d 7573 7420  ror("'out' must 
-000305f0: 6265 204e 6f6e 6522 290a 2020 2020 2020  be None").      
-00030600: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-00030610: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
-00030620: 2020 2020 2020 2020 2020 4d2e 636c 6970            M.clip
-00030630: 2c20 6c6f 7765 723d 6c6f 7765 722c 2075  , lower=lower, u
-00030640: 7070 6572 3d75 7070 6572 2c20 656e 666f  pper=upper, enfo
-00030650: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
-00030660: 7365 0a20 2020 2020 2020 2029 0a0a 2020  se.        )..  
-00030670: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
-00030680: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
-00030690: 2020 6465 6620 636c 6970 5f6c 6f77 6572    def clip_lower
-000306a0: 2873 656c 662c 2074 6872 6573 686f 6c64  (self, threshold
-000306b0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-000306c0: 6e20 7365 6c66 2e6d 6170 5f70 6172 7469  n self.map_parti
-000306d0: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
-000306e0: 2020 204d 2e63 6c69 705f 6c6f 7765 722c     M.clip_lower,
-000306f0: 2074 6872 6573 686f 6c64 3d74 6872 6573   threshold=thres
-00030700: 686f 6c64 2c20 656e 666f 7263 655f 6d65  hold, enforce_me
-00030710: 7461 6461 7461 3d46 616c 7365 0a20 2020  tadata=False.   
-00030720: 2020 2020 2029 0a0a 2020 2020 4064 6572       )..    @der
-00030730: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
-00030740: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
-00030750: 636c 6970 5f75 7070 6572 2873 656c 662c  clip_upper(self,
-00030760: 2074 6872 6573 686f 6c64 293a 0a20 2020   threshold):.   
-00030770: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00030780: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
-00030790: 0a20 2020 2020 2020 2020 2020 204d 2e63  .            M.c
-000307a0: 6c69 705f 7570 7065 722c 2074 6872 6573  lip_upper, thres
-000307b0: 686f 6c64 3d74 6872 6573 686f 6c64 2c20  hold=threshold, 
-000307c0: 656e 666f 7263 655f 6d65 7461 6461 7461  enforce_metadata
-000307d0: 3d46 616c 7365 0a20 2020 2020 2020 2029  =False.        )
-000307e0: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-000307f0: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
-00030800: 290a 2020 2020 6465 6620 7371 7565 657a  ).    def squeez
-00030810: 6528 7365 6c66 2c20 6178 6973 3d4e 6f6e  e(self, axis=Non
-00030820: 6529 3a0a 2020 2020 2020 2020 6966 2061  e):.        if a
-00030830: 7869 7320 696e 205b 4e6f 6e65 2c20 315d  xis in [None, 1]
-00030840: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00030850: 206c 656e 2873 656c 662e 636f 6c75 6d6e   len(self.column
-00030860: 7329 203d 3d20 313a 0a20 2020 2020 2020  s) == 1:.       
-00030870: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00030880: 7365 6c66 5b73 656c 662e 636f 6c75 6d6e  self[self.column
-00030890: 735b 305d 5d0a 2020 2020 2020 2020 2020  s[0]].          
-000308a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000308b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000308c0: 656c 660a 0a20 2020 2020 2020 2065 6c69  elf..        eli
-000308d0: 6620 6178 6973 203d 3d20 303a 0a20 2020  f axis == 0:.   
-000308e0: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-000308f0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00030900: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00030910: 2020 2020 6622 7b74 7970 6528 7365 6c66      f"{type(self
-00030920: 297d 2064 6f65 7320 6e6f 7420 7375 7070  )} does not supp
-00030930: 6f72 7420 7371 7565 657a 6520 616c 6f6e  ort squeeze alon
-00030940: 6720 6178 6973 2030 220a 2020 2020 2020  g axis 0".      
-00030950: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00030960: 2065 6c69 6620 6178 6973 206e 6f74 2069   elif axis not i
-00030970: 6e20 5b30 2c20 312c 204e 6f6e 655d 3a0a  n [0, 1, None]:.
-00030980: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00030990: 6520 5661 6c75 6545 7272 6f72 2866 224e  e ValueError(f"N
-000309a0: 6f20 6178 6973 207b 6178 6973 7d20 666f  o axis {axis} fo
-000309b0: 7220 6f62 6a65 6374 2074 7970 6520 7b74  r object type {t
-000309c0: 7970 6528 7365 6c66 297d 2229 0a0a 2020  ype(self)}")..  
-000309d0: 2020 4064 6572 6976 6564 5f66 726f 6d28    @derived_from(
-000309e0: 7064 2e44 6174 6146 7261 6d65 290a 2020  pd.DataFrame).  
-000309f0: 2020 6465 6620 746f 5f74 696d 6573 7461    def to_timesta
-00030a00: 6d70 2873 656c 662c 2066 7265 713d 4e6f  mp(self, freq=No
-00030a10: 6e65 2c20 686f 773d 2273 7461 7274 222c  ne, how="start",
-00030a20: 2061 7869 733d 3029 3a0a 2020 2020 2020   axis=0):.      
-00030a30: 2020 6466 203d 2065 6c65 6d77 6973 6528    df = elemwise(
-00030a40: 4d2e 746f 5f74 696d 6573 7461 6d70 2c20  M.to_timestamp, 
-00030a50: 7365 6c66 2c20 6672 6571 2c20 686f 772c  self, freq, how,
-00030a60: 2061 7869 7329 0a20 2020 2020 2020 2064   axis).        d
-00030a70: 662e 6469 7669 7369 6f6e 7320 3d20 7475  f.divisions = tu
-00030a80: 706c 6528 7064 2e49 6e64 6578 2873 656c  ple(pd.Index(sel
-00030a90: 662e 6469 7669 7369 6f6e 7329 2e74 6f5f  f.divisions).to_
-00030aa0: 7469 6d65 7374 616d 7028 686f 773d 686f  timestamp(how=ho
-00030ab0: 772c 2066 7265 713d 6672 6571 2929 0a20  w, freq=freq)). 
-00030ac0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
-00030ad0: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
-00030ae0: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
-00030af0: 290a 2020 2020 6465 6620 6578 706c 6f64  ).    def explod
-00030b00: 6528 7365 6c66 2c20 636f 6c75 6d6e 293a  e(self, column):
-00030b10: 0a20 2020 2020 2020 206d 6574 6120 3d20  .        meta = 
-00030b20: 7365 6c66 2e5f 6d65 7461 2e65 7870 6c6f  self._meta.explo
-00030b30: 6465 2863 6f6c 756d 6e29 0a20 2020 2020  de(column).     
-00030b40: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
-00030b50: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
-00030b60: 6578 706c 6f64 652c 2063 6f6c 756d 6e2c  explode, column,
-00030b70: 206d 6574 613d 6d65 7461 2c20 656e 666f   meta=meta, enfo
-00030b80: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
-00030b90: 7365 290a 0a20 2020 2064 6566 2074 6f5f  se)..    def to_
-00030ba0: 6261 6728 7365 6c66 2c20 696e 6465 783d  bag(self, index=
-00030bb0: 4661 6c73 652c 2066 6f72 6d61 743d 2274  False, format="t
-00030bc0: 7570 6c65 2229 3a0a 2020 2020 2020 2020  uple"):.        
-00030bd0: 2222 2243 6f6e 7665 7274 2074 6f20 6120  """Convert to a 
-00030be0: 6461 736b 2042 6167 206f 6620 7475 706c  dask Bag of tupl
-00030bf0: 6573 206f 6620 6561 6368 2072 6f77 2e0a  es of each row..
-00030c00: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00030c10: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00030c20: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2069  ------.        i
-00030c30: 6e64 6578 203a 2062 6f6f 6c2c 206f 7074  ndex : bool, opt
-00030c40: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00030c50: 2020 4966 2054 7275 652c 2074 6865 2069    If True, the i
-00030c60: 6e64 6578 2069 7320 696e 636c 7564 6564  ndex is included
-00030c70: 2061 7320 7468 6520 6669 7273 7420 656c   as the first el
-00030c80: 656d 656e 7420 6f66 2065 6163 6820 7475  ement of each tu
-00030c90: 706c 652e 0a20 2020 2020 2020 2020 2020  ple..           
-00030ca0: 2044 6566 6175 6c74 2069 7320 4661 6c73   Default is Fals
-00030cb0: 652e 0a20 2020 2020 2020 2066 6f72 6d61  e..        forma
-00030cc0: 7420 3a20 7b22 7475 706c 6522 2c20 2264  t : {"tuple", "d
-00030cd0: 6963 7422 2c20 2266 7261 6d65 227d 2c20  ict", "frame"}, 
-00030ce0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00030cf0: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
-00030d00: 7265 7475 726e 2061 2062 6167 206f 6620  return a bag of 
-00030d10: 7475 706c 6573 2c20 6469 6374 696f 6e61  tuples, dictiona
-00030d20: 7269 6573 2c20 6f72 0a20 2020 2020 2020  ries, or.       
-00030d30: 2020 2020 2064 6174 6166 7261 6d65 2d6c       dataframe-l
-00030d40: 696b 6520 6f62 6a65 6374 732e 2044 6566  ike objects. Def
-00030d50: 6175 6c74 2069 7320 2274 7570 6c65 222e  ault is "tuple".
-00030d60: 2049 6620 2266 7261 6d65 222c 0a20 2020   If "frame",.   
-00030d70: 2020 2020 2020 2020 2074 6865 206f 7269           the ori
-00030d80: 6769 6e61 6c20 7061 7274 6974 696f 6e73  ginal partitions
-00030d90: 206f 6620 6060 6466 6060 2077 696c 6c20   of ``df`` will 
-00030da0: 6e6f 7420 6265 2074 7261 6e73 666f 726d  not be transform
-00030db0: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
-00030dc0: 6e20 616e 7920 7761 792e 0a20 2020 2020  n any way..     
-00030dd0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00030de0: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
-00030df0: 6d65 2e69 6f20 696d 706f 7274 2074 6f5f  me.io import to_
-00030e00: 6261 670a 0a20 2020 2020 2020 2072 6574  bag..        ret
-00030e10: 7572 6e20 746f 5f62 6167 2873 656c 662c  urn to_bag(self,
-00030e20: 2069 6e64 6578 2c20 666f 726d 6174 290a   index, format).
-00030e30: 0a20 2020 2064 6566 2074 6f5f 7061 7271  .    def to_parq
-00030e40: 7565 7428 7365 6c66 2c20 7061 7468 2c20  uet(self, path, 
-00030e50: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-00030e60: 3a0a 2020 2020 2020 2020 2222 2253 6565  :.        """See
-00030e70: 2064 642e 746f 5f70 6172 7175 6574 2064   dd.to_parquet d
-00030e80: 6f63 7374 7269 6e67 2066 6f72 206d 6f72  ocstring for mor
-00030e90: 6520 696e 666f 726d 6174 696f 6e22 2222  e information"""
-00030ea0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00030eb0: 736b 2e64 6174 6166 7261 6d65 2e69 6f20  sk.dataframe.io 
-00030ec0: 696d 706f 7274 2074 6f5f 7061 7271 7565  import to_parque
-00030ed0: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
-00030ee0: 6e20 746f 5f70 6172 7175 6574 2873 656c  n to_parquet(sel
-00030ef0: 662c 2070 6174 682c 202a 6172 6773 2c20  f, path, *args, 
-00030f00: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00030f10: 6566 2074 6f5f 6f72 6328 7365 6c66 2c20  ef to_orc(self, 
-00030f20: 7061 7468 2c20 2a61 7267 732c 202a 2a6b  path, *args, **k
-00030f30: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00030f40: 2222 2253 6565 2064 642e 746f 5f6f 7263  """See dd.to_orc
-00030f50: 2064 6f63 7374 7269 6e67 2066 6f72 206d   docstring for m
-00030f60: 6f72 6520 696e 666f 726d 6174 696f 6e22  ore information"
-00030f70: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00030f80: 6461 736b 2e64 6174 6166 7261 6d65 2e69  dask.dataframe.i
-00030f90: 6f20 696d 706f 7274 2074 6f5f 6f72 630a  o import to_orc.
-00030fa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00030fb0: 746f 5f6f 7263 2873 656c 662c 2070 6174  to_orc(self, pat
-00030fc0: 682c 202a 6172 6773 2c20 2a2a 6b77 6172  h, *args, **kwar
-00030fd0: 6773 290a 0a20 2020 2040 6465 7269 7665  gs)..    @derive
-00030fe0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00030ff0: 616d 6529 0a20 2020 2064 6566 2074 6f5f  ame).    def to_
-00031000: 7374 7269 6e67 2873 656c 662c 206d 6178  string(self, max
-00031010: 5f72 6f77 733d 3529 3a0a 2020 2020 2020  _rows=5):.      
-00031020: 2020 2320 6f70 7469 6f6e 5f63 6f6e 7465    # option_conte
-00031030: 7874 2064 6f65 736e 2774 2061 6666 6563  xt doesn't affec
-00031040: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
-00031050: 2073 656c 662e 5f72 6570 725f 6461 7461   self._repr_data
-00031060: 2829 2e74 6f5f 7374 7269 6e67 286d 6178  ().to_string(max
-00031070: 5f72 6f77 733d 6d61 785f 726f 7773 2c20  _rows=max_rows, 
-00031080: 7368 6f77 5f64 696d 656e 7369 6f6e 733d  show_dimensions=
-00031090: 4661 6c73 6529 0a0a 2020 2020 6465 6620  False)..    def 
-000310a0: 5f67 6574 5f6e 756d 6572 6963 5f64 6174  _get_numeric_dat
-000310b0: 6128 7365 6c66 2c20 686f 773d 2261 6e79  a(self, how="any
-000310c0: 222c 2073 7562 7365 743d 4e6f 6e65 293a  ", subset=None):
-000310d0: 0a20 2020 2020 2020 2023 2063 616c 6375  .        # calcu
-000310e0: 6c61 7465 2063 6f6c 756d 6e73 2074 6f20  late columns to 
-000310f0: 6176 6f69 6420 756e 6e65 6365 7373 6172  avoid unnecessar
-00031100: 7920 6361 6c63 756c 6174 696f 6e0a 2020  y calculation.  
-00031110: 2020 2020 2020 6e75 6d65 7269 6373 203d        numerics =
-00031120: 2073 656c 662e 5f6d 6574 612e 5f67 6574   self._meta._get
-00031130: 5f6e 756d 6572 6963 5f64 6174 6128 290a  _numeric_data().
-00031140: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00031150: 6e75 6d65 7269 6373 2e63 6f6c 756d 6e73  numerics.columns
-00031160: 2920 3c20 6c65 6e28 7365 6c66 2e63 6f6c  ) < len(self.col
-00031170: 756d 6e73 293a 0a20 2020 2020 2020 2020  umns):.         
-00031180: 2020 206e 616d 6520 3d20 7365 6c66 2e5f     name = self._
-00031190: 746f 6b65 6e5f 7072 6566 6978 202b 2022  token_prefix + "
-000311a0: 2d67 6574 5f6e 756d 6572 6963 5f64 6174  -get_numeric_dat
-000311b0: 6122 0a20 2020 2020 2020 2020 2020 2072  a".            r
-000311c0: 6574 7572 6e20 7365 6c66 2e6d 6170 5f70  eturn self.map_p
-000311d0: 6172 7469 7469 6f6e 7328 4d2e 5f67 6574  artitions(M._get
-000311e0: 5f6e 756d 6572 6963 5f64 6174 612c 206d  _numeric_data, m
-000311f0: 6574 613d 6e75 6d65 7269 6373 2c20 746f  eta=numerics, to
-00031200: 6b65 6e3d 6e61 6d65 290a 2020 2020 2020  ken=name).      
-00031210: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00031220: 2020 2020 2320 7573 6520 6d79 7365 6c66      # use myself
-00031230: 2069 6620 616c 6c20 6e75 6d65 7269 6373   if all numerics
-00031240: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00031250: 7572 6e20 7365 6c66 0a0a 2020 2020 4063  urn self..    @c
-00031260: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00031270: 6566 205f 7661 6c69 6461 7465 5f61 7869  ef _validate_axi
-00031280: 7328 636c 732c 2061 7869 733d 302c 206e  s(cls, axis=0, n
-00031290: 6f6e 655f 6973 5f7a 6572 6f3a 2062 6f6f  one_is_zero: boo
-000312a0: 6c20 3d20 5472 7565 2920 2d3e 204e 6f6e  l = True) -> Non
-000312b0: 6520 7c20 4c69 7465 7261 6c5b 302c 2031  e | Literal[0, 1
-000312c0: 5d3a 0a20 2020 2020 2020 2069 6620 6178  ]:.        if ax
-000312d0: 6973 206e 6f74 2069 6e20 2830 2c20 312c  is not in (0, 1,
-000312e0: 2022 696e 6465 7822 2c20 2263 6f6c 756d   "index", "colum
-000312f0: 6e73 222c 204e 6f6e 6529 3a0a 2020 2020  ns", None):.    
-00031300: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00031310: 6c75 6545 7272 6f72 2866 224e 6f20 6178  lueError(f"No ax
-00031320: 6973 206e 616d 6564 207b 6178 6973 7d22  is named {axis}"
-00031330: 290a 2020 2020 2020 2020 2320 636f 6e76  ).        # conv
-00031340: 6572 7420 746f 206e 756d 6572 6963 2061  ert to numeric a
-00031350: 7869 730a 2020 2020 2020 2020 6e75 6d65  xis.        nume
-00031360: 7269 635f 6178 6973 3a20 6469 6374 5b73  ric_axis: dict[s
-00031370: 7472 207c 204e 6f6e 652c 204c 6974 6572  tr | None, Liter
-00031380: 616c 5b30 2c20 315d 5d20 3d20 7b22 696e  al[0, 1]] = {"in
-00031390: 6465 7822 3a20 302c 2022 636f 6c75 6d6e  dex": 0, "column
-000313a0: 7322 3a20 317d 0a20 2020 2020 2020 2069  s": 1}.        i
-000313b0: 6620 6e6f 6e65 5f69 735f 7a65 726f 3a0a  f none_is_zero:.
-000313c0: 2020 2020 2020 2020 2020 2020 6e75 6d65              nume
-000313d0: 7269 635f 6178 6973 5b4e 6f6e 655d 203d  ric_axis[None] =
-000313e0: 2030 0a0a 2020 2020 2020 2020 7265 7475   0..        retu
-000313f0: 726e 206e 756d 6572 6963 5f61 7869 732e  rn numeric_axis.
-00031400: 6765 7428 6178 6973 2c20 6178 6973 290a  get(axis, axis).
-00031410: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-00031420: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-00031430: 0a20 2020 2064 6566 2064 726f 7028 7365  .    def drop(se
-00031440: 6c66 2c20 6c61 6265 6c73 3d4e 6f6e 652c  lf, labels=None,
-00031450: 2061 7869 733d 302c 2063 6f6c 756d 6e73   axis=0, columns
-00031460: 3d4e 6f6e 652c 2065 7272 6f72 733d 2272  =None, errors="r
-00031470: 6169 7365 2229 3a0a 2020 2020 2020 2020  aise"):.        
-00031480: 6178 6973 203d 2073 656c 662e 5f76 616c  axis = self._val
-00031490: 6964 6174 655f 6178 6973 2861 7869 7329  idate_axis(axis)
-000314a0: 0a20 2020 2020 2020 2069 6620 6178 6973  .        if axis
-000314b0: 203d 3d20 3020 616e 6420 636f 6c75 6d6e   == 0 and column
-000314c0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-000314d0: 2020 2020 2020 2020 2020 2023 2043 6f6c             # Col
-000314e0: 756d 6e73 206d 7573 7420 6265 2073 7065  umns must be spe
-000314f0: 6369 6669 6564 2069 6620 6178 6973 3d3d  cified if axis==
-00031500: 300a 2020 2020 2020 2020 2020 2020 7265  0.            re
-00031510: 7475 726e 2073 656c 662e 6d61 705f 7061  turn self.map_pa
-00031520: 7274 6974 696f 6e73 280a 2020 2020 2020  rtitions(.      
-00031530: 2020 2020 2020 2020 2020 6472 6f70 5f62            drop_b
-00031540: 795f 7368 616c 6c6f 775f 636f 7079 2c20  y_shallow_copy, 
-00031550: 636f 6c75 6d6e 732c 2065 7272 6f72 733d  columns, errors=
-00031560: 6572 726f 7273 2c20 656e 666f 7263 655f  errors, enforce_
-00031570: 6d65 7461 6461 7461 3d46 616c 7365 0a20  metadata=False. 
-00031580: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00031590: 2020 2020 2065 6c69 6620 6178 6973 203d       elif axis =
-000315a0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-000315b0: 2072 6574 7572 6e20 7365 6c66 2e6d 6170   return self.map
-000315c0: 5f70 6172 7469 7469 6f6e 7328 0a20 2020  _partitions(.   
-000315d0: 2020 2020 2020 2020 2020 2020 2064 726f               dro
-000315e0: 705f 6279 5f73 6861 6c6c 6f77 5f63 6f70  p_by_shallow_cop
-000315f0: 792c 206c 6162 656c 732c 2065 7272 6f72  y, labels, error
-00031600: 733d 6572 726f 7273 2c20 656e 666f 7263  s=errors, enforc
-00031610: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
-00031620: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00031630: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00031640: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-00031650: 280a 2020 2020 2020 2020 2020 2020 2244  (.            "D
-00031660: 726f 7020 6375 7272 656e 746c 7920 6f6e  rop currently on
-00031670: 6c79 2077 6f72 6b73 2066 6f72 2061 7869  ly works for axi
-00031680: 733d 3120 6f72 2077 6865 6e20 636f 6c75  s=1 or when colu
-00031690: 6d6e 7320 6973 206e 6f74 204e 6f6e 6522  mns is not None"
-000316a0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000316b0: 6465 6620 6d65 7267 6528 0a20 2020 2020  def merge(.     
-000316c0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000316d0: 2072 6967 6874 2c0a 2020 2020 2020 2020   right,.        
-000316e0: 686f 773d 2269 6e6e 6572 222c 0a20 2020  how="inner",.   
-000316f0: 2020 2020 206f 6e3d 4e6f 6e65 2c0a 2020       on=None,.  
-00031700: 2020 2020 2020 6c65 6674 5f6f 6e3d 4e6f        left_on=No
-00031710: 6e65 2c0a 2020 2020 2020 2020 7269 6768  ne,.        righ
-00031720: 745f 6f6e 3d4e 6f6e 652c 0a20 2020 2020  t_on=None,.     
-00031730: 2020 206c 6566 745f 696e 6465 783d 4661     left_index=Fa
-00031740: 6c73 652c 0a20 2020 2020 2020 2072 6967  lse,.        rig
-00031750: 6874 5f69 6e64 6578 3d46 616c 7365 2c0a  ht_index=False,.
-00031760: 2020 2020 2020 2020 7375 6666 6978 6573          suffixes
-00031770: 3d28 225f 7822 2c20 225f 7922 292c 0a20  =("_x", "_y"),. 
-00031780: 2020 2020 2020 2069 6e64 6963 6174 6f72         indicator
-00031790: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-000317a0: 6e70 6172 7469 7469 6f6e 733d 4e6f 6e65  npartitions=None
-000317b0: 2c0a 2020 2020 2020 2020 7368 7566 666c  ,.        shuffl
-000317c0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-000317d0: 6272 6f61 6463 6173 743d 4e6f 6e65 2c0a  broadcast=None,.
-000317e0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-000317f0: 2222 4d65 7267 6520 7468 6520 4461 7461  ""Merge the Data
-00031800: 4672 616d 6520 7769 7468 2061 6e6f 7468  Frame with anoth
-00031810: 6572 2044 6174 6146 7261 6d65 0a0a 2020  er DataFrame..  
-00031820: 2020 2020 2020 5468 6973 2077 696c 6c20        This will 
-00031830: 6d65 7267 6520 7468 6520 7477 6f20 6461  merge the two da
-00031840: 7461 7365 7473 2c20 6569 7468 6572 206f  tasets, either o
-00031850: 6e20 7468 6520 696e 6469 6365 732c 2061  n the indices, a
-00031860: 2063 6572 7461 696e 2063 6f6c 756d 6e0a   certain column.
-00031870: 2020 2020 2020 2020 696e 2065 6163 6820          in each 
-00031880: 6461 7461 7365 7420 6f72 2074 6865 2069  dataset or the i
-00031890: 6e64 6578 2069 6e20 6f6e 6520 6461 7461  ndex in one data
-000318a0: 7365 7420 616e 6420 7468 6520 636f 6c75  set and the colu
-000318b0: 6d6e 2069 6e20 616e 6f74 6865 722e 0a0a  mn in another...
-000318c0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000318d0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
-000318e0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7269  -----.        ri
-000318f0: 6768 743a 2064 6173 6b2e 6461 7461 6672  ght: dask.datafr
-00031900: 616d 652e 4461 7461 4672 616d 650a 2020  ame.DataFrame.  
-00031910: 2020 2020 2020 686f 7720 3a20 7b27 6c65        how : {'le
-00031920: 6674 272c 2027 7269 6768 7427 2c20 276f  ft', 'right', 'o
-00031930: 7574 6572 272c 2027 696e 6e65 7227 7d2c  uter', 'inner'},
-00031940: 2064 6566 6175 6c74 3a20 2769 6e6e 6572   default: 'inner
-00031950: 270a 2020 2020 2020 2020 2020 2020 486f  '.            Ho
-00031960: 7720 746f 2068 616e 646c 6520 7468 6520  w to handle the 
-00031970: 6f70 6572 6174 696f 6e20 6f66 2074 6865  operation of the
-00031980: 2074 776f 206f 626a 6563 7473 3a0a 0a20   two objects:.. 
-00031990: 2020 2020 2020 2020 2020 202d 206c 6566             - lef
-000319a0: 743a 2075 7365 2063 616c 6c69 6e67 2066  t: use calling f
-000319b0: 7261 6d65 2773 2069 6e64 6578 2028 6f72  rame's index (or
-000319c0: 2063 6f6c 756d 6e20 6966 206f 6e20 6973   column if on is
-000319d0: 2073 7065 6369 6669 6564 290a 2020 2020   specified).    
-000319e0: 2020 2020 2020 2020 2d20 7269 6768 743a          - right:
-000319f0: 2075 7365 206f 7468 6572 2066 7261 6d65   use other frame
-00031a00: 2773 2069 6e64 6578 0a20 2020 2020 2020  's index.       
-00031a10: 2020 2020 202d 206f 7574 6572 3a20 666f       - outer: fo
-00031a20: 726d 2075 6e69 6f6e 206f 6620 6361 6c6c  rm union of call
-00031a30: 696e 6720 6672 616d 6527 7320 696e 6465  ing frame's inde
-00031a40: 7820 286f 7220 636f 6c75 6d6e 2069 6620  x (or column if 
-00031a50: 6f6e 2069 730a 2020 2020 2020 2020 2020  on is.          
-00031a60: 2020 2020 7370 6563 6966 6965 6429 2077      specified) w
-00031a70: 6974 6820 6f74 6865 7220 6672 616d 6527  ith other frame'
-00031a80: 7320 696e 6465 782c 2061 6e64 2073 6f72  s index, and sor
-00031a90: 7420 6974 0a20 2020 2020 2020 2020 2020  t it.           
-00031aa0: 2020 206c 6578 6963 6f67 7261 7068 6963     lexicographic
-00031ab0: 616c 6c79 0a20 2020 2020 2020 2020 2020  ally.           
-00031ac0: 202d 2069 6e6e 6572 3a20 666f 726d 2069   - inner: form i
-00031ad0: 6e74 6572 7365 6374 696f 6e20 6f66 2063  ntersection of c
-00031ae0: 616c 6c69 6e67 2066 7261 6d65 2773 2069  alling frame's i
-00031af0: 6e64 6578 2028 6f72 2063 6f6c 756d 6e20  ndex (or column 
-00031b00: 6966 0a20 2020 2020 2020 2020 2020 2020  if.             
-00031b10: 206f 6e20 6973 2073 7065 6369 6669 6564   on is specified
-00031b20: 2920 7769 7468 206f 7468 6572 2066 7261  ) with other fra
-00031b30: 6d65 2773 2069 6e64 6578 2c20 7072 6573  me's index, pres
-00031b40: 6572 7669 6e67 2074 6865 206f 7264 6572  erving the order
-00031b50: 0a20 2020 2020 2020 2020 2020 2020 206f  .              o
-00031b60: 6620 7468 6520 6361 6c6c 696e 6727 7320  f the calling's 
-00031b70: 6f6e 650a 0a20 2020 2020 2020 206f 6e20  one..        on 
-00031b80: 3a20 6c61 6265 6c20 6f72 206c 6973 740a  : label or list.
-00031b90: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
-00031ba0: 6d6e 206f 7220 696e 6465 7820 6c65 7665  mn or index leve
-00031bb0: 6c20 6e61 6d65 7320 746f 206a 6f69 6e20  l names to join 
-00031bc0: 6f6e 2e20 5468 6573 6520 6d75 7374 2062  on. These must b
-00031bd0: 6520 666f 756e 6420 696e 2062 6f74 680a  e found in both.
-00031be0: 2020 2020 2020 2020 2020 2020 4461 7461              Data
-00031bf0: 4672 616d 6573 2e20 4966 206f 6e20 6973  Frames. If on is
-00031c00: 204e 6f6e 6520 616e 6420 6e6f 7420 6d65   None and not me
-00031c10: 7267 696e 6720 6f6e 2069 6e64 6578 6573  rging on indexes
-00031c20: 2074 6865 6e20 7468 6973 0a20 2020 2020   then this.     
-00031c30: 2020 2020 2020 2064 6566 6175 6c74 7320         defaults 
-00031c40: 746f 2074 6865 2069 6e74 6572 7365 6374  to the intersect
-00031c50: 696f 6e20 6f66 2074 6865 2063 6f6c 756d  ion of the colum
-00031c60: 6e73 2069 6e20 626f 7468 2044 6174 6146  ns in both DataF
-00031c70: 7261 6d65 732e 0a20 2020 2020 2020 206c  rames..        l
-00031c80: 6566 745f 6f6e 203a 206c 6162 656c 206f  eft_on : label o
-00031c90: 7220 6c69 7374 2c20 6f72 2061 7272 6179  r list, or array
-00031ca0: 2d6c 696b 650a 2020 2020 2020 2020 2020  -like.          
-00031cb0: 2020 436f 6c75 6d6e 2074 6f20 6a6f 696e    Column to join
-00031cc0: 206f 6e20 696e 2074 6865 206c 6566 7420   on in the left 
-00031cd0: 4461 7461 4672 616d 652e 204f 7468 6572  DataFrame. Other
-00031ce0: 2074 6861 6e20 696e 2070 616e 6461 730a   than in pandas.
-00031cf0: 2020 2020 2020 2020 2020 2020 6172 7261              arra
-00031d00: 7973 2061 6e64 206c 6973 7473 2061 7265  ys and lists are
-00031d10: 206f 6e6c 7920 7375 7070 6f72 7420 6966   only support if
-00031d20: 2074 6865 6972 206c 656e 6774 6820 6973   their length is
-00031d30: 2031 2e0a 2020 2020 2020 2020 7269 6768   1..        righ
-00031d40: 745f 6f6e 203a 206c 6162 656c 206f 7220  t_on : label or 
-00031d50: 6c69 7374 2c20 6f72 2061 7272 6179 2d6c  list, or array-l
-00031d60: 696b 650a 2020 2020 2020 2020 2020 2020  ike.            
-00031d70: 436f 6c75 6d6e 2074 6f20 6a6f 696e 206f  Column to join o
-00031d80: 6e20 696e 2074 6865 2072 6967 6874 2044  n in the right D
-00031d90: 6174 6146 7261 6d65 2e20 4f74 6865 7220  ataFrame. Other 
-00031da0: 7468 616e 2069 6e20 7061 6e64 6173 0a20  than in pandas. 
-00031db0: 2020 2020 2020 2020 2020 2061 7272 6179             array
-00031dc0: 7320 616e 6420 6c69 7374 7320 6172 6520  s and lists are 
-00031dd0: 6f6e 6c79 2073 7570 706f 7274 2069 6620  only support if 
-00031de0: 7468 6569 7220 6c65 6e67 7468 2069 7320  their length is 
-00031df0: 312e 0a20 2020 2020 2020 206c 6566 745f  1..        left_
-00031e00: 696e 6465 7820 3a20 626f 6f6c 6561 6e2c  index : boolean,
-00031e10: 2064 6566 6175 6c74 2046 616c 7365 0a20   default False. 
-00031e20: 2020 2020 2020 2020 2020 2055 7365 2074             Use t
-00031e30: 6865 2069 6e64 6578 2066 726f 6d20 7468  he index from th
-00031e40: 6520 6c65 6674 2044 6174 6146 7261 6d65  e left DataFrame
-00031e50: 2061 7320 7468 6520 6a6f 696e 206b 6579   as the join key
-00031e60: 2e0a 2020 2020 2020 2020 7269 6768 745f  ..        right_
-00031e70: 696e 6465 7820 3a20 626f 6f6c 6561 6e2c  index : boolean,
-00031e80: 2064 6566 6175 6c74 2046 616c 7365 0a20   default False. 
-00031e90: 2020 2020 2020 2020 2020 2055 7365 2074             Use t
-00031ea0: 6865 2069 6e64 6578 2066 726f 6d20 7468  he index from th
-00031eb0: 6520 7269 6768 7420 4461 7461 4672 616d  e right DataFram
-00031ec0: 6520 6173 2074 6865 206a 6f69 6e20 6b65  e as the join ke
-00031ed0: 792e 0a20 2020 2020 2020 2073 7566 6669  y..        suffi
-00031ee0: 7865 7320 3a20 322d 6c65 6e67 7468 2073  xes : 2-length s
-00031ef0: 6571 7565 6e63 6520 2874 7570 6c65 2c20  equence (tuple, 
-00031f00: 6c69 7374 2c20 2e2e 2e29 0a20 2020 2020  list, ...).     
-00031f10: 2020 2020 2020 2053 7566 6669 7820 746f         Suffix to
-00031f20: 2061 7070 6c79 2074 6f20 6f76 6572 6c61   apply to overla
-00031f30: 7070 696e 6720 636f 6c75 6d6e 206e 616d  pping column nam
-00031f40: 6573 2069 6e20 7468 6520 6c65 6674 2061  es in the left a
-00031f50: 6e64 0a20 2020 2020 2020 2020 2020 2072  nd.            r
-00031f60: 6967 6874 2073 6964 652c 2072 6573 7065  ight side, respe
-00031f70: 6374 6976 656c 790a 2020 2020 2020 2020  ctively.        
-00031f80: 696e 6469 6361 746f 7220 3a20 626f 6f6c  indicator : bool
-00031f90: 6561 6e20 6f72 2073 7472 696e 672c 2064  ean or string, d
-00031fa0: 6566 6175 6c74 2046 616c 7365 0a20 2020  efault False.   
-00031fb0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00031fc0: 2c20 6164 6473 2061 2063 6f6c 756d 6e20  , adds a column 
-00031fd0: 746f 206f 7574 7075 7420 4461 7461 4672  to output DataFr
-00031fe0: 616d 6520 6361 6c6c 6564 2022 5f6d 6572  ame called "_mer
-00031ff0: 6765 2220 7769 7468 0a20 2020 2020 2020  ge" with.       
-00032000: 2020 2020 2069 6e66 6f72 6d61 7469 6f6e       information
-00032010: 206f 6e20 7468 6520 736f 7572 6365 206f   on the source o
-00032020: 6620 6561 6368 2072 6f77 2e20 4966 2073  f each row. If s
-00032030: 7472 696e 672c 2063 6f6c 756d 6e20 7769  tring, column wi
-00032040: 7468 0a20 2020 2020 2020 2020 2020 2069  th.            i
-00032050: 6e66 6f72 6d61 7469 6f6e 206f 6e20 736f  nformation on so
-00032060: 7572 6365 206f 6620 6561 6368 2072 6f77  urce of each row
-00032070: 2077 696c 6c20 6265 2061 6464 6564 2074   will be added t
-00032080: 6f20 6f75 7470 7574 2044 6174 6146 7261  o output DataFra
-00032090: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-000320a0: 616e 6420 636f 6c75 6d6e 2077 696c 6c20  and column will 
-000320b0: 6265 206e 616d 6564 2076 616c 7565 206f  be named value o
-000320c0: 6620 7374 7269 6e67 2e20 496e 666f 726d  f string. Inform
-000320d0: 6174 696f 6e20 636f 6c75 6d6e 2069 730a  ation column is.
-000320e0: 2020 2020 2020 2020 2020 2020 4361 7465              Cate
-000320f0: 676f 7269 6361 6c2d 7479 7065 2061 6e64  gorical-type and
-00032100: 2074 616b 6573 206f 6e20 6120 7661 6c75   takes on a valu
-00032110: 6520 6f66 2022 6c65 6674 5f6f 6e6c 7922  e of "left_only"
-00032120: 2066 6f72 206f 6273 6572 7661 7469 6f6e   for observation
-00032130: 730a 2020 2020 2020 2020 2020 2020 7768  s.            wh
-00032140: 6f73 6520 6d65 7267 6520 6b65 7920 6f6e  ose merge key on
-00032150: 6c79 2061 7070 6561 7273 2069 6e20 606c  ly appears in `l
-00032160: 6566 7460 2044 6174 6146 7261 6d65 2c20  eft` DataFrame, 
-00032170: 2272 6967 6874 5f6f 6e6c 7922 2066 6f72  "right_only" for
-00032180: 0a20 2020 2020 2020 2020 2020 206f 6273  .            obs
-00032190: 6572 7661 7469 6f6e 7320 7768 6f73 6520  ervations whose 
-000321a0: 6d65 7267 6520 6b65 7920 6f6e 6c79 2061  merge key only a
-000321b0: 7070 6561 7273 2069 6e20 6072 6967 6874  ppears in `right
-000321c0: 6020 4461 7461 4672 616d 652c 0a20 2020  ` DataFrame,.   
-000321d0: 2020 2020 2020 2020 2061 6e64 2022 626f           and "bo
-000321e0: 7468 2220 6966 2074 6865 206f 6273 6572  th" if the obser
-000321f0: 7661 7469 6f6e e280 9973 206d 6572 6765  vation...s merge
-00032200: 206b 6579 2069 7320 666f 756e 6420 696e   key is found in
-00032210: 2062 6f74 682e 0a20 2020 2020 2020 206e   both..        n
-00032220: 7061 7274 6974 696f 6e73 3a20 696e 7420  partitions: int 
-00032230: 6f72 204e 6f6e 652c 206f 7074 696f 6e61  or None, optiona
-00032240: 6c0a 2020 2020 2020 2020 2020 2020 5468  l.            Th
-00032250: 6520 6964 6561 6c20 6e75 6d62 6572 206f  e ideal number o
-00032260: 6620 6f75 7470 7574 2070 6172 7469 7469  f output partiti
-00032270: 6f6e 732e 2054 6869 7320 6973 206f 6e6c  ons. This is onl
-00032280: 7920 7574 696c 6973 6564 2077 6865 6e0a  y utilised when.
-00032290: 2020 2020 2020 2020 2020 2020 7065 7266              perf
-000322a0: 6f72 6d69 6e67 2061 2068 6173 685f 6a6f  orming a hash_jo
-000322b0: 696e 2028 6d65 7267 696e 6720 6f6e 2063  in (merging on c
-000322c0: 6f6c 756d 6e73 206f 6e6c 7929 2e20 4966  olumns only). If
-000322d0: 2060 604e 6f6e 6560 6020 7468 656e 0a20   ``None`` then. 
-000322e0: 2020 2020 2020 2020 2020 2060 606e 7061             ``npa
-000322f0: 7274 6974 696f 6e73 203d 206d 6178 286c  rtitions = max(l
-00032300: 6873 2e6e 7061 7274 6974 696f 6e73 2c20  hs.npartitions, 
-00032310: 7268 732e 6e70 6172 7469 7469 6f6e 7329  rhs.npartitions)
-00032320: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
-00032330: 4465 6661 756c 7420 6973 2060 604e 6f6e  Default is ``Non
-00032340: 6560 602e 0a20 2020 2020 2020 2073 6875  e``..        shu
-00032350: 6666 6c65 3a20 7b27 6469 736b 272c 2027  ffle: {'disk', '
-00032360: 7461 736b 7327 7d2c 206f 7074 696f 6e61  tasks'}, optiona
-00032370: 6c0a 2020 2020 2020 2020 2020 2020 4569  l.            Ei
-00032380: 7468 6572 2060 6027 6469 736b 2760 6020  ther ``'disk'`` 
-00032390: 666f 7220 7369 6e67 6c65 2d6e 6f64 6520  for single-node 
-000323a0: 6f70 6572 6174 696f 6e20 6f72 2060 6027  operation or ``'
-000323b0: 7461 736b 7327 6060 2066 6f72 0a20 2020  tasks'`` for.   
-000323c0: 2020 2020 2020 2020 2064 6973 7472 6962           distrib
-000323d0: 7574 6564 206f 7065 7261 7469 6f6e 2e20  uted operation. 
-000323e0: 2057 696c 6c20 6265 2069 6e66 6572 7265   Will be inferre
-000323f0: 6420 6279 2079 6f75 7220 6375 7272 656e  d by your curren
-00032400: 7420 7363 6865 6475 6c65 722e 0a20 2020  t scheduler..   
-00032410: 2020 2020 2062 726f 6164 6361 7374 3a20       broadcast: 
-00032420: 626f 6f6c 6561 6e20 6f72 2066 6c6f 6174  boolean or float
-00032430: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00032440: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
-00032450: 6f20 7573 6520 6120 6272 6f61 6463 6173  o use a broadcas
-00032460: 742d 6261 7365 6420 6a6f 696e 2069 6e20  t-based join in 
-00032470: 6c69 6575 206f 6620 6120 7368 7566 666c  lieu of a shuffl
-00032480: 652d 6261 7365 640a 2020 2020 2020 2020  e-based.        
-00032490: 2020 2020 6a6f 696e 2066 6f72 2073 7570      join for sup
-000324a0: 706f 7274 6564 2063 6173 6573 2e20 2042  ported cases.  B
-000324b0: 7920 6465 6661 756c 742c 2061 2073 696d  y default, a sim
-000324c0: 706c 6520 6865 7572 6973 7469 6320 7769  ple heuristic wi
-000324d0: 6c6c 2062 650a 2020 2020 2020 2020 2020  ll be.          
-000324e0: 2020 7573 6564 2074 6f20 7365 6c65 6374    used to select
-000324f0: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00032500: 616c 676f 7269 7468 6d2e 2049 6620 6120  algorithm. If a 
-00032510: 666c 6f61 7469 6e67 2d70 6f69 6e74 2076  floating-point v
-00032520: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-00032530: 2069 7320 7370 6563 6966 6965 642c 2074   is specified, t
-00032540: 6861 7420 6e75 6d62 6572 2077 696c 6c20  hat number will 
-00032550: 6265 2075 7365 6420 6173 2074 6865 2060  be used as the `
-00032560: 6062 726f 6164 6361 7374 5f62 6961 7360  `broadcast_bias`
-00032570: 600a 2020 2020 2020 2020 2020 2020 7769  `.            wi
-00032580: 7468 696e 2074 6865 2073 696d 706c 6520  thin the simple 
-00032590: 6865 7572 6973 7469 6320 2861 206c 6172  heuristic (a lar
-000325a0: 6765 206e 756d 6265 7220 6d61 6b65 7320  ge number makes 
-000325b0: 4461 736b 206d 6f72 6520 6c69 6b65 6c79  Dask more likely
-000325c0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-000325d0: 6368 6f6f 7365 2074 6865 2060 6062 726f  choose the ``bro
-000325e0: 6163 6173 745f 6a6f 696e 6060 2063 6f64  acast_join`` cod
-000325f0: 6520 7061 7468 292e 2053 6565 2060 6062  e path). See ``b
-00032600: 726f 6164 6361 7374 5f6a 6f69 6e60 600a  roadcast_join``.
-00032610: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00032620: 6d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  more information
-00032630: 2e0a 0a20 2020 2020 2020 204e 6f74 6573  ...        Notes
-00032640: 0a20 2020 2020 2020 202d 2d2d 2d2d 0a0a  .        -----..
-00032650: 2020 2020 2020 2020 5468 6572 6520 6172          There ar
-00032660: 6520 7468 7265 6520 7761 7973 2074 6f20  e three ways to 
-00032670: 6a6f 696e 2064 6174 6166 7261 6d65 733a  join dataframes:
-00032680: 0a0a 2020 2020 2020 2020 312e 204a 6f69  ..        1. Joi
-00032690: 6e69 6e67 206f 6e20 696e 6469 6365 732e  ning on indices.
-000326a0: 2049 6e20 7468 6973 2063 6173 6520 7468   In this case th
-000326b0: 6520 6469 7669 7369 6f6e 7320 6172 650a  e divisions are.
-000326c0: 2020 2020 2020 2020 2020 2061 6c69 676e             align
-000326d0: 6564 2075 7369 6e67 2074 6865 2066 756e  ed using the fun
-000326e0: 6374 696f 6e20 6060 6461 736b 2e64 6174  ction ``dask.dat
-000326f0: 6166 7261 6d65 2e6d 756c 7469 2e61 6c69  aframe.multi.ali
-00032700: 676e 5f70 6172 7469 7469 6f6e 7360 602e  gn_partitions``.
-00032710: 0a20 2020 2020 2020 2020 2020 4166 7465  .           Afte
-00032720: 7277 6172 6473 2c20 6561 6368 2070 6172  rwards, each par
-00032730: 7469 7469 6f6e 2069 7320 6d65 7267 6564  tition is merged
-00032740: 2077 6974 6820 7468 6520 7061 6e64 6173   with the pandas
-00032750: 206d 6572 6765 2066 756e 6374 696f 6e2e   merge function.
-00032760: 0a0a 2020 2020 2020 2020 322e 204a 6f69  ..        2. Joi
-00032770: 6e69 6e67 206f 6e65 206f 6e20 696e 6465  ning one on inde
-00032780: 7820 616e 6420 6f6e 6520 6f6e 2063 6f6c  x and one on col
-00032790: 756d 6e2e 2049 6e20 7468 6973 2063 6173  umn. In this cas
-000327a0: 6520 7468 6520 6469 7669 7369 6f6e 7320  e the divisions 
-000327b0: 6f66 0a20 2020 2020 2020 2020 2020 6461  of.           da
-000327c0: 7461 6672 616d 6520 6d65 7267 6564 2062  taframe merged b
-000327d0: 7920 696e 6465 7820 283a 6d61 7468 3a60  y index (:math:`
-000327e0: 645f 6960 2920 6172 6520 7573 6564 2074  d_i`) are used t
-000327f0: 6f20 6469 7669 6465 2074 6865 2063 6f6c  o divide the col
-00032800: 756d 6e0a 2020 2020 2020 2020 2020 206d  umn.           m
-00032810: 6572 6765 6420 6461 7461 6672 616d 6520  erged dataframe 
-00032820: 283a 6d61 7468 3a60 645f 6360 2920 6f6e  (:math:`d_c`) on
-00032830: 6520 7573 696e 670a 2020 2020 2020 2020  e using.        
-00032840: 2020 2060 6064 6173 6b2e 6461 7461 6672     ``dask.datafr
-00032850: 616d 652e 6d75 6c74 692e 7265 6172 7261  ame.multi.rearra
-00032860: 6e67 655f 6279 5f64 6976 6973 696f 6e73  nge_by_divisions
-00032870: 6060 2e20 496e 2074 6869 7320 6361 7365  ``. In this case
-00032880: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00032890: 6d65 7267 6564 2064 6174 6166 7261 6d65  merged dataframe
-000328a0: 2028 3a6d 6174 683a 6064 5f6d 6029 2068   (:math:`d_m`) h
-000328b0: 6173 2074 6865 2065 7861 6374 2073 616d  as the exact sam
-000328c0: 6520 6469 7669 7369 6f6e 730a 2020 2020  e divisions.    
-000328d0: 2020 2020 2020 2061 7320 283a 6d61 7468         as (:math
-000328e0: 3a60 645f 6960 292e 2054 6869 7320 6361  :`d_i`). This ca
-000328f0: 6e20 6c65 6164 2074 6f20 6973 7375 6573  n lead to issues
-00032900: 2069 6620 796f 7520 6d65 7267 6520 6d75   if you merge mu
-00032910: 6c74 6970 6c65 2072 6f77 7320 6672 6f6d  ltiple rows from
-00032920: 0a20 2020 2020 2020 2020 2020 283a 6d61  .           (:ma
-00032930: 7468 3a60 645f 6360 2920 746f 206f 6e65  th:`d_c`) to one
-00032940: 2072 6f77 2069 6e20 283a 6d61 7468 3a60   row in (:math:`
-00032950: 645f 6960 292e 0a0a 2020 2020 2020 2020  d_i`)...        
-00032960: 332e 204a 6f69 6e69 6e67 2062 6f74 6820  3. Joining both 
-00032970: 6f6e 2063 6f6c 756d 6e73 2e20 496e 2074  on columns. In t
-00032980: 6869 7320 6361 7365 2061 2068 6173 6820  his case a hash 
-00032990: 6a6f 696e 2069 7320 7065 7266 6f72 6d65  join is performe
-000329a0: 6420 7573 696e 670a 2020 2020 2020 2020  d using.        
-000329b0: 2020 2060 6064 6173 6b2e 6461 7461 6672     ``dask.datafr
-000329c0: 616d 652e 6d75 6c74 692e 6861 7368 5f6a  ame.multi.hash_j
-000329d0: 6f69 6e60 602e 0a0a 2020 2020 2020 2020  oin``...        
-000329e0: 496e 2073 6f6d 6520 6361 7365 732c 2079  In some cases, y
-000329f0: 6f75 206d 6179 2073 6565 2061 2060 604d  ou may see a ``M
-00032a00: 656d 6f72 7945 7272 6f72 6060 2069 6620  emoryError`` if 
-00032a10: 7468 6520 6060 6d65 7267 6560 6020 6f70  the ``merge`` op
-00032a20: 6572 6174 696f 6e20 7265 7175 6972 6573  eration requires
-00032a30: 0a20 2020 2020 2020 2061 6e20 696e 7465  .        an inte
-00032a40: 726e 616c 2060 6073 6875 6666 6c65 6060  rnal ``shuffle``
-00032a50: 2c20 6265 6361 7573 6520 7368 7566 666c  , because shuffl
-00032a60: 696e 6720 706c 6163 6573 2061 6c6c 2072  ing places all r
-00032a70: 6f77 7320 7468 6174 2068 6176 6520 7468  ows that have th
-00032a80: 6520 7361 6d65 0a20 2020 2020 2020 2069  e same.        i
-00032a90: 6e64 6578 2069 6e20 7468 6520 7361 6d65  ndex in the same
-00032aa0: 2070 6172 7469 7469 6f6e 2e20 546f 2061   partition. To a
-00032ab0: 766f 6964 2074 6869 7320 6572 726f 722c  void this error,
-00032ac0: 206d 616b 6520 7375 7265 2061 6c6c 2072   make sure all r
-00032ad0: 6f77 7320 7769 7468 2074 6865 0a20 2020  ows with the.   
-00032ae0: 2020 2020 2073 616d 6520 6060 6f6e 6060       same ``on``
-00032af0: 2d63 6f6c 756d 6e20 7661 6c75 6520 6361  -column value ca
-00032b00: 6e20 6669 7420 6f6e 2061 2073 696e 676c  n fit on a singl
-00032b10: 6520 7061 7274 6974 696f 6e2e 0a20 2020  e partition..   
-00032b20: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00032b30: 2020 6966 206e 6f74 2069 735f 6461 7461    if not is_data
-00032b40: 6672 616d 655f 6c69 6b65 2872 6967 6874  frame_like(right
-00032b50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00032b60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00032b70: 2272 6967 6874 206d 7573 7420 6265 2044  "right must be D
-00032b80: 6174 6146 7261 6d65 2229 0a0a 2020 2020  ataFrame")..    
-00032b90: 2020 2020 6672 6f6d 2064 6173 6b2e 6461      from dask.da
-00032ba0: 7461 6672 616d 652e 6d75 6c74 6920 696d  taframe.multi im
-00032bb0: 706f 7274 206d 6572 6765 0a0a 2020 2020  port merge..    
-00032bc0: 2020 2020 7265 7475 726e 206d 6572 6765      return merge
-00032bd0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00032be0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00032bf0: 7269 6768 742c 0a20 2020 2020 2020 2020  right,.         
-00032c00: 2020 2068 6f77 3d68 6f77 2c0a 2020 2020     how=how,.    
-00032c10: 2020 2020 2020 2020 6f6e 3d6f 6e2c 0a20          on=on,. 
-00032c20: 2020 2020 2020 2020 2020 206c 6566 745f             left_
-00032c30: 6f6e 3d6c 6566 745f 6f6e 2c0a 2020 2020  on=left_on,.    
-00032c40: 2020 2020 2020 2020 7269 6768 745f 6f6e          right_on
-00032c50: 3d72 6967 6874 5f6f 6e2c 0a20 2020 2020  =right_on,.     
-00032c60: 2020 2020 2020 206c 6566 745f 696e 6465         left_inde
-00032c70: 783d 6c65 6674 5f69 6e64 6578 2c0a 2020  x=left_index,.  
-00032c80: 2020 2020 2020 2020 2020 7269 6768 745f            right_
-00032c90: 696e 6465 783d 7269 6768 745f 696e 6465  index=right_inde
-00032ca0: 782c 0a20 2020 2020 2020 2020 2020 2073  x,.            s
-00032cb0: 7566 6669 7865 733d 7375 6666 6978 6573  uffixes=suffixes
-00032cc0: 2c0a 2020 2020 2020 2020 2020 2020 6e70  ,.            np
-00032cd0: 6172 7469 7469 6f6e 733d 6e70 6172 7469  artitions=nparti
-00032ce0: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
-00032cf0: 2020 2069 6e64 6963 6174 6f72 3d69 6e64     indicator=ind
-00032d00: 6963 6174 6f72 2c0a 2020 2020 2020 2020  icator,.        
-00032d10: 2020 2020 7368 7566 666c 653d 7368 7566      shuffle=shuf
-00032d20: 666c 652c 0a20 2020 2020 2020 2020 2020  fle,.           
-00032d30: 2062 726f 6164 6361 7374 3d62 726f 6164   broadcast=broad
-00032d40: 6361 7374 2c0a 2020 2020 2020 2020 290a  cast,.        ).
-00032d50: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
-00032d60: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
-00032d70: 0a20 2020 2064 6566 206a 6f69 6e28 0a20  .    def join(. 
-00032d80: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00032d90: 2020 2020 206f 7468 6572 2c0a 2020 2020       other,.    
-00032da0: 2020 2020 6f6e 3d4e 6f6e 652c 0a20 2020      on=None,.   
-00032db0: 2020 2020 2068 6f77 3d22 6c65 6674 222c       how="left",
-00032dc0: 0a20 2020 2020 2020 206c 7375 6666 6978  .        lsuffix
-00032dd0: 3d22 222c 0a20 2020 2020 2020 2072 7375  ="",.        rsu
-00032de0: 6666 6978 3d22 222c 0a20 2020 2020 2020  ffix="",.       
-00032df0: 206e 7061 7274 6974 696f 6e73 3d4e 6f6e   npartitions=Non
-00032e00: 652c 0a20 2020 2020 2020 2073 6875 6666  e,.        shuff
-00032e10: 6c65 3d4e 6f6e 652c 0a20 2020 2029 3a0a  le=None,.    ):.
-00032e20: 2020 2020 2020 2020 6966 2069 735f 7365          if is_se
-00032e30: 7269 6573 5f6c 696b 6528 6f74 6865 7229  ries_like(other)
-00032e40: 2061 6e64 2068 6173 6174 7472 286f 7468   and hasattr(oth
-00032e50: 6572 2c20 226e 616d 6522 293a 0a20 2020  er, "name"):.   
-00032e60: 2020 2020 2020 2020 206f 7468 6572 203d           other =
-00032e70: 206f 7468 6572 2e74 6f5f 6672 616d 6528   other.to_frame(
-00032e80: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00032e90: 7420 6973 5f64 6174 6166 7261 6d65 5f6c  t is_dataframe_l
-00032ea0: 696b 6528 6f74 6865 7229 3a0a 2020 2020  ike(other):.    
-00032eb0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00032ec0: 7369 6e73 7461 6e63 6528 6f74 6865 722c  sinstance(other,
-00032ed0: 206c 6973 7429 206f 7220 6e6f 7420 616c   list) or not al
-00032ee0: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
-00032ef0: 2020 205b 6973 5f64 6174 6166 7261 6d65     [is_dataframe
-00032f00: 5f6c 696b 6528 6f29 2066 6f72 206f 2069  _like(o) for o i
-00032f10: 6e20 6f74 6865 725d 0a20 2020 2020 2020  n other].       
-00032f20: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00032f30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00032f40: 6c75 6545 7272 6f72 2822 6f74 6865 7220  lueError("other 
-00032f50: 6d75 7374 2062 6520 4461 7461 4672 616d  must be DataFram
-00032f60: 6520 6f72 206c 6973 7420 6f66 2044 6174  e or list of Dat
-00032f70: 6146 7261 6d65 7322 290a 2020 2020 2020  aFrames").      
-00032f80: 2020 2020 2020 6966 2068 6f77 206e 6f74        if how not
-00032f90: 2069 6e20 5b22 6f75 7465 7222 2c20 226c   in ["outer", "l
-00032fa0: 6566 7422 5d3a 0a20 2020 2020 2020 2020  eft"]:.         
-00032fb0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00032fc0: 7565 4572 726f 7228 226d 6572 6765 5f6d  ueError("merge_m
-00032fd0: 756c 7469 206f 6e6c 7920 7375 7070 6f72  ulti only suppor
-00032fe0: 7473 206c 6566 7420 6f72 206f 7574 6572  ts left or outer
-00032ff0: 206a 6f69 6e73 2229 0a0a 2020 2020 2020   joins")..      
-00033000: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00033010: 6461 7461 6672 616d 652e 6d75 6c74 6920  dataframe.multi 
-00033020: 696d 706f 7274 205f 7265 6375 7273 6976  import _recursiv
-00033030: 655f 7061 6972 7769 7365 5f6f 7574 6572  e_pairwise_outer
-00033040: 5f6a 6f69 6e0a 0a20 2020 2020 2020 2020  _join..         
-00033050: 2020 2023 2049 6620 6974 7320 616e 206f     # If its an o
-00033060: 7574 6572 206a 6f69 6e20 7765 2063 616e  uter join we can
-00033070: 2075 7365 2074 6865 2066 756c 6c20 7265   use the full re
-00033080: 6375 7273 6976 6520 7061 6972 7769 7365  cursive pairwise
-00033090: 206a 6f69 6e2e 0a20 2020 2020 2020 2020   join..         
-000330a0: 2020 2069 6620 686f 7720 3d3d 2022 6f75     if how == "ou
-000330b0: 7465 7222 3a0a 2020 2020 2020 2020 2020  ter":.          
-000330c0: 2020 2020 2020 6675 6c6c 203d 205b 7365        full = [se
-000330d0: 6c66 5d20 2b20 6f74 6865 720a 0a20 2020  lf] + other..   
-000330e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000330f0: 7572 6e20 5f72 6563 7572 7369 7665 5f70  urn _recursive_p
-00033100: 6169 7277 6973 655f 6f75 7465 725f 6a6f  airwise_outer_jo
-00033110: 696e 280a 2020 2020 2020 2020 2020 2020  in(.            
-00033120: 2020 2020 2020 2020 6675 6c6c 2c0a 2020          full,.  
-00033130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033140: 2020 6f6e 3d6f 6e2c 0a20 2020 2020 2020    on=on,.       
-00033150: 2020 2020 2020 2020 2020 2020 206c 7375               lsu
-00033160: 6666 6978 3d6c 7375 6666 6978 2c0a 2020  ffix=lsuffix,.  
-00033170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033180: 2020 7273 7566 6669 783d 7273 7566 6669    rsuffix=rsuffi
-00033190: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-000331a0: 2020 2020 2020 206e 7061 7274 6974 696f         npartitio
-000331b0: 6e73 3d6e 7061 7274 6974 696f 6e73 2c0a  ns=npartitions,.
-000331c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000331d0: 2020 2020 7368 7566 666c 653d 7368 7566      shuffle=shuf
-000331e0: 666c 652c 0a20 2020 2020 2020 2020 2020  fle,.           
-000331f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00033200: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00033210: 2020 2020 2020 2020 2023 2044 6f20 7265           # Do re
-00033220: 6375 7273 6976 6520 7061 6972 7769 7365  cursive pairwise
-00033230: 206a 6f69 6e20 6f6e 2065 7665 7279 7468   join on everyth
-00033240: 696e 6720 5f65 7863 6570 745f 2074 6865  ing _except_ the
-00033250: 206c 6173 7420 6a6f 696e 0a20 2020 2020   last join.     
-00033260: 2020 2020 2020 2020 2020 2023 2077 6865             # whe
-00033270: 7265 2077 6520 6e65 6564 2074 6f20 646f  re we need to do
-00033280: 2061 206c 6566 7420 6a6f 696e 2e0a 2020   a left join..  
-00033290: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
-000332a0: 6865 7220 3d20 5f72 6563 7572 7369 7665  her = _recursive
-000332b0: 5f70 6169 7277 6973 655f 6f75 7465 725f  _pairwise_outer_
-000332c0: 6a6f 696e 280a 2020 2020 2020 2020 2020  join(.          
-000332d0: 2020 2020 2020 2020 2020 6f74 6865 722c            other,
-000332e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000332f0: 2020 2020 206f 6e3d 6f6e 2c0a 2020 2020       on=on,.    
-00033300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033310: 6c73 7566 6669 783d 6c73 7566 6669 782c  lsuffix=lsuffix,
-00033320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033330: 2020 2020 2072 7375 6666 6978 3d72 7375       rsuffix=rsu
-00033340: 6666 6978 2c0a 2020 2020 2020 2020 2020  ffix,.          
-00033350: 2020 2020 2020 2020 2020 6e70 6172 7469            nparti
-00033360: 7469 6f6e 733d 6e70 6172 7469 7469 6f6e  tions=npartition
-00033370: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00033380: 2020 2020 2020 2073 6875 6666 6c65 3d73         shuffle=s
-00033390: 6875 6666 6c65 2c0a 2020 2020 2020 2020  huffle,.        
-000333a0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000333b0: 2020 2066 726f 6d20 6461 736b 2e64 6174     from dask.dat
-000333c0: 6166 7261 6d65 2e6d 756c 7469 2069 6d70  aframe.multi imp
-000333d0: 6f72 7420 6d65 7267 650a 0a20 2020 2020  ort merge..     
-000333e0: 2020 2072 6574 7572 6e20 6d65 7267 6528     return merge(
-000333f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00033400: 662c 0a20 2020 2020 2020 2020 2020 206f  f,.            o
-00033410: 7468 6572 2c0a 2020 2020 2020 2020 2020  ther,.          
-00033420: 2020 686f 773d 686f 772c 0a20 2020 2020    how=how,.     
-00033430: 2020 2020 2020 206c 6566 745f 696e 6465         left_inde
-00033440: 783d 6f6e 2069 7320 4e6f 6e65 2c0a 2020  x=on is None,.  
-00033450: 2020 2020 2020 2020 2020 7269 6768 745f            right_
-00033460: 696e 6465 783d 5472 7565 2c0a 2020 2020  index=True,.    
-00033470: 2020 2020 2020 2020 6c65 6674 5f6f 6e3d          left_on=
-00033480: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00033490: 7375 6666 6978 6573 3d28 6c73 7566 6669  suffixes=(lsuffi
-000334a0: 782c 2072 7375 6666 6978 292c 0a20 2020  x, rsuffix),.   
-000334b0: 2020 2020 2020 2020 206e 7061 7274 6974           npartit
-000334c0: 696f 6e73 3d6e 7061 7274 6974 696f 6e73  ions=npartitions
-000334d0: 2c0a 2020 2020 2020 2020 2020 2020 7368  ,.            sh
-000334e0: 7566 666c 653d 7368 7566 666c 652c 0a20  uffle=shuffle,. 
-000334f0: 2020 2020 2020 2029 0a0a 2020 2020 6966         )..    if
-00033500: 206e 6f74 2050 414e 4441 535f 4754 5f32   not PANDAS_GT_2
-00033510: 3030 3a0a 0a20 2020 2020 2020 2040 6465  00:..        @de
-00033520: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-00033530: 7461 4672 616d 6529 0a20 2020 2020 2020  taFrame).       
-00033540: 2064 6566 2061 7070 656e 6428 7365 6c66   def append(self
-00033550: 2c20 6f74 6865 722c 2069 6e74 6572 6c65  , other, interle
-00033560: 6176 655f 7061 7274 6974 696f 6e73 3d46  ave_partitions=F
-00033570: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
-00033580: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00033590: 286f 7468 6572 2c20 5365 7269 6573 293a  (other, Series):
-000335a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000335b0: 206d 7367 203d 2028 0a20 2020 2020 2020   msg = (.       
-000335c0: 2020 2020 2020 2020 2020 2020 2022 556e               "Un
-000335d0: 6162 6c65 2074 6f20 6170 7065 6e64 696e  able to appendin
-000335e0: 6720 6464 2e53 6572 6965 7320 746f 2064  g dd.Series to d
-000335f0: 642e 4461 7461 4672 616d 652e 220a 2020  d.DataFrame.".  
-00033600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033610: 2020 2255 7365 2070 642e 5365 7269 6573    "Use pd.Series
-00033620: 2074 6f20 6170 7065 6e64 2061 7320 726f   to append as ro
-00033630: 772e 220a 2020 2020 2020 2020 2020 2020  w.".            
-00033640: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00033650: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00033660: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-00033670: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
-00033680: 7365 7269 6573 5f6c 696b 6528 6f74 6865  series_like(othe
-00033690: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-000336a0: 2020 2020 6f74 6865 7220 3d20 6f74 6865      other = othe
-000336b0: 722e 746f 5f66 7261 6d65 2829 2e54 0a20  r.to_frame().T. 
-000336c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000336d0: 6e20 7375 7065 7228 292e 6170 7065 6e64  n super().append
-000336e0: 286f 7468 6572 2c20 696e 7465 726c 6561  (other, interlea
-000336f0: 7665 5f70 6172 7469 7469 6f6e 733d 696e  ve_partitions=in
-00033700: 7465 726c 6561 7665 5f70 6172 7469 7469  terleave_partiti
-00033710: 6f6e 7329 0a0a 2020 2020 4064 6572 6976  ons)..    @deriv
-00033720: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
-00033730: 7261 6d65 290a 2020 2020 6465 6620 6974  rame).    def it
-00033740: 6572 726f 7773 2873 656c 6629 3a0a 2020  errows(self):.  
-00033750: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00033760: 616e 6765 2873 656c 662e 6e70 6172 7469  ange(self.nparti
-00033770: 7469 6f6e 7329 3a0a 2020 2020 2020 2020  tions):.        
-00033780: 2020 2020 6466 203d 2073 656c 662e 6765      df = self.ge
-00033790: 745f 7061 7274 6974 696f 6e28 6929 2e63  t_partition(i).c
-000337a0: 6f6d 7075 7465 2829 0a20 2020 2020 2020  ompute().       
-000337b0: 2020 2020 2079 6965 6c64 2066 726f 6d20       yield from 
-000337c0: 6466 2e69 7465 7272 6f77 7328 290a 0a20  df.iterrows().. 
-000337d0: 2020 2040 6465 7269 7665 645f 6672 6f6d     @derived_from
-000337e0: 2870 642e 4461 7461 4672 616d 6529 0a20  (pd.DataFrame). 
-000337f0: 2020 2064 6566 2069 7465 7274 7570 6c65     def itertuple
-00033800: 7328 7365 6c66 2c20 696e 6465 783d 5472  s(self, index=Tr
-00033810: 7565 2c20 6e61 6d65 3d22 5061 6e64 6173  ue, name="Pandas
-00033820: 2229 3a0a 2020 2020 2020 2020 666f 7220  "):.        for 
-00033830: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-00033840: 6e70 6172 7469 7469 6f6e 7329 3a0a 2020  npartitions):.  
-00033850: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-00033860: 656c 662e 6765 745f 7061 7274 6974 696f  elf.get_partitio
-00033870: 6e28 6929 2e63 6f6d 7075 7465 2829 0a20  n(i).compute(). 
-00033880: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-00033890: 2066 726f 6d20 6466 2e69 7465 7274 7570   from df.itertup
-000338a0: 6c65 7328 696e 6465 783d 696e 6465 782c  les(index=index,
-000338b0: 206e 616d 653d 6e61 6d65 290a 0a20 2020   name=name)..   
-000338c0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-000338d0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-000338e0: 2064 6566 2069 7465 6d73 2873 656c 6629   def items(self)
-000338f0: 3a0a 2020 2020 2020 2020 666f 7220 636f  :.        for co
-00033900: 6c5f 6964 782c 206c 6162 656c 2069 6e20  l_idx, label in 
-00033910: 656e 756d 6572 6174 6528 7365 6c66 2e63  enumerate(self.c
-00033920: 6f6c 756d 6e73 293a 0a20 2020 2020 2020  olumns):.       
-00033930: 2020 2020 2079 6965 6c64 206c 6162 656c       yield label
-00033940: 2c20 7365 6c66 2e69 6c6f 635b 3a2c 2063  , self.iloc[:, c
-00033950: 6f6c 5f69 6478 5d0a 0a20 2020 2040 636c  ol_idx]..    @cl
-00033960: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00033970: 6620 5f62 696e 645f 6f70 6572 6174 6f72  f _bind_operator
-00033980: 5f6d 6574 686f 6428 636c 732c 206e 616d  _method(cls, nam
-00033990: 652c 206f 702c 206f 7269 6769 6e61 6c3d  e, op, original=
-000339a0: 7064 2e44 6174 6146 7261 6d65 293a 0a20  pd.DataFrame):. 
-000339b0: 2020 2020 2020 2022 2222 6269 6e64 206f         """bind o
-000339c0: 7065 7261 746f 7220 6d65 7468 6f64 206c  perator method l
-000339d0: 696b 6520 4461 7461 4672 616d 652e 6164  ike DataFrame.ad
-000339e0: 6420 746f 2074 6869 7320 636c 6173 7322  d to this class"
-000339f0: 2222 0a0a 2020 2020 2020 2020 2320 6e61  ""..        # na
-00033a00: 6d65 206d 7573 7420 6265 2065 7870 6c69  me must be expli
-00033a10: 6369 746c 7920 7061 7373 6564 2066 6f72  citly passed for
-00033a20: 2064 6976 206d 6574 686f 6420 7768 6f73   div method whos
-00033a30: 6520 6e61 6d65 2069 7320 7472 7565 6469  e name is truedi
-00033a40: 760a 0a20 2020 2020 2020 2064 6566 206d  v..        def m
-00033a50: 6574 6828 7365 6c66 2c20 6f74 6865 722c  eth(self, other,
-00033a60: 2061 7869 733d 2263 6f6c 756d 6e73 222c   axis="columns",
-00033a70: 206c 6576 656c 3d4e 6f6e 652c 2066 696c   level=None, fil
-00033a80: 6c5f 7661 6c75 653d 4e6f 6e65 293a 0a20  l_value=None):. 
-00033a90: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00033aa0: 7665 6c20 6973 206e 6f74 204e 6f6e 653a  vel is not None:
-00033ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033ac0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-00033ad0: 656e 7465 6445 7272 6f72 2822 6c65 7665  entedError("leve
-00033ae0: 6c20 6d75 7374 2062 6520 4e6f 6e65 2229  l must be None")
-00033af0: 0a0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00033b00: 6973 203d 2073 656c 662e 5f76 616c 6964  is = self._valid
-00033b10: 6174 655f 6178 6973 2861 7869 7329 0a0a  ate_axis(axis)..
-00033b20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00033b30: 7869 7320 696e 2028 312c 2022 636f 6c75  xis in (1, "colu
-00033b40: 6d6e 7322 293a 0a20 2020 2020 2020 2020  mns"):.         
-00033b50: 2020 2020 2020 2023 2057 6865 6e20 6178         # When ax
-00033b60: 6973 3d31 2061 6e64 206f 7468 6572 2069  is=1 and other i
-00033b70: 7320 6120 7365 7269 6573 2c20 606f 7468  s a series, `oth
-00033b80: 6572 6020 6973 2074 7261 6e73 706f 7365  er` is transpose
-00033b90: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00033ba0: 2020 2320 616e 6420 7468 6520 6f70 6572    # and the oper
-00033bb0: 6174 6f72 2069 7320 6170 706c 6965 6420  ator is applied 
-00033bc0: 6272 6f61 6463 6173 7420 6163 726f 7373  broadcast across
-00033bd0: 2072 6f77 732e 2054 6869 730a 2020 2020   rows. This.    
-00033be0: 2020 2020 2020 2020 2020 2020 2320 6973              # is
-00033bf0: 6e27 7420 7375 7070 6f72 7465 6420 7769  n't supported wi
-00033c00: 7468 2064 642e 5365 7269 6573 2e0a 2020  th dd.Series..  
-00033c10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00033c20: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-00033c30: 722c 2053 6572 6965 7329 3a0a 2020 2020  r, Series):.    
-00033c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c50: 6d73 6720 3d20 6622 556e 6162 6c65 2074  msg = f"Unable t
-00033c60: 6f20 7b6e 616d 657d 2064 642e 5365 7269  o {name} dd.Seri
-00033c70: 6573 2077 6974 6820 6178 6973 3d31 220a  es with axis=1".
-00033c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c90: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00033ca0: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
-00033cb0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00033cc0: 735f 7365 7269 6573 5f6c 696b 6528 6f74  s_series_like(ot
-00033cd0: 6865 7229 3a0a 2020 2020 2020 2020 2020  her):.          
-00033ce0: 2020 2020 2020 2020 2020 2320 5370 6563            # Spec
-00033cf0: 6961 6c20 6361 7365 2066 6f72 2070 642e  ial case for pd.
-00033d00: 5365 7269 6573 2074 6f20 6176 6f69 6420  Series to avoid 
-00033d10: 756e 7761 6e74 6564 2070 6172 7469 7469  unwanted partiti
-00033d20: 6f6e 696e 670a 2020 2020 2020 2020 2020  oning.          
-00033d30: 2020 2020 2020 2020 2020 2320 6f66 206f            # of o
-00033d40: 7468 6572 2e20 5765 2070 6173 7320 6974  ther. We pass it
-00033d50: 2069 6e20 6173 2061 206b 7761 7267 2074   in as a kwarg t
-00033d60: 6f20 7072 6576 656e 7420 7468 6973 2e0a  o prevent this..
+0002ff70: 6c65 206e 616d 6520 7573 696e 6720 662d  le name using f-
+0002ff80: 7374 7269 6e67 733a 0a0a 2020 2020 2020  strings:..      
+0002ff90: 2020 3e3e 3e20 7661 6c75 6520 3d20 310a    >>> value = 1.
+0002ffa0: 2020 2020 2020 2020 3e3e 3e20 6464 662e          >>> ddf.
+0002ffb0: 7175 6572 7928 6627 7820 3d3d 207b 7661  query(f'x == {va
+0002ffc0: 6c75 657d 2729 2e63 6f6d 7075 7465 2829  lue}').compute()
+0002ffd0: 0a20 2020 2020 2020 2020 2020 7820 2079  .           x  y
+0002ffe0: 2020 7a20 7a0a 2020 2020 2020 2020 3020    z z.        0 
+0002fff0: 2031 2020 3120 2020 2034 0a20 2020 2020   1  1    4.     
+00030000: 2020 2032 2020 3120 2033 2020 2020 320a     2  1  3    2.
+00030010: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
+00030020: 6f20 7661 7269 6162 6c65 206e 616d 6520  o variable name 
+00030030: 7573 696e 6720 6060 6c6f 6361 6c5f 6469  using ``local_di
+00030040: 6374 6060 3a0a 0a20 2020 2020 2020 203e  ct``:..        >
+00030050: 3e3e 2064 6466 2e71 7565 7279 2827 7820  >> ddf.query('x 
+00030060: 3d3d 2040 7661 6c75 6527 2c20 6c6f 6361  == @value', loca
+00030070: 6c5f 6469 6374 3d7b 2276 616c 7565 223a  l_dict={"value":
+00030080: 2076 616c 7565 7d29 2e63 6f6d 7075 7465   value}).compute
+00030090: 2829 0a20 2020 2020 2020 2020 2020 7820  ().           x 
+000300a0: 2079 2020 7a20 7a0a 2020 2020 2020 2020   y  z z.        
+000300b0: 3020 2031 2020 3120 2020 2034 0a20 2020  0  1  1    4.   
+000300c0: 2020 2020 2032 2020 3120 2033 2020 2020       2  1  3    
+000300d0: 320a 2020 2020 2020 2020 2222 220a 2020  2.        """.  
+000300e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000300f0: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
+00030100: 284d 2e71 7565 7279 2c20 6578 7072 2c20  (M.query, expr, 
+00030110: 2a2a 6b77 6172 6773 290a 0a20 2020 2040  **kwargs)..    @
+00030120: 6465 7269 7665 645f 6672 6f6d 2870 642e  derived_from(pd.
+00030130: 4461 7461 4672 616d 6529 0a20 2020 2064  DataFrame).    d
+00030140: 6566 2065 7661 6c28 7365 6c66 2c20 6578  ef eval(self, ex
+00030150: 7072 2c20 696e 706c 6163 653d 4e6f 6e65  pr, inplace=None
+00030160: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00030170: 2020 2020 2069 6620 696e 706c 6163 6520       if inplace 
+00030180: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00030190: 2020 2020 2069 6e70 6c61 6365 203d 2046       inplace = F
+000301a0: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
+000301b0: 223d 2220 696e 2065 7870 7220 616e 6420  "=" in expr and 
+000301c0: 696e 706c 6163 6520 696e 2028 5472 7565  inplace in (True
+000301d0: 2c20 4e6f 6e65 293a 0a20 2020 2020 2020  , None):.       
+000301e0: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+000301f0: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
+00030200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00030210: 2249 6e70 6c61 6365 2065 7661 6c20 6e6f  "Inplace eval no
+00030220: 7420 7375 7070 6f72 7465 642e 2050 6c65  t supported. Ple
+00030230: 6173 6520 7573 6520 696e 706c 6163 653d  ase use inplace=
+00030240: 4661 6c73 6522 0a20 2020 2020 2020 2020  False".         
+00030250: 2020 2029 0a20 2020 2020 2020 206d 6574     ).        met
+00030260: 6120 3d20 7365 6c66 2e5f 6d65 7461 2e65  a = self._meta.e
+00030270: 7661 6c28 6578 7072 2c20 696e 706c 6163  val(expr, inplac
+00030280: 653d 696e 706c 6163 652c 202a 2a6b 7761  e=inplace, **kwa
+00030290: 7267 7329 0a20 2020 2020 2020 2072 6574  rgs).        ret
+000302a0: 7572 6e20 7365 6c66 2e6d 6170 5f70 6172  urn self.map_par
+000302b0: 7469 7469 6f6e 7328 4d2e 6576 616c 2c20  titions(M.eval, 
+000302c0: 6578 7072 2c20 6d65 7461 3d6d 6574 612c  expr, meta=meta,
+000302d0: 2069 6e70 6c61 6365 3d69 6e70 6c61 6365   inplace=inplace
+000302e0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+000302f0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+00030300: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+00030310: 2064 6566 2064 726f 706e 6128 7365 6c66   def dropna(self
+00030320: 2c20 686f 773d 6e6f 5f64 6566 6175 6c74  , how=no_default
+00030330: 2c20 7375 6273 6574 3d4e 6f6e 652c 2074  , subset=None, t
+00030340: 6872 6573 683d 6e6f 5f64 6566 6175 6c74  hresh=no_default
+00030350: 293a 0a20 2020 2020 2020 2023 2054 6865  ):.        # The
+00030360: 7365 206b 6579 776f 7264 7320 6172 6520  se keywords are 
+00030370: 696e 636f 6d70 6174 6962 6c65 2077 6974  incompatible wit
+00030380: 6820 6561 6368 206f 7468 6572 2e0a 2020  h each other..  
+00030390: 2020 2020 2020 2320 446f 6e27 7420 616c        # Don't al
+000303a0: 6c6f 7720 7468 656d 2062 6f74 6820 746f  low them both to
+000303b0: 2062 6520 7365 742e 0a20 2020 2020 2020   be set..       
+000303c0: 2069 6620 686f 7720 6973 206e 6f74 206e   if how is not n
+000303d0: 6f5f 6465 6661 756c 7420 616e 6420 7468  o_default and th
+000303e0: 7265 7368 2069 7320 6e6f 7420 6e6f 5f64  resh is not no_d
+000303f0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+00030400: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+00030410: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00030420: 2020 2020 2022 596f 7520 6361 6e6e 6f74       "You cannot
+00030430: 2073 6574 2062 6f74 6820 7468 6520 686f   set both the ho
+00030440: 7720 616e 6420 7468 7265 7368 2061 7267  w and thresh arg
+00030450: 756d 656e 7473 2061 7420 7468 6520 7361  uments at the sa
+00030460: 6d65 2074 696d 652e 220a 2020 2020 2020  me time.".      
+00030470: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00030480: 2023 204f 6e6c 7920 7370 6563 6966 7920   # Only specify 
+00030490: 6068 6f77 6020 6f72 2060 7468 7265 7368  `how` or `thresh
+000304a0: 6020 6b65 7977 6f72 6420 6966 2073 7065  ` keyword if spe
+000304b0: 6369 6669 6564 2062 7920 7468 6520 7573  cified by the us
+000304c0: 6572 0a20 2020 2020 2020 2023 2073 6f20  er.        # so 
+000304d0: 7765 2075 7469 6c69 7a65 206f 7468 6572  we utilize other
+000304e0: 2060 6472 6f70 6e61 6020 6b65 7977 6f72   `dropna` keywor
+000304f0: 6420 6465 6661 756c 7473 2061 7070 726f  d defaults appro
+00030500: 7072 6961 7465 6c79 0a20 2020 2020 2020  priately.       
+00030510: 206b 7761 7267 7320 3d20 7b22 7375 6273   kwargs = {"subs
+00030520: 6574 223a 2073 7562 7365 747d 0a20 2020  et": subset}.   
+00030530: 2020 2020 2069 6620 686f 7720 6973 206e       if how is n
+00030540: 6f74 206e 6f5f 6465 6661 756c 743a 0a20  ot no_default:. 
+00030550: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+00030560: 735b 2268 6f77 225d 203d 2068 6f77 0a20  s["how"] = how. 
+00030570: 2020 2020 2020 2065 6c69 6620 7468 7265         elif thre
+00030580: 7368 2069 7320 6e6f 7420 6e6f 5f64 6566  sh is not no_def
+00030590: 6175 6c74 3a0a 2020 2020 2020 2020 2020  ault:.          
+000305a0: 2020 6b77 6172 6773 5b22 7468 7265 7368    kwargs["thresh
+000305b0: 225d 203d 2074 6872 6573 680a 0a20 2020  "] = thresh..   
+000305c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000305d0: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+000305e0: 4d2e 6472 6f70 6e61 2c20 2a2a 6b77 6172  M.dropna, **kwar
+000305f0: 6773 2c20 656e 666f 7263 655f 6d65 7461  gs, enforce_meta
+00030600: 6461 7461 3d46 616c 7365 290a 0a20 2020  data=False)..   
+00030610: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+00030620: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+00030630: 2064 6566 2063 6c69 7028 7365 6c66 2c20   def clip(self, 
+00030640: 6c6f 7765 723d 4e6f 6e65 2c20 7570 7065  lower=None, uppe
+00030650: 723d 4e6f 6e65 2c20 6f75 743d 4e6f 6e65  r=None, out=None
+00030660: 293a 0a20 2020 2020 2020 2069 6620 6f75  ):.        if ou
+00030670: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+00030680: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00030690: 2056 616c 7565 4572 726f 7228 2227 6f75   ValueError("'ou
+000306a0: 7427 206d 7573 7420 6265 204e 6f6e 6522  t' must be None"
+000306b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000306c0: 2073 656c 662e 6d61 705f 7061 7274 6974   self.map_partit
+000306d0: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
+000306e0: 2020 4d2e 636c 6970 2c20 6c6f 7765 723d    M.clip, lower=
+000306f0: 6c6f 7765 722c 2075 7070 6572 3d75 7070  lower, upper=upp
+00030700: 6572 2c20 656e 666f 7263 655f 6d65 7461  er, enforce_meta
+00030710: 6461 7461 3d46 616c 7365 0a20 2020 2020  data=False.     
+00030720: 2020 2029 0a0a 2020 2020 4064 6572 6976     )..    @deriv
+00030730: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
+00030740: 7261 6d65 290a 2020 2020 6465 6620 7371  rame).    def sq
+00030750: 7565 657a 6528 7365 6c66 2c20 6178 6973  ueeze(self, axis
+00030760: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00030770: 6966 2061 7869 7320 696e 205b 4e6f 6e65  if axis in [None
+00030780: 2c20 315d 3a0a 2020 2020 2020 2020 2020  , 1]:.          
+00030790: 2020 6966 206c 656e 2873 656c 662e 636f    if len(self.co
+000307a0: 6c75 6d6e 7329 203d 3d20 313a 0a20 2020  lumns) == 1:.   
+000307b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000307c0: 7572 6e20 7365 6c66 5b73 656c 662e 636f  urn self[self.co
+000307d0: 6c75 6d6e 735b 305d 5d0a 2020 2020 2020  lumns[0]].      
+000307e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000307f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00030800: 726e 2073 656c 660a 0a20 2020 2020 2020  rn self..       
+00030810: 2065 6c69 6620 6178 6973 203d 3d20 303a   elif axis == 0:
+00030820: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00030830: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00030840: 6445 7272 6f72 280a 2020 2020 2020 2020  dError(.        
+00030850: 2020 2020 2020 2020 6622 7b74 7970 6528          f"{type(
+00030860: 7365 6c66 297d 2064 6f65 7320 6e6f 7420  self)} does not 
+00030870: 7375 7070 6f72 7420 7371 7565 657a 6520  support squeeze 
+00030880: 616c 6f6e 6720 6178 6973 2030 220a 2020  along axis 0".  
+00030890: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000308a0: 2020 2020 2065 6c69 6620 6178 6973 206e       elif axis n
+000308b0: 6f74 2069 6e20 5b30 2c20 312c 204e 6f6e  ot in [0, 1, Non
+000308c0: 655d 3a0a 2020 2020 2020 2020 2020 2020  e]:.            
+000308d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000308e0: 2866 224e 6f20 6178 6973 207b 6178 6973  (f"No axis {axis
+000308f0: 7d20 666f 7220 6f62 6a65 6374 2074 7970  } for object typ
+00030900: 6520 7b74 7970 6528 7365 6c66 297d 2229  e {type(self)}")
+00030910: 0a0a 2020 2020 4064 6572 6976 6564 5f66  ..    @derived_f
+00030920: 726f 6d28 7064 2e44 6174 6146 7261 6d65  rom(pd.DataFrame
+00030930: 290a 2020 2020 6465 6620 746f 5f74 696d  ).    def to_tim
+00030940: 6573 7461 6d70 2873 656c 662c 2066 7265  estamp(self, fre
+00030950: 713d 4e6f 6e65 2c20 686f 773d 2273 7461  q=None, how="sta
+00030960: 7274 222c 2061 7869 733d 3029 3a0a 2020  rt", axis=0):.  
+00030970: 2020 2020 2020 6466 203d 2065 6c65 6d77        df = elemw
+00030980: 6973 6528 4d2e 746f 5f74 696d 6573 7461  ise(M.to_timesta
+00030990: 6d70 2c20 7365 6c66 2c20 6672 6571 2c20  mp, self, freq, 
+000309a0: 686f 772c 2061 7869 7329 0a20 2020 2020  how, axis).     
+000309b0: 2020 2064 662e 6469 7669 7369 6f6e 7320     df.divisions 
+000309c0: 3d20 7475 706c 6528 7064 2e49 6e64 6578  = tuple(pd.Index
+000309d0: 2873 656c 662e 6469 7669 7369 6f6e 7329  (self.divisions)
+000309e0: 2e74 6f5f 7469 6d65 7374 616d 7028 686f  .to_timestamp(ho
+000309f0: 773d 686f 772c 2066 7265 713d 6672 6571  w=how, freq=freq
+00030a00: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00030a10: 6e20 6466 0a0a 2020 2020 4064 6572 6976  n df..    @deriv
+00030a20: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
+00030a30: 7261 6d65 290a 2020 2020 6465 6620 6578  rame).    def ex
+00030a40: 706c 6f64 6528 7365 6c66 2c20 636f 6c75  plode(self, colu
+00030a50: 6d6e 293a 0a20 2020 2020 2020 206d 6574  mn):.        met
+00030a60: 6120 3d20 7365 6c66 2e5f 6d65 7461 2e65  a = self._meta.e
+00030a70: 7870 6c6f 6465 2863 6f6c 756d 6e29 0a20  xplode(column). 
+00030a80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00030a90: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
+00030aa0: 7328 4d2e 6578 706c 6f64 652c 2063 6f6c  s(M.explode, col
+00030ab0: 756d 6e2c 206d 6574 613d 6d65 7461 2c20  umn, meta=meta, 
+00030ac0: 656e 666f 7263 655f 6d65 7461 6461 7461  enforce_metadata
+00030ad0: 3d46 616c 7365 290a 0a20 2020 2064 6566  =False)..    def
+00030ae0: 2074 6f5f 6261 6728 7365 6c66 2c20 696e   to_bag(self, in
+00030af0: 6465 783d 4661 6c73 652c 2066 6f72 6d61  dex=False, forma
+00030b00: 743d 2274 7570 6c65 2229 3a0a 2020 2020  t="tuple"):.    
+00030b10: 2020 2020 2222 2243 6f6e 7665 7274 2074      """Convert t
+00030b20: 6f20 6120 6461 736b 2042 6167 206f 6620  o a dask Bag of 
+00030b30: 7475 706c 6573 206f 6620 6561 6368 2072  tuples of each r
+00030b40: 6f77 2e0a 0a20 2020 2020 2020 2050 6172  ow...        Par
+00030b50: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00030b60: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00030b70: 2020 2069 6e64 6578 203a 2062 6f6f 6c2c     index : bool,
+00030b80: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+00030b90: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00030ba0: 6865 2069 6e64 6578 2069 7320 696e 636c  he index is incl
+00030bb0: 7564 6564 2061 7320 7468 6520 6669 7273  uded as the firs
+00030bc0: 7420 656c 656d 656e 7420 6f66 2065 6163  t element of eac
+00030bd0: 6820 7475 706c 652e 0a20 2020 2020 2020  h tuple..       
+00030be0: 2020 2020 2044 6566 6175 6c74 2069 7320       Default is 
+00030bf0: 4661 6c73 652e 0a20 2020 2020 2020 2066  False..        f
+00030c00: 6f72 6d61 7420 3a20 7b22 7475 706c 6522  ormat : {"tuple"
+00030c10: 2c20 2264 6963 7422 2c20 2266 7261 6d65  , "dict", "frame
+00030c20: 227d 2c20 6f70 7469 6f6e 616c 0a20 2020  "}, optional.   
+00030c30: 2020 2020 2020 2020 2057 6865 7468 6572           Whether
+00030c40: 2074 6f20 7265 7475 726e 2061 2062 6167   to return a bag
+00030c50: 206f 6620 7475 706c 6573 2c20 6469 6374   of tuples, dict
+00030c60: 696f 6e61 7269 6573 2c20 6f72 0a20 2020  ionaries, or.   
+00030c70: 2020 2020 2020 2020 2064 6174 6166 7261           datafra
+00030c80: 6d65 2d6c 696b 6520 6f62 6a65 6374 732e  me-like objects.
+00030c90: 2044 6566 6175 6c74 2069 7320 2274 7570   Default is "tup
+00030ca0: 6c65 222e 2049 6620 2266 7261 6d65 222c  le". If "frame",
+00030cb0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00030cc0: 206f 7269 6769 6e61 6c20 7061 7274 6974   original partit
+00030cd0: 696f 6e73 206f 6620 6060 6466 6060 2077  ions of ``df`` w
+00030ce0: 696c 6c20 6e6f 7420 6265 2074 7261 6e73  ill not be trans
+00030cf0: 666f 726d 6564 0a20 2020 2020 2020 2020  formed.         
+00030d00: 2020 2069 6e20 616e 7920 7761 792e 0a20     in any way.. 
+00030d10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00030d20: 2020 2066 726f 6d20 6461 736b 2e64 6174     from dask.dat
+00030d30: 6166 7261 6d65 2e69 6f20 696d 706f 7274  aframe.io import
+00030d40: 2074 6f5f 6261 670a 0a20 2020 2020 2020   to_bag..       
+00030d50: 2072 6574 7572 6e20 746f 5f62 6167 2873   return to_bag(s
+00030d60: 656c 662c 2069 6e64 6578 2c20 666f 726d  elf, index, form
+00030d70: 6174 290a 0a20 2020 2064 6566 2074 6f5f  at)..    def to_
+00030d80: 7061 7271 7565 7428 7365 6c66 2c20 7061  parquet(self, pa
+00030d90: 7468 2c20 2a61 7267 732c 202a 2a6b 7761  th, *args, **kwa
+00030da0: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+00030db0: 2253 6565 2064 642e 746f 5f70 6172 7175  "See dd.to_parqu
+00030dc0: 6574 2064 6f63 7374 7269 6e67 2066 6f72  et docstring for
+00030dd0: 206d 6f72 6520 696e 666f 726d 6174 696f   more informatio
+00030de0: 6e22 2222 0a20 2020 2020 2020 2066 726f  n""".        fro
+00030df0: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+00030e00: 2e69 6f20 696d 706f 7274 2074 6f5f 7061  .io import to_pa
+00030e10: 7271 7565 740a 0a20 2020 2020 2020 2072  rquet..        r
+00030e20: 6574 7572 6e20 746f 5f70 6172 7175 6574  eturn to_parquet
+00030e30: 2873 656c 662c 2070 6174 682c 202a 6172  (self, path, *ar
+00030e40: 6773 2c20 2a2a 6b77 6172 6773 290a 0a20  gs, **kwargs).. 
+00030e50: 2020 2064 6566 2074 6f5f 6f72 6328 7365     def to_orc(se
+00030e60: 6c66 2c20 7061 7468 2c20 2a61 7267 732c  lf, path, *args,
+00030e70: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00030e80: 2020 2020 2222 2253 6565 2064 642e 746f      """See dd.to
+00030e90: 5f6f 7263 2064 6f63 7374 7269 6e67 2066  _orc docstring f
+00030ea0: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
+00030eb0: 696f 6e22 2222 0a20 2020 2020 2020 2066  ion""".        f
+00030ec0: 726f 6d20 6461 736b 2e64 6174 6166 7261  rom dask.datafra
+00030ed0: 6d65 2e69 6f20 696d 706f 7274 2074 6f5f  me.io import to_
+00030ee0: 6f72 630a 0a20 2020 2020 2020 2072 6574  orc..        ret
+00030ef0: 7572 6e20 746f 5f6f 7263 2873 656c 662c  urn to_orc(self,
+00030f00: 2070 6174 682c 202a 6172 6773 2c20 2a2a   path, *args, **
+00030f10: 6b77 6172 6773 290a 0a20 2020 2040 6465  kwargs)..    @de
+00030f20: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+00030f30: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+00030f40: 2074 6f5f 7374 7269 6e67 2873 656c 662c   to_string(self,
+00030f50: 206d 6178 5f72 6f77 733d 3529 3a0a 2020   max_rows=5):.  
+00030f60: 2020 2020 2020 2320 6f70 7469 6f6e 5f63        # option_c
+00030f70: 6f6e 7465 7874 2064 6f65 736e 2774 2061  ontext doesn't a
+00030f80: 6666 6563 740a 2020 2020 2020 2020 7265  ffect.        re
+00030f90: 7475 726e 2073 656c 662e 5f72 6570 725f  turn self._repr_
+00030fa0: 6461 7461 2829 2e74 6f5f 7374 7269 6e67  data().to_string
+00030fb0: 286d 6178 5f72 6f77 733d 6d61 785f 726f  (max_rows=max_ro
+00030fc0: 7773 2c20 7368 6f77 5f64 696d 656e 7369  ws, show_dimensi
+00030fd0: 6f6e 733d 4661 6c73 6529 0a0a 2020 2020  ons=False)..    
+00030fe0: 6465 6620 5f67 6574 5f6e 756d 6572 6963  def _get_numeric
+00030ff0: 5f64 6174 6128 7365 6c66 2c20 686f 773d  _data(self, how=
+00031000: 2261 6e79 222c 2073 7562 7365 743d 4e6f  "any", subset=No
+00031010: 6e65 293a 0a20 2020 2020 2020 2023 2063  ne):.        # c
+00031020: 616c 6375 6c61 7465 2063 6f6c 756d 6e73  alculate columns
+00031030: 2074 6f20 6176 6f69 6420 756e 6e65 6365   to avoid unnece
+00031040: 7373 6172 7920 6361 6c63 756c 6174 696f  ssary calculatio
+00031050: 6e0a 2020 2020 2020 2020 6e75 6d65 7269  n.        numeri
+00031060: 6373 203d 2073 656c 662e 5f6d 6574 612e  cs = self._meta.
+00031070: 5f67 6574 5f6e 756d 6572 6963 5f64 6174  _get_numeric_dat
+00031080: 6128 290a 0a20 2020 2020 2020 2069 6620  a()..        if 
+00031090: 6c65 6e28 6e75 6d65 7269 6373 2e63 6f6c  len(numerics.col
+000310a0: 756d 6e73 2920 3c20 6c65 6e28 7365 6c66  umns) < len(self
+000310b0: 2e63 6f6c 756d 6e73 293a 0a20 2020 2020  .columns):.     
+000310c0: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
+000310d0: 6c66 2e5f 746f 6b65 6e5f 7072 6566 6978  lf._token_prefix
+000310e0: 202b 2022 2d67 6574 5f6e 756d 6572 6963   + "-get_numeric
+000310f0: 5f64 6174 6122 0a20 2020 2020 2020 2020  _data".         
+00031100: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+00031110: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
+00031120: 5f67 6574 5f6e 756d 6572 6963 5f64 6174  _get_numeric_dat
+00031130: 612c 206d 6574 613d 6e75 6d65 7269 6373  a, meta=numerics
+00031140: 2c20 746f 6b65 6e3d 6e61 6d65 290a 2020  , token=name).  
+00031150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00031160: 2020 2020 2020 2020 2320 7573 6520 6d79          # use my
+00031170: 7365 6c66 2069 6620 616c 6c20 6e75 6d65  self if all nume
+00031180: 7269 6373 0a20 2020 2020 2020 2020 2020  rics.           
+00031190: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+000311a0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000311b0: 2020 2064 6566 205f 7661 6c69 6461 7465     def _validate
+000311c0: 5f61 7869 7328 636c 732c 2061 7869 733d  _axis(cls, axis=
+000311d0: 302c 206e 6f6e 655f 6973 5f7a 6572 6f3a  0, none_is_zero:
+000311e0: 2062 6f6f 6c20 3d20 5472 7565 2920 2d3e   bool = True) ->
+000311f0: 204e 6f6e 6520 7c20 4c69 7465 7261 6c5b   None | Literal[
+00031200: 302c 2031 5d3a 0a20 2020 2020 2020 2069  0, 1]:.        i
+00031210: 6620 6178 6973 206e 6f74 2069 6e20 2830  f axis not in (0
+00031220: 2c20 312c 2022 696e 6465 7822 2c20 2263  , 1, "index", "c
+00031230: 6f6c 756d 6e73 222c 204e 6f6e 6529 3a0a  olumns", None):.
+00031240: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00031250: 6520 5661 6c75 6545 7272 6f72 2866 224e  e ValueError(f"N
+00031260: 6f20 6178 6973 206e 616d 6564 207b 6178  o axis named {ax
+00031270: 6973 7d22 290a 2020 2020 2020 2020 2320  is}").        # 
+00031280: 636f 6e76 6572 7420 746f 206e 756d 6572  convert to numer
+00031290: 6963 2061 7869 730a 2020 2020 2020 2020  ic axis.        
+000312a0: 6e75 6d65 7269 635f 6178 6973 3a20 6469  numeric_axis: di
+000312b0: 6374 5b73 7472 207c 204e 6f6e 652c 204c  ct[str | None, L
+000312c0: 6974 6572 616c 5b30 2c20 315d 5d20 3d20  iteral[0, 1]] = 
+000312d0: 7b22 696e 6465 7822 3a20 302c 2022 636f  {"index": 0, "co
+000312e0: 6c75 6d6e 7322 3a20 317d 0a20 2020 2020  lumns": 1}.     
+000312f0: 2020 2069 6620 6e6f 6e65 5f69 735f 7a65     if none_is_ze
+00031300: 726f 3a0a 2020 2020 2020 2020 2020 2020  ro:.            
+00031310: 6e75 6d65 7269 635f 6178 6973 5b4e 6f6e  numeric_axis[Non
+00031320: 655d 203d 2030 0a0a 2020 2020 2020 2020  e] = 0..        
+00031330: 7265 7475 726e 206e 756d 6572 6963 5f61  return numeric_a
+00031340: 7869 732e 6765 7428 6178 6973 2c20 6178  xis.get(axis, ax
+00031350: 6973 290a 0a20 2020 2040 6465 7269 7665  is)..    @derive
+00031360: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
+00031370: 616d 6529 0a20 2020 2064 6566 2064 726f  ame).    def dro
+00031380: 7028 7365 6c66 2c20 6c61 6265 6c73 3d4e  p(self, labels=N
+00031390: 6f6e 652c 2061 7869 733d 302c 2063 6f6c  one, axis=0, col
+000313a0: 756d 6e73 3d4e 6f6e 652c 2065 7272 6f72  umns=None, error
+000313b0: 733d 2272 6169 7365 2229 3a0a 2020 2020  s="raise"):.    
+000313c0: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
+000313d0: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
+000313e0: 7869 7329 0a20 2020 2020 2020 2069 6620  xis).        if 
+000313f0: 6178 6973 203d 3d20 3020 616e 6420 636f  axis == 0 and co
+00031400: 6c75 6d6e 7320 6973 206e 6f74 204e 6f6e  lumns is not Non
+00031410: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00031420: 2043 6f6c 756d 6e73 206d 7573 7420 6265   Columns must be
+00031430: 2073 7065 6369 6669 6564 2069 6620 6178   specified if ax
+00031440: 6973 3d3d 300a 2020 2020 2020 2020 2020  is==0.          
+00031450: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+00031460: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
+00031470: 2020 2020 2020 2020 2020 2020 2020 6472                dr
+00031480: 6f70 5f62 795f 7368 616c 6c6f 775f 636f  op_by_shallow_co
+00031490: 7079 2c20 636f 6c75 6d6e 732c 2065 7272  py, columns, err
+000314a0: 6f72 733d 6572 726f 7273 2c20 656e 666f  ors=errors, enfo
+000314b0: 7263 655f 6d65 7461 6461 7461 3d46 616c  rce_metadata=Fal
+000314c0: 7365 0a20 2020 2020 2020 2020 2020 2029  se.            )
+000314d0: 0a20 2020 2020 2020 2065 6c69 6620 6178  .        elif ax
+000314e0: 6973 203d 3d20 313a 0a20 2020 2020 2020  is == 1:.       
+000314f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00031500: 2e6d 6170 5f70 6172 7469 7469 6f6e 7328  .map_partitions(
+00031510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031520: 2064 726f 705f 6279 5f73 6861 6c6c 6f77   drop_by_shallow
+00031530: 5f63 6f70 792c 206c 6162 656c 732c 2065  _copy, labels, e
+00031540: 7272 6f72 733d 6572 726f 7273 2c20 656e  rrors=errors, en
+00031550: 666f 7263 655f 6d65 7461 6461 7461 3d46  force_metadata=F
+00031560: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00031570: 2029 0a20 2020 2020 2020 2072 6169 7365   ).        raise
+00031580: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+00031590: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000315a0: 2020 2244 726f 7020 6375 7272 656e 746c    "Drop currentl
+000315b0: 7920 6f6e 6c79 2077 6f72 6b73 2066 6f72  y only works for
+000315c0: 2061 7869 733d 3120 6f72 2077 6865 6e20   axis=1 or when 
+000315d0: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
+000315e0: 6f6e 6522 0a20 2020 2020 2020 2029 0a0a  one".        )..
+000315f0: 2020 2020 6465 6620 6d65 7267 6528 0a20      def merge(. 
+00031600: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00031610: 2020 2020 2072 6967 6874 2c0a 2020 2020       right,.    
+00031620: 2020 2020 686f 773d 2269 6e6e 6572 222c      how="inner",
+00031630: 0a20 2020 2020 2020 206f 6e3d 4e6f 6e65  .        on=None
+00031640: 2c0a 2020 2020 2020 2020 6c65 6674 5f6f  ,.        left_o
+00031650: 6e3d 4e6f 6e65 2c0a 2020 2020 2020 2020  n=None,.        
+00031660: 7269 6768 745f 6f6e 3d4e 6f6e 652c 0a20  right_on=None,. 
+00031670: 2020 2020 2020 206c 6566 745f 696e 6465         left_inde
+00031680: 783d 4661 6c73 652c 0a20 2020 2020 2020  x=False,.       
+00031690: 2072 6967 6874 5f69 6e64 6578 3d46 616c   right_index=Fal
+000316a0: 7365 2c0a 2020 2020 2020 2020 7375 6666  se,.        suff
+000316b0: 6978 6573 3d28 225f 7822 2c20 225f 7922  ixes=("_x", "_y"
+000316c0: 292c 0a20 2020 2020 2020 2069 6e64 6963  ),.        indic
+000316d0: 6174 6f72 3d46 616c 7365 2c0a 2020 2020  ator=False,.    
+000316e0: 2020 2020 6e70 6172 7469 7469 6f6e 733d      npartitions=
+000316f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7368  None,.        sh
+00031700: 7566 666c 653d 4e6f 6e65 2c0a 2020 2020  uffle=None,.    
+00031710: 2020 2020 6272 6f61 6463 6173 743d 4e6f      broadcast=No
+00031720: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+00031730: 2020 2022 2222 4d65 7267 6520 7468 6520     """Merge the 
+00031740: 4461 7461 4672 616d 6520 7769 7468 2061  DataFrame with a
+00031750: 6e6f 7468 6572 2044 6174 6146 7261 6d65  nother DataFrame
+00031760: 0a0a 2020 2020 2020 2020 5468 6973 2077  ..        This w
+00031770: 696c 6c20 6d65 7267 6520 7468 6520 7477  ill merge the tw
+00031780: 6f20 6461 7461 7365 7473 2c20 6569 7468  o datasets, eith
+00031790: 6572 206f 6e20 7468 6520 696e 6469 6365  er on the indice
+000317a0: 732c 2061 2063 6572 7461 696e 2063 6f6c  s, a certain col
+000317b0: 756d 6e0a 2020 2020 2020 2020 696e 2065  umn.        in e
+000317c0: 6163 6820 6461 7461 7365 7420 6f72 2074  ach dataset or t
+000317d0: 6865 2069 6e64 6578 2069 6e20 6f6e 6520  he index in one 
+000317e0: 6461 7461 7365 7420 616e 6420 7468 6520  dataset and the 
+000317f0: 636f 6c75 6d6e 2069 6e20 616e 6f74 6865  column in anothe
+00031800: 722e 0a0a 2020 2020 2020 2020 5061 7261  r...        Para
+00031810: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+00031820: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00031830: 2020 7269 6768 743a 2064 6173 6b2e 6461    right: dask.da
+00031840: 7461 6672 616d 652e 4461 7461 4672 616d  taframe.DataFram
+00031850: 650a 2020 2020 2020 2020 686f 7720 3a20  e.        how : 
+00031860: 7b27 6c65 6674 272c 2027 7269 6768 7427  {'left', 'right'
+00031870: 2c20 276f 7574 6572 272c 2027 696e 6e65  , 'outer', 'inne
+00031880: 7227 7d2c 2064 6566 6175 6c74 3a20 2769  r'}, default: 'i
+00031890: 6e6e 6572 270a 2020 2020 2020 2020 2020  nner'.          
+000318a0: 2020 486f 7720 746f 2068 616e 646c 6520    How to handle 
+000318b0: 7468 6520 6f70 6572 6174 696f 6e20 6f66  the operation of
+000318c0: 2074 6865 2074 776f 206f 626a 6563 7473   the two objects
+000318d0: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
+000318e0: 206c 6566 743a 2075 7365 2063 616c 6c69   left: use calli
+000318f0: 6e67 2066 7261 6d65 2773 2069 6e64 6578  ng frame's index
+00031900: 2028 6f72 2063 6f6c 756d 6e20 6966 206f   (or column if o
+00031910: 6e20 6973 2073 7065 6369 6669 6564 290a  n is specified).
+00031920: 2020 2020 2020 2020 2020 2020 2d20 7269              - ri
+00031930: 6768 743a 2075 7365 206f 7468 6572 2066  ght: use other f
+00031940: 7261 6d65 2773 2069 6e64 6578 0a20 2020  rame's index.   
+00031950: 2020 2020 2020 2020 202d 206f 7574 6572           - outer
+00031960: 3a20 666f 726d 2075 6e69 6f6e 206f 6620  : form union of 
+00031970: 6361 6c6c 696e 6720 6672 616d 6527 7320  calling frame's 
+00031980: 696e 6465 7820 286f 7220 636f 6c75 6d6e  index (or column
+00031990: 2069 6620 6f6e 2069 730a 2020 2020 2020   if on is.      
+000319a0: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
+000319b0: 6429 2077 6974 6820 6f74 6865 7220 6672  d) with other fr
+000319c0: 616d 6527 7320 696e 6465 782c 2061 6e64  ame's index, and
+000319d0: 2073 6f72 7420 6974 0a20 2020 2020 2020   sort it.       
+000319e0: 2020 2020 2020 206c 6578 6963 6f67 7261         lexicogra
+000319f0: 7068 6963 616c 6c79 0a20 2020 2020 2020  phically.       
+00031a00: 2020 2020 202d 2069 6e6e 6572 3a20 666f       - inner: fo
+00031a10: 726d 2069 6e74 6572 7365 6374 696f 6e20  rm intersection 
+00031a20: 6f66 2063 616c 6c69 6e67 2066 7261 6d65  of calling frame
+00031a30: 2773 2069 6e64 6578 2028 6f72 2063 6f6c  's index (or col
+00031a40: 756d 6e20 6966 0a20 2020 2020 2020 2020  umn if.         
+00031a50: 2020 2020 206f 6e20 6973 2073 7065 6369       on is speci
+00031a60: 6669 6564 2920 7769 7468 206f 7468 6572  fied) with other
+00031a70: 2066 7261 6d65 2773 2069 6e64 6578 2c20   frame's index, 
+00031a80: 7072 6573 6572 7669 6e67 2074 6865 206f  preserving the o
+00031a90: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
+00031aa0: 2020 206f 6620 7468 6520 6361 6c6c 696e     of the callin
+00031ab0: 6727 7320 6f6e 650a 0a20 2020 2020 2020  g's one..       
+00031ac0: 206f 6e20 3a20 6c61 6265 6c20 6f72 206c   on : label or l
+00031ad0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00031ae0: 436f 6c75 6d6e 206f 7220 696e 6465 7820  Column or index 
+00031af0: 6c65 7665 6c20 6e61 6d65 7320 746f 206a  level names to j
+00031b00: 6f69 6e20 6f6e 2e20 5468 6573 6520 6d75  oin on. These mu
+00031b10: 7374 2062 6520 666f 756e 6420 696e 2062  st be found in b
+00031b20: 6f74 680a 2020 2020 2020 2020 2020 2020  oth.            
+00031b30: 4461 7461 4672 616d 6573 2e20 4966 206f  DataFrames. If o
+00031b40: 6e20 6973 204e 6f6e 6520 616e 6420 6e6f  n is None and no
+00031b50: 7420 6d65 7267 696e 6720 6f6e 2069 6e64  t merging on ind
+00031b60: 6578 6573 2074 6865 6e20 7468 6973 0a20  exes then this. 
+00031b70: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00031b80: 6c74 7320 746f 2074 6865 2069 6e74 6572  lts to the inter
+00031b90: 7365 6374 696f 6e20 6f66 2074 6865 2063  section of the c
+00031ba0: 6f6c 756d 6e73 2069 6e20 626f 7468 2044  olumns in both D
+00031bb0: 6174 6146 7261 6d65 732e 0a20 2020 2020  ataFrames..     
+00031bc0: 2020 206c 6566 745f 6f6e 203a 206c 6162     left_on : lab
+00031bd0: 656c 206f 7220 6c69 7374 2c20 6f72 2061  el or list, or a
+00031be0: 7272 6179 2d6c 696b 650a 2020 2020 2020  rray-like.      
+00031bf0: 2020 2020 2020 436f 6c75 6d6e 2074 6f20        Column to 
+00031c00: 6a6f 696e 206f 6e20 696e 2074 6865 206c  join on in the l
+00031c10: 6566 7420 4461 7461 4672 616d 652e 204f  eft DataFrame. O
+00031c20: 7468 6572 2074 6861 6e20 696e 2070 616e  ther than in pan
+00031c30: 6461 730a 2020 2020 2020 2020 2020 2020  das.            
+00031c40: 6172 7261 7973 2061 6e64 206c 6973 7473  arrays and lists
+00031c50: 2061 7265 206f 6e6c 7920 7375 7070 6f72   are only suppor
+00031c60: 7420 6966 2074 6865 6972 206c 656e 6774  t if their lengt
+00031c70: 6820 6973 2031 2e0a 2020 2020 2020 2020  h is 1..        
+00031c80: 7269 6768 745f 6f6e 203a 206c 6162 656c  right_on : label
+00031c90: 206f 7220 6c69 7374 2c20 6f72 2061 7272   or list, or arr
+00031ca0: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
+00031cb0: 2020 2020 436f 6c75 6d6e 2074 6f20 6a6f      Column to jo
+00031cc0: 696e 206f 6e20 696e 2074 6865 2072 6967  in on in the rig
+00031cd0: 6874 2044 6174 6146 7261 6d65 2e20 4f74  ht DataFrame. Ot
+00031ce0: 6865 7220 7468 616e 2069 6e20 7061 6e64  her than in pand
+00031cf0: 6173 0a20 2020 2020 2020 2020 2020 2061  as.            a
+00031d00: 7272 6179 7320 616e 6420 6c69 7374 7320  rrays and lists 
+00031d10: 6172 6520 6f6e 6c79 2073 7570 706f 7274  are only support
+00031d20: 2069 6620 7468 6569 7220 6c65 6e67 7468   if their length
+00031d30: 2069 7320 312e 0a20 2020 2020 2020 206c   is 1..        l
+00031d40: 6566 745f 696e 6465 7820 3a20 626f 6f6c  eft_index : bool
+00031d50: 6561 6e2c 2064 6566 6175 6c74 2046 616c  ean, default Fal
+00031d60: 7365 0a20 2020 2020 2020 2020 2020 2055  se.            U
+00031d70: 7365 2074 6865 2069 6e64 6578 2066 726f  se the index fro
+00031d80: 6d20 7468 6520 6c65 6674 2044 6174 6146  m the left DataF
+00031d90: 7261 6d65 2061 7320 7468 6520 6a6f 696e  rame as the join
+00031da0: 206b 6579 2e0a 2020 2020 2020 2020 7269   key..        ri
+00031db0: 6768 745f 696e 6465 7820 3a20 626f 6f6c  ght_index : bool
+00031dc0: 6561 6e2c 2064 6566 6175 6c74 2046 616c  ean, default Fal
+00031dd0: 7365 0a20 2020 2020 2020 2020 2020 2055  se.            U
+00031de0: 7365 2074 6865 2069 6e64 6578 2066 726f  se the index fro
+00031df0: 6d20 7468 6520 7269 6768 7420 4461 7461  m the right Data
+00031e00: 4672 616d 6520 6173 2074 6865 206a 6f69  Frame as the joi
+00031e10: 6e20 6b65 792e 0a20 2020 2020 2020 2073  n key..        s
+00031e20: 7566 6669 7865 7320 3a20 322d 6c65 6e67  uffixes : 2-leng
+00031e30: 7468 2073 6571 7565 6e63 6520 2874 7570  th sequence (tup
+00031e40: 6c65 2c20 6c69 7374 2c20 2e2e 2e29 0a20  le, list, ...). 
+00031e50: 2020 2020 2020 2020 2020 2053 7566 6669             Suffi
+00031e60: 7820 746f 2061 7070 6c79 2074 6f20 6f76  x to apply to ov
+00031e70: 6572 6c61 7070 696e 6720 636f 6c75 6d6e  erlapping column
+00031e80: 206e 616d 6573 2069 6e20 7468 6520 6c65   names in the le
+00031e90: 6674 2061 6e64 0a20 2020 2020 2020 2020  ft and.         
+00031ea0: 2020 2072 6967 6874 2073 6964 652c 2072     right side, r
+00031eb0: 6573 7065 6374 6976 656c 790a 2020 2020  espectively.    
+00031ec0: 2020 2020 696e 6469 6361 746f 7220 3a20      indicator : 
+00031ed0: 626f 6f6c 6561 6e20 6f72 2073 7472 696e  boolean or strin
+00031ee0: 672c 2064 6566 6175 6c74 2046 616c 7365  g, default False
+00031ef0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00031f00: 5472 7565 2c20 6164 6473 2061 2063 6f6c  True, adds a col
+00031f10: 756d 6e20 746f 206f 7574 7075 7420 4461  umn to output Da
+00031f20: 7461 4672 616d 6520 6361 6c6c 6564 2022  taFrame called "
+00031f30: 5f6d 6572 6765 2220 7769 7468 0a20 2020  _merge" with.   
+00031f40: 2020 2020 2020 2020 2069 6e66 6f72 6d61           informa
+00031f50: 7469 6f6e 206f 6e20 7468 6520 736f 7572  tion on the sour
+00031f60: 6365 206f 6620 6561 6368 2072 6f77 2e20  ce of each row. 
+00031f70: 4966 2073 7472 696e 672c 2063 6f6c 756d  If string, colum
+00031f80: 6e20 7769 7468 0a20 2020 2020 2020 2020  n with.         
+00031f90: 2020 2069 6e66 6f72 6d61 7469 6f6e 206f     information o
+00031fa0: 6e20 736f 7572 6365 206f 6620 6561 6368  n source of each
+00031fb0: 2072 6f77 2077 696c 6c20 6265 2061 6464   row will be add
+00031fc0: 6564 2074 6f20 6f75 7470 7574 2044 6174  ed to output Dat
+00031fd0: 6146 7261 6d65 2c0a 2020 2020 2020 2020  aFrame,.        
+00031fe0: 2020 2020 616e 6420 636f 6c75 6d6e 2077      and column w
+00031ff0: 696c 6c20 6265 206e 616d 6564 2076 616c  ill be named val
+00032000: 7565 206f 6620 7374 7269 6e67 2e20 496e  ue of string. In
+00032010: 666f 726d 6174 696f 6e20 636f 6c75 6d6e  formation column
+00032020: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
+00032030: 4361 7465 676f 7269 6361 6c2d 7479 7065  Categorical-type
+00032040: 2061 6e64 2074 616b 6573 206f 6e20 6120   and takes on a 
+00032050: 7661 6c75 6520 6f66 2022 6c65 6674 5f6f  value of "left_o
+00032060: 6e6c 7922 2066 6f72 206f 6273 6572 7661  nly" for observa
+00032070: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+00032080: 2020 7768 6f73 6520 6d65 7267 6520 6b65    whose merge ke
+00032090: 7920 6f6e 6c79 2061 7070 6561 7273 2069  y only appears i
+000320a0: 6e20 606c 6566 7460 2044 6174 6146 7261  n `left` DataFra
+000320b0: 6d65 2c20 2272 6967 6874 5f6f 6e6c 7922  me, "right_only"
+000320c0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+000320d0: 206f 6273 6572 7661 7469 6f6e 7320 7768   observations wh
+000320e0: 6f73 6520 6d65 7267 6520 6b65 7920 6f6e  ose merge key on
+000320f0: 6c79 2061 7070 6561 7273 2069 6e20 6072  ly appears in `r
+00032100: 6967 6874 6020 4461 7461 4672 616d 652c  ight` DataFrame,
+00032110: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00032120: 2022 626f 7468 2220 6966 2074 6865 206f   "both" if the o
+00032130: 6273 6572 7661 7469 6f6e e280 9973 206d  bservation...s m
+00032140: 6572 6765 206b 6579 2069 7320 666f 756e  erge key is foun
+00032150: 6420 696e 2062 6f74 682e 0a20 2020 2020  d in both..     
+00032160: 2020 206e 7061 7274 6974 696f 6e73 3a20     npartitions: 
+00032170: 696e 7420 6f72 204e 6f6e 652c 206f 7074  int or None, opt
+00032180: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+00032190: 2020 5468 6520 6964 6561 6c20 6e75 6d62    The ideal numb
+000321a0: 6572 206f 6620 6f75 7470 7574 2070 6172  er of output par
+000321b0: 7469 7469 6f6e 732e 2054 6869 7320 6973  titions. This is
+000321c0: 206f 6e6c 7920 7574 696c 6973 6564 2077   only utilised w
+000321d0: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
+000321e0: 7065 7266 6f72 6d69 6e67 2061 2068 6173  performing a has
+000321f0: 685f 6a6f 696e 2028 6d65 7267 696e 6720  h_join (merging 
+00032200: 6f6e 2063 6f6c 756d 6e73 206f 6e6c 7929  on columns only)
+00032210: 2e20 4966 2060 604e 6f6e 6560 6020 7468  . If ``None`` th
+00032220: 656e 0a20 2020 2020 2020 2020 2020 2060  en.            `
+00032230: 606e 7061 7274 6974 696f 6e73 203d 206d  `npartitions = m
+00032240: 6178 286c 6873 2e6e 7061 7274 6974 696f  ax(lhs.npartitio
+00032250: 6e73 2c20 7268 732e 6e70 6172 7469 7469  ns, rhs.npartiti
+00032260: 6f6e 7329 6060 2e0a 2020 2020 2020 2020  ons)``..        
+00032270: 2020 2020 4465 6661 756c 7420 6973 2060      Default is `
+00032280: 604e 6f6e 6560 602e 0a20 2020 2020 2020  `None``..       
+00032290: 2073 6875 6666 6c65 3a20 7b27 6469 736b   shuffle: {'disk
+000322a0: 272c 2027 7461 736b 7327 7d2c 206f 7074  ', 'tasks'}, opt
+000322b0: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
+000322c0: 2020 4569 7468 6572 2060 6027 6469 736b    Either ``'disk
+000322d0: 2760 6020 666f 7220 7369 6e67 6c65 2d6e  '`` for single-n
+000322e0: 6f64 6520 6f70 6572 6174 696f 6e20 6f72  ode operation or
+000322f0: 2060 6027 7461 736b 7327 6060 2066 6f72   ``'tasks'`` for
+00032300: 0a20 2020 2020 2020 2020 2020 2064 6973  .            dis
+00032310: 7472 6962 7574 6564 206f 7065 7261 7469  tributed operati
+00032320: 6f6e 2e20 2057 696c 6c20 6265 2069 6e66  on.  Will be inf
+00032330: 6572 7265 6420 6279 2079 6f75 7220 6375  erred by your cu
+00032340: 7272 656e 7420 7363 6865 6475 6c65 722e  rrent scheduler.
+00032350: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
+00032360: 7374 3a20 626f 6f6c 6561 6e20 6f72 2066  st: boolean or f
+00032370: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0a20  loat, optional. 
+00032380: 2020 2020 2020 2020 2020 2057 6865 7468             Wheth
+00032390: 6572 2074 6f20 7573 6520 6120 6272 6f61  er to use a broa
+000323a0: 6463 6173 742d 6261 7365 6420 6a6f 696e  dcast-based join
+000323b0: 2069 6e20 6c69 6575 206f 6620 6120 7368   in lieu of a sh
+000323c0: 7566 666c 652d 6261 7365 640a 2020 2020  uffle-based.    
+000323d0: 2020 2020 2020 2020 6a6f 696e 2066 6f72          join for
+000323e0: 2073 7570 706f 7274 6564 2063 6173 6573   supported cases
+000323f0: 2e20 2042 7920 6465 6661 756c 742c 2061  .  By default, a
+00032400: 2073 696d 706c 6520 6865 7572 6973 7469   simple heuristi
+00032410: 6320 7769 6c6c 2062 650a 2020 2020 2020  c will be.      
+00032420: 2020 2020 2020 7573 6564 2074 6f20 7365        used to se
+00032430: 6c65 6374 2074 6865 2075 6e64 6572 6c79  lect the underly
+00032440: 696e 6720 616c 676f 7269 7468 6d2e 2049  ing algorithm. I
+00032450: 6620 6120 666c 6f61 7469 6e67 2d70 6f69  f a floating-poi
+00032460: 6e74 2076 616c 7565 0a20 2020 2020 2020  nt value.       
+00032470: 2020 2020 2069 7320 7370 6563 6966 6965       is specifie
+00032480: 642c 2074 6861 7420 6e75 6d62 6572 2077  d, that number w
+00032490: 696c 6c20 6265 2075 7365 6420 6173 2074  ill be used as t
+000324a0: 6865 2060 6062 726f 6164 6361 7374 5f62  he ``broadcast_b
+000324b0: 6961 7360 600a 2020 2020 2020 2020 2020  ias``.          
+000324c0: 2020 7769 7468 696e 2074 6865 2073 696d    within the sim
+000324d0: 706c 6520 6865 7572 6973 7469 6320 2861  ple heuristic (a
+000324e0: 206c 6172 6765 206e 756d 6265 7220 6d61   large number ma
+000324f0: 6b65 7320 4461 736b 206d 6f72 6520 6c69  kes Dask more li
+00032500: 6b65 6c79 0a20 2020 2020 2020 2020 2020  kely.           
+00032510: 2074 6f20 6368 6f6f 7365 2074 6865 2060   to choose the `
+00032520: 6062 726f 6163 6173 745f 6a6f 696e 6060  `broacast_join``
+00032530: 2063 6f64 6520 7061 7468 292e 2053 6565   code path). See
+00032540: 2060 6062 726f 6164 6361 7374 5f6a 6f69   ``broadcast_joi
+00032550: 6e60 600a 2020 2020 2020 2020 2020 2020  n``.            
+00032560: 666f 7220 6d6f 7265 2069 6e66 6f72 6d61  for more informa
+00032570: 7469 6f6e 2e0a 0a20 2020 2020 2020 204e  tion...        N
+00032580: 6f74 6573 0a20 2020 2020 2020 202d 2d2d  otes.        ---
+00032590: 2d2d 0a0a 2020 2020 2020 2020 5468 6572  --..        Ther
+000325a0: 6520 6172 6520 7468 7265 6520 7761 7973  e are three ways
+000325b0: 2074 6f20 6a6f 696e 2064 6174 6166 7261   to join datafra
+000325c0: 6d65 733a 0a0a 2020 2020 2020 2020 312e  mes:..        1.
+000325d0: 204a 6f69 6e69 6e67 206f 6e20 696e 6469   Joining on indi
+000325e0: 6365 732e 2049 6e20 7468 6973 2063 6173  ces. In this cas
+000325f0: 6520 7468 6520 6469 7669 7369 6f6e 7320  e the divisions 
+00032600: 6172 650a 2020 2020 2020 2020 2020 2061  are.           a
+00032610: 6c69 676e 6564 2075 7369 6e67 2074 6865  ligned using the
+00032620: 2066 756e 6374 696f 6e20 6060 6461 736b   function ``dask
+00032630: 2e64 6174 6166 7261 6d65 2e6d 756c 7469  .dataframe.multi
+00032640: 2e61 6c69 676e 5f70 6172 7469 7469 6f6e  .align_partition
+00032650: 7360 602e 0a20 2020 2020 2020 2020 2020  s``..           
+00032660: 4166 7465 7277 6172 6473 2c20 6561 6368  Afterwards, each
+00032670: 2070 6172 7469 7469 6f6e 2069 7320 6d65   partition is me
+00032680: 7267 6564 2077 6974 6820 7468 6520 7061  rged with the pa
+00032690: 6e64 6173 206d 6572 6765 2066 756e 6374  ndas merge funct
+000326a0: 696f 6e2e 0a0a 2020 2020 2020 2020 322e  ion...        2.
+000326b0: 204a 6f69 6e69 6e67 206f 6e65 206f 6e20   Joining one on 
+000326c0: 696e 6465 7820 616e 6420 6f6e 6520 6f6e  index and one on
+000326d0: 2063 6f6c 756d 6e2e 2049 6e20 7468 6973   column. In this
+000326e0: 2063 6173 6520 7468 6520 6469 7669 7369   case the divisi
+000326f0: 6f6e 7320 6f66 0a20 2020 2020 2020 2020  ons of.         
+00032700: 2020 6461 7461 6672 616d 6520 6d65 7267    dataframe merg
+00032710: 6564 2062 7920 696e 6465 7820 283a 6d61  ed by index (:ma
+00032720: 7468 3a60 645f 6960 2920 6172 6520 7573  th:`d_i`) are us
+00032730: 6564 2074 6f20 6469 7669 6465 2074 6865  ed to divide the
+00032740: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
+00032750: 2020 206d 6572 6765 6420 6461 7461 6672     merged datafr
+00032760: 616d 6520 283a 6d61 7468 3a60 645f 6360  ame (:math:`d_c`
+00032770: 2920 6f6e 6520 7573 696e 670a 2020 2020  ) one using.    
+00032780: 2020 2020 2020 2060 6064 6173 6b2e 6461         ``dask.da
+00032790: 7461 6672 616d 652e 6d75 6c74 692e 7265  taframe.multi.re
+000327a0: 6172 7261 6e67 655f 6279 5f64 6976 6973  arrange_by_divis
+000327b0: 696f 6e73 6060 2e20 496e 2074 6869 7320  ions``. In this 
+000327c0: 6361 7365 2074 6865 0a20 2020 2020 2020  case the.       
+000327d0: 2020 2020 6d65 7267 6564 2064 6174 6166      merged dataf
+000327e0: 7261 6d65 2028 3a6d 6174 683a 6064 5f6d  rame (:math:`d_m
+000327f0: 6029 2068 6173 2074 6865 2065 7861 6374  `) has the exact
+00032800: 2073 616d 6520 6469 7669 7369 6f6e 730a   same divisions.
+00032810: 2020 2020 2020 2020 2020 2061 7320 283a             as (:
+00032820: 6d61 7468 3a60 645f 6960 292e 2054 6869  math:`d_i`). Thi
+00032830: 7320 6361 6e20 6c65 6164 2074 6f20 6973  s can lead to is
+00032840: 7375 6573 2069 6620 796f 7520 6d65 7267  sues if you merg
+00032850: 6520 6d75 6c74 6970 6c65 2072 6f77 7320  e multiple rows 
+00032860: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
+00032870: 283a 6d61 7468 3a60 645f 6360 2920 746f  (:math:`d_c`) to
+00032880: 206f 6e65 2072 6f77 2069 6e20 283a 6d61   one row in (:ma
+00032890: 7468 3a60 645f 6960 292e 0a0a 2020 2020  th:`d_i`)...    
+000328a0: 2020 2020 332e 204a 6f69 6e69 6e67 2062      3. Joining b
+000328b0: 6f74 6820 6f6e 2063 6f6c 756d 6e73 2e20  oth on columns. 
+000328c0: 496e 2074 6869 7320 6361 7365 2061 2068  In this case a h
+000328d0: 6173 6820 6a6f 696e 2069 7320 7065 7266  ash join is perf
+000328e0: 6f72 6d65 6420 7573 696e 670a 2020 2020  ormed using.    
+000328f0: 2020 2020 2020 2060 6064 6173 6b2e 6461         ``dask.da
+00032900: 7461 6672 616d 652e 6d75 6c74 692e 6861  taframe.multi.ha
+00032910: 7368 5f6a 6f69 6e60 602e 0a0a 2020 2020  sh_join``...    
+00032920: 2020 2020 496e 2073 6f6d 6520 6361 7365      In some case
+00032930: 732c 2079 6f75 206d 6179 2073 6565 2061  s, you may see a
+00032940: 2060 604d 656d 6f72 7945 7272 6f72 6060   ``MemoryError``
+00032950: 2069 6620 7468 6520 6060 6d65 7267 6560   if the ``merge`
+00032960: 6020 6f70 6572 6174 696f 6e20 7265 7175  ` operation requ
+00032970: 6972 6573 0a20 2020 2020 2020 2061 6e20  ires.        an 
+00032980: 696e 7465 726e 616c 2060 6073 6875 6666  internal ``shuff
+00032990: 6c65 6060 2c20 6265 6361 7573 6520 7368  le``, because sh
+000329a0: 7566 666c 696e 6720 706c 6163 6573 2061  uffling places a
+000329b0: 6c6c 2072 6f77 7320 7468 6174 2068 6176  ll rows that hav
+000329c0: 6520 7468 6520 7361 6d65 0a20 2020 2020  e the same.     
+000329d0: 2020 2069 6e64 6578 2069 6e20 7468 6520     index in the 
+000329e0: 7361 6d65 2070 6172 7469 7469 6f6e 2e20  same partition. 
+000329f0: 546f 2061 766f 6964 2074 6869 7320 6572  To avoid this er
+00032a00: 726f 722c 206d 616b 6520 7375 7265 2061  ror, make sure a
+00032a10: 6c6c 2072 6f77 7320 7769 7468 2074 6865  ll rows with the
+00032a20: 0a20 2020 2020 2020 2073 616d 6520 6060  .        same ``
+00032a30: 6f6e 6060 2d63 6f6c 756d 6e20 7661 6c75  on``-column valu
+00032a40: 6520 6361 6e20 6669 7420 6f6e 2061 2073  e can fit on a s
+00032a50: 696e 676c 6520 7061 7274 6974 696f 6e2e  ingle partition.
+00032a60: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00032a70: 2020 2020 2020 6966 206e 6f74 2069 735f        if not is_
+00032a80: 6461 7461 6672 616d 655f 6c69 6b65 2872  dataframe_like(r
+00032a90: 6967 6874 293a 0a20 2020 2020 2020 2020  ight):.         
+00032aa0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00032ab0: 726f 7228 2272 6967 6874 206d 7573 7420  ror("right must 
+00032ac0: 6265 2044 6174 6146 7261 6d65 2229 0a0a  be DataFrame")..
+00032ad0: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00032ae0: 6b2e 6461 7461 6672 616d 652e 6d75 6c74  k.dataframe.mult
+00032af0: 6920 696d 706f 7274 206d 6572 6765 0a0a  i import merge..
+00032b00: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00032b10: 6572 6765 280a 2020 2020 2020 2020 2020  erge(.          
+00032b20: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00032b30: 2020 2020 7269 6768 742c 0a20 2020 2020      right,.     
+00032b40: 2020 2020 2020 2068 6f77 3d68 6f77 2c0a         how=how,.
+00032b50: 2020 2020 2020 2020 2020 2020 6f6e 3d6f              on=o
+00032b60: 6e2c 0a20 2020 2020 2020 2020 2020 206c  n,.            l
+00032b70: 6566 745f 6f6e 3d6c 6566 745f 6f6e 2c0a  eft_on=left_on,.
+00032b80: 2020 2020 2020 2020 2020 2020 7269 6768              righ
+00032b90: 745f 6f6e 3d72 6967 6874 5f6f 6e2c 0a20  t_on=right_on,. 
+00032ba0: 2020 2020 2020 2020 2020 206c 6566 745f             left_
+00032bb0: 696e 6465 783d 6c65 6674 5f69 6e64 6578  index=left_index
+00032bc0: 2c0a 2020 2020 2020 2020 2020 2020 7269  ,.            ri
+00032bd0: 6768 745f 696e 6465 783d 7269 6768 745f  ght_index=right_
+00032be0: 696e 6465 782c 0a20 2020 2020 2020 2020  index,.         
+00032bf0: 2020 2073 7566 6669 7865 733d 7375 6666     suffixes=suff
+00032c00: 6978 6573 2c0a 2020 2020 2020 2020 2020  ixes,.          
+00032c10: 2020 6e70 6172 7469 7469 6f6e 733d 6e70    npartitions=np
+00032c20: 6172 7469 7469 6f6e 732c 0a20 2020 2020  artitions,.     
+00032c30: 2020 2020 2020 2069 6e64 6963 6174 6f72         indicator
+00032c40: 3d69 6e64 6963 6174 6f72 2c0a 2020 2020  =indicator,.    
+00032c50: 2020 2020 2020 2020 7368 7566 666c 653d          shuffle=
+00032c60: 7368 7566 666c 652c 0a20 2020 2020 2020  shuffle,.       
+00032c70: 2020 2020 2062 726f 6164 6361 7374 3d62       broadcast=b
+00032c80: 726f 6164 6361 7374 2c0a 2020 2020 2020  roadcast,.      
+00032c90: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
+00032ca0: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
+00032cb0: 616d 6529 0a20 2020 2064 6566 206a 6f69  ame).    def joi
+00032cc0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+00032cd0: 0a20 2020 2020 2020 206f 7468 6572 2c0a  .        other,.
+00032ce0: 2020 2020 2020 2020 6f6e 3d4e 6f6e 652c          on=None,
+00032cf0: 0a20 2020 2020 2020 2068 6f77 3d22 6c65  .        how="le
+00032d00: 6674 222c 0a20 2020 2020 2020 206c 7375  ft",.        lsu
+00032d10: 6666 6978 3d22 222c 0a20 2020 2020 2020  ffix="",.       
+00032d20: 2072 7375 6666 6978 3d22 222c 0a20 2020   rsuffix="",.   
+00032d30: 2020 2020 206e 7061 7274 6974 696f 6e73       npartitions
+00032d40: 3d4e 6f6e 652c 0a20 2020 2020 2020 2073  =None,.        s
+00032d50: 6875 6666 6c65 3d4e 6f6e 652c 0a20 2020  huffle=None,.   
+00032d60: 2029 3a0a 2020 2020 2020 2020 6966 2069   ):.        if i
+00032d70: 735f 7365 7269 6573 5f6c 696b 6528 6f74  s_series_like(ot
+00032d80: 6865 7229 2061 6e64 2068 6173 6174 7472  her) and hasattr
+00032d90: 286f 7468 6572 2c20 226e 616d 6522 293a  (other, "name"):
+00032da0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00032db0: 6572 203d 206f 7468 6572 2e74 6f5f 6672  er = other.to_fr
+00032dc0: 616d 6528 290a 0a20 2020 2020 2020 2069  ame()..        i
+00032dd0: 6620 6e6f 7420 6973 5f64 6174 6166 7261  f not is_datafra
+00032de0: 6d65 5f6c 696b 6528 6f74 6865 7229 3a0a  me_like(other):.
+00032df0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00032e00: 6f74 2069 7369 6e73 7461 6e63 6528 6f74  ot isinstance(ot
+00032e10: 6865 722c 206c 6973 7429 206f 7220 6e6f  her, list) or no
+00032e20: 7420 616c 6c28 0a20 2020 2020 2020 2020  t all(.         
+00032e30: 2020 2020 2020 205b 6973 5f64 6174 6166         [is_dataf
+00032e40: 7261 6d65 5f6c 696b 6528 6f29 2066 6f72  rame_like(o) for
+00032e50: 206f 2069 6e20 6f74 6865 725d 0a20 2020   o in other].   
+00032e60: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00032e70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00032e80: 6520 5661 6c75 6545 7272 6f72 2822 6f74  e ValueError("ot
+00032e90: 6865 7220 6d75 7374 2062 6520 4461 7461  her must be Data
+00032ea0: 4672 616d 6520 6f72 206c 6973 7420 6f66  Frame or list of
+00032eb0: 2044 6174 6146 7261 6d65 7322 290a 2020   DataFrames").  
+00032ec0: 2020 2020 2020 2020 2020 6966 2068 6f77            if how
+00032ed0: 206e 6f74 2069 6e20 5b22 6f75 7465 7222   not in ["outer"
+00032ee0: 2c20 226c 6566 7422 5d3a 0a20 2020 2020  , "left"]:.     
+00032ef0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00032f00: 2056 616c 7565 4572 726f 7228 226d 6572   ValueError("mer
+00032f10: 6765 5f6d 756c 7469 206f 6e6c 7920 7375  ge_multi only su
+00032f20: 7070 6f72 7473 206c 6566 7420 6f72 206f  pports left or o
+00032f30: 7574 6572 206a 6f69 6e73 2229 0a0a 2020  uter joins")..  
+00032f40: 2020 2020 2020 2020 2020 6672 6f6d 2064            from d
+00032f50: 6173 6b2e 6461 7461 6672 616d 652e 6d75  ask.dataframe.mu
+00032f60: 6c74 6920 696d 706f 7274 205f 7265 6375  lti import _recu
+00032f70: 7273 6976 655f 7061 6972 7769 7365 5f6f  rsive_pairwise_o
+00032f80: 7574 6572 5f6a 6f69 6e0a 0a20 2020 2020  uter_join..     
+00032f90: 2020 2020 2020 2023 2049 6620 6974 7320         # If its 
+00032fa0: 616e 206f 7574 6572 206a 6f69 6e20 7765  an outer join we
+00032fb0: 2063 616e 2075 7365 2074 6865 2066 756c   can use the ful
+00032fc0: 6c20 7265 6375 7273 6976 6520 7061 6972  l recursive pair
+00032fd0: 7769 7365 206a 6f69 6e2e 0a20 2020 2020  wise join..     
+00032fe0: 2020 2020 2020 2069 6620 686f 7720 3d3d         if how ==
+00032ff0: 2022 6f75 7465 7222 3a0a 2020 2020 2020   "outer":.      
+00033000: 2020 2020 2020 2020 2020 6675 6c6c 203d            full =
+00033010: 205b 7365 6c66 5d20 2b20 6f74 6865 720a   [self] + other.
+00033020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033030: 2072 6574 7572 6e20 5f72 6563 7572 7369   return _recursi
+00033040: 7665 5f70 6169 7277 6973 655f 6f75 7465  ve_pairwise_oute
+00033050: 725f 6a6f 696e 280a 2020 2020 2020 2020  r_join(.        
+00033060: 2020 2020 2020 2020 2020 2020 6675 6c6c              full
+00033070: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00033080: 2020 2020 2020 6f6e 3d6f 6e2c 0a20 2020        on=on,.   
+00033090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000330a0: 206c 7375 6666 6978 3d6c 7375 6666 6978   lsuffix=lsuffix
+000330b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000330c0: 2020 2020 2020 7273 7566 6669 783d 7273        rsuffix=rs
+000330d0: 7566 6669 782c 0a20 2020 2020 2020 2020  uffix,.         
+000330e0: 2020 2020 2020 2020 2020 206e 7061 7274             npart
+000330f0: 6974 696f 6e73 3d6e 7061 7274 6974 696f  itions=npartitio
+00033100: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+00033110: 2020 2020 2020 2020 7368 7566 666c 653d          shuffle=
+00033120: 7368 7566 666c 652c 0a20 2020 2020 2020  shuffle,.       
+00033130: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00033140: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00033150: 2020 2020 2020 2020 2020 2020 2023 2044               # D
+00033160: 6f20 7265 6375 7273 6976 6520 7061 6972  o recursive pair
+00033170: 7769 7365 206a 6f69 6e20 6f6e 2065 7665  wise join on eve
+00033180: 7279 7468 696e 6720 5f65 7863 6570 745f  rything _except_
+00033190: 2074 6865 206c 6173 7420 6a6f 696e 0a20   the last join. 
+000331a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000331b0: 2077 6865 7265 2077 6520 6e65 6564 2074   where we need t
+000331c0: 6f20 646f 2061 206c 6566 7420 6a6f 696e  o do a left join
+000331d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000331e0: 2020 6f74 6865 7220 3d20 5f72 6563 7572    other = _recur
+000331f0: 7369 7665 5f70 6169 7277 6973 655f 6f75  sive_pairwise_ou
+00033200: 7465 725f 6a6f 696e 280a 2020 2020 2020  ter_join(.      
+00033210: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+00033220: 6865 722c 0a20 2020 2020 2020 2020 2020  her,.           
+00033230: 2020 2020 2020 2020 206f 6e3d 6f6e 2c0a           on=on,.
+00033240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033250: 2020 2020 6c73 7566 6669 783d 6c73 7566      lsuffix=lsuf
+00033260: 6669 782c 0a20 2020 2020 2020 2020 2020  fix,.           
+00033270: 2020 2020 2020 2020 2072 7375 6666 6978           rsuffix
+00033280: 3d72 7375 6666 6978 2c0a 2020 2020 2020  =rsuffix,.      
+00033290: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+000332a0: 6172 7469 7469 6f6e 733d 6e70 6172 7469  artitions=nparti
+000332b0: 7469 6f6e 732c 0a20 2020 2020 2020 2020  tions,.         
+000332c0: 2020 2020 2020 2020 2020 2073 6875 6666             shuff
+000332d0: 6c65 3d73 6875 6666 6c65 2c0a 2020 2020  le=shuffle,.    
+000332e0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000332f0: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+00033300: 2e64 6174 6166 7261 6d65 2e6d 756c 7469  .dataframe.multi
+00033310: 2069 6d70 6f72 7420 6d65 7267 650a 0a20   import merge.. 
+00033320: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
+00033330: 7267 6528 0a20 2020 2020 2020 2020 2020  rge(.           
+00033340: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
+00033350: 2020 206f 7468 6572 2c0a 2020 2020 2020     other,.      
+00033360: 2020 2020 2020 686f 773d 686f 772c 0a20        how=how,. 
+00033370: 2020 2020 2020 2020 2020 206c 6566 745f             left_
+00033380: 696e 6465 783d 6f6e 2069 7320 4e6f 6e65  index=on is None
+00033390: 2c0a 2020 2020 2020 2020 2020 2020 7269  ,.            ri
+000333a0: 6768 745f 696e 6465 783d 5472 7565 2c0a  ght_index=True,.
+000333b0: 2020 2020 2020 2020 2020 2020 6c65 6674              left
+000333c0: 5f6f 6e3d 6f6e 2c0a 2020 2020 2020 2020  _on=on,.        
+000333d0: 2020 2020 7375 6666 6978 6573 3d28 6c73      suffixes=(ls
+000333e0: 7566 6669 782c 2072 7375 6666 6978 292c  uffix, rsuffix),
+000333f0: 0a20 2020 2020 2020 2020 2020 206e 7061  .            npa
+00033400: 7274 6974 696f 6e73 3d6e 7061 7274 6974  rtitions=npartit
+00033410: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
+00033420: 2020 7368 7566 666c 653d 7368 7566 666c    shuffle=shuffl
+00033430: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
+00033440: 2020 6966 206e 6f74 2050 414e 4441 535f    if not PANDAS_
+00033450: 4754 5f32 3030 3a0a 0a20 2020 2020 2020  GT_200:..       
+00033460: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+00033470: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+00033480: 2020 2020 2064 6566 2061 7070 656e 6428       def append(
+00033490: 7365 6c66 2c20 6f74 6865 722c 2069 6e74  self, other, int
+000334a0: 6572 6c65 6176 655f 7061 7274 6974 696f  erleave_partitio
+000334b0: 6e73 3d46 616c 7365 293a 0a20 2020 2020  ns=False):.     
+000334c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000334d0: 616e 6365 286f 7468 6572 2c20 5365 7269  ance(other, Seri
+000334e0: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+000334f0: 2020 2020 206d 7367 203d 2028 0a20 2020       msg = (.   
+00033500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033510: 2022 556e 6162 6c65 2074 6f20 6170 7065   "Unable to appe
+00033520: 6e64 696e 6720 6464 2e53 6572 6965 7320  nding dd.Series 
+00033530: 746f 2064 642e 4461 7461 4672 616d 652e  to dd.DataFrame.
+00033540: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00033550: 2020 2020 2020 2255 7365 2070 642e 5365        "Use pd.Se
+00033560: 7269 6573 2074 6f20 6170 7065 6e64 2061  ries to append a
+00033570: 7320 726f 772e 220a 2020 2020 2020 2020  s row.".        
+00033580: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00033590: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000335a0: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+000335b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000335c0: 2069 735f 7365 7269 6573 5f6c 696b 6528   is_series_like(
+000335d0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+000335e0: 2020 2020 2020 2020 6f74 6865 7220 3d20          other = 
+000335f0: 6f74 6865 722e 746f 5f66 7261 6d65 2829  other.to_frame()
+00033600: 2e54 0a20 2020 2020 2020 2020 2020 2072  .T.            r
+00033610: 6574 7572 6e20 7375 7065 7228 292e 6170  eturn super().ap
+00033620: 7065 6e64 286f 7468 6572 2c20 696e 7465  pend(other, inte
+00033630: 726c 6561 7665 5f70 6172 7469 7469 6f6e  rleave_partition
+00033640: 733d 696e 7465 726c 6561 7665 5f70 6172  s=interleave_par
+00033650: 7469 7469 6f6e 7329 0a0a 2020 2020 4064  titions)..    @d
+00033660: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+00033670: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+00033680: 6620 6974 6572 726f 7773 2873 656c 6629  f iterrows(self)
+00033690: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
+000336a0: 696e 2072 616e 6765 2873 656c 662e 6e70  in range(self.np
+000336b0: 6172 7469 7469 6f6e 7329 3a0a 2020 2020  artitions):.    
+000336c0: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
+000336d0: 662e 6765 745f 7061 7274 6974 696f 6e28  f.get_partition(
+000336e0: 6929 2e63 6f6d 7075 7465 2829 0a20 2020  i).compute().   
+000336f0: 2020 2020 2020 2020 2079 6965 6c64 2066           yield f
+00033700: 726f 6d20 6466 2e69 7465 7272 6f77 7328  rom df.iterrows(
+00033710: 290a 0a20 2020 2040 6465 7269 7665 645f  )..    @derived_
+00033720: 6672 6f6d 2870 642e 4461 7461 4672 616d  from(pd.DataFram
+00033730: 6529 0a20 2020 2064 6566 2069 7465 7274  e).    def itert
+00033740: 7570 6c65 7328 7365 6c66 2c20 696e 6465  uples(self, inde
+00033750: 783d 5472 7565 2c20 6e61 6d65 3d22 5061  x=True, name="Pa
+00033760: 6e64 6173 2229 3a0a 2020 2020 2020 2020  ndas"):.        
+00033770: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+00033780: 656c 662e 6e70 6172 7469 7469 6f6e 7329  elf.npartitions)
+00033790: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
+000337a0: 203d 2073 656c 662e 6765 745f 7061 7274   = self.get_part
+000337b0: 6974 696f 6e28 6929 2e63 6f6d 7075 7465  ition(i).compute
+000337c0: 2829 0a20 2020 2020 2020 2020 2020 2079  ().            y
+000337d0: 6965 6c64 2066 726f 6d20 6466 2e69 7465  ield from df.ite
+000337e0: 7274 7570 6c65 7328 696e 6465 783d 696e  rtuples(index=in
+000337f0: 6465 782c 206e 616d 653d 6e61 6d65 290a  dex, name=name).
+00033800: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+00033810: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
+00033820: 0a20 2020 2064 6566 2069 7465 6d73 2873  .    def items(s
+00033830: 656c 6629 3a0a 2020 2020 2020 2020 666f  elf):.        fo
+00033840: 7220 636f 6c5f 6964 782c 206c 6162 656c  r col_idx, label
+00033850: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+00033860: 6c66 2e63 6f6c 756d 6e73 293a 0a20 2020  lf.columns):.   
+00033870: 2020 2020 2020 2020 2079 6965 6c64 206c           yield l
+00033880: 6162 656c 2c20 7365 6c66 2e69 6c6f 635b  abel, self.iloc[
+00033890: 3a2c 2063 6f6c 5f69 6478 5d0a 0a20 2020  :, col_idx]..   
+000338a0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+000338b0: 2020 6465 6620 5f62 696e 645f 6f70 6572    def _bind_oper
+000338c0: 6174 6f72 5f6d 6574 686f 6428 636c 732c  ator_method(cls,
+000338d0: 206e 616d 652c 206f 702c 206f 7269 6769   name, op, origi
+000338e0: 6e61 6c3d 7064 2e44 6174 6146 7261 6d65  nal=pd.DataFrame
+000338f0: 293a 0a20 2020 2020 2020 2022 2222 6269  ):.        """bi
+00033900: 6e64 206f 7065 7261 746f 7220 6d65 7468  nd operator meth
+00033910: 6f64 206c 696b 6520 4461 7461 4672 616d  od like DataFram
+00033920: 652e 6164 6420 746f 2074 6869 7320 636c  e.add to this cl
+00033930: 6173 7322 2222 0a0a 2020 2020 2020 2020  ass"""..        
+00033940: 2320 6e61 6d65 206d 7573 7420 6265 2065  # name must be e
+00033950: 7870 6c69 6369 746c 7920 7061 7373 6564  xplicitly passed
+00033960: 2066 6f72 2064 6976 206d 6574 686f 6420   for div method 
+00033970: 7768 6f73 6520 6e61 6d65 2069 7320 7472  whose name is tr
+00033980: 7565 6469 760a 0a20 2020 2020 2020 2064  uediv..        d
+00033990: 6566 206d 6574 6828 7365 6c66 2c20 6f74  ef meth(self, ot
+000339a0: 6865 722c 2061 7869 733d 2263 6f6c 756d  her, axis="colum
+000339b0: 6e73 222c 206c 6576 656c 3d4e 6f6e 652c  ns", level=None,
+000339c0: 2066 696c 6c5f 7661 6c75 653d 4e6f 6e65   fill_value=None
+000339d0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000339e0: 6620 6c65 7665 6c20 6973 206e 6f74 204e  f level is not N
+000339f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00033a00: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+00033a10: 706c 656d 656e 7465 6445 7272 6f72 2822  plementedError("
+00033a20: 6c65 7665 6c20 6d75 7374 2062 6520 4e6f  level must be No
+00033a30: 6e65 2229 0a0a 2020 2020 2020 2020 2020  ne")..          
+00033a40: 2020 6178 6973 203d 2073 656c 662e 5f76    axis = self._v
+00033a50: 616c 6964 6174 655f 6178 6973 2861 7869  alidate_axis(axi
+00033a60: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00033a70: 6966 2061 7869 7320 696e 2028 312c 2022  if axis in (1, "
+00033a80: 636f 6c75 6d6e 7322 293a 0a20 2020 2020  columns"):.     
+00033a90: 2020 2020 2020 2020 2020 2023 2057 6865             # Whe
+00033aa0: 6e20 6178 6973 3d31 2061 6e64 206f 7468  n axis=1 and oth
+00033ab0: 6572 2069 7320 6120 7365 7269 6573 2c20  er is a series, 
+00033ac0: 606f 7468 6572 6020 6973 2074 7261 6e73  `other` is trans
+00033ad0: 706f 7365 640a 2020 2020 2020 2020 2020  posed.          
+00033ae0: 2020 2020 2020 2320 616e 6420 7468 6520        # and the 
+00033af0: 6f70 6572 6174 6f72 2069 7320 6170 706c  operator is appl
+00033b00: 6965 6420 6272 6f61 6463 6173 7420 6163  ied broadcast ac
+00033b10: 726f 7373 2072 6f77 732e 2054 6869 730a  ross rows. This.
+00033b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033b30: 2320 6973 6e27 7420 7375 7070 6f72 7465  # isn't supporte
+00033b40: 6420 7769 7468 2064 642e 5365 7269 6573  d with dd.Series
+00033b50: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00033b60: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00033b70: 6f74 6865 722c 2053 6572 6965 7329 3a0a  other, Series):.
+00033b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033b90: 2020 2020 6d73 6720 3d20 6622 556e 6162      msg = f"Unab
+00033ba0: 6c65 2074 6f20 7b6e 616d 657d 2064 642e  le to {name} dd.
+00033bb0: 5365 7269 6573 2077 6974 6820 6178 6973  Series with axis
+00033bc0: 3d31 220a 2020 2020 2020 2020 2020 2020  =1".            
+00033bd0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00033be0: 6c75 6545 7272 6f72 286d 7367 290a 2020  lueError(msg).  
+00033bf0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00033c00: 6966 2069 735f 7365 7269 6573 5f6c 696b  if is_series_lik
+00033c10: 6528 6f74 6865 7229 3a0a 2020 2020 2020  e(other):.      
+00033c20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00033c30: 5370 6563 6961 6c20 6361 7365 2066 6f72  Special case for
+00033c40: 2070 642e 5365 7269 6573 2074 6f20 6176   pd.Series to av
+00033c50: 6f69 6420 756e 7761 6e74 6564 2070 6172  oid unwanted par
+00033c60: 7469 7469 6f6e 696e 670a 2020 2020 2020  titioning.      
+00033c70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00033c80: 6f66 206f 7468 6572 2e20 5765 2070 6173  of other. We pas
+00033c90: 7320 6974 2069 6e20 6173 2061 206b 7761  s it in as a kwa
+00033ca0: 7267 2074 6f20 7072 6576 656e 7420 7468  rg to prevent th
+00033cb0: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
+00033cc0: 2020 2020 2020 2020 6d65 7461 203d 205f          meta = _
+00033cd0: 656d 756c 6174 6528 0a20 2020 2020 2020  emulate(.       
+00033ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033cf0: 206f 702c 2073 656c 662c 206f 7468 6572   op, self, other
+00033d00: 3d6f 7468 6572 2c20 6178 6973 3d61 7869  =other, axis=axi
+00033d10: 732c 2066 696c 6c5f 7661 6c75 653d 6669  s, fill_value=fi
+00033d20: 6c6c 5f76 616c 7565 0a20 2020 2020 2020  ll_value.       
+00033d30: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00033d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033d50: 2020 2072 6574 7572 6e20 6d61 705f 7061     return map_pa
+00033d60: 7274 6974 696f 6e73 280a 2020 2020 2020  rtitions(.      
 00033d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033d80: 2020 2020 6d65 7461 203d 205f 656d 756c      meta = _emul
-00033d90: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00033da0: 2020 2020 2020 2020 2020 2020 206f 702c               op,
-00033db0: 2073 656c 662c 206f 7468 6572 3d6f 7468   self, other=oth
-00033dc0: 6572 2c20 6178 6973 3d61 7869 732c 2066  er, axis=axis, f
-00033dd0: 696c 6c5f 7661 6c75 653d 6669 6c6c 5f76  ill_value=fill_v
-00033de0: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-00033df0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00033e00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00033e10: 6574 7572 6e20 6d61 705f 7061 7274 6974  eturn map_partit
-00033e20: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
-00033e30: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-00033e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00033e50: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-00033e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033e70: 2020 2020 2020 2020 6f74 6865 723d 6f74          other=ot
-00033e80: 6865 722c 0a20 2020 2020 2020 2020 2020  her,.           
-00033e90: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00033ea0: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
-00033eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ec0: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
-00033ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033ee0: 2020 2066 696c 6c5f 7661 6c75 653d 6669     fill_value=fi
-00033ef0: 6c6c 5f76 616c 7565 2c0a 2020 2020 2020  ll_value,.      
-00033f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033f10: 2020 656e 666f 7263 655f 6d65 7461 6461    enforce_metada
-00033f20: 7461 3d46 616c 7365 2c0a 2020 2020 2020  ta=False,.      
-00033f30: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00033f40: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-00033f50: 6120 3d20 5f65 6d75 6c61 7465 286f 702c  a = _emulate(op,
-00033f60: 2073 656c 662c 206f 7468 6572 2c20 6178   self, other, ax
-00033f70: 6973 3d61 7869 732c 2066 696c 6c5f 7661  is=axis, fill_va
-00033f80: 6c75 653d 6669 6c6c 5f76 616c 7565 290a  lue=fill_value).
-00033f90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00033fa0: 726e 206d 6170 5f70 6172 7469 7469 6f6e  rn map_partition
-00033fb0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00033fc0: 2020 206f 702c 0a20 2020 2020 2020 2020     op,.         
-00033fd0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00033fe0: 2020 2020 2020 2020 2020 2020 206f 7468               oth
-00033ff0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00034000: 2020 2020 6d65 7461 3d6d 6574 612c 0a20      meta=meta,. 
-00034010: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00034020: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
-00034030: 2020 2020 2020 2020 2020 6669 6c6c 5f76            fill_v
-00034040: 616c 7565 3d66 696c 6c5f 7661 6c75 652c  alue=fill_value,
-00034050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034060: 2065 6e66 6f72 6365 5f6d 6574 6164 6174   enforce_metadat
-00034070: 613d 4661 6c73 652c 0a20 2020 2020 2020  a=False,.       
-00034080: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00034090: 6d65 7468 2e5f 5f6e 616d 655f 5f20 3d20  meth.__name__ = 
-000340a0: 6e61 6d65 0a20 2020 2020 2020 2073 6574  name.        set
-000340b0: 6174 7472 2863 6c73 2c20 6e61 6d65 2c20  attr(cls, name, 
-000340c0: 6465 7269 7665 645f 6672 6f6d 286f 7269  derived_from(ori
-000340d0: 6769 6e61 6c29 286d 6574 6829 290a 0a20  ginal)(meth)).. 
-000340e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000340f0: 2020 2020 6465 6620 5f62 696e 645f 636f      def _bind_co
-00034100: 6d70 6172 6973 6f6e 5f6d 6574 686f 6428  mparison_method(
-00034110: 636c 732c 206e 616d 652c 2063 6f6d 7061  cls, name, compa
-00034120: 7269 736f 6e2c 206f 7269 6769 6e61 6c3d  rison, original=
-00034130: 7064 2e44 6174 6146 7261 6d65 293a 0a20  pd.DataFrame):. 
-00034140: 2020 2020 2020 2022 2222 6269 6e64 2063         """bind c
-00034150: 6f6d 7061 7269 736f 6e20 6d65 7468 6f64  omparison method
-00034160: 206c 696b 6520 4461 7461 4672 616d 652e   like DataFrame.
-00034170: 6571 2074 6f20 7468 6973 2063 6c61 7373  eq to this class
-00034180: 2222 220a 0a20 2020 2020 2020 2064 6566  """..        def
-00034190: 206d 6574 6828 7365 6c66 2c20 6f74 6865   meth(self, othe
-000341a0: 722c 2061 7869 733d 2263 6f6c 756d 6e73  r, axis="columns
-000341b0: 222c 206c 6576 656c 3d4e 6f6e 6529 3a0a  ", level=None):.
-000341c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000341d0: 6576 656c 2069 7320 6e6f 7420 4e6f 6e65  evel is not None
-000341e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000341f0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-00034200: 6d65 6e74 6564 4572 726f 7228 226c 6576  mentedError("lev
-00034210: 656c 206d 7573 7420 6265 204e 6f6e 6522  el must be None"
-00034220: 290a 2020 2020 2020 2020 2020 2020 6178  ).            ax
-00034230: 6973 203d 2073 656c 662e 5f76 616c 6964  is = self._valid
-00034240: 6174 655f 6178 6973 2861 7869 7329 0a20  ate_axis(axis). 
-00034250: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00034260: 6e20 656c 656d 7769 7365 2863 6f6d 7061  n elemwise(compa
-00034270: 7269 736f 6e2c 2073 656c 662c 206f 7468  rison, self, oth
-00034280: 6572 2c20 6178 6973 3d61 7869 7329 0a0a  er, axis=axis)..
-00034290: 2020 2020 2020 2020 6d65 7468 2e5f 5f6e          meth.__n
-000342a0: 616d 655f 5f20 3d20 6e61 6d65 0a20 2020  ame__ = name.   
-000342b0: 2020 2020 2073 6574 6174 7472 2863 6c73       setattr(cls
-000342c0: 2c20 6e61 6d65 2c20 6465 7269 7665 645f  , name, derived_
-000342d0: 6672 6f6d 286f 7269 6769 6e61 6c29 286d  from(original)(m
-000342e0: 6574 6829 290a 0a20 2020 2040 696e 7365  eth))..    @inse
-000342f0: 7274 5f6d 6574 615f 7061 7261 6d5f 6465  rt_meta_param_de
-00034300: 7363 7269 7074 696f 6e28 7061 643d 3132  scription(pad=12
-00034310: 290a 2020 2020 6465 6620 6170 706c 7928  ).    def apply(
-00034320: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00034330: 2020 2020 2020 2066 756e 632c 0a20 2020         func,.   
-00034340: 2020 2020 2061 7869 733d 302c 0a20 2020       axis=0,.   
-00034350: 2020 2020 2062 726f 6164 6361 7374 3d4e       broadcast=N
-00034360: 6f6e 652c 0a20 2020 2020 2020 2072 6177  one,.        raw
-00034370: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00034380: 7265 6475 6365 3d4e 6f6e 652c 0a20 2020  reduce=None,.   
-00034390: 2020 2020 2061 7267 733d 2829 2c0a 2020       args=(),.  
-000343a0: 2020 2020 2020 6d65 7461 3d6e 6f5f 6465        meta=no_de
-000343b0: 6661 756c 742c 0a20 2020 2020 2020 2072  fault,.        r
-000343c0: 6573 756c 745f 7479 7065 3d4e 6f6e 652c  esult_type=None,
-000343d0: 0a20 2020 2020 2020 202a 2a6b 7764 732c  .        **kwds,
-000343e0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000343f0: 2222 2250 6172 616c 6c65 6c20 7665 7273  """Parallel vers
-00034400: 696f 6e20 6f66 2070 616e 6461 732e 4461  ion of pandas.Da
-00034410: 7461 4672 616d 652e 6170 706c 790a 0a20  taFrame.apply.. 
-00034420: 2020 2020 2020 2054 6869 7320 6d69 6d69         This mimi
-00034430: 6373 2074 6865 2070 616e 6461 7320 7665  cs the pandas ve
-00034440: 7273 696f 6e20 6578 6365 7074 2066 6f72  rsion except for
-00034450: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
-00034460: 0a20 2020 2020 2020 2031 2e20 204f 6e6c  .        1.  Onl
-00034470: 7920 6060 6178 6973 3d31 6060 2069 7320  y ``axis=1`` is 
-00034480: 7375 7070 6f72 7465 6420 2861 6e64 206d  supported (and m
-00034490: 7573 7420 6265 2073 7065 6369 6669 6564  ust be specified
-000344a0: 2065 7870 6c69 6369 746c 7929 2e0a 2020   explicitly)..  
-000344b0: 2020 2020 2020 322e 2020 5468 6520 7573        2.  The us
-000344c0: 6572 2073 686f 756c 6420 7072 6f76 6964  er should provid
-000344d0: 6520 6f75 7470 7574 206d 6574 6164 6174  e output metadat
-000344e0: 6120 7669 6120 7468 6520 606d 6574 6160  a via the `meta`
-000344f0: 206b 6579 776f 7264 2e0a 0a20 2020 2020   keyword...     
-00034500: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00034510: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00034520: 0a20 2020 2020 2020 2066 756e 6320 3a20  .        func : 
-00034530: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00034540: 2020 2020 2046 756e 6374 696f 6e20 746f       Function to
-00034550: 2061 7070 6c79 2074 6f20 6561 6368 2063   apply to each c
-00034560: 6f6c 756d 6e2f 726f 770a 2020 2020 2020  olumn/row.      
-00034570: 2020 6178 6973 203a 207b 3020 6f72 2027    axis : {0 or '
-00034580: 696e 6465 7827 2c20 3120 6f72 2027 636f  index', 1 or 'co
-00034590: 6c75 6d6e 7327 7d2c 2064 6566 6175 6c74  lumns'}, default
-000345a0: 2030 0a20 2020 2020 2020 2020 2020 202d   0.            -
-000345b0: 2030 206f 7220 2769 6e64 6578 273a 2061   0 or 'index': a
-000345c0: 7070 6c79 2066 756e 6374 696f 6e20 746f  pply function to
-000345d0: 2065 6163 6820 636f 6c75 6d6e 2028 4e4f   each column (NO
-000345e0: 5420 5355 5050 4f52 5445 4429 0a20 2020  T SUPPORTED).   
-000345f0: 2020 2020 2020 2020 202d 2031 206f 7220           - 1 or 
-00034600: 2763 6f6c 756d 6e73 273a 2061 7070 6c79  'columns': apply
-00034610: 2066 756e 6374 696f 6e20 746f 2065 6163   function to eac
-00034620: 6820 726f 770a 2020 2020 2020 2020 244d  h row.        $M
-00034630: 4554 410a 2020 2020 2020 2020 6172 6773  ETA.        args
-00034640: 203a 2074 7570 6c65 0a20 2020 2020 2020   : tuple.       
-00034650: 2020 2020 2050 6f73 6974 696f 6e61 6c20       Positional 
-00034660: 6172 6775 6d65 6e74 7320 746f 2070 6173  arguments to pas
-00034670: 7320 746f 2066 756e 6374 696f 6e20 696e  s to function in
-00034680: 2061 6464 6974 696f 6e20 746f 2074 6865   addition to the
-00034690: 2061 7272 6179 2f73 6572 6965 730a 0a20   array/series.. 
-000346a0: 2020 2020 2020 2041 6464 6974 696f 6e61         Additiona
-000346b0: 6c20 6b65 7977 6f72 6420 6172 6775 6d65  l keyword argume
-000346c0: 6e74 7320 7769 6c6c 2062 6520 7061 7373  nts will be pass
-000346d0: 6564 2061 7320 6b65 7977 6f72 6473 2074  ed as keywords t
-000346e0: 6f20 7468 6520 6675 6e63 7469 6f6e 0a0a  o the function..
-000346f0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-00034700: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-00034710: 2020 2020 2020 2020 6170 706c 6965 6420          applied 
-00034720: 3a20 5365 7269 6573 206f 7220 4461 7461  : Series or Data
-00034730: 4672 616d 650a 0a20 2020 2020 2020 2045  Frame..        E
-00034740: 7861 6d70 6c65 730a 2020 2020 2020 2020  xamples.        
-00034750: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00034760: 203e 3e3e 2069 6d70 6f72 7420 7061 6e64   >>> import pand
-00034770: 6173 2061 7320 7064 0a20 2020 2020 2020  as as pd.       
-00034780: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
-00034790: 2e64 6174 6166 7261 6d65 2061 7320 6464  .dataframe as dd
-000347a0: 0a20 2020 2020 2020 203e 3e3e 2064 6620  .        >>> df 
-000347b0: 3d20 7064 2e44 6174 6146 7261 6d65 287b  = pd.DataFrame({
-000347c0: 2778 273a 205b 312c 2032 2c20 332c 2034  'x': [1, 2, 3, 4
-000347d0: 2c20 355d 2c0a 2020 2020 2020 2020 2e2e  , 5],.        ..
-000347e0: 2e20 2020 2020 2020 2020 2020 2020 2020  .               
-000347f0: 2020 2020 2027 7927 3a20 5b31 2e2c 2032       'y': [1., 2
-00034800: 2e2c 2033 2e2c 2034 2e2c 2035 2e5d 7d29  ., 3., 4., 5.]})
-00034810: 0a20 2020 2020 2020 203e 3e3e 2064 6466  .        >>> ddf
-00034820: 203d 2064 642e 6672 6f6d 5f70 616e 6461   = dd.from_panda
-00034830: 7328 6466 2c20 6e70 6172 7469 7469 6f6e  s(df, npartition
-00034840: 733d 3229 0a0a 2020 2020 2020 2020 4170  s=2)..        Ap
-00034850: 706c 7920 6120 6675 6e63 7469 6f6e 2074  ply a function t
-00034860: 6f20 726f 772d 7769 7365 2070 6173 7369  o row-wise passi
-00034870: 6e67 2069 6e20 6578 7472 6120 6172 6775  ng in extra argu
-00034880: 6d65 6e74 7320 696e 2060 6061 7267 7360  ments in ``args`
-00034890: 6020 616e 640a 2020 2020 2020 2020 6060  ` and.        ``
-000348a0: 6b77 6172 6773 6060 3a0a 0a20 2020 2020  kwargs``:..     
-000348b0: 2020 203e 3e3e 2064 6566 206d 7961 6464     >>> def myadd
-000348c0: 2872 6f77 2c20 612c 2062 3d31 293a 0a20  (row, a, b=1):. 
-000348d0: 2020 2020 2020 202e 2e2e 2020 2020 2072         ...     r
-000348e0: 6574 7572 6e20 726f 772e 7375 6d28 2920  eturn row.sum() 
-000348f0: 2b20 6120 2b20 620a 2020 2020 2020 2020  + a + b.        
-00034900: 3e3e 3e20 7265 7320 3d20 6464 662e 6170  >>> res = ddf.ap
-00034910: 706c 7928 6d79 6164 642c 2061 7869 733d  ply(myadd, axis=
-00034920: 312c 2061 7267 733d 2832 2c29 2c20 623d  1, args=(2,), b=
-00034930: 312e 3529 2020 2320 646f 6374 6573 743a  1.5)  # doctest:
-00034940: 202b 534b 4950 0a0a 2020 2020 2020 2020   +SKIP..        
-00034950: 4279 2064 6566 6175 6c74 2c20 6461 736b  By default, dask
-00034960: 2074 7269 6573 2074 6f20 696e 6665 7220   tries to infer 
-00034970: 7468 6520 6f75 7470 7574 206d 6574 6164  the output metad
-00034980: 6174 6120 6279 2072 756e 6e69 6e67 2079  ata by running y
-00034990: 6f75 720a 2020 2020 2020 2020 7072 6f76  our.        prov
-000349a0: 6964 6564 2066 756e 6374 696f 6e20 6f6e  ided function on
-000349b0: 2073 6f6d 6520 6661 6b65 2064 6174 612e   some fake data.
-000349c0: 2054 6869 7320 776f 726b 7320 7765 6c6c   This works well
-000349d0: 2069 6e20 6d61 6e79 2063 6173 6573 2c20   in many cases, 
-000349e0: 6275 740a 2020 2020 2020 2020 6361 6e20  but.        can 
-000349f0: 736f 6d65 7469 6d65 7320 6265 2065 7870  sometimes be exp
-00034a00: 656e 7369 7665 2c20 6f72 2065 7665 6e20  ensive, or even 
-00034a10: 6661 696c 2e20 546f 2061 766f 6964 2074  fail. To avoid t
-00034a20: 6869 732c 2079 6f75 2063 616e 0a20 2020  his, you can.   
-00034a30: 2020 2020 206d 616e 7561 6c6c 7920 7370       manually sp
-00034a40: 6563 6966 7920 7468 6520 6f75 7470 7574  ecify the output
-00034a50: 206d 6574 6164 6174 6120 7769 7468 2074   metadata with t
-00034a60: 6865 2060 606d 6574 6160 6020 6b65 7977  he ``meta`` keyw
-00034a70: 6f72 642e 2054 6869 730a 2020 2020 2020  ord. This.      
-00034a80: 2020 6361 6e20 6265 2073 7065 6369 6669    can be specifi
-00034a90: 6564 2069 6e20 6d61 6e79 2066 6f72 6d73  ed in many forms
-00034aa0: 2c20 666f 7220 6d6f 7265 2069 6e66 6f72  , for more infor
-00034ab0: 6d61 7469 6f6e 2073 6565 0a20 2020 2020  mation see.     
-00034ac0: 2020 2060 6064 6173 6b2e 6461 7461 6672     ``dask.datafr
-00034ad0: 616d 652e 7574 696c 732e 6d61 6b65 5f6d  ame.utils.make_m
-00034ae0: 6574 6160 602e 0a0a 2020 2020 2020 2020  eta``...        
-00034af0: 4865 7265 2077 6520 7370 6563 6966 7920  Here we specify 
-00034b00: 7468 6520 6f75 7470 7574 2069 7320 6120  the output is a 
-00034b10: 5365 7269 6573 2077 6974 6820 6e61 6d65  Series with name
-00034b20: 2060 6027 7827 6060 2c20 616e 6420 6474   ``'x'``, and dt
-00034b30: 7970 650a 2020 2020 2020 2020 6060 666c  ype.        ``fl
-00034b40: 6f61 7436 3460 603a 0a0a 2020 2020 2020  oat64``:..      
-00034b50: 2020 3e3e 3e20 7265 7320 3d20 6464 662e    >>> res = ddf.
-00034b60: 6170 706c 7928 6d79 6164 642c 2061 7869  apply(myadd, axi
-00034b70: 733d 312c 2061 7267 733d 2832 2c29 2c20  s=1, args=(2,), 
-00034b80: 623d 312e 352c 206d 6574 613d 2827 7827  b=1.5, meta=('x'
-00034b90: 2c20 2766 3827 2929 0a0a 2020 2020 2020  , 'f8'))..      
-00034ba0: 2020 496e 2074 6865 2063 6173 6520 7768    In the case wh
-00034bb0: 6572 6520 7468 6520 6d65 7461 6461 7461  ere the metadata
-00034bc0: 2064 6f65 736e 2774 2063 6861 6e67 652c   doesn't change,
-00034bd0: 2079 6f75 2063 616e 2061 6c73 6f20 7061   you can also pa
-00034be0: 7373 2069 6e0a 2020 2020 2020 2020 7468  ss in.        th
-00034bf0: 6520 6f62 6a65 6374 2069 7473 656c 6620  e object itself 
-00034c00: 6469 7265 6374 6c79 3a0a 0a20 2020 2020  directly:..     
-00034c10: 2020 203e 3e3e 2072 6573 203d 2064 6466     >>> res = ddf
-00034c20: 2e61 7070 6c79 286c 616d 6264 6120 726f  .apply(lambda ro
-00034c30: 773a 2072 6f77 202b 2031 2c20 6178 6973  w: row + 1, axis
-00034c40: 3d31 2c20 6d65 7461 3d64 6466 290a 0a20  =1, meta=ddf).. 
-00034c50: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00034c60: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00034c70: 0a20 2020 2020 2020 2064 6173 6b2e 4461  .        dask.Da
-00034c80: 7461 4672 616d 652e 6d61 705f 7061 7274  taFrame.map_part
-00034c90: 6974 696f 6e73 0a20 2020 2020 2020 2022  itions.        "
-00034ca0: 2222 0a0a 2020 2020 2020 2020 6966 2062  ""..        if b
-00034cb0: 726f 6164 6361 7374 2069 7320 6e6f 7420  roadcast is not 
-00034cc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00034cd0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00034ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00034cf0: 2022 5468 6520 6062 726f 6164 6361 7374   "The `broadcast
-00034d00: 6020 6172 6775 6d65 6e74 2069 7320 6e6f  ` argument is no
-00034d10: 206c 6f6e 6765 7220 7573 6564 2f73 7570   longer used/sup
-00034d20: 706f 7274 6564 2e20 220a 2020 2020 2020  ported. ".      
-00034d30: 2020 2020 2020 2020 2020 2249 7420 7769            "It wi
-00034d40: 6c6c 2062 6520 6472 6f70 7065 6420 696e  ll be dropped in
-00034d50: 2061 2066 7574 7572 6520 7265 6c65 6173   a future releas
-00034d60: 652e 222c 0a20 2020 2020 2020 2020 2020  e.",.           
-00034d70: 2020 2020 2063 6174 6567 6f72 793d 4675       category=Fu
-00034d80: 7475 7265 5761 726e 696e 672c 0a20 2020  tureWarning,.   
-00034d90: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00034da0: 2020 2020 6178 6973 203d 2073 656c 662e      axis = self.
-00034db0: 5f76 616c 6964 6174 655f 6178 6973 2861  _validate_axis(a
-00034dc0: 7869 7329 0a20 2020 2020 2020 2070 616e  xis).        pan
-00034dd0: 6461 735f 6b77 6172 6773 203d 207b 2261  das_kwargs = {"a
-00034de0: 7869 7322 3a20 6178 6973 2c20 2272 6177  xis": axis, "raw
-00034df0: 223a 2072 6177 2c20 2272 6573 756c 745f  ": raw, "result_
-00034e00: 7479 7065 223a 2072 6573 756c 745f 7479  type": result_ty
-00034e10: 7065 7d0a 0a20 2020 2020 2020 206b 7764  pe}..        kwd
-00034e20: 732e 7570 6461 7465 2870 616e 6461 735f  s.update(pandas_
-00034e30: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-00034e40: 2069 6620 6178 6973 203d 3d20 303a 0a20   if axis == 0:. 
-00034e50: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
-00034e60: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00034e70: 2020 2022 6464 2e44 6174 6146 7261 6d65     "dd.DataFrame
-00034e80: 2e61 7070 6c79 206f 6e6c 7920 7375 7070  .apply only supp
-00034e90: 6f72 7473 2061 7869 733d 315c 6e22 0a20  orts axis=1\n". 
-00034ea0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00034eb0: 2020 5472 793a 2064 662e 6170 706c 7928    Try: df.apply(
-00034ec0: 6675 6e63 2c20 6178 6973 3d31 2922 0a20  func, axis=1)". 
-00034ed0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00034ee0: 2020 2020 2020 2020 2072 6169 7365 204e           raise N
-00034ef0: 6f74 496d 706c 656d 656e 7465 6445 7272  otImplementedErr
-00034f00: 6f72 286d 7367 290a 0a20 2020 2020 2020  or(msg)..       
-00034f10: 2069 6620 6d65 7461 2069 7320 6e6f 5f64   if meta is no_d
-00034f20: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-00034f30: 2020 2020 6d65 7461 203d 205f 656d 756c      meta = _emul
-00034f40: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-00034f50: 2020 2020 204d 2e61 7070 6c79 2c20 7365       M.apply, se
-00034f60: 6c66 2e5f 6d65 7461 5f6e 6f6e 656d 7074  lf._meta_nonempt
-00034f70: 792c 2066 756e 632c 2061 7267 733d 6172  y, func, args=ar
-00034f80: 6773 2c20 7564 663d 5472 7565 2c20 2a2a  gs, udf=True, **
-00034f90: 6b77 6473 0a20 2020 2020 2020 2020 2020  kwds.           
-00034fa0: 2029 0a20 2020 2020 2020 2020 2020 2077   ).            w
-00034fb0: 6172 6e69 6e67 732e 7761 726e 286d 6574  arnings.warn(met
-00034fc0: 615f 7761 726e 696e 6728 6d65 7461 2929  a_warning(meta))
-00034fd0: 0a20 2020 2020 2020 206b 7764 732e 7570  .        kwds.up
-00034fe0: 6461 7465 287b 2270 6172 656e 745f 6d65  date({"parent_me
-00034ff0: 7461 223a 2073 656c 662e 5f6d 6574 617d  ta": self._meta}
-00035000: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00035010: 206d 6170 5f70 6172 7469 7469 6f6e 7328   map_partitions(
-00035020: 4d2e 6170 706c 792c 2073 656c 662c 2066  M.apply, self, f
-00035030: 756e 632c 2061 7267 733d 6172 6773 2c20  unc, args=args, 
-00035040: 6d65 7461 3d6d 6574 612c 202a 2a6b 7764  meta=meta, **kwd
-00035050: 7329 0a0a 2020 2020 4064 6572 6976 6564  s)..    @derived
-00035060: 5f66 726f 6d28 7064 2e44 6174 6146 7261  _from(pd.DataFra
-00035070: 6d65 290a 2020 2020 6465 6620 6170 706c  me).    def appl
-00035080: 796d 6170 2873 656c 662c 2066 756e 632c  ymap(self, func,
-00035090: 206d 6574 613d 6e6f 5f64 6566 6175 6c74   meta=no_default
-000350a0: 293a 0a20 2020 2020 2020 2023 204c 6574  ):.        # Let
-000350b0: 2070 616e 6461 7320 7261 6973 6520 6465   pandas raise de
-000350c0: 7072 6563 6174 696f 6e20 7761 726e 696e  precation warnin
-000350d0: 6773 0a20 2020 2020 2020 2073 656c 662e  gs.        self.
-000350e0: 5f6d 6574 612e 6170 706c 796d 6170 2866  _meta.applymap(f
-000350f0: 756e 6329 0a20 2020 2020 2020 2072 6574  unc).        ret
-00035100: 7572 6e20 656c 656d 7769 7365 286d 6574  urn elemwise(met
-00035110: 686f 6473 2e61 7070 6c79 6d61 702c 2073  hods.applymap, s
-00035120: 656c 662c 2066 756e 632c 206d 6574 613d  elf, func, meta=
-00035130: 6d65 7461 290a 0a20 2020 2064 6566 206d  meta)..    def m
-00035140: 6170 2873 656c 662c 2066 756e 632c 206d  ap(self, func, m
-00035150: 6574 613d 6e6f 5f64 6566 6175 6c74 2c20  eta=no_default, 
-00035160: 6e61 5f61 6374 696f 6e3d 4e6f 6e65 293a  na_action=None):
-00035170: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00035180: 5041 4e44 4153 5f47 545f 3231 303a 0a20  PANDAS_GT_210:. 
-00035190: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000351a0: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-000351b0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000351c0: 2020 2020 2020 6622 4461 7461 4672 616d        f"DataFram
-000351d0: 652e 6d61 7020 7265 7175 6972 6573 2070  e.map requires p
-000351e0: 616e 6461 733e 3d32 2e31 2e30 2c20 6275  andas>=2.1.0, bu
-000351f0: 7420 7061 6e64 6173 3d7b 5041 4e44 4153  t pandas={PANDAS
-00035200: 5f56 4552 5349 4f4e 7d20 6973 2022 0a20  _VERSION} is ". 
-00035210: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00035220: 696e 7374 616c 6c65 642e 220a 2020 2020  installed.".    
-00035230: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00035240: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
-00035250: 6528 4d2e 6d61 702c 2073 656c 662c 2066  e(M.map, self, f
-00035260: 756e 632c 206d 6574 613d 6d65 7461 2c20  unc, meta=meta, 
-00035270: 6e61 5f61 6374 696f 6e3d 6e61 5f61 6374  na_action=na_act
-00035280: 696f 6e29 0a0a 2020 2020 4064 6572 6976  ion)..    @deriv
-00035290: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
-000352a0: 7261 6d65 290a 2020 2020 6465 6620 726f  rame).    def ro
-000352b0: 756e 6428 7365 6c66 2c20 6465 6369 6d61  und(self, decima
-000352c0: 6c73 3d30 293a 0a20 2020 2020 2020 2072  ls=0):.        r
-000352d0: 6574 7572 6e20 656c 656d 7769 7365 284d  eturn elemwise(M
-000352e0: 2e72 6f75 6e64 2c20 7365 6c66 2c20 6465  .round, self, de
-000352f0: 6369 6d61 6c73 290a 0a20 2020 2040 6465  cimals)..    @de
-00035300: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
-00035310: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
-00035320: 206e 756e 6971 7565 2873 656c 662c 2073   nunique(self, s
-00035330: 706c 6974 5f65 7665 7279 3d46 616c 7365  plit_every=False
-00035340: 2c20 6472 6f70 6e61 3d54 7275 652c 2061  , dropna=True, a
-00035350: 7869 733d 3029 3a0a 2020 2020 2020 2020  xis=0):.        
-00035360: 6966 2061 7869 7320 3d3d 2031 3a0a 2020  if axis == 1:.  
-00035370: 2020 2020 2020 2020 2020 2320 7370 6c69            # spli
-00035380: 745f 6576 6572 7920 6e6f 7420 7573 6564  t_every not used
-00035390: 2066 6f72 2061 7869 733d 310a 2020 2020   for axis=1.    
-000353a0: 2020 2020 2020 2020 6d65 7461 203d 2073          meta = s
-000353b0: 656c 662e 5f6d 6574 615f 6e6f 6e65 6d70  elf._meta_nonemp
-000353c0: 7479 2e6e 756e 6971 7565 2861 7869 733d  ty.nunique(axis=
-000353d0: 6178 6973 290a 2020 2020 2020 2020 2020  axis).          
-000353e0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
-000353f0: 705f 7061 7274 6974 696f 6e73 280a 2020  p_partitions(.  
-00035400: 2020 2020 2020 2020 2020 2020 2020 4d2e                M.
-00035410: 6e75 6e69 7175 652c 0a20 2020 2020 2020  nunique,.       
-00035420: 2020 2020 2020 2020 206d 6574 613d 6d65           meta=me
-00035430: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-00035440: 2020 2020 746f 6b65 6e3d 2273 6572 6965      token="serie
-00035450: 732d 6e75 6e69 7175 6522 2c0a 2020 2020  s-nunique",.    
-00035460: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00035470: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-00035480: 2020 2020 2020 2064 726f 706e 613d 6472         dropna=dr
-00035490: 6f70 6e61 2c0a 2020 2020 2020 2020 2020  opna,.          
-000354a0: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
-000354b0: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
-000354c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000354d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000354e0: 2020 2020 2020 6e75 6e69 7175 655f 6c69        nunique_li
-000354f0: 7374 203d 205b 0a20 2020 2020 2020 2020  st = [.         
-00035500: 2020 2020 2020 2073 656c 662e 696c 6f63         self.iloc
-00035510: 5b3a 2c20 695d 2e6e 756e 6971 7565 2873  [:, i].nunique(s
-00035520: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
-00035530: 5f65 7665 7279 2c20 6472 6f70 6e61 3d64  _every, dropna=d
-00035540: 726f 706e 6129 0a20 2020 2020 2020 2020  ropna).         
-00035550: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00035560: 7261 6e67 6528 6c65 6e28 7365 6c66 2e63  range(len(self.c
-00035570: 6f6c 756d 6e73 2929 0a20 2020 2020 2020  olumns)).       
-00035580: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
-00035590: 2020 206e 616d 6520 3d20 2273 6572 6965     name = "serie
-000355a0: 732d 2220 2b20 746f 6b65 6e69 7a65 282a  s-" + tokenize(*
-000355b0: 6e75 6e69 7175 655f 6c69 7374 290a 2020  nunique_list).  
-000355c0: 2020 2020 2020 2020 2020 6473 6b20 3d20            dsk = 
-000355d0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-000355e0: 2020 286e 616d 652c 2030 293a 2028 0a20    (name, 0): (. 
-000355f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035600: 2020 2061 7070 6c79 2c0a 2020 2020 2020     apply,.      
-00035610: 2020 2020 2020 2020 2020 2020 2020 7064                pd
-00035620: 2e53 6572 6965 732c 0a20 2020 2020 2020  .Series,.       
-00035630: 2020 2020 2020 2020 2020 2020 205b 5b28               [[(
-00035640: 732e 5f6e 616d 652c 2030 2920 666f 7220  s._name, 0) for 
-00035650: 7320 696e 206e 756e 6971 7565 5f6c 6973  s in nunique_lis
-00035660: 745d 5d2c 0a20 2020 2020 2020 2020 2020  t]],.           
-00035670: 2020 2020 2020 2020 207b 2269 6e64 6578           {"index
-00035680: 223a 2073 656c 662e 636f 6c75 6d6e 737d  ": self.columns}
-00035690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000356a0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000356b0: 7d0a 2020 2020 2020 2020 2020 2020 6772  }.            gr
-000356c0: 6170 6820 3d20 4869 6768 4c65 7665 6c47  aph = HighLevelG
-000356d0: 7261 7068 2e66 726f 6d5f 636f 6c6c 6563  raph.from_collec
-000356e0: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
-000356f0: 2020 2020 2020 206e 616d 652c 2064 736b         name, dsk
-00035700: 2c20 6465 7065 6e64 656e 6369 6573 3d6e  , dependencies=n
-00035710: 756e 6971 7565 5f6c 6973 740a 2020 2020  unique_list.    
-00035720: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00035730: 2020 2020 2020 7265 7475 726e 2053 6572        return Ser
-00035740: 6965 7328 6772 6170 682c 206e 616d 652c  ies(graph, name,
-00035750: 2073 656c 662e 5f6d 6574 612e 6e75 6e69   self._meta.nuni
-00035760: 7175 6528 292c 2028 4e6f 6e65 2c20 4e6f  que(), (None, No
-00035770: 6e65 2929 0a0a 2020 2020 4064 6572 6976  ne))..    @deriv
-00035780: 6564 5f66 726f 6d28 7064 2e44 6174 6146  ed_from(pd.DataF
-00035790: 7261 6d65 290a 2020 2020 6465 6620 6d6f  rame).    def mo
-000357a0: 6465 2873 656c 662c 2064 726f 706e 613d  de(self, dropna=
-000357b0: 5472 7565 2c20 7370 6c69 745f 6576 6572  True, split_ever
-000357c0: 793d 4661 6c73 652c 206e 756d 6572 6963  y=False, numeric
-000357d0: 5f6f 6e6c 793d 4661 6c73 6529 3a0a 2020  _only=False):.  
-000357e0: 2020 2020 2020 6d6f 6465 5f73 6572 6965        mode_serie
-000357f0: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
-00035800: 2020 2020 666f 7220 636f 6c5f 696e 6465      for col_inde
-00035810: 7820 696e 2072 616e 6765 286c 656e 2873  x in range(len(s
-00035820: 656c 662e 636f 6c75 6d6e 7329 293a 0a20  elf.columns)):. 
-00035830: 2020 2020 2020 2020 2020 2063 6f6c 5f73             col_s
-00035840: 6572 6965 7320 3d20 7365 6c66 2e69 6c6f  eries = self.ilo
-00035850: 635b 3a2c 2063 6f6c 5f69 6e64 6578 5d0a  c[:, col_index].
-00035860: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00035870: 756d 6572 6963 5f6f 6e6c 7920 616e 6420  umeric_only and 
-00035880: 6e6f 7420 7064 2e61 7069 2e74 7970 6573  not pd.api.types
-00035890: 2e69 735f 6e75 6d65 7269 635f 6474 7970  .is_numeric_dtyp
-000358a0: 6528 636f 6c5f 7365 7269 6573 2e64 7479  e(col_series.dty
-000358b0: 7065 293a 0a20 2020 2020 2020 2020 2020  pe):.           
-000358c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-000358d0: 2020 2020 2020 2020 2020 6d6f 6465 5f73            mode_s
-000358e0: 6572 6965 7320 3d20 5365 7269 6573 2e6d  eries = Series.m
-000358f0: 6f64 6528 0a20 2020 2020 2020 2020 2020  ode(.           
-00035900: 2020 2020 2063 6f6c 5f73 6572 6965 732c       col_series,
-00035910: 2064 726f 706e 613d 6472 6f70 6e61 2c20   dropna=dropna, 
-00035920: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-00035930: 745f 6576 6572 790a 2020 2020 2020 2020  t_every.        
-00035940: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00035950: 2020 6d6f 6465 5f73 6572 6965 735f 6c69    mode_series_li
-00035960: 7374 2e61 7070 656e 6428 6d6f 6465 5f73  st.append(mode_s
-00035970: 6572 6965 7329 0a0a 2020 2020 2020 2020  eries)..        
-00035980: 6e61 6d65 203d 2022 636f 6e63 6174 2d22  name = "concat-"
-00035990: 202b 2074 6f6b 656e 697a 6528 2a6d 6f64   + tokenize(*mod
-000359a0: 655f 7365 7269 6573 5f6c 6973 7429 0a0a  e_series_list)..
-000359b0: 2020 2020 2020 2020 6473 6b20 3d20 7b0a          dsk = {.
-000359c0: 2020 2020 2020 2020 2020 2020 286e 616d              (nam
-000359d0: 652c 2030 293a 2028 0a20 2020 2020 2020  e, 0): (.       
-000359e0: 2020 2020 2020 2020 2061 7070 6c79 2c0a           apply,.
-000359f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035a00: 6d65 7468 6f64 732e 636f 6e63 6174 2c0a  methods.concat,.
-00035a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035a20: 5b5b 2864 662e 5f6e 616d 652c 2030 2920  [[(df._name, 0) 
-00035a30: 666f 7220 6466 2069 6e20 6d6f 6465 5f73  for df in mode_s
-00035a40: 6572 6965 735f 6c69 7374 5d5d 2c0a 2020  eries_list]],.  
-00035a50: 2020 2020 2020 2020 2020 2020 2020 7b22                {"
-00035a60: 6178 6973 223a 2031 7d2c 0a20 2020 2020  axis": 1},.     
-00035a70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00035a80: 207d 0a0a 2020 2020 2020 2020 6d65 7461   }..        meta
-00035a90: 203d 206d 6574 686f 6473 2e63 6f6e 6361   = methods.conca
-00035aa0: 7428 5b64 662e 5f6d 6574 6120 666f 7220  t([df._meta for 
-00035ab0: 6466 2069 6e20 6d6f 6465 5f73 6572 6965  df in mode_serie
-00035ac0: 735f 6c69 7374 5d2c 2061 7869 733d 3129  s_list], axis=1)
-00035ad0: 0a20 2020 2020 2020 2067 7261 7068 203d  .        graph =
-00035ae0: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
-00035af0: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
-00035b00: 280a 2020 2020 2020 2020 2020 2020 6e61  (.            na
-00035b10: 6d65 2c20 6473 6b2c 2064 6570 656e 6465  me, dsk, depende
-00035b20: 6e63 6965 733d 6d6f 6465 5f73 6572 6965  ncies=mode_serie
-00035b30: 735f 6c69 7374 0a20 2020 2020 2020 2029  s_list.        )
-00035b40: 0a20 2020 2020 2020 2064 6466 203d 206e  .        ddf = n
-00035b50: 6577 5f64 645f 6f62 6a65 6374 2867 7261  ew_dd_object(gra
-00035b60: 7068 2c20 6e61 6d65 2c20 6d65 7461 2c20  ph, name, meta, 
-00035b70: 6469 7669 7369 6f6e 733d 284e 6f6e 652c  divisions=(None,
-00035b80: 204e 6f6e 6529 290a 0a20 2020 2020 2020   None))..       
-00035b90: 2072 6574 7572 6e20 6464 660a 0a20 2020   return ddf..   
-00035ba0: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
-00035bb0: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
-00035bc0: 2064 6566 2063 6f76 2873 656c 662c 206d   def cov(self, m
-00035bd0: 696e 5f70 6572 696f 6473 3d4e 6f6e 652c  in_periods=None,
-00035be0: 206e 756d 6572 6963 5f6f 6e6c 793d 6e6f   numeric_only=no
-00035bf0: 5f64 6566 6175 6c74 2c20 7370 6c69 745f  _default, split_
-00035c00: 6576 6572 793d 4661 6c73 6529 3a0a 2020  every=False):.  
-00035c10: 2020 2020 2020 7265 7475 726e 205f 636f        return _co
-00035c20: 765f 636f 7272 280a 2020 2020 2020 2020  v_corr(.        
-00035c30: 2020 2020 7365 6c66 2c20 6d69 6e5f 7065      self, min_pe
-00035c40: 7269 6f64 732c 206e 756d 6572 6963 5f6f  riods, numeric_o
-00035c50: 6e6c 793d 6e75 6d65 7269 635f 6f6e 6c79  nly=numeric_only
-00035c60: 2c20 7370 6c69 745f 6576 6572 793d 7370  , split_every=sp
-00035c70: 6c69 745f 6576 6572 790a 2020 2020 2020  lit_every.      
-00035c80: 2020 290a 0a20 2020 2040 6465 7269 7665    )..    @derive
-00035c90: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00035ca0: 616d 6529 0a20 2020 2064 6566 2063 6f72  ame).    def cor
-00035cb0: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
-00035cc0: 0a20 2020 2020 2020 206d 6574 686f 643d  .        method=
-00035cd0: 2270 6561 7273 6f6e 222c 0a20 2020 2020  "pearson",.     
-00035ce0: 2020 206d 696e 5f70 6572 696f 6473 3d4e     min_periods=N
-00035cf0: 6f6e 652c 0a20 2020 2020 2020 206e 756d  one,.        num
-00035d00: 6572 6963 5f6f 6e6c 793d 6e6f 5f64 6566  eric_only=no_def
-00035d10: 6175 6c74 2c0a 2020 2020 2020 2020 7370  ault,.        sp
-00035d20: 6c69 745f 6576 6572 793d 4661 6c73 652c  lit_every=False,
-00035d30: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00035d40: 6966 206d 6574 686f 6420 213d 2022 7065  if method != "pe
-00035d50: 6172 736f 6e22 3a0a 2020 2020 2020 2020  arson":.        
-00035d60: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
-00035d70: 6c65 6d65 6e74 6564 4572 726f 7228 224f  lementedError("O
-00035d80: 6e6c 7920 5065 6172 736f 6e20 636f 7272  nly Pearson corr
-00035d90: 656c 6174 696f 6e20 6861 7320 6265 656e  elation has been
-00035da0: 2069 6d70 6c65 6d65 6e74 6564 2229 0a0a   implemented")..
-00035db0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-00035dc0: 636f 765f 636f 7272 280a 2020 2020 2020  cov_corr(.      
-00035dd0: 2020 2020 2020 7365 6c66 2c20 6d69 6e5f        self, min_
-00035de0: 7065 7269 6f64 732c 2054 7275 652c 206e  periods, True, n
-00035df0: 756d 6572 6963 5f6f 6e6c 793d 6e75 6d65  umeric_only=nume
-00035e00: 7269 635f 6f6e 6c79 2c20 7370 6c69 745f  ric_only, split_
-00035e10: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
-00035e20: 790a 2020 2020 2020 2020 290a 0a20 2020  y.        )..   
-00035e30: 2064 6566 2069 6e66 6f28 7365 6c66 2c20   def info(self, 
-00035e40: 6275 663d 4e6f 6e65 2c20 7665 7262 6f73  buf=None, verbos
-00035e50: 653d 4661 6c73 652c 206d 656d 6f72 795f  e=False, memory_
-00035e60: 7573 6167 653d 4661 6c73 6529 3a0a 2020  usage=False):.  
-00035e70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00035e80: 2020 436f 6e63 6973 6520 7375 6d6d 6172    Concise summar
-00035e90: 7920 6f66 2061 2044 6173 6b20 4461 7461  y of a Dask Data
-00035ea0: 4672 616d 652e 0a20 2020 2020 2020 2022  Frame..        "
-00035eb0: 2222 0a0a 2020 2020 2020 2020 6966 2062  ""..        if b
-00035ec0: 7566 2069 7320 4e6f 6e65 3a0a 2020 2020  uf is None:.    
-00035ed0: 2020 2020 2020 2020 696d 706f 7274 2073          import s
-00035ee0: 7973 0a0a 2020 2020 2020 2020 2020 2020  ys..            
-00035ef0: 6275 6620 3d20 7379 732e 7374 646f 7574  buf = sys.stdout
-00035f00: 0a0a 2020 2020 2020 2020 6c69 6e65 7320  ..        lines 
-00035f10: 3d20 5b73 7472 2874 7970 6528 7365 6c66  = [str(type(self
-00035f20: 2929 5d0a 0a20 2020 2020 2020 2069 6620  ))]..        if 
-00035f30: 6c65 6e28 7365 6c66 2e63 6f6c 756d 6e73  len(self.columns
-00035f40: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-00035f50: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
-00035f60: 2866 227b 7479 7065 2873 656c 662e 696e  (f"{type(self.in
-00035f70: 6465 782e 5f6d 6574 6129 2e5f 5f6e 616d  dex._meta).__nam
-00035f80: 655f 5f7d 3a20 3020 656e 7472 6965 7322  e__}: 0 entries"
-00035f90: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
-00035fa0: 6e65 732e 6170 7065 6e64 2866 2245 6d70  nes.append(f"Emp
-00035fb0: 7479 207b 7479 7065 2873 656c 6629 2e5f  ty {type(self)._
-00035fc0: 5f6e 616d 655f 5f7d 2229 0a20 2020 2020  _name__}").     
-00035fd0: 2020 2020 2020 2069 6620 5041 4e44 4153         if PANDAS
-00035fe0: 5f47 545f 3135 303a 0a20 2020 2020 2020  _GT_150:.       
-00035ff0: 2020 2020 2020 2020 2023 2070 616e 6461           # panda
-00036000: 7320 6461 7461 6672 616d 6520 7374 6172  s dataframe star
-00036010: 7465 6420 6164 6469 6e67 2061 206e 6577  ted adding a new
-00036020: 6c69 6e65 2077 6865 6e20 696e 666f 2069  line when info i
-00036030: 7320 6361 6c6c 6564 2e0a 2020 2020 2020  s called..      
-00036040: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-00036050: 6170 7065 6e64 2822 2229 0a20 2020 2020  append("").     
-00036060: 2020 2020 2020 2070 7574 5f6c 696e 6573         put_lines
-00036070: 2862 7566 2c20 6c69 6e65 7329 0a20 2020  (buf, lines).   
-00036080: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00036090: 0a20 2020 2020 2020 2023 2047 726f 7570  .        # Group
-000360a0: 2061 6e64 2065 7865 6375 7465 2074 6865   and execute the
-000360b0: 2072 6571 7569 7265 6420 636f 6d70 7574   required comput
-000360c0: 6174 696f 6e73 0a20 2020 2020 2020 2063  ations.        c
-000360d0: 6f6d 7075 7461 7469 6f6e 7320 3d20 7b7d  omputations = {}
-000360e0: 0a20 2020 2020 2020 2069 6620 7665 7262  .        if verb
-000360f0: 6f73 653a 0a20 2020 2020 2020 2020 2020  ose:.           
-00036100: 206d 656d 6f72 795f 7573 6167 6520 3d20   memory_usage = 
-00036110: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00036120: 2063 6f6d 7075 7461 7469 6f6e 732e 7570   computations.up
-00036130: 6461 7465 287b 2269 6e64 6578 223a 2073  date({"index": s
-00036140: 656c 662e 696e 6465 782c 2022 636f 756e  elf.index, "coun
-00036150: 7422 3a20 7365 6c66 2e63 6f75 6e74 2829  t": self.count()
-00036160: 7d29 0a20 2020 2020 2020 2069 6620 6d65  }).        if me
-00036170: 6d6f 7279 5f75 7361 6765 3a0a 2020 2020  mory_usage:.    
-00036180: 2020 2020 2020 2020 636f 6d70 7574 6174          computat
-00036190: 696f 6e73 2e75 7064 6174 6528 0a20 2020  ions.update(.   
-000361a0: 2020 2020 2020 2020 2020 2020 207b 226d               {"m
-000361b0: 656d 6f72 795f 7573 6167 6522 3a20 7365  emory_usage": se
-000361c0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
-000361d0: 7328 4d2e 6d65 6d6f 7279 5f75 7361 6765  s(M.memory_usage
-000361e0: 2c20 696e 6465 783d 5472 7565 297d 0a20  , index=True)}. 
-000361f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00036200: 2020 2020 2063 6f6d 7075 7461 7469 6f6e       computation
-00036210: 7320 3d20 6469 6374 280a 2020 2020 2020  s = dict(.      
-00036220: 2020 2020 2020 7a69 7028 636f 6d70 7574        zip(comput
-00036230: 6174 696f 6e73 2e6b 6579 7328 292c 2064  ations.keys(), d
-00036240: 612e 636f 6d70 7574 6528 2a63 6f6d 7075  a.compute(*compu
-00036250: 7461 7469 6f6e 732e 7661 6c75 6573 2829  tations.values()
-00036260: 2929 0a20 2020 2020 2020 2029 0a0a 2020  )).        )..  
-00036270: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-00036280: 3a0a 2020 2020 2020 2020 2020 2020 696d  :.            im
-00036290: 706f 7274 2074 6578 7477 7261 700a 0a20  port textwrap.. 
-000362a0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-000362b0: 203d 2063 6f6d 7075 7461 7469 6f6e 735b   = computations[
-000362c0: 2269 6e64 6578 225d 0a20 2020 2020 2020  "index"].       
-000362d0: 2020 2020 2063 6f75 6e74 7320 3d20 636f       counts = co
-000362e0: 6d70 7574 6174 696f 6e73 5b22 636f 756e  mputations["coun
-000362f0: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
-00036300: 6c69 6e65 732e 6170 7065 6e64 2869 6e64  lines.append(ind
-00036310: 6578 5f73 756d 6d61 7279 2869 6e64 6578  ex_summary(index
-00036320: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
-00036330: 696e 6573 2e61 7070 656e 6428 6622 4461  ines.append(f"Da
-00036340: 7461 2063 6f6c 756d 6e73 2028 746f 7461  ta columns (tota
-00036350: 6c20 7b6c 656e 2873 656c 662e 636f 6c75  l {len(self.colu
-00036360: 6d6e 7329 7d20 636f 6c75 6d6e 7329 3a22  mns)} columns):"
-00036370: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00036380: 726f 6d20 7061 6e64 6173 2e69 6f2e 666f  rom pandas.io.fo
-00036390: 726d 6174 732e 7072 696e 7469 6e67 2069  rmats.printing i
-000363a0: 6d70 6f72 7420 7070 7269 6e74 5f74 6869  mport pprint_thi
-000363b0: 6e67 0a0a 2020 2020 2020 2020 2020 2020  ng..            
-000363c0: 7370 6163 6520 3d20 6d61 7828 6c65 6e28  space = max(len(
-000363d0: 7070 7269 6e74 5f74 6869 6e67 286b 2929  pprint_thing(k))
-000363e0: 2066 6f72 206b 2069 6e20 7365 6c66 2e63   for k in self.c
-000363f0: 6f6c 756d 6e73 2920 2b20 310a 2020 2020  olumns) + 1.    
-00036400: 2020 2020 2020 2020 636f 6c75 6d6e 5f77          column_w
-00036410: 6964 7468 203d 206d 6178 2873 7061 6365  idth = max(space
-00036420: 2c20 3729 0a0a 2020 2020 2020 2020 2020  , 7)..          
-00036430: 2020 6865 6164 6572 203d 2028 0a20 2020    header = (.   
-00036440: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-00036450: 7477 7261 702e 6465 6465 6e74 280a 2020  twrap.dedent(.  
-00036460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036470: 2020 2222 225c 0a20 2020 2020 2020 2020    """\.         
-00036480: 2020 2020 2320 2020 7b7b 636f 6c75 6d6e      #   {{column
-00036490: 3a3c 7b63 6f6c 756d 6e5f 7769 6474 687d  :<{column_width}
-000364a0: 7d7d 204e 6f6e 2d4e 756c 6c20 436f 756e  }} Non-Null Coun
-000364b0: 7420 2044 7479 7065 0a20 2020 2020 2020  t  Dtype.       
-000364c0: 2020 2020 202d 2d2d 2020 7b7b 756e 6465       ---  {{unde
-000364d0: 726c 3a3c 7b63 6f6c 756d 6e5f 7769 6474  rl:<{column_widt
-000364e0: 687d 7d7d 202d 2d2d 2d2d 2d2d 2d2d 2d2d  h}}} -----------
-000364f0: 2d2d 2d20 202d 2d2d 2d2d 2222 220a 2020  ---  -----""".  
-00036500: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00036510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036520: 2e66 6f72 6d61 7428 636f 6c75 6d6e 5f77  .format(column_w
-00036530: 6964 7468 3d63 6f6c 756d 6e5f 7769 6474  idth=column_widt
-00036540: 6829 0a20 2020 2020 2020 2020 2020 2020  h).             
-00036550: 2020 202e 666f 726d 6174 2863 6f6c 756d     .format(colum
-00036560: 6e3d 2243 6f6c 756d 6e22 2c20 756e 6465  n="Column", unde
-00036570: 726c 3d22 2d2d 2d2d 2d2d 2229 0a20 2020  rl="------").   
-00036580: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00036590: 2020 2020 2020 2063 6f6c 756d 6e5f 7465         column_te
-000365a0: 6d70 6c61 7465 203d 2074 6578 7477 7261  mplate = textwra
-000365b0: 702e 6465 6465 6e74 280a 2020 2020 2020  p.dedent(.      
-000365c0: 2020 2020 2020 2020 2020 2222 225c 0a20            """\. 
-000365d0: 2020 2020 2020 2020 2020 207b 7b69 3a5e             {{i:^
-000365e0: 337d 7d20 207b 7b6e 616d 653a 3c7b 636f  3}}  {{name:<{co
-000365f0: 6c75 6d6e 5f77 6964 7468 7d7d 7d20 7b7b  lumn_width}}} {{
-00036600: 636f 756e 747d 7d20 6e6f 6e2d 6e75 6c6c  count}} non-null
-00036610: 2020 2020 2020 7b7b 6474 7970 657d 7d22        {{dtype}}"
-00036620: 2222 2e66 6f72 6d61 7428 0a20 2020 2020  "".format(.     
-00036630: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00036640: 6f6c 756d 6e5f 7769 6474 683d 636f 6c75  olumn_width=colu
-00036650: 6d6e 5f77 6964 7468 0a20 2020 2020 2020  mn_width.       
-00036660: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00036670: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00036680: 2020 2020 2063 6f6c 756d 6e5f 696e 666f       column_info
-00036690: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-000366a0: 2020 2020 2063 6f6c 756d 6e5f 7465 6d70       column_temp
-000366b0: 6c61 7465 2e66 6f72 6d61 7428 0a20 2020  late.format(.   
-000366c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000366d0: 2069 3d70 7072 696e 745f 7468 696e 6728   i=pprint_thing(
-000366e0: 6929 2c0a 2020 2020 2020 2020 2020 2020  i),.            
-000366f0: 2020 2020 2020 2020 6e61 6d65 3d70 7072          name=ppr
-00036700: 696e 745f 7468 696e 6728 6e61 6d65 292c  int_thing(name),
-00036710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036720: 2020 2020 2063 6f75 6e74 3d70 7072 696e       count=pprin
-00036730: 745f 7468 696e 6728 636f 756e 7429 2c0a  t_thing(count),.
-00036740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036750: 2020 2020 6474 7970 653d 7070 7269 6e74      dtype=pprint
-00036760: 5f74 6869 6e67 2864 7479 7065 292c 0a20  _thing(dtype),. 
-00036770: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00036780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036790: 2066 6f72 2069 2c20 286e 616d 652c 2063   for i, (name, c
-000367a0: 6f75 6e74 2c20 6474 7970 6529 2069 6e20  ount, dtype) in 
-000367b0: 656e 756d 6572 6174 6528 0a20 2020 2020  enumerate(.     
-000367c0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-000367d0: 6970 2873 656c 662e 636f 6c75 6d6e 732c  ip(self.columns,
-000367e0: 2063 6f75 6e74 732c 2073 656c 662e 6474   counts, self.dt
-000367f0: 7970 6573 290a 2020 2020 2020 2020 2020  ypes).          
-00036800: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00036810: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-00036820: 2020 6c69 6e65 732e 6578 7465 6e64 2868    lines.extend(h
-00036830: 6561 6465 722e 7370 6c69 7428 225c 6e22  eader.split("\n"
-00036840: 2929 0a20 2020 2020 2020 2065 6c73 653a  )).        else:
-00036850: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00036860: 756d 6e5f 696e 666f 203d 205b 696e 6465  umn_info = [inde
-00036870: 785f 7375 6d6d 6172 7928 7365 6c66 2e63  x_summary(self.c
-00036880: 6f6c 756d 6e73 2c20 6e61 6d65 3d22 436f  olumns, name="Co
-00036890: 6c75 6d6e 7322 295d 0a0a 2020 2020 2020  lumns")]..      
-000368a0: 2020 6c69 6e65 732e 6578 7465 6e64 2863    lines.extend(c
-000368b0: 6f6c 756d 6e5f 696e 666f 290a 2020 2020  olumn_info).    
-000368c0: 2020 2020 6474 7970 655f 636f 756e 7473      dtype_counts
-000368d0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-000368e0: 2022 2573 2825 6429 2220 2520 6b20 666f   "%s(%d)" % k fo
-000368f0: 7220 6b20 696e 2073 6f72 7465 6428 7365  r k in sorted(se
-00036900: 6c66 2e64 7479 7065 732e 7661 6c75 655f  lf.dtypes.value_
-00036910: 636f 756e 7473 2829 2e69 7465 6d73 2829  counts().items()
-00036920: 2c20 6b65 793d 7374 7229 0a20 2020 2020  , key=str).     
-00036930: 2020 205d 0a20 2020 2020 2020 206c 696e     ].        lin
-00036940: 6573 2e61 7070 656e 6428 2264 7479 7065  es.append("dtype
-00036950: 733a 207b 7d22 2e66 6f72 6d61 7428 222c  s: {}".format(",
-00036960: 2022 2e6a 6f69 6e28 6474 7970 655f 636f   ".join(dtype_co
-00036970: 756e 7473 2929 290a 0a20 2020 2020 2020  unts)))..       
-00036980: 2069 6620 6d65 6d6f 7279 5f75 7361 6765   if memory_usage
-00036990: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-000369a0: 6d6f 7279 5f69 6e74 203d 2063 6f6d 7075  mory_int = compu
-000369b0: 7461 7469 6f6e 735b 226d 656d 6f72 795f  tations["memory_
-000369c0: 7573 6167 6522 5d2e 7375 6d28 290a 2020  usage"].sum().  
-000369d0: 2020 2020 2020 2020 2020 6c69 6e65 732e            lines.
-000369e0: 6170 7065 6e64 2866 226d 656d 6f72 7920  append(f"memory 
-000369f0: 7573 6167 653a 207b 6d65 6d6f 7279 5f72  usage: {memory_r
-00036a00: 6570 7228 6d65 6d6f 7279 5f69 6e74 297d  epr(memory_int)}
-00036a10: 5c6e 2229 0a0a 2020 2020 2020 2020 7075  \n")..        pu
-00036a20: 745f 6c69 6e65 7328 6275 662c 206c 696e  t_lines(buf, lin
-00036a30: 6573 290a 0a20 2020 2040 6465 7269 7665  es)..    @derive
-00036a40: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-00036a50: 616d 6529 0a20 2020 2064 6566 206d 656d  ame).    def mem
-00036a60: 6f72 795f 7573 6167 6528 7365 6c66 2c20  ory_usage(self, 
-00036a70: 696e 6465 783d 5472 7565 2c20 6465 6570  index=True, deep
-00036a80: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00036a90: 2072 6573 756c 7420 3d20 7365 6c66 2e6d   result = self.m
-00036aa0: 6170 5f70 6172 7469 7469 6f6e 7328 4d2e  ap_partitions(M.
-00036ab0: 6d65 6d6f 7279 5f75 7361 6765 2c20 696e  memory_usage, in
-00036ac0: 6465 783d 696e 6465 782c 2064 6565 703d  dex=index, deep=
-00036ad0: 6465 6570 290a 2020 2020 2020 2020 7265  deep).        re
-00036ae0: 7375 6c74 203d 2072 6573 756c 742e 6772  sult = result.gr
-00036af0: 6f75 7062 7928 7265 7375 6c74 2e69 6e64  oupby(result.ind
-00036b00: 6578 292e 7375 6d28 290a 2020 2020 2020  ex).sum().      
-00036b10: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-00036b20: 0a20 2020 2064 6566 2070 6976 6f74 5f74  .    def pivot_t
-00036b30: 6162 6c65 2873 656c 662c 2069 6e64 6578  able(self, index
-00036b40: 3d4e 6f6e 652c 2063 6f6c 756d 6e73 3d4e  =None, columns=N
-00036b50: 6f6e 652c 2076 616c 7565 733d 4e6f 6e65  one, values=None
-00036b60: 2c20 6167 6766 756e 633d 226d 6561 6e22  , aggfunc="mean"
-00036b70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00036b80: 2020 2020 2020 2043 7265 6174 6520 6120         Create a 
-00036b90: 7370 7265 6164 7368 6565 742d 7374 796c  spreadsheet-styl
-00036ba0: 6520 7069 766f 7420 7461 626c 6520 6173  e pivot table as
-00036bb0: 2061 2044 6174 6146 7261 6d65 2e20 5461   a DataFrame. Ta
-00036bc0: 7267 6574 2060 6063 6f6c 756d 6e73 6060  rget ``columns``
-00036bd0: 0a20 2020 2020 2020 206d 7573 7420 6861  .        must ha
-00036be0: 7665 2063 6174 6567 6f72 7920 6474 7970  ve category dtyp
-00036bf0: 6520 746f 2069 6e66 6572 2072 6573 756c  e to infer resul
-00036c00: 7427 7320 6060 636f 6c75 6d6e 7360 602e  t's ``columns``.
-00036c10: 0a20 2020 2020 2020 2060 6069 6e64 6578  .        ``index
-00036c20: 6060 2c20 6060 636f 6c75 6d6e 7360 602c  ``, ``columns``,
-00036c30: 2060 6076 616c 7565 7360 6020 616e 6420   ``values`` and 
-00036c40: 6060 6167 6766 756e 6360 6020 6d75 7374  ``aggfunc`` must
-00036c50: 2062 6520 616c 6c20 7363 616c 6172 2e0a   be all scalar..
-00036c60: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00036c70: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00036c80: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2076  ------.        v
-00036c90: 616c 7565 7320 3a20 7363 616c 6172 0a20  alues : scalar. 
-00036ca0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00036cb0: 6e20 746f 2061 6767 7265 6761 7465 0a20  n to aggregate. 
-00036cc0: 2020 2020 2020 2069 6e64 6578 203a 2073         index : s
-00036cd0: 6361 6c61 720a 2020 2020 2020 2020 2020  calar.          
-00036ce0: 2020 636f 6c75 6d6e 2074 6f20 6265 2069    column to be i
-00036cf0: 6e64 6578 0a20 2020 2020 2020 2063 6f6c  ndex.        col
-00036d00: 756d 6e73 203a 2073 6361 6c61 720a 2020  umns : scalar.  
-00036d10: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00036d20: 2074 6f20 6265 2063 6f6c 756d 6e73 0a20   to be columns. 
-00036d30: 2020 2020 2020 2061 6767 6675 6e63 203a         aggfunc :
-00036d40: 207b 276d 6561 6e27 2c20 2773 756d 272c   {'mean', 'sum',
-00036d50: 2027 636f 756e 7427 7d2c 2064 6566 6175   'count'}, defau
-00036d60: 6c74 2027 6d65 616e 270a 0a20 2020 2020  lt 'mean'..     
-00036d70: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-00036d80: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-00036d90: 2020 2074 6162 6c65 203a 2044 6174 6146     table : DataF
-00036da0: 7261 6d65 0a20 2020 2020 2020 2022 2222  rame.        """
-00036db0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-00036dc0: 736b 2e64 6174 6166 7261 6d65 2e72 6573  sk.dataframe.res
-00036dd0: 6861 7065 2069 6d70 6f72 7420 7069 766f  hape import pivo
-00036de0: 745f 7461 626c 650a 0a20 2020 2020 2020  t_table..       
-00036df0: 2072 6574 7572 6e20 7069 766f 745f 7461   return pivot_ta
-00036e00: 626c 6528 0a20 2020 2020 2020 2020 2020  ble(.           
-00036e10: 2073 656c 662c 2069 6e64 6578 3d69 6e64   self, index=ind
-00036e20: 6578 2c20 636f 6c75 6d6e 733d 636f 6c75  ex, columns=colu
-00036e30: 6d6e 732c 2076 616c 7565 733d 7661 6c75  mns, values=valu
-00036e40: 6573 2c20 6167 6766 756e 633d 6167 6766  es, aggfunc=aggf
-00036e50: 756e 630a 2020 2020 2020 2020 290a 0a20  unc.        ).. 
-00036e60: 2020 2064 6566 206d 656c 7428 0a20 2020     def melt(.   
-00036e70: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00036e80: 2020 2069 645f 7661 7273 3d4e 6f6e 652c     id_vars=None,
-00036e90: 0a20 2020 2020 2020 2076 616c 7565 5f76  .        value_v
-00036ea0: 6172 733d 4e6f 6e65 2c0a 2020 2020 2020  ars=None,.      
-00036eb0: 2020 7661 725f 6e61 6d65 3d4e 6f6e 652c    var_name=None,
-00036ec0: 0a20 2020 2020 2020 2076 616c 7565 5f6e  .        value_n
-00036ed0: 616d 653d 2276 616c 7565 222c 0a20 2020  ame="value",.   
-00036ee0: 2020 2020 2063 6f6c 5f6c 6576 656c 3d4e       col_level=N
-00036ef0: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-00036f00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00036f10: 556e 7069 766f 7473 2061 2044 6174 6146  Unpivots a DataF
-00036f20: 7261 6d65 2066 726f 6d20 7769 6465 2066  rame from wide f
-00036f30: 6f72 6d61 7420 746f 206c 6f6e 6720 666f  ormat to long fo
-00036f40: 726d 6174 2c0a 2020 2020 2020 2020 6f70  rmat,.        op
-00036f50: 7469 6f6e 616c 6c79 206c 6561 7669 6e67  tionally leaving
-00036f60: 2069 6465 6e74 6966 6965 7220 7661 7269   identifier vari
-00036f70: 6162 6c65 7320 7365 742e 0a0a 2020 2020  ables set...    
-00036f80: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-00036f90: 6e20 6973 2075 7365 6675 6c20 746f 206d  n is useful to m
-00036fa0: 6173 7361 6765 2061 2044 6174 6146 7261  assage a DataFra
-00036fb0: 6d65 2069 6e74 6f20 6120 666f 726d 6174  me into a format
-00036fc0: 2077 6865 7265 0a20 2020 2020 2020 206f   where.        o
-00036fd0: 6e65 206f 7220 6d6f 7265 2063 6f6c 756d  ne or more colum
-00036fe0: 6e73 2061 7265 2069 6465 6e74 6966 6965  ns are identifie
-00036ff0: 7220 7661 7269 6162 6c65 7320 2860 6069  r variables (``i
-00037000: 645f 7661 7273 6060 292c 2077 6869 6c65  d_vars``), while
-00037010: 0a20 2020 2020 2020 2061 6c6c 206f 7468  .        all oth
-00037020: 6572 2063 6f6c 756d 6e73 2c20 636f 6e73  er columns, cons
-00037030: 6964 6572 6564 206d 6561 7375 7265 6420  idered measured 
-00037040: 7661 7269 6162 6c65 7320 2860 6076 616c  variables (``val
-00037050: 7565 5f76 6172 7360 6029 2c0a 2020 2020  ue_vars``),.    
-00037060: 2020 2020 6172 6520 2275 6e70 6976 6f74      are "unpivot
-00037070: 6564 2220 746f 2074 6865 2072 6f77 2061  ed" to the row a
-00037080: 7869 732c 206c 6561 7669 6e67 206a 7573  xis, leaving jus
-00037090: 7420 7477 6f20 6e6f 6e2d 6964 656e 7469  t two non-identi
-000370a0: 6669 6572 0a20 2020 2020 2020 2063 6f6c  fier.        col
-000370b0: 756d 6e73 2c20 2776 6172 6961 626c 6527  umns, 'variable'
-000370c0: 2061 6e64 2027 7661 6c75 6527 2e0a 0a20   and 'value'... 
-000370d0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-000370e0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-000370f0: 2d2d 2d2d 0a20 2020 2020 2020 2066 7261  ----.        fra
-00037100: 6d65 203a 2044 6174 6146 7261 6d65 0a20  me : DataFrame. 
-00037110: 2020 2020 2020 2069 645f 7661 7273 203a         id_vars :
-00037120: 2074 7570 6c65 2c20 6c69 7374 2c20 6f72   tuple, list, or
-00037130: 206e 6461 7272 6179 2c20 6f70 7469 6f6e   ndarray, option
-00037140: 616c 0a20 2020 2020 2020 2020 2020 2043  al.            C
-00037150: 6f6c 756d 6e28 7329 2074 6f20 7573 6520  olumn(s) to use 
-00037160: 6173 2069 6465 6e74 6966 6965 7220 7661  as identifier va
-00037170: 7269 6162 6c65 732e 0a20 2020 2020 2020  riables..       
-00037180: 2076 616c 7565 5f76 6172 7320 3a20 7475   value_vars : tu
-00037190: 706c 652c 206c 6973 742c 206f 7220 6e64  ple, list, or nd
-000371a0: 6172 7261 792c 206f 7074 696f 6e61 6c0a  array, optional.
-000371b0: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
-000371c0: 6d6e 2873 2920 746f 2075 6e70 6976 6f74  mn(s) to unpivot
-000371d0: 2e20 4966 206e 6f74 2073 7065 6369 6669  . If not specifi
-000371e0: 6564 2c20 7573 6573 2061 6c6c 2063 6f6c  ed, uses all col
-000371f0: 756d 6e73 2074 6861 740a 2020 2020 2020  umns that.      
-00037200: 2020 2020 2020 6172 6520 6e6f 7420 7365        are not se
-00037210: 7420 6173 2060 6964 5f76 6172 7360 2e0a  t as `id_vars`..
-00037220: 2020 2020 2020 2020 7661 725f 6e61 6d65          var_name
-00037230: 203a 2073 6361 6c61 720a 2020 2020 2020   : scalar.      
-00037240: 2020 2020 2020 4e61 6d65 2074 6f20 7573        Name to us
-00037250: 6520 666f 7220 7468 6520 2776 6172 6961  e for the 'varia
-00037260: 626c 6527 2063 6f6c 756d 6e2e 2049 6620  ble' column. If 
-00037270: 4e6f 6e65 2069 7420 7573 6573 0a20 2020  None it uses.   
-00037280: 2020 2020 2020 2020 2060 6066 7261 6d65           ``frame
-00037290: 2e63 6f6c 756d 6e73 2e6e 616d 6560 6020  .columns.name`` 
-000372a0: 6f72 2027 7661 7269 6162 6c65 272e 0a20  or 'variable'.. 
-000372b0: 2020 2020 2020 2076 616c 7565 5f6e 616d         value_nam
-000372c0: 6520 3a20 7363 616c 6172 2c20 6465 6661  e : scalar, defa
-000372d0: 756c 7420 2776 616c 7565 270a 2020 2020  ult 'value'.    
-000372e0: 2020 2020 2020 2020 4e61 6d65 2074 6f20          Name to 
-000372f0: 7573 6520 666f 7220 7468 6520 2776 616c  use for the 'val
-00037300: 7565 2720 636f 6c75 6d6e 2e0a 2020 2020  ue' column..    
-00037310: 2020 2020 636f 6c5f 6c65 7665 6c20 3a20      col_level : 
-00037320: 696e 7420 6f72 2073 7472 696e 672c 206f  int or string, o
-00037330: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00037340: 2020 2020 4966 2063 6f6c 756d 6e73 2061      If columns a
-00037350: 7265 2061 204d 756c 7469 496e 6465 7820  re a MultiIndex 
-00037360: 7468 656e 2075 7365 2074 6869 7320 6c65  then use this le
-00037370: 7665 6c20 746f 206d 656c 742e 0a0a 2020  vel to melt...  
-00037380: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00037390: 2020 2020 2020 2d2d 2d2d 2d2d 2d0a 2020        -------.  
-000373a0: 2020 2020 2020 4461 7461 4672 616d 650a        DataFrame.
-000373b0: 2020 2020 2020 2020 2020 2020 556e 7069              Unpi
-000373c0: 766f 7465 6420 4461 7461 4672 616d 652e  voted DataFrame.
-000373d0: 0a0a 2020 2020 2020 2020 5365 6520 416c  ..        See Al
-000373e0: 736f 0a20 2020 2020 2020 202d 2d2d 2d2d  so.        -----
-000373f0: 2d2d 2d0a 2020 2020 2020 2020 7061 6e64  ---.        pand
-00037400: 6173 2e44 6174 6146 7261 6d65 2e6d 656c  as.DataFrame.mel
-00037410: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-00037420: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00037430: 6461 7461 6672 616d 652e 7265 7368 6170  dataframe.reshap
-00037440: 6520 696d 706f 7274 206d 656c 740a 0a20  e import melt.. 
-00037450: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
-00037460: 6c74 280a 2020 2020 2020 2020 2020 2020  lt(.            
-00037470: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-00037480: 2020 6964 5f76 6172 733d 6964 5f76 6172    id_vars=id_var
-00037490: 732c 0a20 2020 2020 2020 2020 2020 2076  s,.            v
-000374a0: 616c 7565 5f76 6172 733d 7661 6c75 655f  alue_vars=value_
-000374b0: 7661 7273 2c0a 2020 2020 2020 2020 2020  vars,.          
-000374c0: 2020 7661 725f 6e61 6d65 3d76 6172 5f6e    var_name=var_n
-000374d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-000374e0: 2076 616c 7565 5f6e 616d 653d 7661 6c75   value_name=valu
-000374f0: 655f 6e61 6d65 2c0a 2020 2020 2020 2020  e_name,.        
-00037500: 2020 2020 636f 6c5f 6c65 7665 6c3d 636f      col_level=co
-00037510: 6c5f 6c65 7665 6c2c 0a20 2020 2020 2020  l_level,.       
-00037520: 2029 0a0a 2020 2020 6465 6620 746f 5f72   )..    def to_r
-00037530: 6563 6f72 6473 2873 656c 662c 2069 6e64  ecords(self, ind
-00037540: 6578 3d46 616c 7365 2c20 6c65 6e67 7468  ex=False, length
-00037550: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-00037560: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-00037570: 7261 6d65 2e69 6f20 696d 706f 7274 2074  rame.io import t
-00037580: 6f5f 7265 636f 7264 730a 0a20 2020 2020  o_records..     
-00037590: 2020 2069 6620 6c65 6e67 7468 7320 6973     if lengths is
-000375a0: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-000375b0: 2020 206c 656e 6774 6873 203d 2074 7570     lengths = tup
-000375c0: 6c65 2873 656c 662e 6d61 705f 7061 7274  le(self.map_part
-000375d0: 6974 696f 6e73 286c 656e 292e 636f 6d70  itions(len).comp
-000375e0: 7574 6528 2929 0a0a 2020 2020 2020 2020  ute())..        
-000375f0: 7265 636f 7264 7320 3d20 746f 5f72 6563  records = to_rec
-00037600: 6f72 6473 2873 656c 6629 0a0a 2020 2020  ords(self)..    
-00037610: 2020 2020 6368 756e 6b73 203d 2073 656c      chunks = sel
-00037620: 662e 5f76 616c 6964 6174 655f 6368 756e  f._validate_chun
-00037630: 6b73 2872 6563 6f72 6473 2c20 6c65 6e67  ks(records, leng
-00037640: 7468 7329 0a20 2020 2020 2020 2072 6563  ths).        rec
-00037650: 6f72 6473 2e5f 6368 756e 6b73 203d 2028  ords._chunks = (
-00037660: 6368 756e 6b73 5b30 5d2c 290a 0a20 2020  chunks[0],)..   
-00037670: 2020 2020 2072 6574 7572 6e20 7265 636f       return reco
-00037680: 7264 730a 0a20 2020 2040 6465 7269 7665  rds..    @derive
-00037690: 645f 6672 6f6d 2870 642e 4461 7461 4672  d_from(pd.DataFr
-000376a0: 616d 6529 0a20 2020 2064 6566 2074 6f5f  ame).    def to_
-000376b0: 6874 6d6c 2873 656c 662c 206d 6178 5f72  html(self, max_r
-000376c0: 6f77 733d 3529 3a0a 2020 2020 2020 2020  ows=5):.        
-000376d0: 2320 7064 2e53 6572 6965 7320 646f 6573  # pd.Series does
-000376e0: 6e27 7420 6861 7665 2068 746d 6c20 7265  n't have html re
-000376f0: 7072 0a20 2020 2020 2020 2064 6174 6120  pr.        data 
-00037700: 3d20 7365 6c66 2e5f 7265 7072 5f64 6174  = self._repr_dat
-00037710: 6128 292e 746f 5f68 746d 6c28 6d61 785f  a().to_html(max_
-00037720: 726f 7773 3d6d 6178 5f72 6f77 732c 2073  rows=max_rows, s
-00037730: 686f 775f 6469 6d65 6e73 696f 6e73 3d46  how_dimensions=F
-00037740: 616c 7365 290a 2020 2020 2020 2020 7265  alse).        re
-00037750: 7475 726e 2067 6574 5f74 656d 706c 6174  turn get_templat
-00037760: 6528 2264 6174 6166 7261 6d65 2e68 746d  e("dataframe.htm
-00037770: 6c2e 6a32 2229 2e72 656e 6465 7228 0a20  l.j2").render(. 
-00037780: 2020 2020 2020 2020 2020 2064 6174 613d             data=
-00037790: 6461 7461 2c0a 2020 2020 2020 2020 2020  data,.          
-000377a0: 2020 6e61 6d65 3d73 656c 662e 5f6e 616d    name=self._nam
-000377b0: 652c 0a20 2020 2020 2020 2020 2020 206c  e,.            l
-000377c0: 6179 6572 733d 6d61 7962 655f 706c 7572  ayers=maybe_plur
-000377d0: 616c 697a 6528 6c65 6e28 7365 6c66 2e64  alize(len(self.d
-000377e0: 6173 6b2e 6c61 7965 7273 292c 2022 6772  ask.layers), "gr
-000377f0: 6170 6820 6c61 7965 7222 292c 0a20 2020  aph layer"),.   
-00037800: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00037810: 5f72 6570 725f 6461 7461 2873 656c 6629  _repr_data(self)
-00037820: 3a0a 2020 2020 2020 2020 6d65 7461 203d  :.        meta =
-00037830: 2073 656c 662e 5f6d 6574 610a 2020 2020   self._meta.    
-00037840: 2020 2020 696e 6465 7820 3d20 7365 6c66      index = self
-00037850: 2e5f 7265 7072 5f64 6976 6973 696f 6e73  ._repr_divisions
-00037860: 0a20 2020 2020 2020 2063 6f6c 7320 3d20  .        cols = 
-00037870: 6d65 7461 2e63 6f6c 756d 6e73 0a20 2020  meta.columns.   
-00037880: 2020 2020 2069 6620 6c65 6e28 636f 6c73       if len(cols
-00037890: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-000378a0: 2020 2020 7365 7269 6573 5f64 6620 3d20      series_df = 
-000378b0: 7064 2e44 6174 6146 7261 6d65 285b 5b5d  pd.DataFrame([[]
-000378c0: 5d20 2a20 6c65 6e28 696e 6465 7829 2c20  ] * len(index), 
-000378d0: 636f 6c75 6d6e 733d 636f 6c73 2c20 696e  columns=cols, in
-000378e0: 6465 783d 696e 6465 7829 0a20 2020 2020  dex=index).     
-000378f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00037900: 2020 2020 2073 6572 6965 735f 6466 203d       series_df =
-00037910: 2070 642e 636f 6e63 6174 280a 2020 2020   pd.concat(.    
-00037920: 2020 2020 2020 2020 2020 2020 5b5f 7265              [_re
-00037930: 7072 5f64 6174 615f 7365 7269 6573 2873  pr_data_series(s
-00037940: 2c20 696e 6465 783d 696e 6465 7829 2066  , index=index) f
-00037950: 6f72 205f 2c20 7320 696e 206d 6574 612e  or _, s in meta.
-00037960: 6974 656d 7328 295d 2c20 6178 6973 3d31  items()], axis=1
-00037970: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00037980: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00037990: 7269 6573 5f64 660a 0a20 2020 2064 6566  ries_df..    def
-000379a0: 205f 7265 7072 5f68 746d 6c5f 2873 656c   _repr_html_(sel
-000379b0: 6629 3a0a 2020 2020 2020 2020 6461 7461  f):.        data
-000379c0: 203d 2073 656c 662e 5f72 6570 725f 6461   = self._repr_da
-000379d0: 7461 2829 2e74 6f5f 6874 6d6c 280a 2020  ta().to_html(.  
-000379e0: 2020 2020 2020 2020 2020 6d61 785f 726f            max_ro
-000379f0: 7773 3d35 2c20 7368 6f77 5f64 696d 656e  ws=5, show_dimen
-00037a00: 7369 6f6e 733d 4661 6c73 652c 206e 6f74  sions=False, not
-00037a10: 6562 6f6f 6b3d 5472 7565 0a20 2020 2020  ebook=True.     
-00037a20: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-00037a30: 7572 6e20 6765 745f 7465 6d70 6c61 7465  urn get_template
-00037a40: 2822 6461 7461 6672 616d 652e 6874 6d6c  ("dataframe.html
-00037a50: 2e6a 3222 292e 7265 6e64 6572 280a 2020  .j2").render(.  
-00037a60: 2020 2020 2020 2020 2020 6461 7461 3d64            data=d
-00037a70: 6174 612c 0a20 2020 2020 2020 2020 2020  ata,.           
-00037a80: 206e 616d 653d 7365 6c66 2e5f 6e61 6d65   name=self._name
-00037a90: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00037aa0: 7965 7273 3d6d 6179 6265 5f70 6c75 7261  yers=maybe_plura
-00037ab0: 6c69 7a65 286c 656e 2873 656c 662e 6461  lize(len(self.da
-00037ac0: 736b 2e6c 6179 6572 7329 2c20 2267 7261  sk.layers), "gra
-00037ad0: 7068 206c 6179 6572 2229 2c0a 2020 2020  ph layer"),.    
-00037ae0: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00037af0: 7365 6c65 6374 5f63 6f6c 756d 6e73 5f6f  select_columns_o
-00037b00: 725f 696e 6465 7828 7365 6c66 2c20 636f  r_index(self, co
-00037b10: 6c75 6d6e 735f 6f72 5f69 6e64 6578 293a  lumns_or_index):
-00037b20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00037b30: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00037b40: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00037b50: 2d2d 0a20 2020 2020 2020 2063 6f6c 756d  --.        colum
-00037b60: 6e73 5f6f 725f 696e 6465 780a 2020 2020  ns_or_index.    
-00037b70: 2020 2020 2020 2020 436f 6c75 6d6e 206f          Column o
-00037b80: 7220 696e 6465 7820 6e61 6d65 2c20 6f72  r index name, or
-00037b90: 2061 206c 6973 7420 6f66 2074 6865 7365   a list of these
-00037ba0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00037bb0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-00037bc0: 2d0a 2020 2020 2020 2020 6464 2e44 6174  -.        dd.Dat
-00037bd0: 6146 7261 6d65 0a20 2020 2020 2020 2020  aFrame.         
-00037be0: 2020 2044 6173 6b20 4461 7461 4672 616d     Dask DataFram
-00037bf0: 6520 7769 7468 2063 6f6c 756d 6e73 2063  e with columns c
-00037c00: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-00037c10: 6561 6368 2063 6f6c 756d 6e20 6f72 0a20  each column or. 
-00037c20: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00037c30: 206c 6576 656c 2069 6e20 636f 6c75 6d6e   level in column
-00037c40: 735f 6f72 5f69 6e64 6578 2e20 2049 6620  s_or_index.  If 
-00037c50: 696e 636c 7564 6564 2c20 7468 6520 636f  included, the co
-00037c60: 6c75 6d6e 0a20 2020 2020 2020 2020 2020  lumn.           
-00037c70: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00037c80: 6f20 7468 6520 696e 6465 7820 6c65 7665  o the index leve
-00037c90: 6c20 6973 206e 616d 6564 205f 696e 6465  l is named _inde
-00037ca0: 780a 2020 2020 2020 2020 2222 220a 0a20  x.        """.. 
-00037cb0: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
-00037cc0: 636f 6c75 6d6e 735f 6f72 5f69 6e64 6578  columns_or_index
-00037cd0: 2069 7320 6120 6c69 7374 0a20 2020 2020   is a list.     
-00037ce0: 2020 2063 6f6c 756d 6e73 5f6f 725f 696e     columns_or_in
-00037cf0: 6465 7820 3d20 280a 2020 2020 2020 2020  dex = (.        
-00037d00: 2020 2020 636f 6c75 6d6e 735f 6f72 5f69      columns_or_i
-00037d10: 6e64 6578 0a20 2020 2020 2020 2020 2020  ndex.           
-00037d20: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
-00037d30: 6f6c 756d 6e73 5f6f 725f 696e 6465 782c  olumns_or_index,
-00037d40: 206c 6973 7429 0a20 2020 2020 2020 2020   list).         
-00037d50: 2020 2065 6c73 6520 5b63 6f6c 756d 6e73     else [columns
-00037d60: 5f6f 725f 696e 6465 785d 0a20 2020 2020  _or_index].     
-00037d70: 2020 2029 0a0a 2020 2020 2020 2020 636f     )..        co
-00037d80: 6c75 6d6e 5f6e 616d 6573 203d 205b 0a20  lumn_names = [. 
-00037d90: 2020 2020 2020 2020 2020 206e 2066 6f72             n for
-00037da0: 206e 2069 6e20 636f 6c75 6d6e 735f 6f72   n in columns_or
-00037db0: 5f69 6e64 6578 2069 6620 7365 6c66 2e5f  _index if self._
-00037dc0: 6973 5f63 6f6c 756d 6e5f 6c61 6265 6c5f  is_column_label_
-00037dd0: 7265 6665 7265 6e63 6528 6e29 0a20 2020  reference(n).   
-00037de0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-00037df0: 7365 6c65 6374 6564 5f64 6620 3d20 7365  selected_df = se
-00037e00: 6c66 5b63 6f6c 756d 6e5f 6e61 6d65 735d  lf[column_names]
-00037e10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00037e20: 2e5f 636f 6e74 6169 6e73 5f69 6e64 6578  ._contains_index
-00037e30: 5f6e 616d 6528 636f 6c75 6d6e 735f 6f72  _name(columns_or
-00037e40: 5f69 6e64 6578 293a 0a20 2020 2020 2020  _index):.       
-00037e50: 2020 2020 2023 2049 6e64 6578 206e 616d       # Index nam
-00037e60: 6520 7761 7320 696e 636c 7564 6564 0a20  e was included. 
-00037e70: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-00037e80: 7465 645f 6466 203d 2073 656c 6563 7465  ted_df = selecte
-00037e90: 645f 6466 2e61 7373 6967 6e28 5f69 6e64  d_df.assign(_ind
-00037ea0: 6578 3d73 656c 662e 696e 6465 7829 0a0a  ex=self.index)..
-00037eb0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00037ec0: 656c 6563 7465 645f 6466 0a0a 2020 2020  elected_df..    
-00037ed0: 6465 6620 5f69 735f 636f 6c75 6d6e 5f6c  def _is_column_l
-00037ee0: 6162 656c 5f72 6566 6572 656e 6365 2873  abel_reference(s
-00037ef0: 656c 662c 206b 6579 293a 0a20 2020 2020  elf, key):.     
-00037f00: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-00037f10: 6573 7420 7768 6574 6865 7220 6120 6b65  est whether a ke
-00037f20: 7920 6973 2061 2063 6f6c 756d 6e20 6c61  y is a column la
-00037f30: 6265 6c20 7265 6665 7265 6e63 650a 0a20  bel reference.. 
-00037f40: 2020 2020 2020 2054 6f20 6265 2063 6f6e         To be con
-00037f50: 7369 6465 7265 6420 6120 636f 6c75 6d6e  sidered a column
-00037f60: 206c 6162 656c 2072 6566 6572 656e 6365   label reference
-00037f70: 2c20 606b 6579 6020 6d75 7374 206d 6174  , `key` must mat
-00037f80: 6368 2074 6865 206e 616d 6520 6f66 2061  ch the name of a
-00037f90: 740a 2020 2020 2020 2020 6c65 6173 7420  t.        least 
-00037fa0: 6f6e 6520 636f 6c75 6d6e 2e0a 2020 2020  one column..    
-00037fb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00037fc0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-00037fd0: 2020 2020 206e 6f74 2069 735f 6461 736b       not is_dask
-00037fe0: 5f63 6f6c 6c65 6374 696f 6e28 6b65 7929  _collection(key)
-00037ff0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-00038000: 2028 6e70 2e69 7373 6361 6c61 7228 6b65   (np.isscalar(ke
-00038010: 7929 206f 7220 6973 696e 7374 616e 6365  y) or isinstance
-00038020: 286b 6579 2c20 7475 706c 6529 290a 2020  (key, tuple)).  
-00038030: 2020 2020 2020 2020 2020 616e 6420 6b65            and ke
-00038040: 7920 696e 2073 656c 662e 636f 6c75 6d6e  y in self.column
-00038050: 730a 2020 2020 2020 2020 290a 0a20 2020  s.        )..   
-00038060: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00038070: 2020 6465 6620 6672 6f6d 5f64 6963 7428    def from_dict(
-00038080: 0a20 2020 2020 2020 2063 6c73 2c20 6461  .        cls, da
-00038090: 7461 2c20 2a2c 206e 7061 7274 6974 696f  ta, *, npartitio
-000380a0: 6e73 2c20 6f72 6965 6e74 3d22 636f 6c75  ns, orient="colu
-000380b0: 6d6e 7322 2c20 6474 7970 653d 4e6f 6e65  mns", dtype=None
-000380c0: 2c20 636f 6c75 6d6e 733d 4e6f 6e65 0a20  , columns=None. 
-000380d0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-000380e0: 220a 2020 2020 2020 2020 436f 6e73 7472  ".        Constr
-000380f0: 7563 7420 6120 4461 736b 2044 6174 6146  uct a Dask DataF
-00038100: 7261 6d65 2066 726f 6d20 6120 5079 7468  rame from a Pyth
-00038110: 6f6e 2044 6963 7469 6f6e 6172 790a 0a20  on Dictionary.. 
-00038120: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00038130: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00038140: 0a20 2020 2020 2020 2064 6173 6b2e 6461  .        dask.da
-00038150: 7461 6672 616d 652e 6672 6f6d 5f64 6963  taframe.from_dic
-00038160: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
-00038170: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00038180: 6461 7461 6672 616d 652e 696f 2069 6d70  dataframe.io imp
-00038190: 6f72 7420 6672 6f6d 5f64 6963 740a 0a20  ort from_dict.. 
-000381a0: 2020 2020 2020 2072 6574 7572 6e20 6672         return fr
-000381b0: 6f6d 5f64 6963 7428 0a20 2020 2020 2020  om_dict(.       
-000381c0: 2020 2020 2064 6174 612c 0a20 2020 2020       data,.     
-000381d0: 2020 2020 2020 206e 7061 7274 6974 696f         npartitio
-000381e0: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
-000381f0: 6f72 6965 6e74 3d6f 7269 656e 742c 0a20  orient=orient,. 
-00038200: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
-00038210: 3d64 7479 7065 2c0a 2020 2020 2020 2020  =dtype,.        
-00038220: 2020 2020 636f 6c75 6d6e 733d 636f 6c75      columns=colu
-00038230: 6d6e 732c 0a20 2020 2020 2020 2020 2020  mns,.           
-00038240: 2063 6f6e 7374 7275 6374 6f72 3d63 6c73   constructor=cls
-00038250: 2e5f 7061 7274 6974 696f 6e5f 7479 7065  ._partition_type
-00038260: 2c0a 2020 2020 2020 2020 290a 0a0a 2320  ,.        )...# 
-00038270: 6269 6e64 206f 7065 7261 746f 7273 0a23  bind operators.#
-00038280: 2054 4f44 4f3a 2064 796e 616d 6963 616c   TODO: dynamical
-00038290: 6c79 2062 6f75 6e64 206f 7065 7261 746f  ly bound operato
-000382a0: 7273 2061 7265 2064 6566 6561 7469 6e67  rs are defeating
-000382b0: 2074 7970 6520 616e 6e6f 7461 7469 6f6e   type annotation
-000382c0: 730a 666f 7220 6f70 2069 6e20 5b0a 2020  s.for op in [.  
-000382d0: 2020 6f70 6572 6174 6f72 2e61 6273 2c0a    operator.abs,.
-000382e0: 2020 2020 6f70 6572 6174 6f72 2e61 6464      operator.add
-000382f0: 2c0a 2020 2020 6f70 6572 6174 6f72 2e61  ,.    operator.a
-00038300: 6e64 5f2c 0a20 2020 206f 7065 7261 746f  nd_,.    operato
-00038310: 722e 6571 2c0a 2020 2020 6f70 6572 6174  r.eq,.    operat
-00038320: 6f72 2e67 742c 0a20 2020 206f 7065 7261  or.gt,.    opera
-00038330: 746f 722e 6765 2c0a 2020 2020 6f70 6572  tor.ge,.    oper
-00038340: 6174 6f72 2e69 6e76 2c0a 2020 2020 6f70  ator.inv,.    op
-00038350: 6572 6174 6f72 2e6c 742c 0a20 2020 206f  erator.lt,.    o
-00038360: 7065 7261 746f 722e 6c65 2c0a 2020 2020  perator.le,.    
-00038370: 6f70 6572 6174 6f72 2e6d 6f64 2c0a 2020  operator.mod,.  
-00038380: 2020 6f70 6572 6174 6f72 2e6d 756c 2c0a    operator.mul,.
-00038390: 2020 2020 6f70 6572 6174 6f72 2e6e 652c      operator.ne,
-000383a0: 0a20 2020 206f 7065 7261 746f 722e 6e65  .    operator.ne
-000383b0: 672c 0a20 2020 206f 7065 7261 746f 722e  g,.    operator.
-000383c0: 6f72 5f2c 0a20 2020 206f 7065 7261 746f  or_,.    operato
-000383d0: 722e 706f 772c 0a20 2020 206f 7065 7261  r.pow,.    opera
-000383e0: 746f 722e 7375 622c 0a20 2020 206f 7065  tor.sub,.    ope
-000383f0: 7261 746f 722e 7472 7565 6469 762c 0a20  rator.truediv,. 
-00038400: 2020 206f 7065 7261 746f 722e 666c 6f6f     operator.floo
-00038410: 7264 6976 2c0a 2020 2020 6f70 6572 6174  rdiv,.    operat
-00038420: 6f72 2e78 6f72 2c0a 5d3a 0a20 2020 205f  or.xor,.]:.    _
-00038430: 4672 616d 652e 5f62 696e 645f 6f70 6572  Frame._bind_oper
-00038440: 6174 6f72 286f 7029 0a20 2020 2053 6361  ator(op).    Sca
-00038450: 6c61 722e 5f62 696e 645f 6f70 6572 6174  lar._bind_operat
-00038460: 6f72 286f 7029 0a0a 666f 7220 6e61 6d65  or(op)..for name
-00038470: 2069 6e20 5b0a 2020 2020 2261 6464 222c   in [.    "add",
-00038480: 0a20 2020 2022 7375 6222 2c0a 2020 2020  .    "sub",.    
-00038490: 226d 756c 222c 0a20 2020 2022 6469 7622  "mul",.    "div"
-000384a0: 2c0a 2020 2020 2264 6976 6964 6522 2c0a  ,.    "divide",.
-000384b0: 2020 2020 2274 7275 6564 6976 222c 0a20      "truediv",. 
-000384c0: 2020 2022 666c 6f6f 7264 6976 222c 0a20     "floordiv",. 
-000384d0: 2020 2022 6d6f 6422 2c0a 2020 2020 2270     "mod",.    "p
-000384e0: 6f77 222c 0a20 2020 2022 7261 6464 222c  ow",.    "radd",
-000384f0: 0a20 2020 2022 7273 7562 222c 0a20 2020  .    "rsub",.   
-00038500: 2022 726d 756c 222c 0a20 2020 2022 7264   "rmul",.    "rd
-00038510: 6976 222c 0a20 2020 2022 7274 7275 6564  iv",.    "rtrued
-00038520: 6976 222c 0a20 2020 2022 7266 6c6f 6f72  iv",.    "rfloor
-00038530: 6469 7622 2c0a 2020 2020 2272 6d6f 6422  div",.    "rmod"
-00038540: 2c0a 2020 2020 2272 706f 7722 2c0a 5d3a  ,.    "rpow",.]:
-00038550: 0a20 2020 206d 6574 6820 3d20 6765 7461  .    meth = geta
-00038560: 7474 7228 7064 2e44 6174 6146 7261 6d65  ttr(pd.DataFrame
-00038570: 2c20 6e61 6d65 290a 2020 2020 4461 7461  , name).    Data
-00038580: 4672 616d 652e 5f62 696e 645f 6f70 6572  Frame._bind_oper
-00038590: 6174 6f72 5f6d 6574 686f 6428 6e61 6d65  ator_method(name
-000385a0: 2c20 6d65 7468 290a 0a20 2020 206d 6574  , meth)..    met
-000385b0: 6820 3d20 6765 7461 7474 7228 7064 2e53  h = getattr(pd.S
-000385c0: 6572 6965 732c 206e 616d 6529 0a20 2020  eries, name).   
-000385d0: 2053 6572 6965 732e 5f62 696e 645f 6f70   Series._bind_op
-000385e0: 6572 6174 6f72 5f6d 6574 686f 6428 6e61  erator_method(na
-000385f0: 6d65 2c20 6d65 7468 290a 0a66 6f72 206e  me, meth)..for n
-00038600: 616d 6520 696e 205b 226c 7422 2c20 2267  ame in ["lt", "g
-00038610: 7422 2c20 226c 6522 2c20 2267 6522 2c20  t", "le", "ge", 
-00038620: 226e 6522 2c20 2265 7122 5d3a 0a20 2020  "ne", "eq"]:.   
-00038630: 206d 6574 6820 3d20 6765 7461 7474 7228   meth = getattr(
-00038640: 7064 2e44 6174 6146 7261 6d65 2c20 6e61  pd.DataFrame, na
-00038650: 6d65 290a 2020 2020 4461 7461 4672 616d  me).    DataFram
-00038660: 652e 5f62 696e 645f 636f 6d70 6172 6973  e._bind_comparis
-00038670: 6f6e 5f6d 6574 686f 6428 6e61 6d65 2c20  on_method(name, 
-00038680: 6d65 7468 290a 0a20 2020 206d 6574 6820  meth)..    meth 
-00038690: 3d20 6765 7461 7474 7228 7064 2e53 6572  = getattr(pd.Ser
-000386a0: 6965 732c 206e 616d 6529 0a20 2020 2053  ies, name).    S
-000386b0: 6572 6965 732e 5f62 696e 645f 636f 6d70  eries._bind_comp
-000386c0: 6172 6973 6f6e 5f6d 6574 686f 6428 6e61  arison_method(na
-000386d0: 6d65 2c20 6d65 7468 290a 0a0a 6465 6620  me, meth)...def 
-000386e0: 6973 5f62 726f 6164 6361 7374 6162 6c65  is_broadcastable
-000386f0: 2864 6673 2c20 7329 3a0a 2020 2020 2222  (dfs, s):.    ""
-00038700: 220a 2020 2020 5468 6973 2053 6572 6965  ".    This Serie
-00038710: 7320 6973 2062 726f 6164 6361 7374 6162  s is broadcastab
-00038720: 6c65 2061 6761 696e 7374 2061 6e6f 7468  le against anoth
-00038730: 6572 2064 6174 6166 7261 6d65 2069 6e20  er dataframe in 
-00038740: 7468 6520 7365 7175 656e 6365 0a20 2020  the sequence.   
-00038750: 2022 2222 0a0a 2020 2020 6465 6620 636f   """..    def co
-00038760: 6d70 6172 6528 732c 2064 6629 3a0a 2020  mpare(s, df):.  
-00038770: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00038780: 2020 2020 2020 2072 6574 7572 6e20 732e         return s.
-00038790: 6469 7669 7369 6f6e 7320 3d3d 2028 6466  divisions == (df
-000387a0: 2e63 6f6c 756d 6e73 2e6d 696e 2829 2c20  .columns.min(), 
-000387b0: 6466 2e63 6f6c 756d 6e73 2e6d 6178 2829  df.columns.max()
-000387c0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-000387d0: 2054 7970 6545 7272 6f72 3a0a 2020 2020   TypeError:.    
-000387e0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000387f0: 616c 7365 0a0a 2020 2020 7265 7475 726e  alse..    return
-00038800: 2028 0a20 2020 2020 2020 2069 7369 6e73   (.        isins
-00038810: 7461 6e63 6528 732c 2053 6572 6965 7329  tance(s, Series)
-00038820: 0a20 2020 2020 2020 2061 6e64 2073 2e6e  .        and s.n
-00038830: 7061 7274 6974 696f 6e73 203d 3d20 310a  partitions == 1.
-00038840: 2020 2020 2020 2020 616e 6420 732e 6b6e          and s.kn
-00038850: 6f77 6e5f 6469 7669 7369 6f6e 730a 2020  own_divisions.  
-00038860: 2020 2020 2020 616e 6420 616e 7928 636f        and any(co
-00038870: 6d70 6172 6528 732c 2064 6629 2066 6f72  mpare(s, df) for
-00038880: 2064 6620 696e 2064 6673 2069 6620 6973   df in dfs if is
-00038890: 696e 7374 616e 6365 2864 662c 2044 6174  instance(df, Dat
-000388a0: 6146 7261 6d65 2929 0a20 2020 2029 0a0a  aFrame)).    )..
-000388b0: 0a64 6566 2065 6c65 6d77 6973 6528 6f70  .def elemwise(op
-000388c0: 2c20 2a61 7267 732c 206d 6574 613d 6e6f  , *args, meta=no
-000388d0: 5f64 6566 6175 6c74 2c20 6f75 743d 4e6f  _default, out=No
-000388e0: 6e65 2c20 7472 616e 7366 6f72 6d5f 6469  ne, transform_di
-000388f0: 7669 7369 6f6e 733d 5472 7565 2c20 2a2a  visions=True, **
-00038900: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
-00038910: 456c 656d 656e 7477 6973 6520 6f70 6572  Elementwise oper
-00038920: 6174 696f 6e20 666f 7220 4461 736b 2064  ation for Dask d
-00038930: 6174 6166 7261 6d65 730a 0a20 2020 2050  ataframes..    P
-00038940: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00038950: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206f 703a  --------.    op:
-00038960: 2063 616c 6c61 626c 650a 2020 2020 2020   callable.      
-00038970: 2020 4675 6e63 7469 6f6e 2074 6f20 6170    Function to ap
-00038980: 706c 7920 6163 726f 7373 2069 6e70 7574  ply across input
-00038990: 2064 6174 6166 7261 6d65 730a 2020 2020   dataframes.    
-000389a0: 2a61 7267 733a 2044 6174 6146 7261 6d65  *args: DataFrame
-000389b0: 732c 2053 6572 6965 732c 2053 6361 6c61  s, Series, Scala
-000389c0: 7273 2c20 4172 7261 7973 2c0a 2020 2020  rs, Arrays,.    
-000389d0: 2020 2020 5468 6520 6172 6775 6d65 6e74      The argument
-000389e0: 7320 6f66 2074 6865 206f 7065 7261 7469  s of the operati
-000389f0: 6f6e 0a20 2020 206d 6574 613a 2070 642e  on.    meta: pd.
-00038a00: 4461 7461 4672 616d 652c 2070 642e 5365  DataFrame, pd.Se
-00038a10: 7269 6573 2028 6f70 7469 6f6e 616c 290a  ries (optional).
-00038a20: 2020 2020 2020 2020 5661 6c69 6420 6d65          Valid me
-00038a30: 7461 6461 7461 2066 6f72 2074 6865 206f  tadata for the o
-00038a40: 7065 7261 7469 6f6e 2e20 2057 696c 6c20  peration.  Will 
-00038a50: 6576 616c 7561 7465 206f 6e20 6120 736d  evaluate on a sm
-00038a60: 616c 6c20 7069 6563 6520 6f66 0a20 2020  all piece of.   
-00038a70: 2020 2020 2064 6174 6120 6966 206e 6f74       data if not
-00038a80: 2070 726f 7669 6465 642e 0a20 2020 2074   provided..    t
-00038a90: 7261 6e73 666f 726d 5f64 6976 6973 696f  ransform_divisio
-00038aa0: 6e73 3a20 626f 6f6c 6561 6e0a 2020 2020  ns: boolean.    
-00038ab0: 2020 2020 4966 2074 6865 2069 6e70 7574      If the input
-00038ac0: 2069 7320 6120 6060 6461 736b 2e64 6174   is a ``dask.dat
-00038ad0: 6166 7261 6d65 2e49 6e64 6578 6060 2077  aframe.Index`` w
-00038ae0: 6520 6e6f 726d 616c 6c79 2077 696c 6c20  e normally will 
-00038af0: 616c 736f 2061 7070 6c79 0a20 2020 2020  also apply.     
-00038b00: 2020 2074 6865 2066 756e 6374 696f 6e20     the function 
-00038b10: 6f6e 746f 2074 6865 2064 6976 6973 696f  onto the divisio
-00038b20: 6e73 2061 6e64 2061 7070 6c79 2074 686f  ns and apply tho
-00038b30: 7365 2074 7261 6e73 666f 726d 6564 2064  se transformed d
-00038b40: 6976 6973 696f 6e73 0a20 2020 2020 2020  ivisions.       
-00038b50: 2074 6f20 7468 6520 6f75 7470 7574 2e20   to the output. 
-00038b60: 2059 6f75 2063 616e 2070 6173 7320 6060   You can pass ``
-00038b70: 7472 616e 7366 6f72 6d5f 6469 7669 7369  transform_divisi
-00038b80: 6f6e 733d 4661 6c73 6560 6020 746f 206f  ons=False`` to o
-00038b90: 7665 7272 6964 650a 2020 2020 2020 2020  verride.        
-00038ba0: 7468 6973 2062 6568 6176 696f 720a 2020  this behavior.  
-00038bb0: 2020 6f75 7420 3a20 6060 6461 736b 2e61    out : ``dask.a
-00038bc0: 7272 6179 6060 206f 7220 6060 4e6f 6e65  rray`` or ``None
-00038bd0: 6060 0a20 2020 2020 2020 2049 6620 6f75  ``.        If ou
-00038be0: 7420 6973 2061 2064 6173 6b2e 4461 7461  t is a dask.Data
-00038bf0: 4672 616d 652c 2064 6173 6b2e 5365 7269  Frame, dask.Seri
-00038c00: 6573 206f 7220 6461 736b 2e53 6361 6c61  es or dask.Scala
-00038c10: 7220 7468 656e 0a20 2020 2020 2020 2074  r then.        t
-00038c20: 6869 7320 6f76 6572 7772 6974 6573 2074  his overwrites t
-00038c30: 6865 2063 6f6e 7465 6e74 7320 6f66 2069  he contents of i
-00038c40: 7420 7769 7468 2074 6865 2072 6573 756c  t with the resul
-00038c50: 740a 2020 2020 2a2a 6b77 6172 6773 3a20  t.    **kwargs: 
-00038c60: 7363 616c 6172 730a 0a20 2020 2045 7861  scalars..    Exa
-00038c70: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-00038c80: 2d2d 0a20 2020 203e 3e3e 2065 6c65 6d77  --.    >>> elemw
-00038c90: 6973 6528 6f70 6572 6174 6f72 2e61 6464  ise(operator.add
-00038ca0: 2c20 6466 2e78 2c20 6466 2e79 2920 2023  , df.x, df.y)  #
-00038cb0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-00038cc0: 2020 2020 2222 220a 2020 2020 5f6e 616d      """.    _nam
-00038cd0: 6520 3d20 6675 6e63 6e61 6d65 286f 7029  e = funcname(op)
-00038ce0: 202b 2022 2d22 202b 2074 6f6b 656e 697a   + "-" + tokeniz
-00038cf0: 6528 6f70 2c20 2a61 7267 732c 202a 2a6b  e(op, *args, **k
-00038d00: 7761 7267 7329 0a0a 2020 2020 6172 6773  wargs)..    args
-00038d10: 203d 205f 6d61 7962 655f 6672 6f6d 5f70   = _maybe_from_p
-00038d20: 616e 6461 7328 6172 6773 290a 0a20 2020  andas(args)..   
-00038d30: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-00038d40: 7261 6d65 2e6d 756c 7469 2069 6d70 6f72  rame.multi impor
-00038d50: 7420 5f6d 6179 6265 5f61 6c69 676e 5f70  t _maybe_align_p
-00038d60: 6172 7469 7469 6f6e 730a 0a20 2020 2061  artitions..    a
-00038d70: 7267 7320 3d20 5f6d 6179 6265 5f61 6c69  rgs = _maybe_ali
-00038d80: 676e 5f70 6172 7469 7469 6f6e 7328 6172  gn_partitions(ar
-00038d90: 6773 290a 2020 2020 6461 736b 7320 3d20  gs).    dasks = 
-00038da0: 5b61 7267 2066 6f72 2061 7267 2069 6e20  [arg for arg in 
-00038db0: 6172 6773 2069 6620 6973 696e 7374 616e  args if isinstan
-00038dc0: 6365 2861 7267 2c20 285f 4672 616d 652c  ce(arg, (_Frame,
-00038dd0: 2053 6361 6c61 722c 2041 7272 6179 2929   Scalar, Array))
-00038de0: 5d0a 2020 2020 6466 7320 3d20 5b64 6620  ].    dfs = [df 
-00038df0: 666f 7220 6466 2069 6e20 6461 736b 7320  for df in dasks 
-00038e00: 6966 2069 7369 6e73 7461 6e63 6528 6466  if isinstance(df
-00038e10: 2c20 5f46 7261 6d65 295d 0a0a 2020 2020  , _Frame)]..    
-00038e20: 2320 436c 6561 6e20 7570 2064 6173 6b20  # Clean up dask 
-00038e30: 6172 7261 7973 2069 6620 7072 6573 656e  arrays if presen
-00038e40: 740a 2020 2020 6465 7073 203d 2064 6173  t.    deps = das
-00038e50: 6b73 2e63 6f70 7928 290a 2020 2020 666f  ks.copy().    fo
-00038e60: 7220 692c 2061 2069 6e20 656e 756d 6572  r i, a in enumer
-00038e70: 6174 6528 6461 736b 7329 3a0a 2020 2020  ate(dasks):.    
-00038e80: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00038e90: 7461 6e63 6528 612c 2041 7272 6179 293a  tance(a, Array):
-00038ea0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00038eb0: 7469 6e75 650a 2020 2020 2020 2020 2320  tinue.        # 
-00038ec0: 456e 7375 7265 2074 6861 7420 7468 6579  Ensure that they
-00038ed0: 2068 6176 6520 7369 6d69 6c61 722d 6973   have similar-is
-00038ee0: 6820 6368 756e 6b20 7374 7275 6374 7572  h chunk structur
-00038ef0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00038f00: 2061 6c6c 286e 6f74 2061 2e63 6875 6e6b   all(not a.chunk
-00038f10: 7320 6f72 206c 656e 2861 2e63 6875 6e6b  s or len(a.chunk
-00038f20: 735b 305d 2920 3d3d 2064 662e 6e70 6172  s[0]) == df.npar
-00038f30: 7469 7469 6f6e 7320 666f 7220 6466 2069  titions for df i
-00038f40: 6e20 6466 7329 3a0a 2020 2020 2020 2020  n dfs):.        
-00038f50: 2020 2020 6d73 6720 3d20 280a 2020 2020      msg = (.    
-00038f60: 2020 2020 2020 2020 2020 2020 2257 6865              "Whe
-00038f70: 6e20 636f 6d62 696e 696e 6720 6461 736b  n combining dask
-00038f80: 2061 7272 6179 7320 7769 7468 2064 6174   arrays with dat
-00038f90: 6166 7261 6d65 7320 7468 6579 206d 7573  aframes they mus
-00038fa0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-00038fb0: 2020 2020 226d 6174 6368 2063 6875 6e6b      "match chunk
-00038fc0: 696e 6720 6578 6163 746c 792e 2020 4f70  ing exactly.  Op
-00038fd0: 6572 6174 696f 6e3a 2025 7322 2025 2066  eration: %s" % f
-00038fe0: 756e 636e 616d 6528 6f70 290a 2020 2020  uncname(op).    
-00038ff0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00039000: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00039010: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-00039020: 2020 2020 2320 5265 6368 756e 6b20 746f      # Rechunk to
-00039030: 2068 6176 6520 6120 7369 6e67 6c65 2063   have a single c
-00039040: 6875 6e6b 2061 6c6f 6e67 2061 6c6c 206f  hunk along all o
-00039050: 7468 6572 2061 7865 730a 2020 2020 2020  ther axes.      
-00039060: 2020 6966 2061 2e6e 6469 6d20 3e20 313a    if a.ndim > 1:
-00039070: 0a20 2020 2020 2020 2020 2020 2061 203d  .            a =
-00039080: 2061 2e72 6563 6875 6e6b 287b 6920 2b20   a.rechunk({i + 
-00039090: 313a 2064 2066 6f72 2069 2c20 6420 696e  1: d for i, d in
-000390a0: 2065 6e75 6d65 7261 7465 2861 2e73 6861   enumerate(a.sha
-000390b0: 7065 5b31 3a5d 297d 290a 2020 2020 2020  pe[1:])}).      
-000390c0: 2020 2020 2020 6461 736b 735b 695d 203d        dasks[i] =
-000390d0: 2061 0a0a 2020 2020 6469 7669 7369 6f6e   a..    division
-000390e0: 7320 3d20 6466 735b 305d 2e64 6976 6973  s = dfs[0].divis
-000390f0: 696f 6e73 0a20 2020 2069 6620 7472 616e  ions.    if tran
-00039100: 7366 6f72 6d5f 6469 7669 7369 6f6e 7320  sform_divisions 
-00039110: 616e 6420 6973 696e 7374 616e 6365 2864  and isinstance(d
-00039120: 6673 5b30 5d2c 2049 6e64 6578 2920 616e  fs[0], Index) an
-00039130: 6420 6c65 6e28 6466 7329 203d 3d20 313a  d len(dfs) == 1:
-00039140: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00039150: 2020 2020 2020 2020 2020 6469 7669 7369            divisi
-00039160: 6f6e 7320 3d20 6f70 280a 2020 2020 2020  ons = op(.      
-00039170: 2020 2020 2020 2020 2020 2a5b 7064 2e49            *[pd.I
-00039180: 6e64 6578 2861 7267 2e64 6976 6973 696f  ndex(arg.divisio
-00039190: 6e73 2920 6966 2061 7267 2069 7320 6466  ns) if arg is df
-000391a0: 735b 305d 2065 6c73 6520 6172 6720 666f  s[0] else arg fo
-000391b0: 7220 6172 6720 696e 2061 7267 735d 2c0a  r arg in args],.
-000391c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000391d0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-000391e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000391f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00039200: 6528 6469 7669 7369 6f6e 732c 2070 642e  e(divisions, pd.
-00039210: 496e 6465 7829 3a0a 2020 2020 2020 2020  Index):.        
-00039220: 2020 2020 2020 2020 6469 7669 7369 6f6e          division
-00039230: 7320 3d20 6d65 7468 6f64 732e 746f 6c69  s = methods.toli
-00039240: 7374 2864 6976 6973 696f 6e73 290a 2020  st(divisions).  
-00039250: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00039260: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00039270: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00039280: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00039290: 2020 2069 6620 6e6f 7420 7661 6c69 645f     if not valid_
-000392a0: 6469 7669 7369 6f6e 7328 6469 7669 7369  divisions(divisi
-000392b0: 6f6e 7329 3a0a 2020 2020 2020 2020 2020  ons):.          
-000392c0: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
-000392d0: 3d20 5b4e 6f6e 655d 202a 2028 6466 735b  = [None] * (dfs[
-000392e0: 305d 2e6e 7061 7274 6974 696f 6e73 202b  0].npartitions +
-000392f0: 2031 290a 0a20 2020 205f 6973 5f62 726f   1)..    _is_bro
-00039300: 6164 6361 7374 6162 6c65 203d 2070 6172  adcastable = par
-00039310: 7469 616c 2869 735f 6272 6f61 6463 6173  tial(is_broadcas
-00039320: 7461 626c 652c 2064 6673 290a 2020 2020  table, dfs).    
-00039330: 6466 7320 3d20 6c69 7374 2872 656d 6f76  dfs = list(remov
-00039340: 6528 5f69 735f 6272 6f61 6463 6173 7461  e(_is_broadcasta
-00039350: 626c 652c 2064 6673 2929 0a0a 2020 2020  ble, dfs))..    
-00039360: 6f74 6865 7220 3d20 5b0a 2020 2020 2020  other = [.      
-00039370: 2020 2869 2c20 6172 6729 0a20 2020 2020    (i, arg).     
-00039380: 2020 2066 6f72 2069 2c20 6172 6720 696e     for i, arg in
-00039390: 2065 6e75 6d65 7261 7465 2861 7267 7329   enumerate(args)
-000393a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000393b0: 6973 696e 7374 616e 6365 2861 7267 2c20  isinstance(arg, 
-000393c0: 285f 4672 616d 652c 2053 6361 6c61 722c  (_Frame, Scalar,
-000393d0: 2041 7272 6179 2929 0a20 2020 205d 0a0a   Array)).    ]..
-000393e0: 2020 2020 2320 6164 6a75 7374 2074 6865      # adjust the
-000393f0: 206b 6579 206c 656e 6774 6820 6f66 2053   key length of S
-00039400: 6361 6c61 720a 2020 2020 6473 6b20 3d20  calar.    dsk = 
-00039410: 7061 7274 6974 696f 6e77 6973 655f 6772  partitionwise_gr
-00039420: 6170 6828 6f70 2c20 5f6e 616d 652c 202a  aph(op, _name, *
-00039430: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-00039440: 0a20 2020 2067 7261 7068 203d 2048 6967  .    graph = Hig
-00039450: 684c 6576 656c 4772 6170 682e 6672 6f6d  hLevelGraph.from
-00039460: 5f63 6f6c 6c65 6374 696f 6e73 285f 6e61  _collections(_na
-00039470: 6d65 2c20 6473 6b2c 2064 6570 656e 6465  me, dsk, depende
-00039480: 6e63 6965 733d 6465 7073 290a 0a20 2020  ncies=deps)..   
-00039490: 2069 6620 6d65 7461 2069 7320 6e6f 5f64   if meta is no_d
-000394a0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-000394b0: 6966 206c 656e 2864 6673 2920 3e3d 2032  if len(dfs) >= 2
-000394c0: 2061 6e64 206e 6f74 2061 6c6c 2868 6173   and not all(has
-000394d0: 6174 7472 2864 2c20 226e 7061 7274 6974  attr(d, "npartit
-000394e0: 696f 6e73 2229 2066 6f72 2064 2069 6e20  ions") for d in 
-000394f0: 6461 736b 7329 3a0a 2020 2020 2020 2020  dasks):.        
-00039500: 2020 2020 2320 7368 6f75 6c64 206e 6f74      # should not
-00039510: 206f 6363 7572 2069 6e20 6375 7272 656e   occur in curren
-00039520: 7420 6675 6e63 730a 2020 2020 2020 2020  t funcs.        
-00039530: 2020 2020 6d73 6720 3d20 2265 6c65 6d77      msg = "elemw
-00039540: 6973 6520 7769 7468 2032 206f 7220 6d6f  ise with 2 or mo
-00039550: 7265 2044 6174 6146 7261 6d65 7320 616e  re DataFrames an
-00039560: 6420 5363 616c 6172 2069 7320 6e6f 7420  d Scalar is not 
-00039570: 7375 7070 6f72 7465 6422 0a20 2020 2020  supported".     
-00039580: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00039590: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-000395a0: 286d 7367 290a 2020 2020 2020 2020 2320  (msg).        # 
-000395b0: 466f 7220 6272 6f61 6463 6173 7461 626c  For broadcastabl
-000395c0: 6520 7365 7269 6573 2c20 7573 6520 6e6f  e series, use no
-000395d0: 2072 6f77 732e 0a20 2020 2020 2020 2070   rows..        p
-000395e0: 6172 7473 203d 205b 0a20 2020 2020 2020  arts = [.       
-000395f0: 2020 2020 2064 2e5f 6d65 7461 0a20 2020       d._meta.   
-00039600: 2020 2020 2020 2020 2069 6620 5f69 735f           if _is_
-00039610: 6272 6f61 6463 6173 7461 626c 6528 6429  broadcastable(d)
-00039620: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00039630: 6520 6e70 2e65 6d70 7479 2828 292c 2064  e np.empty((), d
-00039640: 7479 7065 3d64 2e64 7479 7065 290a 2020  type=d.dtype).  
-00039650: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00039660: 6e73 7461 6e63 6528 642c 2041 7272 6179  nstance(d, Array
-00039670: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00039680: 7365 2064 2e5f 6d65 7461 5f6e 6f6e 656d  se d._meta_nonem
-00039690: 7074 790a 2020 2020 2020 2020 2020 2020  pty.            
-000396a0: 666f 7220 6420 696e 2064 6173 6b73 0a20  for d in dasks. 
-000396b0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-000396c0: 2077 6974 6820 7261 6973 655f 6f6e 5f6d   with raise_on_m
-000396d0: 6574 615f 6572 726f 7228 6675 6e63 6e61  eta_error(funcna
-000396e0: 6d65 286f 7029 293a 0a20 2020 2020 2020  me(op)):.       
-000396f0: 2020 2020 206d 6574 6120 3d20 7061 7274       meta = part
-00039700: 6961 6c5f 6279 5f6f 7264 6572 282a 7061  ial_by_order(*pa
-00039710: 7274 732c 2066 756e 6374 696f 6e3d 6f70  rts, function=op
-00039720: 2c20 6f74 6865 723d 6f74 6865 7229 0a0a  , other=other)..
-00039730: 2020 2020 7265 7375 6c74 203d 206e 6577      result = new
-00039740: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
-00039750: 2c20 5f6e 616d 652c 206d 6574 612c 2064  , _name, meta, d
-00039760: 6976 6973 696f 6e73 290a 2020 2020 7265  ivisions).    re
-00039770: 7475 726e 2068 616e 646c 655f 6f75 7428  turn handle_out(
-00039780: 6f75 742c 2072 6573 756c 7429 0a0a 0a64  out, result)...d
-00039790: 6566 2068 616e 646c 655f 6f75 7428 6f75  ef handle_out(ou
-000397a0: 742c 2072 6573 756c 7429 3a0a 2020 2020  t, result):.    
-000397b0: 2222 2248 616e 646c 6520 6f75 7420 7061  """Handle out pa
-000397c0: 7261 6d65 7465 7273 0a0a 2020 2020 4966  rameters..    If
-000397d0: 206f 7574 2069 7320 6120 6461 736b 2e44   out is a dask.D
-000397e0: 6174 6146 7261 6d65 2c20 6461 736b 2e53  ataFrame, dask.S
-000397f0: 6572 6965 7320 6f72 2064 6173 6b2e 5363  eries or dask.Sc
-00039800: 616c 6172 2074 6865 6e0a 2020 2020 7468  alar then.    th
-00039810: 6973 206f 7665 7277 7269 7465 7320 7468  is overwrites th
-00039820: 6520 636f 6e74 656e 7473 206f 6620 6974  e contents of it
-00039830: 2077 6974 6820 7468 6520 7265 7375 6c74   with the result
-00039840: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-00039850: 6973 696e 7374 616e 6365 286f 7574 2c20  isinstance(out, 
-00039860: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
-00039870: 6966 206c 656e 286f 7574 2920 3d3d 2031  if len(out) == 1
-00039880: 3a0a 2020 2020 2020 2020 2020 2020 6f75  :.            ou
-00039890: 7420 3d20 6f75 745b 305d 0a20 2020 2020  t = out[0].     
-000398a0: 2020 2065 6c69 6620 6c65 6e28 6f75 7429     elif len(out)
-000398b0: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
-000398c0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
-000398d0: 6d65 6e74 6564 4572 726f 7228 2254 6865  mentedError("The
-000398e0: 206f 7574 2070 6172 616d 6574 6572 2069   out parameter i
-000398f0: 7320 6e6f 7420 6675 6c6c 7920 7375 7070  s not fully supp
-00039900: 6f72 7465 6422 290a 2020 2020 2020 2020  orted").        
-00039910: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00039920: 2020 6f75 7420 3d20 4e6f 6e65 0a0a 2020    out = None..  
-00039930: 2020 2320 4e6f 7469 6365 2c20 7765 2075    # Notice, we u
-00039940: 7365 202e 5f5f 636c 6173 735f 5f20 6173  se .__class__ as
-00039950: 206f 7070 6f73 6564 2074 6f20 7479 7065   opposed to type
-00039960: 2829 2069 6e20 6f72 6465 7220 746f 2073  () in order to s
-00039970: 7570 706f 7274 0a20 2020 2023 206f 626a  upport.    # obj
-00039980: 6563 7420 7072 6f78 6965 7320 7365 6520  ect proxies see 
-00039990: 3c68 7474 7073 3a2f 2f67 6974 6875 622e  <https://github.
-000399a0: 636f 6d2f 6461 736b 2f64 6173 6b2f 7075  com/dask/dask/pu
-000399b0: 6c6c 2f36 3938 313e 0a20 2020 2069 6620  ll/6981>.    if 
-000399c0: 6f75 7420 6973 206e 6f74 204e 6f6e 6520  out is not None 
-000399d0: 616e 6420 6f75 742e 5f5f 636c 6173 735f  and out.__class_
-000399e0: 5f20 213d 2072 6573 756c 742e 5f5f 636c  _ != result.__cl
-000399f0: 6173 735f 5f3a 0a20 2020 2020 2020 2072  ass__:.        r
-00039a00: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
-00039a10: 2020 2020 2020 2020 2020 2020 224d 6973              "Mis
-00039a20: 6d61 7463 6865 6420 7479 7065 7320 6265  matched types be
-00039a30: 7477 6565 6e20 7265 7375 6c74 2061 6e64  tween result and
-00039a40: 206f 7574 2070 6172 616d 6574 6572 2e20   out parameter. 
-00039a50: 220a 2020 2020 2020 2020 2020 2020 226f  ".            "o
-00039a60: 7574 3d25 732c 2072 6573 756c 743d 2573  ut=%s, result=%s
-00039a70: 2220 2520 2873 7472 2874 7970 6528 6f75  " % (str(type(ou
-00039a80: 7429 292c 2073 7472 2874 7970 6528 7265  t)), str(type(re
-00039a90: 7375 6c74 2929 290a 2020 2020 2020 2020  sult))).        
-00039aa0: 290a 0a20 2020 2069 6620 6973 696e 7374  )..    if isinst
-00039ab0: 616e 6365 286f 7574 2c20 4461 7461 4672  ance(out, DataFr
-00039ac0: 616d 6529 3a0a 2020 2020 2020 2020 6966  ame):.        if
-00039ad0: 206c 656e 286f 7574 2e63 6f6c 756d 6e73   len(out.columns
-00039ae0: 2920 213d 206c 656e 2872 6573 756c 742e  ) != len(result.
-00039af0: 636f 6c75 6d6e 7329 3a0a 2020 2020 2020  columns):.      
-00039b00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00039b10: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00039b20: 2020 2020 2020 2020 224d 6973 6d61 7463          "Mismatc
-00039b30: 6865 6420 636f 6c75 6d6e 7320 636f 756e  hed columns coun
-00039b40: 7420 6265 7477 6565 6e20 7265 7375 6c74  t between result
-00039b50: 2061 6e64 206f 7574 2070 6172 616d 6574   and out paramet
-00039b60: 6572 2e20 220a 2020 2020 2020 2020 2020  er. ".          
-00039b70: 2020 2020 2020 226f 7574 3d25 732c 2072        "out=%s, r
-00039b80: 6573 756c 743d 2573 2220 2520 2873 7472  esult=%s" % (str
-00039b90: 286c 656e 286f 7574 2e63 6f6c 756d 6e73  (len(out.columns
-00039ba0: 2929 2c20 7374 7228 6c65 6e28 7265 7375  )), str(len(resu
-00039bb0: 6c74 2e63 6f6c 756d 6e73 2929 290a 2020  lt.columns))).  
-00039bc0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00039bd0: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
-00039be0: 7574 2c20 2853 6572 6965 732c 2044 6174  ut, (Series, Dat
-00039bf0: 6146 7261 6d65 2c20 5363 616c 6172 2929  aFrame, Scalar))
-00039c00: 3a0a 2020 2020 2020 2020 6f75 742e 5f6d  :.        out._m
-00039c10: 6574 6120 3d20 7265 7375 6c74 2e5f 6d65  eta = result._me
-00039c20: 7461 0a20 2020 2020 2020 206f 7574 2e5f  ta.        out._
-00039c30: 6e61 6d65 203d 2072 6573 756c 742e 5f6e  name = result._n
-00039c40: 616d 650a 2020 2020 2020 2020 6f75 742e  ame.        out.
-00039c50: 6461 736b 203d 2072 6573 756c 742e 6461  dask = result.da
-00039c60: 736b 0a0a 2020 2020 2020 2020 6966 206e  sk..        if n
-00039c70: 6f74 2069 7369 6e73 7461 6e63 6528 6f75  ot isinstance(ou
-00039c80: 742c 2053 6361 6c61 7229 3a0a 2020 2020  t, Scalar):.    
-00039c90: 2020 2020 2020 2020 6f75 742e 5f64 6976          out._div
-00039ca0: 6973 696f 6e73 203d 2072 6573 756c 742e  isions = result.
-00039cb0: 6469 7669 7369 6f6e 730a 2020 2020 656c  divisions.    el
-00039cc0: 6966 206f 7574 2069 7320 6e6f 7420 4e6f  if out is not No
-00039cd0: 6e65 3a0a 2020 2020 2020 2020 6d73 6720  ne:.        msg 
-00039ce0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00039cf0: 2254 6865 206f 7574 2070 6172 616d 6574  "The out paramet
-00039d00: 6572 2069 7320 6e6f 7420 6675 6c6c 7920  er is not fully 
-00039d10: 7375 7070 6f72 7465 642e 220a 2020 2020  supported.".    
-00039d20: 2020 2020 2020 2020 2220 5265 6365 6976          " Receiv
-00039d30: 6564 2074 7970 6520 2573 2c20 6578 7065  ed type %s, expe
-00039d40: 6374 6564 2025 7320 220a 2020 2020 2020  cted %s ".      
-00039d50: 2020 2020 2020 2520 280a 2020 2020 2020        % (.      
-00039d60: 2020 2020 2020 2020 2020 7479 7065 6e61            typena
-00039d70: 6d65 2874 7970 6528 6f75 7429 292c 0a20  me(type(out)),. 
-00039d80: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00039d90: 7970 656e 616d 6528 7479 7065 2872 6573  ypename(type(res
-00039da0: 756c 7429 292c 0a20 2020 2020 2020 2020  ult)),.         
-00039db0: 2020 2029 0a20 2020 2020 2020 2029 0a20     ).        ). 
-00039dc0: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
-00039dd0: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
-00039de0: 286d 7367 290a 2020 2020 656c 7365 3a0a  (msg).    else:.
-00039df0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00039e00: 6573 756c 740a 0a0a 6465 6620 5f6d 6179  esult...def _may
-00039e10: 6265 5f66 726f 6d5f 7061 6e64 6173 2864  be_from_pandas(d
-00039e20: 6673 293a 0a20 2020 2066 726f 6d20 6461  fs):.    from da
-00039e30: 736b 2e64 6174 6166 7261 6d65 2e69 6f20  sk.dataframe.io 
-00039e40: 696d 706f 7274 2066 726f 6d5f 7061 6e64  import from_pand
-00039e50: 6173 0a0a 2020 2020 6466 7320 3d20 5b0a  as..    dfs = [.
-00039e60: 2020 2020 2020 2020 6672 6f6d 5f70 616e          from_pan
-00039e70: 6461 7328 6466 2c20 3129 0a20 2020 2020  das(df, 1).     
-00039e80: 2020 2069 6620 2869 735f 7365 7269 6573     if (is_series
-00039e90: 5f6c 696b 6528 6466 2920 6f72 2069 735f  _like(df) or is_
-00039ea0: 6461 7461 6672 616d 655f 6c69 6b65 2864  dataframe_like(d
-00039eb0: 6629 2920 616e 6420 6e6f 7420 6973 5f64  f)) and not is_d
-00039ec0: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2864  ask_collection(d
-00039ed0: 6629 0a20 2020 2020 2020 2065 6c73 6520  f).        else 
-00039ee0: 6466 0a20 2020 2020 2020 2066 6f72 2064  df.        for d
-00039ef0: 6620 696e 2064 6673 0a20 2020 205d 0a20  f in dfs.    ]. 
-00039f00: 2020 2072 6574 7572 6e20 6466 730a 0a0a     return dfs...
-00039f10: 6465 6620 6861 7368 5f73 6861 7264 280a  def hash_shard(.
-00039f20: 2020 2020 6466 2c20 6e70 6172 7473 2c20      df, nparts, 
-00039f30: 7370 6c69 745f 6f75 745f 7365 7475 703d  split_out_setup=
-00039f40: 4e6f 6e65 2c20 7370 6c69 745f 6f75 745f  None, split_out_
-00039f50: 7365 7475 705f 6b77 6172 6773 3d4e 6f6e  setup_kwargs=Non
-00039f60: 652c 2069 676e 6f72 655f 696e 6465 783d  e, ignore_index=
-00039f70: 4661 6c73 650a 293a 0a20 2020 2069 6620  False.):.    if 
-00039f80: 7370 6c69 745f 6f75 745f 7365 7475 703a  split_out_setup:
-00039f90: 0a20 2020 2020 2020 2068 203d 2073 706c  .        h = spl
-00039fa0: 6974 5f6f 7574 5f73 6574 7570 2864 662c  it_out_setup(df,
-00039fb0: 202a 2a28 7370 6c69 745f 6f75 745f 7365   **(split_out_se
-00039fc0: 7475 705f 6b77 6172 6773 206f 7220 7b7d  tup_kwargs or {}
-00039fd0: 2929 0a20 2020 2065 6c73 653a 0a20 2020  )).    else:.   
-00039fe0: 2020 2020 2068 203d 2064 660a 0a20 2020       h = df..   
-00039ff0: 2068 203d 2068 6173 685f 6f62 6a65 6374   h = hash_object
-0003a000: 5f64 6973 7061 7463 6828 682c 2069 6e64  _dispatch(h, ind
-0003a010: 6578 3d46 616c 7365 290a 2020 2020 7265  ex=False).    re
-0003a020: 7475 726e 2067 726f 7570 5f73 706c 6974  turn group_split
-0003a030: 5f64 6973 7061 7463 6828 6466 2c20 6820  _dispatch(df, h 
-0003a040: 2520 6e70 6172 7473 2c20 6e70 6172 7473  % nparts, nparts
-0003a050: 2c20 6967 6e6f 7265 5f69 6e64 6578 3d69  , ignore_index=i
-0003a060: 676e 6f72 655f 696e 6465 7829 0a0a 0a64  gnore_index)...d
-0003a070: 6566 2073 706c 6974 5f65 7665 6e6c 7928  ef split_evenly(
-0003a080: 6466 2c20 6b29 3a0a 2020 2020 2222 2253  df, k):.    """S
-0003a090: 706c 6974 2064 6174 6166 7261 6d65 2069  plit dataframe i
-0003a0a0: 6e74 6f20 6b20 726f 7567 686c 7920 6571  nto k roughly eq
-0003a0b0: 7561 6c20 7061 7274 7322 2222 0a20 2020  ual parts""".   
-0003a0c0: 2064 6976 6973 696f 6e73 203d 206e 702e   divisions = np.
-0003a0d0: 6c69 6e73 7061 6365 2830 2c20 6c65 6e28  linspace(0, len(
-0003a0e0: 6466 292c 206b 202b 2031 292e 6173 7479  df), k + 1).asty
-0003a0f0: 7065 2869 6e74 290a 2020 2020 7265 7475  pe(int).    retu
-0003a100: 726e 207b 693a 2064 662e 696c 6f63 5b64  rn {i: df.iloc[d
-0003a110: 6976 6973 696f 6e73 5b69 5d20 3a20 6469  ivisions[i] : di
-0003a120: 7669 7369 6f6e 735b 6920 2b20 315d 5d20  visions[i + 1]] 
-0003a130: 666f 7220 6920 696e 2072 616e 6765 286b  for i in range(k
-0003a140: 297d 0a0a 0a64 6566 2073 706c 6974 5f6f  )}...def split_o
-0003a150: 7574 5f6f 6e5f 696e 6465 7828 6466 293a  ut_on_index(df):
-0003a160: 0a20 2020 2068 203d 2064 662e 696e 6465  .    h = df.inde
-0003a170: 780a 2020 2020 6966 2069 7369 6e73 7461  x.    if isinsta
-0003a180: 6e63 6528 682c 2070 642e 4d75 6c74 6949  nce(h, pd.MultiI
-0003a190: 6e64 6578 293a 0a20 2020 2020 2020 2068  ndex):.        h
-0003a1a0: 203d 206d 6574 615f 6672 616d 655f 636f   = meta_frame_co
-0003a1b0: 6e73 7472 7563 746f 7228 6466 2928 5b5d  nstructor(df)([]
-0003a1c0: 2c20 696e 6465 783d 6829 2e72 6573 6574  , index=h).reset
-0003a1d0: 5f69 6e64 6578 2829 0a20 2020 2072 6574  _index().    ret
-0003a1e0: 7572 6e20 680a 0a0a 6465 6620 7370 6c69  urn h...def spli
-0003a1f0: 745f 6f75 745f 6f6e 5f63 6f6c 7328 6466  t_out_on_cols(df
-0003a200: 2c20 636f 6c73 3d4e 6f6e 6529 3a0a 2020  , cols=None):.  
-0003a210: 2020 7265 7475 726e 2064 665b 636f 6c73    return df[cols
-0003a220: 5d0a 0a0a 4069 6e73 6572 745f 6d65 7461  ]...@insert_meta
-0003a230: 5f70 6172 616d 5f64 6573 6372 6970 7469  _param_descripti
-0003a240: 6f6e 0a64 6566 2061 7070 6c79 5f63 6f6e  on.def apply_con
-0003a250: 6361 745f 6170 706c 7928 0a20 2020 2061  cat_apply(.    a
-0003a260: 7267 732c 0a20 2020 2063 6875 6e6b 3d4e  rgs,.    chunk=N
-0003a270: 6f6e 652c 0a20 2020 2061 6767 7265 6761  one,.    aggrega
-0003a280: 7465 3d4e 6f6e 652c 0a20 2020 2063 6f6d  te=None,.    com
-0003a290: 6269 6e65 3d4e 6f6e 652c 0a20 2020 206d  bine=None,.    m
-0003a2a0: 6574 613d 6e6f 5f64 6566 6175 6c74 2c0a  eta=no_default,.
-0003a2b0: 2020 2020 746f 6b65 6e3d 4e6f 6e65 2c0a      token=None,.
-0003a2c0: 2020 2020 6368 756e 6b5f 6b77 6172 6773      chunk_kwargs
-0003a2d0: 3d4e 6f6e 652c 0a20 2020 2061 6767 7265  =None,.    aggre
-0003a2e0: 6761 7465 5f6b 7761 7267 733d 4e6f 6e65  gate_kwargs=None
-0003a2f0: 2c0a 2020 2020 636f 6d62 696e 655f 6b77  ,.    combine_kw
-0003a300: 6172 6773 3d4e 6f6e 652c 0a20 2020 2073  args=None,.    s
-0003a310: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
-0003a320: 0a20 2020 2073 706c 6974 5f6f 7574 3d4e  .    split_out=N
-0003a330: 6f6e 652c 0a20 2020 2073 706c 6974 5f6f  one,.    split_o
-0003a340: 7574 5f73 6574 7570 3d4e 6f6e 652c 0a20  ut_setup=None,. 
-0003a350: 2020 2073 706c 6974 5f6f 7574 5f73 6574     split_out_set
-0003a360: 7570 5f6b 7761 7267 733d 4e6f 6e65 2c0a  up_kwargs=None,.
-0003a370: 2020 2020 736f 7274 3d4e 6f6e 652c 0a20      sort=None,. 
-0003a380: 2020 2069 676e 6f72 655f 696e 6465 783d     ignore_index=
-0003a390: 4661 6c73 652c 0a20 2020 202a 2a6b 7761  False,.    **kwa
-0003a3a0: 7267 732c 0a29 3a0a 2020 2020 2222 2241  rgs,.):.    """A
-0003a3b0: 7070 6c79 2061 2066 756e 6374 696f 6e20  pply a function 
-0003a3c0: 746f 2062 6c6f 636b 732c 2074 6865 6e20  to blocks, then 
-0003a3d0: 636f 6e63 6174 2c20 7468 656e 2061 7070  concat, then app
-0003a3e0: 6c79 2061 6761 696e 0a0a 2020 2020 5061  ly again..    Pa
-0003a3f0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-0003a400: 2d2d 2d2d 2d2d 2d0a 2020 2020 6172 6773  -------.    args
-0003a410: 203a 0a20 2020 2020 2020 2050 6f73 6974   :.        Posit
-0003a420: 696f 6e61 6c20 6172 6775 6d65 6e74 7320  ional arguments 
-0003a430: 666f 7220 7468 6520 6063 6875 6e6b 6020  for the `chunk` 
-0003a440: 6675 6e63 7469 6f6e 2e20 416c 6c20 6064  function. All `d
-0003a450: 6173 6b2e 6461 7461 6672 616d 6560 0a20  ask.dataframe`. 
-0003a460: 2020 2020 2020 206f 626a 6563 7473 2073         objects s
-0003a470: 686f 756c 6420 6265 2070 6172 7469 7469  hould be partiti
-0003a480: 6f6e 6564 2061 6e64 2069 6e64 6578 6564  oned and indexed
-0003a490: 2065 7175 6976 616c 656e 746c 792e 0a20   equivalently.. 
-0003a4a0: 2020 2063 6875 6e6b 203a 2066 756e 6374     chunk : funct
-0003a4b0: 696f 6e20 5b62 6c6f 636b 2d70 6572 2d61  ion [block-per-a
-0003a4c0: 7267 5d20 2d3e 2062 6c6f 636b 0a20 2020  rg] -> block.   
-0003a4d0: 2020 2020 2046 756e 6374 696f 6e20 746f       Function to
-0003a4e0: 206f 7065 7261 7465 206f 6e20 6561 6368   operate on each
-0003a4f0: 2062 6c6f 636b 206f 6620 6461 7461 0a20   block of data. 
-0003a500: 2020 2061 6767 7265 6761 7465 203a 2066     aggregate : f
-0003a510: 756e 6374 696f 6e20 636f 6e63 6174 656e  unction concaten
-0003a520: 6174 6564 2d62 6c6f 636b 202d 3e20 626c  ated-block -> bl
-0003a530: 6f63 6b0a 2020 2020 2020 2020 4675 6e63  ock.        Func
-0003a540: 7469 6f6e 2074 6f20 6f70 6572 6174 6520  tion to operate 
-0003a550: 6f6e 2074 6865 2063 6f6e 6361 7465 6e61  on the concatena
-0003a560: 7465 6420 7265 7375 6c74 206f 6620 6368  ted result of ch
-0003a570: 756e 6b0a 2020 2020 636f 6d62 696e 6520  unk.    combine 
-0003a580: 3a20 6675 6e63 7469 6f6e 2063 6f6e 6361  : function conca
-0003a590: 7465 6e61 7465 642d 626c 6f63 6b20 2d3e  tenated-block ->
-0003a5a0: 2062 6c6f 636b 2c20 6f70 7469 6f6e 616c   block, optional
-0003a5b0: 0a20 2020 2020 2020 2046 756e 6374 696f  .        Functio
-0003a5c0: 6e20 746f 206f 7065 7261 7465 206f 6e20  n to operate on 
-0003a5d0: 696e 7465 726d 6564 6961 7465 2063 6f6e  intermediate con
-0003a5e0: 6361 7465 6e61 7465 6420 7265 7375 6c74  catenated result
-0003a5f0: 7320 6f66 2063 6875 6e6b 0a20 2020 2020  s of chunk.     
-0003a600: 2020 2069 6e20 6120 7472 6565 2d72 6564     in a tree-red
-0003a610: 7563 7469 6f6e 2e20 4966 206e 6f74 2070  uction. If not p
-0003a620: 726f 7669 6465 642c 2064 6566 6175 6c74  rovided, default
-0003a630: 7320 746f 2061 6767 7265 6761 7465 2e0a  s to aggregate..
-0003a640: 2020 2020 244d 4554 410a 2020 2020 746f      $META.    to
-0003a650: 6b65 6e20 3a20 7374 722c 206f 7074 696f  ken : str, optio
-0003a660: 6e61 6c0a 2020 2020 2020 2020 5468 6520  nal.        The 
-0003a670: 6e61 6d65 2074 6f20 7573 6520 666f 7220  name to use for 
-0003a680: 7468 6520 6f75 7470 7574 206b 6579 732e  the output keys.
-0003a690: 0a20 2020 2063 6875 6e6b 5f6b 7761 7267  .    chunk_kwarg
-0003a6a0: 7320 3a20 6469 6374 2c20 6f70 7469 6f6e  s : dict, option
-0003a6b0: 616c 0a20 2020 2020 2020 204b 6579 776f  al.        Keywo
-0003a6c0: 7264 7320 666f 7220 7468 6520 6368 756e  rds for the chun
-0003a6d0: 6b20 6675 6e63 7469 6f6e 206f 6e6c 792e  k function only.
-0003a6e0: 0a20 2020 2061 6767 7265 6761 7465 5f6b  .    aggregate_k
-0003a6f0: 7761 7267 7320 3a20 6469 6374 2c20 6f70  wargs : dict, op
-0003a700: 7469 6f6e 616c 0a20 2020 2020 2020 204b  tional.        K
-0003a710: 6579 776f 7264 7320 666f 7220 7468 6520  eywords for the 
-0003a720: 6167 6772 6567 6174 6520 6675 6e63 7469  aggregate functi
-0003a730: 6f6e 206f 6e6c 792e 0a20 2020 2063 6f6d  on only..    com
-0003a740: 6269 6e65 5f6b 7761 7267 7320 3a20 6469  bine_kwargs : di
-0003a750: 6374 2c20 6f70 7469 6f6e 616c 0a20 2020  ct, optional.   
-0003a760: 2020 2020 204b 6579 776f 7264 7320 666f       Keywords fo
-0003a770: 7220 7468 6520 636f 6d62 696e 6520 6675  r the combine fu
-0003a780: 6e63 7469 6f6e 206f 6e6c 792e 0a20 2020  nction only..   
-0003a790: 2073 706c 6974 5f65 7665 7279 203a 2069   split_every : i
-0003a7a0: 6e74 2c20 6f70 7469 6f6e 616c 0a20 2020  nt, optional.   
-0003a7b0: 2020 2020 2047 726f 7570 2070 6172 7469       Group parti
-0003a7c0: 7469 6f6e 7320 696e 746f 2067 726f 7570  tions into group
-0003a7d0: 7320 6f66 2074 6869 7320 7369 7a65 2077  s of this size w
-0003a7e0: 6869 6c65 2070 6572 666f 726d 696e 6720  hile performing 
-0003a7f0: 610a 2020 2020 2020 2020 7472 6565 2d72  a.        tree-r
-0003a800: 6564 7563 7469 6f6e 2e20 4966 2073 6574  eduction. If set
-0003a810: 2074 6f20 4661 6c73 652c 206e 6f20 7472   to False, no tr
-0003a820: 6565 2d72 6564 7563 7469 6f6e 2077 696c  ee-reduction wil
-0003a830: 6c20 6265 2075 7365 642c 0a20 2020 2020  l be used,.     
-0003a840: 2020 2061 6e64 2061 6c6c 2069 6e74 6572     and all inter
-0003a850: 6d65 6469 6174 6573 2077 696c 6c20 6265  mediates will be
-0003a860: 2063 6f6e 6361 7465 6e61 7465 6420 616e   concatenated an
-0003a870: 6420 7061 7373 6564 2074 6f20 6060 6167  d passed to ``ag
-0003a880: 6772 6567 6174 6560 602e 0a20 2020 2020  gregate``..     
-0003a890: 2020 2044 6566 6175 6c74 2069 7320 382e     Default is 8.
-0003a8a0: 0a20 2020 2073 706c 6974 5f6f 7574 203a  .    split_out :
-0003a8b0: 2069 6e74 2c20 6f70 7469 6f6e 616c 0a20   int, optional. 
-0003a8c0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-0003a8d0: 206f 7574 7075 7420 7061 7274 6974 696f   output partitio
-0003a8e0: 6e73 2e20 5370 6c69 7420 6f63 6375 7273  ns. Split occurs
-0003a8f0: 2061 6674 6572 2066 6972 7374 2063 6875   after first chu
-0003a900: 6e6b 2072 6564 7563 7469 6f6e 2e0a 2020  nk reduction..  
-0003a910: 2020 7370 6c69 745f 6f75 745f 7365 7475    split_out_setu
-0003a920: 7020 3a20 6361 6c6c 6162 6c65 2c20 6f70  p : callable, op
-0003a930: 7469 6f6e 616c 0a20 2020 2020 2020 2049  tional.        I
-0003a940: 6620 7072 6f76 6964 6564 2c20 7468 6973  f provided, this
-0003a950: 2066 756e 6374 696f 6e20 6973 2063 616c   function is cal
-0003a960: 6c65 6420 6f6e 2065 6163 6820 6368 756e  led on each chun
-0003a970: 6b20 6265 666f 7265 2070 6572 666f 726d  k before perform
-0003a980: 696e 670a 2020 2020 2020 2020 7468 6520  ing.        the 
-0003a990: 6861 7368 2d73 706c 6974 2e20 4974 2073  hash-split. It s
-0003a9a0: 686f 756c 6420 7265 7475 726e 2061 2070  hould return a p
-0003a9b0: 616e 6461 7320 6f62 6a65 6374 2c20 7768  andas object, wh
-0003a9c0: 6572 6520 6561 6368 2072 6f77 0a20 2020  ere each row.   
-0003a9d0: 2020 2020 2028 6578 636c 7564 696e 6720       (excluding 
-0003a9e0: 7468 6520 696e 6465 7829 2069 7320 6861  the index) is ha
-0003a9f0: 7368 6564 2e20 4966 206e 6f74 2070 726f  shed. If not pro
-0003aa00: 7669 6465 642c 2074 6865 2063 6875 6e6b  vided, the chunk
-0003aa10: 2069 7320 6861 7368 6564 0a20 2020 2020   is hashed.     
-0003aa20: 2020 2061 7320 6973 2e0a 2020 2020 7370     as is..    sp
-0003aa30: 6c69 745f 6f75 745f 7365 7475 705f 6b77  lit_out_setup_kw
-0003aa40: 6172 6773 203a 2064 6963 742c 206f 7074  args : dict, opt
-0003aa50: 696f 6e61 6c0a 2020 2020 2020 2020 4b65  ional.        Ke
-0003aa60: 7977 6f72 6473 2066 6f72 2074 6865 2060  ywords for the `
-0003aa70: 7370 6c69 745f 6f75 745f 7365 7475 7060  split_out_setup`
-0003aa80: 2066 756e 6374 696f 6e20 6f6e 6c79 2e0a   function only..
-0003aa90: 2020 2020 736f 7274 203a 2062 6f6f 6c2c      sort : bool,
-0003aaa0: 2064 6566 6175 6c74 204e 6f6e 650a 2020   default None.  
-0003aab0: 2020 2020 2020 4966 2061 6c6c 6f77 6564        If allowed
-0003aac0: 2c20 736f 7274 2074 6865 206b 6579 7320  , sort the keys 
-0003aad0: 6f66 2074 6865 206f 7574 7075 7420 6167  of the output ag
-0003aae0: 6772 6567 6174 696f 6e2e 0a20 2020 2069  gregation..    i
-0003aaf0: 676e 6f72 655f 696e 6465 7820 3a20 626f  gnore_index : bo
-0003ab00: 6f6c 2c20 6465 6661 756c 7420 4661 6c73  ol, default Fals
-0003ab10: 650a 2020 2020 2020 2020 4966 2054 7275  e.        If Tru
-0003ab20: 652c 2064 6f20 6e6f 7420 7072 6573 6572  e, do not preser
-0003ab30: 7665 2069 6e64 6578 2076 616c 7565 7320  ve index values 
-0003ab40: 7468 726f 7567 686f 7574 2041 4341 206f  throughout ACA o
-0003ab50: 7065 7261 7469 6f6e 732e 0a20 2020 206b  perations..    k
-0003ab60: 7761 7267 7320 3a0a 2020 2020 2020 2020  wargs :.        
-0003ab70: 416c 6c20 7265 6d61 696e 696e 6720 6b65  All remaining ke
-0003ab80: 7977 6f72 6473 2077 696c 6c20 6265 2070  ywords will be p
-0003ab90: 6173 7365 6420 746f 2060 6063 6875 6e6b  assed to ``chunk
-0003aba0: 6060 2c20 6060 6167 6772 6567 6174 6560  ``, ``aggregate`
-0003abb0: 602c 2061 6e64 0a20 2020 2020 2020 2060  `, and.        `
-0003abc0: 6063 6f6d 6269 6e65 6060 2e0a 0a20 2020  `combine``...   
-0003abd0: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
-0003abe0: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2064  ------.    >>> d
-0003abf0: 6566 2063 6875 6e6b 2861 5f62 6c6f 636b  ef chunk(a_block
-0003ac00: 2c20 625f 626c 6f63 6b29 3a0a 2020 2020  , b_block):.    
-0003ac10: 2e2e 2e20 2020 2020 7061 7373 0a0a 2020  ...     pass..  
-0003ac20: 2020 3e3e 3e20 6465 6620 6167 6728 6466    >>> def agg(df
-0003ac30: 293a 0a20 2020 202e 2e2e 2020 2020 2070  ):.    ...     p
-0003ac40: 6173 730a 0a20 2020 203e 3e3e 2061 7070  ass..    >>> app
-0003ac50: 6c79 5f63 6f6e 6361 745f 6170 706c 7928  ly_concat_apply(
-0003ac60: 5b61 2c20 625d 2c20 6368 756e 6b3d 6368  [a, b], chunk=ch
-0003ac70: 756e 6b2c 2061 6767 7265 6761 7465 3d61  unk, aggregate=a
-0003ac80: 6767 2920 2023 2064 6f63 7465 7374 3a20  gg)  # doctest: 
-0003ac90: 2b53 4b49 500a 2020 2020 2222 220a 2020  +SKIP.    """.  
-0003aca0: 2020 6966 2073 706c 6974 5f6f 7574 2069    if split_out i
-0003acb0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0003acc0: 7370 6c69 745f 6f75 7420 3d20 310a 2020  split_out = 1.  
-0003acd0: 2020 6966 2063 6875 6e6b 5f6b 7761 7267    if chunk_kwarg
-0003ace0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-0003acf0: 2020 2063 6875 6e6b 5f6b 7761 7267 7320     chunk_kwargs 
-0003ad00: 3d20 6469 6374 2829 0a20 2020 2069 6620  = dict().    if 
-0003ad10: 6167 6772 6567 6174 655f 6b77 6172 6773  aggregate_kwargs
-0003ad20: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0003ad30: 2020 6167 6772 6567 6174 655f 6b77 6172    aggregate_kwar
-0003ad40: 6773 203d 2064 6963 7428 290a 2020 2020  gs = dict().    
-0003ad50: 6368 756e 6b5f 6b77 6172 6773 2e75 7064  chunk_kwargs.upd
-0003ad60: 6174 6528 6b77 6172 6773 290a 2020 2020  ate(kwargs).    
-0003ad70: 6167 6772 6567 6174 655f 6b77 6172 6773  aggregate_kwargs
-0003ad80: 2e75 7064 6174 6528 6b77 6172 6773 290a  .update(kwargs).
-0003ad90: 0a20 2020 2069 6620 636f 6d62 696e 6520  .    if combine 
-0003ada0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0003adb0: 2069 6620 636f 6d62 696e 655f 6b77 6172   if combine_kwar
-0003adc0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0003add0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0003ade0: 2822 6063 6f6d 6269 6e65 5f6b 7761 7267  ("`combine_kwarg
-0003adf0: 7360 2070 726f 7669 6465 6420 7769 7468  s` provided with
-0003ae00: 206e 6f20 6063 6f6d 6269 6e65 6022 290a   no `combine`").
-0003ae10: 2020 2020 2020 2020 636f 6d62 696e 6520          combine 
-0003ae20: 3d20 6167 6772 6567 6174 650a 2020 2020  = aggregate.    
-0003ae30: 2020 2020 636f 6d62 696e 655f 6b77 6172      combine_kwar
-0003ae40: 6773 203d 2061 6767 7265 6761 7465 5f6b  gs = aggregate_k
-0003ae50: 7761 7267 730a 2020 2020 656c 7365 3a0a  wargs.    else:.
-0003ae60: 2020 2020 2020 2020 6966 2063 6f6d 6269          if combi
-0003ae70: 6e65 5f6b 7761 7267 7320 6973 204e 6f6e  ne_kwargs is Non
-0003ae80: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0003ae90: 6f6d 6269 6e65 5f6b 7761 7267 7320 3d20  ombine_kwargs = 
-0003aea0: 6469 6374 2829 0a20 2020 2020 2020 2063  dict().        c
-0003aeb0: 6f6d 6269 6e65 5f6b 7761 7267 732e 7570  ombine_kwargs.up
-0003aec0: 6461 7465 286b 7761 7267 7329 0a0a 2020  date(kwargs)..  
-0003aed0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0003aee0: 6e63 6528 6172 6773 2c20 2874 7570 6c65  nce(args, (tuple
-0003aef0: 2c20 6c69 7374 2929 3a0a 2020 2020 2020  , list)):.      
-0003af00: 2020 6172 6773 203d 205b 6172 6773 5d0a    args = [args].
-0003af10: 0a20 2020 2064 6673 203d 205b 6172 6720  .    dfs = [arg 
-0003af20: 666f 7220 6172 6720 696e 2061 7267 7320  for arg in args 
-0003af30: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-0003af40: 672c 205f 4672 616d 6529 5d0a 0a20 2020  g, _Frame)]..   
-0003af50: 206e 7061 7274 6974 696f 6e73 203d 207b   npartitions = {
-0003af60: 6172 672e 6e70 6172 7469 7469 6f6e 7320  arg.npartitions 
-0003af70: 666f 7220 6172 6720 696e 2064 6673 7d0a  for arg in dfs}.
-0003af80: 2020 2020 6966 206c 656e 286e 7061 7274      if len(npart
-0003af90: 6974 696f 6e73 2920 3e20 313a 0a20 2020  itions) > 1:.   
-0003afa0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0003afb0: 4572 726f 7228 2241 6c6c 2061 7267 756d  Error("All argum
-0003afc0: 656e 7473 206d 7573 7420 6861 7665 2073  ents must have s
-0003afd0: 616d 6520 6e75 6d62 6572 206f 6620 7061  ame number of pa
-0003afe0: 7274 6974 696f 6e73 2229 0a20 2020 206e  rtitions").    n
-0003aff0: 7061 7274 6974 696f 6e73 203d 206e 7061  partitions = npa
-0003b000: 7274 6974 696f 6e73 2e70 6f70 2829 0a0a  rtitions.pop()..
-0003b010: 2020 2020 6966 2073 706c 6974 5f65 7665      if split_eve
-0003b020: 7279 2069 7320 4e6f 6e65 3a0a 2020 2020  ry is None:.    
-0003b030: 2020 2020 7370 6c69 745f 6576 6572 7920      split_every 
-0003b040: 3d20 380a 2020 2020 656c 6966 2073 706c  = 8.    elif spl
-0003b050: 6974 5f65 7665 7279 2069 7320 4661 6c73  it_every is Fals
-0003b060: 653a 0a20 2020 2020 2020 2073 706c 6974  e:.        split
-0003b070: 5f65 7665 7279 203d 206e 7061 7274 6974  _every = npartit
-0003b080: 696f 6e73 0a20 2020 2065 6c69 6620 7370  ions.    elif sp
-0003b090: 6c69 745f 6576 6572 7920 3c20 3220 6f72  lit_every < 2 or
-0003b0a0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0003b0b0: 7370 6c69 745f 6576 6572 792c 2049 6e74  split_every, Int
-0003b0c0: 6567 7261 6c29 3a0a 2020 2020 2020 2020  egral):.        
-0003b0d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0003b0e0: 2822 7370 6c69 745f 6576 6572 7920 6d75  ("split_every mu
-0003b0f0: 7374 2062 6520 616e 2069 6e74 6567 6572  st be an integer
-0003b100: 203e 3d20 3222 290a 0a20 2020 2074 6f6b   >= 2")..    tok
-0003b110: 656e 5f6b 6579 203d 2074 6f6b 656e 697a  en_key = tokeniz
-0003b120: 6528 0a20 2020 2020 2020 2074 6f6b 656e  e(.        token
-0003b130: 206f 7220 2863 6875 6e6b 2c20 6167 6772   or (chunk, aggr
-0003b140: 6567 6174 6529 2c0a 2020 2020 2020 2020  egate),.        
-0003b150: 6d65 7461 2c0a 2020 2020 2020 2020 6172  meta,.        ar
-0003b160: 6773 2c0a 2020 2020 2020 2020 6368 756e  gs,.        chun
-0003b170: 6b5f 6b77 6172 6773 2c0a 2020 2020 2020  k_kwargs,.      
-0003b180: 2020 6167 6772 6567 6174 655f 6b77 6172    aggregate_kwar
-0003b190: 6773 2c0a 2020 2020 2020 2020 636f 6d62  gs,.        comb
-0003b1a0: 696e 655f 6b77 6172 6773 2c0a 2020 2020  ine_kwargs,.    
-0003b1b0: 2020 2020 7370 6c69 745f 6576 6572 792c      split_every,
-0003b1c0: 0a20 2020 2020 2020 2073 706c 6974 5f6f  .        split_o
-0003b1d0: 7574 2c0a 2020 2020 2020 2020 7370 6c69  ut,.        spli
-0003b1e0: 745f 6f75 745f 7365 7475 702c 0a20 2020  t_out_setup,.   
-0003b1f0: 2020 2020 2073 706c 6974 5f6f 7574 5f73       split_out_s
-0003b200: 6574 7570 5f6b 7761 7267 732c 0a20 2020  etup_kwargs,.   
-0003b210: 2029 0a0a 2020 2020 2320 426c 6f63 6b77   )..    # Blockw
-0003b220: 6973 6520 4368 756e 6b20 4c61 7965 720a  ise Chunk Layer.
-0003b230: 2020 2020 6368 756e 6b5f 6e61 6d65 203d      chunk_name =
-0003b240: 2066 227b 746f 6b65 6e20 6f72 2066 756e   f"{token or fun
-0003b250: 636e 616d 6528 6368 756e 6b29 7d2d 6368  cname(chunk)}-ch
-0003b260: 756e 6b2d 7b74 6f6b 656e 5f6b 6579 7d22  unk-{token_key}"
-0003b270: 0a20 2020 2063 6875 6e6b 6564 203d 206d  .    chunked = m
-0003b280: 6170 5f62 6167 5f70 6172 7469 7469 6f6e  ap_bag_partition
-0003b290: 7328 0a20 2020 2020 2020 2063 6875 6e6b  s(.        chunk
-0003b2a0: 2c0a 2020 2020 2020 2020 2320 436f 6e76  ,.        # Conv
-0003b2b0: 6572 7420 5f46 7261 6d65 2063 6f6c 6c65  ert _Frame colle
-0003b2c0: 6374 696f 6e73 2074 6f20 4261 670a 2020  ctions to Bag.  
-0003b2d0: 2020 2020 2020 2a5b 0a20 2020 2020 2020        *[.       
-0003b2e0: 2020 2020 2061 7267 2e74 6f5f 6261 6728       arg.to_bag(
-0003b2f0: 666f 726d 6174 3d22 6672 616d 6522 2920  format="frame") 
-0003b300: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-0003b310: 672c 205f 4672 616d 6529 2065 6c73 6520  g, _Frame) else 
-0003b320: 6172 670a 2020 2020 2020 2020 2020 2020  arg.            
-0003b330: 666f 7220 6172 6720 696e 2061 7267 730a  for arg in args.
-0003b340: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
-0003b350: 2020 2074 6f6b 656e 3d63 6875 6e6b 5f6e     token=chunk_n
-0003b360: 616d 652c 0a20 2020 2020 2020 202a 2a63  ame,.        **c
-0003b370: 6875 6e6b 5f6b 7761 7267 732c 0a20 2020  hunk_kwargs,.   
-0003b380: 2029 0a0a 2020 2020 2320 4e4f 5445 3a20   )..    # NOTE: 
-0003b390: 6063 6875 6e6b 6564 6020 6973 206e 6f77  `chunked` is now
-0003b3a0: 2061 2042 6167 2063 6f6c 6c65 6374 696f   a Bag collectio
-0003b3b0: 6e2e 0a20 2020 2023 2057 6520 646f 6e27  n..    # We don'
-0003b3c0: 7420 7573 6520 6120 4461 7461 4672 616d  t use a DataFram
-0003b3d0: 6520 636f 6c6c 6563 7469 6f6e 2c20 6265  e collection, be
-0003b3e0: 6361 7573 650a 2020 2020 2320 7468 6520  cause.    # the 
-0003b3f0: 7061 7274 6974 696f 6e73 206d 6179 206e  partitions may n
-0003b400: 6f74 2063 6f6e 7461 696e 2064 6174 6166  ot contain dataf
-0003b410: 7261 6d65 2d6c 696b 650a 2020 2020 2320  rame-like.    # 
-0003b420: 6f62 6a65 6374 7320 616e 796d 6f72 652e  objects anymore.
-0003b430: 0a0a 2020 2020 2320 426c 6f63 6b77 6973  ..    # Blockwis
-0003b440: 6520 5370 6c69 7420 4c61 7965 720a 2020  e Split Layer.  
-0003b450: 2020 6966 2073 706c 6974 5f6f 7574 2061    if split_out a
-0003b460: 6e64 2073 706c 6974 5f6f 7574 203e 2031  nd split_out > 1
-0003b470: 3a0a 2020 2020 2020 2020 6368 756e 6b65  :.        chunke
-0003b480: 6420 3d20 6368 756e 6b65 642e 6d61 705f  d = chunked.map_
-0003b490: 7061 7274 6974 696f 6e73 280a 2020 2020  partitions(.    
-0003b4a0: 2020 2020 2020 2020 6861 7368 5f73 6861          hash_sha
-0003b4b0: 7264 2c0a 2020 2020 2020 2020 2020 2020  rd,.            
-0003b4c0: 7370 6c69 745f 6f75 742c 0a20 2020 2020  split_out,.     
-0003b4d0: 2020 2020 2020 2073 706c 6974 5f6f 7574         split_out
-0003b4e0: 5f73 6574 7570 2c0a 2020 2020 2020 2020  _setup,.        
-0003b4f0: 2020 2020 7370 6c69 745f 6f75 745f 7365      split_out_se
-0003b500: 7475 705f 6b77 6172 6773 2c0a 2020 2020  tup_kwargs,.    
-0003b510: 2020 2020 2020 2020 6967 6e6f 7265 5f69          ignore_i
-0003b520: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-0003b530: 2020 746f 6b65 6e3d 2273 706c 6974 2d25    token="split-%
-0003b540: 7322 2025 2074 6f6b 656e 5f6b 6579 2c0a  s" % token_key,.
-0003b550: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-0003b560: 2048 616e 646c 6520 736f 7274 2062 6568   Handle sort beh
-0003b570: 6176 696f 720a 2020 2020 6966 2073 6f72  avior.    if sor
-0003b580: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-0003b590: 2020 2020 2020 2069 6620 736f 7274 2061         if sort a
-0003b5a0: 6e64 2073 706c 6974 5f6f 7574 203e 2031  nd split_out > 1
-0003b5b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0003b5c0: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
-0003b5d0: 6564 4572 726f 7228 0a20 2020 2020 2020  edError(.       
-0003b5e0: 2020 2020 2020 2020 2022 4361 6e6e 6f74           "Cannot
-0003b5f0: 2067 7561 7261 6e74 6565 2073 6f72 7465   guarantee sorte
-0003b600: 6420 6b65 7973 2066 6f72 2060 7370 6c69  d keys for `spli
-0003b610: 745f 6f75 743e 3160 2e22 0a20 2020 2020  t_out>1`.".     
-0003b620: 2020 2020 2020 2020 2020 2022 2054 7279             " Try
-0003b630: 2075 7369 6e67 2073 706c 6974 5f6f 7574   using split_out
-0003b640: 3d31 2c20 6f72 2067 726f 7570 696e 6720  =1, or grouping 
-0003b650: 7769 7468 2073 6f72 743d 4661 6c73 652e  with sort=False.
-0003b660: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-0003b670: 2020 2020 2020 2020 6167 6772 6567 6174          aggregat
-0003b680: 655f 6b77 6172 6773 203d 2061 6767 7265  e_kwargs = aggre
-0003b690: 6761 7465 5f6b 7761 7267 7320 6f72 207b  gate_kwargs or {
-0003b6a0: 7d0a 2020 2020 2020 2020 6167 6772 6567  }.        aggreg
-0003b6b0: 6174 655f 6b77 6172 6773 5b22 736f 7274  ate_kwargs["sort
-0003b6c0: 225d 203d 2073 6f72 740a 0a20 2020 2023  "] = sort..    #
-0003b6d0: 2054 7265 652d 5265 6475 6374 696f 6e20   Tree-Reduction 
-0003b6e0: 4c61 7965 720a 2020 2020 6669 6e61 6c5f  Layer.    final_
-0003b6f0: 6e61 6d65 203d 2066 227b 746f 6b65 6e20  name = f"{token 
-0003b700: 6f72 2066 756e 636e 616d 6528 6167 6772  or funcname(aggr
-0003b710: 6567 6174 6529 7d2d 6167 672d 7b74 6f6b  egate)}-agg-{tok
-0003b720: 656e 5f6b 6579 7d22 0a20 2020 206c 6179  en_key}".    lay
-0003b730: 6572 203d 2044 6174 6146 7261 6d65 5472  er = DataFrameTr
-0003b740: 6565 5265 6475 6374 696f 6e28 0a20 2020  eeReduction(.   
-0003b750: 2020 2020 2066 696e 616c 5f6e 616d 652c       final_name,
-0003b760: 0a20 2020 2020 2020 2063 6875 6e6b 6564  .        chunked
-0003b770: 2e6e 616d 652c 0a20 2020 2020 2020 206e  .name,.        n
-0003b780: 7061 7274 6974 696f 6e73 2c0a 2020 2020  partitions,.    
-0003b790: 2020 2020 7061 7274 6961 6c28 5f63 6f6e      partial(_con
-0003b7a0: 6361 742c 2069 676e 6f72 655f 696e 6465  cat, ignore_inde
-0003b7b0: 783d 6967 6e6f 7265 5f69 6e64 6578 292c  x=ignore_index),
-0003b7c0: 0a20 2020 2020 2020 2070 6172 7469 616c  .        partial
-0003b7d0: 2863 6f6d 6269 6e65 2c20 2a2a 636f 6d62  (combine, **comb
-0003b7e0: 696e 655f 6b77 6172 6773 2920 6966 2063  ine_kwargs) if c
-0003b7f0: 6f6d 6269 6e65 5f6b 7761 7267 7320 656c  ombine_kwargs el
-0003b800: 7365 2063 6f6d 6269 6e65 2c0a 2020 2020  se combine,.    
-0003b810: 2020 2020 6669 6e61 6c69 7a65 5f66 756e      finalize_fun
-0003b820: 633d 7061 7274 6961 6c28 6167 6772 6567  c=partial(aggreg
-0003b830: 6174 652c 202a 2a61 6767 7265 6761 7465  ate, **aggregate
-0003b840: 5f6b 7761 7267 7329 0a20 2020 2020 2020  _kwargs).       
-0003b850: 2069 6620 6167 6772 6567 6174 655f 6b77   if aggregate_kw
-0003b860: 6172 6773 0a20 2020 2020 2020 2065 6c73  args.        els
-0003b870: 6520 6167 6772 6567 6174 652c 0a20 2020  e aggregate,.   
-0003b880: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
-0003b890: 3d73 706c 6974 5f65 7665 7279 2c0a 2020  =split_every,.  
-0003b8a0: 2020 2020 2020 7370 6c69 745f 6f75 743d        split_out=
-0003b8b0: 7370 6c69 745f 6f75 7420 6966 2028 7370  split_out if (sp
-0003b8c0: 6c69 745f 6f75 7420 616e 6420 7370 6c69  lit_out and spli
-0003b8d0: 745f 6f75 7420 3e20 3129 2065 6c73 6520  t_out > 1) else 
-0003b8e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7472  None,.        tr
-0003b8f0: 6565 5f6e 6f64 655f 6e61 6d65 3d66 227b  ee_node_name=f"{
-0003b900: 746f 6b65 6e20 6f72 2066 756e 636e 616d  token or funcnam
-0003b910: 6528 636f 6d62 696e 6529 7d2d 636f 6d62  e(combine)}-comb
-0003b920: 696e 652d 7b74 6f6b 656e 5f6b 6579 7d22  ine-{token_key}"
-0003b930: 2c0a 2020 2020 290a 0a20 2020 2069 6620  ,.    )..    if 
-0003b940: 6d65 7461 2069 7320 6e6f 5f64 6566 6175  meta is no_defau
-0003b950: 6c74 3a0a 2020 2020 2020 2020 6d65 7461  lt:.        meta
-0003b960: 5f63 6875 6e6b 203d 205f 656d 756c 6174  _chunk = _emulat
-0003b970: 6528 6368 756e 6b2c 202a 6172 6773 2c20  e(chunk, *args, 
-0003b980: 7564 663d 5472 7565 2c20 2a2a 6368 756e  udf=True, **chun
-0003b990: 6b5f 6b77 6172 6773 290a 2020 2020 2020  k_kwargs).      
-0003b9a0: 2020 6d65 7461 203d 205f 656d 756c 6174    meta = _emulat
-0003b9b0: 6528 0a20 2020 2020 2020 2020 2020 2061  e(.            a
-0003b9c0: 6767 7265 6761 7465 2c20 5f63 6f6e 6361  ggregate, _conca
-0003b9d0: 7428 5b6d 6574 615f 6368 756e 6b5d 2c20  t([meta_chunk], 
-0003b9e0: 6967 6e6f 7265 5f69 6e64 6578 292c 2075  ignore_index), u
-0003b9f0: 6466 3d54 7275 652c 202a 2a61 6767 7265  df=True, **aggre
-0003ba00: 6761 7465 5f6b 7761 7267 730a 2020 2020  gate_kwargs.    
-0003ba10: 2020 2020 290a 2020 2020 6d65 7461 203d      ).    meta =
-0003ba20: 206d 616b 655f 6d65 7461 280a 2020 2020   make_meta(.    
-0003ba30: 2020 2020 6d65 7461 2c0a 2020 2020 2020      meta,.      
-0003ba40: 2020 696e 6465 783d 2867 6574 6174 7472    index=(getattr
-0003ba50: 286d 616b 655f 6d65 7461 2864 6673 5b30  (make_meta(dfs[0
-0003ba60: 5d29 2c20 2269 6e64 6578 222c 204e 6f6e  ]), "index", Non
-0003ba70: 6529 2069 6620 6466 7320 656c 7365 204e  e) if dfs else N
-0003ba80: 6f6e 6529 2c0a 2020 2020 2020 2020 7061  one),.        pa
-0003ba90: 7265 6e74 5f6d 6574 613d 6466 735b 305d  rent_meta=dfs[0]
-0003baa0: 2e5f 6d65 7461 2c0a 2020 2020 290a 0a20  ._meta,.    ).. 
-0003bab0: 2020 2067 7261 7068 203d 2048 6967 684c     graph = HighL
-0003bac0: 6576 656c 4772 6170 682e 6672 6f6d 5f63  evelGraph.from_c
-0003bad0: 6f6c 6c65 6374 696f 6e73 2866 696e 616c  ollections(final
-0003bae0: 5f6e 616d 652c 206c 6179 6572 2c20 6465  _name, layer, de
-0003baf0: 7065 6e64 656e 6369 6573 3d28 6368 756e  pendencies=(chun
-0003bb00: 6b65 642c 2929 0a20 2020 2064 6976 6973  ked,)).    divis
-0003bb10: 696f 6e73 203d 205b 4e6f 6e65 5d20 2a20  ions = [None] * 
-0003bb20: 2828 7370 6c69 745f 6f75 7420 6f72 2031  ((split_out or 1
-0003bb30: 2920 2b20 3129 0a20 2020 2072 6574 7572  ) + 1).    retur
-0003bb40: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-0003bb50: 6772 6170 682c 2066 696e 616c 5f6e 616d  graph, final_nam
-0003bb60: 652c 206d 6574 612c 2064 6976 6973 696f  e, meta, divisio
-0003bb70: 6e73 2c20 7061 7265 6e74 5f6d 6574 613d  ns, parent_meta=
-0003bb80: 6466 735b 305d 2e5f 6d65 7461 290a 0a0a  dfs[0]._meta)...
-0003bb90: 6163 6120 3d20 6170 706c 795f 636f 6e63  aca = apply_conc
-0003bba0: 6174 5f61 7070 6c79 0a0a 0a64 6566 205f  at_apply...def _
-0003bbb0: 6578 7472 6163 745f 6d65 7461 2878 2c20  extract_meta(x, 
-0003bbc0: 6e6f 6e65 6d70 7479 3d46 616c 7365 293a  nonempty=False):
-0003bbd0: 0a20 2020 2022 2222 0a20 2020 2045 7874  .    """.    Ext
-0003bbe0: 7261 6374 2069 6e74 6572 6e61 6c20 6361  ract internal ca
-0003bbf0: 6368 6520 6461 7461 2028 6060 5f6d 6574  che data (``_met
-0003bc00: 6160 6029 2066 726f 6d20 6464 2e44 6174  a``) from dd.Dat
-0003bc10: 6146 7261 6d65 202f 2064 642e 5365 7269  aFrame / dd.Seri
-0003bc20: 6573 0a20 2020 2022 2222 0a20 2020 2069  es.    """.    i
-0003bc30: 6620 6973 696e 7374 616e 6365 2878 2c20  f isinstance(x, 
-0003bc40: 2853 6361 6c61 722c 205f 4672 616d 6529  (Scalar, _Frame)
-0003bc50: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0003bc60: 6e20 782e 5f6d 6574 615f 6e6f 6e65 6d70  n x._meta_nonemp
-0003bc70: 7479 2069 6620 6e6f 6e65 6d70 7479 2065  ty if nonempty e
-0003bc80: 6c73 6520 782e 5f6d 6574 610a 2020 2020  lse x._meta.    
-0003bc90: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0003bca0: 782c 206c 6973 7429 3a0a 2020 2020 2020  x, list):.      
-0003bcb0: 2020 7265 7475 726e 205b 5f65 7874 7261    return [_extra
-0003bcc0: 6374 5f6d 6574 6128 5f78 2c20 6e6f 6e65  ct_meta(_x, none
-0003bcd0: 6d70 7479 2920 666f 7220 5f78 2069 6e20  mpty) for _x in 
-0003bce0: 785d 0a20 2020 2065 6c69 6620 6973 696e  x].    elif isin
-0003bcf0: 7374 616e 6365 2878 2c20 7475 706c 6529  stance(x, tuple)
-0003bd00: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0003bd10: 2074 7570 6c65 285f 6578 7472 6163 745f   tuple(_extract_
-0003bd20: 6d65 7461 285f 782c 206e 6f6e 656d 7074  meta(_x, nonempt
-0003bd30: 7929 2066 6f72 205f 7820 696e 2078 290a  y) for _x in x).
-0003bd40: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0003bd50: 6e63 6528 782c 2064 6963 7429 3a0a 2020  nce(x, dict):.  
-0003bd60: 2020 2020 2020 7265 7320 3d20 7b7d 0a20        res = {}. 
-0003bd70: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
-0003bd80: 783a 0a20 2020 2020 2020 2020 2020 2072  x:.            r
-0003bd90: 6573 5b6b 5d20 3d20 5f65 7874 7261 6374  es[k] = _extract
-0003bda0: 5f6d 6574 6128 785b 6b5d 2c20 6e6f 6e65  _meta(x[k], none
-0003bdb0: 6d70 7479 290a 2020 2020 2020 2020 7265  mpty).        re
-0003bdc0: 7475 726e 2072 6573 0a20 2020 2065 6c69  turn res.    eli
-0003bdd0: 6620 6973 696e 7374 616e 6365 2878 2c20  f isinstance(x, 
-0003bde0: 4465 6c61 7965 6429 3a0a 2020 2020 2020  Delayed):.      
-0003bdf0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0003be00: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0003be10: 2243 616e 6e6f 7420 696e 6665 7220 6461  "Cannot infer da
-0003be20: 7461 6672 616d 6520 6d65 7461 6461 7461  taframe metadata
-0003be30: 2077 6974 6820 6120 6064 6173 6b2e 6465   with a `dask.de
-0003be40: 6c61 7965 6460 2061 7267 756d 656e 7422  layed` argument"
-0003be50: 0a20 2020 2020 2020 2029 0a20 2020 2065  .        ).    e
-0003be60: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-0003be70: 7572 6e20 780a 0a0a 6465 6620 5f65 6d75  urn x...def _emu
-0003be80: 6c61 7465 2866 756e 632c 202a 6172 6773  late(func, *args
-0003be90: 2c20 7564 663d 4661 6c73 652c 202a 2a6b  , udf=False, **k
-0003bea0: 7761 7267 7329 3a0a 2020 2020 2222 220a  wargs):.    """.
-0003beb0: 2020 2020 4170 706c 7920 6120 6675 6e63      Apply a func
-0003bec0: 7469 6f6e 2075 7369 6e67 2061 7267 7320  tion using args 
-0003bed0: 2f20 6b77 6172 6773 2e20 4966 2061 7267  / kwargs. If arg
-0003bee0: 756d 656e 7473 2063 6f6e 7461 696e 2064  uments contain d
-0003bef0: 642e 4461 7461 4672 616d 6520 2f0a 2020  d.DataFrame /.  
-0003bf00: 2020 6464 2e53 6572 6965 732c 2075 7369    dd.Series, usi
-0003bf10: 6e67 2069 6e74 6572 6e61 6c20 6361 6368  ng internal cach
-0003bf20: 6520 2860 605f 6d65 7461 6060 2920 666f  e (``_meta``) fo
-0003bf30: 7220 6361 6c63 756c 6174 696f 6e0a 2020  r calculation.  
-0003bf40: 2020 2222 220a 2020 2020 7769 7468 2072    """.    with r
-0003bf50: 6169 7365 5f6f 6e5f 6d65 7461 5f65 7272  aise_on_meta_err
-0003bf60: 6f72 2866 756e 636e 616d 6528 6675 6e63  or(funcname(func
-0003bf70: 292c 2075 6466 3d75 6466 292c 2063 6865  ), udf=udf), che
-0003bf80: 636b 5f6e 756d 6572 6963 5f6f 6e6c 795f  ck_numeric_only_
-0003bf90: 6465 7072 6563 6174 696f 6e28 293a 0a20  deprecation():. 
-0003bfa0: 2020 2020 2020 2072 6574 7572 6e20 6675         return fu
-0003bfb0: 6e63 282a 5f65 7874 7261 6374 5f6d 6574  nc(*_extract_met
-0003bfc0: 6128 6172 6773 2c20 5472 7565 292c 202a  a(args, True), *
-0003bfd0: 2a5f 6578 7472 6163 745f 6d65 7461 286b  *_extract_meta(k
-0003bfe0: 7761 7267 732c 2054 7275 6529 290a 0a0a  wargs, True))...
-0003bff0: 4069 6e73 6572 745f 6d65 7461 5f70 6172  @insert_meta_par
-0003c000: 616d 5f64 6573 6372 6970 7469 6f6e 0a64  am_description.d
-0003c010: 6566 206d 6170 5f70 6172 7469 7469 6f6e  ef map_partition
-0003c020: 7328 0a20 2020 2066 756e 632c 0a20 2020  s(.    func,.   
-0003c030: 202a 6172 6773 2c0a 2020 2020 6d65 7461   *args,.    meta
-0003c040: 3d6e 6f5f 6465 6661 756c 742c 0a20 2020  =no_default,.   
-0003c050: 2065 6e66 6f72 6365 5f6d 6574 6164 6174   enforce_metadat
-0003c060: 613d 5472 7565 2c0a 2020 2020 7472 616e  a=True,.    tran
-0003c070: 7366 6f72 6d5f 6469 7669 7369 6f6e 733d  sform_divisions=
-0003c080: 5472 7565 2c0a 2020 2020 616c 6967 6e5f  True,.    align_
-0003c090: 6461 7461 6672 616d 6573 3d54 7275 652c  dataframes=True,
-0003c0a0: 0a20 2020 202a 2a6b 7761 7267 732c 0a29  .    **kwargs,.)
-0003c0b0: 3a0a 2020 2020 2222 2241 7070 6c79 2050  :.    """Apply P
-0003c0c0: 7974 686f 6e20 6675 6e63 7469 6f6e 206f  ython function o
-0003c0d0: 6e20 6561 6368 2044 6174 6146 7261 6d65  n each DataFrame
-0003c0e0: 2070 6172 7469 7469 6f6e 2e0a 0a20 2020   partition...   
-0003c0f0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-0003c100: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2066  ----------.    f
-0003c110: 756e 6320 3a20 6675 6e63 7469 6f6e 0a20  unc : function. 
-0003c120: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
-0003c130: 6170 706c 6965 6420 746f 2065 6163 6820  applied to each 
-0003c140: 7061 7274 6974 696f 6e2e 0a20 2020 2061  partition..    a
-0003c150: 7267 732c 206b 7761 7267 7320 3a0a 2020  rgs, kwargs :.  
-0003c160: 2020 2020 2020 4172 6775 6d65 6e74 7320        Arguments 
-0003c170: 616e 6420 6b65 7977 6f72 6473 2074 6f20  and keywords to 
-0003c180: 7061 7373 2074 6f20 7468 6520 6675 6e63  pass to the func
-0003c190: 7469 6f6e 2e20 2041 7420 6c65 6173 7420  tion.  At least 
-0003c1a0: 6f6e 6520 6f66 2074 6865 0a20 2020 2020  one of the.     
-0003c1b0: 2020 2061 7267 7320 7368 6f75 6c64 2062     args should b
-0003c1c0: 6520 6120 4461 736b 2e64 6174 6166 7261  e a Dask.datafra
-0003c1d0: 6d65 2e20 4172 6775 6d65 6e74 7320 616e  me. Arguments an
-0003c1e0: 6420 6b65 7977 6f72 6473 206d 6179 2063  d keywords may c
-0003c1f0: 6f6e 7461 696e 0a20 2020 2020 2020 2060  ontain.        `
-0003c200: 6053 6361 6c61 7260 602c 2060 6044 656c  `Scalar``, ``Del
-0003c210: 6179 6564 6060 206f 7220 7265 6775 6c61  ayed`` or regula
-0003c220: 7220 7079 7468 6f6e 206f 626a 6563 7473  r python objects
-0003c230: 2e20 4461 7461 4672 616d 652d 6c69 6b65  . DataFrame-like
-0003c240: 2061 7267 730a 2020 2020 2020 2020 2862   args.        (b
-0003c250: 6f74 6820 6461 736b 2061 6e64 2070 616e  oth dask and pan
-0003c260: 6461 7329 2077 696c 6c20 6265 2072 6570  das) will be rep
-0003c270: 6172 7469 7469 6f6e 6564 2074 6f20 616c  artitioned to al
-0003c280: 6967 6e20 2869 6620 6e65 6365 7373 6172  ign (if necessar
-0003c290: 7929 0a20 2020 2020 2020 2062 6566 6f72  y).        befor
-0003c2a0: 6520 6170 706c 7969 6e67 2074 6865 2066  e applying the f
-0003c2b0: 756e 6374 696f 6e20 2873 6565 2060 6061  unction (see ``a
-0003c2c0: 6c69 676e 5f64 6174 6166 7261 6d65 7360  lign_dataframes`
-0003c2d0: 6020 746f 2063 6f6e 7472 6f6c 292e 0a20  ` to control).. 
-0003c2e0: 2020 2065 6e66 6f72 6365 5f6d 6574 6164     enforce_metad
-0003c2f0: 6174 6120 3a20 626f 6f6c 2c20 6465 6661  ata : bool, defa
-0003c300: 756c 7420 5472 7565 0a20 2020 2020 2020  ult True.       
-0003c310: 2057 6865 7468 6572 2074 6f20 656e 666f   Whether to enfo
-0003c320: 7263 6520 6174 2072 756e 7469 6d65 2074  rce at runtime t
-0003c330: 6861 7420 7468 6520 7374 7275 6374 7572  hat the structur
-0003c340: 6520 6f66 2074 6865 2044 6174 6146 7261  e of the DataFra
-0003c350: 6d65 0a20 2020 2020 2020 2070 726f 6475  me.        produ
-0003c360: 6365 6420 6279 2060 6066 756e 6360 6020  ced by ``func`` 
-0003c370: 6163 7475 616c 6c79 206d 6174 6368 6573  actually matches
-0003c380: 2074 6865 2073 7472 7563 7475 7265 206f   the structure o
-0003c390: 6620 6060 6d65 7461 6060 2e0a 2020 2020  f ``meta``..    
-0003c3a0: 2020 2020 5468 6973 2077 696c 6c20 7265      This will re
-0003c3b0: 6e61 6d65 2061 6e64 2072 656f 7264 6572  name and reorder
-0003c3c0: 2063 6f6c 756d 6e73 2066 6f72 2065 6163   columns for eac
-0003c3d0: 6820 7061 7274 6974 696f 6e2c 0a20 2020  h partition,.   
-0003c3e0: 2020 2020 2061 6e64 2077 696c 6c20 7261       and will ra
-0003c3f0: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
-0003c400: 7468 6973 2064 6f65 736e 2774 2077 6f72  this doesn't wor
-0003c410: 6b2c 0a20 2020 2020 2020 2062 7574 2069  k,.        but i
-0003c420: 7420 776f 6e27 7420 7261 6973 6520 6966  t won't raise if
-0003c430: 2064 7479 7065 7320 646f 6e27 7420 6d61   dtypes don't ma
-0003c440: 7463 682e 0a20 2020 2074 7261 6e73 666f  tch..    transfo
-0003c450: 726d 5f64 6976 6973 696f 6e73 203a 2062  rm_divisions : b
-0003c460: 6f6f 6c2c 2064 6566 6175 6c74 2054 7275  ool, default Tru
-0003c470: 650a 2020 2020 2020 2020 5768 6574 6865  e.        Whethe
-0003c480: 7220 746f 2061 7070 6c79 2074 6865 2066  r to apply the f
-0003c490: 756e 6374 696f 6e20 6f6e 746f 2074 6865  unction onto the
-0003c4a0: 2064 6976 6973 696f 6e73 2061 6e64 2061   divisions and a
-0003c4b0: 7070 6c79 2074 686f 7365 0a20 2020 2020  pply those.     
-0003c4c0: 2020 2074 7261 6e73 666f 726d 6564 2064     transformed d
-0003c4d0: 6976 6973 696f 6e73 2074 6f20 7468 6520  ivisions to the 
-0003c4e0: 6f75 7470 7574 2e0a 2020 2020 616c 6967  output..    alig
-0003c4f0: 6e5f 6461 7461 6672 616d 6573 203a 2062  n_dataframes : b
-0003c500: 6f6f 6c2c 2064 6566 6175 6c74 2054 7275  ool, default Tru
-0003c510: 650a 2020 2020 2020 2020 5768 6574 6865  e.        Whethe
-0003c520: 7220 746f 2072 6570 6172 7469 7469 6f6e  r to repartition
-0003c530: 2044 6174 6146 7261 6d65 2d20 6f72 2053   DataFrame- or S
-0003c540: 6572 6965 732d 6c69 6b65 2061 7267 730a  eries-like args.
-0003c550: 2020 2020 2020 2020 2862 6f74 6820 6461          (both da
-0003c560: 736b 2061 6e64 2070 616e 6461 7329 2073  sk and pandas) s
-0003c570: 6f20 7468 6569 7220 6469 7669 7369 6f6e  o their division
-0003c580: 7320 616c 6967 6e20 6265 666f 7265 2061  s align before a
-0003c590: 7070 6c79 696e 670a 2020 2020 2020 2020  pplying.        
-0003c5a0: 7468 6520 6675 6e63 7469 6f6e 2e20 5468  the function. Th
-0003c5b0: 6973 2072 6571 7569 7265 7320 616c 6c20  is requires all 
-0003c5c0: 696e 7075 7473 2074 6f20 6861 7665 206b  inputs to have k
-0003c5d0: 6e6f 776e 2064 6976 6973 696f 6e73 2e0a  nown divisions..
-0003c5e0: 2020 2020 2020 2020 5369 6e67 6c65 2d70          Single-p
-0003c5f0: 6172 7469 7469 6f6e 2069 6e70 7574 7320  artition inputs 
-0003c600: 7769 6c6c 2062 6520 7370 6c69 7420 696e  will be split in
-0003c610: 746f 206d 756c 7469 706c 6520 7061 7274  to multiple part
-0003c620: 6974 696f 6e73 2e0a 0a20 2020 2020 2020  itions...       
-0003c630: 2049 6620 4661 6c73 652c 2061 6c6c 2069   If False, all i
-0003c640: 6e70 7574 7320 6d75 7374 2068 6176 6520  nputs must have 
-0003c650: 6569 7468 6572 2074 6865 2073 616d 6520  either the same 
-0003c660: 6e75 6d62 6572 206f 6620 7061 7274 6974  number of partit
-0003c670: 696f 6e73 0a20 2020 2020 2020 206f 7220  ions.        or 
-0003c680: 6120 7369 6e67 6c65 2070 6172 7469 7469  a single partiti
-0003c690: 6f6e 2e20 5369 6e67 6c65 2d70 6172 7469  on. Single-parti
-0003c6a0: 7469 6f6e 2069 6e70 7574 7320 7769 6c6c  tion inputs will
-0003c6b0: 2062 6520 6272 6f61 6463 6173 7420 746f   be broadcast to
-0003c6c0: 0a20 2020 2020 2020 2065 7665 7279 2070  .        every p
-0003c6d0: 6172 7469 7469 6f6e 206f 6620 6d75 6c74  artition of mult
-0003c6e0: 692d 7061 7274 6974 696f 6e20 696e 7075  i-partition inpu
-0003c6f0: 7473 2e0a 2020 2020 244d 4554 410a 2020  ts..    $META.  
-0003c700: 2020 2222 220a 2020 2020 6e61 6d65 203d    """.    name =
-0003c710: 206b 7761 7267 732e 706f 7028 2274 6f6b   kwargs.pop("tok
-0003c720: 656e 222c 204e 6f6e 6529 0a20 2020 2070  en", None).    p
-0003c730: 6172 656e 745f 6d65 7461 203d 206b 7761  arent_meta = kwa
-0003c740: 7267 732e 706f 7028 2270 6172 656e 745f  rgs.pop("parent_
-0003c750: 6d65 7461 222c 204e 6f6e 6529 0a0a 2020  meta", None)..  
-0003c760: 2020 6173 7365 7274 2063 616c 6c61 626c    assert callabl
-0003c770: 6528 6675 6e63 290a 2020 2020 6966 206e  e(func).    if n
-0003c780: 616d 6520 6973 206e 6f74 204e 6f6e 653a  ame is not None:
-0003c790: 0a20 2020 2020 2020 2074 6f6b 656e 203d  .        token =
-0003c7a0: 2074 6f6b 656e 697a 6528 6d65 7461 2c20   tokenize(meta, 
-0003c7b0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0003c7c0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0003c7d0: 2020 206e 616d 6520 3d20 6675 6e63 6e61     name = funcna
-0003c7e0: 6d65 2866 756e 6329 0a20 2020 2020 2020  me(func).       
-0003c7f0: 2074 6f6b 656e 203d 2074 6f6b 656e 697a   token = tokeniz
-0003c800: 6528 6675 6e63 2c20 6d65 7461 2c20 2a61  e(func, meta, *a
-0003c810: 7267 732c 202a 2a6b 7761 7267 7329 0a20  rgs, **kwargs). 
-0003c820: 2020 206e 616d 6520 3d20 6622 7b6e 616d     name = f"{nam
-0003c830: 657d 2d7b 746f 6b65 6e7d 220a 0a20 2020  e}-{token}"..   
-0003c840: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
-0003c850: 7261 6d65 2e6d 756c 7469 2069 6d70 6f72  rame.multi impor
-0003c860: 7420 5f6d 6179 6265 5f61 6c69 676e 5f70  t _maybe_align_p
-0003c870: 6172 7469 7469 6f6e 730a 0a20 2020 2069  artitions..    i
-0003c880: 6620 616c 6967 6e5f 6461 7461 6672 616d  f align_datafram
-0003c890: 6573 3a0a 2020 2020 2020 2020 6172 6773  es:.        args
-0003c8a0: 203d 205f 6d61 7962 655f 6672 6f6d 5f70   = _maybe_from_p
-0003c8b0: 616e 6461 7328 6172 6773 290a 2020 2020  andas(args).    
-0003c8c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0003c8d0: 2020 2020 2061 7267 7320 3d20 5f6d 6179       args = _may
-0003c8e0: 6265 5f61 6c69 676e 5f70 6172 7469 7469  be_align_partiti
-0003c8f0: 6f6e 7328 6172 6773 290a 2020 2020 2020  ons(args).      
-0003c900: 2020 6578 6365 7074 2056 616c 7565 4572    except ValueEr
-0003c910: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-0003c920: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0003c930: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0003c940: 2020 2020 2020 2020 6622 7b65 7d2e 2049          f"{e}. I
-0003c950: 6620 796f 7520 646f 6e27 7420 7761 6e74  f you don't want
-0003c960: 2074 6865 2070 6172 7469 7469 6f6e 7320   the partitions 
-0003c970: 746f 2062 6520 616c 6967 6e65 642c 2061  to be aligned, a
-0003c980: 6e64 2061 7265 2022 0a20 2020 2020 2020  nd are ".       
-0003c990: 2020 2020 2020 2020 2022 6361 6c6c 696e           "callin
-0003c9a0: 6720 606d 6170 5f70 6172 7469 7469 6f6e  g `map_partition
-0003c9b0: 7360 2064 6972 6563 746c 792c 2070 6173  s` directly, pas
-0003c9c0: 7320 6061 6c69 676e 5f64 6174 6166 7261  s `align_datafra
-0003c9d0: 6d65 733d 4661 6c73 6560 2e22 0a20 2020  mes=False`.".   
-0003c9e0: 2020 2020 2020 2020 2029 2066 726f 6d20           ) from 
-0003c9f0: 650a 0a20 2020 2064 6673 203d 205b 6466  e..    dfs = [df
-0003ca00: 2066 6f72 2064 6620 696e 2061 7267 7320   for df in args 
-0003ca10: 6966 2069 7369 6e73 7461 6e63 6528 6466  if isinstance(df
-0003ca20: 2c20 5f46 7261 6d65 295d 0a0a 2020 2020  , _Frame)]..    
-0003ca30: 6d65 7461 203d 205f 6765 745f 6d65 7461  meta = _get_meta
-0003ca40: 5f6d 6170 5f70 6172 7469 7469 6f6e 7328  _map_partitions(
-0003ca50: 6172 6773 2c20 6466 732c 2066 756e 632c  args, dfs, func,
-0003ca60: 206b 7761 7267 732c 206d 6574 612c 2070   kwargs, meta, p
-0003ca70: 6172 656e 745f 6d65 7461 290a 2020 2020  arent_meta).    
-0003ca80: 6966 2061 6c6c 2869 7369 6e73 7461 6e63  if all(isinstanc
-0003ca90: 6528 6172 672c 2053 6361 6c61 7229 2066  e(arg, Scalar) f
-0003caa0: 6f72 2061 7267 2069 6e20 6172 6773 293a  or arg in args):
-0003cab0: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
-0003cac0: 207b 0a20 2020 2020 2020 2020 2020 2028   {.            (
-0003cad0: 6e61 6d65 2c20 3029 3a20 280a 2020 2020  name, 0): (.    
-0003cae0: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-0003caf0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0003cb00: 2020 2066 756e 632c 0a20 2020 2020 2020     func,.       
-0003cb10: 2020 2020 2020 2020 2028 7475 706c 652c           (tuple,
-0003cb20: 205b 2861 7267 2e5f 6e61 6d65 2c20 3029   [(arg._name, 0)
-0003cb30: 2066 6f72 2061 7267 2069 6e20 6172 6773   for arg in args
-0003cb40: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-0003cb50: 2020 2020 6b77 6172 6773 2c0a 2020 2020      kwargs,.    
-0003cb60: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0003cb70: 2020 7d0a 2020 2020 2020 2020 6772 6170    }.        grap
-0003cb80: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
-0003cb90: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
-0003cba0: 6f6e 7328 6e61 6d65 2c20 6c61 7965 722c  ons(name, layer,
-0003cbb0: 2064 6570 656e 6465 6e63 6965 733d 6172   dependencies=ar
-0003cbc0: 6773 290a 2020 2020 2020 2020 7265 7475  gs).        retu
-0003cbd0: 726e 2053 6361 6c61 7228 6772 6170 682c  rn Scalar(graph,
-0003cbe0: 206e 616d 652c 206d 6574 6129 0a0a 2020   name, meta)..  
-0003cbf0: 2020 6172 6773 3220 3d20 5b5d 0a20 2020    args2 = [].   
-0003cc00: 2064 6570 656e 6465 6e63 6965 7320 3d20   dependencies = 
-0003cc10: 5b5d 0a20 2020 2066 6f72 2061 7267 2069  [].    for arg i
-0003cc20: 6e20 6172 6773 3a0a 2020 2020 2020 2020  n args:.        
-0003cc30: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-0003cc40: 672c 205f 4672 616d 6529 3a0a 2020 2020  g, _Frame):.    
-0003cc50: 2020 2020 2020 2020 6172 6773 322e 6170          args2.ap
-0003cc60: 7065 6e64 2861 7267 290a 2020 2020 2020  pend(arg).      
-0003cc70: 2020 2020 2020 6465 7065 6e64 656e 6369        dependenci
-0003cc80: 6573 2e61 7070 656e 6428 6172 6729 0a20  es.append(arg). 
-0003cc90: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0003cca0: 6e75 650a 2020 2020 2020 2020 6172 6720  nue.        arg 
-0003ccb0: 3d20 6e6f 726d 616c 697a 655f 6172 6728  = normalize_arg(
-0003ccc0: 6172 6729 0a20 2020 2020 2020 2061 7267  arg).        arg
-0003ccd0: 322c 2063 6f6c 6c65 6374 696f 6e73 203d  2, collections =
-0003cce0: 2075 6e70 6163 6b5f 636f 6c6c 6563 7469   unpack_collecti
-0003ccf0: 6f6e 7328 6172 6729 0a20 2020 2020 2020  ons(arg).       
-0003cd00: 2069 6620 636f 6c6c 6563 7469 6f6e 733a   if collections:
-0003cd10: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-0003cd20: 7332 2e61 7070 656e 6428 6172 6732 290a  s2.append(arg2).
-0003cd30: 2020 2020 2020 2020 2020 2020 6465 7065              depe
-0003cd40: 6e64 656e 6369 6573 2e65 7874 656e 6428  ndencies.extend(
-0003cd50: 636f 6c6c 6563 7469 6f6e 7329 0a20 2020  collections).   
-0003cd60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003cd70: 2020 2020 2020 2061 7267 7332 2e61 7070         args2.app
-0003cd80: 656e 6428 6172 6729 0a0a 2020 2020 6b77  end(arg)..    kw
-0003cd90: 6172 6773 3320 3d20 7b7d 0a20 2020 2073  args3 = {}.    s
-0003cda0: 696d 706c 6520 3d20 5472 7565 0a20 2020  imple = True.   
-0003cdb0: 2066 6f72 206b 2c20 7620 696e 206b 7761   for k, v in kwa
-0003cdc0: 7267 732e 6974 656d 7328 293a 0a20 2020  rgs.items():.   
-0003cdd0: 2020 2020 2076 203d 206e 6f72 6d61 6c69       v = normali
-0003cde0: 7a65 5f61 7267 2876 290a 2020 2020 2020  ze_arg(v).      
-0003cdf0: 2020 762c 2063 6f6c 6c65 6374 696f 6e73    v, collections
-0003ce00: 203d 2075 6e70 6163 6b5f 636f 6c6c 6563   = unpack_collec
-0003ce10: 7469 6f6e 7328 7629 0a20 2020 2020 2020  tions(v).       
-0003ce20: 2064 6570 656e 6465 6e63 6965 732e 6578   dependencies.ex
-0003ce30: 7465 6e64 2863 6f6c 6c65 6374 696f 6e73  tend(collections
-0003ce40: 290a 2020 2020 2020 2020 6b77 6172 6773  ).        kwargs
-0003ce50: 335b 6b5d 203d 2076 0a20 2020 2020 2020  3[k] = v.       
-0003ce60: 2069 6620 636f 6c6c 6563 7469 6f6e 733a   if collections:
-0003ce70: 0a20 2020 2020 2020 2020 2020 2073 696d  .            sim
-0003ce80: 706c 6520 3d20 4661 6c73 650a 0a20 2020  ple = False..   
-0003ce90: 2064 6976 6973 696f 6e73 203d 205f 6765   divisions = _ge
-0003cea0: 745f 6469 7669 7369 6f6e 735f 6d61 705f  t_divisions_map_
-0003ceb0: 7061 7274 6974 696f 6e73 280a 2020 2020  partitions(.    
-0003cec0: 2020 2020 616c 6967 6e5f 6461 7461 6672      align_datafr
-0003ced0: 616d 6573 2c20 7472 616e 7366 6f72 6d5f  ames, transform_
-0003cee0: 6469 7669 7369 6f6e 732c 2064 6673 2c20  divisions, dfs, 
-0003cef0: 6675 6e63 2c20 6172 6773 2c20 6b77 6172  func, args, kwar
-0003cf00: 6773 0a20 2020 2029 0a0a 2020 2020 6966  gs.    )..    if
-0003cf10: 2068 6173 5f6b 6579 776f 7264 2866 756e   has_keyword(fun
-0003cf20: 632c 2022 7061 7274 6974 696f 6e5f 696e  c, "partition_in
-0003cf30: 666f 2229 3a0a 2020 2020 2020 2020 7061  fo"):.        pa
-0003cf40: 7274 6974 696f 6e5f 696e 666f 203d 207b  rtition_info = {
-0003cf50: 0a20 2020 2020 2020 2020 2020 2028 692c  .            (i,
-0003cf60: 293a 207b 226e 756d 6265 7222 3a20 692c  ): {"number": i,
-0003cf70: 2022 6469 7669 7369 6f6e 223a 2064 6976   "division": div
-0003cf80: 6973 696f 6e7d 0a20 2020 2020 2020 2020  ision}.         
-0003cf90: 2020 2066 6f72 2069 2c20 6469 7669 7369     for i, divisi
-0003cfa0: 6f6e 2069 6e20 656e 756d 6572 6174 6528  on in enumerate(
-0003cfb0: 6469 7669 7369 6f6e 735b 3a2d 315d 290a  divisions[:-1]).
-0003cfc0: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0003cfd0: 2020 2061 7267 7332 2e69 6e73 6572 7428     args2.insert(
-0003cfe0: 302c 2042 6c6f 636b 7769 7365 4465 7044  0, BlockwiseDepD
-0003cff0: 6963 7428 7061 7274 6974 696f 6e5f 696e  ict(partition_in
-0003d000: 666f 2929 0a20 2020 2020 2020 206f 7269  fo)).        ori
-0003d010: 675f 6675 6e63 203d 2066 756e 630a 0a20  g_func = func.. 
-0003d020: 2020 2020 2020 2064 6566 2066 756e 6328         def func(
-0003d030: 7061 7274 6974 696f 6e5f 696e 666f 2c20  partition_info, 
-0003d040: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0003d050: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0003d060: 7475 726e 206f 7269 675f 6675 6e63 282a  turn orig_func(*
-0003d070: 6172 6773 2c20 2a2a 6b77 6172 6773 2c20  args, **kwargs, 
-0003d080: 7061 7274 6974 696f 6e5f 696e 666f 3d70  partition_info=p
-0003d090: 6172 7469 7469 6f6e 5f69 6e66 6f29 0a0a  artition_info)..
-0003d0a0: 2020 2020 6966 2065 6e66 6f72 6365 5f6d      if enforce_m
-0003d0b0: 6574 6164 6174 613a 0a20 2020 2020 2020  etadata:.       
-0003d0c0: 2064 736b 203d 2070 6172 7469 7469 6f6e   dsk = partition
-0003d0d0: 7769 7365 5f67 7261 7068 280a 2020 2020  wise_graph(.    
-0003d0e0: 2020 2020 2020 2020 6170 706c 795f 616e          apply_an
-0003d0f0: 645f 656e 666f 7263 652c 0a20 2020 2020  d_enforce,.     
-0003d100: 2020 2020 2020 206e 616d 652c 0a20 2020         name,.   
-0003d110: 2020 2020 2020 2020 202a 6172 6773 322c           *args2,
-0003d120: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-0003d130: 656e 6465 6e63 6965 733d 6465 7065 6e64  endencies=depend
-0003d140: 656e 6369 6573 2c0a 2020 2020 2020 2020  encies,.        
-0003d150: 2020 2020 5f66 756e 633d 6675 6e63 2c0a      _func=func,.
-0003d160: 2020 2020 2020 2020 2020 2020 5f6d 6574              _met
-0003d170: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
-0003d180: 2020 2020 2a2a 6b77 6172 6773 332c 0a20      **kwargs3,. 
-0003d190: 2020 2020 2020 2029 0a20 2020 2065 6c73         ).    els
-0003d1a0: 653a 0a20 2020 2020 2020 206b 7761 7267  e:.        kwarg
-0003d1b0: 7334 203d 206b 7761 7267 7320 6966 2073  s4 = kwargs if s
-0003d1c0: 696d 706c 6520 656c 7365 206b 7761 7267  imple else kwarg
-0003d1d0: 7333 0a20 2020 2020 2020 2064 736b 203d  s3.        dsk =
-0003d1e0: 2070 6172 7469 7469 6f6e 7769 7365 5f67   partitionwise_g
-0003d1f0: 7261 7068 280a 2020 2020 2020 2020 2020  raph(.          
-0003d200: 2020 6675 6e63 2c20 6e61 6d65 2c20 2a61    func, name, *a
-0003d210: 7267 7332 2c20 2a2a 6b77 6172 6773 342c  rgs2, **kwargs4,
-0003d220: 2064 6570 656e 6465 6e63 6965 733d 6465   dependencies=de
-0003d230: 7065 6e64 656e 6369 6573 0a20 2020 2020  pendencies.     
-0003d240: 2020 2029 0a0a 2020 2020 6772 6170 6820     )..    graph 
-0003d250: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
-0003d260: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
-0003d270: 7328 6e61 6d65 2c20 6473 6b2c 2064 6570  s(name, dsk, dep
-0003d280: 656e 6465 6e63 6965 733d 6465 7065 6e64  endencies=depend
-0003d290: 656e 6369 6573 290a 2020 2020 7265 7475  encies).    retu
-0003d2a0: 726e 206e 6577 5f64 645f 6f62 6a65 6374  rn new_dd_object
-0003d2b0: 2867 7261 7068 2c20 6e61 6d65 2c20 6d65  (graph, name, me
-0003d2c0: 7461 2c20 6469 7669 7369 6f6e 7329 0a0a  ta, divisions)..
-0003d2d0: 0a64 6566 205f 6765 745f 6469 7669 7369  .def _get_divisi
-0003d2e0: 6f6e 735f 6d61 705f 7061 7274 6974 696f  ons_map_partitio
-0003d2f0: 6e73 280a 2020 2020 616c 6967 6e5f 6461  ns(.    align_da
-0003d300: 7461 6672 616d 6573 2c20 7472 616e 7366  taframes, transf
-0003d310: 6f72 6d5f 6469 7669 7369 6f6e 732c 2064  orm_divisions, d
-0003d320: 6673 2c20 6675 6e63 2c20 6172 6773 2c20  fs, func, args, 
-0003d330: 6b77 6172 6773 0a29 3a0a 2020 2020 2222  kwargs.):.    ""
-0003d340: 220a 2020 2020 4865 6c70 6572 2074 6f20  ".    Helper to 
-0003d350: 6765 7420 6469 7669 7369 6f6e 7320 666f  get divisions fo
-0003d360: 7220 6d61 705f 7061 7274 6974 696f 6e73  r map_partitions
-0003d370: 2061 6e64 206d 6170 5f6f 7665 726c 6170   and map_overlap
-0003d380: 206f 7574 7075 742e 0a20 2020 2022 2222   output..    """
-0003d390: 0a20 2020 2069 6620 616c 6967 6e5f 6461  .    if align_da
-0003d3a0: 7461 6672 616d 6573 3a0a 2020 2020 2020  taframes:.      
-0003d3b0: 2020 6469 7669 7369 6f6e 7320 3d20 6466    divisions = df
-0003d3c0: 735b 305d 2e64 6976 6973 696f 6e73 0a20  s[0].divisions. 
-0003d3d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0003d3e0: 2023 2055 6e61 6c69 676e 6564 2c20 6466   # Unaligned, df
-0003d3f0: 7320 6973 2061 206d 6978 206f 6620 3120  s is a mix of 1 
-0003d400: 7061 7274 6974 696f 6e20 616e 6420 312b  partition and 1+
-0003d410: 2070 6172 7469 7469 6f6e 2064 6174 6166   partition dataf
-0003d420: 7261 6d65 732c 0a20 2020 2020 2020 2023  rames,.        #
-0003d430: 2075 7365 206c 6f6e 6765 7374 2064 6976   use longest div
-0003d440: 6973 696f 6e73 2066 6f75 6e64 0a20 2020  isions found.   
-0003d450: 2020 2020 2064 6976 6973 696f 6e73 203d       divisions =
-0003d460: 206d 6178 2828 642e 6469 7669 7369 6f6e   max((d.division
-0003d470: 7320 666f 7220 6420 696e 2064 6673 292c  s for d in dfs),
-0003d480: 206b 6579 3d6c 656e 290a 2020 2020 6966   key=len).    if
-0003d490: 2074 7261 6e73 666f 726d 5f64 6976 6973   transform_divis
-0003d4a0: 696f 6e73 2061 6e64 2069 7369 6e73 7461  ions and isinsta
-0003d4b0: 6e63 6528 6466 735b 305d 2c20 496e 6465  nce(dfs[0], Inde
-0003d4c0: 7829 2061 6e64 206c 656e 2864 6673 2920  x) and len(dfs) 
-0003d4d0: 3d3d 2031 3a0a 2020 2020 2020 2020 7472  == 1:.        tr
-0003d4e0: 793a 0a20 2020 2020 2020 2020 2020 2064  y:.            d
-0003d4f0: 6976 6973 696f 6e73 203d 2066 756e 6328  ivisions = func(
-0003d500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d510: 202a 5b70 642e 496e 6465 7828 612e 6469   *[pd.Index(a.di
-0003d520: 7669 7369 6f6e 7329 2069 6620 6120 6973  visions) if a is
-0003d530: 2064 6673 5b30 5d20 656c 7365 2061 2066   dfs[0] else a f
-0003d540: 6f72 2061 2069 6e20 6172 6773 5d2c 202a  or a in args], *
-0003d550: 2a6b 7761 7267 730a 2020 2020 2020 2020  *kwargs.        
-0003d560: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0003d570: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0003d580: 6469 7669 7369 6f6e 732c 2070 642e 496e  divisions, pd.In
-0003d590: 6465 7829 3a0a 2020 2020 2020 2020 2020  dex):.          
-0003d5a0: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
-0003d5b0: 3d20 6d65 7468 6f64 732e 746f 6c69 7374  = methods.tolist
-0003d5c0: 2864 6976 6973 696f 6e73 290a 2020 2020  (divisions).    
-0003d5d0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0003d5e0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0003d5f0: 2020 7061 7373 0a20 2020 2020 2020 2065    pass.        e
-0003d600: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0003d610: 2069 6620 6e6f 7420 7661 6c69 645f 6469   if not valid_di
-0003d620: 7669 7369 6f6e 7328 6469 7669 7369 6f6e  visions(division
-0003d630: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0003d640: 2020 2020 6469 7669 7369 6f6e 7320 3d20      divisions = 
-0003d650: 5b4e 6f6e 655d 202a 2028 6466 735b 305d  [None] * (dfs[0]
-0003d660: 2e6e 7061 7274 6974 696f 6e73 202b 2031  .npartitions + 1
-0003d670: 290a 2020 2020 7265 7475 726e 2064 6976  ).    return div
-0003d680: 6973 696f 6e73 0a0a 0a64 6566 205f 6765  isions...def _ge
-0003d690: 745f 6d65 7461 5f6d 6170 5f70 6172 7469  t_meta_map_parti
-0003d6a0: 7469 6f6e 7328 6172 6773 2c20 6466 732c  tions(args, dfs,
-0003d6b0: 2066 756e 632c 206b 7761 7267 732c 206d   func, kwargs, m
-0003d6c0: 6574 612c 2070 6172 656e 745f 6d65 7461  eta, parent_meta
-0003d6d0: 293a 0a20 2020 2022 2222 0a20 2020 2048  ):.    """.    H
-0003d6e0: 656c 7065 7220 746f 2067 656e 6572 6174  elper to generat
-0003d6f0: 6520 6d65 7461 6461 7461 2066 6f72 206d  e metadata for m
-0003d700: 6170 5f70 6172 7469 7469 6f6e 7320 616e  ap_partitions an
-0003d710: 6420 6d61 705f 6f76 6572 6c61 7020 6f75  d map_overlap ou
-0003d720: 7470 7574 2e0a 2020 2020 2222 220a 2020  tput..    """.  
-0003d730: 2020 6d65 7461 5f69 6e64 6578 203d 2067    meta_index = g
-0003d740: 6574 6174 7472 286d 616b 655f 6d65 7461  etattr(make_meta
-0003d750: 2864 6673 5b30 5d29 2c20 2269 6e64 6578  (dfs[0]), "index
-0003d760: 222c 204e 6f6e 6529 2069 6620 6466 7320  ", None) if dfs 
-0003d770: 656c 7365 204e 6f6e 650a 2020 2020 6966  else None.    if
-0003d780: 2070 6172 656e 745f 6d65 7461 2069 7320   parent_meta is 
-0003d790: 4e6f 6e65 2061 6e64 2064 6673 3a0a 2020  None and dfs:.  
-0003d7a0: 2020 2020 2020 7061 7265 6e74 5f6d 6574        parent_met
-0003d7b0: 6120 3d20 6466 735b 305d 2e5f 6d65 7461  a = dfs[0]._meta
-0003d7c0: 0a20 2020 2069 6620 6d65 7461 2069 7320  .    if meta is 
-0003d7d0: 6e6f 5f64 6566 6175 6c74 3a0a 2020 2020  no_default:.    
-0003d7e0: 2020 2020 2320 5573 6520 6e6f 6e2d 6e6f      # Use non-no
-0003d7f0: 726d 616c 697a 6564 206b 7761 7267 7320  rmalized kwargs 
-0003d800: 6865 7265 2c20 6173 2077 6520 7761 6e74  here, as we want
-0003d810: 2074 6865 2072 6561 6c20 7661 6c75 6573   the real values
-0003d820: 2028 6e6f 740a 2020 2020 2020 2020 2320   (not.        # 
-0003d830: 6465 6c61 7965 6420 7661 6c75 6573 290a  delayed values).
-0003d840: 2020 2020 2020 2020 6d65 7461 203d 205f          meta = _
-0003d850: 656d 756c 6174 6528 6675 6e63 2c20 2a61  emulate(func, *a
-0003d860: 7267 732c 2075 6466 3d54 7275 652c 202a  rgs, udf=True, *
-0003d870: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0003d880: 206d 6574 615f 6973 5f65 6d75 6c61 7465   meta_is_emulate
-0003d890: 6420 3d20 5472 7565 0a20 2020 2065 6c73  d = True.    els
-0003d8a0: 653a 0a20 2020 2020 2020 206d 6574 6120  e:.        meta 
-0003d8b0: 3d20 6d61 6b65 5f6d 6574 6128 6d65 7461  = make_meta(meta
-0003d8c0: 2c20 696e 6465 783d 6d65 7461 5f69 6e64  , index=meta_ind
-0003d8d0: 6578 2c20 7061 7265 6e74 5f6d 6574 613d  ex, parent_meta=
-0003d8e0: 7061 7265 6e74 5f6d 6574 6129 0a20 2020  parent_meta).   
-0003d8f0: 2020 2020 206d 6574 615f 6973 5f65 6d75       meta_is_emu
-0003d900: 6c61 7465 6420 3d20 4661 6c73 650a 0a20  lated = False.. 
-0003d910: 2020 2069 6620 6e6f 7420 2868 6173 5f70     if not (has_p
-0003d920: 6172 616c 6c65 6c5f 7479 7065 286d 6574  arallel_type(met
-0003d930: 6129 206f 7220 6973 5f61 7272 6179 6c69  a) or is_arrayli
-0003d940: 6b65 286d 6574 6129 2061 6e64 206d 6574  ke(meta) and met
-0003d950: 612e 7368 6170 6529 2061 6e64 206e 6f74  a.shape) and not
-0003d960: 2061 6c6c 280a 2020 2020 2020 2020 6973   all(.        is
-0003d970: 696e 7374 616e 6365 2861 7267 2c20 5363  instance(arg, Sc
-0003d980: 616c 6172 2920 666f 7220 6172 6720 696e  alar) for arg in
-0003d990: 2061 7267 730a 2020 2020 293a 0a20 2020   args.    ):.   
-0003d9a0: 2020 2020 2069 6620 6e6f 7420 6d65 7461       if not meta
-0003d9b0: 5f69 735f 656d 756c 6174 6564 3a0a 2020  _is_emulated:.  
-0003d9c0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0003d9d0: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0003d9e0: 2020 2020 2020 2020 2022 4d65 7461 2069           "Meta i
-0003d9f0: 7320 6e6f 7420 7661 6c69 642c 2060 6d61  s not valid, `ma
-0003da00: 705f 7061 7274 6974 696f 6e73 6020 616e  p_partitions` an
-0003da10: 6420 606d 6170 5f6f 7665 726c 6170 6020  d `map_overlap` 
-0003da20: 6578 7065 6374 7320 6f75 7470 7574 2074  expects output t
-0003da30: 6f20 6265 2061 2070 616e 6461 7320 6f62  o be a pandas ob
-0003da40: 6a65 6374 2e20 220a 2020 2020 2020 2020  ject. ".        
-0003da50: 2020 2020 2020 2020 2254 7279 2070 6173          "Try pas
-0003da60: 7369 6e67 2061 2070 616e 6461 7320 6f62  sing a pandas ob
-0003da70: 6a65 6374 2061 7320 6d65 7461 206f 7220  ject as meta or 
-0003da80: 6120 6469 6374 206f 7220 7475 706c 6520  a dict or tuple 
-0003da90: 7265 7072 6573 656e 7469 6e67 2074 6865  representing the
-0003daa0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0003dab0: 2020 2022 286e 616d 652c 2064 7479 7065     "(name, dtype
-0003dac0: 2920 6f66 2074 6865 2063 6f6c 756d 6e73  ) of the columns
-0003dad0: 2e20 496e 2074 6865 2066 7574 7572 6520  . In the future 
-0003dae0: 7468 6520 6d65 7461 2079 6f75 2070 6173  the meta you pas
-0003daf0: 7365 6420 7769 6c6c 206e 6f74 2077 6f72  sed will not wor
-0003db00: 6b2e 222c 0a20 2020 2020 2020 2020 2020  k.",.           
-0003db10: 2020 2020 2046 7574 7572 6557 6172 6e69       FutureWarni
-0003db20: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0003db30: 290a 2020 2020 2020 2020 2320 4966 2060  ).        # If `
-0003db40: 6d65 7461 6020 6973 206e 6f74 2061 2070  meta` is not a p
-0003db50: 616e 6461 7320 6f62 6a65 6374 2c20 7468  andas object, th
-0003db60: 6520 636f 6e63 6174 656e 6174 6564 2072  e concatenated r
-0003db70: 6573 756c 7473 2077 696c 6c20 6265 2061  esults will be a
-0003db80: 0a20 2020 2020 2020 2023 2064 6966 6665  .        # diffe
-0003db90: 7265 6e74 2074 7970 650a 2020 2020 2020  rent type.      
-0003dba0: 2020 6d65 7461 203d 206d 616b 655f 6d65    meta = make_me
-0003dbb0: 7461 285f 636f 6e63 6174 285b 6d65 7461  ta(_concat([meta
-0003dbc0: 5d29 2c20 696e 6465 783d 6d65 7461 5f69  ]), index=meta_i
-0003dbd0: 6e64 6578 290a 0a20 2020 2023 2045 6e73  ndex)..    # Ens
-0003dbe0: 7572 6520 6d65 7461 2069 7320 656d 7074  ure meta is empt
-0003dbf0: 7920 7365 7269 6573 0a20 2020 206d 6574  y series.    met
-0003dc00: 6120 3d20 6d61 6b65 5f6d 6574 6128 6d65  a = make_meta(me
-0003dc10: 7461 2c20 7061 7265 6e74 5f6d 6574 613d  ta, parent_meta=
-0003dc20: 7061 7265 6e74 5f6d 6574 6129 0a0a 2020  parent_meta)..  
-0003dc30: 2020 7265 7475 726e 206d 6574 610a 0a0a    return meta...
-0003dc40: 6465 6620 6170 706c 795f 616e 645f 656e  def apply_and_en
-0003dc50: 666f 7263 6528 2a61 7267 732c 202a 2a6b  force(*args, **k
-0003dc60: 7761 7267 7329 3a0a 2020 2020 2222 2241  wargs):.    """A
-0003dc70: 7070 6c79 2061 2066 756e 6374 696f 6e2c  pply a function,
-0003dc80: 2061 6e64 2065 6e66 6f72 6365 2074 6865   and enforce the
-0003dc90: 206f 7574 7075 7420 746f 206d 6174 6368   output to match
-0003dca0: 206d 6574 610a 0a20 2020 2045 6e73 7572   meta..    Ensur
-0003dcb0: 6573 2074 6865 206f 7574 7075 7420 6861  es the output ha
-0003dcc0: 7320 7468 6520 7361 6d65 2063 6f6c 756d  s the same colum
-0003dcd0: 6e73 2c20 6576 656e 2069 6620 656d 7074  ns, even if empt
-0003dce0: 792e 2222 220a 2020 2020 6675 6e63 203d  y.""".    func =
-0003dcf0: 206b 7761 7267 732e 706f 7028 225f 6675   kwargs.pop("_fu
-0003dd00: 6e63 2229 0a20 2020 206d 6574 6120 3d20  nc").    meta = 
-0003dd10: 6b77 6172 6773 2e70 6f70 2822 5f6d 6574  kwargs.pop("_met
-0003dd20: 6122 290a 2020 2020 6466 203d 2066 756e  a").    df = fun
-0003dd30: 6328 2a61 7267 732c 202a 2a6b 7761 7267  c(*args, **kwarg
-0003dd40: 7329 0a20 2020 2069 6620 6973 5f64 6174  s).    if is_dat
-0003dd50: 6166 7261 6d65 5f6c 696b 6528 6466 2920  aframe_like(df) 
-0003dd60: 6f72 2069 735f 7365 7269 6573 5f6c 696b  or is_series_lik
-0003dd70: 6528 6466 2920 6f72 2069 735f 696e 6465  e(df) or is_inde
-0003dd80: 785f 6c69 6b65 2864 6629 3a0a 2020 2020  x_like(df):.    
-0003dd90: 2020 2020 6966 206e 6f74 206c 656e 2864      if not len(d
-0003dda0: 6629 3a0a 2020 2020 2020 2020 2020 2020  f):.            
-0003ddb0: 7265 7475 726e 206d 6574 610a 2020 2020  return meta.    
-0003ddc0: 2020 2020 6966 2069 735f 6461 7461 6672      if is_datafr
-0003ddd0: 616d 655f 6c69 6b65 2864 6629 3a0a 2020  ame_like(df):.  
-0003dde0: 2020 2020 2020 2020 2020 6368 6563 6b5f            check_
-0003ddf0: 6d61 7463 6869 6e67 5f63 6f6c 756d 6e73  matching_columns
-0003de00: 286d 6574 612c 2064 6629 0a20 2020 2020  (meta, df).     
-0003de10: 2020 2020 2020 2063 203d 206d 6574 612e         c = meta.
-0003de20: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-0003de30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0003de40: 2020 6320 3d20 6d65 7461 2e6e 616d 650a    c = meta.name.
-0003de50: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-0003de60: 7265 6e61 6d65 2863 2c20 6466 290a 2020  rename(c, df).  
-0003de70: 2020 7265 7475 726e 2064 660a 0a0a 6465    return df...de
-0003de80: 6620 5f72 656e 616d 6528 636f 6c75 6d6e  f _rename(column
-0003de90: 732c 2064 6629 3a0a 2020 2020 2222 220a  s, df):.    """.
-0003dea0: 2020 2020 5265 6e61 6d65 2063 6f6c 756d      Rename colum
-0003deb0: 6e73 206f 6620 7064 2e44 6174 6146 7261  ns of pd.DataFra
-0003dec0: 6d65 206f 7220 6e61 6d65 206f 6620 7064  me or name of pd
-0003ded0: 2e53 6572 6965 732e 0a20 2020 204e 6f74  .Series..    Not
-0003dee0: 2066 6f72 2064 642e 4461 7461 4672 616d   for dd.DataFram
-0003def0: 6520 6f72 2064 642e 5365 7269 6573 2e0a  e or dd.Series..
-0003df00: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-0003df10: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0003df20: 2020 2063 6f6c 756d 6e73 203a 2074 7570     columns : tup
-0003df30: 6c65 2c20 7374 7269 6e67 2c20 7064 2e44  le, string, pd.D
-0003df40: 6174 6146 7261 6d65 206f 7220 7064 2e53  ataFrame or pd.S
-0003df50: 6572 6965 730a 2020 2020 2020 2020 436f  eries.        Co
-0003df60: 6c75 6d6e 206e 616d 6573 2c20 5365 7269  lumn names, Seri
-0003df70: 6573 206e 616d 6520 6f72 2070 616e 6461  es name or panda
-0003df80: 7320 696e 7374 616e 6365 2077 6869 6368  s instance which
-0003df90: 2068 6173 2074 6865 0a20 2020 2020 2020   has the.       
-0003dfa0: 2074 6172 6765 7420 636f 6c75 6d6e 206e   target column n
-0003dfb0: 616d 6573 202f 206e 616d 652e 0a20 2020  ames / name..   
-0003dfc0: 2064 6620 3a20 7064 2e44 6174 6146 7261   df : pd.DataFra
-0003dfd0: 6d65 206f 7220 7064 2e53 6572 6965 730a  me or pd.Series.
-0003dfe0: 2020 2020 2020 2020 7461 7267 6574 2044          target D
-0003dff0: 6174 6146 7261 6d65 202f 2053 6572 6965  ataFrame / Serie
-0003e000: 7320 746f 2062 6520 7265 6e61 6d65 640a  s to be renamed.
-0003e010: 2020 2020 2222 220a 2020 2020 6173 7365      """.    asse
-0003e020: 7274 206e 6f74 2069 7369 6e73 7461 6e63  rt not isinstanc
-0003e030: 6528 6466 2c20 5f46 7261 6d65 290a 0a20  e(df, _Frame).. 
-0003e040: 2020 2069 6620 636f 6c75 6d6e 7320 6973     if columns is
-0003e050: 206e 6f5f 6465 6661 756c 743a 0a20 2020   no_default:.   
-0003e060: 2020 2020 2072 6574 7572 6e20 6466 0a0a       return df..
-0003e070: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0003e080: 6528 636f 6c75 6d6e 732c 2049 7465 7261  e(columns, Itera
-0003e090: 746f 7229 3a0a 2020 2020 2020 2020 636f  tor):.        co
-0003e0a0: 6c75 6d6e 7320 3d20 6c69 7374 2863 6f6c  lumns = list(col
-0003e0b0: 756d 6e73 290a 0a20 2020 2069 6620 6973  umns)..    if is
-0003e0c0: 5f64 6174 6166 7261 6d65 5f6c 696b 6528  _dataframe_like(
-0003e0d0: 6466 293a 0a20 2020 2020 2020 2069 6620  df):.        if 
-0003e0e0: 6973 5f64 6174 6166 7261 6d65 5f6c 696b  is_dataframe_lik
-0003e0f0: 6528 636f 6c75 6d6e 7329 3a0a 2020 2020  e(columns):.    
-0003e100: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-0003e110: 3d20 636f 6c75 6d6e 732e 636f 6c75 6d6e  = columns.column
-0003e120: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-0003e130: 2069 7369 6e73 7461 6e63 6528 636f 6c75   isinstance(colu
-0003e140: 6d6e 732c 2070 642e 496e 6465 7829 3a0a  mns, pd.Index):.
-0003e150: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0003e160: 6d6e 7320 3d20 7064 2e49 6e64 6578 2863  mns = pd.Index(c
-0003e170: 6f6c 756d 6e73 290a 2020 2020 2020 2020  olumns).        
-0003e180: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0003e190: 206c 656e 2863 6f6c 756d 6e73 2920 3d3d   len(columns) ==
-0003e1a0: 206c 656e 2864 662e 636f 6c75 6d6e 7329   len(df.columns)
-0003e1b0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0003e1c0: 2074 7970 6528 636f 6c75 6d6e 7329 2069   type(columns) i
-0003e1d0: 7320 7479 7065 2864 662e 636f 6c75 6d6e  s type(df.column
-0003e1e0: 7329 0a20 2020 2020 2020 2020 2020 2061  s).            a
-0003e1f0: 6e64 2063 6f6c 756d 6e73 2e64 7479 7065  nd columns.dtype
-0003e200: 203d 3d20 6466 2e63 6f6c 756d 6e73 2e64   == df.columns.d
-0003e210: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-0003e220: 2061 6e64 2063 6f6c 756d 6e73 2e65 7175   and columns.equ
-0003e230: 616c 7328 6466 2e63 6f6c 756d 6e73 290a  als(df.columns).
-0003e240: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0003e250: 2020 2020 2020 2023 2069 6620 7461 7267         # if targ
-0003e260: 6574 2069 7320 6964 656e 7469 6361 6c2c  et is identical,
-0003e270: 2072 656e 616d 6520 6973 206e 6f74 206e   rename is not n
-0003e280: 6563 6573 7361 7279 0a20 2020 2020 2020  ecessary.       
-0003e290: 2020 2020 2072 6574 7572 6e20 6466 0a20       return df. 
-0003e2a0: 2020 2020 2020 2023 2064 6565 703d 4661         # deep=Fa
-0003e2b0: 6c73 6520 646f 6573 6e27 7420 646f 6573  lse doesn't does
-0003e2c0: 6e27 7420 636f 7079 2061 6e79 2064 6174  n't copy any dat
-0003e2d0: 612f 696e 6469 6365 732c 2073 6f20 7468  a/indices, so th
-0003e2e0: 6973 2069 7320 6368 6561 700a 2020 2020  is is cheap.    
-0003e2f0: 2020 2020 6466 203d 2064 662e 636f 7079      df = df.copy
-0003e300: 2864 6565 703d 4661 6c73 6529 0a20 2020  (deep=False).   
-0003e310: 2020 2020 2064 662e 636f 6c75 6d6e 7320       df.columns 
-0003e320: 3d20 636f 6c75 6d6e 730a 2020 2020 2020  = columns.      
-0003e330: 2020 7265 7475 726e 2064 660a 2020 2020    return df.    
-0003e340: 656c 6966 2069 735f 7365 7269 6573 5f6c  elif is_series_l
-0003e350: 696b 6528 6466 2920 6f72 2069 735f 696e  ike(df) or is_in
-0003e360: 6465 785f 6c69 6b65 2864 6629 3a0a 2020  dex_like(df):.  
-0003e370: 2020 2020 2020 6966 2069 735f 7365 7269        if is_seri
-0003e380: 6573 5f6c 696b 6528 636f 6c75 6d6e 7329  es_like(columns)
-0003e390: 206f 7220 6973 5f69 6e64 6578 5f6c 696b   or is_index_lik
-0003e3a0: 6528 636f 6c75 6d6e 7329 3a0a 2020 2020  e(columns):.    
-0003e3b0: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-0003e3c0: 3d20 636f 6c75 6d6e 732e 6e61 6d65 0a20  = columns.name. 
-0003e3d0: 2020 2020 2020 2069 6620 6466 2e6e 616d         if df.nam
-0003e3e0: 6520 3d3d 2063 6f6c 756d 6e73 3a0a 2020  e == columns:.  
-0003e3f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0003e400: 2064 660a 2020 2020 2020 2020 7265 7475   df.        retu
-0003e410: 726e 2064 662e 7265 6e61 6d65 2863 6f6c  rn df.rename(col
-0003e420: 756d 6e73 290a 2020 2020 2320 6d61 705f  umns).    # map_
-0003e430: 7061 7274 6974 696f 6e20 6d61 7920 7061  partition may pa
-0003e440: 7373 206f 7468 6572 2074 7970 6573 0a20  ss other types. 
-0003e450: 2020 2072 6574 7572 6e20 6466 0a0a 0a64     return df...d
-0003e460: 6566 205f 7265 6e61 6d65 5f64 6173 6b28  ef _rename_dask(
-0003e470: 6466 2c20 6e61 6d65 7329 3a0a 2020 2020  df, names):.    
-0003e480: 2222 220a 2020 2020 4465 7374 7275 6374  """.    Destruct
-0003e490: 6976 656c 7920 7265 6e61 6d65 2063 6f6c  ively rename col
-0003e4a0: 756d 6e73 206f 6620 6464 2e44 6174 6146  umns of dd.DataF
-0003e4b0: 7261 6d65 206f 7220 6e61 6d65 206f 6620  rame or name of 
-0003e4c0: 6464 2e53 6572 6965 732e 0a20 2020 204e  dd.Series..    N
-0003e4d0: 6f74 2066 6f72 2070 642e 4461 7461 4672  ot for pd.DataFr
-0003e4e0: 616d 6520 6f72 2070 642e 5365 7269 6573  ame or pd.Series
-0003e4f0: 2e0a 0a20 2020 2049 6e74 6572 6e61 6c6c  ...    Internall
-0003e500: 7920 7573 6564 2074 6f20 6f76 6572 7772  y used to overwr
-0003e510: 6974 6520 6464 2e44 6174 6146 7261 6d65  ite dd.DataFrame
-0003e520: 2e63 6f6c 756d 6e73 2061 6e64 2064 642e  .columns and dd.
-0003e530: 5365 7269 6573 2e6e 616d 650a 2020 2020  Series.name.    
-0003e540: 5765 2063 616e 2774 2075 7365 206d 6170  We can't use map
-0003e550: 5f70 6172 7469 7469 6f6e 2062 6563 6175  _partition becau
-0003e560: 7365 2069 7420 6170 706c 6965 7320 6675  se it applies fu
-0003e570: 6e63 7469 6f6e 2074 6865 6e20 7265 6e61  nction then rena
-0003e580: 6d65 0a0a 2020 2020 5061 7261 6d65 7465  me..    Paramete
-0003e590: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-0003e5a0: 2d0a 2020 2020 6466 203a 2064 642e 4461  -.    df : dd.Da
-0003e5b0: 7461 4672 616d 6520 6f72 2064 642e 5365  taFrame or dd.Se
-0003e5c0: 7269 6573 0a20 2020 2020 2020 2074 6172  ries.        tar
-0003e5d0: 6765 7420 4461 7461 4672 616d 6520 2f20  get DataFrame / 
-0003e5e0: 5365 7269 6573 2074 6f20 6265 2072 656e  Series to be ren
-0003e5f0: 616d 6564 0a20 2020 206e 616d 6573 203a  amed.    names :
-0003e600: 2074 7570 6c65 2c20 7374 7269 6e67 0a20   tuple, string. 
-0003e610: 2020 2020 2020 2043 6f6c 756d 6e20 6e61         Column na
-0003e620: 6d65 732f 5365 7269 6573 206e 616d 650a  mes/Series name.
-0003e630: 2020 2020 2222 220a 0a20 2020 2061 7373      """..    ass
-0003e640: 6572 7420 6973 696e 7374 616e 6365 2864  ert isinstance(d
-0003e650: 662c 205f 4672 616d 6529 0a20 2020 206d  f, _Frame).    m
-0003e660: 6574 6164 6174 6120 3d20 5f72 656e 616d  etadata = _renam
-0003e670: 6528 6e61 6d65 732c 2064 662e 5f6d 6574  e(names, df._met
-0003e680: 6129 0a20 2020 206e 616d 6520 3d20 6622  a).    name = f"
-0003e690: 7265 6e61 6d65 2d7b 746f 6b65 6e69 7a65  rename-{tokenize
-0003e6a0: 2864 662c 206d 6574 6164 6174 6129 7d22  (df, metadata)}"
-0003e6b0: 0a0a 2020 2020 6473 6b20 3d20 7061 7274  ..    dsk = part
-0003e6c0: 6974 696f 6e77 6973 655f 6772 6170 6828  itionwise_graph(
-0003e6d0: 5f72 656e 616d 652c 206e 616d 652c 206d  _rename, name, m
-0003e6e0: 6574 6164 6174 612c 2064 6629 0a20 2020  etadata, df).   
-0003e6f0: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
-0003e700: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
-0003e710: 6c65 6374 696f 6e73 286e 616d 652c 2064  lections(name, d
-0003e720: 736b 2c20 6465 7065 6e64 656e 6369 6573  sk, dependencies
-0003e730: 3d5b 6466 5d29 0a20 2020 2072 6574 7572  =[df]).    retur
-0003e740: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-0003e750: 6772 6170 682c 206e 616d 652c 206d 6574  graph, name, met
-0003e760: 6164 6174 612c 2064 662e 6469 7669 7369  adata, df.divisi
-0003e770: 6f6e 7329 0a0a 0a64 6566 2071 7561 6e74  ons)...def quant
-0003e780: 696c 6528 6466 2c20 712c 206d 6574 686f  ile(df, q, metho
-0003e790: 643d 2264 6566 6175 6c74 2229 3a0a 2020  d="default"):.  
-0003e7a0: 2020 2222 2241 7070 726f 7869 6d61 7465    """Approximate
-0003e7b0: 2071 7561 6e74 696c 6573 206f 6620 5365   quantiles of Se
-0003e7c0: 7269 6573 2e0a 0a20 2020 2050 6172 616d  ries...    Param
-0003e7d0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0003e7e0: 2d2d 2d2d 0a20 2020 2071 203a 206c 6973  ----.    q : lis
-0003e7f0: 742f 6172 7261 7920 6f66 2066 6c6f 6174  t/array of float
-0003e800: 730a 2020 2020 2020 2020 4974 6572 6162  s.        Iterab
-0003e810: 6c65 206f 6620 6e75 6d62 6572 7320 7261  le of numbers ra
-0003e820: 6e67 696e 6720 6672 6f6d 2030 2074 6f20  nging from 0 to 
-0003e830: 3130 3020 666f 7220 7468 6520 6465 7369  100 for the desi
-0003e840: 7265 6420 7175 616e 7469 6c65 730a 2020  red quantiles.  
-0003e850: 2020 6d65 7468 6f64 203a 207b 2764 6566    method : {'def
-0003e860: 6175 6c74 272c 2027 7464 6967 6573 7427  ault', 'tdigest'
-0003e870: 2c20 2764 6173 6b27 7d2c 206f 7074 696f  , 'dask'}, optio
-0003e880: 6e61 6c0a 2020 2020 2020 2020 5768 6174  nal.        What
-0003e890: 206d 6574 686f 6420 746f 2075 7365 2e20   method to use. 
-0003e8a0: 4279 2064 6566 6175 6c74 2077 696c 6c20  By default will 
-0003e8b0: 7573 6520 6461 736b 2773 2069 6e74 6572  use dask's inter
-0003e8c0: 6e61 6c20 6375 7374 6f6d 0a20 2020 2020  nal custom.     
-0003e8d0: 2020 2061 6c67 6f72 6974 686d 2028 6060     algorithm (``
-0003e8e0: 2764 6173 6b27 6060 292e 2020 4966 2073  'dask'``).  If s
-0003e8f0: 6574 2074 6f20 6060 2774 6469 6765 7374  et to ``'tdigest
-0003e900: 2760 6020 7769 6c6c 2075 7365 2074 6469  '`` will use tdi
-0003e910: 6765 7374 2066 6f72 0a20 2020 2020 2020  gest for.       
-0003e920: 2066 6c6f 6174 7320 616e 6420 696e 7473   floats and ints
-0003e930: 2061 6e64 2066 616c 6c62 6163 6b20 746f   and fallback to
-0003e940: 2074 6865 2060 6027 6461 736b 2760 6020   the ``'dask'`` 
-0003e950: 6f74 6865 7277 6973 652e 0a20 2020 2022  otherwise..    "
-0003e960: 2222 0a20 2020 2023 2063 7572 7265 6e74  "".    # current
-0003e970: 2069 6d70 6c65 6d65 6e74 6174 696f 6e20   implementation 
-0003e980: 6e65 6564 7320 7120 746f 2062 6520 736f  needs q to be so
-0003e990: 7274 6564 2073 6f0a 2020 2020 2320 736f  rted so.    # so
-0003e9a0: 7274 2069 6620 6172 7261 792d 6c69 6b65  rt if array-like
-0003e9b0: 2c20 6f74 6865 7277 6973 6520 6c65 6176  , otherwise leav
-0003e9c0: 6520 6974 2061 6c6f 6e65 0a20 2020 2071  e it alone.    q
-0003e9d0: 5f6e 6461 7272 6179 203d 206e 702e 6172  _ndarray = np.ar
-0003e9e0: 7261 7928 7129 0a20 2020 2069 6620 715f  ray(q).    if q_
-0003e9f0: 6e64 6172 7261 792e 6e64 696d 203e 2030  ndarray.ndim > 0
-0003ea00: 3a0a 2020 2020 2020 2020 715f 6e64 6172  :.        q_ndar
-0003ea10: 7261 792e 736f 7274 286b 696e 643d 226d  ray.sort(kind="m
-0003ea20: 6572 6765 736f 7274 2229 0a20 2020 2020  ergesort").     
-0003ea30: 2020 2071 203d 2071 5f6e 6461 7272 6179     q = q_ndarray
-0003ea40: 0a0a 2020 2020 6173 7365 7274 2069 7369  ..    assert isi
-0003ea50: 6e73 7461 6e63 6528 6466 2c20 5365 7269  nstance(df, Seri
-0003ea60: 6573 290a 0a20 2020 2061 6c6c 6f77 6564  es)..    allowed
-0003ea70: 5f6d 6574 686f 6473 203d 205b 2264 6566  _methods = ["def
-0003ea80: 6175 6c74 222c 2022 6461 736b 222c 2022  ault", "dask", "
-0003ea90: 7464 6967 6573 7422 5d0a 2020 2020 6966  tdigest"].    if
-0003eaa0: 206d 6574 686f 6420 6e6f 7420 696e 2061   method not in a
-0003eab0: 6c6c 6f77 6564 5f6d 6574 686f 6473 3a0a  llowed_methods:.
-0003eac0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0003ead0: 6c75 6545 7272 6f72 2822 6d65 7468 6f64  lueError("method
-0003eae0: 2063 616e 206f 6e6c 7920 6265 2027 6465   can only be 'de
-0003eaf0: 6661 756c 7427 2c20 2764 6173 6b27 206f  fault', 'dask' o
-0003eb00: 7220 2774 6469 6765 7374 2722 290a 0a20  r 'tdigest'").. 
-0003eb10: 2020 2069 6620 6d65 7468 6f64 203d 3d20     if method == 
-0003eb20: 2264 6566 6175 6c74 223a 0a20 2020 2020  "default":.     
-0003eb30: 2020 2069 6e74 6572 6e61 6c5f 6d65 7468     internal_meth
-0003eb40: 6f64 203d 2022 6461 736b 220a 2020 2020  od = "dask".    
-0003eb50: 656c 7365 3a0a 2020 2020 2020 2020 696e  else:.        in
-0003eb60: 7465 726e 616c 5f6d 6574 686f 6420 3d20  ternal_method = 
-0003eb70: 6d65 7468 6f64 0a0a 2020 2020 2320 6375  method..    # cu
-0003eb80: 7272 656e 746c 792c 206f 6e6c 7920 5365  rrently, only Se
-0003eb90: 7269 6573 2068 6173 2071 7561 6e74 696c  ries has quantil
-0003eba0: 6520 6d65 7468 6f64 0a20 2020 2069 6620  e method.    if 
-0003ebb0: 6973 696e 7374 616e 6365 2864 662c 2049  isinstance(df, I
-0003ebc0: 6e64 6578 293a 0a20 2020 2020 2020 2073  ndex):.        s
-0003ebd0: 6572 6965 735f 7479 7020 3d20 6466 2e5f  eries_typ = df._
-0003ebe0: 6d65 7461 2e74 6f5f 7365 7269 6573 2829  meta.to_series()
-0003ebf0: 2e5f 636f 6e73 7472 7563 746f 720a 2020  ._constructor.  
-0003ec00: 2020 2020 2020 6d65 7461 203d 2064 662e        meta = df.
-0003ec10: 5f6d 6574 615f 6e6f 6e65 6d70 7479 2e74  _meta_nonempty.t
-0003ec20: 6f5f 7365 7269 6573 2829 2e71 7561 6e74  o_series().quant
-0003ec30: 696c 6528 7129 0a20 2020 2065 6c73 653a  ile(q).    else:
-0003ec40: 0a20 2020 2020 2020 2069 6620 6973 5f73  .        if is_s
-0003ec50: 6572 6965 735f 6c69 6b65 2864 662e 5f6d  eries_like(df._m
-0003ec60: 6574 6129 3a0a 2020 2020 2020 2020 2020  eta):.          
-0003ec70: 2020 7365 7269 6573 5f74 7970 203d 2064    series_typ = d
-0003ec80: 662e 5f6d 6574 612e 5f63 6f6e 7374 7275  f._meta._constru
-0003ec90: 6374 6f72 0a20 2020 2020 2020 2065 6c73  ctor.        els
-0003eca0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0003ecb0: 6572 6965 735f 7479 7020 3d20 6466 2e5f  eries_typ = df._
-0003ecc0: 6d65 7461 2e5f 636f 6e73 7472 7563 746f  meta._constructo
-0003ecd0: 725f 736c 6963 6564 0a20 2020 2020 2020  r_sliced.       
-0003ece0: 206d 6574 6120 3d20 6466 2e5f 6d65 7461   meta = df._meta
-0003ecf0: 5f6e 6f6e 656d 7074 792e 7175 616e 7469  _nonempty.quanti
-0003ed00: 6c65 2871 290a 0a20 2020 2069 6620 6973  le(q)..    if is
-0003ed10: 5f73 6572 6965 735f 6c69 6b65 286d 6574  _series_like(met
-0003ed20: 6129 3a0a 2020 2020 2020 2020 2320 496e  a):.        # In
-0003ed30: 6465 782e 7175 616e 7469 6c65 286c 6973  dex.quantile(lis
-0003ed40: 742d 6c69 6b65 2920 6d75 7374 2062 6520  t-like) must be 
-0003ed50: 7064 2e53 6572 6965 732c 206e 6f74 2070  pd.Series, not p
-0003ed60: 642e 496e 6465 780a 2020 2020 2020 2020  d.Index.        
-0003ed70: 6466 5f6e 616d 6520 3d20 6466 2e6e 616d  df_name = df.nam
-0003ed80: 650a 2020 2020 2020 2020 6669 6e61 6c69  e.        finali
-0003ed90: 7a65 5f74 736b 203d 206c 616d 6264 6120  ze_tsk = lambda 
-0003eda0: 7473 6b3a 2028 7365 7269 6573 5f74 7970  tsk: (series_typ
-0003edb0: 2c20 7473 6b2c 2071 2c20 4e6f 6e65 2c20  , tsk, q, None, 
-0003edc0: 6466 5f6e 616d 6529 0a20 2020 2020 2020  df_name).       
-0003edd0: 2072 6574 7572 6e5f 7479 7065 203d 2053   return_type = S
-0003ede0: 6572 6965 730a 2020 2020 656c 7365 3a0a  eries.    else:.
-0003edf0: 2020 2020 2020 2020 2320 7265 7061 636b          # repack
-0003ee00: 2061 7320 5365 7269 6573 206f 626a 6563   as Series objec
-0003ee10: 7420 746f 2063 6f6e 7665 7274 2073 6361  t to convert sca
-0003ee20: 6c61 7273 2066 726f 6d20 4e75 6d50 7920  lars from NumPy 
-0003ee30: 6261 636b 2062 6566 6f72 6520 6578 7472  back before extr
-0003ee40: 6163 7469 6e67 0a20 2020 2020 2020 2066  acting.        f
-0003ee50: 696e 616c 697a 655f 7473 6b20 3d20 6c61  inalize_tsk = la
-0003ee60: 6d62 6461 2074 736b 3a20 280a 2020 2020  mbda tsk: (.    
-0003ee70: 2020 2020 2020 2020 6c61 6d62 6461 202a          lambda *
-0003ee80: 6172 6773 2c20 2a2a 6b77 6172 6773 3a20  args, **kwargs: 
-0003ee90: 7365 7269 6573 5f74 7970 282a 6172 6773  series_typ(*args
-0003eea0: 2c20 2a2a 6b77 6172 6773 295b 305d 2c0a  , **kwargs)[0],.
-0003eeb0: 2020 2020 2020 2020 2020 2020 7473 6b2c              tsk,
-0003eec0: 0a20 2020 2020 2020 2020 2020 205b 305d  .            [0]
-0003eed0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-0003eee0: 2020 2020 7265 7475 726e 5f74 7970 6520      return_type 
-0003eef0: 3d20 5363 616c 6172 0a20 2020 2020 2020  = Scalar.       
-0003ef00: 2071 203d 205b 715d 0a0a 2020 2020 2320   q = [q]..    # 
-0003ef10: 7061 6e64 6173 2075 7365 7320 7175 616e  pandas uses quan
-0003ef20: 7469 6c65 2069 6e20 5b30 2c20 315d 0a20  tile in [0, 1]. 
-0003ef30: 2020 2023 206e 756d 7079 202f 2065 7665     # numpy / eve
-0003ef40: 7279 6f6e 6520 656c 7365 2075 7365 7320  ryone else uses 
-0003ef50: 5b30 2c20 3130 305d 0a20 2020 2071 7320  [0, 100].    qs 
-0003ef60: 3d20 6e70 2e61 7361 7272 6179 2871 2920  = np.asarray(q) 
-0003ef70: 2a20 3130 300a 2020 2020 746f 6b65 6e20  * 100.    token 
-0003ef80: 3d20 746f 6b65 6e69 7a65 2864 662c 2071  = tokenize(df, q
-0003ef90: 7329 0a0a 2020 2020 6966 206c 656e 2871  s)..    if len(q
-0003efa0: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-0003efb0: 206e 616d 6520 3d20 2271 7561 6e74 696c   name = "quantil
-0003efc0: 6573 2d22 202b 2074 6f6b 656e 0a20 2020  es-" + token.   
-0003efd0: 2020 2020 2065 6d70 7479 5f69 6e64 6578       empty_index
-0003efe0: 203d 2070 642e 496e 6465 7828 5b5d 2c20   = pd.Index([], 
-0003eff0: 6474 7970 653d 666c 6f61 7429 0a0a 2020  dtype=float)..  
-0003f000: 2020 2020 2020 7265 7475 726e 2053 6572        return Ser
-0003f010: 6965 7328 0a20 2020 2020 2020 2020 2020  ies(.           
-0003f020: 207b 286e 616d 652c 2030 293a 2073 6572   {(name, 0): ser
-0003f030: 6965 735f 7479 7028 5b5d 2c20 6e61 6d65  ies_typ([], name
-0003f040: 3d64 662e 6e61 6d65 2c20 696e 6465 783d  =df.name, index=
-0003f050: 656d 7074 795f 696e 6465 782c 2064 7479  empty_index, dty
-0003f060: 7065 3d22 666c 6f61 7422 297d 2c0a 2020  pe="float")},.  
-0003f070: 2020 2020 2020 2020 2020 6e61 6d65 2c0a            name,.
-0003f080: 2020 2020 2020 2020 2020 2020 6466 2e5f              df._
-0003f090: 6d65 7461 2c0a 2020 2020 2020 2020 2020  meta,.          
-0003f0a0: 2020 5b4e 6f6e 652c 204e 6f6e 655d 2c0a    [None, None],.
-0003f0b0: 2020 2020 2020 2020 290a 2020 2020 656c          ).    el
-0003f0c0: 7365 3a0a 2020 2020 2020 2020 6e65 775f  se:.        new_
-0003f0d0: 6469 7669 7369 6f6e 7320 3d20 5b6e 702e  divisions = [np.
-0003f0e0: 6d69 6e28 7129 2c20 6e70 2e6d 6178 2871  min(q), np.max(q
-0003f0f0: 295d 0a0a 2020 2020 6466 203d 2064 662e  )]..    df = df.
-0003f100: 6472 6f70 6e61 2829 0a0a 2020 2020 6966  dropna()..    if
-0003f110: 2069 6e74 6572 6e61 6c5f 6d65 7468 6f64   internal_method
-0003f120: 203d 3d20 2274 6469 6765 7374 2220 616e   == "tdigest" an
-0003f130: 6420 280a 2020 2020 2020 2020 6e70 2e69  d (.        np.i
-0003f140: 7373 7562 6474 7970 6528 6466 2e64 7479  ssubdtype(df.dty
-0003f150: 7065 2c20 6e70 2e66 6c6f 6174 696e 6729  pe, np.floating)
-0003f160: 206f 7220 6e70 2e69 7373 7562 6474 7970   or np.issubdtyp
-0003f170: 6528 6466 2e64 7479 7065 2c20 6e70 2e69  e(df.dtype, np.i
-0003f180: 6e74 6567 6572 290a 2020 2020 293a 0a20  nteger).    ):. 
-0003f190: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-0003f1a0: 2e75 7469 6c73 2069 6d70 6f72 7420 696d  .utils import im
-0003f1b0: 706f 7274 5f72 6571 7569 7265 640a 0a20  port_required.. 
-0003f1c0: 2020 2020 2020 2069 6d70 6f72 745f 7265         import_re
-0003f1d0: 7175 6972 6564 280a 2020 2020 2020 2020  quired(.        
-0003f1e0: 2020 2020 2263 7269 636b 222c 2022 6372      "crick", "cr
-0003f1f0: 6963 6b20 6973 2061 2072 6571 7569 7265  ick is a require
-0003f200: 6420 6465 7065 6e64 656e 6379 2066 6f72  d dependency for
-0003f210: 2075 7369 6e67 2074 6865 2074 2d64 6967   using the t-dig
-0003f220: 6573 7420 6d65 7468 6f64 2e22 0a20 2020  est method.".   
-0003f230: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0003f240: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-0003f250: 7065 7263 656e 7469 6c65 2069 6d70 6f72  percentile impor
-0003f260: 7420 5f70 6572 6365 6e74 696c 6573 5f66  t _percentiles_f
-0003f270: 726f 6d5f 7464 6967 6573 742c 205f 7464  rom_tdigest, _td
-0003f280: 6967 6573 745f 6368 756e 6b0a 0a20 2020  igest_chunk..   
-0003f290: 2020 2020 206e 616d 6520 3d20 2271 7561       name = "qua
-0003f2a0: 6e74 696c 6573 5f74 6469 6765 7374 2d31  ntiles_tdigest-1
-0003f2b0: 2d22 202b 2074 6f6b 656e 0a20 2020 2020  -" + token.     
-0003f2c0: 2020 2076 616c 5f64 736b 203d 207b 0a20     val_dsk = {. 
-0003f2d0: 2020 2020 2020 2020 2020 2028 6e61 6d65             (name
-0003f2e0: 2c20 6929 3a20 285f 7464 6967 6573 745f  , i): (_tdigest_
-0003f2f0: 6368 756e 6b2c 2028 6765 7461 7474 722c  chunk, (getattr,
-0003f300: 206b 6579 2c20 2276 616c 7565 7322 2929   key, "values"))
-0003f310: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0003f320: 2069 2c20 6b65 7920 696e 2065 6e75 6d65   i, key in enume
-0003f330: 7261 7465 2864 662e 5f5f 6461 736b 5f6b  rate(df.__dask_k
-0003f340: 6579 735f 5f28 2929 0a20 2020 2020 2020  eys__()).       
-0003f350: 207d 0a0a 2020 2020 2020 2020 6e61 6d65   }..        name
-0003f360: 3220 3d20 2271 7561 6e74 696c 6573 5f74  2 = "quantiles_t
-0003f370: 6469 6765 7374 2d32 2d22 202b 2074 6f6b  digest-2-" + tok
-0003f380: 656e 0a20 2020 2020 2020 206d 6572 6765  en.        merge
-0003f390: 5f64 736b 203d 207b 0a20 2020 2020 2020  _dsk = {.       
-0003f3a0: 2020 2020 2028 6e61 6d65 322c 2030 293a       (name2, 0):
-0003f3b0: 2066 696e 616c 697a 655f 7473 6b28 285f   finalize_tsk((_
-0003f3c0: 7065 7263 656e 7469 6c65 735f 6672 6f6d  percentiles_from
-0003f3d0: 5f74 6469 6765 7374 2c20 7173 2c20 736f  _tdigest, qs, so
-0003f3e0: 7274 6564 2876 616c 5f64 736b 2929 290a  rted(val_dsk))).
-0003f3f0: 2020 2020 2020 2020 7d0a 2020 2020 656c          }.    el
-0003f400: 7365 3a0a 2020 2020 2020 2020 6672 6f6d  se:.        from
-0003f410: 2064 6173 6b2e 6172 7261 792e 6469 7370   dask.array.disp
-0003f420: 6174 6368 2069 6d70 6f72 7420 7065 7263  atch import perc
-0003f430: 656e 7469 6c65 5f6c 6f6f 6b75 7020 6173  entile_lookup as
-0003f440: 205f 7065 7263 656e 7469 6c65 0a20 2020   _percentile.   
-0003f450: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
-0003f460: 7272 6179 2e70 6572 6365 6e74 696c 6520  rray.percentile 
-0003f470: 696d 706f 7274 206d 6572 6765 5f70 6572  import merge_per
-0003f480: 6365 6e74 696c 6573 0a0a 2020 2020 2020  centiles..      
-0003f490: 2020 2320 4164 6420 3020 616e 6420 3130    # Add 0 and 10
-0003f4a0: 3020 6475 7269 6e67 2063 616c 6375 6c61  0 during calcula
-0003f4b0: 7469 6f6e 2066 6f72 206d 6f72 6520 726f  tion for more ro
-0003f4c0: 6275 7374 2062 6568 6176 696f 7220 2868  bust behavior (h
-0003f4d0: 6f70 6566 756c 6c79 290a 2020 2020 2020  opefully).      
-0003f4e0: 2020 6361 6c63 5f71 7320 3d20 6e70 2e70    calc_qs = np.p
-0003f4f0: 6164 2871 732c 2031 2c20 6d6f 6465 3d22  ad(qs, 1, mode="
-0003f500: 636f 6e73 7461 6e74 2229 0a20 2020 2020  constant").     
-0003f510: 2020 2063 616c 635f 7173 5b2d 315d 203d     calc_qs[-1] =
-0003f520: 2031 3030 0a20 2020 2020 2020 206e 616d   100.        nam
-0003f530: 6520 3d20 2271 7561 6e74 696c 6573 2d31  e = "quantiles-1
-0003f540: 2d22 202b 2074 6f6b 656e 0a20 2020 2020  -" + token.     
-0003f550: 2020 2076 616c 5f64 736b 203d 207b 0a20     val_dsk = {. 
-0003f560: 2020 2020 2020 2020 2020 2028 6e61 6d65             (name
-0003f570: 2c20 6929 3a20 285f 7065 7263 656e 7469  , i): (_percenti
-0003f580: 6c65 2c20 6b65 792c 2063 616c 635f 7173  le, key, calc_qs
-0003f590: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0003f5a0: 7220 692c 206b 6579 2069 6e20 656e 756d  r i, key in enum
-0003f5b0: 6572 6174 6528 6466 2e5f 5f64 6173 6b5f  erate(df.__dask_
-0003f5c0: 6b65 7973 5f5f 2829 290a 2020 2020 2020  keys__()).      
-0003f5d0: 2020 7d0a 0a20 2020 2020 2020 206e 616d    }..        nam
-0003f5e0: 6532 203d 2022 7175 616e 7469 6c65 732d  e2 = "quantiles-
-0003f5f0: 322d 2220 2b20 746f 6b65 6e0a 2020 2020  2-" + token.    
-0003f600: 2020 2020 6d65 7267 655f 6473 6b20 3d20      merge_dsk = 
-0003f610: 7b0a 2020 2020 2020 2020 2020 2020 286e  {.            (n
-0003f620: 616d 6532 2c20 3029 3a20 6669 6e61 6c69  ame2, 0): finali
-0003f630: 7a65 5f74 736b 280a 2020 2020 2020 2020  ze_tsk(.        
-0003f640: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-0003f650: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-0003f660: 7267 655f 7065 7263 656e 7469 6c65 732c  rge_percentiles,
-0003f670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003f680: 2020 2020 2071 732c 0a20 2020 2020 2020       qs,.       
-0003f690: 2020 2020 2020 2020 2020 2020 205b 6361               [ca
-0003f6a0: 6c63 5f71 735d 202a 2064 662e 6e70 6172  lc_qs] * df.npar
-0003f6b0: 7469 7469 6f6e 732c 0a20 2020 2020 2020  titions,.       
-0003f6c0: 2020 2020 2020 2020 2020 2020 2073 6f72               sor
-0003f6d0: 7465 6428 7661 6c5f 6473 6b29 2c0a 2020  ted(val_dsk),.  
-0003f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f6f0: 2020 226c 6f77 6572 222c 0a20 2020 2020    "lower",.     
-0003f700: 2020 2020 2020 2020 2020 2020 2020 204e                 N
-0003f710: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0003f720: 2020 2020 2020 2020 2046 616c 7365 2c0a           False,.
-0003f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f740: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0003f750: 2020 2020 2020 2020 7d0a 2020 2020 6473          }.    ds
-0003f760: 6b20 3d20 6d65 7267 6528 7661 6c5f 6473  k = merge(val_ds
-0003f770: 6b2c 206d 6572 6765 5f64 736b 290a 2020  k, merge_dsk).  
-0003f780: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
-0003f790: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
-0003f7a0: 6c6c 6563 7469 6f6e 7328 6e61 6d65 322c  llections(name2,
-0003f7b0: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
-0003f7c0: 6573 3d5b 6466 5d29 0a20 2020 2072 6574  es=[df]).    ret
-0003f7d0: 7572 6e20 7265 7475 726e 5f74 7970 6528  urn return_type(
-0003f7e0: 6772 6170 682c 206e 616d 6532 2c20 6d65  graph, name2, me
-0003f7f0: 7461 2c20 6e65 775f 6469 7669 7369 6f6e  ta, new_division
-0003f800: 7329 0a0a 0a64 6566 205f 636f 765f 636f  s)...def _cov_co
-0003f810: 7272 280a 2020 2020 6466 2c0a 2020 2020  rr(.    df,.    
-0003f820: 6d69 6e5f 7065 7269 6f64 733d 4e6f 6e65  min_periods=None
-0003f830: 2c0a 2020 2020 636f 7272 3d46 616c 7365  ,.    corr=False
-0003f840: 2c0a 2020 2020 7363 616c 6172 3d46 616c  ,.    scalar=Fal
-0003f850: 7365 2c0a 2020 2020 6e75 6d65 7269 635f  se,.    numeric_
-0003f860: 6f6e 6c79 3d6e 6f5f 6465 6661 756c 742c  only=no_default,
-0003f870: 0a20 2020 2073 706c 6974 5f65 7665 7279  .    split_every
-0003f880: 3d46 616c 7365 2c0a 293a 0a20 2020 2022  =False,.):.    "
-0003f890: 2222 4461 7461 4672 616d 6520 636f 7661  ""DataFrame cova
-0003f8a0: 7269 616e 6365 2061 6e64 2070 6561 7273  riance and pears
-0003f8b0: 6f6e 2063 6f72 7265 6c61 7469 6f6e 2e0a  on correlation..
-0003f8c0: 0a20 2020 2043 6f6d 7075 7465 7320 7061  .    Computes pa
-0003f8d0: 6972 7769 7365 2063 6f76 6172 6961 6e63  irwise covarianc
-0003f8e0: 6520 6f72 2063 6f72 7265 6c61 7469 6f6e  e or correlation
-0003f8f0: 206f 6620 636f 6c75 6d6e 732c 2065 7863   of columns, exc
-0003f900: 6c75 6469 6e67 204e 412f 6e75 6c6c 0a20  luding NA/null. 
-0003f910: 2020 2076 616c 7565 732e 0a0a 2020 2020     values...    
-0003f920: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0003f930: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6466  ---------.    df
-0003f940: 203a 2044 6174 6146 7261 6d65 0a20 2020   : DataFrame.   
-0003f950: 206d 696e 5f70 6572 696f 6473 203a 2069   min_periods : i
-0003f960: 6e74 2c20 6f70 7469 6f6e 616c 0a20 2020  nt, optional.   
-0003f970: 2020 2020 204d 696e 696d 756d 206e 756d       Minimum num
-0003f980: 6265 7220 6f66 206f 6273 6572 7661 7469  ber of observati
-0003f990: 6f6e 7320 7265 7175 6972 6564 2070 6572  ons required per
-0003f9a0: 2070 6169 7220 6f66 2063 6f6c 756d 6e73   pair of columns
-0003f9b0: 0a20 2020 2020 2020 2074 6f20 6861 7665  .        to have
-0003f9c0: 2061 2076 616c 6964 2072 6573 756c 742e   a valid result.
-0003f9d0: 0a20 2020 2063 6f72 7220 3a20 626f 6f6c  .    corr : bool
-0003f9e0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0003f9f0: 2020 2049 6620 5472 7565 2c20 636f 6d70     If True, comp
-0003fa00: 7574 6520 7468 6520 5065 6172 736f 6e20  ute the Pearson 
-0003fa10: 636f 7272 656c 6174 696f 6e2e 2049 6620  correlation. If 
-0003fa20: 4661 6c73 6520 5b64 6566 6175 6c74 5d2c  False [default],
-0003fa30: 2063 6f6d 7075 7465 0a20 2020 2020 2020   compute.       
-0003fa40: 2074 6865 2063 6f76 6172 6961 6e63 652e   the covariance.
-0003fa50: 0a20 2020 2073 6361 6c61 7220 3a20 626f  .    scalar : bo
-0003fa60: 6f6c 2c20 6f70 7469 6f6e 616c 0a20 2020  ol, optional.   
-0003fa70: 2020 2020 2049 6620 5472 7565 2c20 636f       If True, co
-0003fa80: 6d70 7574 6520 636f 7661 7269 616e 6365  mpute covariance
-0003fa90: 2062 6574 7765 656e 2074 776f 2076 6172   between two var
-0003faa0: 6961 626c 6573 2061 7320 6120 7363 616c  iables as a scal
-0003fab0: 6172 2e20 4f6e 6c79 0a20 2020 2020 2020  ar. Only.       
-0003fac0: 2076 616c 6964 2069 6620 6064 6660 2068   valid if `df` h
-0003fad0: 6173 2032 2063 6f6c 756d 6e73 2e20 2049  as 2 columns.  I
-0003fae0: 6620 4661 6c73 6520 5b64 6566 6175 6c74  f False [default
-0003faf0: 5d2c 2063 6f6d 7075 7465 2074 6865 2065  ], compute the e
-0003fb00: 6e74 6972 650a 2020 2020 2020 2020 636f  ntire.        co
-0003fb10: 7661 7269 616e 6365 2f63 6f72 7265 6c61  variance/correla
-0003fb20: 7469 6f6e 206d 6174 7269 782e 0a20 2020  tion matrix..   
-0003fb30: 2073 706c 6974 5f65 7665 7279 203a 2069   split_every : i
-0003fb40: 6e74 2c20 6f70 7469 6f6e 616c 0a20 2020  nt, optional.   
-0003fb50: 2020 2020 2047 726f 7570 2070 6172 7469       Group parti
-0003fb60: 7469 6f6e 7320 696e 746f 2067 726f 7570  tions into group
-0003fb70: 7320 6f66 2074 6869 7320 7369 7a65 2077  s of this size w
-0003fb80: 6869 6c65 2070 6572 666f 726d 696e 6720  hile performing 
-0003fb90: 610a 2020 2020 2020 2020 7472 6565 2d72  a.        tree-r
-0003fba0: 6564 7563 7469 6f6e 2e20 4966 2073 6574  eduction. If set
-0003fbb0: 2074 6f20 4661 6c73 652c 206e 6f20 7472   to False, no tr
-0003fbc0: 6565 2d72 6564 7563 7469 6f6e 2077 696c  ee-reduction wil
-0003fbd0: 6c20 6265 2075 7365 642e 0a20 2020 2020  l be used..     
-0003fbe0: 2020 2044 6566 6175 6c74 2069 7320 4661     Default is Fa
-0003fbf0: 6c73 652e 0a20 2020 2022 2222 0a20 2020  lse..    """.   
-0003fc00: 2069 6620 6d69 6e5f 7065 7269 6f64 7320   if min_periods 
-0003fc10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0003fc20: 206d 696e 5f70 6572 696f 6473 203d 2032   min_periods = 2
-0003fc30: 0a20 2020 2065 6c69 6620 6d69 6e5f 7065  .    elif min_pe
-0003fc40: 7269 6f64 7320 3c20 323a 0a20 2020 2020  riods < 2:.     
-0003fc50: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0003fc60: 726f 7228 226d 696e 5f70 6572 696f 6473  ror("min_periods
-0003fc70: 206d 7573 7420 6265 203e 3d20 3222 290a   must be >= 2").
-0003fc80: 0a20 2020 2069 6620 7370 6c69 745f 6576  .    if split_ev
-0003fc90: 6572 7920 6973 2046 616c 7365 3a0a 2020  ery is False:.  
-0003fca0: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
-0003fcb0: 7920 3d20 6466 2e6e 7061 7274 6974 696f  y = df.npartitio
-0003fcc0: 6e73 0a20 2020 2065 6c69 6620 7370 6c69  ns.    elif spli
-0003fcd0: 745f 6576 6572 7920 3c20 3220 6f72 206e  t_every < 2 or n
-0003fce0: 6f74 2069 7369 6e73 7461 6e63 6528 7370  ot isinstance(sp
-0003fcf0: 6c69 745f 6576 6572 792c 2049 6e74 6567  lit_every, Integ
-0003fd00: 7261 6c29 3a0a 2020 2020 2020 2020 7261  ral):.        ra
-0003fd10: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-0003fd20: 7370 6c69 745f 6576 6572 7920 6d75 7374  split_every must
-0003fd30: 2062 6520 616e 2069 6e74 6567 6572 203e   be an integer >
-0003fd40: 3d20 3222 290a 0a20 2020 2023 2048 616e  = 2")..    # Han
-0003fd50: 646c 6520 7365 6c65 6374 696e 6720 6e75  dle selecting nu
-0003fd60: 6d65 7269 6320 6461 7461 2061 6e64 2061  meric data and a
-0003fd70: 7373 6f63 6961 7465 6420 6465 7072 6563  ssociated deprec
-0003fd80: 6174 696f 6e20 7761 726e 696e 670a 2020  ation warning.  
-0003fd90: 2020 6d61 7962 655f 7761 726e 203d 2046    maybe_warn = F
-0003fda0: 616c 7365 0a20 2020 2069 6620 6e75 6d65  alse.    if nume
-0003fdb0: 7269 635f 6f6e 6c79 2069 7320 6e6f 5f64  ric_only is no_d
-0003fdc0: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
-0003fdd0: 6966 2050 414e 4441 535f 4754 5f32 3030  if PANDAS_GT_200
-0003fde0: 3a0a 2020 2020 2020 2020 2020 2020 6e75  :.            nu
-0003fdf0: 6d65 7269 635f 6f6e 6c79 203d 2046 616c  meric_only = Fal
-0003fe00: 7365 0a20 2020 2020 2020 2065 6c69 6620  se.        elif 
-0003fe10: 5041 4e44 4153 5f47 545f 3135 303a 0a20  PANDAS_GT_150:. 
-0003fe20: 2020 2020 2020 2020 2020 206d 6179 6265             maybe
-0003fe30: 5f77 6172 6e20 3d20 5472 7565 0a20 2020  _warn = True.   
-0003fe40: 2020 2020 2020 2020 206e 756d 6572 6963           numeric
-0003fe50: 5f6f 6e6c 7920 3d20 5472 7565 0a20 2020  _only = True.   
-0003fe60: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003fe70: 2020 2020 2020 206e 756d 6572 6963 5f6f         numeric_o
-0003fe80: 6e6c 7920 3d20 5472 7565 0a0a 2020 2020  nly = True..    
-0003fe90: 616c 6c5f 6e75 6d65 7269 6320 3d20 6466  all_numeric = df
-0003fea0: 2e5f 6765 745f 6e75 6d65 7269 635f 6461  ._get_numeric_da
-0003feb0: 7461 2829 2e5f 6e61 6d65 203d 3d20 6466  ta()._name == df
-0003fec0: 2e5f 6e61 6d65 0a20 2020 2069 6620 6d61  ._name.    if ma
-0003fed0: 7962 655f 7761 726e 2061 6e64 206e 6f74  ybe_warn and not
-0003fee0: 2061 6c6c 5f6e 756d 6572 6963 3a0a 2020   all_numeric:.  
-0003fef0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-0003ff00: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
-0003ff10: 2022 5468 6520 6465 6661 756c 7420 7661   "The default va
-0003ff20: 6c75 6520 6f66 206e 756d 6572 6963 5f6f  lue of numeric_o
-0003ff30: 6e6c 7920 7769 6c6c 2062 6520 6046 616c  nly will be `Fal
-0003ff40: 7365 6020 220a 2020 2020 2020 2020 2020  se` ".          
-0003ff50: 2020 2269 6e20 6120 6675 7475 7265 2076    "in a future v
-0003ff60: 6572 7369 6f6e 206f 6620 4461 736b 2e22  ersion of Dask."
-0003ff70: 2c0a 2020 2020 2020 2020 2020 2020 4675  ,.            Fu
-0003ff80: 7475 7265 5761 726e 696e 672c 0a20 2020  tureWarning,.   
-0003ff90: 2020 2020 2029 0a0a 2020 2020 6966 206e       )..    if n
-0003ffa0: 756d 6572 6963 5f6f 6e6c 7920 616e 6420  umeric_only and 
-0003ffb0: 6e6f 7420 616c 6c5f 6e75 6d65 7269 633a  not all_numeric:
-0003ffc0: 0a20 2020 2020 2020 2064 6620 3d20 6466  .        df = df
-0003ffd0: 2e5f 6765 745f 6e75 6d65 7269 635f 6461  ._get_numeric_da
-0003ffe0: 7461 2829 0a0a 2020 2020 6966 2073 6361  ta()..    if sca
-0003fff0: 6c61 7220 616e 6420 6c65 6e28 6466 2e63  lar and len(df.c
-00040000: 6f6c 756d 6e73 2920 213d 2032 3a0a 2020  olumns) != 2:.  
-00040010: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00040020: 6545 7272 6f72 2822 7363 616c 6172 206f  eError("scalar o
-00040030: 6e6c 7920 7661 6c69 6420 666f 7220 3220  nly valid for 2 
-00040040: 636f 6c75 6d6e 2064 6174 6166 7261 6d65  column dataframe
-00040050: 2229 0a0a 2020 2020 746f 6b65 6e20 3d20  ")..    token = 
-00040060: 746f 6b65 6e69 7a65 2864 662c 206d 696e  tokenize(df, min
-00040070: 5f70 6572 696f 6473 2c20 7363 616c 6172  _periods, scalar
-00040080: 2c20 7370 6c69 745f 6576 6572 7929 0a0a  , split_every)..
-00040090: 2020 2020 6675 6e63 6e61 6d65 203d 2022      funcname = "
-000400a0: 636f 7272 2220 6966 2063 6f72 7220 656c  corr" if corr el
-000400b0: 7365 2022 636f 7622 0a20 2020 2061 203d  se "cov".    a =
-000400c0: 2066 227b 6675 6e63 6e61 6d65 7d2d 6368   f"{funcname}-ch
-000400d0: 756e 6b2d 7b64 662e 5f6e 616d 657d 220a  unk-{df._name}".
-000400e0: 2020 2020 6473 6b20 3d20 7b0a 2020 2020      dsk = {.    
-000400f0: 2020 2020 2861 2c20 6929 3a20 285f 636f      (a, i): (_co
-00040100: 765f 636f 7272 5f63 6875 6e6b 2c20 662c  v_corr_chunk, f,
-00040110: 2063 6f72 7229 2066 6f72 2028 692c 2066   corr) for (i, f
-00040120: 2920 696e 2065 6e75 6d65 7261 7465 2864  ) in enumerate(d
-00040130: 662e 5f5f 6461 736b 5f6b 6579 735f 5f28  f.__dask_keys__(
-00040140: 2929 0a20 2020 207d 0a0a 2020 2020 7072  )).    }..    pr
-00040150: 6566 6978 203d 2066 227b 6675 6e63 6e61  efix = f"{funcna
-00040160: 6d65 7d2d 636f 6d62 696e 652d 7b64 662e  me}-combine-{df.
-00040170: 5f6e 616d 657d 2d22 0a20 2020 206b 203d  _name}-".    k =
-00040180: 2064 662e 6e70 6172 7469 7469 6f6e 730a   df.npartitions.
-00040190: 2020 2020 6220 3d20 610a 2020 2020 6465      b = a.    de
-000401a0: 7074 6820 3d20 300a 2020 2020 7768 696c  pth = 0.    whil
-000401b0: 6520 6b20 3e20 7370 6c69 745f 6576 6572  e k > split_ever
-000401c0: 793a 0a20 2020 2020 2020 2062 203d 2070  y:.        b = p
-000401d0: 7265 6669 7820 2b20 7374 7228 6465 7074  refix + str(dept
-000401e0: 6829 0a20 2020 2020 2020 2066 6f72 2070  h).        for p
-000401f0: 6172 745f 692c 2069 6e64 7320 696e 2065  art_i, inds in e
-00040200: 6e75 6d65 7261 7465 2870 6172 7469 7469  numerate(partiti
-00040210: 6f6e 5f61 6c6c 2873 706c 6974 5f65 7665  on_all(split_eve
-00040220: 7279 2c20 7261 6e67 6528 6b29 2929 3a0a  ry, range(k))):.
-00040230: 2020 2020 2020 2020 2020 2020 6473 6b5b              dsk[
-00040240: 2862 2c20 7061 7274 5f69 295d 203d 2028  (b, part_i)] = (
-00040250: 5f63 6f76 5f63 6f72 725f 636f 6d62 696e  _cov_corr_combin
-00040260: 652c 205b 2861 2c20 6929 2066 6f72 2069  e, [(a, i) for i
-00040270: 2069 6e20 696e 6473 5d2c 2063 6f72 7229   in inds], corr)
-00040280: 0a20 2020 2020 2020 206b 203d 2070 6172  .        k = par
-00040290: 745f 6920 2b20 310a 2020 2020 2020 2020  t_i + 1.        
-000402a0: 6120 3d20 620a 2020 2020 2020 2020 6465  a = b.        de
-000402b0: 7074 6820 2b3d 2031 0a0a 2020 2020 6e61  pth += 1..    na
-000402c0: 6d65 203d 2066 227b 6675 6e63 6e61 6d65  me = f"{funcname
-000402d0: 7d2d 7b74 6f6b 656e 7d22 0a20 2020 2064  }-{token}".    d
-000402e0: 736b 5b28 6e61 6d65 2c20 3029 5d20 3d20  sk[(name, 0)] = 
-000402f0: 280a 2020 2020 2020 2020 5f63 6f76 5f63  (.        _cov_c
-00040300: 6f72 725f 6167 672c 0a20 2020 2020 2020  orr_agg,.       
-00040310: 205b 2861 2c20 6929 2066 6f72 2069 2069   [(a, i) for i i
-00040320: 6e20 7261 6e67 6528 6b29 5d2c 0a20 2020  n range(k)],.   
-00040330: 2020 2020 2064 662e 636f 6c75 6d6e 732c       df.columns,
-00040340: 0a20 2020 2020 2020 206d 696e 5f70 6572  .        min_per
-00040350: 696f 6473 2c0a 2020 2020 2020 2020 636f  iods,.        co
-00040360: 7272 2c0a 2020 2020 2020 2020 7363 616c  rr,.        scal
-00040370: 6172 2c0a 2020 2020 2020 2020 6466 2e5f  ar,.        df._
-00040380: 6d65 7461 2c0a 2020 2020 290a 2020 2020  meta,.    ).    
-00040390: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
-000403a0: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
-000403b0: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
-000403c0: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
-000403d0: 5b64 665d 290a 2020 2020 6966 2073 6361  [df]).    if sca
-000403e0: 6c61 723a 0a20 2020 2020 2020 2072 6574  lar:.        ret
-000403f0: 7572 6e20 5363 616c 6172 2867 7261 7068  urn Scalar(graph
-00040400: 2c20 6e61 6d65 2c20 2266 3822 290a 2020  , name, "f8").  
-00040410: 2020 6d65 7461 203d 206d 616b 655f 6d65    meta = make_me
-00040420: 7461 280a 2020 2020 2020 2020 5b28 632c  ta(.        [(c,
-00040430: 2022 6638 2229 2066 6f72 2063 2069 6e20   "f8") for c in 
-00040440: 6466 2e63 6f6c 756d 6e73 5d2c 0a20 2020  df.columns],.   
-00040450: 2020 2020 2069 6e64 6578 3d6d 6574 615f       index=meta_
-00040460: 7365 7269 6573 5f63 6f6e 7374 7275 6374  series_construct
-00040470: 6f72 2864 6629 2864 662e 636f 6c75 6d6e  or(df)(df.column
-00040480: 7329 2c0a 2020 2020 2020 2020 7061 7265  s),.        pare
-00040490: 6e74 5f6d 6574 613d 6466 2e5f 6d65 7461  nt_meta=df._meta
-000404a0: 2c0a 2020 2020 290a 2020 2020 7265 7475  ,.    ).    retu
-000404b0: 726e 206e 6577 5f64 645f 6f62 6a65 6374  rn new_dd_object
-000404c0: 2867 7261 7068 2c20 6e61 6d65 2c20 6d65  (graph, name, me
-000404d0: 7461 2c20 2864 662e 636f 6c75 6d6e 732e  ta, (df.columns.
-000404e0: 6d69 6e28 292c 2064 662e 636f 6c75 6d6e  min(), df.column
-000404f0: 732e 6d61 7828 2929 290a 0a0a 6465 6620  s.max()))...def 
-00040500: 5f63 6f76 5f63 6f72 725f 6368 756e 6b28  _cov_corr_chunk(
-00040510: 6466 2c20 636f 7272 3d46 616c 7365 293a  df, corr=False):
-00040520: 0a20 2020 2022 2222 4368 756e 6b20 7061  .    """Chunk pa
-00040530: 7274 206f 6620 6120 636f 7661 7269 616e  rt of a covarian
-00040540: 6365 206f 7220 636f 7272 656c 6174 696f  ce or correlatio
-00040550: 6e20 636f 6d70 7574 6174 696f 6e22 2222  n computation"""
-00040560: 0a20 2020 2073 6861 7065 203d 2028 6466  .    shape = (df
-00040570: 2e73 6861 7065 5b31 5d2c 2064 662e 7368  .shape[1], df.sh
-00040580: 6170 655b 315d 290a 2020 2020 6466 203d  ape[1]).    df =
-00040590: 2064 662e 6173 7479 7065 2822 666c 6f61   df.astype("floa
-000405a0: 7436 3422 2c20 636f 7079 3d46 616c 7365  t64", copy=False
-000405b0: 290a 2020 2020 7375 6d73 203d 206e 702e  ).    sums = np.
-000405c0: 7a65 726f 735f 6c69 6b65 2864 662e 7661  zeros_like(df.va
-000405d0: 6c75 6573 2c20 7368 6170 653d 7368 6170  lues, shape=shap
-000405e0: 6529 0a20 2020 2063 6f75 6e74 7320 3d20  e).    counts = 
-000405f0: 6e70 2e7a 6572 6f73 5f6c 696b 6528 6466  np.zeros_like(df
-00040600: 2e76 616c 7565 732c 2073 6861 7065 3d73  .values, shape=s
-00040610: 6861 7065 290a 2020 2020 666f 7220 6964  hape).    for id
-00040620: 7820 696e 2072 616e 6765 286c 656e 2864  x in range(len(d
-00040630: 662e 636f 6c75 6d6e 7329 293a 0a20 2020  f.columns)):.   
-00040640: 2020 2020 206d 6173 6b20 3d20 6466 2e69       mask = df.i
-00040650: 6c6f 635b 3a2c 2069 6478 5d2e 6e6f 746e  loc[:, idx].notn
-00040660: 756c 6c28 290a 2020 2020 2020 2020 7375  ull().        su
-00040670: 6d73 5b69 6478 5d20 3d20 6466 5b6d 6173  ms[idx] = df[mas
-00040680: 6b5d 2e73 756d 2829 2e76 616c 7565 730a  k].sum().values.
-00040690: 2020 2020 2020 2020 636f 756e 7473 5b69          counts[i
-000406a0: 6478 5d20 3d20 6466 5b6d 6173 6b5d 2e63  dx] = df[mask].c
-000406b0: 6f75 6e74 2829 2e76 616c 7565 730a 2020  ount().values.  
-000406c0: 2020 2320 5370 6563 6961 6c20 6361 7365    # Special case
-000406d0: 2073 696e 676c 652d 726f 7720 4461 7461   single-row Data
-000406e0: 4672 616d 6520 636f 7620 746f 2061 766f  Frame cov to avo
-000406f0: 6964 2077 6172 6e69 6e67 7320 6672 6f6d  id warnings from
-00040700: 2070 616e 6461 732e 0a20 2020 2069 6620   pandas..    if 
-00040710: 6466 2e73 6861 7065 5b30 5d20 3d3d 2031  df.shape[0] == 1
-00040720: 3a0a 2020 2020 2020 2020 636f 7620 3d20  :.        cov = 
-00040730: 6e70 2e66 756c 6c5f 6c69 6b65 2873 756d  np.full_like(sum
-00040740: 732c 206e 702e 6e61 6e29 2020 2320 616c  s, np.nan)  # al
-00040750: 7761 7973 2061 6e20 616c 6c20 6e61 6e20  ways an all nan 
-00040760: 7265 7375 6c74 0a20 2020 2065 6c73 653a  result.    else:
-00040770: 0a20 2020 2020 2020 2063 6f76 203d 2064  .        cov = d
-00040780: 662e 636f 7628 292e 7661 6c75 6573 0a20  f.cov().values. 
-00040790: 2020 2064 7479 7065 203d 205b 2822 7375     dtype = [("su
-000407a0: 6d22 2c20 7375 6d73 2e64 7479 7065 292c  m", sums.dtype),
-000407b0: 2028 2263 6f75 6e74 222c 2063 6f75 6e74   ("count", count
-000407c0: 732e 6474 7970 6529 2c20 2822 636f 7622  s.dtype), ("cov"
-000407d0: 2c20 636f 762e 6474 7970 6529 5d0a 2020  , cov.dtype)].  
-000407e0: 2020 6966 2063 6f72 723a 0a20 2020 2020    if corr:.     
-000407f0: 2020 2077 6974 6820 7761 726e 696e 6773     with warnings
-00040800: 2e63 6174 6368 5f77 6172 6e69 6e67 7328  .catch_warnings(
-00040810: 7265 636f 7264 3d54 7275 6529 3a0a 2020  record=True):.  
-00040820: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00040830: 6773 2e73 696d 706c 6566 696c 7465 7228  gs.simplefilter(
-00040840: 2261 6c77 6179 7322 290a 2020 2020 2020  "always").      
-00040850: 2020 2020 2020 6d75 203d 2028 7375 6d73        mu = (sums
-00040860: 202f 2063 6f75 6e74 7329 2e54 0a20 2020   / counts).T.   
-00040870: 2020 2020 206d 203d 206e 702e 7a65 726f       m = np.zero
-00040880: 735f 6c69 6b65 2864 662e 7661 6c75 6573  s_like(df.values
-00040890: 2c20 7368 6170 653d 7368 6170 6529 0a20  , shape=shape). 
-000408a0: 2020 2020 2020 206d 6173 6b20 3d20 6466         mask = df
-000408b0: 2e69 736e 756c 6c28 292e 7661 6c75 6573  .isnull().values
-000408c0: 0a20 2020 2020 2020 2066 6f72 2069 6478  .        for idx
-000408d0: 2069 6e20 7261 6e67 6528 6c65 6e28 6466   in range(len(df
-000408e0: 2e63 6f6c 756d 6e73 2929 3a0a 2020 2020  .columns)):.    
-000408f0: 2020 2020 2020 2020 2320 4176 6f69 6420          # Avoid 
-00040900: 7573 696e 6720 7566 756e 632e 6f75 7465  using ufunc.oute
-00040910: 7220 286e 6f74 2073 7570 706f 7274 6564  r (not supported
-00040920: 2062 7920 6375 7079 290a 2020 2020 2020   by cupy).      
-00040930: 2020 2020 2020 6d75 5f64 6973 6372 6570        mu_discrep
-00040940: 616e 6379 203d 2028 0a20 2020 2020 2020  ancy = (.       
-00040950: 2020 2020 2020 2020 206e 702e 7375 6274           np.subt
-00040960: 7261 6374 2864 662e 696c 6f63 5b3a 2c20  ract(df.iloc[:, 
-00040970: 6964 785d 2e76 616c 7565 735b 3a2c 204e  idx].values[:, N
-00040980: 6f6e 655d 2c20 6d75 5b69 6478 5d5b 4e6f  one], mu[idx][No
-00040990: 6e65 2c20 3a5d 2920 2a2a 2032 0a20 2020  ne, :]) ** 2.   
-000409a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000409b0: 2020 2020 2020 206d 755f 6469 7363 7265         mu_discre
-000409c0: 7061 6e63 795b 6d61 736b 5d20 3d20 6e70  pancy[mask] = np
-000409d0: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
-000409e0: 206d 5b69 6478 5d20 3d20 6e70 2e6e 616e   m[idx] = np.nan
-000409f0: 7375 6d28 6d75 5f64 6973 6372 6570 616e  sum(mu_discrepan
-00040a00: 6379 2c20 6178 6973 3d30 290a 2020 2020  cy, axis=0).    
-00040a10: 2020 2020 6d20 3d20 6d2e 540a 2020 2020      m = m.T.    
-00040a20: 2020 2020 6474 7970 652e 6170 7065 6e64      dtype.append
-00040a30: 2828 226d 222c 206d 2e64 7479 7065 2929  (("m", m.dtype))
-00040a40: 0a0a 2020 2020 6f75 7420 3d20 7b22 7375  ..    out = {"su
-00040a50: 6d22 3a20 7375 6d73 2c20 2263 6f75 6e74  m": sums, "count
-00040a60: 223a 2063 6f75 6e74 732c 2022 636f 7622  ": counts, "cov"
-00040a70: 3a20 636f 7620 2a20 2863 6f75 6e74 7320  : cov * (counts 
-00040a80: 2d20 3129 7d0a 2020 2020 6966 2063 6f72  - 1)}.    if cor
-00040a90: 723a 0a20 2020 2020 2020 206f 7574 5b22  r:.        out["
-00040aa0: 6d22 5d20 3d20 6d0a 2020 2020 7265 7475  m"] = m.    retu
-00040ab0: 726e 206f 7574 0a0a 0a64 6566 205f 636f  rn out...def _co
-00040ac0: 765f 636f 7272 5f63 6f6d 6269 6e65 2864  v_corr_combine(d
-00040ad0: 6174 615f 696e 2c20 636f 7272 3d46 616c  ata_in, corr=Fal
-00040ae0: 7365 293a 0a20 2020 2064 6174 6120 3d20  se):.    data = 
-00040af0: 7b22 7375 6d22 3a20 4e6f 6e65 2c20 2263  {"sum": None, "c
-00040b00: 6f75 6e74 223a 204e 6f6e 652c 2022 636f  ount": None, "co
-00040b10: 7622 3a20 4e6f 6e65 7d0a 2020 2020 6966  v": None}.    if
-00040b20: 2063 6f72 723a 0a20 2020 2020 2020 2064   corr:.        d
-00040b30: 6174 615b 226d 225d 203d 204e 6f6e 650a  ata["m"] = None.
-00040b40: 0a20 2020 2066 6f72 206b 2069 6e20 6461  .    for k in da
-00040b50: 7461 2e6b 6579 7328 293a 0a20 2020 2020  ta.keys():.     
-00040b60: 2020 2064 6174 615b 6b5d 203d 205b 645b     data[k] = [d[
-00040b70: 6b5d 2066 6f72 2064 2069 6e20 6461 7461  k] for d in data
-00040b80: 5f69 6e5d 0a20 2020 2020 2020 2064 6174  _in].        dat
-00040b90: 615b 6b5d 203d 206e 702e 636f 6e63 6174  a[k] = np.concat
-00040ba0: 656e 6174 6528 6461 7461 5b6b 5d29 2e72  enate(data[k]).r
-00040bb0: 6573 6861 7065 2828 6c65 6e28 6461 7461  eshape((len(data
-00040bc0: 5b6b 5d29 2c29 202b 2064 6174 615b 6b5d  [k]),) + data[k]
-00040bd0: 5b30 5d2e 7368 6170 6529 0a0a 2020 2020  [0].shape)..    
-00040be0: 7375 6d73 203d 206e 702e 6e61 6e5f 746f  sums = np.nan_to
-00040bf0: 5f6e 756d 2864 6174 615b 2273 756d 225d  _num(data["sum"]
-00040c00: 290a 2020 2020 636f 756e 7473 203d 2064  ).    counts = d
-00040c10: 6174 615b 2263 6f75 6e74 225d 0a0a 2020  ata["count"]..  
-00040c20: 2020 6375 6d5f 7375 6d73 203d 206e 702e    cum_sums = np.
-00040c30: 6375 6d73 756d 2873 756d 732c 2030 290a  cumsum(sums, 0).
-00040c40: 2020 2020 6375 6d5f 636f 756e 7473 203d      cum_counts =
-00040c50: 206e 702e 6375 6d73 756d 2863 6f75 6e74   np.cumsum(count
-00040c60: 732c 2030 290a 0a20 2020 2073 3120 3d20  s, 0)..    s1 = 
-00040c70: 6375 6d5f 7375 6d73 5b3a 2d31 5d0a 2020  cum_sums[:-1].  
-00040c80: 2020 7332 203d 2073 756d 735b 313a 5d0a    s2 = sums[1:].
-00040c90: 2020 2020 6e31 203d 2063 756d 5f63 6f75      n1 = cum_cou
-00040ca0: 6e74 735b 3a2d 315d 0a20 2020 206e 3220  nts[:-1].    n2 
-00040cb0: 3d20 636f 756e 7473 5b31 3a5d 0a20 2020  = counts[1:].   
-00040cc0: 2077 6974 6820 6e70 2e65 7272 7374 6174   with np.errstat
-00040cd0: 6528 696e 7661 6c69 643d 2269 676e 6f72  e(invalid="ignor
-00040ce0: 6522 293a 0a20 2020 2020 2020 2064 203d  e"):.        d =
-00040cf0: 2028 7332 202f 206e 3229 202d 2028 7331   (s2 / n2) - (s1
-00040d00: 202f 206e 3129 0a20 2020 2020 2020 2043   / n1).        C
-00040d10: 203d 206e 702e 6e61 6e73 756d 280a 2020   = np.nansum(.  
-00040d20: 2020 2020 2020 2020 2020 286e 3120 2a20            (n1 * 
-00040d30: 6e32 2920 2f20 286e 3120 2b20 6e32 2920  n2) / (n1 + n2) 
-00040d40: 2a20 2864 202a 2064 2e74 7261 6e73 706f  * (d * d.transpo
-00040d50: 7365 2828 302c 2032 2c20 3129 2929 2c20  se((0, 2, 1))), 
-00040d60: 300a 2020 2020 2020 2020 2920 2b20 6e70  0.        ) + np
-00040d70: 2e6e 616e 7375 6d28 6461 7461 5b22 636f  .nansum(data["co
-00040d80: 7622 5d2c 2030 290a 0a20 2020 206f 7574  v"], 0)..    out
-00040d90: 203d 207b 2273 756d 223a 2063 756d 5f73   = {"sum": cum_s
-00040da0: 756d 735b 2d31 5d2c 2022 636f 756e 7422  ums[-1], "count"
-00040db0: 3a20 6375 6d5f 636f 756e 7473 5b2d 315d  : cum_counts[-1]
-00040dc0: 2c20 2263 6f76 223a 2043 7d0a 0a20 2020  , "cov": C}..   
-00040dd0: 2069 6620 636f 7272 3a0a 2020 2020 2020   if corr:.      
-00040de0: 2020 6e6f 6273 203d 206e 702e 7768 6572    nobs = np.wher
-00040df0: 6528 6375 6d5f 636f 756e 7473 5b2d 315d  e(cum_counts[-1]
-00040e00: 2c20 6375 6d5f 636f 756e 7473 5b2d 315d  , cum_counts[-1]
-00040e10: 2c20 6e70 2e6e 616e 290a 2020 2020 2020  , np.nan).      
-00040e20: 2020 6d75 203d 2063 756d 5f73 756d 735b    mu = cum_sums[
-00040e30: 2d31 5d20 2f20 6e6f 6273 0a20 2020 2020  -1] / nobs.     
-00040e40: 2020 2063 6f75 6e74 735f 6e61 203d 206e     counts_na = n
-00040e50: 702e 7768 6572 6528 636f 756e 7473 2c20  p.where(counts, 
-00040e60: 636f 756e 7473 2c20 6e70 2e6e 616e 290a  counts, np.nan).
-00040e70: 2020 2020 2020 2020 6d20 3d20 6e70 2e6e          m = np.n
-00040e80: 616e 7375 6d28 6461 7461 5b22 6d22 5d20  ansum(data["m"] 
-00040e90: 2b20 636f 756e 7473 202a 2028 7375 6d73  + counts * (sums
-00040ea0: 202f 2063 6f75 6e74 735f 6e61 202d 206d   / counts_na - m
-00040eb0: 7529 202a 2a20 322c 2061 7869 733d 3029  u) ** 2, axis=0)
-00040ec0: 0a20 2020 2020 2020 206f 7574 5b22 6d22  .        out["m"
-00040ed0: 5d20 3d20 6d0a 2020 2020 7265 7475 726e  ] = m.    return
-00040ee0: 206f 7574 0a0a 0a64 6566 205f 636f 765f   out...def _cov_
-00040ef0: 636f 7272 5f61 6767 2864 6174 612c 2063  corr_agg(data, c
-00040f00: 6f6c 732c 206d 696e 5f70 6572 696f 6473  ols, min_periods
-00040f10: 3d32 2c20 636f 7272 3d46 616c 7365 2c20  =2, corr=False, 
-00040f20: 7363 616c 6172 3d46 616c 7365 2c20 6c69  scalar=False, li
-00040f30: 6b65 5f64 663d 4e6f 6e65 293a 0a20 2020  ke_df=None):.   
-00040f40: 206f 7574 203d 205f 636f 765f 636f 7272   out = _cov_corr
-00040f50: 5f63 6f6d 6269 6e65 2864 6174 612c 2063  _combine(data, c
-00040f60: 6f72 7229 0a20 2020 2063 6f75 6e74 7320  orr).    counts 
-00040f70: 3d20 6f75 745b 2263 6f75 6e74 225d 0a20  = out["count"]. 
-00040f80: 2020 2043 203d 206f 7574 5b22 636f 7622     C = out["cov"
-00040f90: 5d0a 2020 2020 435b 636f 756e 7473 203c  ].    C[counts <
-00040fa0: 206d 696e 5f70 6572 696f 6473 5d20 3d20   min_periods] = 
-00040fb0: 6e70 2e6e 616e 0a20 2020 2069 6620 636f  np.nan.    if co
-00040fc0: 7272 3a0a 2020 2020 2020 2020 6d32 203d  rr:.        m2 =
-00040fd0: 206f 7574 5b22 6d22 5d0a 2020 2020 2020   out["m"].      
-00040fe0: 2020 6465 6e20 3d20 6e70 2e73 7172 7428    den = np.sqrt(
-00040ff0: 6d32 202a 206d 322e 5429 0a20 2020 2065  m2 * m2.T).    e
-00041000: 6c73 653a 0a20 2020 2020 2020 2064 656e  lse:.        den
-00041010: 203d 206e 702e 7768 6572 6528 636f 756e   = np.where(coun
-00041020: 7473 2c20 636f 756e 7473 2c20 6e70 2e6e  ts, counts, np.n
-00041030: 616e 2920 2d20 310a 2020 2020 7769 7468  an) - 1.    with
-00041040: 206e 702e 6572 7273 7461 7465 2869 6e76   np.errstate(inv
-00041050: 616c 6964 3d22 6967 6e6f 7265 222c 2064  alid="ignore", d
-00041060: 6976 6964 653d 2269 676e 6f72 6522 293a  ivide="ignore"):
-00041070: 0a20 2020 2020 2020 206d 6174 203d 2043  .        mat = C
-00041080: 202f 2064 656e 0a20 2020 2069 6620 7363   / den.    if sc
-00041090: 616c 6172 3a0a 2020 2020 2020 2020 7265  alar:.        re
-000410a0: 7475 726e 2066 6c6f 6174 286d 6174 5b30  turn float(mat[0
-000410b0: 2c20 315d 290a 2020 2020 7265 7475 726e  , 1]).    return
-000410c0: 2028 7064 2e44 6174 6146 7261 6d65 2069   (pd.DataFrame i
-000410d0: 6620 6c69 6b65 5f64 6620 6973 204e 6f6e  f like_df is Non
-000410e0: 6520 656c 7365 206d 6574 615f 6672 616d  e else meta_fram
-000410f0: 655f 636f 6e73 7472 7563 746f 7228 6c69  e_constructor(li
-00041100: 6b65 5f64 6629 2928 0a20 2020 2020 2020  ke_df))(.       
-00041110: 206d 6174 2c20 636f 6c75 6d6e 733d 636f   mat, columns=co
-00041120: 6c73 2c20 696e 6465 783d 636f 6c73 0a20  ls, index=cols. 
-00041130: 2020 2029 0a0a 0a64 6566 2070 645f 7370     )...def pd_sp
-00041140: 6c69 7428 6466 2c20 702c 2072 616e 646f  lit(df, p, rando
-00041150: 6d5f 7374 6174 653d 4e6f 6e65 2c20 7368  m_state=None, sh
-00041160: 7566 666c 653d 4661 6c73 6529 3a0a 2020  uffle=False):.  
-00041170: 2020 2222 2253 706c 6974 2044 6174 6146    """Split DataF
-00041180: 7261 6d65 2069 6e74 6f20 6d75 6c74 6970  rame into multip
-00041190: 6c65 2070 6965 6365 7320 7073 6575 646f  le pieces pseudo
-000411a0: 7261 6e64 6f6d 6c79 0a0a 2020 2020 3e3e  randomly..    >>
-000411b0: 3e20 6466 203d 2070 642e 4461 7461 4672  > df = pd.DataFr
-000411c0: 616d 6528 7b27 6127 3a20 5b31 2c20 322c  ame({'a': [1, 2,
-000411d0: 2033 2c20 342c 2035 2c20 365d 2c0a 2020   3, 4, 5, 6],.  
-000411e0: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-000411f0: 2020 2020 2020 2020 2027 6227 3a20 5b32           'b': [2
-00041200: 2c20 332c 2034 2c20 352c 2036 2c20 375d  , 3, 4, 5, 6, 7]
-00041210: 7d29 0a0a 2020 2020 3e3e 3e20 612c 2062  })..    >>> a, b
-00041220: 203d 2070 645f 7370 6c69 7428 0a20 2020   = pd_split(.   
-00041230: 202e 2e2e 2020 2020 2064 662c 205b 302e   ...     df, [0.
-00041240: 352c 2030 2e35 5d2c 2072 616e 646f 6d5f  5, 0.5], random_
-00041250: 7374 6174 653d 3132 332c 2073 6875 6666  state=123, shuff
-00041260: 6c65 3d54 7275 650a 2020 2020 2e2e 2e20  le=True.    ... 
-00041270: 2920 2023 2072 6f75 6768 6c79 2035 302f  )  # roughly 50/
-00041280: 3530 2073 706c 6974 0a20 2020 203e 3e3e  50 split.    >>>
-00041290: 2061 0a20 2020 2020 2020 6120 2062 0a20   a.       a  b. 
-000412a0: 2020 2033 2020 3420 2035 0a20 2020 2030     3  4  5.    0
-000412b0: 2020 3120 2032 0a20 2020 2035 2020 3620    1  2.    5  6 
-000412c0: 2037 0a20 2020 203e 3e3e 2062 0a20 2020   7.    >>> b.   
-000412d0: 2020 2020 6120 2062 0a20 2020 2031 2020      a  b.    1  
-000412e0: 3220 2033 0a20 2020 2034 2020 3520 2036  2  3.    4  5  6
-000412f0: 0a20 2020 2032 2020 3320 2034 0a20 2020  .    2  3  4.   
-00041300: 2022 2222 0a20 2020 2070 203d 206c 6973   """.    p = lis
-00041310: 7428 7029 0a20 2020 2069 6620 7368 7566  t(p).    if shuf
-00041320: 666c 653a 0a20 2020 2020 2020 2069 6620  fle:.        if 
-00041330: 6e6f 7420 6973 696e 7374 616e 6365 2872  not isinstance(r
-00041340: 616e 646f 6d5f 7374 6174 652c 206e 702e  andom_state, np.
-00041350: 7261 6e64 6f6d 2e52 616e 646f 6d53 7461  random.RandomSta
-00041360: 7465 293a 0a20 2020 2020 2020 2020 2020  te):.           
-00041370: 2072 616e 646f 6d5f 7374 6174 6520 3d20   random_state = 
-00041380: 6e70 2e72 616e 646f 6d2e 5261 6e64 6f6d  np.random.Random
-00041390: 5374 6174 6528 7261 6e64 6f6d 5f73 7461  State(random_sta
-000413a0: 7465 290a 2020 2020 2020 2020 6466 203d  te).        df =
-000413b0: 2064 662e 7361 6d70 6c65 2866 7261 633d   df.sample(frac=
-000413c0: 312e 302c 2072 616e 646f 6d5f 7374 6174  1.0, random_stat
-000413d0: 653d 7261 6e64 6f6d 5f73 7461 7465 290a  e=random_state).
-000413e0: 2020 2020 696e 6465 7820 3d20 7073 6575      index = pseu
-000413f0: 646f 7261 6e64 6f6d 286c 656e 2864 6629  dorandom(len(df)
-00041400: 2c20 702c 2072 616e 646f 6d5f 7374 6174  , p, random_stat
-00041410: 6529 0a20 2020 2072 6574 7572 6e20 5b64  e).    return [d
-00041420: 662e 696c 6f63 5b69 6e64 6578 203d 3d20  f.iloc[index == 
-00041430: 695d 2066 6f72 2069 2069 6e20 7261 6e67  i] for i in rang
-00041440: 6528 6c65 6e28 7029 295d 0a0a 0a64 6566  e(len(p))]...def
-00041450: 205f 7461 6b65 5f6c 6173 7428 612c 2073   _take_last(a, s
-00041460: 6b69 706e 613d 5472 7565 293a 0a20 2020  kipna=True):.   
-00041470: 2022 2222 0a20 2020 2074 616b 6520 6c61   """.    take la
-00041480: 7374 2072 6f77 2028 5365 7269 6573 2920  st row (Series) 
-00041490: 6f66 2044 6174 6146 7261 6d65 202f 206c  of DataFrame / l
-000414a0: 6173 7420 7661 6c75 6520 6f66 2053 6572  ast value of Ser
-000414b0: 6965 730a 2020 2020 636f 6e73 6964 6572  ies.    consider
-000414c0: 696e 6720 4e61 4e2e 0a0a 2020 2020 5061  ing NaN...    Pa
-000414d0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-000414e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6120 3a20  -------.    a : 
-000414f0: 7064 2e44 6174 6146 7261 6d65 206f 7220  pd.DataFrame or 
-00041500: 7064 2e53 6572 6965 730a 2020 2020 736b  pd.Series.    sk
-00041510: 6970 6e61 203a 2062 6f6f 6c2c 2064 6566  ipna : bool, def
-00041520: 6175 6c74 2054 7275 650a 2020 2020 2020  ault True.      
-00041530: 2020 5768 6574 6865 7220 746f 2065 7863    Whether to exc
-00041540: 6c75 6465 204e 614e 0a0a 2020 2020 2222  lude NaN..    ""
-00041550: 220a 0a20 2020 2064 6566 205f 6c61 7374  "..    def _last
-00041560: 5f76 616c 6964 2873 293a 0a20 2020 2020  _valid(s):.     
-00041570: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00041580: 6528 312c 206d 696e 2831 302c 206c 656e  e(1, min(10, len
-00041590: 2873 2920 2b20 3129 293a 0a20 2020 2020  (s) + 1)):.     
-000415a0: 2020 2020 2020 2076 616c 203d 2073 2e69         val = s.i
-000415b0: 6c6f 635b 2d69 5d0a 2020 2020 2020 2020  loc[-i].        
-000415c0: 2020 2020 6966 206e 6f74 2070 642e 6973      if not pd.is
-000415d0: 6e75 6c6c 2876 616c 293a 0a20 2020 2020  null(val):.     
-000415e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000415f0: 6e20 7661 6c0a 2020 2020 2020 2020 656c  n val.        el
-00041600: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00041610: 6e6f 6e6e 756c 6c20 3d20 735b 732e 6e6f  nonnull = s[s.no
-00041620: 746e 6128 295d 0a20 2020 2020 2020 2020  tna()].         
-00041630: 2020 2069 6620 6e6f 7420 6e6f 6e6e 756c     if not nonnul
-00041640: 6c2e 656d 7074 793a 0a20 2020 2020 2020  l.empty:.       
-00041650: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00041660: 6e6f 6e6e 756c 6c2e 696c 6f63 5b2d 315d  nonnull.iloc[-1]
-00041670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00041680: 4e6f 6e65 0a0a 2020 2020 6966 2073 6b69  None..    if ski
-00041690: 706e 6120 6973 2046 616c 7365 3a0a 2020  pna is False:.  
-000416a0: 2020 2020 2020 7265 7475 726e 2061 2e69        return a.i
-000416b0: 6c6f 635b 2d31 5d0a 2020 2020 656c 7365  loc[-1].    else
-000416c0: 3a0a 2020 2020 2020 2020 2320 7461 6b65  :.        # take
-000416d0: 206c 6173 7420 7661 6c69 6420 7661 6c75   last valid valu
-000416e0: 6520 6578 636c 7564 696e 6720 4e61 4e2c  e excluding NaN,
-000416f0: 204e 614e 206c 6f63 6174 696f 6e20 6d61   NaN location ma
-00041700: 7920 6265 2064 6966 6665 7265 6e74 0a20  y be different. 
-00041710: 2020 2020 2020 2023 2069 6e20 6561 6368         # in each
-00041720: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
-00041730: 6966 2069 735f 6461 7461 6672 616d 655f  if is_dataframe_
-00041740: 6c69 6b65 2861 293a 0a20 2020 2020 2020  like(a):.       
-00041750: 2020 2020 2023 2063 7265 6174 6520 5365       # create Se
-00041760: 7269 6573 2066 726f 6d20 6170 7072 6f70  ries from approp
-00041770: 7269 6174 6520 6261 636b 656e 6420 6461  riate backend da
-00041780: 7461 6672 616d 6520 6c69 6272 6172 790a  taframe library.
-00041790: 2020 2020 2020 2020 2020 2020 7365 7269              seri
-000417a0: 6573 5f74 7970 203d 2074 7970 6528 612e  es_typ = type(a.
-000417b0: 696c 6f63 5b30 3a31 2c20 305d 290a 2020  iloc[0:1, 0]).  
-000417c0: 2020 2020 2020 2020 2020 6966 2061 2e65            if a.e
-000417d0: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
-000417e0: 2020 2020 2020 7265 7475 726e 2073 6572        return ser
-000417f0: 6965 735f 7479 7028 5b5d 2c20 6474 7970  ies_typ([], dtyp
-00041800: 653d 2266 6c6f 6174 2229 0a20 2020 2020  e="float").     
-00041810: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00041820: 7269 6573 5f74 7970 280a 2020 2020 2020  ries_typ(.      
-00041830: 2020 2020 2020 2020 2020 5b5f 6c61 7374            [_last
-00041840: 5f76 616c 6964 2861 2e69 6c6f 635b 3a2c  _valid(a.iloc[:,
-00041850: 2069 5d29 2066 6f72 2069 2069 6e20 7261   i]) for i in ra
-00041860: 6e67 6528 6c65 6e28 612e 636f 6c75 6d6e  nge(len(a.column
-00041870: 7329 295d 2c0a 2020 2020 2020 2020 2020  s))],.          
-00041880: 2020 2020 2020 696e 6465 783d 612e 636f        index=a.co
-00041890: 6c75 6d6e 732c 0a20 2020 2020 2020 2020  lumns,.         
-000418a0: 2020 2029 0a20 2020 2020 2020 2065 6c73     ).        els
-000418b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000418c0: 6574 7572 6e20 5f6c 6173 745f 7661 6c69  eturn _last_vali
-000418d0: 6428 6129 0a0a 0a64 6566 2063 6865 636b  d(a)...def check
-000418e0: 5f64 6976 6973 696f 6e73 2864 6976 6973  _divisions(divis
-000418f0: 696f 6e73 293a 0a20 2020 2069 6620 6e6f  ions):.    if no
-00041900: 7420 6973 696e 7374 616e 6365 2864 6976  t isinstance(div
-00041910: 6973 696f 6e73 2c20 286c 6973 742c 2074  isions, (list, t
-00041920: 7570 6c65 2929 3a0a 2020 2020 2020 2020  uple)):.        
-00041930: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00041940: 2822 4e65 7720 6469 7669 7369 6f6e 206d  ("New division m
-00041950: 7573 7420 6265 206c 6973 7420 6f72 2074  ust be list or t
-00041960: 7570 6c65 2229 0a20 2020 2064 6976 6973  uple").    divis
-00041970: 696f 6e73 203d 206c 6973 7428 6469 7669  ions = list(divi
-00041980: 7369 6f6e 7329 0a20 2020 2069 6620 6c65  sions).    if le
-00041990: 6e28 6469 7669 7369 6f6e 7329 203d 3d20  n(divisions) == 
-000419a0: 303a 0a20 2020 2020 2020 2072 6169 7365  0:.        raise
-000419b0: 2056 616c 7565 4572 726f 7228 224e 6577   ValueError("New
-000419c0: 2064 6976 6973 696f 6e20 6d75 7374 206e   division must n
-000419d0: 6f74 2062 6520 656d 7074 7922 290a 2020  ot be empty").  
-000419e0: 2020 6966 2064 6976 6973 696f 6e73 2021    if divisions !
-000419f0: 3d20 736f 7274 6564 2864 6976 6973 696f  = sorted(divisio
-00041a00: 6e73 293a 0a20 2020 2020 2020 2072 6169  ns):.        rai
-00041a10: 7365 2056 616c 7565 4572 726f 7228 224e  se ValueError("N
-00041a20: 6577 2064 6976 6973 696f 6e20 6d75 7374  ew division must
-00041a30: 2062 6520 736f 7274 6564 2229 0a20 2020   be sorted").   
-00041a40: 2069 6620 6c65 6e28 6469 7669 7369 6f6e   if len(division
-00041a50: 735b 3a2d 315d 2920 213d 206c 656e 286c  s[:-1]) != len(l
-00041a60: 6973 7428 756e 6971 7565 2864 6976 6973  ist(unique(divis
-00041a70: 696f 6e73 5b3a 2d31 5d29 2929 3a0a 2020  ions[:-1]))):.  
-00041a80: 2020 2020 2020 6d73 6720 3d20 224e 6577        msg = "New
-00041a90: 2064 6976 6973 696f 6e20 6d75 7374 2062   division must b
-00041aa0: 6520 756e 6971 7565 2c20 6578 6365 7074  e unique, except
-00041ab0: 2066 6f72 2074 6865 206c 6173 7420 656c   for the last el
-00041ac0: 656d 656e 7422 0a20 2020 2020 2020 2072  ement".        r
-00041ad0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00041ae0: 6d73 6729 0a0a 0a64 6566 2072 6570 6172  msg)...def repar
-00041af0: 7469 7469 6f6e 5f64 6976 6973 696f 6e73  tition_divisions
-00041b00: 2861 2c20 622c 206e 616d 652c 206f 7574  (a, b, name, out
-00041b10: 312c 206f 7574 322c 2066 6f72 6365 3d46  1, out2, force=F
-00041b20: 616c 7365 293a 0a20 2020 2022 2222 6461  alse):.    """da
-00041b30: 736b 2067 7261 7068 2074 6f20 7265 7061  sk graph to repa
-00041b40: 7274 6974 696f 6e20 6461 7461 6672 616d  rtition datafram
-00041b50: 6520 6279 206e 6577 2064 6976 6973 696f  e by new divisio
-00041b60: 6e73 0a0a 2020 2020 5061 7261 6d65 7465  ns..    Paramete
-00041b70: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
-00041b80: 2d0a 2020 2020 6120 3a20 7475 706c 650a  -.    a : tuple.
-00041b90: 2020 2020 2020 2020 6f6c 6420 6469 7669          old divi
-00041ba0: 7369 6f6e 730a 2020 2020 6220 3a20 7475  sions.    b : tu
-00041bb0: 706c 652c 206c 6973 746d 7970 790a 2020  ple, listmypy.  
-00041bc0: 2020 6f75 7432 203a 2073 7472 0a20 2020    out2 : str.   
-00041bd0: 2020 2020 206e 616d 6520 6f66 206e 6577       name of new
-00041be0: 2064 6174 6166 7261 6d65 0a20 2020 2066   dataframe.    f
-00041bf0: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
-00041c00: 6175 6c74 2046 616c 7365 0a20 2020 2020  ault False.     
-00041c10: 2020 2041 6c6c 6f77 7320 7468 6520 6578     Allows the ex
-00041c20: 7061 6e73 696f 6e20 6f66 2074 6865 2065  pansion of the e
-00041c30: 7869 7374 696e 6720 6469 7669 7369 6f6e  xisting division
-00041c40: 732e 0a20 2020 2020 2020 2049 6620 4661  s..        If Fa
-00041c50: 6c73 6520 7468 656e 2074 6865 206e 6577  lse then the new
-00041c60: 2064 6976 6973 696f 6e73 206c 6f77 6572   divisions lower
-00041c70: 2061 6e64 2075 7070 6572 2062 6f75 6e64   and upper bound
-00041c80: 7320 6d75 7374 2062 650a 2020 2020 2020  s must be.      
-00041c90: 2020 7468 6520 7361 6d65 2061 7320 7468    the same as th
-00041ca0: 6520 6f6c 6420 6469 7669 7369 6f6e 732e  e old divisions.
-00041cb0: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-00041cc0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00041cd0: 3e3e 3e20 6672 6f6d 2070 7072 696e 7420  >>> from pprint 
-00041ce0: 696d 706f 7274 2070 7072 696e 740a 2020  import pprint.  
-00041cf0: 2020 3e3e 3e20 7070 7269 6e74 2872 6570    >>> pprint(rep
-00041d00: 6172 7469 7469 6f6e 5f64 6976 6973 696f  artition_divisio
-00041d10: 6e73 285b 312c 2033 2c20 375d 2c20 5b31  ns([1, 3, 7], [1
-00041d20: 2c20 342c 2036 2c20 375d 2c20 2761 272c  , 4, 6, 7], 'a',
-00041d30: 2027 6227 2c20 2763 2729 2920 2023 2064   'b', 'c'))  # d
-00041d40: 6f63 7465 7374 3a20 2b45 4c4c 4950 5349  octest: +ELLIPSI
-00041d50: 530a 2020 2020 7b28 2762 272c 2030 293a  S.    {('b', 0):
-00041d60: 2028 3c66 756e 6374 696f 6e20 626f 756e   (<function boun
-00041d70: 6461 7279 5f73 6c69 6365 2061 7420 2e2e  dary_slice at ..
-00041d80: 2e3e 2c20 2827 6127 2c20 3029 2c20 312c  .>, ('a', 0), 1,
-00041d90: 2033 2c20 4661 6c73 6529 2c0a 2020 2020   3, False),.    
-00041da0: 2028 2762 272c 2031 293a 2028 3c66 756e   ('b', 1): (<fun
-00041db0: 6374 696f 6e20 626f 756e 6461 7279 5f73  ction boundary_s
-00041dc0: 6c69 6365 2061 7420 2e2e 2e3e 2c20 2827  lice at ...>, ('
-00041dd0: 6127 2c20 3129 2c20 332c 2034 2c20 4661  a', 1), 3, 4, Fa
-00041de0: 6c73 6529 2c0a 2020 2020 2028 2762 272c  lse),.     ('b',
-00041df0: 2032 293a 2028 3c66 756e 6374 696f 6e20   2): (<function 
-00041e00: 626f 756e 6461 7279 5f73 6c69 6365 2061  boundary_slice a
-00041e10: 7420 2e2e 2e3e 2c20 2827 6127 2c20 3129  t ...>, ('a', 1)
-00041e20: 2c20 342c 2036 2c20 4661 6c73 6529 2c0a  , 4, 6, False),.
-00041e30: 2020 2020 2028 2762 272c 2033 293a 2028       ('b', 3): (
-00041e40: 3c66 756e 6374 696f 6e20 626f 756e 6461  <function bounda
-00041e50: 7279 5f73 6c69 6365 2061 7420 2e2e 2e3e  ry_slice at ...>
-00041e60: 2c20 2827 6127 2c20 3129 2c20 362c 2037  , ('a', 1), 6, 7
-00041e70: 2c20 5472 7565 292c 0a20 2020 2020 2827  , True),.     ('
-00041e80: 6327 2c20 3029 3a20 283c 6675 6e63 7469  c', 0): (<functi
-00041e90: 6f6e 2063 6f6e 6361 7420 6174 202e 2e2e  on concat at ...
-00041ea0: 3e2c 205b 2827 6227 2c20 3029 2c20 2827  >, [('b', 0), ('
-00041eb0: 6227 2c20 3129 5d29 2c0a 2020 2020 2028  b', 1)]),.     (
-00041ec0: 2763 272c 2031 293a 2028 2762 272c 2032  'c', 1): ('b', 2
-00041ed0: 292c 0a20 2020 2020 2827 6327 2c20 3229  ),.     ('c', 2)
-00041ee0: 3a20 2827 6227 2c20 3329 7d0a 2020 2020  : ('b', 3)}.    
-00041ef0: 2222 220a 2020 2020 6368 6563 6b5f 6469  """.    check_di
-00041f00: 7669 7369 6f6e 7328 6229 0a0a 2020 2020  visions(b)..    
-00041f10: 6966 206c 656e 2862 2920 3c20 323a 0a20  if len(b) < 2:. 
-00041f20: 2020 2020 2020 2023 206d 696e 696d 756d         # minimum
-00041f30: 2064 6976 6973 696f 6e20 6973 2032 2065   division is 2 e
-00041f40: 6c65 6d65 6e74 732c 206c 696b 6520 5b30  lements, like [0
-00041f50: 2c20 305d 0a20 2020 2020 2020 2072 6169  , 0].        rai
-00041f60: 7365 2056 616c 7565 4572 726f 7228 224e  se ValueError("N
-00041f70: 6577 2064 6976 6973 696f 6e20 6d75 7374  ew division must
-00041f80: 2062 6520 6c6f 6e67 6572 2074 6861 6e20   be longer than 
-00041f90: 3220 656c 656d 656e 7473 2229 0a0a 2020  2 elements")..  
-00041fa0: 2020 6966 2066 6f72 6365 3a0a 2020 2020    if force:.    
-00041fb0: 2020 2020 6966 2061 5b30 5d20 3c20 625b      if a[0] < b[
-00041fc0: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00041fd0: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
-00041fe0: 2020 2020 2020 2020 226c 6566 7420 7369          "left si
-00041ff0: 6465 206f 6620 7468 6520 6e65 7720 6469  de of the new di
-00042000: 7669 7369 6f6e 206d 7573 7420 6265 2065  vision must be e
-00042010: 7175 616c 206f 7220 736d 616c 6c65 7220  qual or smaller 
-00042020: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00042030: 2020 2274 6861 6e20 6f6c 6420 6469 7669    "than old divi
-00042040: 7369 6f6e 220a 2020 2020 2020 2020 2020  sion".          
-00042050: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00042060: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00042070: 286d 7367 290a 2020 2020 2020 2020 6966  (msg).        if
-00042080: 2061 5b2d 315d 203e 2062 5b2d 315d 3a0a   a[-1] > b[-1]:.
-00042090: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-000420a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000420b0: 2020 2020 2272 6967 6874 2073 6964 6520      "right side 
-000420c0: 6f66 2074 6865 206e 6577 2064 6976 6973  of the new divis
-000420d0: 696f 6e20 6d75 7374 2062 6520 6571 7561  ion must be equa
-000420e0: 6c20 6f72 206c 6172 6765 7220 220a 2020  l or larger ".  
-000420f0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-00042100: 6861 6e20 6f6c 6420 6469 7669 7369 6f6e  han old division
-00042110: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00042120: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00042130: 6520 5661 6c75 6545 7272 6f72 286d 7367  e ValueError(msg
-00042140: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00042150: 2020 2020 6966 2061 5b30 5d20 213d 2062      if a[0] != b
-00042160: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-00042170: 206d 7367 203d 2022 6c65 6674 2073 6964   msg = "left sid
-00042180: 6520 6f66 206f 6c64 2061 6e64 206e 6577  e of old and new
-00042190: 2064 6976 6973 696f 6e73 2061 7265 2064   divisions are d
-000421a0: 6966 6665 7265 6e74 220a 2020 2020 2020  ifferent".      
-000421b0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000421c0: 6545 7272 6f72 286d 7367 290a 2020 2020  eError(msg).    
-000421d0: 2020 2020 6966 2061 5b2d 315d 2021 3d20      if a[-1] != 
-000421e0: 625b 2d31 5d3a 0a20 2020 2020 2020 2020  b[-1]:.         
-000421f0: 2020 206d 7367 203d 2022 7269 6768 7420     msg = "right 
-00042200: 7369 6465 206f 6620 6f6c 6420 616e 6420  side of old and 
-00042210: 6e65 7720 6469 7669 7369 6f6e 7320 6172  new divisions ar
-00042220: 6520 6469 6666 6572 656e 7422 0a20 2020  e different".   
-00042230: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00042240: 616c 7565 4572 726f 7228 6d73 6729 0a0a  alueError(msg)..
-00042250: 2020 2020 6465 6620 5f69 735f 7369 6e67      def _is_sing
-00042260: 6c65 5f6c 6173 745f 6469 7628 7829 3a0a  le_last_div(x):.
-00042270: 2020 2020 2020 2020 2222 2257 6865 7468          """Wheth
-00042280: 6572 206c 6173 7420 6469 7669 7369 6f6e  er last division
-00042290: 206f 6e6c 7920 636f 6e74 6169 6e73 2073   only contains s
-000422a0: 696e 676c 6520 6c61 6265 6c22 2222 0a20  ingle label""". 
-000422b0: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
-000422c0: 6e28 7829 203e 3d20 3220 616e 6420 785b  n(x) >= 2 and x[
-000422d0: 2d31 5d20 3d3d 2078 5b2d 325d 0a0a 2020  -1] == x[-2]..  
-000422e0: 2020 6320 3d20 5b61 5b30 5d5d 0a20 2020    c = [a[0]].   
-000422f0: 2064 203d 2064 6963 7428 290a 2020 2020   d = dict().    
-00042300: 6c6f 7720 3d20 615b 305d 0a0a 2020 2020  low = a[0]..    
-00042310: 692c 206a 203d 2031 2c20 3120 2023 2069  i, j = 1, 1  # i
-00042320: 6e64 6963 6573 2066 6f72 206f 6c64 2f6e  ndices for old/n
-00042330: 6577 2064 6976 6973 696f 6e73 0a20 2020  ew divisions.   
-00042340: 206b 203d 2030 2020 2320 696e 6465 7820   k = 0  # index 
-00042350: 666f 7220 7465 6d70 2064 6976 6973 696f  for temp divisio
-00042360: 6e73 0a0a 2020 2020 6c61 7374 5f65 6c65  ns..    last_ele
-00042370: 6d20 3d20 5f69 735f 7369 6e67 6c65 5f6c  m = _is_single_l
-00042380: 6173 745f 6469 7628 6129 0a0a 2020 2020  ast_div(a)..    
-00042390: 2320 7072 6f63 6573 7320 7468 726f 7567  # process throug
-000423a0: 6820 6f6c 6420 6469 7669 7369 6f6e 0a20  h old division. 
-000423b0: 2020 2023 206c 6566 7420 7061 7274 206f     # left part o
-000423c0: 6620 6e65 7720 6469 7669 7369 6f6e 2063  f new division c
-000423d0: 616e 2062 6520 7072 6f63 6573 7365 6420  an be processed 
-000423e0: 696e 2074 6869 7320 6c6f 6f70 0a20 2020  in this loop.   
-000423f0: 2077 6869 6c65 2069 203c 206c 656e 2861   while i < len(a
-00042400: 2920 616e 6420 6a20 3c20 6c65 6e28 6229  ) and j < len(b)
-00042410: 3a0a 2020 2020 2020 2020 6966 2061 5b69  :.        if a[i
-00042420: 5d20 3c20 625b 6a5d 3a0a 2020 2020 2020  ] < b[j]:.      
-00042430: 2020 2020 2020 2320 7475 706c 6520 6973        # tuple is
-00042440: 2073 6f6d 6574 6869 6e67 206c 696b 653a   something like:
-00042450: 0a20 2020 2020 2020 2020 2020 2023 2028  .            # (
-00042460: 6d65 7468 6f64 732e 626f 756e 6461 7279  methods.boundary
-00042470: 5f73 6c69 6365 2c20 2827 6672 6f6d 5f70  _slice, ('from_p
-00042480: 616e 6461 732d 2327 2c20 3029 2c20 332c  andas-#', 0), 3,
-00042490: 2034 2c20 4661 6c73 6529 290a 2020 2020   4, False)).    
-000424a0: 2020 2020 2020 2020 645b 286f 7574 312c          d[(out1,
-000424b0: 206b 295d 203d 2028 6d65 7468 6f64 732e   k)] = (methods.
-000424c0: 626f 756e 6461 7279 5f73 6c69 6365 2c20  boundary_slice, 
-000424d0: 286e 616d 652c 2069 202d 2031 292c 206c  (name, i - 1), l
-000424e0: 6f77 2c20 615b 695d 2c20 4661 6c73 6529  ow, a[i], False)
-000424f0: 0a20 2020 2020 2020 2020 2020 206c 6f77  .            low
-00042500: 203d 2061 5b69 5d0a 2020 2020 2020 2020   = a[i].        
-00042510: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-00042520: 2020 2065 6c69 6620 615b 695d 203e 2062     elif a[i] > b
-00042530: 5b6a 5d3a 0a20 2020 2020 2020 2020 2020  [j]:.           
-00042540: 2064 5b28 6f75 7431 2c20 6b29 5d20 3d20   d[(out1, k)] = 
-00042550: 286d 6574 686f 6473 2e62 6f75 6e64 6172  (methods.boundar
-00042560: 795f 736c 6963 652c 2028 6e61 6d65 2c20  y_slice, (name, 
-00042570: 6920 2d20 3129 2c20 6c6f 772c 2062 5b6a  i - 1), low, b[j
-00042580: 5d2c 2046 616c 7365 290a 2020 2020 2020  ], False).      
-00042590: 2020 2020 2020 6c6f 7720 3d20 625b 6a5d        low = b[j]
-000425a0: 0a20 2020 2020 2020 2020 2020 206a 202b  .            j +
-000425b0: 3d20 310a 2020 2020 2020 2020 656c 7365  = 1.        else
-000425c0: 3a0a 2020 2020 2020 2020 2020 2020 645b  :.            d[
-000425d0: 286f 7574 312c 206b 295d 203d 2028 6d65  (out1, k)] = (me
-000425e0: 7468 6f64 732e 626f 756e 6461 7279 5f73  thods.boundary_s
-000425f0: 6c69 6365 2c20 286e 616d 652c 2069 202d  lice, (name, i -
-00042600: 2031 292c 206c 6f77 2c20 625b 6a5d 2c20   1), low, b[j], 
-00042610: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00042620: 2020 206c 6f77 203d 2062 5b6a 5d0a 2020     low = b[j].  
-00042630: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00042640: 2861 2920 3d3d 2069 202b 2031 206f 7220  (a) == i + 1 or 
-00042650: 615b 695d 203c 2061 5b69 202b 2031 5d3a  a[i] < a[i + 1]:
-00042660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042670: 206a 202b 3d20 310a 2020 2020 2020 2020   j += 1.        
-00042680: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-00042690: 2020 2063 2e61 7070 656e 6428 6c6f 7729     c.append(low)
-000426a0: 0a20 2020 2020 2020 206b 202b 3d20 310a  .        k += 1.
-000426b0: 0a20 2020 2023 2072 6967 6874 2070 6172  .    # right par
-000426c0: 7420 6f66 206e 6577 2064 6976 6973 696f  t of new divisio
-000426d0: 6e20 6361 6e20 7265 6d61 696e 0a20 2020  n can remain.   
-000426e0: 2069 6620 615b 2d31 5d20 3c20 625b 2d31   if a[-1] < b[-1
-000426f0: 5d20 6f72 2062 5b2d 315d 203d 3d20 625b  ] or b[-1] == b[
-00042700: 2d32 5d3a 0a20 2020 2020 2020 2066 6f72  -2]:.        for
-00042710: 205f 6a20 696e 2072 616e 6765 286a 2c20   _j in range(j, 
-00042720: 6c65 6e28 6229 293a 0a20 2020 2020 2020  len(b)):.       
-00042730: 2020 2020 2023 2061 6c77 6179 7320 7573       # always us
-00042740: 6520 7269 6768 742d 6d6f 7374 206f 6620  e right-most of 
-00042750: 6f6c 6420 6469 7669 7369 6f6e 0a20 2020  old division.   
-00042760: 2020 2020 2020 2020 2023 2062 6563 6175           # becau
-00042770: 7365 2069 7420 6d61 7920 636f 6e74 6169  se it may contai
-00042780: 6e20 6c61 7374 2065 6c65 6d65 6e74 0a20  n last element. 
-00042790: 2020 2020 2020 2020 2020 206d 203d 206c             m = l
-000427a0: 656e 2861 2920 2d20 320a 2020 2020 2020  en(a) - 2.      
-000427b0: 2020 2020 2020 645b 286f 7574 312c 206b        d[(out1, k
-000427c0: 295d 203d 2028 6d65 7468 6f64 732e 626f  )] = (methods.bo
-000427d0: 756e 6461 7279 5f73 6c69 6365 2c20 286e  undary_slice, (n
-000427e0: 616d 652c 206d 292c 206c 6f77 2c20 625b  ame, m), low, b[
-000427f0: 5f6a 5d2c 2046 616c 7365 290a 2020 2020  _j], False).    
-00042800: 2020 2020 2020 2020 6c6f 7720 3d20 625b          low = b[
-00042810: 5f6a 5d0a 2020 2020 2020 2020 2020 2020  _j].            
-00042820: 632e 6170 7065 6e64 286c 6f77 290a 2020  c.append(low).  
-00042830: 2020 2020 2020 2020 2020 6b20 2b3d 2031            k += 1
-00042840: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00042850: 2020 2023 2065 7665 6e20 6966 206e 6577     # even if new
-00042860: 2064 6976 6973 696f 6e20 6973 2070 726f   division is pro
-00042870: 6365 7373 6564 2074 6872 6f75 6768 2c0a  cessed through,.
-00042880: 2020 2020 2020 2020 2320 7269 6768 742d          # right-
-00042890: 6d6f 7374 2065 6c65 6d65 6e74 206f 6620  most element of 
-000428a0: 6f6c 6420 6469 7669 7369 6f6e 2063 616e  old division can
-000428b0: 2072 656d 6169 6e0a 2020 2020 2020 2020   remain.        
-000428c0: 6966 206c 6173 745f 656c 656d 2061 6e64  if last_elem and
-000428d0: 2069 203c 206c 656e 2861 293a 0a20 2020   i < len(a):.   
-000428e0: 2020 2020 2020 2020 2064 5b28 6f75 7431           d[(out1
-000428f0: 2c20 6b29 5d20 3d20 286d 6574 686f 6473  , k)] = (methods
-00042900: 2e62 6f75 6e64 6172 795f 736c 6963 652c  .boundary_slice,
-00042910: 2028 6e61 6d65 2c20 6920 2d20 3129 2c20   (name, i - 1), 
-00042920: 615b 695d 2c20 615b 695d 2c20 4661 6c73  a[i], a[i], Fals
-00042930: 6529 0a20 2020 2020 2020 2020 2020 206b  e).            k
-00042940: 202b 3d20 310a 2020 2020 2020 2020 632e   += 1.        c.
-00042950: 6170 7065 6e64 2861 5b2d 315d 290a 0a20  append(a[-1]).. 
-00042960: 2020 2023 2072 6570 6c61 6365 206c 6173     # replace las
-00042970: 7420 656c 656d 656e 7420 6f66 2074 7570  t element of tup
-00042980: 6c65 2077 6974 6820 5472 7565 0a20 2020  le with True.   
-00042990: 2064 5b28 6f75 7431 2c20 6b20 2d20 3129   d[(out1, k - 1)
-000429a0: 5d20 3d20 645b 286f 7574 312c 206b 202d  ] = d[(out1, k -
-000429b0: 2031 295d 5b3a 2d31 5d20 2b20 2854 7275   1)][:-1] + (Tru
-000429c0: 652c 290a 0a20 2020 2069 2c20 6a20 3d20  e,)..    i, j = 
-000429d0: 302c 2031 0a0a 2020 2020 6c61 7374 5f65  0, 1..    last_e
-000429e0: 6c65 6d20 3d20 5f69 735f 7369 6e67 6c65  lem = _is_single
-000429f0: 5f6c 6173 745f 6469 7628 6329 0a0a 2020  _last_div(c)..  
-00042a00: 2020 7768 696c 6520 6a20 3c20 6c65 6e28    while j < len(
-00042a10: 6229 3a0a 2020 2020 2020 2020 746d 7020  b):.        tmp 
-00042a20: 3d20 5b5d 0a20 2020 2020 2020 2077 6869  = [].        whi
-00042a30: 6c65 2063 5b69 5d20 3c20 625b 6a5d 3a0a  le c[i] < b[j]:.
-00042a40: 2020 2020 2020 2020 2020 2020 746d 702e              tmp.
-00042a50: 6170 7065 6e64 2828 6f75 7431 2c20 6929  append((out1, i)
-00042a60: 290a 2020 2020 2020 2020 2020 2020 6920  ).            i 
-00042a70: 2b3d 2031 0a20 2020 2020 2020 2077 6869  += 1.        whi
-00042a80: 6c65 2028 0a20 2020 2020 2020 2020 2020  le (.           
-00042a90: 206c 6173 745f 656c 656d 0a20 2020 2020   last_elem.     
-00042aa0: 2020 2020 2020 2061 6e64 2063 5b69 5d20         and c[i] 
-00042ab0: 3d3d 2062 5b2d 315d 0a20 2020 2020 2020  == b[-1].       
-00042ac0: 2020 2020 2061 6e64 2028 625b 2d31 5d20       and (b[-1] 
-00042ad0: 213d 2062 5b2d 325d 206f 7220 6a20 3d3d  != b[-2] or j ==
-00042ae0: 206c 656e 2862 2920 2d20 3129 0a20 2020   len(b) - 1).   
-00042af0: 2020 2020 2020 2020 2061 6e64 2069 203c           and i <
-00042b00: 206b 0a20 2020 2020 2020 2029 3a0a 2020   k.        ):.  
-00042b10: 2020 2020 2020 2020 2020 2320 6170 7065            # appe
-00042b20: 6e64 2069 6620 6c61 7374 2073 706c 6974  nd if last split
-00042b30: 2069 7320 6e6f 7420 696e 636c 7564 6564   is not included
-00042b40: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
-00042b50: 2e61 7070 656e 6428 286f 7574 312c 2069  .append((out1, i
-00042b60: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00042b70: 202b 3d20 310a 2020 2020 2020 2020 6966   += 1.        if
-00042b80: 206c 656e 2874 6d70 2920 3d3d 2030 3a0a   len(tmp) == 0:.
-00042b90: 2020 2020 2020 2020 2020 2020 2320 6475              # du
-00042ba0: 6d6d 7920 736c 6963 6520 746f 2072 6574  mmy slice to ret
-00042bb0: 7572 6e20 656d 7074 7920 4461 7461 4672  urn empty DataFr
-00042bc0: 616d 6520 6f72 2053 6572 6965 732c 0a20  ame or Series,. 
-00042bd0: 2020 2020 2020 2020 2020 2023 2077 6869             # whi
-00042be0: 6368 2072 6574 6169 6e20 6f72 6967 696e  ch retain origin
-00042bf0: 616c 2064 6174 6120 6174 7472 6962 7574  al data attribut
-00042c00: 6573 2028 636f 6c75 6d6e 7320 2f20 6e61  es (columns / na
-00042c10: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00042c20: 645b 286f 7574 322c 206a 202d 2031 295d  d[(out2, j - 1)]
-00042c30: 203d 2028 6d65 7468 6f64 732e 626f 756e   = (methods.boun
-00042c40: 6461 7279 5f73 6c69 6365 2c20 286e 616d  dary_slice, (nam
-00042c50: 652c 2030 292c 2061 5b30 5d2c 2061 5b30  e, 0), a[0], a[0
-00042c60: 5d2c 2046 616c 7365 290a 2020 2020 2020  ], False).      
-00042c70: 2020 656c 6966 206c 656e 2874 6d70 2920    elif len(tmp) 
-00042c80: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-00042c90: 2020 645b 286f 7574 322c 206a 202d 2031    d[(out2, j - 1
-00042ca0: 295d 203d 2074 6d70 5b30 5d0a 2020 2020  )] = tmp[0].    
-00042cb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00042cc0: 2020 2020 2020 6966 206e 6f74 2074 6d70        if not tmp
-00042cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00042ce0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00042cf0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00042d00: 2020 2020 2020 2020 2263 6865 636b 2066          "check f
-00042d10: 6f72 2064 7570 6c69 6361 7465 2070 6172  or duplicate par
-00042d20: 7469 7469 6f6e 735c 6e6f 6c64 3a5c 6e25  titions\nold:\n%
-00042d30: 735c 6e5c 6e22 0a20 2020 2020 2020 2020  s\n\n".         
-00042d40: 2020 2020 2020 2020 2020 2022 6e65 773a             "new:
-00042d50: 5c6e 2573 5c6e 5c6e 636f 6d62 696e 6564  \n%s\n\ncombined
-00042d60: 3a5c 6e25 7322 2025 2028 7066 6f72 6d61  :\n%s" % (pforma
-00042d70: 7428 6129 2c20 7066 6f72 6d61 7428 6229  t(a), pformat(b)
-00042d80: 2c20 7066 6f72 6d61 7428 6329 290a 2020  , pformat(c)).  
-00042d90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00042da0: 2020 2020 2020 2020 2020 2020 645b 286f              d[(o
-00042db0: 7574 322c 206a 202d 2031 295d 203d 2028  ut2, j - 1)] = (
-00042dc0: 6d65 7468 6f64 732e 636f 6e63 6174 2c20  methods.concat, 
-00042dd0: 746d 7029 0a20 2020 2020 2020 206a 202b  tmp).        j +
-00042de0: 3d20 310a 2020 2020 7265 7475 726e 2064  = 1.    return d
-00042df0: 0a0a 0a64 6566 2072 6570 6172 7469 7469  ...def repartiti
-00042e00: 6f6e 5f66 7265 7128 6466 2c20 6672 6571  on_freq(df, freq
-00042e10: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2252  =None):.    """R
-00042e20: 6570 6172 7469 7469 6f6e 2061 2074 696d  epartition a tim
-00042e30: 6573 6572 6965 7320 6461 7461 6672 616d  eseries datafram
-00042e40: 6520 6279 2061 206e 6577 2066 7265 7175  e by a new frequ
-00042e50: 656e 6379 2222 220a 2020 2020 6966 206e  ency""".    if n
-00042e60: 6f74 2069 7369 6e73 7461 6e63 6528 6466  ot isinstance(df
-00042e70: 2e64 6976 6973 696f 6e73 5b30 5d2c 2070  .divisions[0], p
-00042e80: 642e 5469 6d65 7374 616d 7029 3a0a 2020  d.Timestamp):.  
-00042e90: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-00042ea0: 4572 726f 7228 2243 616e 206f 6e6c 7920  Error("Can only 
-00042eb0: 7265 7061 7274 6974 696f 6e20 6f6e 2066  repartition on f
-00042ec0: 7265 7175 656e 6379 2066 6f72 2074 696d  requency for tim
-00042ed0: 6573 6572 6965 7322 290a 0a20 2020 2066  eseries")..    f
-00042ee0: 7265 7120 3d20 5f6d 6170 5f66 7265 715f  req = _map_freq_
-00042ef0: 746f 5f70 6572 696f 645f 7374 6172 7428  to_period_start(
-00042f00: 6672 6571 290a 0a20 2020 2074 7279 3a0a  freq)..    try:.
-00042f10: 2020 2020 2020 2020 7374 6172 7420 3d20          start = 
-00042f20: 6466 2e64 6976 6973 696f 6e73 5b30 5d2e  df.divisions[0].
-00042f30: 6365 696c 2866 7265 7129 0a20 2020 2065  ceil(freq).    e
-00042f40: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00042f50: 3a0a 2020 2020 2020 2020 7374 6172 7420  :.        start 
-00042f60: 3d20 6466 2e64 6976 6973 696f 6e73 5b30  = df.divisions[0
-00042f70: 5d0a 2020 2020 6469 7669 7369 6f6e 7320  ].    divisions 
-00042f80: 3d20 6d65 7468 6f64 732e 746f 6c69 7374  = methods.tolist
-00042f90: 280a 2020 2020 2020 2020 7064 2e64 6174  (.        pd.dat
-00042fa0: 655f 7261 6e67 6528 7374 6172 743d 7374  e_range(start=st
-00042fb0: 6172 742c 2065 6e64 3d64 662e 6469 7669  art, end=df.divi
-00042fc0: 7369 6f6e 735b 2d31 5d2c 2066 7265 713d  sions[-1], freq=
-00042fd0: 6672 6571 290a 2020 2020 290a 2020 2020  freq).    ).    
-00042fe0: 6966 206e 6f74 206c 656e 2864 6976 6973  if not len(divis
-00042ff0: 696f 6e73 293a 0a20 2020 2020 2020 2064  ions):.        d
-00043000: 6976 6973 696f 6e73 203d 205b 6466 2e64  ivisions = [df.d
-00043010: 6976 6973 696f 6e73 5b30 5d2c 2064 662e  ivisions[0], df.
-00043020: 6469 7669 7369 6f6e 735b 2d31 5d5d 0a20  divisions[-1]]. 
-00043030: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00043040: 2064 6976 6973 696f 6e73 2e61 7070 656e   divisions.appen
-00043050: 6428 6466 2e64 6976 6973 696f 6e73 5b2d  d(df.divisions[-
-00043060: 315d 290a 2020 2020 2020 2020 6966 2064  1]).        if d
-00043070: 6976 6973 696f 6e73 5b30 5d20 213d 2064  ivisions[0] != d
-00043080: 662e 6469 7669 7369 6f6e 735b 305d 3a0a  f.divisions[0]:.
-00043090: 2020 2020 2020 2020 2020 2020 6469 7669              divi
-000430a0: 7369 6f6e 7320 3d20 5b64 662e 6469 7669  sions = [df.divi
-000430b0: 7369 6f6e 735b 305d 5d20 2b20 6469 7669  sions[0]] + divi
-000430c0: 7369 6f6e 730a 0a20 2020 2072 6574 7572  sions..    retur
-000430d0: 6e20 6466 2e72 6570 6172 7469 7469 6f6e  n df.repartition
-000430e0: 2864 6976 6973 696f 6e73 3d64 6976 6973  (divisions=divis
-000430f0: 696f 6e73 290a 0a0a 6465 6620 5f6d 6170  ions)...def _map
-00043100: 5f66 7265 715f 746f 5f70 6572 696f 645f  _freq_to_period_
-00043110: 7374 6172 7428 6672 6571 293a 0a20 2020  start(freq):.   
-00043120: 2022 2222 456e 7375 7265 2074 6861 7420   """Ensure that 
-00043130: 7468 6520 6672 6571 7565 6e63 7920 7065  the frequency pe
-00043140: 7274 6169 6e73 2074 6f20 7468 6520 2a2a  rtains to the **
-00043150: 7374 6172 742a 2a20 6f66 2061 2070 6572  start** of a per
-00043160: 696f 642e 0a0a 2020 2020 4966 2065 2e67  iod...    If e.g
-00043170: 2e20 6066 7265 713d 274d 2760 2c20 7468  . `freq='M'`, th
-00043180: 656e 2074 6865 2064 6976 6973 696f 6e73  en the divisions
-00043190: 2061 7265 3a0a 2020 2020 2020 2020 2d20   are:.        - 
-000431a0: 3230 3231 2d33 312d 3120 3030 3a30 303a  2021-31-1 00:00:
-000431b0: 3030 2028 7374 6172 7420 6f66 2046 6562  00 (start of Feb
-000431c0: 7275 6172 7920 7061 7274 6974 696f 6e29  ruary partition)
-000431d0: 0a20 2020 2020 2020 202d 2032 3032 312d  .        - 2021-
-000431e0: 322d 3238 2030 303a 3030 3a30 3020 2873  2-28 00:00:00 (s
-000431f0: 7461 7274 206f 6620 4d61 7263 6820 7061  tart of March pa
-00043200: 7274 6974 696f 6e29 0a20 2020 2020 2020  rtition).       
-00043210: 202d 202e 2e2e 0a0a 2020 2020 6275 7420   - .....    but 
-00043220: 7468 6973 202a 2a73 686f 756c 642a 2a20  this **should** 
-00043230: 6265 3a0a 2020 2020 2020 2020 2d20 3230  be:.        - 20
-00043240: 3231 2d32 2d31 2030 303a 3030 3a30 3020  21-2-1 00:00:00 
-00043250: 2873 7461 7274 206f 6620 4665 6272 7561  (start of Februa
-00043260: 7279 2070 6172 7469 7469 6f6e 290a 2020  ry partition).  
-00043270: 2020 2020 2020 2d20 3230 3231 2d33 2d31        - 2021-3-1
-00043280: 2030 303a 3030 3a30 3020 2873 7461 7274   00:00:00 (start
-00043290: 206f 6620 4d61 7263 6820 7061 7274 6974   of March partit
-000432a0: 696f 6e29 0a20 2020 2020 2020 202d 202e  ion).        - .
-000432b0: 2e2e 0a0a 2020 2020 5468 6572 6566 6f72  ....    Therefor
-000432c0: 652c 2077 6520 6d61 7020 6066 7265 713d  e, we map `freq=
-000432d0: 274d 2760 2074 6f20 6066 7265 713d 274d  'M'` to `freq='M
-000432e0: 5327 6020 2873 616d 6520 666f 7220 7175  S'` (same for qu
-000432f0: 6172 7465 7220 616e 6420 7965 6172 292e  arter and year).
-00043300: 0a20 2020 2022 2222 0a0a 2020 2020 6966  .    """..    if
-00043310: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00043320: 6672 6571 2c20 7374 7229 3a0a 2020 2020  freq, str):.    
-00043330: 2020 2020 7265 7475 726e 2066 7265 710a      return freq.
-00043340: 0a20 2020 206f 6666 7365 7420 3d20 7064  .    offset = pd
-00043350: 2e74 7365 7269 6573 2e66 7265 7175 656e  .tseries.frequen
-00043360: 6369 6573 2e74 6f5f 6f66 6673 6574 2866  cies.to_offset(f
-00043370: 7265 7129 0a20 2020 206f 6666 7365 745f  req).    offset_
-00043380: 7479 7065 5f6e 616d 6520 3d20 7479 7065  type_name = type
-00043390: 286f 6666 7365 7429 2e5f 5f6e 616d 655f  (offset).__name_
-000433a0: 5f0a 0a20 2020 2069 6620 6e6f 7420 6f66  _..    if not of
-000433b0: 6673 6574 5f74 7970 655f 6e61 6d65 2e65  fset_type_name.e
-000433c0: 6e64 7377 6974 6828 2245 6e64 2229 3a0a  ndswith("End"):.
-000433d0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-000433e0: 7265 710a 0a20 2020 206e 6577 5f6f 6666  req..    new_off
-000433f0: 7365 7420 3d20 6f66 6673 6574 5f74 7970  set = offset_typ
-00043400: 655f 6e61 6d65 5b3a 202d 6c65 6e28 2245  e_name[: -len("E
-00043410: 6e64 2229 5d20 2b20 2242 6567 696e 220a  nd")] + "Begin".
-00043420: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00043430: 206e 6577 5f6f 6666 7365 745f 7479 7065   new_offset_type
-00043440: 203d 2067 6574 6174 7472 2870 642e 7473   = getattr(pd.ts
-00043450: 6572 6965 732e 6f66 6673 6574 732c 206e  eries.offsets, n
-00043460: 6577 5f6f 6666 7365 7429 0a20 2020 2020  ew_offset).     
-00043470: 2020 2069 6620 222d 2220 696e 2066 7265     if "-" in fre
-00043480: 713a 0a20 2020 2020 2020 2020 2020 205f  q:.            _
-00043490: 2c20 616e 6368 6f72 203d 2066 7265 712e  , anchor = freq.
-000434a0: 7370 6c69 7428 222d 2229 0a20 2020 2020  split("-").     
-000434b0: 2020 2020 2020 2061 6e63 686f 7220 3d20         anchor = 
-000434c0: 222d 2220 2b20 616e 6368 6f72 0a20 2020  "-" + anchor.   
-000434d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000434e0: 2020 2020 2020 2061 6e63 686f 7220 3d20         anchor = 
-000434f0: 2222 0a20 2020 2020 2020 206e 203d 2073  "".        n = s
-00043500: 7472 286f 6666 7365 742e 6e29 2069 6620  tr(offset.n) if 
-00043510: 6f66 6673 6574 2e6e 2021 3d20 3120 656c  offset.n != 1 el
-00043520: 7365 2022 220a 2020 2020 2020 2020 7265  se "".        re
-00043530: 7475 726e 2066 227b 6e7d 7b6e 6577 5f6f  turn f"{n}{new_o
-00043540: 6666 7365 745f 7479 7065 2e5f 7072 6566  ffset_type._pref
-00043550: 6978 7d7b 616e 6368 6f72 7d22 0a20 2020  ix}{anchor}".   
-00043560: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00043570: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-00043580: 7265 7475 726e 2066 7265 710a 0a0a 6465  return freq...de
-00043590: 6620 7265 7061 7274 6974 696f 6e5f 7369  f repartition_si
-000435a0: 7a65 2864 662c 2073 697a 6529 3a0a 2020  ze(df, size):.  
-000435b0: 2020 2222 220a 2020 2020 5265 7061 7274    """.    Repart
-000435c0: 6974 696f 6e20 6461 7461 6672 616d 6520  ition dataframe 
-000435d0: 736f 2074 6861 7420 6e65 7720 7061 7274  so that new part
-000435e0: 6974 696f 6e73 2068 6176 6520 6170 7072  itions have appr
-000435f0: 6f78 696d 6174 656c 7920 6073 697a 6560  oximately `size`
-00043600: 206d 656d 6f72 7920 7573 6167 6520 6561   memory usage ea
-00043610: 6368 0a20 2020 2022 2222 0a20 2020 2069  ch.    """.    i
-00043620: 6620 6973 696e 7374 616e 6365 2873 697a  f isinstance(siz
-00043630: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
-00043640: 2073 697a 6520 3d20 7061 7273 655f 6279   size = parse_by
-00043650: 7465 7328 7369 7a65 290a 2020 2020 7369  tes(size).    si
-00043660: 7a65 203d 2069 6e74 2873 697a 6529 0a0a  ze = int(size)..
-00043670: 2020 2020 6d65 6d5f 7573 6167 6573 203d      mem_usages =
-00043680: 2064 662e 6d61 705f 7061 7274 6974 696f   df.map_partitio
-00043690: 6e73 2874 6f74 616c 5f6d 656d 5f75 7361  ns(total_mem_usa
-000436a0: 6765 2c20 6465 6570 3d54 7275 6529 2e63  ge, deep=True).c
-000436b0: 6f6d 7075 7465 2829 0a0a 2020 2020 2320  ompute()..    # 
-000436c0: 312e 2073 706c 6974 2065 6163 6820 7061  1. split each pa
-000436d0: 7274 6974 696f 6e20 7468 6174 2069 7320  rtition that is 
-000436e0: 6c61 7267 6572 2074 6861 6e20 7061 7274  larger than part
-000436f0: 6974 696f 6e5f 7369 7a65 0a20 2020 206e  ition_size.    n
-00043700: 7370 6c69 7473 203d 2031 202b 206d 656d  splits = 1 + mem
-00043710: 5f75 7361 6765 7320 2f2f 2073 697a 650a  _usages // size.
-00043720: 2020 2020 6966 206e 702e 616e 7928 6e73      if np.any(ns
-00043730: 706c 6974 7320 3e20 3129 3a0a 2020 2020  plits > 1):.    
-00043740: 2020 2020 7370 6c69 745f 6e61 6d65 203d      split_name =
-00043750: 2066 2272 6570 6172 7469 7469 6f6e 2d73   f"repartition-s
-00043760: 706c 6974 2d7b 7369 7a65 7d2d 7b74 6f6b  plit-{size}-{tok
-00043770: 656e 697a 6528 6466 297d 220a 2020 2020  enize(df)}".    
-00043780: 2020 2020 6466 203d 205f 7370 6c69 745f      df = _split_
-00043790: 7061 7274 6974 696f 6e73 2864 662c 206e  partitions(df, n
-000437a0: 7370 6c69 7473 2c20 7370 6c69 745f 6e61  splits, split_na
-000437b0: 6d65 290a 2020 2020 2020 2020 2320 7570  me).        # up
-000437c0: 6461 7465 206d 656d 5f75 7361 6765 7320  date mem_usages 
-000437d0: 746f 2061 6363 6f75 6e74 2066 6f72 2074  to account for t
-000437e0: 6865 2073 706c 6974 2070 6172 7469 7469  he split partiti
-000437f0: 6f6e 730a 2020 2020 2020 2020 7370 6c69  ons.        spli
-00043800: 745f 6d65 6d5f 7573 6167 6573 203d 205b  t_mem_usages = [
-00043810: 5d0a 2020 2020 2020 2020 666f 7220 6e2c  ].        for n,
-00043820: 2075 7361 6765 2069 6e20 7a69 7028 6e73   usage in zip(ns
-00043830: 706c 6974 732c 206d 656d 5f75 7361 6765  plits, mem_usage
-00043840: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00043850: 7370 6c69 745f 6d65 6d5f 7573 6167 6573  split_mem_usages
-00043860: 2e65 7874 656e 6428 5b75 7361 6765 202f  .extend([usage /
-00043870: 206e 5d20 2a20 6e29 0a20 2020 2020 2020   n] * n).       
-00043880: 206d 656d 5f75 7361 6765 7320 3d20 7064   mem_usages = pd
-00043890: 2e53 6572 6965 7328 7370 6c69 745f 6d65  .Series(split_me
-000438a0: 6d5f 7573 6167 6573 290a 0a20 2020 2023  m_usages)..    #
-000438b0: 2032 2e20 6e6f 7720 7468 6174 2061 6c6c   2. now that all
-000438c0: 2070 6172 7469 7469 6f6e 7320 6172 6520   partitions are 
-000438d0: 6c65 7373 2074 6861 6e20 7369 7a65 2c20  less than size, 
-000438e0: 636f 6e63 6174 2074 6865 6d20 7570 2074  concat them up t
-000438f0: 6f20 7369 7a65 0a20 2020 2061 7373 6572  o size.    asser
-00043900: 7420 6e70 2e61 6c6c 286d 656d 5f75 7361  t np.all(mem_usa
-00043910: 6765 7320 3c3d 2073 697a 6529 0a20 2020  ges <= size).   
-00043920: 206e 6577 5f6e 7061 7274 6974 696f 6e73   new_npartitions
-00043930: 203d 206c 6973 7428 6d61 7028 6c65 6e2c   = list(map(len,
-00043940: 2069 7465 725f 6368 756e 6b73 286d 656d   iter_chunks(mem
-00043950: 5f75 7361 6765 732c 2073 697a 6529 2929  _usages, size)))
-00043960: 0a20 2020 206e 6577 5f70 6172 7469 7469  .    new_partiti
-00043970: 6f6e 735f 626f 756e 6461 7269 6573 203d  ons_boundaries =
-00043980: 206e 702e 6375 6d73 756d 286e 6577 5f6e   np.cumsum(new_n
-00043990: 7061 7274 6974 696f 6e73 290a 2020 2020  partitions).    
-000439a0: 6e65 775f 6e61 6d65 203d 2066 2272 6570  new_name = f"rep
-000439b0: 6172 7469 7469 6f6e 2d7b 7369 7a65 7d2d  artition-{size}-
-000439c0: 7b74 6f6b 656e 697a 6528 6466 297d 220a  {tokenize(df)}".
-000439d0: 2020 2020 7265 7475 726e 205f 7265 7061      return _repa
-000439e0: 7274 6974 696f 6e5f 6672 6f6d 5f62 6f75  rtition_from_bou
-000439f0: 6e64 6172 6965 7328 6466 2c20 6e65 775f  ndaries(df, new_
-00043a00: 7061 7274 6974 696f 6e73 5f62 6f75 6e64  partitions_bound
-00043a10: 6172 6965 732c 206e 6577 5f6e 616d 6529  aries, new_name)
-00043a20: 0a0a 0a64 6566 2074 6f74 616c 5f6d 656d  ...def total_mem
-00043a30: 5f75 7361 6765 2864 662c 2069 6e64 6578  _usage(df, index
-00043a40: 3d54 7275 652c 2064 6565 703d 4661 6c73  =True, deep=Fals
-00043a50: 6529 3a0a 2020 2020 6d65 6d5f 7573 6167  e):.    mem_usag
-00043a60: 6520 3d20 6466 2e6d 656d 6f72 795f 7573  e = df.memory_us
-00043a70: 6167 6528 696e 6465 783d 696e 6465 782c  age(index=index,
-00043a80: 2064 6565 703d 6465 6570 290a 2020 2020   deep=deep).    
-00043a90: 6966 2069 735f 7365 7269 6573 5f6c 696b  if is_series_lik
-00043aa0: 6528 6d65 6d5f 7573 6167 6529 3a0a 2020  e(mem_usage):.  
-00043ab0: 2020 2020 2020 6d65 6d5f 7573 6167 6520        mem_usage 
-00043ac0: 3d20 6d65 6d5f 7573 6167 652e 7375 6d28  = mem_usage.sum(
-00043ad0: 290a 2020 2020 7265 7475 726e 206d 656d  ).    return mem
-00043ae0: 5f75 7361 6765 0a0a 0a64 6566 2072 6570  _usage...def rep
-00043af0: 6172 7469 7469 6f6e 5f6e 7061 7274 6974  artition_npartit
-00043b00: 696f 6e73 2864 662c 206e 7061 7274 6974  ions(df, npartit
-00043b10: 696f 6e73 293a 0a20 2020 2022 2222 5265  ions):.    """Re
-00043b20: 7061 7274 6974 696f 6e20 6461 7461 6672  partition datafr
-00043b30: 616d 6520 746f 2061 2073 6d61 6c6c 6572  ame to a smaller
-00043b40: 206e 756d 6265 7220 6f66 2070 6172 7469   number of parti
-00043b50: 7469 6f6e 7322 2222 0a20 2020 206e 6577  tions""".    new
-00043b60: 5f6e 616d 6520 3d20 2272 6570 6172 7469  _name = "reparti
-00043b70: 7469 6f6e 2d25 642d 2573 2220 2520 286e  tion-%d-%s" % (n
-00043b80: 7061 7274 6974 696f 6e73 2c20 746f 6b65  partitions, toke
-00043b90: 6e69 7a65 2864 6629 290a 2020 2020 6966  nize(df)).    if
-00043ba0: 2064 662e 6e70 6172 7469 7469 6f6e 7320   df.npartitions 
-00043bb0: 3d3d 206e 7061 7274 6974 696f 6e73 3a0a  == npartitions:.
-00043bc0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00043bd0: 660a 2020 2020 656c 6966 2064 662e 6e70  f.    elif df.np
-00043be0: 6172 7469 7469 6f6e 7320 3e20 6e70 6172  artitions > npar
-00043bf0: 7469 7469 6f6e 733a 0a20 2020 2020 2020  titions:.       
-00043c00: 206e 7061 7274 6974 696f 6e73 5f72 6174   npartitions_rat
-00043c10: 696f 203d 2064 662e 6e70 6172 7469 7469  io = df.npartiti
-00043c20: 6f6e 7320 2f20 6e70 6172 7469 7469 6f6e  ons / npartition
-00043c30: 730a 2020 2020 2020 2020 6e65 775f 7061  s.        new_pa
-00043c40: 7274 6974 696f 6e73 5f62 6f75 6e64 6172  rtitions_boundar
-00043c50: 6965 7320 3d20 5b0a 2020 2020 2020 2020  ies = [.        
-00043c60: 2020 2020 696e 7428 6e65 775f 7061 7274      int(new_part
-00043c70: 6974 696f 6e5f 696e 6465 7820 2a20 6e70  ition_index * np
-00043c80: 6172 7469 7469 6f6e 735f 7261 7469 6f29  artitions_ratio)
-00043c90: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00043ca0: 206e 6577 5f70 6172 7469 7469 6f6e 5f69   new_partition_i
-00043cb0: 6e64 6578 2069 6e20 7261 6e67 6528 6e70  ndex in range(np
-00043cc0: 6172 7469 7469 6f6e 7320 2b20 3129 0a20  artitions + 1). 
-00043cd0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00043ce0: 2072 6574 7572 6e20 5f72 6570 6172 7469   return _reparti
-00043cf0: 7469 6f6e 5f66 726f 6d5f 626f 756e 6461  tion_from_bounda
-00043d00: 7269 6573 2864 662c 206e 6577 5f70 6172  ries(df, new_par
-00043d10: 7469 7469 6f6e 735f 626f 756e 6461 7269  titions_boundari
-00043d20: 6573 2c20 6e65 775f 6e61 6d65 290a 2020  es, new_name).  
-00043d30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00043d40: 2320 4472 6f70 2064 7570 6c63 6174 6573  # Drop duplcates
-00043d50: 2069 6e20 6361 7365 206c 6173 7420 7061   in case last pa
-00043d60: 7274 6974 696f 6e20 6861 7320 7361 6d65  rtition has same
-00043d70: 0a20 2020 2020 2020 2023 2076 616c 7565  .        # value
-00043d80: 2066 6f72 206d 696e 2061 6e64 206d 6178   for min and max
-00043d90: 2064 6976 6973 696f 6e0a 2020 2020 2020   division.      
-00043da0: 2020 6f72 6967 696e 616c 5f64 6976 6973    original_divis
-00043db0: 696f 6e73 203d 2064 6976 6973 696f 6e73  ions = divisions
-00043dc0: 203d 2070 642e 5365 7269 6573 2864 662e   = pd.Series(df.
-00043dd0: 6469 7669 7369 6f6e 7329 2e64 726f 705f  divisions).drop_
-00043de0: 6475 706c 6963 6174 6573 2829 0a20 2020  duplicates().   
-00043df0: 2020 2020 2069 6620 6466 2e6b 6e6f 776e       if df.known
-00043e00: 5f64 6976 6973 696f 6e73 2061 6e64 2028  _divisions and (
-00043e10: 0a20 2020 2020 2020 2020 2020 2069 735f  .            is_
-00043e20: 6461 7465 7469 6d65 3634 5f61 6e79 5f64  datetime64_any_d
-00043e30: 7479 7065 2864 6976 6973 696f 6e73 2e64  type(divisions.d
-00043e40: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-00043e50: 2020 6f72 2069 735f 6e75 6d65 7269 635f    or is_numeric_
-00043e60: 6474 7970 6528 6469 7669 7369 6f6e 732e  dtype(divisions.
-00043e70: 6474 7970 6529 0a20 2020 2020 2020 2029  dtype).        )
-00043e80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00043e90: 2069 735f 6461 7465 7469 6d65 3634 5f61   is_datetime64_a
-00043ea0: 6e79 5f64 7479 7065 2864 6976 6973 696f  ny_dtype(divisio
-00043eb0: 6e73 2e64 7479 7065 293a 0a20 2020 2020  ns.dtype):.     
-00043ec0: 2020 2020 2020 2020 2020 2064 6976 6973             divis
-00043ed0: 696f 6e73 203d 2064 6976 6973 696f 6e73  ions = divisions
-00043ee0: 2e76 616c 7565 732e 6173 7479 7065 2822  .values.astype("
-00043ef0: 666c 6f61 7436 3422 290a 0a20 2020 2020  float64")..     
-00043f00: 2020 2020 2020 2069 6620 6973 5f73 6572         if is_ser
-00043f10: 6965 735f 6c69 6b65 2864 6976 6973 696f  ies_like(divisio
-00043f20: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
-00043f30: 2020 2020 2064 6976 6973 696f 6e73 203d       divisions =
-00043f40: 2064 6976 6973 696f 6e73 2e76 616c 7565   divisions.value
-00043f50: 730a 0a20 2020 2020 2020 2020 2020 206e  s..            n
-00043f60: 203d 206c 656e 2864 6976 6973 696f 6e73   = len(divisions
-00043f70: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-00043f80: 7669 7369 6f6e 7320 3d20 6e70 2e69 6e74  visions = np.int
-00043f90: 6572 7028 0a20 2020 2020 2020 2020 2020  erp(.           
-00043fa0: 2020 2020 2078 3d6e 702e 6c69 6e73 7061       x=np.linspa
-00043fb0: 6365 2830 2c20 6e2c 206e 7061 7274 6974  ce(0, n, npartit
-00043fc0: 696f 6e73 202b 2031 292c 0a20 2020 2020  ions + 1),.     
-00043fd0: 2020 2020 2020 2020 2020 2078 703d 6e70             xp=np
-00043fe0: 2e6c 696e 7370 6163 6528 302c 206e 2c20  .linspace(0, n, 
-00043ff0: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
-00044000: 2020 2020 6670 3d64 6976 6973 696f 6e73      fp=divisions
-00044010: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00044020: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00044030: 735f 6461 7465 7469 6d65 3634 5f61 6e79  s_datetime64_any
-00044040: 5f64 7479 7065 286f 7269 6769 6e61 6c5f  _dtype(original_
-00044050: 6469 7669 7369 6f6e 732e 6474 7970 6529  divisions.dtype)
-00044060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00044070: 2020 6469 7669 7369 6f6e 7320 3d20 6d65    divisions = me
-00044080: 7468 6f64 732e 746f 6c69 7374 280a 2020  thods.tolist(.  
-00044090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000440a0: 2020 7064 2e53 6572 6965 7328 6469 7669    pd.Series(divi
-000440b0: 7369 6f6e 7329 2e61 7374 7970 6528 6f72  sions).astype(or
-000440c0: 6967 696e 616c 5f64 6976 6973 696f 6e73  iginal_divisions
-000440d0: 2e64 7479 7065 290a 2020 2020 2020 2020  .dtype).        
-000440e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000440f0: 2020 2020 2020 656c 6966 206e 702e 6973        elif np.is
-00044100: 7375 6264 7479 7065 286f 7269 6769 6e61  subdtype(origina
-00044110: 6c5f 6469 7669 7369 6f6e 732e 6474 7970  l_divisions.dtyp
-00044120: 652c 206e 702e 696e 7465 6765 7229 3a0a  e, np.integer):.
-00044130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044140: 6469 7669 7369 6f6e 7320 3d20 6469 7669  divisions = divi
-00044150: 7369 6f6e 732e 6173 7479 7065 286f 7269  sions.astype(ori
-00044160: 6769 6e61 6c5f 6469 7669 7369 6f6e 732e  ginal_divisions.
-00044170: 6474 7970 6529 0a0a 2020 2020 2020 2020  dtype)..        
-00044180: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00044190: 6528 6469 7669 7369 6f6e 732c 206e 702e  e(divisions, np.
-000441a0: 6e64 6172 7261 7929 3a0a 2020 2020 2020  ndarray):.      
-000441b0: 2020 2020 2020 2020 2020 6469 7669 7369            divisi
-000441c0: 6f6e 7320 3d20 6469 7669 7369 6f6e 732e  ons = divisions.
-000441d0: 746f 6c69 7374 2829 0a0a 2020 2020 2020  tolist()..      
-000441e0: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
-000441f0: 3d20 6c69 7374 2864 6976 6973 696f 6e73  = list(divisions
-00044200: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-00044210: 7669 7369 6f6e 735b 305d 203d 2064 662e  visions[0] = df.
-00044220: 6469 7669 7369 6f6e 735b 305d 0a20 2020  divisions[0].   
-00044230: 2020 2020 2020 2020 2064 6976 6973 696f           divisio
-00044240: 6e73 5b2d 315d 203d 2064 662e 6469 7669  ns[-1] = df.divi
-00044250: 7369 6f6e 735b 2d31 5d0a 0a20 2020 2020  sions[-1]..     
-00044260: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
-00044270: 7468 6520 636f 6d70 7574 6564 2064 6976  the computed div
-00044280: 6973 696f 6e73 2061 7265 2075 6e69 7175  isions are uniqu
-00044290: 650a 2020 2020 2020 2020 2020 2020 6469  e.            di
-000442a0: 7669 7369 6f6e 7320 3d20 6c69 7374 2875  visions = list(u
-000442b0: 6e69 7175 6528 6469 7669 7369 6f6e 735b  nique(divisions[
-000442c0: 3a2d 315d 2929 202b 205b 6469 7669 7369  :-1])) + [divisi
-000442d0: 6f6e 735b 2d31 5d5d 0a20 2020 2020 2020  ons[-1]].       
-000442e0: 2020 2020 2072 6574 7572 6e20 6466 2e72       return df.r
-000442f0: 6570 6172 7469 7469 6f6e 2864 6976 6973  epartition(divis
-00044300: 696f 6e73 3d64 6976 6973 696f 6e73 290a  ions=divisions).
-00044310: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00044320: 2020 2020 2020 2020 2020 6469 762c 206d            div, m
-00044330: 6f64 203d 2064 6976 6d6f 6428 6e70 6172  od = divmod(npar
-00044340: 7469 7469 6f6e 732c 2064 662e 6e70 6172  titions, df.npar
-00044350: 7469 7469 6f6e 7329 0a20 2020 2020 2020  titions).       
-00044360: 2020 2020 206e 7370 6c69 7473 203d 205b       nsplits = [
-00044370: 6469 765d 202a 2064 662e 6e70 6172 7469  div] * df.nparti
-00044380: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
-00044390: 2020 6e73 706c 6974 735b 2d31 5d20 2b3d    nsplits[-1] +=
-000443a0: 206d 6f64 0a20 2020 2020 2020 2020 2020   mod.           
-000443b0: 2072 6574 7572 6e20 5f73 706c 6974 5f70   return _split_p
-000443c0: 6172 7469 7469 6f6e 7328 6466 2c20 6e73  artitions(df, ns
-000443d0: 706c 6974 732c 206e 6577 5f6e 616d 6529  plits, new_name)
-000443e0: 0a0a 0a64 6566 205f 7265 7061 7274 6974  ...def _repartit
-000443f0: 696f 6e5f 6672 6f6d 5f62 6f75 6e64 6172  ion_from_boundar
-00044400: 6965 7328 6466 2c20 6e65 775f 7061 7274  ies(df, new_part
-00044410: 6974 696f 6e73 5f62 6f75 6e64 6172 6965  itions_boundarie
-00044420: 732c 206e 6577 5f6e 616d 6529 3a0a 2020  s, new_name):.  
-00044430: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00044440: 6e63 6528 6e65 775f 7061 7274 6974 696f  nce(new_partitio
-00044450: 6e73 5f62 6f75 6e64 6172 6965 732c 206c  ns_boundaries, l
-00044460: 6973 7429 3a0a 2020 2020 2020 2020 6e65  ist):.        ne
-00044470: 775f 7061 7274 6974 696f 6e73 5f62 6f75  w_partitions_bou
-00044480: 6e64 6172 6965 7320 3d20 6c69 7374 286e  ndaries = list(n
-00044490: 6577 5f70 6172 7469 7469 6f6e 735f 626f  ew_partitions_bo
-000444a0: 756e 6461 7269 6573 290a 2020 2020 6966  undaries).    if
-000444b0: 206e 6577 5f70 6172 7469 7469 6f6e 735f   new_partitions_
-000444c0: 626f 756e 6461 7269 6573 5b30 5d20 3e20  boundaries[0] > 
-000444d0: 303a 0a20 2020 2020 2020 206e 6577 5f70  0:.        new_p
-000444e0: 6172 7469 7469 6f6e 735f 626f 756e 6461  artitions_bounda
-000444f0: 7269 6573 2e69 6e73 6572 7428 302c 2030  ries.insert(0, 0
-00044500: 290a 2020 2020 6966 206e 6577 5f70 6172  ).    if new_par
-00044510: 7469 7469 6f6e 735f 626f 756e 6461 7269  titions_boundari
-00044520: 6573 5b2d 315d 203c 2064 662e 6e70 6172  es[-1] < df.npar
-00044530: 7469 7469 6f6e 733a 0a20 2020 2020 2020  titions:.       
-00044540: 206e 6577 5f70 6172 7469 7469 6f6e 735f   new_partitions_
-00044550: 626f 756e 6461 7269 6573 2e61 7070 656e  boundaries.appen
-00044560: 6428 6466 2e6e 7061 7274 6974 696f 6e73  d(df.npartitions
-00044570: 290a 2020 2020 6473 6b20 3d20 7b7d 0a20  ).    dsk = {}. 
-00044580: 2020 2066 6f72 2069 2c20 2873 7461 7274     for i, (start
-00044590: 2c20 656e 6429 2069 6e20 656e 756d 6572  , end) in enumer
-000445a0: 6174 6528 0a20 2020 2020 2020 207a 6970  ate(.        zip
-000445b0: 286e 6577 5f70 6172 7469 7469 6f6e 735f  (new_partitions_
-000445c0: 626f 756e 6461 7269 6573 2c20 6e65 775f  boundaries, new_
-000445d0: 7061 7274 6974 696f 6e73 5f62 6f75 6e64  partitions_bound
-000445e0: 6172 6965 735b 313a 5d29 0a20 2020 2029  aries[1:]).    )
-000445f0: 3a0a 2020 2020 2020 2020 6473 6b5b 6e65  :.        dsk[ne
-00044600: 775f 6e61 6d65 2c20 695d 203d 2028 6d65  w_name, i] = (me
-00044610: 7468 6f64 732e 636f 6e63 6174 2c20 5b28  thods.concat, [(
-00044620: 6466 2e5f 6e61 6d65 2c20 6a29 2066 6f72  df._name, j) for
-00044630: 206a 2069 6e20 7261 6e67 6528 7374 6172   j in range(star
-00044640: 742c 2065 6e64 295d 290a 2020 2020 6469  t, end)]).    di
-00044650: 7669 7369 6f6e 7320 3d20 5b64 662e 6469  visions = [df.di
-00044660: 7669 7369 6f6e 735b 695d 2066 6f72 2069  visions[i] for i
-00044670: 2069 6e20 6e65 775f 7061 7274 6974 696f   in new_partitio
-00044680: 6e73 5f62 6f75 6e64 6172 6965 735d 0a20  ns_boundaries]. 
-00044690: 2020 2067 7261 7068 203d 2048 6967 684c     graph = HighL
-000446a0: 6576 656c 4772 6170 682e 6672 6f6d 5f63  evelGraph.from_c
-000446b0: 6f6c 6c65 6374 696f 6e73 286e 6577 5f6e  ollections(new_n
-000446c0: 616d 652c 2064 736b 2c20 6465 7065 6e64  ame, dsk, depend
-000446d0: 656e 6369 6573 3d5b 6466 5d29 0a20 2020  encies=[df]).   
-000446e0: 2072 6574 7572 6e20 6e65 775f 6464 5f6f   return new_dd_o
-000446f0: 626a 6563 7428 6772 6170 682c 206e 6577  bject(graph, new
-00044700: 5f6e 616d 652c 2064 662e 5f6d 6574 612c  _name, df._meta,
-00044710: 2064 6976 6973 696f 6e73 290a 0a0a 6465   divisions)...de
-00044720: 6620 5f73 706c 6974 5f70 6172 7469 7469  f _split_partiti
-00044730: 6f6e 7328 6466 2c20 6e73 706c 6974 732c  ons(df, nsplits,
-00044740: 206e 6577 5f6e 616d 6529 3a0a 2020 2020   new_name):.    
-00044750: 2222 2253 706c 6974 2061 2044 6173 6b20  """Split a Dask 
-00044760: 6461 7461 6672 616d 6520 696e 746f 206e  dataframe into n
-00044770: 6577 2070 6172 7469 7469 6f6e 730a 0a20  ew partitions.. 
-00044780: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00044790: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000447a0: 2064 663a 2044 6174 6146 7261 6d65 206f   df: DataFrame o
-000447b0: 7220 5365 7269 6573 0a20 2020 206e 7370  r Series.    nsp
-000447c0: 6c69 7473 3a20 4c69 7374 5b69 6e74 5d0a  lits: List[int].
-000447d0: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
-000447e0: 6620 7461 7267 6574 2064 6174 6166 7261  f target datafra
-000447f0: 6d65 7320 666f 7220 6561 6368 2070 6172  mes for each par
-00044800: 7469 7469 6f6e 0a20 2020 2020 2020 2054  tition.        T
-00044810: 6865 206c 656e 6774 6820 6f66 206e 7370  he length of nsp
-00044820: 6c69 7473 2073 686f 756c 6420 6265 2074  lits should be t
-00044830: 6865 2073 616d 6520 6173 2064 662e 6e70  he same as df.np
-00044840: 6172 7469 7469 6f6e 730a 2020 2020 6e65  artitions.    ne
-00044850: 775f 6e61 6d65 3a20 7374 720a 0a20 2020  w_name: str..   
-00044860: 2053 6565 2041 6c73 6f0a 2020 2020 2d2d   See Also.    --
-00044870: 2d2d 2d2d 2d2d 0a20 2020 2072 6570 6172  ------.    repar
-00044880: 7469 7469 6f6e 5f6e 7061 7274 6974 696f  tition_npartitio
-00044890: 6e73 0a20 2020 2072 6570 6172 7469 7469  ns.    repartiti
-000448a0: 6f6e 5f73 697a 650a 2020 2020 2222 220a  on_size.    """.
-000448b0: 2020 2020 6966 206c 656e 286e 7370 6c69      if len(nspli
-000448c0: 7473 2920 213d 2064 662e 6e70 6172 7469  ts) != df.nparti
-000448d0: 7469 6f6e 733a 0a20 2020 2020 2020 2072  tions:.        r
-000448e0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000448f0: 6622 6e73 706c 6974 7320 7368 6f75 6c64  f"nsplits should
-00044900: 2068 6176 6520 6c65 6e3d 7b64 662e 6e70   have len={df.np
-00044910: 6172 7469 7469 6f6e 737d 2229 0a0a 2020  artitions}")..  
-00044920: 2020 6473 6b20 3d20 7b7d 0a20 2020 2073    dsk = {}.    s
-00044930: 706c 6974 5f6e 616d 6520 3d20 6622 7370  plit_name = f"sp
-00044940: 6c69 742d 7b74 6f6b 656e 697a 6528 6466  lit-{tokenize(df
-00044950: 2c20 6e73 706c 6974 7329 7d22 0a20 2020  , nsplits)}".   
-00044960: 206a 203d 2030 0a20 2020 2066 6f72 2069   j = 0.    for i
-00044970: 2c20 6b20 696e 2065 6e75 6d65 7261 7465  , k in enumerate
-00044980: 286e 7370 6c69 7473 293a 0a20 2020 2020  (nsplits):.     
-00044990: 2020 2069 6620 6b20 3d3d 2031 3a0a 2020     if k == 1:.  
-000449a0: 2020 2020 2020 2020 2020 6473 6b5b 6e65            dsk[ne
-000449b0: 775f 6e61 6d65 2c20 6a5d 203d 2028 6466  w_name, j] = (df
-000449c0: 2e5f 6e61 6d65 2c20 6929 0a20 2020 2020  ._name, i).     
-000449d0: 2020 2020 2020 206a 202b 3d20 310a 2020         j += 1.  
-000449e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000449f0: 2020 2020 2020 2020 6473 6b5b 7370 6c69          dsk[spli
-00044a00: 745f 6e61 6d65 2c20 695d 203d 2028 7370  t_name, i] = (sp
-00044a10: 6c69 745f 6576 656e 6c79 2c20 2864 662e  lit_evenly, (df.
-00044a20: 5f6e 616d 652c 2069 292c 206b 290a 2020  _name, i), k).  
-00044a30: 2020 2020 2020 2020 2020 666f 7220 6a6a            for jj
-00044a40: 2069 6e20 7261 6e67 6528 6b29 3a0a 2020   in range(k):.  
-00044a50: 2020 2020 2020 2020 2020 2020 2020 6473                ds
-00044a60: 6b5b 6e65 775f 6e61 6d65 2c20 6a5d 203d  k[new_name, j] =
-00044a70: 2028 6765 7469 7465 6d2c 2028 7370 6c69   (getitem, (spli
-00044a80: 745f 6e61 6d65 2c20 6929 2c20 6a6a 290a  t_name, i), jj).
-00044a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044aa0: 6a20 2b3d 2031 0a0a 2020 2020 6469 7669  j += 1..    divi
-00044ab0: 7369 6f6e 7320 3d20 5b4e 6f6e 655d 202a  sions = [None] *
-00044ac0: 2028 3120 2b20 7375 6d28 6e73 706c 6974   (1 + sum(nsplit
-00044ad0: 7329 290a 2020 2020 6772 6170 6820 3d20  s)).    graph = 
-00044ae0: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
-00044af0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
-00044b00: 6e65 775f 6e61 6d65 2c20 6473 6b2c 2064  new_name, dsk, d
-00044b10: 6570 656e 6465 6e63 6965 733d 5b64 665d  ependencies=[df]
-00044b20: 290a 2020 2020 7265 7475 726e 206e 6577  ).    return new
-00044b30: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
-00044b40: 2c20 6e65 775f 6e61 6d65 2c20 6466 2e5f  , new_name, df._
-00044b50: 6d65 7461 2c20 6469 7669 7369 6f6e 7329  meta, divisions)
-00044b60: 0a0a 0a64 6566 2072 6570 6172 7469 7469  ...def repartiti
-00044b70: 6f6e 2864 662c 2064 6976 6973 696f 6e73  on(df, divisions
-00044b80: 3d4e 6f6e 652c 2066 6f72 6365 3d46 616c  =None, force=Fal
-00044b90: 7365 293a 0a20 2020 2022 2222 5265 7061  se):.    """Repa
-00044ba0: 7274 6974 696f 6e20 6461 7461 6672 616d  rtition datafram
-00044bb0: 6520 616c 6f6e 6720 6e65 7720 6469 7669  e along new divi
-00044bc0: 7369 6f6e 730a 0a20 2020 2044 6173 6b2e  sions..    Dask.
-00044bd0: 4461 7461 4672 616d 6520 6f62 6a65 6374  DataFrame object
-00044be0: 7320 6172 6520 7061 7274 6974 696f 6e65  s are partitione
-00044bf0: 6420 616c 6f6e 6720 7468 6569 7220 696e  d along their in
-00044c00: 6465 782e 2020 4f66 7465 6e20 7768 656e  dex.  Often when
-00044c10: 0a20 2020 206d 756c 7469 706c 6520 6461  .    multiple da
-00044c20: 7461 6672 616d 6573 2069 6e74 6572 6163  taframes interac
-00044c30: 7420 7765 206e 6565 6420 746f 2061 6c69  t we need to ali
-00044c40: 676e 2074 6865 7365 2070 6172 7469 7469  gn these partiti
-00044c50: 6f6e 696e 6773 2e20 2054 6865 0a20 2020  onings.  The.   
-00044c60: 2060 6072 6570 6172 7469 7469 6f6e 6060   ``repartition``
-00044c70: 2066 756e 6374 696f 6e20 636f 6e73 7472   function constr
-00044c80: 7563 7473 2061 206e 6577 2044 6174 6146  ucts a new DataF
-00044c90: 7261 6d65 206f 626a 6563 7420 686f 6c64  rame object hold
-00044ca0: 696e 6720 7468 6520 7361 6d65 0a20 2020  ing the same.   
-00044cb0: 2064 6174 6120 6275 7420 7061 7274 6974   data but partit
-00044cc0: 696f 6e65 6420 6f6e 2064 6966 6665 7265  ioned on differe
-00044cd0: 6e74 2076 616c 7565 732e 2020 4974 2064  nt values.  It d
-00044ce0: 6f65 7320 7468 6973 2062 7920 7065 7266  oes this by perf
-00044cf0: 6f72 6d69 6e67 2061 0a20 2020 2073 6571  orming a.    seq
-00044d00: 7565 6e63 6520 6f66 2060 606c 6f63 6060  uence of ``loc``
-00044d10: 2061 6e64 2060 6063 6f6e 6361 7460 6020   and ``concat`` 
-00044d20: 6361 6c6c 7320 746f 2073 706c 6974 2061  calls to split a
-00044d30: 6e64 206d 6572 6765 2074 6865 2070 7265  nd merge the pre
-00044d40: 7669 6f75 730a 2020 2020 6765 6e65 7261  vious.    genera
-00044d50: 7469 6f6e 206f 6620 7061 7274 6974 696f  tion of partitio
-00044d60: 6e73 2e0a 0a20 2020 2050 6172 616d 6574  ns...    Paramet
-00044d70: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00044d80: 2d2d 0a0a 2020 2020 6469 7669 7369 6f6e  --..    division
-00044d90: 7320 3a20 6c69 7374 0a20 2020 2020 2020  s : list.       
-00044da0: 204c 6973 7420 6f66 2070 6172 7469 7469   List of partiti
-00044db0: 6f6e 7320 746f 2062 6520 7573 6564 0a20  ons to be used. 
-00044dc0: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
-00044dd0: 2064 6566 6175 6c74 2046 616c 7365 0a20   default False. 
-00044de0: 2020 2020 2020 2041 6c6c 6f77 7320 7468         Allows th
-00044df0: 6520 6578 7061 6e73 696f 6e20 6f66 2074  e expansion of t
-00044e00: 6865 2065 7869 7374 696e 6720 6469 7669  he existing divi
-00044e10: 7369 6f6e 732e 0a20 2020 2020 2020 2049  sions..        I
-00044e20: 6620 4661 6c73 6520 7468 656e 2074 6865  f False then the
-00044e30: 206e 6577 2064 6976 6973 696f 6e73 206c   new divisions l
-00044e40: 6f77 6572 2061 6e64 2075 7070 6572 2062  ower and upper b
-00044e50: 6f75 6e64 7320 6d75 7374 2062 650a 2020  ounds must be.  
-00044e60: 2020 2020 2020 7468 6520 7361 6d65 2061        the same a
-00044e70: 7320 7468 6520 6f6c 6420 6469 7669 7369  s the old divisi
-00044e80: 6f6e 732e 0a0a 2020 2020 4578 616d 706c  ons...    Exampl
-00044e90: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-00044ea0: 0a20 2020 203e 3e3e 2064 6620 3d20 6466  .    >>> df = df
-00044eb0: 2e72 6570 6172 7469 7469 6f6e 285b 302c  .repartition([0,
-00044ec0: 2035 2c20 3130 2c20 3230 5d29 2020 2320   5, 10, 20])  # 
-00044ed0: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
-00044ee0: 2020 2020 416c 736f 2077 6f72 6b73 206f      Also works o
-00044ef0: 6e20 5061 6e64 6173 206f 626a 6563 7473  n Pandas objects
-00044f00: 0a0a 2020 2020 3e3e 3e20 6464 6620 3d20  ..    >>> ddf = 
-00044f10: 6464 2e72 6570 6172 7469 7469 6f6e 2864  dd.repartition(d
-00044f20: 662c 205b 302c 2035 2c20 3130 2c20 3230  f, [0, 5, 10, 20
-00044f30: 5d29 2020 2320 646f 6374 6573 743a 202b  ])  # doctest: +
-00044f40: 534b 4950 0a20 2020 2022 2222 0a0a 2020  SKIP.    """..  
-00044f50: 2020 2320 6e6f 2d6f 7020 6661 7374 7061    # no-op fastpa
-00044f60: 7468 2066 6f72 2077 6865 6e20 7765 2061  th for when we a
-00044f70: 6c72 6561 6479 2068 6176 6520 6d61 7463  lready have matc
-00044f80: 6869 6e67 2064 6976 6973 696f 6e73 0a20  hing divisions. 
-00044f90: 2020 2069 6620 6973 5f64 6173 6b5f 636f     if is_dask_co
-00044fa0: 6c6c 6563 7469 6f6e 2864 6629 2061 6e64  llection(df) and
-00044fb0: 2064 662e 6469 7669 7369 6f6e 7320 3d3d   df.divisions ==
-00044fc0: 2064 6976 6973 696f 6e73 3a0a 2020 2020   divisions:.    
-00044fd0: 2020 2020 7265 7475 726e 2064 660a 0a20      return df.. 
-00044fe0: 2020 2074 6f6b 656e 203d 2074 6f6b 656e     token = token
-00044ff0: 697a 6528 6466 2c20 6469 7669 7369 6f6e  ize(df, division
-00045000: 7329 0a20 2020 2069 6620 6973 696e 7374  s).    if isinst
-00045010: 616e 6365 2864 662c 205f 4672 616d 6529  ance(df, _Frame)
-00045020: 3a0a 2020 2020 2020 2020 746d 7020 3d20  :.        tmp = 
-00045030: 2272 6570 6172 7469 7469 6f6e 2d73 706c  "repartition-spl
-00045040: 6974 2d22 202b 2074 6f6b 656e 0a20 2020  it-" + token.   
-00045050: 2020 2020 206f 7574 203d 2022 7265 7061       out = "repa
-00045060: 7274 6974 696f 6e2d 6d65 7267 652d 2220  rtition-merge-" 
-00045070: 2b20 746f 6b65 6e0a 2020 2020 2020 2020  + token.        
-00045080: 6473 6b20 3d20 7265 7061 7274 6974 696f  dsk = repartitio
-00045090: 6e5f 6469 7669 7369 6f6e 7328 0a20 2020  n_divisions(.   
-000450a0: 2020 2020 2020 2020 2064 662e 6469 7669           df.divi
-000450b0: 7369 6f6e 732c 2064 6976 6973 696f 6e73  sions, divisions
-000450c0: 2c20 6466 2e5f 6e61 6d65 2c20 746d 702c  , df._name, tmp,
-000450d0: 206f 7574 2c20 666f 7263 653d 666f 7263   out, force=forc
-000450e0: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
-000450f0: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-00045100: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-00045110: 636f 6c6c 6563 7469 6f6e 7328 6f75 742c  collections(out,
-00045120: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
-00045130: 6573 3d5b 6466 5d29 0a20 2020 2020 2020  es=[df]).       
-00045140: 2072 6574 7572 6e20 6e65 775f 6464 5f6f   return new_dd_o
-00045150: 626a 6563 7428 6772 6170 682c 206f 7574  bject(graph, out
-00045160: 2c20 6466 2e5f 6d65 7461 2c20 6469 7669  , df._meta, divi
-00045170: 7369 6f6e 7329 0a20 2020 2065 6c69 6620  sions).    elif 
-00045180: 6973 5f64 6174 6166 7261 6d65 5f6c 696b  is_dataframe_lik
-00045190: 6528 6466 2920 6f72 2069 735f 7365 7269  e(df) or is_seri
-000451a0: 6573 5f6c 696b 6528 6466 293a 0a20 2020  es_like(df):.   
-000451b0: 2020 2020 206e 616d 6520 3d20 2272 6570       name = "rep
-000451c0: 6172 7469 7469 6f6e 2d64 6174 6166 7261  artition-datafra
-000451d0: 6d65 2d22 202b 2074 6f6b 656e 0a20 2020  me-" + token.   
-000451e0: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
-000451f0: 6174 6166 7261 6d65 2e75 7469 6c73 2069  ataframe.utils i
-00045200: 6d70 6f72 7420 7368 6172 645f 6466 5f6f  mport shard_df_o
-00045210: 6e5f 696e 6465 780a 0a20 2020 2020 2020  n_index..       
-00045220: 2064 6673 203d 2073 6861 7264 5f64 665f   dfs = shard_df_
-00045230: 6f6e 5f69 6e64 6578 2864 662c 2064 6976  on_index(df, div
-00045240: 6973 696f 6e73 5b31 3a2d 315d 290a 2020  isions[1:-1]).  
-00045250: 2020 2020 2020 6473 6b20 3d20 7b28 6e61        dsk = {(na
-00045260: 6d65 2c20 6929 3a20 6466 2066 6f72 2069  me, i): df for i
-00045270: 2c20 6466 2069 6e20 656e 756d 6572 6174  , df in enumerat
-00045280: 6528 6466 7329 7d0a 2020 2020 2020 2020  e(dfs)}.        
-00045290: 7265 7475 726e 206e 6577 5f64 645f 6f62  return new_dd_ob
-000452a0: 6a65 6374 2864 736b 2c20 6e61 6d65 2c20  ject(dsk, name, 
-000452b0: 6466 2c20 6469 7669 7369 6f6e 7329 0a20  df, divisions). 
-000452c0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000452d0: 726f 7228 2244 6174 6120 6d75 7374 2062  ror("Data must b
-000452e0: 6520 4461 7461 4672 616d 6520 6f72 2053  e DataFrame or S
-000452f0: 6572 6965 7322 290a 0a0a 6465 6620 5f72  eries")...def _r
-00045300: 6564 7563 7469 6f6e 5f63 6875 6e6b 2878  eduction_chunk(x
-00045310: 2c20 6163 615f 6368 756e 6b3d 4e6f 6e65  , aca_chunk=None
-00045320: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00045330: 206f 203d 2061 6361 5f63 6875 6e6b 2878   o = aca_chunk(x
-00045340: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-00045350: 2320 5265 7475 726e 2061 2064 6174 6166  # Return a dataf
-00045360: 7261 6d65 2073 6f20 7468 6174 2074 6865  rame so that the
-00045370: 2063 6f6e 6361 7465 6e61 7465 6420 7665   concatenated ve
-00045380: 7273 696f 6e20 6973 2061 6c73 6f20 6120  rsion is also a 
-00045390: 6461 7461 6672 616d 650a 2020 2020 6966  dataframe.    if
-000453a0: 206e 6f74 2069 735f 7365 7269 6573 5f6c   not is_series_l
-000453b0: 696b 6528 6f29 3a0a 2020 2020 2020 2020  ike(o):.        
-000453c0: 7265 7475 726e 206f 0a20 2020 2072 6573  return o.    res
-000453d0: 756c 7420 3d20 6f2e 746f 5f66 7261 6d65  ult = o.to_frame
-000453e0: 2829 2e54 0a20 2020 2069 6620 6f2e 6474  ().T.    if o.dt
-000453f0: 7970 652e 6b69 6e64 203d 3d20 224f 223a  ype.kind == "O":
-00045400: 0a20 2020 2020 2020 2023 2057 6173 2063  .        # Was c
-00045410: 6f65 7263 6564 2074 6f20 6f62 6a65 6374  oerced to object
-00045420: 2c20 736f 2063 6173 7420 6261 636b 0a20  , so cast back. 
-00045430: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00045440: 7375 6c74 2e69 6e66 6572 5f6f 626a 6563  sult.infer_objec
-00045450: 7473 2829 0a20 2020 2072 6574 7572 6e20  ts().    return 
-00045460: 7265 7375 6c74 0a0a 0a64 6566 205f 7265  result...def _re
-00045470: 6475 6374 696f 6e5f 636f 6d62 696e 6528  duction_combine(
-00045480: 782c 2061 6361 5f63 6f6d 6269 6e65 3d4e  x, aca_combine=N
-00045490: 6f6e 652c 202a 2a6b 7761 7267 7329 3a0a  one, **kwargs):.
-000454a0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000454b0: 6528 782c 206c 6973 7429 3a0a 2020 2020  e(x, list):.    
-000454c0: 2020 2020 7820 3d20 7064 2e53 6572 6965      x = pd.Serie
-000454d0: 7328 7829 0a20 2020 206f 203d 2061 6361  s(x).    o = aca
-000454e0: 5f63 6f6d 6269 6e65 2878 2c20 2a2a 6b77  _combine(x, **kw
-000454f0: 6172 6773 290a 2020 2020 2320 5265 7475  args).    # Retu
-00045500: 726e 2061 2064 6174 6166 7261 6d65 2073  rn a dataframe s
-00045510: 6f20 7468 6174 2074 6865 2063 6f6e 6361  o that the conca
-00045520: 7465 6e61 7465 6420 7665 7273 696f 6e20  tenated version 
-00045530: 6973 2061 6c73 6f20 6120 6461 7461 6672  is also a datafr
-00045540: 616d 650a 2020 2020 7265 7475 726e 206f  ame.    return o
-00045550: 2e74 6f5f 6672 616d 6528 292e 5420 6966  .to_frame().T if
-00045560: 2069 735f 7365 7269 6573 5f6c 696b 6528   is_series_like(
-00045570: 6f29 2065 6c73 6520 6f0a 0a0a 6465 6620  o) else o...def 
-00045580: 5f72 6564 7563 7469 6f6e 5f61 6767 7265  _reduction_aggre
-00045590: 6761 7465 2878 2c20 6163 615f 6167 6772  gate(x, aca_aggr
-000455a0: 6567 6174 653d 4e6f 6e65 2c20 2a2a 6b77  egate=None, **kw
-000455b0: 6172 6773 293a 0a20 2020 2069 6620 6973  args):.    if is
-000455c0: 696e 7374 616e 6365 2878 2c20 6c69 7374  instance(x, list
-000455d0: 293a 0a20 2020 2020 2020 2078 203d 2070  ):.        x = p
-000455e0: 642e 5365 7269 6573 2878 290a 2020 2020  d.Series(x).    
-000455f0: 7265 7475 726e 2061 6361 5f61 6767 7265  return aca_aggre
-00045600: 6761 7465 2878 2c20 2a2a 6b77 6172 6773  gate(x, **kwargs
-00045610: 290a 0a0a 6465 6620 6964 786d 6178 6d69  )...def idxmaxmi
-00045620: 6e5f 6368 756e 6b28 782c 2066 6e3d 4e6f  n_chunk(x, fn=No
-00045630: 6e65 2c20 736b 6970 6e61 3d54 7275 652c  ne, skipna=True,
-00045640: 206e 756d 6572 6963 5f6f 6e6c 793d 4661   numeric_only=Fa
-00045650: 6c73 6529 3a0a 2020 2020 6e75 6d65 7269  lse):.    numeri
-00045660: 635f 6f6e 6c79 5f6b 7761 7267 7320 3d20  c_only_kwargs = 
-00045670: 280a 2020 2020 2020 2020 7b7d 2069 6620  (.        {} if 
-00045680: 6e6f 7420 5041 4e44 4153 5f47 545f 3135  not PANDAS_GT_15
-00045690: 3020 6f72 2069 735f 7365 7269 6573 5f6c  0 or is_series_l
-000456a0: 696b 6528 7829 2065 6c73 6520 7b22 6e75  ike(x) else {"nu
-000456b0: 6d65 7269 635f 6f6e 6c79 223a 206e 756d  meric_only": num
-000456c0: 6572 6963 5f6f 6e6c 797d 0a20 2020 2029  eric_only}.    )
-000456d0: 0a20 2020 206d 696e 6d61 7820 3d20 226d  .    minmax = "m
-000456e0: 6178 2220 6966 2066 6e20 3d3d 2022 6964  ax" if fn == "id
-000456f0: 786d 6178 2220 656c 7365 2022 6d69 6e22  xmax" else "min"
-00045700: 0a20 2020 2069 6620 6c65 6e28 7829 203e  .    if len(x) >
-00045710: 2030 3a0a 2020 2020 2020 2020 6964 7820   0:.        idx 
-00045720: 3d20 6765 7461 7474 7228 782c 2066 6e29  = getattr(x, fn)
-00045730: 2873 6b69 706e 613d 736b 6970 6e61 2c20  (skipna=skipna, 
-00045740: 2a2a 6e75 6d65 7269 635f 6f6e 6c79 5f6b  **numeric_only_k
-00045750: 7761 7267 7329 0a20 2020 2020 2020 2076  wargs).        v
-00045760: 616c 7565 203d 2067 6574 6174 7472 2878  alue = getattr(x
-00045770: 2c20 6d69 6e6d 6178 2928 736b 6970 6e61  , minmax)(skipna
-00045780: 3d73 6b69 706e 612c 202a 2a6e 756d 6572  =skipna, **numer
-00045790: 6963 5f6f 6e6c 795f 6b77 6172 6773 290a  ic_only_kwargs).
-000457a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000457b0: 2020 6964 7820 3d20 7661 6c75 6520 3d20    idx = value = 
-000457c0: 6d65 7461 5f73 6572 6965 735f 636f 6e73  meta_series_cons
-000457d0: 7472 7563 746f 7228 7829 285b 5d2c 2064  tructor(x)([], d
-000457e0: 7479 7065 3d22 6938 2229 0a20 2020 2069  type="i8").    i
-000457f0: 6620 6973 5f73 6572 6965 735f 6c69 6b65  f is_series_like
-00045800: 2869 6478 293a 0a20 2020 2020 2020 2072  (idx):.        r
-00045810: 6574 7572 6e20 6d65 7461 5f66 7261 6d65  eturn meta_frame
-00045820: 5f63 6f6e 7374 7275 6374 6f72 2878 2928  _constructor(x)(
-00045830: 7b22 6964 7822 3a20 6964 782c 2022 7661  {"idx": idx, "va
-00045840: 6c75 6522 3a20 7661 6c75 657d 290a 2020  lue": value}).  
-00045850: 2020 7265 7475 726e 206d 6574 615f 6672    return meta_fr
-00045860: 616d 655f 636f 6e73 7472 7563 746f 7228  ame_constructor(
-00045870: 7829 287b 2269 6478 223a 205b 6964 785d  x)({"idx": [idx]
-00045880: 2c20 2276 616c 7565 223a 205b 7661 6c75  , "value": [valu
-00045890: 655d 7d29 0a0a 0a64 6566 2069 6478 6d61  e]})...def idxma
-000458a0: 786d 696e 5f72 6f77 2878 2c20 666e 3d4e  xmin_row(x, fn=N
-000458b0: 6f6e 652c 2073 6b69 706e 613d 5472 7565  one, skipna=True
-000458c0: 293a 0a20 2020 206d 696e 6d61 7820 3d20  ):.    minmax = 
-000458d0: 226d 6178 2220 6966 2066 6e20 3d3d 2022  "max" if fn == "
-000458e0: 6964 786d 6178 2220 656c 7365 2022 6d69  idxmax" else "mi
-000458f0: 6e22 0a20 2020 2069 6620 6c65 6e28 7829  n".    if len(x)
-00045900: 203e 2030 3a0a 2020 2020 2020 2020 7820   > 0:.        x 
-00045910: 3d20 782e 7365 745f 696e 6465 7828 2269  = x.set_index("i
-00045920: 6478 2229 0a20 2020 2020 2020 2023 2070  dx").        # p
-00045930: 6f74 656e 7469 616c 6c79 2063 6f65 7263  otentially coerc
-00045940: 6564 2074 6f20 6f62 6a65 6374 2c20 736f  ed to object, so
-00045950: 2063 6173 7420 6261 636b 0a20 2020 2020   cast back.     
-00045960: 2020 2076 616c 7565 203d 2078 2e76 616c     value = x.val
-00045970: 7565 2e69 6e66 6572 5f6f 626a 6563 7473  ue.infer_objects
-00045980: 2829 0a20 2020 2020 2020 2069 6478 203d  ().        idx =
-00045990: 205b 6765 7461 7474 7228 7661 6c75 652c   [getattr(value,
-000459a0: 2066 6e29 2873 6b69 706e 613d 736b 6970   fn)(skipna=skip
-000459b0: 6e61 295d 0a20 2020 2020 2020 2076 616c  na)].        val
-000459c0: 7565 203d 205b 6765 7461 7474 7228 7661  ue = [getattr(va
-000459d0: 6c75 652c 206d 696e 6d61 7829 2873 6b69  lue, minmax)(ski
-000459e0: 706e 613d 736b 6970 6e61 295d 0a20 2020  pna=skipna)].   
-000459f0: 2065 6c73 653a 0a20 2020 2020 2020 2069   else:.        i
-00045a00: 6478 203d 2076 616c 7565 203d 206d 6574  dx = value = met
-00045a10: 615f 7365 7269 6573 5f63 6f6e 7374 7275  a_series_constru
-00045a20: 6374 6f72 2878 2928 5b5d 2c20 6474 7970  ctor(x)([], dtyp
-00045a30: 653d 2269 3822 290a 2020 2020 7265 7475  e="i8").    retu
-00045a40: 726e 206d 6574 615f 6672 616d 655f 636f  rn meta_frame_co
-00045a50: 6e73 7472 7563 746f 7228 7829 280a 2020  nstructor(x)(.  
-00045a60: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00045a70: 2020 2020 2269 6478 223a 206d 6574 615f      "idx": meta_
-00045a80: 7365 7269 6573 5f63 6f6e 7374 7275 6374  series_construct
-00045a90: 6f72 2878 2928 6964 782c 2064 7479 7065  or(x)(idx, dtype
-00045aa0: 3d78 2e69 6e64 6578 2e64 7479 7065 292c  =x.index.dtype),
-00045ab0: 0a20 2020 2020 2020 2020 2020 2022 7661  .            "va
-00045ac0: 6c75 6522 3a20 6d65 7461 5f73 6572 6965  lue": meta_serie
-00045ad0: 735f 636f 6e73 7472 7563 746f 7228 7829  s_constructor(x)
-00045ae0: 2876 616c 7565 2c20 6474 7970 653d 782e  (value, dtype=x.
-00045af0: 6474 7970 6573 2e69 6c6f 635b 305d 292c  dtypes.iloc[0]),
-00045b00: 0a20 2020 2020 2020 207d 0a20 2020 2029  .        }.    )
-00045b10: 0a0a 0a64 6566 2069 6478 6d61 786d 696e  ...def idxmaxmin
-00045b20: 5f63 6f6d 6269 6e65 2878 2c20 666e 3d4e  _combine(x, fn=N
-00045b30: 6f6e 652c 2073 6b69 706e 613d 5472 7565  one, skipna=True
-00045b40: 293a 0a20 2020 2069 6620 6c65 6e28 7829  ):.    if len(x)
-00045b50: 203c 3d20 313a 0a20 2020 2020 2020 2072   <= 1:.        r
-00045b60: 6574 7572 6e20 780a 2020 2020 7265 7475  eturn x.    retu
-00045b70: 726e 2028 0a20 2020 2020 2020 2078 2e67  rn (.        x.g
-00045b80: 726f 7570 6279 286c 6576 656c 3d30 290a  roupby(level=0).
-00045b90: 2020 2020 2020 2020 2e61 7070 6c79 2869          .apply(i
-00045ba0: 6478 6d61 786d 696e 5f72 6f77 2c20 666e  dxmaxmin_row, fn
-00045bb0: 3d66 6e2c 2073 6b69 706e 613d 736b 6970  =fn, skipna=skip
-00045bc0: 6e61 290a 2020 2020 2020 2020 2e72 6573  na).        .res
-00045bd0: 6574 5f69 6e64 6578 286c 6576 656c 3d31  et_index(level=1
-00045be0: 2c20 6472 6f70 3d54 7275 6529 0a20 2020  , drop=True).   
-00045bf0: 2029 0a0a 0a64 6566 2069 6478 6d61 786d   )...def idxmaxm
-00045c00: 696e 5f61 6767 2878 2c20 666e 3d4e 6f6e  in_agg(x, fn=Non
-00045c10: 652c 2073 6b69 706e 613d 5472 7565 2c20  e, skipna=True, 
-00045c20: 7363 616c 6172 3d46 616c 7365 2c20 6e75  scalar=False, nu
-00045c30: 6d65 7269 635f 6f6e 6c79 3d6e 6f5f 6465  meric_only=no_de
-00045c40: 6661 756c 7429 3a0a 2020 2020 7265 7320  fault):.    res 
-00045c50: 3d20 6964 786d 6178 6d69 6e5f 636f 6d62  = idxmaxmin_comb
-00045c60: 696e 6528 782c 2066 6e2c 2073 6b69 706e  ine(x, fn, skipn
-00045c70: 613d 736b 6970 6e61 295b 2269 6478 225d  a=skipna)["idx"]
-00045c80: 0a20 2020 2069 6620 6c65 6e28 7265 7329  .    if len(res)
-00045c90: 203d 3d20 303a 0a20 2020 2020 2020 2072   == 0:.        r
-00045ca0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00045cb0: 2261 7474 656d 7074 2074 6f20 6765 7420  "attempt to get 
-00045cc0: 6172 676d 6178 206f 6620 616e 2065 6d70  argmax of an emp
-00045cd0: 7479 2073 6571 7565 6e63 6522 290a 2020  ty sequence").  
-00045ce0: 2020 6966 2073 6361 6c61 723a 0a20 2020    if scalar:.   
-00045cf0: 2020 2020 2072 6574 7572 6e20 7265 735b       return res[
-00045d00: 305d 0a20 2020 2072 6573 2e6e 616d 6520  0].    res.name 
-00045d10: 3d20 4e6f 6e65 0a20 2020 2072 6574 7572  = None.    retur
-00045d20: 6e20 7265 730a 0a0a 6465 6620 5f6d 6f64  n res...def _mod
-00045d30: 655f 6167 6772 6567 6174 6528 6466 2c20  e_aggregate(df, 
-00045d40: 6472 6f70 6e61 293a 0a20 2020 2076 616c  dropna):.    val
-00045d50: 7565 5f63 6f75 6e74 5f73 6572 6965 7320  ue_count_series 
-00045d60: 3d20 6466 2e73 756d 2829 0a20 2020 206d  = df.sum().    m
-00045d70: 6178 5f76 616c 203d 2076 616c 7565 5f63  ax_val = value_c
-00045d80: 6f75 6e74 5f73 6572 6965 732e 6d61 7828  ount_series.max(
-00045d90: 736b 6970 6e61 3d64 726f 706e 6129 0a20  skipna=dropna). 
-00045da0: 2020 206d 6f64 655f 7365 7269 6573 203d     mode_series =
-00045db0: 2028 0a20 2020 2020 2020 2076 616c 7565   (.        value
-00045dc0: 5f63 6f75 6e74 5f73 6572 6965 735b 7661  _count_series[va
-00045dd0: 6c75 655f 636f 756e 745f 7365 7269 6573  lue_count_series
-00045de0: 203d 3d20 6d61 785f 7661 6c5d 0a20 2020   == max_val].   
-00045df0: 2020 2020 202e 696e 6465 782e 746f 5f73       .index.to_s
-00045e00: 6572 6965 7328 290a 2020 2020 2020 2020  eries().        
-00045e10: 2e73 6f72 745f 7661 6c75 6573 2829 0a20  .sort_values(). 
-00045e20: 2020 2020 2020 202e 7265 7365 745f 696e         .reset_in
-00045e30: 6465 7828 6472 6f70 3d54 7275 6529 0a20  dex(drop=True). 
-00045e40: 2020 2029 0a20 2020 2072 6574 7572 6e20     ).    return 
-00045e50: 6d6f 6465 5f73 6572 6965 730a 0a0a 6465  mode_series...de
-00045e60: 6620 5f63 6f75 6e74 5f61 6767 7265 6761  f _count_aggrega
-00045e70: 7465 2878 293a 0a20 2020 2072 6574 7572  te(x):.    retur
-00045e80: 6e20 782e 7375 6d28 292e 6173 7479 7065  n x.sum().astype
-00045e90: 2822 696e 7436 3422 290a 0a0a 6465 6620  ("int64")...def 
-00045ea0: 7361 6665 5f68 6561 6428 6466 2c20 6e29  safe_head(df, n)
-00045eb0: 3a0a 2020 2020 7220 3d20 4d2e 6865 6164  :.    r = M.head
-00045ec0: 2864 662c 206e 290a 2020 2020 6966 206c  (df, n).    if l
-00045ed0: 656e 2872 2920 213d 206e 3a0a 2020 2020  en(r) != n:.    
-00045ee0: 2020 2020 7761 726e 696e 6773 2e77 6172      warnings.war
-00045ef0: 6e28 0a20 2020 2020 2020 2020 2020 2066  n(.            f
-00045f00: 2249 6e73 7566 6669 6369 656e 7420 656c  "Insufficient el
-00045f10: 656d 656e 7473 2066 6f72 2060 6865 6164  ements for `head
-00045f20: 602e 207b 6e7d 2065 6c65 6d65 6e74 7320  `. {n} elements 
-00045f30: 7265 7175 6573 7465 642c 206f 6e6c 7920  requested, only 
-00045f40: 7b6c 656e 2872 297d 2022 0a20 2020 2020  {len(r)} ".     
-00045f50: 2020 2020 2020 2022 656c 656d 656e 7473         "elements
-00045f60: 2061 7661 696c 6162 6c65 2e20 5472 7920   available. Try 
-00045f70: 7061 7373 696e 6720 6c61 7267 6572 2060  passing larger `
-00045f80: 6e70 6172 7469 7469 6f6e 7360 2074 6f20  npartitions` to 
-00045f90: 6068 6561 6460 2e22 0a20 2020 2020 2020  `head`.".       
-00045fa0: 2029 0a20 2020 2072 6574 7572 6e20 720a   ).    return r.
-00045fb0: 0a0a 6465 6620 6d61 7962 655f 7368 6966  ..def maybe_shif
-00045fc0: 745f 6469 7669 7369 6f6e 7328 6466 2c20  t_divisions(df, 
-00045fd0: 7065 7269 6f64 732c 2066 7265 7129 3a0a  periods, freq):.
-00045fe0: 2020 2020 2222 224d 6179 6265 2073 6869      """Maybe shi
-00045ff0: 6674 2064 6976 6973 696f 6e73 2062 7920  ft divisions by 
-00046000: 7065 7269 6f64 7320 6f66 2073 697a 6520  periods of size 
-00046010: 6672 6571 0a0a 2020 2020 5573 6564 2074  freq..    Used t
-00046020: 6f20 7368 6966 7420 7468 6520 6469 7669  o shift the divi
-00046030: 7369 6f6e 7320 666f 7220 7468 6520 6073  sions for the `s
-00046040: 6869 6674 6020 6d65 7468 6f64 2e20 4966  hift` method. If
-00046050: 2066 7265 7120 6973 6e27 7420 6120 6669   freq isn't a fi
-00046060: 7865 640a 2020 2020 7369 7a65 2028 6e6f  xed.    size (no
-00046070: 7420 616e 6368 6f72 6564 206f 7220 7265  t anchored or re
-00046080: 6c61 7469 7665 292c 2074 6865 6e20 7468  lative), then th
-00046090: 6520 6469 7669 7369 6f6e 7320 6172 6520  e divisions are 
-000460a0: 7368 6966 7465 640a 2020 2020 6170 7072  shifted.    appr
-000460b0: 6f70 7269 6174 656c 792e 204f 7468 6572  opriately. Other
-000460c0: 7769 7365 2074 6865 2064 6976 6973 696f  wise the divisio
-000460d0: 6e73 2061 7265 2063 6c65 6172 6564 2e0a  ns are cleared..
-000460e0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-000460f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00046100: 2020 2064 6620 3a20 6464 2e44 6174 6146     df : dd.DataF
-00046110: 7261 6d65 2c20 6464 2e53 6572 6965 732c  rame, dd.Series,
-00046120: 206f 7220 6464 2e49 6e64 6578 0a20 2020   or dd.Index.   
-00046130: 2070 6572 696f 6473 203a 2069 6e74 0a20   periods : int. 
-00046140: 2020 2020 2020 2054 6865 206e 756d 6265         The numbe
-00046150: 7220 6f66 2070 6572 696f 6473 2074 6f20  r of periods to 
-00046160: 7368 6966 742e 0a20 2020 2066 7265 7120  shift..    freq 
-00046170: 3a20 4461 7465 4f66 6673 6574 2c20 7469  : DateOffset, ti
-00046180: 6d65 6465 6c74 612c 206f 7220 7469 6d65  medelta, or time
-00046190: 2072 756c 6520 7374 7269 6e67 0a20 2020   rule string.   
-000461a0: 2020 2020 2054 6865 2066 7265 7175 656e       The frequen
-000461b0: 6379 2074 6f20 7368 6966 7420 6279 2e0a  cy to shift by..
-000461c0: 2020 2020 2222 220a 2020 2020 6966 2069      """.    if i
-000461d0: 7369 6e73 7461 6e63 6528 6672 6571 2c20  sinstance(freq, 
-000461e0: 7374 7229 3a0a 2020 2020 2020 2020 6672  str):.        fr
-000461f0: 6571 203d 2070 642e 7473 6572 6965 732e  eq = pd.tseries.
-00046200: 6672 6571 7565 6e63 6965 732e 746f 5f6f  frequencies.to_o
-00046210: 6666 7365 7428 6672 6571 290a 0a20 2020  ffset(freq)..   
-00046220: 2069 735f 6f66 6673 6574 203d 2069 7369   is_offset = isi
-00046230: 6e73 7461 6e63 6528 6672 6571 2c20 7064  nstance(freq, pd
-00046240: 2e44 6174 654f 6666 7365 7429 0a20 2020  .DateOffset).   
-00046250: 2069 6620 6973 5f6f 6666 7365 743a 0a20   if is_offset:. 
-00046260: 2020 2020 2020 2069 6620 6672 6571 2e69         if freq.i
-00046270: 735f 616e 6368 6f72 6564 2829 206f 7220  s_anchored() or 
-00046280: 6e6f 7420 6861 7361 7474 7228 6672 6571  not hasattr(freq
-00046290: 2c20 2264 656c 7461 2229 3a0a 2020 2020  , "delta"):.    
-000462a0: 2020 2020 2020 2020 2320 4361 6e27 7420          # Can't 
-000462b0: 696e 6665 7220 6469 7669 7369 6f6e 7320  infer divisions 
-000462c0: 6f6e 2072 656c 6174 6976 6520 6f72 2061  on relative or a
-000462d0: 6e63 686f 7265 6420 6f66 6673 6574 732c  nchored offsets,
-000462e0: 2061 730a 2020 2020 2020 2020 2020 2020   as.            
-000462f0: 2320 6469 7669 7369 6f6e 7320 6d61 7920  # divisions may 
-00046300: 6e6f 7720 7370 6c69 7420 6964 656e 7469  now split identi
-00046310: 6361 6c20 696e 6465 7820 7661 6c75 652e  cal index value.
-00046320: 0a20 2020 2020 2020 2020 2020 2023 2028  .            # (
-00046330: 652e 672e 2069 6e64 6578 5f70 6172 7469  e.g. index_parti
-00046340: 7469 6f6e 7320 3d20 5b5b 312c 2032 2c20  tions = [[1, 2, 
-00046350: 335d 2c20 5b33 2c20 342c 2035 5d5d 290a  3], [3, 4, 5]]).
-00046360: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00046370: 726e 2064 662e 636c 6561 725f 6469 7669  rn df.clear_divi
-00046380: 7369 6f6e 7328 290a 2020 2020 6966 2064  sions().    if d
-00046390: 662e 6b6e 6f77 6e5f 6469 7669 7369 6f6e  f.known_division
-000463a0: 733a 0a20 2020 2020 2020 2064 6976 7320  s:.        divs 
-000463b0: 3d20 7064 2e53 6572 6965 7328 7261 6e67  = pd.Series(rang
-000463c0: 6528 6c65 6e28 6466 2e64 6976 6973 696f  e(len(df.divisio
-000463d0: 6e73 2929 2c20 696e 6465 783d 6466 2e64  ns)), index=df.d
-000463e0: 6976 6973 696f 6e73 290a 2020 2020 2020  ivisions).      
-000463f0: 2020 6469 7669 7369 6f6e 7320 3d20 6469    divisions = di
-00046400: 7673 2e73 6869 6674 2870 6572 696f 6473  vs.shift(periods
-00046410: 2c20 6672 6571 3d66 7265 7129 2e69 6e64  , freq=freq).ind
-00046420: 6578 0a20 2020 2020 2020 2072 6574 7572  ex.        retur
-00046430: 6e20 6466 2e5f 5f63 6c61 7373 5f5f 2864  n df.__class__(d
-00046440: 662e 6461 736b 2c20 6466 2e5f 6e61 6d65  f.dask, df._name
-00046450: 2c20 6466 2e5f 6d65 7461 2c20 6469 7669  , df._meta, divi
-00046460: 7369 6f6e 7329 0a20 2020 2072 6574 7572  sions).    retur
-00046470: 6e20 6466 0a0a 0a40 7772 6170 7328 7064  n df...@wraps(pd
-00046480: 2e74 6f5f 6461 7465 7469 6d65 290a 6465  .to_datetime).de
-00046490: 6620 746f 5f64 6174 6574 696d 6528 6172  f to_datetime(ar
-000464a0: 672c 206d 6574 613d 4e6f 6e65 2c20 2a2a  g, meta=None, **
-000464b0: 6b77 6172 6773 293a 0a20 2020 2074 7a5f  kwargs):.    tz_
-000464c0: 6b77 6172 6720 3d20 7b22 747a 223a 2022  kwarg = {"tz": "
-000464d0: 7574 6322 7d20 6966 206b 7761 7267 732e  utc"} if kwargs.
-000464e0: 6765 7428 2275 7463 2229 2065 6c73 6520  get("utc") else 
-000464f0: 7b7d 0a20 2020 2069 6620 6d65 7461 2069  {}.    if meta i
-00046500: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00046510: 6966 2069 7369 6e73 7461 6e63 6528 6172  if isinstance(ar
-00046520: 672c 2049 6e64 6578 293a 0a20 2020 2020  g, Index):.     
-00046530: 2020 2020 2020 206d 6574 6120 3d20 6765         meta = ge
-00046540: 745f 6d65 7461 5f6c 6962 7261 7279 2861  t_meta_library(a
-00046550: 7267 292e 4461 7465 7469 6d65 496e 6465  rg).DatetimeInde
-00046560: 7828 5b5d 2c20 2a2a 747a 5f6b 7761 7267  x([], **tz_kwarg
-00046570: 290a 2020 2020 2020 2020 2020 2020 6d65  ).            me
-00046580: 7461 2e6e 616d 6520 3d20 6172 672e 6e61  ta.name = arg.na
-00046590: 6d65 0a20 2020 2020 2020 2065 6c69 6620  me.        elif 
-000465a0: 6e6f 7420 2869 735f 6461 7461 6672 616d  not (is_datafram
-000465b0: 655f 6c69 6b65 2861 7267 2920 6f72 2069  e_like(arg) or i
-000465c0: 735f 7365 7269 6573 5f6c 696b 6528 6172  s_series_like(ar
-000465d0: 6729 293a 0a20 2020 2020 2020 2020 2020  g)):.           
-000465e0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-000465f0: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
-00046600: 2020 2020 2020 2020 2020 2020 2264 6173              "das
-00046610: 6b2e 6461 7461 6672 616d 652e 746f 5f64  k.dataframe.to_d
-00046620: 6174 6574 696d 6520 646f 6573 206e 6f74  atetime does not
-00046630: 2073 7570 706f 7274 2022 0a20 2020 2020   support ".     
-00046640: 2020 2020 2020 2020 2020 2022 6e6f 6e2d             "non-
-00046650: 696e 6465 782d 6162 6c65 2061 7267 756d  index-able argum
-00046660: 656e 7473 2028 6c69 6b65 2073 6361 6c61  ents (like scala
-00046670: 7273 2922 0a20 2020 2020 2020 2020 2020  rs)".           
-00046680: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-00046690: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-000466a0: 6120 3d20 6d65 7461 5f73 6572 6965 735f  a = meta_series_
-000466b0: 636f 6e73 7472 7563 746f 7228 6172 6729  constructor(arg)
-000466c0: 285b 7064 2e54 696d 6573 7461 6d70 2822  ([pd.Timestamp("
-000466d0: 3230 3030 222c 202a 2a74 7a5f 6b77 6172  2000", **tz_kwar
-000466e0: 6729 5d29 0a20 2020 2020 2020 2020 2020  g)]).           
-000466f0: 206d 6574 612e 696e 6465 7820 3d20 6d65   meta.index = me
-00046700: 7461 2e69 6e64 6578 2e61 7374 7970 6528  ta.index.astype(
-00046710: 6172 672e 696e 6465 782e 6474 7970 6529  arg.index.dtype)
-00046720: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-00046730: 612e 696e 6465 782e 6e61 6d65 203d 2061  a.index.name = a
-00046740: 7267 2e69 6e64 6578 2e6e 616d 650a 2020  rg.index.name.  
-00046750: 2020 6966 2050 414e 4441 535f 4754 5f32    if PANDAS_GT_2
-00046760: 3030 2061 6e64 2022 696e 6665 725f 6461  00 and "infer_da
-00046770: 7465 7469 6d65 5f66 6f72 6d61 7422 2069  tetime_format" i
-00046780: 6e20 6b77 6172 6773 3a0a 2020 2020 2020  n kwargs:.      
-00046790: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-000467a0: 0a20 2020 2020 2020 2020 2020 2022 5468  .            "Th
-000467b0: 6520 6172 6775 6d65 6e74 2027 696e 6665  e argument 'infe
-000467c0: 725f 6461 7465 7469 6d65 5f66 6f72 6d61  r_datetime_forma
-000467d0: 7427 2069 7320 6465 7072 6563 6174 6564  t' is deprecated
-000467e0: 2061 6e64 2077 696c 6c20 6265 2072 656d   and will be rem
-000467f0: 6f76 6564 2069 6e20 6120 6675 7475 7265  oved in a future
-00046800: 2076 6572 7369 6f6e 2e20 220a 2020 2020   version. ".    
-00046810: 2020 2020 2020 2020 2241 2073 7472 6963          "A stric
-00046820: 7420 7665 7273 696f 6e20 6f66 2069 7420  t version of it 
-00046830: 6973 206e 6f77 2074 6865 2064 6566 6175  is now the defau
-00046840: 6c74 2c20 7365 6520 220a 2020 2020 2020  lt, see ".      
-00046850: 2020 2020 2020 2268 7474 7073 3a2f 2f70        "https://p
-00046860: 616e 6461 732e 7079 6461 7461 2e6f 7267  andas.pydata.org
-00046870: 2f70 6465 7073 2f30 3030 342d 636f 6e73  /pdeps/0004-cons
-00046880: 6973 7465 6e74 2d74 6f2d 6461 7465 7469  istent-to-dateti
-00046890: 6d65 2d70 6172 7369 6e67 2e68 746d 6c2e  me-parsing.html.
-000468a0: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
-000468b0: 596f 7520 6361 6e20 7361 6665 6c79 2072  You can safely r
-000468c0: 656d 6f76 6520 7468 6973 2061 7267 756d  emove this argum
-000468d0: 656e 742e 222c 0a20 2020 2020 2020 2020  ent.",.         
-000468e0: 2020 2055 7365 7257 6172 6e69 6e67 2c0a     UserWarning,.
-000468f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00046900: 2020 6b77 6172 6773 2e70 6f70 2822 696e    kwargs.pop("in
-00046910: 6665 725f 6461 7465 7469 6d65 5f66 6f72  fer_datetime_for
-00046920: 6d61 7422 290a 0a20 2020 2072 6574 7572  mat")..    retur
-00046930: 6e20 6d61 705f 7061 7274 6974 696f 6e73  n map_partitions
-00046940: 2867 6574 5f6d 6574 615f 6c69 6272 6172  (get_meta_librar
-00046950: 7928 6172 6729 2e74 6f5f 6461 7465 7469  y(arg).to_dateti
-00046960: 6d65 2c20 6172 672c 206d 6574 613d 6d65  me, arg, meta=me
-00046970: 7461 2c20 2a2a 6b77 6172 6773 290a 0a0a  ta, **kwargs)...
-00046980: 4077 7261 7073 2870 642e 746f 5f74 696d  @wraps(pd.to_tim
-00046990: 6564 656c 7461 290a 6465 6620 746f 5f74  edelta).def to_t
-000469a0: 696d 6564 656c 7461 2861 7267 2c20 756e  imedelta(arg, un
-000469b0: 6974 3d4e 6f6e 652c 2065 7272 6f72 733d  it=None, errors=
-000469c0: 2272 6169 7365 2229 3a0a 2020 2020 6d65  "raise"):.    me
-000469d0: 7461 203d 206d 6574 615f 7365 7269 6573  ta = meta_series
-000469e0: 5f63 6f6e 7374 7275 6374 6f72 2861 7267  _constructor(arg
-000469f0: 2928 5b70 642e 5469 6d65 6465 6c74 6128  )([pd.Timedelta(
-00046a00: 312c 2075 6e69 743d 756e 6974 295d 290a  1, unit=unit)]).
-00046a10: 2020 2020 7265 7475 726e 206d 6170 5f70      return map_p
-00046a20: 6172 7469 7469 6f6e 7328 7064 2e74 6f5f  artitions(pd.to_
-00046a30: 7469 6d65 6465 6c74 612c 2061 7267 2c20  timedelta, arg, 
-00046a40: 756e 6974 3d75 6e69 742c 2065 7272 6f72  unit=unit, error
-00046a50: 733d 6572 726f 7273 2c20 6d65 7461 3d6d  s=errors, meta=m
-00046a60: 6574 6129 0a0a 0a69 6620 6861 7361 7474  eta)...if hasatt
-00046a70: 7228 7064 2c20 2269 736e 6122 293a 0a0a  r(pd, "isna"):..
-00046a80: 2020 2020 4077 7261 7073 2870 642e 6973      @wraps(pd.is
-00046a90: 6e61 290a 2020 2020 6465 6620 6973 6e61  na).    def isna
-00046aa0: 2861 7267 293a 0a20 2020 2020 2020 2072  (arg):.        r
-00046ab0: 6574 7572 6e20 6d61 705f 7061 7274 6974  eturn map_partit
-00046ac0: 696f 6e73 2870 642e 6973 6e61 2c20 6172  ions(pd.isna, ar
-00046ad0: 6729 0a0a 0a64 6566 205f 7265 7072 5f64  g)...def _repr_d
-00046ae0: 6174 615f 7365 7269 6573 2873 2c20 696e  ata_series(s, in
-00046af0: 6465 7829 3a0a 2020 2020 2222 2241 2068  dex):.    """A h
-00046b00: 656c 7065 7220 666f 7220 6372 6561 7469  elper for creati
-00046b10: 6e67 2074 6865 2060 605f 7265 7072 5f64  ng the ``_repr_d
-00046b20: 6174 6160 6020 7072 6f70 6572 7479 2222  ata`` property""
-00046b30: 220a 2020 2020 6e70 6172 7469 7469 6f6e  ".    npartition
-00046b40: 7320 3d20 6c65 6e28 696e 6465 7829 202d  s = len(index) -
-00046b50: 2031 0a20 2020 2069 6620 6973 696e 7374   1.    if isinst
-00046b60: 616e 6365 2873 2e64 7479 7065 2c20 7064  ance(s.dtype, pd
-00046b70: 2e43 6174 6567 6f72 6963 616c 4474 7970  .CategoricalDtyp
-00046b80: 6529 3a0a 2020 2020 2020 2020 6966 2068  e):.        if h
-00046b90: 6173 5f6b 6e6f 776e 5f63 6174 6567 6f72  as_known_categor
-00046ba0: 6965 7328 7329 3a0a 2020 2020 2020 2020  ies(s):.        
-00046bb0: 2020 2020 6474 7970 6520 3d20 2263 6174      dtype = "cat
-00046bc0: 6567 6f72 795b 6b6e 6f77 6e5d 220a 2020  egory[known]".  
-00046bd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00046be0: 2020 2020 2020 2020 6474 7970 6520 3d20          dtype = 
-00046bf0: 2263 6174 6567 6f72 795b 756e 6b6e 6f77  "category[unknow
-00046c00: 6e5d 220a 2020 2020 656c 7365 3a0a 2020  n]".    else:.  
-00046c10: 2020 2020 2020 6474 7970 6520 3d20 7374        dtype = st
-00046c20: 7228 732e 6474 7970 6529 0a20 2020 2072  r(s.dtype).    r
-00046c30: 6574 7572 6e20 7064 2e53 6572 6965 7328  eturn pd.Series(
-00046c40: 5b64 7479 7065 5d20 2b20 5b22 2e2e 2e22  [dtype] + ["..."
-00046c50: 5d20 2a20 6e70 6172 7469 7469 6f6e 732c  ] * npartitions,
-00046c60: 2069 6e64 6578 3d69 6e64 6578 2c20 6e61   index=index, na
-00046c70: 6d65 3d73 2e6e 616d 6529 0a0a 0a64 6566  me=s.name)...def
-00046c80: 2068 6173 5f70 6172 616c 6c65 6c5f 7479   has_parallel_ty
-00046c90: 7065 2878 293a 0a20 2020 2022 2222 446f  pe(x):.    """Do
-00046ca0: 6573 2074 6869 7320 6f62 6a65 6374 2068  es this object h
-00046cb0: 6176 6520 6120 6461 736b 2064 6174 6166  ave a dask dataf
-00046cc0: 7261 6d65 2065 7175 6976 616c 656e 743f  rame equivalent?
-00046cd0: 2222 220a 2020 2020 7265 7475 726e 2067  """.    return g
-00046ce0: 6574 5f70 6172 616c 6c65 6c5f 7479 7065  et_parallel_type
-00046cf0: 2878 2920 6973 206e 6f74 2053 6361 6c61  (x) is not Scala
-00046d00: 720a 0a0a 6465 6620 6e65 775f 6464 5f6f  r...def new_dd_o
-00046d10: 626a 6563 7428 6473 6b2c 206e 616d 652c  bject(dsk, name,
-00046d20: 206d 6574 612c 2064 6976 6973 696f 6e73   meta, divisions
-00046d30: 2c20 7061 7265 6e74 5f6d 6574 613d 4e6f  , parent_meta=No
-00046d40: 6e65 293a 0a20 2020 2022 2222 4765 6e65  ne):.    """Gene
-00046d50: 7269 6320 636f 6e73 7472 7563 746f 7220  ric constructor 
-00046d60: 666f 7220 6461 736b 2e64 6174 6166 7261  for dask.datafra
-00046d70: 6d65 206f 626a 6563 7473 2e0a 0a20 2020  me objects...   
-00046d80: 2044 6563 6964 6573 2074 6865 2061 7070   Decides the app
-00046d90: 726f 7072 6961 7465 206f 7574 7075 7420  ropriate output 
-00046da0: 636c 6173 7320 6261 7365 6420 6f6e 2074  class based on t
-00046db0: 6865 2074 7970 6520 6f66 2060 6d65 7461  he type of `meta
-00046dc0: 6020 7072 6f76 6964 6564 2e0a 2020 2020  ` provided..    
-00046dd0: 2222 220a 2020 2020 6966 2068 6173 5f70  """.    if has_p
-00046de0: 6172 616c 6c65 6c5f 7479 7065 286d 6574  arallel_type(met
-00046df0: 6129 3a0a 2020 2020 2020 2020 7265 7475  a):.        retu
-00046e00: 726e 2067 6574 5f70 6172 616c 6c65 6c5f  rn get_parallel_
-00046e10: 7479 7065 286d 6574 6129 2864 736b 2c20  type(meta)(dsk, 
-00046e20: 6e61 6d65 2c20 6d65 7461 2c20 6469 7669  name, meta, divi
-00046e30: 7369 6f6e 7329 0a20 2020 2065 6c69 6620  sions).    elif 
-00046e40: 6973 5f61 7272 6179 6c69 6b65 286d 6574  is_arraylike(met
-00046e50: 6129 2061 6e64 206d 6574 612e 7368 6170  a) and meta.shap
-00046e60: 653a 0a20 2020 2020 2020 2069 6d70 6f72  e:.        impor
-00046e70: 7420 6461 736b 2e61 7272 6179 2061 7320  t dask.array as 
-00046e80: 6461 0a0a 2020 2020 2020 2020 6368 756e  da..        chun
-00046e90: 6b73 203d 2028 286e 702e 6e61 6e2c 2920  ks = ((np.nan,) 
-00046ea0: 2a20 286c 656e 2864 6976 6973 696f 6e73  * (len(divisions
-00046eb0: 2920 2d20 3129 2c29 202b 2074 7570 6c65  ) - 1),) + tuple
-00046ec0: 280a 2020 2020 2020 2020 2020 2020 2864  (.            (d
-00046ed0: 2c29 2066 6f72 2064 2069 6e20 6d65 7461  ,) for d in meta
-00046ee0: 2e73 6861 7065 5b31 3a5d 0a20 2020 2020  .shape[1:].     
-00046ef0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
-00046f00: 6c65 6e28 6368 756e 6b73 2920 3e20 313a  len(chunks) > 1:
-00046f10: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00046f20: 6572 203d 2064 736b 2e6c 6179 6572 735b  er = dsk.layers[
-00046f30: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
-00046f40: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00046f50: 6c61 7965 722c 2042 6c6f 636b 7769 7365  layer, Blockwise
-00046f60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00046f70: 2020 206c 6179 6572 2e6e 6577 5f61 7865     layer.new_axe
-00046f80: 735b 226a 225d 203d 2063 6875 6e6b 735b  s["j"] = chunks[
-00046f90: 315d 5b30 5d0a 2020 2020 2020 2020 2020  1][0].          
-00046fa0: 2020 2020 2020 6c61 7965 722e 6f75 7470        layer.outp
-00046fb0: 7574 5f69 6e64 6963 6573 203d 206c 6179  ut_indices = lay
-00046fc0: 6572 2e6f 7574 7075 745f 696e 6469 6365  er.output_indice
-00046fd0: 7320 2b20 2822 6a22 2c29 0a20 2020 2020  s + ("j",).     
-00046fe0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00046ff0: 2020 2020 2020 2020 2020 2020 2073 7566               suf
-00047000: 6669 7820 3d20 2830 2c29 202a 2028 6c65  fix = (0,) * (le
-00047010: 6e28 6368 756e 6b73 2920 2d20 3129 0a20  n(chunks) - 1). 
-00047020: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00047030: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-00047040: 6e28 6368 756e 6b73 5b30 5d29 293a 0a20  n(chunks[0])):. 
-00047050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047060: 2020 206c 6179 6572 5b28 6e61 6d65 2c20     layer[(name, 
-00047070: 6929 202b 2073 7566 6669 785d 203d 206c  i) + suffix] = l
-00047080: 6179 6572 2e70 6f70 2828 6e61 6d65 2c20  ayer.pop((name, 
-00047090: 6929 290a 2020 2020 2020 2020 7265 7475  i)).        retu
-000470a0: 726e 2064 612e 4172 7261 7928 6473 6b2c  rn da.Array(dsk,
-000470b0: 206e 616d 653d 6e61 6d65 2c20 6368 756e   name=name, chun
-000470c0: 6b73 3d63 6875 6e6b 732c 2064 7479 7065  ks=chunks, dtype
-000470d0: 3d6d 6574 612e 6474 7970 6529 0a20 2020  =meta.dtype).   
-000470e0: 2065 6c73 653a 0a20 2020 2020 2020 2072   else:.        r
-000470f0: 6574 7572 6e20 6765 745f 7061 7261 6c6c  eturn get_parall
-00047100: 656c 5f74 7970 6528 6d65 7461 2928 6473  el_type(meta)(ds
-00047110: 6b2c 206e 616d 652c 206d 6574 612c 2064  k, name, meta, d
-00047120: 6976 6973 696f 6e73 290a 0a0a 6465 6620  ivisions)...def 
-00047130: 7061 7274 6974 696f 6e77 6973 655f 6772  partitionwise_gr
-00047140: 6170 6828 6675 6e63 2c20 6c61 7965 725f  aph(func, layer_
-00047150: 6e61 6d65 2c20 2a61 7267 732c 202a 2a6b  name, *args, **k
-00047160: 7761 7267 7329 3a0a 2020 2020 2222 220a  wargs):.    """.
-00047170: 2020 2020 4170 706c 7920 6120 6675 6e63      Apply a func
-00047180: 7469 6f6e 2070 6172 7469 7469 6f6e 2d77  tion partition-w
-00047190: 6973 6520 6163 726f 7373 2061 7267 756d  ise across argum
-000471a0: 656e 7473 2074 6f20 6372 6561 7465 206c  ents to create l
-000471b0: 6179 6572 206f 6620 6120 6772 6170 680a  ayer of a graph.
-000471c0: 0a20 2020 2054 6869 7320 6170 706c 6965  .    This applie
-000471d0: 7320 6120 6675 6e63 7469 6f6e 2c20 6060  s a function, ``
-000471e0: 6675 6e63 6060 2c20 696e 2061 6e20 656d  func``, in an em
-000471f0: 6261 7272 6173 7369 6e67 6c79 2070 6172  barrassingly par
-00047200: 616c 6c65 6c20 6661 7368 696f 6e0a 2020  allel fashion.  
-00047210: 2020 6163 726f 7373 2070 6172 7469 7469    across partiti
-00047220: 6f6e 732f 6368 756e 6b73 2069 6e20 7468  ons/chunks in th
-00047230: 6520 7072 6f76 6964 6564 2061 7267 756d  e provided argum
-00047240: 656e 7473 2e20 2049 7420 6861 6e64 6c65  ents.  It handle
-00047250: 7320 4461 7461 6672 616d 6573 2c0a 2020  s Dataframes,.  
-00047260: 2020 4172 7261 7973 2c20 616e 6420 7363    Arrays, and sc
-00047270: 616c 6172 7320 736d 6f6f 7468 6c79 2c20  alars smoothly, 
-00047280: 616e 6420 7265 6c69 6573 206f 6e20 7468  and relies on th
-00047290: 6520 6060 626c 6f63 6b77 6973 6560 6020  e ``blockwise`` 
-000472a0: 6d61 6368 696e 6572 790a 2020 2020 746f  machinery.    to
-000472b0: 2070 726f 7669 6465 2061 206e 6963 656c   provide a nicel
-000472c0: 7920 7379 6d62 6f6c 6963 2067 7261 7068  y symbolic graph
-000472d0: 2e0a 0a20 2020 2049 7420 6973 206d 6f73  ...    It is mos
-000472e0: 7420 636f 6d6d 6f6e 6c79 2075 7365 6420  t commonly used 
-000472f0: 696e 206f 7468 6572 2067 7261 7068 2d62  in other graph-b
-00047300: 7569 6c64 696e 6720 6675 6e63 7469 6f6e  uilding function
-00047310: 7320 746f 2063 7265 6174 6520 7468 650a  s to create the.
-00047320: 2020 2020 6170 7072 6f70 7269 6174 6520      appropriate 
-00047330: 6c61 7965 7220 6f66 2074 6865 2072 6573  layer of the res
-00047340: 756c 7469 6e67 2064 6174 6166 7261 6d65  ulting dataframe
-00047350: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00047360: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00047370: 0a20 2020 2066 756e 633a 2063 616c 6c61  .    func: calla
-00047380: 626c 650a 2020 2020 6c61 7965 725f 6e61  ble.    layer_na
-00047390: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
-000473a0: 4465 7363 7269 7074 6976 6520 6e61 6d65  Descriptive name
-000473b0: 2066 6f72 2074 6865 206f 7065 7261 7469   for the operati
-000473c0: 6f6e 2e20 5573 6564 2061 7320 7468 6520  on. Used as the 
-000473d0: 6f75 7470 7574 206e 616d 650a 2020 2020  output name.    
-000473e0: 2020 2020 696e 2074 6865 2072 6573 756c      in the resul
-000473f0: 7469 6e67 2060 6042 6c6f 636b 7769 7365  ting ``Blockwise
-00047400: 6060 2067 7261 7068 206c 6179 6572 2e0a  `` graph layer..
-00047410: 2020 2020 2a61 7267 733a 0a20 2020 202a      *args:.    *
-00047420: 2a6b 7761 7267 733a 0a0a 2020 2020 5265  *kwargs:..    Re
-00047430: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
-00047440: 2d0a 2020 2020 6f75 743a 2042 6c6f 636b  -.    out: Block
-00047450: 7769 7365 2067 7261 7068 0a0a 2020 2020  wise graph..    
-00047460: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-00047470: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 7375  -----.    >>> su
-00047480: 6267 7261 7068 203d 2070 6172 7469 7469  bgraph = partiti
-00047490: 6f6e 7769 7365 5f67 7261 7068 2866 756e  onwise_graph(fun
-000474a0: 6374 696f 6e2c 2078 2c20 792c 207a 3d31  ction, x, y, z=1
-000474b0: 3233 2920 2023 2064 6f63 7465 7374 3a20  23)  # doctest: 
-000474c0: 2b53 4b49 500a 2020 2020 3e3e 3e20 6c61  +SKIP.    >>> la
-000474d0: 7965 7220 3d20 7061 7274 6974 696f 6e77  yer = partitionw
-000474e0: 6973 655f 6772 6170 6828 6675 6e63 7469  ise_graph(functi
-000474f0: 6f6e 2c20 6466 2c20 782c 207a 3d31 3233  on, df, x, z=123
-00047500: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00047510: 4b49 500a 2020 2020 3e3e 3e20 6772 6170  KIP.    >>> grap
-00047520: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
-00047530: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
-00047540: 6f6e 7328 6e61 6d65 2c20 6c61 7965 722c  ons(name, layer,
-00047550: 2064 6570 656e 6465 6e63 6965 733d 5b64   dependencies=[d
-00047560: 662c 2078 5d29 2020 2320 646f 6374 6573  f, x])  # doctes
-00047570: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
-00047580: 2072 6573 756c 7420 3d20 6e65 775f 6464   result = new_dd
-00047590: 5f6f 626a 6563 7428 6772 6170 682c 206e  _object(graph, n
-000475a0: 616d 652c 206d 6574 6164 6174 612c 2064  ame, metadata, d
-000475b0: 662e 6469 7669 7369 6f6e 7329 2020 2320  f.divisions)  # 
-000475c0: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
-000475d0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-000475e0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 6d61   --------.    ma
-000475f0: 705f 7061 7274 6974 696f 6e73 0a20 2020  p_partitions.   
-00047600: 2022 2222 0a20 2020 2070 6169 7273 203d   """.    pairs =
-00047610: 205b 5d0a 2020 2020 6e75 6d62 6c6f 636b   [].    numblock
-00047620: 7320 3d20 7b7d 0a20 2020 2066 6f72 2061  s = {}.    for a
-00047630: 7267 2069 6e20 6172 6773 3a0a 2020 2020  rg in args:.    
-00047640: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00047650: 6528 6172 672c 205f 4672 616d 6529 3a0a  e(arg, _Frame):.
-00047660: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-00047670: 732e 6578 7465 6e64 285b 6172 672e 5f6e  s.extend([arg._n
-00047680: 616d 652c 2022 6922 5d29 0a20 2020 2020  ame, "i"]).     
-00047690: 2020 2020 2020 206e 756d 626c 6f63 6b73         numblocks
-000476a0: 5b61 7267 2e5f 6e61 6d65 5d20 3d20 2861  [arg._name] = (a
-000476b0: 7267 2e6e 7061 7274 6974 696f 6e73 2c29  rg.npartitions,)
-000476c0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-000476d0: 696e 7374 616e 6365 2861 7267 2c20 5363  instance(arg, Sc
-000476e0: 616c 6172 293a 0a20 2020 2020 2020 2020  alar):.         
-000476f0: 2020 2070 6169 7273 2e65 7874 656e 6428     pairs.extend(
-00047700: 5b61 7267 2e5f 6e61 6d65 2c20 2269 225d  [arg._name, "i"]
-00047710: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
-00047720: 6d62 6c6f 636b 735b 6172 672e 5f6e 616d  mblocks[arg._nam
-00047730: 655d 203d 2028 312c 290a 2020 2020 2020  e] = (1,).      
-00047740: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00047750: 6528 6172 672c 2041 7272 6179 293a 0a20  e(arg, Array):. 
-00047760: 2020 2020 2020 2020 2020 2069 6620 6172             if ar
-00047770: 672e 6e64 696d 203d 3d20 313a 0a20 2020  g.ndim == 1:.   
-00047780: 2020 2020 2020 2020 2020 2020 2070 6169               pai
-00047790: 7273 2e65 7874 656e 6428 5b61 7267 2e6e  rs.extend([arg.n
-000477a0: 616d 652c 2022 6922 5d29 0a20 2020 2020  ame, "i"]).     
-000477b0: 2020 2020 2020 2065 6c69 6620 6172 672e         elif arg.
-000477c0: 6e64 696d 203d 3d20 303a 0a20 2020 2020  ndim == 0:.     
-000477d0: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
-000477e0: 2e65 7874 656e 6428 5b61 7267 2e6e 616d  .extend([arg.nam
-000477f0: 652c 2022 225d 290a 2020 2020 2020 2020  e, ""]).        
-00047800: 2020 2020 656c 6966 2061 7267 2e6e 6469      elif arg.ndi
-00047810: 6d20 3d3d 2032 3a0a 2020 2020 2020 2020  m == 2:.        
-00047820: 2020 2020 2020 2020 7061 6972 732e 6578          pairs.ex
-00047830: 7465 6e64 285b 6172 672e 6e61 6d65 2c20  tend([arg.name, 
-00047840: 2269 6a22 5d29 0a20 2020 2020 2020 2020  "ij"]).         
-00047850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00047860: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00047870: 616c 7565 4572 726f 7228 2243 616e 2774  alueError("Can't
-00047880: 2061 6464 206d 756c 7469 2d64 696d 656e   add multi-dimen
-00047890: 7369 6f6e 616c 2061 7272 6179 2074 6f20  sional array to 
-000478a0: 6461 7461 6672 616d 6573 2229 0a20 2020  dataframes").   
-000478b0: 2020 2020 2020 2020 206e 756d 626c 6f63           numbloc
-000478c0: 6b73 5b61 7267 2e5f 6e61 6d65 5d20 3d20  ks[arg._name] = 
-000478d0: 6172 672e 6e75 6d62 6c6f 636b 730a 2020  arg.numblocks.  
-000478e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-000478f0: 7461 6e63 6528 6172 672c 2042 6c6f 636b  tance(arg, Block
-00047900: 7769 7365 4465 7029 3a0a 2020 2020 2020  wiseDep):.      
-00047910: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
-00047920: 2e6e 756d 626c 6f63 6b73 2920 3d3d 2031  .numblocks) == 1
-00047930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00047940: 2020 7061 6972 732e 6578 7465 6e64 285b    pairs.extend([
-00047950: 6172 672c 2022 6922 5d29 0a20 2020 2020  arg, "i"]).     
-00047960: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-00047970: 6172 672e 6e75 6d62 6c6f 636b 7329 203d  arg.numblocks) =
-00047980: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-00047990: 2020 2020 2070 6169 7273 2e65 7874 656e       pairs.exten
-000479a0: 6428 5b61 7267 2c20 2269 6a22 5d29 0a20  d([arg, "ij"]). 
-000479b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000479c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000479d0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000479e0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000479f0: 2020 2020 2020 2066 2242 6c6f 636b 7769         f"Blockwi
-00047a00: 7365 4465 7020 6172 6720 7b61 7267 2172  seDep arg {arg!r
-00047a10: 7d20 6861 7320 7b6c 656e 2861 7267 2e6e  } has {len(arg.n
-00047a20: 756d 626c 6f63 6b73 297d 2064 696d 656e  umblocks)} dimen
-00047a30: 7369 6f6e 733b 206f 6e6c 7920 3120 6f72  sions; only 1 or
-00047a40: 2032 2061 7265 2073 7570 706f 7274 6564   2 are supported
-00047a50: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00047a60: 2020 2029 0a20 2020 2020 2020 2065 6c73     ).        els
-00047a70: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00047a80: 6169 7273 2e65 7874 656e 6428 5b61 7267  airs.extend([arg
-00047a90: 2c20 4e6f 6e65 5d29 0a20 2020 2072 6574  , None]).    ret
-00047aa0: 7572 6e20 626c 6f63 6b77 6973 6528 0a20  urn blockwise(. 
-00047ab0: 2020 2020 2020 2066 756e 632c 206c 6179         func, lay
-00047ac0: 6572 5f6e 616d 652c 2022 6922 2c20 2a70  er_name, "i", *p
-00047ad0: 6169 7273 2c20 6e75 6d62 6c6f 636b 733d  airs, numblocks=
-00047ae0: 6e75 6d62 6c6f 636b 732c 2063 6f6e 6361  numblocks, conca
-00047af0: 7465 6e61 7465 3d54 7275 652c 202a 2a6b  tenate=True, **k
-00047b00: 7761 7267 730a 2020 2020 290a 0a0a 6465  wargs.    )...de
-00047b10: 6620 6d65 7461 5f77 6172 6e69 6e67 2864  f meta_warning(d
-00047b20: 6629 3a0a 2020 2020 2222 220a 2020 2020  f):.    """.    
-00047b30: 5072 6f76 6964 6520 616e 2069 6e66 6f72  Provide an infor
-00047b40: 6d61 7469 7665 206d 6573 7361 6765 2077  mative message w
-00047b50: 6865 6e20 7468 6520 7573 6572 2069 7320  hen the user is 
-00047b60: 6173 6b65 6420 746f 2070 726f 7669 6465  asked to provide
-00047b70: 206d 6574 6164 6174 610a 2020 2020 2222   metadata.    ""
-00047b80: 220a 2020 2020 6966 2069 735f 6461 7461  ".    if is_data
-00047b90: 6672 616d 655f 6c69 6b65 2864 6629 3a0a  frame_like(df):.
-00047ba0: 2020 2020 2020 2020 6d65 7461 5f73 7472          meta_str
-00047bb0: 203d 207b 6b3a 2073 7472 2876 2920 666f   = {k: str(v) fo
-00047bc0: 7220 6b2c 2076 2069 6e20 6466 2e64 7479  r k, v in df.dty
-00047bd0: 7065 732e 746f 5f64 6963 7428 292e 6974  pes.to_dict().it
-00047be0: 656d 7328 297d 0a20 2020 2065 6c69 6620  ems()}.    elif 
-00047bf0: 6973 5f73 6572 6965 735f 6c69 6b65 2864  is_series_like(d
-00047c00: 6629 3a0a 2020 2020 2020 2020 6d65 7461  f):.        meta
-00047c10: 5f73 7472 203d 2028 6466 2e6e 616d 652c  _str = (df.name,
-00047c20: 2073 7472 2864 662e 6474 7970 6529 290a   str(df.dtype)).
-00047c30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00047c40: 2020 6d65 7461 5f73 7472 203d 204e 6f6e    meta_str = Non
-00047c50: 650a 2020 2020 6d73 6720 3d20 280a 2020  e.    msg = (.  
-00047c60: 2020 2020 2020 225c 6e59 6f75 2064 6964        "\nYou did
-00047c70: 206e 6f74 2070 726f 7669 6465 206d 6574   not provide met
-00047c80: 6164 6174 612c 2073 6f20 4461 736b 2069  adata, so Dask i
-00047c90: 7320 7275 6e6e 696e 6720 796f 7572 2022  s running your "
-00047ca0: 0a20 2020 2020 2020 2022 6675 6e63 7469  .        "functi
-00047cb0: 6f6e 206f 6e20 6120 736d 616c 6c20 6461  on on a small da
-00047cc0: 7461 7365 7420 746f 2067 7565 7373 206f  taset to guess o
-00047cd0: 7574 7075 7420 7479 7065 732e 2022 0a20  utput types. ". 
-00047ce0: 2020 2020 2020 2022 4974 2069 7320 706f         "It is po
-00047cf0: 7373 6962 6c65 2074 6861 7420 4461 736b  ssible that Dask
-00047d00: 2077 696c 6c20 6775 6573 7320 696e 636f   will guess inco
-00047d10: 7272 6563 746c 792e 5c6e 220a 2020 2020  rrectly.\n".    
-00047d20: 2020 2020 2254 6f20 7072 6f76 6964 6520      "To provide 
-00047d30: 616e 2065 7870 6c69 6369 7420 6f75 7470  an explicit outp
-00047d40: 7574 2074 7970 6573 206f 7220 746f 2073  ut types or to s
-00047d50: 696c 656e 6365 2074 6869 7320 6d65 7373  ilence this mess
-00047d60: 6167 652c 2022 0a20 2020 2020 2020 2022  age, ".        "
-00047d70: 706c 6561 7365 2070 726f 7669 6465 2074  please provide t
-00047d80: 6865 2060 6d65 7461 3d60 206b 6579 776f  he `meta=` keywo
-00047d90: 7264 2c20 6173 2064 6573 6372 6962 6564  rd, as described
-00047da0: 2069 6e20 7468 6520 6d61 7020 6f72 2022   in the map or "
-00047db0: 0a20 2020 2020 2020 2022 6170 706c 7920  .        "apply 
-00047dc0: 6675 6e63 7469 6f6e 2074 6861 7420 796f  function that yo
-00047dd0: 7520 6172 6520 7573 696e 672e 220a 2020  u are using.".  
-00047de0: 2020 290a 2020 2020 6966 206d 6574 615f    ).    if meta_
-00047df0: 7374 723a 0a20 2020 2020 2020 206d 7367  str:.        msg
-00047e00: 202b 3d20 280a 2020 2020 2020 2020 2020   += (.          
-00047e10: 2020 225c 6e22 0a20 2020 2020 2020 2020    "\n".         
-00047e20: 2020 2022 2020 4265 666f 7265 3a20 2e61     "  Before: .a
-00047e30: 7070 6c79 2866 756e 6329 5c6e 220a 2020  pply(func)\n".  
-00047e40: 2020 2020 2020 2020 2020 2220 2041 6674            "  Aft
-00047e50: 6572 3a20 202e 6170 706c 7928 6675 6e63  er:  .apply(func
-00047e60: 2c20 6d65 7461 3d25 7329 5c6e 2220 2520  , meta=%s)\n" % 
-00047e70: 7374 7228 6d65 7461 5f73 7472 290a 2020  str(meta_str).  
-00047e80: 2020 2020 2020 290a 2020 2020 7265 7475        ).    retu
-00047e90: 726e 206d 7367 0a0a 0a64 6566 2070 7265  rn msg...def pre
-00047ea0: 6669 785f 7265 6475 6374 696f 6e28 662c  fix_reduction(f,
-00047eb0: 2064 6466 2c20 6964 656e 7469 7479 2c20   ddf, identity, 
-00047ec0: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-00047ed0: 2222 436f 6d70 7574 6573 2074 6865 2070  ""Computes the p
-00047ee0: 7265 6669 7820 7375 6d73 206f 6620 6620  refix sums of f 
-00047ef0: 6f6e 2064 660a 0a20 2020 2049 6620 6466  on df..    If df
-00047f00: 2068 6173 2070 6172 7469 7469 6f6e 7320   has partitions 
-00047f10: 5b50 312c 2050 322c 202e 2e2e 2c20 506e  [P1, P2, ..., Pn
-00047f20: 5d2c 2074 6865 6e20 7265 7475 726e 7320  ], then returns 
-00047f30: 7468 6520 4461 7461 4672 616d 6520 7769  the DataFrame wi
-00047f40: 7468 0a20 2020 2070 6172 7469 7469 6f6e  th.    partition
-00047f50: 7320 5b66 2869 6465 6e74 6974 792c 2050  s [f(identity, P
-00047f60: 3129 2c0a 2020 2020 2020 2020 2020 2020  1),.            
-00047f70: 2020 2020 6628 6628 6964 656e 7469 7479      f(f(identity
-00047f80: 2c20 5031 292c 2050 3229 2c0a 2020 2020  , P1), P2),.    
-00047f90: 2020 2020 2020 2020 2020 2020 6628 6628              f(f(
-00047fa0: 6628 6964 656e 7469 7479 2c20 5031 292c  f(identity, P1),
-00047fb0: 2050 3229 2c20 5033 292c 0a20 2020 2020   P2), P3),.     
-00047fc0: 2020 2020 2020 2020 2020 202e 2e2e 5d0a             ...].
-00047fd0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00047fe0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00047ff0: 2020 2066 203a 2063 616c 6c61 626c 650a     f : callable.
-00048000: 2020 2020 2020 2020 616e 2061 7373 6f63          an assoc
-00048010: 6961 7469 7665 2066 756e 6374 696f 6e20  iative function 
-00048020: 660a 2020 2020 6464 6620 3a20 6464 2e44  f.    ddf : dd.D
-00048030: 6174 6146 7261 6d65 0a20 2020 2069 6465  ataFrame.    ide
-00048040: 6e74 6974 7920 3a20 7064 2e44 6174 6146  ntity : pd.DataF
-00048050: 7261 6d65 0a20 2020 2020 2020 2061 6e20  rame.        an 
-00048060: 6964 656e 7469 7479 2065 6c65 6d65 6e74  identity element
-00048070: 206f 6620 662c 2074 6861 7420 6973 2066   of f, that is f
-00048080: 2869 6465 6e74 6974 792c 2064 6629 203d  (identity, df) =
-00048090: 2066 2864 662c 2069 6465 6e74 6974 7929   f(df, identity)
-000480a0: 203d 2064 660a 2020 2020 2222 220a 2020   = df.    """.  
-000480b0: 2020 6473 6b20 3d20 6469 6374 2829 0a20    dsk = dict(). 
-000480c0: 2020 206e 616d 6520 3d20 2270 7265 6669     name = "prefi
-000480d0: 785f 7265 6475 6374 696f 6e2d 2220 2b20  x_reduction-" + 
-000480e0: 746f 6b65 6e69 7a65 2866 2c20 6464 662c  tokenize(f, ddf,
-000480f0: 2069 6465 6e74 6974 792c 202a 2a6b 7761   identity, **kwa
-00048100: 7267 7329 0a20 2020 206d 6574 6120 3d20  rgs).    meta = 
-00048110: 6464 662e 5f6d 6574 610a 2020 2020 6e20  ddf._meta.    n 
-00048120: 3d20 6c65 6e28 6464 662e 6469 7669 7369  = len(ddf.divisi
-00048130: 6f6e 7329 202d 2031 0a20 2020 2064 6976  ons) - 1.    div
-00048140: 6973 696f 6e73 203d 205b 4e6f 6e65 5d20  isions = [None] 
-00048150: 2a20 286e 202b 2031 290a 0a20 2020 204e  * (n + 1)..    N
-00048160: 203d 2031 0a20 2020 2077 6869 6c65 204e   = 1.    while N
-00048170: 203c 206e 3a0a 2020 2020 2020 2020 4e20   < n:.        N 
-00048180: 2a3d 2032 0a20 2020 2066 6f72 2069 2069  *= 2.    for i i
-00048190: 6e20 7261 6e67 6528 6e29 3a0a 2020 2020  n range(n):.    
-000481a0: 2020 2020 6473 6b5b 286e 616d 652c 2069      dsk[(name, i
-000481b0: 2c20 312c 2030 295d 203d 2028 6170 706c  , 1, 0)] = (appl
-000481c0: 792c 2066 2c20 5b28 6464 662e 5f6e 616d  y, f, [(ddf._nam
-000481d0: 652c 2069 292c 2069 6465 6e74 6974 795d  e, i), identity]
-000481e0: 2c20 6b77 6172 6773 290a 2020 2020 666f  , kwargs).    fo
-000481f0: 7220 6920 696e 2072 616e 6765 286e 2c20  r i in range(n, 
-00048200: 4e29 3a0a 2020 2020 2020 2020 6473 6b5b  N):.        dsk[
-00048210: 286e 616d 652c 2069 2c20 312c 2030 295d  (name, i, 1, 0)]
-00048220: 203d 2069 6465 6e74 6974 790a 0a20 2020   = identity..   
-00048230: 2064 203d 2031 0a20 2020 2077 6869 6c65   d = 1.    while
-00048240: 2064 203c 204e 3a0a 2020 2020 2020 2020   d < N:.        
-00048250: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
-00048260: 2c20 4e2c 2032 202a 2064 293a 0a20 2020  , N, 2 * d):.   
-00048270: 2020 2020 2020 2020 2064 736b 5b28 6e61           dsk[(na
-00048280: 6d65 2c20 6920 2b20 3220 2a20 6420 2d20  me, i + 2 * d - 
-00048290: 312c 2032 202a 2064 2c20 3029 5d20 3d20  1, 2 * d, 0)] = 
-000482a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000482b0: 2020 6170 706c 792c 0a20 2020 2020 2020    apply,.       
-000482c0: 2020 2020 2020 2020 2066 2c0a 2020 2020           f,.    
-000482d0: 2020 2020 2020 2020 2020 2020 5b28 6e61              [(na
-000482e0: 6d65 2c20 6920 2b20 6420 2d20 312c 2064  me, i + d - 1, d
-000482f0: 2c20 3029 2c20 286e 616d 652c 2069 202b  , 0), (name, i +
-00048300: 2032 202a 2064 202d 2031 2c20 642c 2030   2 * d - 1, d, 0
-00048310: 295d 2c0a 2020 2020 2020 2020 2020 2020  )],.            
-00048320: 2020 2020 6b77 6172 6773 2c0a 2020 2020      kwargs,.    
-00048330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00048340: 2020 6420 2a3d 2032 0a0a 2020 2020 6473    d *= 2..    ds
-00048350: 6b5b 286e 616d 652c 204e 202d 2031 2c20  k[(name, N - 1, 
-00048360: 4e2c 2031 295d 203d 2069 6465 6e74 6974  N, 1)] = identit
-00048370: 790a 0a20 2020 2077 6869 6c65 2064 203e  y..    while d >
-00048380: 2031 3a0a 2020 2020 2020 2020 6420 2f2f   1:.        d //
-00048390: 3d20 320a 2020 2020 2020 2020 666f 7220  = 2.        for 
-000483a0: 6920 696e 2072 616e 6765 2830 2c20 4e2c  i in range(0, N,
-000483b0: 2032 202a 2064 293a 0a20 2020 2020 2020   2 * d):.       
-000483c0: 2020 2020 2064 736b 5b28 6e61 6d65 2c20       dsk[(name, 
-000483d0: 6920 2b20 6420 2d20 312c 2064 2c20 3129  i + d - 1, d, 1)
-000483e0: 5d20 3d20 286e 616d 652c 2069 202b 2032  ] = (name, i + 2
-000483f0: 202a 2064 202d 2031 2c20 3220 2a20 642c   * d - 1, 2 * d,
-00048400: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
-00048410: 6473 6b5b 286e 616d 652c 2069 202b 2032  dsk[(name, i + 2
-00048420: 202a 2064 202d 2031 2c20 642c 2031 295d   * d - 1, d, 1)]
-00048430: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00048440: 2020 2020 2061 7070 6c79 2c0a 2020 2020       apply,.    
-00048450: 2020 2020 2020 2020 2020 2020 662c 0a20              f,. 
-00048460: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00048470: 286e 616d 652c 2069 202b 2032 202a 2064  (name, i + 2 * d
-00048480: 202d 2031 2c20 3220 2a20 642c 2031 292c   - 1, 2 * d, 1),
-00048490: 2028 6e61 6d65 2c20 6920 2b20 6420 2d20   (name, i + d - 
-000484a0: 312c 2064 2c20 3029 5d2c 0a20 2020 2020  1, d, 0)],.     
-000484b0: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-000484c0: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
-000484d0: 0a0a 2020 2020 666f 7220 6920 696e 2072  ..    for i in r
-000484e0: 616e 6765 286e 293a 0a20 2020 2020 2020  ange(n):.       
-000484f0: 2064 736b 5b28 6e61 6d65 2c20 6929 5d20   dsk[(name, i)] 
-00048500: 3d20 2861 7070 6c79 2c20 662c 205b 286e  = (apply, f, [(n
-00048510: 616d 652c 2069 2c20 312c 2031 292c 2069  ame, i, 1, 1), i
-00048520: 6465 6e74 6974 795d 2c20 6b77 6172 6773  dentity], kwargs
-00048530: 290a 0a20 2020 2067 7261 7068 203d 2048  )..    graph = H
-00048540: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
-00048550: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 286e  om_collections(n
-00048560: 616d 652c 2064 736b 2c20 6465 7065 6e64  ame, dsk, depend
-00048570: 656e 6369 6573 3d5b 6464 665d 290a 2020  encies=[ddf]).  
-00048580: 2020 7265 7475 726e 206e 6577 5f64 645f    return new_dd_
-00048590: 6f62 6a65 6374 2867 7261 7068 2c20 6e61  object(graph, na
-000485a0: 6d65 2c20 6d65 7461 2c20 6469 7669 7369  me, meta, divisi
-000485b0: 6f6e 7329 0a0a 0a64 6566 2073 7566 6669  ons)...def suffi
-000485c0: 785f 7265 6475 6374 696f 6e28 662c 2064  x_reduction(f, d
-000485d0: 6466 2c20 6964 656e 7469 7479 2c20 2a2a  df, identity, **
-000485e0: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
-000485f0: 436f 6d70 7574 6573 2074 6865 2073 7566  Computes the suf
-00048600: 6669 7820 7375 6d73 206f 6620 6620 6f6e  fix sums of f on
-00048610: 2064 660a 0a20 2020 2049 6620 6466 2068   df..    If df h
-00048620: 6173 2070 6172 7469 7469 6f6e 7320 5b50  as partitions [P
-00048630: 312c 2050 322c 202e 2e2e 2c20 506e 5d2c  1, P2, ..., Pn],
-00048640: 2074 6865 6e20 7265 7475 726e 7320 7468   then returns th
-00048650: 6520 4461 7461 4672 616d 6520 7769 7468  e DataFrame with
-00048660: 0a20 2020 2070 6172 7469 7469 6f6e 7320  .    partitions 
-00048670: 5b66 2850 312c 2066 2850 322c 202e 2e2e  [f(P1, f(P2, ...
-00048680: 6628 506e 2c20 6964 656e 7469 7479 292e  f(Pn, identity).
-00048690: 2e2e 2929 2c0a 2020 2020 2020 2020 2020  ..)),.          
-000486a0: 2020 2020 2020 6628 5032 2c20 2e2e 2e66        f(P2, ...f
-000486b0: 2850 6e2c 2069 6465 6e74 6974 7929 2e2e  (Pn, identity)..
-000486c0: 2e29 2c0a 2020 2020 2020 2020 2020 2020  .),.            
-000486d0: 2020 2020 2e2e 2e66 2850 6e2c 2069 6465      ...f(Pn, ide
-000486e0: 6e74 6974 7929 2e2e 2e2c 0a20 2020 2020  ntity)...,.     
-000486f0: 2020 2020 2020 2020 2020 202e 2e2e 5d0a             ...].
-00048700: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00048710: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00048720: 2020 2066 203a 2063 616c 6c61 626c 650a     f : callable.
-00048730: 2020 2020 2020 2020 616e 2061 7373 6f63          an assoc
-00048740: 6961 7469 7665 2066 756e 6374 696f 6e20  iative function 
-00048750: 660a 2020 2020 6464 6620 3a20 6464 2e44  f.    ddf : dd.D
-00048760: 6174 6146 7261 6d65 0a20 2020 2069 6465  ataFrame.    ide
-00048770: 6e74 6974 7920 3a20 7064 2e44 6174 6146  ntity : pd.DataF
-00048780: 7261 6d65 0a20 2020 2020 2020 2061 6e20  rame.        an 
-00048790: 6964 656e 7469 7479 2065 6c65 6d65 6e74  identity element
-000487a0: 206f 6620 662c 2074 6861 7420 6973 2066   of f, that is f
-000487b0: 2869 6465 6e74 6974 792c 2064 6629 203d  (identity, df) =
-000487c0: 2066 2864 662c 2069 6465 6e74 6974 7929   f(df, identity)
-000487d0: 203d 2064 660a 2020 2020 6b77 6172 6773   = df.    kwargs
-000487e0: 203a 203f 3f0a 2020 2020 2020 2020 6b65   : ??.        ke
-000487f0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00048800: 6f66 2066 203f 3f0a 2020 2020 2222 220a  of f ??.    """.
-00048810: 2020 2020 6473 6b20 3d20 6469 6374 2829      dsk = dict()
-00048820: 0a20 2020 206e 616d 6520 3d20 2273 7566  .    name = "suf
-00048830: 6669 785f 7265 6475 6374 696f 6e2d 2220  fix_reduction-" 
-00048840: 2b20 746f 6b65 6e69 7a65 2866 2c20 6464  + tokenize(f, dd
-00048850: 662c 2069 6465 6e74 6974 792c 202a 2a6b  f, identity, **k
-00048860: 7761 7267 7329 0a20 2020 206d 6574 6120  wargs).    meta 
-00048870: 3d20 6464 662e 5f6d 6574 610a 2020 2020  = ddf._meta.    
-00048880: 6e20 3d20 6c65 6e28 6464 662e 6469 7669  n = len(ddf.divi
-00048890: 7369 6f6e 7329 202d 2031 0a20 2020 2064  sions) - 1.    d
-000488a0: 6976 6973 696f 6e73 203d 205b 4e6f 6e65  ivisions = [None
-000488b0: 5d20 2a20 286e 202b 2031 290a 0a20 2020  ] * (n + 1)..   
-000488c0: 204e 203d 2031 0a20 2020 2077 6869 6c65   N = 1.    while
-000488d0: 204e 203c 206e 3a0a 2020 2020 2020 2020   N < n:.        
-000488e0: 4e20 2a3d 2032 0a20 2020 2066 6f72 2069  N *= 2.    for i
-000488f0: 2069 6e20 7261 6e67 6528 6e29 3a0a 2020   in range(n):.  
-00048900: 2020 2020 2020 6473 6b5b 286e 616d 652c        dsk[(name,
-00048910: 2069 2c20 312c 2030 295d 203d 2028 6170   i, 1, 0)] = (ap
-00048920: 706c 792c 2066 2c20 5b28 6464 662e 5f6e  ply, f, [(ddf._n
-00048930: 616d 652c 206e 202d 2031 202d 2069 292c  ame, n - 1 - i),
-00048940: 2069 6465 6e74 6974 795d 2c20 6b77 6172   identity], kwar
-00048950: 6773 290a 2020 2020 666f 7220 6920 696e  gs).    for i in
-00048960: 2072 616e 6765 286e 2c20 4e29 3a0a 2020   range(n, N):.  
-00048970: 2020 2020 2020 6473 6b5b 286e 616d 652c        dsk[(name,
-00048980: 2069 2c20 312c 2030 295d 203d 2069 6465   i, 1, 0)] = ide
-00048990: 6e74 6974 790a 0a20 2020 2064 203d 2031  ntity..    d = 1
-000489a0: 0a20 2020 2077 6869 6c65 2064 203c 204e  .    while d < N
-000489b0: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-000489c0: 696e 2072 616e 6765 2830 2c20 4e2c 2032  in range(0, N, 2
-000489d0: 202a 2064 293a 0a20 2020 2020 2020 2020   * d):.         
-000489e0: 2020 2064 736b 5b28 6e61 6d65 2c20 6920     dsk[(name, i 
-000489f0: 2b20 3220 2a20 6420 2d20 312c 2032 202a  + 2 * d - 1, 2 *
-00048a00: 2064 2c20 3029 5d20 3d20 280a 2020 2020   d, 0)] = (.    
-00048a10: 2020 2020 2020 2020 2020 2020 6170 706c              appl
-00048a20: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-00048a30: 2020 2066 2c0a 2020 2020 2020 2020 2020     f,.          
-00048a40: 2020 2020 2020 5b28 6e61 6d65 2c20 6920        [(name, i 
-00048a50: 2b20 3220 2a20 6420 2d20 312c 2064 2c20  + 2 * d - 1, d, 
-00048a60: 3029 2c20 286e 616d 652c 2069 202b 2064  0), (name, i + d
-00048a70: 202d 2031 2c20 642c 2030 295d 2c0a 2020   - 1, d, 0)],.  
-00048a80: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
-00048a90: 6172 6773 2c0a 2020 2020 2020 2020 2020  args,.          
-00048aa0: 2020 290a 2020 2020 2020 2020 6420 2a3d    ).        d *=
-00048ab0: 2032 0a0a 2020 2020 6473 6b5b 286e 616d   2..    dsk[(nam
-00048ac0: 652c 204e 202d 2031 2c20 4e2c 2031 295d  e, N - 1, N, 1)]
-00048ad0: 203d 2069 6465 6e74 6974 790a 0a20 2020   = identity..   
-00048ae0: 2077 6869 6c65 2064 203e 2031 3a0a 2020   while d > 1:.  
-00048af0: 2020 2020 2020 6420 2f2f 3d20 320a 2020        d //= 2.  
-00048b00: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-00048b10: 616e 6765 2830 2c20 4e2c 2032 202a 2064  ange(0, N, 2 * d
-00048b20: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-00048b30: 736b 5b28 6e61 6d65 2c20 6920 2b20 6420  sk[(name, i + d 
-00048b40: 2d20 312c 2064 2c20 3129 5d20 3d20 286e  - 1, d, 1)] = (n
-00048b50: 616d 652c 2069 202b 2032 202a 2064 202d  ame, i + 2 * d -
-00048b60: 2031 2c20 3220 2a20 642c 2031 290a 2020   1, 2 * d, 1).  
-00048b70: 2020 2020 2020 2020 2020 6473 6b5b 286e            dsk[(n
-00048b80: 616d 652c 2069 202b 2032 202a 2064 202d  ame, i + 2 * d -
-00048b90: 2031 2c20 642c 2031 295d 203d 2028 0a20   1, d, 1)] = (. 
-00048ba0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00048bb0: 7070 6c79 2c0a 2020 2020 2020 2020 2020  pply,.          
-00048bc0: 2020 2020 2020 662c 0a20 2020 2020 2020        f,.       
-00048bd0: 2020 2020 2020 2020 205b 286e 616d 652c           [(name,
-00048be0: 2069 202b 2064 202d 2031 2c20 642c 2030   i + d - 1, d, 0
-00048bf0: 292c 2028 6e61 6d65 2c20 6920 2b20 3220  ), (name, i + 2 
-00048c00: 2a20 6420 2d20 312c 2032 202a 2064 2c20  * d - 1, 2 * d, 
-00048c10: 3129 5d2c 0a20 2020 2020 2020 2020 2020  1)],.           
-00048c20: 2020 2020 206b 7761 7267 732c 0a20 2020       kwargs,.   
-00048c30: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00048c40: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
-00048c50: 293a 0a20 2020 2020 2020 2064 736b 5b28  ):.        dsk[(
-00048c60: 6e61 6d65 2c20 6929 5d20 3d20 2861 7070  name, i)] = (app
-00048c70: 6c79 2c20 662c 205b 286e 616d 652c 206e  ly, f, [(name, n
-00048c80: 202d 2031 202d 2069 2c20 312c 2031 292c   - 1 - i, 1, 1),
-00048c90: 2069 6465 6e74 6974 795d 2c20 6b77 6172   identity], kwar
-00048ca0: 6773 290a 0a20 2020 2067 7261 7068 203d  gs)..    graph =
-00048cb0: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
-00048cc0: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
-00048cd0: 286e 616d 652c 2064 736b 2c20 6465 7065  (name, dsk, depe
-00048ce0: 6e64 656e 6369 6573 3d5b 6464 665d 290a  ndencies=[ddf]).
-00048cf0: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
-00048d00: 645f 6f62 6a65 6374 2867 7261 7068 2c20  d_object(graph, 
-00048d10: 6e61 6d65 2c20 6d65 7461 2c20 6469 7669  name, meta, divi
-00048d20: 7369 6f6e 7329 0a0a 0a64 6566 206d 6170  sions)...def map
-00048d30: 7365 7269 6573 2862 6173 655f 6368 756e  series(base_chun
-00048d40: 6b2c 2063 6f6e 6361 745f 6d61 7029 3a0a  k, concat_map):.
-00048d50: 2020 2020 7265 7475 726e 2062 6173 655f      return base_
-00048d60: 6368 756e 6b2e 6d61 7028 636f 6e63 6174  chunk.map(concat
-00048d70: 5f6d 6170 290a 0a0a 6465 6620 6d61 7073  _map)...def maps
-00048d80: 6572 6965 735f 636f 6d62 696e 6528 696e  eries_combine(in
-00048d90: 6465 782c 2063 6f6e 6361 745f 7265 7375  dex, concat_resu
-00048da0: 6c74 293a 0a20 2020 2066 696e 616c 5f73  lt):.    final_s
-00048db0: 6572 6965 7320 3d20 636f 6e63 6174 5f72  eries = concat_r
-00048dc0: 6573 756c 742e 736f 7274 5f69 6e64 6578  esult.sort_index
-00048dd0: 2829 0a20 2020 2066 696e 616c 5f73 6572  ().    final_ser
-00048de0: 6965 7320 3d20 696e 6465 782e 746f 5f73  ies = index.to_s
-00048df0: 6572 6965 7328 292e 6d61 7028 6669 6e61  eries().map(fina
-00048e00: 6c5f 7365 7269 6573 290a 2020 2020 7265  l_series).    re
-00048e10: 7475 726e 2066 696e 616c 5f73 6572 6965  turn final_serie
-00048e20: 730a 0a0a 6465 6620 7365 7269 6573 5f6d  s...def series_m
-00048e30: 6170 2862 6173 655f 7365 7269 6573 2c20  ap(base_series, 
-00048e40: 6d61 705f 7365 7269 6573 293a 0a20 2020  map_series):.   
-00048e50: 206e 7061 7274 6974 696f 6e73 203d 2062   npartitions = b
-00048e60: 6173 655f 7365 7269 6573 2e6e 7061 7274  ase_series.npart
-00048e70: 6974 696f 6e73 0a20 2020 2073 706c 6974  itions.    split
-00048e80: 5f6f 7574 203d 206d 6170 5f73 6572 6965  _out = map_serie
-00048e90: 732e 6e70 6172 7469 7469 6f6e 730a 0a20  s.npartitions.. 
-00048ea0: 2020 2064 736b 203d 207b 7d0a 0a20 2020     dsk = {}..   
-00048eb0: 2062 6173 655f 746f 6b65 6e5f 6b65 7920   base_token_key 
-00048ec0: 3d20 746f 6b65 6e69 7a65 2862 6173 655f  = tokenize(base_
-00048ed0: 7365 7269 6573 2c20 7370 6c69 745f 6f75  series, split_ou
-00048ee0: 7429 0a20 2020 2062 6173 655f 7370 6c69  t).    base_spli
-00048ef0: 745f 7072 6566 6978 203d 2066 2262 6173  t_prefix = f"bas
-00048f00: 652d 7370 6c69 742d 7b62 6173 655f 746f  e-split-{base_to
-00048f10: 6b65 6e5f 6b65 797d 220a 2020 2020 6261  ken_key}".    ba
-00048f20: 7365 5f73 6861 7264 5f70 7265 6669 7820  se_shard_prefix 
-00048f30: 3d20 6622 6261 7365 2d73 6861 7264 2d7b  = f"base-shard-{
-00048f40: 6261 7365 5f74 6f6b 656e 5f6b 6579 7d22  base_token_key}"
-00048f50: 0a20 2020 2066 6f72 2069 2c20 6b65 7920  .    for i, key 
-00048f60: 696e 2065 6e75 6d65 7261 7465 2862 6173  in enumerate(bas
-00048f70: 655f 7365 7269 6573 2e5f 5f64 6173 6b5f  e_series.__dask_
-00048f80: 6b65 7973 5f5f 2829 293a 0a20 2020 2020  keys__()):.     
-00048f90: 2020 2064 736b 5b28 6261 7365 5f73 706c     dsk[(base_spl
-00048fa0: 6974 5f70 7265 6669 782c 2069 295d 203d  it_prefix, i)] =
-00048fb0: 2028 6861 7368 5f73 6861 7264 2c20 6b65   (hash_shard, ke
-00048fc0: 792c 2073 706c 6974 5f6f 7574 290a 2020  y, split_out).  
-00048fd0: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-00048fe0: 616e 6765 2873 706c 6974 5f6f 7574 293a  ange(split_out):
-00048ff0: 0a20 2020 2020 2020 2020 2020 2064 736b  .            dsk
-00049000: 5b28 6261 7365 5f73 6861 7264 5f70 7265  [(base_shard_pre
-00049010: 6669 782c 2030 2c20 692c 206a 295d 203d  fix, 0, i, j)] =
-00049020: 2028 6765 7469 7465 6d2c 2028 6261 7365   (getitem, (base
-00049030: 5f73 706c 6974 5f70 7265 6669 782c 2069  _split_prefix, i
-00049040: 292c 206a 290a 0a20 2020 206d 6170 5f74  ), j)..    map_t
-00049050: 6f6b 656e 5f6b 6579 203d 2074 6f6b 656e  oken_key = token
-00049060: 697a 6528 6d61 705f 7365 7269 6573 290a  ize(map_series).
-00049070: 2020 2020 6d61 705f 7370 6c69 745f 7072      map_split_pr
-00049080: 6566 6978 203d 2066 226d 6170 2d73 706c  efix = f"map-spl
-00049090: 6974 2d7b 6d61 705f 746f 6b65 6e5f 6b65  it-{map_token_ke
-000490a0: 797d 220a 2020 2020 6d61 705f 7368 6172  y}".    map_shar
-000490b0: 645f 7072 6566 6978 203d 2066 226d 6170  d_prefix = f"map
-000490c0: 2d73 6861 7264 2d7b 6d61 705f 746f 6b65  -shard-{map_toke
-000490d0: 6e5f 6b65 797d 220a 2020 2020 666f 7220  n_key}".    for 
-000490e0: 692c 206b 6579 2069 6e20 656e 756d 6572  i, key in enumer
-000490f0: 6174 6528 6d61 705f 7365 7269 6573 2e5f  ate(map_series._
-00049100: 5f64 6173 6b5f 6b65 7973 5f5f 2829 293a  _dask_keys__()):
-00049110: 0a20 2020 2020 2020 2064 736b 5b28 6d61  .        dsk[(ma
-00049120: 705f 7370 6c69 745f 7072 6566 6978 2c20  p_split_prefix, 
-00049130: 6929 5d20 3d20 280a 2020 2020 2020 2020  i)] = (.        
-00049140: 2020 2020 6861 7368 5f73 6861 7264 2c0a      hash_shard,.
-00049150: 2020 2020 2020 2020 2020 2020 6b65 792c              key,
-00049160: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
-00049170: 6974 5f6f 7574 2c0a 2020 2020 2020 2020  it_out,.        
-00049180: 2020 2020 7370 6c69 745f 6f75 745f 6f6e      split_out_on
-00049190: 5f69 6e64 6578 2c0a 2020 2020 2020 2020  _index,.        
-000491a0: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
-000491b0: 2020 290a 2020 2020 2020 2020 666f 7220    ).        for 
-000491c0: 6a20 696e 2072 616e 6765 2873 706c 6974  j in range(split
-000491d0: 5f6f 7574 293a 0a20 2020 2020 2020 2020  _out):.         
-000491e0: 2020 2064 736b 5b28 6d61 705f 7368 6172     dsk[(map_shar
-000491f0: 645f 7072 6566 6978 2c20 302c 2069 2c20  d_prefix, 0, i, 
-00049200: 6a29 5d20 3d20 2867 6574 6974 656d 2c20  j)] = (getitem, 
-00049210: 286d 6170 5f73 706c 6974 5f70 7265 6669  (map_split_prefi
-00049220: 782c 2069 292c 206a 290a 0a20 2020 2074  x, i), j)..    t
-00049230: 6f6b 656e 5f6b 6579 203d 2074 6f6b 656e  oken_key = token
-00049240: 697a 6528 6261 7365 5f73 6572 6965 732c  ize(base_series,
-00049250: 206d 6170 5f73 6572 6965 7329 0a20 2020   map_series).   
-00049260: 206d 6170 5f70 7265 6669 7820 3d20 6622   map_prefix = f"
-00049270: 6d61 702d 7365 7269 6573 2d7b 746f 6b65  map-series-{toke
-00049280: 6e5f 6b65 797d 220a 2020 2020 666f 7220  n_key}".    for 
-00049290: 6920 696e 2072 616e 6765 286e 7061 7274  i in range(npart
-000492a0: 6974 696f 6e73 293a 0a20 2020 2020 2020  itions):.       
-000492b0: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
-000492c0: 7370 6c69 745f 6f75 7429 3a0a 2020 2020  split_out):.    
-000492d0: 2020 2020 2020 2020 6473 6b5b 286d 6170          dsk[(map
-000492e0: 5f70 7265 6669 782c 2069 2c20 6a29 5d20  _prefix, i, j)] 
-000492f0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00049300: 2020 2020 6d61 7073 6572 6965 732c 0a20      mapseries,. 
-00049310: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00049320: 6261 7365 5f73 6861 7264 5f70 7265 6669  base_shard_prefi
-00049330: 782c 2030 2c20 692c 206a 292c 0a20 2020  x, 0, i, j),.   
-00049340: 2020 2020 2020 2020 2020 2020 2028 5f63               (_c
-00049350: 6f6e 6361 742c 205b 286d 6170 5f73 6861  oncat, [(map_sha
-00049360: 7264 5f70 7265 6669 782c 2030 2c20 6b2c  rd_prefix, 0, k,
-00049370: 206a 2920 666f 7220 6b20 696e 2072 616e   j) for k in ran
-00049380: 6765 2873 706c 6974 5f6f 7574 295d 292c  ge(split_out)]),
-00049390: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-000493a0: 2020 2020 6669 6e61 6c5f 7072 6566 6978      final_prefix
-000493b0: 203d 2066 226d 6170 2d73 6572 6965 732d   = f"map-series-
-000493c0: 636f 6d62 696e 652d 7b74 6f6b 656e 5f6b  combine-{token_k
-000493d0: 6579 7d22 0a20 2020 2066 6f72 2069 2c20  ey}".    for i, 
-000493e0: 6b65 7920 696e 2065 6e75 6d65 7261 7465  key in enumerate
-000493f0: 2862 6173 655f 7365 7269 6573 2e69 6e64  (base_series.ind
-00049400: 6578 2e5f 5f64 6173 6b5f 6b65 7973 5f5f  ex.__dask_keys__
-00049410: 2829 293a 0a20 2020 2020 2020 2064 736b  ()):.        dsk
-00049420: 5b28 6669 6e61 6c5f 7072 6566 6978 2c20  [(final_prefix, 
-00049430: 6929 5d20 3d20 280a 2020 2020 2020 2020  i)] = (.        
-00049440: 2020 2020 6d61 7073 6572 6965 735f 636f      mapseries_co
-00049450: 6d62 696e 652c 0a20 2020 2020 2020 2020  mbine,.         
-00049460: 2020 206b 6579 2c0a 2020 2020 2020 2020     key,.        
-00049470: 2020 2020 285f 636f 6e63 6174 2c20 5b28      (_concat, [(
-00049480: 6d61 705f 7072 6566 6978 2c20 692c 206a  map_prefix, i, j
-00049490: 2920 666f 7220 6a20 696e 2072 616e 6765  ) for j in range
-000494a0: 2873 706c 6974 5f6f 7574 295d 292c 0a20  (split_out)]),. 
-000494b0: 2020 2020 2020 2029 0a0a 2020 2020 6d65         )..    me
-000494c0: 7461 203d 206d 6170 5f73 6572 6965 732e  ta = map_series.
-000494d0: 5f6d 6574 612e 636f 7079 2829 0a20 2020  _meta.copy().   
-000494e0: 206d 6574 612e 696e 6465 7820 3d20 6261   meta.index = ba
-000494f0: 7365 5f73 6572 6965 732e 5f6d 6574 612e  se_series._meta.
-00049500: 696e 6465 780a 2020 2020 6d65 7461 203d  index.    meta =
-00049510: 206d 616b 655f 6d65 7461 286d 6574 6129   make_meta(meta)
-00049520: 0a0a 2020 2020 6465 7065 6e64 656e 6369  ..    dependenci
-00049530: 6573 203d 205b 6261 7365 5f73 6572 6965  es = [base_serie
-00049540: 732c 206d 6170 5f73 6572 6965 732c 2062  s, map_series, b
-00049550: 6173 655f 7365 7269 6573 2e69 6e64 6578  ase_series.index
-00049560: 5d0a 2020 2020 6772 6170 6820 3d20 4869  ].    graph = Hi
-00049570: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-00049580: 6d5f 636f 6c6c 6563 7469 6f6e 7328 0a20  m_collections(. 
-00049590: 2020 2020 2020 2066 696e 616c 5f70 7265         final_pre
-000495a0: 6669 782c 2064 736b 2c20 6465 7065 6e64  fix, dsk, depend
-000495b0: 656e 6369 6573 3d64 6570 656e 6465 6e63  encies=dependenc
-000495c0: 6965 730a 2020 2020 290a 2020 2020 6469  ies.    ).    di
-000495d0: 7669 7369 6f6e 7320 3d20 6c69 7374 2862  visions = list(b
-000495e0: 6173 655f 7365 7269 6573 2e64 6976 6973  ase_series.divis
-000495f0: 696f 6e73 290a 0a20 2020 2072 6574 7572  ions)..    retur
-00049600: 6e20 6e65 775f 6464 5f6f 626a 6563 7428  n new_dd_object(
-00049610: 6772 6170 682c 2066 696e 616c 5f70 7265  graph, final_pre
-00049620: 6669 782c 206d 6574 612c 2064 6976 6973  fix, meta, divis
-00049630: 696f 6e73 290a 0a0a 6465 6620 5f63 6f6e  ions)...def _con
-00049640: 7665 7274 5f74 6f5f 6e75 6d65 7269 6328  vert_to_numeric(
-00049650: 7365 7269 6573 2c20 736b 6970 6e61 293a  series, skipna):
-00049660: 0a20 2020 2069 6620 736b 6970 6e61 3a0a  .    if skipna:.
-00049670: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00049680: 6572 6965 732e 6472 6f70 6e61 2829 2e76  eries.dropna().v
-00049690: 6965 7728 2269 3822 290a 0a20 2020 2023  iew("i8")..    #
-000496a0: 2073 6572 6965 732e 7669 6577 2822 6938   series.view("i8
-000496b0: 2229 2077 6974 6820 7064 2e4e 6154 2070  ") with pd.NaT p
-000496c0: 726f 6475 6365 7320 2d39 3232 3333 3732  roduces -9223372
-000496d0: 3033 3638 3534 3737 3538 3038 2069 7320  036854775808 is 
-000496e0: 7768 7920 7765 206e 6565 6420 746f 2064  why we need to d
-000496f0: 6f20 7468 6973 0a20 2020 2072 6574 7572  o this.    retur
-00049700: 6e20 7365 7269 6573 2e76 6965 7728 2269  n series.view("i
-00049710: 3822 292e 6d61 736b 2873 6572 6965 732e  8").mask(series.
-00049720: 6973 6e75 6c6c 2829 2c20 6e70 2e6e 616e  isnull(), np.nan
-00049730: 290a 0a0a 6465 6620 5f73 7172 745f 616e  )...def _sqrt_an
-00049740: 645f 636f 6e76 6572 745f 746f 5f74 696d  d_convert_to_tim
-00049750: 6564 656c 7461 2870 6172 7469 7469 6f6e  edelta(partition
-00049760: 2c20 6178 6973 2c20 6474 7970 653d 4e6f  , axis, dtype=No
-00049770: 6e65 2c20 2a61 7267 732c 202a 2a6b 7761  ne, *args, **kwa
-00049780: 7267 7329 3a0a 2020 2020 6966 2061 7869  rgs):.    if axi
-00049790: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
-000497a0: 7769 7468 2077 6172 6e69 6e67 732e 6361  with warnings.ca
-000497b0: 7463 685f 7761 726e 696e 6773 2829 3a0a  tch_warnings():.
-000497c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-000497d0: 696e 6773 2e66 696c 7465 7277 6172 6e69  ings.filterwarni
-000497e0: 6e67 7328 0a20 2020 2020 2020 2020 2020  ngs(.           
-000497f0: 2020 2020 2022 6967 6e6f 7265 222c 0a20       "ignore",. 
-00049800: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00049810: 6174 6567 6f72 793d 5275 6e74 696d 6557  ategory=RuntimeW
-00049820: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
-00049830: 2020 2020 2020 2020 6d65 7373 6167 653d          message=
-00049840: 2269 6e76 616c 6964 2076 616c 7565 2065  "invalid value e
-00049850: 6e63 6f75 6e74 6572 6564 2069 6e20 6361  ncountered in ca
-00049860: 7374 222c 0a20 2020 2020 2020 2020 2020  st",.           
-00049870: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
-00049880: 6574 7572 6e20 7064 2e74 6f5f 7469 6d65  eturn pd.to_time
-00049890: 6465 6c74 6128 4d2e 7374 6428 7061 7274  delta(M.std(part
-000498a0: 6974 696f 6e2c 2061 7869 733d 6178 6973  ition, axis=axis
-000498b0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-000498c0: 7329 290a 0a20 2020 2069 735f 6466 5f6c  s))..    is_df_l
-000498d0: 696b 652c 2074 696d 655f 636f 6c73 203d  ike, time_cols =
-000498e0: 206b 7761 7267 735b 2269 735f 6466 5f6c   kwargs["is_df_l
-000498f0: 696b 6522 5d2c 206b 7761 7267 735b 2274  ike"], kwargs["t
-00049900: 696d 655f 636f 6c73 225d 0a0a 2020 2020  ime_cols"]..    
-00049910: 7371 7274 203d 206e 702e 7371 7274 2870  sqrt = np.sqrt(p
-00049920: 6172 7469 7469 6f6e 290a 0a20 2020 2069  artition)..    i
-00049930: 6620 6e6f 7420 6973 5f64 665f 6c69 6b65  f not is_df_like
-00049940: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00049950: 2070 642e 746f 5f74 696d 6564 656c 7461   pd.to_timedelta
-00049960: 2873 7172 7429 0a0a 2020 2020 7469 6d65  (sqrt)..    time
-00049970: 5f63 6f6c 5f6d 6173 6b20 3d20 7371 7274  _col_mask = sqrt
-00049980: 2e69 6e64 6578 2e69 7369 6e28 7469 6d65  .index.isin(time
-00049990: 5f63 6f6c 7329 0a20 2020 206d 6174 6368  _cols).    match
-000499a0: 696e 675f 7661 6c73 203d 2073 7172 745b  ing_vals = sqrt[
-000499b0: 7469 6d65 5f63 6f6c 5f6d 6173 6b5d 0a20  time_col_mask]. 
-000499c0: 2020 2066 6f72 2074 696d 655f 636f 6c2c     for time_col,
-000499d0: 206d 6174 6368 696e 675f 7661 6c20 696e   matching_val in
-000499e0: 207a 6970 2874 696d 655f 636f 6c73 2c20   zip(time_cols, 
-000499f0: 6d61 7463 6869 6e67 5f76 616c 7329 3a0a  matching_vals):.
-00049a00: 2020 2020 2020 2020 7371 7274 5b74 696d          sqrt[tim
-00049a10: 655f 636f 6c5d 203d 2070 642e 746f 5f74  e_col] = pd.to_t
-00049a20: 696d 6564 656c 7461 286d 6174 6368 696e  imedelta(matchin
-00049a30: 675f 7661 6c29 0a0a 2020 2020 6966 2064  g_val)..    if d
-00049a40: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
-00049a50: 3a0a 2020 2020 2020 2020 7371 7274 203d  :.        sqrt =
-00049a60: 2073 7172 742e 6173 7479 7065 2864 7479   sqrt.astype(dty
-00049a70: 7065 290a 2020 2020 7265 7475 726e 2073  pe).    return s
-00049a80: 7172 740a 0a0a 6465 6620 5f72 6169 7365  qrt...def _raise
-00049a90: 5f69 665f 6e6f 745f 7365 7269 6573 5f6f  _if_not_series_o
-00049aa0: 725f 6461 7461 6672 616d 6528 782c 2066  r_dataframe(x, f
-00049ab0: 756e 636e 616d 6529 3a0a 2020 2020 2222  uncname):.    ""
-00049ac0: 220a 2020 2020 5574 696c 6974 7920 6675  ".    Utility fu
-00049ad0: 6e63 7469 6f6e 2074 6f20 7261 6973 6520  nction to raise 
-00049ae0: 616e 2065 7272 6f72 2069 6620 616e 206f  an error if an o
-00049af0: 626a 6563 7420 6973 206e 6f74 2061 2053  bject is not a S
-00049b00: 6572 6965 7320 6f72 2044 6174 6146 7261  eries or DataFra
-00049b10: 6d65 0a20 2020 2022 2222 0a20 2020 2069  me.    """.    i
-00049b20: 6620 6e6f 7420 6973 5f73 6572 6965 735f  f not is_series_
-00049b30: 6c69 6b65 2878 2920 616e 6420 6e6f 7420  like(x) and not 
-00049b40: 6973 5f64 6174 6166 7261 6d65 5f6c 696b  is_dataframe_lik
-00049b50: 6528 7829 3a0a 2020 2020 2020 2020 7261  e(x):.        ra
-00049b60: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
-00049b70: 6564 4572 726f 7228 0a20 2020 2020 2020  edError(.       
-00049b80: 2020 2020 2022 6025 7360 2069 7320 6f6e       "`%s` is on
-00049b90: 6c79 2073 7570 706f 7274 6564 2077 6974  ly supported wit
-00049ba0: 6820 6f62 6a65 6374 7320 7468 6174 2061  h objects that a
-00049bb0: 7265 2044 6174 6166 7261 6d65 7320 6f72  re Dataframes or
-00049bc0: 2053 6572 6965 7322 0a20 2020 2020 2020   Series".       
-00049bd0: 2020 2020 2025 2066 756e 636e 616d 650a       % funcname.
-00049be0: 2020 2020 2020 2020 290a 0a0a 6465 6620          )...def 
-00049bf0: 5f67 6574 6174 7472 5f6e 756d 6572 6963  _getattr_numeric
-00049c00: 5f6f 6e6c 7928 2a61 7267 732c 205f 6461  _only(*args, _da
-00049c10: 736b 5f6d 6574 686f 645f 6e61 6d65 2c20  sk_method_name, 
-00049c20: 2a2a 6b77 6172 6773 293a 0a20 2020 2077  **kwargs):.    w
-00049c30: 6974 6820 6368 6563 6b5f 6e75 6d65 7269  ith check_numeri
-00049c40: 635f 6f6e 6c79 5f64 6570 7265 6361 7469  c_only_deprecati
-00049c50: 6f6e 2829 3a0a 2020 2020 2020 2020 7265  on():.        re
-00049c60: 7475 726e 2067 6574 6174 7472 284d 2c20  turn getattr(M, 
-00049c70: 5f64 6173 6b5f 6d65 7468 6f64 5f6e 616d  _dask_method_nam
-00049c80: 6529 282a 6172 6773 2c20 2a2a 6b77 6172  e)(*args, **kwar
-00049c90: 6773 290a                                gs).
+00033d80: 2020 6f70 2c0a 2020 2020 2020 2020 2020    op,.          
+00033d90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00033da0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00033db0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+00033dc0: 723d 6f74 6865 722c 0a20 2020 2020 2020  r=other,.       
+00033dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033de0: 206d 6574 613d 6d65 7461 2c0a 2020 2020   meta=meta,.    
+00033df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e00: 2020 2020 6178 6973 3d61 7869 732c 0a20      axis=axis,. 
+00033e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e20: 2020 2020 2020 2066 696c 6c5f 7661 6c75         fill_valu
+00033e30: 653d 6669 6c6c 5f76 616c 7565 2c0a 2020  e=fill_value,.  
+00033e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e50: 2020 2020 2020 656e 666f 7263 655f 6d65        enforce_me
+00033e60: 7461 6461 7461 3d46 616c 7365 2c0a 2020  tadata=False,.  
+00033e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033e80: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00033e90: 206d 6574 6120 3d20 5f65 6d75 6c61 7465   meta = _emulate
+00033ea0: 286f 702c 2073 656c 662c 206f 7468 6572  (op, self, other
+00033eb0: 2c20 6178 6973 3d61 7869 732c 2066 696c  , axis=axis, fil
+00033ec0: 6c5f 7661 6c75 653d 6669 6c6c 5f76 616c  l_value=fill_val
+00033ed0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00033ee0: 7265 7475 726e 206d 6170 5f70 6172 7469  return map_parti
+00033ef0: 7469 6f6e 7328 0a20 2020 2020 2020 2020  tions(.         
+00033f00: 2020 2020 2020 206f 702c 0a20 2020 2020         op,.     
+00033f10: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00033f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00033f30: 206f 7468 6572 2c0a 2020 2020 2020 2020   other,.        
+00033f40: 2020 2020 2020 2020 6d65 7461 3d6d 6574          meta=met
+00033f50: 612c 0a20 2020 2020 2020 2020 2020 2020  a,.             
+00033f60: 2020 2061 7869 733d 6178 6973 2c0a 2020     axis=axis,.  
+00033f70: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00033f80: 6c6c 5f76 616c 7565 3d66 696c 6c5f 7661  ll_value=fill_va
+00033f90: 6c75 652c 0a20 2020 2020 2020 2020 2020  lue,.           
+00033fa0: 2020 2020 2065 6e66 6f72 6365 5f6d 6574       enforce_met
+00033fb0: 6164 6174 613d 4661 6c73 652c 0a20 2020  adata=False,.   
+00033fc0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00033fd0: 2020 2020 6d65 7468 2e5f 5f6e 616d 655f      meth.__name_
+00033fe0: 5f20 3d20 6e61 6d65 0a20 2020 2020 2020  _ = name.       
+00033ff0: 2073 6574 6174 7472 2863 6c73 2c20 6e61   setattr(cls, na
+00034000: 6d65 2c20 6465 7269 7665 645f 6672 6f6d  me, derived_from
+00034010: 286f 7269 6769 6e61 6c29 286d 6574 6829  (original)(meth)
+00034020: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00034030: 686f 640a 2020 2020 6465 6620 5f62 696e  hod.    def _bin
+00034040: 645f 636f 6d70 6172 6973 6f6e 5f6d 6574  d_comparison_met
+00034050: 686f 6428 636c 732c 206e 616d 652c 2063  hod(cls, name, c
+00034060: 6f6d 7061 7269 736f 6e2c 206f 7269 6769  omparison, origi
+00034070: 6e61 6c3d 7064 2e44 6174 6146 7261 6d65  nal=pd.DataFrame
+00034080: 293a 0a20 2020 2020 2020 2022 2222 6269  ):.        """bi
+00034090: 6e64 2063 6f6d 7061 7269 736f 6e20 6d65  nd comparison me
+000340a0: 7468 6f64 206c 696b 6520 4461 7461 4672  thod like DataFr
+000340b0: 616d 652e 6571 2074 6f20 7468 6973 2063  ame.eq to this c
+000340c0: 6c61 7373 2222 220a 0a20 2020 2020 2020  lass"""..       
+000340d0: 2064 6566 206d 6574 6828 7365 6c66 2c20   def meth(self, 
+000340e0: 6f74 6865 722c 2061 7869 733d 2263 6f6c  other, axis="col
+000340f0: 756d 6e73 222c 206c 6576 656c 3d4e 6f6e  umns", level=Non
+00034100: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00034110: 6966 206c 6576 656c 2069 7320 6e6f 7420  if level is not 
+00034120: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00034130: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+00034140: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+00034150: 226c 6576 656c 206d 7573 7420 6265 204e  "level must be N
+00034160: 6f6e 6522 290a 2020 2020 2020 2020 2020  one").          
+00034170: 2020 6178 6973 203d 2073 656c 662e 5f76    axis = self._v
+00034180: 616c 6964 6174 655f 6178 6973 2861 7869  alidate_axis(axi
+00034190: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+000341a0: 6574 7572 6e20 656c 656d 7769 7365 2863  eturn elemwise(c
+000341b0: 6f6d 7061 7269 736f 6e2c 2073 656c 662c  omparison, self,
+000341c0: 206f 7468 6572 2c20 6178 6973 3d61 7869   other, axis=axi
+000341d0: 7329 0a0a 2020 2020 2020 2020 6d65 7468  s)..        meth
+000341e0: 2e5f 5f6e 616d 655f 5f20 3d20 6e61 6d65  .__name__ = name
+000341f0: 0a20 2020 2020 2020 2073 6574 6174 7472  .        setattr
+00034200: 2863 6c73 2c20 6e61 6d65 2c20 6465 7269  (cls, name, deri
+00034210: 7665 645f 6672 6f6d 286f 7269 6769 6e61  ved_from(origina
+00034220: 6c29 286d 6574 6829 290a 0a20 2020 2040  l)(meth))..    @
+00034230: 696e 7365 7274 5f6d 6574 615f 7061 7261  insert_meta_para
+00034240: 6d5f 6465 7363 7269 7074 696f 6e28 7061  m_description(pa
+00034250: 643d 3132 290a 2020 2020 6465 6620 6170  d=12).    def ap
+00034260: 706c 7928 0a20 2020 2020 2020 2073 656c  ply(.        sel
+00034270: 662c 0a20 2020 2020 2020 2066 756e 632c  f,.        func,
+00034280: 0a20 2020 2020 2020 2061 7869 733d 302c  .        axis=0,
+00034290: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
+000342a0: 7374 3d4e 6f6e 652c 0a20 2020 2020 2020  st=None,.       
+000342b0: 2072 6177 3d46 616c 7365 2c0a 2020 2020   raw=False,.    
+000342c0: 2020 2020 7265 6475 6365 3d4e 6f6e 652c      reduce=None,
+000342d0: 0a20 2020 2020 2020 2061 7267 733d 2829  .        args=()
+000342e0: 2c0a 2020 2020 2020 2020 6d65 7461 3d6e  ,.        meta=n
+000342f0: 6f5f 6465 6661 756c 742c 0a20 2020 2020  o_default,.     
+00034300: 2020 2072 6573 756c 745f 7479 7065 3d4e     result_type=N
+00034310: 6f6e 652c 0a20 2020 2020 2020 202a 2a6b  one,.        **k
+00034320: 7764 732c 0a20 2020 2029 3a0a 2020 2020  wds,.    ):.    
+00034330: 2020 2020 2222 2250 6172 616c 6c65 6c20      """Parallel 
+00034340: 7665 7273 696f 6e20 6f66 2070 616e 6461  version of panda
+00034350: 732e 4461 7461 4672 616d 652e 6170 706c  s.DataFrame.appl
+00034360: 790a 0a20 2020 2020 2020 2054 6869 7320  y..        This 
+00034370: 6d69 6d69 6373 2074 6865 2070 616e 6461  mimics the panda
+00034380: 7320 7665 7273 696f 6e20 6578 6365 7074  s version except
+00034390: 2066 6f72 2074 6865 2066 6f6c 6c6f 7769   for the followi
+000343a0: 6e67 3a0a 0a20 2020 2020 2020 2031 2e20  ng:..        1. 
+000343b0: 204f 6e6c 7920 6060 6178 6973 3d31 6060   Only ``axis=1``
+000343c0: 2069 7320 7375 7070 6f72 7465 6420 2861   is supported (a
+000343d0: 6e64 206d 7573 7420 6265 2073 7065 6369  nd must be speci
+000343e0: 6669 6564 2065 7870 6c69 6369 746c 7929  fied explicitly)
+000343f0: 2e0a 2020 2020 2020 2020 322e 2020 5468  ..        2.  Th
+00034400: 6520 7573 6572 2073 686f 756c 6420 7072  e user should pr
+00034410: 6f76 6964 6520 6f75 7470 7574 206d 6574  ovide output met
+00034420: 6164 6174 6120 7669 6120 7468 6520 606d  adata via the `m
+00034430: 6574 6160 206b 6579 776f 7264 2e0a 0a20  eta` keyword... 
+00034440: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00034450: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00034460: 2d2d 2d2d 0a20 2020 2020 2020 2066 756e  ----.        fun
+00034470: 6320 3a20 6675 6e63 7469 6f6e 0a20 2020  c : function.   
+00034480: 2020 2020 2020 2020 2046 756e 6374 696f           Functio
+00034490: 6e20 746f 2061 7070 6c79 2074 6f20 6561  n to apply to ea
+000344a0: 6368 2063 6f6c 756d 6e2f 726f 770a 2020  ch column/row.  
+000344b0: 2020 2020 2020 6178 6973 203a 207b 3020        axis : {0 
+000344c0: 6f72 2027 696e 6465 7827 2c20 3120 6f72  or 'index', 1 or
+000344d0: 2027 636f 6c75 6d6e 7327 7d2c 2064 6566   'columns'}, def
+000344e0: 6175 6c74 2030 0a20 2020 2020 2020 2020  ault 0.         
+000344f0: 2020 202d 2030 206f 7220 2769 6e64 6578     - 0 or 'index
+00034500: 273a 2061 7070 6c79 2066 756e 6374 696f  ': apply functio
+00034510: 6e20 746f 2065 6163 6820 636f 6c75 6d6e  n to each column
+00034520: 2028 4e4f 5420 5355 5050 4f52 5445 4429   (NOT SUPPORTED)
+00034530: 0a20 2020 2020 2020 2020 2020 202d 2031  .            - 1
+00034540: 206f 7220 2763 6f6c 756d 6e73 273a 2061   or 'columns': a
+00034550: 7070 6c79 2066 756e 6374 696f 6e20 746f  pply function to
+00034560: 2065 6163 6820 726f 770a 2020 2020 2020   each row.      
+00034570: 2020 244d 4554 410a 2020 2020 2020 2020    $META.        
+00034580: 6172 6773 203a 2074 7570 6c65 0a20 2020  args : tuple.   
+00034590: 2020 2020 2020 2020 2050 6f73 6974 696f           Positio
+000345a0: 6e61 6c20 6172 6775 6d65 6e74 7320 746f  nal arguments to
+000345b0: 2070 6173 7320 746f 2066 756e 6374 696f   pass to functio
+000345c0: 6e20 696e 2061 6464 6974 696f 6e20 746f  n in addition to
+000345d0: 2074 6865 2061 7272 6179 2f73 6572 6965   the array/serie
+000345e0: 730a 0a20 2020 2020 2020 2041 6464 6974  s..        Addit
+000345f0: 696f 6e61 6c20 6b65 7977 6f72 6420 6172  ional keyword ar
+00034600: 6775 6d65 6e74 7320 7769 6c6c 2062 6520  guments will be 
+00034610: 7061 7373 6564 2061 7320 6b65 7977 6f72  passed as keywor
+00034620: 6473 2074 6f20 7468 6520 6675 6e63 7469  ds to the functi
+00034630: 6f6e 0a0a 2020 2020 2020 2020 5265 7475  on..        Retu
+00034640: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+00034650: 2d2d 2d0a 2020 2020 2020 2020 6170 706c  ---.        appl
+00034660: 6965 6420 3a20 5365 7269 6573 206f 7220  ied : Series or 
+00034670: 4461 7461 4672 616d 650a 0a20 2020 2020  DataFrame..     
+00034680: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+00034690: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+000346a0: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
+000346b0: 7061 6e64 6173 2061 7320 7064 0a20 2020  pandas as pd.   
+000346c0: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
+000346d0: 6461 736b 2e64 6174 6166 7261 6d65 2061  dask.dataframe a
+000346e0: 7320 6464 0a20 2020 2020 2020 203e 3e3e  s dd.        >>>
+000346f0: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
+00034700: 6d65 287b 2778 273a 205b 312c 2032 2c20  me({'x': [1, 2, 
+00034710: 332c 2034 2c20 355d 2c0a 2020 2020 2020  3, 4, 5],.      
+00034720: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
+00034730: 2020 2020 2020 2020 2027 7927 3a20 5b31           'y': [1
+00034740: 2e2c 2032 2e2c 2033 2e2c 2034 2e2c 2035  ., 2., 3., 4., 5
+00034750: 2e5d 7d29 0a20 2020 2020 2020 203e 3e3e  .]}).        >>>
+00034760: 2064 6466 203d 2064 642e 6672 6f6d 5f70   ddf = dd.from_p
+00034770: 616e 6461 7328 6466 2c20 6e70 6172 7469  andas(df, nparti
+00034780: 7469 6f6e 733d 3229 0a0a 2020 2020 2020  tions=2)..      
+00034790: 2020 4170 706c 7920 6120 6675 6e63 7469    Apply a functi
+000347a0: 6f6e 2074 6f20 726f 772d 7769 7365 2070  on to row-wise p
+000347b0: 6173 7369 6e67 2069 6e20 6578 7472 6120  assing in extra 
+000347c0: 6172 6775 6d65 6e74 7320 696e 2060 6061  arguments in ``a
+000347d0: 7267 7360 6020 616e 640a 2020 2020 2020  rgs`` and.      
+000347e0: 2020 6060 6b77 6172 6773 6060 3a0a 0a20    ``kwargs``:.. 
+000347f0: 2020 2020 2020 203e 3e3e 2064 6566 206d         >>> def m
+00034800: 7961 6464 2872 6f77 2c20 612c 2062 3d31  yadd(row, a, b=1
+00034810: 293a 0a20 2020 2020 2020 202e 2e2e 2020  ):.        ...  
+00034820: 2020 2072 6574 7572 6e20 726f 772e 7375     return row.su
+00034830: 6d28 2920 2b20 6120 2b20 620a 2020 2020  m() + a + b.    
+00034840: 2020 2020 3e3e 3e20 7265 7320 3d20 6464      >>> res = dd
+00034850: 662e 6170 706c 7928 6d79 6164 642c 2061  f.apply(myadd, a
+00034860: 7869 733d 312c 2061 7267 733d 2832 2c29  xis=1, args=(2,)
+00034870: 2c20 623d 312e 3529 2020 2320 646f 6374  , b=1.5)  # doct
+00034880: 6573 743a 202b 534b 4950 0a0a 2020 2020  est: +SKIP..    
+00034890: 2020 2020 4279 2064 6566 6175 6c74 2c20      By default, 
+000348a0: 6461 736b 2074 7269 6573 2074 6f20 696e  dask tries to in
+000348b0: 6665 7220 7468 6520 6f75 7470 7574 206d  fer the output m
+000348c0: 6574 6164 6174 6120 6279 2072 756e 6e69  etadata by runni
+000348d0: 6e67 2079 6f75 720a 2020 2020 2020 2020  ng your.        
+000348e0: 7072 6f76 6964 6564 2066 756e 6374 696f  provided functio
+000348f0: 6e20 6f6e 2073 6f6d 6520 6661 6b65 2064  n on some fake d
+00034900: 6174 612e 2054 6869 7320 776f 726b 7320  ata. This works 
+00034910: 7765 6c6c 2069 6e20 6d61 6e79 2063 6173  well in many cas
+00034920: 6573 2c20 6275 740a 2020 2020 2020 2020  es, but.        
+00034930: 6361 6e20 736f 6d65 7469 6d65 7320 6265  can sometimes be
+00034940: 2065 7870 656e 7369 7665 2c20 6f72 2065   expensive, or e
+00034950: 7665 6e20 6661 696c 2e20 546f 2061 766f  ven fail. To avo
+00034960: 6964 2074 6869 732c 2079 6f75 2063 616e  id this, you can
+00034970: 0a20 2020 2020 2020 206d 616e 7561 6c6c  .        manuall
+00034980: 7920 7370 6563 6966 7920 7468 6520 6f75  y specify the ou
+00034990: 7470 7574 206d 6574 6164 6174 6120 7769  tput metadata wi
+000349a0: 7468 2074 6865 2060 606d 6574 6160 6020  th the ``meta`` 
+000349b0: 6b65 7977 6f72 642e 2054 6869 730a 2020  keyword. This.  
+000349c0: 2020 2020 2020 6361 6e20 6265 2073 7065        can be spe
+000349d0: 6369 6669 6564 2069 6e20 6d61 6e79 2066  cified in many f
+000349e0: 6f72 6d73 2c20 666f 7220 6d6f 7265 2069  orms, for more i
+000349f0: 6e66 6f72 6d61 7469 6f6e 2073 6565 0a20  nformation see. 
+00034a00: 2020 2020 2020 2060 6064 6173 6b2e 6461         ``dask.da
+00034a10: 7461 6672 616d 652e 7574 696c 732e 6d61  taframe.utils.ma
+00034a20: 6b65 5f6d 6574 6160 602e 0a0a 2020 2020  ke_meta``...    
+00034a30: 2020 2020 4865 7265 2077 6520 7370 6563      Here we spec
+00034a40: 6966 7920 7468 6520 6f75 7470 7574 2069  ify the output i
+00034a50: 7320 6120 5365 7269 6573 2077 6974 6820  s a Series with 
+00034a60: 6e61 6d65 2060 6027 7827 6060 2c20 616e  name ``'x'``, an
+00034a70: 6420 6474 7970 650a 2020 2020 2020 2020  d dtype.        
+00034a80: 6060 666c 6f61 7436 3460 603a 0a0a 2020  ``float64``:..  
+00034a90: 2020 2020 2020 3e3e 3e20 7265 7320 3d20        >>> res = 
+00034aa0: 6464 662e 6170 706c 7928 6d79 6164 642c  ddf.apply(myadd,
+00034ab0: 2061 7869 733d 312c 2061 7267 733d 2832   axis=1, args=(2
+00034ac0: 2c29 2c20 623d 312e 352c 206d 6574 613d  ,), b=1.5, meta=
+00034ad0: 2827 7827 2c20 2766 3827 2929 0a0a 2020  ('x', 'f8'))..  
+00034ae0: 2020 2020 2020 496e 2074 6865 2063 6173        In the cas
+00034af0: 6520 7768 6572 6520 7468 6520 6d65 7461  e where the meta
+00034b00: 6461 7461 2064 6f65 736e 2774 2063 6861  data doesn't cha
+00034b10: 6e67 652c 2079 6f75 2063 616e 2061 6c73  nge, you can als
+00034b20: 6f20 7061 7373 2069 6e0a 2020 2020 2020  o pass in.      
+00034b30: 2020 7468 6520 6f62 6a65 6374 2069 7473    the object its
+00034b40: 656c 6620 6469 7265 6374 6c79 3a0a 0a20  elf directly:.. 
+00034b50: 2020 2020 2020 203e 3e3e 2072 6573 203d         >>> res =
+00034b60: 2064 6466 2e61 7070 6c79 286c 616d 6264   ddf.apply(lambd
+00034b70: 6120 726f 773a 2072 6f77 202b 2031 2c20  a row: row + 1, 
+00034b80: 6178 6973 3d31 2c20 6d65 7461 3d64 6466  axis=1, meta=ddf
+00034b90: 290a 0a20 2020 2020 2020 2053 6565 2041  )..        See A
+00034ba0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00034bb0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+00034bc0: 6b2e 4461 7461 4672 616d 652e 6d61 705f  k.DataFrame.map_
+00034bd0: 7061 7274 6974 696f 6e73 0a20 2020 2020  partitions.     
+00034be0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00034bf0: 6966 2062 726f 6164 6361 7374 2069 7320  if broadcast is 
+00034c00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00034c10: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00034c20: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+00034c30: 2020 2020 2022 5468 6520 6062 726f 6164       "The `broad
+00034c40: 6361 7374 6020 6172 6775 6d65 6e74 2069  cast` argument i
+00034c50: 7320 6e6f 206c 6f6e 6765 7220 7573 6564  s no longer used
+00034c60: 2f73 7570 706f 7274 6564 2e20 220a 2020  /supported. ".  
+00034c70: 2020 2020 2020 2020 2020 2020 2020 2249                "I
+00034c80: 7420 7769 6c6c 2062 6520 6472 6f70 7065  t will be droppe
+00034c90: 6420 696e 2061 2066 7574 7572 6520 7265  d in a future re
+00034ca0: 6c65 6173 652e 222c 0a20 2020 2020 2020  lease.",.       
+00034cb0: 2020 2020 2020 2020 2063 6174 6567 6f72           categor
+00034cc0: 793d 4675 7475 7265 5761 726e 696e 672c  y=FutureWarning,
+00034cd0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00034ce0: 2020 2020 2020 2020 6178 6973 203d 2073          axis = s
+00034cf0: 656c 662e 5f76 616c 6964 6174 655f 6178  elf._validate_ax
+00034d00: 6973 2861 7869 7329 0a20 2020 2020 2020  is(axis).       
+00034d10: 2070 616e 6461 735f 6b77 6172 6773 203d   pandas_kwargs =
+00034d20: 207b 2261 7869 7322 3a20 6178 6973 2c20   {"axis": axis, 
+00034d30: 2272 6177 223a 2072 6177 2c20 2272 6573  "raw": raw, "res
+00034d40: 756c 745f 7479 7065 223a 2072 6573 756c  ult_type": resul
+00034d50: 745f 7479 7065 7d0a 0a20 2020 2020 2020  t_type}..       
+00034d60: 206b 7764 732e 7570 6461 7465 2870 616e   kwds.update(pan
+00034d70: 6461 735f 6b77 6172 6773 290a 0a20 2020  das_kwargs)..   
+00034d80: 2020 2020 2069 6620 6178 6973 203d 3d20       if axis == 
+00034d90: 303a 0a20 2020 2020 2020 2020 2020 206d  0:.            m
+00034da0: 7367 203d 2028 0a20 2020 2020 2020 2020  sg = (.         
+00034db0: 2020 2020 2020 2022 6464 2e44 6174 6146         "dd.DataF
+00034dc0: 7261 6d65 2e61 7070 6c79 206f 6e6c 7920  rame.apply only 
+00034dd0: 7375 7070 6f72 7473 2061 7869 733d 315c  supports axis=1\
+00034de0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+00034df0: 2020 2022 2020 5472 793a 2064 662e 6170     "  Try: df.ap
+00034e00: 706c 7928 6675 6e63 2c20 6178 6973 3d31  ply(func, axis=1
+00034e10: 2922 0a20 2020 2020 2020 2020 2020 2029  )".            )
+00034e20: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00034e30: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00034e40: 6445 7272 6f72 286d 7367 290a 0a20 2020  dError(msg)..   
+00034e50: 2020 2020 2069 6620 6d65 7461 2069 7320       if meta is 
+00034e60: 6e6f 5f64 6566 6175 6c74 3a0a 2020 2020  no_default:.    
+00034e70: 2020 2020 2020 2020 6d65 7461 203d 205f          meta = _
+00034e80: 656d 756c 6174 6528 0a20 2020 2020 2020  emulate(.       
+00034e90: 2020 2020 2020 2020 204d 2e61 7070 6c79           M.apply
+00034ea0: 2c20 7365 6c66 2e5f 6d65 7461 5f6e 6f6e  , self._meta_non
+00034eb0: 656d 7074 792c 2066 756e 632c 2061 7267  empty, func, arg
+00034ec0: 733d 6172 6773 2c20 7564 663d 5472 7565  s=args, udf=True
+00034ed0: 2c20 2a2a 6b77 6473 0a20 2020 2020 2020  , **kwds.       
+00034ee0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00034ef0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00034f00: 286d 6574 615f 7761 726e 696e 6728 6d65  (meta_warning(me
+00034f10: 7461 2929 0a20 2020 2020 2020 206b 7764  ta)).        kwd
+00034f20: 732e 7570 6461 7465 287b 2270 6172 656e  s.update({"paren
+00034f30: 745f 6d65 7461 223a 2073 656c 662e 5f6d  t_meta": self._m
+00034f40: 6574 617d 290a 2020 2020 2020 2020 7265  eta}).        re
+00034f50: 7475 726e 206d 6170 5f70 6172 7469 7469  turn map_partiti
+00034f60: 6f6e 7328 4d2e 6170 706c 792c 2073 656c  ons(M.apply, sel
+00034f70: 662c 2066 756e 632c 2061 7267 733d 6172  f, func, args=ar
+00034f80: 6773 2c20 6d65 7461 3d6d 6574 612c 202a  gs, meta=meta, *
+00034f90: 2a6b 7764 7329 0a0a 2020 2020 4064 6572  *kwds)..    @der
+00034fa0: 6976 6564 5f66 726f 6d28 7064 2e44 6174  ived_from(pd.Dat
+00034fb0: 6146 7261 6d65 290a 2020 2020 6465 6620  aFrame).    def 
+00034fc0: 6170 706c 796d 6170 2873 656c 662c 2066  applymap(self, f
+00034fd0: 756e 632c 206d 6574 613d 6e6f 5f64 6566  unc, meta=no_def
+00034fe0: 6175 6c74 293a 0a20 2020 2020 2020 2023  ault):.        #
+00034ff0: 204c 6574 2070 616e 6461 7320 7261 6973   Let pandas rais
+00035000: 6520 6465 7072 6563 6174 696f 6e20 7761  e deprecation wa
+00035010: 726e 696e 6773 0a20 2020 2020 2020 2073  rnings.        s
+00035020: 656c 662e 5f6d 6574 612e 6170 706c 796d  elf._meta.applym
+00035030: 6170 2866 756e 6329 0a20 2020 2020 2020  ap(func).       
+00035040: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
+00035050: 286d 6574 686f 6473 2e61 7070 6c79 6d61  (methods.applyma
+00035060: 702c 2073 656c 662c 2066 756e 632c 206d  p, self, func, m
+00035070: 6574 613d 6d65 7461 290a 0a20 2020 2064  eta=meta)..    d
+00035080: 6566 206d 6170 2873 656c 662c 2066 756e  ef map(self, fun
+00035090: 632c 206d 6574 613d 6e6f 5f64 6566 6175  c, meta=no_defau
+000350a0: 6c74 2c20 6e61 5f61 6374 696f 6e3d 4e6f  lt, na_action=No
+000350b0: 6e65 293a 0a20 2020 2020 2020 2069 6620  ne):.        if 
+000350c0: 6e6f 7420 5041 4e44 4153 5f47 545f 3231  not PANDAS_GT_21
+000350d0: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+000350e0: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
+000350f0: 7465 6445 7272 6f72 280a 2020 2020 2020  tedError(.      
+00035100: 2020 2020 2020 2020 2020 6622 4461 7461            f"Data
+00035110: 4672 616d 652e 6d61 7020 7265 7175 6972  Frame.map requir
+00035120: 6573 2070 616e 6461 733e 3d32 2e31 2e30  es pandas>=2.1.0
+00035130: 2c20 6275 7420 7061 6e64 6173 3d7b 5041  , but pandas={PA
+00035140: 4e44 4153 5f56 4552 5349 4f4e 7d20 6973  NDAS_VERSION} is
+00035150: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00035160: 2020 2022 696e 7374 616c 6c65 642e 220a     "installed.".
+00035170: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00035180: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00035190: 6d77 6973 6528 4d2e 6d61 702c 2073 656c  mwise(M.map, sel
+000351a0: 662c 2066 756e 632c 206d 6574 613d 6d65  f, func, meta=me
+000351b0: 7461 2c20 6e61 5f61 6374 696f 6e3d 6e61  ta, na_action=na
+000351c0: 5f61 6374 696f 6e29 0a0a 2020 2020 4064  _action)..    @d
+000351d0: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+000351e0: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+000351f0: 6620 726f 756e 6428 7365 6c66 2c20 6465  f round(self, de
+00035200: 6369 6d61 6c73 3d30 293a 0a20 2020 2020  cimals=0):.     
+00035210: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
+00035220: 7365 284d 2e72 6f75 6e64 2c20 7365 6c66  se(M.round, self
+00035230: 2c20 6465 6369 6d61 6c73 290a 0a20 2020  , decimals)..   
+00035240: 2040 6465 7269 7665 645f 6672 6f6d 2870   @derived_from(p
+00035250: 642e 4461 7461 4672 616d 6529 0a20 2020  d.DataFrame).   
+00035260: 2064 6566 206e 756e 6971 7565 2873 656c   def nunique(sel
+00035270: 662c 2073 706c 6974 5f65 7665 7279 3d46  f, split_every=F
+00035280: 616c 7365 2c20 6472 6f70 6e61 3d54 7275  alse, dropna=Tru
+00035290: 652c 2061 7869 733d 3029 3a0a 2020 2020  e, axis=0):.    
+000352a0: 2020 2020 6966 2061 7869 7320 3d3d 2031      if axis == 1
+000352b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000352c0: 7370 6c69 745f 6576 6572 7920 6e6f 7420  split_every not 
+000352d0: 7573 6564 2066 6f72 2061 7869 733d 310a  used for axis=1.
+000352e0: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+000352f0: 203d 2073 656c 662e 5f6d 6574 615f 6e6f   = self._meta_no
+00035300: 6e65 6d70 7479 2e6e 756e 6971 7565 2861  nempty.nunique(a
+00035310: 7869 733d 6178 6973 290a 2020 2020 2020  xis=axis).      
+00035320: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00035330: 662e 6d61 705f 7061 7274 6974 696f 6e73  f.map_partitions
+00035340: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00035350: 2020 4d2e 6e75 6e69 7175 652c 0a20 2020    M.nunique,.   
+00035360: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00035370: 613d 6d65 7461 2c0a 2020 2020 2020 2020  a=meta,.        
+00035380: 2020 2020 2020 2020 746f 6b65 6e3d 2273          token="s
+00035390: 6572 6965 732d 6e75 6e69 7175 6522 2c0a  eries-nunique",.
+000353a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000353b0: 6178 6973 3d61 7869 732c 0a20 2020 2020  axis=axis,.     
+000353c0: 2020 2020 2020 2020 2020 2064 726f 706e             dropn
+000353d0: 613d 6472 6f70 6e61 2c0a 2020 2020 2020  a=dropna,.      
+000353e0: 2020 2020 2020 2020 2020 656e 666f 7263            enforc
+000353f0: 655f 6d65 7461 6461 7461 3d46 616c 7365  e_metadata=False
+00035400: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+00035410: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00035420: 2020 2020 2020 2020 2020 6e75 6e69 7175            nuniqu
+00035430: 655f 6c69 7374 203d 205b 0a20 2020 2020  e_list = [.     
+00035440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00035450: 696c 6f63 5b3a 2c20 695d 2e6e 756e 6971  iloc[:, i].nuniq
+00035460: 7565 2873 706c 6974 5f65 7665 7279 3d73  ue(split_every=s
+00035470: 706c 6974 5f65 7665 7279 2c20 6472 6f70  plit_every, drop
+00035480: 6e61 3d64 726f 706e 6129 0a20 2020 2020  na=dropna).     
+00035490: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+000354a0: 2069 6e20 7261 6e67 6528 6c65 6e28 7365   in range(len(se
+000354b0: 6c66 2e63 6f6c 756d 6e73 2929 0a20 2020  lf.columns)).   
+000354c0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+000354d0: 2020 2020 2020 206e 616d 6520 3d20 2273         name = "s
+000354e0: 6572 6965 732d 2220 2b20 746f 6b65 6e69  eries-" + tokeni
+000354f0: 7a65 282a 6e75 6e69 7175 655f 6c69 7374  ze(*nunique_list
+00035500: 290a 2020 2020 2020 2020 2020 2020 6473  ).            ds
+00035510: 6b20 3d20 7b0a 2020 2020 2020 2020 2020  k = {.          
+00035520: 2020 2020 2020 286e 616d 652c 2030 293a        (name, 0):
+00035530: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00035540: 2020 2020 2020 2061 7070 6c79 2c0a 2020         apply,.  
+00035550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035560: 2020 7064 2e53 6572 6965 732c 0a20 2020    pd.Series,.   
+00035570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035580: 205b 5b28 732e 5f6e 616d 652c 2030 2920   [[(s._name, 0) 
+00035590: 666f 7220 7320 696e 206e 756e 6971 7565  for s in nunique
+000355a0: 5f6c 6973 745d 5d2c 0a20 2020 2020 2020  _list]],.       
+000355b0: 2020 2020 2020 2020 2020 2020 207b 2269               {"i
+000355c0: 6e64 6578 223a 2073 656c 662e 636f 6c75  ndex": self.colu
+000355d0: 6d6e 737d 2c0a 2020 2020 2020 2020 2020  mns},.          
+000355e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000355f0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+00035600: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
+00035610: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
+00035620: 6c6c 6563 7469 6f6e 7328 0a20 2020 2020  llections(.     
+00035630: 2020 2020 2020 2020 2020 206e 616d 652c             name,
+00035640: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
+00035650: 6573 3d6e 756e 6971 7565 5f6c 6973 740a  es=nunique_list.
+00035660: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00035670: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00035680: 2053 6572 6965 7328 6772 6170 682c 206e   Series(graph, n
+00035690: 616d 652c 2073 656c 662e 5f6d 6574 612e  ame, self._meta.
+000356a0: 6e75 6e69 7175 6528 292c 2028 4e6f 6e65  nunique(), (None
+000356b0: 2c20 4e6f 6e65 2929 0a0a 2020 2020 4064  , None))..    @d
+000356c0: 6572 6976 6564 5f66 726f 6d28 7064 2e44  erived_from(pd.D
+000356d0: 6174 6146 7261 6d65 290a 2020 2020 6465  ataFrame).    de
+000356e0: 6620 6d6f 6465 2873 656c 662c 2064 726f  f mode(self, dro
+000356f0: 706e 613d 5472 7565 2c20 7370 6c69 745f  pna=True, split_
+00035700: 6576 6572 793d 4661 6c73 652c 206e 756d  every=False, num
+00035710: 6572 6963 5f6f 6e6c 793d 4661 6c73 6529  eric_only=False)
+00035720: 3a0a 2020 2020 2020 2020 6d6f 6465 5f73  :.        mode_s
+00035730: 6572 6965 735f 6c69 7374 203d 205b 5d0a  eries_list = [].
+00035740: 2020 2020 2020 2020 666f 7220 636f 6c5f          for col_
+00035750: 696e 6465 7820 696e 2072 616e 6765 286c  index in range(l
+00035760: 656e 2873 656c 662e 636f 6c75 6d6e 7329  en(self.columns)
+00035770: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+00035780: 6f6c 5f73 6572 6965 7320 3d20 7365 6c66  ol_series = self
+00035790: 2e69 6c6f 635b 3a2c 2063 6f6c 5f69 6e64  .iloc[:, col_ind
+000357a0: 6578 5d0a 2020 2020 2020 2020 2020 2020  ex].            
+000357b0: 6966 206e 756d 6572 6963 5f6f 6e6c 7920  if numeric_only 
+000357c0: 616e 6420 6e6f 7420 7064 2e61 7069 2e74  and not pd.api.t
+000357d0: 7970 6573 2e69 735f 6e75 6d65 7269 635f  ypes.is_numeric_
+000357e0: 6474 7970 6528 636f 6c5f 7365 7269 6573  dtype(col_series
+000357f0: 2e64 7479 7065 293a 0a20 2020 2020 2020  .dtype):.       
+00035800: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00035810: 650a 2020 2020 2020 2020 2020 2020 6d6f  e.            mo
+00035820: 6465 5f73 6572 6965 7320 3d20 5365 7269  de_series = Seri
+00035830: 6573 2e6d 6f64 6528 0a20 2020 2020 2020  es.mode(.       
+00035840: 2020 2020 2020 2020 2063 6f6c 5f73 6572           col_ser
+00035850: 6965 732c 2064 726f 706e 613d 6472 6f70  ies, dropna=drop
+00035860: 6e61 2c20 7370 6c69 745f 6576 6572 793d  na, split_every=
+00035870: 7370 6c69 745f 6576 6572 790a 2020 2020  split_every.    
+00035880: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00035890: 2020 2020 2020 6d6f 6465 5f73 6572 6965        mode_serie
+000358a0: 735f 6c69 7374 2e61 7070 656e 6428 6d6f  s_list.append(mo
+000358b0: 6465 5f73 6572 6965 7329 0a0a 2020 2020  de_series)..    
+000358c0: 2020 2020 6e61 6d65 203d 2022 636f 6e63      name = "conc
+000358d0: 6174 2d22 202b 2074 6f6b 656e 697a 6528  at-" + tokenize(
+000358e0: 2a6d 6f64 655f 7365 7269 6573 5f6c 6973  *mode_series_lis
+000358f0: 7429 0a0a 2020 2020 2020 2020 6473 6b20  t)..        dsk 
+00035900: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00035910: 286e 616d 652c 2030 293a 2028 0a20 2020  (name, 0): (.   
+00035920: 2020 2020 2020 2020 2020 2020 2061 7070               app
+00035930: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
+00035940: 2020 2020 6d65 7468 6f64 732e 636f 6e63      methods.conc
+00035950: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+00035960: 2020 2020 5b5b 2864 662e 5f6e 616d 652c      [[(df._name,
+00035970: 2030 2920 666f 7220 6466 2069 6e20 6d6f   0) for df in mo
+00035980: 6465 5f73 6572 6965 735f 6c69 7374 5d5d  de_series_list]]
+00035990: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000359a0: 2020 7b22 6178 6973 223a 2031 7d2c 0a20    {"axis": 1},. 
+000359b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000359c0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+000359d0: 6d65 7461 203d 206d 6574 686f 6473 2e63  meta = methods.c
+000359e0: 6f6e 6361 7428 5b64 662e 5f6d 6574 6120  oncat([df._meta 
+000359f0: 666f 7220 6466 2069 6e20 6d6f 6465 5f73  for df in mode_s
+00035a00: 6572 6965 735f 6c69 7374 5d2c 2061 7869  eries_list], axi
+00035a10: 733d 3129 0a20 2020 2020 2020 2067 7261  s=1).        gra
+00035a20: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
+00035a30: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
+00035a40: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
+00035a50: 2020 6e61 6d65 2c20 6473 6b2c 2064 6570    name, dsk, dep
+00035a60: 656e 6465 6e63 6965 733d 6d6f 6465 5f73  endencies=mode_s
+00035a70: 6572 6965 735f 6c69 7374 0a20 2020 2020  eries_list.     
+00035a80: 2020 2029 0a20 2020 2020 2020 2064 6466     ).        ddf
+00035a90: 203d 206e 6577 5f64 645f 6f62 6a65 6374   = new_dd_object
+00035aa0: 2867 7261 7068 2c20 6e61 6d65 2c20 6d65  (graph, name, me
+00035ab0: 7461 2c20 6469 7669 7369 6f6e 733d 284e  ta, divisions=(N
+00035ac0: 6f6e 652c 204e 6f6e 6529 290a 0a20 2020  one, None))..   
+00035ad0: 2020 2020 2072 6574 7572 6e20 6464 660a       return ddf.
+00035ae0: 0a20 2020 2040 6465 7269 7665 645f 6672  .    @derived_fr
+00035af0: 6f6d 2870 642e 4461 7461 4672 616d 6529  om(pd.DataFrame)
+00035b00: 0a20 2020 2064 6566 2063 6f76 2873 656c  .    def cov(sel
+00035b10: 662c 206d 696e 5f70 6572 696f 6473 3d4e  f, min_periods=N
+00035b20: 6f6e 652c 206e 756d 6572 6963 5f6f 6e6c  one, numeric_onl
+00035b30: 793d 6e6f 5f64 6566 6175 6c74 2c20 7370  y=no_default, sp
+00035b40: 6c69 745f 6576 6572 793d 4661 6c73 6529  lit_every=False)
+00035b50: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00035b60: 205f 636f 765f 636f 7272 280a 2020 2020   _cov_corr(.    
+00035b70: 2020 2020 2020 2020 7365 6c66 2c20 6d69          self, mi
+00035b80: 6e5f 7065 7269 6f64 732c 206e 756d 6572  n_periods, numer
+00035b90: 6963 5f6f 6e6c 793d 6e75 6d65 7269 635f  ic_only=numeric_
+00035ba0: 6f6e 6c79 2c20 7370 6c69 745f 6576 6572  only, split_ever
+00035bb0: 793d 7370 6c69 745f 6576 6572 790a 2020  y=split_every.  
+00035bc0: 2020 2020 2020 290a 0a20 2020 2040 6465        )..    @de
+00035bd0: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+00035be0: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+00035bf0: 2063 6f72 7228 0a20 2020 2020 2020 2073   corr(.        s
+00035c00: 656c 662c 0a20 2020 2020 2020 206d 6574  elf,.        met
+00035c10: 686f 643d 2270 6561 7273 6f6e 222c 0a20  hod="pearson",. 
+00035c20: 2020 2020 2020 206d 696e 5f70 6572 696f         min_perio
+00035c30: 6473 3d4e 6f6e 652c 0a20 2020 2020 2020  ds=None,.       
+00035c40: 206e 756d 6572 6963 5f6f 6e6c 793d 6e6f   numeric_only=no
+00035c50: 5f64 6566 6175 6c74 2c0a 2020 2020 2020  _default,.      
+00035c60: 2020 7370 6c69 745f 6576 6572 793d 4661    split_every=Fa
+00035c70: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
+00035c80: 2020 2020 6966 206d 6574 686f 6420 213d      if method !=
+00035c90: 2022 7065 6172 736f 6e22 3a0a 2020 2020   "pearson":.    
+00035ca0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+00035cb0: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+00035cc0: 7228 224f 6e6c 7920 5065 6172 736f 6e20  r("Only Pearson 
+00035cd0: 636f 7272 656c 6174 696f 6e20 6861 7320  correlation has 
+00035ce0: 6265 656e 2069 6d70 6c65 6d65 6e74 6564  been implemented
+00035cf0: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+00035d00: 726e 205f 636f 765f 636f 7272 280a 2020  rn _cov_corr(.  
+00035d10: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+00035d20: 6d69 6e5f 7065 7269 6f64 732c 2054 7275  min_periods, Tru
+00035d30: 652c 206e 756d 6572 6963 5f6f 6e6c 793d  e, numeric_only=
+00035d40: 6e75 6d65 7269 635f 6f6e 6c79 2c20 7370  numeric_only, sp
+00035d50: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+00035d60: 6576 6572 790a 2020 2020 2020 2020 290a  every.        ).
+00035d70: 0a20 2020 2064 6566 2069 6e66 6f28 7365  .    def info(se
+00035d80: 6c66 2c20 6275 663d 4e6f 6e65 2c20 7665  lf, buf=None, ve
+00035d90: 7262 6f73 653d 4661 6c73 652c 206d 656d  rbose=False, mem
+00035da0: 6f72 795f 7573 6167 653d 4661 6c73 6529  ory_usage=False)
+00035db0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00035dc0: 2020 2020 2020 436f 6e63 6973 6520 7375        Concise su
+00035dd0: 6d6d 6172 7920 6f66 2061 2044 6173 6b20  mmary of a Dask 
+00035de0: 4461 7461 4672 616d 652e 0a20 2020 2020  DataFrame..     
+00035df0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00035e00: 6966 2062 7566 2069 7320 4e6f 6e65 3a0a  if buf is None:.
+00035e10: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00035e20: 7274 2073 7973 0a0a 2020 2020 2020 2020  rt sys..        
+00035e30: 2020 2020 6275 6620 3d20 7379 732e 7374      buf = sys.st
+00035e40: 646f 7574 0a0a 2020 2020 2020 2020 6c69  dout..        li
+00035e50: 6e65 7320 3d20 5b73 7472 2874 7970 6528  nes = [str(type(
+00035e60: 7365 6c66 2929 5d0a 0a20 2020 2020 2020  self))]..       
+00035e70: 2069 6620 6c65 6e28 7365 6c66 2e63 6f6c   if len(self.col
+00035e80: 756d 6e73 2920 3d3d 2030 3a0a 2020 2020  umns) == 0:.    
+00035e90: 2020 2020 2020 2020 6c69 6e65 732e 6170          lines.ap
+00035ea0: 7065 6e64 2866 227b 7479 7065 2873 656c  pend(f"{type(sel
+00035eb0: 662e 696e 6465 782e 5f6d 6574 6129 2e5f  f.index._meta)._
+00035ec0: 5f6e 616d 655f 5f7d 3a20 3020 656e 7472  _name__}: 0 entr
+00035ed0: 6965 7322 290a 2020 2020 2020 2020 2020  ies").          
+00035ee0: 2020 6c69 6e65 732e 6170 7065 6e64 2866    lines.append(f
+00035ef0: 2245 6d70 7479 207b 7479 7065 2873 656c  "Empty {type(sel
+00035f00: 6629 2e5f 5f6e 616d 655f 5f7d 2229 0a20  f).__name__}"). 
+00035f10: 2020 2020 2020 2020 2020 2069 6620 5041             if PA
+00035f20: 4e44 4153 5f47 545f 3135 303a 0a20 2020  NDAS_GT_150:.   
+00035f30: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+00035f40: 616e 6461 7320 6461 7461 6672 616d 6520  andas dataframe 
+00035f50: 7374 6172 7465 6420 6164 6469 6e67 2061  started adding a
+00035f60: 206e 6577 6c69 6e65 2077 6865 6e20 696e   newline when in
+00035f70: 666f 2069 7320 6361 6c6c 6564 2e0a 2020  fo is called..  
+00035f80: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00035f90: 6e65 732e 6170 7065 6e64 2822 2229 0a20  nes.append(""). 
+00035fa0: 2020 2020 2020 2020 2020 2070 7574 5f6c             put_l
+00035fb0: 696e 6573 2862 7566 2c20 6c69 6e65 7329  ines(buf, lines)
+00035fc0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00035fd0: 7572 6e0a 0a20 2020 2020 2020 2023 2047  urn..        # G
+00035fe0: 726f 7570 2061 6e64 2065 7865 6375 7465  roup and execute
+00035ff0: 2074 6865 2072 6571 7569 7265 6420 636f   the required co
+00036000: 6d70 7574 6174 696f 6e73 0a20 2020 2020  mputations.     
+00036010: 2020 2063 6f6d 7075 7461 7469 6f6e 7320     computations 
+00036020: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
+00036030: 7665 7262 6f73 653a 0a20 2020 2020 2020  verbose:.       
+00036040: 2020 2020 206d 656d 6f72 795f 7573 6167       memory_usag
+00036050: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00036060: 2020 2020 2063 6f6d 7075 7461 7469 6f6e       computation
+00036070: 732e 7570 6461 7465 287b 2269 6e64 6578  s.update({"index
+00036080: 223a 2073 656c 662e 696e 6465 782c 2022  ": self.index, "
+00036090: 636f 756e 7422 3a20 7365 6c66 2e63 6f75  count": self.cou
+000360a0: 6e74 2829 7d29 0a20 2020 2020 2020 2069  nt()}).        i
+000360b0: 6620 6d65 6d6f 7279 5f75 7361 6765 3a0a  f memory_usage:.
+000360c0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+000360d0: 7574 6174 696f 6e73 2e75 7064 6174 6528  utations.update(
+000360e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000360f0: 207b 226d 656d 6f72 795f 7573 6167 6522   {"memory_usage"
+00036100: 3a20 7365 6c66 2e6d 6170 5f70 6172 7469  : self.map_parti
+00036110: 7469 6f6e 7328 4d2e 6d65 6d6f 7279 5f75  tions(M.memory_u
+00036120: 7361 6765 2c20 696e 6465 783d 5472 7565  sage, index=True
+00036130: 297d 0a20 2020 2020 2020 2020 2020 2029  )}.            )
+00036140: 0a20 2020 2020 2020 2063 6f6d 7075 7461  .        computa
+00036150: 7469 6f6e 7320 3d20 6469 6374 280a 2020  tions = dict(.  
+00036160: 2020 2020 2020 2020 2020 7a69 7028 636f            zip(co
+00036170: 6d70 7574 6174 696f 6e73 2e6b 6579 7328  mputations.keys(
+00036180: 292c 2064 612e 636f 6d70 7574 6528 2a63  ), da.compute(*c
+00036190: 6f6d 7075 7461 7469 6f6e 732e 7661 6c75  omputations.valu
+000361a0: 6573 2829 2929 0a20 2020 2020 2020 2029  es())).        )
+000361b0: 0a0a 2020 2020 2020 2020 6966 2076 6572  ..        if ver
+000361c0: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
+000361d0: 2020 696d 706f 7274 2074 6578 7477 7261    import textwra
+000361e0: 700a 0a20 2020 2020 2020 2020 2020 2069  p..            i
+000361f0: 6e64 6578 203d 2063 6f6d 7075 7461 7469  ndex = computati
+00036200: 6f6e 735b 2269 6e64 6578 225d 0a20 2020  ons["index"].   
+00036210: 2020 2020 2020 2020 2063 6f75 6e74 7320           counts 
+00036220: 3d20 636f 6d70 7574 6174 696f 6e73 5b22  = computations["
+00036230: 636f 756e 7422 5d0a 2020 2020 2020 2020  count"].        
+00036240: 2020 2020 6c69 6e65 732e 6170 7065 6e64      lines.append
+00036250: 2869 6e64 6578 5f73 756d 6d61 7279 2869  (index_summary(i
+00036260: 6e64 6578 2929 0a20 2020 2020 2020 2020  ndex)).         
+00036270: 2020 206c 696e 6573 2e61 7070 656e 6428     lines.append(
+00036280: 6622 4461 7461 2063 6f6c 756d 6e73 2028  f"Data columns (
+00036290: 746f 7461 6c20 7b6c 656e 2873 656c 662e  total {len(self.
+000362a0: 636f 6c75 6d6e 7329 7d20 636f 6c75 6d6e  columns)} column
+000362b0: 7329 3a22 290a 0a20 2020 2020 2020 2020  s):")..         
+000362c0: 2020 2066 726f 6d20 7061 6e64 6173 2e69     from pandas.i
+000362d0: 6f2e 666f 726d 6174 732e 7072 696e 7469  o.formats.printi
+000362e0: 6e67 2069 6d70 6f72 7420 7070 7269 6e74  ng import pprint
+000362f0: 5f74 6869 6e67 0a0a 2020 2020 2020 2020  _thing..        
+00036300: 2020 2020 7370 6163 6520 3d20 6d61 7828      space = max(
+00036310: 6c65 6e28 7070 7269 6e74 5f74 6869 6e67  len(pprint_thing
+00036320: 286b 2929 2066 6f72 206b 2069 6e20 7365  (k)) for k in se
+00036330: 6c66 2e63 6f6c 756d 6e73 2920 2b20 310a  lf.columns) + 1.
+00036340: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+00036350: 6d6e 5f77 6964 7468 203d 206d 6178 2873  mn_width = max(s
+00036360: 7061 6365 2c20 3729 0a0a 2020 2020 2020  pace, 7)..      
+00036370: 2020 2020 2020 6865 6164 6572 203d 2028        header = (
+00036380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036390: 2074 6578 7477 7261 702e 6465 6465 6e74   textwrap.dedent
+000363a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000363b0: 2020 2020 2020 2222 225c 0a20 2020 2020        """\.     
+000363c0: 2020 2020 2020 2020 2320 2020 7b7b 636f          #   {{co
+000363d0: 6c75 6d6e 3a3c 7b63 6f6c 756d 6e5f 7769  lumn:<{column_wi
+000363e0: 6474 687d 7d7d 204e 6f6e 2d4e 756c 6c20  dth}}} Non-Null 
+000363f0: 436f 756e 7420 2044 7479 7065 0a20 2020  Count  Dtype.   
+00036400: 2020 2020 2020 2020 202d 2d2d 2020 7b7b           ---  {{
+00036410: 756e 6465 726c 3a3c 7b63 6f6c 756d 6e5f  underl:<{column_
+00036420: 7769 6474 687d 7d7d 202d 2d2d 2d2d 2d2d  width}}} -------
+00036430: 2d2d 2d2d 2d2d 2d20 202d 2d2d 2d2d 2222  -------  -----""
+00036440: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00036450: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00036460: 2020 2020 2e66 6f72 6d61 7428 636f 6c75      .format(colu
+00036470: 6d6e 5f77 6964 7468 3d63 6f6c 756d 6e5f  mn_width=column_
+00036480: 7769 6474 6829 0a20 2020 2020 2020 2020  width).         
+00036490: 2020 2020 2020 202e 666f 726d 6174 2863         .format(c
+000364a0: 6f6c 756d 6e3d 2243 6f6c 756d 6e22 2c20  olumn="Column", 
+000364b0: 756e 6465 726c 3d22 2d2d 2d2d 2d2d 2229  underl="------")
+000364c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000364d0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+000364e0: 6e5f 7465 6d70 6c61 7465 203d 2074 6578  n_template = tex
+000364f0: 7477 7261 702e 6465 6465 6e74 280a 2020  twrap.dedent(.  
+00036500: 2020 2020 2020 2020 2020 2020 2020 2222                ""
+00036510: 225c 0a20 2020 2020 2020 2020 2020 207b  "\.            {
+00036520: 7b69 3a5e 337d 7d20 207b 7b6e 616d 653a  {i:^3}}  {{name:
+00036530: 3c7b 636f 6c75 6d6e 5f77 6964 7468 7d7d  <{column_width}}
+00036540: 7d20 7b7b 636f 756e 747d 7d20 6e6f 6e2d  } {{count}} non-
+00036550: 6e75 6c6c 2020 2020 2020 7b7b 6474 7970  null      {{dtyp
+00036560: 657d 7d22 2222 2e66 6f72 6d61 7428 0a20  e}}""".format(. 
+00036570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036580: 2020 2063 6f6c 756d 6e5f 7769 6474 683d     column_width=
+00036590: 636f 6c75 6d6e 5f77 6964 7468 0a20 2020  column_width.   
+000365a0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000365b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000365c0: 2020 2020 2020 2020 2063 6f6c 756d 6e5f           column_
+000365d0: 696e 666f 203d 205b 0a20 2020 2020 2020  info = [.       
+000365e0: 2020 2020 2020 2020 2063 6f6c 756d 6e5f           column_
+000365f0: 7465 6d70 6c61 7465 2e66 6f72 6d61 7428  template.format(
+00036600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036610: 2020 2020 2069 3d70 7072 696e 745f 7468       i=pprint_th
+00036620: 696e 6728 6929 2c0a 2020 2020 2020 2020  ing(i),.        
+00036630: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00036640: 3d70 7072 696e 745f 7468 696e 6728 6e61  =pprint_thing(na
+00036650: 6d65 292c 0a20 2020 2020 2020 2020 2020  me),.           
+00036660: 2020 2020 2020 2020 2063 6f75 6e74 3d70           count=p
+00036670: 7072 696e 745f 7468 696e 6728 636f 756e  print_thing(coun
+00036680: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
+00036690: 2020 2020 2020 2020 6474 7970 653d 7070          dtype=pp
+000366a0: 7269 6e74 5f74 6869 6e67 2864 7479 7065  rint_thing(dtype
+000366b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+000366c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000366d0: 2020 2020 2066 6f72 2069 2c20 286e 616d       for i, (nam
+000366e0: 652c 2063 6f75 6e74 2c20 6474 7970 6529  e, count, dtype)
+000366f0: 2069 6e20 656e 756d 6572 6174 6528 0a20   in enumerate(. 
+00036700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036710: 2020 207a 6970 2873 656c 662e 636f 6c75     zip(self.colu
+00036720: 6d6e 732c 2063 6f75 6e74 732c 2073 656c  mns, counts, sel
+00036730: 662e 6474 7970 6573 290a 2020 2020 2020  f.dtypes).      
+00036740: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00036750: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00036760: 2020 2020 2020 6c69 6e65 732e 6578 7465        lines.exte
+00036770: 6e64 2868 6561 6465 722e 7370 6c69 7428  nd(header.split(
+00036780: 225c 6e22 2929 0a20 2020 2020 2020 2065  "\n")).        e
+00036790: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000367a0: 2063 6f6c 756d 6e5f 696e 666f 203d 205b   column_info = [
+000367b0: 696e 6465 785f 7375 6d6d 6172 7928 7365  index_summary(se
+000367c0: 6c66 2e63 6f6c 756d 6e73 2c20 6e61 6d65  lf.columns, name
+000367d0: 3d22 436f 6c75 6d6e 7322 295d 0a0a 2020  ="Columns")]..  
+000367e0: 2020 2020 2020 6c69 6e65 732e 6578 7465        lines.exte
+000367f0: 6e64 2863 6f6c 756d 6e5f 696e 666f 290a  nd(column_info).
+00036800: 2020 2020 2020 2020 6474 7970 655f 636f          dtype_co
+00036810: 756e 7473 203d 205b 0a20 2020 2020 2020  unts = [.       
+00036820: 2020 2020 2022 2573 2825 6429 2220 2520       "%s(%d)" % 
+00036830: 6b20 666f 7220 6b20 696e 2073 6f72 7465  k for k in sorte
+00036840: 6428 7365 6c66 2e64 7479 7065 732e 7661  d(self.dtypes.va
+00036850: 6c75 655f 636f 756e 7473 2829 2e69 7465  lue_counts().ite
+00036860: 6d73 2829 2c20 6b65 793d 7374 7229 0a20  ms(), key=str). 
+00036870: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00036880: 206c 696e 6573 2e61 7070 656e 6428 2264   lines.append("d
+00036890: 7479 7065 733a 207b 7d22 2e66 6f72 6d61  types: {}".forma
+000368a0: 7428 222c 2022 2e6a 6f69 6e28 6474 7970  t(", ".join(dtyp
+000368b0: 655f 636f 756e 7473 2929 290a 0a20 2020  e_counts)))..   
+000368c0: 2020 2020 2069 6620 6d65 6d6f 7279 5f75       if memory_u
+000368d0: 7361 6765 3a0a 2020 2020 2020 2020 2020  sage:.          
+000368e0: 2020 6d65 6d6f 7279 5f69 6e74 203d 2063    memory_int = c
+000368f0: 6f6d 7075 7461 7469 6f6e 735b 226d 656d  omputations["mem
+00036900: 6f72 795f 7573 6167 6522 5d2e 7375 6d28  ory_usage"].sum(
+00036910: 290a 2020 2020 2020 2020 2020 2020 6c69  ).            li
+00036920: 6e65 732e 6170 7065 6e64 2866 226d 656d  nes.append(f"mem
+00036930: 6f72 7920 7573 6167 653a 207b 6d65 6d6f  ory usage: {memo
+00036940: 7279 5f72 6570 7228 6d65 6d6f 7279 5f69  ry_repr(memory_i
+00036950: 6e74 297d 5c6e 2229 0a0a 2020 2020 2020  nt)}\n")..      
+00036960: 2020 7075 745f 6c69 6e65 7328 6275 662c    put_lines(buf,
+00036970: 206c 696e 6573 290a 0a20 2020 2040 6465   lines)..    @de
+00036980: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+00036990: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+000369a0: 206d 656d 6f72 795f 7573 6167 6528 7365   memory_usage(se
+000369b0: 6c66 2c20 696e 6465 783d 5472 7565 2c20  lf, index=True, 
+000369c0: 6465 6570 3d46 616c 7365 293a 0a20 2020  deep=False):.   
+000369d0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+000369e0: 6c66 2e6d 6170 5f70 6172 7469 7469 6f6e  lf.map_partition
+000369f0: 7328 4d2e 6d65 6d6f 7279 5f75 7361 6765  s(M.memory_usage
+00036a00: 2c20 696e 6465 783d 696e 6465 782c 2064  , index=index, d
+00036a10: 6565 703d 6465 6570 290a 2020 2020 2020  eep=deep).      
+00036a20: 2020 7265 7375 6c74 203d 2072 6573 756c    result = resul
+00036a30: 742e 6772 6f75 7062 7928 7265 7375 6c74  t.groupby(result
+00036a40: 2e69 6e64 6578 292e 7375 6d28 290a 2020  .index).sum().  
+00036a50: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00036a60: 756c 740a 0a20 2020 2064 6566 2070 6976  ult..    def piv
+00036a70: 6f74 5f74 6162 6c65 2873 656c 662c 2069  ot_table(self, i
+00036a80: 6e64 6578 3d4e 6f6e 652c 2063 6f6c 756d  ndex=None, colum
+00036a90: 6e73 3d4e 6f6e 652c 2076 616c 7565 733d  ns=None, values=
+00036aa0: 4e6f 6e65 2c20 6167 6766 756e 633d 226d  None, aggfunc="m
+00036ab0: 6561 6e22 293a 0a20 2020 2020 2020 2022  ean"):.        "
+00036ac0: 2222 0a20 2020 2020 2020 2043 7265 6174  "".        Creat
+00036ad0: 6520 6120 7370 7265 6164 7368 6565 742d  e a spreadsheet-
+00036ae0: 7374 796c 6520 7069 766f 7420 7461 626c  style pivot tabl
+00036af0: 6520 6173 2061 2044 6174 6146 7261 6d65  e as a DataFrame
+00036b00: 2e20 5461 7267 6574 2060 6063 6f6c 756d  . Target ``colum
+00036b10: 6e73 6060 0a20 2020 2020 2020 206d 7573  ns``.        mus
+00036b20: 7420 6861 7665 2063 6174 6567 6f72 7920  t have category 
+00036b30: 6474 7970 6520 746f 2069 6e66 6572 2072  dtype to infer r
+00036b40: 6573 756c 7427 7320 6060 636f 6c75 6d6e  esult's ``column
+00036b50: 7360 602e 0a20 2020 2020 2020 2060 6069  s``..        ``i
+00036b60: 6e64 6578 6060 2c20 6060 636f 6c75 6d6e  ndex``, ``column
+00036b70: 7360 602c 2060 6076 616c 7565 7360 6020  s``, ``values`` 
+00036b80: 616e 6420 6060 6167 6766 756e 6360 6020  and ``aggfunc`` 
+00036b90: 6d75 7374 2062 6520 616c 6c20 7363 616c  must be all scal
+00036ba0: 6172 2e0a 0a20 2020 2020 2020 2050 6172  ar...        Par
+00036bb0: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
+00036bc0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00036bd0: 2020 2076 616c 7565 7320 3a20 7363 616c     values : scal
+00036be0: 6172 0a20 2020 2020 2020 2020 2020 2063  ar.            c
+00036bf0: 6f6c 756d 6e20 746f 2061 6767 7265 6761  olumn to aggrega
+00036c00: 7465 0a20 2020 2020 2020 2069 6e64 6578  te.        index
+00036c10: 203a 2073 6361 6c61 720a 2020 2020 2020   : scalar.      
+00036c20: 2020 2020 2020 636f 6c75 6d6e 2074 6f20        column to 
+00036c30: 6265 2069 6e64 6578 0a20 2020 2020 2020  be index.       
+00036c40: 2063 6f6c 756d 6e73 203a 2073 6361 6c61   columns : scala
+00036c50: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
+00036c60: 6c75 6d6e 2074 6f20 6265 2063 6f6c 756d  lumn to be colum
+00036c70: 6e73 0a20 2020 2020 2020 2061 6767 6675  ns.        aggfu
+00036c80: 6e63 203a 207b 276d 6561 6e27 2c20 2773  nc : {'mean', 's
+00036c90: 756d 272c 2027 636f 756e 7427 7d2c 2064  um', 'count'}, d
+00036ca0: 6566 6175 6c74 2027 6d65 616e 270a 0a20  efault 'mean'.. 
+00036cb0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00036cc0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
+00036cd0: 2020 2020 2020 2074 6162 6c65 203a 2044         table : D
+00036ce0: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
+00036cf0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00036d00: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+00036d10: 2e72 6573 6861 7065 2069 6d70 6f72 7420  .reshape import 
+00036d20: 7069 766f 745f 7461 626c 650a 0a20 2020  pivot_table..   
+00036d30: 2020 2020 2072 6574 7572 6e20 7069 766f       return pivo
+00036d40: 745f 7461 626c 6528 0a20 2020 2020 2020  t_table(.       
+00036d50: 2020 2020 2073 656c 662c 2069 6e64 6578       self, index
+00036d60: 3d69 6e64 6578 2c20 636f 6c75 6d6e 733d  =index, columns=
+00036d70: 636f 6c75 6d6e 732c 2076 616c 7565 733d  columns, values=
+00036d80: 7661 6c75 6573 2c20 6167 6766 756e 633d  values, aggfunc=
+00036d90: 6167 6766 756e 630a 2020 2020 2020 2020  aggfunc.        
+00036da0: 290a 0a20 2020 2064 6566 206d 656c 7428  )..    def melt(
+00036db0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00036dc0: 2020 2020 2020 2069 645f 7661 7273 3d4e         id_vars=N
+00036dd0: 6f6e 652c 0a20 2020 2020 2020 2076 616c  one,.        val
+00036de0: 7565 5f76 6172 733d 4e6f 6e65 2c0a 2020  ue_vars=None,.  
+00036df0: 2020 2020 2020 7661 725f 6e61 6d65 3d4e        var_name=N
+00036e00: 6f6e 652c 0a20 2020 2020 2020 2076 616c  one,.        val
+00036e10: 7565 5f6e 616d 653d 2276 616c 7565 222c  ue_name="value",
+00036e20: 0a20 2020 2020 2020 2063 6f6c 5f6c 6576  .        col_lev
+00036e30: 656c 3d4e 6f6e 652c 0a20 2020 2029 3a0a  el=None,.    ):.
+00036e40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00036e50: 2020 2020 556e 7069 766f 7473 2061 2044      Unpivots a D
+00036e60: 6174 6146 7261 6d65 2066 726f 6d20 7769  ataFrame from wi
+00036e70: 6465 2066 6f72 6d61 7420 746f 206c 6f6e  de format to lon
+00036e80: 6720 666f 726d 6174 2c0a 2020 2020 2020  g format,.      
+00036e90: 2020 6f70 7469 6f6e 616c 6c79 206c 6561    optionally lea
+00036ea0: 7669 6e67 2069 6465 6e74 6966 6965 7220  ving identifier 
+00036eb0: 7661 7269 6162 6c65 7320 7365 742e 0a0a  variables set...
+00036ec0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+00036ed0: 6374 696f 6e20 6973 2075 7365 6675 6c20  ction is useful 
+00036ee0: 746f 206d 6173 7361 6765 2061 2044 6174  to massage a Dat
+00036ef0: 6146 7261 6d65 2069 6e74 6f20 6120 666f  aFrame into a fo
+00036f00: 726d 6174 2077 6865 7265 0a20 2020 2020  rmat where.     
+00036f10: 2020 206f 6e65 206f 7220 6d6f 7265 2063     one or more c
+00036f20: 6f6c 756d 6e73 2061 7265 2069 6465 6e74  olumns are ident
+00036f30: 6966 6965 7220 7661 7269 6162 6c65 7320  ifier variables 
+00036f40: 2860 6069 645f 7661 7273 6060 292c 2077  (``id_vars``), w
+00036f50: 6869 6c65 0a20 2020 2020 2020 2061 6c6c  hile.        all
+00036f60: 206f 7468 6572 2063 6f6c 756d 6e73 2c20   other columns, 
+00036f70: 636f 6e73 6964 6572 6564 206d 6561 7375  considered measu
+00036f80: 7265 6420 7661 7269 6162 6c65 7320 2860  red variables (`
+00036f90: 6076 616c 7565 5f76 6172 7360 6029 2c0a  `value_vars``),.
+00036fa0: 2020 2020 2020 2020 6172 6520 2275 6e70          are "unp
+00036fb0: 6976 6f74 6564 2220 746f 2074 6865 2072  ivoted" to the r
+00036fc0: 6f77 2061 7869 732c 206c 6561 7669 6e67  ow axis, leaving
+00036fd0: 206a 7573 7420 7477 6f20 6e6f 6e2d 6964   just two non-id
+00036fe0: 656e 7469 6669 6572 0a20 2020 2020 2020  entifier.       
+00036ff0: 2063 6f6c 756d 6e73 2c20 2776 6172 6961   columns, 'varia
+00037000: 626c 6527 2061 6e64 2027 7661 6c75 6527  ble' and 'value'
+00037010: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00037020: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00037030: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00037040: 2066 7261 6d65 203a 2044 6174 6146 7261   frame : DataFra
+00037050: 6d65 0a20 2020 2020 2020 2069 645f 7661  me.        id_va
+00037060: 7273 203a 2074 7570 6c65 2c20 6c69 7374  rs : tuple, list
+00037070: 2c20 6f72 206e 6461 7272 6179 2c20 6f70  , or ndarray, op
+00037080: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00037090: 2020 2043 6f6c 756d 6e28 7329 2074 6f20     Column(s) to 
+000370a0: 7573 6520 6173 2069 6465 6e74 6966 6965  use as identifie
+000370b0: 7220 7661 7269 6162 6c65 732e 0a20 2020  r variables..   
+000370c0: 2020 2020 2076 616c 7565 5f76 6172 7320       value_vars 
+000370d0: 3a20 7475 706c 652c 206c 6973 742c 206f  : tuple, list, o
+000370e0: 7220 6e64 6172 7261 792c 206f 7074 696f  r ndarray, optio
+000370f0: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
+00037100: 436f 6c75 6d6e 2873 2920 746f 2075 6e70  Column(s) to unp
+00037110: 6976 6f74 2e20 4966 206e 6f74 2073 7065  ivot. If not spe
+00037120: 6369 6669 6564 2c20 7573 6573 2061 6c6c  cified, uses all
+00037130: 2063 6f6c 756d 6e73 2074 6861 740a 2020   columns that.  
+00037140: 2020 2020 2020 2020 2020 6172 6520 6e6f            are no
+00037150: 7420 7365 7420 6173 2060 6964 5f76 6172  t set as `id_var
+00037160: 7360 2e0a 2020 2020 2020 2020 7661 725f  s`..        var_
+00037170: 6e61 6d65 203a 2073 6361 6c61 720a 2020  name : scalar.  
+00037180: 2020 2020 2020 2020 2020 4e61 6d65 2074            Name t
+00037190: 6f20 7573 6520 666f 7220 7468 6520 2776  o use for the 'v
+000371a0: 6172 6961 626c 6527 2063 6f6c 756d 6e2e  ariable' column.
+000371b0: 2049 6620 4e6f 6e65 2069 7420 7573 6573   If None it uses
+000371c0: 0a20 2020 2020 2020 2020 2020 2060 6066  .            ``f
+000371d0: 7261 6d65 2e63 6f6c 756d 6e73 2e6e 616d  rame.columns.nam
+000371e0: 6560 6020 6f72 2027 7661 7269 6162 6c65  e`` or 'variable
+000371f0: 272e 0a20 2020 2020 2020 2076 616c 7565  '..        value
+00037200: 5f6e 616d 6520 3a20 7363 616c 6172 2c20  _name : scalar, 
+00037210: 6465 6661 756c 7420 2776 616c 7565 270a  default 'value'.
+00037220: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
+00037230: 2074 6f20 7573 6520 666f 7220 7468 6520   to use for the 
+00037240: 2776 616c 7565 2720 636f 6c75 6d6e 2e0a  'value' column..
+00037250: 2020 2020 2020 2020 636f 6c5f 6c65 7665          col_leve
+00037260: 6c20 3a20 696e 7420 6f72 2073 7472 696e  l : int or strin
+00037270: 672c 206f 7074 696f 6e61 6c0a 2020 2020  g, optional.    
+00037280: 2020 2020 2020 2020 4966 2063 6f6c 756d          If colum
+00037290: 6e73 2061 7265 2061 204d 756c 7469 496e  ns are a MultiIn
+000372a0: 6465 7820 7468 656e 2075 7365 2074 6869  dex then use thi
+000372b0: 7320 6c65 7665 6c20 746f 206d 656c 742e  s level to melt.
+000372c0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000372d0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+000372e0: 2d0a 2020 2020 2020 2020 4461 7461 4672  -.        DataFr
+000372f0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+00037300: 556e 7069 766f 7465 6420 4461 7461 4672  Unpivoted DataFr
+00037310: 616d 652e 0a0a 2020 2020 2020 2020 5365  ame...        Se
+00037320: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
+00037330: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00037340: 7061 6e64 6173 2e44 6174 6146 7261 6d65  pandas.DataFrame
+00037350: 2e6d 656c 740a 2020 2020 2020 2020 2222  .melt.        ""
+00037360: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+00037370: 6173 6b2e 6461 7461 6672 616d 652e 7265  ask.dataframe.re
+00037380: 7368 6170 6520 696d 706f 7274 206d 656c  shape import mel
+00037390: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
+000373a0: 6e20 6d65 6c74 280a 2020 2020 2020 2020  n melt(.        
+000373b0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000373c0: 2020 2020 2020 6964 5f76 6172 733d 6964        id_vars=id
+000373d0: 5f76 6172 732c 0a20 2020 2020 2020 2020  _vars,.         
+000373e0: 2020 2076 616c 7565 5f76 6172 733d 7661     value_vars=va
+000373f0: 6c75 655f 7661 7273 2c0a 2020 2020 2020  lue_vars,.      
+00037400: 2020 2020 2020 7661 725f 6e61 6d65 3d76        var_name=v
+00037410: 6172 5f6e 616d 652c 0a20 2020 2020 2020  ar_name,.       
+00037420: 2020 2020 2076 616c 7565 5f6e 616d 653d       value_name=
+00037430: 7661 6c75 655f 6e61 6d65 2c0a 2020 2020  value_name,.    
+00037440: 2020 2020 2020 2020 636f 6c5f 6c65 7665          col_leve
+00037450: 6c3d 636f 6c5f 6c65 7665 6c2c 0a20 2020  l=col_level,.   
+00037460: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00037470: 746f 5f72 6563 6f72 6473 2873 656c 662c  to_records(self,
+00037480: 2069 6e64 6578 3d46 616c 7365 2c20 6c65   index=False, le
+00037490: 6e67 7468 733d 4e6f 6e65 293a 0a20 2020  ngths=None):.   
+000374a0: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
+000374b0: 6174 6166 7261 6d65 2e69 6f20 696d 706f  ataframe.io impo
+000374c0: 7274 2074 6f5f 7265 636f 7264 730a 0a20  rt to_records.. 
+000374d0: 2020 2020 2020 2069 6620 6c65 6e67 7468         if length
+000374e0: 7320 6973 2054 7275 653a 0a20 2020 2020  s is True:.     
+000374f0: 2020 2020 2020 206c 656e 6774 6873 203d         lengths =
+00037500: 2074 7570 6c65 2873 656c 662e 6d61 705f   tuple(self.map_
+00037510: 7061 7274 6974 696f 6e73 286c 656e 292e  partitions(len).
+00037520: 636f 6d70 7574 6528 2929 0a0a 2020 2020  compute())..    
+00037530: 2020 2020 7265 636f 7264 7320 3d20 746f      records = to
+00037540: 5f72 6563 6f72 6473 2873 656c 6629 0a0a  _records(self)..
+00037550: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+00037560: 2073 656c 662e 5f76 616c 6964 6174 655f   self._validate_
+00037570: 6368 756e 6b73 2872 6563 6f72 6473 2c20  chunks(records, 
+00037580: 6c65 6e67 7468 7329 0a20 2020 2020 2020  lengths).       
+00037590: 2072 6563 6f72 6473 2e5f 6368 756e 6b73   records._chunks
+000375a0: 203d 2028 6368 756e 6b73 5b30 5d2c 290a   = (chunks[0],).
+000375b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000375c0: 7265 636f 7264 730a 0a20 2020 2040 6465  records..    @de
+000375d0: 7269 7665 645f 6672 6f6d 2870 642e 4461  rived_from(pd.Da
+000375e0: 7461 4672 616d 6529 0a20 2020 2064 6566  taFrame).    def
+000375f0: 2074 6f5f 6874 6d6c 2873 656c 662c 206d   to_html(self, m
+00037600: 6178 5f72 6f77 733d 3529 3a0a 2020 2020  ax_rows=5):.    
+00037610: 2020 2020 2320 7064 2e53 6572 6965 7320      # pd.Series 
+00037620: 646f 6573 6e27 7420 6861 7665 2068 746d  doesn't have htm
+00037630: 6c20 7265 7072 0a20 2020 2020 2020 2064  l repr.        d
+00037640: 6174 6120 3d20 7365 6c66 2e5f 7265 7072  ata = self._repr
+00037650: 5f64 6174 6128 292e 746f 5f68 746d 6c28  _data().to_html(
+00037660: 6d61 785f 726f 7773 3d6d 6178 5f72 6f77  max_rows=max_row
+00037670: 732c 2073 686f 775f 6469 6d65 6e73 696f  s, show_dimensio
+00037680: 6e73 3d46 616c 7365 290a 2020 2020 2020  ns=False).      
+00037690: 2020 7265 7475 726e 2067 6574 5f74 656d    return get_tem
+000376a0: 706c 6174 6528 2264 6174 6166 7261 6d65  plate("dataframe
+000376b0: 2e68 746d 6c2e 6a32 2229 2e72 656e 6465  .html.j2").rende
+000376c0: 7228 0a20 2020 2020 2020 2020 2020 2064  r(.            d
+000376d0: 6174 613d 6461 7461 2c0a 2020 2020 2020  ata=data,.      
+000376e0: 2020 2020 2020 6e61 6d65 3d73 656c 662e        name=self.
+000376f0: 5f6e 616d 652c 0a20 2020 2020 2020 2020  _name,.         
+00037700: 2020 206c 6179 6572 733d 6d61 7962 655f     layers=maybe_
+00037710: 706c 7572 616c 697a 6528 6c65 6e28 7365  pluralize(len(se
+00037720: 6c66 2e64 6173 6b2e 6c61 7965 7273 292c  lf.dask.layers),
+00037730: 2022 6772 6170 6820 6c61 7965 7222 292c   "graph layer"),
+00037740: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00037750: 6465 6620 5f72 6570 725f 6461 7461 2873  def _repr_data(s
+00037760: 656c 6629 3a0a 2020 2020 2020 2020 6d65  elf):.        me
+00037770: 7461 203d 2073 656c 662e 5f6d 6574 610a  ta = self._meta.
+00037780: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+00037790: 7365 6c66 2e5f 7265 7072 5f64 6976 6973  self._repr_divis
+000377a0: 696f 6e73 0a20 2020 2020 2020 2063 6f6c  ions.        col
+000377b0: 7320 3d20 6d65 7461 2e63 6f6c 756d 6e73  s = meta.columns
+000377c0: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+000377d0: 636f 6c73 2920 3d3d 2030 3a0a 2020 2020  cols) == 0:.    
+000377e0: 2020 2020 2020 2020 7365 7269 6573 5f64          series_d
+000377f0: 6620 3d20 7064 2e44 6174 6146 7261 6d65  f = pd.DataFrame
+00037800: 285b 5b5d 5d20 2a20 6c65 6e28 696e 6465  ([[]] * len(inde
+00037810: 7829 2c20 636f 6c75 6d6e 733d 636f 6c73  x), columns=cols
+00037820: 2c20 696e 6465 783d 696e 6465 7829 0a20  , index=index). 
+00037830: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00037840: 2020 2020 2020 2020 2073 6572 6965 735f           series_
+00037850: 6466 203d 2070 642e 636f 6e63 6174 280a  df = pd.concat(.
+00037860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037870: 5b5f 7265 7072 5f64 6174 615f 7365 7269  [_repr_data_seri
+00037880: 6573 2873 2c20 696e 6465 783d 696e 6465  es(s, index=inde
+00037890: 7829 2066 6f72 205f 2c20 7320 696e 206d  x) for _, s in m
+000378a0: 6574 612e 6974 656d 7328 295d 2c20 6178  eta.items()], ax
+000378b0: 6973 3d31 0a20 2020 2020 2020 2020 2020  is=1.           
+000378c0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+000378d0: 6e20 7365 7269 6573 5f64 660a 0a20 2020  n series_df..   
+000378e0: 2064 6566 205f 7265 7072 5f68 746d 6c5f   def _repr_html_
+000378f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00037900: 6461 7461 203d 2073 656c 662e 5f72 6570  data = self._rep
+00037910: 725f 6461 7461 2829 2e74 6f5f 6874 6d6c  r_data().to_html
+00037920: 280a 2020 2020 2020 2020 2020 2020 6d61  (.            ma
+00037930: 785f 726f 7773 3d35 2c20 7368 6f77 5f64  x_rows=5, show_d
+00037940: 696d 656e 7369 6f6e 733d 4661 6c73 652c  imensions=False,
+00037950: 206e 6f74 6562 6f6f 6b3d 5472 7565 0a20   notebook=True. 
+00037960: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00037970: 2072 6574 7572 6e20 6765 745f 7465 6d70   return get_temp
+00037980: 6c61 7465 2822 6461 7461 6672 616d 652e  late("dataframe.
+00037990: 6874 6d6c 2e6a 3222 292e 7265 6e64 6572  html.j2").render
+000379a0: 280a 2020 2020 2020 2020 2020 2020 6461  (.            da
+000379b0: 7461 3d64 6174 612c 0a20 2020 2020 2020  ta=data,.       
+000379c0: 2020 2020 206e 616d 653d 7365 6c66 2e5f       name=self._
+000379d0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+000379e0: 2020 6c61 7965 7273 3d6d 6179 6265 5f70    layers=maybe_p
+000379f0: 6c75 7261 6c69 7a65 286c 656e 2873 656c  luralize(len(sel
+00037a00: 662e 6461 736b 2e6c 6179 6572 7329 2c20  f.dask.layers), 
+00037a10: 2267 7261 7068 206c 6179 6572 2229 2c0a  "graph layer"),.
+00037a20: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00037a30: 6566 205f 7365 6c65 6374 5f63 6f6c 756d  ef _select_colum
+00037a40: 6e73 5f6f 725f 696e 6465 7828 7365 6c66  ns_or_index(self
+00037a50: 2c20 636f 6c75 6d6e 735f 6f72 5f69 6e64  , columns_or_ind
+00037a60: 6578 293a 0a20 2020 2020 2020 2022 2222  ex):.        """
+00037a70: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00037a80: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+00037a90: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2063  ------.        c
+00037aa0: 6f6c 756d 6e73 5f6f 725f 696e 6465 780a  olumns_or_index.
+00037ab0: 2020 2020 2020 2020 2020 2020 436f 6c75              Colu
+00037ac0: 6d6e 206f 7220 696e 6465 7820 6e61 6d65  mn or index name
+00037ad0: 2c20 6f72 2061 206c 6973 7420 6f66 2074  , or a list of t
+00037ae0: 6865 7365 0a0a 2020 2020 2020 2020 5265  hese..        Re
+00037af0: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+00037b00: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6464  -----.        dd
+00037b10: 2e44 6174 6146 7261 6d65 0a20 2020 2020  .DataFrame.     
+00037b20: 2020 2020 2020 2044 6173 6b20 4461 7461         Dask Data
+00037b30: 4672 616d 6520 7769 7468 2063 6f6c 756d  Frame with colum
+00037b40: 6e73 2063 6f72 7265 7370 6f6e 6469 6e67  ns corresponding
+00037b50: 2074 6f20 6561 6368 2063 6f6c 756d 6e20   to each column 
+00037b60: 6f72 0a20 2020 2020 2020 2020 2020 2069  or.            i
+00037b70: 6e64 6578 206c 6576 656c 2069 6e20 636f  ndex level in co
+00037b80: 6c75 6d6e 735f 6f72 5f69 6e64 6578 2e20  lumns_or_index. 
+00037b90: 2049 6620 696e 636c 7564 6564 2c20 7468   If included, th
+00037ba0: 6520 636f 6c75 6d6e 0a20 2020 2020 2020  e column.       
+00037bb0: 2020 2020 2063 6f72 7265 7370 6f6e 6469       correspondi
+00037bc0: 6e67 2074 6f20 7468 6520 696e 6465 7820  ng to the index 
+00037bd0: 6c65 7665 6c20 6973 206e 616d 6564 205f  level is named _
+00037be0: 696e 6465 780a 2020 2020 2020 2020 2222  index.        ""
+00037bf0: 220a 0a20 2020 2020 2020 2023 2045 6e73  "..        # Ens
+00037c00: 7572 6520 636f 6c75 6d6e 735f 6f72 5f69  ure columns_or_i
+00037c10: 6e64 6578 2069 7320 6120 6c69 7374 0a20  ndex is a list. 
+00037c20: 2020 2020 2020 2063 6f6c 756d 6e73 5f6f         columns_o
+00037c30: 725f 696e 6465 7820 3d20 280a 2020 2020  r_index = (.    
+00037c40: 2020 2020 2020 2020 636f 6c75 6d6e 735f          columns_
+00037c50: 6f72 5f69 6e64 6578 0a20 2020 2020 2020  or_index.       
+00037c60: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00037c70: 6365 2863 6f6c 756d 6e73 5f6f 725f 696e  ce(columns_or_in
+00037c80: 6465 782c 206c 6973 7429 0a20 2020 2020  dex, list).     
+00037c90: 2020 2020 2020 2065 6c73 6520 5b63 6f6c         else [col
+00037ca0: 756d 6e73 5f6f 725f 696e 6465 785d 0a20  umns_or_index]. 
+00037cb0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00037cc0: 2020 636f 6c75 6d6e 5f6e 616d 6573 203d    column_names =
+00037cd0: 205b 0a20 2020 2020 2020 2020 2020 206e   [.            n
+00037ce0: 2066 6f72 206e 2069 6e20 636f 6c75 6d6e   for n in column
+00037cf0: 735f 6f72 5f69 6e64 6578 2069 6620 7365  s_or_index if se
+00037d00: 6c66 2e5f 6973 5f63 6f6c 756d 6e5f 6c61  lf._is_column_la
+00037d10: 6265 6c5f 7265 6665 7265 6e63 6528 6e29  bel_reference(n)
+00037d20: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+00037d30: 2020 2020 7365 6c65 6374 6564 5f64 6620      selected_df 
+00037d40: 3d20 7365 6c66 5b63 6f6c 756d 6e5f 6e61  = self[column_na
+00037d50: 6d65 735d 0a20 2020 2020 2020 2069 6620  mes].        if 
+00037d60: 7365 6c66 2e5f 636f 6e74 6169 6e73 5f69  self._contains_i
+00037d70: 6e64 6578 5f6e 616d 6528 636f 6c75 6d6e  ndex_name(column
+00037d80: 735f 6f72 5f69 6e64 6578 293a 0a20 2020  s_or_index):.   
+00037d90: 2020 2020 2020 2020 2023 2049 6e64 6578           # Index
+00037da0: 206e 616d 6520 7761 7320 696e 636c 7564   name was includ
+00037db0: 6564 0a20 2020 2020 2020 2020 2020 2073  ed.            s
+00037dc0: 656c 6563 7465 645f 6466 203d 2073 656c  elected_df = sel
+00037dd0: 6563 7465 645f 6466 2e61 7373 6967 6e28  ected_df.assign(
+00037de0: 5f69 6e64 6578 3d73 656c 662e 696e 6465  _index=self.inde
+00037df0: 7829 0a0a 2020 2020 2020 2020 7265 7475  x)..        retu
+00037e00: 726e 2073 656c 6563 7465 645f 6466 0a0a  rn selected_df..
+00037e10: 2020 2020 6465 6620 5f69 735f 636f 6c75      def _is_colu
+00037e20: 6d6e 5f6c 6162 656c 5f72 6566 6572 656e  mn_label_referen
+00037e30: 6365 2873 656c 662c 206b 6579 293a 0a20  ce(self, key):. 
+00037e40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00037e50: 2020 2054 6573 7420 7768 6574 6865 7220     Test whether 
+00037e60: 6120 6b65 7920 6973 2061 2063 6f6c 756d  a key is a colum
+00037e70: 6e20 6c61 6265 6c20 7265 6665 7265 6e63  n label referenc
+00037e80: 650a 0a20 2020 2020 2020 2054 6f20 6265  e..        To be
+00037e90: 2063 6f6e 7369 6465 7265 6420 6120 636f   considered a co
+00037ea0: 6c75 6d6e 206c 6162 656c 2072 6566 6572  lumn label refer
+00037eb0: 656e 6365 2c20 606b 6579 6020 6d75 7374  ence, `key` must
+00037ec0: 206d 6174 6368 2074 6865 206e 616d 6520   match the name 
+00037ed0: 6f66 2061 740a 2020 2020 2020 2020 6c65  of at.        le
+00037ee0: 6173 7420 6f6e 6520 636f 6c75 6d6e 2e0a  ast one column..
+00037ef0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00037f00: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+00037f10: 2020 2020 2020 2020 206e 6f74 2069 735f           not is_
+00037f20: 6461 736b 5f63 6f6c 6c65 6374 696f 6e28  dask_collection(
+00037f30: 6b65 7929 0a20 2020 2020 2020 2020 2020  key).           
+00037f40: 2061 6e64 2028 6e70 2e69 7373 6361 6c61   and (np.isscala
+00037f50: 7228 6b65 7929 206f 7220 6973 696e 7374  r(key) or isinst
+00037f60: 616e 6365 286b 6579 2c20 7475 706c 6529  ance(key, tuple)
+00037f70: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+00037f80: 6420 6b65 7920 696e 2073 656c 662e 636f  d key in self.co
+00037f90: 6c75 6d6e 730a 2020 2020 2020 2020 290a  lumns.        ).
+00037fa0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00037fb0: 640a 2020 2020 6465 6620 6672 6f6d 5f64  d.    def from_d
+00037fc0: 6963 7428 0a20 2020 2020 2020 2063 6c73  ict(.        cls
+00037fd0: 2c20 6461 7461 2c20 2a2c 206e 7061 7274  , data, *, npart
+00037fe0: 6974 696f 6e73 2c20 6f72 6965 6e74 3d22  itions, orient="
+00037ff0: 636f 6c75 6d6e 7322 2c20 6474 7970 653d  columns", dtype=
+00038000: 4e6f 6e65 2c20 636f 6c75 6d6e 733d 4e6f  None, columns=No
+00038010: 6e65 0a20 2020 2029 3a0a 2020 2020 2020  ne.    ):.      
+00038020: 2020 2222 220a 2020 2020 2020 2020 436f    """.        Co
+00038030: 6e73 7472 7563 7420 6120 4461 736b 2044  nstruct a Dask D
+00038040: 6174 6146 7261 6d65 2066 726f 6d20 6120  ataFrame from a 
+00038050: 5079 7468 6f6e 2044 6963 7469 6f6e 6172  Python Dictionar
+00038060: 790a 0a20 2020 2020 2020 2053 6565 2041  y..        See A
+00038070: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
+00038080: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
+00038090: 6b2e 6461 7461 6672 616d 652e 6672 6f6d  k.dataframe.from
+000380a0: 5f64 6963 740a 2020 2020 2020 2020 2222  _dict.        ""
+000380b0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+000380c0: 6173 6b2e 6461 7461 6672 616d 652e 696f  ask.dataframe.io
+000380d0: 2069 6d70 6f72 7420 6672 6f6d 5f64 6963   import from_dic
+000380e0: 740a 0a20 2020 2020 2020 2072 6574 7572  t..        retur
+000380f0: 6e20 6672 6f6d 5f64 6963 7428 0a20 2020  n from_dict(.   
+00038100: 2020 2020 2020 2020 2064 6174 612c 0a20           data,. 
+00038110: 2020 2020 2020 2020 2020 206e 7061 7274             npart
+00038120: 6974 696f 6e73 2c0a 2020 2020 2020 2020  itions,.        
+00038130: 2020 2020 6f72 6965 6e74 3d6f 7269 656e      orient=orien
+00038140: 742c 0a20 2020 2020 2020 2020 2020 2064  t,.            d
+00038150: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
+00038160: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+00038170: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
+00038180: 2020 2020 2063 6f6e 7374 7275 6374 6f72       constructor
+00038190: 3d63 6c73 2e5f 7061 7274 6974 696f 6e5f  =cls._partition_
+000381a0: 7479 7065 2c0a 2020 2020 2020 2020 290a  type,.        ).
+000381b0: 0a0a 2320 6269 6e64 206f 7065 7261 746f  ..# bind operato
+000381c0: 7273 0a23 2054 4f44 4f3a 2064 796e 616d  rs.# TODO: dynam
+000381d0: 6963 616c 6c79 2062 6f75 6e64 206f 7065  ically bound ope
+000381e0: 7261 746f 7273 2061 7265 2064 6566 6561  rators are defea
+000381f0: 7469 6e67 2074 7970 6520 616e 6e6f 7461  ting type annota
+00038200: 7469 6f6e 730a 666f 7220 6f70 2069 6e20  tions.for op in 
+00038210: 5b0a 2020 2020 6f70 6572 6174 6f72 2e61  [.    operator.a
+00038220: 6273 2c0a 2020 2020 6f70 6572 6174 6f72  bs,.    operator
+00038230: 2e61 6464 2c0a 2020 2020 6f70 6572 6174  .add,.    operat
+00038240: 6f72 2e61 6e64 5f2c 0a20 2020 206f 7065  or.and_,.    ope
+00038250: 7261 746f 722e 6571 2c0a 2020 2020 6f70  rator.eq,.    op
+00038260: 6572 6174 6f72 2e67 742c 0a20 2020 206f  erator.gt,.    o
+00038270: 7065 7261 746f 722e 6765 2c0a 2020 2020  perator.ge,.    
+00038280: 6f70 6572 6174 6f72 2e69 6e76 2c0a 2020  operator.inv,.  
+00038290: 2020 6f70 6572 6174 6f72 2e6c 742c 0a20    operator.lt,. 
+000382a0: 2020 206f 7065 7261 746f 722e 6c65 2c0a     operator.le,.
+000382b0: 2020 2020 6f70 6572 6174 6f72 2e6d 6f64      operator.mod
+000382c0: 2c0a 2020 2020 6f70 6572 6174 6f72 2e6d  ,.    operator.m
+000382d0: 756c 2c0a 2020 2020 6f70 6572 6174 6f72  ul,.    operator
+000382e0: 2e6e 652c 0a20 2020 206f 7065 7261 746f  .ne,.    operato
+000382f0: 722e 6e65 672c 0a20 2020 206f 7065 7261  r.neg,.    opera
+00038300: 746f 722e 6f72 5f2c 0a20 2020 206f 7065  tor.or_,.    ope
+00038310: 7261 746f 722e 706f 772c 0a20 2020 206f  rator.pow,.    o
+00038320: 7065 7261 746f 722e 7375 622c 0a20 2020  perator.sub,.   
+00038330: 206f 7065 7261 746f 722e 7472 7565 6469   operator.truedi
+00038340: 762c 0a20 2020 206f 7065 7261 746f 722e  v,.    operator.
+00038350: 666c 6f6f 7264 6976 2c0a 2020 2020 6f70  floordiv,.    op
+00038360: 6572 6174 6f72 2e78 6f72 2c0a 5d3a 0a20  erator.xor,.]:. 
+00038370: 2020 205f 4672 616d 652e 5f62 696e 645f     _Frame._bind_
+00038380: 6f70 6572 6174 6f72 286f 7029 0a20 2020  operator(op).   
+00038390: 2053 6361 6c61 722e 5f62 696e 645f 6f70   Scalar._bind_op
+000383a0: 6572 6174 6f72 286f 7029 0a0a 666f 7220  erator(op)..for 
+000383b0: 6e61 6d65 2069 6e20 5b0a 2020 2020 2261  name in [.    "a
+000383c0: 6464 222c 0a20 2020 2022 7375 6222 2c0a  dd",.    "sub",.
+000383d0: 2020 2020 226d 756c 222c 0a20 2020 2022      "mul",.    "
+000383e0: 6469 7622 2c0a 2020 2020 2264 6976 6964  div",.    "divid
+000383f0: 6522 2c0a 2020 2020 2274 7275 6564 6976  e",.    "truediv
+00038400: 222c 0a20 2020 2022 666c 6f6f 7264 6976  ",.    "floordiv
+00038410: 222c 0a20 2020 2022 6d6f 6422 2c0a 2020  ",.    "mod",.  
+00038420: 2020 2270 6f77 222c 0a20 2020 2022 7261    "pow",.    "ra
+00038430: 6464 222c 0a20 2020 2022 7273 7562 222c  dd",.    "rsub",
+00038440: 0a20 2020 2022 726d 756c 222c 0a20 2020  .    "rmul",.   
+00038450: 2022 7264 6976 222c 0a20 2020 2022 7274   "rdiv",.    "rt
+00038460: 7275 6564 6976 222c 0a20 2020 2022 7266  ruediv",.    "rf
+00038470: 6c6f 6f72 6469 7622 2c0a 2020 2020 2272  loordiv",.    "r
+00038480: 6d6f 6422 2c0a 2020 2020 2272 706f 7722  mod",.    "rpow"
+00038490: 2c0a 5d3a 0a20 2020 206d 6574 6820 3d20  ,.]:.    meth = 
+000384a0: 6765 7461 7474 7228 7064 2e44 6174 6146  getattr(pd.DataF
+000384b0: 7261 6d65 2c20 6e61 6d65 290a 2020 2020  rame, name).    
+000384c0: 4461 7461 4672 616d 652e 5f62 696e 645f  DataFrame._bind_
+000384d0: 6f70 6572 6174 6f72 5f6d 6574 686f 6428  operator_method(
+000384e0: 6e61 6d65 2c20 6d65 7468 290a 0a20 2020  name, meth)..   
+000384f0: 206d 6574 6820 3d20 6765 7461 7474 7228   meth = getattr(
+00038500: 7064 2e53 6572 6965 732c 206e 616d 6529  pd.Series, name)
+00038510: 0a20 2020 2053 6572 6965 732e 5f62 696e  .    Series._bin
+00038520: 645f 6f70 6572 6174 6f72 5f6d 6574 686f  d_operator_metho
+00038530: 6428 6e61 6d65 2c20 6d65 7468 290a 0a66  d(name, meth)..f
+00038540: 6f72 206e 616d 6520 696e 205b 226c 7422  or name in ["lt"
+00038550: 2c20 2267 7422 2c20 226c 6522 2c20 2267  , "gt", "le", "g
+00038560: 6522 2c20 226e 6522 2c20 2265 7122 5d3a  e", "ne", "eq"]:
+00038570: 0a20 2020 206d 6574 6820 3d20 6765 7461  .    meth = geta
+00038580: 7474 7228 7064 2e44 6174 6146 7261 6d65  ttr(pd.DataFrame
+00038590: 2c20 6e61 6d65 290a 2020 2020 4461 7461  , name).    Data
+000385a0: 4672 616d 652e 5f62 696e 645f 636f 6d70  Frame._bind_comp
+000385b0: 6172 6973 6f6e 5f6d 6574 686f 6428 6e61  arison_method(na
+000385c0: 6d65 2c20 6d65 7468 290a 0a20 2020 206d  me, meth)..    m
+000385d0: 6574 6820 3d20 6765 7461 7474 7228 7064  eth = getattr(pd
+000385e0: 2e53 6572 6965 732c 206e 616d 6529 0a20  .Series, name). 
+000385f0: 2020 2053 6572 6965 732e 5f62 696e 645f     Series._bind_
+00038600: 636f 6d70 6172 6973 6f6e 5f6d 6574 686f  comparison_metho
+00038610: 6428 6e61 6d65 2c20 6d65 7468 290a 0a0a  d(name, meth)...
+00038620: 6465 6620 6973 5f62 726f 6164 6361 7374  def is_broadcast
+00038630: 6162 6c65 2864 6673 2c20 7329 3a0a 2020  able(dfs, s):.  
+00038640: 2020 2222 220a 2020 2020 5468 6973 2053    """.    This S
+00038650: 6572 6965 7320 6973 2062 726f 6164 6361  eries is broadca
+00038660: 7374 6162 6c65 2061 6761 696e 7374 2061  stable against a
+00038670: 6e6f 7468 6572 2064 6174 6166 7261 6d65  nother dataframe
+00038680: 2069 6e20 7468 6520 7365 7175 656e 6365   in the sequence
+00038690: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000386a0: 6620 636f 6d70 6172 6528 732c 2064 6629  f compare(s, df)
+000386b0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+000386c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000386d0: 6e20 732e 6469 7669 7369 6f6e 7320 3d3d  n s.divisions ==
+000386e0: 2028 6466 2e63 6f6c 756d 6e73 2e6d 696e   (df.columns.min
+000386f0: 2829 2c20 6466 2e63 6f6c 756d 6e73 2e6d  (), df.columns.m
+00038700: 6178 2829 290a 2020 2020 2020 2020 6578  ax()).        ex
+00038710: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+00038720: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00038730: 726e 2046 616c 7365 0a0a 2020 2020 7265  rn False..    re
+00038740: 7475 726e 2028 0a20 2020 2020 2020 2069  turn (.        i
+00038750: 7369 6e73 7461 6e63 6528 732c 2053 6572  sinstance(s, Ser
+00038760: 6965 7329 0a20 2020 2020 2020 2061 6e64  ies).        and
+00038770: 2073 2e6e 7061 7274 6974 696f 6e73 203d   s.npartitions =
+00038780: 3d20 310a 2020 2020 2020 2020 616e 6420  = 1.        and 
+00038790: 732e 6b6e 6f77 6e5f 6469 7669 7369 6f6e  s.known_division
+000387a0: 730a 2020 2020 2020 2020 616e 6420 616e  s.        and an
+000387b0: 7928 636f 6d70 6172 6528 732c 2064 6629  y(compare(s, df)
+000387c0: 2066 6f72 2064 6620 696e 2064 6673 2069   for df in dfs i
+000387d0: 6620 6973 696e 7374 616e 6365 2864 662c  f isinstance(df,
+000387e0: 2044 6174 6146 7261 6d65 2929 0a20 2020   DataFrame)).   
+000387f0: 2029 0a0a 0a64 6566 2065 6c65 6d77 6973   )...def elemwis
+00038800: 6528 6f70 2c20 2a61 7267 732c 206d 6574  e(op, *args, met
+00038810: 613d 6e6f 5f64 6566 6175 6c74 2c20 6f75  a=no_default, ou
+00038820: 743d 4e6f 6e65 2c20 7472 616e 7366 6f72  t=None, transfor
+00038830: 6d5f 6469 7669 7369 6f6e 733d 5472 7565  m_divisions=True
+00038840: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00038850: 2022 2222 456c 656d 656e 7477 6973 6520   """Elementwise 
+00038860: 6f70 6572 6174 696f 6e20 666f 7220 4461  operation for Da
+00038870: 736b 2064 6174 6166 7261 6d65 730a 0a20  sk dataframes.. 
+00038880: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00038890: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000388a0: 206f 703a 2063 616c 6c61 626c 650a 2020   op: callable.  
+000388b0: 2020 2020 2020 4675 6e63 7469 6f6e 2074        Function t
+000388c0: 6f20 6170 706c 7920 6163 726f 7373 2069  o apply across i
+000388d0: 6e70 7574 2064 6174 6166 7261 6d65 730a  nput dataframes.
+000388e0: 2020 2020 2a61 7267 733a 2044 6174 6146      *args: DataF
+000388f0: 7261 6d65 732c 2053 6572 6965 732c 2053  rames, Series, S
+00038900: 6361 6c61 7273 2c20 4172 7261 7973 2c0a  calars, Arrays,.
+00038910: 2020 2020 2020 2020 5468 6520 6172 6775          The argu
+00038920: 6d65 6e74 7320 6f66 2074 6865 206f 7065  ments of the ope
+00038930: 7261 7469 6f6e 0a20 2020 206d 6574 613a  ration.    meta:
+00038940: 2070 642e 4461 7461 4672 616d 652c 2070   pd.DataFrame, p
+00038950: 642e 5365 7269 6573 2028 6f70 7469 6f6e  d.Series (option
+00038960: 616c 290a 2020 2020 2020 2020 5661 6c69  al).        Vali
+00038970: 6420 6d65 7461 6461 7461 2066 6f72 2074  d metadata for t
+00038980: 6865 206f 7065 7261 7469 6f6e 2e20 2057  he operation.  W
+00038990: 696c 6c20 6576 616c 7561 7465 206f 6e20  ill evaluate on 
+000389a0: 6120 736d 616c 6c20 7069 6563 6520 6f66  a small piece of
+000389b0: 0a20 2020 2020 2020 2064 6174 6120 6966  .        data if
+000389c0: 206e 6f74 2070 726f 7669 6465 642e 0a20   not provided.. 
+000389d0: 2020 2074 7261 6e73 666f 726d 5f64 6976     transform_div
+000389e0: 6973 696f 6e73 3a20 626f 6f6c 6561 6e0a  isions: boolean.
+000389f0: 2020 2020 2020 2020 4966 2074 6865 2069          If the i
+00038a00: 6e70 7574 2069 7320 6120 6060 6461 736b  nput is a ``dask
+00038a10: 2e64 6174 6166 7261 6d65 2e49 6e64 6578  .dataframe.Index
+00038a20: 6060 2077 6520 6e6f 726d 616c 6c79 2077  `` we normally w
+00038a30: 696c 6c20 616c 736f 2061 7070 6c79 0a20  ill also apply. 
+00038a40: 2020 2020 2020 2074 6865 2066 756e 6374         the funct
+00038a50: 696f 6e20 6f6e 746f 2074 6865 2064 6976  ion onto the div
+00038a60: 6973 696f 6e73 2061 6e64 2061 7070 6c79  isions and apply
+00038a70: 2074 686f 7365 2074 7261 6e73 666f 726d   those transform
+00038a80: 6564 2064 6976 6973 696f 6e73 0a20 2020  ed divisions.   
+00038a90: 2020 2020 2074 6f20 7468 6520 6f75 7470       to the outp
+00038aa0: 7574 2e20 2059 6f75 2063 616e 2070 6173  ut.  You can pas
+00038ab0: 7320 6060 7472 616e 7366 6f72 6d5f 6469  s ``transform_di
+00038ac0: 7669 7369 6f6e 733d 4661 6c73 6560 6020  visions=False`` 
+00038ad0: 746f 206f 7665 7272 6964 650a 2020 2020  to override.    
+00038ae0: 2020 2020 7468 6973 2062 6568 6176 696f      this behavio
+00038af0: 720a 2020 2020 6f75 7420 3a20 6060 6461  r.    out : ``da
+00038b00: 736b 2e61 7272 6179 6060 206f 7220 6060  sk.array`` or ``
+00038b10: 4e6f 6e65 6060 0a20 2020 2020 2020 2049  None``.        I
+00038b20: 6620 6f75 7420 6973 2061 2064 6173 6b2e  f out is a dask.
+00038b30: 4461 7461 4672 616d 652c 2064 6173 6b2e  DataFrame, dask.
+00038b40: 5365 7269 6573 206f 7220 6461 736b 2e53  Series or dask.S
+00038b50: 6361 6c61 7220 7468 656e 0a20 2020 2020  calar then.     
+00038b60: 2020 2074 6869 7320 6f76 6572 7772 6974     this overwrit
+00038b70: 6573 2074 6865 2063 6f6e 7465 6e74 7320  es the contents 
+00038b80: 6f66 2069 7420 7769 7468 2074 6865 2072  of it with the r
+00038b90: 6573 756c 740a 2020 2020 2a2a 6b77 6172  esult.    **kwar
+00038ba0: 6773 3a20 7363 616c 6172 730a 0a20 2020  gs: scalars..   
+00038bb0: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
+00038bc0: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2065  ------.    >>> e
+00038bd0: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00038be0: 2e61 6464 2c20 6466 2e78 2c20 6466 2e79  .add, df.x, df.y
+00038bf0: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
+00038c00: 4b49 500a 2020 2020 2222 220a 2020 2020  KIP.    """.    
+00038c10: 5f6e 616d 6520 3d20 6675 6e63 6e61 6d65  _name = funcname
+00038c20: 286f 7029 202b 2022 2d22 202b 2074 6f6b  (op) + "-" + tok
+00038c30: 656e 697a 6528 6f70 2c20 2a61 7267 732c  enize(op, *args,
+00038c40: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00038c50: 6172 6773 203d 205f 6d61 7962 655f 6672  args = _maybe_fr
+00038c60: 6f6d 5f70 616e 6461 7328 6172 6773 290a  om_pandas(args).
+00038c70: 0a20 2020 2066 726f 6d20 6461 736b 2e64  .    from dask.d
+00038c80: 6174 6166 7261 6d65 2e6d 756c 7469 2069  ataframe.multi i
+00038c90: 6d70 6f72 7420 5f6d 6179 6265 5f61 6c69  mport _maybe_ali
+00038ca0: 676e 5f70 6172 7469 7469 6f6e 730a 0a20  gn_partitions.. 
+00038cb0: 2020 2061 7267 7320 3d20 5f6d 6179 6265     args = _maybe
+00038cc0: 5f61 6c69 676e 5f70 6172 7469 7469 6f6e  _align_partition
+00038cd0: 7328 6172 6773 290a 2020 2020 6461 736b  s(args).    dask
+00038ce0: 7320 3d20 5b61 7267 2066 6f72 2061 7267  s = [arg for arg
+00038cf0: 2069 6e20 6172 6773 2069 6620 6973 696e   in args if isin
+00038d00: 7374 616e 6365 2861 7267 2c20 285f 4672  stance(arg, (_Fr
+00038d10: 616d 652c 2053 6361 6c61 722c 2041 7272  ame, Scalar, Arr
+00038d20: 6179 2929 5d0a 2020 2020 6466 7320 3d20  ay))].    dfs = 
+00038d30: 5b64 6620 666f 7220 6466 2069 6e20 6461  [df for df in da
+00038d40: 736b 7320 6966 2069 7369 6e73 7461 6e63  sks if isinstanc
+00038d50: 6528 6466 2c20 5f46 7261 6d65 295d 0a0a  e(df, _Frame)]..
+00038d60: 2020 2020 2320 436c 6561 6e20 7570 2064      # Clean up d
+00038d70: 6173 6b20 6172 7261 7973 2069 6620 7072  ask arrays if pr
+00038d80: 6573 656e 740a 2020 2020 6465 7073 203d  esent.    deps =
+00038d90: 2064 6173 6b73 2e63 6f70 7928 290a 2020   dasks.copy().  
+00038da0: 2020 666f 7220 692c 2061 2069 6e20 656e    for i, a in en
+00038db0: 756d 6572 6174 6528 6461 736b 7329 3a0a  umerate(dasks):.
+00038dc0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00038dd0: 7369 6e73 7461 6e63 6528 612c 2041 7272  sinstance(a, Arr
+00038de0: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
+00038df0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00038e00: 2020 2320 456e 7375 7265 2074 6861 7420    # Ensure that 
+00038e10: 7468 6579 2068 6176 6520 7369 6d69 6c61  they have simila
+00038e20: 722d 6973 6820 6368 756e 6b20 7374 7275  r-ish chunk stru
+00038e30: 6374 7572 650a 2020 2020 2020 2020 6966  cture.        if
+00038e40: 206e 6f74 2061 6c6c 286e 6f74 2061 2e63   not all(not a.c
+00038e50: 6875 6e6b 7320 6f72 206c 656e 2861 2e63  hunks or len(a.c
+00038e60: 6875 6e6b 735b 305d 2920 3d3d 2064 662e  hunks[0]) == df.
+00038e70: 6e70 6172 7469 7469 6f6e 7320 666f 7220  npartitions for 
+00038e80: 6466 2069 6e20 6466 7329 3a0a 2020 2020  df in dfs):.    
+00038e90: 2020 2020 2020 2020 6d73 6720 3d20 280a          msg = (.
+00038ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038eb0: 2257 6865 6e20 636f 6d62 696e 696e 6720  "When combining 
+00038ec0: 6461 736b 2061 7272 6179 7320 7769 7468  dask arrays with
+00038ed0: 2064 6174 6166 7261 6d65 7320 7468 6579   dataframes they
+00038ee0: 206d 7573 7420 220a 2020 2020 2020 2020   must ".        
+00038ef0: 2020 2020 2020 2020 226d 6174 6368 2063          "match c
+00038f00: 6875 6e6b 696e 6720 6578 6163 746c 792e  hunking exactly.
+00038f10: 2020 4f70 6572 6174 696f 6e3a 2025 7322    Operation: %s"
+00038f20: 2025 2066 756e 636e 616d 6528 6f70 290a   % funcname(op).
+00038f30: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00038f40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00038f50: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+00038f60: 2020 2020 2020 2020 2320 5265 6368 756e          # Rechun
+00038f70: 6b20 746f 2068 6176 6520 6120 7369 6e67  k to have a sing
+00038f80: 6c65 2063 6875 6e6b 2061 6c6f 6e67 2061  le chunk along a
+00038f90: 6c6c 206f 7468 6572 2061 7865 730a 2020  ll other axes.  
+00038fa0: 2020 2020 2020 6966 2061 2e6e 6469 6d20        if a.ndim 
+00038fb0: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00038fc0: 2061 203d 2061 2e72 6563 6875 6e6b 287b   a = a.rechunk({
+00038fd0: 6920 2b20 313a 2064 2066 6f72 2069 2c20  i + 1: d for i, 
+00038fe0: 6420 696e 2065 6e75 6d65 7261 7465 2861  d in enumerate(a
+00038ff0: 2e73 6861 7065 5b31 3a5d 297d 290a 2020  .shape[1:])}).  
+00039000: 2020 2020 2020 2020 2020 6461 736b 735b            dasks[
+00039010: 695d 203d 2061 0a0a 2020 2020 6469 7669  i] = a..    divi
+00039020: 7369 6f6e 7320 3d20 6466 735b 305d 2e64  sions = dfs[0].d
+00039030: 6976 6973 696f 6e73 0a20 2020 2069 6620  ivisions.    if 
+00039040: 7472 616e 7366 6f72 6d5f 6469 7669 7369  transform_divisi
+00039050: 6f6e 7320 616e 6420 6973 696e 7374 616e  ons and isinstan
+00039060: 6365 2864 6673 5b30 5d2c 2049 6e64 6578  ce(dfs[0], Index
+00039070: 2920 616e 6420 6c65 6e28 6466 7329 203d  ) and len(dfs) =
+00039080: 3d20 313a 0a20 2020 2020 2020 2074 7279  = 1:.        try
+00039090: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+000390a0: 7669 7369 6f6e 7320 3d20 6f70 280a 2020  visions = op(.  
+000390b0: 2020 2020 2020 2020 2020 2020 2020 2a5b                *[
+000390c0: 7064 2e49 6e64 6578 2861 7267 2e64 6976  pd.Index(arg.div
+000390d0: 6973 696f 6e73 2920 6966 2061 7267 2069  isions) if arg i
+000390e0: 7320 6466 735b 305d 2065 6c73 6520 6172  s dfs[0] else ar
+000390f0: 6720 666f 7220 6172 6720 696e 2061 7267  g for arg in arg
+00039100: 735d 2c0a 2020 2020 2020 2020 2020 2020  s],.            
+00039110: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+00039120: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00039130: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00039140: 7461 6e63 6528 6469 7669 7369 6f6e 732c  tance(divisions,
+00039150: 2070 642e 496e 6465 7829 3a0a 2020 2020   pd.Index):.    
+00039160: 2020 2020 2020 2020 2020 2020 6469 7669              divi
+00039170: 7369 6f6e 7320 3d20 6d65 7468 6f64 732e  sions = methods.
+00039180: 746f 6c69 7374 2864 6976 6973 696f 6e73  tolist(divisions
+00039190: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+000391a0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+000391b0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+000391c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000391d0: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
+000391e0: 6c69 645f 6469 7669 7369 6f6e 7328 6469  lid_divisions(di
+000391f0: 7669 7369 6f6e 7329 3a0a 2020 2020 2020  visions):.      
+00039200: 2020 2020 2020 2020 2020 6469 7669 7369            divisi
+00039210: 6f6e 7320 3d20 5b4e 6f6e 655d 202a 2028  ons = [None] * (
+00039220: 6466 735b 305d 2e6e 7061 7274 6974 696f  dfs[0].npartitio
+00039230: 6e73 202b 2031 290a 0a20 2020 205f 6973  ns + 1)..    _is
+00039240: 5f62 726f 6164 6361 7374 6162 6c65 203d  _broadcastable =
+00039250: 2070 6172 7469 616c 2869 735f 6272 6f61   partial(is_broa
+00039260: 6463 6173 7461 626c 652c 2064 6673 290a  dcastable, dfs).
+00039270: 2020 2020 6466 7320 3d20 6c69 7374 2872      dfs = list(r
+00039280: 656d 6f76 6528 5f69 735f 6272 6f61 6463  emove(_is_broadc
+00039290: 6173 7461 626c 652c 2064 6673 2929 0a0a  astable, dfs))..
+000392a0: 2020 2020 6f74 6865 7220 3d20 5b0a 2020      other = [.  
+000392b0: 2020 2020 2020 2869 2c20 6172 6729 0a20        (i, arg). 
+000392c0: 2020 2020 2020 2066 6f72 2069 2c20 6172         for i, ar
+000392d0: 6720 696e 2065 6e75 6d65 7261 7465 2861  g in enumerate(a
+000392e0: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
+000392f0: 6e6f 7420 6973 696e 7374 616e 6365 2861  not isinstance(a
+00039300: 7267 2c20 285f 4672 616d 652c 2053 6361  rg, (_Frame, Sca
+00039310: 6c61 722c 2041 7272 6179 2929 0a20 2020  lar, Array)).   
+00039320: 205d 0a0a 2020 2020 2320 6164 6a75 7374   ]..    # adjust
+00039330: 2074 6865 206b 6579 206c 656e 6774 6820   the key length 
+00039340: 6f66 2053 6361 6c61 720a 2020 2020 6473  of Scalar.    ds
+00039350: 6b20 3d20 7061 7274 6974 696f 6e77 6973  k = partitionwis
+00039360: 655f 6772 6170 6828 6f70 2c20 5f6e 616d  e_graph(op, _nam
+00039370: 652c 202a 6172 6773 2c20 2a2a 6b77 6172  e, *args, **kwar
+00039380: 6773 290a 0a20 2020 2067 7261 7068 203d  gs)..    graph =
+00039390: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
+000393a0: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
+000393b0: 285f 6e61 6d65 2c20 6473 6b2c 2064 6570  (_name, dsk, dep
+000393c0: 656e 6465 6e63 6965 733d 6465 7073 290a  endencies=deps).
+000393d0: 0a20 2020 2069 6620 6d65 7461 2069 7320  .    if meta is 
+000393e0: 6e6f 5f64 6566 6175 6c74 3a0a 2020 2020  no_default:.    
+000393f0: 2020 2020 6966 206c 656e 2864 6673 2920      if len(dfs) 
+00039400: 3e3d 2032 2061 6e64 206e 6f74 2061 6c6c  >= 2 and not all
+00039410: 2868 6173 6174 7472 2864 2c20 226e 7061  (hasattr(d, "npa
+00039420: 7274 6974 696f 6e73 2229 2066 6f72 2064  rtitions") for d
+00039430: 2069 6e20 6461 736b 7329 3a0a 2020 2020   in dasks):.    
+00039440: 2020 2020 2020 2020 2320 7368 6f75 6c64          # should
+00039450: 206e 6f74 206f 6363 7572 2069 6e20 6375   not occur in cu
+00039460: 7272 656e 7420 6675 6e63 730a 2020 2020  rrent funcs.    
+00039470: 2020 2020 2020 2020 6d73 6720 3d20 2265          msg = "e
+00039480: 6c65 6d77 6973 6520 7769 7468 2032 206f  lemwise with 2 o
+00039490: 7220 6d6f 7265 2044 6174 6146 7261 6d65  r more DataFrame
+000394a0: 7320 616e 6420 5363 616c 6172 2069 7320  s and Scalar is 
+000394b0: 6e6f 7420 7375 7070 6f72 7465 6422 0a20  not supported". 
+000394c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000394d0: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+000394e0: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
+000394f0: 2020 2320 466f 7220 6272 6f61 6463 6173    # For broadcas
+00039500: 7461 626c 6520 7365 7269 6573 2c20 7573  table series, us
+00039510: 6520 6e6f 2072 6f77 732e 0a20 2020 2020  e no rows..     
+00039520: 2020 2070 6172 7473 203d 205b 0a20 2020     parts = [.   
+00039530: 2020 2020 2020 2020 2064 2e5f 6d65 7461           d._meta
+00039540: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00039550: 5f69 735f 6272 6f61 6463 6173 7461 626c  _is_broadcastabl
+00039560: 6528 6429 0a20 2020 2020 2020 2020 2020  e(d).           
+00039570: 2065 6c73 6520 6e70 2e65 6d70 7479 2828   else np.empty((
+00039580: 292c 2064 7479 7065 3d64 2e64 7479 7065  ), dtype=d.dtype
+00039590: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000395a0: 2069 7369 6e73 7461 6e63 6528 642c 2041   isinstance(d, A
+000395b0: 7272 6179 290a 2020 2020 2020 2020 2020  rray).          
+000395c0: 2020 656c 7365 2064 2e5f 6d65 7461 5f6e    else d._meta_n
+000395d0: 6f6e 656d 7074 790a 2020 2020 2020 2020  onempty.        
+000395e0: 2020 2020 666f 7220 6420 696e 2064 6173      for d in das
+000395f0: 6b73 0a20 2020 2020 2020 205d 0a20 2020  ks.        ].   
+00039600: 2020 2020 2077 6974 6820 7261 6973 655f       with raise_
+00039610: 6f6e 5f6d 6574 615f 6572 726f 7228 6675  on_meta_error(fu
+00039620: 6e63 6e61 6d65 286f 7029 293a 0a20 2020  ncname(op)):.   
+00039630: 2020 2020 2020 2020 206d 6574 6120 3d20           meta = 
+00039640: 7061 7274 6961 6c5f 6279 5f6f 7264 6572  partial_by_order
+00039650: 282a 7061 7274 732c 2066 756e 6374 696f  (*parts, functio
+00039660: 6e3d 6f70 2c20 6f74 6865 723d 6f74 6865  n=op, other=othe
+00039670: 7229 0a0a 2020 2020 7265 7375 6c74 203d  r)..    result =
+00039680: 206e 6577 5f64 645f 6f62 6a65 6374 2867   new_dd_object(g
+00039690: 7261 7068 2c20 5f6e 616d 652c 206d 6574  raph, _name, met
+000396a0: 612c 2064 6976 6973 696f 6e73 290a 2020  a, divisions).  
+000396b0: 2020 7265 7475 726e 2068 616e 646c 655f    return handle_
+000396c0: 6f75 7428 6f75 742c 2072 6573 756c 7429  out(out, result)
+000396d0: 0a0a 0a64 6566 2068 616e 646c 655f 6f75  ...def handle_ou
+000396e0: 7428 6f75 742c 2072 6573 756c 7429 3a0a  t(out, result):.
+000396f0: 2020 2020 2222 2248 616e 646c 6520 6f75      """Handle ou
+00039700: 7420 7061 7261 6d65 7465 7273 0a0a 2020  t parameters..  
+00039710: 2020 4966 206f 7574 2069 7320 6120 6461    If out is a da
+00039720: 736b 2e44 6174 6146 7261 6d65 2c20 6461  sk.DataFrame, da
+00039730: 736b 2e53 6572 6965 7320 6f72 2064 6173  sk.Series or das
+00039740: 6b2e 5363 616c 6172 2074 6865 6e0a 2020  k.Scalar then.  
+00039750: 2020 7468 6973 206f 7665 7277 7269 7465    this overwrite
+00039760: 7320 7468 6520 636f 6e74 656e 7473 206f  s the contents o
+00039770: 6620 6974 2077 6974 6820 7468 6520 7265  f it with the re
+00039780: 7375 6c74 0a20 2020 2022 2222 0a20 2020  sult.    """.   
+00039790: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+000397a0: 7574 2c20 7475 706c 6529 3a0a 2020 2020  ut, tuple):.    
+000397b0: 2020 2020 6966 206c 656e 286f 7574 2920      if len(out) 
+000397c0: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+000397d0: 2020 6f75 7420 3d20 6f75 745b 305d 0a20    out = out[0]. 
+000397e0: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
+000397f0: 6f75 7429 203e 2031 3a0a 2020 2020 2020  out) > 1:.      
+00039800: 2020 2020 2020 7261 6973 6520 4e6f 7449        raise NotI
+00039810: 6d70 6c65 6d65 6e74 6564 4572 726f 7228  mplementedError(
+00039820: 2254 6865 206f 7574 2070 6172 616d 6574  "The out paramet
+00039830: 6572 2069 7320 6e6f 7420 6675 6c6c 7920  er is not fully 
+00039840: 7375 7070 6f72 7465 6422 290a 2020 2020  supported").    
+00039850: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00039860: 2020 2020 2020 6f75 7420 3d20 4e6f 6e65        out = None
+00039870: 0a0a 2020 2020 2320 4e6f 7469 6365 2c20  ..    # Notice, 
+00039880: 7765 2075 7365 202e 5f5f 636c 6173 735f  we use .__class_
+00039890: 5f20 6173 206f 7070 6f73 6564 2074 6f20  _ as opposed to 
+000398a0: 7479 7065 2829 2069 6e20 6f72 6465 7220  type() in order 
+000398b0: 746f 2073 7570 706f 7274 0a20 2020 2023  to support.    #
+000398c0: 206f 626a 6563 7420 7072 6f78 6965 7320   object proxies 
+000398d0: 7365 6520 3c68 7474 7073 3a2f 2f67 6974  see <https://git
+000398e0: 6875 622e 636f 6d2f 6461 736b 2f64 6173  hub.com/dask/das
+000398f0: 6b2f 7075 6c6c 2f36 3938 313e 0a20 2020  k/pull/6981>.   
+00039900: 2069 6620 6f75 7420 6973 206e 6f74 204e   if out is not N
+00039910: 6f6e 6520 616e 6420 6f75 742e 5f5f 636c  one and out.__cl
+00039920: 6173 735f 5f20 213d 2072 6573 756c 742e  ass__ != result.
+00039930: 5f5f 636c 6173 735f 5f3a 0a20 2020 2020  __class__:.     
+00039940: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00039950: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00039960: 224d 6973 6d61 7463 6865 6420 7479 7065  "Mismatched type
+00039970: 7320 6265 7477 6565 6e20 7265 7375 6c74  s between result
+00039980: 2061 6e64 206f 7574 2070 6172 616d 6574   and out paramet
+00039990: 6572 2e20 220a 2020 2020 2020 2020 2020  er. ".          
+000399a0: 2020 226f 7574 3d25 732c 2072 6573 756c    "out=%s, resul
+000399b0: 743d 2573 2220 2520 2873 7472 2874 7970  t=%s" % (str(typ
+000399c0: 6528 6f75 7429 292c 2073 7472 2874 7970  e(out)), str(typ
+000399d0: 6528 7265 7375 6c74 2929 290a 2020 2020  e(result))).    
+000399e0: 2020 2020 290a 0a20 2020 2069 6620 6973      )..    if is
+000399f0: 696e 7374 616e 6365 286f 7574 2c20 4461  instance(out, Da
+00039a00: 7461 4672 616d 6529 3a0a 2020 2020 2020  taFrame):.      
+00039a10: 2020 6966 206c 656e 286f 7574 2e63 6f6c    if len(out.col
+00039a20: 756d 6e73 2920 213d 206c 656e 2872 6573  umns) != len(res
+00039a30: 756c 742e 636f 6c75 6d6e 7329 3a0a 2020  ult.columns):.  
+00039a40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00039a50: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00039a60: 2020 2020 2020 2020 2020 2020 224d 6973              "Mis
+00039a70: 6d61 7463 6865 6420 636f 6c75 6d6e 7320  matched columns 
+00039a80: 636f 756e 7420 6265 7477 6565 6e20 7265  count between re
+00039a90: 7375 6c74 2061 6e64 206f 7574 2070 6172  sult and out par
+00039aa0: 616d 6574 6572 2e20 220a 2020 2020 2020  ameter. ".      
+00039ab0: 2020 2020 2020 2020 2020 226f 7574 3d25            "out=%
+00039ac0: 732c 2072 6573 756c 743d 2573 2220 2520  s, result=%s" % 
+00039ad0: 2873 7472 286c 656e 286f 7574 2e63 6f6c  (str(len(out.col
+00039ae0: 756d 6e73 2929 2c20 7374 7228 6c65 6e28  umns)), str(len(
+00039af0: 7265 7375 6c74 2e63 6f6c 756d 6e73 2929  result.columns))
+00039b00: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00039b10: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
+00039b20: 6365 286f 7574 2c20 2853 6572 6965 732c  ce(out, (Series,
+00039b30: 2044 6174 6146 7261 6d65 2c20 5363 616c   DataFrame, Scal
+00039b40: 6172 2929 3a0a 2020 2020 2020 2020 6f75  ar)):.        ou
+00039b50: 742e 5f6d 6574 6120 3d20 7265 7375 6c74  t._meta = result
+00039b60: 2e5f 6d65 7461 0a20 2020 2020 2020 206f  ._meta.        o
+00039b70: 7574 2e5f 6e61 6d65 203d 2072 6573 756c  ut._name = resul
+00039b80: 742e 5f6e 616d 650a 2020 2020 2020 2020  t._name.        
+00039b90: 6f75 742e 6461 736b 203d 2072 6573 756c  out.dask = resul
+00039ba0: 742e 6461 736b 0a0a 2020 2020 2020 2020  t.dask..        
+00039bb0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00039bc0: 6528 6f75 742c 2053 6361 6c61 7229 3a0a  e(out, Scalar):.
+00039bd0: 2020 2020 2020 2020 2020 2020 6f75 742e              out.
+00039be0: 5f64 6976 6973 696f 6e73 203d 2072 6573  _divisions = res
+00039bf0: 756c 742e 6469 7669 7369 6f6e 730a 2020  ult.divisions.  
+00039c00: 2020 656c 6966 206f 7574 2069 7320 6e6f    elif out is no
+00039c10: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00039c20: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
+00039c30: 2020 2020 2254 6865 206f 7574 2070 6172      "The out par
+00039c40: 616d 6574 6572 2069 7320 6e6f 7420 6675  ameter is not fu
+00039c50: 6c6c 7920 7375 7070 6f72 7465 642e 220a  lly supported.".
+00039c60: 2020 2020 2020 2020 2020 2020 2220 5265              " Re
+00039c70: 6365 6976 6564 2074 7970 6520 2573 2c20  ceived type %s, 
+00039c80: 6578 7065 6374 6564 2025 7320 220a 2020  expected %s ".  
+00039c90: 2020 2020 2020 2020 2020 2520 280a 2020            % (.  
+00039ca0: 2020 2020 2020 2020 2020 2020 2020 7479                ty
+00039cb0: 7065 6e61 6d65 2874 7970 6528 6f75 7429  pename(type(out)
+00039cc0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00039cd0: 2020 2074 7970 656e 616d 6528 7479 7065     typename(type
+00039ce0: 2872 6573 756c 7429 292c 0a20 2020 2020  (result)),.     
+00039cf0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00039d00: 2029 0a20 2020 2020 2020 2072 6169 7365   ).        raise
+00039d10: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+00039d20: 7272 6f72 286d 7367 290a 2020 2020 656c  rror(msg).    el
+00039d30: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
+00039d40: 726e 2072 6573 756c 740a 0a0a 6465 6620  rn result...def 
+00039d50: 5f6d 6179 6265 5f66 726f 6d5f 7061 6e64  _maybe_from_pand
+00039d60: 6173 2864 6673 293a 0a20 2020 2066 726f  as(dfs):.    fro
+00039d70: 6d20 6461 736b 2e64 6174 6166 7261 6d65  m dask.dataframe
+00039d80: 2e69 6f20 696d 706f 7274 2066 726f 6d5f  .io import from_
+00039d90: 7061 6e64 6173 0a0a 2020 2020 6466 7320  pandas..    dfs 
+00039da0: 3d20 5b0a 2020 2020 2020 2020 6672 6f6d  = [.        from
+00039db0: 5f70 616e 6461 7328 6466 2c20 3129 0a20  _pandas(df, 1). 
+00039dc0: 2020 2020 2020 2069 6620 2869 735f 7365         if (is_se
+00039dd0: 7269 6573 5f6c 696b 6528 6466 2920 6f72  ries_like(df) or
+00039de0: 2069 735f 6461 7461 6672 616d 655f 6c69   is_dataframe_li
+00039df0: 6b65 2864 6629 2920 616e 6420 6e6f 7420  ke(df)) and not 
+00039e00: 6973 5f64 6173 6b5f 636f 6c6c 6563 7469  is_dask_collecti
+00039e10: 6f6e 2864 6629 0a20 2020 2020 2020 2065  on(df).        e
+00039e20: 6c73 6520 6466 0a20 2020 2020 2020 2066  lse df.        f
+00039e30: 6f72 2064 6620 696e 2064 6673 0a20 2020  or df in dfs.   
+00039e40: 205d 0a20 2020 2072 6574 7572 6e20 6466   ].    return df
+00039e50: 730a 0a0a 6465 6620 6861 7368 5f73 6861  s...def hash_sha
+00039e60: 7264 280a 2020 2020 6466 2c20 6e70 6172  rd(.    df, npar
+00039e70: 7473 2c20 7370 6c69 745f 6f75 745f 7365  ts, split_out_se
+00039e80: 7475 703d 4e6f 6e65 2c20 7370 6c69 745f  tup=None, split_
+00039e90: 6f75 745f 7365 7475 705f 6b77 6172 6773  out_setup_kwargs
+00039ea0: 3d4e 6f6e 652c 2069 676e 6f72 655f 696e  =None, ignore_in
+00039eb0: 6465 783d 4661 6c73 650a 293a 0a20 2020  dex=False.):.   
+00039ec0: 2069 6620 7370 6c69 745f 6f75 745f 7365   if split_out_se
+00039ed0: 7475 703a 0a20 2020 2020 2020 2068 203d  tup:.        h =
+00039ee0: 2073 706c 6974 5f6f 7574 5f73 6574 7570   split_out_setup
+00039ef0: 2864 662c 202a 2a28 7370 6c69 745f 6f75  (df, **(split_ou
+00039f00: 745f 7365 7475 705f 6b77 6172 6773 206f  t_setup_kwargs o
+00039f10: 7220 7b7d 2929 0a20 2020 2065 6c73 653a  r {})).    else:
+00039f20: 0a20 2020 2020 2020 2068 203d 2064 660a  .        h = df.
+00039f30: 0a20 2020 2068 203d 2068 6173 685f 6f62  .    h = hash_ob
+00039f40: 6a65 6374 5f64 6973 7061 7463 6828 682c  ject_dispatch(h,
+00039f50: 2069 6e64 6578 3d46 616c 7365 290a 2020   index=False).  
+00039f60: 2020 7265 7475 726e 2067 726f 7570 5f73    return group_s
+00039f70: 706c 6974 5f64 6973 7061 7463 6828 6466  plit_dispatch(df
+00039f80: 2c20 6820 2520 6e70 6172 7473 2c20 6e70  , h % nparts, np
+00039f90: 6172 7473 2c20 6967 6e6f 7265 5f69 6e64  arts, ignore_ind
+00039fa0: 6578 3d69 676e 6f72 655f 696e 6465 7829  ex=ignore_index)
+00039fb0: 0a0a 0a64 6566 2073 706c 6974 5f65 7665  ...def split_eve
+00039fc0: 6e6c 7928 6466 2c20 6b29 3a0a 2020 2020  nly(df, k):.    
+00039fd0: 2222 2253 706c 6974 2064 6174 6166 7261  """Split datafra
+00039fe0: 6d65 2069 6e74 6f20 6b20 726f 7567 686c  me into k roughl
+00039ff0: 7920 6571 7561 6c20 7061 7274 7322 2222  y equal parts"""
+0003a000: 0a20 2020 2064 6976 6973 696f 6e73 203d  .    divisions =
+0003a010: 206e 702e 6c69 6e73 7061 6365 2830 2c20   np.linspace(0, 
+0003a020: 6c65 6e28 6466 292c 206b 202b 2031 292e  len(df), k + 1).
+0003a030: 6173 7479 7065 2869 6e74 290a 2020 2020  astype(int).    
+0003a040: 7265 7475 726e 207b 693a 2064 662e 696c  return {i: df.il
+0003a050: 6f63 5b64 6976 6973 696f 6e73 5b69 5d20  oc[divisions[i] 
+0003a060: 3a20 6469 7669 7369 6f6e 735b 6920 2b20  : divisions[i + 
+0003a070: 315d 5d20 666f 7220 6920 696e 2072 616e  1]] for i in ran
+0003a080: 6765 286b 297d 0a0a 0a64 6566 2073 706c  ge(k)}...def spl
+0003a090: 6974 5f6f 7574 5f6f 6e5f 696e 6465 7828  it_out_on_index(
+0003a0a0: 6466 293a 0a20 2020 2068 203d 2064 662e  df):.    h = df.
+0003a0b0: 696e 6465 780a 2020 2020 6966 2069 7369  index.    if isi
+0003a0c0: 6e73 7461 6e63 6528 682c 2070 642e 4d75  nstance(h, pd.Mu
+0003a0d0: 6c74 6949 6e64 6578 293a 0a20 2020 2020  ltiIndex):.     
+0003a0e0: 2020 2068 203d 206d 6574 615f 6672 616d     h = meta_fram
+0003a0f0: 655f 636f 6e73 7472 7563 746f 7228 6466  e_constructor(df
+0003a100: 2928 5b5d 2c20 696e 6465 783d 6829 2e72  )([], index=h).r
+0003a110: 6573 6574 5f69 6e64 6578 2829 0a20 2020  eset_index().   
+0003a120: 2072 6574 7572 6e20 680a 0a0a 6465 6620   return h...def 
+0003a130: 7370 6c69 745f 6f75 745f 6f6e 5f63 6f6c  split_out_on_col
+0003a140: 7328 6466 2c20 636f 6c73 3d4e 6f6e 6529  s(df, cols=None)
+0003a150: 3a0a 2020 2020 7265 7475 726e 2064 665b  :.    return df[
+0003a160: 636f 6c73 5d0a 0a0a 4069 6e73 6572 745f  cols]...@insert_
+0003a170: 6d65 7461 5f70 6172 616d 5f64 6573 6372  meta_param_descr
+0003a180: 6970 7469 6f6e 0a64 6566 2061 7070 6c79  iption.def apply
+0003a190: 5f63 6f6e 6361 745f 6170 706c 7928 0a20  _concat_apply(. 
+0003a1a0: 2020 2061 7267 732c 0a20 2020 2063 6875     args,.    chu
+0003a1b0: 6e6b 3d4e 6f6e 652c 0a20 2020 2061 6767  nk=None,.    agg
+0003a1c0: 7265 6761 7465 3d4e 6f6e 652c 0a20 2020  regate=None,.   
+0003a1d0: 2063 6f6d 6269 6e65 3d4e 6f6e 652c 0a20   combine=None,. 
+0003a1e0: 2020 206d 6574 613d 6e6f 5f64 6566 6175     meta=no_defau
+0003a1f0: 6c74 2c0a 2020 2020 746f 6b65 6e3d 4e6f  lt,.    token=No
+0003a200: 6e65 2c0a 2020 2020 6368 756e 6b5f 6b77  ne,.    chunk_kw
+0003a210: 6172 6773 3d4e 6f6e 652c 0a20 2020 2061  args=None,.    a
+0003a220: 6767 7265 6761 7465 5f6b 7761 7267 733d  ggregate_kwargs=
+0003a230: 4e6f 6e65 2c0a 2020 2020 636f 6d62 696e  None,.    combin
+0003a240: 655f 6b77 6172 6773 3d4e 6f6e 652c 0a20  e_kwargs=None,. 
+0003a250: 2020 2073 706c 6974 5f65 7665 7279 3d4e     split_every=N
+0003a260: 6f6e 652c 0a20 2020 2073 706c 6974 5f6f  one,.    split_o
+0003a270: 7574 3d4e 6f6e 652c 0a20 2020 2073 706c  ut=None,.    spl
+0003a280: 6974 5f6f 7574 5f73 6574 7570 3d4e 6f6e  it_out_setup=Non
+0003a290: 652c 0a20 2020 2073 706c 6974 5f6f 7574  e,.    split_out
+0003a2a0: 5f73 6574 7570 5f6b 7761 7267 733d 4e6f  _setup_kwargs=No
+0003a2b0: 6e65 2c0a 2020 2020 736f 7274 3d4e 6f6e  ne,.    sort=Non
+0003a2c0: 652c 0a20 2020 2069 676e 6f72 655f 696e  e,.    ignore_in
+0003a2d0: 6465 783d 4661 6c73 652c 0a20 2020 202a  dex=False,.    *
+0003a2e0: 2a6b 7761 7267 732c 0a29 3a0a 2020 2020  *kwargs,.):.    
+0003a2f0: 2222 2241 7070 6c79 2061 2066 756e 6374  """Apply a funct
+0003a300: 696f 6e20 746f 2062 6c6f 636b 732c 2074  ion to blocks, t
+0003a310: 6865 6e20 636f 6e63 6174 2c20 7468 656e  hen concat, then
+0003a320: 2061 7070 6c79 2061 6761 696e 0a0a 2020   apply again..  
+0003a330: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0003a340: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+0003a350: 6172 6773 203a 0a20 2020 2020 2020 2050  args :.        P
+0003a360: 6f73 6974 696f 6e61 6c20 6172 6775 6d65  ositional argume
+0003a370: 6e74 7320 666f 7220 7468 6520 6063 6875  nts for the `chu
+0003a380: 6e6b 6020 6675 6e63 7469 6f6e 2e20 416c  nk` function. Al
+0003a390: 6c20 6064 6173 6b2e 6461 7461 6672 616d  l `dask.datafram
+0003a3a0: 6560 0a20 2020 2020 2020 206f 626a 6563  e`.        objec
+0003a3b0: 7473 2073 686f 756c 6420 6265 2070 6172  ts should be par
+0003a3c0: 7469 7469 6f6e 6564 2061 6e64 2069 6e64  titioned and ind
+0003a3d0: 6578 6564 2065 7175 6976 616c 656e 746c  exed equivalentl
+0003a3e0: 792e 0a20 2020 2063 6875 6e6b 203a 2066  y..    chunk : f
+0003a3f0: 756e 6374 696f 6e20 5b62 6c6f 636b 2d70  unction [block-p
+0003a400: 6572 2d61 7267 5d20 2d3e 2062 6c6f 636b  er-arg] -> block
+0003a410: 0a20 2020 2020 2020 2046 756e 6374 696f  .        Functio
+0003a420: 6e20 746f 206f 7065 7261 7465 206f 6e20  n to operate on 
+0003a430: 6561 6368 2062 6c6f 636b 206f 6620 6461  each block of da
+0003a440: 7461 0a20 2020 2061 6767 7265 6761 7465  ta.    aggregate
+0003a450: 203a 2066 756e 6374 696f 6e20 636f 6e63   : function conc
+0003a460: 6174 656e 6174 6564 2d62 6c6f 636b 202d  atenated-block -
+0003a470: 3e20 626c 6f63 6b0a 2020 2020 2020 2020  > block.        
+0003a480: 4675 6e63 7469 6f6e 2074 6f20 6f70 6572  Function to oper
+0003a490: 6174 6520 6f6e 2074 6865 2063 6f6e 6361  ate on the conca
+0003a4a0: 7465 6e61 7465 6420 7265 7375 6c74 206f  tenated result o
+0003a4b0: 6620 6368 756e 6b0a 2020 2020 636f 6d62  f chunk.    comb
+0003a4c0: 696e 6520 3a20 6675 6e63 7469 6f6e 2063  ine : function c
+0003a4d0: 6f6e 6361 7465 6e61 7465 642d 626c 6f63  oncatenated-bloc
+0003a4e0: 6b20 2d3e 2062 6c6f 636b 2c20 6f70 7469  k -> block, opti
+0003a4f0: 6f6e 616c 0a20 2020 2020 2020 2046 756e  onal.        Fun
+0003a500: 6374 696f 6e20 746f 206f 7065 7261 7465  ction to operate
+0003a510: 206f 6e20 696e 7465 726d 6564 6961 7465   on intermediate
+0003a520: 2063 6f6e 6361 7465 6e61 7465 6420 7265   concatenated re
+0003a530: 7375 6c74 7320 6f66 2063 6875 6e6b 0a20  sults of chunk. 
+0003a540: 2020 2020 2020 2069 6e20 6120 7472 6565         in a tree
+0003a550: 2d72 6564 7563 7469 6f6e 2e20 4966 206e  -reduction. If n
+0003a560: 6f74 2070 726f 7669 6465 642c 2064 6566  ot provided, def
+0003a570: 6175 6c74 7320 746f 2061 6767 7265 6761  aults to aggrega
+0003a580: 7465 2e0a 2020 2020 244d 4554 410a 2020  te..    $META.  
+0003a590: 2020 746f 6b65 6e20 3a20 7374 722c 206f    token : str, o
+0003a5a0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0003a5b0: 5468 6520 6e61 6d65 2074 6f20 7573 6520  The name to use 
+0003a5c0: 666f 7220 7468 6520 6f75 7470 7574 206b  for the output k
+0003a5d0: 6579 732e 0a20 2020 2063 6875 6e6b 5f6b  eys..    chunk_k
+0003a5e0: 7761 7267 7320 3a20 6469 6374 2c20 6f70  wargs : dict, op
+0003a5f0: 7469 6f6e 616c 0a20 2020 2020 2020 204b  tional.        K
+0003a600: 6579 776f 7264 7320 666f 7220 7468 6520  eywords for the 
+0003a610: 6368 756e 6b20 6675 6e63 7469 6f6e 206f  chunk function o
+0003a620: 6e6c 792e 0a20 2020 2061 6767 7265 6761  nly..    aggrega
+0003a630: 7465 5f6b 7761 7267 7320 3a20 6469 6374  te_kwargs : dict
+0003a640: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0003a650: 2020 204b 6579 776f 7264 7320 666f 7220     Keywords for 
+0003a660: 7468 6520 6167 6772 6567 6174 6520 6675  the aggregate fu
+0003a670: 6e63 7469 6f6e 206f 6e6c 792e 0a20 2020  nction only..   
+0003a680: 2063 6f6d 6269 6e65 5f6b 7761 7267 7320   combine_kwargs 
+0003a690: 3a20 6469 6374 2c20 6f70 7469 6f6e 616c  : dict, optional
+0003a6a0: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
+0003a6b0: 7320 666f 7220 7468 6520 636f 6d62 696e  s for the combin
+0003a6c0: 6520 6675 6e63 7469 6f6e 206f 6e6c 792e  e function only.
+0003a6d0: 0a20 2020 2073 706c 6974 5f65 7665 7279  .    split_every
+0003a6e0: 203a 2069 6e74 2c20 6f70 7469 6f6e 616c   : int, optional
+0003a6f0: 0a20 2020 2020 2020 2047 726f 7570 2070  .        Group p
+0003a700: 6172 7469 7469 6f6e 7320 696e 746f 2067  artitions into g
+0003a710: 726f 7570 7320 6f66 2074 6869 7320 7369  roups of this si
+0003a720: 7a65 2077 6869 6c65 2070 6572 666f 726d  ze while perform
+0003a730: 696e 6720 610a 2020 2020 2020 2020 7472  ing a.        tr
+0003a740: 6565 2d72 6564 7563 7469 6f6e 2e20 4966  ee-reduction. If
+0003a750: 2073 6574 2074 6f20 4661 6c73 652c 206e   set to False, n
+0003a760: 6f20 7472 6565 2d72 6564 7563 7469 6f6e  o tree-reduction
+0003a770: 2077 696c 6c20 6265 2075 7365 642c 0a20   will be used,. 
+0003a780: 2020 2020 2020 2061 6e64 2061 6c6c 2069         and all i
+0003a790: 6e74 6572 6d65 6469 6174 6573 2077 696c  ntermediates wil
+0003a7a0: 6c20 6265 2063 6f6e 6361 7465 6e61 7465  l be concatenate
+0003a7b0: 6420 616e 6420 7061 7373 6564 2074 6f20  d and passed to 
+0003a7c0: 6060 6167 6772 6567 6174 6560 602e 0a20  ``aggregate``.. 
+0003a7d0: 2020 2020 2020 2044 6566 6175 6c74 2069         Default i
+0003a7e0: 7320 382e 0a20 2020 2073 706c 6974 5f6f  s 8..    split_o
+0003a7f0: 7574 203a 2069 6e74 2c20 6f70 7469 6f6e  ut : int, option
+0003a800: 616c 0a20 2020 2020 2020 204e 756d 6265  al.        Numbe
+0003a810: 7220 6f66 206f 7574 7075 7420 7061 7274  r of output part
+0003a820: 6974 696f 6e73 2e20 5370 6c69 7420 6f63  itions. Split oc
+0003a830: 6375 7273 2061 6674 6572 2066 6972 7374  curs after first
+0003a840: 2063 6875 6e6b 2072 6564 7563 7469 6f6e   chunk reduction
+0003a850: 2e0a 2020 2020 7370 6c69 745f 6f75 745f  ..    split_out_
+0003a860: 7365 7475 7020 3a20 6361 6c6c 6162 6c65  setup : callable
+0003a870: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0003a880: 2020 2049 6620 7072 6f76 6964 6564 2c20     If provided, 
+0003a890: 7468 6973 2066 756e 6374 696f 6e20 6973  this function is
+0003a8a0: 2063 616c 6c65 6420 6f6e 2065 6163 6820   called on each 
+0003a8b0: 6368 756e 6b20 6265 666f 7265 2070 6572  chunk before per
+0003a8c0: 666f 726d 696e 670a 2020 2020 2020 2020  forming.        
+0003a8d0: 7468 6520 6861 7368 2d73 706c 6974 2e20  the hash-split. 
+0003a8e0: 4974 2073 686f 756c 6420 7265 7475 726e  It should return
+0003a8f0: 2061 2070 616e 6461 7320 6f62 6a65 6374   a pandas object
+0003a900: 2c20 7768 6572 6520 6561 6368 2072 6f77  , where each row
+0003a910: 0a20 2020 2020 2020 2028 6578 636c 7564  .        (exclud
+0003a920: 696e 6720 7468 6520 696e 6465 7829 2069  ing the index) i
+0003a930: 7320 6861 7368 6564 2e20 4966 206e 6f74  s hashed. If not
+0003a940: 2070 726f 7669 6465 642c 2074 6865 2063   provided, the c
+0003a950: 6875 6e6b 2069 7320 6861 7368 6564 0a20  hunk is hashed. 
+0003a960: 2020 2020 2020 2061 7320 6973 2e0a 2020         as is..  
+0003a970: 2020 7370 6c69 745f 6f75 745f 7365 7475    split_out_setu
+0003a980: 705f 6b77 6172 6773 203a 2064 6963 742c  p_kwargs : dict,
+0003a990: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0003a9a0: 2020 4b65 7977 6f72 6473 2066 6f72 2074    Keywords for t
+0003a9b0: 6865 2060 7370 6c69 745f 6f75 745f 7365  he `split_out_se
+0003a9c0: 7475 7060 2066 756e 6374 696f 6e20 6f6e  tup` function on
+0003a9d0: 6c79 2e0a 2020 2020 736f 7274 203a 2062  ly..    sort : b
+0003a9e0: 6f6f 6c2c 2064 6566 6175 6c74 204e 6f6e  ool, default Non
+0003a9f0: 650a 2020 2020 2020 2020 4966 2061 6c6c  e.        If all
+0003aa00: 6f77 6564 2c20 736f 7274 2074 6865 206b  owed, sort the k
+0003aa10: 6579 7320 6f66 2074 6865 206f 7574 7075  eys of the outpu
+0003aa20: 7420 6167 6772 6567 6174 696f 6e2e 0a20  t aggregation.. 
+0003aa30: 2020 2069 676e 6f72 655f 696e 6465 7820     ignore_index 
+0003aa40: 3a20 626f 6f6c 2c20 6465 6661 756c 7420  : bool, default 
+0003aa50: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
+0003aa60: 2054 7275 652c 2064 6f20 6e6f 7420 7072   True, do not pr
+0003aa70: 6573 6572 7665 2069 6e64 6578 2076 616c  eserve index val
+0003aa80: 7565 7320 7468 726f 7567 686f 7574 2041  ues throughout A
+0003aa90: 4341 206f 7065 7261 7469 6f6e 732e 0a20  CA operations.. 
+0003aaa0: 2020 206b 7761 7267 7320 3a0a 2020 2020     kwargs :.    
+0003aab0: 2020 2020 416c 6c20 7265 6d61 696e 696e      All remainin
+0003aac0: 6720 6b65 7977 6f72 6473 2077 696c 6c20  g keywords will 
+0003aad0: 6265 2070 6173 7365 6420 746f 2060 6063  be passed to ``c
+0003aae0: 6875 6e6b 6060 2c20 6060 6167 6772 6567  hunk``, ``aggreg
+0003aaf0: 6174 6560 602c 2061 6e64 0a20 2020 2020  ate``, and.     
+0003ab00: 2020 2060 6063 6f6d 6269 6e65 6060 2e0a     ``combine``..
+0003ab10: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+0003ab20: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+0003ab30: 3e3e 2064 6566 2063 6875 6e6b 2861 5f62  >> def chunk(a_b
+0003ab40: 6c6f 636b 2c20 625f 626c 6f63 6b29 3a0a  lock, b_block):.
+0003ab50: 2020 2020 2e2e 2e20 2020 2020 7061 7373      ...     pass
+0003ab60: 0a0a 2020 2020 3e3e 3e20 6465 6620 6167  ..    >>> def ag
+0003ab70: 6728 6466 293a 0a20 2020 202e 2e2e 2020  g(df):.    ...  
+0003ab80: 2020 2070 6173 730a 0a20 2020 203e 3e3e     pass..    >>>
+0003ab90: 2061 7070 6c79 5f63 6f6e 6361 745f 6170   apply_concat_ap
+0003aba0: 706c 7928 5b61 2c20 625d 2c20 6368 756e  ply([a, b], chun
+0003abb0: 6b3d 6368 756e 6b2c 2061 6767 7265 6761  k=chunk, aggrega
+0003abc0: 7465 3d61 6767 2920 2023 2064 6f63 7465  te=agg)  # docte
+0003abd0: 7374 3a20 2b53 4b49 500a 2020 2020 2222  st: +SKIP.    ""
+0003abe0: 220a 2020 2020 6966 2073 706c 6974 5f6f  ".    if split_o
+0003abf0: 7574 2069 7320 4e6f 6e65 3a0a 2020 2020  ut is None:.    
+0003ac00: 2020 2020 7370 6c69 745f 6f75 7420 3d20      split_out = 
+0003ac10: 310a 2020 2020 6966 2063 6875 6e6b 5f6b  1.    if chunk_k
+0003ac20: 7761 7267 7320 6973 204e 6f6e 653a 0a20  wargs is None:. 
+0003ac30: 2020 2020 2020 2063 6875 6e6b 5f6b 7761         chunk_kwa
+0003ac40: 7267 7320 3d20 6469 6374 2829 0a20 2020  rgs = dict().   
+0003ac50: 2069 6620 6167 6772 6567 6174 655f 6b77   if aggregate_kw
+0003ac60: 6172 6773 2069 7320 4e6f 6e65 3a0a 2020  args is None:.  
+0003ac70: 2020 2020 2020 6167 6772 6567 6174 655f        aggregate_
+0003ac80: 6b77 6172 6773 203d 2064 6963 7428 290a  kwargs = dict().
+0003ac90: 2020 2020 6368 756e 6b5f 6b77 6172 6773      chunk_kwargs
+0003aca0: 2e75 7064 6174 6528 6b77 6172 6773 290a  .update(kwargs).
+0003acb0: 2020 2020 6167 6772 6567 6174 655f 6b77      aggregate_kw
+0003acc0: 6172 6773 2e75 7064 6174 6528 6b77 6172  args.update(kwar
+0003acd0: 6773 290a 0a20 2020 2069 6620 636f 6d62  gs)..    if comb
+0003ace0: 696e 6520 6973 204e 6f6e 653a 0a20 2020  ine is None:.   
+0003acf0: 2020 2020 2069 6620 636f 6d62 696e 655f       if combine_
+0003ad00: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
+0003ad10: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0003ad20: 7272 6f72 2822 6063 6f6d 6269 6e65 5f6b  rror("`combine_k
+0003ad30: 7761 7267 7360 2070 726f 7669 6465 6420  wargs` provided 
+0003ad40: 7769 7468 206e 6f20 6063 6f6d 6269 6e65  with no `combine
+0003ad50: 6022 290a 2020 2020 2020 2020 636f 6d62  `").        comb
+0003ad60: 696e 6520 3d20 6167 6772 6567 6174 650a  ine = aggregate.
+0003ad70: 2020 2020 2020 2020 636f 6d62 696e 655f          combine_
+0003ad80: 6b77 6172 6773 203d 2061 6767 7265 6761  kwargs = aggrega
+0003ad90: 7465 5f6b 7761 7267 730a 2020 2020 656c  te_kwargs.    el
+0003ada0: 7365 3a0a 2020 2020 2020 2020 6966 2063  se:.        if c
+0003adb0: 6f6d 6269 6e65 5f6b 7761 7267 7320 6973  ombine_kwargs is
+0003adc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0003add0: 2020 2063 6f6d 6269 6e65 5f6b 7761 7267     combine_kwarg
+0003ade0: 7320 3d20 6469 6374 2829 0a20 2020 2020  s = dict().     
+0003adf0: 2020 2063 6f6d 6269 6e65 5f6b 7761 7267     combine_kwarg
+0003ae00: 732e 7570 6461 7465 286b 7761 7267 7329  s.update(kwargs)
+0003ae10: 0a0a 2020 2020 6966 206e 6f74 2069 7369  ..    if not isi
+0003ae20: 6e73 7461 6e63 6528 6172 6773 2c20 2874  nstance(args, (t
+0003ae30: 7570 6c65 2c20 6c69 7374 2929 3a0a 2020  uple, list)):.  
+0003ae40: 2020 2020 2020 6172 6773 203d 205b 6172        args = [ar
+0003ae50: 6773 5d0a 0a20 2020 2064 6673 203d 205b  gs]..    dfs = [
+0003ae60: 6172 6720 666f 7220 6172 6720 696e 2061  arg for arg in a
+0003ae70: 7267 7320 6966 2069 7369 6e73 7461 6e63  rgs if isinstanc
+0003ae80: 6528 6172 672c 205f 4672 616d 6529 5d0a  e(arg, _Frame)].
+0003ae90: 0a20 2020 206e 7061 7274 6974 696f 6e73  .    npartitions
+0003aea0: 203d 207b 6172 672e 6e70 6172 7469 7469   = {arg.npartiti
+0003aeb0: 6f6e 7320 666f 7220 6172 6720 696e 2064  ons for arg in d
+0003aec0: 6673 7d0a 2020 2020 6966 206c 656e 286e  fs}.    if len(n
+0003aed0: 7061 7274 6974 696f 6e73 2920 3e20 313a  partitions) > 1:
+0003aee0: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
+0003aef0: 616c 7565 4572 726f 7228 2241 6c6c 2061  alueError("All a
+0003af00: 7267 756d 656e 7473 206d 7573 7420 6861  rguments must ha
+0003af10: 7665 2073 616d 6520 6e75 6d62 6572 206f  ve same number o
+0003af20: 6620 7061 7274 6974 696f 6e73 2229 0a20  f partitions"). 
+0003af30: 2020 206e 7061 7274 6974 696f 6e73 203d     npartitions =
+0003af40: 206e 7061 7274 6974 696f 6e73 2e70 6f70   npartitions.pop
+0003af50: 2829 0a0a 2020 2020 6966 2073 706c 6974  ()..    if split
+0003af60: 5f65 7665 7279 2069 7320 4e6f 6e65 3a0a  _every is None:.
+0003af70: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
+0003af80: 6572 7920 3d20 380a 2020 2020 656c 6966  ery = 8.    elif
+0003af90: 2073 706c 6974 5f65 7665 7279 2069 7320   split_every is 
+0003afa0: 4661 6c73 653a 0a20 2020 2020 2020 2073  False:.        s
+0003afb0: 706c 6974 5f65 7665 7279 203d 206e 7061  plit_every = npa
+0003afc0: 7274 6974 696f 6e73 0a20 2020 2065 6c69  rtitions.    eli
+0003afd0: 6620 7370 6c69 745f 6576 6572 7920 3c20  f split_every < 
+0003afe0: 3220 6f72 206e 6f74 2069 7369 6e73 7461  2 or not isinsta
+0003aff0: 6e63 6528 7370 6c69 745f 6576 6572 792c  nce(split_every,
+0003b000: 2049 6e74 6567 7261 6c29 3a0a 2020 2020   Integral):.    
+0003b010: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0003b020: 7272 6f72 2822 7370 6c69 745f 6576 6572  rror("split_ever
+0003b030: 7920 6d75 7374 2062 6520 616e 2069 6e74  y must be an int
+0003b040: 6567 6572 203e 3d20 3222 290a 0a20 2020  eger >= 2")..   
+0003b050: 2074 6f6b 656e 5f6b 6579 203d 2074 6f6b   token_key = tok
+0003b060: 656e 697a 6528 0a20 2020 2020 2020 2074  enize(.        t
+0003b070: 6f6b 656e 206f 7220 2863 6875 6e6b 2c20  oken or (chunk, 
+0003b080: 6167 6772 6567 6174 6529 2c0a 2020 2020  aggregate),.    
+0003b090: 2020 2020 6d65 7461 2c0a 2020 2020 2020      meta,.      
+0003b0a0: 2020 6172 6773 2c0a 2020 2020 2020 2020    args,.        
+0003b0b0: 6368 756e 6b5f 6b77 6172 6773 2c0a 2020  chunk_kwargs,.  
+0003b0c0: 2020 2020 2020 6167 6772 6567 6174 655f        aggregate_
+0003b0d0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+0003b0e0: 636f 6d62 696e 655f 6b77 6172 6773 2c0a  combine_kwargs,.
+0003b0f0: 2020 2020 2020 2020 7370 6c69 745f 6576          split_ev
+0003b100: 6572 792c 0a20 2020 2020 2020 2073 706c  ery,.        spl
+0003b110: 6974 5f6f 7574 2c0a 2020 2020 2020 2020  it_out,.        
+0003b120: 7370 6c69 745f 6f75 745f 7365 7475 702c  split_out_setup,
+0003b130: 0a20 2020 2020 2020 2073 706c 6974 5f6f  .        split_o
+0003b140: 7574 5f73 6574 7570 5f6b 7761 7267 732c  ut_setup_kwargs,
+0003b150: 0a20 2020 2029 0a0a 2020 2020 2320 426c  .    )..    # Bl
+0003b160: 6f63 6b77 6973 6520 4368 756e 6b20 4c61  ockwise Chunk La
+0003b170: 7965 720a 2020 2020 6368 756e 6b5f 6e61  yer.    chunk_na
+0003b180: 6d65 203d 2066 227b 746f 6b65 6e20 6f72  me = f"{token or
+0003b190: 2066 756e 636e 616d 6528 6368 756e 6b29   funcname(chunk)
+0003b1a0: 7d2d 6368 756e 6b2d 7b74 6f6b 656e 5f6b  }-chunk-{token_k
+0003b1b0: 6579 7d22 0a20 2020 2063 6875 6e6b 6564  ey}".    chunked
+0003b1c0: 203d 206d 6170 5f62 6167 5f70 6172 7469   = map_bag_parti
+0003b1d0: 7469 6f6e 7328 0a20 2020 2020 2020 2063  tions(.        c
+0003b1e0: 6875 6e6b 2c0a 2020 2020 2020 2020 2320  hunk,.        # 
+0003b1f0: 436f 6e76 6572 7420 5f46 7261 6d65 2063  Convert _Frame c
+0003b200: 6f6c 6c65 6374 696f 6e73 2074 6f20 4261  ollections to Ba
+0003b210: 670a 2020 2020 2020 2020 2a5b 0a20 2020  g.        *[.   
+0003b220: 2020 2020 2020 2020 2061 7267 2e74 6f5f           arg.to_
+0003b230: 6261 6728 666f 726d 6174 3d22 6672 616d  bag(format="fram
+0003b240: 6522 2920 6966 2069 7369 6e73 7461 6e63  e") if isinstanc
+0003b250: 6528 6172 672c 205f 4672 616d 6529 2065  e(arg, _Frame) e
+0003b260: 6c73 6520 6172 670a 2020 2020 2020 2020  lse arg.        
+0003b270: 2020 2020 666f 7220 6172 6720 696e 2061      for arg in a
+0003b280: 7267 730a 2020 2020 2020 2020 5d2c 0a20  rgs.        ],. 
+0003b290: 2020 2020 2020 2074 6f6b 656e 3d63 6875         token=chu
+0003b2a0: 6e6b 5f6e 616d 652c 0a20 2020 2020 2020  nk_name,.       
+0003b2b0: 202a 2a63 6875 6e6b 5f6b 7761 7267 732c   **chunk_kwargs,
+0003b2c0: 0a20 2020 2029 0a0a 2020 2020 2320 4e4f  .    )..    # NO
+0003b2d0: 5445 3a20 6063 6875 6e6b 6564 6020 6973  TE: `chunked` is
+0003b2e0: 206e 6f77 2061 2042 6167 2063 6f6c 6c65   now a Bag colle
+0003b2f0: 6374 696f 6e2e 0a20 2020 2023 2057 6520  ction..    # We 
+0003b300: 646f 6e27 7420 7573 6520 6120 4461 7461  don't use a Data
+0003b310: 4672 616d 6520 636f 6c6c 6563 7469 6f6e  Frame collection
+0003b320: 2c20 6265 6361 7573 650a 2020 2020 2320  , because.    # 
+0003b330: 7468 6520 7061 7274 6974 696f 6e73 206d  the partitions m
+0003b340: 6179 206e 6f74 2063 6f6e 7461 696e 2064  ay not contain d
+0003b350: 6174 6166 7261 6d65 2d6c 696b 650a 2020  ataframe-like.  
+0003b360: 2020 2320 6f62 6a65 6374 7320 616e 796d    # objects anym
+0003b370: 6f72 652e 0a0a 2020 2020 2320 426c 6f63  ore...    # Bloc
+0003b380: 6b77 6973 6520 5370 6c69 7420 4c61 7965  kwise Split Laye
+0003b390: 720a 2020 2020 6966 2073 706c 6974 5f6f  r.    if split_o
+0003b3a0: 7574 2061 6e64 2073 706c 6974 5f6f 7574  ut and split_out
+0003b3b0: 203e 2031 3a0a 2020 2020 2020 2020 6368   > 1:.        ch
+0003b3c0: 756e 6b65 6420 3d20 6368 756e 6b65 642e  unked = chunked.
+0003b3d0: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
+0003b3e0: 2020 2020 2020 2020 2020 2020 6861 7368              hash
+0003b3f0: 5f73 6861 7264 2c0a 2020 2020 2020 2020  _shard,.        
+0003b400: 2020 2020 7370 6c69 745f 6f75 742c 0a20      split_out,. 
+0003b410: 2020 2020 2020 2020 2020 2073 706c 6974             split
+0003b420: 5f6f 7574 5f73 6574 7570 2c0a 2020 2020  _out_setup,.    
+0003b430: 2020 2020 2020 2020 7370 6c69 745f 6f75          split_ou
+0003b440: 745f 7365 7475 705f 6b77 6172 6773 2c0a  t_setup_kwargs,.
+0003b450: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+0003b460: 7265 5f69 6e64 6578 2c0a 2020 2020 2020  re_index,.      
+0003b470: 2020 2020 2020 746f 6b65 6e3d 2273 706c        token="spl
+0003b480: 6974 2d25 7322 2025 2074 6f6b 656e 5f6b  it-%s" % token_k
+0003b490: 6579 2c0a 2020 2020 2020 2020 290a 0a20  ey,.        ).. 
+0003b4a0: 2020 2023 2048 616e 646c 6520 736f 7274     # Handle sort
+0003b4b0: 2062 6568 6176 696f 720a 2020 2020 6966   behavior.    if
+0003b4c0: 2073 6f72 7420 6973 206e 6f74 204e 6f6e   sort is not Non
+0003b4d0: 653a 0a20 2020 2020 2020 2069 6620 736f  e:.        if so
+0003b4e0: 7274 2061 6e64 2073 706c 6974 5f6f 7574  rt and split_out
+0003b4f0: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+0003b500: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+0003b510: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
+0003b520: 2020 2020 2020 2020 2020 2020 2022 4361               "Ca
+0003b530: 6e6e 6f74 2067 7561 7261 6e74 6565 2073  nnot guarantee s
+0003b540: 6f72 7465 6420 6b65 7973 2066 6f72 2060  orted keys for `
+0003b550: 7370 6c69 745f 6f75 743e 3160 2e22 0a20  split_out>1`.". 
+0003b560: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0003b570: 2054 7279 2075 7369 6e67 2073 706c 6974   Try using split
+0003b580: 5f6f 7574 3d31 2c20 6f72 2067 726f 7570  _out=1, or group
+0003b590: 696e 6720 7769 7468 2073 6f72 743d 4661  ing with sort=Fa
+0003b5a0: 6c73 652e 220a 2020 2020 2020 2020 2020  lse.".          
+0003b5b0: 2020 290a 2020 2020 2020 2020 6167 6772    ).        aggr
+0003b5c0: 6567 6174 655f 6b77 6172 6773 203d 2061  egate_kwargs = a
+0003b5d0: 6767 7265 6761 7465 5f6b 7761 7267 7320  ggregate_kwargs 
+0003b5e0: 6f72 207b 7d0a 2020 2020 2020 2020 6167  or {}.        ag
+0003b5f0: 6772 6567 6174 655f 6b77 6172 6773 5b22  gregate_kwargs["
+0003b600: 736f 7274 225d 203d 2073 6f72 740a 0a20  sort"] = sort.. 
+0003b610: 2020 2023 2054 7265 652d 5265 6475 6374     # Tree-Reduct
+0003b620: 696f 6e20 4c61 7965 720a 2020 2020 6669  ion Layer.    fi
+0003b630: 6e61 6c5f 6e61 6d65 203d 2066 227b 746f  nal_name = f"{to
+0003b640: 6b65 6e20 6f72 2066 756e 636e 616d 6528  ken or funcname(
+0003b650: 6167 6772 6567 6174 6529 7d2d 6167 672d  aggregate)}-agg-
+0003b660: 7b74 6f6b 656e 5f6b 6579 7d22 0a20 2020  {token_key}".   
+0003b670: 206c 6179 6572 203d 2044 6174 6146 7261   layer = DataFra
+0003b680: 6d65 5472 6565 5265 6475 6374 696f 6e28  meTreeReduction(
+0003b690: 0a20 2020 2020 2020 2066 696e 616c 5f6e  .        final_n
+0003b6a0: 616d 652c 0a20 2020 2020 2020 2063 6875  ame,.        chu
+0003b6b0: 6e6b 6564 2e6e 616d 652c 0a20 2020 2020  nked.name,.     
+0003b6c0: 2020 206e 7061 7274 6974 696f 6e73 2c0a     npartitions,.
+0003b6d0: 2020 2020 2020 2020 7061 7274 6961 6c28          partial(
+0003b6e0: 5f63 6f6e 6361 742c 2069 676e 6f72 655f  _concat, ignore_
+0003b6f0: 696e 6465 783d 6967 6e6f 7265 5f69 6e64  index=ignore_ind
+0003b700: 6578 292c 0a20 2020 2020 2020 2070 6172  ex),.        par
+0003b710: 7469 616c 2863 6f6d 6269 6e65 2c20 2a2a  tial(combine, **
+0003b720: 636f 6d62 696e 655f 6b77 6172 6773 2920  combine_kwargs) 
+0003b730: 6966 2063 6f6d 6269 6e65 5f6b 7761 7267  if combine_kwarg
+0003b740: 7320 656c 7365 2063 6f6d 6269 6e65 2c0a  s else combine,.
+0003b750: 2020 2020 2020 2020 6669 6e61 6c69 7a65          finalize
+0003b760: 5f66 756e 633d 7061 7274 6961 6c28 6167  _func=partial(ag
+0003b770: 6772 6567 6174 652c 202a 2a61 6767 7265  gregate, **aggre
+0003b780: 6761 7465 5f6b 7761 7267 7329 0a20 2020  gate_kwargs).   
+0003b790: 2020 2020 2069 6620 6167 6772 6567 6174       if aggregat
+0003b7a0: 655f 6b77 6172 6773 0a20 2020 2020 2020  e_kwargs.       
+0003b7b0: 2065 6c73 6520 6167 6772 6567 6174 652c   else aggregate,
+0003b7c0: 0a20 2020 2020 2020 2073 706c 6974 5f65  .        split_e
+0003b7d0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
+0003b7e0: 2c0a 2020 2020 2020 2020 7370 6c69 745f  ,.        split_
+0003b7f0: 6f75 743d 7370 6c69 745f 6f75 7420 6966  out=split_out if
+0003b800: 2028 7370 6c69 745f 6f75 7420 616e 6420   (split_out and 
+0003b810: 7370 6c69 745f 6f75 7420 3e20 3129 2065  split_out > 1) e
+0003b820: 6c73 6520 4e6f 6e65 2c0a 2020 2020 2020  lse None,.      
+0003b830: 2020 7472 6565 5f6e 6f64 655f 6e61 6d65    tree_node_name
+0003b840: 3d66 227b 746f 6b65 6e20 6f72 2066 756e  =f"{token or fun
+0003b850: 636e 616d 6528 636f 6d62 696e 6529 7d2d  cname(combine)}-
+0003b860: 636f 6d62 696e 652d 7b74 6f6b 656e 5f6b  combine-{token_k
+0003b870: 6579 7d22 2c0a 2020 2020 290a 0a20 2020  ey}",.    )..   
+0003b880: 2069 6620 6d65 7461 2069 7320 6e6f 5f64   if meta is no_d
+0003b890: 6566 6175 6c74 3a0a 2020 2020 2020 2020  efault:.        
+0003b8a0: 6d65 7461 5f63 6875 6e6b 203d 205f 656d  meta_chunk = _em
+0003b8b0: 756c 6174 6528 6368 756e 6b2c 202a 6172  ulate(chunk, *ar
+0003b8c0: 6773 2c20 7564 663d 5472 7565 2c20 2a2a  gs, udf=True, **
+0003b8d0: 6368 756e 6b5f 6b77 6172 6773 290a 2020  chunk_kwargs).  
+0003b8e0: 2020 2020 2020 6d65 7461 203d 205f 656d        meta = _em
+0003b8f0: 756c 6174 6528 0a20 2020 2020 2020 2020  ulate(.         
+0003b900: 2020 2061 6767 7265 6761 7465 2c20 5f63     aggregate, _c
+0003b910: 6f6e 6361 7428 5b6d 6574 615f 6368 756e  oncat([meta_chun
+0003b920: 6b5d 2c20 6967 6e6f 7265 5f69 6e64 6578  k], ignore_index
+0003b930: 292c 2075 6466 3d54 7275 652c 202a 2a61  ), udf=True, **a
+0003b940: 6767 7265 6761 7465 5f6b 7761 7267 730a  ggregate_kwargs.
+0003b950: 2020 2020 2020 2020 290a 2020 2020 6d65          ).    me
+0003b960: 7461 203d 206d 616b 655f 6d65 7461 280a  ta = make_meta(.
+0003b970: 2020 2020 2020 2020 6d65 7461 2c0a 2020          meta,.  
+0003b980: 2020 2020 2020 696e 6465 783d 2867 6574        index=(get
+0003b990: 6174 7472 286d 616b 655f 6d65 7461 2864  attr(make_meta(d
+0003b9a0: 6673 5b30 5d29 2c20 2269 6e64 6578 222c  fs[0]), "index",
+0003b9b0: 204e 6f6e 6529 2069 6620 6466 7320 656c   None) if dfs el
+0003b9c0: 7365 204e 6f6e 6529 2c0a 2020 2020 2020  se None),.      
+0003b9d0: 2020 7061 7265 6e74 5f6d 6574 613d 6466    parent_meta=df
+0003b9e0: 735b 305d 2e5f 6d65 7461 2c0a 2020 2020  s[0]._meta,.    
+0003b9f0: 290a 0a20 2020 2067 7261 7068 203d 2048  )..    graph = H
+0003ba00: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
+0003ba10: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 2866  om_collections(f
+0003ba20: 696e 616c 5f6e 616d 652c 206c 6179 6572  inal_name, layer
+0003ba30: 2c20 6465 7065 6e64 656e 6369 6573 3d28  , dependencies=(
+0003ba40: 6368 756e 6b65 642c 2929 0a20 2020 2064  chunked,)).    d
+0003ba50: 6976 6973 696f 6e73 203d 205b 4e6f 6e65  ivisions = [None
+0003ba60: 5d20 2a20 2828 7370 6c69 745f 6f75 7420  ] * ((split_out 
+0003ba70: 6f72 2031 2920 2b20 3129 0a20 2020 2072  or 1) + 1).    r
+0003ba80: 6574 7572 6e20 6e65 775f 6464 5f6f 626a  eturn new_dd_obj
+0003ba90: 6563 7428 6772 6170 682c 2066 696e 616c  ect(graph, final
+0003baa0: 5f6e 616d 652c 206d 6574 612c 2064 6976  _name, meta, div
+0003bab0: 6973 696f 6e73 2c20 7061 7265 6e74 5f6d  isions, parent_m
+0003bac0: 6574 613d 6466 735b 305d 2e5f 6d65 7461  eta=dfs[0]._meta
+0003bad0: 290a 0a0a 6163 6120 3d20 6170 706c 795f  )...aca = apply_
+0003bae0: 636f 6e63 6174 5f61 7070 6c79 0a0a 0a64  concat_apply...d
+0003baf0: 6566 205f 6578 7472 6163 745f 6d65 7461  ef _extract_meta
+0003bb00: 2878 2c20 6e6f 6e65 6d70 7479 3d46 616c  (x, nonempty=Fal
+0003bb10: 7365 293a 0a20 2020 2022 2222 0a20 2020  se):.    """.   
+0003bb20: 2045 7874 7261 6374 2069 6e74 6572 6e61   Extract interna
+0003bb30: 6c20 6361 6368 6520 6461 7461 2028 6060  l cache data (``
+0003bb40: 5f6d 6574 6160 6029 2066 726f 6d20 6464  _meta``) from dd
+0003bb50: 2e44 6174 6146 7261 6d65 202f 2064 642e  .DataFrame / dd.
+0003bb60: 5365 7269 6573 0a20 2020 2022 2222 0a20  Series.    """. 
+0003bb70: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003bb80: 2878 2c20 2853 6361 6c61 722c 205f 4672  (x, (Scalar, _Fr
+0003bb90: 616d 6529 293a 0a20 2020 2020 2020 2072  ame)):.        r
+0003bba0: 6574 7572 6e20 782e 5f6d 6574 615f 6e6f  eturn x._meta_no
+0003bbb0: 6e65 6d70 7479 2069 6620 6e6f 6e65 6d70  nempty if nonemp
+0003bbc0: 7479 2065 6c73 6520 782e 5f6d 6574 610a  ty else x._meta.
+0003bbd0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0003bbe0: 6e63 6528 782c 206c 6973 7429 3a0a 2020  nce(x, list):.  
+0003bbf0: 2020 2020 2020 7265 7475 726e 205b 5f65        return [_e
+0003bc00: 7874 7261 6374 5f6d 6574 6128 5f78 2c20  xtract_meta(_x, 
+0003bc10: 6e6f 6e65 6d70 7479 2920 666f 7220 5f78  nonempty) for _x
+0003bc20: 2069 6e20 785d 0a20 2020 2065 6c69 6620   in x].    elif 
+0003bc30: 6973 696e 7374 616e 6365 2878 2c20 7475  isinstance(x, tu
+0003bc40: 706c 6529 3a0a 2020 2020 2020 2020 7265  ple):.        re
+0003bc50: 7475 726e 2074 7570 6c65 285f 6578 7472  turn tuple(_extr
+0003bc60: 6163 745f 6d65 7461 285f 782c 206e 6f6e  act_meta(_x, non
+0003bc70: 656d 7074 7929 2066 6f72 205f 7820 696e  empty) for _x in
+0003bc80: 2078 290a 2020 2020 656c 6966 2069 7369   x).    elif isi
+0003bc90: 6e73 7461 6e63 6528 782c 2064 6963 7429  nstance(x, dict)
+0003bca0: 3a0a 2020 2020 2020 2020 7265 7320 3d20  :.        res = 
+0003bcb0: 7b7d 0a20 2020 2020 2020 2066 6f72 206b  {}.        for k
+0003bcc0: 2069 6e20 783a 0a20 2020 2020 2020 2020   in x:.         
+0003bcd0: 2020 2072 6573 5b6b 5d20 3d20 5f65 7874     res[k] = _ext
+0003bce0: 7261 6374 5f6d 6574 6128 785b 6b5d 2c20  ract_meta(x[k], 
+0003bcf0: 6e6f 6e65 6d70 7479 290a 2020 2020 2020  nonempty).      
+0003bd00: 2020 7265 7475 726e 2072 6573 0a20 2020    return res.   
+0003bd10: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0003bd20: 2878 2c20 4465 6c61 7965 6429 3a0a 2020  (x, Delayed):.  
+0003bd30: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0003bd40: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0003bd50: 2020 2020 2243 616e 6e6f 7420 696e 6665      "Cannot infe
+0003bd60: 7220 6461 7461 6672 616d 6520 6d65 7461  r dataframe meta
+0003bd70: 6461 7461 2077 6974 6820 6120 6064 6173  data with a `das
+0003bd80: 6b2e 6465 6c61 7965 6460 2061 7267 756d  k.delayed` argum
+0003bd90: 656e 7422 0a20 2020 2020 2020 2029 0a20  ent".        ). 
+0003bda0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003bdb0: 2072 6574 7572 6e20 780a 0a0a 6465 6620   return x...def 
+0003bdc0: 5f65 6d75 6c61 7465 2866 756e 632c 202a  _emulate(func, *
+0003bdd0: 6172 6773 2c20 7564 663d 4661 6c73 652c  args, udf=False,
+0003bde0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0003bdf0: 2222 220a 2020 2020 4170 706c 7920 6120  """.    Apply a 
+0003be00: 6675 6e63 7469 6f6e 2075 7369 6e67 2061  function using a
+0003be10: 7267 7320 2f20 6b77 6172 6773 2e20 4966  rgs / kwargs. If
+0003be20: 2061 7267 756d 656e 7473 2063 6f6e 7461   arguments conta
+0003be30: 696e 2064 642e 4461 7461 4672 616d 6520  in dd.DataFrame 
+0003be40: 2f0a 2020 2020 6464 2e53 6572 6965 732c  /.    dd.Series,
+0003be50: 2075 7369 6e67 2069 6e74 6572 6e61 6c20   using internal 
+0003be60: 6361 6368 6520 2860 605f 6d65 7461 6060  cache (``_meta``
+0003be70: 2920 666f 7220 6361 6c63 756c 6174 696f  ) for calculatio
+0003be80: 6e0a 2020 2020 2222 220a 2020 2020 7769  n.    """.    wi
+0003be90: 7468 2072 6169 7365 5f6f 6e5f 6d65 7461  th raise_on_meta
+0003bea0: 5f65 7272 6f72 2866 756e 636e 616d 6528  _error(funcname(
+0003beb0: 6675 6e63 292c 2075 6466 3d75 6466 292c  func), udf=udf),
+0003bec0: 2063 6865 636b 5f6e 756d 6572 6963 5f6f   check_numeric_o
+0003bed0: 6e6c 795f 6465 7072 6563 6174 696f 6e28  nly_deprecation(
+0003bee0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0003bef0: 6e20 6675 6e63 282a 5f65 7874 7261 6374  n func(*_extract
+0003bf00: 5f6d 6574 6128 6172 6773 2c20 5472 7565  _meta(args, True
+0003bf10: 292c 202a 2a5f 6578 7472 6163 745f 6d65  ), **_extract_me
+0003bf20: 7461 286b 7761 7267 732c 2054 7275 6529  ta(kwargs, True)
+0003bf30: 290a 0a0a 4069 6e73 6572 745f 6d65 7461  )...@insert_meta
+0003bf40: 5f70 6172 616d 5f64 6573 6372 6970 7469  _param_descripti
+0003bf50: 6f6e 0a64 6566 206d 6170 5f70 6172 7469  on.def map_parti
+0003bf60: 7469 6f6e 7328 0a20 2020 2066 756e 632c  tions(.    func,
+0003bf70: 0a20 2020 202a 6172 6773 2c0a 2020 2020  .    *args,.    
+0003bf80: 6d65 7461 3d6e 6f5f 6465 6661 756c 742c  meta=no_default,
+0003bf90: 0a20 2020 2065 6e66 6f72 6365 5f6d 6574  .    enforce_met
+0003bfa0: 6164 6174 613d 5472 7565 2c0a 2020 2020  adata=True,.    
+0003bfb0: 7472 616e 7366 6f72 6d5f 6469 7669 7369  transform_divisi
+0003bfc0: 6f6e 733d 5472 7565 2c0a 2020 2020 616c  ons=True,.    al
+0003bfd0: 6967 6e5f 6461 7461 6672 616d 6573 3d54  ign_dataframes=T
+0003bfe0: 7275 652c 0a20 2020 202a 2a6b 7761 7267  rue,.    **kwarg
+0003bff0: 732c 0a29 3a0a 2020 2020 2222 2241 7070  s,.):.    """App
+0003c000: 6c79 2050 7974 686f 6e20 6675 6e63 7469  ly Python functi
+0003c010: 6f6e 206f 6e20 6561 6368 2044 6174 6146  on on each DataF
+0003c020: 7261 6d65 2070 6172 7469 7469 6f6e 2e0a  rame partition..
+0003c030: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+0003c040: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+0003c050: 2020 2066 756e 6320 3a20 6675 6e63 7469     func : functi
+0003c060: 6f6e 0a20 2020 2020 2020 2046 756e 6374  on.        Funct
+0003c070: 696f 6e20 6170 706c 6965 6420 746f 2065  ion applied to e
+0003c080: 6163 6820 7061 7274 6974 696f 6e2e 0a20  ach partition.. 
+0003c090: 2020 2061 7267 732c 206b 7761 7267 7320     args, kwargs 
+0003c0a0: 3a0a 2020 2020 2020 2020 4172 6775 6d65  :.        Argume
+0003c0b0: 6e74 7320 616e 6420 6b65 7977 6f72 6473  nts and keywords
+0003c0c0: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
+0003c0d0: 6675 6e63 7469 6f6e 2e20 2041 7420 6c65  function.  At le
+0003c0e0: 6173 7420 6f6e 6520 6f66 2074 6865 0a20  ast one of the. 
+0003c0f0: 2020 2020 2020 2061 7267 7320 7368 6f75         args shou
+0003c100: 6c64 2062 6520 6120 4461 736b 2e64 6174  ld be a Dask.dat
+0003c110: 6166 7261 6d65 2e20 4172 6775 6d65 6e74  aframe. Argument
+0003c120: 7320 616e 6420 6b65 7977 6f72 6473 206d  s and keywords m
+0003c130: 6179 2063 6f6e 7461 696e 0a20 2020 2020  ay contain.     
+0003c140: 2020 2060 6053 6361 6c61 7260 602c 2060     ``Scalar``, `
+0003c150: 6044 656c 6179 6564 6060 206f 7220 7265  `Delayed`` or re
+0003c160: 6775 6c61 7220 7079 7468 6f6e 206f 626a  gular python obj
+0003c170: 6563 7473 2e20 4461 7461 4672 616d 652d  ects. DataFrame-
+0003c180: 6c69 6b65 2061 7267 730a 2020 2020 2020  like args.      
+0003c190: 2020 2862 6f74 6820 6461 736b 2061 6e64    (both dask and
+0003c1a0: 2070 616e 6461 7329 2077 696c 6c20 6265   pandas) will be
+0003c1b0: 2072 6570 6172 7469 7469 6f6e 6564 2074   repartitioned t
+0003c1c0: 6f20 616c 6967 6e20 2869 6620 6e65 6365  o align (if nece
+0003c1d0: 7373 6172 7929 0a20 2020 2020 2020 2062  ssary).        b
+0003c1e0: 6566 6f72 6520 6170 706c 7969 6e67 2074  efore applying t
+0003c1f0: 6865 2066 756e 6374 696f 6e20 2873 6565  he function (see
+0003c200: 2060 6061 6c69 676e 5f64 6174 6166 7261   ``align_datafra
+0003c210: 6d65 7360 6020 746f 2063 6f6e 7472 6f6c  mes`` to control
+0003c220: 292e 0a20 2020 2065 6e66 6f72 6365 5f6d  )..    enforce_m
+0003c230: 6574 6164 6174 6120 3a20 626f 6f6c 2c20  etadata : bool, 
+0003c240: 6465 6661 756c 7420 5472 7565 0a20 2020  default True.   
+0003c250: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
+0003c260: 656e 666f 7263 6520 6174 2072 756e 7469  enforce at runti
+0003c270: 6d65 2074 6861 7420 7468 6520 7374 7275  me that the stru
+0003c280: 6374 7572 6520 6f66 2074 6865 2044 6174  cture of the Dat
+0003c290: 6146 7261 6d65 0a20 2020 2020 2020 2070  aFrame.        p
+0003c2a0: 726f 6475 6365 6420 6279 2060 6066 756e  roduced by ``fun
+0003c2b0: 6360 6020 6163 7475 616c 6c79 206d 6174  c`` actually mat
+0003c2c0: 6368 6573 2074 6865 2073 7472 7563 7475  ches the structu
+0003c2d0: 7265 206f 6620 6060 6d65 7461 6060 2e0a  re of ``meta``..
+0003c2e0: 2020 2020 2020 2020 5468 6973 2077 696c          This wil
+0003c2f0: 6c20 7265 6e61 6d65 2061 6e64 2072 656f  l rename and reo
+0003c300: 7264 6572 2063 6f6c 756d 6e73 2066 6f72  rder columns for
+0003c310: 2065 6163 6820 7061 7274 6974 696f 6e2c   each partition,
+0003c320: 0a20 2020 2020 2020 2061 6e64 2077 696c  .        and wil
+0003c330: 6c20 7261 6973 6520 616e 2065 7272 6f72  l raise an error
+0003c340: 2069 6620 7468 6973 2064 6f65 736e 2774   if this doesn't
+0003c350: 2077 6f72 6b2c 0a20 2020 2020 2020 2062   work,.        b
+0003c360: 7574 2069 7420 776f 6e27 7420 7261 6973  ut it won't rais
+0003c370: 6520 6966 2064 7479 7065 7320 646f 6e27  e if dtypes don'
+0003c380: 7420 6d61 7463 682e 0a20 2020 2074 7261  t match..    tra
+0003c390: 6e73 666f 726d 5f64 6976 6973 696f 6e73  nsform_divisions
+0003c3a0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0003c3b0: 2054 7275 650a 2020 2020 2020 2020 5768   True.        Wh
+0003c3c0: 6574 6865 7220 746f 2061 7070 6c79 2074  ether to apply t
+0003c3d0: 6865 2066 756e 6374 696f 6e20 6f6e 746f  he function onto
+0003c3e0: 2074 6865 2064 6976 6973 696f 6e73 2061   the divisions a
+0003c3f0: 6e64 2061 7070 6c79 2074 686f 7365 0a20  nd apply those. 
+0003c400: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+0003c410: 6564 2064 6976 6973 696f 6e73 2074 6f20  ed divisions to 
+0003c420: 7468 6520 6f75 7470 7574 2e0a 2020 2020  the output..    
+0003c430: 616c 6967 6e5f 6461 7461 6672 616d 6573  align_dataframes
+0003c440: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0003c450: 2054 7275 650a 2020 2020 2020 2020 5768   True.        Wh
+0003c460: 6574 6865 7220 746f 2072 6570 6172 7469  ether to reparti
+0003c470: 7469 6f6e 2044 6174 6146 7261 6d65 2d20  tion DataFrame- 
+0003c480: 6f72 2053 6572 6965 732d 6c69 6b65 2061  or Series-like a
+0003c490: 7267 730a 2020 2020 2020 2020 2862 6f74  rgs.        (bot
+0003c4a0: 6820 6461 736b 2061 6e64 2070 616e 6461  h dask and panda
+0003c4b0: 7329 2073 6f20 7468 6569 7220 6469 7669  s) so their divi
+0003c4c0: 7369 6f6e 7320 616c 6967 6e20 6265 666f  sions align befo
+0003c4d0: 7265 2061 7070 6c79 696e 670a 2020 2020  re applying.    
+0003c4e0: 2020 2020 7468 6520 6675 6e63 7469 6f6e      the function
+0003c4f0: 2e20 5468 6973 2072 6571 7569 7265 7320  . This requires 
+0003c500: 616c 6c20 696e 7075 7473 2074 6f20 6861  all inputs to ha
+0003c510: 7665 206b 6e6f 776e 2064 6976 6973 696f  ve known divisio
+0003c520: 6e73 2e0a 2020 2020 2020 2020 5369 6e67  ns..        Sing
+0003c530: 6c65 2d70 6172 7469 7469 6f6e 2069 6e70  le-partition inp
+0003c540: 7574 7320 7769 6c6c 2062 6520 7370 6c69  uts will be spli
+0003c550: 7420 696e 746f 206d 756c 7469 706c 6520  t into multiple 
+0003c560: 7061 7274 6974 696f 6e73 2e0a 0a20 2020  partitions...   
+0003c570: 2020 2020 2049 6620 4661 6c73 652c 2061       If False, a
+0003c580: 6c6c 2069 6e70 7574 7320 6d75 7374 2068  ll inputs must h
+0003c590: 6176 6520 6569 7468 6572 2074 6865 2073  ave either the s
+0003c5a0: 616d 6520 6e75 6d62 6572 206f 6620 7061  ame number of pa
+0003c5b0: 7274 6974 696f 6e73 0a20 2020 2020 2020  rtitions.       
+0003c5c0: 206f 7220 6120 7369 6e67 6c65 2070 6172   or a single par
+0003c5d0: 7469 7469 6f6e 2e20 5369 6e67 6c65 2d70  tition. Single-p
+0003c5e0: 6172 7469 7469 6f6e 2069 6e70 7574 7320  artition inputs 
+0003c5f0: 7769 6c6c 2062 6520 6272 6f61 6463 6173  will be broadcas
+0003c600: 7420 746f 0a20 2020 2020 2020 2065 7665  t to.        eve
+0003c610: 7279 2070 6172 7469 7469 6f6e 206f 6620  ry partition of 
+0003c620: 6d75 6c74 692d 7061 7274 6974 696f 6e20  multi-partition 
+0003c630: 696e 7075 7473 2e0a 2020 2020 244d 4554  inputs..    $MET
+0003c640: 410a 2020 2020 2222 220a 2020 2020 6e61  A.    """.    na
+0003c650: 6d65 203d 206b 7761 7267 732e 706f 7028  me = kwargs.pop(
+0003c660: 2274 6f6b 656e 222c 204e 6f6e 6529 0a20  "token", None). 
+0003c670: 2020 2070 6172 656e 745f 6d65 7461 203d     parent_meta =
+0003c680: 206b 7761 7267 732e 706f 7028 2270 6172   kwargs.pop("par
+0003c690: 656e 745f 6d65 7461 222c 204e 6f6e 6529  ent_meta", None)
+0003c6a0: 0a0a 2020 2020 6173 7365 7274 2063 616c  ..    assert cal
+0003c6b0: 6c61 626c 6528 6675 6e63 290a 2020 2020  lable(func).    
+0003c6c0: 6966 206e 616d 6520 6973 206e 6f74 204e  if name is not N
+0003c6d0: 6f6e 653a 0a20 2020 2020 2020 2074 6f6b  one:.        tok
+0003c6e0: 656e 203d 2074 6f6b 656e 697a 6528 6d65  en = tokenize(me
+0003c6f0: 7461 2c20 2a61 7267 732c 202a 2a6b 7761  ta, *args, **kwa
+0003c700: 7267 7329 0a20 2020 2065 6c73 653a 0a20  rgs).    else:. 
+0003c710: 2020 2020 2020 206e 616d 6520 3d20 6675         name = fu
+0003c720: 6e63 6e61 6d65 2866 756e 6329 0a20 2020  ncname(func).   
+0003c730: 2020 2020 2074 6f6b 656e 203d 2074 6f6b       token = tok
+0003c740: 656e 697a 6528 6675 6e63 2c20 6d65 7461  enize(func, meta
+0003c750: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+0003c760: 7329 0a20 2020 206e 616d 6520 3d20 6622  s).    name = f"
+0003c770: 7b6e 616d 657d 2d7b 746f 6b65 6e7d 220a  {name}-{token}".
+0003c780: 0a20 2020 2066 726f 6d20 6461 736b 2e64  .    from dask.d
+0003c790: 6174 6166 7261 6d65 2e6d 756c 7469 2069  ataframe.multi i
+0003c7a0: 6d70 6f72 7420 5f6d 6179 6265 5f61 6c69  mport _maybe_ali
+0003c7b0: 676e 5f70 6172 7469 7469 6f6e 730a 0a20  gn_partitions.. 
+0003c7c0: 2020 2069 6620 616c 6967 6e5f 6461 7461     if align_data
+0003c7d0: 6672 616d 6573 3a0a 2020 2020 2020 2020  frames:.        
+0003c7e0: 6172 6773 203d 205f 6d61 7962 655f 6672  args = _maybe_fr
+0003c7f0: 6f6d 5f70 616e 6461 7328 6172 6773 290a  om_pandas(args).
+0003c800: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0003c810: 2020 2020 2020 2020 2061 7267 7320 3d20           args = 
+0003c820: 5f6d 6179 6265 5f61 6c69 676e 5f70 6172  _maybe_align_par
+0003c830: 7469 7469 6f6e 7328 6172 6773 290a 2020  titions(args).  
+0003c840: 2020 2020 2020 6578 6365 7074 2056 616c        except Val
+0003c850: 7565 4572 726f 7220 6173 2065 3a0a 2020  ueError as e:.  
+0003c860: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0003c870: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0003c880: 2020 2020 2020 2020 2020 2020 6622 7b65              f"{e
+0003c890: 7d2e 2049 6620 796f 7520 646f 6e27 7420  }. If you don't 
+0003c8a0: 7761 6e74 2074 6865 2070 6172 7469 7469  want the partiti
+0003c8b0: 6f6e 7320 746f 2062 6520 616c 6967 6e65  ons to be aligne
+0003c8c0: 642c 2061 6e64 2061 7265 2022 0a20 2020  d, and are ".   
+0003c8d0: 2020 2020 2020 2020 2020 2020 2022 6361               "ca
+0003c8e0: 6c6c 696e 6720 606d 6170 5f70 6172 7469  lling `map_parti
+0003c8f0: 7469 6f6e 7360 2064 6972 6563 746c 792c  tions` directly,
+0003c900: 2070 6173 7320 6061 6c69 676e 5f64 6174   pass `align_dat
+0003c910: 6166 7261 6d65 733d 4661 6c73 6560 2e22  aframes=False`."
+0003c920: 0a20 2020 2020 2020 2020 2020 2029 2066  .            ) f
+0003c930: 726f 6d20 650a 0a20 2020 2064 6673 203d  rom e..    dfs =
+0003c940: 205b 6466 2066 6f72 2064 6620 696e 2061   [df for df in a
+0003c950: 7267 7320 6966 2069 7369 6e73 7461 6e63  rgs if isinstanc
+0003c960: 6528 6466 2c20 5f46 7261 6d65 295d 0a0a  e(df, _Frame)]..
+0003c970: 2020 2020 6d65 7461 203d 205f 6765 745f      meta = _get_
+0003c980: 6d65 7461 5f6d 6170 5f70 6172 7469 7469  meta_map_partiti
+0003c990: 6f6e 7328 6172 6773 2c20 6466 732c 2066  ons(args, dfs, f
+0003c9a0: 756e 632c 206b 7761 7267 732c 206d 6574  unc, kwargs, met
+0003c9b0: 612c 2070 6172 656e 745f 6d65 7461 290a  a, parent_meta).
+0003c9c0: 2020 2020 6966 2061 6c6c 2869 7369 6e73      if all(isins
+0003c9d0: 7461 6e63 6528 6172 672c 2053 6361 6c61  tance(arg, Scala
+0003c9e0: 7229 2066 6f72 2061 7267 2069 6e20 6172  r) for arg in ar
+0003c9f0: 6773 293a 0a20 2020 2020 2020 206c 6179  gs):.        lay
+0003ca00: 6572 203d 207b 0a20 2020 2020 2020 2020  er = {.         
+0003ca10: 2020 2028 6e61 6d65 2c20 3029 3a20 280a     (name, 0): (.
+0003ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ca30: 6170 706c 792c 0a20 2020 2020 2020 2020  apply,.         
+0003ca40: 2020 2020 2020 2066 756e 632c 0a20 2020         func,.   
+0003ca50: 2020 2020 2020 2020 2020 2020 2028 7475               (tu
+0003ca60: 706c 652c 205b 2861 7267 2e5f 6e61 6d65  ple, [(arg._name
+0003ca70: 2c20 3029 2066 6f72 2061 7267 2069 6e20  , 0) for arg in 
+0003ca80: 6172 6773 5d29 2c0a 2020 2020 2020 2020  args]),.        
+0003ca90: 2020 2020 2020 2020 6b77 6172 6773 2c0a          kwargs,.
+0003caa0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0003cab0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0003cac0: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
+0003cad0: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
+0003cae0: 6563 7469 6f6e 7328 6e61 6d65 2c20 6c61  ections(name, la
+0003caf0: 7965 722c 2064 6570 656e 6465 6e63 6965  yer, dependencie
+0003cb00: 733d 6172 6773 290a 2020 2020 2020 2020  s=args).        
+0003cb10: 7265 7475 726e 2053 6361 6c61 7228 6772  return Scalar(gr
+0003cb20: 6170 682c 206e 616d 652c 206d 6574 6129  aph, name, meta)
+0003cb30: 0a0a 2020 2020 6172 6773 3220 3d20 5b5d  ..    args2 = []
+0003cb40: 0a20 2020 2064 6570 656e 6465 6e63 6965  .    dependencie
+0003cb50: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
+0003cb60: 7267 2069 6e20 6172 6773 3a0a 2020 2020  rg in args:.    
+0003cb70: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003cb80: 6528 6172 672c 205f 4672 616d 6529 3a0a  e(arg, _Frame):.
+0003cb90: 2020 2020 2020 2020 2020 2020 6172 6773              args
+0003cba0: 322e 6170 7065 6e64 2861 7267 290a 2020  2.append(arg).  
+0003cbb0: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
+0003cbc0: 656e 6369 6573 2e61 7070 656e 6428 6172  encies.append(ar
+0003cbd0: 6729 0a20 2020 2020 2020 2020 2020 2063  g).            c
+0003cbe0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0003cbf0: 6172 6720 3d20 6e6f 726d 616c 697a 655f  arg = normalize_
+0003cc00: 6172 6728 6172 6729 0a20 2020 2020 2020  arg(arg).       
+0003cc10: 2061 7267 322c 2063 6f6c 6c65 6374 696f   arg2, collectio
+0003cc20: 6e73 203d 2075 6e70 6163 6b5f 636f 6c6c  ns = unpack_coll
+0003cc30: 6563 7469 6f6e 7328 6172 6729 0a20 2020  ections(arg).   
+0003cc40: 2020 2020 2069 6620 636f 6c6c 6563 7469       if collecti
+0003cc50: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+0003cc60: 2061 7267 7332 2e61 7070 656e 6428 6172   args2.append(ar
+0003cc70: 6732 290a 2020 2020 2020 2020 2020 2020  g2).            
+0003cc80: 6465 7065 6e64 656e 6369 6573 2e65 7874  dependencies.ext
+0003cc90: 656e 6428 636f 6c6c 6563 7469 6f6e 7329  end(collections)
+0003cca0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003ccb0: 2020 2020 2020 2020 2020 2061 7267 7332             args2
+0003ccc0: 2e61 7070 656e 6428 6172 6729 0a0a 2020  .append(arg)..  
+0003ccd0: 2020 6b77 6172 6773 3320 3d20 7b7d 0a20    kwargs3 = {}. 
+0003cce0: 2020 2073 696d 706c 6520 3d20 5472 7565     simple = True
+0003ccf0: 0a20 2020 2066 6f72 206b 2c20 7620 696e  .    for k, v in
+0003cd00: 206b 7761 7267 732e 6974 656d 7328 293a   kwargs.items():
+0003cd10: 0a20 2020 2020 2020 2076 203d 206e 6f72  .        v = nor
+0003cd20: 6d61 6c69 7a65 5f61 7267 2876 290a 2020  malize_arg(v).  
+0003cd30: 2020 2020 2020 762c 2063 6f6c 6c65 6374        v, collect
+0003cd40: 696f 6e73 203d 2075 6e70 6163 6b5f 636f  ions = unpack_co
+0003cd50: 6c6c 6563 7469 6f6e 7328 7629 0a20 2020  llections(v).   
+0003cd60: 2020 2020 2064 6570 656e 6465 6e63 6965       dependencie
+0003cd70: 732e 6578 7465 6e64 2863 6f6c 6c65 6374  s.extend(collect
+0003cd80: 696f 6e73 290a 2020 2020 2020 2020 6b77  ions).        kw
+0003cd90: 6172 6773 335b 6b5d 203d 2076 0a20 2020  args3[k] = v.   
+0003cda0: 2020 2020 2069 6620 636f 6c6c 6563 7469       if collecti
+0003cdb0: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+0003cdc0: 2073 696d 706c 6520 3d20 4661 6c73 650a   simple = False.
+0003cdd0: 0a20 2020 2064 6976 6973 696f 6e73 203d  .    divisions =
+0003cde0: 205f 6765 745f 6469 7669 7369 6f6e 735f   _get_divisions_
+0003cdf0: 6d61 705f 7061 7274 6974 696f 6e73 280a  map_partitions(.
+0003ce00: 2020 2020 2020 2020 616c 6967 6e5f 6461          align_da
+0003ce10: 7461 6672 616d 6573 2c20 7472 616e 7366  taframes, transf
+0003ce20: 6f72 6d5f 6469 7669 7369 6f6e 732c 2064  orm_divisions, d
+0003ce30: 6673 2c20 6675 6e63 2c20 6172 6773 2c20  fs, func, args, 
+0003ce40: 6b77 6172 6773 0a20 2020 2029 0a0a 2020  kwargs.    )..  
+0003ce50: 2020 6966 2068 6173 5f6b 6579 776f 7264    if has_keyword
+0003ce60: 2866 756e 632c 2022 7061 7274 6974 696f  (func, "partitio
+0003ce70: 6e5f 696e 666f 2229 3a0a 2020 2020 2020  n_info"):.      
+0003ce80: 2020 7061 7274 6974 696f 6e5f 696e 666f    partition_info
+0003ce90: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0003cea0: 2028 692c 293a 207b 226e 756d 6265 7222   (i,): {"number"
+0003ceb0: 3a20 692c 2022 6469 7669 7369 6f6e 223a  : i, "division":
+0003cec0: 2064 6976 6973 696f 6e7d 0a20 2020 2020   division}.     
+0003ced0: 2020 2020 2020 2066 6f72 2069 2c20 6469         for i, di
+0003cee0: 7669 7369 6f6e 2069 6e20 656e 756d 6572  vision in enumer
+0003cef0: 6174 6528 6469 7669 7369 6f6e 735b 3a2d  ate(divisions[:-
+0003cf00: 315d 290a 2020 2020 2020 2020 7d0a 0a20  1]).        }.. 
+0003cf10: 2020 2020 2020 2061 7267 7332 2e69 6e73         args2.ins
+0003cf20: 6572 7428 302c 2042 6c6f 636b 7769 7365  ert(0, Blockwise
+0003cf30: 4465 7044 6963 7428 7061 7274 6974 696f  DepDict(partitio
+0003cf40: 6e5f 696e 666f 2929 0a20 2020 2020 2020  n_info)).       
+0003cf50: 206f 7269 675f 6675 6e63 203d 2066 756e   orig_func = fun
+0003cf60: 630a 0a20 2020 2020 2020 2064 6566 2066  c..        def f
+0003cf70: 756e 6328 7061 7274 6974 696f 6e5f 696e  unc(partition_in
+0003cf80: 666f 2c20 2a61 7267 732c 202a 2a6b 7761  fo, *args, **kwa
+0003cf90: 7267 7329 3a0a 2020 2020 2020 2020 2020  rgs):.          
+0003cfa0: 2020 7265 7475 726e 206f 7269 675f 6675    return orig_fu
+0003cfb0: 6e63 282a 6172 6773 2c20 2a2a 6b77 6172  nc(*args, **kwar
+0003cfc0: 6773 2c20 7061 7274 6974 696f 6e5f 696e  gs, partition_in
+0003cfd0: 666f 3d70 6172 7469 7469 6f6e 5f69 6e66  fo=partition_inf
+0003cfe0: 6f29 0a0a 2020 2020 6966 2065 6e66 6f72  o)..    if enfor
+0003cff0: 6365 5f6d 6574 6164 6174 613a 0a20 2020  ce_metadata:.   
+0003d000: 2020 2020 2064 736b 203d 2070 6172 7469       dsk = parti
+0003d010: 7469 6f6e 7769 7365 5f67 7261 7068 280a  tionwise_graph(.
+0003d020: 2020 2020 2020 2020 2020 2020 6170 706c              appl
+0003d030: 795f 616e 645f 656e 666f 7263 652c 0a20  y_and_enforce,. 
+0003d040: 2020 2020 2020 2020 2020 206e 616d 652c             name,
+0003d050: 0a20 2020 2020 2020 2020 2020 202a 6172  .            *ar
+0003d060: 6773 322c 0a20 2020 2020 2020 2020 2020  gs2,.           
+0003d070: 2064 6570 656e 6465 6e63 6965 733d 6465   dependencies=de
+0003d080: 7065 6e64 656e 6369 6573 2c0a 2020 2020  pendencies,.    
+0003d090: 2020 2020 2020 2020 5f66 756e 633d 6675          _func=fu
+0003d0a0: 6e63 2c0a 2020 2020 2020 2020 2020 2020  nc,.            
+0003d0b0: 5f6d 6574 613d 6d65 7461 2c0a 2020 2020  _meta=meta,.    
+0003d0c0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+0003d0d0: 332c 0a20 2020 2020 2020 2029 0a20 2020  3,.        ).   
+0003d0e0: 2065 6c73 653a 0a20 2020 2020 2020 206b   else:.        k
+0003d0f0: 7761 7267 7334 203d 206b 7761 7267 7320  wargs4 = kwargs 
+0003d100: 6966 2073 696d 706c 6520 656c 7365 206b  if simple else k
+0003d110: 7761 7267 7333 0a20 2020 2020 2020 2064  wargs3.        d
+0003d120: 736b 203d 2070 6172 7469 7469 6f6e 7769  sk = partitionwi
+0003d130: 7365 5f67 7261 7068 280a 2020 2020 2020  se_graph(.      
+0003d140: 2020 2020 2020 6675 6e63 2c20 6e61 6d65        func, name
+0003d150: 2c20 2a61 7267 7332 2c20 2a2a 6b77 6172  , *args2, **kwar
+0003d160: 6773 342c 2064 6570 656e 6465 6e63 6965  gs4, dependencie
+0003d170: 733d 6465 7065 6e64 656e 6369 6573 0a20  s=dependencies. 
+0003d180: 2020 2020 2020 2029 0a0a 2020 2020 6772         )..    gr
+0003d190: 6170 6820 3d20 4869 6768 4c65 7665 6c47  aph = HighLevelG
+0003d1a0: 7261 7068 2e66 726f 6d5f 636f 6c6c 6563  raph.from_collec
+0003d1b0: 7469 6f6e 7328 6e61 6d65 2c20 6473 6b2c  tions(name, dsk,
+0003d1c0: 2064 6570 656e 6465 6e63 6965 733d 6465   dependencies=de
+0003d1d0: 7065 6e64 656e 6369 6573 290a 2020 2020  pendencies).    
+0003d1e0: 7265 7475 726e 206e 6577 5f64 645f 6f62  return new_dd_ob
+0003d1f0: 6a65 6374 2867 7261 7068 2c20 6e61 6d65  ject(graph, name
+0003d200: 2c20 6d65 7461 2c20 6469 7669 7369 6f6e  , meta, division
+0003d210: 7329 0a0a 0a64 6566 205f 6765 745f 6469  s)...def _get_di
+0003d220: 7669 7369 6f6e 735f 6d61 705f 7061 7274  visions_map_part
+0003d230: 6974 696f 6e73 280a 2020 2020 616c 6967  itions(.    alig
+0003d240: 6e5f 6461 7461 6672 616d 6573 2c20 7472  n_dataframes, tr
+0003d250: 616e 7366 6f72 6d5f 6469 7669 7369 6f6e  ansform_division
+0003d260: 732c 2064 6673 2c20 6675 6e63 2c20 6172  s, dfs, func, ar
+0003d270: 6773 2c20 6b77 6172 6773 0a29 3a0a 2020  gs, kwargs.):.  
+0003d280: 2020 2222 220a 2020 2020 4865 6c70 6572    """.    Helper
+0003d290: 2074 6f20 6765 7420 6469 7669 7369 6f6e   to get division
+0003d2a0: 7320 666f 7220 6d61 705f 7061 7274 6974  s for map_partit
+0003d2b0: 696f 6e73 2061 6e64 206d 6170 5f6f 7665  ions and map_ove
+0003d2c0: 726c 6170 206f 7574 7075 742e 0a20 2020  rlap output..   
+0003d2d0: 2022 2222 0a20 2020 2069 6620 616c 6967   """.    if alig
+0003d2e0: 6e5f 6461 7461 6672 616d 6573 3a0a 2020  n_dataframes:.  
+0003d2f0: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
+0003d300: 3d20 6466 735b 305d 2e64 6976 6973 696f  = dfs[0].divisio
+0003d310: 6e73 0a20 2020 2065 6c73 653a 0a20 2020  ns.    else:.   
+0003d320: 2020 2020 2023 2055 6e61 6c69 676e 6564       # Unaligned
+0003d330: 2c20 6466 7320 6973 2061 206d 6978 206f  , dfs is a mix o
+0003d340: 6620 3120 7061 7274 6974 696f 6e20 616e  f 1 partition an
+0003d350: 6420 312b 2070 6172 7469 7469 6f6e 2064  d 1+ partition d
+0003d360: 6174 6166 7261 6d65 732c 0a20 2020 2020  ataframes,.     
+0003d370: 2020 2023 2075 7365 206c 6f6e 6765 7374     # use longest
+0003d380: 2064 6976 6973 696f 6e73 2066 6f75 6e64   divisions found
+0003d390: 0a20 2020 2020 2020 2064 6976 6973 696f  .        divisio
+0003d3a0: 6e73 203d 206d 6178 2828 642e 6469 7669  ns = max((d.divi
+0003d3b0: 7369 6f6e 7320 666f 7220 6420 696e 2064  sions for d in d
+0003d3c0: 6673 292c 206b 6579 3d6c 656e 290a 2020  fs), key=len).  
+0003d3d0: 2020 6966 2074 7261 6e73 666f 726d 5f64    if transform_d
+0003d3e0: 6976 6973 696f 6e73 2061 6e64 2069 7369  ivisions and isi
+0003d3f0: 6e73 7461 6e63 6528 6466 735b 305d 2c20  nstance(dfs[0], 
+0003d400: 496e 6465 7829 2061 6e64 206c 656e 2864  Index) and len(d
+0003d410: 6673 2920 3d3d 2031 3a0a 2020 2020 2020  fs) == 1:.      
+0003d420: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0003d430: 2020 2064 6976 6973 696f 6e73 203d 2066     divisions = f
+0003d440: 756e 6328 0a20 2020 2020 2020 2020 2020  unc(.           
+0003d450: 2020 2020 202a 5b70 642e 496e 6465 7828       *[pd.Index(
+0003d460: 612e 6469 7669 7369 6f6e 7329 2069 6620  a.divisions) if 
+0003d470: 6120 6973 2064 6673 5b30 5d20 656c 7365  a is dfs[0] else
+0003d480: 2061 2066 6f72 2061 2069 6e20 6172 6773   a for a in args
+0003d490: 5d2c 202a 2a6b 7761 7267 730a 2020 2020  ], **kwargs.    
+0003d4a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0003d4b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003d4c0: 6e63 6528 6469 7669 7369 6f6e 732c 2070  nce(divisions, p
+0003d4d0: 642e 496e 6465 7829 3a0a 2020 2020 2020  d.Index):.      
+0003d4e0: 2020 2020 2020 2020 2020 6469 7669 7369            divisi
+0003d4f0: 6f6e 7320 3d20 6d65 7468 6f64 732e 746f  ons = methods.to
+0003d500: 6c69 7374 2864 6976 6973 696f 6e73 290a  list(divisions).
+0003d510: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0003d520: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+0003d530: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0003d540: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003d550: 2020 2020 2069 6620 6e6f 7420 7661 6c69       if not vali
+0003d560: 645f 6469 7669 7369 6f6e 7328 6469 7669  d_divisions(divi
+0003d570: 7369 6f6e 7329 3a0a 2020 2020 2020 2020  sions):.        
+0003d580: 2020 2020 2020 2020 6469 7669 7369 6f6e          division
+0003d590: 7320 3d20 5b4e 6f6e 655d 202a 2028 6466  s = [None] * (df
+0003d5a0: 735b 305d 2e6e 7061 7274 6974 696f 6e73  s[0].npartitions
+0003d5b0: 202b 2031 290a 2020 2020 7265 7475 726e   + 1).    return
+0003d5c0: 2064 6976 6973 696f 6e73 0a0a 0a64 6566   divisions...def
+0003d5d0: 205f 6765 745f 6d65 7461 5f6d 6170 5f70   _get_meta_map_p
+0003d5e0: 6172 7469 7469 6f6e 7328 6172 6773 2c20  artitions(args, 
+0003d5f0: 6466 732c 2066 756e 632c 206b 7761 7267  dfs, func, kwarg
+0003d600: 732c 206d 6574 612c 2070 6172 656e 745f  s, meta, parent_
+0003d610: 6d65 7461 293a 0a20 2020 2022 2222 0a20  meta):.    """. 
+0003d620: 2020 2048 656c 7065 7220 746f 2067 656e     Helper to gen
+0003d630: 6572 6174 6520 6d65 7461 6461 7461 2066  erate metadata f
+0003d640: 6f72 206d 6170 5f70 6172 7469 7469 6f6e  or map_partition
+0003d650: 7320 616e 6420 6d61 705f 6f76 6572 6c61  s and map_overla
+0003d660: 7020 6f75 7470 7574 2e0a 2020 2020 2222  p output..    ""
+0003d670: 220a 2020 2020 6d65 7461 5f69 6e64 6578  ".    meta_index
+0003d680: 203d 2067 6574 6174 7472 286d 616b 655f   = getattr(make_
+0003d690: 6d65 7461 2864 6673 5b30 5d29 2c20 2269  meta(dfs[0]), "i
+0003d6a0: 6e64 6578 222c 204e 6f6e 6529 2069 6620  ndex", None) if 
+0003d6b0: 6466 7320 656c 7365 204e 6f6e 650a 2020  dfs else None.  
+0003d6c0: 2020 6966 2070 6172 656e 745f 6d65 7461    if parent_meta
+0003d6d0: 2069 7320 4e6f 6e65 2061 6e64 2064 6673   is None and dfs
+0003d6e0: 3a0a 2020 2020 2020 2020 7061 7265 6e74  :.        parent
+0003d6f0: 5f6d 6574 6120 3d20 6466 735b 305d 2e5f  _meta = dfs[0]._
+0003d700: 6d65 7461 0a20 2020 2069 6620 6d65 7461  meta.    if meta
+0003d710: 2069 7320 6e6f 5f64 6566 6175 6c74 3a0a   is no_default:.
+0003d720: 2020 2020 2020 2020 2320 5573 6520 6e6f          # Use no
+0003d730: 6e2d 6e6f 726d 616c 697a 6564 206b 7761  n-normalized kwa
+0003d740: 7267 7320 6865 7265 2c20 6173 2077 6520  rgs here, as we 
+0003d750: 7761 6e74 2074 6865 2072 6561 6c20 7661  want the real va
+0003d760: 6c75 6573 2028 6e6f 740a 2020 2020 2020  lues (not.      
+0003d770: 2020 2320 6465 6c61 7965 6420 7661 6c75    # delayed valu
+0003d780: 6573 290a 2020 2020 2020 2020 6d65 7461  es).        meta
+0003d790: 203d 205f 656d 756c 6174 6528 6675 6e63   = _emulate(func
+0003d7a0: 2c20 2a61 7267 732c 2075 6466 3d54 7275  , *args, udf=Tru
+0003d7b0: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
+0003d7c0: 2020 2020 206d 6574 615f 6973 5f65 6d75       meta_is_emu
+0003d7d0: 6c61 7465 6420 3d20 5472 7565 0a20 2020  lated = True.   
+0003d7e0: 2065 6c73 653a 0a20 2020 2020 2020 206d   else:.        m
+0003d7f0: 6574 6120 3d20 6d61 6b65 5f6d 6574 6128  eta = make_meta(
+0003d800: 6d65 7461 2c20 696e 6465 783d 6d65 7461  meta, index=meta
+0003d810: 5f69 6e64 6578 2c20 7061 7265 6e74 5f6d  _index, parent_m
+0003d820: 6574 613d 7061 7265 6e74 5f6d 6574 6129  eta=parent_meta)
+0003d830: 0a20 2020 2020 2020 206d 6574 615f 6973  .        meta_is
+0003d840: 5f65 6d75 6c61 7465 6420 3d20 4661 6c73  _emulated = Fals
+0003d850: 650a 0a20 2020 2069 6620 6e6f 7420 2868  e..    if not (h
+0003d860: 6173 5f70 6172 616c 6c65 6c5f 7479 7065  as_parallel_type
+0003d870: 286d 6574 6129 206f 7220 6973 5f61 7272  (meta) or is_arr
+0003d880: 6179 6c69 6b65 286d 6574 6129 2061 6e64  aylike(meta) and
+0003d890: 206d 6574 612e 7368 6170 6529 2061 6e64   meta.shape) and
+0003d8a0: 206e 6f74 2061 6c6c 280a 2020 2020 2020   not all(.      
+0003d8b0: 2020 6973 696e 7374 616e 6365 2861 7267    isinstance(arg
+0003d8c0: 2c20 5363 616c 6172 2920 666f 7220 6172  , Scalar) for ar
+0003d8d0: 6720 696e 2061 7267 730a 2020 2020 293a  g in args.    ):
+0003d8e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0003d8f0: 6d65 7461 5f69 735f 656d 756c 6174 6564  meta_is_emulated
+0003d900: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+0003d910: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+0003d920: 2020 2020 2020 2020 2020 2020 2022 4d65               "Me
+0003d930: 7461 2069 7320 6e6f 7420 7661 6c69 642c  ta is not valid,
+0003d940: 2060 6d61 705f 7061 7274 6974 696f 6e73   `map_partitions
+0003d950: 6020 616e 6420 606d 6170 5f6f 7665 726c  ` and `map_overl
+0003d960: 6170 6020 6578 7065 6374 7320 6f75 7470  ap` expects outp
+0003d970: 7574 2074 6f20 6265 2061 2070 616e 6461  ut to be a panda
+0003d980: 7320 6f62 6a65 6374 2e20 220a 2020 2020  s object. ".    
+0003d990: 2020 2020 2020 2020 2020 2020 2254 7279              "Try
+0003d9a0: 2070 6173 7369 6e67 2061 2070 616e 6461   passing a panda
+0003d9b0: 7320 6f62 6a65 6374 2061 7320 6d65 7461  s object as meta
+0003d9c0: 206f 7220 6120 6469 6374 206f 7220 7475   or a dict or tu
+0003d9d0: 706c 6520 7265 7072 6573 656e 7469 6e67  ple representing
+0003d9e0: 2074 6865 2022 0a20 2020 2020 2020 2020   the ".         
+0003d9f0: 2020 2020 2020 2022 286e 616d 652c 2064         "(name, d
+0003da00: 7479 7065 2920 6f66 2074 6865 2063 6f6c  type) of the col
+0003da10: 756d 6e73 2e20 496e 2074 6865 2066 7574  umns. In the fut
+0003da20: 7572 6520 7468 6520 6d65 7461 2079 6f75  ure the meta you
+0003da30: 2070 6173 7365 6420 7769 6c6c 206e 6f74   passed will not
+0003da40: 2077 6f72 6b2e 222c 0a20 2020 2020 2020   work.",.       
+0003da50: 2020 2020 2020 2020 2046 7574 7572 6557           FutureW
+0003da60: 6172 6e69 6e67 2c0a 2020 2020 2020 2020  arning,.        
+0003da70: 2020 2020 290a 2020 2020 2020 2020 2320      ).        # 
+0003da80: 4966 2060 6d65 7461 6020 6973 206e 6f74  If `meta` is not
+0003da90: 2061 2070 616e 6461 7320 6f62 6a65 6374   a pandas object
+0003daa0: 2c20 7468 6520 636f 6e63 6174 656e 6174  , the concatenat
+0003dab0: 6564 2072 6573 756c 7473 2077 696c 6c20  ed results will 
+0003dac0: 6265 2061 0a20 2020 2020 2020 2023 2064  be a.        # d
+0003dad0: 6966 6665 7265 6e74 2074 7970 650a 2020  ifferent type.  
+0003dae0: 2020 2020 2020 6d65 7461 203d 206d 616b        meta = mak
+0003daf0: 655f 6d65 7461 285f 636f 6e63 6174 285b  e_meta(_concat([
+0003db00: 6d65 7461 5d29 2c20 696e 6465 783d 6d65  meta]), index=me
+0003db10: 7461 5f69 6e64 6578 290a 0a20 2020 2023  ta_index)..    #
+0003db20: 2045 6e73 7572 6520 6d65 7461 2069 7320   Ensure meta is 
+0003db30: 656d 7074 7920 7365 7269 6573 0a20 2020  empty series.   
+0003db40: 206d 6574 6120 3d20 6d61 6b65 5f6d 6574   meta = make_met
+0003db50: 6128 6d65 7461 2c20 7061 7265 6e74 5f6d  a(meta, parent_m
+0003db60: 6574 613d 7061 7265 6e74 5f6d 6574 6129  eta=parent_meta)
+0003db70: 0a0a 2020 2020 7265 7475 726e 206d 6574  ..    return met
+0003db80: 610a 0a0a 6465 6620 6170 706c 795f 616e  a...def apply_an
+0003db90: 645f 656e 666f 7263 6528 2a61 7267 732c  d_enforce(*args,
+0003dba0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0003dbb0: 2222 2241 7070 6c79 2061 2066 756e 6374  """Apply a funct
+0003dbc0: 696f 6e2c 2061 6e64 2065 6e66 6f72 6365  ion, and enforce
+0003dbd0: 2074 6865 206f 7574 7075 7420 746f 206d   the output to m
+0003dbe0: 6174 6368 206d 6574 610a 0a20 2020 2045  atch meta..    E
+0003dbf0: 6e73 7572 6573 2074 6865 206f 7574 7075  nsures the outpu
+0003dc00: 7420 6861 7320 7468 6520 7361 6d65 2063  t has the same c
+0003dc10: 6f6c 756d 6e73 2c20 6576 656e 2069 6620  olumns, even if 
+0003dc20: 656d 7074 792e 2222 220a 2020 2020 6675  empty.""".    fu
+0003dc30: 6e63 203d 206b 7761 7267 732e 706f 7028  nc = kwargs.pop(
+0003dc40: 225f 6675 6e63 2229 0a20 2020 206d 6574  "_func").    met
+0003dc50: 6120 3d20 6b77 6172 6773 2e70 6f70 2822  a = kwargs.pop("
+0003dc60: 5f6d 6574 6122 290a 2020 2020 6466 203d  _meta").    df =
+0003dc70: 2066 756e 6328 2a61 7267 732c 202a 2a6b   func(*args, **k
+0003dc80: 7761 7267 7329 0a20 2020 2069 6620 6973  wargs).    if is
+0003dc90: 5f64 6174 6166 7261 6d65 5f6c 696b 6528  _dataframe_like(
+0003dca0: 6466 2920 6f72 2069 735f 7365 7269 6573  df) or is_series
+0003dcb0: 5f6c 696b 6528 6466 2920 6f72 2069 735f  _like(df) or is_
+0003dcc0: 696e 6465 785f 6c69 6b65 2864 6629 3a0a  index_like(df):.
+0003dcd0: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
+0003dce0: 656e 2864 6629 3a0a 2020 2020 2020 2020  en(df):.        
+0003dcf0: 2020 2020 7265 7475 726e 206d 6574 610a      return meta.
+0003dd00: 2020 2020 2020 2020 6966 2069 735f 6461          if is_da
+0003dd10: 7461 6672 616d 655f 6c69 6b65 2864 6629  taframe_like(df)
+0003dd20: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
+0003dd30: 6563 6b5f 6d61 7463 6869 6e67 5f63 6f6c  eck_matching_col
+0003dd40: 756d 6e73 286d 6574 612c 2064 6629 0a20  umns(meta, df). 
+0003dd50: 2020 2020 2020 2020 2020 2063 203d 206d             c = m
+0003dd60: 6574 612e 636f 6c75 6d6e 730a 2020 2020  eta.columns.    
+0003dd70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003dd80: 2020 2020 2020 6320 3d20 6d65 7461 2e6e        c = meta.n
+0003dd90: 616d 650a 2020 2020 2020 2020 7265 7475  ame.        retu
+0003dda0: 726e 205f 7265 6e61 6d65 2863 2c20 6466  rn _rename(c, df
+0003ddb0: 290a 2020 2020 7265 7475 726e 2064 660a  ).    return df.
+0003ddc0: 0a0a 6465 6620 5f72 656e 616d 6528 636f  ..def _rename(co
+0003ddd0: 6c75 6d6e 732c 2064 6629 3a0a 2020 2020  lumns, df):.    
+0003dde0: 2222 220a 2020 2020 5265 6e61 6d65 2063  """.    Rename c
+0003ddf0: 6f6c 756d 6e73 206f 6620 7064 2e44 6174  olumns of pd.Dat
+0003de00: 6146 7261 6d65 206f 7220 6e61 6d65 206f  aFrame or name o
+0003de10: 6620 7064 2e53 6572 6965 732e 0a20 2020  f pd.Series..   
+0003de20: 204e 6f74 2066 6f72 2064 642e 4461 7461   Not for dd.Data
+0003de30: 4672 616d 6520 6f72 2064 642e 5365 7269  Frame or dd.Seri
+0003de40: 6573 2e0a 0a20 2020 2050 6172 616d 6574  es...    Paramet
+0003de50: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+0003de60: 2d2d 0a20 2020 2063 6f6c 756d 6e73 203a  --.    columns :
+0003de70: 2074 7570 6c65 2c20 7374 7269 6e67 2c20   tuple, string, 
+0003de80: 7064 2e44 6174 6146 7261 6d65 206f 7220  pd.DataFrame or 
+0003de90: 7064 2e53 6572 6965 730a 2020 2020 2020  pd.Series.      
+0003dea0: 2020 436f 6c75 6d6e 206e 616d 6573 2c20    Column names, 
+0003deb0: 5365 7269 6573 206e 616d 6520 6f72 2070  Series name or p
+0003dec0: 616e 6461 7320 696e 7374 616e 6365 2077  andas instance w
+0003ded0: 6869 6368 2068 6173 2074 6865 0a20 2020  hich has the.   
+0003dee0: 2020 2020 2074 6172 6765 7420 636f 6c75       target colu
+0003def0: 6d6e 206e 616d 6573 202f 206e 616d 652e  mn names / name.
+0003df00: 0a20 2020 2064 6620 3a20 7064 2e44 6174  .    df : pd.Dat
+0003df10: 6146 7261 6d65 206f 7220 7064 2e53 6572  aFrame or pd.Ser
+0003df20: 6965 730a 2020 2020 2020 2020 7461 7267  ies.        targ
+0003df30: 6574 2044 6174 6146 7261 6d65 202f 2053  et DataFrame / S
+0003df40: 6572 6965 7320 746f 2062 6520 7265 6e61  eries to be rena
+0003df50: 6d65 640a 2020 2020 2222 220a 2020 2020  med.    """.    
+0003df60: 6173 7365 7274 206e 6f74 2069 7369 6e73  assert not isins
+0003df70: 7461 6e63 6528 6466 2c20 5f46 7261 6d65  tance(df, _Frame
+0003df80: 290a 0a20 2020 2069 6620 636f 6c75 6d6e  )..    if column
+0003df90: 7320 6973 206e 6f5f 6465 6661 756c 743a  s is no_default:
+0003dfa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003dfb0: 6466 0a0a 2020 2020 6966 2069 7369 6e73  df..    if isins
+0003dfc0: 7461 6e63 6528 636f 6c75 6d6e 732c 2049  tance(columns, I
+0003dfd0: 7465 7261 746f 7229 3a0a 2020 2020 2020  terator):.      
+0003dfe0: 2020 636f 6c75 6d6e 7320 3d20 6c69 7374    columns = list
+0003dff0: 2863 6f6c 756d 6e73 290a 0a20 2020 2069  (columns)..    i
+0003e000: 6620 6973 5f64 6174 6166 7261 6d65 5f6c  f is_dataframe_l
+0003e010: 696b 6528 6466 293a 0a20 2020 2020 2020  ike(df):.       
+0003e020: 2069 6620 6973 5f64 6174 6166 7261 6d65   if is_dataframe
+0003e030: 5f6c 696b 6528 636f 6c75 6d6e 7329 3a0a  _like(columns):.
+0003e040: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0003e050: 6d6e 7320 3d20 636f 6c75 6d6e 732e 636f  mns = columns.co
+0003e060: 6c75 6d6e 730a 2020 2020 2020 2020 6966  lumns.        if
+0003e070: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0003e080: 636f 6c75 6d6e 732c 2070 642e 496e 6465  columns, pd.Inde
+0003e090: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
+0003e0a0: 636f 6c75 6d6e 7320 3d20 7064 2e49 6e64  columns = pd.Ind
+0003e0b0: 6578 2863 6f6c 756d 6e73 290a 2020 2020  ex(columns).    
+0003e0c0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+0003e0d0: 2020 2020 206c 656e 2863 6f6c 756d 6e73       len(columns
+0003e0e0: 2920 3d3d 206c 656e 2864 662e 636f 6c75  ) == len(df.colu
+0003e0f0: 6d6e 7329 0a20 2020 2020 2020 2020 2020  mns).           
+0003e100: 2061 6e64 2074 7970 6528 636f 6c75 6d6e   and type(column
+0003e110: 7329 2069 7320 7479 7065 2864 662e 636f  s) is type(df.co
+0003e120: 6c75 6d6e 7329 0a20 2020 2020 2020 2020  lumns).         
+0003e130: 2020 2061 6e64 2063 6f6c 756d 6e73 2e64     and columns.d
+0003e140: 7479 7065 203d 3d20 6466 2e63 6f6c 756d  type == df.colum
+0003e150: 6e73 2e64 7479 7065 0a20 2020 2020 2020  ns.dtype.       
+0003e160: 2020 2020 2061 6e64 2063 6f6c 756d 6e73       and columns
+0003e170: 2e65 7175 616c 7328 6466 2e63 6f6c 756d  .equals(df.colum
+0003e180: 6e73 290a 2020 2020 2020 2020 293a 0a20  ns).        ):. 
+0003e190: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+0003e1a0: 7461 7267 6574 2069 7320 6964 656e 7469  target is identi
+0003e1b0: 6361 6c2c 2072 656e 616d 6520 6973 206e  cal, rename is n
+0003e1c0: 6f74 206e 6563 6573 7361 7279 0a20 2020  ot necessary.   
+0003e1d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003e1e0: 6466 0a20 2020 2020 2020 2023 2064 6565  df.        # dee
+0003e1f0: 703d 4661 6c73 6520 646f 6573 6e27 7420  p=False doesn't 
+0003e200: 646f 6573 6e27 7420 636f 7079 2061 6e79  doesn't copy any
+0003e210: 2064 6174 612f 696e 6469 6365 732c 2073   data/indices, s
+0003e220: 6f20 7468 6973 2069 7320 6368 6561 700a  o this is cheap.
+0003e230: 2020 2020 2020 2020 6466 203d 2064 662e          df = df.
+0003e240: 636f 7079 2864 6565 703d 4661 6c73 6529  copy(deep=False)
+0003e250: 0a20 2020 2020 2020 2064 662e 636f 6c75  .        df.colu
+0003e260: 6d6e 7320 3d20 636f 6c75 6d6e 730a 2020  mns = columns.  
+0003e270: 2020 2020 2020 7265 7475 726e 2064 660a        return df.
+0003e280: 2020 2020 656c 6966 2069 735f 7365 7269      elif is_seri
+0003e290: 6573 5f6c 696b 6528 6466 2920 6f72 2069  es_like(df) or i
+0003e2a0: 735f 696e 6465 785f 6c69 6b65 2864 6629  s_index_like(df)
+0003e2b0: 3a0a 2020 2020 2020 2020 6966 2069 735f  :.        if is_
+0003e2c0: 7365 7269 6573 5f6c 696b 6528 636f 6c75  series_like(colu
+0003e2d0: 6d6e 7329 206f 7220 6973 5f69 6e64 6578  mns) or is_index
+0003e2e0: 5f6c 696b 6528 636f 6c75 6d6e 7329 3a0a  _like(columns):.
+0003e2f0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+0003e300: 6d6e 7320 3d20 636f 6c75 6d6e 732e 6e61  mns = columns.na
+0003e310: 6d65 0a20 2020 2020 2020 2069 6620 6466  me.        if df
+0003e320: 2e6e 616d 6520 3d3d 2063 6f6c 756d 6e73  .name == columns
+0003e330: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0003e340: 7475 726e 2064 660a 2020 2020 2020 2020  turn df.        
+0003e350: 7265 7475 726e 2064 662e 7265 6e61 6d65  return df.rename
+0003e360: 2863 6f6c 756d 6e73 290a 2020 2020 2320  (columns).    # 
+0003e370: 6d61 705f 7061 7274 6974 696f 6e20 6d61  map_partition ma
+0003e380: 7920 7061 7373 206f 7468 6572 2074 7970  y pass other typ
+0003e390: 6573 0a20 2020 2072 6574 7572 6e20 6466  es.    return df
+0003e3a0: 0a0a 0a64 6566 205f 7265 6e61 6d65 5f64  ...def _rename_d
+0003e3b0: 6173 6b28 6466 2c20 6e61 6d65 7329 3a0a  ask(df, names):.
+0003e3c0: 2020 2020 2222 220a 2020 2020 4465 7374      """.    Dest
+0003e3d0: 7275 6374 6976 656c 7920 7265 6e61 6d65  ructively rename
+0003e3e0: 2063 6f6c 756d 6e73 206f 6620 6464 2e44   columns of dd.D
+0003e3f0: 6174 6146 7261 6d65 206f 7220 6e61 6d65  ataFrame or name
+0003e400: 206f 6620 6464 2e53 6572 6965 732e 0a20   of dd.Series.. 
+0003e410: 2020 204e 6f74 2066 6f72 2070 642e 4461     Not for pd.Da
+0003e420: 7461 4672 616d 6520 6f72 2070 642e 5365  taFrame or pd.Se
+0003e430: 7269 6573 2e0a 0a20 2020 2049 6e74 6572  ries...    Inter
+0003e440: 6e61 6c6c 7920 7573 6564 2074 6f20 6f76  nally used to ov
+0003e450: 6572 7772 6974 6520 6464 2e44 6174 6146  erwrite dd.DataF
+0003e460: 7261 6d65 2e63 6f6c 756d 6e73 2061 6e64  rame.columns and
+0003e470: 2064 642e 5365 7269 6573 2e6e 616d 650a   dd.Series.name.
+0003e480: 2020 2020 5765 2063 616e 2774 2075 7365      We can't use
+0003e490: 206d 6170 5f70 6172 7469 7469 6f6e 2062   map_partition b
+0003e4a0: 6563 6175 7365 2069 7420 6170 706c 6965  ecause it applie
+0003e4b0: 7320 6675 6e63 7469 6f6e 2074 6865 6e20  s function then 
+0003e4c0: 7265 6e61 6d65 0a0a 2020 2020 5061 7261  rename..    Para
+0003e4d0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+0003e4e0: 2d2d 2d2d 2d0a 2020 2020 6466 203a 2064  -----.    df : d
+0003e4f0: 642e 4461 7461 4672 616d 6520 6f72 2064  d.DataFrame or d
+0003e500: 642e 5365 7269 6573 0a20 2020 2020 2020  d.Series.       
+0003e510: 2074 6172 6765 7420 4461 7461 4672 616d   target DataFram
+0003e520: 6520 2f20 5365 7269 6573 2074 6f20 6265  e / Series to be
+0003e530: 2072 656e 616d 6564 0a20 2020 206e 616d   renamed.    nam
+0003e540: 6573 203a 2074 7570 6c65 2c20 7374 7269  es : tuple, stri
+0003e550: 6e67 0a20 2020 2020 2020 2043 6f6c 756d  ng.        Colum
+0003e560: 6e20 6e61 6d65 732f 5365 7269 6573 206e  n names/Series n
+0003e570: 616d 650a 2020 2020 2222 220a 0a20 2020  ame.    """..   
+0003e580: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+0003e590: 6365 2864 662c 205f 4672 616d 6529 0a20  ce(df, _Frame). 
+0003e5a0: 2020 206d 6574 6164 6174 6120 3d20 5f72     metadata = _r
+0003e5b0: 656e 616d 6528 6e61 6d65 732c 2064 662e  ename(names, df.
+0003e5c0: 5f6d 6574 6129 0a20 2020 206e 616d 6520  _meta).    name 
+0003e5d0: 3d20 6622 7265 6e61 6d65 2d7b 746f 6b65  = f"rename-{toke
+0003e5e0: 6e69 7a65 2864 662c 206d 6574 6164 6174  nize(df, metadat
+0003e5f0: 6129 7d22 0a0a 2020 2020 6473 6b20 3d20  a)}"..    dsk = 
+0003e600: 7061 7274 6974 696f 6e77 6973 655f 6772  partitionwise_gr
+0003e610: 6170 6828 5f72 656e 616d 652c 206e 616d  aph(_rename, nam
+0003e620: 652c 206d 6574 6164 6174 612c 2064 6629  e, metadata, df)
+0003e630: 0a20 2020 2067 7261 7068 203d 2048 6967  .    graph = Hig
+0003e640: 684c 6576 656c 4772 6170 682e 6672 6f6d  hLevelGraph.from
+0003e650: 5f63 6f6c 6c65 6374 696f 6e73 286e 616d  _collections(nam
+0003e660: 652c 2064 736b 2c20 6465 7065 6e64 656e  e, dsk, dependen
+0003e670: 6369 6573 3d5b 6466 5d29 0a20 2020 2072  cies=[df]).    r
+0003e680: 6574 7572 6e20 6e65 775f 6464 5f6f 626a  eturn new_dd_obj
+0003e690: 6563 7428 6772 6170 682c 206e 616d 652c  ect(graph, name,
+0003e6a0: 206d 6574 6164 6174 612c 2064 662e 6469   metadata, df.di
+0003e6b0: 7669 7369 6f6e 7329 0a0a 0a64 6566 2071  visions)...def q
+0003e6c0: 7561 6e74 696c 6528 6466 2c20 712c 206d  uantile(df, q, m
+0003e6d0: 6574 686f 643d 2264 6566 6175 6c74 2229  ethod="default")
+0003e6e0: 3a0a 2020 2020 2222 2241 7070 726f 7869  :.    """Approxi
+0003e6f0: 6d61 7465 2071 7561 6e74 696c 6573 206f  mate quantiles o
+0003e700: 6620 5365 7269 6573 2e0a 0a20 2020 2050  f Series...    P
+0003e710: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+0003e720: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2071 203a  --------.    q :
+0003e730: 206c 6973 742f 6172 7261 7920 6f66 2066   list/array of f
+0003e740: 6c6f 6174 730a 2020 2020 2020 2020 4974  loats.        It
+0003e750: 6572 6162 6c65 206f 6620 6e75 6d62 6572  erable of number
+0003e760: 7320 7261 6e67 696e 6720 6672 6f6d 2030  s ranging from 0
+0003e770: 2074 6f20 3130 3020 666f 7220 7468 6520   to 100 for the 
+0003e780: 6465 7369 7265 6420 7175 616e 7469 6c65  desired quantile
+0003e790: 730a 2020 2020 6d65 7468 6f64 203a 207b  s.    method : {
+0003e7a0: 2764 6566 6175 6c74 272c 2027 7464 6967  'default', 'tdig
+0003e7b0: 6573 7427 2c20 2764 6173 6b27 7d2c 206f  est', 'dask'}, o
+0003e7c0: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0003e7d0: 5768 6174 206d 6574 686f 6420 746f 2075  What method to u
+0003e7e0: 7365 2e20 4279 2064 6566 6175 6c74 2077  se. By default w
+0003e7f0: 696c 6c20 7573 6520 6461 736b 2773 2069  ill use dask's i
+0003e800: 6e74 6572 6e61 6c20 6375 7374 6f6d 0a20  nternal custom. 
+0003e810: 2020 2020 2020 2061 6c67 6f72 6974 686d         algorithm
+0003e820: 2028 6060 2764 6173 6b27 6060 292e 2020   (``'dask'``).  
+0003e830: 4966 2073 6574 2074 6f20 6060 2774 6469  If set to ``'tdi
+0003e840: 6765 7374 2760 6020 7769 6c6c 2075 7365  gest'`` will use
+0003e850: 2074 6469 6765 7374 2066 6f72 0a20 2020   tdigest for.   
+0003e860: 2020 2020 2066 6c6f 6174 7320 616e 6420       floats and 
+0003e870: 696e 7473 2061 6e64 2066 616c 6c62 6163  ints and fallbac
+0003e880: 6b20 746f 2074 6865 2060 6027 6461 736b  k to the ``'dask
+0003e890: 2760 6020 6f74 6865 7277 6973 652e 0a20  '`` otherwise.. 
+0003e8a0: 2020 2022 2222 0a20 2020 2023 2063 7572     """.    # cur
+0003e8b0: 7265 6e74 2069 6d70 6c65 6d65 6e74 6174  rent implementat
+0003e8c0: 696f 6e20 6e65 6564 7320 7120 746f 2062  ion needs q to b
+0003e8d0: 6520 736f 7274 6564 2073 6f0a 2020 2020  e sorted so.    
+0003e8e0: 2320 736f 7274 2069 6620 6172 7261 792d  # sort if array-
+0003e8f0: 6c69 6b65 2c20 6f74 6865 7277 6973 6520  like, otherwise 
+0003e900: 6c65 6176 6520 6974 2061 6c6f 6e65 0a20  leave it alone. 
+0003e910: 2020 2071 5f6e 6461 7272 6179 203d 206e     q_ndarray = n
+0003e920: 702e 6172 7261 7928 7129 0a20 2020 2069  p.array(q).    i
+0003e930: 6620 715f 6e64 6172 7261 792e 6e64 696d  f q_ndarray.ndim
+0003e940: 203e 2030 3a0a 2020 2020 2020 2020 715f   > 0:.        q_
+0003e950: 6e64 6172 7261 792e 736f 7274 286b 696e  ndarray.sort(kin
+0003e960: 643d 226d 6572 6765 736f 7274 2229 0a20  d="mergesort"). 
+0003e970: 2020 2020 2020 2071 203d 2071 5f6e 6461         q = q_nda
+0003e980: 7272 6179 0a0a 2020 2020 6173 7365 7274  rray..    assert
+0003e990: 2069 7369 6e73 7461 6e63 6528 6466 2c20   isinstance(df, 
+0003e9a0: 5365 7269 6573 290a 0a20 2020 2061 6c6c  Series)..    all
+0003e9b0: 6f77 6564 5f6d 6574 686f 6473 203d 205b  owed_methods = [
+0003e9c0: 2264 6566 6175 6c74 222c 2022 6461 736b  "default", "dask
+0003e9d0: 222c 2022 7464 6967 6573 7422 5d0a 2020  ", "tdigest"].  
+0003e9e0: 2020 6966 206d 6574 686f 6420 6e6f 7420    if method not 
+0003e9f0: 696e 2061 6c6c 6f77 6564 5f6d 6574 686f  in allowed_metho
+0003ea00: 6473 3a0a 2020 2020 2020 2020 7261 6973  ds:.        rais
+0003ea10: 6520 5661 6c75 6545 7272 6f72 2822 6d65  e ValueError("me
+0003ea20: 7468 6f64 2063 616e 206f 6e6c 7920 6265  thod can only be
+0003ea30: 2027 6465 6661 756c 7427 2c20 2764 6173   'default', 'das
+0003ea40: 6b27 206f 7220 2774 6469 6765 7374 2722  k' or 'tdigest'"
+0003ea50: 290a 0a20 2020 2069 6620 6d65 7468 6f64  )..    if method
+0003ea60: 203d 3d20 2264 6566 6175 6c74 223a 0a20   == "default":. 
+0003ea70: 2020 2020 2020 2069 6e74 6572 6e61 6c5f         internal_
+0003ea80: 6d65 7468 6f64 203d 2022 6461 736b 220a  method = "dask".
+0003ea90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003eaa0: 2020 696e 7465 726e 616c 5f6d 6574 686f    internal_metho
+0003eab0: 6420 3d20 6d65 7468 6f64 0a0a 2020 2020  d = method..    
+0003eac0: 2320 6375 7272 656e 746c 792c 206f 6e6c  # currently, onl
+0003ead0: 7920 5365 7269 6573 2068 6173 2071 7561  y Series has qua
+0003eae0: 6e74 696c 6520 6d65 7468 6f64 0a20 2020  ntile method.   
+0003eaf0: 2069 6620 6973 696e 7374 616e 6365 2864   if isinstance(d
+0003eb00: 662c 2049 6e64 6578 293a 0a20 2020 2020  f, Index):.     
+0003eb10: 2020 2073 6572 6965 735f 7479 7020 3d20     series_typ = 
+0003eb20: 6466 2e5f 6d65 7461 2e74 6f5f 7365 7269  df._meta.to_seri
+0003eb30: 6573 2829 2e5f 636f 6e73 7472 7563 746f  es()._constructo
+0003eb40: 720a 2020 2020 2020 2020 6d65 7461 203d  r.        meta =
+0003eb50: 2064 662e 5f6d 6574 615f 6e6f 6e65 6d70   df._meta_nonemp
+0003eb60: 7479 2e74 6f5f 7365 7269 6573 2829 2e71  ty.to_series().q
+0003eb70: 7561 6e74 696c 6528 7129 0a20 2020 2065  uantile(q).    e
+0003eb80: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
+0003eb90: 6973 5f73 6572 6965 735f 6c69 6b65 2864  is_series_like(d
+0003eba0: 662e 5f6d 6574 6129 3a0a 2020 2020 2020  f._meta):.      
+0003ebb0: 2020 2020 2020 7365 7269 6573 5f74 7970        series_typ
+0003ebc0: 203d 2064 662e 5f6d 6574 612e 5f63 6f6e   = df._meta._con
+0003ebd0: 7374 7275 6374 6f72 0a20 2020 2020 2020  structor.       
+0003ebe0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003ebf0: 2020 2073 6572 6965 735f 7479 7020 3d20     series_typ = 
+0003ec00: 6466 2e5f 6d65 7461 2e5f 636f 6e73 7472  df._meta._constr
+0003ec10: 7563 746f 725f 736c 6963 6564 0a20 2020  uctor_sliced.   
+0003ec20: 2020 2020 206d 6574 6120 3d20 6466 2e5f       meta = df._
+0003ec30: 6d65 7461 5f6e 6f6e 656d 7074 792e 7175  meta_nonempty.qu
+0003ec40: 616e 7469 6c65 2871 290a 0a20 2020 2069  antile(q)..    i
+0003ec50: 6620 6973 5f73 6572 6965 735f 6c69 6b65  f is_series_like
+0003ec60: 286d 6574 6129 3a0a 2020 2020 2020 2020  (meta):.        
+0003ec70: 2320 496e 6465 782e 7175 616e 7469 6c65  # Index.quantile
+0003ec80: 286c 6973 742d 6c69 6b65 2920 6d75 7374  (list-like) must
+0003ec90: 2062 6520 7064 2e53 6572 6965 732c 206e   be pd.Series, n
+0003eca0: 6f74 2070 642e 496e 6465 780a 2020 2020  ot pd.Index.    
+0003ecb0: 2020 2020 6466 5f6e 616d 6520 3d20 6466      df_name = df
+0003ecc0: 2e6e 616d 650a 2020 2020 2020 2020 6669  .name.        fi
+0003ecd0: 6e61 6c69 7a65 5f74 736b 203d 206c 616d  nalize_tsk = lam
+0003ece0: 6264 6120 7473 6b3a 2028 7365 7269 6573  bda tsk: (series
+0003ecf0: 5f74 7970 2c20 7473 6b2c 2071 2c20 4e6f  _typ, tsk, q, No
+0003ed00: 6e65 2c20 6466 5f6e 616d 6529 0a20 2020  ne, df_name).   
+0003ed10: 2020 2020 2072 6574 7572 6e5f 7479 7065       return_type
+0003ed20: 203d 2053 6572 6965 730a 2020 2020 656c   = Series.    el
+0003ed30: 7365 3a0a 2020 2020 2020 2020 2320 7265  se:.        # re
+0003ed40: 7061 636b 2061 7320 5365 7269 6573 206f  pack as Series o
+0003ed50: 626a 6563 7420 746f 2063 6f6e 7665 7274  bject to convert
+0003ed60: 2073 6361 6c61 7273 2066 726f 6d20 4e75   scalars from Nu
+0003ed70: 6d50 7920 6261 636b 2062 6566 6f72 6520  mPy back before 
+0003ed80: 6578 7472 6163 7469 6e67 0a20 2020 2020  extracting.     
+0003ed90: 2020 2066 696e 616c 697a 655f 7473 6b20     finalize_tsk 
+0003eda0: 3d20 6c61 6d62 6461 2074 736b 3a20 280a  = lambda tsk: (.
+0003edb0: 2020 2020 2020 2020 2020 2020 6c61 6d62              lamb
+0003edc0: 6461 202a 6172 6773 2c20 2a2a 6b77 6172  da *args, **kwar
+0003edd0: 6773 3a20 7365 7269 6573 5f74 7970 282a  gs: series_typ(*
+0003ede0: 6172 6773 2c20 2a2a 6b77 6172 6773 295b  args, **kwargs)[
+0003edf0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+0003ee00: 7473 6b2c 0a20 2020 2020 2020 2020 2020  tsk,.           
+0003ee10: 205b 305d 2c0a 2020 2020 2020 2020 290a   [0],.        ).
+0003ee20: 2020 2020 2020 2020 7265 7475 726e 5f74          return_t
+0003ee30: 7970 6520 3d20 5363 616c 6172 0a20 2020  ype = Scalar.   
+0003ee40: 2020 2020 2071 203d 205b 715d 0a0a 2020       q = [q]..  
+0003ee50: 2020 2320 7061 6e64 6173 2075 7365 7320    # pandas uses 
+0003ee60: 7175 616e 7469 6c65 2069 6e20 5b30 2c20  quantile in [0, 
+0003ee70: 315d 0a20 2020 2023 206e 756d 7079 202f  1].    # numpy /
+0003ee80: 2065 7665 7279 6f6e 6520 656c 7365 2075   everyone else u
+0003ee90: 7365 7320 5b30 2c20 3130 305d 0a20 2020  ses [0, 100].   
+0003eea0: 2071 7320 3d20 6e70 2e61 7361 7272 6179   qs = np.asarray
+0003eeb0: 2871 2920 2a20 3130 300a 2020 2020 746f  (q) * 100.    to
+0003eec0: 6b65 6e20 3d20 746f 6b65 6e69 7a65 2864  ken = tokenize(d
+0003eed0: 662c 2071 7329 0a0a 2020 2020 6966 206c  f, qs)..    if l
+0003eee0: 656e 2871 7329 203d 3d20 303a 0a20 2020  en(qs) == 0:.   
+0003eef0: 2020 2020 206e 616d 6520 3d20 2271 7561       name = "qua
+0003ef00: 6e74 696c 6573 2d22 202b 2074 6f6b 656e  ntiles-" + token
+0003ef10: 0a20 2020 2020 2020 2065 6d70 7479 5f69  .        empty_i
+0003ef20: 6e64 6578 203d 2070 642e 496e 6465 7828  ndex = pd.Index(
+0003ef30: 5b5d 2c20 6474 7970 653d 666c 6f61 7429  [], dtype=float)
+0003ef40: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003ef50: 2053 6572 6965 7328 0a20 2020 2020 2020   Series(.       
+0003ef60: 2020 2020 207b 286e 616d 652c 2030 293a       {(name, 0):
+0003ef70: 2073 6572 6965 735f 7479 7028 5b5d 2c20   series_typ([], 
+0003ef80: 6e61 6d65 3d64 662e 6e61 6d65 2c20 696e  name=df.name, in
+0003ef90: 6465 783d 656d 7074 795f 696e 6465 782c  dex=empty_index,
+0003efa0: 2064 7479 7065 3d22 666c 6f61 7422 297d   dtype="float")}
+0003efb0: 2c0a 2020 2020 2020 2020 2020 2020 6e61  ,.            na
+0003efc0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+0003efd0: 6466 2e5f 6d65 7461 2c0a 2020 2020 2020  df._meta,.      
+0003efe0: 2020 2020 2020 5b4e 6f6e 652c 204e 6f6e        [None, Non
+0003eff0: 655d 2c0a 2020 2020 2020 2020 290a 2020  e],.        ).  
+0003f000: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003f010: 6e65 775f 6469 7669 7369 6f6e 7320 3d20  new_divisions = 
+0003f020: 5b6e 702e 6d69 6e28 7129 2c20 6e70 2e6d  [np.min(q), np.m
+0003f030: 6178 2871 295d 0a0a 2020 2020 6466 203d  ax(q)]..    df =
+0003f040: 2064 662e 6472 6f70 6e61 2829 0a0a 2020   df.dropna()..  
+0003f050: 2020 6966 2069 6e74 6572 6e61 6c5f 6d65    if internal_me
+0003f060: 7468 6f64 203d 3d20 2274 6469 6765 7374  thod == "tdigest
+0003f070: 2220 616e 6420 280a 2020 2020 2020 2020  " and (.        
+0003f080: 6e70 2e69 7373 7562 6474 7970 6528 6466  np.issubdtype(df
+0003f090: 2e64 7479 7065 2c20 6e70 2e66 6c6f 6174  .dtype, np.float
+0003f0a0: 696e 6729 206f 7220 6e70 2e69 7373 7562  ing) or np.issub
+0003f0b0: 6474 7970 6528 6466 2e64 7479 7065 2c20  dtype(df.dtype, 
+0003f0c0: 6e70 2e69 6e74 6567 6572 290a 2020 2020  np.integer).    
+0003f0d0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+0003f0e0: 6461 736b 2e75 7469 6c73 2069 6d70 6f72  dask.utils impor
+0003f0f0: 7420 696d 706f 7274 5f72 6571 7569 7265  t import_require
+0003f100: 640a 0a20 2020 2020 2020 2069 6d70 6f72  d..        impor
+0003f110: 745f 7265 7175 6972 6564 280a 2020 2020  t_required(.    
+0003f120: 2020 2020 2020 2020 2263 7269 636b 222c          "crick",
+0003f130: 2022 6372 6963 6b20 6973 2061 2072 6571   "crick is a req
+0003f140: 7569 7265 6420 6465 7065 6e64 656e 6379  uired dependency
+0003f150: 2066 6f72 2075 7369 6e67 2074 6865 2074   for using the t
+0003f160: 2d64 6967 6573 7420 6d65 7468 6f64 2e22  -digest method."
+0003f170: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0003f180: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+0003f190: 7261 792e 7065 7263 656e 7469 6c65 2069  ray.percentile i
+0003f1a0: 6d70 6f72 7420 5f70 6572 6365 6e74 696c  mport _percentil
+0003f1b0: 6573 5f66 726f 6d5f 7464 6967 6573 742c  es_from_tdigest,
+0003f1c0: 205f 7464 6967 6573 745f 6368 756e 6b0a   _tdigest_chunk.
+0003f1d0: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
+0003f1e0: 2271 7561 6e74 696c 6573 5f74 6469 6765  "quantiles_tdige
+0003f1f0: 7374 2d31 2d22 202b 2074 6f6b 656e 0a20  st-1-" + token. 
+0003f200: 2020 2020 2020 2076 616c 5f64 736b 203d         val_dsk =
+0003f210: 207b 0a20 2020 2020 2020 2020 2020 2028   {.            (
+0003f220: 6e61 6d65 2c20 6929 3a20 285f 7464 6967  name, i): (_tdig
+0003f230: 6573 745f 6368 756e 6b2c 2028 6765 7461  est_chunk, (geta
+0003f240: 7474 722c 206b 6579 2c20 2276 616c 7565  ttr, key, "value
+0003f250: 7322 2929 0a20 2020 2020 2020 2020 2020  s")).           
+0003f260: 2066 6f72 2069 2c20 6b65 7920 696e 2065   for i, key in e
+0003f270: 6e75 6d65 7261 7465 2864 662e 5f5f 6461  numerate(df.__da
+0003f280: 736b 5f6b 6579 735f 5f28 2929 0a20 2020  sk_keys__()).   
+0003f290: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0003f2a0: 6e61 6d65 3220 3d20 2271 7561 6e74 696c  name2 = "quantil
+0003f2b0: 6573 5f74 6469 6765 7374 2d32 2d22 202b  es_tdigest-2-" +
+0003f2c0: 2074 6f6b 656e 0a20 2020 2020 2020 206d   token.        m
+0003f2d0: 6572 6765 5f64 736b 203d 207b 0a20 2020  erge_dsk = {.   
+0003f2e0: 2020 2020 2020 2020 2028 6e61 6d65 322c           (name2,
+0003f2f0: 2030 293a 2066 696e 616c 697a 655f 7473   0): finalize_ts
+0003f300: 6b28 285f 7065 7263 656e 7469 6c65 735f  k((_percentiles_
+0003f310: 6672 6f6d 5f74 6469 6765 7374 2c20 7173  from_tdigest, qs
+0003f320: 2c20 736f 7274 6564 2876 616c 5f64 736b  , sorted(val_dsk
+0003f330: 2929 290a 2020 2020 2020 2020 7d0a 2020  ))).        }.  
+0003f340: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003f350: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+0003f360: 6469 7370 6174 6368 2069 6d70 6f72 7420  dispatch import 
+0003f370: 7065 7263 656e 7469 6c65 5f6c 6f6f 6b75  percentile_looku
+0003f380: 7020 6173 205f 7065 7263 656e 7469 6c65  p as _percentile
+0003f390: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+0003f3a0: 736b 2e61 7272 6179 2e70 6572 6365 6e74  sk.array.percent
+0003f3b0: 696c 6520 696d 706f 7274 206d 6572 6765  ile import merge
+0003f3c0: 5f70 6572 6365 6e74 696c 6573 0a0a 2020  _percentiles..  
+0003f3d0: 2020 2020 2020 2320 4164 6420 3020 616e        # Add 0 an
+0003f3e0: 6420 3130 3020 6475 7269 6e67 2063 616c  d 100 during cal
+0003f3f0: 6375 6c61 7469 6f6e 2066 6f72 206d 6f72  culation for mor
+0003f400: 6520 726f 6275 7374 2062 6568 6176 696f  e robust behavio
+0003f410: 7220 2868 6f70 6566 756c 6c79 290a 2020  r (hopefully).  
+0003f420: 2020 2020 2020 6361 6c63 5f71 7320 3d20        calc_qs = 
+0003f430: 6e70 2e70 6164 2871 732c 2031 2c20 6d6f  np.pad(qs, 1, mo
+0003f440: 6465 3d22 636f 6e73 7461 6e74 2229 0a20  de="constant"). 
+0003f450: 2020 2020 2020 2063 616c 635f 7173 5b2d         calc_qs[-
+0003f460: 315d 203d 2031 3030 0a20 2020 2020 2020  1] = 100.       
+0003f470: 206e 616d 6520 3d20 2271 7561 6e74 696c   name = "quantil
+0003f480: 6573 2d31 2d22 202b 2074 6f6b 656e 0a20  es-1-" + token. 
+0003f490: 2020 2020 2020 2076 616c 5f64 736b 203d         val_dsk =
+0003f4a0: 207b 0a20 2020 2020 2020 2020 2020 2028   {.            (
+0003f4b0: 6e61 6d65 2c20 6929 3a20 285f 7065 7263  name, i): (_perc
+0003f4c0: 656e 7469 6c65 2c20 6b65 792c 2063 616c  entile, key, cal
+0003f4d0: 635f 7173 290a 2020 2020 2020 2020 2020  c_qs).          
+0003f4e0: 2020 666f 7220 692c 206b 6579 2069 6e20    for i, key in 
+0003f4f0: 656e 756d 6572 6174 6528 6466 2e5f 5f64  enumerate(df.__d
+0003f500: 6173 6b5f 6b65 7973 5f5f 2829 290a 2020  ask_keys__()).  
+0003f510: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+0003f520: 206e 616d 6532 203d 2022 7175 616e 7469   name2 = "quanti
+0003f530: 6c65 732d 322d 2220 2b20 746f 6b65 6e0a  les-2-" + token.
+0003f540: 2020 2020 2020 2020 6d65 7267 655f 6473          merge_ds
+0003f550: 6b20 3d20 7b0a 2020 2020 2020 2020 2020  k = {.          
+0003f560: 2020 286e 616d 6532 2c20 3029 3a20 6669    (name2, 0): fi
+0003f570: 6e61 6c69 7a65 5f74 736b 280a 2020 2020  nalize_tsk(.    
+0003f580: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
+0003f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f5a0: 2020 6d65 7267 655f 7065 7263 656e 7469    merge_percenti
+0003f5b0: 6c65 732c 0a20 2020 2020 2020 2020 2020  les,.           
+0003f5c0: 2020 2020 2020 2020 2071 732c 0a20 2020           qs,.   
+0003f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f5e0: 205b 6361 6c63 5f71 735d 202a 2064 662e   [calc_qs] * df.
+0003f5f0: 6e70 6172 7469 7469 6f6e 732c 0a20 2020  npartitions,.   
+0003f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f610: 2073 6f72 7465 6428 7661 6c5f 6473 6b29   sorted(val_dsk)
+0003f620: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0003f630: 2020 2020 2020 226c 6f77 6572 222c 0a20        "lower",. 
+0003f640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f650: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
+0003f660: 2020 2020 2020 2020 2020 2020 2046 616c               Fal
+0003f670: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0003f680: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0003f690: 2020 290a 2020 2020 2020 2020 7d0a 2020    ).        }.  
+0003f6a0: 2020 6473 6b20 3d20 6d65 7267 6528 7661    dsk = merge(va
+0003f6b0: 6c5f 6473 6b2c 206d 6572 6765 5f64 736b  l_dsk, merge_dsk
+0003f6c0: 290a 2020 2020 6772 6170 6820 3d20 4869  ).    graph = Hi
+0003f6d0: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
+0003f6e0: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6e61  m_collections(na
+0003f6f0: 6d65 322c 2064 736b 2c20 6465 7065 6e64  me2, dsk, depend
+0003f700: 656e 6369 6573 3d5b 6466 5d29 0a20 2020  encies=[df]).   
+0003f710: 2072 6574 7572 6e20 7265 7475 726e 5f74   return return_t
+0003f720: 7970 6528 6772 6170 682c 206e 616d 6532  ype(graph, name2
+0003f730: 2c20 6d65 7461 2c20 6e65 775f 6469 7669  , meta, new_divi
+0003f740: 7369 6f6e 7329 0a0a 0a64 6566 205f 636f  sions)...def _co
+0003f750: 765f 636f 7272 280a 2020 2020 6466 2c0a  v_corr(.    df,.
+0003f760: 2020 2020 6d69 6e5f 7065 7269 6f64 733d      min_periods=
+0003f770: 4e6f 6e65 2c0a 2020 2020 636f 7272 3d46  None,.    corr=F
+0003f780: 616c 7365 2c0a 2020 2020 7363 616c 6172  alse,.    scalar
+0003f790: 3d46 616c 7365 2c0a 2020 2020 6e75 6d65  =False,.    nume
+0003f7a0: 7269 635f 6f6e 6c79 3d6e 6f5f 6465 6661  ric_only=no_defa
+0003f7b0: 756c 742c 0a20 2020 2073 706c 6974 5f65  ult,.    split_e
+0003f7c0: 7665 7279 3d46 616c 7365 2c0a 293a 0a20  very=False,.):. 
+0003f7d0: 2020 2022 2222 4461 7461 4672 616d 6520     """DataFrame 
+0003f7e0: 636f 7661 7269 616e 6365 2061 6e64 2070  covariance and p
+0003f7f0: 6561 7273 6f6e 2063 6f72 7265 6c61 7469  earson correlati
+0003f800: 6f6e 2e0a 0a20 2020 2043 6f6d 7075 7465  on...    Compute
+0003f810: 7320 7061 6972 7769 7365 2063 6f76 6172  s pairwise covar
+0003f820: 6961 6e63 6520 6f72 2063 6f72 7265 6c61  iance or correla
+0003f830: 7469 6f6e 206f 6620 636f 6c75 6d6e 732c  tion of columns,
+0003f840: 2065 7863 6c75 6469 6e67 204e 412f 6e75   excluding NA/nu
+0003f850: 6c6c 0a20 2020 2076 616c 7565 732e 0a0a  ll.    values...
+0003f860: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0003f870: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0003f880: 2020 6466 203a 2044 6174 6146 7261 6d65    df : DataFrame
+0003f890: 0a20 2020 206d 696e 5f70 6572 696f 6473  .    min_periods
+0003f8a0: 203a 2069 6e74 2c20 6f70 7469 6f6e 616c   : int, optional
+0003f8b0: 0a20 2020 2020 2020 204d 696e 696d 756d  .        Minimum
+0003f8c0: 206e 756d 6265 7220 6f66 206f 6273 6572   number of obser
+0003f8d0: 7661 7469 6f6e 7320 7265 7175 6972 6564  vations required
+0003f8e0: 2070 6572 2070 6169 7220 6f66 2063 6f6c   per pair of col
+0003f8f0: 756d 6e73 0a20 2020 2020 2020 2074 6f20  umns.        to 
+0003f900: 6861 7665 2061 2076 616c 6964 2072 6573  have a valid res
+0003f910: 756c 742e 0a20 2020 2063 6f72 7220 3a20  ult..    corr : 
+0003f920: 626f 6f6c 2c20 6f70 7469 6f6e 616c 0a20  bool, optional. 
+0003f930: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+0003f940: 636f 6d70 7574 6520 7468 6520 5065 6172  compute the Pear
+0003f950: 736f 6e20 636f 7272 656c 6174 696f 6e2e  son correlation.
+0003f960: 2049 6620 4661 6c73 6520 5b64 6566 6175   If False [defau
+0003f970: 6c74 5d2c 2063 6f6d 7075 7465 0a20 2020  lt], compute.   
+0003f980: 2020 2020 2074 6865 2063 6f76 6172 6961       the covaria
+0003f990: 6e63 652e 0a20 2020 2073 6361 6c61 7220  nce..    scalar 
+0003f9a0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
+0003f9b0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
+0003f9c0: 2c20 636f 6d70 7574 6520 636f 7661 7269  , compute covari
+0003f9d0: 616e 6365 2062 6574 7765 656e 2074 776f  ance between two
+0003f9e0: 2076 6172 6961 626c 6573 2061 7320 6120   variables as a 
+0003f9f0: 7363 616c 6172 2e20 4f6e 6c79 0a20 2020  scalar. Only.   
+0003fa00: 2020 2020 2076 616c 6964 2069 6620 6064       valid if `d
+0003fa10: 6660 2068 6173 2032 2063 6f6c 756d 6e73  f` has 2 columns
+0003fa20: 2e20 2049 6620 4661 6c73 6520 5b64 6566  .  If False [def
+0003fa30: 6175 6c74 5d2c 2063 6f6d 7075 7465 2074  ault], compute t
+0003fa40: 6865 2065 6e74 6972 650a 2020 2020 2020  he entire.      
+0003fa50: 2020 636f 7661 7269 616e 6365 2f63 6f72    covariance/cor
+0003fa60: 7265 6c61 7469 6f6e 206d 6174 7269 782e  relation matrix.
+0003fa70: 0a20 2020 2073 706c 6974 5f65 7665 7279  .    split_every
+0003fa80: 203a 2069 6e74 2c20 6f70 7469 6f6e 616c   : int, optional
+0003fa90: 0a20 2020 2020 2020 2047 726f 7570 2070  .        Group p
+0003faa0: 6172 7469 7469 6f6e 7320 696e 746f 2067  artitions into g
+0003fab0: 726f 7570 7320 6f66 2074 6869 7320 7369  roups of this si
+0003fac0: 7a65 2077 6869 6c65 2070 6572 666f 726d  ze while perform
+0003fad0: 696e 6720 610a 2020 2020 2020 2020 7472  ing a.        tr
+0003fae0: 6565 2d72 6564 7563 7469 6f6e 2e20 4966  ee-reduction. If
+0003faf0: 2073 6574 2074 6f20 4661 6c73 652c 206e   set to False, n
+0003fb00: 6f20 7472 6565 2d72 6564 7563 7469 6f6e  o tree-reduction
+0003fb10: 2077 696c 6c20 6265 2075 7365 642e 0a20   will be used.. 
+0003fb20: 2020 2020 2020 2044 6566 6175 6c74 2069         Default i
+0003fb30: 7320 4661 6c73 652e 0a20 2020 2022 2222  s False..    """
+0003fb40: 0a20 2020 2069 6620 6d69 6e5f 7065 7269  .    if min_peri
+0003fb50: 6f64 7320 6973 204e 6f6e 653a 0a20 2020  ods is None:.   
+0003fb60: 2020 2020 206d 696e 5f70 6572 696f 6473       min_periods
+0003fb70: 203d 2032 0a20 2020 2065 6c69 6620 6d69   = 2.    elif mi
+0003fb80: 6e5f 7065 7269 6f64 7320 3c20 323a 0a20  n_periods < 2:. 
+0003fb90: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0003fba0: 7565 4572 726f 7228 226d 696e 5f70 6572  ueError("min_per
+0003fbb0: 696f 6473 206d 7573 7420 6265 203e 3d20  iods must be >= 
+0003fbc0: 3222 290a 0a20 2020 2069 6620 7370 6c69  2")..    if spli
+0003fbd0: 745f 6576 6572 7920 6973 2046 616c 7365  t_every is False
+0003fbe0: 3a0a 2020 2020 2020 2020 7370 6c69 745f  :.        split_
+0003fbf0: 6576 6572 7920 3d20 6466 2e6e 7061 7274  every = df.npart
+0003fc00: 6974 696f 6e73 0a20 2020 2065 6c69 6620  itions.    elif 
+0003fc10: 7370 6c69 745f 6576 6572 7920 3c20 3220  split_every < 2 
+0003fc20: 6f72 206e 6f74 2069 7369 6e73 7461 6e63  or not isinstanc
+0003fc30: 6528 7370 6c69 745f 6576 6572 792c 2049  e(split_every, I
+0003fc40: 6e74 6567 7261 6c29 3a0a 2020 2020 2020  ntegral):.      
+0003fc50: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0003fc60: 6f72 2822 7370 6c69 745f 6576 6572 7920  or("split_every 
+0003fc70: 6d75 7374 2062 6520 616e 2069 6e74 6567  must be an integ
+0003fc80: 6572 203e 3d20 3222 290a 0a20 2020 2023  er >= 2")..    #
+0003fc90: 2048 616e 646c 6520 7365 6c65 6374 696e   Handle selectin
+0003fca0: 6720 6e75 6d65 7269 6320 6461 7461 2061  g numeric data a
+0003fcb0: 6e64 2061 7373 6f63 6961 7465 6420 6465  nd associated de
+0003fcc0: 7072 6563 6174 696f 6e20 7761 726e 696e  precation warnin
+0003fcd0: 670a 2020 2020 6d61 7962 655f 7761 726e  g.    maybe_warn
+0003fce0: 203d 2046 616c 7365 0a20 2020 2069 6620   = False.    if 
+0003fcf0: 6e75 6d65 7269 635f 6f6e 6c79 2069 7320  numeric_only is 
+0003fd00: 6e6f 5f64 6566 6175 6c74 3a0a 2020 2020  no_default:.    
+0003fd10: 2020 2020 6966 2050 414e 4441 535f 4754      if PANDAS_GT
+0003fd20: 5f32 3030 3a0a 2020 2020 2020 2020 2020  _200:.          
+0003fd30: 2020 6e75 6d65 7269 635f 6f6e 6c79 203d    numeric_only =
+0003fd40: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+0003fd50: 6c69 6620 5041 4e44 4153 5f47 545f 3135  lif PANDAS_GT_15
+0003fd60: 303a 0a20 2020 2020 2020 2020 2020 206d  0:.            m
+0003fd70: 6179 6265 5f77 6172 6e20 3d20 5472 7565  aybe_warn = True
+0003fd80: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0003fd90: 6572 6963 5f6f 6e6c 7920 3d20 5472 7565  eric_only = True
+0003fda0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0003fdb0: 2020 2020 2020 2020 2020 206e 756d 6572             numer
+0003fdc0: 6963 5f6f 6e6c 7920 3d20 5472 7565 0a0a  ic_only = True..
+0003fdd0: 2020 2020 616c 6c5f 6e75 6d65 7269 6320      all_numeric 
+0003fde0: 3d20 6466 2e5f 6765 745f 6e75 6d65 7269  = df._get_numeri
+0003fdf0: 635f 6461 7461 2829 2e5f 6e61 6d65 203d  c_data()._name =
+0003fe00: 3d20 6466 2e5f 6e61 6d65 0a20 2020 2069  = df._name.    i
+0003fe10: 6620 6d61 7962 655f 7761 726e 2061 6e64  f maybe_warn and
+0003fe20: 206e 6f74 2061 6c6c 5f6e 756d 6572 6963   not all_numeric
+0003fe30: 3a0a 2020 2020 2020 2020 7761 726e 696e  :.        warnin
+0003fe40: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+0003fe50: 2020 2020 2022 5468 6520 6465 6661 756c       "The defaul
+0003fe60: 7420 7661 6c75 6520 6f66 206e 756d 6572  t value of numer
+0003fe70: 6963 5f6f 6e6c 7920 7769 6c6c 2062 6520  ic_only will be 
+0003fe80: 6046 616c 7365 6020 220a 2020 2020 2020  `False` ".      
+0003fe90: 2020 2020 2020 2269 6e20 6120 6675 7475        "in a futu
+0003fea0: 7265 2076 6572 7369 6f6e 206f 6620 4461  re version of Da
+0003feb0: 736b 2e22 2c0a 2020 2020 2020 2020 2020  sk.",.          
+0003fec0: 2020 4675 7475 7265 5761 726e 696e 672c    FutureWarning,
+0003fed0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0003fee0: 6966 206e 756d 6572 6963 5f6f 6e6c 7920  if numeric_only 
+0003fef0: 616e 6420 6e6f 7420 616c 6c5f 6e75 6d65  and not all_nume
+0003ff00: 7269 633a 0a20 2020 2020 2020 2064 6620  ric:.        df 
+0003ff10: 3d20 6466 2e5f 6765 745f 6e75 6d65 7269  = df._get_numeri
+0003ff20: 635f 6461 7461 2829 0a0a 2020 2020 6966  c_data()..    if
+0003ff30: 2073 6361 6c61 7220 616e 6420 6c65 6e28   scalar and len(
+0003ff40: 6466 2e63 6f6c 756d 6e73 2920 213d 2032  df.columns) != 2
+0003ff50: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+0003ff60: 5661 6c75 6545 7272 6f72 2822 7363 616c  ValueError("scal
+0003ff70: 6172 206f 6e6c 7920 7661 6c69 6420 666f  ar only valid fo
+0003ff80: 7220 3220 636f 6c75 6d6e 2064 6174 6166  r 2 column dataf
+0003ff90: 7261 6d65 2229 0a0a 2020 2020 746f 6b65  rame")..    toke
+0003ffa0: 6e20 3d20 746f 6b65 6e69 7a65 2864 662c  n = tokenize(df,
+0003ffb0: 206d 696e 5f70 6572 696f 6473 2c20 7363   min_periods, sc
+0003ffc0: 616c 6172 2c20 7370 6c69 745f 6576 6572  alar, split_ever
+0003ffd0: 7929 0a0a 2020 2020 6675 6e63 6e61 6d65  y)..    funcname
+0003ffe0: 203d 2022 636f 7272 2220 6966 2063 6f72   = "corr" if cor
+0003fff0: 7220 656c 7365 2022 636f 7622 0a20 2020  r else "cov".   
+00040000: 2061 203d 2066 227b 6675 6e63 6e61 6d65   a = f"{funcname
+00040010: 7d2d 6368 756e 6b2d 7b64 662e 5f6e 616d  }-chunk-{df._nam
+00040020: 657d 220a 2020 2020 6473 6b20 3d20 7b0a  e}".    dsk = {.
+00040030: 2020 2020 2020 2020 2861 2c20 6929 3a20          (a, i): 
+00040040: 285f 636f 765f 636f 7272 5f63 6875 6e6b  (_cov_corr_chunk
+00040050: 2c20 662c 2063 6f72 7229 2066 6f72 2028  , f, corr) for (
+00040060: 692c 2066 2920 696e 2065 6e75 6d65 7261  i, f) in enumera
+00040070: 7465 2864 662e 5f5f 6461 736b 5f6b 6579  te(df.__dask_key
+00040080: 735f 5f28 2929 0a20 2020 207d 0a0a 2020  s__()).    }..  
+00040090: 2020 7072 6566 6978 203d 2066 227b 6675    prefix = f"{fu
+000400a0: 6e63 6e61 6d65 7d2d 636f 6d62 696e 652d  ncname}-combine-
+000400b0: 7b64 662e 5f6e 616d 657d 2d22 0a20 2020  {df._name}-".   
+000400c0: 206b 203d 2064 662e 6e70 6172 7469 7469   k = df.npartiti
+000400d0: 6f6e 730a 2020 2020 6220 3d20 610a 2020  ons.    b = a.  
+000400e0: 2020 6465 7074 6820 3d20 300a 2020 2020    depth = 0.    
+000400f0: 7768 696c 6520 6b20 3e20 7370 6c69 745f  while k > split_
+00040100: 6576 6572 793a 0a20 2020 2020 2020 2062  every:.        b
+00040110: 203d 2070 7265 6669 7820 2b20 7374 7228   = prefix + str(
+00040120: 6465 7074 6829 0a20 2020 2020 2020 2066  depth).        f
+00040130: 6f72 2070 6172 745f 692c 2069 6e64 7320  or part_i, inds 
+00040140: 696e 2065 6e75 6d65 7261 7465 2870 6172  in enumerate(par
+00040150: 7469 7469 6f6e 5f61 6c6c 2873 706c 6974  tition_all(split
+00040160: 5f65 7665 7279 2c20 7261 6e67 6528 6b29  _every, range(k)
+00040170: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00040180: 6473 6b5b 2862 2c20 7061 7274 5f69 295d  dsk[(b, part_i)]
+00040190: 203d 2028 5f63 6f76 5f63 6f72 725f 636f   = (_cov_corr_co
+000401a0: 6d62 696e 652c 205b 2861 2c20 6929 2066  mbine, [(a, i) f
+000401b0: 6f72 2069 2069 6e20 696e 6473 5d2c 2063  or i in inds], c
+000401c0: 6f72 7229 0a20 2020 2020 2020 206b 203d  orr).        k =
+000401d0: 2070 6172 745f 6920 2b20 310a 2020 2020   part_i + 1.    
+000401e0: 2020 2020 6120 3d20 620a 2020 2020 2020      a = b.      
+000401f0: 2020 6465 7074 6820 2b3d 2031 0a0a 2020    depth += 1..  
+00040200: 2020 6e61 6d65 203d 2066 227b 6675 6e63    name = f"{func
+00040210: 6e61 6d65 7d2d 7b74 6f6b 656e 7d22 0a20  name}-{token}". 
+00040220: 2020 2064 736b 5b28 6e61 6d65 2c20 3029     dsk[(name, 0)
+00040230: 5d20 3d20 280a 2020 2020 2020 2020 5f63  ] = (.        _c
+00040240: 6f76 5f63 6f72 725f 6167 672c 0a20 2020  ov_corr_agg,.   
+00040250: 2020 2020 205b 2861 2c20 6929 2066 6f72       [(a, i) for
+00040260: 2069 2069 6e20 7261 6e67 6528 6b29 5d2c   i in range(k)],
+00040270: 0a20 2020 2020 2020 2064 662e 636f 6c75  .        df.colu
+00040280: 6d6e 732c 0a20 2020 2020 2020 206d 696e  mns,.        min
+00040290: 5f70 6572 696f 6473 2c0a 2020 2020 2020  _periods,.      
+000402a0: 2020 636f 7272 2c0a 2020 2020 2020 2020    corr,.        
+000402b0: 7363 616c 6172 2c0a 2020 2020 2020 2020  scalar,.        
+000402c0: 6466 2e5f 6d65 7461 2c0a 2020 2020 290a  df._meta,.    ).
+000402d0: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
+000402e0: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
+000402f0: 636f 6c6c 6563 7469 6f6e 7328 6e61 6d65  collections(name
+00040300: 2c20 6473 6b2c 2064 6570 656e 6465 6e63  , dsk, dependenc
+00040310: 6965 733d 5b64 665d 290a 2020 2020 6966  ies=[df]).    if
+00040320: 2073 6361 6c61 723a 0a20 2020 2020 2020   scalar:.       
+00040330: 2072 6574 7572 6e20 5363 616c 6172 2867   return Scalar(g
+00040340: 7261 7068 2c20 6e61 6d65 2c20 2266 3822  raph, name, "f8"
+00040350: 290a 2020 2020 6d65 7461 203d 206d 616b  ).    meta = mak
+00040360: 655f 6d65 7461 280a 2020 2020 2020 2020  e_meta(.        
+00040370: 5b28 632c 2022 6638 2229 2066 6f72 2063  [(c, "f8") for c
+00040380: 2069 6e20 6466 2e63 6f6c 756d 6e73 5d2c   in df.columns],
+00040390: 0a20 2020 2020 2020 2069 6e64 6578 3d6d  .        index=m
+000403a0: 6574 615f 7365 7269 6573 5f63 6f6e 7374  eta_series_const
+000403b0: 7275 6374 6f72 2864 6629 2864 662e 636f  ructor(df)(df.co
+000403c0: 6c75 6d6e 7329 2c0a 2020 2020 2020 2020  lumns),.        
+000403d0: 7061 7265 6e74 5f6d 6574 613d 6466 2e5f  parent_meta=df._
+000403e0: 6d65 7461 2c0a 2020 2020 290a 2020 2020  meta,.    ).    
+000403f0: 7265 7475 726e 206e 6577 5f64 645f 6f62  return new_dd_ob
+00040400: 6a65 6374 2867 7261 7068 2c20 6e61 6d65  ject(graph, name
+00040410: 2c20 6d65 7461 2c20 2864 662e 636f 6c75  , meta, (df.colu
+00040420: 6d6e 732e 6d69 6e28 292c 2064 662e 636f  mns.min(), df.co
+00040430: 6c75 6d6e 732e 6d61 7828 2929 290a 0a0a  lumns.max()))...
+00040440: 6465 6620 5f63 6f76 5f63 6f72 725f 6368  def _cov_corr_ch
+00040450: 756e 6b28 6466 2c20 636f 7272 3d46 616c  unk(df, corr=Fal
+00040460: 7365 293a 0a20 2020 2022 2222 4368 756e  se):.    """Chun
+00040470: 6b20 7061 7274 206f 6620 6120 636f 7661  k part of a cova
+00040480: 7269 616e 6365 206f 7220 636f 7272 656c  riance or correl
+00040490: 6174 696f 6e20 636f 6d70 7574 6174 696f  ation computatio
+000404a0: 6e22 2222 0a20 2020 2073 6861 7065 203d  n""".    shape =
+000404b0: 2028 6466 2e73 6861 7065 5b31 5d2c 2064   (df.shape[1], d
+000404c0: 662e 7368 6170 655b 315d 290a 2020 2020  f.shape[1]).    
+000404d0: 6466 203d 2064 662e 6173 7479 7065 2822  df = df.astype("
+000404e0: 666c 6f61 7436 3422 2c20 636f 7079 3d46  float64", copy=F
+000404f0: 616c 7365 290a 2020 2020 7375 6d73 203d  alse).    sums =
+00040500: 206e 702e 7a65 726f 735f 6c69 6b65 2864   np.zeros_like(d
+00040510: 662e 7661 6c75 6573 2c20 7368 6170 653d  f.values, shape=
+00040520: 7368 6170 6529 0a20 2020 2063 6f75 6e74  shape).    count
+00040530: 7320 3d20 6e70 2e7a 6572 6f73 5f6c 696b  s = np.zeros_lik
+00040540: 6528 6466 2e76 616c 7565 732c 2073 6861  e(df.values, sha
+00040550: 7065 3d73 6861 7065 290a 2020 2020 666f  pe=shape).    fo
+00040560: 7220 6964 7820 696e 2072 616e 6765 286c  r idx in range(l
+00040570: 656e 2864 662e 636f 6c75 6d6e 7329 293a  en(df.columns)):
+00040580: 0a20 2020 2020 2020 206d 6173 6b20 3d20  .        mask = 
+00040590: 6466 2e69 6c6f 635b 3a2c 2069 6478 5d2e  df.iloc[:, idx].
+000405a0: 6e6f 746e 756c 6c28 290a 2020 2020 2020  notnull().      
+000405b0: 2020 7375 6d73 5b69 6478 5d20 3d20 6466    sums[idx] = df
+000405c0: 5b6d 6173 6b5d 2e73 756d 2829 2e76 616c  [mask].sum().val
+000405d0: 7565 730a 2020 2020 2020 2020 636f 756e  ues.        coun
+000405e0: 7473 5b69 6478 5d20 3d20 6466 5b6d 6173  ts[idx] = df[mas
+000405f0: 6b5d 2e63 6f75 6e74 2829 2e76 616c 7565  k].count().value
+00040600: 730a 2020 2020 2320 5370 6563 6961 6c20  s.    # Special 
+00040610: 6361 7365 2073 696e 676c 652d 726f 7720  case single-row 
+00040620: 4461 7461 4672 616d 6520 636f 7620 746f  DataFrame cov to
+00040630: 2061 766f 6964 2077 6172 6e69 6e67 7320   avoid warnings 
+00040640: 6672 6f6d 2070 616e 6461 732e 0a20 2020  from pandas..   
+00040650: 2069 6620 6466 2e73 6861 7065 5b30 5d20   if df.shape[0] 
+00040660: 3d3d 2031 3a0a 2020 2020 2020 2020 636f  == 1:.        co
+00040670: 7620 3d20 6e70 2e66 756c 6c5f 6c69 6b65  v = np.full_like
+00040680: 2873 756d 732c 206e 702e 6e61 6e29 2020  (sums, np.nan)  
+00040690: 2320 616c 7761 7973 2061 6e20 616c 6c20  # always an all 
+000406a0: 6e61 6e20 7265 7375 6c74 0a20 2020 2065  nan result.    e
+000406b0: 6c73 653a 0a20 2020 2020 2020 2063 6f76  lse:.        cov
+000406c0: 203d 2064 662e 636f 7628 292e 7661 6c75   = df.cov().valu
+000406d0: 6573 0a20 2020 2064 7479 7065 203d 205b  es.    dtype = [
+000406e0: 2822 7375 6d22 2c20 7375 6d73 2e64 7479  ("sum", sums.dty
+000406f0: 7065 292c 2028 2263 6f75 6e74 222c 2063  pe), ("count", c
+00040700: 6f75 6e74 732e 6474 7970 6529 2c20 2822  ounts.dtype), ("
+00040710: 636f 7622 2c20 636f 762e 6474 7970 6529  cov", cov.dtype)
+00040720: 5d0a 2020 2020 6966 2063 6f72 723a 0a20  ].    if corr:. 
+00040730: 2020 2020 2020 2077 6974 6820 7761 726e         with warn
+00040740: 696e 6773 2e63 6174 6368 5f77 6172 6e69  ings.catch_warni
+00040750: 6e67 7328 7265 636f 7264 3d54 7275 6529  ngs(record=True)
+00040760: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+00040770: 726e 696e 6773 2e73 696d 706c 6566 696c  rnings.simplefil
+00040780: 7465 7228 2261 6c77 6179 7322 290a 2020  ter("always").  
+00040790: 2020 2020 2020 2020 2020 6d75 203d 2028            mu = (
+000407a0: 7375 6d73 202f 2063 6f75 6e74 7329 2e54  sums / counts).T
+000407b0: 0a20 2020 2020 2020 206d 203d 206e 702e  .        m = np.
+000407c0: 7a65 726f 735f 6c69 6b65 2864 662e 7661  zeros_like(df.va
+000407d0: 6c75 6573 2c20 7368 6170 653d 7368 6170  lues, shape=shap
+000407e0: 6529 0a20 2020 2020 2020 206d 6173 6b20  e).        mask 
+000407f0: 3d20 6466 2e69 736e 756c 6c28 292e 7661  = df.isnull().va
+00040800: 6c75 6573 0a20 2020 2020 2020 2066 6f72  lues.        for
+00040810: 2069 6478 2069 6e20 7261 6e67 6528 6c65   idx in range(le
+00040820: 6e28 6466 2e63 6f6c 756d 6e73 2929 3a0a  n(df.columns)):.
+00040830: 2020 2020 2020 2020 2020 2020 2320 4176              # Av
+00040840: 6f69 6420 7573 696e 6720 7566 756e 632e  oid using ufunc.
+00040850: 6f75 7465 7220 286e 6f74 2073 7570 706f  outer (not suppo
+00040860: 7274 6564 2062 7920 6375 7079 290a 2020  rted by cupy).  
+00040870: 2020 2020 2020 2020 2020 6d75 5f64 6973            mu_dis
+00040880: 6372 6570 616e 6379 203d 2028 0a20 2020  crepancy = (.   
+00040890: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+000408a0: 7375 6274 7261 6374 2864 662e 696c 6f63  subtract(df.iloc
+000408b0: 5b3a 2c20 6964 785d 2e76 616c 7565 735b  [:, idx].values[
+000408c0: 3a2c 204e 6f6e 655d 2c20 6d75 5b69 6478  :, None], mu[idx
+000408d0: 5d5b 4e6f 6e65 2c20 3a5d 2920 2a2a 2032  ][None, :]) ** 2
+000408e0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000408f0: 2020 2020 2020 2020 2020 206d 755f 6469             mu_di
+00040900: 7363 7265 7061 6e63 795b 6d61 736b 5d20  screpancy[mask] 
+00040910: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
+00040920: 2020 2020 206d 5b69 6478 5d20 3d20 6e70       m[idx] = np
+00040930: 2e6e 616e 7375 6d28 6d75 5f64 6973 6372  .nansum(mu_discr
+00040940: 6570 616e 6379 2c20 6178 6973 3d30 290a  epancy, axis=0).
+00040950: 2020 2020 2020 2020 6d20 3d20 6d2e 540a          m = m.T.
+00040960: 2020 2020 2020 2020 6474 7970 652e 6170          dtype.ap
+00040970: 7065 6e64 2828 226d 222c 206d 2e64 7479  pend(("m", m.dty
+00040980: 7065 2929 0a0a 2020 2020 6f75 7420 3d20  pe))..    out = 
+00040990: 7b22 7375 6d22 3a20 7375 6d73 2c20 2263  {"sum": sums, "c
+000409a0: 6f75 6e74 223a 2063 6f75 6e74 732c 2022  ount": counts, "
+000409b0: 636f 7622 3a20 636f 7620 2a20 2863 6f75  cov": cov * (cou
+000409c0: 6e74 7320 2d20 3129 7d0a 2020 2020 6966  nts - 1)}.    if
+000409d0: 2063 6f72 723a 0a20 2020 2020 2020 206f   corr:.        o
+000409e0: 7574 5b22 6d22 5d20 3d20 6d0a 2020 2020  ut["m"] = m.    
+000409f0: 7265 7475 726e 206f 7574 0a0a 0a64 6566  return out...def
+00040a00: 205f 636f 765f 636f 7272 5f63 6f6d 6269   _cov_corr_combi
+00040a10: 6e65 2864 6174 615f 696e 2c20 636f 7272  ne(data_in, corr
+00040a20: 3d46 616c 7365 293a 0a20 2020 2064 6174  =False):.    dat
+00040a30: 6120 3d20 7b22 7375 6d22 3a20 4e6f 6e65  a = {"sum": None
+00040a40: 2c20 2263 6f75 6e74 223a 204e 6f6e 652c  , "count": None,
+00040a50: 2022 636f 7622 3a20 4e6f 6e65 7d0a 2020   "cov": None}.  
+00040a60: 2020 6966 2063 6f72 723a 0a20 2020 2020    if corr:.     
+00040a70: 2020 2064 6174 615b 226d 225d 203d 204e     data["m"] = N
+00040a80: 6f6e 650a 0a20 2020 2066 6f72 206b 2069  one..    for k i
+00040a90: 6e20 6461 7461 2e6b 6579 7328 293a 0a20  n data.keys():. 
+00040aa0: 2020 2020 2020 2064 6174 615b 6b5d 203d         data[k] =
+00040ab0: 205b 645b 6b5d 2066 6f72 2064 2069 6e20   [d[k] for d in 
+00040ac0: 6461 7461 5f69 6e5d 0a20 2020 2020 2020  data_in].       
+00040ad0: 2064 6174 615b 6b5d 203d 206e 702e 636f   data[k] = np.co
+00040ae0: 6e63 6174 656e 6174 6528 6461 7461 5b6b  ncatenate(data[k
+00040af0: 5d29 2e72 6573 6861 7065 2828 6c65 6e28  ]).reshape((len(
+00040b00: 6461 7461 5b6b 5d29 2c29 202b 2064 6174  data[k]),) + dat
+00040b10: 615b 6b5d 5b30 5d2e 7368 6170 6529 0a0a  a[k][0].shape)..
+00040b20: 2020 2020 7375 6d73 203d 206e 702e 6e61      sums = np.na
+00040b30: 6e5f 746f 5f6e 756d 2864 6174 615b 2273  n_to_num(data["s
+00040b40: 756d 225d 290a 2020 2020 636f 756e 7473  um"]).    counts
+00040b50: 203d 2064 6174 615b 2263 6f75 6e74 225d   = data["count"]
+00040b60: 0a0a 2020 2020 6375 6d5f 7375 6d73 203d  ..    cum_sums =
+00040b70: 206e 702e 6375 6d73 756d 2873 756d 732c   np.cumsum(sums,
+00040b80: 2030 290a 2020 2020 6375 6d5f 636f 756e   0).    cum_coun
+00040b90: 7473 203d 206e 702e 6375 6d73 756d 2863  ts = np.cumsum(c
+00040ba0: 6f75 6e74 732c 2030 290a 0a20 2020 2073  ounts, 0)..    s
+00040bb0: 3120 3d20 6375 6d5f 7375 6d73 5b3a 2d31  1 = cum_sums[:-1
+00040bc0: 5d0a 2020 2020 7332 203d 2073 756d 735b  ].    s2 = sums[
+00040bd0: 313a 5d0a 2020 2020 6e31 203d 2063 756d  1:].    n1 = cum
+00040be0: 5f63 6f75 6e74 735b 3a2d 315d 0a20 2020  _counts[:-1].   
+00040bf0: 206e 3220 3d20 636f 756e 7473 5b31 3a5d   n2 = counts[1:]
+00040c00: 0a20 2020 2077 6974 6820 6e70 2e65 7272  .    with np.err
+00040c10: 7374 6174 6528 696e 7661 6c69 643d 2269  state(invalid="i
+00040c20: 676e 6f72 6522 293a 0a20 2020 2020 2020  gnore"):.       
+00040c30: 2064 203d 2028 7332 202f 206e 3229 202d   d = (s2 / n2) -
+00040c40: 2028 7331 202f 206e 3129 0a20 2020 2020   (s1 / n1).     
+00040c50: 2020 2043 203d 206e 702e 6e61 6e73 756d     C = np.nansum
+00040c60: 280a 2020 2020 2020 2020 2020 2020 286e  (.            (n
+00040c70: 3120 2a20 6e32 2920 2f20 286e 3120 2b20  1 * n2) / (n1 + 
+00040c80: 6e32 2920 2a20 2864 202a 2064 2e74 7261  n2) * (d * d.tra
+00040c90: 6e73 706f 7365 2828 302c 2032 2c20 3129  nspose((0, 2, 1)
+00040ca0: 2929 2c20 300a 2020 2020 2020 2020 2920  )), 0.        ) 
+00040cb0: 2b20 6e70 2e6e 616e 7375 6d28 6461 7461  + np.nansum(data
+00040cc0: 5b22 636f 7622 5d2c 2030 290a 0a20 2020  ["cov"], 0)..   
+00040cd0: 206f 7574 203d 207b 2273 756d 223a 2063   out = {"sum": c
+00040ce0: 756d 5f73 756d 735b 2d31 5d2c 2022 636f  um_sums[-1], "co
+00040cf0: 756e 7422 3a20 6375 6d5f 636f 756e 7473  unt": cum_counts
+00040d00: 5b2d 315d 2c20 2263 6f76 223a 2043 7d0a  [-1], "cov": C}.
+00040d10: 0a20 2020 2069 6620 636f 7272 3a0a 2020  .    if corr:.  
+00040d20: 2020 2020 2020 6e6f 6273 203d 206e 702e        nobs = np.
+00040d30: 7768 6572 6528 6375 6d5f 636f 756e 7473  where(cum_counts
+00040d40: 5b2d 315d 2c20 6375 6d5f 636f 756e 7473  [-1], cum_counts
+00040d50: 5b2d 315d 2c20 6e70 2e6e 616e 290a 2020  [-1], np.nan).  
+00040d60: 2020 2020 2020 6d75 203d 2063 756d 5f73        mu = cum_s
+00040d70: 756d 735b 2d31 5d20 2f20 6e6f 6273 0a20  ums[-1] / nobs. 
+00040d80: 2020 2020 2020 2063 6f75 6e74 735f 6e61         counts_na
+00040d90: 203d 206e 702e 7768 6572 6528 636f 756e   = np.where(coun
+00040da0: 7473 2c20 636f 756e 7473 2c20 6e70 2e6e  ts, counts, np.n
+00040db0: 616e 290a 2020 2020 2020 2020 6d20 3d20  an).        m = 
+00040dc0: 6e70 2e6e 616e 7375 6d28 6461 7461 5b22  np.nansum(data["
+00040dd0: 6d22 5d20 2b20 636f 756e 7473 202a 2028  m"] + counts * (
+00040de0: 7375 6d73 202f 2063 6f75 6e74 735f 6e61  sums / counts_na
+00040df0: 202d 206d 7529 202a 2a20 322c 2061 7869   - mu) ** 2, axi
+00040e00: 733d 3029 0a20 2020 2020 2020 206f 7574  s=0).        out
+00040e10: 5b22 6d22 5d20 3d20 6d0a 2020 2020 7265  ["m"] = m.    re
+00040e20: 7475 726e 206f 7574 0a0a 0a64 6566 205f  turn out...def _
+00040e30: 636f 765f 636f 7272 5f61 6767 2864 6174  cov_corr_agg(dat
+00040e40: 612c 2063 6f6c 732c 206d 696e 5f70 6572  a, cols, min_per
+00040e50: 696f 6473 3d32 2c20 636f 7272 3d46 616c  iods=2, corr=Fal
+00040e60: 7365 2c20 7363 616c 6172 3d46 616c 7365  se, scalar=False
+00040e70: 2c20 6c69 6b65 5f64 663d 4e6f 6e65 293a  , like_df=None):
+00040e80: 0a20 2020 206f 7574 203d 205f 636f 765f  .    out = _cov_
+00040e90: 636f 7272 5f63 6f6d 6269 6e65 2864 6174  corr_combine(dat
+00040ea0: 612c 2063 6f72 7229 0a20 2020 2063 6f75  a, corr).    cou
+00040eb0: 6e74 7320 3d20 6f75 745b 2263 6f75 6e74  nts = out["count
+00040ec0: 225d 0a20 2020 2043 203d 206f 7574 5b22  "].    C = out["
+00040ed0: 636f 7622 5d0a 2020 2020 435b 636f 756e  cov"].    C[coun
+00040ee0: 7473 203c 206d 696e 5f70 6572 696f 6473  ts < min_periods
+00040ef0: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2069  ] = np.nan.    i
+00040f00: 6620 636f 7272 3a0a 2020 2020 2020 2020  f corr:.        
+00040f10: 6d32 203d 206f 7574 5b22 6d22 5d0a 2020  m2 = out["m"].  
+00040f20: 2020 2020 2020 6465 6e20 3d20 6e70 2e73        den = np.s
+00040f30: 7172 7428 6d32 202a 206d 322e 5429 0a20  qrt(m2 * m2.T). 
+00040f40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00040f50: 2064 656e 203d 206e 702e 7768 6572 6528   den = np.where(
+00040f60: 636f 756e 7473 2c20 636f 756e 7473 2c20  counts, counts, 
+00040f70: 6e70 2e6e 616e 2920 2d20 310a 2020 2020  np.nan) - 1.    
+00040f80: 7769 7468 206e 702e 6572 7273 7461 7465  with np.errstate
+00040f90: 2869 6e76 616c 6964 3d22 6967 6e6f 7265  (invalid="ignore
+00040fa0: 222c 2064 6976 6964 653d 2269 676e 6f72  ", divide="ignor
+00040fb0: 6522 293a 0a20 2020 2020 2020 206d 6174  e"):.        mat
+00040fc0: 203d 2043 202f 2064 656e 0a20 2020 2069   = C / den.    i
+00040fd0: 6620 7363 616c 6172 3a0a 2020 2020 2020  f scalar:.      
+00040fe0: 2020 7265 7475 726e 2066 6c6f 6174 286d    return float(m
+00040ff0: 6174 5b30 2c20 315d 290a 2020 2020 7265  at[0, 1]).    re
+00041000: 7475 726e 2028 7064 2e44 6174 6146 7261  turn (pd.DataFra
+00041010: 6d65 2069 6620 6c69 6b65 5f64 6620 6973  me if like_df is
+00041020: 204e 6f6e 6520 656c 7365 206d 6574 615f   None else meta_
+00041030: 6672 616d 655f 636f 6e73 7472 7563 746f  frame_constructo
+00041040: 7228 6c69 6b65 5f64 6629 2928 0a20 2020  r(like_df))(.   
+00041050: 2020 2020 206d 6174 2c20 636f 6c75 6d6e       mat, column
+00041060: 733d 636f 6c73 2c20 696e 6465 783d 636f  s=cols, index=co
+00041070: 6c73 0a20 2020 2029 0a0a 0a64 6566 2070  ls.    )...def p
+00041080: 645f 7370 6c69 7428 6466 2c20 702c 2072  d_split(df, p, r
+00041090: 616e 646f 6d5f 7374 6174 653d 4e6f 6e65  andom_state=None
+000410a0: 2c20 7368 7566 666c 653d 4661 6c73 6529  , shuffle=False)
+000410b0: 3a0a 2020 2020 2222 2253 706c 6974 2044  :.    """Split D
+000410c0: 6174 6146 7261 6d65 2069 6e74 6f20 6d75  ataFrame into mu
+000410d0: 6c74 6970 6c65 2070 6965 6365 7320 7073  ltiple pieces ps
+000410e0: 6575 646f 7261 6e64 6f6d 6c79 0a0a 2020  eudorandomly..  
+000410f0: 2020 3e3e 3e20 6466 203d 2070 642e 4461    >>> df = pd.Da
+00041100: 7461 4672 616d 6528 7b27 6127 3a20 5b31  taFrame({'a': [1
+00041110: 2c20 322c 2033 2c20 342c 2035 2c20 365d  , 2, 3, 4, 5, 6]
+00041120: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
+00041130: 2020 2020 2020 2020 2020 2020 2027 6227               'b'
+00041140: 3a20 5b32 2c20 332c 2034 2c20 352c 2036  : [2, 3, 4, 5, 6
+00041150: 2c20 375d 7d29 0a0a 2020 2020 3e3e 3e20  , 7]})..    >>> 
+00041160: 612c 2062 203d 2070 645f 7370 6c69 7428  a, b = pd_split(
+00041170: 0a20 2020 202e 2e2e 2020 2020 2064 662c  .    ...     df,
+00041180: 205b 302e 352c 2030 2e35 5d2c 2072 616e   [0.5, 0.5], ran
+00041190: 646f 6d5f 7374 6174 653d 3132 332c 2073  dom_state=123, s
+000411a0: 6875 6666 6c65 3d54 7275 650a 2020 2020  huffle=True.    
+000411b0: 2e2e 2e20 2920 2023 2072 6f75 6768 6c79  ... )  # roughly
+000411c0: 2035 302f 3530 2073 706c 6974 0a20 2020   50/50 split.   
+000411d0: 203e 3e3e 2061 0a20 2020 2020 2020 6120   >>> a.       a 
+000411e0: 2062 0a20 2020 2033 2020 3420 2035 0a20   b.    3  4  5. 
+000411f0: 2020 2030 2020 3120 2032 0a20 2020 2035     0  1  2.    5
+00041200: 2020 3620 2037 0a20 2020 203e 3e3e 2062    6  7.    >>> b
+00041210: 0a20 2020 2020 2020 6120 2062 0a20 2020  .       a  b.   
+00041220: 2031 2020 3220 2033 0a20 2020 2034 2020   1  2  3.    4  
+00041230: 3520 2036 0a20 2020 2032 2020 3320 2034  5  6.    2  3  4
+00041240: 0a20 2020 2022 2222 0a20 2020 2070 203d  .    """.    p =
+00041250: 206c 6973 7428 7029 0a20 2020 2069 6620   list(p).    if 
+00041260: 7368 7566 666c 653a 0a20 2020 2020 2020  shuffle:.       
+00041270: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00041280: 6365 2872 616e 646f 6d5f 7374 6174 652c  ce(random_state,
+00041290: 206e 702e 7261 6e64 6f6d 2e52 616e 646f   np.random.Rando
+000412a0: 6d53 7461 7465 293a 0a20 2020 2020 2020  mState):.       
+000412b0: 2020 2020 2072 616e 646f 6d5f 7374 6174       random_stat
+000412c0: 6520 3d20 6e70 2e72 616e 646f 6d2e 5261  e = np.random.Ra
+000412d0: 6e64 6f6d 5374 6174 6528 7261 6e64 6f6d  ndomState(random
+000412e0: 5f73 7461 7465 290a 2020 2020 2020 2020  _state).        
+000412f0: 6466 203d 2064 662e 7361 6d70 6c65 2866  df = df.sample(f
+00041300: 7261 633d 312e 302c 2072 616e 646f 6d5f  rac=1.0, random_
+00041310: 7374 6174 653d 7261 6e64 6f6d 5f73 7461  state=random_sta
+00041320: 7465 290a 2020 2020 696e 6465 7820 3d20  te).    index = 
+00041330: 7073 6575 646f 7261 6e64 6f6d 286c 656e  pseudorandom(len
+00041340: 2864 6629 2c20 702c 2072 616e 646f 6d5f  (df), p, random_
+00041350: 7374 6174 6529 0a20 2020 2072 6574 7572  state).    retur
+00041360: 6e20 5b64 662e 696c 6f63 5b69 6e64 6578  n [df.iloc[index
+00041370: 203d 3d20 695d 2066 6f72 2069 2069 6e20   == i] for i in 
+00041380: 7261 6e67 6528 6c65 6e28 7029 295d 0a0a  range(len(p))]..
+00041390: 0a64 6566 205f 7461 6b65 5f6c 6173 7428  .def _take_last(
+000413a0: 612c 2073 6b69 706e 613d 5472 7565 293a  a, skipna=True):
+000413b0: 0a20 2020 2022 2222 0a20 2020 2074 616b  .    """.    tak
+000413c0: 6520 6c61 7374 2072 6f77 2028 5365 7269  e last row (Seri
+000413d0: 6573 2920 6f66 2044 6174 6146 7261 6d65  es) of DataFrame
+000413e0: 202f 206c 6173 7420 7661 6c75 6520 6f66   / last value of
+000413f0: 2053 6572 6965 730a 2020 2020 636f 6e73   Series.    cons
+00041400: 6964 6572 696e 6720 4e61 4e2e 0a0a 2020  idering NaN...  
+00041410: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00041420: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00041430: 6120 3a20 7064 2e44 6174 6146 7261 6d65  a : pd.DataFrame
+00041440: 206f 7220 7064 2e53 6572 6965 730a 2020   or pd.Series.  
+00041450: 2020 736b 6970 6e61 203a 2062 6f6f 6c2c    skipna : bool,
+00041460: 2064 6566 6175 6c74 2054 7275 650a 2020   default True.  
+00041470: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
+00041480: 2065 7863 6c75 6465 204e 614e 0a0a 2020   exclude NaN..  
+00041490: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+000414a0: 6c61 7374 5f76 616c 6964 2873 293a 0a20  last_valid(s):. 
+000414b0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+000414c0: 7261 6e67 6528 312c 206d 696e 2831 302c  range(1, min(10,
+000414d0: 206c 656e 2873 2920 2b20 3129 293a 0a20   len(s) + 1)):. 
+000414e0: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+000414f0: 2073 2e69 6c6f 635b 2d69 5d0a 2020 2020   s.iloc[-i].    
+00041500: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+00041510: 642e 6973 6e75 6c6c 2876 616c 293a 0a20  d.isnull(val):. 
+00041520: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00041530: 6574 7572 6e20 7661 6c0a 2020 2020 2020  eturn val.      
+00041540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00041550: 2020 2020 6e6f 6e6e 756c 6c20 3d20 735b      nonnull = s[
+00041560: 732e 6e6f 746e 6128 295d 0a20 2020 2020  s.notna()].     
+00041570: 2020 2020 2020 2069 6620 6e6f 7420 6e6f         if not no
+00041580: 6e6e 756c 6c2e 656d 7074 793a 0a20 2020  nnull.empty:.   
+00041590: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000415a0: 7572 6e20 6e6f 6e6e 756c 6c2e 696c 6f63  urn nonnull.iloc
+000415b0: 5b2d 315d 0a20 2020 2020 2020 2072 6574  [-1].        ret
+000415c0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 6966  urn None..    if
+000415d0: 2073 6b69 706e 6120 6973 2046 616c 7365   skipna is False
+000415e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000415f0: 2061 2e69 6c6f 635b 2d31 5d0a 2020 2020   a.iloc[-1].    
+00041600: 656c 7365 3a0a 2020 2020 2020 2020 2320  else:.        # 
+00041610: 7461 6b65 206c 6173 7420 7661 6c69 6420  take last valid 
+00041620: 7661 6c75 6520 6578 636c 7564 696e 6720  value excluding 
+00041630: 4e61 4e2c 204e 614e 206c 6f63 6174 696f  NaN, NaN locatio
+00041640: 6e20 6d61 7920 6265 2064 6966 6665 7265  n may be differe
+00041650: 6e74 0a20 2020 2020 2020 2023 2069 6e20  nt.        # in 
+00041660: 6561 6368 2063 6f6c 756d 6e0a 2020 2020  each column.    
+00041670: 2020 2020 6966 2069 735f 6461 7461 6672      if is_datafr
+00041680: 616d 655f 6c69 6b65 2861 293a 0a20 2020  ame_like(a):.   
+00041690: 2020 2020 2020 2020 2023 2063 7265 6174           # creat
+000416a0: 6520 5365 7269 6573 2066 726f 6d20 6170  e Series from ap
+000416b0: 7072 6f70 7269 6174 6520 6261 636b 656e  propriate backen
+000416c0: 6420 6461 7461 6672 616d 6520 6c69 6272  d dataframe libr
+000416d0: 6172 790a 2020 2020 2020 2020 2020 2020  ary.            
+000416e0: 7365 7269 6573 5f74 7970 203d 2074 7970  series_typ = typ
+000416f0: 6528 612e 696c 6f63 5b30 3a31 2c20 305d  e(a.iloc[0:1, 0]
+00041700: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00041710: 2061 2e65 6d70 7479 3a0a 2020 2020 2020   a.empty:.      
+00041720: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00041730: 2073 6572 6965 735f 7479 7028 5b5d 2c20   series_typ([], 
+00041740: 6474 7970 653d 2266 6c6f 6174 2229 0a20  dtype="float"). 
+00041750: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00041760: 6e20 7365 7269 6573 5f74 7970 280a 2020  n series_typ(.  
+00041770: 2020 2020 2020 2020 2020 2020 2020 5b5f                [_
+00041780: 6c61 7374 5f76 616c 6964 2861 2e69 6c6f  last_valid(a.ilo
+00041790: 635b 3a2c 2069 5d29 2066 6f72 2069 2069  c[:, i]) for i i
+000417a0: 6e20 7261 6e67 6528 6c65 6e28 612e 636f  n range(len(a.co
+000417b0: 6c75 6d6e 7329 295d 2c0a 2020 2020 2020  lumns))],.      
+000417c0: 2020 2020 2020 2020 2020 696e 6465 783d            index=
+000417d0: 612e 636f 6c75 6d6e 732c 0a20 2020 2020  a.columns,.     
+000417e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000417f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00041800: 2020 2072 6574 7572 6e20 5f6c 6173 745f     return _last_
+00041810: 7661 6c69 6428 6129 0a0a 0a64 6566 2063  valid(a)...def c
+00041820: 6865 636b 5f64 6976 6973 696f 6e73 2864  heck_divisions(d
+00041830: 6976 6973 696f 6e73 293a 0a20 2020 2069  ivisions):.    i
+00041840: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+00041850: 2864 6976 6973 696f 6e73 2c20 286c 6973  (divisions, (lis
+00041860: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
+00041870: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00041880: 7272 6f72 2822 4e65 7720 6469 7669 7369  rror("New divisi
+00041890: 6f6e 206d 7573 7420 6265 206c 6973 7420  on must be list 
+000418a0: 6f72 2074 7570 6c65 2229 0a20 2020 2064  or tuple").    d
+000418b0: 6976 6973 696f 6e73 203d 206c 6973 7428  ivisions = list(
+000418c0: 6469 7669 7369 6f6e 7329 0a20 2020 2069  divisions).    i
+000418d0: 6620 6c65 6e28 6469 7669 7369 6f6e 7329  f len(divisions)
+000418e0: 203d 3d20 303a 0a20 2020 2020 2020 2072   == 0:.        r
+000418f0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00041900: 224e 6577 2064 6976 6973 696f 6e20 6d75  "New division mu
+00041910: 7374 206e 6f74 2062 6520 656d 7074 7922  st not be empty"
+00041920: 290a 2020 2020 6966 2064 6976 6973 696f  ).    if divisio
+00041930: 6e73 2021 3d20 736f 7274 6564 2864 6976  ns != sorted(div
+00041940: 6973 696f 6e73 293a 0a20 2020 2020 2020  isions):.       
+00041950: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00041960: 7228 224e 6577 2064 6976 6973 696f 6e20  r("New division 
+00041970: 6d75 7374 2062 6520 736f 7274 6564 2229  must be sorted")
+00041980: 0a20 2020 2069 6620 6c65 6e28 6469 7669  .    if len(divi
+00041990: 7369 6f6e 735b 3a2d 315d 2920 213d 206c  sions[:-1]) != l
+000419a0: 656e 286c 6973 7428 756e 6971 7565 2864  en(list(unique(d
+000419b0: 6976 6973 696f 6e73 5b3a 2d31 5d29 2929  ivisions[:-1])))
+000419c0: 3a0a 2020 2020 2020 2020 6d73 6720 3d20  :.        msg = 
+000419d0: 224e 6577 2064 6976 6973 696f 6e20 6d75  "New division mu
+000419e0: 7374 2062 6520 756e 6971 7565 2c20 6578  st be unique, ex
+000419f0: 6365 7074 2066 6f72 2074 6865 206c 6173  cept for the las
+00041a00: 7420 656c 656d 656e 7422 0a20 2020 2020  t element".     
+00041a10: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00041a20: 726f 7228 6d73 6729 0a0a 0a64 6566 2072  ror(msg)...def r
+00041a30: 6570 6172 7469 7469 6f6e 5f64 6976 6973  epartition_divis
+00041a40: 696f 6e73 2861 2c20 622c 206e 616d 652c  ions(a, b, name,
+00041a50: 206f 7574 312c 206f 7574 322c 2066 6f72   out1, out2, for
+00041a60: 6365 3d46 616c 7365 293a 0a20 2020 2022  ce=False):.    "
+00041a70: 2222 6461 736b 2067 7261 7068 2074 6f20  ""dask graph to 
+00041a80: 7265 7061 7274 6974 696f 6e20 6461 7461  repartition data
+00041a90: 6672 616d 6520 6279 206e 6577 2064 6976  frame by new div
+00041aa0: 6973 696f 6e73 0a0a 2020 2020 5061 7261  isions..    Para
+00041ab0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00041ac0: 2d2d 2d2d 2d0a 2020 2020 6120 3a20 7475  -----.    a : tu
+00041ad0: 706c 650a 2020 2020 2020 2020 6f6c 6420  ple.        old 
+00041ae0: 6469 7669 7369 6f6e 730a 2020 2020 6220  divisions.    b 
+00041af0: 3a20 7475 706c 652c 206c 6973 746d 7970  : tuple, listmyp
+00041b00: 790a 2020 2020 6f75 7432 203a 2073 7472  y.    out2 : str
+00041b10: 0a20 2020 2020 2020 206e 616d 6520 6f66  .        name of
+00041b20: 206e 6577 2064 6174 6166 7261 6d65 0a20   new dataframe. 
+00041b30: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+00041b40: 2064 6566 6175 6c74 2046 616c 7365 0a20   default False. 
+00041b50: 2020 2020 2020 2041 6c6c 6f77 7320 7468         Allows th
+00041b60: 6520 6578 7061 6e73 696f 6e20 6f66 2074  e expansion of t
+00041b70: 6865 2065 7869 7374 696e 6720 6469 7669  he existing divi
+00041b80: 7369 6f6e 732e 0a20 2020 2020 2020 2049  sions..        I
+00041b90: 6620 4661 6c73 6520 7468 656e 2074 6865  f False then the
+00041ba0: 206e 6577 2064 6976 6973 696f 6e73 206c   new divisions l
+00041bb0: 6f77 6572 2061 6e64 2075 7070 6572 2062  ower and upper b
+00041bc0: 6f75 6e64 7320 6d75 7374 2062 650a 2020  ounds must be.  
+00041bd0: 2020 2020 2020 7468 6520 7361 6d65 2061        the same a
+00041be0: 7320 7468 6520 6f6c 6420 6469 7669 7369  s the old divisi
+00041bf0: 6f6e 732e 0a0a 2020 2020 4578 616d 706c  ons...    Exampl
+00041c00: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
+00041c10: 2020 2020 3e3e 3e20 6672 6f6d 2070 7072      >>> from ppr
+00041c20: 696e 7420 696d 706f 7274 2070 7072 696e  int import pprin
+00041c30: 740a 2020 2020 3e3e 3e20 7070 7269 6e74  t.    >>> pprint
+00041c40: 2872 6570 6172 7469 7469 6f6e 5f64 6976  (repartition_div
+00041c50: 6973 696f 6e73 285b 312c 2033 2c20 375d  isions([1, 3, 7]
+00041c60: 2c20 5b31 2c20 342c 2036 2c20 375d 2c20  , [1, 4, 6, 7], 
+00041c70: 2761 272c 2027 6227 2c20 2763 2729 2920  'a', 'b', 'c')) 
+00041c80: 2023 2064 6f63 7465 7374 3a20 2b45 4c4c   # doctest: +ELL
+00041c90: 4950 5349 530a 2020 2020 7b28 2762 272c  IPSIS.    {('b',
+00041ca0: 2030 293a 2028 3c66 756e 6374 696f 6e20   0): (<function 
+00041cb0: 626f 756e 6461 7279 5f73 6c69 6365 2061  boundary_slice a
+00041cc0: 7420 2e2e 2e3e 2c20 2827 6127 2c20 3029  t ...>, ('a', 0)
+00041cd0: 2c20 312c 2033 2c20 4661 6c73 6529 2c0a  , 1, 3, False),.
+00041ce0: 2020 2020 2028 2762 272c 2031 293a 2028       ('b', 1): (
+00041cf0: 3c66 756e 6374 696f 6e20 626f 756e 6461  <function bounda
+00041d00: 7279 5f73 6c69 6365 2061 7420 2e2e 2e3e  ry_slice at ...>
+00041d10: 2c20 2827 6127 2c20 3129 2c20 332c 2034  , ('a', 1), 3, 4
+00041d20: 2c20 4661 6c73 6529 2c0a 2020 2020 2028  , False),.     (
+00041d30: 2762 272c 2032 293a 2028 3c66 756e 6374  'b', 2): (<funct
+00041d40: 696f 6e20 626f 756e 6461 7279 5f73 6c69  ion boundary_sli
+00041d50: 6365 2061 7420 2e2e 2e3e 2c20 2827 6127  ce at ...>, ('a'
+00041d60: 2c20 3129 2c20 342c 2036 2c20 4661 6c73  , 1), 4, 6, Fals
+00041d70: 6529 2c0a 2020 2020 2028 2762 272c 2033  e),.     ('b', 3
+00041d80: 293a 2028 3c66 756e 6374 696f 6e20 626f  ): (<function bo
+00041d90: 756e 6461 7279 5f73 6c69 6365 2061 7420  undary_slice at 
+00041da0: 2e2e 2e3e 2c20 2827 6127 2c20 3129 2c20  ...>, ('a', 1), 
+00041db0: 362c 2037 2c20 5472 7565 292c 0a20 2020  6, 7, True),.   
+00041dc0: 2020 2827 6327 2c20 3029 3a20 283c 6675    ('c', 0): (<fu
+00041dd0: 6e63 7469 6f6e 2063 6f6e 6361 7420 6174  nction concat at
+00041de0: 202e 2e2e 3e2c 205b 2827 6227 2c20 3029   ...>, [('b', 0)
+00041df0: 2c20 2827 6227 2c20 3129 5d29 2c0a 2020  , ('b', 1)]),.  
+00041e00: 2020 2028 2763 272c 2031 293a 2028 2762     ('c', 1): ('b
+00041e10: 272c 2032 292c 0a20 2020 2020 2827 6327  ', 2),.     ('c'
+00041e20: 2c20 3229 3a20 2827 6227 2c20 3329 7d0a  , 2): ('b', 3)}.
+00041e30: 2020 2020 2222 220a 2020 2020 6368 6563      """.    chec
+00041e40: 6b5f 6469 7669 7369 6f6e 7328 6229 0a0a  k_divisions(b)..
+00041e50: 2020 2020 6966 206c 656e 2862 2920 3c20      if len(b) < 
+00041e60: 323a 0a20 2020 2020 2020 2023 206d 696e  2:.        # min
+00041e70: 696d 756d 2064 6976 6973 696f 6e20 6973  imum division is
+00041e80: 2032 2065 6c65 6d65 6e74 732c 206c 696b   2 elements, lik
+00041e90: 6520 5b30 2c20 305d 0a20 2020 2020 2020  e [0, 0].       
+00041ea0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00041eb0: 7228 224e 6577 2064 6976 6973 696f 6e20  r("New division 
+00041ec0: 6d75 7374 2062 6520 6c6f 6e67 6572 2074  must be longer t
+00041ed0: 6861 6e20 3220 656c 656d 656e 7473 2229  han 2 elements")
+00041ee0: 0a0a 2020 2020 6966 2066 6f72 6365 3a0a  ..    if force:.
+00041ef0: 2020 2020 2020 2020 6966 2061 5b30 5d20          if a[0] 
+00041f00: 3c20 625b 305d 3a0a 2020 2020 2020 2020  < b[0]:.        
+00041f10: 2020 2020 6d73 6720 3d20 280a 2020 2020      msg = (.    
+00041f20: 2020 2020 2020 2020 2020 2020 226c 6566              "lef
+00041f30: 7420 7369 6465 206f 6620 7468 6520 6e65  t side of the ne
+00041f40: 7720 6469 7669 7369 6f6e 206d 7573 7420  w division must 
+00041f50: 6265 2065 7175 616c 206f 7220 736d 616c  be equal or smal
+00041f60: 6c65 7220 220a 2020 2020 2020 2020 2020  ler ".          
+00041f70: 2020 2020 2020 2274 6861 6e20 6f6c 6420        "than old 
+00041f80: 6469 7669 7369 6f6e 220a 2020 2020 2020  division".      
+00041f90: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00041fa0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00041fb0: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
+00041fc0: 2020 6966 2061 5b2d 315d 203e 2062 5b2d    if a[-1] > b[-
+00041fd0: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
+00041fe0: 6d73 6720 3d20 280a 2020 2020 2020 2020  msg = (.        
+00041ff0: 2020 2020 2020 2020 2272 6967 6874 2073          "right s
+00042000: 6964 6520 6f66 2074 6865 206e 6577 2064  ide of the new d
+00042010: 6976 6973 696f 6e20 6d75 7374 2062 6520  ivision must be 
+00042020: 6571 7561 6c20 6f72 206c 6172 6765 7220  equal or larger 
+00042030: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00042040: 2020 2274 6861 6e20 6f6c 6420 6469 7669    "than old divi
+00042050: 7369 6f6e 220a 2020 2020 2020 2020 2020  sion".          
+00042060: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00042070: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00042080: 286d 7367 290a 2020 2020 656c 7365 3a0a  (msg).    else:.
+00042090: 2020 2020 2020 2020 6966 2061 5b30 5d20          if a[0] 
+000420a0: 213d 2062 5b30 5d3a 0a20 2020 2020 2020  != b[0]:.       
+000420b0: 2020 2020 206d 7367 203d 2022 6c65 6674       msg = "left
+000420c0: 2073 6964 6520 6f66 206f 6c64 2061 6e64   side of old and
+000420d0: 206e 6577 2064 6976 6973 696f 6e73 2061   new divisions a
+000420e0: 7265 2064 6966 6665 7265 6e74 220a 2020  re different".  
+000420f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00042100: 5661 6c75 6545 7272 6f72 286d 7367 290a  ValueError(msg).
+00042110: 2020 2020 2020 2020 6966 2061 5b2d 315d          if a[-1]
+00042120: 2021 3d20 625b 2d31 5d3a 0a20 2020 2020   != b[-1]:.     
+00042130: 2020 2020 2020 206d 7367 203d 2022 7269         msg = "ri
+00042140: 6768 7420 7369 6465 206f 6620 6f6c 6420  ght side of old 
+00042150: 616e 6420 6e65 7720 6469 7669 7369 6f6e  and new division
+00042160: 7320 6172 6520 6469 6666 6572 656e 7422  s are different"
+00042170: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00042180: 7365 2056 616c 7565 4572 726f 7228 6d73  se ValueError(ms
+00042190: 6729 0a0a 2020 2020 6465 6620 5f69 735f  g)..    def _is_
+000421a0: 7369 6e67 6c65 5f6c 6173 745f 6469 7628  single_last_div(
+000421b0: 7829 3a0a 2020 2020 2020 2020 2222 2257  x):.        """W
+000421c0: 6865 7468 6572 206c 6173 7420 6469 7669  hether last divi
+000421d0: 7369 6f6e 206f 6e6c 7920 636f 6e74 6169  sion only contai
+000421e0: 6e73 2073 696e 676c 6520 6c61 6265 6c22  ns single label"
+000421f0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00042200: 6e20 6c65 6e28 7829 203e 3d20 3220 616e  n len(x) >= 2 an
+00042210: 6420 785b 2d31 5d20 3d3d 2078 5b2d 325d  d x[-1] == x[-2]
+00042220: 0a0a 2020 2020 6320 3d20 5b61 5b30 5d5d  ..    c = [a[0]]
+00042230: 0a20 2020 2064 203d 2064 6963 7428 290a  .    d = dict().
+00042240: 2020 2020 6c6f 7720 3d20 615b 305d 0a0a      low = a[0]..
+00042250: 2020 2020 692c 206a 203d 2031 2c20 3120      i, j = 1, 1 
+00042260: 2023 2069 6e64 6963 6573 2066 6f72 206f   # indices for o
+00042270: 6c64 2f6e 6577 2064 6976 6973 696f 6e73  ld/new divisions
+00042280: 0a20 2020 206b 203d 2030 2020 2320 696e  .    k = 0  # in
+00042290: 6465 7820 666f 7220 7465 6d70 2064 6976  dex for temp div
+000422a0: 6973 696f 6e73 0a0a 2020 2020 6c61 7374  isions..    last
+000422b0: 5f65 6c65 6d20 3d20 5f69 735f 7369 6e67  _elem = _is_sing
+000422c0: 6c65 5f6c 6173 745f 6469 7628 6129 0a0a  le_last_div(a)..
+000422d0: 2020 2020 2320 7072 6f63 6573 7320 7468      # process th
+000422e0: 726f 7567 6820 6f6c 6420 6469 7669 7369  rough old divisi
+000422f0: 6f6e 0a20 2020 2023 206c 6566 7420 7061  on.    # left pa
+00042300: 7274 206f 6620 6e65 7720 6469 7669 7369  rt of new divisi
+00042310: 6f6e 2063 616e 2062 6520 7072 6f63 6573  on can be proces
+00042320: 7365 6420 696e 2074 6869 7320 6c6f 6f70  sed in this loop
+00042330: 0a20 2020 2077 6869 6c65 2069 203c 206c  .    while i < l
+00042340: 656e 2861 2920 616e 6420 6a20 3c20 6c65  en(a) and j < le
+00042350: 6e28 6229 3a0a 2020 2020 2020 2020 6966  n(b):.        if
+00042360: 2061 5b69 5d20 3c20 625b 6a5d 3a0a 2020   a[i] < b[j]:.  
+00042370: 2020 2020 2020 2020 2020 2320 7475 706c            # tupl
+00042380: 6520 6973 2073 6f6d 6574 6869 6e67 206c  e is something l
+00042390: 696b 653a 0a20 2020 2020 2020 2020 2020  ike:.           
+000423a0: 2023 2028 6d65 7468 6f64 732e 626f 756e   # (methods.boun
+000423b0: 6461 7279 5f73 6c69 6365 2c20 2827 6672  dary_slice, ('fr
+000423c0: 6f6d 5f70 616e 6461 732d 2327 2c20 3029  om_pandas-#', 0)
+000423d0: 2c20 332c 2034 2c20 4661 6c73 6529 290a  , 3, 4, False)).
+000423e0: 2020 2020 2020 2020 2020 2020 645b 286f              d[(o
+000423f0: 7574 312c 206b 295d 203d 2028 6d65 7468  ut1, k)] = (meth
+00042400: 6f64 732e 626f 756e 6461 7279 5f73 6c69  ods.boundary_sli
+00042410: 6365 2c20 286e 616d 652c 2069 202d 2031  ce, (name, i - 1
+00042420: 292c 206c 6f77 2c20 615b 695d 2c20 4661  ), low, a[i], Fa
+00042430: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+00042440: 206c 6f77 203d 2061 5b69 5d0a 2020 2020   low = a[i].    
+00042450: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+00042460: 2020 2020 2020 2065 6c69 6620 615b 695d         elif a[i]
+00042470: 203e 2062 5b6a 5d3a 0a20 2020 2020 2020   > b[j]:.       
+00042480: 2020 2020 2064 5b28 6f75 7431 2c20 6b29       d[(out1, k)
+00042490: 5d20 3d20 286d 6574 686f 6473 2e62 6f75  ] = (methods.bou
+000424a0: 6e64 6172 795f 736c 6963 652c 2028 6e61  ndary_slice, (na
+000424b0: 6d65 2c20 6920 2d20 3129 2c20 6c6f 772c  me, i - 1), low,
+000424c0: 2062 5b6a 5d2c 2046 616c 7365 290a 2020   b[j], False).  
+000424d0: 2020 2020 2020 2020 2020 6c6f 7720 3d20            low = 
+000424e0: 625b 6a5d 0a20 2020 2020 2020 2020 2020  b[j].           
+000424f0: 206a 202b 3d20 310a 2020 2020 2020 2020   j += 1.        
+00042500: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00042510: 2020 645b 286f 7574 312c 206b 295d 203d    d[(out1, k)] =
+00042520: 2028 6d65 7468 6f64 732e 626f 756e 6461   (methods.bounda
+00042530: 7279 5f73 6c69 6365 2c20 286e 616d 652c  ry_slice, (name,
+00042540: 2069 202d 2031 292c 206c 6f77 2c20 625b   i - 1), low, b[
+00042550: 6a5d 2c20 4661 6c73 6529 0a20 2020 2020  j], False).     
+00042560: 2020 2020 2020 206c 6f77 203d 2062 5b6a         low = b[j
+00042570: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00042580: 206c 656e 2861 2920 3d3d 2069 202b 2031   len(a) == i + 1
+00042590: 206f 7220 615b 695d 203c 2061 5b69 202b   or a[i] < a[i +
+000425a0: 2031 5d3a 0a20 2020 2020 2020 2020 2020   1]:.           
+000425b0: 2020 2020 206a 202b 3d20 310a 2020 2020       j += 1.    
+000425c0: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+000425d0: 2020 2020 2020 2063 2e61 7070 656e 6428         c.append(
+000425e0: 6c6f 7729 0a20 2020 2020 2020 206b 202b  low).        k +
+000425f0: 3d20 310a 0a20 2020 2023 2072 6967 6874  = 1..    # right
+00042600: 2070 6172 7420 6f66 206e 6577 2064 6976   part of new div
+00042610: 6973 696f 6e20 6361 6e20 7265 6d61 696e  ision can remain
+00042620: 0a20 2020 2069 6620 615b 2d31 5d20 3c20  .    if a[-1] < 
+00042630: 625b 2d31 5d20 6f72 2062 5b2d 315d 203d  b[-1] or b[-1] =
+00042640: 3d20 625b 2d32 5d3a 0a20 2020 2020 2020  = b[-2]:.       
+00042650: 2066 6f72 205f 6a20 696e 2072 616e 6765   for _j in range
+00042660: 286a 2c20 6c65 6e28 6229 293a 0a20 2020  (j, len(b)):.   
+00042670: 2020 2020 2020 2020 2023 2061 6c77 6179           # alway
+00042680: 7320 7573 6520 7269 6768 742d 6d6f 7374  s use right-most
+00042690: 206f 6620 6f6c 6420 6469 7669 7369 6f6e   of old division
+000426a0: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+000426b0: 6563 6175 7365 2069 7420 6d61 7920 636f  ecause it may co
+000426c0: 6e74 6169 6e20 6c61 7374 2065 6c65 6d65  ntain last eleme
+000426d0: 6e74 0a20 2020 2020 2020 2020 2020 206d  nt.            m
+000426e0: 203d 206c 656e 2861 2920 2d20 320a 2020   = len(a) - 2.  
+000426f0: 2020 2020 2020 2020 2020 645b 286f 7574            d[(out
+00042700: 312c 206b 295d 203d 2028 6d65 7468 6f64  1, k)] = (method
+00042710: 732e 626f 756e 6461 7279 5f73 6c69 6365  s.boundary_slice
+00042720: 2c20 286e 616d 652c 206d 292c 206c 6f77  , (name, m), low
+00042730: 2c20 625b 5f6a 5d2c 2046 616c 7365 290a  , b[_j], False).
+00042740: 2020 2020 2020 2020 2020 2020 6c6f 7720              low 
+00042750: 3d20 625b 5f6a 5d0a 2020 2020 2020 2020  = b[_j].        
+00042760: 2020 2020 632e 6170 7065 6e64 286c 6f77      c.append(low
+00042770: 290a 2020 2020 2020 2020 2020 2020 6b20  ).            k 
+00042780: 2b3d 2031 0a20 2020 2065 6c73 653a 0a20  += 1.    else:. 
+00042790: 2020 2020 2020 2023 2065 7665 6e20 6966         # even if
+000427a0: 206e 6577 2064 6976 6973 696f 6e20 6973   new division is
+000427b0: 2070 726f 6365 7373 6564 2074 6872 6f75   processed throu
+000427c0: 6768 2c0a 2020 2020 2020 2020 2320 7269  gh,.        # ri
+000427d0: 6768 742d 6d6f 7374 2065 6c65 6d65 6e74  ght-most element
+000427e0: 206f 6620 6f6c 6420 6469 7669 7369 6f6e   of old division
+000427f0: 2063 616e 2072 656d 6169 6e0a 2020 2020   can remain.    
+00042800: 2020 2020 6966 206c 6173 745f 656c 656d      if last_elem
+00042810: 2061 6e64 2069 203c 206c 656e 2861 293a   and i < len(a):
+00042820: 0a20 2020 2020 2020 2020 2020 2064 5b28  .            d[(
+00042830: 6f75 7431 2c20 6b29 5d20 3d20 286d 6574  out1, k)] = (met
+00042840: 686f 6473 2e62 6f75 6e64 6172 795f 736c  hods.boundary_sl
+00042850: 6963 652c 2028 6e61 6d65 2c20 6920 2d20  ice, (name, i - 
+00042860: 3129 2c20 615b 695d 2c20 615b 695d 2c20  1), a[i], a[i], 
+00042870: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00042880: 2020 206b 202b 3d20 310a 2020 2020 2020     k += 1.      
+00042890: 2020 632e 6170 7065 6e64 2861 5b2d 315d    c.append(a[-1]
+000428a0: 290a 0a20 2020 2023 2072 6570 6c61 6365  )..    # replace
+000428b0: 206c 6173 7420 656c 656d 656e 7420 6f66   last element of
+000428c0: 2074 7570 6c65 2077 6974 6820 5472 7565   tuple with True
+000428d0: 0a20 2020 2064 5b28 6f75 7431 2c20 6b20  .    d[(out1, k 
+000428e0: 2d20 3129 5d20 3d20 645b 286f 7574 312c  - 1)] = d[(out1,
+000428f0: 206b 202d 2031 295d 5b3a 2d31 5d20 2b20   k - 1)][:-1] + 
+00042900: 2854 7275 652c 290a 0a20 2020 2069 2c20  (True,)..    i, 
+00042910: 6a20 3d20 302c 2031 0a0a 2020 2020 6c61  j = 0, 1..    la
+00042920: 7374 5f65 6c65 6d20 3d20 5f69 735f 7369  st_elem = _is_si
+00042930: 6e67 6c65 5f6c 6173 745f 6469 7628 6329  ngle_last_div(c)
+00042940: 0a0a 2020 2020 7768 696c 6520 6a20 3c20  ..    while j < 
+00042950: 6c65 6e28 6229 3a0a 2020 2020 2020 2020  len(b):.        
+00042960: 746d 7020 3d20 5b5d 0a20 2020 2020 2020  tmp = [].       
+00042970: 2077 6869 6c65 2063 5b69 5d20 3c20 625b   while c[i] < b[
+00042980: 6a5d 3a0a 2020 2020 2020 2020 2020 2020  j]:.            
+00042990: 746d 702e 6170 7065 6e64 2828 6f75 7431  tmp.append((out1
+000429a0: 2c20 6929 290a 2020 2020 2020 2020 2020  , i)).          
+000429b0: 2020 6920 2b3d 2031 0a20 2020 2020 2020    i += 1.       
+000429c0: 2077 6869 6c65 2028 0a20 2020 2020 2020   while (.       
+000429d0: 2020 2020 206c 6173 745f 656c 656d 0a20       last_elem. 
+000429e0: 2020 2020 2020 2020 2020 2061 6e64 2063             and c
+000429f0: 5b69 5d20 3d3d 2062 5b2d 315d 0a20 2020  [i] == b[-1].   
+00042a00: 2020 2020 2020 2020 2061 6e64 2028 625b           and (b[
+00042a10: 2d31 5d20 213d 2062 5b2d 325d 206f 7220  -1] != b[-2] or 
+00042a20: 6a20 3d3d 206c 656e 2862 2920 2d20 3129  j == len(b) - 1)
+00042a30: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+00042a40: 2069 203c 206b 0a20 2020 2020 2020 2029   i < k.        )
+00042a50: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00042a60: 6170 7065 6e64 2069 6620 6c61 7374 2073  append if last s
+00042a70: 706c 6974 2069 7320 6e6f 7420 696e 636c  plit is not incl
+00042a80: 7564 6564 0a20 2020 2020 2020 2020 2020  uded.           
+00042a90: 2074 6d70 2e61 7070 656e 6428 286f 7574   tmp.append((out
+00042aa0: 312c 2069 2929 0a20 2020 2020 2020 2020  1, i)).         
+00042ab0: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
+00042ac0: 2020 6966 206c 656e 2874 6d70 2920 3d3d    if len(tmp) ==
+00042ad0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00042ae0: 2320 6475 6d6d 7920 736c 6963 6520 746f  # dummy slice to
+00042af0: 2072 6574 7572 6e20 656d 7074 7920 4461   return empty Da
+00042b00: 7461 4672 616d 6520 6f72 2053 6572 6965  taFrame or Serie
+00042b10: 732c 0a20 2020 2020 2020 2020 2020 2023  s,.            #
+00042b20: 2077 6869 6368 2072 6574 6169 6e20 6f72   which retain or
+00042b30: 6967 696e 616c 2064 6174 6120 6174 7472  iginal data attr
+00042b40: 6962 7574 6573 2028 636f 6c75 6d6e 7320  ibutes (columns 
+00042b50: 2f20 6e61 6d65 290a 2020 2020 2020 2020  / name).        
+00042b60: 2020 2020 645b 286f 7574 322c 206a 202d      d[(out2, j -
+00042b70: 2031 295d 203d 2028 6d65 7468 6f64 732e   1)] = (methods.
+00042b80: 626f 756e 6461 7279 5f73 6c69 6365 2c20  boundary_slice, 
+00042b90: 286e 616d 652c 2030 292c 2061 5b30 5d2c  (name, 0), a[0],
+00042ba0: 2061 5b30 5d2c 2046 616c 7365 290a 2020   a[0], False).  
+00042bb0: 2020 2020 2020 656c 6966 206c 656e 2874        elif len(t
+00042bc0: 6d70 2920 3d3d 2031 3a0a 2020 2020 2020  mp) == 1:.      
+00042bd0: 2020 2020 2020 645b 286f 7574 322c 206a        d[(out2, j
+00042be0: 202d 2031 295d 203d 2074 6d70 5b30 5d0a   - 1)] = tmp[0].
+00042bf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00042c00: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00042c10: 2074 6d70 3a0a 2020 2020 2020 2020 2020   tmp:.          
+00042c20: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00042c30: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00042c40: 2020 2020 2020 2020 2020 2020 2263 6865              "che
+00042c50: 636b 2066 6f72 2064 7570 6c69 6361 7465  ck for duplicate
+00042c60: 2070 6172 7469 7469 6f6e 735c 6e6f 6c64   partitions\nold
+00042c70: 3a5c 6e25 735c 6e5c 6e22 0a20 2020 2020  :\n%s\n\n".     
+00042c80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00042c90: 6e65 773a 5c6e 2573 5c6e 5c6e 636f 6d62  new:\n%s\n\ncomb
+00042ca0: 696e 6564 3a5c 6e25 7322 2025 2028 7066  ined:\n%s" % (pf
+00042cb0: 6f72 6d61 7428 6129 2c20 7066 6f72 6d61  ormat(a), pforma
+00042cc0: 7428 6229 2c20 7066 6f72 6d61 7428 6329  t(b), pformat(c)
+00042cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00042ce0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00042cf0: 645b 286f 7574 322c 206a 202d 2031 295d  d[(out2, j - 1)]
+00042d00: 203d 2028 6d65 7468 6f64 732e 636f 6e63   = (methods.conc
+00042d10: 6174 2c20 746d 7029 0a20 2020 2020 2020  at, tmp).       
+00042d20: 206a 202b 3d20 310a 2020 2020 7265 7475   j += 1.    retu
+00042d30: 726e 2064 0a0a 0a64 6566 2072 6570 6172  rn d...def repar
+00042d40: 7469 7469 6f6e 5f66 7265 7128 6466 2c20  tition_freq(df, 
+00042d50: 6672 6571 3d4e 6f6e 6529 3a0a 2020 2020  freq=None):.    
+00042d60: 2222 2252 6570 6172 7469 7469 6f6e 2061  """Repartition a
+00042d70: 2074 696d 6573 6572 6965 7320 6461 7461   timeseries data
+00042d80: 6672 616d 6520 6279 2061 206e 6577 2066  frame by a new f
+00042d90: 7265 7175 656e 6379 2222 220a 2020 2020  requency""".    
+00042da0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00042db0: 6528 6466 2e64 6976 6973 696f 6e73 5b30  e(df.divisions[0
+00042dc0: 5d2c 2070 642e 5469 6d65 7374 616d 7029  ], pd.Timestamp)
+00042dd0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00042de0: 5479 7065 4572 726f 7228 2243 616e 206f  TypeError("Can o
+00042df0: 6e6c 7920 7265 7061 7274 6974 696f 6e20  nly repartition 
+00042e00: 6f6e 2066 7265 7175 656e 6379 2066 6f72  on frequency for
+00042e10: 2074 696d 6573 6572 6965 7322 290a 0a20   timeseries").. 
+00042e20: 2020 2066 7265 7120 3d20 5f6d 6170 5f66     freq = _map_f
+00042e30: 7265 715f 746f 5f70 6572 696f 645f 7374  req_to_period_st
+00042e40: 6172 7428 6672 6571 290a 0a20 2020 2074  art(freq)..    t
+00042e50: 7279 3a0a 2020 2020 2020 2020 7374 6172  ry:.        star
+00042e60: 7420 3d20 6466 2e64 6976 6973 696f 6e73  t = df.divisions
+00042e70: 5b30 5d2e 6365 696c 2866 7265 7129 0a20  [0].ceil(freq). 
+00042e80: 2020 2065 7863 6570 7420 5661 6c75 6545     except ValueE
+00042e90: 7272 6f72 3a0a 2020 2020 2020 2020 7374  rror:.        st
+00042ea0: 6172 7420 3d20 6466 2e64 6976 6973 696f  art = df.divisio
+00042eb0: 6e73 5b30 5d0a 2020 2020 6469 7669 7369  ns[0].    divisi
+00042ec0: 6f6e 7320 3d20 6d65 7468 6f64 732e 746f  ons = methods.to
+00042ed0: 6c69 7374 280a 2020 2020 2020 2020 7064  list(.        pd
+00042ee0: 2e64 6174 655f 7261 6e67 6528 7374 6172  .date_range(star
+00042ef0: 743d 7374 6172 742c 2065 6e64 3d64 662e  t=start, end=df.
+00042f00: 6469 7669 7369 6f6e 735b 2d31 5d2c 2066  divisions[-1], f
+00042f10: 7265 713d 6672 6571 290a 2020 2020 290a  req=freq).    ).
+00042f20: 2020 2020 6966 206e 6f74 206c 656e 2864      if not len(d
+00042f30: 6976 6973 696f 6e73 293a 0a20 2020 2020  ivisions):.     
+00042f40: 2020 2064 6976 6973 696f 6e73 203d 205b     divisions = [
+00042f50: 6466 2e64 6976 6973 696f 6e73 5b30 5d2c  df.divisions[0],
+00042f60: 2064 662e 6469 7669 7369 6f6e 735b 2d31   df.divisions[-1
+00042f70: 5d5d 0a20 2020 2065 6c73 653a 0a20 2020  ]].    else:.   
+00042f80: 2020 2020 2064 6976 6973 696f 6e73 2e61       divisions.a
+00042f90: 7070 656e 6428 6466 2e64 6976 6973 696f  ppend(df.divisio
+00042fa0: 6e73 5b2d 315d 290a 2020 2020 2020 2020  ns[-1]).        
+00042fb0: 6966 2064 6976 6973 696f 6e73 5b30 5d20  if divisions[0] 
+00042fc0: 213d 2064 662e 6469 7669 7369 6f6e 735b  != df.divisions[
+00042fd0: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+00042fe0: 6469 7669 7369 6f6e 7320 3d20 5b64 662e  divisions = [df.
+00042ff0: 6469 7669 7369 6f6e 735b 305d 5d20 2b20  divisions[0]] + 
+00043000: 6469 7669 7369 6f6e 730a 0a20 2020 2072  divisions..    r
+00043010: 6574 7572 6e20 6466 2e72 6570 6172 7469  eturn df.reparti
+00043020: 7469 6f6e 2864 6976 6973 696f 6e73 3d64  tion(divisions=d
+00043030: 6976 6973 696f 6e73 290a 0a0a 6465 6620  ivisions)...def 
+00043040: 5f6d 6170 5f66 7265 715f 746f 5f70 6572  _map_freq_to_per
+00043050: 696f 645f 7374 6172 7428 6672 6571 293a  iod_start(freq):
+00043060: 0a20 2020 2022 2222 456e 7375 7265 2074  .    """Ensure t
+00043070: 6861 7420 7468 6520 6672 6571 7565 6e63  hat the frequenc
+00043080: 7920 7065 7274 6169 6e73 2074 6f20 7468  y pertains to th
+00043090: 6520 2a2a 7374 6172 742a 2a20 6f66 2061  e **start** of a
+000430a0: 2070 6572 696f 642e 0a0a 2020 2020 4966   period...    If
+000430b0: 2065 2e67 2e20 6066 7265 713d 274d 2760   e.g. `freq='M'`
+000430c0: 2c20 7468 656e 2074 6865 2064 6976 6973  , then the divis
+000430d0: 696f 6e73 2061 7265 3a0a 2020 2020 2020  ions are:.      
+000430e0: 2020 2d20 3230 3231 2d33 312d 3120 3030    - 2021-31-1 00
+000430f0: 3a30 303a 3030 2028 7374 6172 7420 6f66  :00:00 (start of
+00043100: 2046 6562 7275 6172 7920 7061 7274 6974   February partit
+00043110: 696f 6e29 0a20 2020 2020 2020 202d 2032  ion).        - 2
+00043120: 3032 312d 322d 3238 2030 303a 3030 3a30  021-2-28 00:00:0
+00043130: 3020 2873 7461 7274 206f 6620 4d61 7263  0 (start of Marc
+00043140: 6820 7061 7274 6974 696f 6e29 0a20 2020  h partition).   
+00043150: 2020 2020 202d 202e 2e2e 0a0a 2020 2020       - .....    
+00043160: 6275 7420 7468 6973 202a 2a73 686f 756c  but this **shoul
+00043170: 642a 2a20 6265 3a0a 2020 2020 2020 2020  d** be:.        
+00043180: 2d20 3230 3231 2d32 2d31 2030 303a 3030  - 2021-2-1 00:00
+00043190: 3a30 3020 2873 7461 7274 206f 6620 4665  :00 (start of Fe
+000431a0: 6272 7561 7279 2070 6172 7469 7469 6f6e  bruary partition
+000431b0: 290a 2020 2020 2020 2020 2d20 3230 3231  ).        - 2021
+000431c0: 2d33 2d31 2030 303a 3030 3a30 3020 2873  -3-1 00:00:00 (s
+000431d0: 7461 7274 206f 6620 4d61 7263 6820 7061  tart of March pa
+000431e0: 7274 6974 696f 6e29 0a20 2020 2020 2020  rtition).       
+000431f0: 202d 202e 2e2e 0a0a 2020 2020 5468 6572   - .....    Ther
+00043200: 6566 6f72 652c 2077 6520 6d61 7020 6066  efore, we map `f
+00043210: 7265 713d 274d 2760 2074 6f20 6066 7265  req='M'` to `fre
+00043220: 713d 274d 5327 6020 2873 616d 6520 666f  q='MS'` (same fo
+00043230: 7220 7175 6172 7465 7220 616e 6420 7965  r quarter and ye
+00043240: 6172 292e 0a20 2020 2022 2222 0a0a 2020  ar)..    """..  
+00043250: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00043260: 6e63 6528 6672 6571 2c20 7374 7229 3a0a  nce(freq, str):.
+00043270: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00043280: 7265 710a 0a20 2020 206f 6666 7365 7420  req..    offset 
+00043290: 3d20 7064 2e74 7365 7269 6573 2e66 7265  = pd.tseries.fre
+000432a0: 7175 656e 6369 6573 2e74 6f5f 6f66 6673  quencies.to_offs
+000432b0: 6574 2866 7265 7129 0a20 2020 206f 6666  et(freq).    off
+000432c0: 7365 745f 7479 7065 5f6e 616d 6520 3d20  set_type_name = 
+000432d0: 7479 7065 286f 6666 7365 7429 2e5f 5f6e  type(offset).__n
+000432e0: 616d 655f 5f0a 0a20 2020 2069 6620 6e6f  ame__..    if no
+000432f0: 7420 6f66 6673 6574 5f74 7970 655f 6e61  t offset_type_na
+00043300: 6d65 2e65 6e64 7377 6974 6828 2245 6e64  me.endswith("End
+00043310: 2229 3a0a 2020 2020 2020 2020 7265 7475  "):.        retu
+00043320: 726e 2066 7265 710a 0a20 2020 206e 6577  rn freq..    new
+00043330: 5f6f 6666 7365 7420 3d20 6f66 6673 6574  _offset = offset
+00043340: 5f74 7970 655f 6e61 6d65 5b3a 202d 6c65  _type_name[: -le
+00043350: 6e28 2245 6e64 2229 5d20 2b20 2242 6567  n("End")] + "Beg
+00043360: 696e 220a 2020 2020 7472 793a 0a20 2020  in".    try:.   
+00043370: 2020 2020 206e 6577 5f6f 6666 7365 745f       new_offset_
+00043380: 7479 7065 203d 2067 6574 6174 7472 2870  type = getattr(p
+00043390: 642e 7473 6572 6965 732e 6f66 6673 6574  d.tseries.offset
+000433a0: 732c 206e 6577 5f6f 6666 7365 7429 0a20  s, new_offset). 
+000433b0: 2020 2020 2020 2069 6620 222d 2220 696e         if "-" in
+000433c0: 2066 7265 713a 0a20 2020 2020 2020 2020   freq:.         
+000433d0: 2020 205f 2c20 616e 6368 6f72 203d 2066     _, anchor = f
+000433e0: 7265 712e 7370 6c69 7428 222d 2229 0a20  req.split("-"). 
+000433f0: 2020 2020 2020 2020 2020 2061 6e63 686f             ancho
+00043400: 7220 3d20 222d 2220 2b20 616e 6368 6f72  r = "-" + anchor
+00043410: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00043420: 2020 2020 2020 2020 2020 2061 6e63 686f             ancho
+00043430: 7220 3d20 2222 0a20 2020 2020 2020 206e  r = "".        n
+00043440: 203d 2073 7472 286f 6666 7365 742e 6e29   = str(offset.n)
+00043450: 2069 6620 6f66 6673 6574 2e6e 2021 3d20   if offset.n != 
+00043460: 3120 656c 7365 2022 220a 2020 2020 2020  1 else "".      
+00043470: 2020 7265 7475 726e 2066 227b 6e7d 7b6e    return f"{n}{n
+00043480: 6577 5f6f 6666 7365 745f 7479 7065 2e5f  ew_offset_type._
+00043490: 7072 6566 6978 7d7b 616e 6368 6f72 7d22  prefix}{anchor}"
+000434a0: 0a20 2020 2065 7863 6570 7420 4174 7472  .    except Attr
+000434b0: 6962 7574 6545 7272 6f72 3a0a 2020 2020  ibuteError:.    
+000434c0: 2020 2020 7265 7475 726e 2066 7265 710a      return freq.
+000434d0: 0a0a 6465 6620 7265 7061 7274 6974 696f  ..def repartitio
+000434e0: 6e5f 7369 7a65 2864 662c 2073 697a 6529  n_size(df, size)
+000434f0: 3a0a 2020 2020 2222 220a 2020 2020 5265  :.    """.    Re
+00043500: 7061 7274 6974 696f 6e20 6461 7461 6672  partition datafr
+00043510: 616d 6520 736f 2074 6861 7420 6e65 7720  ame so that new 
+00043520: 7061 7274 6974 696f 6e73 2068 6176 6520  partitions have 
+00043530: 6170 7072 6f78 696d 6174 656c 7920 6073  approximately `s
+00043540: 697a 6560 206d 656d 6f72 7920 7573 6167  ize` memory usag
+00043550: 6520 6561 6368 0a20 2020 2022 2222 0a20  e each.    """. 
+00043560: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00043570: 2873 697a 652c 2073 7472 293a 0a20 2020  (size, str):.   
+00043580: 2020 2020 2073 697a 6520 3d20 7061 7273       size = pars
+00043590: 655f 6279 7465 7328 7369 7a65 290a 2020  e_bytes(size).  
+000435a0: 2020 7369 7a65 203d 2069 6e74 2873 697a    size = int(siz
+000435b0: 6529 0a0a 2020 2020 6d65 6d5f 7573 6167  e)..    mem_usag
+000435c0: 6573 203d 2064 662e 6d61 705f 7061 7274  es = df.map_part
+000435d0: 6974 696f 6e73 2874 6f74 616c 5f6d 656d  itions(total_mem
+000435e0: 5f75 7361 6765 2c20 6465 6570 3d54 7275  _usage, deep=Tru
+000435f0: 6529 2e63 6f6d 7075 7465 2829 0a0a 2020  e).compute()..  
+00043600: 2020 2320 312e 2073 706c 6974 2065 6163    # 1. split eac
+00043610: 6820 7061 7274 6974 696f 6e20 7468 6174  h partition that
+00043620: 2069 7320 6c61 7267 6572 2074 6861 6e20   is larger than 
+00043630: 7061 7274 6974 696f 6e5f 7369 7a65 0a20  partition_size. 
+00043640: 2020 206e 7370 6c69 7473 203d 2031 202b     nsplits = 1 +
+00043650: 206d 656d 5f75 7361 6765 7320 2f2f 2073   mem_usages // s
+00043660: 697a 650a 2020 2020 6966 206e 702e 616e  ize.    if np.an
+00043670: 7928 6e73 706c 6974 7320 3e20 3129 3a0a  y(nsplits > 1):.
+00043680: 2020 2020 2020 2020 7370 6c69 745f 6e61          split_na
+00043690: 6d65 203d 2066 2272 6570 6172 7469 7469  me = f"repartiti
+000436a0: 6f6e 2d73 706c 6974 2d7b 7369 7a65 7d2d  on-split-{size}-
+000436b0: 7b74 6f6b 656e 697a 6528 6466 297d 220a  {tokenize(df)}".
+000436c0: 2020 2020 2020 2020 6466 203d 205f 7370          df = _sp
+000436d0: 6c69 745f 7061 7274 6974 696f 6e73 2864  lit_partitions(d
+000436e0: 662c 206e 7370 6c69 7473 2c20 7370 6c69  f, nsplits, spli
+000436f0: 745f 6e61 6d65 290a 2020 2020 2020 2020  t_name).        
+00043700: 2320 7570 6461 7465 206d 656d 5f75 7361  # update mem_usa
+00043710: 6765 7320 746f 2061 6363 6f75 6e74 2066  ges to account f
+00043720: 6f72 2074 6865 2073 706c 6974 2070 6172  or the split par
+00043730: 7469 7469 6f6e 730a 2020 2020 2020 2020  titions.        
+00043740: 7370 6c69 745f 6d65 6d5f 7573 6167 6573  split_mem_usages
+00043750: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00043760: 7220 6e2c 2075 7361 6765 2069 6e20 7a69  r n, usage in zi
+00043770: 7028 6e73 706c 6974 732c 206d 656d 5f75  p(nsplits, mem_u
+00043780: 7361 6765 7329 3a0a 2020 2020 2020 2020  sages):.        
+00043790: 2020 2020 7370 6c69 745f 6d65 6d5f 7573      split_mem_us
+000437a0: 6167 6573 2e65 7874 656e 6428 5b75 7361  ages.extend([usa
+000437b0: 6765 202f 206e 5d20 2a20 6e29 0a20 2020  ge / n] * n).   
+000437c0: 2020 2020 206d 656d 5f75 7361 6765 7320       mem_usages 
+000437d0: 3d20 7064 2e53 6572 6965 7328 7370 6c69  = pd.Series(spli
+000437e0: 745f 6d65 6d5f 7573 6167 6573 290a 0a20  t_mem_usages).. 
+000437f0: 2020 2023 2032 2e20 6e6f 7720 7468 6174     # 2. now that
+00043800: 2061 6c6c 2070 6172 7469 7469 6f6e 7320   all partitions 
+00043810: 6172 6520 6c65 7373 2074 6861 6e20 7369  are less than si
+00043820: 7a65 2c20 636f 6e63 6174 2074 6865 6d20  ze, concat them 
+00043830: 7570 2074 6f20 7369 7a65 0a20 2020 2061  up to size.    a
+00043840: 7373 6572 7420 6e70 2e61 6c6c 286d 656d  ssert np.all(mem
+00043850: 5f75 7361 6765 7320 3c3d 2073 697a 6529  _usages <= size)
+00043860: 0a20 2020 206e 6577 5f6e 7061 7274 6974  .    new_npartit
+00043870: 696f 6e73 203d 206c 6973 7428 6d61 7028  ions = list(map(
+00043880: 6c65 6e2c 2069 7465 725f 6368 756e 6b73  len, iter_chunks
+00043890: 286d 656d 5f75 7361 6765 732c 2073 697a  (mem_usages, siz
+000438a0: 6529 2929 0a20 2020 206e 6577 5f70 6172  e))).    new_par
+000438b0: 7469 7469 6f6e 735f 626f 756e 6461 7269  titions_boundari
+000438c0: 6573 203d 206e 702e 6375 6d73 756d 286e  es = np.cumsum(n
+000438d0: 6577 5f6e 7061 7274 6974 696f 6e73 290a  ew_npartitions).
+000438e0: 2020 2020 6e65 775f 6e61 6d65 203d 2066      new_name = f
+000438f0: 2272 6570 6172 7469 7469 6f6e 2d7b 7369  "repartition-{si
+00043900: 7a65 7d2d 7b74 6f6b 656e 697a 6528 6466  ze}-{tokenize(df
+00043910: 297d 220a 2020 2020 7265 7475 726e 205f  )}".    return _
+00043920: 7265 7061 7274 6974 696f 6e5f 6672 6f6d  repartition_from
+00043930: 5f62 6f75 6e64 6172 6965 7328 6466 2c20  _boundaries(df, 
+00043940: 6e65 775f 7061 7274 6974 696f 6e73 5f62  new_partitions_b
+00043950: 6f75 6e64 6172 6965 732c 206e 6577 5f6e  oundaries, new_n
+00043960: 616d 6529 0a0a 0a64 6566 2074 6f74 616c  ame)...def total
+00043970: 5f6d 656d 5f75 7361 6765 2864 662c 2069  _mem_usage(df, i
+00043980: 6e64 6578 3d54 7275 652c 2064 6565 703d  ndex=True, deep=
+00043990: 4661 6c73 6529 3a0a 2020 2020 6d65 6d5f  False):.    mem_
+000439a0: 7573 6167 6520 3d20 6466 2e6d 656d 6f72  usage = df.memor
+000439b0: 795f 7573 6167 6528 696e 6465 783d 696e  y_usage(index=in
+000439c0: 6465 782c 2064 6565 703d 6465 6570 290a  dex, deep=deep).
+000439d0: 2020 2020 6966 2069 735f 7365 7269 6573      if is_series
+000439e0: 5f6c 696b 6528 6d65 6d5f 7573 6167 6529  _like(mem_usage)
+000439f0: 3a0a 2020 2020 2020 2020 6d65 6d5f 7573  :.        mem_us
+00043a00: 6167 6520 3d20 6d65 6d5f 7573 6167 652e  age = mem_usage.
+00043a10: 7375 6d28 290a 2020 2020 7265 7475 726e  sum().    return
+00043a20: 206d 656d 5f75 7361 6765 0a0a 0a64 6566   mem_usage...def
+00043a30: 2072 6570 6172 7469 7469 6f6e 5f6e 7061   repartition_npa
+00043a40: 7274 6974 696f 6e73 2864 662c 206e 7061  rtitions(df, npa
+00043a50: 7274 6974 696f 6e73 293a 0a20 2020 2022  rtitions):.    "
+00043a60: 2222 5265 7061 7274 6974 696f 6e20 6461  ""Repartition da
+00043a70: 7461 6672 616d 6520 746f 2061 2073 6d61  taframe to a sma
+00043a80: 6c6c 6572 206e 756d 6265 7220 6f66 2070  ller number of p
+00043a90: 6172 7469 7469 6f6e 7322 2222 0a20 2020  artitions""".   
+00043aa0: 206e 6577 5f6e 616d 6520 3d20 2272 6570   new_name = "rep
+00043ab0: 6172 7469 7469 6f6e 2d25 642d 2573 2220  artition-%d-%s" 
+00043ac0: 2520 286e 7061 7274 6974 696f 6e73 2c20  % (npartitions, 
+00043ad0: 746f 6b65 6e69 7a65 2864 6629 290a 2020  tokenize(df)).  
+00043ae0: 2020 6966 2064 662e 6e70 6172 7469 7469    if df.npartiti
+00043af0: 6f6e 7320 3d3d 206e 7061 7274 6974 696f  ons == npartitio
+00043b00: 6e73 3a0a 2020 2020 2020 2020 7265 7475  ns:.        retu
+00043b10: 726e 2064 660a 2020 2020 656c 6966 2064  rn df.    elif d
+00043b20: 662e 6e70 6172 7469 7469 6f6e 7320 3e20  f.npartitions > 
+00043b30: 6e70 6172 7469 7469 6f6e 733a 0a20 2020  npartitions:.   
+00043b40: 2020 2020 206e 7061 7274 6974 696f 6e73       npartitions
+00043b50: 5f72 6174 696f 203d 2064 662e 6e70 6172  _ratio = df.npar
+00043b60: 7469 7469 6f6e 7320 2f20 6e70 6172 7469  titions / nparti
+00043b70: 7469 6f6e 730a 2020 2020 2020 2020 6e65  tions.        ne
+00043b80: 775f 7061 7274 6974 696f 6e73 5f62 6f75  w_partitions_bou
+00043b90: 6e64 6172 6965 7320 3d20 5b0a 2020 2020  ndaries = [.    
+00043ba0: 2020 2020 2020 2020 696e 7428 6e65 775f          int(new_
+00043bb0: 7061 7274 6974 696f 6e5f 696e 6465 7820  partition_index 
+00043bc0: 2a20 6e70 6172 7469 7469 6f6e 735f 7261  * npartitions_ra
+00043bd0: 7469 6f29 0a20 2020 2020 2020 2020 2020  tio).           
+00043be0: 2066 6f72 206e 6577 5f70 6172 7469 7469   for new_partiti
+00043bf0: 6f6e 5f69 6e64 6578 2069 6e20 7261 6e67  on_index in rang
+00043c00: 6528 6e70 6172 7469 7469 6f6e 7320 2b20  e(npartitions + 
+00043c10: 3129 0a20 2020 2020 2020 205d 0a20 2020  1).        ].   
+00043c20: 2020 2020 2072 6574 7572 6e20 5f72 6570       return _rep
+00043c30: 6172 7469 7469 6f6e 5f66 726f 6d5f 626f  artition_from_bo
+00043c40: 756e 6461 7269 6573 2864 662c 206e 6577  undaries(df, new
+00043c50: 5f70 6172 7469 7469 6f6e 735f 626f 756e  _partitions_boun
+00043c60: 6461 7269 6573 2c20 6e65 775f 6e61 6d65  daries, new_name
+00043c70: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00043c80: 2020 2020 2320 4472 6f70 2064 7570 6c63      # Drop duplc
+00043c90: 6174 6573 2069 6e20 6361 7365 206c 6173  ates in case las
+00043ca0: 7420 7061 7274 6974 696f 6e20 6861 7320  t partition has 
+00043cb0: 7361 6d65 0a20 2020 2020 2020 2023 2076  same.        # v
+00043cc0: 616c 7565 2066 6f72 206d 696e 2061 6e64  alue for min and
+00043cd0: 206d 6178 2064 6976 6973 696f 6e0a 2020   max division.  
+00043ce0: 2020 2020 2020 6f72 6967 696e 616c 5f64        original_d
+00043cf0: 6976 6973 696f 6e73 203d 2064 6976 6973  ivisions = divis
+00043d00: 696f 6e73 203d 2070 642e 5365 7269 6573  ions = pd.Series
+00043d10: 2864 662e 6469 7669 7369 6f6e 7329 2e64  (df.divisions).d
+00043d20: 726f 705f 6475 706c 6963 6174 6573 2829  rop_duplicates()
+00043d30: 0a20 2020 2020 2020 2069 6620 6466 2e6b  .        if df.k
+00043d40: 6e6f 776e 5f64 6976 6973 696f 6e73 2061  nown_divisions a
+00043d50: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+00043d60: 2069 735f 6461 7465 7469 6d65 3634 5f61   is_datetime64_a
+00043d70: 6e79 5f64 7479 7065 2864 6976 6973 696f  ny_dtype(divisio
+00043d80: 6e73 2e64 7479 7065 290a 2020 2020 2020  ns.dtype).      
+00043d90: 2020 2020 2020 6f72 2069 735f 6e75 6d65        or is_nume
+00043da0: 7269 635f 6474 7970 6528 6469 7669 7369  ric_dtype(divisi
+00043db0: 6f6e 732e 6474 7970 6529 0a20 2020 2020  ons.dtype).     
+00043dc0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00043dd0: 2020 6966 2069 735f 6461 7465 7469 6d65    if is_datetime
+00043de0: 3634 5f61 6e79 5f64 7479 7065 2864 6976  64_any_dtype(div
+00043df0: 6973 696f 6e73 2e64 7479 7065 293a 0a20  isions.dtype):. 
+00043e00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00043e10: 6976 6973 696f 6e73 203d 2064 6976 6973  ivisions = divis
+00043e20: 696f 6e73 2e76 616c 7565 732e 6173 7479  ions.values.asty
+00043e30: 7065 2822 666c 6f61 7436 3422 290a 0a20  pe("float64").. 
+00043e40: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00043e50: 5f73 6572 6965 735f 6c69 6b65 2864 6976  _series_like(div
+00043e60: 6973 696f 6e73 293a 0a20 2020 2020 2020  isions):.       
+00043e70: 2020 2020 2020 2020 2064 6976 6973 696f           divisio
+00043e80: 6e73 203d 2064 6976 6973 696f 6e73 2e76  ns = divisions.v
+00043e90: 616c 7565 730a 0a20 2020 2020 2020 2020  alues..         
+00043ea0: 2020 206e 203d 206c 656e 2864 6976 6973     n = len(divis
+00043eb0: 696f 6e73 290a 2020 2020 2020 2020 2020  ions).          
+00043ec0: 2020 6469 7669 7369 6f6e 7320 3d20 6e70    divisions = np
+00043ed0: 2e69 6e74 6572 7028 0a20 2020 2020 2020  .interp(.       
+00043ee0: 2020 2020 2020 2020 2078 3d6e 702e 6c69           x=np.li
+00043ef0: 6e73 7061 6365 2830 2c20 6e2c 206e 7061  nspace(0, n, npa
+00043f00: 7274 6974 696f 6e73 202b 2031 292c 0a20  rtitions + 1),. 
+00043f10: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00043f20: 703d 6e70 2e6c 696e 7370 6163 6528 302c  p=np.linspace(0,
+00043f30: 206e 2c20 6e29 2c0a 2020 2020 2020 2020   n, n),.        
+00043f40: 2020 2020 2020 2020 6670 3d64 6976 6973          fp=divis
+00043f50: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
+00043f60: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00043f70: 6966 2069 735f 6461 7465 7469 6d65 3634  if is_datetime64
+00043f80: 5f61 6e79 5f64 7479 7065 286f 7269 6769  _any_dtype(origi
+00043f90: 6e61 6c5f 6469 7669 7369 6f6e 732e 6474  nal_divisions.dt
+00043fa0: 7970 6529 3a0a 2020 2020 2020 2020 2020  ype):.          
+00043fb0: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
+00043fc0: 3d20 6d65 7468 6f64 732e 746f 6c69 7374  = methods.tolist
+00043fd0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00043fe0: 2020 2020 2020 7064 2e53 6572 6965 7328        pd.Series(
+00043ff0: 6469 7669 7369 6f6e 7329 2e61 7374 7970  divisions).astyp
+00044000: 6528 6f72 6967 696e 616c 5f64 6976 6973  e(original_divis
+00044010: 696f 6e73 2e64 7479 7065 290a 2020 2020  ions.dtype).    
+00044020: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00044030: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
+00044040: 702e 6973 7375 6264 7479 7065 286f 7269  p.issubdtype(ori
+00044050: 6769 6e61 6c5f 6469 7669 7369 6f6e 732e  ginal_divisions.
+00044060: 6474 7970 652c 206e 702e 696e 7465 6765  dtype, np.intege
+00044070: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00044080: 2020 2020 6469 7669 7369 6f6e 7320 3d20      divisions = 
+00044090: 6469 7669 7369 6f6e 732e 6173 7479 7065  divisions.astype
+000440a0: 286f 7269 6769 6e61 6c5f 6469 7669 7369  (original_divisi
+000440b0: 6f6e 732e 6474 7970 6529 0a0a 2020 2020  ons.dtype)..    
+000440c0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000440d0: 7461 6e63 6528 6469 7669 7369 6f6e 732c  tance(divisions,
+000440e0: 206e 702e 6e64 6172 7261 7929 3a0a 2020   np.ndarray):.  
+000440f0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00044100: 7669 7369 6f6e 7320 3d20 6469 7669 7369  visions = divisi
+00044110: 6f6e 732e 746f 6c69 7374 2829 0a0a 2020  ons.tolist()..  
+00044120: 2020 2020 2020 2020 2020 6469 7669 7369            divisi
+00044130: 6f6e 7320 3d20 6c69 7374 2864 6976 6973  ons = list(divis
+00044140: 696f 6e73 290a 2020 2020 2020 2020 2020  ions).          
+00044150: 2020 6469 7669 7369 6f6e 735b 305d 203d    divisions[0] =
+00044160: 2064 662e 6469 7669 7369 6f6e 735b 305d   df.divisions[0]
+00044170: 0a20 2020 2020 2020 2020 2020 2064 6976  .            div
+00044180: 6973 696f 6e73 5b2d 315d 203d 2064 662e  isions[-1] = df.
+00044190: 6469 7669 7369 6f6e 735b 2d31 5d0a 0a20  divisions[-1].. 
+000441a0: 2020 2020 2020 2020 2020 2023 2045 6e73             # Ens
+000441b0: 7572 6520 7468 6520 636f 6d70 7574 6564  ure the computed
+000441c0: 2064 6976 6973 696f 6e73 2061 7265 2075   divisions are u
+000441d0: 6e69 7175 650a 2020 2020 2020 2020 2020  nique.          
+000441e0: 2020 6469 7669 7369 6f6e 7320 3d20 6c69    divisions = li
+000441f0: 7374 2875 6e69 7175 6528 6469 7669 7369  st(unique(divisi
+00044200: 6f6e 735b 3a2d 315d 2929 202b 205b 6469  ons[:-1])) + [di
+00044210: 7669 7369 6f6e 735b 2d31 5d5d 0a20 2020  visions[-1]].   
+00044220: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00044230: 6466 2e72 6570 6172 7469 7469 6f6e 2864  df.repartition(d
+00044240: 6976 6973 696f 6e73 3d64 6976 6973 696f  ivisions=divisio
+00044250: 6e73 290a 2020 2020 2020 2020 656c 7365  ns).        else
+00044260: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+00044270: 762c 206d 6f64 203d 2064 6976 6d6f 6428  v, mod = divmod(
+00044280: 6e70 6172 7469 7469 6f6e 732c 2064 662e  npartitions, df.
+00044290: 6e70 6172 7469 7469 6f6e 7329 0a20 2020  npartitions).   
+000442a0: 2020 2020 2020 2020 206e 7370 6c69 7473           nsplits
+000442b0: 203d 205b 6469 765d 202a 2064 662e 6e70   = [div] * df.np
+000442c0: 6172 7469 7469 6f6e 730a 2020 2020 2020  artitions.      
+000442d0: 2020 2020 2020 6e73 706c 6974 735b 2d31        nsplits[-1
+000442e0: 5d20 2b3d 206d 6f64 0a20 2020 2020 2020  ] += mod.       
+000442f0: 2020 2020 2072 6574 7572 6e20 5f73 706c       return _spl
+00044300: 6974 5f70 6172 7469 7469 6f6e 7328 6466  it_partitions(df
+00044310: 2c20 6e73 706c 6974 732c 206e 6577 5f6e  , nsplits, new_n
+00044320: 616d 6529 0a0a 0a64 6566 205f 7265 7061  ame)...def _repa
+00044330: 7274 6974 696f 6e5f 6672 6f6d 5f62 6f75  rtition_from_bou
+00044340: 6e64 6172 6965 7328 6466 2c20 6e65 775f  ndaries(df, new_
+00044350: 7061 7274 6974 696f 6e73 5f62 6f75 6e64  partitions_bound
+00044360: 6172 6965 732c 206e 6577 5f6e 616d 6529  aries, new_name)
+00044370: 3a0a 2020 2020 6966 206e 6f74 2069 7369  :.    if not isi
+00044380: 6e73 7461 6e63 6528 6e65 775f 7061 7274  nstance(new_part
+00044390: 6974 696f 6e73 5f62 6f75 6e64 6172 6965  itions_boundarie
+000443a0: 732c 206c 6973 7429 3a0a 2020 2020 2020  s, list):.      
+000443b0: 2020 6e65 775f 7061 7274 6974 696f 6e73    new_partitions
+000443c0: 5f62 6f75 6e64 6172 6965 7320 3d20 6c69  _boundaries = li
+000443d0: 7374 286e 6577 5f70 6172 7469 7469 6f6e  st(new_partition
+000443e0: 735f 626f 756e 6461 7269 6573 290a 2020  s_boundaries).  
+000443f0: 2020 6966 206e 6577 5f70 6172 7469 7469    if new_partiti
+00044400: 6f6e 735f 626f 756e 6461 7269 6573 5b30  ons_boundaries[0
+00044410: 5d20 3e20 303a 0a20 2020 2020 2020 206e  ] > 0:.        n
+00044420: 6577 5f70 6172 7469 7469 6f6e 735f 626f  ew_partitions_bo
+00044430: 756e 6461 7269 6573 2e69 6e73 6572 7428  undaries.insert(
+00044440: 302c 2030 290a 2020 2020 6966 206e 6577  0, 0).    if new
+00044450: 5f70 6172 7469 7469 6f6e 735f 626f 756e  _partitions_boun
+00044460: 6461 7269 6573 5b2d 315d 203c 2064 662e  daries[-1] < df.
+00044470: 6e70 6172 7469 7469 6f6e 733a 0a20 2020  npartitions:.   
+00044480: 2020 2020 206e 6577 5f70 6172 7469 7469       new_partiti
+00044490: 6f6e 735f 626f 756e 6461 7269 6573 2e61  ons_boundaries.a
+000444a0: 7070 656e 6428 6466 2e6e 7061 7274 6974  ppend(df.npartit
+000444b0: 696f 6e73 290a 2020 2020 6473 6b20 3d20  ions).    dsk = 
+000444c0: 7b7d 0a20 2020 2066 6f72 2069 2c20 2873  {}.    for i, (s
+000444d0: 7461 7274 2c20 656e 6429 2069 6e20 656e  tart, end) in en
+000444e0: 756d 6572 6174 6528 0a20 2020 2020 2020  umerate(.       
+000444f0: 207a 6970 286e 6577 5f70 6172 7469 7469   zip(new_partiti
+00044500: 6f6e 735f 626f 756e 6461 7269 6573 2c20  ons_boundaries, 
+00044510: 6e65 775f 7061 7274 6974 696f 6e73 5f62  new_partitions_b
+00044520: 6f75 6e64 6172 6965 735b 313a 5d29 0a20  oundaries[1:]). 
+00044530: 2020 2029 3a0a 2020 2020 2020 2020 6473     ):.        ds
+00044540: 6b5b 6e65 775f 6e61 6d65 2c20 695d 203d  k[new_name, i] =
+00044550: 2028 6d65 7468 6f64 732e 636f 6e63 6174   (methods.concat
+00044560: 2c20 5b28 6466 2e5f 6e61 6d65 2c20 6a29  , [(df._name, j)
+00044570: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
+00044580: 7374 6172 742c 2065 6e64 295d 290a 2020  start, end)]).  
+00044590: 2020 6469 7669 7369 6f6e 7320 3d20 5b64    divisions = [d
+000445a0: 662e 6469 7669 7369 6f6e 735b 695d 2066  f.divisions[i] f
+000445b0: 6f72 2069 2069 6e20 6e65 775f 7061 7274  or i in new_part
+000445c0: 6974 696f 6e73 5f62 6f75 6e64 6172 6965  itions_boundarie
+000445d0: 735d 0a20 2020 2067 7261 7068 203d 2048  s].    graph = H
+000445e0: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
+000445f0: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 286e  om_collections(n
+00044600: 6577 5f6e 616d 652c 2064 736b 2c20 6465  ew_name, dsk, de
+00044610: 7065 6e64 656e 6369 6573 3d5b 6466 5d29  pendencies=[df])
+00044620: 0a20 2020 2072 6574 7572 6e20 6e65 775f  .    return new_
+00044630: 6464 5f6f 626a 6563 7428 6772 6170 682c  dd_object(graph,
+00044640: 206e 6577 5f6e 616d 652c 2064 662e 5f6d   new_name, df._m
+00044650: 6574 612c 2064 6976 6973 696f 6e73 290a  eta, divisions).
+00044660: 0a0a 6465 6620 5f73 706c 6974 5f70 6172  ..def _split_par
+00044670: 7469 7469 6f6e 7328 6466 2c20 6e73 706c  titions(df, nspl
+00044680: 6974 732c 206e 6577 5f6e 616d 6529 3a0a  its, new_name):.
+00044690: 2020 2020 2222 2253 706c 6974 2061 2044      """Split a D
+000446a0: 6173 6b20 6461 7461 6672 616d 6520 696e  ask dataframe in
+000446b0: 746f 206e 6577 2070 6172 7469 7469 6f6e  to new partition
+000446c0: 730a 0a20 2020 2050 6172 616d 6574 6572  s..    Parameter
+000446d0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+000446e0: 0a20 2020 2064 663a 2044 6174 6146 7261  .    df: DataFra
+000446f0: 6d65 206f 7220 5365 7269 6573 0a20 2020  me or Series.   
+00044700: 206e 7370 6c69 7473 3a20 4c69 7374 5b69   nsplits: List[i
+00044710: 6e74 5d0a 2020 2020 2020 2020 4e75 6d62  nt].        Numb
+00044720: 6572 206f 6620 7461 7267 6574 2064 6174  er of target dat
+00044730: 6166 7261 6d65 7320 666f 7220 6561 6368  aframes for each
+00044740: 2070 6172 7469 7469 6f6e 0a20 2020 2020   partition.     
+00044750: 2020 2054 6865 206c 656e 6774 6820 6f66     The length of
+00044760: 206e 7370 6c69 7473 2073 686f 756c 6420   nsplits should 
+00044770: 6265 2074 6865 2073 616d 6520 6173 2064  be the same as d
+00044780: 662e 6e70 6172 7469 7469 6f6e 730a 2020  f.npartitions.  
+00044790: 2020 6e65 775f 6e61 6d65 3a20 7374 720a    new_name: str.
+000447a0: 0a20 2020 2053 6565 2041 6c73 6f0a 2020  .    See Also.  
+000447b0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2072    --------.    r
+000447c0: 6570 6172 7469 7469 6f6e 5f6e 7061 7274  epartition_npart
+000447d0: 6974 696f 6e73 0a20 2020 2072 6570 6172  itions.    repar
+000447e0: 7469 7469 6f6e 5f73 697a 650a 2020 2020  tition_size.    
+000447f0: 2222 220a 2020 2020 6966 206c 656e 286e  """.    if len(n
+00044800: 7370 6c69 7473 2920 213d 2064 662e 6e70  splits) != df.np
+00044810: 6172 7469 7469 6f6e 733a 0a20 2020 2020  artitions:.     
+00044820: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00044830: 726f 7228 6622 6e73 706c 6974 7320 7368  ror(f"nsplits sh
+00044840: 6f75 6c64 2068 6176 6520 6c65 6e3d 7b64  ould have len={d
+00044850: 662e 6e70 6172 7469 7469 6f6e 737d 2229  f.npartitions}")
+00044860: 0a0a 2020 2020 6473 6b20 3d20 7b7d 0a20  ..    dsk = {}. 
+00044870: 2020 2073 706c 6974 5f6e 616d 6520 3d20     split_name = 
+00044880: 6622 7370 6c69 742d 7b74 6f6b 656e 697a  f"split-{tokeniz
+00044890: 6528 6466 2c20 6e73 706c 6974 7329 7d22  e(df, nsplits)}"
+000448a0: 0a20 2020 206a 203d 2030 0a20 2020 2066  .    j = 0.    f
+000448b0: 6f72 2069 2c20 6b20 696e 2065 6e75 6d65  or i, k in enume
+000448c0: 7261 7465 286e 7370 6c69 7473 293a 0a20  rate(nsplits):. 
+000448d0: 2020 2020 2020 2069 6620 6b20 3d3d 2031         if k == 1
+000448e0: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
+000448f0: 6b5b 6e65 775f 6e61 6d65 2c20 6a5d 203d  k[new_name, j] =
+00044900: 2028 6466 2e5f 6e61 6d65 2c20 6929 0a20   (df._name, i). 
+00044910: 2020 2020 2020 2020 2020 206a 202b 3d20             j += 
+00044920: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
+00044930: 2020 2020 2020 2020 2020 2020 6473 6b5b              dsk[
+00044940: 7370 6c69 745f 6e61 6d65 2c20 695d 203d  split_name, i] =
+00044950: 2028 7370 6c69 745f 6576 656e 6c79 2c20   (split_evenly, 
+00044960: 2864 662e 5f6e 616d 652c 2069 292c 206b  (df._name, i), k
+00044970: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00044980: 7220 6a6a 2069 6e20 7261 6e67 6528 6b29  r jj in range(k)
+00044990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000449a0: 2020 6473 6b5b 6e65 775f 6e61 6d65 2c20    dsk[new_name, 
+000449b0: 6a5d 203d 2028 6765 7469 7465 6d2c 2028  j] = (getitem, (
+000449c0: 7370 6c69 745f 6e61 6d65 2c20 6929 2c20  split_name, i), 
+000449d0: 6a6a 290a 2020 2020 2020 2020 2020 2020  jj).            
+000449e0: 2020 2020 6a20 2b3d 2031 0a0a 2020 2020      j += 1..    
+000449f0: 6469 7669 7369 6f6e 7320 3d20 5b4e 6f6e  divisions = [Non
+00044a00: 655d 202a 2028 3120 2b20 7375 6d28 6e73  e] * (1 + sum(ns
+00044a10: 706c 6974 7329 290a 2020 2020 6772 6170  plits)).    grap
+00044a20: 6820 3d20 4869 6768 4c65 7665 6c47 7261  h = HighLevelGra
+00044a30: 7068 2e66 726f 6d5f 636f 6c6c 6563 7469  ph.from_collecti
+00044a40: 6f6e 7328 6e65 775f 6e61 6d65 2c20 6473  ons(new_name, ds
+00044a50: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
+00044a60: 5b64 665d 290a 2020 2020 7265 7475 726e  [df]).    return
+00044a70: 206e 6577 5f64 645f 6f62 6a65 6374 2867   new_dd_object(g
+00044a80: 7261 7068 2c20 6e65 775f 6e61 6d65 2c20  raph, new_name, 
+00044a90: 6466 2e5f 6d65 7461 2c20 6469 7669 7369  df._meta, divisi
+00044aa0: 6f6e 7329 0a0a 0a64 6566 2072 6570 6172  ons)...def repar
+00044ab0: 7469 7469 6f6e 2864 662c 2064 6976 6973  tition(df, divis
+00044ac0: 696f 6e73 3d4e 6f6e 652c 2066 6f72 6365  ions=None, force
+00044ad0: 3d46 616c 7365 293a 0a20 2020 2022 2222  =False):.    """
+00044ae0: 5265 7061 7274 6974 696f 6e20 6461 7461  Repartition data
+00044af0: 6672 616d 6520 616c 6f6e 6720 6e65 7720  frame along new 
+00044b00: 6469 7669 7369 6f6e 730a 0a20 2020 2044  divisions..    D
+00044b10: 6173 6b2e 4461 7461 4672 616d 6520 6f62  ask.DataFrame ob
+00044b20: 6a65 6374 7320 6172 6520 7061 7274 6974  jects are partit
+00044b30: 696f 6e65 6420 616c 6f6e 6720 7468 6569  ioned along thei
+00044b40: 7220 696e 6465 782e 2020 4f66 7465 6e20  r index.  Often 
+00044b50: 7768 656e 0a20 2020 206d 756c 7469 706c  when.    multipl
+00044b60: 6520 6461 7461 6672 616d 6573 2069 6e74  e dataframes int
+00044b70: 6572 6163 7420 7765 206e 6565 6420 746f  eract we need to
+00044b80: 2061 6c69 676e 2074 6865 7365 2070 6172   align these par
+00044b90: 7469 7469 6f6e 696e 6773 2e20 2054 6865  titionings.  The
+00044ba0: 0a20 2020 2060 6072 6570 6172 7469 7469  .    ``repartiti
+00044bb0: 6f6e 6060 2066 756e 6374 696f 6e20 636f  on`` function co
+00044bc0: 6e73 7472 7563 7473 2061 206e 6577 2044  nstructs a new D
+00044bd0: 6174 6146 7261 6d65 206f 626a 6563 7420  ataFrame object 
+00044be0: 686f 6c64 696e 6720 7468 6520 7361 6d65  holding the same
+00044bf0: 0a20 2020 2064 6174 6120 6275 7420 7061  .    data but pa
+00044c00: 7274 6974 696f 6e65 6420 6f6e 2064 6966  rtitioned on dif
+00044c10: 6665 7265 6e74 2076 616c 7565 732e 2020  ferent values.  
+00044c20: 4974 2064 6f65 7320 7468 6973 2062 7920  It does this by 
+00044c30: 7065 7266 6f72 6d69 6e67 2061 0a20 2020  performing a.   
+00044c40: 2073 6571 7565 6e63 6520 6f66 2060 606c   sequence of ``l
+00044c50: 6f63 6060 2061 6e64 2060 6063 6f6e 6361  oc`` and ``conca
+00044c60: 7460 6020 6361 6c6c 7320 746f 2073 706c  t`` calls to spl
+00044c70: 6974 2061 6e64 206d 6572 6765 2074 6865  it and merge the
+00044c80: 2070 7265 7669 6f75 730a 2020 2020 6765   previous.    ge
+00044c90: 6e65 7261 7469 6f6e 206f 6620 7061 7274  neration of part
+00044ca0: 6974 696f 6e73 2e0a 0a20 2020 2050 6172  itions...    Par
+00044cb0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00044cc0: 2d2d 2d2d 2d2d 0a0a 2020 2020 6469 7669  ------..    divi
+00044cd0: 7369 6f6e 7320 3a20 6c69 7374 0a20 2020  sions : list.   
+00044ce0: 2020 2020 204c 6973 7420 6f66 2070 6172       List of par
+00044cf0: 7469 7469 6f6e 7320 746f 2062 6520 7573  titions to be us
+00044d00: 6564 0a20 2020 2066 6f72 6365 203a 2062  ed.    force : b
+00044d10: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
+00044d20: 7365 0a20 2020 2020 2020 2041 6c6c 6f77  se.        Allow
+00044d30: 7320 7468 6520 6578 7061 6e73 696f 6e20  s the expansion 
+00044d40: 6f66 2074 6865 2065 7869 7374 696e 6720  of the existing 
+00044d50: 6469 7669 7369 6f6e 732e 0a20 2020 2020  divisions..     
+00044d60: 2020 2049 6620 4661 6c73 6520 7468 656e     If False then
+00044d70: 2074 6865 206e 6577 2064 6976 6973 696f   the new divisio
+00044d80: 6e73 206c 6f77 6572 2061 6e64 2075 7070  ns lower and upp
+00044d90: 6572 2062 6f75 6e64 7320 6d75 7374 2062  er bounds must b
+00044da0: 650a 2020 2020 2020 2020 7468 6520 7361  e.        the sa
+00044db0: 6d65 2061 7320 7468 6520 6f6c 6420 6469  me as the old di
+00044dc0: 7669 7369 6f6e 732e 0a0a 2020 2020 4578  visions...    Ex
+00044dd0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+00044de0: 2d2d 2d0a 0a20 2020 203e 3e3e 2064 6620  ---..    >>> df 
+00044df0: 3d20 6466 2e72 6570 6172 7469 7469 6f6e  = df.repartition
+00044e00: 285b 302c 2035 2c20 3130 2c20 3230 5d29  ([0, 5, 10, 20])
+00044e10: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00044e20: 4950 0a0a 2020 2020 416c 736f 2077 6f72  IP..    Also wor
+00044e30: 6b73 206f 6e20 5061 6e64 6173 206f 626a  ks on Pandas obj
+00044e40: 6563 7473 0a0a 2020 2020 3e3e 3e20 6464  ects..    >>> dd
+00044e50: 6620 3d20 6464 2e72 6570 6172 7469 7469  f = dd.repartiti
+00044e60: 6f6e 2864 662c 205b 302c 2035 2c20 3130  on(df, [0, 5, 10
+00044e70: 2c20 3230 5d29 2020 2320 646f 6374 6573  , 20])  # doctes
+00044e80: 743a 202b 534b 4950 0a20 2020 2022 2222  t: +SKIP.    """
+00044e90: 0a0a 2020 2020 2320 6e6f 2d6f 7020 6661  ..    # no-op fa
+00044ea0: 7374 7061 7468 2066 6f72 2077 6865 6e20  stpath for when 
+00044eb0: 7765 2061 6c72 6561 6479 2068 6176 6520  we already have 
+00044ec0: 6d61 7463 6869 6e67 2064 6976 6973 696f  matching divisio
+00044ed0: 6e73 0a20 2020 2069 6620 6973 5f64 6173  ns.    if is_das
+00044ee0: 6b5f 636f 6c6c 6563 7469 6f6e 2864 6629  k_collection(df)
+00044ef0: 2061 6e64 2064 662e 6469 7669 7369 6f6e   and df.division
+00044f00: 7320 3d3d 2064 6976 6973 696f 6e73 3a0a  s == divisions:.
+00044f10: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00044f20: 660a 0a20 2020 2074 6f6b 656e 203d 2074  f..    token = t
+00044f30: 6f6b 656e 697a 6528 6466 2c20 6469 7669  okenize(df, divi
+00044f40: 7369 6f6e 7329 0a20 2020 2069 6620 6973  sions).    if is
+00044f50: 696e 7374 616e 6365 2864 662c 205f 4672  instance(df, _Fr
+00044f60: 616d 6529 3a0a 2020 2020 2020 2020 746d  ame):.        tm
+00044f70: 7020 3d20 2272 6570 6172 7469 7469 6f6e  p = "repartition
+00044f80: 2d73 706c 6974 2d22 202b 2074 6f6b 656e  -split-" + token
+00044f90: 0a20 2020 2020 2020 206f 7574 203d 2022  .        out = "
+00044fa0: 7265 7061 7274 6974 696f 6e2d 6d65 7267  repartition-merg
+00044fb0: 652d 2220 2b20 746f 6b65 6e0a 2020 2020  e-" + token.    
+00044fc0: 2020 2020 6473 6b20 3d20 7265 7061 7274      dsk = repart
+00044fd0: 6974 696f 6e5f 6469 7669 7369 6f6e 7328  ition_divisions(
+00044fe0: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
+00044ff0: 6469 7669 7369 6f6e 732c 2064 6976 6973  divisions, divis
+00045000: 696f 6e73 2c20 6466 2e5f 6e61 6d65 2c20  ions, df._name, 
+00045010: 746d 702c 206f 7574 2c20 666f 7263 653d  tmp, out, force=
+00045020: 666f 7263 650a 2020 2020 2020 2020 290a  force.        ).
+00045030: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
+00045040: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+00045050: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+00045060: 6f75 742c 2064 736b 2c20 6465 7065 6e64  out, dsk, depend
+00045070: 656e 6369 6573 3d5b 6466 5d29 0a20 2020  encies=[df]).   
+00045080: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+00045090: 6464 5f6f 626a 6563 7428 6772 6170 682c  dd_object(graph,
+000450a0: 206f 7574 2c20 6466 2e5f 6d65 7461 2c20   out, df._meta, 
+000450b0: 6469 7669 7369 6f6e 7329 0a20 2020 2065  divisions).    e
+000450c0: 6c69 6620 6973 5f64 6174 6166 7261 6d65  lif is_dataframe
+000450d0: 5f6c 696b 6528 6466 2920 6f72 2069 735f  _like(df) or is_
+000450e0: 7365 7269 6573 5f6c 696b 6528 6466 293a  series_like(df):
+000450f0: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
+00045100: 2272 6570 6172 7469 7469 6f6e 2d64 6174  "repartition-dat
+00045110: 6166 7261 6d65 2d22 202b 2074 6f6b 656e  aframe-" + token
+00045120: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00045130: 736b 2e64 6174 6166 7261 6d65 2e75 7469  sk.dataframe.uti
+00045140: 6c73 2069 6d70 6f72 7420 7368 6172 645f  ls import shard_
+00045150: 6466 5f6f 6e5f 696e 6465 780a 0a20 2020  df_on_index..   
+00045160: 2020 2020 2064 6673 203d 2073 6861 7264       dfs = shard
+00045170: 5f64 665f 6f6e 5f69 6e64 6578 2864 662c  _df_on_index(df,
+00045180: 2064 6976 6973 696f 6e73 5b31 3a2d 315d   divisions[1:-1]
+00045190: 290a 2020 2020 2020 2020 6473 6b20 3d20  ).        dsk = 
+000451a0: 7b28 6e61 6d65 2c20 6929 3a20 6466 2066  {(name, i): df f
+000451b0: 6f72 2069 2c20 6466 2069 6e20 656e 756d  or i, df in enum
+000451c0: 6572 6174 6528 6466 7329 7d0a 2020 2020  erate(dfs)}.    
+000451d0: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
+000451e0: 645f 6f62 6a65 6374 2864 736b 2c20 6e61  d_object(dsk, na
+000451f0: 6d65 2c20 6466 2c20 6469 7669 7369 6f6e  me, df, division
+00045200: 7329 0a20 2020 2072 6169 7365 2056 616c  s).    raise Val
+00045210: 7565 4572 726f 7228 2244 6174 6120 6d75  ueError("Data mu
+00045220: 7374 2062 6520 4461 7461 4672 616d 6520  st be DataFrame 
+00045230: 6f72 2053 6572 6965 7322 290a 0a0a 6465  or Series")...de
+00045240: 6620 5f72 6564 7563 7469 6f6e 5f63 6875  f _reduction_chu
+00045250: 6e6b 2878 2c20 6163 615f 6368 756e 6b3d  nk(x, aca_chunk=
+00045260: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00045270: 0a20 2020 206f 203d 2061 6361 5f63 6875  .    o = aca_chu
+00045280: 6e6b 2878 2c20 2a2a 6b77 6172 6773 290a  nk(x, **kwargs).
+00045290: 2020 2020 2320 5265 7475 726e 2061 2064      # Return a d
+000452a0: 6174 6166 7261 6d65 2073 6f20 7468 6174  ataframe so that
+000452b0: 2074 6865 2063 6f6e 6361 7465 6e61 7465   the concatenate
+000452c0: 6420 7665 7273 696f 6e20 6973 2061 6c73  d version is als
+000452d0: 6f20 6120 6461 7461 6672 616d 650a 2020  o a dataframe.  
+000452e0: 2020 6966 206e 6f74 2069 735f 7365 7269    if not is_seri
+000452f0: 6573 5f6c 696b 6528 6f29 3a0a 2020 2020  es_like(o):.    
+00045300: 2020 2020 7265 7475 726e 206f 0a20 2020      return o.   
+00045310: 2072 6573 756c 7420 3d20 6f2e 746f 5f66   result = o.to_f
+00045320: 7261 6d65 2829 2e54 0a20 2020 2069 6620  rame().T.    if 
+00045330: 6f2e 6474 7970 652e 6b69 6e64 203d 3d20  o.dtype.kind == 
+00045340: 224f 223a 0a20 2020 2020 2020 2023 2057  "O":.        # W
+00045350: 6173 2063 6f65 7263 6564 2074 6f20 6f62  as coerced to ob
+00045360: 6a65 6374 2c20 736f 2063 6173 7420 6261  ject, so cast ba
+00045370: 636b 0a20 2020 2020 2020 2072 6574 7572  ck.        retur
+00045380: 6e20 7265 7375 6c74 2e69 6e66 6572 5f6f  n result.infer_o
+00045390: 626a 6563 7473 2829 0a20 2020 2072 6574  bjects().    ret
+000453a0: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+000453b0: 205f 7265 6475 6374 696f 6e5f 636f 6d62   _reduction_comb
+000453c0: 696e 6528 782c 2061 6361 5f63 6f6d 6269  ine(x, aca_combi
+000453d0: 6e65 3d4e 6f6e 652c 202a 2a6b 7761 7267  ne=None, **kwarg
+000453e0: 7329 3a0a 2020 2020 6966 2069 7369 6e73  s):.    if isins
+000453f0: 7461 6e63 6528 782c 206c 6973 7429 3a0a  tance(x, list):.
+00045400: 2020 2020 2020 2020 7820 3d20 7064 2e53          x = pd.S
+00045410: 6572 6965 7328 7829 0a20 2020 206f 203d  eries(x).    o =
+00045420: 2061 6361 5f63 6f6d 6269 6e65 2878 2c20   aca_combine(x, 
+00045430: 2a2a 6b77 6172 6773 290a 2020 2020 2320  **kwargs).    # 
+00045440: 5265 7475 726e 2061 2064 6174 6166 7261  Return a datafra
+00045450: 6d65 2073 6f20 7468 6174 2074 6865 2063  me so that the c
+00045460: 6f6e 6361 7465 6e61 7465 6420 7665 7273  oncatenated vers
+00045470: 696f 6e20 6973 2061 6c73 6f20 6120 6461  ion is also a da
+00045480: 7461 6672 616d 650a 2020 2020 7265 7475  taframe.    retu
+00045490: 726e 206f 2e74 6f5f 6672 616d 6528 292e  rn o.to_frame().
+000454a0: 5420 6966 2069 735f 7365 7269 6573 5f6c  T if is_series_l
+000454b0: 696b 6528 6f29 2065 6c73 6520 6f0a 0a0a  ike(o) else o...
+000454c0: 6465 6620 5f72 6564 7563 7469 6f6e 5f61  def _reduction_a
+000454d0: 6767 7265 6761 7465 2878 2c20 6163 615f  ggregate(x, aca_
+000454e0: 6167 6772 6567 6174 653d 4e6f 6e65 2c20  aggregate=None, 
+000454f0: 2a2a 6b77 6172 6773 293a 0a20 2020 2069  **kwargs):.    i
+00045500: 6620 6973 696e 7374 616e 6365 2878 2c20  f isinstance(x, 
+00045510: 6c69 7374 293a 0a20 2020 2020 2020 2078  list):.        x
+00045520: 203d 2070 642e 5365 7269 6573 2878 290a   = pd.Series(x).
+00045530: 2020 2020 7265 7475 726e 2061 6361 5f61      return aca_a
+00045540: 6767 7265 6761 7465 2878 2c20 2a2a 6b77  ggregate(x, **kw
+00045550: 6172 6773 290a 0a0a 6465 6620 6964 786d  args)...def idxm
+00045560: 6178 6d69 6e5f 6368 756e 6b28 782c 2066  axmin_chunk(x, f
+00045570: 6e3d 4e6f 6e65 2c20 736b 6970 6e61 3d54  n=None, skipna=T
+00045580: 7275 652c 206e 756d 6572 6963 5f6f 6e6c  rue, numeric_onl
+00045590: 793d 4661 6c73 6529 3a0a 2020 2020 6e75  y=False):.    nu
+000455a0: 6d65 7269 635f 6f6e 6c79 5f6b 7761 7267  meric_only_kwarg
+000455b0: 7320 3d20 280a 2020 2020 2020 2020 7b7d  s = (.        {}
+000455c0: 2069 6620 6e6f 7420 5041 4e44 4153 5f47   if not PANDAS_G
+000455d0: 545f 3135 3020 6f72 2069 735f 7365 7269  T_150 or is_seri
+000455e0: 6573 5f6c 696b 6528 7829 2065 6c73 6520  es_like(x) else 
+000455f0: 7b22 6e75 6d65 7269 635f 6f6e 6c79 223a  {"numeric_only":
+00045600: 206e 756d 6572 6963 5f6f 6e6c 797d 0a20   numeric_only}. 
+00045610: 2020 2029 0a20 2020 206d 696e 6d61 7820     ).    minmax 
+00045620: 3d20 226d 6178 2220 6966 2066 6e20 3d3d  = "max" if fn ==
+00045630: 2022 6964 786d 6178 2220 656c 7365 2022   "idxmax" else "
+00045640: 6d69 6e22 0a20 2020 2069 6620 6c65 6e28  min".    if len(
+00045650: 7829 203e 2030 3a0a 2020 2020 2020 2020  x) > 0:.        
+00045660: 6964 7820 3d20 6765 7461 7474 7228 782c  idx = getattr(x,
+00045670: 2066 6e29 2873 6b69 706e 613d 736b 6970   fn)(skipna=skip
+00045680: 6e61 2c20 2a2a 6e75 6d65 7269 635f 6f6e  na, **numeric_on
+00045690: 6c79 5f6b 7761 7267 7329 0a20 2020 2020  ly_kwargs).     
+000456a0: 2020 2076 616c 7565 203d 2067 6574 6174     value = getat
+000456b0: 7472 2878 2c20 6d69 6e6d 6178 2928 736b  tr(x, minmax)(sk
+000456c0: 6970 6e61 3d73 6b69 706e 612c 202a 2a6e  ipna=skipna, **n
+000456d0: 756d 6572 6963 5f6f 6e6c 795f 6b77 6172  umeric_only_kwar
+000456e0: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
+000456f0: 2020 2020 2020 6964 7820 3d20 7661 6c75        idx = valu
+00045700: 6520 3d20 6d65 7461 5f73 6572 6965 735f  e = meta_series_
+00045710: 636f 6e73 7472 7563 746f 7228 7829 285b  constructor(x)([
+00045720: 5d2c 2064 7479 7065 3d22 6938 2229 0a20  ], dtype="i8"). 
+00045730: 2020 2069 6620 6973 5f73 6572 6965 735f     if is_series_
+00045740: 6c69 6b65 2869 6478 293a 0a20 2020 2020  like(idx):.     
+00045750: 2020 2072 6574 7572 6e20 6d65 7461 5f66     return meta_f
+00045760: 7261 6d65 5f63 6f6e 7374 7275 6374 6f72  rame_constructor
+00045770: 2878 2928 7b22 6964 7822 3a20 6964 782c  (x)({"idx": idx,
+00045780: 2022 7661 6c75 6522 3a20 7661 6c75 657d   "value": value}
+00045790: 290a 2020 2020 7265 7475 726e 206d 6574  ).    return met
+000457a0: 615f 6672 616d 655f 636f 6e73 7472 7563  a_frame_construc
+000457b0: 746f 7228 7829 287b 2269 6478 223a 205b  tor(x)({"idx": [
+000457c0: 6964 785d 2c20 2276 616c 7565 223a 205b  idx], "value": [
+000457d0: 7661 6c75 655d 7d29 0a0a 0a64 6566 2069  value]})...def i
+000457e0: 6478 6d61 786d 696e 5f72 6f77 2878 2c20  dxmaxmin_row(x, 
+000457f0: 666e 3d4e 6f6e 652c 2073 6b69 706e 613d  fn=None, skipna=
+00045800: 5472 7565 293a 0a20 2020 206d 696e 6d61  True):.    minma
+00045810: 7820 3d20 226d 6178 2220 6966 2066 6e20  x = "max" if fn 
+00045820: 3d3d 2022 6964 786d 6178 2220 656c 7365  == "idxmax" else
+00045830: 2022 6d69 6e22 0a20 2020 2069 6620 6c65   "min".    if le
+00045840: 6e28 7829 203e 2030 3a0a 2020 2020 2020  n(x) > 0:.      
+00045850: 2020 7820 3d20 782e 7365 745f 696e 6465    x = x.set_inde
+00045860: 7828 2269 6478 2229 0a20 2020 2020 2020  x("idx").       
+00045870: 2023 2070 6f74 656e 7469 616c 6c79 2063   # potentially c
+00045880: 6f65 7263 6564 2074 6f20 6f62 6a65 6374  oerced to object
+00045890: 2c20 736f 2063 6173 7420 6261 636b 0a20  , so cast back. 
+000458a0: 2020 2020 2020 2076 616c 7565 203d 2078         value = x
+000458b0: 2e76 616c 7565 2e69 6e66 6572 5f6f 626a  .value.infer_obj
+000458c0: 6563 7473 2829 0a20 2020 2020 2020 2069  ects().        i
+000458d0: 6478 203d 205b 6765 7461 7474 7228 7661  dx = [getattr(va
+000458e0: 6c75 652c 2066 6e29 2873 6b69 706e 613d  lue, fn)(skipna=
+000458f0: 736b 6970 6e61 295d 0a20 2020 2020 2020  skipna)].       
+00045900: 2076 616c 7565 203d 205b 6765 7461 7474   value = [getatt
+00045910: 7228 7661 6c75 652c 206d 696e 6d61 7829  r(value, minmax)
+00045920: 2873 6b69 706e 613d 736b 6970 6e61 295d  (skipna=skipna)]
+00045930: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00045940: 2020 2069 6478 203d 2076 616c 7565 203d     idx = value =
+00045950: 206d 6574 615f 7365 7269 6573 5f63 6f6e   meta_series_con
+00045960: 7374 7275 6374 6f72 2878 2928 5b5d 2c20  structor(x)([], 
+00045970: 6474 7970 653d 2269 3822 290a 2020 2020  dtype="i8").    
+00045980: 7265 7475 726e 206d 6574 615f 6672 616d  return meta_fram
+00045990: 655f 636f 6e73 7472 7563 746f 7228 7829  e_constructor(x)
+000459a0: 280a 2020 2020 2020 2020 7b0a 2020 2020  (.        {.    
+000459b0: 2020 2020 2020 2020 2269 6478 223a 206d          "idx": m
+000459c0: 6574 615f 7365 7269 6573 5f63 6f6e 7374  eta_series_const
+000459d0: 7275 6374 6f72 2878 2928 6964 782c 2064  ructor(x)(idx, d
+000459e0: 7479 7065 3d78 2e69 6e64 6578 2e64 7479  type=x.index.dty
+000459f0: 7065 292c 0a20 2020 2020 2020 2020 2020  pe),.           
+00045a00: 2022 7661 6c75 6522 3a20 6d65 7461 5f73   "value": meta_s
+00045a10: 6572 6965 735f 636f 6e73 7472 7563 746f  eries_constructo
+00045a20: 7228 7829 2876 616c 7565 2c20 6474 7970  r(x)(value, dtyp
+00045a30: 653d 782e 6474 7970 6573 2e69 6c6f 635b  e=x.dtypes.iloc[
+00045a40: 305d 292c 0a20 2020 2020 2020 207d 0a20  0]),.        }. 
+00045a50: 2020 2029 0a0a 0a64 6566 2069 6478 6d61     )...def idxma
+00045a60: 786d 696e 5f63 6f6d 6269 6e65 2878 2c20  xmin_combine(x, 
+00045a70: 666e 3d4e 6f6e 652c 2073 6b69 706e 613d  fn=None, skipna=
+00045a80: 5472 7565 293a 0a20 2020 2069 6620 6c65  True):.    if le
+00045a90: 6e28 7829 203c 3d20 313a 0a20 2020 2020  n(x) <= 1:.     
+00045aa0: 2020 2072 6574 7572 6e20 780a 2020 2020     return x.    
+00045ab0: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
+00045ac0: 2078 2e67 726f 7570 6279 286c 6576 656c   x.groupby(level
+00045ad0: 3d30 290a 2020 2020 2020 2020 2e61 7070  =0).        .app
+00045ae0: 6c79 2869 6478 6d61 786d 696e 5f72 6f77  ly(idxmaxmin_row
+00045af0: 2c20 666e 3d66 6e2c 2073 6b69 706e 613d  , fn=fn, skipna=
+00045b00: 736b 6970 6e61 290a 2020 2020 2020 2020  skipna).        
+00045b10: 2e72 6573 6574 5f69 6e64 6578 286c 6576  .reset_index(lev
+00045b20: 656c 3d31 2c20 6472 6f70 3d54 7275 6529  el=1, drop=True)
+00045b30: 0a20 2020 2029 0a0a 0a64 6566 2069 6478  .    )...def idx
+00045b40: 6d61 786d 696e 5f61 6767 2878 2c20 666e  maxmin_agg(x, fn
+00045b50: 3d4e 6f6e 652c 2073 6b69 706e 613d 5472  =None, skipna=Tr
+00045b60: 7565 2c20 7363 616c 6172 3d46 616c 7365  ue, scalar=False
+00045b70: 2c20 6e75 6d65 7269 635f 6f6e 6c79 3d6e  , numeric_only=n
+00045b80: 6f5f 6465 6661 756c 7429 3a0a 2020 2020  o_default):.    
+00045b90: 7265 7320 3d20 6964 786d 6178 6d69 6e5f  res = idxmaxmin_
+00045ba0: 636f 6d62 696e 6528 782c 2066 6e2c 2073  combine(x, fn, s
+00045bb0: 6b69 706e 613d 736b 6970 6e61 295b 2269  kipna=skipna)["i
+00045bc0: 6478 225d 0a20 2020 2069 6620 6c65 6e28  dx"].    if len(
+00045bd0: 7265 7329 203d 3d20 303a 0a20 2020 2020  res) == 0:.     
+00045be0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00045bf0: 726f 7228 2261 7474 656d 7074 2074 6f20  ror("attempt to 
+00045c00: 6765 7420 6172 676d 6178 206f 6620 616e  get argmax of an
+00045c10: 2065 6d70 7479 2073 6571 7565 6e63 6522   empty sequence"
+00045c20: 290a 2020 2020 6966 2073 6361 6c61 723a  ).    if scalar:
+00045c30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00045c40: 7265 735b 305d 0a20 2020 2072 6573 2e6e  res[0].    res.n
+00045c50: 616d 6520 3d20 4e6f 6e65 0a20 2020 2072  ame = None.    r
+00045c60: 6574 7572 6e20 7265 730a 0a0a 6465 6620  eturn res...def 
+00045c70: 5f6d 6f64 655f 6167 6772 6567 6174 6528  _mode_aggregate(
+00045c80: 6466 2c20 6472 6f70 6e61 293a 0a20 2020  df, dropna):.   
+00045c90: 2076 616c 7565 5f63 6f75 6e74 5f73 6572   value_count_ser
+00045ca0: 6965 7320 3d20 6466 2e73 756d 2829 0a20  ies = df.sum(). 
+00045cb0: 2020 206d 6178 5f76 616c 203d 2076 616c     max_val = val
+00045cc0: 7565 5f63 6f75 6e74 5f73 6572 6965 732e  ue_count_series.
+00045cd0: 6d61 7828 736b 6970 6e61 3d64 726f 706e  max(skipna=dropn
+00045ce0: 6129 0a20 2020 206d 6f64 655f 7365 7269  a).    mode_seri
+00045cf0: 6573 203d 2028 0a20 2020 2020 2020 2076  es = (.        v
+00045d00: 616c 7565 5f63 6f75 6e74 5f73 6572 6965  alue_count_serie
+00045d10: 735b 7661 6c75 655f 636f 756e 745f 7365  s[value_count_se
+00045d20: 7269 6573 203d 3d20 6d61 785f 7661 6c5d  ries == max_val]
+00045d30: 0a20 2020 2020 2020 202e 696e 6465 782e  .        .index.
+00045d40: 746f 5f73 6572 6965 7328 290a 2020 2020  to_series().    
+00045d50: 2020 2020 2e73 6f72 745f 7661 6c75 6573      .sort_values
+00045d60: 2829 0a20 2020 2020 2020 202e 7265 7365  ().        .rese
+00045d70: 745f 696e 6465 7828 6472 6f70 3d54 7275  t_index(drop=Tru
+00045d80: 6529 0a20 2020 2029 0a20 2020 2072 6574  e).    ).    ret
+00045d90: 7572 6e20 6d6f 6465 5f73 6572 6965 730a  urn mode_series.
+00045da0: 0a0a 6465 6620 5f63 6f75 6e74 5f61 6767  ..def _count_agg
+00045db0: 7265 6761 7465 2878 293a 0a20 2020 2072  regate(x):.    r
+00045dc0: 6574 7572 6e20 782e 7375 6d28 292e 6173  eturn x.sum().as
+00045dd0: 7479 7065 2822 696e 7436 3422 290a 0a0a  type("int64")...
+00045de0: 6465 6620 7361 6665 5f68 6561 6428 6466  def safe_head(df
+00045df0: 2c20 6e29 3a0a 2020 2020 7220 3d20 4d2e  , n):.    r = M.
+00045e00: 6865 6164 2864 662c 206e 290a 2020 2020  head(df, n).    
+00045e10: 6966 206c 656e 2872 2920 213d 206e 3a0a  if len(r) != n:.
+00045e20: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+00045e30: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+00045e40: 2020 2066 2249 6e73 7566 6669 6369 656e     f"Insufficien
+00045e50: 7420 656c 656d 656e 7473 2066 6f72 2060  t elements for `
+00045e60: 6865 6164 602e 207b 6e7d 2065 6c65 6d65  head`. {n} eleme
+00045e70: 6e74 7320 7265 7175 6573 7465 642c 206f  nts requested, o
+00045e80: 6e6c 7920 7b6c 656e 2872 297d 2022 0a20  nly {len(r)} ". 
+00045e90: 2020 2020 2020 2020 2020 2022 656c 656d             "elem
+00045ea0: 656e 7473 2061 7661 696c 6162 6c65 2e20  ents available. 
+00045eb0: 5472 7920 7061 7373 696e 6720 6c61 7267  Try passing larg
+00045ec0: 6572 2060 6e70 6172 7469 7469 6f6e 7360  er `npartitions`
+00045ed0: 2074 6f20 6068 6561 6460 2e22 0a20 2020   to `head`.".   
+00045ee0: 2020 2020 2029 0a20 2020 2072 6574 7572       ).    retur
+00045ef0: 6e20 720a 0a0a 6465 6620 6d61 7962 655f  n r...def maybe_
+00045f00: 7368 6966 745f 6469 7669 7369 6f6e 7328  shift_divisions(
+00045f10: 6466 2c20 7065 7269 6f64 732c 2066 7265  df, periods, fre
+00045f20: 7129 3a0a 2020 2020 2222 224d 6179 6265  q):.    """Maybe
+00045f30: 2073 6869 6674 2064 6976 6973 696f 6e73   shift divisions
+00045f40: 2062 7920 7065 7269 6f64 7320 6f66 2073   by periods of s
+00045f50: 697a 6520 6672 6571 0a0a 2020 2020 5573  ize freq..    Us
+00045f60: 6564 2074 6f20 7368 6966 7420 7468 6520  ed to shift the 
+00045f70: 6469 7669 7369 6f6e 7320 666f 7220 7468  divisions for th
+00045f80: 6520 6073 6869 6674 6020 6d65 7468 6f64  e `shift` method
+00045f90: 2e20 4966 2066 7265 7120 6973 6e27 7420  . If freq isn't 
+00045fa0: 6120 6669 7865 640a 2020 2020 7369 7a65  a fixed.    size
+00045fb0: 2028 6e6f 7420 616e 6368 6f72 6564 206f   (not anchored o
+00045fc0: 7220 7265 6c61 7469 7665 292c 2074 6865  r relative), the
+00045fd0: 6e20 7468 6520 6469 7669 7369 6f6e 7320  n the divisions 
+00045fe0: 6172 6520 7368 6966 7465 640a 2020 2020  are shifted.    
+00045ff0: 6170 7072 6f70 7269 6174 656c 792e 204f  appropriately. O
+00046000: 7468 6572 7769 7365 2074 6865 2064 6976  therwise the div
+00046010: 6973 696f 6e73 2061 7265 2063 6c65 6172  isions are clear
+00046020: 6564 2e0a 0a20 2020 2050 6172 616d 6574  ed...    Paramet
+00046030: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00046040: 2d2d 0a20 2020 2064 6620 3a20 6464 2e44  --.    df : dd.D
+00046050: 6174 6146 7261 6d65 2c20 6464 2e53 6572  ataFrame, dd.Ser
+00046060: 6965 732c 206f 7220 6464 2e49 6e64 6578  ies, or dd.Index
+00046070: 0a20 2020 2070 6572 696f 6473 203a 2069  .    periods : i
+00046080: 6e74 0a20 2020 2020 2020 2054 6865 206e  nt.        The n
+00046090: 756d 6265 7220 6f66 2070 6572 696f 6473  umber of periods
+000460a0: 2074 6f20 7368 6966 742e 0a20 2020 2066   to shift..    f
+000460b0: 7265 7120 3a20 4461 7465 4f66 6673 6574  req : DateOffset
+000460c0: 2c20 7469 6d65 6465 6c74 612c 206f 7220  , timedelta, or 
+000460d0: 7469 6d65 2072 756c 6520 7374 7269 6e67  time rule string
+000460e0: 0a20 2020 2020 2020 2054 6865 2066 7265  .        The fre
+000460f0: 7175 656e 6379 2074 6f20 7368 6966 7420  quency to shift 
+00046100: 6279 2e0a 2020 2020 2222 220a 2020 2020  by..    """.    
+00046110: 6966 2069 7369 6e73 7461 6e63 6528 6672  if isinstance(fr
+00046120: 6571 2c20 7374 7229 3a0a 2020 2020 2020  eq, str):.      
+00046130: 2020 6672 6571 203d 2070 642e 7473 6572    freq = pd.tser
+00046140: 6965 732e 6672 6571 7565 6e63 6965 732e  ies.frequencies.
+00046150: 746f 5f6f 6666 7365 7428 6672 6571 290a  to_offset(freq).
+00046160: 0a20 2020 2069 735f 6f66 6673 6574 203d  .    is_offset =
+00046170: 2069 7369 6e73 7461 6e63 6528 6672 6571   isinstance(freq
+00046180: 2c20 7064 2e44 6174 654f 6666 7365 7429  , pd.DateOffset)
+00046190: 0a20 2020 2069 6620 6973 5f6f 6666 7365  .    if is_offse
+000461a0: 743a 0a20 2020 2020 2020 2069 6620 6672  t:.        if fr
+000461b0: 6571 2e69 735f 616e 6368 6f72 6564 2829  eq.is_anchored()
+000461c0: 206f 7220 6e6f 7420 6861 7361 7474 7228   or not hasattr(
+000461d0: 6672 6571 2c20 2264 656c 7461 2229 3a0a  freq, "delta"):.
+000461e0: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
+000461f0: 6e27 7420 696e 6665 7220 6469 7669 7369  n't infer divisi
+00046200: 6f6e 7320 6f6e 2072 656c 6174 6976 6520  ons on relative 
+00046210: 6f72 2061 6e63 686f 7265 6420 6f66 6673  or anchored offs
+00046220: 6574 732c 2061 730a 2020 2020 2020 2020  ets, as.        
+00046230: 2020 2020 2320 6469 7669 7369 6f6e 7320      # divisions 
+00046240: 6d61 7920 6e6f 7720 7370 6c69 7420 6964  may now split id
+00046250: 656e 7469 6361 6c20 696e 6465 7820 7661  entical index va
+00046260: 6c75 652e 0a20 2020 2020 2020 2020 2020  lue..           
+00046270: 2023 2028 652e 672e 2069 6e64 6578 5f70   # (e.g. index_p
+00046280: 6172 7469 7469 6f6e 7320 3d20 5b5b 312c  artitions = [[1,
+00046290: 2032 2c20 335d 2c20 5b33 2c20 342c 2035   2, 3], [3, 4, 5
+000462a0: 5d5d 290a 2020 2020 2020 2020 2020 2020  ]]).            
+000462b0: 7265 7475 726e 2064 662e 636c 6561 725f  return df.clear_
+000462c0: 6469 7669 7369 6f6e 7328 290a 2020 2020  divisions().    
+000462d0: 6966 2064 662e 6b6e 6f77 6e5f 6469 7669  if df.known_divi
+000462e0: 7369 6f6e 733a 0a20 2020 2020 2020 2064  sions:.        d
+000462f0: 6976 7320 3d20 7064 2e53 6572 6965 7328  ivs = pd.Series(
+00046300: 7261 6e67 6528 6c65 6e28 6466 2e64 6976  range(len(df.div
+00046310: 6973 696f 6e73 2929 2c20 696e 6465 783d  isions)), index=
+00046320: 6466 2e64 6976 6973 696f 6e73 290a 2020  df.divisions).  
+00046330: 2020 2020 2020 6469 7669 7369 6f6e 7320        divisions 
+00046340: 3d20 6469 7673 2e73 6869 6674 2870 6572  = divs.shift(per
+00046350: 696f 6473 2c20 6672 6571 3d66 7265 7129  iods, freq=freq)
+00046360: 2e69 6e64 6578 0a20 2020 2020 2020 2072  .index.        r
+00046370: 6574 7572 6e20 6466 2e5f 5f63 6c61 7373  eturn df.__class
+00046380: 5f5f 2864 662e 6461 736b 2c20 6466 2e5f  __(df.dask, df._
+00046390: 6e61 6d65 2c20 6466 2e5f 6d65 7461 2c20  name, df._meta, 
+000463a0: 6469 7669 7369 6f6e 7329 0a20 2020 2072  divisions).    r
+000463b0: 6574 7572 6e20 6466 0a0a 0a40 7772 6170  eturn df...@wrap
+000463c0: 7328 7064 2e74 6f5f 6461 7465 7469 6d65  s(pd.to_datetime
+000463d0: 290a 6465 6620 746f 5f64 6174 6574 696d  ).def to_datetim
+000463e0: 6528 6172 672c 206d 6574 613d 4e6f 6e65  e(arg, meta=None
+000463f0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00046400: 2074 7a5f 6b77 6172 6720 3d20 7b22 747a   tz_kwarg = {"tz
+00046410: 223a 2022 7574 6322 7d20 6966 206b 7761  ": "utc"} if kwa
+00046420: 7267 732e 6765 7428 2275 7463 2229 2065  rgs.get("utc") e
+00046430: 6c73 6520 7b7d 0a20 2020 2069 6620 6d65  lse {}.    if me
+00046440: 7461 2069 7320 4e6f 6e65 3a0a 2020 2020  ta is None:.    
+00046450: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00046460: 6528 6172 672c 2049 6e64 6578 293a 0a20  e(arg, Index):. 
+00046470: 2020 2020 2020 2020 2020 206d 6574 6120             meta 
+00046480: 3d20 6765 745f 6d65 7461 5f6c 6962 7261  = get_meta_libra
+00046490: 7279 2861 7267 292e 4461 7465 7469 6d65  ry(arg).Datetime
+000464a0: 496e 6465 7828 5b5d 2c20 2a2a 747a 5f6b  Index([], **tz_k
+000464b0: 7761 7267 290a 2020 2020 2020 2020 2020  warg).          
+000464c0: 2020 6d65 7461 2e6e 616d 6520 3d20 6172    meta.name = ar
+000464d0: 672e 6e61 6d65 0a20 2020 2020 2020 2065  g.name.        e
+000464e0: 6c69 6620 6e6f 7420 2869 735f 6461 7461  lif not (is_data
+000464f0: 6672 616d 655f 6c69 6b65 2861 7267 2920  frame_like(arg) 
+00046500: 6f72 2069 735f 7365 7269 6573 5f6c 696b  or is_series_lik
+00046510: 6528 6172 6729 293a 0a20 2020 2020 2020  e(arg)):.       
+00046520: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+00046530: 706c 656d 656e 7465 6445 7272 6f72 280a  plementedError(.
+00046540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046550: 2264 6173 6b2e 6461 7461 6672 616d 652e  "dask.dataframe.
+00046560: 746f 5f64 6174 6574 696d 6520 646f 6573  to_datetime does
+00046570: 206e 6f74 2073 7570 706f 7274 2022 0a20   not support ". 
+00046580: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00046590: 6e6f 6e2d 696e 6465 782d 6162 6c65 2061  non-index-able a
+000465a0: 7267 756d 656e 7473 2028 6c69 6b65 2073  rguments (like s
+000465b0: 6361 6c61 7273 2922 0a20 2020 2020 2020  calars)".       
+000465c0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+000465d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000465e0: 206d 6574 6120 3d20 6d65 7461 5f73 6572   meta = meta_ser
+000465f0: 6965 735f 636f 6e73 7472 7563 746f 7228  ies_constructor(
+00046600: 6172 6729 285b 7064 2e54 696d 6573 7461  arg)([pd.Timesta
+00046610: 6d70 2822 3230 3030 222c 202a 2a74 7a5f  mp("2000", **tz_
+00046620: 6b77 6172 6729 5d29 0a20 2020 2020 2020  kwarg)]).       
+00046630: 2020 2020 206d 6574 612e 696e 6465 7820       meta.index 
+00046640: 3d20 6d65 7461 2e69 6e64 6578 2e61 7374  = meta.index.ast
+00046650: 7970 6528 6172 672e 696e 6465 782e 6474  ype(arg.index.dt
+00046660: 7970 6529 0a20 2020 2020 2020 2020 2020  ype).           
+00046670: 206d 6574 612e 696e 6465 782e 6e61 6d65   meta.index.name
+00046680: 203d 2061 7267 2e69 6e64 6578 2e6e 616d   = arg.index.nam
+00046690: 650a 2020 2020 6966 2050 414e 4441 535f  e.    if PANDAS_
+000466a0: 4754 5f32 3030 2061 6e64 2022 696e 6665  GT_200 and "infe
+000466b0: 725f 6461 7465 7469 6d65 5f66 6f72 6d61  r_datetime_forma
+000466c0: 7422 2069 6e20 6b77 6172 6773 3a0a 2020  t" in kwargs:.  
+000466d0: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+000466e0: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+000466f0: 2022 5468 6520 6172 6775 6d65 6e74 2027   "The argument '
+00046700: 696e 6665 725f 6461 7465 7469 6d65 5f66  infer_datetime_f
+00046710: 6f72 6d61 7427 2069 7320 6465 7072 6563  ormat' is deprec
+00046720: 6174 6564 2061 6e64 2077 696c 6c20 6265  ated and will be
+00046730: 2072 656d 6f76 6564 2069 6e20 6120 6675   removed in a fu
+00046740: 7475 7265 2076 6572 7369 6f6e 2e20 220a  ture version. ".
+00046750: 2020 2020 2020 2020 2020 2020 2241 2073              "A s
+00046760: 7472 6963 7420 7665 7273 696f 6e20 6f66  trict version of
+00046770: 2069 7420 6973 206e 6f77 2074 6865 2064   it is now the d
+00046780: 6566 6175 6c74 2c20 7365 6520 220a 2020  efault, see ".  
+00046790: 2020 2020 2020 2020 2020 2268 7474 7073            "https
+000467a0: 3a2f 2f70 616e 6461 732e 7079 6461 7461  ://pandas.pydata
+000467b0: 2e6f 7267 2f70 6465 7073 2f30 3030 342d  .org/pdeps/0004-
+000467c0: 636f 6e73 6973 7465 6e74 2d74 6f2d 6461  consistent-to-da
+000467d0: 7465 7469 6d65 2d70 6172 7369 6e67 2e68  tetime-parsing.h
+000467e0: 746d 6c2e 2022 0a20 2020 2020 2020 2020  tml. ".         
+000467f0: 2020 2022 596f 7520 6361 6e20 7361 6665     "You can safe
+00046800: 6c79 2072 656d 6f76 6520 7468 6973 2061  ly remove this a
+00046810: 7267 756d 656e 742e 222c 0a20 2020 2020  rgument.",.     
+00046820: 2020 2020 2020 2055 7365 7257 6172 6e69         UserWarni
+00046830: 6e67 2c0a 2020 2020 2020 2020 290a 2020  ng,.        ).  
+00046840: 2020 2020 2020 6b77 6172 6773 2e70 6f70        kwargs.pop
+00046850: 2822 696e 6665 725f 6461 7465 7469 6d65  ("infer_datetime
+00046860: 5f66 6f72 6d61 7422 290a 0a20 2020 2072  _format")..    r
+00046870: 6574 7572 6e20 6d61 705f 7061 7274 6974  eturn map_partit
+00046880: 696f 6e73 2867 6574 5f6d 6574 615f 6c69  ions(get_meta_li
+00046890: 6272 6172 7928 6172 6729 2e74 6f5f 6461  brary(arg).to_da
+000468a0: 7465 7469 6d65 2c20 6172 672c 206d 6574  tetime, arg, met
+000468b0: 613d 6d65 7461 2c20 2a2a 6b77 6172 6773  a=meta, **kwargs
+000468c0: 290a 0a0a 4077 7261 7073 2870 642e 746f  )...@wraps(pd.to
+000468d0: 5f74 696d 6564 656c 7461 290a 6465 6620  _timedelta).def 
+000468e0: 746f 5f74 696d 6564 656c 7461 2861 7267  to_timedelta(arg
+000468f0: 2c20 756e 6974 3d4e 6f6e 652c 2065 7272  , unit=None, err
+00046900: 6f72 733d 2272 6169 7365 2229 3a0a 2020  ors="raise"):.  
+00046910: 2020 6d65 7461 203d 206d 6574 615f 7365    meta = meta_se
+00046920: 7269 6573 5f63 6f6e 7374 7275 6374 6f72  ries_constructor
+00046930: 2861 7267 2928 5b70 642e 5469 6d65 6465  (arg)([pd.Timede
+00046940: 6c74 6128 312c 2075 6e69 743d 756e 6974  lta(1, unit=unit
+00046950: 295d 290a 2020 2020 7265 7475 726e 206d  )]).    return m
+00046960: 6170 5f70 6172 7469 7469 6f6e 7328 7064  ap_partitions(pd
+00046970: 2e74 6f5f 7469 6d65 6465 6c74 612c 2061  .to_timedelta, a
+00046980: 7267 2c20 756e 6974 3d75 6e69 742c 2065  rg, unit=unit, e
+00046990: 7272 6f72 733d 6572 726f 7273 2c20 6d65  rrors=errors, me
+000469a0: 7461 3d6d 6574 6129 0a0a 0a69 6620 6861  ta=meta)...if ha
+000469b0: 7361 7474 7228 7064 2c20 2269 736e 6122  sattr(pd, "isna"
+000469c0: 293a 0a0a 2020 2020 4077 7261 7073 2870  ):..    @wraps(p
+000469d0: 642e 6973 6e61 290a 2020 2020 6465 6620  d.isna).    def 
+000469e0: 6973 6e61 2861 7267 293a 0a20 2020 2020  isna(arg):.     
+000469f0: 2020 2072 6574 7572 6e20 6d61 705f 7061     return map_pa
+00046a00: 7274 6974 696f 6e73 2870 642e 6973 6e61  rtitions(pd.isna
+00046a10: 2c20 6172 6729 0a0a 0a64 6566 205f 7265  , arg)...def _re
+00046a20: 7072 5f64 6174 615f 7365 7269 6573 2873  pr_data_series(s
+00046a30: 2c20 696e 6465 7829 3a0a 2020 2020 2222  , index):.    ""
+00046a40: 2241 2068 656c 7065 7220 666f 7220 6372  "A helper for cr
+00046a50: 6561 7469 6e67 2074 6865 2060 605f 7265  eating the ``_re
+00046a60: 7072 5f64 6174 6160 6020 7072 6f70 6572  pr_data`` proper
+00046a70: 7479 2222 220a 2020 2020 6e70 6172 7469  ty""".    nparti
+00046a80: 7469 6f6e 7320 3d20 6c65 6e28 696e 6465  tions = len(inde
+00046a90: 7829 202d 2031 0a20 2020 2069 6620 6973  x) - 1.    if is
+00046aa0: 696e 7374 616e 6365 2873 2e64 7479 7065  instance(s.dtype
+00046ab0: 2c20 7064 2e43 6174 6567 6f72 6963 616c  , pd.Categorical
+00046ac0: 4474 7970 6529 3a0a 2020 2020 2020 2020  Dtype):.        
+00046ad0: 6966 2068 6173 5f6b 6e6f 776e 5f63 6174  if has_known_cat
+00046ae0: 6567 6f72 6965 7328 7329 3a0a 2020 2020  egories(s):.    
+00046af0: 2020 2020 2020 2020 6474 7970 6520 3d20          dtype = 
+00046b00: 2263 6174 6567 6f72 795b 6b6e 6f77 6e5d  "category[known]
+00046b10: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
+00046b20: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00046b30: 6520 3d20 2263 6174 6567 6f72 795b 756e  e = "category[un
+00046b40: 6b6e 6f77 6e5d 220a 2020 2020 656c 7365  known]".    else
+00046b50: 3a0a 2020 2020 2020 2020 6474 7970 6520  :.        dtype 
+00046b60: 3d20 7374 7228 732e 6474 7970 6529 0a20  = str(s.dtype). 
+00046b70: 2020 2072 6574 7572 6e20 7064 2e53 6572     return pd.Ser
+00046b80: 6965 7328 5b64 7479 7065 5d20 2b20 5b22  ies([dtype] + ["
+00046b90: 2e2e 2e22 5d20 2a20 6e70 6172 7469 7469  ..."] * npartiti
+00046ba0: 6f6e 732c 2069 6e64 6578 3d69 6e64 6578  ons, index=index
+00046bb0: 2c20 6e61 6d65 3d73 2e6e 616d 6529 0a0a  , name=s.name)..
+00046bc0: 0a64 6566 2068 6173 5f70 6172 616c 6c65  .def has_paralle
+00046bd0: 6c5f 7479 7065 2878 293a 0a20 2020 2022  l_type(x):.    "
+00046be0: 2222 446f 6573 2074 6869 7320 6f62 6a65  ""Does this obje
+00046bf0: 6374 2068 6176 6520 6120 6461 736b 2064  ct have a dask d
+00046c00: 6174 6166 7261 6d65 2065 7175 6976 616c  ataframe equival
+00046c10: 656e 743f 2222 220a 2020 2020 7265 7475  ent?""".    retu
+00046c20: 726e 2067 6574 5f70 6172 616c 6c65 6c5f  rn get_parallel_
+00046c30: 7479 7065 2878 2920 6973 206e 6f74 2053  type(x) is not S
+00046c40: 6361 6c61 720a 0a0a 6465 6620 6e65 775f  calar...def new_
+00046c50: 6464 5f6f 626a 6563 7428 6473 6b2c 206e  dd_object(dsk, n
+00046c60: 616d 652c 206d 6574 612c 2064 6976 6973  ame, meta, divis
+00046c70: 696f 6e73 2c20 7061 7265 6e74 5f6d 6574  ions, parent_met
+00046c80: 613d 4e6f 6e65 293a 0a20 2020 2022 2222  a=None):.    """
+00046c90: 4765 6e65 7269 6320 636f 6e73 7472 7563  Generic construc
+00046ca0: 746f 7220 666f 7220 6461 736b 2e64 6174  tor for dask.dat
+00046cb0: 6166 7261 6d65 206f 626a 6563 7473 2e0a  aframe objects..
+00046cc0: 0a20 2020 2044 6563 6964 6573 2074 6865  .    Decides the
+00046cd0: 2061 7070 726f 7072 6961 7465 206f 7574   appropriate out
+00046ce0: 7075 7420 636c 6173 7320 6261 7365 6420  put class based 
+00046cf0: 6f6e 2074 6865 2074 7970 6520 6f66 2060  on the type of `
+00046d00: 6d65 7461 6020 7072 6f76 6964 6564 2e0a  meta` provided..
+00046d10: 2020 2020 2222 220a 2020 2020 6966 2068      """.    if h
+00046d20: 6173 5f70 6172 616c 6c65 6c5f 7479 7065  as_parallel_type
+00046d30: 286d 6574 6129 3a0a 2020 2020 2020 2020  (meta):.        
+00046d40: 7265 7475 726e 2067 6574 5f70 6172 616c  return get_paral
+00046d50: 6c65 6c5f 7479 7065 286d 6574 6129 2864  lel_type(meta)(d
+00046d60: 736b 2c20 6e61 6d65 2c20 6d65 7461 2c20  sk, name, meta, 
+00046d70: 6469 7669 7369 6f6e 7329 0a20 2020 2065  divisions).    e
+00046d80: 6c69 6620 6973 5f61 7272 6179 6c69 6b65  lif is_arraylike
+00046d90: 286d 6574 6129 2061 6e64 206d 6574 612e  (meta) and meta.
+00046da0: 7368 6170 653a 0a20 2020 2020 2020 2069  shape:.        i
+00046db0: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
+00046dc0: 2061 7320 6461 0a0a 2020 2020 2020 2020   as da..        
+00046dd0: 6368 756e 6b73 203d 2028 286e 702e 6e61  chunks = ((np.na
+00046de0: 6e2c 2920 2a20 286c 656e 2864 6976 6973  n,) * (len(divis
+00046df0: 696f 6e73 2920 2d20 3129 2c29 202b 2074  ions) - 1),) + t
+00046e00: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
+00046e10: 2020 2864 2c29 2066 6f72 2064 2069 6e20    (d,) for d in 
+00046e20: 6d65 7461 2e73 6861 7065 5b31 3a5d 0a20  meta.shape[1:]. 
+00046e30: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00046e40: 2069 6620 6c65 6e28 6368 756e 6b73 2920   if len(chunks) 
+00046e50: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00046e60: 206c 6179 6572 203d 2064 736b 2e6c 6179   layer = dsk.lay
+00046e70: 6572 735b 6e61 6d65 5d0a 2020 2020 2020  ers[name].      
+00046e80: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00046e90: 6e63 6528 6c61 7965 722c 2042 6c6f 636b  nce(layer, Block
+00046ea0: 7769 7365 293a 0a20 2020 2020 2020 2020  wise):.         
+00046eb0: 2020 2020 2020 206c 6179 6572 2e6e 6577         layer.new
+00046ec0: 5f61 7865 735b 226a 225d 203d 2063 6875  _axes["j"] = chu
+00046ed0: 6e6b 735b 315d 5b30 5d0a 2020 2020 2020  nks[1][0].      
+00046ee0: 2020 2020 2020 2020 2020 6c61 7965 722e            layer.
+00046ef0: 6f75 7470 7574 5f69 6e64 6963 6573 203d  output_indices =
+00046f00: 206c 6179 6572 2e6f 7574 7075 745f 696e   layer.output_in
+00046f10: 6469 6365 7320 2b20 2822 6a22 2c29 0a20  dices + ("j",). 
+00046f20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00046f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046f40: 2073 7566 6669 7820 3d20 2830 2c29 202a   suffix = (0,) *
+00046f50: 2028 6c65 6e28 6368 756e 6b73 2920 2d20   (len(chunks) - 
+00046f60: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00046f70: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00046f80: 6528 6c65 6e28 6368 756e 6b73 5b30 5d29  e(len(chunks[0])
+00046f90: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00046fa0: 2020 2020 2020 206c 6179 6572 5b28 6e61         layer[(na
+00046fb0: 6d65 2c20 6929 202b 2073 7566 6669 785d  me, i) + suffix]
+00046fc0: 203d 206c 6179 6572 2e70 6f70 2828 6e61   = layer.pop((na
+00046fd0: 6d65 2c20 6929 290a 2020 2020 2020 2020  me, i)).        
+00046fe0: 7265 7475 726e 2064 612e 4172 7261 7928  return da.Array(
+00046ff0: 6473 6b2c 206e 616d 653d 6e61 6d65 2c20  dsk, name=name, 
+00047000: 6368 756e 6b73 3d63 6875 6e6b 732c 2064  chunks=chunks, d
+00047010: 7479 7065 3d6d 6574 612e 6474 7970 6529  type=meta.dtype)
+00047020: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00047030: 2020 2072 6574 7572 6e20 6765 745f 7061     return get_pa
+00047040: 7261 6c6c 656c 5f74 7970 6528 6d65 7461  rallel_type(meta
+00047050: 2928 6473 6b2c 206e 616d 652c 206d 6574  )(dsk, name, met
+00047060: 612c 2064 6976 6973 696f 6e73 290a 0a0a  a, divisions)...
+00047070: 6465 6620 7061 7274 6974 696f 6e77 6973  def partitionwis
+00047080: 655f 6772 6170 6828 6675 6e63 2c20 6c61  e_graph(func, la
+00047090: 7965 725f 6e61 6d65 2c20 2a61 7267 732c  yer_name, *args,
+000470a0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+000470b0: 2222 220a 2020 2020 4170 706c 7920 6120  """.    Apply a 
+000470c0: 6675 6e63 7469 6f6e 2070 6172 7469 7469  function partiti
+000470d0: 6f6e 2d77 6973 6520 6163 726f 7373 2061  on-wise across a
+000470e0: 7267 756d 656e 7473 2074 6f20 6372 6561  rguments to crea
+000470f0: 7465 206c 6179 6572 206f 6620 6120 6772  te layer of a gr
+00047100: 6170 680a 0a20 2020 2054 6869 7320 6170  aph..    This ap
+00047110: 706c 6965 7320 6120 6675 6e63 7469 6f6e  plies a function
+00047120: 2c20 6060 6675 6e63 6060 2c20 696e 2061  , ``func``, in a
+00047130: 6e20 656d 6261 7272 6173 7369 6e67 6c79  n embarrassingly
+00047140: 2070 6172 616c 6c65 6c20 6661 7368 696f   parallel fashio
+00047150: 6e0a 2020 2020 6163 726f 7373 2070 6172  n.    across par
+00047160: 7469 7469 6f6e 732f 6368 756e 6b73 2069  titions/chunks i
+00047170: 6e20 7468 6520 7072 6f76 6964 6564 2061  n the provided a
+00047180: 7267 756d 656e 7473 2e20 2049 7420 6861  rguments.  It ha
+00047190: 6e64 6c65 7320 4461 7461 6672 616d 6573  ndles Dataframes
+000471a0: 2c0a 2020 2020 4172 7261 7973 2c20 616e  ,.    Arrays, an
+000471b0: 6420 7363 616c 6172 7320 736d 6f6f 7468  d scalars smooth
+000471c0: 6c79 2c20 616e 6420 7265 6c69 6573 206f  ly, and relies o
+000471d0: 6e20 7468 6520 6060 626c 6f63 6b77 6973  n the ``blockwis
+000471e0: 6560 6020 6d61 6368 696e 6572 790a 2020  e`` machinery.  
+000471f0: 2020 746f 2070 726f 7669 6465 2061 206e    to provide a n
+00047200: 6963 656c 7920 7379 6d62 6f6c 6963 2067  icely symbolic g
+00047210: 7261 7068 2e0a 0a20 2020 2049 7420 6973  raph...    It is
+00047220: 206d 6f73 7420 636f 6d6d 6f6e 6c79 2075   most commonly u
+00047230: 7365 6420 696e 206f 7468 6572 2067 7261  sed in other gra
+00047240: 7068 2d62 7569 6c64 696e 6720 6675 6e63  ph-building func
+00047250: 7469 6f6e 7320 746f 2063 7265 6174 6520  tions to create 
+00047260: 7468 650a 2020 2020 6170 7072 6f70 7269  the.    appropri
+00047270: 6174 6520 6c61 7965 7220 6f66 2074 6865  ate layer of the
+00047280: 2072 6573 756c 7469 6e67 2064 6174 6166   resulting dataf
+00047290: 7261 6d65 2e0a 0a20 2020 2050 6172 616d  rame...    Param
+000472a0: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+000472b0: 2d2d 2d2d 0a20 2020 2066 756e 633a 2063  ----.    func: c
+000472c0: 616c 6c61 626c 650a 2020 2020 6c61 7965  allable.    laye
+000472d0: 725f 6e61 6d65 3a20 7374 720a 2020 2020  r_name: str.    
+000472e0: 2020 2020 4465 7363 7269 7074 6976 6520      Descriptive 
+000472f0: 6e61 6d65 2066 6f72 2074 6865 206f 7065  name for the ope
+00047300: 7261 7469 6f6e 2e20 5573 6564 2061 7320  ration. Used as 
+00047310: 7468 6520 6f75 7470 7574 206e 616d 650a  the output name.
+00047320: 2020 2020 2020 2020 696e 2074 6865 2072          in the r
+00047330: 6573 756c 7469 6e67 2060 6042 6c6f 636b  esulting ``Block
+00047340: 7769 7365 6060 2067 7261 7068 206c 6179  wise`` graph lay
+00047350: 6572 2e0a 2020 2020 2a61 7267 733a 0a20  er..    *args:. 
+00047360: 2020 202a 2a6b 7761 7267 733a 0a0a 2020     **kwargs:..  
+00047370: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00047380: 2d2d 2d2d 2d0a 2020 2020 6f75 743a 2042  -----.    out: B
+00047390: 6c6f 636b 7769 7365 2067 7261 7068 0a0a  lockwise graph..
+000473a0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
+000473b0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e   --------.    >>
+000473c0: 3e20 7375 6267 7261 7068 203d 2070 6172  > subgraph = par
+000473d0: 7469 7469 6f6e 7769 7365 5f67 7261 7068  titionwise_graph
+000473e0: 2866 756e 6374 696f 6e2c 2078 2c20 792c  (function, x, y,
+000473f0: 207a 3d31 3233 2920 2023 2064 6f63 7465   z=123)  # docte
+00047400: 7374 3a20 2b53 4b49 500a 2020 2020 3e3e  st: +SKIP.    >>
+00047410: 3e20 6c61 7965 7220 3d20 7061 7274 6974  > layer = partit
+00047420: 696f 6e77 6973 655f 6772 6170 6828 6675  ionwise_graph(fu
+00047430: 6e63 7469 6f6e 2c20 6466 2c20 782c 207a  nction, df, x, z
+00047440: 3d31 3233 2920 2023 2064 6f63 7465 7374  =123)  # doctest
+00047450: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
+00047460: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
+00047470: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
+00047480: 6563 7469 6f6e 7328 6e61 6d65 2c20 6c61  ections(name, la
+00047490: 7965 722c 2064 6570 656e 6465 6e63 6965  yer, dependencie
+000474a0: 733d 5b64 662c 2078 5d29 2020 2320 646f  s=[df, x])  # do
+000474b0: 6374 6573 743a 202b 534b 4950 0a20 2020  ctest: +SKIP.   
+000474c0: 203e 3e3e 2072 6573 756c 7420 3d20 6e65   >>> result = ne
+000474d0: 775f 6464 5f6f 626a 6563 7428 6772 6170  w_dd_object(grap
+000474e0: 682c 206e 616d 652c 206d 6574 6164 6174  h, name, metadat
+000474f0: 612c 2064 662e 6469 7669 7369 6f6e 7329  a, df.divisions)
+00047500: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00047510: 4950 0a0a 2020 2020 5365 6520 416c 736f  IP..    See Also
+00047520: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00047530: 2020 6d61 705f 7061 7274 6974 696f 6e73    map_partitions
+00047540: 0a20 2020 2022 2222 0a20 2020 2070 6169  .    """.    pai
+00047550: 7273 203d 205b 5d0a 2020 2020 6e75 6d62  rs = [].    numb
+00047560: 6c6f 636b 7320 3d20 7b7d 0a20 2020 2066  locks = {}.    f
+00047570: 6f72 2061 7267 2069 6e20 6172 6773 3a0a  or arg in args:.
+00047580: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00047590: 7461 6e63 6528 6172 672c 205f 4672 616d  tance(arg, _Fram
+000475a0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000475b0: 7061 6972 732e 6578 7465 6e64 285b 6172  pairs.extend([ar
+000475c0: 672e 5f6e 616d 652c 2022 6922 5d29 0a20  g._name, "i"]). 
+000475d0: 2020 2020 2020 2020 2020 206e 756d 626c             numbl
+000475e0: 6f63 6b73 5b61 7267 2e5f 6e61 6d65 5d20  ocks[arg._name] 
+000475f0: 3d20 2861 7267 2e6e 7061 7274 6974 696f  = (arg.npartitio
+00047600: 6e73 2c29 0a20 2020 2020 2020 2065 6c69  ns,).        eli
+00047610: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
+00047620: 2c20 5363 616c 6172 293a 0a20 2020 2020  , Scalar):.     
+00047630: 2020 2020 2020 2070 6169 7273 2e65 7874         pairs.ext
+00047640: 656e 6428 5b61 7267 2e5f 6e61 6d65 2c20  end([arg._name, 
+00047650: 2269 225d 290a 2020 2020 2020 2020 2020  "i"]).          
+00047660: 2020 6e75 6d62 6c6f 636b 735b 6172 672e    numblocks[arg.
+00047670: 5f6e 616d 655d 203d 2028 312c 290a 2020  _name] = (1,).  
+00047680: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00047690: 7461 6e63 6528 6172 672c 2041 7272 6179  tance(arg, Array
+000476a0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+000476b0: 6620 6172 672e 6e64 696d 203d 3d20 313a  f arg.ndim == 1:
+000476c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000476d0: 2070 6169 7273 2e65 7874 656e 6428 5b61   pairs.extend([a
+000476e0: 7267 2e6e 616d 652c 2022 6922 5d29 0a20  rg.name, "i"]). 
+000476f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00047700: 6172 672e 6e64 696d 203d 3d20 303a 0a20  arg.ndim == 0:. 
+00047710: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00047720: 6169 7273 2e65 7874 656e 6428 5b61 7267  airs.extend([arg
+00047730: 2e6e 616d 652c 2022 225d 290a 2020 2020  .name, ""]).    
+00047740: 2020 2020 2020 2020 656c 6966 2061 7267          elif arg
+00047750: 2e6e 6469 6d20 3d3d 2032 3a0a 2020 2020  .ndim == 2:.    
+00047760: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+00047770: 732e 6578 7465 6e64 285b 6172 672e 6e61  s.extend([arg.na
+00047780: 6d65 2c20 2269 6a22 5d29 0a20 2020 2020  me, "ij"]).     
+00047790: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000477a0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+000477b0: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
+000477c0: 616e 2774 2061 6464 206d 756c 7469 2d64  an't add multi-d
+000477d0: 696d 656e 7369 6f6e 616c 2061 7272 6179  imensional array
+000477e0: 2074 6f20 6461 7461 6672 616d 6573 2229   to dataframes")
+000477f0: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00047800: 626c 6f63 6b73 5b61 7267 2e5f 6e61 6d65  blocks[arg._name
+00047810: 5d20 3d20 6172 672e 6e75 6d62 6c6f 636b  ] = arg.numblock
+00047820: 730a 2020 2020 2020 2020 656c 6966 2069  s.        elif i
+00047830: 7369 6e73 7461 6e63 6528 6172 672c 2042  sinstance(arg, B
+00047840: 6c6f 636b 7769 7365 4465 7029 3a0a 2020  lockwiseDep):.  
+00047850: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00047860: 2861 7267 2e6e 756d 626c 6f63 6b73 2920  (arg.numblocks) 
+00047870: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00047880: 2020 2020 2020 7061 6972 732e 6578 7465        pairs.exte
+00047890: 6e64 285b 6172 672c 2022 6922 5d29 0a20  nd([arg, "i"]). 
+000478a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000478b0: 6c65 6e28 6172 672e 6e75 6d62 6c6f 636b  len(arg.numblock
+000478c0: 7329 203d 3d20 323a 0a20 2020 2020 2020  s) == 2:.       
+000478d0: 2020 2020 2020 2020 2070 6169 7273 2e65           pairs.e
+000478e0: 7874 656e 6428 5b61 7267 2c20 2269 6a22  xtend([arg, "ij"
+000478f0: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+00047900: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00047910: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00047920: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00047930: 2020 2020 2020 2020 2020 2066 2242 6c6f             f"Blo
+00047940: 636b 7769 7365 4465 7020 6172 6720 7b61  ckwiseDep arg {a
+00047950: 7267 2172 7d20 6861 7320 7b6c 656e 2861  rg!r} has {len(a
+00047960: 7267 2e6e 756d 626c 6f63 6b73 297d 2064  rg.numblocks)} d
+00047970: 696d 656e 7369 6f6e 733b 206f 6e6c 7920  imensions; only 
+00047980: 3120 6f72 2032 2061 7265 2073 7570 706f  1 or 2 are suppo
+00047990: 7274 6564 2e22 0a20 2020 2020 2020 2020  rted.".         
+000479a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000479b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000479c0: 2020 2070 6169 7273 2e65 7874 656e 6428     pairs.extend(
+000479d0: 5b61 7267 2c20 4e6f 6e65 5d29 0a20 2020  [arg, None]).   
+000479e0: 2072 6574 7572 6e20 626c 6f63 6b77 6973   return blockwis
+000479f0: 6528 0a20 2020 2020 2020 2066 756e 632c  e(.        func,
+00047a00: 206c 6179 6572 5f6e 616d 652c 2022 6922   layer_name, "i"
+00047a10: 2c20 2a70 6169 7273 2c20 6e75 6d62 6c6f  , *pairs, numblo
+00047a20: 636b 733d 6e75 6d62 6c6f 636b 732c 2063  cks=numblocks, c
+00047a30: 6f6e 6361 7465 6e61 7465 3d54 7275 652c  oncatenate=True,
+00047a40: 202a 2a6b 7761 7267 730a 2020 2020 290a   **kwargs.    ).
+00047a50: 0a0a 6465 6620 6d65 7461 5f77 6172 6e69  ..def meta_warni
+00047a60: 6e67 2864 6629 3a0a 2020 2020 2222 220a  ng(df):.    """.
+00047a70: 2020 2020 5072 6f76 6964 6520 616e 2069      Provide an i
+00047a80: 6e66 6f72 6d61 7469 7665 206d 6573 7361  nformative messa
+00047a90: 6765 2077 6865 6e20 7468 6520 7573 6572  ge when the user
+00047aa0: 2069 7320 6173 6b65 6420 746f 2070 726f   is asked to pro
+00047ab0: 7669 6465 206d 6574 6164 6174 610a 2020  vide metadata.  
+00047ac0: 2020 2222 220a 2020 2020 6966 2069 735f    """.    if is_
+00047ad0: 6461 7461 6672 616d 655f 6c69 6b65 2864  dataframe_like(d
+00047ae0: 6629 3a0a 2020 2020 2020 2020 6d65 7461  f):.        meta
+00047af0: 5f73 7472 203d 207b 6b3a 2073 7472 2876  _str = {k: str(v
+00047b00: 2920 666f 7220 6b2c 2076 2069 6e20 6466  ) for k, v in df
+00047b10: 2e64 7479 7065 732e 746f 5f64 6963 7428  .dtypes.to_dict(
+00047b20: 292e 6974 656d 7328 297d 0a20 2020 2065  ).items()}.    e
+00047b30: 6c69 6620 6973 5f73 6572 6965 735f 6c69  lif is_series_li
+00047b40: 6b65 2864 6629 3a0a 2020 2020 2020 2020  ke(df):.        
+00047b50: 6d65 7461 5f73 7472 203d 2028 6466 2e6e  meta_str = (df.n
+00047b60: 616d 652c 2073 7472 2864 662e 6474 7970  ame, str(df.dtyp
+00047b70: 6529 290a 2020 2020 656c 7365 3a0a 2020  e)).    else:.  
+00047b80: 2020 2020 2020 6d65 7461 5f73 7472 203d        meta_str =
+00047b90: 204e 6f6e 650a 2020 2020 6d73 6720 3d20   None.    msg = 
+00047ba0: 280a 2020 2020 2020 2020 225c 6e59 6f75  (.        "\nYou
+00047bb0: 2064 6964 206e 6f74 2070 726f 7669 6465   did not provide
+00047bc0: 206d 6574 6164 6174 612c 2073 6f20 4461   metadata, so Da
+00047bd0: 736b 2069 7320 7275 6e6e 696e 6720 796f  sk is running yo
+00047be0: 7572 2022 0a20 2020 2020 2020 2022 6675  ur ".        "fu
+00047bf0: 6e63 7469 6f6e 206f 6e20 6120 736d 616c  nction on a smal
+00047c00: 6c20 6461 7461 7365 7420 746f 2067 7565  l dataset to gue
+00047c10: 7373 206f 7574 7075 7420 7479 7065 732e  ss output types.
+00047c20: 2022 0a20 2020 2020 2020 2022 4974 2069   ".        "It i
+00047c30: 7320 706f 7373 6962 6c65 2074 6861 7420  s possible that 
+00047c40: 4461 736b 2077 696c 6c20 6775 6573 7320  Dask will guess 
+00047c50: 696e 636f 7272 6563 746c 792e 5c6e 220a  incorrectly.\n".
+00047c60: 2020 2020 2020 2020 2254 6f20 7072 6f76          "To prov
+00047c70: 6964 6520 616e 2065 7870 6c69 6369 7420  ide an explicit 
+00047c80: 6f75 7470 7574 2074 7970 6573 206f 7220  output types or 
+00047c90: 746f 2073 696c 656e 6365 2074 6869 7320  to silence this 
+00047ca0: 6d65 7373 6167 652c 2022 0a20 2020 2020  message, ".     
+00047cb0: 2020 2022 706c 6561 7365 2070 726f 7669     "please provi
+00047cc0: 6465 2074 6865 2060 6d65 7461 3d60 206b  de the `meta=` k
+00047cd0: 6579 776f 7264 2c20 6173 2064 6573 6372  eyword, as descr
+00047ce0: 6962 6564 2069 6e20 7468 6520 6d61 7020  ibed in the map 
+00047cf0: 6f72 2022 0a20 2020 2020 2020 2022 6170  or ".        "ap
+00047d00: 706c 7920 6675 6e63 7469 6f6e 2074 6861  ply function tha
+00047d10: 7420 796f 7520 6172 6520 7573 696e 672e  t you are using.
+00047d20: 220a 2020 2020 290a 2020 2020 6966 206d  ".    ).    if m
+00047d30: 6574 615f 7374 723a 0a20 2020 2020 2020  eta_str:.       
+00047d40: 206d 7367 202b 3d20 280a 2020 2020 2020   msg += (.      
+00047d50: 2020 2020 2020 225c 6e22 0a20 2020 2020        "\n".     
+00047d60: 2020 2020 2020 2022 2020 4265 666f 7265         "  Before
+00047d70: 3a20 2e61 7070 6c79 2866 756e 6329 5c6e  : .apply(func)\n
+00047d80: 220a 2020 2020 2020 2020 2020 2020 2220  ".            " 
+00047d90: 2041 6674 6572 3a20 202e 6170 706c 7928   After:  .apply(
+00047da0: 6675 6e63 2c20 6d65 7461 3d25 7329 5c6e  func, meta=%s)\n
+00047db0: 2220 2520 7374 7228 6d65 7461 5f73 7472  " % str(meta_str
+00047dc0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00047dd0: 7265 7475 726e 206d 7367 0a0a 0a64 6566  return msg...def
+00047de0: 2070 7265 6669 785f 7265 6475 6374 696f   prefix_reductio
+00047df0: 6e28 662c 2064 6466 2c20 6964 656e 7469  n(f, ddf, identi
+00047e00: 7479 2c20 2a2a 6b77 6172 6773 293a 0a20  ty, **kwargs):. 
+00047e10: 2020 2022 2222 436f 6d70 7574 6573 2074     """Computes t
+00047e20: 6865 2070 7265 6669 7820 7375 6d73 206f  he prefix sums o
+00047e30: 6620 6620 6f6e 2064 660a 0a20 2020 2049  f f on df..    I
+00047e40: 6620 6466 2068 6173 2070 6172 7469 7469  f df has partiti
+00047e50: 6f6e 7320 5b50 312c 2050 322c 202e 2e2e  ons [P1, P2, ...
+00047e60: 2c20 506e 5d2c 2074 6865 6e20 7265 7475  , Pn], then retu
+00047e70: 726e 7320 7468 6520 4461 7461 4672 616d  rns the DataFram
+00047e80: 6520 7769 7468 0a20 2020 2070 6172 7469  e with.    parti
+00047e90: 7469 6f6e 7320 5b66 2869 6465 6e74 6974  tions [f(identit
+00047ea0: 792c 2050 3129 2c0a 2020 2020 2020 2020  y, P1),.        
+00047eb0: 2020 2020 2020 2020 6628 6628 6964 656e          f(f(iden
+00047ec0: 7469 7479 2c20 5031 292c 2050 3229 2c0a  tity, P1), P2),.
+00047ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047ee0: 6628 6628 6628 6964 656e 7469 7479 2c20  f(f(f(identity, 
+00047ef0: 5031 292c 2050 3229 2c20 5033 292c 0a20  P1), P2), P3),. 
+00047f00: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00047f10: 2e2e 5d0a 0a20 2020 2050 6172 616d 6574  ..]..    Paramet
+00047f20: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00047f30: 2d2d 0a20 2020 2066 203a 2063 616c 6c61  --.    f : calla
+00047f40: 626c 650a 2020 2020 2020 2020 616e 2061  ble.        an a
+00047f50: 7373 6f63 6961 7469 7665 2066 756e 6374  ssociative funct
+00047f60: 696f 6e20 660a 2020 2020 6464 6620 3a20  ion f.    ddf : 
+00047f70: 6464 2e44 6174 6146 7261 6d65 0a20 2020  dd.DataFrame.   
+00047f80: 2069 6465 6e74 6974 7920 3a20 7064 2e44   identity : pd.D
+00047f90: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
+00047fa0: 2061 6e20 6964 656e 7469 7479 2065 6c65   an identity ele
+00047fb0: 6d65 6e74 206f 6620 662c 2074 6861 7420  ment of f, that 
+00047fc0: 6973 2066 2869 6465 6e74 6974 792c 2064  is f(identity, d
+00047fd0: 6629 203d 2066 2864 662c 2069 6465 6e74  f) = f(df, ident
+00047fe0: 6974 7929 203d 2064 660a 2020 2020 2222  ity) = df.    ""
+00047ff0: 220a 2020 2020 6473 6b20 3d20 6469 6374  ".    dsk = dict
+00048000: 2829 0a20 2020 206e 616d 6520 3d20 2270  ().    name = "p
+00048010: 7265 6669 785f 7265 6475 6374 696f 6e2d  refix_reduction-
+00048020: 2220 2b20 746f 6b65 6e69 7a65 2866 2c20  " + tokenize(f, 
+00048030: 6464 662c 2069 6465 6e74 6974 792c 202a  ddf, identity, *
+00048040: 2a6b 7761 7267 7329 0a20 2020 206d 6574  *kwargs).    met
+00048050: 6120 3d20 6464 662e 5f6d 6574 610a 2020  a = ddf._meta.  
+00048060: 2020 6e20 3d20 6c65 6e28 6464 662e 6469    n = len(ddf.di
+00048070: 7669 7369 6f6e 7329 202d 2031 0a20 2020  visions) - 1.   
+00048080: 2064 6976 6973 696f 6e73 203d 205b 4e6f   divisions = [No
+00048090: 6e65 5d20 2a20 286e 202b 2031 290a 0a20  ne] * (n + 1).. 
+000480a0: 2020 204e 203d 2031 0a20 2020 2077 6869     N = 1.    whi
+000480b0: 6c65 204e 203c 206e 3a0a 2020 2020 2020  le N < n:.      
+000480c0: 2020 4e20 2a3d 2032 0a20 2020 2066 6f72    N *= 2.    for
+000480d0: 2069 2069 6e20 7261 6e67 6528 6e29 3a0a   i in range(n):.
+000480e0: 2020 2020 2020 2020 6473 6b5b 286e 616d          dsk[(nam
+000480f0: 652c 2069 2c20 312c 2030 295d 203d 2028  e, i, 1, 0)] = (
+00048100: 6170 706c 792c 2066 2c20 5b28 6464 662e  apply, f, [(ddf.
+00048110: 5f6e 616d 652c 2069 292c 2069 6465 6e74  _name, i), ident
+00048120: 6974 795d 2c20 6b77 6172 6773 290a 2020  ity], kwargs).  
+00048130: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00048140: 286e 2c20 4e29 3a0a 2020 2020 2020 2020  (n, N):.        
+00048150: 6473 6b5b 286e 616d 652c 2069 2c20 312c  dsk[(name, i, 1,
+00048160: 2030 295d 203d 2069 6465 6e74 6974 790a   0)] = identity.
+00048170: 0a20 2020 2064 203d 2031 0a20 2020 2077  .    d = 1.    w
+00048180: 6869 6c65 2064 203c 204e 3a0a 2020 2020  hile d < N:.    
+00048190: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+000481a0: 6765 2830 2c20 4e2c 2032 202a 2064 293a  ge(0, N, 2 * d):
+000481b0: 0a20 2020 2020 2020 2020 2020 2064 736b  .            dsk
+000481c0: 5b28 6e61 6d65 2c20 6920 2b20 3220 2a20  [(name, i + 2 * 
+000481d0: 6420 2d20 312c 2032 202a 2064 2c20 3029  d - 1, 2 * d, 0)
+000481e0: 5d20 3d20 280a 2020 2020 2020 2020 2020  ] = (.          
+000481f0: 2020 2020 2020 6170 706c 792c 0a20 2020        apply,.   
+00048200: 2020 2020 2020 2020 2020 2020 2066 2c0a               f,.
+00048210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048220: 5b28 6e61 6d65 2c20 6920 2b20 6420 2d20  [(name, i + d - 
+00048230: 312c 2064 2c20 3029 2c20 286e 616d 652c  1, d, 0), (name,
+00048240: 2069 202b 2032 202a 2064 202d 2031 2c20   i + 2 * d - 1, 
+00048250: 642c 2030 295d 2c0a 2020 2020 2020 2020  d, 0)],.        
+00048260: 2020 2020 2020 2020 6b77 6172 6773 2c0a          kwargs,.
+00048270: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00048280: 2020 2020 2020 6420 2a3d 2032 0a0a 2020        d *= 2..  
+00048290: 2020 6473 6b5b 286e 616d 652c 204e 202d    dsk[(name, N -
+000482a0: 2031 2c20 4e2c 2031 295d 203d 2069 6465   1, N, 1)] = ide
+000482b0: 6e74 6974 790a 0a20 2020 2077 6869 6c65  ntity..    while
+000482c0: 2064 203e 2031 3a0a 2020 2020 2020 2020   d > 1:.        
+000482d0: 6420 2f2f 3d20 320a 2020 2020 2020 2020  d //= 2.        
+000482e0: 666f 7220 6920 696e 2072 616e 6765 2830  for i in range(0
+000482f0: 2c20 4e2c 2032 202a 2064 293a 0a20 2020  , N, 2 * d):.   
+00048300: 2020 2020 2020 2020 2064 736b 5b28 6e61           dsk[(na
+00048310: 6d65 2c20 6920 2b20 6420 2d20 312c 2064  me, i + d - 1, d
+00048320: 2c20 3129 5d20 3d20 286e 616d 652c 2069  , 1)] = (name, i
+00048330: 202b 2032 202a 2064 202d 2031 2c20 3220   + 2 * d - 1, 2 
+00048340: 2a20 642c 2031 290a 2020 2020 2020 2020  * d, 1).        
+00048350: 2020 2020 6473 6b5b 286e 616d 652c 2069      dsk[(name, i
+00048360: 202b 2032 202a 2064 202d 2031 2c20 642c   + 2 * d - 1, d,
+00048370: 2031 295d 203d 2028 0a20 2020 2020 2020   1)] = (.       
+00048380: 2020 2020 2020 2020 2061 7070 6c79 2c0a           apply,.
+00048390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000483a0: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+000483b0: 2020 205b 286e 616d 652c 2069 202b 2032     [(name, i + 2
+000483c0: 202a 2064 202d 2031 2c20 3220 2a20 642c   * d - 1, 2 * d,
+000483d0: 2031 292c 2028 6e61 6d65 2c20 6920 2b20   1), (name, i + 
+000483e0: 6420 2d20 312c 2064 2c20 3029 5d2c 0a20  d - 1, d, 0)],. 
+000483f0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00048400: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00048410: 2020 2029 0a0a 2020 2020 666f 7220 6920     )..    for i 
+00048420: 696e 2072 616e 6765 286e 293a 0a20 2020  in range(n):.   
+00048430: 2020 2020 2064 736b 5b28 6e61 6d65 2c20       dsk[(name, 
+00048440: 6929 5d20 3d20 2861 7070 6c79 2c20 662c  i)] = (apply, f,
+00048450: 205b 286e 616d 652c 2069 2c20 312c 2031   [(name, i, 1, 1
+00048460: 292c 2069 6465 6e74 6974 795d 2c20 6b77  ), identity], kw
+00048470: 6172 6773 290a 0a20 2020 2067 7261 7068  args)..    graph
+00048480: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+00048490: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+000484a0: 6e73 286e 616d 652c 2064 736b 2c20 6465  ns(name, dsk, de
+000484b0: 7065 6e64 656e 6369 6573 3d5b 6464 665d  pendencies=[ddf]
+000484c0: 290a 2020 2020 7265 7475 726e 206e 6577  ).    return new
+000484d0: 5f64 645f 6f62 6a65 6374 2867 7261 7068  _dd_object(graph
+000484e0: 2c20 6e61 6d65 2c20 6d65 7461 2c20 6469  , name, meta, di
+000484f0: 7669 7369 6f6e 7329 0a0a 0a64 6566 2073  visions)...def s
+00048500: 7566 6669 785f 7265 6475 6374 696f 6e28  uffix_reduction(
+00048510: 662c 2064 6466 2c20 6964 656e 7469 7479  f, ddf, identity
+00048520: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00048530: 2022 2222 436f 6d70 7574 6573 2074 6865   """Computes the
+00048540: 2073 7566 6669 7820 7375 6d73 206f 6620   suffix sums of 
+00048550: 6620 6f6e 2064 660a 0a20 2020 2049 6620  f on df..    If 
+00048560: 6466 2068 6173 2070 6172 7469 7469 6f6e  df has partition
+00048570: 7320 5b50 312c 2050 322c 202e 2e2e 2c20  s [P1, P2, ..., 
+00048580: 506e 5d2c 2074 6865 6e20 7265 7475 726e  Pn], then return
+00048590: 7320 7468 6520 4461 7461 4672 616d 6520  s the DataFrame 
+000485a0: 7769 7468 0a20 2020 2070 6172 7469 7469  with.    partiti
+000485b0: 6f6e 7320 5b66 2850 312c 2066 2850 322c  ons [f(P1, f(P2,
+000485c0: 202e 2e2e 6628 506e 2c20 6964 656e 7469   ...f(Pn, identi
+000485d0: 7479 292e 2e2e 2929 2c0a 2020 2020 2020  ty)...)),.      
+000485e0: 2020 2020 2020 2020 2020 6628 5032 2c20            f(P2, 
+000485f0: 2e2e 2e66 2850 6e2c 2069 6465 6e74 6974  ...f(Pn, identit
+00048600: 7929 2e2e 2e29 2c0a 2020 2020 2020 2020  y)...),.        
+00048610: 2020 2020 2020 2020 2e2e 2e66 2850 6e2c          ...f(Pn,
+00048620: 2069 6465 6e74 6974 7929 2e2e 2e2c 0a20   identity)...,. 
+00048630: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00048640: 2e2e 5d0a 0a20 2020 2050 6172 616d 6574  ..]..    Paramet
+00048650: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00048660: 2d2d 0a20 2020 2066 203a 2063 616c 6c61  --.    f : calla
+00048670: 626c 650a 2020 2020 2020 2020 616e 2061  ble.        an a
+00048680: 7373 6f63 6961 7469 7665 2066 756e 6374  ssociative funct
+00048690: 696f 6e20 660a 2020 2020 6464 6620 3a20  ion f.    ddf : 
+000486a0: 6464 2e44 6174 6146 7261 6d65 0a20 2020  dd.DataFrame.   
+000486b0: 2069 6465 6e74 6974 7920 3a20 7064 2e44   identity : pd.D
+000486c0: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
+000486d0: 2061 6e20 6964 656e 7469 7479 2065 6c65   an identity ele
+000486e0: 6d65 6e74 206f 6620 662c 2074 6861 7420  ment of f, that 
+000486f0: 6973 2066 2869 6465 6e74 6974 792c 2064  is f(identity, d
+00048700: 6629 203d 2066 2864 662c 2069 6465 6e74  f) = f(df, ident
+00048710: 6974 7929 203d 2064 660a 2020 2020 6b77  ity) = df.    kw
+00048720: 6172 6773 203a 203f 3f0a 2020 2020 2020  args : ??.      
+00048730: 2020 6b65 7977 6f72 6420 6172 6775 6d65    keyword argume
+00048740: 6e74 7320 6f66 2066 203f 3f0a 2020 2020  nts of f ??.    
+00048750: 2222 220a 2020 2020 6473 6b20 3d20 6469  """.    dsk = di
+00048760: 6374 2829 0a20 2020 206e 616d 6520 3d20  ct().    name = 
+00048770: 2273 7566 6669 785f 7265 6475 6374 696f  "suffix_reductio
+00048780: 6e2d 2220 2b20 746f 6b65 6e69 7a65 2866  n-" + tokenize(f
+00048790: 2c20 6464 662c 2069 6465 6e74 6974 792c  , ddf, identity,
+000487a0: 202a 2a6b 7761 7267 7329 0a20 2020 206d   **kwargs).    m
+000487b0: 6574 6120 3d20 6464 662e 5f6d 6574 610a  eta = ddf._meta.
+000487c0: 2020 2020 6e20 3d20 6c65 6e28 6464 662e      n = len(ddf.
+000487d0: 6469 7669 7369 6f6e 7329 202d 2031 0a20  divisions) - 1. 
+000487e0: 2020 2064 6976 6973 696f 6e73 203d 205b     divisions = [
+000487f0: 4e6f 6e65 5d20 2a20 286e 202b 2031 290a  None] * (n + 1).
+00048800: 0a20 2020 204e 203d 2031 0a20 2020 2077  .    N = 1.    w
+00048810: 6869 6c65 204e 203c 206e 3a0a 2020 2020  hile N < n:.    
+00048820: 2020 2020 4e20 2a3d 2032 0a20 2020 2066      N *= 2.    f
+00048830: 6f72 2069 2069 6e20 7261 6e67 6528 6e29  or i in range(n)
+00048840: 3a0a 2020 2020 2020 2020 6473 6b5b 286e  :.        dsk[(n
+00048850: 616d 652c 2069 2c20 312c 2030 295d 203d  ame, i, 1, 0)] =
+00048860: 2028 6170 706c 792c 2066 2c20 5b28 6464   (apply, f, [(dd
+00048870: 662e 5f6e 616d 652c 206e 202d 2031 202d  f._name, n - 1 -
+00048880: 2069 292c 2069 6465 6e74 6974 795d 2c20   i), identity], 
+00048890: 6b77 6172 6773 290a 2020 2020 666f 7220  kwargs).    for 
+000488a0: 6920 696e 2072 616e 6765 286e 2c20 4e29  i in range(n, N)
+000488b0: 3a0a 2020 2020 2020 2020 6473 6b5b 286e  :.        dsk[(n
+000488c0: 616d 652c 2069 2c20 312c 2030 295d 203d  ame, i, 1, 0)] =
+000488d0: 2069 6465 6e74 6974 790a 0a20 2020 2064   identity..    d
+000488e0: 203d 2031 0a20 2020 2077 6869 6c65 2064   = 1.    while d
+000488f0: 203c 204e 3a0a 2020 2020 2020 2020 666f   < N:.        fo
+00048900: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00048910: 4e2c 2032 202a 2064 293a 0a20 2020 2020  N, 2 * d):.     
+00048920: 2020 2020 2020 2064 736b 5b28 6e61 6d65         dsk[(name
+00048930: 2c20 6920 2b20 3220 2a20 6420 2d20 312c  , i + 2 * d - 1,
+00048940: 2032 202a 2064 2c20 3029 5d20 3d20 280a   2 * d, 0)] = (.
+00048950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048960: 6170 706c 792c 0a20 2020 2020 2020 2020  apply,.         
+00048970: 2020 2020 2020 2066 2c0a 2020 2020 2020         f,.      
+00048980: 2020 2020 2020 2020 2020 5b28 6e61 6d65            [(name
+00048990: 2c20 6920 2b20 3220 2a20 6420 2d20 312c  , i + 2 * d - 1,
+000489a0: 2064 2c20 3029 2c20 286e 616d 652c 2069   d, 0), (name, i
+000489b0: 202b 2064 202d 2031 2c20 642c 2030 295d   + d - 1, d, 0)]
+000489c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000489d0: 2020 6b77 6172 6773 2c0a 2020 2020 2020    kwargs,.      
+000489e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000489f0: 6420 2a3d 2032 0a0a 2020 2020 6473 6b5b  d *= 2..    dsk[
+00048a00: 286e 616d 652c 204e 202d 2031 2c20 4e2c  (name, N - 1, N,
+00048a10: 2031 295d 203d 2069 6465 6e74 6974 790a   1)] = identity.
+00048a20: 0a20 2020 2077 6869 6c65 2064 203e 2031  .    while d > 1
+00048a30: 3a0a 2020 2020 2020 2020 6420 2f2f 3d20  :.        d //= 
+00048a40: 320a 2020 2020 2020 2020 666f 7220 6920  2.        for i 
+00048a50: 696e 2072 616e 6765 2830 2c20 4e2c 2032  in range(0, N, 2
+00048a60: 202a 2064 293a 0a20 2020 2020 2020 2020   * d):.         
+00048a70: 2020 2064 736b 5b28 6e61 6d65 2c20 6920     dsk[(name, i 
+00048a80: 2b20 6420 2d20 312c 2064 2c20 3129 5d20  + d - 1, d, 1)] 
+00048a90: 3d20 286e 616d 652c 2069 202b 2032 202a  = (name, i + 2 *
+00048aa0: 2064 202d 2031 2c20 3220 2a20 642c 2031   d - 1, 2 * d, 1
+00048ab0: 290a 2020 2020 2020 2020 2020 2020 6473  ).            ds
+00048ac0: 6b5b 286e 616d 652c 2069 202b 2032 202a  k[(name, i + 2 *
+00048ad0: 2064 202d 2031 2c20 642c 2031 295d 203d   d - 1, d, 1)] =
+00048ae0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00048af0: 2020 2061 7070 6c79 2c0a 2020 2020 2020     apply,.      
+00048b00: 2020 2020 2020 2020 2020 662c 0a20 2020            f,.   
+00048b10: 2020 2020 2020 2020 2020 2020 205b 286e               [(n
+00048b20: 616d 652c 2069 202b 2064 202d 2031 2c20  ame, i + d - 1, 
+00048b30: 642c 2030 292c 2028 6e61 6d65 2c20 6920  d, 0), (name, i 
+00048b40: 2b20 3220 2a20 6420 2d20 312c 2032 202a  + 2 * d - 1, 2 *
+00048b50: 2064 2c20 3129 5d2c 0a20 2020 2020 2020   d, 1)],.       
+00048b60: 2020 2020 2020 2020 206b 7761 7267 732c           kwargs,
+00048b70: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00048b80: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00048b90: 6765 286e 293a 0a20 2020 2020 2020 2064  ge(n):.        d
+00048ba0: 736b 5b28 6e61 6d65 2c20 6929 5d20 3d20  sk[(name, i)] = 
+00048bb0: 2861 7070 6c79 2c20 662c 205b 286e 616d  (apply, f, [(nam
+00048bc0: 652c 206e 202d 2031 202d 2069 2c20 312c  e, n - 1 - i, 1,
+00048bd0: 2031 292c 2069 6465 6e74 6974 795d 2c20   1), identity], 
+00048be0: 6b77 6172 6773 290a 0a20 2020 2067 7261  kwargs)..    gra
+00048bf0: 7068 203d 2048 6967 684c 6576 656c 4772  ph = HighLevelGr
+00048c00: 6170 682e 6672 6f6d 5f63 6f6c 6c65 6374  aph.from_collect
+00048c10: 696f 6e73 286e 616d 652c 2064 736b 2c20  ions(name, dsk, 
+00048c20: 6465 7065 6e64 656e 6369 6573 3d5b 6464  dependencies=[dd
+00048c30: 665d 290a 2020 2020 7265 7475 726e 206e  f]).    return n
+00048c40: 6577 5f64 645f 6f62 6a65 6374 2867 7261  ew_dd_object(gra
+00048c50: 7068 2c20 6e61 6d65 2c20 6d65 7461 2c20  ph, name, meta, 
+00048c60: 6469 7669 7369 6f6e 7329 0a0a 0a64 6566  divisions)...def
+00048c70: 206d 6170 7365 7269 6573 2862 6173 655f   mapseries(base_
+00048c80: 6368 756e 6b2c 2063 6f6e 6361 745f 6d61  chunk, concat_ma
+00048c90: 7029 3a0a 2020 2020 7265 7475 726e 2062  p):.    return b
+00048ca0: 6173 655f 6368 756e 6b2e 6d61 7028 636f  ase_chunk.map(co
+00048cb0: 6e63 6174 5f6d 6170 290a 0a0a 6465 6620  ncat_map)...def 
+00048cc0: 6d61 7073 6572 6965 735f 636f 6d62 696e  mapseries_combin
+00048cd0: 6528 696e 6465 782c 2063 6f6e 6361 745f  e(index, concat_
+00048ce0: 7265 7375 6c74 293a 0a20 2020 2066 696e  result):.    fin
+00048cf0: 616c 5f73 6572 6965 7320 3d20 636f 6e63  al_series = conc
+00048d00: 6174 5f72 6573 756c 742e 736f 7274 5f69  at_result.sort_i
+00048d10: 6e64 6578 2829 0a20 2020 2066 696e 616c  ndex().    final
+00048d20: 5f73 6572 6965 7320 3d20 696e 6465 782e  _series = index.
+00048d30: 746f 5f73 6572 6965 7328 292e 6d61 7028  to_series().map(
+00048d40: 6669 6e61 6c5f 7365 7269 6573 290a 2020  final_series).  
+00048d50: 2020 7265 7475 726e 2066 696e 616c 5f73    return final_s
+00048d60: 6572 6965 730a 0a0a 6465 6620 7365 7269  eries...def seri
+00048d70: 6573 5f6d 6170 2862 6173 655f 7365 7269  es_map(base_seri
+00048d80: 6573 2c20 6d61 705f 7365 7269 6573 293a  es, map_series):
+00048d90: 0a20 2020 206e 7061 7274 6974 696f 6e73  .    npartitions
+00048da0: 203d 2062 6173 655f 7365 7269 6573 2e6e   = base_series.n
+00048db0: 7061 7274 6974 696f 6e73 0a20 2020 2073  partitions.    s
+00048dc0: 706c 6974 5f6f 7574 203d 206d 6170 5f73  plit_out = map_s
+00048dd0: 6572 6965 732e 6e70 6172 7469 7469 6f6e  eries.npartition
+00048de0: 730a 0a20 2020 2064 736b 203d 207b 7d0a  s..    dsk = {}.
+00048df0: 0a20 2020 2062 6173 655f 746f 6b65 6e5f  .    base_token_
+00048e00: 6b65 7920 3d20 746f 6b65 6e69 7a65 2862  key = tokenize(b
+00048e10: 6173 655f 7365 7269 6573 2c20 7370 6c69  ase_series, spli
+00048e20: 745f 6f75 7429 0a20 2020 2062 6173 655f  t_out).    base_
+00048e30: 7370 6c69 745f 7072 6566 6978 203d 2066  split_prefix = f
+00048e40: 2262 6173 652d 7370 6c69 742d 7b62 6173  "base-split-{bas
+00048e50: 655f 746f 6b65 6e5f 6b65 797d 220a 2020  e_token_key}".  
+00048e60: 2020 6261 7365 5f73 6861 7264 5f70 7265    base_shard_pre
+00048e70: 6669 7820 3d20 6622 6261 7365 2d73 6861  fix = f"base-sha
+00048e80: 7264 2d7b 6261 7365 5f74 6f6b 656e 5f6b  rd-{base_token_k
+00048e90: 6579 7d22 0a20 2020 2066 6f72 2069 2c20  ey}".    for i, 
+00048ea0: 6b65 7920 696e 2065 6e75 6d65 7261 7465  key in enumerate
+00048eb0: 2862 6173 655f 7365 7269 6573 2e5f 5f64  (base_series.__d
+00048ec0: 6173 6b5f 6b65 7973 5f5f 2829 293a 0a20  ask_keys__()):. 
+00048ed0: 2020 2020 2020 2064 736b 5b28 6261 7365         dsk[(base
+00048ee0: 5f73 706c 6974 5f70 7265 6669 782c 2069  _split_prefix, i
+00048ef0: 295d 203d 2028 6861 7368 5f73 6861 7264  )] = (hash_shard
+00048f00: 2c20 6b65 792c 2073 706c 6974 5f6f 7574  , key, split_out
+00048f10: 290a 2020 2020 2020 2020 666f 7220 6a20  ).        for j 
+00048f20: 696e 2072 616e 6765 2873 706c 6974 5f6f  in range(split_o
+00048f30: 7574 293a 0a20 2020 2020 2020 2020 2020  ut):.           
+00048f40: 2064 736b 5b28 6261 7365 5f73 6861 7264   dsk[(base_shard
+00048f50: 5f70 7265 6669 782c 2030 2c20 692c 206a  _prefix, 0, i, j
+00048f60: 295d 203d 2028 6765 7469 7465 6d2c 2028  )] = (getitem, (
+00048f70: 6261 7365 5f73 706c 6974 5f70 7265 6669  base_split_prefi
+00048f80: 782c 2069 292c 206a 290a 0a20 2020 206d  x, i), j)..    m
+00048f90: 6170 5f74 6f6b 656e 5f6b 6579 203d 2074  ap_token_key = t
+00048fa0: 6f6b 656e 697a 6528 6d61 705f 7365 7269  okenize(map_seri
+00048fb0: 6573 290a 2020 2020 6d61 705f 7370 6c69  es).    map_spli
+00048fc0: 745f 7072 6566 6978 203d 2066 226d 6170  t_prefix = f"map
+00048fd0: 2d73 706c 6974 2d7b 6d61 705f 746f 6b65  -split-{map_toke
+00048fe0: 6e5f 6b65 797d 220a 2020 2020 6d61 705f  n_key}".    map_
+00048ff0: 7368 6172 645f 7072 6566 6978 203d 2066  shard_prefix = f
+00049000: 226d 6170 2d73 6861 7264 2d7b 6d61 705f  "map-shard-{map_
+00049010: 746f 6b65 6e5f 6b65 797d 220a 2020 2020  token_key}".    
+00049020: 666f 7220 692c 206b 6579 2069 6e20 656e  for i, key in en
+00049030: 756d 6572 6174 6528 6d61 705f 7365 7269  umerate(map_seri
+00049040: 6573 2e5f 5f64 6173 6b5f 6b65 7973 5f5f  es.__dask_keys__
+00049050: 2829 293a 0a20 2020 2020 2020 2064 736b  ()):.        dsk
+00049060: 5b28 6d61 705f 7370 6c69 745f 7072 6566  [(map_split_pref
+00049070: 6978 2c20 6929 5d20 3d20 280a 2020 2020  ix, i)] = (.    
+00049080: 2020 2020 2020 2020 6861 7368 5f73 6861          hash_sha
+00049090: 7264 2c0a 2020 2020 2020 2020 2020 2020  rd,.            
+000490a0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
+000490b0: 2073 706c 6974 5f6f 7574 2c0a 2020 2020   split_out,.    
+000490c0: 2020 2020 2020 2020 7370 6c69 745f 6f75          split_ou
+000490d0: 745f 6f6e 5f69 6e64 6578 2c0a 2020 2020  t_on_index,.    
+000490e0: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
+000490f0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00049100: 666f 7220 6a20 696e 2072 616e 6765 2873  for j in range(s
+00049110: 706c 6974 5f6f 7574 293a 0a20 2020 2020  plit_out):.     
+00049120: 2020 2020 2020 2064 736b 5b28 6d61 705f         dsk[(map_
+00049130: 7368 6172 645f 7072 6566 6978 2c20 302c  shard_prefix, 0,
+00049140: 2069 2c20 6a29 5d20 3d20 2867 6574 6974   i, j)] = (getit
+00049150: 656d 2c20 286d 6170 5f73 706c 6974 5f70  em, (map_split_p
+00049160: 7265 6669 782c 2069 292c 206a 290a 0a20  refix, i), j).. 
+00049170: 2020 2074 6f6b 656e 5f6b 6579 203d 2074     token_key = t
+00049180: 6f6b 656e 697a 6528 6261 7365 5f73 6572  okenize(base_ser
+00049190: 6965 732c 206d 6170 5f73 6572 6965 7329  ies, map_series)
+000491a0: 0a20 2020 206d 6170 5f70 7265 6669 7820  .    map_prefix 
+000491b0: 3d20 6622 6d61 702d 7365 7269 6573 2d7b  = f"map-series-{
+000491c0: 746f 6b65 6e5f 6b65 797d 220a 2020 2020  token_key}".    
+000491d0: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
+000491e0: 7061 7274 6974 696f 6e73 293a 0a20 2020  partitions):.   
+000491f0: 2020 2020 2066 6f72 206a 2069 6e20 7261       for j in ra
+00049200: 6e67 6528 7370 6c69 745f 6f75 7429 3a0a  nge(split_out):.
+00049210: 2020 2020 2020 2020 2020 2020 6473 6b5b              dsk[
+00049220: 286d 6170 5f70 7265 6669 782c 2069 2c20  (map_prefix, i, 
+00049230: 6a29 5d20 3d20 280a 2020 2020 2020 2020  j)] = (.        
+00049240: 2020 2020 2020 2020 6d61 7073 6572 6965          mapserie
+00049250: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00049260: 2020 2028 6261 7365 5f73 6861 7264 5f70     (base_shard_p
+00049270: 7265 6669 782c 2030 2c20 692c 206a 292c  refix, 0, i, j),
+00049280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049290: 2028 5f63 6f6e 6361 742c 205b 286d 6170   (_concat, [(map
+000492a0: 5f73 6861 7264 5f70 7265 6669 782c 2030  _shard_prefix, 0
+000492b0: 2c20 6b2c 206a 2920 666f 7220 6b20 696e  , k, j) for k in
+000492c0: 2072 616e 6765 2873 706c 6974 5f6f 7574   range(split_out
+000492d0: 295d 292c 0a20 2020 2020 2020 2020 2020  )]),.           
+000492e0: 2029 0a0a 2020 2020 6669 6e61 6c5f 7072   )..    final_pr
+000492f0: 6566 6978 203d 2066 226d 6170 2d73 6572  efix = f"map-ser
+00049300: 6965 732d 636f 6d62 696e 652d 7b74 6f6b  ies-combine-{tok
+00049310: 656e 5f6b 6579 7d22 0a20 2020 2066 6f72  en_key}".    for
+00049320: 2069 2c20 6b65 7920 696e 2065 6e75 6d65   i, key in enume
+00049330: 7261 7465 2862 6173 655f 7365 7269 6573  rate(base_series
+00049340: 2e69 6e64 6578 2e5f 5f64 6173 6b5f 6b65  .index.__dask_ke
+00049350: 7973 5f5f 2829 293a 0a20 2020 2020 2020  ys__()):.       
+00049360: 2064 736b 5b28 6669 6e61 6c5f 7072 6566   dsk[(final_pref
+00049370: 6978 2c20 6929 5d20 3d20 280a 2020 2020  ix, i)] = (.    
+00049380: 2020 2020 2020 2020 6d61 7073 6572 6965          mapserie
+00049390: 735f 636f 6d62 696e 652c 0a20 2020 2020  s_combine,.     
+000493a0: 2020 2020 2020 206b 6579 2c0a 2020 2020         key,.    
+000493b0: 2020 2020 2020 2020 285f 636f 6e63 6174          (_concat
+000493c0: 2c20 5b28 6d61 705f 7072 6566 6978 2c20  , [(map_prefix, 
+000493d0: 692c 206a 2920 666f 7220 6a20 696e 2072  i, j) for j in r
+000493e0: 616e 6765 2873 706c 6974 5f6f 7574 295d  ange(split_out)]
+000493f0: 292c 0a20 2020 2020 2020 2029 0a0a 2020  ),.        )..  
+00049400: 2020 6d65 7461 203d 206d 6170 5f73 6572    meta = map_ser
+00049410: 6965 732e 5f6d 6574 612e 636f 7079 2829  ies._meta.copy()
+00049420: 0a20 2020 206d 6574 612e 696e 6465 7820  .    meta.index 
+00049430: 3d20 6261 7365 5f73 6572 6965 732e 5f6d  = base_series._m
+00049440: 6574 612e 696e 6465 780a 2020 2020 6d65  eta.index.    me
+00049450: 7461 203d 206d 616b 655f 6d65 7461 286d  ta = make_meta(m
+00049460: 6574 6129 0a0a 2020 2020 6465 7065 6e64  eta)..    depend
+00049470: 656e 6369 6573 203d 205b 6261 7365 5f73  encies = [base_s
+00049480: 6572 6965 732c 206d 6170 5f73 6572 6965  eries, map_serie
+00049490: 732c 2062 6173 655f 7365 7269 6573 2e69  s, base_series.i
+000494a0: 6e64 6578 5d0a 2020 2020 6772 6170 6820  ndex].    graph 
+000494b0: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
+000494c0: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
+000494d0: 7328 0a20 2020 2020 2020 2066 696e 616c  s(.        final
+000494e0: 5f70 7265 6669 782c 2064 736b 2c20 6465  _prefix, dsk, de
+000494f0: 7065 6e64 656e 6369 6573 3d64 6570 656e  pendencies=depen
+00049500: 6465 6e63 6965 730a 2020 2020 290a 2020  dencies.    ).  
+00049510: 2020 6469 7669 7369 6f6e 7320 3d20 6c69    divisions = li
+00049520: 7374 2862 6173 655f 7365 7269 6573 2e64  st(base_series.d
+00049530: 6976 6973 696f 6e73 290a 0a20 2020 2072  ivisions)..    r
+00049540: 6574 7572 6e20 6e65 775f 6464 5f6f 626a  eturn new_dd_obj
+00049550: 6563 7428 6772 6170 682c 2066 696e 616c  ect(graph, final
+00049560: 5f70 7265 6669 782c 206d 6574 612c 2064  _prefix, meta, d
+00049570: 6976 6973 696f 6e73 290a 0a0a 6465 6620  ivisions)...def 
+00049580: 5f63 6f6e 7665 7274 5f74 6f5f 6e75 6d65  _convert_to_nume
+00049590: 7269 6328 7365 7269 6573 2c20 736b 6970  ric(series, skip
+000495a0: 6e61 293a 0a20 2020 2069 6620 736b 6970  na):.    if skip
+000495b0: 6e61 3a0a 2020 2020 2020 2020 7265 7475  na:.        retu
+000495c0: 726e 2073 6572 6965 732e 6472 6f70 6e61  rn series.dropna
+000495d0: 2829 2e76 6965 7728 2269 3822 290a 0a20  ().view("i8").. 
+000495e0: 2020 2023 2073 6572 6965 732e 7669 6577     # series.view
+000495f0: 2822 6938 2229 2077 6974 6820 7064 2e4e  ("i8") with pd.N
+00049600: 6154 2070 726f 6475 6365 7320 2d39 3232  aT produces -922
+00049610: 3333 3732 3033 3638 3534 3737 3538 3038  3372036854775808
+00049620: 2069 7320 7768 7920 7765 206e 6565 6420   is why we need 
+00049630: 746f 2064 6f20 7468 6973 0a20 2020 2072  to do this.    r
+00049640: 6574 7572 6e20 7365 7269 6573 2e76 6965  eturn series.vie
+00049650: 7728 2269 3822 292e 6d61 736b 2873 6572  w("i8").mask(ser
+00049660: 6965 732e 6973 6e75 6c6c 2829 2c20 6e70  ies.isnull(), np
+00049670: 2e6e 616e 290a 0a0a 6465 6620 5f73 7172  .nan)...def _sqr
+00049680: 745f 616e 645f 636f 6e76 6572 745f 746f  t_and_convert_to
+00049690: 5f74 696d 6564 656c 7461 2870 6172 7469  _timedelta(parti
+000496a0: 7469 6f6e 2c20 6178 6973 2c20 6474 7970  tion, axis, dtyp
+000496b0: 653d 4e6f 6e65 2c20 2a61 7267 732c 202a  e=None, *args, *
+000496c0: 2a6b 7761 7267 7329 3a0a 2020 2020 6966  *kwargs):.    if
+000496d0: 2061 7869 7320 3d3d 2031 3a0a 2020 2020   axis == 1:.    
+000496e0: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
+000496f0: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
+00049700: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00049710: 7761 726e 696e 6773 2e66 696c 7465 7277  warnings.filterw
+00049720: 6172 6e69 6e67 7328 0a20 2020 2020 2020  arnings(.       
+00049730: 2020 2020 2020 2020 2022 6967 6e6f 7265           "ignore
+00049740: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00049750: 2020 2063 6174 6567 6f72 793d 5275 6e74     category=Runt
+00049760: 696d 6557 6172 6e69 6e67 2c0a 2020 2020  imeWarning,.    
+00049770: 2020 2020 2020 2020 2020 2020 6d65 7373              mess
+00049780: 6167 653d 2269 6e76 616c 6964 2076 616c  age="invalid val
+00049790: 7565 2065 6e63 6f75 6e74 6572 6564 2069  ue encountered i
+000497a0: 6e20 6361 7374 222c 0a20 2020 2020 2020  n cast",.       
+000497b0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000497c0: 2020 2072 6574 7572 6e20 7064 2e74 6f5f     return pd.to_
+000497d0: 7469 6d65 6465 6c74 6128 4d2e 7374 6428  timedelta(M.std(
+000497e0: 7061 7274 6974 696f 6e2c 2061 7869 733d  partition, axis=
+000497f0: 6178 6973 2c20 2a61 7267 732c 202a 2a6b  axis, *args, **k
+00049800: 7761 7267 7329 290a 0a20 2020 2069 735f  wargs))..    is_
+00049810: 6466 5f6c 696b 652c 2074 696d 655f 636f  df_like, time_co
+00049820: 6c73 203d 206b 7761 7267 735b 2269 735f  ls = kwargs["is_
+00049830: 6466 5f6c 696b 6522 5d2c 206b 7761 7267  df_like"], kwarg
+00049840: 735b 2274 696d 655f 636f 6c73 225d 0a0a  s["time_cols"]..
+00049850: 2020 2020 7371 7274 203d 206e 702e 7371      sqrt = np.sq
+00049860: 7274 2870 6172 7469 7469 6f6e 290a 0a20  rt(partition).. 
+00049870: 2020 2069 6620 6e6f 7420 6973 5f64 665f     if not is_df_
+00049880: 6c69 6b65 3a0a 2020 2020 2020 2020 7265  like:.        re
+00049890: 7475 726e 2070 642e 746f 5f74 696d 6564  turn pd.to_timed
+000498a0: 656c 7461 2873 7172 7429 0a0a 2020 2020  elta(sqrt)..    
+000498b0: 7469 6d65 5f63 6f6c 5f6d 6173 6b20 3d20  time_col_mask = 
+000498c0: 7371 7274 2e69 6e64 6578 2e69 7369 6e28  sqrt.index.isin(
+000498d0: 7469 6d65 5f63 6f6c 7329 0a20 2020 206d  time_cols).    m
+000498e0: 6174 6368 696e 675f 7661 6c73 203d 2073  atching_vals = s
+000498f0: 7172 745b 7469 6d65 5f63 6f6c 5f6d 6173  qrt[time_col_mas
+00049900: 6b5d 0a20 2020 2066 6f72 2074 696d 655f  k].    for time_
+00049910: 636f 6c2c 206d 6174 6368 696e 675f 7661  col, matching_va
+00049920: 6c20 696e 207a 6970 2874 696d 655f 636f  l in zip(time_co
+00049930: 6c73 2c20 6d61 7463 6869 6e67 5f76 616c  ls, matching_val
+00049940: 7329 3a0a 2020 2020 2020 2020 7371 7274  s):.        sqrt
+00049950: 5b74 696d 655f 636f 6c5d 203d 2070 642e  [time_col] = pd.
+00049960: 746f 5f74 696d 6564 656c 7461 286d 6174  to_timedelta(mat
+00049970: 6368 696e 675f 7661 6c29 0a0a 2020 2020  ching_val)..    
+00049980: 6966 2064 7479 7065 2069 7320 6e6f 7420  if dtype is not 
+00049990: 4e6f 6e65 3a0a 2020 2020 2020 2020 7371  None:.        sq
+000499a0: 7274 203d 2073 7172 742e 6173 7479 7065  rt = sqrt.astype
+000499b0: 2864 7479 7065 290a 2020 2020 7265 7475  (dtype).    retu
+000499c0: 726e 2073 7172 740a 0a0a 6465 6620 5f72  rn sqrt...def _r
+000499d0: 6169 7365 5f69 665f 6e6f 745f 7365 7269  aise_if_not_seri
+000499e0: 6573 5f6f 725f 6461 7461 6672 616d 6528  es_or_dataframe(
+000499f0: 782c 2066 756e 636e 616d 6529 3a0a 2020  x, funcname):.  
+00049a00: 2020 2222 220a 2020 2020 5574 696c 6974    """.    Utilit
+00049a10: 7920 6675 6e63 7469 6f6e 2074 6f20 7261  y function to ra
+00049a20: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
+00049a30: 616e 206f 626a 6563 7420 6973 206e 6f74  an object is not
+00049a40: 2061 2053 6572 6965 7320 6f72 2044 6174   a Series or Dat
+00049a50: 6146 7261 6d65 0a20 2020 2022 2222 0a20  aFrame.    """. 
+00049a60: 2020 2069 6620 6e6f 7420 6973 5f73 6572     if not is_ser
+00049a70: 6965 735f 6c69 6b65 2878 2920 616e 6420  ies_like(x) and 
+00049a80: 6e6f 7420 6973 5f64 6174 6166 7261 6d65  not is_dataframe
+00049a90: 5f6c 696b 6528 7829 3a0a 2020 2020 2020  _like(x):.      
+00049aa0: 2020 7261 6973 6520 4e6f 7449 6d70 6c65    raise NotImple
+00049ab0: 6d65 6e74 6564 4572 726f 7228 0a20 2020  mentedError(.   
+00049ac0: 2020 2020 2020 2020 2022 6025 7360 2069           "`%s` i
+00049ad0: 7320 6f6e 6c79 2073 7570 706f 7274 6564  s only supported
+00049ae0: 2077 6974 6820 6f62 6a65 6374 7320 7468   with objects th
+00049af0: 6174 2061 7265 2044 6174 6166 7261 6d65  at are Dataframe
+00049b00: 7320 6f72 2053 6572 6965 7322 0a20 2020  s or Series".   
+00049b10: 2020 2020 2020 2020 2025 2066 756e 636e           % funcn
+00049b20: 616d 650a 2020 2020 2020 2020 290a 0a0a  ame.        )...
+00049b30: 6465 6620 5f67 6574 6174 7472 5f6e 756d  def _getattr_num
+00049b40: 6572 6963 5f6f 6e6c 7928 2a61 7267 732c  eric_only(*args,
+00049b50: 205f 6461 736b 5f6d 6574 686f 645f 6e61   _dask_method_na
+00049b60: 6d65 2c20 2a2a 6b77 6172 6773 293a 0a20  me, **kwargs):. 
+00049b70: 2020 2077 6974 6820 6368 6563 6b5f 6e75     with check_nu
+00049b80: 6d65 7269 635f 6f6e 6c79 5f64 6570 7265  meric_only_depre
+00049b90: 6361 7469 6f6e 2829 3a0a 2020 2020 2020  cation():.      
+00049ba0: 2020 7265 7475 726e 2067 6574 6174 7472    return getattr
+00049bb0: 284d 2c20 5f64 6173 6b5f 6d65 7468 6f64  (M, _dask_method
+00049bc0: 5f6e 616d 6529 282a 6172 6773 2c20 2a2a  _name)(*args, **
+00049bd0: 6b77 6172 6773 290a                      kwargs).
```

### Comparing `dask-2023.6.0/dask/dataframe/dispatch.py` & `dask-2023.6.1/dask/dataframe/dispatch.py`

 * *Files 15% similar despite different names*

```diff
@@ -22,14 +22,16 @@
 categorical_dtype_dispatch = Dispatch("CategoricalDtype")
 concat_dispatch = Dispatch("concat")
 tolist_dispatch = Dispatch("tolist")
 is_categorical_dtype_dispatch = Dispatch("is_categorical_dtype")
 union_categoricals_dispatch = Dispatch("union_categoricals")
 grouper_dispatch = Dispatch("grouper")
 pyarrow_schema_dispatch = Dispatch("pyarrow_schema_dispatch")
+from_pyarrow_table_dispatch = Dispatch("from_pyarrow_table_dispatch")
+to_pyarrow_table_dispatch = Dispatch("to_pyarrow_table_dispatch")
 to_pandas_dispatch = Dispatch("to_pandas_dispatch")
 
 
 def concat(
     dfs,
     axis=0,
     join="outer",
```

### Comparing `dask-2023.6.0/dask/dataframe/extensions.py` & `dask-2023.6.1/dask/dataframe/extensions.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/groupby.py` & `dask-2023.6.1/dask/dataframe/groupby.py`

 * *Files 1% similar despite different names*

```diff
@@ -534,44 +534,48 @@
         return func(g, **kwargs)
     else:
         if isinstance(columns, (tuple, list, set, pd.Index)):
             columns = list(columns)
         return func(g[columns], **kwargs)
 
 
-def _var_chunk(df, *by, numeric_only=no_default):
+def _var_chunk(df, *by, numeric_only=no_default, observed=False, dropna=True):
     numeric_only_kwargs = get_numeric_only_kwargs(numeric_only)
     if is_series_like(df):
         df = df.to_frame()
 
     df = df.copy()
 
-    g = _groupby_raise_unaligned(df, by=by)
+    g = _groupby_raise_unaligned(df, by=by, observed=observed, dropna=dropna)
     with check_numeric_only_deprecation():
         x = g.sum(**numeric_only_kwargs)
 
     n = g[x.columns].count().rename(columns=lambda c: (c, "-count"))
 
     cols = x.columns
     df[cols] = df[cols] ** 2
 
-    g2 = _groupby_raise_unaligned(df, by=by)
+    g2 = _groupby_raise_unaligned(df, by=by, observed=observed, dropna=dropna)
     with check_numeric_only_deprecation():
         x2 = g2.sum(**numeric_only_kwargs).rename(columns=lambda c: (c, "-x2"))
 
     return concat([x, x2, n], axis=1)
 
 
 def _var_combine(g, levels, sort=False):
     return g.groupby(level=levels, sort=sort).sum()
 
 
-def _var_agg(g, levels, ddof, sort=False, numeric_only=no_default):
+def _var_agg(
+    g, levels, ddof, sort=False, numeric_only=no_default, observed=False, dropna=True
+):
     numeric_only_kwargs = get_numeric_only_kwargs(numeric_only)
-    g = g.groupby(level=levels, sort=sort).sum(**numeric_only_kwargs)
+    g = g.groupby(level=levels, sort=sort, observed=observed, dropna=dropna).sum(
+        **numeric_only_kwargs
+    )
     nc = len(g.columns)
     x = g[g.columns[: nc // 3]]
     # chunks columns are tuples (value, name), so we just keep the value part
     x2 = g[g.columns[nc // 3 : 2 * nc // 3]].rename(columns=lambda c: c[0])
     n = g[g.columns[-nc // 3 :]].rename(columns=lambda c: c[0])
 
     # TODO: replace with _finalize_var?
@@ -1311,19 +1315,17 @@
     )
 
 
 def _cumcount_aggregate(a, b, fill_value=None):
     return a.add(b, fill_value=fill_value) + 1
 
 
-def _fillna_group(group, by, value, method, limit, fillna_axis):
-    # apply() conserves the grouped-by columns, so drop them to stay consistent with pandas groupby-fillna
-    return group.drop(columns=by).fillna(
-        value=value, method=method, limit=limit, axis=fillna_axis
-    )
+def _drop_apply(group, *, by, what, **kwargs):
+    # apply keeps the grouped-by columns, so drop them to stay consistent with pandas groupby-fillna
+    return getattr(group.drop(columns=by), what)(**kwargs)
 
 
 def _aggregate_docstring(based_on=None):
     # Insert common groupby-aggregation docstring.
     # Use `based_on` parameter to add note about the
     # Pandas method the Dask version is based on.
     based_on_str = "\n" if based_on is None else f"\nBased on {based_on}\n"
@@ -2065,16 +2067,18 @@
             aggregate=_var_agg,
             combine=_var_combine,
             token=self._token_prefix + "var",
             aggregate_kwargs={
                 "ddof": ddof,
                 "levels": levels,
                 "numeric_only": numeric_only,
+                **self.observed,
+                **self.dropna,
             },
-            chunk_kwargs={"numeric_only": numeric_only},
+            chunk_kwargs={"numeric_only": numeric_only, **self.observed, **self.dropna},
             combine_kwargs={"levels": levels},
             split_every=split_every,
             split_out=split_out,
             split_out_setup=split_out_on_index,
             sort=self.sort,
         )
 
@@ -2826,44 +2830,62 @@
         """
         axis = self._normalize_axis(axis, "fillna")
         if not np.isscalar(value) and value is not None:
             raise NotImplementedError(
                 "groupby-fillna with value=dict/Series/DataFrame is currently not supported"
             )
         meta = self._meta_nonempty.apply(
-            _fillna_group,
+            _drop_apply,
             by=self.by,
+            what="fillna",
             value=value,
             method=method,
             limit=limit,
-            fillna_axis=axis,
+            axis=axis,
         )
 
         result = self.apply(
-            _fillna_group,
+            _drop_apply,
             by=self.by,
+            what="fillna",
             value=value,
             method=method,
             limit=limit,
-            fillna_axis=axis,
+            axis=axis,
             meta=meta,
         )
 
         if PANDAS_GT_150 and self.group_keys:
             return result.map_partitions(M.droplevel, self.by)
 
         return result
 
     @derived_from(pd.core.groupby.GroupBy)
     def ffill(self, limit=None):
-        return self.fillna(method="ffill", limit=limit)
+        meta = self._meta_nonempty.apply(
+            _drop_apply, by=self.by, what="ffill", limit=limit
+        )
+        result = self.apply(
+            _drop_apply, by=self.by, what="ffill", limit=limit, meta=meta
+        )
+        if PANDAS_GT_150 and self.group_keys:
+            return result.map_partitions(M.droplevel, self.by)
+        return result
 
     @derived_from(pd.core.groupby.GroupBy)
     def bfill(self, limit=None):
-        return self.fillna(method="bfill", limit=limit)
+        meta = self._meta_nonempty.apply(
+            _drop_apply, by=self.by, what="bfill", limit=limit
+        )
+        result = self.apply(
+            _drop_apply, by=self.by, what="bfill", limit=limit, meta=meta
+        )
+        if PANDAS_GT_150 and self.group_keys:
+            return result.map_partitions(M.droplevel, self.by)
+        return result
 
 
 class DataFrameGroupBy(_GroupBy):
     _token_prefix = "dataframe-groupby-"
 
     def __getitem__(self, key):
         with check_observed_deprecation():
```

### Comparing `dask-2023.6.0/dask/dataframe/hyperloglog.py` & `dask-2023.6.1/dask/dataframe/hyperloglog.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/indexing.py` & `dask-2023.6.1/dask/dataframe/indexing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/__init__.py` & `dask-2023.6.1/dask/dataframe/io/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/csv.py` & `dask-2023.6.1/dask/dataframe/io/csv.py`

 * *Files 1% similar despite different names*

```diff
@@ -584,43 +584,44 @@
 
     # Get header row, and check that sample is long enough. If the file
     # contains a header row, we need at least 2 nonempty rows + the number of
     # rows to skip.
     names = kwargs.get("names", None)
     header = kwargs.get("header", "infer" if names is None else None)
     need = 1 if header is None else 2
-
+    if isinstance(header, int):
+        firstrow += header
     if kwargs.get("comment"):
         # if comment is provided, step through lines of b_sample and strip out comments
         parts = []
         for part in b_sample.split(b_lineterminator):
             split_comment = part.decode().split(kwargs.get("comment"))
             if len(split_comment) > 1:
                 # if line starts with comment, don't include that line in parts.
                 if len(split_comment[0]) > 0:
                     parts.append(split_comment[0].strip().encode())
             else:
                 parts.append(part)
             if len(parts) > need:
                 break
     else:
-        parts = b_sample.split(b_lineterminator, lastskiprow + need)
+        parts = b_sample.split(
+            b_lineterminator, max(lastskiprow + need, firstrow + need)
+        )
 
     # If the last partition is empty, don't count it
     nparts = 0 if not parts else len(parts) - int(not parts[-1])
 
     if sample is not False and nparts < lastskiprow + need and len(b_sample) >= sample:
         raise ValueError(
             "Sample is not large enough to include at least one "
             "row of data. Please increase the number of bytes "
             "in `sample` in the call to `read_csv`/`read_table`"
         )
 
-    if isinstance(header, int):
-        firstrow += header
     header = b"" if header is None else parts[firstrow] + b_lineterminator
 
     # Use sample to infer dtypes and check for presence of include_path_column
     head_kwargs = kwargs.copy()
     head_kwargs.pop("skipfooter", None)
     if head_kwargs.get("engine") == "pyarrow":
         # Use c engine to infer since Arrow engine does not support nrows
```

### Comparing `dask-2023.6.0/dask/dataframe/io/demo.py` & `dask-2023.6.1/dask/dataframe/io/demo.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/hdf.py` & `dask-2023.6.1/dask/dataframe/io/hdf.py`

 * *Files 1% similar despite different names*

```diff
@@ -16,15 +16,15 @@
     get_scheduler,
     named_schedulers,
     tokenize,
 )
 from dask.dataframe.backends import dataframe_creation_dispatch
 from dask.dataframe.core import DataFrame, Scalar
 from dask.dataframe.io.io import _link, from_map
-from dask.dataframe.io.utils import DataFrameIOFunction
+from dask.dataframe.io.utils import DataFrameIOFunction, SupportsLock
 from dask.highlevelgraph import HighLevelGraph
 from dask.utils import get_scheduler_lock
 
 MP_GET = named_schedulers.get("processes", object())
 
 
 def _pd_to_hdf(pd_to_hdf, lock, args, kwargs=None):
@@ -217,16 +217,20 @@
             lock = True
         elif not single_file and _actual_get is not MP_GET:
             # if we're writing to multiple files with the multiprocessing
             # scheduler we don't need to lock
             lock = True
         else:
             lock = False
-    if lock:
+
+    # TODO: validation logic to ensure that provided locks are compatible with the scheduler
+    if isinstance(lock, bool) and lock:
         lock = get_scheduler_lock(df, scheduler=scheduler)
+    elif lock:
+        assert isinstance(lock, SupportsLock)
 
     kwargs.update({"format": "table", "mode": mode, "append": append})
 
     dsk = dict()
 
     i_name = name_function(0)
     dsk[(name, 0)] = (
```

### Comparing `dask-2023.6.0/dask/dataframe/io/io.py` & `dask-2023.6.1/dask/dataframe/io/io.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/json.py` & `dask-2023.6.1/dask/dataframe/io/json.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/orc/arrow.py` & `dask-2023.6.1/dask/dataframe/io/orc/arrow.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/orc/core.py` & `dask-2023.6.1/dask/dataframe/io/orc/core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/parquet/arrow.py` & `dask-2023.6.1/dask/dataframe/io/parquet/arrow.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/parquet/core.py` & `dask-2023.6.1/dask/dataframe/io/parquet/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -612,15 +612,15 @@
             common_kwargs,
         )
 
     # If we are using a remote filesystem and retries is not set, bump it
     # to be more fault tolerant, as transient transport errors can occur.
     # The specific number 5 isn't hugely motivated: it's less than ten and more
     # than two.
-    annotations = dask.config.get("annotations", {})
+    annotations = dask.get_annotations()
     if "retries" not in annotations and not _is_local_fs(fs):
         ctx = dask.annotate(retries=5)
     else:
         ctx = contextlib.nullcontext()  # type: ignore
 
     with ctx:
         # Construct the output collection with from_map
@@ -988,15 +988,15 @@
         if len(set(filenames)) < len(filenames):
             raise ValueError("``name_function`` must produce unique filenames.")
 
     # If we are using a remote filesystem and retries is not set, bump it
     # to be more fault tolerant, as transient transport errors can occur.
     # The specific number 5 isn't hugely motivated: it's less than ten and more
     # than two.
-    annotations = dask.config.get("annotations", {})
+    annotations = dask.get_annotations()
     if "retries" not in annotations and not _is_local_fs(fs):
         ctx = dask.annotate(retries=5)
     else:
         ctx = contextlib.nullcontext()
 
     # Create Blockwise layer for parquet-data write
     with ctx:
```

### Comparing `dask-2023.6.0/dask/dataframe/io/parquet/fastparquet.py` & `dask-2023.6.1/dask/dataframe/io/parquet/fastparquet.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/parquet/utils.py` & `dask-2023.6.1/dask/dataframe/io/parquet/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/sql.py` & `dask-2023.6.1/dask/dataframe/io/sql.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_csv.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_csv.py`

 * *Files 0% similar despite different names*

```diff
@@ -823,27 +823,28 @@
     text = "a,b\r\n1,2\r\n2,3\r\n3,4\r\n4,5\r\n5,6\r\n6,7"
     with filetext(text) as fn:
         df = dd.read_csv(fn, blocksize=5, lineterminator="\r\n")
         assert df.b.sum().compute() == 2 + 3 + 4 + 5 + 6 + 7
         assert df.a.sum().compute() == 1 + 2 + 3 + 4 + 5 + 6
 
 
-def test_header_int():
+@pytest.mark.parametrize("header", [1, 2, 3])
+def test_header_int(header):
     text = (
         "id0,name0,x0,y0\n"
         "id,name,x,y\n"
         "1034,Victor,-0.25,0.84\n"
         "998,Xavier,-0.48,-0.13\n"
         "999,Zelda,0.00,0.47\n"
         "980,Alice,0.67,-0.98\n"
         "989,Zelda,-0.04,0.03\n"
     )
     with filetexts({"test_header_int.csv": text}):
-        df = dd.read_csv("test_header_int.csv", header=1, blocksize=64)
-        expected = pd.read_csv("test_header_int.csv", header=1)
+        df = dd.read_csv("test_header_int.csv", header=header, blocksize=64)
+        expected = pd.read_csv("test_header_int.csv", header=header)
         assert_eq(df, expected, check_index=False)
 
 
 def test_header_None():
     with filetexts({".tmp.1.csv": "1,2", ".tmp.2.csv": "", ".tmp.3.csv": "3,4"}):
         df = dd.read_csv(".tmp.*.csv", header=None)
         expected = pd.DataFrame({0: [1, 3], 1: [2, 4]})
```

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_demo.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_demo.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_hdf.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_hdf.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_io.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_io.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_json.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_json.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_orc.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_orc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_parquet.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_parquet.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/tests/test_sql.py` & `dask-2023.6.1/dask/dataframe/io/tests/test_sql.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/io/utils.py` & `dask-2023.6.1/dask/dataframe/io/utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -239,7 +239,16 @@
         with a new column projection
         """
         raise NotImplementedError
 
     def __call__(self, *args, **kwargs):
         """Return a new DataFrame partition"""
         raise NotImplementedError
+
+
+@runtime_checkable
+class SupportsLock(Protocol):
+    def acquire(self) -> object:
+        ...
+
+    def release(self) -> object:
+        ...
```

### Comparing `dask-2023.6.0/dask/dataframe/methods.py` & `dask-2023.6.1/dask/dataframe/methods.py`

 * *Files 0% similar despite different names*

```diff
@@ -411,15 +411,18 @@
 def drop_columns(df, columns, dtype):
     df = df.drop(columns, axis=1)
     df.columns = df.columns.astype(dtype)
     return df
 
 
 def fillna_check(df, method, check=True):
-    out = df.fillna(method=method)
+    if method:
+        out = getattr(df, method)()
+    else:
+        out = df.fillna()
     if check and out.isnull().values.all(axis=0).any():
         raise ValueError(
             "All NaN partition encountered in `fillna`. Try "
             "using ``df.repartition`` to increase the partition "
             "size, or specify `limit` in `fillna`."
         )
     return out
```

### Comparing `dask-2023.6.0/dask/dataframe/multi.py` & `dask-2023.6.1/dask/dataframe/multi.py`

 * *Files 0% similar despite different names*

```diff
@@ -94,15 +94,15 @@
     is_dataframe_like,
     is_series_like,
     make_meta,
     strip_unknown_categories,
 )
 from dask.highlevelgraph import HighLevelGraph
 from dask.layers import BroadcastJoinLayer
-from dask.utils import M, apply, get_default_shuffle_algorithm
+from dask.utils import M, apply, get_default_shuffle_method
 
 
 def align_partitions(*dfs):
     """Mutually partition and align DataFrame blocks
 
     This serves as precursor to multi-dataframe operations like join, concat,
     or merge.
@@ -343,15 +343,15 @@
 
     This shuffles both datasets on the joined column and then performs an
     embarrassingly parallel join partition-by-partition
 
     >>> hash_join(lhs, 'id', rhs, 'id', how='left', npartitions=10)  # doctest: +SKIP
     """
     if shuffle is None:
-        shuffle = get_default_shuffle_algorithm()
+        shuffle = get_default_shuffle_method()
     if shuffle == "p2p":
         from distributed.shuffle import hash_join_p2p
 
         return hash_join_p2p(
             lhs=lhs,
             left_on=left_on,
             rhs=rhs,
```

### Comparing `dask-2023.6.0/dask/dataframe/numeric.py` & `dask-2023.6.1/dask/dataframe/numeric.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/optimize.py` & `dask-2023.6.1/dask/dataframe/optimize.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/partitionquantiles.py` & `dask-2023.6.1/dask/dataframe/partitionquantiles.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/reshape.py` & `dask-2023.6.1/dask/dataframe/reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/rolling.py` & `dask-2023.6.1/dask/dataframe/rolling.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/shuffle.py` & `dask-2023.6.1/dask/dataframe/shuffle.py`

 * *Files 0% similar despite different names*

```diff
@@ -20,15 +20,15 @@
 from dask.dataframe import methods
 from dask.dataframe.core import DataFrame, Series, _Frame, map_partitions, new_dd_object
 from dask.dataframe.dispatch import group_split_dispatch, hash_object_dispatch
 from dask.dataframe.utils import UNKNOWN_CATEGORIES
 from dask.highlevelgraph import HighLevelGraph
 from dask.layers import ShuffleLayer, SimpleShuffleLayer
 from dask.sizeof import sizeof
-from dask.utils import M, digit, get_default_shuffle_algorithm
+from dask.utils import M, digit, get_default_shuffle_method
 
 logger = logging.getLogger(__name__)
 
 
 def _calculate_divisions(
     df: DataFrame,
     partition_col: Series,
@@ -86,16 +86,16 @@
     else:
         # Drop duplicate divisions returned by partition quantiles
         n = divisions.size
         divisions = (
             list(divisions.iloc[: n - 1].unique()) + divisions.iloc[n - 1 :].tolist()
         )
 
-    mins = mins.fillna(method="bfill")
-    maxes = maxes.fillna(method="bfill")
+    mins = mins.bfill()
+    maxes = maxes.bfill()
     if isinstance(partition_col.dtype, pd.CategoricalDtype):
         dtype = partition_col.dtype
         mins = mins.astype(dtype)
         maxes = maxes.astype(dtype)
 
     if mins.isna().any() or maxes.isna().any():
         presorted = False
@@ -207,17 +207,23 @@
     npartitions: int | Literal["auto"] | None = None,
     shuffle: str | None = None,
     compute: bool = False,
     drop: bool = True,
     upsample: float = 1.0,
     divisions: Sequence | None = None,
     partition_size: float = 128e6,
+    sort: bool = True,
     **kwargs,
 ) -> DataFrame:
     """See _Frame.set_index for docstring"""
+    if not sort:
+        return df.map_partitions(
+            M.set_index, index, align_dataframes=False, drop=drop, **kwargs
+        ).clear_divisions()
+
     if npartitions == "auto":
         repartition = True
         npartitions = max(100, df.npartitions)
     else:
         if npartitions is None:
             npartitions = df.npartitions
         repartition = False
@@ -369,15 +375,15 @@
     See Also
     --------
     set_index
     set_partition
     shuffle_disk
     """
     list_like = pd.api.types.is_list_like(index) and not is_dask_collection(index)
-    shuffle = shuffle or get_default_shuffle_algorithm()
+    shuffle = shuffle or get_default_shuffle_method()
     if shuffle == "tasks" and (isinstance(index, str) or list_like):
         # Avoid creating the "_partitions" column if possible.
         # We currently do this if the user is passing in
         # specific column names (and shuffle == "tasks").
         if isinstance(index, str):
             index = [index]
         else:
@@ -469,15 +475,15 @@
     col,
     npartitions=None,
     max_branch=None,
     shuffle=None,
     compute=None,
     ignore_index=False,
 ):
-    shuffle = shuffle or get_default_shuffle_algorithm()
+    shuffle = shuffle or get_default_shuffle_method()
 
     # if the requested output partitions < input partitions
     # we repartition first as shuffling overhead is
     # proportionate to the number of input partitions
 
     if npartitions is not None and npartitions < df.npartitions:
         df = df.repartition(npartitions=npartitions)
@@ -1025,16 +1031,16 @@
     And make sure that the partitions are sorted relative to each other.
     NOTE: this does not guarantee that every partition is internally sorted.
     """
     mins = column.map_partitions(M.min, meta=column)
     maxes = column.map_partitions(M.max, meta=column)
     lens = column.map_partitions(len, meta=column)
     mins, maxes, lens = compute(mins, maxes, lens, **kwargs)
-    mins = mins.fillna(method="bfill").tolist()
-    maxes = maxes.fillna(method="bfill").tolist()
+    mins = mins.bfill().tolist()
+    maxes = maxes.bfill().tolist()
     non_empty_mins = [m for m, length in zip(mins, lens) if length != 0]
     non_empty_maxes = [m for m, length in zip(maxes, lens) if length != 0]
     if (
         sorted(non_empty_mins) != non_empty_mins
         or sorted(non_empty_maxes) != non_empty_maxes
     ):
         raise ValueError(
```

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_accessors.py` & `dask-2023.6.1/dask/dataframe/tests/test_accessors.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_arithmetics_reduction.py` & `dask-2023.6.1/dask/dataframe/tests/test_arithmetics_reduction.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_boolean.py` & `dask-2023.6.1/dask/dataframe/tests/test_boolean.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_categorical.py` & `dask-2023.6.1/dask/dataframe/tests/test_categorical.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_dataframe.py` & `dask-2023.6.1/dask/dataframe/tests/test_dataframe.py`

 * *Files 2% similar despite different names*

```diff
@@ -2472,45 +2472,54 @@
 def test_fillna():
     df = _compat.makeMissingDataframe()
     ddf = dd.from_pandas(df, npartitions=5, sort=False)
 
     assert_eq(ddf.fillna(100), df.fillna(100))
     assert_eq(ddf.A.fillna(100), df.A.fillna(100))
     assert_eq(ddf.A.fillna(ddf["A"].mean()), df.A.fillna(df["A"].mean()))
+    assert_eq(ddf.fillna(100, axis=1), df.fillna(100, axis=1))
 
-    assert_eq(ddf.fillna(method="pad"), df.fillna(method="pad"))
-    assert_eq(ddf.A.fillna(method="pad"), df.A.fillna(method="pad"))
+    pytest.raises(ValueError, lambda: ddf.A.fillna(0, axis=1))
+    pytest.raises(NotImplementedError, lambda: ddf.fillna(0, limit=10))
+    pytest.raises(NotImplementedError, lambda: ddf.fillna(0, limit=10, axis=1))
 
-    assert_eq(ddf.fillna(method="bfill"), df.fillna(method="bfill"))
-    assert_eq(ddf.A.fillna(method="bfill"), df.A.fillna(method="bfill"))
 
-    assert_eq(ddf.fillna(method="pad", limit=2), df.fillna(method="pad", limit=2))
-    assert_eq(ddf.A.fillna(method="pad", limit=2), df.A.fillna(method="pad", limit=2))
+def test_ffill():
+    df = _compat.makeMissingDataframe()
+    ddf = dd.from_pandas(df, npartitions=5, sort=False)
 
-    assert_eq(ddf.fillna(method="bfill", limit=2), df.fillna(method="bfill", limit=2))
-    assert_eq(
-        ddf.A.fillna(method="bfill", limit=2), df.A.fillna(method="bfill", limit=2)
-    )
+    assert_eq(ddf.ffill(), df.ffill())
+    assert_eq(ddf.A.ffill(), df.A.ffill())
+    assert_eq(ddf.ffill(limit=2), df.ffill(limit=2))
+    assert_eq(ddf.A.ffill(limit=2), df.A.ffill(limit=2))
+    assert_eq(ddf.ffill(axis=1), df.ffill(axis=1))
+    assert_eq(ddf.ffill(limit=2, axis=1), df.ffill(limit=2, axis=1))
 
-    assert_eq(ddf.fillna(100, axis=1), df.fillna(100, axis=1))
-    assert_eq(ddf.fillna(method="pad", axis=1), df.fillna(method="pad", axis=1))
-    assert_eq(
-        ddf.fillna(method="pad", limit=2, axis=1),
-        df.fillna(method="pad", limit=2, axis=1),
-    )
+    df = _compat.makeMissingDataframe()
+    df.iloc[:15, 0] = np.nan  # all NaN partition
+    ddf = dd.from_pandas(df, npartitions=5, sort=False)
+    pytest.raises(ValueError, lambda: ddf.ffill().compute())
+    assert_eq(df.ffill(limit=3), ddf.ffill(limit=3))
 
-    pytest.raises(ValueError, lambda: ddf.A.fillna(0, axis=1))
-    pytest.raises(NotImplementedError, lambda: ddf.fillna(0, limit=10))
-    pytest.raises(NotImplementedError, lambda: ddf.fillna(0, limit=10, axis=1))
+
+def test_bfill():
+    df = _compat.makeMissingDataframe()
+    ddf = dd.from_pandas(df, npartitions=5, sort=False)
+
+    assert_eq(ddf.bfill(), df.bfill())
+    assert_eq(ddf.A.bfill(), df.A.bfill())
+
+    assert_eq(ddf.bfill(limit=2), df.bfill(limit=2))
+    assert_eq(ddf.A.bfill(limit=2), df.A.bfill(limit=2))
 
     df = _compat.makeMissingDataframe()
     df.iloc[:15, 0] = np.nan  # all NaN partition
     ddf = dd.from_pandas(df, npartitions=5, sort=False)
-    pytest.raises(ValueError, lambda: ddf.fillna(method="pad").compute())
-    assert_eq(df.fillna(method="pad", limit=3), ddf.fillna(method="pad", limit=3))
+    pytest.raises(ValueError, lambda: ddf.bfill().compute())
+    assert_eq(df.bfill(limit=3), ddf.bfill(limit=3))
 
 
 @pytest.mark.parametrize("optimize", [True, False])
 def test_delayed_roundtrip(optimize):
     df1 = d + 1 + 1
     delayed = df1.to_delayed(optimize_graph=optimize)
 
@@ -4528,23 +4537,34 @@
 
 
 @pytest.mark.parametrize("method", ["first", "last"])
 def test_first_and_last(method):
     f = lambda x, offset: getattr(x, method)(offset)
     freqs = ["12h", "D"]
     offsets = ["0d", "100h", "20d", "20B", "3W", "3M", "400d", "13M"]
+    should_warn = PANDAS_GT_210 and method == "first"
+
     for freq in freqs:
         index = pd.date_range("1/1/2000", "1/1/2001", freq=freq)[::4]
         df = pd.DataFrame(
             np.random.random((len(index), 4)), index=index, columns=["A", "B", "C", "D"]
         )
         ddf = dd.from_pandas(df, npartitions=10)
         for offset in offsets:
-            assert_eq(f(ddf, offset), f(df, offset))
-            assert_eq(f(ddf.A, offset), f(df.A, offset))
+            with _check_warning(should_warn, FutureWarning, "first"):
+                expected = f(df, offset)
+            with _check_warning(should_warn, FutureWarning, "first"):
+                actual = f(ddf, offset)
+            assert_eq(actual, expected)
+
+            with _check_warning(should_warn, FutureWarning, "first"):
+                expected = f(df.A, offset)
+            with _check_warning(should_warn, FutureWarning, "first"):
+                actual = f(ddf.A, offset)
+            assert_eq(actual, expected)
 
 
 @pytest.mark.parametrize("npartitions", [1, 4, 20])
 @pytest.mark.parametrize("split_every", [2, 5])
 @pytest.mark.parametrize("split_out", [None, 1, 5, 20])
 def test_hash_split_unique(npartitions, split_every, split_out):
     from string import ascii_lowercase
@@ -6020,7 +6040,54 @@
     ddf = dd.from_pandas(pdf, npartitions=1)
 
     # dataframe
     assert_eq(pdf.where(lambda d: d.isna(), 3), ddf.where(lambda d: d.isna(), 3))
 
     #  series
     assert_eq(pdf.x.where(lambda d: d == 1, 2), ddf.x.where(lambda d: d == 1, 2))
+
+
+@pytest.mark.parametrize("self_destruct", [True, False])
+def test_pyarrow_conversion_dispatch(self_destruct):
+    from dask.dataframe.dispatch import (
+        from_pyarrow_table_dispatch,
+        to_pyarrow_table_dispatch,
+    )
+
+    pytest.importorskip("pyarrow")
+
+    df1 = pd.DataFrame(np.random.randn(10, 3), columns=list("abc"))
+    df2 = from_pyarrow_table_dispatch(
+        df1,
+        to_pyarrow_table_dispatch(df1),
+        self_destruct=self_destruct,
+    )
+
+    assert type(df1) == type(df2)
+    assert_eq(df1, df2)
+
+
+@pytest.mark.gpu
+def test_pyarrow_conversion_dispatch_cudf():
+    # NOTE: This test can probably be removed (or simplified) once
+    # the to_pyarrow_table_dispatch and from_pyarrow_table_dispatch
+    # are registered to `cudf` in `dask_cudf`.
+    from dask.dataframe.dispatch import (
+        from_pyarrow_table_dispatch,
+        to_pyarrow_table_dispatch,
+    )
+
+    cudf = pytest.importorskip("cudf")
+
+    @to_pyarrow_table_dispatch.register(cudf.DataFrame)
+    def _cudf_to_table(obj, preserve_index=True):
+        return obj.to_arrow(preserve_index=preserve_index)
+
+    @from_pyarrow_table_dispatch.register(cudf.DataFrame)
+    def _table_to_cudf(obj, table, self_destruct=False):
+        return obj.from_arrow(table)
+
+    df1 = cudf.DataFrame(np.random.randn(10, 3), columns=list("abc"))
+    df2 = from_pyarrow_table_dispatch(df1, to_pyarrow_table_dispatch(df1))
+
+    assert type(df1) == type(df2)
+    assert_eq(df1, df2)
```

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_extensions.py` & `dask-2023.6.1/dask/dataframe/tests/test_extensions.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_format.py` & `dask-2023.6.1/dask/dataframe/tests/test_format.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_groupby.py` & `dask-2023.6.1/dask/dataframe/tests/test_groupby.py`

 * *Files 1% similar despite different names*

```diff
@@ -1295,17 +1295,16 @@
         ddf.groupby(keys).aggregate(spec, shuffle=False)
     with pytest.raises(ValueError, match="must use shuffl"):
         ddf.groupby(keys).median(shuffle=False)
 
 
 @pytest.mark.parametrize("axis", [0, 1])
 @pytest.mark.parametrize("group_keys", [True, False, None])
-@pytest.mark.parametrize("method", ["ffill", "bfill"])
 @pytest.mark.parametrize("limit", [None, 1, 4])
-def test_fillna(axis, group_keys, method, limit):
+def test_fillna(axis, group_keys, limit):
     df = pd.DataFrame(
         {
             "A": [1, 1, 2, 2],
             "B": [3, 4, 3, 4],
             "C": [np.nan, 3, np.nan, np.nan],
             "D": [4, np.nan, 5, np.nan],
             "E": [6, np.nan, 7, np.nan],
@@ -1322,90 +1321,76 @@
         df.groupby("A", group_keys=group_keys).B.fillna(0),
         ddf.groupby("A", group_keys=group_keys).B.fillna(0),
     )
     assert_eq(
         df.groupby(["A", "B"], group_keys=group_keys).fillna(0),
         ddf.groupby(["A", "B"], group_keys=group_keys).fillna(0),
     )
-    with groupby_axis_deprecated():
-        expected = df.groupby("A", group_keys=group_keys).fillna(
-            method=method, limit=limit, axis=axis
-        )
-    with groupby_axis_deprecated():
-        result = ddf.groupby("A", group_keys=group_keys).fillna(
-            method=method, limit=limit, axis=axis
-        )
-    assert_eq(expected, result)
-    with groupby_axis_deprecated():
-        expected = df.groupby(["A", "B"], group_keys=group_keys).fillna(
-            method=method, limit=limit, axis=axis
-        )
-    with groupby_axis_deprecated():
-        result = ddf.groupby(["A", "B"], group_keys=group_keys).fillna(
-            method=method, limit=limit, axis=axis
-        )
-    assert_eq(expected, result)
 
     with pytest.raises(NotImplementedError):
         ddf.groupby("A").fillna({"A": 0})
 
     with pytest.raises(NotImplementedError):
         ddf.groupby("A").fillna(pd.Series(dtype=int))
 
     with pytest.raises(NotImplementedError):
         ddf.groupby("A").fillna(pd.DataFrame)
 
 
-def test_ffill():
+@pytest.mark.parametrize("group_keys", [True, False, None])
+@pytest.mark.parametrize("limit", [None, 1, 4])
+def test_ffill(group_keys, limit):
     df = pd.DataFrame(
         {
             "A": [1, 1, 2, 2],
             "B": [3, 4, 3, 4],
             "C": [np.nan, 3, np.nan, np.nan],
             "D": [4, np.nan, 5, np.nan],
             "E": [6, np.nan, 7, np.nan],
         }
     )
     ddf = dd.from_pandas(df, npartitions=2)
     assert_eq(
-        df.groupby("A").ffill(),
-        ddf.groupby("A").ffill(),
+        df.groupby("A", group_keys=group_keys).ffill(limit=limit),
+        ddf.groupby("A", group_keys=group_keys).ffill(limit=limit),
     )
     assert_eq(
-        df.groupby("A").B.ffill(),
-        ddf.groupby("A").B.ffill(),
+        df.groupby("A", group_keys=group_keys).B.ffill(limit=limit),
+        ddf.groupby("A", group_keys=group_keys).B.ffill(limit=limit),
     )
     assert_eq(
-        df.groupby(["A", "B"]).ffill(),
-        ddf.groupby(["A", "B"]).ffill(),
+        df.groupby(["A", "B"], group_keys=group_keys).ffill(limit=limit),
+        ddf.groupby(["A", "B"], group_keys=group_keys).ffill(limit=limit),
     )
 
 
-def test_bfill():
+@pytest.mark.parametrize("group_keys", [True, False, None])
+@pytest.mark.parametrize("limit", [None, 1, 4])
+def test_bfill(group_keys, limit):
     df = pd.DataFrame(
         {
             "A": [1, 1, 2, 2],
             "B": [3, 4, 3, 4],
             "C": [np.nan, 3, np.nan, np.nan],
             "D": [np.nan, 4, np.nan, 5],
             "E": [np.nan, 6, np.nan, 7],
         }
     )
     ddf = dd.from_pandas(df, npartitions=2)
     assert_eq(
-        df.groupby("A").bfill(),
-        ddf.groupby("A").bfill(),
+        df.groupby("A", group_keys=group_keys).bfill(limit=limit),
+        ddf.groupby("A", group_keys=group_keys).bfill(limit=limit),
     )
     assert_eq(
-        df.groupby("A").B.bfill(),
-        ddf.groupby("A").B.bfill(),
+        df.groupby("A", group_keys=group_keys).B.bfill(limit=limit),
+        ddf.groupby("A", group_keys=group_keys).B.bfill(limit=limit),
     )
     assert_eq(
-        df.groupby(["A", "B"]).bfill(),
-        ddf.groupby(["A", "B"]).bfill(),
+        df.groupby(["A", "B"], group_keys=group_keys).bfill(limit=limit),
+        ddf.groupby(["A", "B"], group_keys=group_keys).bfill(limit=limit),
     )
 
 
 @pytest.mark.flaky(reruns=5)  # See https://github.com/dask/dask/issues/9793
 @pytest.mark.parametrize(
     "grouper",
     [
@@ -3713,7 +3698,23 @@
             ctx = contextlib.nullcontext()
 
         with ctx:
             dd_result = getattr(ddf.groupby("A"), func)()
         with ctx:
             pd_result = getattr(df.groupby("A"), func)()
         assert_eq(dd_result, pd_result)
+
+
+@pytest.mark.parametrize("func", ["var", "std"])
+@pytest.mark.parametrize("observed", [True, False])
+@pytest.mark.parametrize("dropna", [True, False])
+def test_groupby_var_dropna_observed(dropna, observed, func):
+    df = pd.DataFrame(
+        {
+            "a": [11, 12, 31, 1, 2, 3, 4, 5, 6, 10],
+            "b": pd.Categorical(values=[1] * 9 + [np.nan], categories=[1, 2]),
+        }
+    )
+    ddf = dd.from_pandas(df, npartitions=3)
+    dd_result = getattr(ddf.groupby("b", observed=observed, dropna=dropna), func)()
+    pdf_result = getattr(df.groupby("b", observed=observed, dropna=dropna), func)()
+    assert_eq(dd_result, pdf_result)
```

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_hashing.py` & `dask-2023.6.1/dask/dataframe/tests/test_hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_hyperloglog.py` & `dask-2023.6.1/dask/dataframe/tests/test_hyperloglog.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_indexing.py` & `dask-2023.6.1/dask/dataframe/tests/test_indexing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_merge_column_and_index.py` & `dask-2023.6.1/dask/dataframe/tests/test_merge_column_and_index.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_multi.py` & `dask-2023.6.1/dask/dataframe/tests/test_multi.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_numeric.py` & `dask-2023.6.1/dask/dataframe/tests/test_numeric.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_optimize_dataframe.py` & `dask-2023.6.1/dask/dataframe/tests/test_optimize_dataframe.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_pyarrow.py` & `dask-2023.6.1/dask/dataframe/tests/test_pyarrow.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_pyarrow_compat.py` & `dask-2023.6.1/dask/dataframe/tests/test_pyarrow_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_reshape.py` & `dask-2023.6.1/dask/dataframe/tests/test_reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_rolling.py` & `dask-2023.6.1/dask/dataframe/tests/test_rolling.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_shuffle.py` & `dask-2023.6.1/dask/dataframe/tests/test_shuffle.py`

 * *Files 1% similar despite different names*

```diff
@@ -300,14 +300,42 @@
         "x", shuffle=shuffle_method, max_branch=2, npartitions=ddf.npartitions
     )
     df2 = df.set_index("x")
     assert_eq(df2, ddf2)
     assert ddf2.npartitions == ddf.npartitions
 
 
+@pytest.mark.parametrize("drop", (True, False))
+@pytest.mark.parametrize("append", (True, False))
+def test_set_index_no_sort(drop, append):
+    """
+    GH10333 - Allow setting index on existing partitions without
+    computing new divisions and repartitioning.
+    """
+    df = pd.DataFrame({"col1": [2, 4, 1, 3, 5], "col2": [1, 2, 3, 4, 5]})
+    ddf = dd.from_pandas(df, npartitions=2)
+
+    assert ddf.npartitions > 1
+
+    # Default is sort=True
+    # Index in ddf will be same values, but sorted
+    df_result = df.set_index("col1")
+    ddf_result = ddf.set_index("col1")
+    assert ddf_result.known_divisions
+    assert_eq(ddf_result, df_result.sort_index(), sort_results=False)
+
+    # Unknown divisions and index remains unsorted when sort is False
+    # and thus equal to pandas set_index, adding extra kwargs also supported by
+    # pandas set_index to ensure they're forwarded.
+    df_result = df.set_index("col1", drop=drop, append=append)
+    ddf_result = ddf.set_index("col1", sort=False, drop=drop, append=append)
+    assert not ddf_result.known_divisions
+    assert_eq(ddf_result, df_result, sort_results=False)
+
+
 def test_shuffle_sort(shuffle_method):
     df = pd.DataFrame({"x": [1, 2, 3, 2, 1], "y": [9, 8, 7, 1, 5]})
     ddf = dd.from_pandas(df, npartitions=3)
 
     df2 = df.set_index("x").sort_index()
     ddf2 = ddf.set_index("x", shuffle=shuffle_method)
```

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_ufunc.py` & `dask-2023.6.1/dask/dataframe/tests/test_ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tests/test_utils_dataframe.py` & `dask-2023.6.1/dask/dataframe/tests/test_utils_dataframe.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tseries/resample.py` & `dask-2023.6.1/dask/dataframe/tseries/resample.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/tseries/tests/test_resample.py` & `dask-2023.6.1/dask/dataframe/tseries/tests/test_resample.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dataframe/utils.py` & `dask-2023.6.1/dask/dataframe/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/datasets.py` & `dask-2023.6.1/dask/datasets.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/delayed.py` & `dask-2023.6.1/dask/delayed.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/diagnostics/profile.py` & `dask-2023.6.1/dask/diagnostics/profile.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/diagnostics/profile_visualize.py` & `dask-2023.6.1/dask/diagnostics/profile_visualize.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/diagnostics/progress.py` & `dask-2023.6.1/dask/diagnostics/progress.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/diagnostics/tests/test_profiler.py` & `dask-2023.6.1/dask/diagnostics/tests/test_profiler.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/diagnostics/tests/test_progress.py` & `dask-2023.6.1/dask/diagnostics/tests/test_progress.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/distributed.py` & `dask-2023.6.1/dask/distributed.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/dot.py` & `dask-2023.6.1/dask/dot.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/graph_manipulation.py` & `dask-2023.6.1/dask/graph_manipulation.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/hashing.py` & `dask-2023.6.1/dask/hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/highlevelgraph.py` & `dask-2023.6.1/dask/highlevelgraph.py`

 * *Files 0% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 import copy
 import html
 from collections.abc import Hashable, Iterable, KeysView, Mapping, Set
 from typing import Any
 
 import tlz as toolz
 
+import dask
 from dask import config
 from dask.base import clone_key, flatten, is_dask_collection
 from dask.core import keys_in_tasks, reverse_dict
 from dask.utils import ensure_dict, import_required, key_split
 from dask.widgets import get_template
 
 
@@ -68,15 +69,15 @@
             As such, they are primarily designed for use with the distributed
             scheduler. See the dask.annotate function for more information.
         collection_annotations : Mapping[str, Any], optional. By default, None.
             Experimental, intended to assist with visualizing the performance
             characteristics of Dask computations.
             These annotations are *not* passed to the distributed scheduler.
         """
-        self.annotations = annotations or copy.copy(config.get("annotations", None))
+        self.annotations = annotations or dask.get_annotations().copy() or None
         self.collection_annotations = collection_annotations or copy.copy(
             config.get("collection_annotations", None)
         )
 
     @abc.abstractmethod
     def is_materialized(self) -> bool:
         """Return whether the layer is materialized or not"""
```

### Comparing `dask-2023.6.0/dask/layers.py` & `dask-2023.6.1/dask/layers.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/local.py` & `dask-2023.6.1/dask/local.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/multiprocessing.py` & `dask-2023.6.1/dask/multiprocessing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/optimization.py` & `dask-2023.6.1/dask/optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/order.py` & `dask-2023.6.1/dask/order.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/rewrite.py` & `dask-2023.6.1/dask/rewrite.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/sizeof.py` & `dask-2023.6.1/dask/sizeof.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/system.py` & `dask-2023.6.1/dask/system.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_backends.py` & `dask-2023.6.1/dask/tests/test_backends.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_base.py` & `dask-2023.6.1/dask/tests/test_base.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_cache.py` & `dask-2023.6.1/dask/tests/test_cache.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_callbacks.py` & `dask-2023.6.1/dask/tests/test_callbacks.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_ci.py` & `dask-2023.6.1/dask/tests/test_ci.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_cli.py` & `dask-2023.6.1/dask/tests/test_cli.py`

 * *Files 2% similar despite different names*

```diff
@@ -34,15 +34,15 @@
     assert result.output.startswith("Section not found")
 
 
 def test_config_list():
     runner = CliRunner()
     result = runner.invoke(dask.cli.config_list)
     assert result.exit_code == 0
-    assert result.output.startswith("array:")
+    assert "array:" in result.output
 
 
 def test_version():
     runner = CliRunner()
     result = runner.invoke(dask.cli.cli, ["--version"])
     assert result.exit_code == 0
     assert result.output == f"cli, version {dask.__version__}\n"
```

### Comparing `dask-2023.6.0/dask/tests/test_config.py` & `dask-2023.6.1/dask/tests/test_config.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_context.py` & `dask-2023.6.1/dask/tests/test_context.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_core.py` & `dask-2023.6.1/dask/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_datasets.py` & `dask-2023.6.1/dask/tests/test_datasets.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_delayed.py` & `dask-2023.6.1/dask/tests/test_delayed.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_distributed.py` & `dask-2023.6.1/dask/tests/test_distributed.py`

 * *Files 7% similar despite different names*

```diff
@@ -2,40 +2,42 @@
 
 import pytest
 
 distributed = pytest.importorskip("distributed")
 
 import asyncio
 import os
+import subprocess
 import sys
 from functools import partial
 from operator import add
 
 from distributed import Client, SchedulerPlugin, WorkerPlugin
 from distributed.utils_test import cleanup  # noqa F401
 from distributed.utils_test import client as c  # noqa F401
 from distributed.utils_test import (  # noqa F401
     cluster,
     cluster_fixture,
     gen_cluster,
     loop,
     loop_in_thread,
+    popen,
     varying,
 )
 
 import dask
 import dask.bag as db
 from dask import compute, delayed, persist
 from dask.base import compute_as_if_collection, get_scheduler
 from dask.blockwise import Blockwise
 from dask.delayed import Delayed
 from dask.distributed import futures_of, wait
 from dask.highlevelgraph import HighLevelGraph
 from dask.layers import ShuffleLayer, SimpleShuffleLayer
-from dask.utils import get_named_args, tmpdir, tmpfile
+from dask.utils import get_named_args, get_scheduler_lock, tmpdir, tmpfile
 from dask.utils_test import inc
 
 if "should_check_state" in get_named_args(gen_cluster):
     gen_cluster = partial(gen_cluster, should_check_state=False)
     cluster = partial(cluster, should_check_state=False)
 
 
@@ -904,14 +906,73 @@
     with dask.config.set(scheduler="threads"):
         with pytest.warns(UserWarning):
             assert get_scheduler() != c.get
         with dask.config.set(scheduler=None):
             assert get_scheduler() == c.get
 
 
+@pytest.mark.parametrize(
+    "scheduler, expected_classes",
+    [
+        (None, ("SerializableLock", "SerializableLock", "AcquirerProxy")),
+        ("threads", ("SerializableLock", "SerializableLock", "SerializableLock")),
+        ("processes", ("AcquirerProxy", "AcquirerProxy", "AcquirerProxy")),
+    ],
+)
+def test_get_scheduler_lock(scheduler, expected_classes):
+    da = pytest.importorskip("dask.array", reason="Requires dask.array")
+    db = pytest.importorskip("dask.bag", reason="Requires dask.bag")
+    dd = pytest.importorskip("dask.dataframe", reason="Requires dask.dataframe")
+
+    darr = da.ones((100,))
+    ddf = dd.from_dask_array(darr, columns=["x"])
+    dbag = db.range(100, npartitions=2)
+
+    for collection, expected in zip((ddf, darr, dbag), expected_classes):
+        res = get_scheduler_lock(collection, scheduler=scheduler)
+        assert res.__class__.__name__ == expected
+
+
+@pytest.mark.parametrize(
+    "multiprocessing_method",
+    [
+        "spawn",
+        "fork",
+        "forkserver",
+    ],
+)
+def test_get_scheduler_lock_distributed(c, multiprocessing_method):
+    da = pytest.importorskip("dask.array", reason="Requires dask.array")
+    dd = pytest.importorskip("dask.dataframe", reason="Requires dask.dataframe")
+
+    darr = da.ones((100,))
+    ddf = dd.from_dask_array(darr, columns=["x"])
+    dbag = db.range(100, npartitions=2)
+
+    with dask.config.set(
+        {"distributed.worker.multiprocessing-method": multiprocessing_method}
+    ):
+        for collection in (ddf, darr, dbag):
+            res = get_scheduler_lock(collection, scheduler="distributed")
+            assert isinstance(res, distributed.lock.Lock)
+
+
+@pytest.mark.skip_with_pyarrow_strings  # AttributeError: 'StringDtype' object has no attribute 'itemsize'
+@pytest.mark.parametrize("lock_param", [True, distributed.lock.Lock()])
+def test_write_single_hdf(c, lock_param):
+    """https://github.com/dask/dask/issues/9972 and
+    https://github.com/dask/dask/issues/10315
+    """
+    pytest.importorskip("dask.dataframe")
+    pytest.importorskip("tables")
+    with tmpfile(extension="hd5") as f:
+        ddf = dask.datasets.timeseries(start="2000-01-01", end="2000-07-01", freq="12h")
+        ddf.to_hdf(str(f), key="/ds_*", lock=lock_param)
+
+
 @gen_cluster(config={"scheduler": "sync"}, nthreads=[])
 async def test_get_scheduler_default_client_config_interleaving(s):
     # This test is using context managers intentionally. We should not refactor
     # this to use it in more places to make the client closing cleaner.
     with pytest.warns(UserWarning):
         assert dask.base.get_scheduler() == dask.local.get_sync
         with dask.config.set(scheduler="threads"):
@@ -971,7 +1032,75 @@
 
 
 @gen_cluster(client=True)
 async def test_bag_groupby_default(c, s, a, b):
     b = db.range(100, npartitions=10)
     b2 = b.groupby(lambda x: x % 13)
     assert not any("partd" in k[0] for k in b2.dask)
+
+
+def test_shorten_traceback_excepthook(tmp_path):
+    """
+    See Also
+    --------
+    test_distributed.py::test_shorten_traceback_ipython
+    test_utils.py::test_shorten_traceback
+    """
+    client_script = """
+from dask.distributed import Client
+if __name__ == "__main__":
+    f1 = lambda: 2 / 0
+    f2 = lambda: f1() + 5
+    f3 = lambda: f2() + 1
+    with Client() as client:
+        client.submit(f3).result()
+    """
+    with open(tmp_path / "script.py", mode="w") as f:
+        f.write(client_script)
+
+    proc_args = [sys.executable, os.path.join(tmp_path, "script.py")]
+    with popen(proc_args, capture_output=True) as proc:
+        out, err = proc.communicate(timeout=60)
+
+    lines = out.decode("utf-8").split("\n")
+    lines = [line for line in lines if line.startswith("  File ")]
+
+    assert len(lines) == 4
+    assert 'script.py", line 8, in <module>' in lines[0]
+    assert 'script.py", line 6, in <lambda>' in lines[1]
+    assert 'script.py", line 5, in <lambda>' in lines[2]
+    assert 'script.py", line 4, in <lambda>' in lines[3]
+
+
+def test_shorten_traceback_ipython(tmp_path):
+    """
+    See Also
+    --------
+    test_distributed.py::test_shorten_traceback_excepthook
+    test_utils.py::test_shorten_traceback
+    """
+    pytest.importorskip("IPython", reason="Requires IPython")
+
+    client_script = """
+from dask.distributed import Client
+f1 = lambda: 2 / 0
+f2 = lambda: f1() + 5
+f3 = lambda: f2() + 1
+with Client() as client: client.submit(f3).result()
+"""
+    with popen(["ipython"], capture_output=True, stdin=subprocess.PIPE) as proc:
+        out, err = proc.communicate(input=client_script.encode(), timeout=60)
+
+    lines = out.decode("utf-8").split("\n")
+    lines = [
+        line
+        for line in lines
+        if line.startswith("File ")
+        or line.startswith("Cell ")
+        or "<ipython-input" in line
+    ]
+
+    assert len(lines) == 4
+    assert "In[5]" in lines[0] or "<ipython-input-5-" in lines[0]
+    assert "In[4]" in lines[1] or "<ipython-input-4-" in lines[1]
+    assert "In[3]" in lines[2] or "<ipython-input-3-" in lines[2]
+    assert "In[2]" in lines[3] or "<ipython-input-2-" in lines[3]
```

### Comparing `dask-2023.6.0/dask/tests/test_docs.py` & `dask-2023.6.1/dask/tests/test_docs.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_dot.py` & `dask-2023.6.1/dask/tests/test_dot.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_graph_manipulation.py` & `dask-2023.6.1/dask/tests/test_graph_manipulation.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_hashing.py` & `dask-2023.6.1/dask/tests/test_hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_highgraph.py` & `dask-2023.6.1/dask/tests/test_highgraph.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,12 +1,14 @@
 from __future__ import annotations
 
 import os
+import threading
 import xml.etree.ElementTree
 from collections.abc import Set
+from concurrent.futures import ThreadPoolExecutor
 
 import pytest
 
 import dask
 from dask.blockwise import Blockwise, blockwise_token
 from dask.highlevelgraph import HighLevelGraph, Layer, MaterializedLayer, to_graphviz
 from dask.utils_test import inc
@@ -155,58 +157,78 @@
 def test_single_annotation(annotation):
     da = pytest.importorskip("dask.array")
     with dask.annotate(**annotation):
         A = da.ones((10, 10), chunks=(5, 5))
 
     alayer = A.__dask_graph__().layers[A.name]
     assert alayer.annotations == annotation
-    assert dask.config.get("annotations", None) is None
+    assert not dask.get_annotations()
 
 
 def test_multiple_annotations():
     da = pytest.importorskip("dask.array")
     with dask.annotate(block_id=annot_map_fn):
         with dask.annotate(resources={"GPU": 1}):
             A = da.ones((10, 10), chunks=(5, 5))
 
         B = A + 1
 
     C = B + 1
 
-    assert dask.config.get("annotations", None) is None
+    assert not dask.get_annotations()
 
     alayer = A.__dask_graph__().layers[A.name]
     blayer = B.__dask_graph__().layers[B.name]
     clayer = C.__dask_graph__().layers[C.name]
     assert alayer.annotations == {"resources": {"GPU": 1}, "block_id": annot_map_fn}
     assert blayer.annotations == {"block_id": annot_map_fn}
     assert clayer.annotations is None
 
 
-def test_annotation_and_config_collision():
-    with dask.config.set({"foo": 1}):
-        with dask.annotate(foo=2):
-            assert dask.config.get("foo") == 1
-            assert dask.config.get("annotations") == {"foo": 2}
-            with dask.annotate(bar=3):
-                assert dask.config.get("foo") == 1
-                assert dask.config.get("annotations") == {"foo": 2, "bar": 3}
+def test_annotation_cleared_on_error():
+    with dask.annotate(x=1):
+        with pytest.raises(ZeroDivisionError):
+            with dask.annotate(x=2):
+                assert dask.get_annotations() == {"x": 2}
+                1 / 0
+        assert dask.get_annotations() == {"x": 1}
+    assert not dask.get_annotations()
 
 
 def test_materializedlayer_cull_preserves_annotations():
     layer = MaterializedLayer(
         {"a": 42, "b": 3.14},
         annotations={"foo": "bar"},
     )
 
     culled_layer, _ = layer.cull({"a"}, [])
     assert len(culled_layer) == 1
     assert culled_layer.annotations == {"foo": "bar"}
 
 
+def test_annotations_leak():
+    """Annotations shouldn't leak between threads.
+    See https://github.com/dask/dask/issues/10340."""
+    b1 = threading.Barrier(2)
+    b2 = threading.Barrier(2)
+
+    def f(n):
+        with dask.annotate(foo=n):
+            b1.wait()
+            out = dask.get_annotations()
+            b2.wait()
+            return out
+
+    with ThreadPoolExecutor(2) as ex:
+        f1 = ex.submit(f, 1)
+        f2 = ex.submit(f, 2)
+        result = [f1.result(), f2.result()]
+    assert result == [{"foo": 1}, {"foo": 2}]
+
+
 @pytest.mark.parametrize("flat", [True, False])
 def test_blockwise_cull(flat):
     da = pytest.importorskip("dask.array")
     np = pytest.importorskip("numpy")
     if flat:
         # Simple "flat" mapping between input and
         # outut indices
```

### Comparing `dask-2023.6.0/dask/tests/test_layers.py` & `dask-2023.6.1/dask/tests/test_layers.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_local.py` & `dask-2023.6.1/dask/tests/test_local.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_multiprocessing.py` & `dask-2023.6.1/dask/tests/test_multiprocessing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_optimization.py` & `dask-2023.6.1/dask/tests/test_optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_order.py` & `dask-2023.6.1/dask/tests/test_order.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_rewrite.py` & `dask-2023.6.1/dask/tests/test_rewrite.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_sizeof.py` & `dask-2023.6.1/dask/tests/test_sizeof.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_spark_compat.py` & `dask-2023.6.1/dask/tests/test_spark_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_system.py` & `dask-2023.6.1/dask/tests/test_system.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_threaded.py` & `dask-2023.6.1/dask/tests/test_threaded.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_typing.py` & `dask-2023.6.1/dask/tests/test_typing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/tests/test_utils.py` & `dask-2023.6.1/dask/tests/test_utils.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,19 +1,20 @@
 from __future__ import annotations
 
 import datetime
 import functools
 import operator
 import pickle
+import traceback
 from array import array
 
 import pytest
 from tlz import curry
 
-from dask import get
+from dask import config, get
 from dask.highlevelgraph import HighLevelGraph
 from dask.optimization import SubgraphCallable
 from dask.utils import (
     Dispatch,
     M,
     SerializableLock,
     _deprecated,
@@ -37,14 +38,15 @@
     memory_repr,
     methodcaller,
     ndeepmap,
     parse_bytes,
     parse_timedelta,
     partial_by_order,
     random_state_data,
+    shorten_traceback,
     skip_doctest,
     stringify,
     stringify_collection_keys,
     takes_multiple_arguments,
     tmpfile,
     typename,
 )
@@ -931,7 +933,53 @@
 
     assert get_meta_library(cudf.DataFrame()) == get_meta_library(
         dd.from_dict({}, npartitions=1).to_backend("cudf")
     )
     assert get_meta_library(cp.ndarray([])) == get_meta_library(
         da.from_array([]).to_backend("cupy")
     )
+
+
+@pytest.mark.parametrize(
+    "when,what,expect",
+    [
+        ([], [], 4),
+        ([".*"], [], 4),
+        ([], [".*"], 4),
+        ([r"nomatch"], [".*"], 4),
+        ([r".*"], ["nomatch"], 4),
+        ([".*"], [".*"], 2),
+        ([r"dask[\\\/]tests"], [], 4),
+        ([r"dask[\\\/]tests"], [r"dask[\\\/]tests"], 2),
+        ([], [r"dask[\\\/]tests"], 4),
+    ],
+)
+def test_shorten_traceback(when, what, expect):
+    """
+    See also
+    --------
+    test_distributed.py::test_shorten_traceback_excepthook
+    test_distributed.py::test_shorten_traceback_ipython
+    """
+
+    def f1():
+        return 2 / 0
+
+    def f2():
+        return f1() + 5
+
+    def f3():
+        return f2() + 1
+
+    with pytest.raises(ZeroDivisionError) as ex:
+        f3()
+
+    tb = ex.value.__traceback__
+    with config.set(
+        {
+            "admin.traceback.shorten.when": when,
+            "admin.traceback.shorten.what": what,
+        }
+    ):
+        tb = shorten_traceback(tb)
+    frame_count = len(list(traceback.walk_tb(tb)))
+    assert frame_count == expect
```

### Comparing `dask-2023.6.0/dask/tests/test_utils_test.py` & `dask-2023.6.1/dask/tests/test_utils_test.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/threaded.py` & `dask-2023.6.1/dask/threaded.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/typing.py` & `dask-2023.6.1/dask/typing.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/utils.py` & `dask-2023.6.1/dask/utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 import functools
 import inspect
 import os
 import re
 import shutil
 import sys
 import tempfile
+import traceback
 import uuid
 import warnings
 from collections.abc import Hashable, Iterable, Iterator, Mapping, Set
 from contextlib import contextmanager, nullcontext, suppress
 from datetime import datetime, timedelta
 from errno import ENOENT
 from functools import lru_cache
@@ -20,15 +21,14 @@
 from operator import add
 from threading import Lock
 from typing import Any, ClassVar, Literal, TypeVar, overload
 from weakref import WeakValueDictionary
 
 import tlz as toolz
 
-import dask
 from dask import config
 from dask.core import get_deps
 
 K = TypeVar("K")
 V = TypeVar("V")
 T = TypeVar("T")
 
@@ -1225,14 +1225,27 @@
     from dask import multiprocessing
     from dask.base import get_scheduler
 
     actual_get = get_scheduler(collections=[collection], scheduler=scheduler)
 
     if actual_get == multiprocessing.get:
         return multiprocessing.get_context().Manager().Lock()
+    else:
+        # if this is a distributed client, we need to lock on
+        # the level between processes, SerializableLock won't work
+        try:
+            import distributed.lock
+            from distributed.worker import get_client
+
+            client = get_client()
+        except (ImportError, ValueError):
+            pass
+        else:
+            if actual_get == client.get:
+                return distributed.lock.Lock()
 
     return SerializableLock()
 
 
 def ensure_dict(d: Mapping[K, V], *, copy: bool = False) -> dict[K, V]:
     """Convert a generic Mapping into a dict.
     Optimize use case of :class:`~dask.highlevelgraph.HighLevelGraph`.
@@ -2081,33 +2094,82 @@
         and hasattr(obj, "_asdict")
         and hasattr(obj, "_replace")
         and hasattr(obj, "_fields")
         and hasattr(obj, "_field_defaults")
     )
 
 
-def get_default_shuffle_algorithm() -> str:
+def get_default_shuffle_method() -> str:
     if d := config.get("dataframe.shuffle.method", None):
         return d
     try:
         from distributed import default_client
 
         default_client()
-        # We might lose annotations if low level fusion is active
-        if not dask.config.get("optimization.fuse.active"):
-            try:
-                from distributed.shuffle import check_minimal_arrow_version
+        try:
+            from distributed.shuffle import check_minimal_arrow_version
 
-                check_minimal_arrow_version()
-                return "p2p"
-            except RuntimeError:
-                pass
+            check_minimal_arrow_version()
+            return "p2p"
+        except RuntimeError:
+            pass
         return "tasks"
     except (ImportError, ValueError):
         return "disk"
 
 
 def get_meta_library(like):
     if hasattr(like, "_meta"):
         like = like._meta
 
     return import_module(typename(like).partition(".")[0])
+
+
+def shorten_traceback(exc_traceback):
+    """Remove irrelevant stack elements from traceback.
+
+    * only shortens traceback if any of the traceback lines match
+      `admin.traceback.shorten.when`
+    * omits frames from modules that match `admin.traceback.shorten.what`
+    * always keeps the first and last frame.
+
+    Parameters
+    ----------
+    exc_traceback : types.TracebackType
+        Original traceback
+
+    Returns
+    -------
+    types.TracebackType
+        Shortened traceback
+    """
+    when_paths = config.get("admin.traceback.shorten.when")
+    what_paths = config.get("admin.traceback.shorten.what")
+    if not when_paths or not what_paths:
+        return exc_traceback
+
+    when_exp = re.compile(".*(" + "|".join(when_paths) + ")")
+    for f, _ in traceback.walk_tb(exc_traceback):
+        if when_exp.match(f.f_code.co_filename):
+            break
+    else:
+        return exc_traceback
+
+    what_exp = re.compile(".*(" + "|".join(what_paths) + ")")
+    curr = exc_traceback
+    prev = None
+
+    while curr:
+        if prev is None:
+            # always keep first frame
+            prev = curr
+        elif not curr.tb_next:
+            # always keep last frame
+            prev.tb_next = curr
+            prev = prev.tb_next
+        elif not what_exp.match(curr.tb_frame.f_code.co_filename):
+            # keep if module is not listed in what
+            prev.tb_next = curr
+            prev = prev.tb_next
+        curr = curr.tb_next
+
+    return exc_traceback
```

### Comparing `dask-2023.6.0/dask/utils_test.py` & `dask-2023.6.1/dask/utils_test.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/__init__.py` & `dask-2023.6.1/dask/widgets/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/templates/array.html.j2` & `dask-2023.6.1/dask/widgets/templates/array.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/templates/highlevelgraph.html.j2` & `dask-2023.6.1/dask/widgets/templates/highlevelgraph.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/templates/highlevelgraph_layer.html.j2` & `dask-2023.6.1/dask/widgets/templates/highlevelgraph_layer.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/tests/test_widgets.py` & `dask-2023.6.1/dask/widgets/tests/test_widgets.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask/widgets/widgets.py` & `dask-2023.6.1/dask/widgets/widgets.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/dask.egg-info/PKG-INFO` & `dask-2023.6.1/dask.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dask
-Version: 2023.6.0
+Version: 2023.6.1
 Summary: Parallel PyData with Task Scheduling
 Maintainer-email: Matthew Rocklin <mrocklin@gmail.com>
 License: BSD
 Project-URL: Homepage, https://github.com/dask/dask/
 Keywords: task-scheduling parallel numpy pandas pydata
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
```

### Comparing `dask-2023.6.0/dask.egg-info/SOURCES.txt` & `dask-2023.6.1/dask.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/Makefile` & `dask-2023.6.1/docs/Makefile`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/make.bat` & `dask-2023.6.1/docs/make.bat`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/10-minutes-to-dask.rst` & `dask-2023.6.1/docs/source/10-minutes-to-dask.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/config_converter.js` & `dask-2023.6.1/docs/source/_static/config_converter.js`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/dask-simple.png` & `dask-2023.6.1/docs/source/_static/dask-simple.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/main-page.css` & `dask-2023.6.1/docs/source/_static/main-page.css`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/profile.html` & `dask-2023.6.1/docs/source/_static/profile.html`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/stacked_profile.html` & `dask-2023.6.1/docs/source/_static/stacked_profile.html`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/style.css` & `dask-2023.6.1/docs/source/_static/style.css`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/transpose_cyto.html` & `dask-2023.6.1/docs/source/_static/transpose_cyto.html`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/_static/yaml.min.js` & `dask-2023.6.1/docs/source/_static/yaml.min.js`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/api.rst` & `dask-2023.6.1/docs/source/api.rst`

 * *Files 10% similar despite different names*

```diff
@@ -41,14 +41,15 @@
 workflows.  These are not necessary for normal operation, but can be useful for
 real-time or advanced operation.
 
 This more advanced API is available in the `Dask distributed documentation
 <https://distributed.dask.org/en/latest/api.html>`_
 
 .. autofunction:: annotate
+.. autofunction:: get_annotations
 .. autofunction:: compute
 .. autofunction:: is_dask_collection
 .. autofunction:: optimize
 .. autofunction:: persist
 .. autofunction:: visualize
 
 Datasets
```

### Comparing `dask-2023.6.0/docs/source/array-api.rst` & `dask-2023.6.1/docs/source/array-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-assignment.rst` & `dask-2023.6.1/docs/source/array-assignment.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-best-practices.rst` & `dask-2023.6.1/docs/source/array-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-chunks.rst` & `dask-2023.6.1/docs/source/array-chunks.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-creation.rst` & `dask-2023.6.1/docs/source/array-creation.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-design.rst` & `dask-2023.6.1/docs/source/array-design.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-gufunc.rst` & `dask-2023.6.1/docs/source/array-gufunc.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-overlap.rst` & `dask-2023.6.1/docs/source/array-overlap.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-random.rst` & `dask-2023.6.1/docs/source/array-random.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-slicing.rst` & `dask-2023.6.1/docs/source/array-slicing.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-sparse.rst` & `dask-2023.6.1/docs/source/array-sparse.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-stack.rst` & `dask-2023.6.1/docs/source/array-stack.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array-stats.rst` & `dask-2023.6.1/docs/source/array-stats.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/array.rst` & `dask-2023.6.1/docs/source/array.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/bag-api.rst` & `dask-2023.6.1/docs/source/bag-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/bag-creation.rst` & `dask-2023.6.1/docs/source/bag-creation.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/bag.rst` & `dask-2023.6.1/docs/source/bag.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/best-practices.rst` & `dask-2023.6.1/docs/source/best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/caching.rst` & `dask-2023.6.1/docs/source/caching.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/changelog.rst` & `dask-2023.6.1/docs/source/changelog.rst`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,51 @@
 Changelog
 =========
 
+.. _v2023.6.1:
+
+2023.6.1
+--------
+
+Released on June 26, 2023
+
+Enhancements
+^^^^^^^^^^^^
+- Remove no longer supported ``clip_lower`` and ``clip_upper`` (:pr:`10371`) `Patrick Hoefler`_
+- Support ``DataFrame.set_index(..., sort=False)`` (:pr:`10342`) `Miles`_
+- Cleanup remote tracebacks (:pr:`10354`) `Irina Truong`_
+- Add dispatching mechanisms for ``pyarrow.Table`` conversion (:pr:`10312`) `Richard (Rick) Zamora`_
+- Choose P2P even if fusion is enabled (:pr:`10344`) `Hendrik Makait`_
+- Validate that rechunking is possible earlier in graph generation (:pr:`10336`) `Hendrik Makait`_
+
+Bug Fixes
+^^^^^^^^^
+- Fix issue with ``header`` passed to ``read_csv`` (:pr:`10355`) `GALI PREM SAGAR`_
+- Respect ``dropna`` and ``observed`` in ``GroupBy.var`` and ``GroupBy.std`` (:pr:`10350`) `Patrick Hoefler`_
+- Fix ``H5FD_lock`` error when writing to hdf with distributed client (:pr:`10309`) `Irina Truong`_
+- Fix for ``total_mem_usage`` of ``bag.map()`` (:pr:`10341`) `Irina Truong`_
+
+Deprecations
+^^^^^^^^^^^^
+- Deprecate ``DataFrame.fillna``/``Series.fillna`` with ``method`` (:pr:`10349`) `Irina Truong`_
+- Deprecate ``DataFrame.first`` and ``Series.first`` (:pr:`10352`) `Irina Truong`_
+
+Maintenance
+^^^^^^^^^^^
+- Deprecate ``numpy.compat`` (:pr:`10370`) `Irina Truong`_
+- Fix annotations and spans leaking between threads (:pr:`10367`) `Irina Truong`_
+- Use general kwargs in ``pyarrow_table_dispatch`` functions (:pr:`10364`) `Richard (Rick) Zamora`_
+- Remove unnecessary ``try``/``except`` in ``isna`` (:pr:`10363`) `Patrick Hoefler`_
+- ``mypy`` support for numpy 1.25 (:pr:`10362`) `crusaderky`_
+- Bump ``actions/checkout`` from 3.5.2 to 3.5.3 (:pr:`10348`)
+- Restore ``numba`` in ``upstream`` build (:pr:`10330`) `James Bourbeau`_
+- Update nightly wheel index for ``pandas``/``numpy``/``scipy`` (:pr:`10346`) `Matthew Roeschke`_
+- Add rechunk config values to yaml (:pr:`10343`) `Hendrik Makait`_
+
+
 .. _v2023.6.0:
 
 2023.6.0
 --------
 
 Released on June 9, 2023
```

### Comparing `dask-2023.6.0/docs/source/cli.rst` & `dask-2023.6.1/docs/source/cli.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/conf.py` & `dask-2023.6.1/docs/source/conf.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/configuration.rst` & `dask-2023.6.1/docs/source/configuration.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/custom-collections.rst` & `dask-2023.6.1/docs/source/custom-collections.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/custom-graphs.rst` & `dask-2023.6.1/docs/source/custom-graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dashboard-progress-script.py` & `dask-2023.6.1/docs/source/dashboard-progress-script.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dashboard.rst` & `dask-2023.6.1/docs/source/dashboard.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/daskcheatsheet.pdf` & `dask-2023.6.1/docs/source/daskcheatsheet.pdf`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-api.rst` & `dask-2023.6.1/docs/source/dataframe-api.rst`

 * *Files 0% similar despite different names*

```diff
@@ -157,16 +157,14 @@
    Series.apply
    Series.astype
    Series.autocorr
    Series.between
    Series.bfill
    Series.clear_divisions
    Series.clip
-   Series.clip_lower
-   Series.clip_upper
    Series.compute
    Series.copy
    Series.corr
    Series.count
    Series.cov
    Series.cummax
    Series.cummin
@@ -275,16 +273,14 @@
    Index.apply
    Index.astype
    Index.autocorr
    Index.between
    Index.bfill
    Index.clear_divisions
    Index.clip
-   Index.clip_lower
-   Index.clip_upper
    Index.compute
    Index.copy
    Index.corr
    Index.count
    Index.cov
    Index.cummax
    Index.cummin
```

### Comparing `dask-2023.6.0/docs/source/dataframe-best-practices.rst` & `dask-2023.6.1/docs/source/dataframe-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-categoricals.rst` & `dask-2023.6.1/docs/source/dataframe-categoricals.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-create.rst` & `dask-2023.6.1/docs/source/dataframe-create.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-design.rst` & `dask-2023.6.1/docs/source/dataframe-design.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-extend.rst` & `dask-2023.6.1/docs/source/dataframe-extend.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-groupby.rst` & `dask-2023.6.1/docs/source/dataframe-groupby.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-indexing.rst` & `dask-2023.6.1/docs/source/dataframe-indexing.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-joins.rst` & `dask-2023.6.1/docs/source/dataframe-joins.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-parquet.rst` & `dask-2023.6.1/docs/source/dataframe-parquet.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe-sql.rst` & `dask-2023.6.1/docs/source/dataframe-sql.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/dataframe.rst` & `dask-2023.6.1/docs/source/dataframe.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/delayed-api.rst` & `dask-2023.6.1/docs/source/delayed-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/delayed-best-practices.rst` & `dask-2023.6.1/docs/source/delayed-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/delayed-collections.rst` & `dask-2023.6.1/docs/source/delayed-collections.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/delayed.rst` & `dask-2023.6.1/docs/source/delayed.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-cli.rst` & `dask-2023.6.1/docs/source/deploying-cli.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-cloud.rst` & `dask-2023.6.1/docs/source/deploying-cloud.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-docker.rst` & `dask-2023.6.1/docs/source/deploying-docker.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-hpc.rst` & `dask-2023.6.1/docs/source/deploying-hpc.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-kubernetes.rst` & `dask-2023.6.1/docs/source/deploying-kubernetes.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-python-advanced.rst` & `dask-2023.6.1/docs/source/deploying-python-advanced.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-python.rst` & `dask-2023.6.1/docs/source/deploying-python.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying-ssh.rst` & `dask-2023.6.1/docs/source/deploying-ssh.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deploying.rst` & `dask-2023.6.1/docs/source/deploying.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/deployment-considerations.rst` & `dask-2023.6.1/docs/source/deployment-considerations.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/develop.rst` & `dask-2023.6.1/docs/source/develop.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/diagnostics-distributed.rst` & `dask-2023.6.1/docs/source/diagnostics-distributed.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/diagnostics-local.rst` & `dask-2023.6.1/docs/source/diagnostics-local.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/ecosystem.rst` & `dask-2023.6.1/docs/source/ecosystem.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/faq.rst` & `dask-2023.6.1/docs/source/faq.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/futures.rst` & `dask-2023.6.1/docs/source/futures.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/gpu.rst` & `dask-2023.6.1/docs/source/gpu.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/graph_manipulation.rst` & `dask-2023.6.1/docs/source/graph_manipulation.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/graphs.rst` & `dask-2023.6.1/docs/source/graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/graphviz.rst` & `dask-2023.6.1/docs/source/graphviz.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/high-level-graphs.rst` & `dask-2023.6.1/docs/source/high-level-graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/adaptive.rst` & `dask-2023.6.1/docs/source/how-to/adaptive.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/connect-to-remote-data.rst` & `dask-2023.6.1/docs/source/how-to/connect-to-remote-data.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/customize-initialization.rst` & `dask-2023.6.1/docs/source/how-to/customize-initialization.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/debug.rst` & `dask-2023.6.1/docs/source/how-to/debug.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/extend-sizeof.rst` & `dask-2023.6.1/docs/source/how-to/extend-sizeof.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/manage-environments.rst` & `dask-2023.6.1/docs/source/how-to/manage-environments.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/selecting-the-collection-backend.rst` & `dask-2023.6.1/docs/source/how-to/selecting-the-collection-backend.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/how-to/setup-prometheus.rst` & `dask-2023.6.1/docs/source/how-to/setup-prometheus.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/10_minutes_array_graph.png` & `dask-2023.6.1/docs/source/images/10_minutes_array_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/10_minutes_bag_graph.png` & `dask-2023.6.1/docs/source/images/10_minutes_bag_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/10_minutes_dataframe_graph.png` & `dask-2023.6.1/docs/source/images/10_minutes_dataframe_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/HHMI_Janelia_Color.png` & `dask-2023.6.1/docs/source/images/HHMI_Janelia_Color.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/array.svg` & `dask-2023.6.1/docs/source/images/array.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/async-embarrassing.gif` & `dask-2023.6.1/docs/source/images/async-embarrassing.gif`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/concurrent-futures-threaded.webp` & `dask-2023.6.1/docs/source/images/concurrent-futures-threaded.webp`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/crosstalk.svg` & `dask-2023.6.1/docs/source/images/crosstalk.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_jupyterlab.png` & `dask-2023.6.1/docs/source/images/dashboard_jupyterlab.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_link.png` & `dask-2023.6.1/docs/source/images/dashboard_link.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_memory.png` & `dask-2023.6.1/docs/source/images/dashboard_memory.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_memory_new.gif` & `dask-2023.6.1/docs/source/images/dashboard_memory_new.gif`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_progress.png` & `dask-2023.6.1/docs/source/images/dashboard_progress.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_status.png` & `dask-2023.6.1/docs/source/images/dashboard_status.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_task_processing.png` & `dask-2023.6.1/docs/source/images/dashboard_task_processing.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_task_stream_unhealthy.png` & `dask-2023.6.1/docs/source/images/dashboard_task_stream_unhealthy.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dashboard_taskstream_healthy.png` & `dask-2023.6.1/docs/source/images/dashboard_taskstream_healthy.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-adaptive.svg` & `dask-2023.6.1/docs/source/images/dask-adaptive.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-array.svg` & `dask-2023.6.1/docs/source/images/dask-array.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-cluster-manager.svg` & `dask-2023.6.1/docs/source/images/dask-cluster-manager.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-dataframe.svg` & `dask-2023.6.1/docs/source/images/dask-dataframe.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-overview-distributed-callout.svg` & `dask-2023.6.1/docs/source/images/dask-overview-distributed-callout.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-overview-schedulers.svg` & `dask-2023.6.1/docs/source/images/dask-overview-schedulers.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask-overview.svg` & `dask-2023.6.1/docs/source/images/dask-overview.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_horizontal.svg` & `dask-2023.6.1/docs/source/images/dask_horizontal.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_horizontal_black.svg` & `dask-2023.6.1/docs/source/images/dask_horizontal_black.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_horizontal_on_blue.svg` & `dask-2023.6.1/docs/source/images/dask_horizontal_on_blue.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_horizontal_on_pink.svg` & `dask-2023.6.1/docs/source/images/dask_horizontal_on_pink.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_horizontal_white.svg` & `dask-2023.6.1/docs/source/images/dask_horizontal_white.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_icon.svg` & `dask-2023.6.1/docs/source/images/dask_icon.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_icon_black.svg` & `dask-2023.6.1/docs/source/images/dask_icon_black.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_icon_on_pink.svg` & `dask-2023.6.1/docs/source/images/dask_icon_on_pink.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/dask_icon_white.svg` & `dask-2023.6.1/docs/source/images/dask_icon_white.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/delayed-inc-double-add.svg` & `dask-2023.6.1/docs/source/images/delayed-inc-double-add.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/distributed-overview.svg` & `dask-2023.6.1/docs/source/images/distributed-overview.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/frame-shuffle.svg` & `dask-2023.6.1/docs/source/images/frame-shuffle.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/frame-sort.svg` & `dask-2023.6.1/docs/source/images/frame-sort.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/frame.svg` & `dask-2023.6.1/docs/source/images/frame.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/gputester-msg.png` & `dask-2023.6.1/docs/source/images/gputester-msg.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/growth_of_languages.png` & `dask-2023.6.1/docs/source/images/growth_of_languages.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/growth_of_libraries.png` & `dask-2023.6.1/docs/source/images/growth_of_libraries.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/inc-add.svg` & `dask-2023.6.1/docs/source/images/inc-add.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/map-reduce-task-scheduling.svg` & `dask-2023.6.1/docs/source/images/map-reduce-task-scheduling.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/map_blocks_drop_axis.png` & `dask-2023.6.1/docs/source/images/map_blocks_drop_axis.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/merge_chunks.png` & `dask-2023.6.1/docs/source/images/merge_chunks.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/merge_chunks_false.png` & `dask-2023.6.1/docs/source/images/merge_chunks_false.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/optimize_dask1.svg` & `dask-2023.6.1/docs/source/images/optimize_dask1.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/optimize_dask2.svg` & `dask-2023.6.1/docs/source/images/optimize_dask2.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/optimize_dask3.svg` & `dask-2023.6.1/docs/source/images/optimize_dask3.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/optimize_dask4.svg` & `dask-2023.6.1/docs/source/images/optimize_dask4.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/optimize_dask5.svg` & `dask-2023.6.1/docs/source/images/optimize_dask5.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/order-failure.png` & `dask-2023.6.1/docs/source/images/order-failure.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/order-success.png` & `dask-2023.6.1/docs/source/images/order-success.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/overlap.svg` & `dask-2023.6.1/docs/source/images/overlap.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/overlapping-blocks.svg` & `dask-2023.6.1/docs/source/images/overlapping-blocks.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/overlapping-neighbors.svg` & `dask-2023.6.1/docs/source/images/overlapping-neighbors.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/pipeline.svg` & `dask-2023.6.1/docs/source/images/pipeline.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/reshape.png` & `dask-2023.6.1/docs/source/images/reshape.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/reshape_problem.png` & `dask-2023.6.1/docs/source/images/reshape_problem.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/reshape_rechunked.png` & `dask-2023.6.1/docs/source/images/reshape_rechunked.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/scaling-edges.png` & `dask-2023.6.1/docs/source/images/scaling-edges.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/scaling-nodes.png` & `dask-2023.6.1/docs/source/images/scaling-nodes.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/simple-dask.png` & `dask-2023.6.1/docs/source/images/simple-dask.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/transpose-hlg-hovertooltip.png` & `dask-2023.6.1/docs/source/images/transpose-hlg-hovertooltip.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/transpose-hlg-html-repr.png` & `dask-2023.6.1/docs/source/images/transpose-hlg-html-repr.png`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/transpose.svg` & `dask-2023.6.1/docs/source/images/transpose.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/transpose_opt.svg` & `dask-2023.6.1/docs/source/images/transpose_opt.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/trivial.svg` & `dask-2023.6.1/docs/source/images/trivial.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/images/unoverlapping-neighbors.svg` & `dask-2023.6.1/docs/source/images/unoverlapping-neighbors.svg`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/index.rst` & `dask-2023.6.1/docs/source/index.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/install.rst` & `dask-2023.6.1/docs/source/install.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/logos.rst` & `dask-2023.6.1/docs/source/logos.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/maintainers.rst` & `dask-2023.6.1/docs/source/maintainers.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/optimize.rst` & `dask-2023.6.1/docs/source/optimize.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/order.rst` & `dask-2023.6.1/docs/source/order.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/phases-of-computation.rst` & `dask-2023.6.1/docs/source/phases-of-computation.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/presentations.rst` & `dask-2023.6.1/docs/source/presentations.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/scheduler-overview.rst` & `dask-2023.6.1/docs/source/scheduler-overview.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/scheduling-policy.rst` & `dask-2023.6.1/docs/source/scheduling-policy.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/scheduling.rst` & `dask-2023.6.1/docs/source/scheduling.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/scripts/scheduling.py` & `dask-2023.6.1/docs/source/scripts/scheduling.py`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/shared.rst` & `dask-2023.6.1/docs/source/shared.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/spark.rst` & `dask-2023.6.1/docs/source/spark.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/spec.rst` & `dask-2023.6.1/docs/source/spec.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/support.rst` & `dask-2023.6.1/docs/source/support.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/understanding-performance.rst` & `dask-2023.6.1/docs/source/understanding-performance.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/user-interfaces.rst` & `dask-2023.6.1/docs/source/user-interfaces.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/docs/source/why.rst` & `dask-2023.6.1/docs/source/why.rst`

 * *Files identical despite different names*

### Comparing `dask-2023.6.0/pyproject.toml` & `dask-2023.6.1/pyproject.toml`

 * *Files 0% similar despite different names*

```diff
@@ -51,15 +51,15 @@
 array = ["numpy >= 1.21"]
 # keeping for backwards compatibility
 bag = []
 dataframe = [
     "numpy >= 1.21",
     "pandas >= 1.3",
 ]
-distributed = ["distributed == 2023.6.0"]
+distributed = ["distributed == 2023.6.1"]
 diagnostics = [
     "bokeh >= 2.4.2",
     "jinja2 >= 2.10.3",
 ]
 # keeping for backwards compatibility
 delayed = []
 complete = [
```

