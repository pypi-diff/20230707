# Comparing `tmp/freqtrade-2023.5.1.tar.gz` & `tmp/freqtrade-2023.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "freqtrade-2023.5.1.tar", last modified: Thu Jun  8 20:46:37 2023, max compression
+gzip compressed data, was "freqtrade-2023.6.tar", last modified: Fri Jul  7 18:46:03 2023, max compression
```

## Comparing `freqtrade-2023.5.1.tar` & `freqtrade-2023.6.tar`

### file list

```diff
@@ -1,416 +1,429 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/
--rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)    12541 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.327417 freqtrade-2023.5.1/freqtrade/
--rw-r--r--   0 runner    (1001) docker     (123)      812 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/commands/
--rw-r--r--   0 runner    (1001) docker     (123)     1741 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/analyze_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    21033 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/build_config_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    22324 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/cli_options.py
--rw-r--r--   0 runner    (1001) docker     (123)     9009 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/data_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/db_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/deploy_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/hyperopt_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     9277 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/list_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     4513 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/optimize_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/pairlist_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/plot_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/strategy_utils_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      936 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/trade_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      416 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/webserver_commands.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/configuration/
--rw-r--r--   0 runner    (1001) docker     (123)      299 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      723 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/config_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    17385 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/config_validation.py
--rw-r--r--   0 runner    (1001) docker     (123)    24880 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/deprecated_settings.py
--rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/environment_vars.py
--rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/load_config.py
--rw-r--r--   0 runner    (1001) docker     (123)     6263 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    29286 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/constants.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/data/
--rw-r--r--   0 runner    (1001) docker     (123)      152 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    16153 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    13517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)    12843 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/entryexitanalysis.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/data/history/
--rw-r--r--   0 runner    (1001) docker     (123)      465 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4903 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/featherdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/hdf5datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    21512 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/history_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/idatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     5580 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/jsondatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     4798 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/parquetdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/metrics.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/edge/
--rw-r--r--   0 runner    (1001) docker     (123)       59 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20869 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/edge/edge_positioning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/enums/
--rw-r--r--   0 runner    (1001) docker     (123)      861 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      238 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/backteststate.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/candletype.py
--rw-r--r--   0 runner    (1001) docker     (123)      640 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/exitchecktuple.py
--rw-r--r--   0 runner    (1001) docker     (123)      619 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/exittype.py
--rw-r--r--   0 runner    (1001) docker     (123)      210 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/hyperoptstate.py
--rw-r--r--   0 runner    (1001) docker     (123)      237 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/marginmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/marketstatetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/ordertypevalue.py
--rw-r--r--   0 runner    (1001) docker     (123)      177 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/pricetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      976 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/rpcmessagetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      592 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/runmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      626 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/signaltype.py
--rw-r--r--   0 runner    (1001) docker     (123)      202 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/state.py
--rw-r--r--   0 runner    (1001) docker     (123)      220 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/tradingmode.py
--rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exceptions.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.339417 freqtrade-2023.5.1/freqtrade/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)     1540 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9455 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/binance.py
--rw-r--r--   0 runner    (1001) docker     (123)   632547 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/binance_leverage_tiers.json
--rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bittrex.py
--rw-r--r--   0 runner    (1001) docker     (123)      547 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bitvavo.py
--rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/check_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)      564 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/coinbasepro.py
--rw-r--r--   0 runner    (1001) docker     (123)     6112 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/common.py
--rw-r--r--   0 runner    (1001) docker     (123)   131881 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)    10553 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     5035 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/gate.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/hitbtc.py
--rw-r--r--   0 runner    (1001) docker     (123)      827 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9717 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)     8695 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/okx.py
--rw-r--r--   0 runner    (1001) docker     (123)      725 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.339417 freqtrade-2023.5.1/freqtrade/freqai/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.343417 freqtrade-2023.5.1/freqtrade/freqai/RL/
--rw-r--r--   0 runner    (1001) docker     (123)     4496 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base3ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5021 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base4ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5644 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base5ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)    15138 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/BaseEnvironment.py
--rw-r--r--   0 runner    (1001) docker     (123)    20053 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.343417 freqtrade-2023.5.1/freqtrade/freqai/base_models/
--rw-r--r--   0 runner    (1001) docker     (123)     4320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseClassifierModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     5700 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2985 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     4054 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseRegressionModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     2572 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseTensorFlowModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)    30241 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/data_drawer.py
--rw-r--r--   0 runner    (1001) docker     (123)    65930 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/data_kitchen.py
--rw-r--r--   0 runner    (1001) docker     (123)    44639 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/freqai_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/
--rw-r--r--   0 runner    (1001) docker     (123)     2083 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2866 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     2048 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2834 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1920 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2698 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1837 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2692 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     3320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     5635 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     6732 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner.py
--rw-r--r--   0 runner    (1001) docker     (123)     2981 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
--rw-r--r--   0 runner    (1001) docker     (123)     3338 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2596 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/
--rw-r--r--   0 runner    (1001) docker     (123)     2166 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/TensorboardCallback.py
--rw-r--r--   0 runner    (1001) docker     (123)      587 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      690 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/base_tensorboard.py
--rw-r--r--   0 runner    (1001) docker     (123)     1926 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/tensorboard.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/torch/
--rw-r--r--   0 runner    (1001) docker     (123)     2028 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchDataConvertor.py
--rw-r--r--   0 runner    (1001) docker     (123)     3762 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchMLPModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     8903 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchModelTrainer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2026 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTrainerInterface.py
--rw-r--r--   0 runner    (1001) docker     (123)     3613 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTransformerModel.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      666 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7382 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    95442 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqtradebot.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/leverage/
--rw-r--r--   0 runner    (1001) docker     (123)       63 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/leverage/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/leverage/interest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/loggers/
--rw-r--r--   0 runner    (1001) docker     (123)     4942 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      460 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/buffering_handler.py
--rw-r--r--   0 runner    (1001) docker     (123)      714 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/std_err_stream_handler.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/main.py
--rw-r--r--   0 runner    (1001) docker     (123)     9450 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/misc.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/mixins/
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/mixins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1265 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/mixins/logging_mixin.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/backtest_caching.py
--rw-r--r--   0 runner    (1001) docker     (123)    64916 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)      856 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/bt_progress.py
--rw-r--r--   0 runner    (1001) docker     (123)     1823 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    28627 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_auto.py
--rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_epoch_filters.py
--rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/
--rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
--rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
--rw-r--r--   0 runner    (1001) docker     (123)      746 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
--rw-r--r--   0 runner    (1001) docker     (123)      931 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
--rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
--rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
--rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)      951 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    23094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    45232 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/space/
--rw-r--r--   0 runner    (1001) docker     (123)      127 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/space/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/space/decimalspace.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)      284 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/base.py
--rw-r--r--   0 runner    (1001) docker     (123)     6441 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/key_value_store.py
--rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/models.py
--rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/pairlock.py
--rw-r--r--   0 runner    (1001) docker     (123)     6366 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/pairlock_middleware.py
--rw-r--r--   0 runner    (1001) docker     (123)    72288 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/trade_model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/plot/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    26157 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plot/plotting.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.355417 freqtrade-2023.5.1/freqtrade/plugins/pairlist/
--rw-r--r--   0 runner    (1001) docker     (123)     5739 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/AgeFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/IPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/OffsetFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3259 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PerformanceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2957 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PrecisionFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     5426 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PriceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3180 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/ProducerPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/RemotePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2874 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/ShuffleFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2505 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/SpreadFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2369 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/StaticPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     5005 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolatilityFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)    10935 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolumePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/pairlist_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     5402 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/rangestabilityfilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlistmanager.py
--rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protectionmanager.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.355417 freqtrade-2023.5.1/freqtrade/plugins/protections/
--rw-r--r--   0 runner    (1001) docker     (123)      105 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/cooldown_period.py
--rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/iprotection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/low_profit_pairs.py
--rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/max_drawdown_protection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/stoploss_guard.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/resolvers/
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2618 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/exchange_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1799 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/freqaimodel_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/hyperopt_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    10493 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/iresolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/pairlist_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/protection_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/strategy_resolver.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)      111 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/api_server/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_auth.py
--rw-r--r--   0 runner    (1001) docker     (123)     9537 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_backtest.py
--rw-r--r--   0 runner    (1001) docker     (123)    10836 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)    14352 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_v1.py
--rw-r--r--   0 runner    (1001) docker     (123)     4200 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_ws.py
--rw-r--r--   0 runner    (1001) docker     (123)     1583 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/deps.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/
--rw-r--r--   0 runner    (1001) docker     (123)      753 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/fallback_file.html
--rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (123)     2100 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/uvicorn_threaded.py
--rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/web_ui.py
--rw-r--r--   0 runner    (1001) docker     (123)     7693 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver.py
--rw-r--r--   0 runner    (1001) docker     (123)      342 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver_bgwork.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/
--rw-r--r--   0 runner    (1001) docker     (123)      419 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/channel.py
--rw-r--r--   0 runner    (1001) docker     (123)      898 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/message_stream.py
--rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/proxy.py
--rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/serializer.py
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/types.py
--rw-r--r--   0 runner    (1001) docker     (123)     1775 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/discord.py
--rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/external_message_consumer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    57320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc_types.py
--rw-r--r--   0 runner    (1001) docker     (123)    79414 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)      650 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8240 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/hyper.py
--rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/informative_decorator.py
--rw-r--r--   0 runner    (1001) docker     (123)    65823 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategy_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategy_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategyupdater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/templates/
--rw-r--r--   0 runner    (1001) docker     (123)    12781 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleHybridStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    12688 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/base_config.json.j2
--rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/base_strategy.py.j2
--rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/sample_hyperopt_loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/sample_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_analysis_example.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      101 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      464 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      506 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      262 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      103 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/templates/subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_binance.j2
--rw-r--r--   0 runner    (1001) docker     (123)      483 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_bittrex.j2
--rw-r--r--   0 runner    (1001) docker     (123)      271 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_gateio.j2
--rw-r--r--   0 runner    (1001) docker     (123)      244 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_generic.j2
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_huobi.j2
--rw-r--r--   0 runner    (1001) docker     (123)      413 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_kraken.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_kucoin.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_okex.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/util/
--rw-r--r--   0 runner    (1001) docker     (123)      442 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2718 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)     1846 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/datetime_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)      337 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/ft_precise.py
--rw-r--r--   0 runner    (1001) docker     (123)      458 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/gc_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)      580 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/periodic_cache.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/vendor/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    14830 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/worker.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.327417 freqtrade-2023.5.1/freqtrade.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)    12541 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    13938 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       50 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)     1697 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)       16 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     2291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/commands/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/test_build_config.py
--rw-r--r--   0 runner    (1001) docker     (123)    52582 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/test_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)   124669 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest_trades.py
--rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest_trades_usdt.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19274 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)     8496 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_entryexitanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    26738 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_history.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/edge/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20687 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/edge/test_edge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    21890 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_binance.py
--rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)    30479 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_ccxt_compat.py
--rw-r--r--   0 runner    (1001) docker     (123)   221394 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_gate.py
--rw-r--r--   0 runner    (1001) docker     (123)     4979 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)    10785 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     6641 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)    22177 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_okx.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)     2276 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    43247 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtest_detail.py
--rw-r--r--   0 runner    (1001) docker     (123)    82511 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)     7655 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtesting_adjust_position.py
--rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    44215 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperoptloss.py
--rw-r--r--   0 runner    (1001) docker     (123)    20838 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2942 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_key_value_store.py
--rw-r--r--   0 runner    (1001) docker     (123)    16218 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)    99825 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_persistence.py
--rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_trade_fromjson.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_pairlist.py
--rw-r--r--   0 runner    (1001) docker     (123)     5604 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_pairlocks.py
--rw-r--r--   0 runner    (1001) docker     (123)    19094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_protections.py
--rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_remotepairlist.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    44020 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)    71301 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_apiserver.py
--rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_emc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9666 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)    94365 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)    17192 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2230 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_default_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    40824 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_strategy_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_strategy_loading.py
--rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)    58618 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)   235594 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_freqtradebot.py
--rw-r--r--   0 runner    (1001) docker     (123)      880 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    20485 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_integration.py
--rw-r--r--   0 runner    (1001) docker     (123)     8293 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_main.py
--rw-r--r--   0 runner    (1001) docker     (123)     9552 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_misc.py
--rw-r--r--   0 runner    (1001) docker     (123)    19996 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_plotting.py
--rw-r--r--   0 runner    (1001) docker     (123)     6787 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_strategy_updater.py
--rw-r--r--   0 runner    (1001) docker     (123)      414 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_talib.py
--rw-r--r--   0 runner    (1001) docker     (123)     3539 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    15063 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.635886 freqtrade-2023.6/
+-rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-07-07 18:46:00.000000 freqtrade-2023.6/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-07-07 18:46:00.000000 freqtrade-2023.6/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-07-07 18:46:03.635886 freqtrade-2023.6/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-07-07 18:46:00.000000 freqtrade-2023.6/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.579886 freqtrade-2023.6/freqtrade/
+-rw-r--r--   0 runner    (1001) docker     (123)      810 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.583886 freqtrade-2023.6/freqtrade/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)     1817 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/analyze_commands.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    21769 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/build_config_commands.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    22898 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/cli_options.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5775 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/data_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/db_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/deploy_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/hyperopt_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10311 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/list_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4906 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/optimize_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/pairlist_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/plot_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/strategy_utils_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      936 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/trade_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      416 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/commands/webserver_commands.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.583886 freqtrade-2023.6/freqtrade/configuration/
+-rw-r--r--   0 runner    (1001) docker     (123)      299 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      723 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/config_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17385 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/config_validation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25752 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/deprecated_settings.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/environment_vars.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/load_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6284 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/configuration/timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29635 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.583886 freqtrade-2023.6/freqtrade/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      152 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16153 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13517 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12843 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/entryexitanalysis.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.583886 freqtrade-2023.6/freqtrade/data/history/
+-rw-r--r--   0 runner    (1001) docker     (123)      485 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4903 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/featherdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/hdf5datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    25132 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/history_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/idatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5580 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/jsondatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4798 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/history/parquetdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/data/metrics.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.583886 freqtrade-2023.6/freqtrade/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)       59 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20869 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/edge/edge_positioning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.587886 freqtrade-2023.6/freqtrade/enums/
+-rw-r--r--   0 runner    (1001) docker     (123)      861 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      238 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/backteststate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/candletype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      640 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/exitchecktuple.py
+-rw-r--r--   0 runner    (1001) docker     (123)      619 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/exittype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      210 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/hyperoptstate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      242 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/marginmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/marketstatetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/ordertypevalue.py
+-rw-r--r--   0 runner    (1001) docker     (123)      177 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/pricetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      976 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/rpcmessagetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      592 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/runmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      626 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/signaltype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      202 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)      220 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/enums/tradingmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.591886 freqtrade-2023.6/freqtrade/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)     1546 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9455 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)   638487 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/binance_leverage_tiers.json
+-rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/bittrex.py
+-rw-r--r--   0 runner    (1001) docker     (123)      547 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/bitvavo.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/check_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)      564 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/coinbasepro.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6112 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)   132563 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11701 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4996 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/hitbtc.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9717 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9508 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/okx.py
+-rw-r--r--   0 runner    (1001) docker     (123)      725 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/exchange/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.591886 freqtrade-2023.6/freqtrade/freqai/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.591886 freqtrade-2023.6/freqtrade/freqai/RL/
+-rw-r--r--   0 runner    (1001) docker     (123)     4496 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/Base3ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5021 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/Base4ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5644 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/Base5ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15260 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/BaseEnvironment.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21133 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/RL/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.591886 freqtrade-2023.6/freqtrade/freqai/base_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     5137 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/BaseClassifierModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8283 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/BasePyTorchClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1144 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/BasePyTorchModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4774 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/BasePyTorchRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5039 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/BaseRegressionModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30101 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/data_drawer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    42789 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/data_kitchen.py
+-rw-r--r--   0 runner    (1001) docker     (123)    46219 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/freqai_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/freqai/prediction_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     2083 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2866 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2048 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2834 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1920 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2698 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1837 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2692 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3320 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5895 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6732 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/ReinforcementLearner.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3284 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3338 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2110 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2596 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/prediction_models/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/freqai/tensorboard/
+-rw-r--r--   0 runner    (1001) docker     (123)     2166 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/tensorboard/TensorboardCallback.py
+-rw-r--r--   0 runner    (1001) docker     (123)      587 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/tensorboard/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      690 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/tensorboard/base_tensorboard.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1926 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/tensorboard/tensorboard.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/freqai/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)     2028 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/PyTorchDataConvertor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3762 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/PyTorchMLPModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8903 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/PyTorchModelTrainer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2026 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/PyTorchTrainerInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3613 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/PyTorchTransformerModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      666 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/torch/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7382 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqai/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    95634 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/freqtradebot.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/leverage/
+-rw-r--r--   0 runner    (1001) docker     (123)       63 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/leverage/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/leverage/interest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/loggers/
+-rw-r--r--   0 runner    (1001) docker     (123)     4271 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/loggers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      460 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/loggers/buffering_handler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1552 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/loggers/set_log_levels.py
+-rw-r--r--   0 runner    (1001) docker     (123)      714 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/loggers/std_err_stream_handler.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9450 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/misc.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.595886 freqtrade-2023.6/freqtrade/mixins/
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/mixins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1263 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/mixins/logging_mixin.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.599886 freqtrade-2023.6/freqtrade/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/backtest_caching.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65163 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)      856 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/bt_progress.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1823 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28627 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_auto.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_epoch_filters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.599886 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/
+-rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
+-rw-r--r--   0 runner    (1001) docker     (123)      746 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      931 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)      951 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_loss_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23090 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/hyperopt_tools.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)    11721 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/lookahead_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9284 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/lookahead_analysis_helpers.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.599886 freqtrade-2023.6/freqtrade/optimize/optimize_reports/
+-rw-r--r--   0 runner    (1001) docker     (123)     1401 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/optimize_reports/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19572 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/optimize_reports/bt_output.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2756 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/optimize_reports/bt_storage.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23383 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/optimize_reports/optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.599886 freqtrade-2023.6/freqtrade/optimize/space/
+-rw-r--r--   0 runner    (1001) docker     (123)      127 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/space/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/optimize/space/decimalspace.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.603886 freqtrade-2023.6/freqtrade/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)      284 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6439 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/pairlock.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6364 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/pairlock_middleware.py
+-rw-r--r--   0 runner    (1001) docker     (123)    72482 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/persistence/trade_model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.603886 freqtrade-2023.6/freqtrade/plot/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26157 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plot/plotting.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.603886 freqtrade-2023.6/freqtrade/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.603886 freqtrade-2023.6/freqtrade/plugins/pairlist/
+-rw-r--r--   0 runner    (1001) docker     (123)     6497 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/AgeFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9088 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/IPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/OffsetFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3966 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/PerformanceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3089 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/PrecisionFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6630 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/PriceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3987 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/ProducerPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9584 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/RemotePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3639 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/ShuffleFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2971 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/SpreadFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2879 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/StaticPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6003 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/VolatilityFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12665 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/VolumePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/pairlist_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6389 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlist/rangestabilityfilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/pairlistmanager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2870 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protectionmanager.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.603886 freqtrade-2023.6/freqtrade/plugins/protections/
+-rw-r--r--   0 runner    (1001) docker     (123)      105 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/cooldown_period.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/iprotection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/low_profit_pairs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/max_drawdown_protection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/plugins/protections/stoploss_guard.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.607886 freqtrade-2023.6/freqtrade/resolvers/
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3699 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/exchange_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1776 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/freqaimodel_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/hyperopt_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10500 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/iresolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/pairlist_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/protection_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/resolvers/strategy_resolver.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.607886 freqtrade-2023.6/freqtrade/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)      111 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.607886 freqtrade-2023.6/freqtrade/rpc/api_server/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_auth.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5121 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_background_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9306 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_backtest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    11853 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14770 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_v1.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4584 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/api_ws.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2017 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/deps.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.611886 freqtrade-2023.6/freqtrade/rpc/api_server/ui/
+-rw-r--r--   0 runner    (1001) docker     (123)      753 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ui/fallback_file.html
+-rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ui/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (123)     2100 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/uvicorn_threaded.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/web_ui.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8152 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/webserver.py
+-rw-r--r--   0 runner    (1001) docker     (123)      889 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/webserver_bgwork.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.611886 freqtrade-2023.6/freqtrade/rpc/api_server/ws/
+-rw-r--r--   0 runner    (1001) docker     (123)      419 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/channel.py
+-rw-r--r--   0 runner    (1001) docker     (123)      898 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/message_stream.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/proxy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/serializer.py
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws/types.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1882 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/api_server/ws_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/discord.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/external_message_consumer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57602 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/rpc_types.py
+-rw-r--r--   0 runner    (1001) docker     (123)    79769 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/rpc/webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.611886 freqtrade-2023.6/freqtrade/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)      650 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8240 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/hyper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/informative_decorator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65791 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/strategy_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/strategy_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/strategy/strategyupdater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.611886 freqtrade-2023.6/freqtrade/templates/
+-rw-r--r--   0 runner    (1001) docker     (123)    12781 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/FreqaiExampleHybridStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12687 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/FreqaiExampleStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/base_config.json.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/base_strategy.py.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/sample_hyperopt_loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/sample_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_analysis_example.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.615886 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      101 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/indicators_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      464 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      506 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      262 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      103 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.615886 freqtrade-2023.6/freqtrade/templates/subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_binance.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      483 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_bittrex.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      271 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_gateio.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      244 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_generic.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_huobi.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      413 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_kraken.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_kucoin.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/templates/subtemplates/exchange_okex.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.615886 freqtrade-2023.6/freqtrade/types/
+-rw-r--r--   0 runner    (1001) docker     (123)       82 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/types/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      311 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/types/valid_exchanges_type.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.615886 freqtrade-2023.6/freqtrade/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      442 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1846 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/datetime_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      337 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/ft_precise.py
+-rw-r--r--   0 runner    (1001) docker     (123)      458 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/gc_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)      580 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/util/periodic_cache.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.615886 freqtrade-2023.6/freqtrade/vendor/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/vendor/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.619886 freqtrade-2023.6/freqtrade/vendor/qtpylib/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/vendor/qtpylib/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/vendor/qtpylib/indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14830 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-07-07 18:46:00.000000 freqtrade-2023.6/freqtrade/worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.579886 freqtrade-2023.6/freqtrade.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    14392 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       50 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)     1803 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       16 2023-07-07 18:46:03.000000 freqtrade-2023.6/freqtrade.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-07-07 18:46:00.000000 freqtrade-2023.6/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-07-07 18:46:03.635886 freqtrade-2023.6/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     2330 2023-07-07 18:46:00.000000 freqtrade-2023.6/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.623886 freqtrade-2023.6/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.623886 freqtrade-2023.6/tests/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/commands/test_build_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52545 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/commands/test_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)   124669 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/conftest_trades.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/conftest_trades_usdt.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.623886 freqtrade-2023.6/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19274 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3708 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_download_data.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8496 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_entryexitanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26758 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/data/test_history.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.623886 freqtrade-2023.6/tests/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20687 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/edge/test_edge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.627886 freqtrade-2023.6/tests/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21890 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30477 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_ccxt_compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)   222194 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4979 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10785 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6641 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23283 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/exchange/test_okx.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.631886 freqtrade-2023.6/tests/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)     2276 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43238 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_backtest_detail.py
+-rw-r--r--   0 runner    (1001) docker     (123)    82631 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7655 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_backtesting_adjust_position.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44215 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_hyperopt_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_hyperoptloss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14071 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_lookahead_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20933 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/optimize/test_optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.631886 freqtrade-2023.6/tests/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2942 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/persistence/test_key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16218 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/persistence/test_migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)    99825 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/persistence/test_persistence.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/persistence/test_trade_fromjson.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.631886 freqtrade-2023.6/tests/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/plugins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/plugins/test_pairlist.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5604 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/plugins/test_pairlocks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19094 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/plugins/test_protections.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/plugins/test_remotepairlist.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.635886 freqtrade-2023.6/tests/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44909 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    76835 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc_apiserver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc_emc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9666 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94365 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc_telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17192 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/rpc/test_rpc_webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:03.635886 freqtrade-2023.6/tests/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2230 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/strategy/test_default_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40824 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/strategy/test_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/strategy/test_strategy_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/strategy/test_strategy_loading.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)    54017 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)   235656 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_freqtradebot.py
+-rw-r--r--   0 runner    (1001) docker     (123)      880 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20485 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_integration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5642 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_log_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8305 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9552 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_misc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19996 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_plotting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6787 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_strategy_updater.py
+-rw-r--r--   0 runner    (1001) docker     (123)      414 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_talib.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3539 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15063 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-07-07 18:46:00.000000 freqtrade-2023.6/tests/test_worker.py
```

### Comparing `freqtrade-2023.5.1/LICENSE` & `freqtrade-2023.6/LICENSE`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/PKG-INFO` & `freqtrade-2023.6/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.5.1
+Version: 2023.6
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
```

### Comparing `freqtrade-2023.5.1/README.md` & `freqtrade-2023.6/README.md`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/__init__.py` & `freqtrade-2023.6/freqtrade/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 """ Freqtrade bot """
-__version__ = '2023.5.1'
+__version__ = '2023.6'
 
 if 'dev' in __version__:
     from pathlib import Path
     try:
         import subprocess
         freqtrade_basedir = Path(__file__).parent
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/__init__.py` & `freqtrade-2023.6/freqtrade/commands/__init__.py`

 * *Files 5% similar despite different names*

```diff
@@ -15,13 +15,14 @@
 from freqtrade.commands.deploy_commands import (start_create_userdir, start_install_ui,
                                                 start_new_strategy)
 from freqtrade.commands.hyperopt_commands import start_hyperopt_list, start_hyperopt_show
 from freqtrade.commands.list_commands import (start_list_exchanges, start_list_freqAI_models,
                                               start_list_markets, start_list_strategies,
                                               start_list_timeframes, start_show_trades)
 from freqtrade.commands.optimize_commands import (start_backtesting, start_backtesting_show,
-                                                  start_edge, start_hyperopt)
+                                                  start_edge, start_hyperopt,
+                                                  start_lookahead_analysis)
 from freqtrade.commands.pairlist_commands import start_test_pairlist
 from freqtrade.commands.plot_commands import start_plot_dataframe, start_plot_profit
 from freqtrade.commands.strategy_utils_commands import start_strategy_update
 from freqtrade.commands.trade_commands import start_trading
 from freqtrade.commands.webserver_commands import start_webserver
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/analyze_commands.py` & `freqtrade-2023.6/freqtrade/commands/analyze_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/arguments.py` & `freqtrade-2023.6/freqtrade/commands/arguments.py`

 * *Files 2% similar despite different names*

```diff
@@ -113,15 +113,19 @@
                     "list-markets", "list-pairs", "list-strategies", "list-freqaimodels",
                     "list-data", "hyperopt-list", "hyperopt-show", "backtest-filter",
                     "plot-dataframe", "plot-profit", "show-trades", "trades-to-ohlcv",
                     "strategy-updater"]
 
 NO_CONF_ALLOWED = ["create-userdir", "list-exchanges", "new-strategy"]
 
-ARGS_STRATEGY_UTILS = ["strategy_list", "strategy_path", "recursive_strategy_search"]
+ARGS_STRATEGY_UPDATER = ["strategy_list", "strategy_path", "recursive_strategy_search"]
+
+ARGS_LOOKAHEAD_ANALYSIS = [
+    a for a in ARGS_BACKTEST if a not in ("position_stacking", "use_max_market_positions", 'cache')
+    ] + ["minimum_trade_amount", "targeted_trade_amount", "lookahead_analysis_exportfilename"]
 
 
 class Arguments:
     """
     Arguments Class. Manage the arguments received by the cli
     """
 
@@ -197,16 +201,17 @@
                                         start_backtesting_show, start_convert_data,
                                         start_convert_db, start_convert_trades,
                                         start_create_userdir, start_download_data, start_edge,
                                         start_hyperopt, start_hyperopt_list, start_hyperopt_show,
                                         start_install_ui, start_list_data, start_list_exchanges,
                                         start_list_freqAI_models, start_list_markets,
                                         start_list_strategies, start_list_timeframes,
-                                        start_new_config, start_new_strategy, start_plot_dataframe,
-                                        start_plot_profit, start_show_trades, start_strategy_update,
+                                        start_lookahead_analysis, start_new_config,
+                                        start_new_strategy, start_plot_dataframe, start_plot_profit,
+                                        start_show_trades, start_strategy_update,
                                         start_test_pairlist, start_trading, start_webserver)
 
         subparsers = self.parser.add_subparsers(dest='command',
                                                 # Use custom message when no subhandler is added
                                                 # shown from `main.py`
                                                 # required=True
                                                 )
@@ -447,8 +452,19 @@
 
         # Add strategy_updater subcommand
         strategy_updater_cmd = subparsers.add_parser('strategy-updater',
                                                      help='updates outdated strategy'
                                                           'files to the current version',
                                                      parents=[_common_parser])
         strategy_updater_cmd.set_defaults(func=start_strategy_update)
-        self._build_args(optionlist=ARGS_STRATEGY_UTILS, parser=strategy_updater_cmd)
+        self._build_args(optionlist=ARGS_STRATEGY_UPDATER, parser=strategy_updater_cmd)
+
+        # Add lookahead_analysis subcommand
+        lookahead_analayis_cmd = subparsers.add_parser(
+            'lookahead-analysis',
+            help="Check for potential look ahead bias.",
+            parents=[_common_parser, _strategy_parser])
+
+        lookahead_analayis_cmd.set_defaults(func=start_lookahead_analysis)
+
+        self._build_args(optionlist=ARGS_LOOKAHEAD_ANALYSIS,
+                         parser=lookahead_analayis_cmd)
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/build_config_commands.py` & `freqtrade-2023.6/freqtrade/commands/build_config_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/cli_options.py` & `freqtrade-2023.6/freqtrade/commands/cli_options.py`

 * *Files 2% similar despite different names*

```diff
@@ -686,8 +686,25 @@
         metavar='PATH',
     ),
     "freqai_backtest_live_models": Arg(
         '--freqai-backtest-live-models',
         help='Run backtest with ready models.',
         action='store_true'
     ),
+    "minimum_trade_amount": Arg(
+        '--minimum-trade-amount',
+        help='Minimum trade amount for lookahead-analysis',
+        type=check_int_positive,
+        metavar='INT',
+    ),
+    "targeted_trade_amount": Arg(
+        '--targeted-trade-amount',
+        help='Targeted trade amount for lookahead analysis',
+        type=check_int_positive,
+        metavar='INT',
+    ),
+    "lookahead_analysis_exportfilename": Arg(
+        '--lookahead-analysis-exportfilename',
+        help="Use this csv-filename to store lookahead-analysis-results",
+        type=str
+    ),
 }
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/db_commands.py` & `freqtrade-2023.6/freqtrade/commands/db_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/deploy_commands.py` & `freqtrade-2023.6/freqtrade/commands/deploy_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/hyperopt_commands.py` & `freqtrade-2023.6/freqtrade/commands/hyperopt_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/list_commands.py` & `freqtrade-2023.6/freqtrade/commands/list_commands.py`

 * *Files 13% similar despite different names*

```diff
@@ -1,46 +1,71 @@
 import csv
 import logging
 import sys
-from typing import Any, Dict, List
+from typing import Any, Dict, List, Union
 
 import rapidjson
 from colorama import Fore, Style
 from colorama import init as colorama_init
 from tabulate import tabulate
 
 from freqtrade.configuration import setup_utils_configuration
 from freqtrade.enums import RunMode
 from freqtrade.exceptions import OperationalException
-from freqtrade.exchange import market_is_active, validate_exchanges
+from freqtrade.exchange import list_available_exchanges, market_is_active
 from freqtrade.misc import parse_db_uri_for_logging, plural
 from freqtrade.resolvers import ExchangeResolver, StrategyResolver
+from freqtrade.types import ValidExchangesType
 
 
 logger = logging.getLogger(__name__)
 
 
 def start_list_exchanges(args: Dict[str, Any]) -> None:
     """
     Print available exchanges
     :param args: Cli args from Arguments()
     :return: None
     """
-    exchanges = validate_exchanges(args['list_exchanges_all'])
+    exchanges = list_available_exchanges(args['list_exchanges_all'])
 
     if args['print_one_column']:
-        print('\n'.join([e[0] for e in exchanges]))
+        print('\n'.join([e['name'] for e in exchanges]))
     else:
+        headers = {
+            'name': 'Exchange name',
+            'supported': 'Supported',
+            'trade_modes': 'Markets',
+            'comment': 'Reason',
+            }
+        headers.update({'valid': 'Valid'} if args['list_exchanges_all'] else {})
+
+        def build_entry(exchange: ValidExchangesType, valid: bool):
+            valid_entry = {'valid': exchange['valid']} if valid else {}
+            result: Dict[str, Union[str, bool]] = {
+                'name': exchange['name'],
+                **valid_entry,
+                'supported': 'Official' if exchange['supported'] else '',
+                'trade_modes': ', '.join(
+                    (f"{a['margin_mode']} " if a['margin_mode'] else '') + a['trading_mode']
+                    for a in exchange['trade_modes']
+                ),
+                'comment': exchange['comment'],
+            }
+
+            return result
+
         if args['list_exchanges_all']:
             print("All exchanges supported by the ccxt library:")
+            exchanges = [build_entry(e, True) for e in exchanges]
         else:
             print("Exchanges available for Freqtrade:")
-            exchanges = [e for e in exchanges if e[1] is not False]
+            exchanges = [build_entry(e, False) for e in exchanges if e['valid'] is not False]
 
-        print(tabulate(exchanges, headers=['Exchange name', 'Valid', 'reason']))
+        print(tabulate(exchanges, headers=headers, ))
 
 
 def _print_objs_tabular(objs: List, print_colorized: bool) -> None:
     if print_colorized:
         colorama_init(autoreset=True)
         red = Fore.RED
         yellow = Fore.YELLOW
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/optimize_commands.py` & `freqtrade-2023.6/freqtrade/commands/optimize_commands.py`

 * *Files 3% similar despite different names*

```diff
@@ -128,7 +128,19 @@
     # Initialize configuration
     config = setup_optimize_configuration(args, RunMode.EDGE)
     logger.info('Starting freqtrade in Edge mode')
 
     # Initialize Edge object
     edge_cli = EdgeCli(config)
     edge_cli.start()
+
+
+def start_lookahead_analysis(args: Dict[str, Any]) -> None:
+    """
+    Start the backtest bias tester script
+    :param args: Cli args from Arguments()
+    :return: None
+    """
+    from freqtrade.optimize.lookahead_analysis_helpers import LookaheadAnalysisSubFunctions
+
+    config = setup_utils_configuration(args, RunMode.UTIL_NO_EXCHANGE)
+    LookaheadAnalysisSubFunctions.start(config)
```

### Comparing `freqtrade-2023.5.1/freqtrade/commands/pairlist_commands.py` & `freqtrade-2023.6/freqtrade/commands/pairlist_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/plot_commands.py` & `freqtrade-2023.6/freqtrade/commands/plot_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/strategy_utils_commands.py` & `freqtrade-2023.6/freqtrade/commands/strategy_utils_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/commands/trade_commands.py` & `freqtrade-2023.6/freqtrade/commands/trade_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/config_setup.py` & `freqtrade-2023.6/freqtrade/configuration/config_setup.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/config_validation.py` & `freqtrade-2023.6/freqtrade/configuration/config_validation.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/configuration.py` & `freqtrade-2023.6/freqtrade/configuration/configuration.py`

 * *Files 3% similar despite different names*

```diff
@@ -199,15 +199,15 @@
                                         / 'backtest_results')
 
     def _process_optimize_options(self, config: Config) -> None:
 
         # This will override the strategy configuration
         self._args_to_config(config, argname='timeframe',
                              logstring='Parameter -i/--timeframe detected ... '
-                             'Using timeframe: {} ...')
+                                       'Using timeframe: {} ...')
 
         self._args_to_config(config, argname='position_stacking',
                              logstring='Parameter --enable-position-stacking detected ...')
 
         self._args_to_config(
             config, argname='enable_protections',
             logstring='Parameter --enable-protections detected, enabling Protections. ...')
@@ -296,14 +296,17 @@
 
         self._args_to_config(config, argname='hyperopt_path',
                              logstring='Using additional Hyperopt lookup path: {}')
 
         self._args_to_config(config, argname='hyperoptexportfilename',
                              logstring='Using hyperopt file: {}')
 
+        self._args_to_config(config, argname='lookahead_analysis_exportfilename',
+                             logstring='Saving lookahead analysis results into {} ...')
+
         self._args_to_config(config, argname='epochs',
                              logstring='Parameter --epochs detected ... '
                              'Will run Hyperopt with for {} epochs ...'
                              )
 
         self._args_to_config(config, argname='spaces',
                              logstring='Parameter -s/--spaces detected: {}')
@@ -470,14 +473,27 @@
 
         self._args_to_config(config, argname='analysis_to_csv',
                              logstring='Store analysis tables to CSV: {}')
 
         self._args_to_config(config, argname='analysis_csv_path',
                              logstring='Path to store analysis CSVs: {}')
 
+        self._args_to_config(config, argname='analysis_csv_path',
+                             logstring='Path to store analysis CSVs: {}')
+
+        # Lookahead analysis results
+        self._args_to_config(config, argname='targeted_trade_amount',
+                             logstring='Targeted Trade amount: {}')
+
+        self._args_to_config(config, argname='minimum_trade_amount',
+                             logstring='Minimum Trade amount: {}')
+
+        self._args_to_config(config, argname='lookahead_analysis_exportfilename',
+                             logstring='Path to store lookahead-analysis-results: {}')
+
     def _process_runmode(self, config: Config) -> None:
 
         self._args_to_config(config, argname='dry_run',
                              logstring='Parameter --dry-run detected, '
                              'overriding dry_run to: {} ...')
 
         if not self.runmode:
@@ -548,10 +564,11 @@
         if 'config' in self.args and self.args['config']:
             logger.info("Using pairlist from configuration.")
             config['pairs'] = config.get('exchange', {}).get('pair_whitelist')
         else:
             # Fall back to /dl_path/pairs.json
             pairs_file = config['datadir'] / 'pairs.json'
             if pairs_file.exists():
+                logger.info(f'Reading pairs file "{pairs_file}".')
                 config['pairs'] = load_file(pairs_file)
                 if 'pairs' in config and isinstance(config['pairs'], list):
                     config['pairs'].sort()
```

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/deprecated_settings.py` & `freqtrade-2023.6/freqtrade/configuration/deprecated_settings.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/directory_operations.py` & `freqtrade-2023.6/freqtrade/configuration/directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/environment_vars.py` & `freqtrade-2023.6/freqtrade/configuration/environment_vars.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/load_config.py` & `freqtrade-2023.6/freqtrade/configuration/load_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/configuration/timerange.py` & `freqtrade-2023.6/freqtrade/configuration/timerange.py`

 * *Files 4% similar despite different names*

```diff
@@ -2,14 +2,16 @@
 This module contains the argument manager class
 """
 import logging
 import re
 from datetime import datetime, timezone
 from typing import Optional
 
+from typing_extensions import Self
+
 from freqtrade.constants import DATETIME_PRINT_FORMAT
 from freqtrade.exceptions import OperationalException
 
 
 logger = logging.getLogger(__name__)
 
 
@@ -103,23 +105,23 @@
                                    and min_date.timestamp() >= self.startts)):
             # If no startts was defined, or backtest-data starts at the defined backtest-date
             logger.warning("Moving start-date by %s candles to account for startup time.",
                            startup_candles)
             self.startts = int(min_date.timestamp() + timeframe_secs * startup_candles)
             self.starttype = 'date'
 
-    @staticmethod
-    def parse_timerange(text: Optional[str]) -> 'TimeRange':
+    @classmethod
+    def parse_timerange(cls, text: Optional[str]) -> Self:
         """
         Parse the value of the argument --timerange to determine what is the range desired
         :param text: value from --timerange
         :return: Start and End range period
         """
         if not text:
-            return TimeRange(None, None, 0, 0)
+            return cls(None, None, 0, 0)
         syntax = [(r'^-(\d{8})$', (None, 'date')),
                   (r'^(\d{8})-$', ('date', None)),
                   (r'^(\d{8})-(\d{8})$', ('date', 'date')),
                   (r'^-(\d{10})$', (None, 'date')),
                   (r'^(\d{10})-$', ('date', None)),
                   (r'^(\d{10})-(\d{10})$', ('date', 'date')),
                   (r'^-(\d{13})$', (None, 'date')),
@@ -152,9 +154,9 @@
                     elif len(stops) == 13:
                         stop = int(stops) // 1000
                     else:
                         stop = int(stops)
                 if start > stop > 0:
                     raise OperationalException(
                         f'Start date is after stop date for timerange "{text}"')
-                return TimeRange(stype[0], stype[1], start, stop)
+                return cls(stype[0], stype[1], start, stop)
         raise OperationalException(f'Incorrect syntax for timerange "{text}"')
```

### Comparing `freqtrade-2023.5.1/freqtrade/constants.py` & `freqtrade-2023.6/freqtrade/constants.py`

 * *Files 1% similar despite different names*

```diff
@@ -4,14 +4,15 @@
 bot constants
 """
 from typing import Any, Dict, List, Literal, Tuple
 
 from freqtrade.enums import CandleType, PriceType, RPCMessageType
 
 
+DOCS_LINK = "https://www.freqtrade.io/en/stable"
 DEFAULT_CONFIG = 'config.json'
 DEFAULT_EXCHANGE = 'bittrex'
 PROCESS_THROTTLE_SECS = 5  # sec
 HYPEROPT_EPOCH = 100  # epochs
 RETRY_TIMEOUT = 30  # sec
 TIMEOUT_UNITS = ['minutes', 'seconds']
 EXPORT_OPTIONS = ['none', 'trades', 'signals']
@@ -107,14 +108,16 @@
         "secret": "",
         "pair_whitelist": [],
         "ccxt_async_config": {
         }
     }
 }
 
+__MESSAGE_TYPE_DICT: Dict[str, Dict[str, str]] = {x: {'type': 'object'} for x in RPCMessageType}
+
 # Required json-schema for user specified config
 CONF_SCHEMA = {
     'type': 'object',
     'properties': {
         'max_open_trades': {'type': ['integer', 'number'], 'minimum': -1},
         'new_pairs_days': {'type': 'integer', 'default': 30},
         'timeframe': {'type': 'string'},
@@ -144,15 +147,14 @@
         'cancel_open_orders_on_exit': {'type': 'boolean', 'default': False},
         'process_only_new_candles': {'type': 'boolean'},
         'minimal_roi': {
             'type': 'object',
             'patternProperties': {
                 '^[0-9.]+$': {'type': 'number'}
             },
-            'minProperties': 1
         },
         'amount_reserve_percent': {'type': 'number', 'minimum': 0.0, 'maximum': 0.5},
         'stoploss': {'type': 'number', 'maximum': 0, 'exclusiveMaximum': True, 'minimum': -1},
         'trailing_stop': {'type': 'boolean'},
         'trailing_stop_positive': {'type': 'number', 'minimum': 0, 'maximum': 1},
         'trailing_stop_positive_offset': {'type': 'number', 'minimum': 0, 'maximum': 1},
         'trailing_only_offset_is_reached': {'type': 'boolean'},
@@ -160,14 +162,17 @@
         'exit_profit_only': {'type': 'boolean'},
         'exit_profit_offset': {'type': 'number'},
         'ignore_roi_if_entry_signal': {'type': 'boolean'},
         'ignore_buying_expired_candle_after': {'type': 'number'},
         'trading_mode': {'type': 'string', 'enum': TRADING_MODES},
         'margin_mode': {'type': 'string', 'enum': MARGIN_MODES},
         'reduce_df_footprint': {'type': 'boolean', 'default': False},
+        'minimum_trade_amount': {'type': 'number', 'default': 10},
+        'targeted_trade_amount': {'type': 'number', 'default': 20},
+        'lookahead_analysis_exportfilename': {'type': 'string'},
         'liquidation_buffer': {'type': 'number', 'minimum': 0.0, 'maximum': 0.99},
         'backtest_breakdown': {
             'type': 'array',
             'items': {'type': 'string', 'enum': BACKTEST_BREAKDOWNS}
         },
         'bot_name': {'type': 'string'},
         'unfilledtimeout': {
@@ -347,15 +352,16 @@
             'type': 'object',
             'properties': {
                 'enabled': {'type': 'boolean'},
                 'url': {'type': 'string'},
                 'format': {'type': 'string', 'enum': WEBHOOK_FORMAT_OPTIONS, 'default': 'form'},
                 'retries': {'type': 'integer', 'minimum': 0},
                 'retry_delay': {'type': 'number', 'minimum': 0},
-                **dict([(x, {'type': 'object'}) for x in RPCMessageType]),
+                **__MESSAGE_TYPE_DICT,
+                # **{x: {'type': 'object'} for x in RPCMessageType},
                 # Below -> Deprecated
                 'webhookentry': {'type': 'object'},
                 'webhookentrycancel': {'type': 'object'},
                 'webhookentryfill': {'type': 'object'},
                 'webhookexit': {'type': 'object'},
                 'webhookexitcancel': {'type': 'object'},
                 'webhookexitfill': {'type': 'object'},
```

### Comparing `freqtrade-2023.5.1/freqtrade/data/btanalysis.py` & `freqtrade-2023.6/freqtrade/data/btanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/converter.py` & `freqtrade-2023.6/freqtrade/data/converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/dataprovider.py` & `freqtrade-2023.6/freqtrade/data/dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/entryexitanalysis.py` & `freqtrade-2023.6/freqtrade/data/entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/featherdatahandler.py` & `freqtrade-2023.6/freqtrade/data/history/featherdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/hdf5datahandler.py` & `freqtrade-2023.6/freqtrade/data/history/hdf5datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/history_utils.py` & `freqtrade-2023.6/freqtrade/data/history/history_utils.py`

 * *Files 4% similar despite different names*

```diff
@@ -3,22 +3,24 @@
 from datetime import datetime, timedelta
 from pathlib import Path
 from typing import Dict, List, Optional, Tuple
 
 from pandas import DataFrame, concat
 
 from freqtrade.configuration import TimeRange
-from freqtrade.constants import DEFAULT_DATAFRAME_COLUMNS
+from freqtrade.constants import DATETIME_PRINT_FORMAT, DEFAULT_DATAFRAME_COLUMNS, Config
 from freqtrade.data.converter import (clean_ohlcv_dataframe, ohlcv_to_dataframe,
                                       trades_remove_duplicates, trades_to_ohlcv)
 from freqtrade.data.history.idatahandler import IDataHandler, get_datahandler
 from freqtrade.enums import CandleType
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import Exchange
 from freqtrade.misc import format_ms_time
+from freqtrade.plugins.pairlist.pairlist_helpers import dynamic_expand_pairlist
+from freqtrade.util.binance_mig import migrate_binance_futures_data
 
 
 logger = logging.getLogger(__name__)
 
 
 def load_pair_history(pair: str,
                       timeframe: str,
@@ -223,17 +225,19 @@
         logger.info(f'({process}) - Download history data for "{pair}", {timeframe}, '
                     f'{candle_type} and store in {datadir}. '
                     f'From {format_ms_time(since_ms) if since_ms else "start"} to '
                     f'{format_ms_time(until_ms) if until_ms else "now"}'
                     )
 
         logger.debug("Current Start: %s",
-                     f"{data.iloc[0]['date']:DATETIME_PRINT_FORMAT}" if not data.empty else 'None')
+                     f"{data.iloc[0]['date']:{DATETIME_PRINT_FORMAT}}"
+                     if not data.empty else 'None')
         logger.debug("Current End: %s",
-                     f"{data.iloc[-1]['date']:DATETIME_PRINT_FORMAT}" if not data.empty else 'None')
+                     f"{data.iloc[-1]['date']:{DATETIME_PRINT_FORMAT}}"
+                     if not data.empty else 'None')
 
         # Default since_ms to 30 days if nothing is given
         new_data = exchange.get_historic_ohlcv(pair=pair,
                                                timeframe=timeframe,
                                                since_ms=since_ms if since_ms else
                                                int((datetime.now() - timedelta(days=new_pairs_days)
                                                     ).timestamp()) * 1000,
@@ -248,18 +252,20 @@
             data = new_dataframe
         else:
             # Run cleaning again to ensure there were no duplicate candles
             # Especially between existing and new data.
             data = clean_ohlcv_dataframe(concat([data, new_dataframe], axis=0), timeframe, pair,
                                          fill_missing=False, drop_incomplete=False)
 
-        logger.debug("New  Start: %s",
-                     f"{data.iloc[0]['date']:DATETIME_PRINT_FORMAT}" if not data.empty else 'None')
+        logger.debug("New Start: %s",
+                     f"{data.iloc[0]['date']:{DATETIME_PRINT_FORMAT}}"
+                     if not data.empty else 'None')
         logger.debug("New End: %s",
-                     f"{data.iloc[-1]['date']:DATETIME_PRINT_FORMAT}" if not data.empty else 'None')
+                     f"{data.iloc[-1]['date']:{DATETIME_PRINT_FORMAT}}"
+                     if not data.empty else 'None')
 
         data_handler.ohlcv_store(pair, timeframe, data=data, candle_type=candle_type)
         return True
 
     except Exception:
         logger.exception(
             f'Failed to download history data for pair: "{pair}", timeframe: {timeframe}.'
@@ -286,15 +292,15 @@
     for idx, pair in enumerate(pairs, start=1):
         if pair not in exchange.markets:
             pairs_not_available.append(pair)
             logger.info(f"Skipping pair {pair}...")
             continue
         for timeframe in timeframes:
 
-            logger.info(f'Downloading pair {pair}, interval {timeframe}.')
+            logger.debug(f'Downloading pair {pair}, {candle_type}, interval {timeframe}.')
             process = f'{idx}/{len(pairs)}'
             _download_pair_history(pair=pair, process=process,
                                    datadir=datadir, exchange=exchange,
                                    timerange=timerange, data_handler=data_handler,
                                    timeframe=str(timeframe), new_pairs_days=new_pairs_days,
                                    candle_type=candle_type,
                                    erase=erase, prepend=prepend)
@@ -475,7 +481,81 @@
     found_missing = False
     dflen = len(data)
     if dflen < expected_frames:
         found_missing = True
         logger.warning("%s has missing frames: expected %s, got %s, that's %s missing values",
                        pair, expected_frames, dflen, expected_frames - dflen)
     return found_missing
+
+
+def download_data_main(config: Config) -> None:
+
+    timerange = TimeRange()
+    if 'days' in config:
+        time_since = (datetime.now() - timedelta(days=config['days'])).strftime("%Y%m%d")
+        timerange = TimeRange.parse_timerange(f'{time_since}-')
+
+    if 'timerange' in config:
+        timerange = timerange.parse_timerange(config['timerange'])
+
+    # Remove stake-currency to skip checks which are not relevant for datadownload
+    config['stake_currency'] = ''
+
+    pairs_not_available: List[str] = []
+
+    # Init exchange
+    from freqtrade.resolvers.exchange_resolver import ExchangeResolver
+    exchange = ExchangeResolver.load_exchange(config, validate=False)
+    available_pairs = [
+        p for p in exchange.get_markets(
+            tradable_only=True, active_only=not config.get('include_inactive')
+            ).keys()
+    ]
+
+    expanded_pairs = dynamic_expand_pairlist(config, available_pairs)
+
+    # Manual validations of relevant settings
+    if not config['exchange'].get('skip_pair_validation', False):
+        exchange.validate_pairs(expanded_pairs)
+    logger.info(f"About to download pairs: {expanded_pairs}, "
+                f"intervals: {config['timeframes']} to {config['datadir']}")
+
+    for timeframe in config['timeframes']:
+        exchange.validate_timeframes(timeframe)
+
+    # Start downloading
+    try:
+        if config.get('download_trades'):
+            if config.get('trading_mode') == 'futures':
+                raise OperationalException("Trade download not supported for futures.")
+            pairs_not_available = refresh_backtest_trades_data(
+                exchange, pairs=expanded_pairs, datadir=config['datadir'],
+                timerange=timerange, new_pairs_days=config['new_pairs_days'],
+                erase=bool(config.get('erase')), data_format=config['dataformat_trades'])
+
+            # Convert downloaded trade data to different timeframes
+            convert_trades_to_ohlcv(
+                pairs=expanded_pairs, timeframes=config['timeframes'],
+                datadir=config['datadir'], timerange=timerange, erase=bool(config.get('erase')),
+                data_format_ohlcv=config['dataformat_ohlcv'],
+                data_format_trades=config['dataformat_trades'],
+            )
+        else:
+            if not exchange.get_option('ohlcv_has_history', True):
+                raise OperationalException(
+                    f"Historic klines not available for {exchange.name}. "
+                    "Please use `--dl-trades` instead for this exchange "
+                    "(will unfortunately take a long time)."
+                    )
+            migrate_binance_futures_data(config)
+            pairs_not_available = refresh_backtest_ohlcv_data(
+                exchange, pairs=expanded_pairs, timeframes=config['timeframes'],
+                datadir=config['datadir'], timerange=timerange,
+                new_pairs_days=config['new_pairs_days'],
+                erase=bool(config.get('erase')), data_format=config['dataformat_ohlcv'],
+                trading_mode=config.get('trading_mode', 'spot'),
+                prepend=config.get('prepend_data', False)
+            )
+    finally:
+        if pairs_not_available:
+            logger.info(f"Pairs [{','.join(pairs_not_available)}] not available "
+                        f"on exchange {exchange.name}.")
```

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/idatahandler.py` & `freqtrade-2023.6/freqtrade/data/history/idatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/jsondatahandler.py` & `freqtrade-2023.6/freqtrade/data/history/jsondatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/history/parquetdatahandler.py` & `freqtrade-2023.6/freqtrade/data/history/parquetdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/data/metrics.py` & `freqtrade-2023.6/freqtrade/data/metrics.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/edge/edge_positioning.py` & `freqtrade-2023.6/freqtrade/edge/edge_positioning.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/__init__.py` & `freqtrade-2023.6/freqtrade/enums/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/candletype.py` & `freqtrade-2023.6/freqtrade/enums/candletype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/exitchecktuple.py` & `freqtrade-2023.6/freqtrade/enums/exitchecktuple.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/exittype.py` & `freqtrade-2023.6/freqtrade/enums/exittype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/rpcmessagetype.py` & `freqtrade-2023.6/freqtrade/enums/rpcmessagetype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/runmode.py` & `freqtrade-2023.6/freqtrade/enums/runmode.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/enums/signaltype.py` & `freqtrade-2023.6/freqtrade/enums/signaltype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exceptions.py` & `freqtrade-2023.6/freqtrade/exceptions.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/__init__.py` & `freqtrade-2023.6/freqtrade/exchange/__init__.py`

 * *Files 14% similar despite different names*

```diff
@@ -9,18 +9,18 @@
 from freqtrade.exchange.bitvavo import Bitvavo
 from freqtrade.exchange.bybit import Bybit
 from freqtrade.exchange.coinbasepro import Coinbasepro
 from freqtrade.exchange.exchange_utils import (ROUND_DOWN, ROUND_UP, amount_to_contract_precision,
                                                amount_to_contracts, amount_to_precision,
                                                available_exchanges, ccxt_exchanges,
                                                contracts_to_amount, date_minus_candles,
-                                               is_exchange_known_ccxt, market_is_active,
-                                               price_to_precision, timeframe_to_minutes,
-                                               timeframe_to_msecs, timeframe_to_next_date,
-                                               timeframe_to_prev_date, timeframe_to_seconds,
-                                               validate_exchange, validate_exchanges)
+                                               is_exchange_known_ccxt, list_available_exchanges,
+                                               market_is_active, price_to_precision,
+                                               timeframe_to_minutes, timeframe_to_msecs,
+                                               timeframe_to_next_date, timeframe_to_prev_date,
+                                               timeframe_to_seconds, validate_exchange)
 from freqtrade.exchange.gate import Gate
 from freqtrade.exchange.hitbtc import Hitbtc
 from freqtrade.exchange.huobi import Huobi
 from freqtrade.exchange.kraken import Kraken
 from freqtrade.exchange.kucoin import Kucoin
 from freqtrade.exchange.okx import Okx
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/binance.py` & `freqtrade-2023.6/freqtrade/exchange/binance.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/binance_leverage_tiers.json` & `freqtrade-2023.6/freqtrade/exchange/binance_leverage_tiers.json`

 * *Files 0% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9878955890866982%*

 * *Differences: {"'1000LUNC/BUSD:BUSD'": "{0: {'maxLeverage': 10.0, 'info': {'initialLeverage': '10'}}, 1: "*

 * *                         "{'maxLeverage': 8.0, 'info': {'initialLeverage': '8'}}, 2: "*

 * *                         "{'maxLeverage': 6.0, 'info': {'initialLeverage': '6'}}, 5: "*

 * *                         "{'maxNotional': 1500000.0, 'info': {'notionalCap': '1500000'}}}",*

 * * "'1000PEPE/USDT:USDT'": "{0: {'maxLeverage': 25.0, 'info': {'initialLeverage': '25'}}, 1: "*

 * *                         "{'maxNotional': 50000.0, 'maxLever []*

```diff
@@ -115,53 +115,53 @@
     ],
     "1000LUNC/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 10.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 8.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -197,20 +197,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
     "1000LUNC/USDT:USDT": [
         {
             "currency": "USDT",
@@ -327,167 +327,167 @@
     ],
     "1000PEPE/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 25.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
-            "maxNotional": 25000.0,
+            "maxLeverage": 20.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
+                "cum": "1275.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "600000",
-                "notionalFloor": "25000"
+                "notionalCap": "900000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 600000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 900000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "30650.0",
+                "cum": "46275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "1600000",
-                "notionalFloor": "600000"
+                "notionalCap": "2400000",
+                "notionalFloor": "900000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 1600000.0,
-            "minNotional": 600000.0,
+            "maxNotional": 2400000.0,
+            "minNotional": 900000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "70650.0",
+                "cum": "106275.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "2000000",
-                "notionalFloor": "1600000"
+                "notionalCap": "3000000",
+                "notionalFloor": "2400000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1600000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 2400000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "320650.0",
+                "cum": "481275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "6000000",
-                "notionalFloor": "2000000"
+                "notionalCap": "9000000",
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 6000000.0,
-            "minNotional": 2000000.0,
+            "maxNotional": 9000000.0,
+            "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "1820650.0",
+                "cum": "2731275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "10000000",
-                "notionalFloor": "6000000"
+                "notionalCap": "15000000",
+                "notionalFloor": "9000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 10000000.0,
-            "minNotional": 6000000.0,
+            "maxNotional": 15000000.0,
+            "minNotional": 9000000.0,
             "tier": 7.0
         }
     ],
     "1000SHIB/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
+            "maxLeverage": 10.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maxLeverage": 8.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "10",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -539,20 +539,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "7",
                 "cum": "949400.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "8000000",
+                "notionalCap": "3500000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 8000000.0,
+            "maxNotional": 3500000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
     "1000SHIB/USDT:USDT": [
         {
             "currency": "USDT",
@@ -589,117 +589,117 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "67.5",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.01",
-                "notionalCap": "50000",
+                "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.01,
             "maxLeverage": 25.0,
-            "maxNotional": 50000.0,
+            "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "817.5",
+                "cum": "1567.5",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "150000",
-                "notionalFloor": "50000"
+                "notionalCap": "300000",
+                "notionalFloor": "100000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 150000.0,
-            "minNotional": 50000.0,
+            "maxNotional": 300000.0,
+            "minNotional": 100000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "4567.5",
+                "cum": "9067.5",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "250000",
-                "notionalFloor": "150000"
+                "notionalCap": "750000",
+                "notionalFloor": "300000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 250000.0,
-            "minNotional": 150000.0,
+            "maxNotional": 750000.0,
+            "minNotional": 300000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "17067.5",
+                "cum": "46567.5",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "500000",
-                "notionalFloor": "250000"
+                "notionalCap": "1500000",
+                "notionalFloor": "750000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 500000.0,
-            "minNotional": 250000.0,
+            "maxNotional": 1500000.0,
+            "minNotional": 750000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "29567.5",
+                "cum": "84067.5",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1500000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1500000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "154567.5",
+                "cum": "459067.5",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "6000000",
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 3000000.0,
             "tier": 8.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "9",
-                "cum": "654567.5",
+                "cum": "1959067.5",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "30000000",
-                "notionalFloor": "2000000"
+                "notionalFloor": "6000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 30000000.0,
-            "minNotional": 2000000.0,
+            "minNotional": 6000000.0,
             "tier": 9.0
         }
     ],
     "1000XEC/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
@@ -1973,53 +1973,53 @@
     ],
     "AMB/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 10.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maxLeverage": 8.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "10",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "200000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maxLeverage": 6.0,
             "maxNotional": 200000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
@@ -2071,20 +2071,20 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
                 "cum": "898150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "3500000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 3500000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
     "ANC/BUSD:BUSD": [
         {
             "currency": "BUSD",
@@ -3131,76 +3131,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "770.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "400000",
+                "notionalCap": "600000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 400000.0,
+            "maxNotional": 600000.0,
             "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "10770.0",
+                "cum": "15770.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "800000",
-                "notionalFloor": "400000"
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 800000.0,
-            "minNotional": 400000.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "50770.0",
+                "cum": "75770.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "2000000",
-                "notionalFloor": "800000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 800000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "100770.0",
+                "cum": "150770.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "5000000",
-                "notionalFloor": "2000000"
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 5000000.0,
-            "minNotional": 2000000.0,
+            "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "725770.0",
+                "cum": "775770.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "12000000",
                 "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -3208,15 +3208,15 @@
             "minNotional": 5000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "3725770.0",
+                "cum": "3775770.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "20000000",
                 "notionalFloor": "12000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -4873,86 +4873,102 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 10.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
+                "cum": "1275.0",
                 "initialLeverage": "8",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalCap": "200000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 8.0,
-            "maxNotional": 100000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 200000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5650.0",
+                "cum": "11275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11900.0",
-                "initialLeverage": "2",
+                "cum": "23775.0",
+                "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.125,
-            "maxLeverage": 2.0,
+            "maxLeverage": 4.0,
             "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "minNotional": 500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386900.0",
+                "cum": "148775.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "1500000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 1500000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "523775.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1500000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 6.0
+            "maxNotional": 3000000.0,
+            "minNotional": 1500000.0,
+            "tier": 7.0
         }
     ],
     "BLUEBIRD/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -6713,60 +6729,60 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.015",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.015,
             "maxLeverage": 25.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "150.0",
+                "cum": "275.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "300000",
-                "notionalFloor": "25000"
+                "notionalCap": "400000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 20.0,
-            "maxNotional": 300000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 400000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "9150.0",
+                "cum": "12275.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "1200000",
-                "notionalFloor": "300000"
+                "notionalFloor": "400000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
             "maxNotional": 1200000.0,
-            "minNotional": 300000.0,
+            "minNotional": 400000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "69150.0",
+                "cum": "72275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
                 "notionalCap": "3000000",
                 "notionalFloor": "1200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
@@ -6774,15 +6790,15 @@
             "minNotional": 1200000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "144150.0",
+                "cum": "147275.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "6000000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
@@ -6790,15 +6806,15 @@
             "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "894150.0",
+                "cum": "897275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "18000000",
                 "notionalFloor": "6000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -6806,15 +6822,15 @@
             "minNotional": 6000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "5394150.0",
+                "cum": "5397275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "30000000",
                 "notionalFloor": "18000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -7135,53 +7151,53 @@
     ],
     "COCOS/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maxLeverage": 8.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "7",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maxLeverage": 7.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "10",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
@@ -7217,24 +7233,138 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
                 "cum": "386900.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
+                "notionalCap": "1500000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
+            "maxNotional": 1500000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "COMBO/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "COMP/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -10151,76 +10281,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
                 "cum": "545.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "250000",
+                "notionalCap": "400000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 25.0,
-            "maxNotional": 250000.0,
+            "maxNotional": 400000.0,
             "minNotional": 50000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "8045.0",
+                "cum": "12545.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalCap": "2000000",
+                "notionalFloor": "400000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 400000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "58045.0",
+                "cum": "112545.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "5000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 1000000.0,
+            "maxNotional": 8000000.0,
+            "minNotional": 2000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "183045.0",
+                "cum": "312545.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "10000000",
-                "notionalFloor": "5000000"
+                "notionalFloor": "8000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 10000000.0,
-            "minNotional": 5000000.0,
+            "minNotional": 8000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "433045.0",
+                "cum": "562545.0",
                 "initialLeverage": "3",
                 "maintMarginRatio": "0.15",
                 "notionalCap": "20000000",
                 "notionalFloor": "10000000"
             },
             "maintenanceMarginRate": 0.15,
             "maxLeverage": 3.0,
@@ -10228,15 +10358,15 @@
             "minNotional": 10000000.0,
             "tier": 8.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "9",
-                "cum": "2433045.0",
+                "cum": "2562545.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "30000000",
                 "notionalFloor": "20000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -10244,15 +10374,15 @@
             "minNotional": 20000000.0,
             "tier": 9.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "10",
-                "cum": "9933045.0",
+                "cum": "1.0062545E7",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "50000000",
                 "notionalFloor": "30000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -10263,94 +10393,94 @@
     ],
     "ETH/BTC:BTC": [
         {
             "currency": "BTC",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "75",
+                "initialLeverage": "100",
                 "maintMarginRatio": "0.005",
                 "notionalCap": "5",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.005,
-            "maxLeverage": 75.0,
+            "maxLeverage": 100.0,
             "maxNotional": 5.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "2",
                 "cum": "0.005",
-                "initialLeverage": "50",
+                "initialLeverage": "75",
                 "maintMarginRatio": "0.006",
                 "notionalCap": "10",
                 "notionalFloor": "5"
             },
             "maintenanceMarginRate": 0.006,
-            "maxLeverage": 50.0,
+            "maxLeverage": 75.0,
             "maxNotional": 10.0,
             "minNotional": 5.0,
             "tier": 2.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "3",
                 "cum": "0.045",
-                "initialLeverage": "25",
+                "initialLeverage": "50",
                 "maintMarginRatio": "0.01",
                 "notionalCap": "100",
                 "notionalFloor": "10"
             },
             "maintenanceMarginRate": 0.01,
-            "maxLeverage": 25.0,
+            "maxLeverage": 50.0,
             "maxNotional": 100.0,
             "minNotional": 10.0,
             "tier": 3.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "4",
                 "cum": "1.045",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "250",
+                "notionalCap": "400",
                 "notionalFloor": "100"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 20.0,
-            "maxNotional": 250.0,
+            "maxNotional": 400.0,
             "minNotional": 100.0,
             "tier": 4.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "5",
-                "cum": "2.295",
+                "cum": "3.045",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "800",
-                "notionalFloor": "250"
+                "notionalFloor": "400"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 10.0,
             "maxNotional": 800.0,
-            "minNotional": 250.0,
+            "minNotional": 400.0,
             "tier": 5.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "6",
-                "cum": "22.295",
+                "cum": "23.045",
                 "initialLeverage": "8",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "1500",
                 "notionalFloor": "800"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 8.0,
@@ -10358,15 +10488,15 @@
             "minNotional": 800.0,
             "tier": 6.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "7",
-                "cum": "97.295",
+                "cum": "98.045",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
                 "notionalCap": "2000",
                 "notionalFloor": "1500"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
@@ -10374,15 +10504,15 @@
             "minNotional": 1500.0,
             "tier": 7.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "8",
-                "cum": "147.295",
+                "cum": "148.045",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "3000",
                 "notionalFloor": "2000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
@@ -10390,15 +10520,15 @@
             "minNotional": 2000.0,
             "tier": 8.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "9",
-                "cum": "522.295",
+                "cum": "523.045",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "5000",
                 "notionalFloor": "3000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -10406,15 +10536,15 @@
             "minNotional": 3000.0,
             "tier": 9.0
         },
         {
             "currency": "BTC",
             "info": {
                 "bracket": "10",
-                "cum": "1772.295",
+                "cum": "1773.045",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "10000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -12593,85 +12723,85 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "4500.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "250000",
+                "notionalCap": "600000",
                 "notionalFloor": "150000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 250000.0,
+            "maxNotional": 600000.0,
             "minNotional": 150000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "17000.0",
+                "cum": "34500.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "500000",
-                "notionalFloor": "250000"
+                "notionalCap": "1600000",
+                "notionalFloor": "600000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 500000.0,
-            "minNotional": 250000.0,
+            "maxNotional": 1600000.0,
+            "minNotional": 600000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "29500.0",
+                "cum": "74500.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "154500.0",
+                "cum": "324500.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "654500.0",
+                "cum": "1324500.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "30000000",
-                "notionalFloor": "2000000"
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 30000000.0,
-            "minNotional": 2000000.0,
+            "minNotional": 4000000.0,
             "tier": 7.0
         }
     ],
     "GMX/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
@@ -14933,14 +15063,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 8000000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
+    "KEY/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 15.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "650.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "200000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 200000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "10650.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "23150.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "148150.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "3000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "898150.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 7.0
+        }
+    ],
     "KLAY/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -15689,37 +15933,37 @@
     ],
     "LINA/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
+                "initialLeverage": "20",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
+            "maxLeverage": 20.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "20",
+                "initialLeverage": "15",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maxLeverage": 15.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
@@ -15771,85 +16015,85 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
                 "cum": "480650.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "9000000",
+                "notionalCap": "5000000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 9000000.0,
+            "maxNotional": 5000000.0,
             "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "2730650.0",
+                "cum": "1730650.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "15000000",
-                "notionalFloor": "9000000"
+                "notionalCap": "7000000",
+                "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 15000000.0,
-            "minNotional": 9000000.0,
+            "maxNotional": 7000000.0,
+            "minNotional": 5000000.0,
             "tier": 7.0
         }
     ],
     "LINK/BUSD:BUSD": [
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "25",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 25.0,
+            "maxLeverage": 10.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
+                "initialLeverage": "8",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maxLeverage": 8.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "10",
+                "initialLeverage": "6",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "100000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maxLeverage": 6.0,
             "maxNotional": 100000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "BUSD",
             "info": {
@@ -15901,20 +16145,20 @@
         {
             "currency": "BUSD",
             "info": {
                 "bracket": "7",
                 "cum": "949400.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "8000000",
+                "notionalCap": "4000000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 8000000.0,
+            "maxNotional": 4000000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
     "LINK/USDT:USDT": [
         {
             "currency": "USDT",
@@ -16635,76 +16879,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
                 "cum": "545.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "250000",
+                "notionalCap": "500000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 25.0,
-            "maxNotional": 250000.0,
+            "maxNotional": 500000.0,
             "minNotional": 50000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "8045.0",
+                "cum": "15545.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalCap": "2000000",
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "58045.0",
+                "cum": "115545.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "5000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 1000000.0,
+            "maxNotional": 8000000.0,
+            "minNotional": 2000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "183045.0",
+                "cum": "315545.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "10000000",
-                "notionalFloor": "5000000"
+                "notionalFloor": "8000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 10000000.0,
-            "minNotional": 5000000.0,
+            "minNotional": 8000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "433045.0",
+                "cum": "565545.0",
                 "initialLeverage": "3",
                 "maintMarginRatio": "0.15",
                 "notionalCap": "20000000",
                 "notionalFloor": "10000000"
             },
             "maintenanceMarginRate": 0.15,
             "maxLeverage": 3.0,
@@ -16712,15 +16956,15 @@
             "minNotional": 10000000.0,
             "tier": 8.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "9",
-                "cum": "2433045.0",
+                "cum": "2565545.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "30000000",
                 "notionalFloor": "20000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -16728,15 +16972,15 @@
             "minNotional": 20000000.0,
             "tier": 9.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "10",
-                "cum": "9933045.0",
+                "cum": "1.0065545E7",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "50000000",
                 "notionalFloor": "30000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -18197,76 +18441,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 10.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
+                "cum": "1275.0",
                 "initialLeverage": "8",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalCap": "200000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 8.0,
-            "maxNotional": 100000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 200000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5650.0",
+                "cum": "11275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "250000",
-                "notionalFloor": "100000"
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 250000.0,
-            "minNotional": 100000.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "11900.0",
+                "cum": "23775.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 2.0,
             "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "minNotional": 500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "386900.0",
+                "cum": "398775.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "3000000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -18833,76 +19077,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "770.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "400000",
+                "notionalCap": "600000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 400000.0,
+            "maxNotional": 600000.0,
             "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "10770.0",
+                "cum": "15770.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "800000",
-                "notionalFloor": "400000"
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 800000.0,
-            "minNotional": 400000.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "50770.0",
+                "cum": "75770.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "2000000",
-                "notionalFloor": "800000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 800000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "100770.0",
+                "cum": "150770.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "5000000",
-                "notionalFloor": "2000000"
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 5000000.0,
-            "minNotional": 2000000.0,
+            "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "725770.0",
+                "cum": "775770.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "12000000",
                 "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -18910,15 +19154,15 @@
             "minNotional": 5000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "3725770.0",
+                "cum": "3775770.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "20000000",
                 "notionalFloor": "12000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -22403,92 +22647,92 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "300.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "300000",
+                "notionalCap": "450000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 300000.0,
+            "maxNotional": 450000.0,
             "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "7800.0",
+                "cum": "11550.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "600000",
-                "notionalFloor": "300000"
+                "notionalCap": "900000",
+                "notionalFloor": "450000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 600000.0,
-            "minNotional": 300000.0,
+            "maxNotional": 900000.0,
+            "minNotional": 450000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "37800.0",
+                "cum": "56550.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "1600000",
-                "notionalFloor": "600000"
+                "notionalCap": "2400000",
+                "notionalFloor": "900000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 1600000.0,
-            "minNotional": 600000.0,
+            "maxNotional": 2400000.0,
+            "minNotional": 900000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "77800.0",
+                "cum": "116550.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "2000000",
-                "notionalFloor": "1600000"
+                "notionalCap": "3000000",
+                "notionalFloor": "2400000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1600000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 2400000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "327800.0",
+                "cum": "491550.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "6000000",
-                "notionalFloor": "2000000"
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
             "maxNotional": 6000000.0,
-            "minNotional": 2000000.0,
+            "minNotional": 3000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "1827800.0",
+                "cum": "1991550.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "10000000",
                 "notionalFloor": "6000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -22613,53 +22857,53 @@
     ],
     "SXP/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "15",
+                "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.02,
-            "maxLeverage": 15.0,
+            "maxLeverage": 25.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "10",
+                "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
-            "maxLeverage": 10.0,
+            "maxLeverage": 20.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "650.0",
-                "initialLeverage": "8",
+                "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "600000",
                 "notionalFloor": "25000"
             },
             "maintenanceMarginRate": 0.05,
-            "maxLeverage": 8.0,
+            "maxLeverage": 10.0,
             "maxNotional": 600000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
@@ -23185,60 +23429,60 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
+                "cum": "1275.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "480000",
-                "notionalFloor": "25000"
+                "notionalCap": "600000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 480000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 600000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "24650.0",
+                "cum": "31275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
                 "notionalCap": "1280000",
-                "notionalFloor": "480000"
+                "notionalFloor": "600000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
             "maxNotional": 1280000.0,
-            "minNotional": 480000.0,
+            "minNotional": 600000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "56650.0",
+                "cum": "63275.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1600000",
                 "notionalFloor": "1280000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
@@ -23246,15 +23490,15 @@
             "minNotional": 1280000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "256650.0",
+                "cum": "263275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "4800000",
                 "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -23262,15 +23506,15 @@
             "minNotional": 1600000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "1456650.0",
+                "cum": "1463275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "8000000",
                 "notionalFloor": "4800000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -24193,21 +24437,21 @@
     ],
     "USDC/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "30",
+                "initialLeverage": "50",
                 "maintMarginRatio": "0.006",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
             "maintenanceMarginRate": 0.006,
-            "maxLeverage": 30.0,
+            "maxLeverage": 50.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
@@ -24227,101 +24471,101 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
                 "cum": "770.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "600000",
+                "notionalCap": "900000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 600000.0,
+            "maxNotional": 900000.0,
             "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "15770.0",
+                "cum": "23270.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "1200000",
-                "notionalFloor": "600000"
+                "notionalCap": "1800000",
+                "notionalFloor": "900000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 1200000.0,
-            "minNotional": 600000.0,
+            "maxNotional": 1800000.0,
+            "minNotional": 900000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "75770.0",
+                "cum": "113270.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "3200000",
-                "notionalFloor": "1200000"
+                "notionalCap": "4800000",
+                "notionalFloor": "1800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 3200000.0,
-            "minNotional": 1200000.0,
+            "maxNotional": 4800000.0,
+            "minNotional": 1800000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "155770.0",
+                "cum": "233270.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "5000000",
-                "notionalFloor": "3200000"
+                "notionalCap": "6000000",
+                "notionalFloor": "4800000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 3200000.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 4800000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "780770.0",
+                "cum": "983270.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "12000000",
-                "notionalFloor": "5000000"
+                "notionalCap": "18000000",
+                "notionalFloor": "6000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 12000000.0,
-            "minNotional": 5000000.0,
+            "maxNotional": 18000000.0,
+            "minNotional": 6000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "3780770.0",
+                "cum": "5483270.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "20000000",
-                "notionalFloor": "12000000"
+                "notionalCap": "30000000",
+                "notionalFloor": "18000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 20000000.0,
-            "minNotional": 12000000.0,
+            "maxNotional": 30000000.0,
+            "minNotional": 18000000.0,
             "tier": 8.0
         }
     ],
     "VET/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
@@ -24569,76 +24813,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
+                "cum": "1275.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "200000",
-                "notionalFloor": "25000"
+                "notionalCap": "300000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 200000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 300000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "10650.0",
+                "cum": "16275.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "800000",
+                "notionalFloor": "300000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
+            "maxNotional": 800000.0,
+            "minNotional": 300000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "23150.0",
+                "cum": "36275.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
+            "minNotional": 800000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "148150.0",
+                "cum": "161275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "3000000",
                 "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -24646,15 +24890,15 @@
             "minNotional": 1000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "898150.0",
+                "cum": "911275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "5000000",
                 "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
@@ -25253,76 +25497,76 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
                 "cum": "545.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "250000",
+                "notionalCap": "500000",
                 "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 25.0,
-            "maxNotional": 250000.0,
+            "maxNotional": 500000.0,
             "minNotional": 50000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "8045.0",
+                "cum": "15545.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "1000000",
-                "notionalFloor": "250000"
+                "notionalCap": "2000000",
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 250000.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "58045.0",
+                "cum": "115545.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "5000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 1000000.0,
+            "maxNotional": 8000000.0,
+            "minNotional": 2000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "183045.0",
+                "cum": "315545.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "10000000",
-                "notionalFloor": "5000000"
+                "notionalFloor": "8000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 10000000.0,
-            "minNotional": 5000000.0,
+            "minNotional": 8000000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "433045.0",
+                "cum": "565545.0",
                 "initialLeverage": "3",
                 "maintMarginRatio": "0.15",
                 "notionalCap": "20000000",
                 "notionalFloor": "10000000"
             },
             "maintenanceMarginRate": 0.15,
             "maxLeverage": 3.0,
@@ -25330,15 +25574,15 @@
             "minNotional": 10000000.0,
             "tier": 8.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "9",
-                "cum": "2433045.0",
+                "cum": "2565545.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "30000000",
                 "notionalFloor": "20000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
@@ -25346,15 +25590,15 @@
             "minNotional": 20000000.0,
             "tier": 9.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "10",
-                "cum": "9933045.0",
+                "cum": "1.0065545E7",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "50000000",
                 "notionalFloor": "30000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/bitpanda.py` & `freqtrade-2023.6/freqtrade/exchange/bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/bittrex.py` & `freqtrade-2023.6/freqtrade/exchange/bittrex.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/bitvavo.py` & `freqtrade-2023.6/freqtrade/exchange/bitvavo.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/bybit.py` & `freqtrade-2023.6/freqtrade/exchange/bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/check_exchange.py` & `freqtrade-2023.6/freqtrade/exchange/check_exchange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/coinbasepro.py` & `freqtrade-2023.6/freqtrade/exchange/coinbasepro.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/common.py` & `freqtrade-2023.6/freqtrade/exchange/common.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/exchange.py` & `freqtrade-2023.6/freqtrade/exchange/exchange.py`

 * *Files 0% similar despite different names*

```diff
@@ -832,7412 +832,7455 @@
 000033f0: 656c 6629 202d 3e20 4c69 7374 5b73 7472  elf) -> List[str
 00003400: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
 00003410: 6e20 6c69 7374 2828 7365 6c66 2e5f 6170  n list((self._ap
 00003420: 692e 7469 6d65 6672 616d 6573 206f 7220  i.timeframes or 
 00003430: 7b7d 292e 6b65 7973 2829 290a 0a20 2020  {}).keys())..   
 00003440: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
 00003450: 6566 206d 6172 6b65 7473 2873 656c 6629  ef markets(self)
-00003460: 202d 3e20 4469 6374 3a0a 2020 2020 2020   -> Dict:.      
-00003470: 2020 2222 2265 7863 6861 6e67 6520 6363    """exchange cc
-00003480: 7874 206d 6172 6b65 7473 2222 220a 2020  xt markets""".  
-00003490: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-000034a0: 662e 5f6d 6172 6b65 7473 3a0a 2020 2020  f._markets:.    
-000034b0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-000034c0: 6e66 6f28 224d 6172 6b65 7473 2077 6572  nfo("Markets wer
-000034d0: 6520 6e6f 7420 6c6f 6164 6564 2e20 4c6f  e not loaded. Lo
-000034e0: 6164 696e 6720 7468 656d 206e 6f77 2e2e  ading them now..
-000034f0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-00003500: 656c 662e 5f6c 6f61 645f 6d61 726b 6574  elf._load_market
-00003510: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
-00003520: 726e 2073 656c 662e 5f6d 6172 6b65 7473  rn self._markets
-00003530: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00003540: 2020 2020 6465 6620 7072 6563 6973 696f      def precisio
-00003550: 6e4d 6f64 6528 7365 6c66 2920 2d3e 2069  nMode(self) -> i
-00003560: 6e74 3a0a 2020 2020 2020 2020 2222 2265  nt:.        """e
-00003570: 7863 6861 6e67 6520 6363 7874 2070 7265  xchange ccxt pre
-00003580: 6369 7369 6f6e 4d6f 6465 2222 220a 2020  cisionMode""".  
-00003590: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000035a0: 662e 5f61 7069 2e70 7265 6369 7369 6f6e  f._api.precision
-000035b0: 4d6f 6465 0a0a 2020 2020 6465 6620 6164  Mode..    def ad
-000035c0: 6469 7469 6f6e 616c 5f65 7863 6861 6e67  ditional_exchang
-000035d0: 655f 696e 6974 2873 656c 6629 202d 3e20  e_init(self) -> 
-000035e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000035f0: 220a 2020 2020 2020 2020 4164 6469 7469  ".        Additi
-00003600: 6f6e 616c 2065 7863 6861 6e67 6520 696e  onal exchange in
-00003610: 6974 6961 6c69 7a61 7469 6f6e 206c 6f67  itialization log
-00003620: 6963 2e0a 2020 2020 2020 2020 2e61 7069  ic..        .api
-00003630: 2077 696c 6c20 6265 2061 7661 696c 6162   will be availab
-00003640: 6c65 2061 7420 7468 6973 2070 6f69 6e74  le at this point
-00003650: 2e0a 2020 2020 2020 2020 4d75 7374 2062  ..        Must b
-00003660: 6520 6f76 6572 7269 6464 656e 2069 6e20  e overridden in 
-00003670: 6368 696c 6420 6d65 7468 6f64 7320 6966  child methods if
-00003680: 2072 6571 7569 7265 642e 0a20 2020 2020   required..     
-00003690: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-000036a0: 6173 730a 0a20 2020 2064 6566 205f 6c6f  ass..    def _lo
-000036b0: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
-000036c0: 6e73 6528 7365 6c66 2c20 656e 6470 6f69  nse(self, endpoi
-000036d0: 6e74 2c20 7265 7370 6f6e 7365 2920 2d3e  nt, response) ->
-000036e0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-000036f0: 2222 204c 6f67 2065 7863 6861 6e67 6520  "" Log exchange 
-00003700: 7265 7370 6f6e 7365 7320 2222 220a 2020  responses """.  
-00003710: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
-00003720: 675f 7265 7370 6f6e 7365 733a 0a20 2020  g_responses:.   
-00003730: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00003740: 696e 666f 2866 2241 5049 207b 656e 6470  info(f"API {endp
-00003750: 6f69 6e74 7d3a 207b 7265 7370 6f6e 7365  oint}: {response
-00003760: 7d22 290a 0a20 2020 2064 6566 206f 686c  }")..    def ohl
-00003770: 6376 5f63 616e 646c 655f 6c69 6d69 7428  cv_candle_limit(
-00003780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003790: 662c 2074 696d 6566 7261 6d65 3a20 7374  f, timeframe: st
-000037a0: 722c 2063 616e 646c 655f 7479 7065 3a20  r, candle_type: 
-000037b0: 4361 6e64 6c65 5479 7065 2c20 7369 6e63  CandleType, sinc
-000037c0: 655f 6d73 3a20 4f70 7469 6f6e 616c 5b69  e_ms: Optional[i
-000037d0: 6e74 5d20 3d20 4e6f 6e65 2920 2d3e 2069  nt] = None) -> i
-000037e0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
-000037f0: 2020 2020 2020 2020 4578 6368 616e 6765          Exchange
-00003800: 206f 686c 6376 2063 616e 646c 6520 6c69   ohlcv candle li
-00003810: 6d69 740a 2020 2020 2020 2020 5573 6573  mit.        Uses
-00003820: 206f 686c 6376 5f63 616e 646c 655f 6c69   ohlcv_candle_li
-00003830: 6d69 745f 7065 725f 7469 6d65 6672 616d  mit_per_timefram
-00003840: 6520 6966 2074 6865 2065 7863 6861 6e67  e if the exchang
-00003850: 6520 6861 7320 6469 6666 6572 656e 7420  e has different 
-00003860: 6c69 6d69 7473 0a20 2020 2020 2020 2070  limits.        p
-00003870: 6572 2074 696d 6566 7261 6d65 2028 652e  er timeframe (e.
-00003880: 672e 2062 6974 7472 6578 292c 206f 7468  g. bittrex), oth
-00003890: 6572 7769 7365 2066 616c 6c73 2062 6163  erwise falls bac
-000038a0: 6b20 746f 206f 686c 6376 5f63 616e 646c  k to ohlcv_candl
-000038b0: 655f 6c69 6d69 740a 2020 2020 2020 2020  e_limit.        
-000038c0: 3a70 6172 616d 2074 696d 6566 7261 6d65  :param timeframe
-000038d0: 3a20 5469 6d65 6672 616d 6520 746f 2063  : Timeframe to c
-000038e0: 6865 636b 0a20 2020 2020 2020 203a 7061  heck.        :pa
-000038f0: 7261 6d20 6361 6e64 6c65 5f74 7970 653a  ram candle_type:
-00003900: 2043 616e 646c 652d 7479 7065 0a20 2020   Candle-type.   
-00003910: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
-00003920: 655f 6d73 3a20 5374 6172 7469 6e67 2074  e_ms: Starting t
-00003930: 696d 6573 7461 6d70 0a20 2020 2020 2020  imestamp.       
-00003940: 203a 7265 7475 726e 3a20 4361 6e64 6c65   :return: Candle
-00003950: 206c 696d 6974 2061 7320 696e 7465 6765   limit as intege
-00003960: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
-00003970: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
-00003980: 2873 656c 662e 5f66 745f 6861 732e 6765  (self._ft_has.ge
-00003990: 7428 276f 686c 6376 5f63 616e 646c 655f  t('ohlcv_candle_
-000039a0: 6c69 6d69 745f 7065 725f 7469 6d65 6672  limit_per_timefr
-000039b0: 616d 6527 2c20 7b7d 292e 6765 7428 0a20  ame', {}).get(. 
-000039c0: 2020 2020 2020 2020 2020 2074 696d 6566             timef
-000039d0: 7261 6d65 2c20 7365 6c66 2e5f 6674 5f68  rame, self._ft_h
-000039e0: 6173 2e67 6574 2827 6f68 6c63 765f 6361  as.get('ohlcv_ca
-000039f0: 6e64 6c65 5f6c 696d 6974 2729 2929 0a0a  ndle_limit')))..
-00003a00: 2020 2020 6465 6620 6765 745f 6d61 726b      def get_mark
-00003a10: 6574 7328 7365 6c66 2c20 6261 7365 5f63  ets(self, base_c
-00003a20: 7572 7265 6e63 6965 733a 204c 6973 745b  urrencies: List[
-00003a30: 7374 725d 203d 205b 5d2c 2071 756f 7465  str] = [], quote
-00003a40: 5f63 7572 7265 6e63 6965 733a 204c 6973  _currencies: Lis
-00003a50: 745b 7374 725d 203d 205b 5d2c 0a20 2020  t[str] = [],.   
-00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a70: 2073 706f 745f 6f6e 6c79 3a20 626f 6f6c   spot_only: bool
-00003a80: 203d 2046 616c 7365 2c20 6d61 7267 696e   = False, margin
-00003a90: 5f6f 6e6c 793a 2062 6f6f 6c20 3d20 4661  _only: bool = Fa
-00003aa0: 6c73 652c 2066 7574 7572 6573 5f6f 6e6c  lse, futures_onl
-00003ab0: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
-00003ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ad0: 2020 2020 2074 7261 6461 626c 655f 6f6e       tradable_on
-00003ae0: 6c79 3a20 626f 6f6c 203d 2054 7275 652c  ly: bool = True,
-00003af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003b00: 2020 2020 2061 6374 6976 655f 6f6e 6c79       active_only
-00003b10: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
-00003b20: 2d3e 2044 6963 745b 7374 722c 2041 6e79  -> Dict[str, Any
-00003b30: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-00003b40: 2020 2020 2020 2052 6574 7572 6e20 6578         Return ex
-00003b50: 6368 616e 6765 2063 6378 7420 6d61 726b  change ccxt mark
-00003b60: 6574 732c 2066 696c 7465 7265 6420 6f75  ets, filtered ou
-00003b70: 7420 6279 2062 6173 6520 6375 7272 656e  t by base curren
-00003b80: 6379 2061 6e64 2071 756f 7465 2063 7572  cy and quote cur
-00003b90: 7265 6e63 790a 2020 2020 2020 2020 6966  rency.        if
-00003ba0: 2074 6869 7320 7761 7320 7265 7175 6573   this was reques
-00003bb0: 7465 6420 696e 2070 6172 616d 6574 6572  ted in parameter
-00003bc0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00003bd0: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
-00003be0: 2073 656c 662e 6d61 726b 6574 730a 2020   self.markets.  
-00003bf0: 2020 2020 2020 6966 206e 6f74 206d 6172        if not mar
-00003c00: 6b65 7473 3a0a 2020 2020 2020 2020 2020  kets:.          
-00003c10: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00003c20: 6e61 6c45 7863 6570 7469 6f6e 2822 4d61  nalException("Ma
-00003c30: 726b 6574 7320 7765 7265 206e 6f74 206c  rkets were not l
-00003c40: 6f61 6465 642e 2229 0a0a 2020 2020 2020  oaded.")..      
-00003c50: 2020 6966 2062 6173 655f 6375 7272 656e    if base_curren
-00003c60: 6369 6573 3a0a 2020 2020 2020 2020 2020  cies:.          
-00003c70: 2020 6d61 726b 6574 7320 3d20 7b6b 3a20    markets = {k: 
-00003c80: 7620 666f 7220 6b2c 2076 2069 6e20 6d61  v for k, v in ma
-00003c90: 726b 6574 732e 6974 656d 7328 2920 6966  rkets.items() if
-00003ca0: 2076 5b27 6261 7365 275d 2069 6e20 6261   v['base'] in ba
-00003cb0: 7365 5f63 7572 7265 6e63 6965 737d 0a20  se_currencies}. 
-00003cc0: 2020 2020 2020 2069 6620 7175 6f74 655f         if quote_
-00003cd0: 6375 7272 656e 6369 6573 3a0a 2020 2020  currencies:.    
-00003ce0: 2020 2020 2020 2020 6d61 726b 6574 7320          markets 
-00003cf0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
-00003d00: 2069 6e20 6d61 726b 6574 732e 6974 656d   in markets.item
-00003d10: 7328 2920 6966 2076 5b27 7175 6f74 6527  s() if v['quote'
-00003d20: 5d20 696e 2071 756f 7465 5f63 7572 7265  ] in quote_curre
-00003d30: 6e63 6965 737d 0a20 2020 2020 2020 2069  ncies}.        i
-00003d40: 6620 7472 6164 6162 6c65 5f6f 6e6c 793a  f tradable_only:
-00003d50: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
-00003d60: 6b65 7473 203d 207b 6b3a 2076 2066 6f72  kets = {k: v for
-00003d70: 206b 2c20 7620 696e 206d 6172 6b65 7473   k, v in markets
-00003d80: 2e69 7465 6d73 2829 2069 6620 7365 6c66  .items() if self
-00003d90: 2e6d 6172 6b65 745f 6973 5f74 7261 6461  .market_is_trada
-00003da0: 626c 6528 7629 7d0a 2020 2020 2020 2020  ble(v)}.        
-00003db0: 6966 2073 706f 745f 6f6e 6c79 3a0a 2020  if spot_only:.  
-00003dc0: 2020 2020 2020 2020 2020 6d61 726b 6574            market
-00003dd0: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
-00003de0: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
-00003df0: 656d 7328 2920 6966 2073 656c 662e 6d61  ems() if self.ma
-00003e00: 726b 6574 5f69 735f 7370 6f74 2876 297d  rket_is_spot(v)}
-00003e10: 0a20 2020 2020 2020 2069 6620 6d61 7267  .        if marg
-00003e20: 696e 5f6f 6e6c 793a 0a20 2020 2020 2020  in_only:.       
-00003e30: 2020 2020 206d 6172 6b65 7473 203d 207b       markets = {
-00003e40: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
-00003e50: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
-00003e60: 2069 6620 7365 6c66 2e6d 6172 6b65 745f   if self.market_
-00003e70: 6973 5f6d 6172 6769 6e28 7629 7d0a 2020  is_margin(v)}.  
-00003e80: 2020 2020 2020 6966 2066 7574 7572 6573        if futures
-00003e90: 5f6f 6e6c 793a 0a20 2020 2020 2020 2020  _only:.         
-00003ea0: 2020 206d 6172 6b65 7473 203d 207b 6b3a     markets = {k:
-00003eb0: 2076 2066 6f72 206b 2c20 7620 696e 206d   v for k, v in m
-00003ec0: 6172 6b65 7473 2e69 7465 6d73 2829 2069  arkets.items() i
-00003ed0: 6620 7365 6c66 2e6d 6172 6b65 745f 6973  f self.market_is
-00003ee0: 5f66 7574 7572 6528 7629 7d0a 2020 2020  _future(v)}.    
-00003ef0: 2020 2020 6966 2061 6374 6976 655f 6f6e      if active_on
-00003f00: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-00003f10: 6d61 726b 6574 7320 3d20 7b6b 3a20 7620  markets = {k: v 
-00003f20: 666f 7220 6b2c 2076 2069 6e20 6d61 726b  for k, v in mark
-00003f30: 6574 732e 6974 656d 7328 2920 6966 206d  ets.items() if m
-00003f40: 6172 6b65 745f 6973 5f61 6374 6976 6528  arket_is_active(
-00003f50: 7629 7d0a 2020 2020 2020 2020 7265 7475  v)}.        retu
-00003f60: 726e 206d 6172 6b65 7473 0a0a 2020 2020  rn markets..    
-00003f70: 6465 6620 6765 745f 7175 6f74 655f 6375  def get_quote_cu
-00003f80: 7272 656e 6369 6573 2873 656c 6629 202d  rrencies(self) -
-00003f90: 3e20 4c69 7374 5b73 7472 5d3a 0a20 2020  > List[str]:.   
-00003fa0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003fb0: 2052 6574 7572 6e20 6120 6c69 7374 206f   Return a list o
-00003fc0: 6620 7375 7070 6f72 7465 6420 7175 6f74  f supported quot
-00003fd0: 6520 6375 7272 656e 6369 6573 0a20 2020  e currencies.   
-00003fe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003ff0: 206d 6172 6b65 7473 203d 2073 656c 662e   markets = self.
-00004000: 6d61 726b 6574 730a 2020 2020 2020 2020  markets.        
-00004010: 7265 7475 726e 2073 6f72 7465 6428 7365  return sorted(se
-00004020: 7428 5b78 5b27 7175 6f74 6527 5d20 666f  t([x['quote'] fo
-00004030: 7220 5f2c 2078 2069 6e20 6d61 726b 6574  r _, x in market
-00004040: 732e 6974 656d 7328 295d 2929 0a0a 2020  s.items()]))..  
-00004050: 2020 6465 6620 6765 745f 7061 6972 5f71    def get_pair_q
-00004060: 756f 7465 5f63 7572 7265 6e63 7928 7365  uote_currency(se
-00004070: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
-00004080: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
-00004090: 2222 2052 6574 7572 6e20 6120 7061 6972  "" Return a pair
-000040a0: 2773 2071 756f 7465 2063 7572 7265 6e63  's quote currenc
-000040b0: 7920 2862 6173 652f 7175 6f74 653a 7365  y (base/quote:se
-000040c0: 7474 6c65 6d65 6e74 2920 2222 220a 2020  ttlement) """.  
-000040d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000040e0: 662e 6d61 726b 6574 732e 6765 7428 7061  f.markets.get(pa
-000040f0: 6972 2c20 7b7d 292e 6765 7428 2771 756f  ir, {}).get('quo
-00004100: 7465 272c 2027 2729 0a0a 2020 2020 6465  te', '')..    de
-00004110: 6620 6765 745f 7061 6972 5f62 6173 655f  f get_pair_base_
-00004120: 6375 7272 656e 6379 2873 656c 662c 2070  currency(self, p
-00004130: 6169 723a 2073 7472 2920 2d3e 2073 7472  air: str) -> str
-00004140: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-00004150: 7475 726e 2061 2070 6169 7227 7320 6261  turn a pair's ba
-00004160: 7365 2063 7572 7265 6e63 7920 2862 6173  se currency (bas
-00004170: 652f 7175 6f74 653a 7365 7474 6c65 6d65  e/quote:settleme
-00004180: 6e74 2920 2222 220a 2020 2020 2020 2020  nt) """.        
-00004190: 7265 7475 726e 2073 656c 662e 6d61 726b  return self.mark
-000041a0: 6574 732e 6765 7428 7061 6972 2c20 7b7d  ets.get(pair, {}
-000041b0: 292e 6765 7428 2762 6173 6527 2c20 2727  ).get('base', ''
-000041c0: 290a 0a20 2020 2064 6566 206d 6172 6b65  )..    def marke
-000041d0: 745f 6973 5f66 7574 7572 6528 7365 6c66  t_is_future(self
-000041e0: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
-000041f0: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
-00004200: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
-00004210: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00004220: 6d61 726b 6574 2e67 6574 2873 656c 662e  market.get(self.
-00004230: 5f66 745f 6861 735b 2263 6378 745f 6675  _ft_has["ccxt_fu
-00004240: 7475 7265 735f 6e61 6d65 225d 2c20 4661  tures_name"], Fa
-00004250: 6c73 6529 2069 7320 5472 7565 2061 6e64  lse) is True and
-00004260: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
-00004270: 6b65 742e 6765 7428 276c 696e 6561 7227  ket.get('linear'
-00004280: 2c20 4661 6c73 6529 2069 7320 5472 7565  , False) is True
-00004290: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-000042a0: 6465 6620 6d61 726b 6574 5f69 735f 7370  def market_is_sp
-000042b0: 6f74 2873 656c 662c 206d 6172 6b65 743a  ot(self, market:
-000042c0: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
-000042d0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-000042e0: 2020 7265 7475 726e 206d 6172 6b65 742e    return market.
-000042f0: 6765 7428 2773 706f 7427 2c20 4661 6c73  get('spot', Fals
-00004300: 6529 2069 7320 5472 7565 0a0a 2020 2020  e) is True..    
-00004310: 6465 6620 6d61 726b 6574 5f69 735f 6d61  def market_is_ma
-00004320: 7267 696e 2873 656c 662c 206d 6172 6b65  rgin(self, marke
-00004330: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
-00004340: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
-00004350: 2020 2020 7265 7475 726e 206d 6172 6b65      return marke
-00004360: 742e 6765 7428 276d 6172 6769 6e27 2c20  t.get('margin', 
-00004370: 4661 6c73 6529 2069 7320 5472 7565 0a0a  False) is True..
-00004380: 2020 2020 6465 6620 6d61 726b 6574 5f69      def market_i
-00004390: 735f 7472 6164 6162 6c65 2873 656c 662c  s_tradable(self,
-000043a0: 206d 6172 6b65 743a 2044 6963 745b 7374   market: Dict[st
-000043b0: 722c 2041 6e79 5d29 202d 3e20 626f 6f6c  r, Any]) -> bool
-000043c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000043d0: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
-000043e0: 6865 206d 6172 6b65 7420 7379 6d62 6f6c  he market symbol
-000043f0: 2069 7320 7472 6164 6162 6c65 2062 7920   is tradable by 
-00004400: 4672 6571 7472 6164 652e 0a20 2020 2020  Freqtrade..     
-00004410: 2020 2045 6e73 7572 6573 2074 6861 7420     Ensures that 
-00004420: 436f 6e66 6967 7572 6564 206d 6f64 6520  Configured mode 
-00004430: 616c 6967 6e73 2074 6f0a 2020 2020 2020  aligns to.      
-00004440: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00004450: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
-00004460: 2020 206d 6172 6b65 742e 6765 7428 2771     market.get('q
-00004470: 756f 7465 272c 204e 6f6e 6529 2069 7320  uote', None) is 
-00004480: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
-00004490: 2020 2020 2061 6e64 206d 6172 6b65 742e       and market.
-000044a0: 6765 7428 2762 6173 6527 2c20 4e6f 6e65  get('base', None
-000044b0: 2920 6973 206e 6f74 204e 6f6e 650a 2020  ) is not None.  
-000044c0: 2020 2020 2020 2020 2020 616e 6420 2873            and (s
-000044d0: 656c 662e 7072 6563 6973 696f 6e4d 6f64  elf.precisionMod
-000044e0: 6520 213d 2054 4943 4b5f 5349 5a45 0a20  e != TICK_SIZE. 
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2320 546f 6f20 6c6f 7720 7072 6563 6973  # Too low precis
-00004510: 696f 6e20 7769 6c6c 2066 616c 7369 6679  ion will falsify
-00004520: 2063 616c 6375 6c61 7469 6f6e 730a 2020   calculations.  
-00004530: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00004540: 7220 6d61 726b 6574 2e67 6574 2827 7072  r market.get('pr
-00004550: 6563 6973 696f 6e27 2c20 7b7d 292e 6765  ecision', {}).ge
-00004560: 7428 2770 7269 6365 2729 203e 2031 652d  t('price') > 1e-
-00004570: 3131 290a 2020 2020 2020 2020 2020 2020  11).            
-00004580: 616e 6420 2828 7365 6c66 2e74 7261 6469  and ((self.tradi
-00004590: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
-000045a0: 6e67 4d6f 6465 2e53 504f 5420 616e 6420  ngMode.SPOT and 
-000045b0: 7365 6c66 2e6d 6172 6b65 745f 6973 5f73  self.market_is_s
-000045c0: 706f 7428 6d61 726b 6574 2929 0a20 2020  pot(market)).   
-000045d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-000045e0: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
-000045f0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-00004600: 6465 2e4d 4152 4749 4e20 616e 6420 7365  de.MARGIN and se
-00004610: 6c66 2e6d 6172 6b65 745f 6973 5f6d 6172  lf.market_is_mar
-00004620: 6769 6e28 6d61 726b 6574 2929 0a20 2020  gin(market)).   
-00004630: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00004640: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
-00004650: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-00004660: 6465 2e46 5554 5552 4553 2061 6e64 2073  de.FUTURES and s
-00004670: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
-00004680: 7475 7265 286d 6172 6b65 7429 2929 0a20  ture(market))). 
-00004690: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-000046a0: 6620 6b6c 696e 6573 2873 656c 662c 2070  f klines(self, p
-000046b0: 6169 725f 696e 7465 7276 616c 3a20 5061  air_interval: Pa
-000046c0: 6972 5769 7468 5469 6d65 6672 616d 652c  irWithTimeframe,
-000046d0: 2063 6f70 793a 2062 6f6f 6c20 3d20 5472   copy: bool = Tr
-000046e0: 7565 2920 2d3e 2044 6174 6146 7261 6d65  ue) -> DataFrame
-000046f0: 3a0a 2020 2020 2020 2020 6966 2070 6169  :.        if pai
-00004700: 725f 696e 7465 7276 616c 2069 6e20 7365  r_interval in se
-00004710: 6c66 2e5f 6b6c 696e 6573 3a0a 2020 2020  lf._klines:.    
-00004720: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00004730: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
-00004740: 5f69 6e74 6572 7661 6c5d 2e63 6f70 7928  _interval].copy(
-00004750: 2920 6966 2063 6f70 7920 656c 7365 2073  ) if copy else s
-00004760: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
-00004770: 5f69 6e74 6572 7661 6c5d 0a20 2020 2020  _interval].     
-00004780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00004790: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
-000047a0: 4672 616d 6528 290a 0a20 2020 2064 6566  Frame()..    def
-000047b0: 2067 6574 5f63 6f6e 7472 6163 745f 7369   get_contract_si
-000047c0: 7a65 2873 656c 662c 2070 6169 723a 2073  ze(self, pair: s
-000047d0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
-000047e0: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
-000047f0: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
-00004800: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
-00004810: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
-00004820: 2020 2020 2020 2020 206d 6172 6b65 7420           market 
-00004830: 3d20 7365 6c66 2e6d 6172 6b65 7473 2e67  = self.markets.g
-00004840: 6574 2870 6169 722c 207b 7d29 0a20 2020  et(pair, {}).   
-00004850: 2020 2020 2020 2020 2063 6f6e 7472 6163           contrac
-00004860: 745f 7369 7a65 3a20 666c 6f61 7420 3d20  t_size: float = 
-00004870: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
-00004880: 6966 206e 6f74 206d 6172 6b65 743a 0a20  if not market:. 
-00004890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000048a0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-000048b0: 2020 2020 2020 2069 6620 6d61 726b 6574         if market
-000048c0: 2e67 6574 2827 636f 6e74 7261 6374 5369  .get('contractSi
-000048d0: 7a65 2729 2069 7320 6e6f 7420 4e6f 6e65  ze') is not None
-000048e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000048f0: 2020 2320 6363 7874 2068 6173 2063 6f6e    # ccxt has con
-00004900: 7472 6163 7453 697a 6520 696e 206d 6172  tractSize in mar
-00004910: 6b65 7473 2061 7320 7374 7269 6e67 0a20  kets as string. 
-00004920: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00004930: 6f6e 7472 6163 745f 7369 7a65 203d 2066  ontract_size = f
-00004940: 6c6f 6174 286d 6172 6b65 745b 2763 6f6e  loat(market['con
-00004950: 7472 6163 7453 697a 6527 5d29 0a20 2020  tractSize']).   
-00004960: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004970: 636f 6e74 7261 6374 5f73 697a 650a 2020  contract_size.  
-00004980: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00004990: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
-000049a0: 0a0a 2020 2020 6465 6620 5f74 7261 6465  ..    def _trade
-000049b0: 735f 636f 6e74 7261 6374 735f 746f 5f61  s_contracts_to_a
-000049c0: 6d6f 756e 7428 7365 6c66 2c20 7472 6164  mount(self, trad
-000049d0: 6573 3a20 4c69 7374 2920 2d3e 204c 6973  es: List) -> Lis
-000049e0: 743a 0a20 2020 2020 2020 2069 6620 6c65  t:.        if le
-000049f0: 6e28 7472 6164 6573 2920 3e20 3020 616e  n(trades) > 0 an
-00004a00: 6420 2773 796d 626f 6c27 2069 6e20 7472  d 'symbol' in tr
-00004a10: 6164 6573 5b30 5d3a 0a20 2020 2020 2020  ades[0]:.       
-00004a20: 2020 2020 2063 6f6e 7472 6163 745f 7369       contract_si
-00004a30: 7a65 203d 2073 656c 662e 6765 745f 636f  ze = self.get_co
-00004a40: 6e74 7261 6374 5f73 697a 6528 7472 6164  ntract_size(trad
-00004a50: 6573 5b30 5d5b 2773 796d 626f 6c27 5d29  es[0]['symbol'])
-00004a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004a70: 636f 6e74 7261 6374 5f73 697a 6520 213d  contract_size !=
-00004a80: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00004a90: 2020 2020 666f 7220 7472 6164 6520 696e      for trade in
-00004aa0: 2074 7261 6465 733a 0a20 2020 2020 2020   trades:.       
-00004ab0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-00004ac0: 6465 5b27 616d 6f75 6e74 275d 203d 2074  de['amount'] = t
-00004ad0: 7261 6465 5b27 616d 6f75 6e74 275d 202a  rade['amount'] *
-00004ae0: 2063 6f6e 7472 6163 745f 7369 7a65 0a20   contract_size. 
-00004af0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
-00004b00: 6164 6573 0a0a 2020 2020 6465 6620 5f6f  ades..    def _o
-00004b10: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
-00004b20: 6f5f 616d 6f75 6e74 2873 656c 662c 206f  o_amount(self, o
-00004b30: 7264 6572 3a20 4469 6374 2920 2d3e 2044  rder: Dict) -> D
-00004b40: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
-00004b50: 2773 796d 626f 6c27 2069 6e20 6f72 6465  'symbol' in orde
-00004b60: 7220 616e 6420 6f72 6465 725b 2773 796d  r and order['sym
-00004b70: 626f 6c27 5d20 6973 206e 6f74 204e 6f6e  bol'] is not Non
-00004b80: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00004b90: 6f6e 7472 6163 745f 7369 7a65 203d 2073  ontract_size = s
-00004ba0: 656c 662e 6765 745f 636f 6e74 7261 6374  elf.get_contract
-00004bb0: 5f73 697a 6528 6f72 6465 725b 2773 796d  _size(order['sym
-00004bc0: 626f 6c27 5d29 0a20 2020 2020 2020 2020  bol']).         
-00004bd0: 2020 2069 6620 636f 6e74 7261 6374 5f73     if contract_s
-00004be0: 697a 6520 213d 2031 3a0a 2020 2020 2020  ize != 1:.      
-00004bf0: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
-00004c00: 6f70 2069 6e20 7365 6c66 2e5f 6674 5f68  op in self._ft_h
-00004c10: 6173 2e67 6574 2827 6f72 6465 725f 7072  as.get('order_pr
-00004c20: 6f70 735f 696e 5f63 6f6e 7472 6163 7473  ops_in_contracts
-00004c30: 272c 205b 5d29 3a0a 2020 2020 2020 2020  ', []):.        
-00004c40: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00004c50: 726f 7020 696e 206f 7264 6572 2061 6e64  rop in order and
-00004c60: 206f 7264 6572 5b70 726f 705d 2069 7320   order[prop] is 
-00004c70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00004c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c90: 2020 6f72 6465 725b 7072 6f70 5d20 3d20    order[prop] = 
-00004ca0: 6f72 6465 725b 7072 6f70 5d20 2a20 636f  order[prop] * co
-00004cb0: 6e74 7261 6374 5f73 697a 650a 2020 2020  ntract_size.    
-00004cc0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
-00004cd0: 0a0a 2020 2020 6465 6620 5f61 6d6f 756e  ..    def _amoun
-00004ce0: 745f 746f 5f63 6f6e 7472 6163 7473 2873  t_to_contracts(s
-00004cf0: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
-00004d00: 616d 6f75 6e74 3a20 666c 6f61 7429 202d  amount: float) -
-00004d10: 3e20 666c 6f61 743a 0a0a 2020 2020 2020  > float:..      
-00004d20: 2020 636f 6e74 7261 6374 5f73 697a 6520    contract_size 
-00004d30: 3d20 7365 6c66 2e67 6574 5f63 6f6e 7472  = self.get_contr
-00004d40: 6163 745f 7369 7a65 2870 6169 7229 0a20  act_size(pair). 
-00004d50: 2020 2020 2020 2072 6574 7572 6e20 616d         return am
-00004d60: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
-00004d70: 7328 616d 6f75 6e74 2c20 636f 6e74 7261  s(amount, contra
-00004d80: 6374 5f73 697a 6529 0a0a 2020 2020 6465  ct_size)..    de
-00004d90: 6620 5f63 6f6e 7472 6163 7473 5f74 6f5f  f _contracts_to_
-00004da0: 616d 6f75 6e74 2873 656c 662c 2070 6169  amount(self, pai
-00004db0: 723a 2073 7472 2c20 6e75 6d5f 636f 6e74  r: str, num_cont
-00004dc0: 7261 6374 733a 2066 6c6f 6174 2920 2d3e  racts: float) ->
-00004dd0: 2066 6c6f 6174 3a0a 0a20 2020 2020 2020   float:..       
-00004de0: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
-00004df0: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
-00004e00: 6374 5f73 697a 6528 7061 6972 290a 2020  ct_size(pair).  
-00004e10: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
-00004e20: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
-00004e30: 286e 756d 5f63 6f6e 7472 6163 7473 2c20  (num_contracts, 
-00004e40: 636f 6e74 7261 6374 5f73 697a 6529 0a0a  contract_size)..
-00004e50: 2020 2020 6465 6620 616d 6f75 6e74 5f74      def amount_t
-00004e60: 6f5f 636f 6e74 7261 6374 5f70 7265 6369  o_contract_preci
-00004e70: 7369 6f6e 2873 656c 662c 2070 6169 723a  sion(self, pair:
-00004e80: 2073 7472 2c20 616d 6f75 6e74 3a20 666c   str, amount: fl
-00004e90: 6f61 7429 202d 3e20 666c 6f61 743a 0a20  oat) -> float:. 
-00004ea0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004eb0: 2020 2048 656c 7065 7220 7772 6170 7065     Helper wrappe
-00004ec0: 7220 6172 6f75 6e64 2061 6d6f 756e 745f  r around amount_
-00004ed0: 746f 5f63 6f6e 7472 6163 745f 7072 6563  to_contract_prec
-00004ee0: 6973 696f 6e0a 2020 2020 2020 2020 2222  ision.        ""
-00004ef0: 220a 2020 2020 2020 2020 636f 6e74 7261  ".        contra
-00004f00: 6374 5f73 697a 6520 3d20 7365 6c66 2e67  ct_size = self.g
-00004f10: 6574 5f63 6f6e 7472 6163 745f 7369 7a65  et_contract_size
-00004f20: 2870 6169 7229 0a0a 2020 2020 2020 2020  (pair)..        
-00004f30: 7265 7475 726e 2061 6d6f 756e 745f 746f  return amount_to
-00004f40: 5f63 6f6e 7472 6163 745f 7072 6563 6973  _contract_precis
-00004f50: 696f 6e28 616d 6f75 6e74 2c20 7365 6c66  ion(amount, self
-00004f60: 2e67 6574 5f70 7265 6369 7369 6f6e 5f61  .get_precision_a
-00004f70: 6d6f 756e 7428 7061 6972 292c 0a20 2020  mount(pair),.   
-00004f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003460: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
+00003470: 795d 3a0a 2020 2020 2020 2020 2222 2265  y]:.        """e
+00003480: 7863 6861 6e67 6520 6363 7874 206d 6172  xchange ccxt mar
+00003490: 6b65 7473 2222 220a 2020 2020 2020 2020  kets""".        
+000034a0: 6966 206e 6f74 2073 656c 662e 5f6d 6172  if not self._mar
+000034b0: 6b65 7473 3a0a 2020 2020 2020 2020 2020  kets:.          
+000034c0: 2020 6c6f 6767 6572 2e69 6e66 6f28 224d    logger.info("M
+000034d0: 6172 6b65 7473 2077 6572 6520 6e6f 7420  arkets were not 
+000034e0: 6c6f 6164 6564 2e20 4c6f 6164 696e 6720  loaded. Loading 
+000034f0: 7468 656d 206e 6f77 2e2e 2229 0a20 2020  them now..").   
+00003500: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+00003510: 6f61 645f 6d61 726b 6574 7328 290a 2020  oad_markets().  
+00003520: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00003530: 662e 5f6d 6172 6b65 7473 0a0a 2020 2020  f._markets..    
+00003540: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00003550: 6620 7072 6563 6973 696f 6e4d 6f64 6528  f precisionMode(
+00003560: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
+00003570: 2020 2020 2020 2222 2265 7863 6861 6e67        """exchang
+00003580: 6520 6363 7874 2070 7265 6369 7369 6f6e  e ccxt precision
+00003590: 4d6f 6465 2222 220a 2020 2020 2020 2020  Mode""".        
+000035a0: 7265 7475 726e 2073 656c 662e 5f61 7069  return self._api
+000035b0: 2e70 7265 6369 7369 6f6e 4d6f 6465 0a0a  .precisionMode..
+000035c0: 2020 2020 6465 6620 6164 6469 7469 6f6e      def addition
+000035d0: 616c 5f65 7863 6861 6e67 655f 696e 6974  al_exchange_init
+000035e0: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+000035f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003600: 2020 2020 4164 6469 7469 6f6e 616c 2065      Additional e
+00003610: 7863 6861 6e67 6520 696e 6974 6961 6c69  xchange initiali
+00003620: 7a61 7469 6f6e 206c 6f67 6963 2e0a 2020  zation logic..  
+00003630: 2020 2020 2020 2e61 7069 2077 696c 6c20        .api will 
+00003640: 6265 2061 7661 696c 6162 6c65 2061 7420  be available at 
+00003650: 7468 6973 2070 6f69 6e74 2e0a 2020 2020  this point..    
+00003660: 2020 2020 4d75 7374 2062 6520 6f76 6572      Must be over
+00003670: 7269 6464 656e 2069 6e20 6368 696c 6420  ridden in child 
+00003680: 6d65 7468 6f64 7320 6966 2072 6571 7569  methods if requi
+00003690: 7265 642e 0a20 2020 2020 2020 2022 2222  red..        """
+000036a0: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
+000036b0: 2020 2064 6566 205f 6c6f 675f 6578 6368     def _log_exch
+000036c0: 616e 6765 5f72 6573 706f 6e73 6528 7365  ange_response(se
+000036d0: 6c66 2c20 656e 6470 6f69 6e74 2c20 7265  lf, endpoint, re
+000036e0: 7370 6f6e 7365 2920 2d3e 204e 6f6e 653a  sponse) -> None:
+000036f0: 0a20 2020 2020 2020 2022 2222 204c 6f67  .        """ Log
+00003700: 2065 7863 6861 6e67 6520 7265 7370 6f6e   exchange respon
+00003710: 7365 7320 2222 220a 2020 2020 2020 2020  ses """.        
+00003720: 6966 2073 656c 662e 6c6f 675f 7265 7370  if self.log_resp
+00003730: 6f6e 7365 733a 0a20 2020 2020 2020 2020  onses:.         
+00003740: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
+00003750: 2241 5049 207b 656e 6470 6f69 6e74 7d3a  "API {endpoint}:
+00003760: 207b 7265 7370 6f6e 7365 7d22 290a 0a20   {response}").. 
+00003770: 2020 2064 6566 206f 686c 6376 5f63 616e     def ohlcv_can
+00003780: 646c 655f 6c69 6d69 7428 0a20 2020 2020  dle_limit(.     
+00003790: 2020 2020 2020 2073 656c 662c 2074 696d         self, tim
+000037a0: 6566 7261 6d65 3a20 7374 722c 2063 616e  eframe: str, can
+000037b0: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
+000037c0: 5479 7065 2c20 7369 6e63 655f 6d73 3a20  Type, since_ms: 
+000037d0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+000037e0: 4e6f 6e65 2920 2d3e 2069 6e74 3a0a 2020  None) -> int:.  
+000037f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003800: 2020 4578 6368 616e 6765 206f 686c 6376    Exchange ohlcv
+00003810: 2063 616e 646c 6520 6c69 6d69 740a 2020   candle limit.  
+00003820: 2020 2020 2020 5573 6573 206f 686c 6376        Uses ohlcv
+00003830: 5f63 616e 646c 655f 6c69 6d69 745f 7065  _candle_limit_pe
+00003840: 725f 7469 6d65 6672 616d 6520 6966 2074  r_timeframe if t
+00003850: 6865 2065 7863 6861 6e67 6520 6861 7320  he exchange has 
+00003860: 6469 6666 6572 656e 7420 6c69 6d69 7473  different limits
+00003870: 0a20 2020 2020 2020 2070 6572 2074 696d  .        per tim
+00003880: 6566 7261 6d65 2028 652e 672e 2062 6974  eframe (e.g. bit
+00003890: 7472 6578 292c 206f 7468 6572 7769 7365  trex), otherwise
+000038a0: 2066 616c 6c73 2062 6163 6b20 746f 206f   falls back to o
+000038b0: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
+000038c0: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+000038d0: 2074 696d 6566 7261 6d65 3a20 5469 6d65   timeframe: Time
+000038e0: 6672 616d 6520 746f 2063 6865 636b 0a20  frame to check. 
+000038f0: 2020 2020 2020 203a 7061 7261 6d20 6361         :param ca
+00003900: 6e64 6c65 5f74 7970 653a 2043 616e 646c  ndle_type: Candl
+00003910: 652d 7479 7065 0a20 2020 2020 2020 203a  e-type.        :
+00003920: 7061 7261 6d20 7369 6e63 655f 6d73 3a20  param since_ms: 
+00003930: 5374 6172 7469 6e67 2074 696d 6573 7461  Starting timesta
+00003940: 6d70 0a20 2020 2020 2020 203a 7265 7475  mp.        :retu
+00003950: 726e 3a20 4361 6e64 6c65 206c 696d 6974  rn: Candle limit
+00003960: 2061 7320 696e 7465 6765 720a 2020 2020   as integer.    
+00003970: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003980: 7265 7475 726e 2069 6e74 2873 656c 662e  return int(self.
+00003990: 5f66 745f 6861 732e 6765 7428 276f 686c  _ft_has.get('ohl
+000039a0: 6376 5f63 616e 646c 655f 6c69 6d69 745f  cv_candle_limit_
+000039b0: 7065 725f 7469 6d65 6672 616d 6527 2c20  per_timeframe', 
+000039c0: 7b7d 292e 6765 7428 0a20 2020 2020 2020  {}).get(.       
+000039d0: 2020 2020 2074 696d 6566 7261 6d65 2c20       timeframe, 
+000039e0: 7365 6c66 2e5f 6674 5f68 6173 2e67 6574  self._ft_has.get
+000039f0: 2827 6f68 6c63 765f 6361 6e64 6c65 5f6c  ('ohlcv_candle_l
+00003a00: 696d 6974 2729 2929 0a0a 2020 2020 6465  imit')))..    de
+00003a10: 6620 6765 745f 6d61 726b 6574 7328 7365  f get_markets(se
+00003a20: 6c66 2c20 6261 7365 5f63 7572 7265 6e63  lf, base_currenc
+00003a30: 6965 733a 204c 6973 745b 7374 725d 203d  ies: List[str] =
+00003a40: 205b 5d2c 2071 756f 7465 5f63 7572 7265   [], quote_curre
+00003a50: 6e63 6965 733a 204c 6973 745b 7374 725d  ncies: List[str]
+00003a60: 203d 205b 5d2c 0a20 2020 2020 2020 2020   = [],.         
+00003a70: 2020 2020 2020 2020 2020 2073 706f 745f             spot_
+00003a80: 6f6e 6c79 3a20 626f 6f6c 203d 2046 616c  only: bool = Fal
+00003a90: 7365 2c20 6d61 7267 696e 5f6f 6e6c 793a  se, margin_only:
+00003aa0: 2062 6f6f 6c20 3d20 4661 6c73 652c 2066   bool = False, f
+00003ab0: 7574 7572 6573 5f6f 6e6c 793a 2062 6f6f  utures_only: boo
+00003ac0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00003ae0: 7261 6461 626c 655f 6f6e 6c79 3a20 626f  radable_only: bo
+00003af0: 6f6c 203d 2054 7275 652c 0a20 2020 2020  ol = True,.     
+00003b00: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00003b10: 6374 6976 655f 6f6e 6c79 3a20 626f 6f6c  ctive_only: bool
+00003b20: 203d 2046 616c 7365 2920 2d3e 2044 6963   = False) -> Dic
+00003b30: 745b 7374 722c 2041 6e79 5d3a 0a20 2020  t[str, Any]:.   
+00003b40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003b50: 2052 6574 7572 6e20 6578 6368 616e 6765   Return exchange
+00003b60: 2063 6378 7420 6d61 726b 6574 732c 2066   ccxt markets, f
+00003b70: 696c 7465 7265 6420 6f75 7420 6279 2062  iltered out by b
+00003b80: 6173 6520 6375 7272 656e 6379 2061 6e64  ase currency and
+00003b90: 2071 756f 7465 2063 7572 7265 6e63 790a   quote currency.
+00003ba0: 2020 2020 2020 2020 6966 2074 6869 7320          if this 
+00003bb0: 7761 7320 7265 7175 6573 7465 6420 696e  was requested in
+00003bc0: 2070 6172 616d 6574 6572 732e 0a20 2020   parameters..   
+00003bd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003be0: 206d 6172 6b65 7473 203d 2073 656c 662e   markets = self.
+00003bf0: 6d61 726b 6574 730a 2020 2020 2020 2020  markets.        
+00003c00: 6966 206e 6f74 206d 6172 6b65 7473 3a0a  if not markets:.
+00003c10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00003c20: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00003c30: 6570 7469 6f6e 2822 4d61 726b 6574 7320  eption("Markets 
+00003c40: 7765 7265 206e 6f74 206c 6f61 6465 642e  were not loaded.
+00003c50: 2229 0a0a 2020 2020 2020 2020 6966 2062  ")..        if b
+00003c60: 6173 655f 6375 7272 656e 6369 6573 3a0a  ase_currencies:.
+00003c70: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
+00003c80: 6574 7320 3d20 7b6b 3a20 7620 666f 7220  ets = {k: v for 
+00003c90: 6b2c 2076 2069 6e20 6d61 726b 6574 732e  k, v in markets.
+00003ca0: 6974 656d 7328 2920 6966 2076 5b27 6261  items() if v['ba
+00003cb0: 7365 275d 2069 6e20 6261 7365 5f63 7572  se'] in base_cur
+00003cc0: 7265 6e63 6965 737d 0a20 2020 2020 2020  rencies}.       
+00003cd0: 2069 6620 7175 6f74 655f 6375 7272 656e   if quote_curren
+00003ce0: 6369 6573 3a0a 2020 2020 2020 2020 2020  cies:.          
+00003cf0: 2020 6d61 726b 6574 7320 3d20 7b6b 3a20    markets = {k: 
+00003d00: 7620 666f 7220 6b2c 2076 2069 6e20 6d61  v for k, v in ma
+00003d10: 726b 6574 732e 6974 656d 7328 2920 6966  rkets.items() if
+00003d20: 2076 5b27 7175 6f74 6527 5d20 696e 2071   v['quote'] in q
+00003d30: 756f 7465 5f63 7572 7265 6e63 6965 737d  uote_currencies}
+00003d40: 0a20 2020 2020 2020 2069 6620 7472 6164  .        if trad
+00003d50: 6162 6c65 5f6f 6e6c 793a 0a20 2020 2020  able_only:.     
+00003d60: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
+00003d70: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
+00003d80: 696e 206d 6172 6b65 7473 2e69 7465 6d73  in markets.items
+00003d90: 2829 2069 6620 7365 6c66 2e6d 6172 6b65  () if self.marke
+00003da0: 745f 6973 5f74 7261 6461 626c 6528 7629  t_is_tradable(v)
+00003db0: 7d0a 2020 2020 2020 2020 6966 2073 706f  }.        if spo
+00003dc0: 745f 6f6e 6c79 3a0a 2020 2020 2020 2020  t_only:.        
+00003dd0: 2020 2020 6d61 726b 6574 7320 3d20 7b6b      markets = {k
+00003de0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00003df0: 6d61 726b 6574 732e 6974 656d 7328 2920  markets.items() 
+00003e00: 6966 2073 656c 662e 6d61 726b 6574 5f69  if self.market_i
+00003e10: 735f 7370 6f74 2876 297d 0a20 2020 2020  s_spot(v)}.     
+00003e20: 2020 2069 6620 6d61 7267 696e 5f6f 6e6c     if margin_onl
+00003e30: 793a 0a20 2020 2020 2020 2020 2020 206d  y:.            m
+00003e40: 6172 6b65 7473 203d 207b 6b3a 2076 2066  arkets = {k: v f
+00003e50: 6f72 206b 2c20 7620 696e 206d 6172 6b65  or k, v in marke
+00003e60: 7473 2e69 7465 6d73 2829 2069 6620 7365  ts.items() if se
+00003e70: 6c66 2e6d 6172 6b65 745f 6973 5f6d 6172  lf.market_is_mar
+00003e80: 6769 6e28 7629 7d0a 2020 2020 2020 2020  gin(v)}.        
+00003e90: 6966 2066 7574 7572 6573 5f6f 6e6c 793a  if futures_only:
+00003ea0: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00003eb0: 6b65 7473 203d 207b 6b3a 2076 2066 6f72  kets = {k: v for
+00003ec0: 206b 2c20 7620 696e 206d 6172 6b65 7473   k, v in markets
+00003ed0: 2e69 7465 6d73 2829 2069 6620 7365 6c66  .items() if self
+00003ee0: 2e6d 6172 6b65 745f 6973 5f66 7574 7572  .market_is_futur
+00003ef0: 6528 7629 7d0a 2020 2020 2020 2020 6966  e(v)}.        if
+00003f00: 2061 6374 6976 655f 6f6e 6c79 3a0a 2020   active_only:.  
+00003f10: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+00003f20: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
+00003f30: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
+00003f40: 656d 7328 2920 6966 206d 6172 6b65 745f  ems() if market_
+00003f50: 6973 5f61 6374 6976 6528 7629 7d0a 2020  is_active(v)}.  
+00003f60: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
+00003f70: 6b65 7473 0a0a 2020 2020 6465 6620 6765  kets..    def ge
+00003f80: 745f 7175 6f74 655f 6375 7272 656e 6369  t_quote_currenci
+00003f90: 6573 2873 656c 6629 202d 3e20 4c69 7374  es(self) -> List
+00003fa0: 5b73 7472 5d3a 0a20 2020 2020 2020 2022  [str]:.        "
+00003fb0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00003fc0: 6e20 6120 6c69 7374 206f 6620 7375 7070  n a list of supp
+00003fd0: 6f72 7465 6420 7175 6f74 6520 6375 7272  orted quote curr
+00003fe0: 656e 6369 6573 0a20 2020 2020 2020 2022  encies.        "
+00003ff0: 2222 0a20 2020 2020 2020 206d 6172 6b65  "".        marke
+00004000: 7473 203d 2073 656c 662e 6d61 726b 6574  ts = self.market
+00004010: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00004020: 2073 6f72 7465 6428 7365 7428 5b78 5b27   sorted(set([x['
+00004030: 7175 6f74 6527 5d20 666f 7220 5f2c 2078  quote'] for _, x
+00004040: 2069 6e20 6d61 726b 6574 732e 6974 656d   in markets.item
+00004050: 7328 295d 2929 0a0a 2020 2020 6465 6620  s()]))..    def 
+00004060: 6765 745f 7061 6972 5f71 756f 7465 5f63  get_pair_quote_c
+00004070: 7572 7265 6e63 7928 7365 6c66 2c20 7061  urrency(self, pa
+00004080: 6972 3a20 7374 7229 202d 3e20 7374 723a  ir: str) -> str:
+00004090: 0a20 2020 2020 2020 2022 2222 2052 6574  .        """ Ret
+000040a0: 7572 6e20 6120 7061 6972 2773 2071 756f  urn a pair's quo
+000040b0: 7465 2063 7572 7265 6e63 7920 2862 6173  te currency (bas
+000040c0: 652f 7175 6f74 653a 7365 7474 6c65 6d65  e/quote:settleme
+000040d0: 6e74 2920 2222 220a 2020 2020 2020 2020  nt) """.        
+000040e0: 7265 7475 726e 2073 656c 662e 6d61 726b  return self.mark
+000040f0: 6574 732e 6765 7428 7061 6972 2c20 7b7d  ets.get(pair, {}
+00004100: 292e 6765 7428 2771 756f 7465 272c 2027  ).get('quote', '
+00004110: 2729 0a0a 2020 2020 6465 6620 6765 745f  ')..    def get_
+00004120: 7061 6972 5f62 6173 655f 6375 7272 656e  pair_base_curren
+00004130: 6379 2873 656c 662c 2070 6169 723a 2073  cy(self, pair: s
+00004140: 7472 2920 2d3e 2073 7472 3a0a 2020 2020  tr) -> str:.    
+00004150: 2020 2020 2222 2220 5265 7475 726e 2061      """ Return a
+00004160: 2070 6169 7227 7320 6261 7365 2063 7572   pair's base cur
+00004170: 7265 6e63 7920 2862 6173 652f 7175 6f74  rency (base/quot
+00004180: 653a 7365 7474 6c65 6d65 6e74 2920 2222  e:settlement) ""
+00004190: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+000041a0: 2073 656c 662e 6d61 726b 6574 732e 6765   self.markets.ge
+000041b0: 7428 7061 6972 2c20 7b7d 292e 6765 7428  t(pair, {}).get(
+000041c0: 2762 6173 6527 2c20 2727 290a 0a20 2020  'base', '')..   
+000041d0: 2064 6566 206d 6172 6b65 745f 6973 5f66   def market_is_f
+000041e0: 7574 7572 6528 7365 6c66 2c20 6d61 726b  uture(self, mark
+000041f0: 6574 3a20 4469 6374 5b73 7472 2c20 416e  et: Dict[str, An
+00004200: 795d 2920 2d3e 2062 6f6f 6c3a 0a20 2020  y]) -> bool:.   
+00004210: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
+00004220: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+00004230: 2e67 6574 2873 656c 662e 5f66 745f 6861  .get(self._ft_ha
+00004240: 735b 2263 6378 745f 6675 7475 7265 735f  s["ccxt_futures_
+00004250: 6e61 6d65 225d 2c20 4661 6c73 6529 2069  name"], False) i
+00004260: 7320 5472 7565 2061 6e64 0a20 2020 2020  s True and.     
+00004270: 2020 2020 2020 206d 6172 6b65 742e 6765         market.ge
+00004280: 7428 276c 696e 6561 7227 2c20 4661 6c73  t('linear', Fals
+00004290: 6529 2069 7320 5472 7565 0a20 2020 2020  e) is True.     
+000042a0: 2020 2029 0a0a 2020 2020 6465 6620 6d61     )..    def ma
+000042b0: 726b 6574 5f69 735f 7370 6f74 2873 656c  rket_is_spot(sel
+000042c0: 662c 206d 6172 6b65 743a 2044 6963 745b  f, market: Dict[
+000042d0: 7374 722c 2041 6e79 5d29 202d 3e20 626f  str, Any]) -> bo
+000042e0: 6f6c 3a0a 2020 2020 2020 2020 7265 7475  ol:.        retu
+000042f0: 726e 206d 6172 6b65 742e 6765 7428 2773  rn market.get('s
+00004300: 706f 7427 2c20 4661 6c73 6529 2069 7320  pot', False) is 
+00004310: 5472 7565 0a0a 2020 2020 6465 6620 6d61  True..    def ma
+00004320: 726b 6574 5f69 735f 6d61 7267 696e 2873  rket_is_margin(s
+00004330: 656c 662c 206d 6172 6b65 743a 2044 6963  elf, market: Dic
+00004340: 745b 7374 722c 2041 6e79 5d29 202d 3e20  t[str, Any]) -> 
+00004350: 626f 6f6c 3a0a 2020 2020 2020 2020 7265  bool:.        re
+00004360: 7475 726e 206d 6172 6b65 742e 6765 7428  turn market.get(
+00004370: 276d 6172 6769 6e27 2c20 4661 6c73 6529  'margin', False)
+00004380: 2069 7320 5472 7565 0a0a 2020 2020 6465   is True..    de
+00004390: 6620 6d61 726b 6574 5f69 735f 7472 6164  f market_is_trad
+000043a0: 6162 6c65 2873 656c 662c 206d 6172 6b65  able(self, marke
+000043b0: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
+000043c0: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
+000043d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000043e0: 4368 6563 6b20 6966 2074 6865 206d 6172  Check if the mar
+000043f0: 6b65 7420 7379 6d62 6f6c 2069 7320 7472  ket symbol is tr
+00004400: 6164 6162 6c65 2062 7920 4672 6571 7472  adable by Freqtr
+00004410: 6164 652e 0a20 2020 2020 2020 2045 6e73  ade..        Ens
+00004420: 7572 6573 2074 6861 7420 436f 6e66 6967  ures that Config
+00004430: 7572 6564 206d 6f64 6520 616c 6967 6e73  ured mode aligns
+00004440: 2074 6f0a 2020 2020 2020 2020 2222 220a   to.        """.
+00004450: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00004460: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00004470: 6b65 742e 6765 7428 2771 756f 7465 272c  ket.get('quote',
+00004480: 204e 6f6e 6529 2069 7320 6e6f 7420 4e6f   None) is not No
+00004490: 6e65 0a20 2020 2020 2020 2020 2020 2061  ne.            a
+000044a0: 6e64 206d 6172 6b65 742e 6765 7428 2762  nd market.get('b
+000044b0: 6173 6527 2c20 4e6f 6e65 2920 6973 206e  ase', None) is n
+000044c0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+000044d0: 2020 2020 616e 6420 2873 656c 662e 7072      and (self.pr
+000044e0: 6563 6973 696f 6e4d 6f64 6520 213d 2054  ecisionMode != T
+000044f0: 4943 4b5f 5349 5a45 0a20 2020 2020 2020  ICK_SIZE.       
+00004500: 2020 2020 2020 2020 2020 2320 546f 6f20            # Too 
+00004510: 6c6f 7720 7072 6563 6973 696f 6e20 7769  low precision wi
+00004520: 6c6c 2066 616c 7369 6679 2063 616c 6375  ll falsify calcu
+00004530: 6c61 7469 6f6e 730a 2020 2020 2020 2020  lations.        
+00004540: 2020 2020 2020 2020 206f 7220 6d61 726b           or mark
+00004550: 6574 2e67 6574 2827 7072 6563 6973 696f  et.get('precisio
+00004560: 6e27 2c20 7b7d 292e 6765 7428 2770 7269  n', {}).get('pri
+00004570: 6365 2729 203e 2031 652d 3131 290a 2020  ce') > 1e-11).  
+00004580: 2020 2020 2020 2020 2020 616e 6420 2828            and ((
+00004590: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
+000045a0: 6520 3d3d 2054 7261 6469 6e67 4d6f 6465  e == TradingMode
+000045b0: 2e53 504f 5420 616e 6420 7365 6c66 2e6d  .SPOT and self.m
+000045c0: 6172 6b65 745f 6973 5f73 706f 7428 6d61  arket_is_spot(ma
+000045d0: 726b 6574 2929 0a20 2020 2020 2020 2020  rket)).         
+000045e0: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
+000045f0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
+00004600: 2054 7261 6469 6e67 4d6f 6465 2e4d 4152   TradingMode.MAR
+00004610: 4749 4e20 616e 6420 7365 6c66 2e6d 6172  GIN and self.mar
+00004620: 6b65 745f 6973 5f6d 6172 6769 6e28 6d61  ket_is_margin(ma
+00004630: 726b 6574 2929 0a20 2020 2020 2020 2020  rket)).         
+00004640: 2020 2020 2020 2020 6f72 2028 7365 6c66          or (self
+00004650: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
+00004660: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
+00004670: 5552 4553 2061 6e64 2073 656c 662e 6d61  URES and self.ma
+00004680: 726b 6574 5f69 735f 6675 7475 7265 286d  rket_is_future(m
+00004690: 6172 6b65 7429 2929 0a20 2020 2020 2020  arket))).       
+000046a0: 2029 0a0a 2020 2020 6465 6620 6b6c 696e   )..    def klin
+000046b0: 6573 2873 656c 662c 2070 6169 725f 696e  es(self, pair_in
+000046c0: 7465 7276 616c 3a20 5061 6972 5769 7468  terval: PairWith
+000046d0: 5469 6d65 6672 616d 652c 2063 6f70 793a  Timeframe, copy:
+000046e0: 2062 6f6f 6c20 3d20 5472 7565 2920 2d3e   bool = True) ->
+000046f0: 2044 6174 6146 7261 6d65 3a0a 2020 2020   DataFrame:.    
+00004700: 2020 2020 6966 2070 6169 725f 696e 7465      if pair_inte
+00004710: 7276 616c 2069 6e20 7365 6c66 2e5f 6b6c  rval in self._kl
+00004720: 696e 6573 3a0a 2020 2020 2020 2020 2020  ines:.          
+00004730: 2020 7265 7475 726e 2073 656c 662e 5f6b    return self._k
+00004740: 6c69 6e65 735b 7061 6972 5f69 6e74 6572  lines[pair_inter
+00004750: 7661 6c5d 2e63 6f70 7928 2920 6966 2063  val].copy() if c
+00004760: 6f70 7920 656c 7365 2073 656c 662e 5f6b  opy else self._k
+00004770: 6c69 6e65 735b 7061 6972 5f69 6e74 6572  lines[pair_inter
+00004780: 7661 6c5d 0a20 2020 2020 2020 2065 6c73  val].        els
+00004790: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000047a0: 6574 7572 6e20 4461 7461 4672 616d 6528  eturn DataFrame(
+000047b0: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
+000047c0: 6f6e 7472 6163 745f 7369 7a65 2873 656c  ontract_size(sel
+000047d0: 662c 2070 6169 723a 2073 7472 2920 2d3e  f, pair: str) ->
+000047e0: 204f 7074 696f 6e61 6c5b 666c 6f61 745d   Optional[float]
+000047f0: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+00004800: 662e 7472 6164 696e 675f 6d6f 6465 203d  f.trading_mode =
+00004810: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
+00004820: 5455 5245 533a 0a20 2020 2020 2020 2020  TURES:.         
+00004830: 2020 206d 6172 6b65 7420 3d20 7365 6c66     market = self
+00004840: 2e6d 6172 6b65 7473 2e67 6574 2870 6169  .markets.get(pai
+00004850: 722c 207b 7d29 0a20 2020 2020 2020 2020  r, {}).         
+00004860: 2020 2063 6f6e 7472 6163 745f 7369 7a65     contract_size
+00004870: 3a20 666c 6f61 7420 3d20 312e 300a 2020  : float = 1.0.  
+00004880: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00004890: 206d 6172 6b65 743a 0a20 2020 2020 2020   market:.       
+000048a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000048b0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000048c0: 2069 6620 6d61 726b 6574 2e67 6574 2827   if market.get('
+000048d0: 636f 6e74 7261 6374 5369 7a65 2729 2069  contractSize') i
+000048e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000048f0: 2020 2020 2020 2020 2020 2020 2320 6363              # cc
+00004900: 7874 2068 6173 2063 6f6e 7472 6163 7453  xt has contractS
+00004910: 697a 6520 696e 206d 6172 6b65 7473 2061  ize in markets a
+00004920: 7320 7374 7269 6e67 0a20 2020 2020 2020  s string.       
+00004930: 2020 2020 2020 2020 2063 6f6e 7472 6163           contrac
+00004940: 745f 7369 7a65 203d 2066 6c6f 6174 286d  t_size = float(m
+00004950: 6172 6b65 745b 2763 6f6e 7472 6163 7453  arket['contractS
+00004960: 697a 6527 5d29 0a20 2020 2020 2020 2020  ize']).         
+00004970: 2020 2072 6574 7572 6e20 636f 6e74 7261     return contra
+00004980: 6374 5f73 697a 650a 2020 2020 2020 2020  ct_size.        
+00004990: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000049a0: 2020 7265 7475 726e 2031 0a0a 2020 2020    return 1..    
+000049b0: 6465 6620 5f74 7261 6465 735f 636f 6e74  def _trades_cont
+000049c0: 7261 6374 735f 746f 5f61 6d6f 756e 7428  racts_to_amount(
+000049d0: 7365 6c66 2c20 7472 6164 6573 3a20 4c69  self, trades: Li
+000049e0: 7374 2920 2d3e 204c 6973 743a 0a20 2020  st) -> List:.   
+000049f0: 2020 2020 2069 6620 6c65 6e28 7472 6164       if len(trad
+00004a00: 6573 2920 3e20 3020 616e 6420 2773 796d  es) > 0 and 'sym
+00004a10: 626f 6c27 2069 6e20 7472 6164 6573 5b30  bol' in trades[0
+00004a20: 5d3a 0a20 2020 2020 2020 2020 2020 2063  ]:.            c
+00004a30: 6f6e 7472 6163 745f 7369 7a65 203d 2073  ontract_size = s
+00004a40: 656c 662e 6765 745f 636f 6e74 7261 6374  elf.get_contract
+00004a50: 5f73 697a 6528 7472 6164 6573 5b30 5d5b  _size(trades[0][
+00004a60: 2773 796d 626f 6c27 5d29 0a20 2020 2020  'symbol']).     
+00004a70: 2020 2020 2020 2069 6620 636f 6e74 7261         if contra
+00004a80: 6374 5f73 697a 6520 213d 2031 3a0a 2020  ct_size != 1:.  
+00004a90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00004aa0: 7220 7472 6164 6520 696e 2074 7261 6465  r trade in trade
+00004ab0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00004ac0: 2020 2020 2020 2074 7261 6465 5b27 616d         trade['am
+00004ad0: 6f75 6e74 275d 203d 2074 7261 6465 5b27  ount'] = trade['
+00004ae0: 616d 6f75 6e74 275d 202a 2063 6f6e 7472  amount'] * contr
+00004af0: 6163 745f 7369 7a65 0a20 2020 2020 2020  act_size.       
+00004b00: 2072 6574 7572 6e20 7472 6164 6573 0a0a   return trades..
+00004b10: 2020 2020 6465 6620 5f6f 7264 6572 5f63      def _order_c
+00004b20: 6f6e 7472 6163 7473 5f74 6f5f 616d 6f75  ontracts_to_amou
+00004b30: 6e74 2873 656c 662c 206f 7264 6572 3a20  nt(self, order: 
+00004b40: 4469 6374 2920 2d3e 2044 6963 743a 0a20  Dict) -> Dict:. 
+00004b50: 2020 2020 2020 2069 6620 2773 796d 626f         if 'symbo
+00004b60: 6c27 2069 6e20 6f72 6465 7220 616e 6420  l' in order and 
+00004b70: 6f72 6465 725b 2773 796d 626f 6c27 5d20  order['symbol'] 
+00004b80: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00004b90: 2020 2020 2020 2020 2063 6f6e 7472 6163           contrac
+00004ba0: 745f 7369 7a65 203d 2073 656c 662e 6765  t_size = self.ge
+00004bb0: 745f 636f 6e74 7261 6374 5f73 697a 6528  t_contract_size(
+00004bc0: 6f72 6465 725b 2773 796d 626f 6c27 5d29  order['symbol'])
+00004bd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004be0: 636f 6e74 7261 6374 5f73 697a 6520 213d  contract_size !=
+00004bf0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00004c00: 2020 2020 666f 7220 7072 6f70 2069 6e20      for prop in 
+00004c10: 7365 6c66 2e5f 6674 5f68 6173 2e67 6574  self._ft_has.get
+00004c20: 2827 6f72 6465 725f 7072 6f70 735f 696e  ('order_props_in
+00004c30: 5f63 6f6e 7472 6163 7473 272c 205b 5d29  _contracts', [])
+00004c40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004c50: 2020 2020 2020 6966 2070 726f 7020 696e        if prop in
+00004c60: 206f 7264 6572 2061 6e64 206f 7264 6572   order and order
+00004c70: 5b70 726f 705d 2069 7320 6e6f 7420 4e6f  [prop] is not No
+00004c80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00004c90: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+00004ca0: 725b 7072 6f70 5d20 3d20 6f72 6465 725b  r[prop] = order[
+00004cb0: 7072 6f70 5d20 2a20 636f 6e74 7261 6374  prop] * contract
+00004cc0: 5f73 697a 650a 2020 2020 2020 2020 7265  _size.        re
+00004cd0: 7475 726e 206f 7264 6572 0a0a 2020 2020  turn order..    
+00004ce0: 6465 6620 5f61 6d6f 756e 745f 746f 5f63  def _amount_to_c
+00004cf0: 6f6e 7472 6163 7473 2873 656c 662c 2070  ontracts(self, p
+00004d00: 6169 723a 2073 7472 2c20 616d 6f75 6e74  air: str, amount
+00004d10: 3a20 666c 6f61 7429 202d 3e20 666c 6f61  : float) -> floa
+00004d20: 743a 0a0a 2020 2020 2020 2020 636f 6e74  t:..        cont
+00004d30: 7261 6374 5f73 697a 6520 3d20 7365 6c66  ract_size = self
+00004d40: 2e67 6574 5f63 6f6e 7472 6163 745f 7369  .get_contract_si
+00004d50: 7a65 2870 6169 7229 0a20 2020 2020 2020  ze(pair).       
+00004d60: 2072 6574 7572 6e20 616d 6f75 6e74 5f74   return amount_t
+00004d70: 6f5f 636f 6e74 7261 6374 7328 616d 6f75  o_contracts(amou
+00004d80: 6e74 2c20 636f 6e74 7261 6374 5f73 697a  nt, contract_siz
+00004d90: 6529 0a0a 2020 2020 6465 6620 5f63 6f6e  e)..    def _con
+00004da0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+00004db0: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
+00004dc0: 2c20 6e75 6d5f 636f 6e74 7261 6374 733a  , num_contracts:
+00004dd0: 2066 6c6f 6174 2920 2d3e 2066 6c6f 6174   float) -> float
+00004de0: 3a0a 0a20 2020 2020 2020 2063 6f6e 7472  :..        contr
+00004df0: 6163 745f 7369 7a65 203d 2073 656c 662e  act_size = self.
+00004e00: 6765 745f 636f 6e74 7261 6374 5f73 697a  get_contract_siz
+00004e10: 6528 7061 6972 290a 2020 2020 2020 2020  e(pair).        
+00004e20: 7265 7475 726e 2063 6f6e 7472 6163 7473  return contracts
+00004e30: 5f74 6f5f 616d 6f75 6e74 286e 756d 5f63  _to_amount(num_c
+00004e40: 6f6e 7472 6163 7473 2c20 636f 6e74 7261  ontracts, contra
+00004e50: 6374 5f73 697a 6529 0a0a 2020 2020 6465  ct_size)..    de
+00004e60: 6620 616d 6f75 6e74 5f74 6f5f 636f 6e74  f amount_to_cont
+00004e70: 7261 6374 5f70 7265 6369 7369 6f6e 2873  ract_precision(s
+00004e80: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00004e90: 616d 6f75 6e74 3a20 666c 6f61 7429 202d  amount: float) -
+00004ea0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+00004eb0: 2022 2222 0a20 2020 2020 2020 2048 656c   """.        Hel
+00004ec0: 7065 7220 7772 6170 7065 7220 6172 6f75  per wrapper arou
+00004ed0: 6e64 2061 6d6f 756e 745f 746f 5f63 6f6e  nd amount_to_con
+00004ee0: 7472 6163 745f 7072 6563 6973 696f 6e0a  tract_precision.
+00004ef0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00004f00: 2020 2020 636f 6e74 7261 6374 5f73 697a      contract_siz
+00004f10: 6520 3d20 7365 6c66 2e67 6574 5f63 6f6e  e = self.get_con
+00004f20: 7472 6163 745f 7369 7a65 2870 6169 7229  tract_size(pair)
+00004f30: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00004f40: 2061 6d6f 756e 745f 746f 5f63 6f6e 7472   amount_to_contr
+00004f50: 6163 745f 7072 6563 6973 696f 6e28 616d  act_precision(am
+00004f60: 6f75 6e74 2c20 7365 6c66 2e67 6574 5f70  ount, self.get_p
+00004f70: 7265 6369 7369 6f6e 5f61 6d6f 756e 7428  recision_amount(
+00004f80: 7061 6972 292c 0a20 2020 2020 2020 2020  pair),.         
 00004f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fa0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00004fb0: 6563 6973 696f 6e4d 6f64 652c 2063 6f6e  ecisionMode, con
-00004fc0: 7472 6163 745f 7369 7a65 290a 0a20 2020  tract_size)..   
-00004fd0: 2064 6566 2073 6574 5f73 616e 6462 6f78   def set_sandbox
-00004fe0: 2873 656c 662c 2061 7069 3a20 6363 7874  (self, api: ccxt
-00004ff0: 2e45 7863 6861 6e67 652c 2065 7863 6861  .Exchange, excha
-00005000: 6e67 655f 636f 6e66 6967 3a20 6469 6374  nge_config: dict
-00005010: 2c20 6e61 6d65 3a20 7374 7229 202d 3e20  , name: str) -> 
-00005020: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-00005030: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
-00005040: 2e67 6574 2827 7361 6e64 626f 7827 293a  .get('sandbox'):
-00005050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00005060: 6170 692e 7572 6c73 2e67 6574 2827 7465  api.urls.get('te
-00005070: 7374 2729 3a0a 2020 2020 2020 2020 2020  st'):.          
-00005080: 2020 2020 2020 6170 692e 7572 6c73 5b27        api.urls['
-00005090: 6170 6927 5d20 3d20 6170 692e 7572 6c73  api'] = api.urls
-000050a0: 5b27 7465 7374 275d 0a20 2020 2020 2020  ['test'].       
-000050b0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-000050c0: 696e 666f 2822 456e 6162 6c65 6420 5361  info("Enabled Sa
-000050d0: 6e64 626f 7820 4150 4920 6f6e 2025 7322  ndbox API on %s"
-000050e0: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
-000050f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005100: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00005110: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-00005120: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00005130: 4e6f 2053 616e 6462 6f78 2055 524c 2069  No Sandbox URL i
-00005140: 6e20 4343 5854 2066 6f72 207b 6e61 6d65  n CCXT for {name
-00005150: 7d2c 2065 7869 7469 6e67 2e20 506c 6561  }, exiting. Plea
-00005160: 7365 2063 6865 636b 2079 6f75 7220 636f  se check your co
-00005170: 6e66 6967 2e6a 736f 6e22 290a 2020 2020  nfig.json").    
-00005180: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00005190: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-000051a0: 6570 7469 6f6e 2866 2745 7863 6861 6e67  eption(f'Exchang
-000051b0: 6520 7b6e 616d 657d 2064 6f65 7320 6e6f  e {name} does no
-000051c0: 7420 7072 6f76 6964 6520 6120 7361 6e64  t provide a sand
-000051d0: 626f 7820 6170 6927 290a 0a20 2020 2064  box api')..    d
-000051e0: 6566 205f 6c6f 6164 5f61 7379 6e63 5f6d  ef _load_async_m
-000051f0: 6172 6b65 7473 2873 656c 662c 2072 656c  arkets(self, rel
-00005200: 6f61 643a 2062 6f6f 6c20 3d20 4661 6c73  oad: bool = Fals
-00005210: 6529 202d 3e20 4e6f 6e65 3a0a 2020 2020  e) -> None:.    
-00005220: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00005230: 2020 2020 2069 6620 7365 6c66 2e5f 6170       if self._ap
-00005240: 695f 6173 796e 633a 0a20 2020 2020 2020  i_async:.       
-00005250: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00005260: 6f70 2e72 756e 5f75 6e74 696c 5f63 6f6d  op.run_until_com
-00005270: 706c 6574 6528 0a20 2020 2020 2020 2020  plete(.         
-00005280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005290: 5f61 7069 5f61 7379 6e63 2e6c 6f61 645f  _api_async.load_
-000052a0: 6d61 726b 6574 7328 7265 6c6f 6164 3d72  markets(reload=r
-000052b0: 656c 6f61 642c 2070 6172 616d 733d 7b7d  eload, params={}
-000052c0: 2929 0a0a 2020 2020 2020 2020 6578 6365  ))..        exce
-000052d0: 7074 2028 6173 796e 6369 6f2e 5469 6d65  pt (asyncio.Time
-000052e0: 6f75 7445 7272 6f72 2c20 6363 7874 2e42  outError, ccxt.B
-000052f0: 6173 6545 7272 6f72 2920 6173 2065 3a0a  aseError) as e:.
-00005300: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00005310: 6572 2e77 6172 6e69 6e67 2827 436f 756c  er.warning('Coul
-00005320: 6420 6e6f 7420 6c6f 6164 2061 7379 6e63  d not load async
-00005330: 206d 6172 6b65 7473 2e20 5265 6173 6f6e   markets. Reason
-00005340: 3a20 2573 272c 2065 290a 2020 2020 2020  : %s', e).      
-00005350: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00005360: 2020 6465 6620 5f6c 6f61 645f 6d61 726b    def _load_mark
-00005370: 6574 7328 7365 6c66 2920 2d3e 204e 6f6e  ets(self) -> Non
-00005380: 653a 0a20 2020 2020 2020 2022 2222 2049  e:.        """ I
-00005390: 6e69 7469 616c 697a 6520 6d61 726b 6574  nitialize market
-000053a0: 7320 626f 7468 2073 796e 6320 616e 6420  s both sync and 
-000053b0: 6173 796e 6320 2222 220a 2020 2020 2020  async """.      
-000053c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000053d0: 2020 2073 656c 662e 5f6d 6172 6b65 7473     self._markets
-000053e0: 203d 2073 656c 662e 5f61 7069 2e6c 6f61   = self._api.loa
-000053f0: 645f 6d61 726b 6574 7328 7061 7261 6d73  d_markets(params
-00005400: 3d7b 7d29 0a20 2020 2020 2020 2020 2020  ={}).           
-00005410: 2073 656c 662e 5f6c 6f61 645f 6173 796e   self._load_asyn
-00005420: 635f 6d61 726b 6574 7328 290a 2020 2020  c_markets().    
-00005430: 2020 2020 2020 2020 7365 6c66 2e5f 6c61          self._la
-00005440: 7374 5f6d 6172 6b65 7473 5f72 6566 7265  st_markets_refre
-00005450: 7368 203d 2064 745f 7473 2829 0a20 2020  sh = dt_ts().   
-00005460: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00005470: 2e5f 6674 5f68 6173 5b27 6e65 6564 735f  ._ft_has['needs_
-00005480: 7472 6164 696e 675f 6665 6573 275d 3a0a  trading_fees']:.
-00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054a0: 7365 6c66 2e5f 7472 6164 696e 675f 6665  self._trading_fe
-000054b0: 6573 203d 2073 656c 662e 6665 7463 685f  es = self.fetch_
-000054c0: 7472 6164 696e 675f 6665 6573 2829 0a0a  trading_fees()..
-000054d0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-000054e0: 6378 742e 4261 7365 4572 726f 723a 0a20  cxt.BaseError:. 
-000054f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00005500: 722e 6578 6365 7074 696f 6e28 2755 6e61  r.exception('Una
-00005510: 626c 6520 746f 2069 6e69 7469 616c 697a  ble to initializ
-00005520: 6520 6d61 726b 6574 732e 2729 0a0a 2020  e markets.')..  
-00005530: 2020 6465 6620 7265 6c6f 6164 5f6d 6172    def reload_mar
-00005540: 6b65 7473 2873 656c 6629 202d 3e20 4e6f  kets(self) -> No
-00005550: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
-00005560: 656c 6f61 6420 6d61 726b 6574 7320 626f  eload markets bo
-00005570: 7468 2073 796e 6320 616e 6420 6173 796e  th sync and asyn
-00005580: 6320 6966 2072 6566 7265 7368 2069 6e74  c if refresh int
-00005590: 6572 7661 6c20 6861 7320 7061 7373 6564  erval has passed
-000055a0: 2022 2222 0a20 2020 2020 2020 2023 2043   """.        # C
-000055b0: 6865 636b 2077 6865 7468 6572 206d 6172  heck whether mar
-000055c0: 6b65 7473 2068 6176 6520 746f 2062 6520  kets have to be 
-000055d0: 7265 6c6f 6164 6564 0a20 2020 2020 2020  reloaded.       
-000055e0: 2069 6620 2873 656c 662e 5f6c 6173 745f   if (self._last_
-000055f0: 6d61 726b 6574 735f 7265 6672 6573 6820  markets_refresh 
-00005600: 3e20 3029 2061 6e64 2028 0a20 2020 2020  > 0) and (.     
-00005610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005620: 5f6c 6173 745f 6d61 726b 6574 735f 7265  _last_markets_re
-00005630: 6672 6573 6820 2b20 7365 6c66 2e6d 6172  fresh + self.mar
-00005640: 6b65 7473 5f72 6566 7265 7368 5f69 6e74  kets_refresh_int
-00005650: 6572 7661 6c20 3e20 6474 5f74 7328 2929  erval > dt_ts())
-00005660: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00005670: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00005680: 2020 6c6f 6767 6572 2e64 6562 7567 2822    logger.debug("
-00005690: 5065 7266 6f72 6d69 6e67 2073 6368 6564  Performing sched
-000056a0: 756c 6564 206d 6172 6b65 7420 7265 6c6f  uled market relo
-000056b0: 6164 2e2e 2229 0a20 2020 2020 2020 2074  ad..").        t
-000056c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000056d0: 7365 6c66 2e5f 6d61 726b 6574 7320 3d20  self._markets = 
-000056e0: 7365 6c66 2e5f 6170 692e 6c6f 6164 5f6d  self._api.load_m
-000056f0: 6172 6b65 7473 2872 656c 6f61 643d 5472  arkets(reload=Tr
-00005700: 7565 2c20 7061 7261 6d73 3d7b 7d29 0a20  ue, params={}). 
-00005710: 2020 2020 2020 2020 2020 2023 2041 6c73             # Als
-00005720: 6f20 7265 6c6f 6164 2061 7379 6e63 206d  o reload async m
-00005730: 6172 6b65 7473 2074 6f20 6176 6f69 6420  arkets to avoid 
-00005740: 6973 7375 6573 2077 6974 6820 6e65 776c  issues with newl
-00005750: 7920 6c69 7374 6564 2070 6169 7273 0a20  y listed pairs. 
-00005760: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005770: 5f6c 6f61 645f 6173 796e 635f 6d61 726b  _load_async_mark
-00005780: 6574 7328 7265 6c6f 6164 3d54 7275 6529  ets(reload=True)
-00005790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000057a0: 662e 5f6c 6173 745f 6d61 726b 6574 735f  f._last_markets_
-000057b0: 7265 6672 6573 6820 3d20 6474 5f74 7328  refresh = dt_ts(
-000057c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-000057d0: 6c66 2e66 696c 6c5f 6c65 7665 7261 6765  lf.fill_leverage
-000057e0: 5f74 6965 7273 2829 0a20 2020 2020 2020  _tiers().       
-000057f0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-00005800: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-00005810: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
-00005820: 7469 6f6e 2822 436f 756c 6420 6e6f 7420  tion("Could not 
-00005830: 7265 6c6f 6164 206d 6172 6b65 7473 2e22  reload markets."
-00005840: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
-00005850: 6174 655f 7374 616b 6563 7572 7265 6e63  ate_stakecurrenc
-00005860: 7928 7365 6c66 2c20 7374 616b 655f 6375  y(self, stake_cu
-00005870: 7272 656e 6379 3a20 7374 7229 202d 3e20  rrency: str) -> 
-00005880: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00005890: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
-000058a0: 2073 7461 6b65 2d63 7572 7265 6e63 7920   stake-currency 
-000058b0: 6167 6169 6e73 7420 6176 6169 6c61 626c  against availabl
-000058c0: 6520 6375 7272 656e 6369 6573 206f 6e20  e currencies on 
-000058d0: 7468 6520 6578 6368 616e 6765 2e0a 2020  the exchange..  
-000058e0: 2020 2020 2020 4f6e 6c79 2072 756e 7320        Only runs 
-000058f0: 6f6e 2073 7461 7274 7570 2e20 4966 206d  on startup. If m
-00005900: 6172 6b65 7473 2068 6176 6520 6e6f 7420  arkets have not 
-00005910: 6265 656e 206c 6f61 6465 642c 2074 6865  been loaded, the
-00005920: 7265 2773 2062 6565 6e20 6120 7072 6f62  re's been a prob
-00005930: 6c65 6d20 7769 7468 0a20 2020 2020 2020  lem with.       
-00005940: 2074 6865 2063 6f6e 6e65 6374 696f 6e20   the connection 
-00005950: 746f 2074 6865 2065 7863 6861 6e67 652e  to the exchange.
-00005960: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00005970: 7374 616b 655f 6375 7272 656e 6379 3a20  stake_currency: 
-00005980: 5374 616b 652d 6375 7272 656e 6379 2074  Stake-currency t
-00005990: 6f20 7661 6c69 6461 7465 0a20 2020 2020  o validate.     
-000059a0: 2020 203a 7261 6973 653a 204f 7065 7261     :raise: Opera
-000059b0: 7469 6f6e 616c 4578 6365 7074 696f 6e20  tionalException 
-000059c0: 6966 2073 7461 6b65 2d63 7572 7265 6e63  if stake-currenc
-000059d0: 7920 6973 206e 6f74 2061 7661 696c 6162  y is not availab
-000059e0: 6c65 2e0a 2020 2020 2020 2020 2222 220a  le..        """.
-000059f0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00005a00: 656c 662e 5f6d 6172 6b65 7473 3a0a 2020  elf._markets:.  
-00005a10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005a20: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00005a30: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00005a40: 2020 2020 2020 2743 6f75 6c64 206e 6f74        'Could not
-00005a50: 206c 6f61 6420 6d61 726b 6574 732c 2074   load markets, t
-00005a60: 6865 7265 666f 7265 2063 616e 6e6f 7420  herefore cannot 
-00005a70: 7374 6172 742e 2027 0a20 2020 2020 2020  start. '.       
-00005a80: 2020 2020 2020 2020 2027 506c 6561 7365           'Please
-00005a90: 2069 6e76 6573 7469 6761 7465 2074 6865   investigate the
-00005aa0: 2061 626f 7665 2065 7272 6f72 2066 6f72   above error for
-00005ab0: 206d 6f72 6520 6465 7461 696c 732e 270a   more details.'.
-00005ac0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00005ad0: 2020 2020 2020 7175 6f74 655f 6375 7272        quote_curr
-00005ae0: 656e 6369 6573 203d 2073 656c 662e 6765  encies = self.ge
-00005af0: 745f 7175 6f74 655f 6375 7272 656e 6369  t_quote_currenci
-00005b00: 6573 2829 0a20 2020 2020 2020 2069 6620  es().        if 
-00005b10: 7374 616b 655f 6375 7272 656e 6379 206e  stake_currency n
-00005b20: 6f74 2069 6e20 7175 6f74 655f 6375 7272  ot in quote_curr
-00005b30: 656e 6369 6573 3a0a 2020 2020 2020 2020  encies:.        
-00005b40: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00005b50: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b70: 6622 7b73 7461 6b65 5f63 7572 7265 6e63  f"{stake_currenc
-00005b80: 797d 2069 7320 6e6f 7420 6176 6169 6c61  y} is not availa
-00005b90: 626c 6520 6173 2073 7461 6b65 206f 6e20  ble as stake on 
-00005ba0: 7b73 656c 662e 6e61 6d65 7d2e 2022 0a20  {self.name}. ". 
-00005bb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005bc0: 2241 7661 696c 6162 6c65 2063 7572 7265  "Available curre
-00005bd0: 6e63 6965 7320 6172 653a 207b 272c 2027  ncies are: {', '
-00005be0: 2e6a 6f69 6e28 7175 6f74 655f 6375 7272  .join(quote_curr
-00005bf0: 656e 6369 6573 297d 2229 0a0a 2020 2020  encies)}")..    
-00005c00: 6465 6620 7661 6c69 6461 7465 5f70 6169  def validate_pai
-00005c10: 7273 2873 656c 662c 2070 6169 7273 3a20  rs(self, pairs: 
-00005c20: 4c69 7374 5b73 7472 5d29 202d 3e20 4e6f  List[str]) -> No
-00005c30: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00005c40: 2020 2020 2020 2020 4368 6563 6b73 2069          Checks i
-00005c50: 6620 616c 6c20 6769 7665 6e20 7061 6972  f all given pair
-00005c60: 7320 6172 6520 7472 6164 6162 6c65 206f  s are tradable o
-00005c70: 6e20 7468 6520 6375 7272 656e 7420 6578  n the current ex
-00005c80: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
-00005c90: 3a70 6172 616d 2070 6169 7273 3a20 6c69  :param pairs: li
-00005ca0: 7374 206f 6620 7061 6972 730a 2020 2020  st of pairs.    
-00005cb0: 2020 2020 3a72 6169 7365 3a20 4f70 6572      :raise: Oper
-00005cc0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00005cd0: 2069 6620 6f6e 6520 7061 6972 2069 7320   if one pair is 
-00005ce0: 6e6f 7420 6176 6169 6c61 626c 650a 2020  not available.  
-00005cf0: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
-00005d00: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
-00005d10: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00005d20: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
-00005d30: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00005d40: 2e77 6172 6e69 6e67 2827 556e 6162 6c65  .warning('Unable
-00005d50: 2074 6f20 7661 6c69 6461 7465 2070 6169   to validate pai
-00005d60: 7273 2028 6173 7375 6d69 6e67 2074 6865  rs (assuming the
-00005d70: 7920 6172 6520 636f 7272 6563 7429 2e27  y are correct).'
-00005d80: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00005d90: 7475 726e 0a20 2020 2020 2020 2065 7874  turn.        ext
-00005da0: 656e 6465 645f 7061 6972 7320 3d20 6578  ended_pairs = ex
-00005db0: 7061 6e64 5f70 6169 726c 6973 7428 7061  pand_pairlist(pa
-00005dc0: 6972 732c 206c 6973 7428 7365 6c66 2e6d  irs, list(self.m
-00005dd0: 6172 6b65 7473 292c 206b 6565 705f 696e  arkets), keep_in
-00005de0: 7661 6c69 643d 5472 7565 290a 2020 2020  valid=True).    
-00005df0: 2020 2020 696e 7661 6c69 645f 7061 6972      invalid_pair
-00005e00: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00005e10: 6f72 2070 6169 7220 696e 2065 7874 656e  or pair in exten
-00005e20: 6465 645f 7061 6972 733a 0a20 2020 2020  ded_pairs:.     
-00005e30: 2020 2020 2020 2023 204e 6f74 653a 2063         # Note: c
-00005e40: 6378 7420 6861 7320 4261 7365 4375 7272  cxt has BaseCurr
-00005e50: 656e 6379 2f51 756f 7465 4375 7272 656e  ency/QuoteCurren
-00005e60: 6379 2066 6f72 6d61 7420 666f 7220 7061  cy format for pa
-00005e70: 6972 730a 2020 2020 2020 2020 2020 2020  irs.            
-00005e80: 6966 2073 656c 662e 6d61 726b 6574 7320  if self.markets 
-00005e90: 616e 6420 7061 6972 206e 6f74 2069 6e20  and pair not in 
-00005ea0: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
-00005eb0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00005ec0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00005ed0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-00005ee0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00005ef0: 5061 6972 207b 7061 6972 7d20 6973 206e  Pair {pair} is n
-00005f00: 6f74 2061 7661 696c 6162 6c65 206f 6e20  ot available on 
-00005f10: 7b73 656c 662e 6e61 6d65 7d20 7b73 656c  {self.name} {sel
-00005f20: 662e 7472 6164 696e 675f 6d6f 6465 2e76  f.trading_mode.v
-00005f30: 616c 7565 7d2e 2027 0a20 2020 2020 2020  alue}. '.       
-00005f40: 2020 2020 2020 2020 2020 2020 2066 2750               f'P
-00005f50: 6c65 6173 6520 7265 6d6f 7665 207b 7061  lease remove {pa
-00005f60: 6972 7d20 6672 6f6d 2079 6f75 7220 7768  ir} from your wh
-00005f70: 6974 656c 6973 742e 2729 0a0a 2020 2020  itelist.')..    
-00005f80: 2020 2020 2020 2020 2020 2020 2320 4672              # Fr
-00005f90: 6f6d 2063 6378 7420 446f 6375 6d65 6e74  om ccxt Document
-00005fa0: 6174 696f 6e3a 0a20 2020 2020 2020 2020  ation:.         
-00005fb0: 2020 2020 2020 2023 206d 6172 6b65 7473         # markets
-00005fc0: 2e69 6e66 6f3a 2041 6e20 6173 736f 6369  .info: An associ
-00005fd0: 6174 6976 6520 6172 7261 7920 6f66 206e  ative array of n
-00005fe0: 6f6e 2d63 6f6d 6d6f 6e20 6d61 726b 6574  on-common market
-00005ff0: 2070 726f 7065 7274 6965 732c 0a20 2020   properties,.   
-00006000: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-00006010: 6e63 6c75 6469 6e67 2066 6565 732c 2072  ncluding fees, r
-00006020: 6174 6573 2c20 6c69 6d69 7473 2061 6e64  ates, limits and
-00006030: 206f 7468 6572 2067 656e 6572 616c 206d   other general m
-00006040: 6172 6b65 7420 696e 666f 726d 6174 696f  arket informatio
-00006050: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-00006060: 2020 2023 2054 6865 2069 6e74 6572 6e61     # The interna
-00006070: 6c20 696e 666f 2061 7272 6179 2069 7320  l info array is 
-00006080: 6469 6666 6572 656e 7420 666f 7220 6561  different for ea
-00006090: 6368 2070 6172 7469 6375 6c61 7220 6d61  ch particular ma
-000060a0: 726b 6574 2c0a 2020 2020 2020 2020 2020  rket,.          
-000060b0: 2020 2020 2020 2320 6974 7320 636f 6e74        # its cont
-000060c0: 656e 7473 2064 6570 656e 6420 6f6e 2074  ents depend on t
-000060d0: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
-000060e0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-000060f0: 7420 6361 6e20 616c 736f 2062 6520 6120  t can also be a 
-00006100: 7374 7269 6e67 206f 7220 7369 6d69 6c61  string or simila
-00006110: 7220 2e2e 2e20 736f 2077 6520 6e65 6564  r ... so we need
-00006120: 2074 6f20 7665 7269 6679 2074 6861 7420   to verify that 
-00006130: 6669 7273 742e 0a20 2020 2020 2020 2020  first..         
-00006140: 2020 2065 6c69 6620 2869 7369 6e73 7461     elif (isinsta
-00006150: 6e63 6528 7365 6c66 2e6d 6172 6b65 7473  nce(self.markets
-00006160: 5b70 6169 725d 2e67 6574 2827 696e 666f  [pair].get('info
-00006170: 2729 2c20 6469 6374 290a 2020 2020 2020  '), dict).      
-00006180: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00006190: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
-000061a0: 725d 2e67 6574 2827 696e 666f 272c 207b  r].get('info', {
-000061b0: 7d29 2e67 6574 2827 7072 6f68 6962 6974  }).get('prohibit
-000061c0: 6564 496e 272c 2046 616c 7365 2929 3a0a  edIn', False)):.
-000061d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061e0: 2320 5761 726e 2075 7365 7273 2061 626f  # Warn users abo
-000061f0: 7574 2072 6573 7472 6963 7465 6420 7061  ut restricted pa
-00006200: 6972 7320 696e 2077 6869 7465 6c69 7374  irs in whitelist
-00006210: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006220: 2020 2320 5765 2063 616e 6e6f 7420 6465    # We cannot de
-00006230: 7465 726d 696e 6520 7265 6c69 6162 6c79  termine reliably
-00006240: 2069 6620 5573 6572 7320 6172 6520 6166   if Users are af
-00006250: 6665 6374 6564 2e0a 2020 2020 2020 2020  fected..        
-00006260: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-00006270: 6172 6e69 6e67 2866 2250 6169 7220 7b70  arning(f"Pair {p
-00006280: 6169 727d 2069 7320 7265 7374 7269 6374  air} is restrict
-00006290: 6564 2066 6f72 2073 6f6d 6520 7573 6572  ed for some user
-000062a0: 7320 6f6e 2074 6869 7320 6578 6368 616e  s on this exchan
-000062b0: 6765 2e22 0a20 2020 2020 2020 2020 2020  ge.".           
+00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fb0: 2020 2073 656c 662e 7072 6563 6973 696f     self.precisio
+00004fc0: 6e4d 6f64 652c 2063 6f6e 7472 6163 745f  nMode, contract_
+00004fd0: 7369 7a65 290a 0a20 2020 2064 6566 2073  size)..    def s
+00004fe0: 6574 5f73 616e 6462 6f78 2873 656c 662c  et_sandbox(self,
+00004ff0: 2061 7069 3a20 6363 7874 2e45 7863 6861   api: ccxt.Excha
+00005000: 6e67 652c 2065 7863 6861 6e67 655f 636f  nge, exchange_co
+00005010: 6e66 6967 3a20 6469 6374 2c20 6e61 6d65  nfig: dict, name
+00005020: 3a20 7374 7229 202d 3e20 4e6f 6e65 3a0a  : str) -> None:.
+00005030: 2020 2020 2020 2020 6966 2065 7863 6861          if excha
+00005040: 6e67 655f 636f 6e66 6967 2e67 6574 2827  nge_config.get('
+00005050: 7361 6e64 626f 7827 293a 0a20 2020 2020  sandbox'):.     
+00005060: 2020 2020 2020 2069 6620 6170 692e 7572         if api.ur
+00005070: 6c73 2e67 6574 2827 7465 7374 2729 3a0a  ls.get('test'):.
+00005080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005090: 6170 692e 7572 6c73 5b27 6170 6927 5d20  api.urls['api'] 
+000050a0: 3d20 6170 692e 7572 6c73 5b27 7465 7374  = api.urls['test
+000050b0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+000050c0: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
+000050d0: 456e 6162 6c65 6420 5361 6e64 626f 7820  Enabled Sandbox 
+000050e0: 4150 4920 6f6e 2025 7322 2c20 6e61 6d65  API on %s", name
+000050f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00005100: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00005110: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+00005120: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+00005130: 2020 2020 2020 2020 6622 4e6f 2053 616e          f"No San
+00005140: 6462 6f78 2055 524c 2069 6e20 4343 5854  dbox URL in CCXT
+00005150: 2066 6f72 207b 6e61 6d65 7d2c 2065 7869   for {name}, exi
+00005160: 7469 6e67 2e20 506c 6561 7365 2063 6865  ting. Please che
+00005170: 636b 2079 6f75 7220 636f 6e66 6967 2e6a  ck your config.j
+00005180: 736f 6e22 290a 2020 2020 2020 2020 2020  son").          
+00005190: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+000051a0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000051b0: 2866 2745 7863 6861 6e67 6520 7b6e 616d  (f'Exchange {nam
+000051c0: 657d 2064 6f65 7320 6e6f 7420 7072 6f76  e} does not prov
+000051d0: 6964 6520 6120 7361 6e64 626f 7820 6170  ide a sandbox ap
+000051e0: 6927 290a 0a20 2020 2064 6566 205f 6c6f  i')..    def _lo
+000051f0: 6164 5f61 7379 6e63 5f6d 6172 6b65 7473  ad_async_markets
+00005200: 2873 656c 662c 2072 656c 6f61 643a 2062  (self, reload: b
+00005210: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
+00005220: 4e6f 6e65 3a0a 2020 2020 2020 2020 7472  None:.        tr
+00005230: 793a 0a20 2020 2020 2020 2020 2020 2069  y:.            i
+00005240: 6620 7365 6c66 2e5f 6170 695f 6173 796e  f self._api_asyn
+00005250: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+00005260: 2020 2073 656c 662e 6c6f 6f70 2e72 756e     self.loop.run
+00005270: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
+00005280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005290: 2020 2020 2073 656c 662e 5f61 7069 5f61       self._api_a
+000052a0: 7379 6e63 2e6c 6f61 645f 6d61 726b 6574  sync.load_market
+000052b0: 7328 7265 6c6f 6164 3d72 656c 6f61 642c  s(reload=reload,
+000052c0: 2070 6172 616d 733d 7b7d 2929 0a0a 2020   params={}))..  
+000052d0: 2020 2020 2020 6578 6365 7074 2028 6173        except (as
+000052e0: 796e 6369 6f2e 5469 6d65 6f75 7445 7272  yncio.TimeoutErr
+000052f0: 6f72 2c20 6363 7874 2e42 6173 6545 7272  or, ccxt.BaseErr
+00005300: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+00005310: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+00005320: 6e69 6e67 2827 436f 756c 6420 6e6f 7420  ning('Could not 
+00005330: 6c6f 6164 2061 7379 6e63 206d 6172 6b65  load async marke
+00005340: 7473 2e20 5265 6173 6f6e 3a20 2573 272c  ts. Reason: %s',
+00005350: 2065 290a 2020 2020 2020 2020 2020 2020   e).            
+00005360: 7265 7475 726e 0a0a 2020 2020 6465 6620  return..    def 
+00005370: 5f6c 6f61 645f 6d61 726b 6574 7328 7365  _load_markets(se
+00005380: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+00005390: 2020 2020 2022 2222 2049 6e69 7469 616c       """ Initial
+000053a0: 697a 6520 6d61 726b 6574 7320 626f 7468  ize markets both
+000053b0: 2073 796e 6320 616e 6420 6173 796e 6320   sync and async 
+000053c0: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+000053d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000053e0: 662e 5f6d 6172 6b65 7473 203d 2073 656c  f._markets = sel
+000053f0: 662e 5f61 7069 2e6c 6f61 645f 6d61 726b  f._api.load_mark
+00005400: 6574 7328 7061 7261 6d73 3d7b 7d29 0a20  ets(params={}). 
+00005410: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005420: 5f6c 6f61 645f 6173 796e 635f 6d61 726b  _load_async_mark
+00005430: 6574 7328 290a 2020 2020 2020 2020 2020  ets().          
+00005440: 2020 7365 6c66 2e5f 6c61 7374 5f6d 6172    self._last_mar
+00005450: 6b65 7473 5f72 6566 7265 7368 203d 2064  kets_refresh = d
+00005460: 745f 7473 2829 0a20 2020 2020 2020 2020  t_ts().         
+00005470: 2020 2069 6620 7365 6c66 2e5f 6674 5f68     if self._ft_h
+00005480: 6173 5b27 6e65 6564 735f 7472 6164 696e  as['needs_tradin
+00005490: 675f 6665 6573 275d 3a0a 2020 2020 2020  g_fees']:.      
+000054a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000054b0: 7472 6164 696e 675f 6665 6573 203d 2073  trading_fees = s
+000054c0: 656c 662e 6665 7463 685f 7472 6164 696e  elf.fetch_tradin
+000054d0: 675f 6665 6573 2829 0a0a 2020 2020 2020  g_fees()..      
+000054e0: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
+000054f0: 7365 4572 726f 723a 0a20 2020 2020 2020  seError:.       
+00005500: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
+00005510: 7074 696f 6e28 2755 6e61 626c 6520 746f  ption('Unable to
+00005520: 2069 6e69 7469 616c 697a 6520 6d61 726b   initialize mark
+00005530: 6574 732e 2729 0a0a 2020 2020 6465 6620  ets.')..    def 
+00005540: 7265 6c6f 6164 5f6d 6172 6b65 7473 2873  reload_markets(s
+00005550: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+00005560: 2020 2020 2020 2222 2252 656c 6f61 6420        """Reload 
+00005570: 6d61 726b 6574 7320 626f 7468 2073 796e  markets both syn
+00005580: 6320 616e 6420 6173 796e 6320 6966 2072  c and async if r
+00005590: 6566 7265 7368 2069 6e74 6572 7661 6c20  efresh interval 
+000055a0: 6861 7320 7061 7373 6564 2022 2222 0a20  has passed """. 
+000055b0: 2020 2020 2020 2023 2043 6865 636b 2077         # Check w
+000055c0: 6865 7468 6572 206d 6172 6b65 7473 2068  hether markets h
+000055d0: 6176 6520 746f 2062 6520 7265 6c6f 6164  ave to be reload
+000055e0: 6564 0a20 2020 2020 2020 2069 6620 2873  ed.        if (s
+000055f0: 656c 662e 5f6c 6173 745f 6d61 726b 6574  elf._last_market
+00005600: 735f 7265 6672 6573 6820 3e20 3029 2061  s_refresh > 0) a
+00005610: 6e64 2028 0a20 2020 2020 2020 2020 2020  nd (.           
+00005620: 2020 2020 2073 656c 662e 5f6c 6173 745f       self._last_
+00005630: 6d61 726b 6574 735f 7265 6672 6573 6820  markets_refresh 
+00005640: 2b20 7365 6c66 2e6d 6172 6b65 7473 5f72  + self.markets_r
+00005650: 6566 7265 7368 5f69 6e74 6572 7661 6c20  efresh_interval 
+00005660: 3e20 6474 5f74 7328 2929 3a0a 2020 2020  > dt_ts()):.    
+00005670: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00005680: 6f6e 650a 2020 2020 2020 2020 6c6f 6767  one.        logg
+00005690: 6572 2e64 6562 7567 2822 5065 7266 6f72  er.debug("Perfor
+000056a0: 6d69 6e67 2073 6368 6564 756c 6564 206d  ming scheduled m
+000056b0: 6172 6b65 7420 7265 6c6f 6164 2e2e 2229  arket reload..")
+000056c0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000056d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000056e0: 6d61 726b 6574 7320 3d20 7365 6c66 2e5f  markets = self._
+000056f0: 6170 692e 6c6f 6164 5f6d 6172 6b65 7473  api.load_markets
+00005700: 2872 656c 6f61 643d 5472 7565 2c20 7061  (reload=True, pa
+00005710: 7261 6d73 3d7b 7d29 0a20 2020 2020 2020  rams={}).       
+00005720: 2020 2020 2023 2041 6c73 6f20 7265 6c6f       # Also relo
+00005730: 6164 2061 7379 6e63 206d 6172 6b65 7473  ad async markets
+00005740: 2074 6f20 6176 6f69 6420 6973 7375 6573   to avoid issues
+00005750: 2077 6974 6820 6e65 776c 7920 6c69 7374   with newly list
+00005760: 6564 2070 6169 7273 0a20 2020 2020 2020  ed pairs.       
+00005770: 2020 2020 2073 656c 662e 5f6c 6f61 645f       self._load_
+00005780: 6173 796e 635f 6d61 726b 6574 7328 7265  async_markets(re
+00005790: 6c6f 6164 3d54 7275 6529 0a20 2020 2020  load=True).     
+000057a0: 2020 2020 2020 2073 656c 662e 5f6c 6173         self._las
+000057b0: 745f 6d61 726b 6574 735f 7265 6672 6573  t_markets_refres
+000057c0: 6820 3d20 6474 5f74 7328 290a 2020 2020  h = dt_ts().    
+000057d0: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+000057e0: 6c5f 6c65 7665 7261 6765 5f74 6965 7273  l_leverage_tiers
+000057f0: 2829 0a20 2020 2020 2020 2065 7863 6570  ().        excep
+00005800: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
+00005810: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00005820: 6767 6572 2e65 7863 6570 7469 6f6e 2822  gger.exception("
+00005830: 436f 756c 6420 6e6f 7420 7265 6c6f 6164  Could not reload
+00005840: 206d 6172 6b65 7473 2e22 290a 0a20 2020   markets.")..   
+00005850: 2064 6566 2076 616c 6964 6174 655f 7374   def validate_st
+00005860: 616b 6563 7572 7265 6e63 7928 7365 6c66  akecurrency(self
+00005870: 2c20 7374 616b 655f 6375 7272 656e 6379  , stake_currency
+00005880: 3a20 7374 7229 202d 3e20 4e6f 6e65 3a0a  : str) -> None:.
+00005890: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000058a0: 2020 2020 4368 6563 6b73 2073 7461 6b65      Checks stake
+000058b0: 2d63 7572 7265 6e63 7920 6167 6169 6e73  -currency agains
+000058c0: 7420 6176 6169 6c61 626c 6520 6375 7272  t available curr
+000058d0: 656e 6369 6573 206f 6e20 7468 6520 6578  encies on the ex
+000058e0: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
+000058f0: 4f6e 6c79 2072 756e 7320 6f6e 2073 7461  Only runs on sta
+00005900: 7274 7570 2e20 4966 206d 6172 6b65 7473  rtup. If markets
+00005910: 2068 6176 6520 6e6f 7420 6265 656e 206c   have not been l
+00005920: 6f61 6465 642c 2074 6865 7265 2773 2062  oaded, there's b
+00005930: 6565 6e20 6120 7072 6f62 6c65 6d20 7769  een a problem wi
+00005940: 7468 0a20 2020 2020 2020 2074 6865 2063  th.        the c
+00005950: 6f6e 6e65 6374 696f 6e20 746f 2074 6865  onnection to the
+00005960: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
+00005970: 2020 203a 7061 7261 6d20 7374 616b 655f     :param stake_
+00005980: 6375 7272 656e 6379 3a20 5374 616b 652d  currency: Stake-
+00005990: 6375 7272 656e 6379 2074 6f20 7661 6c69  currency to vali
+000059a0: 6461 7465 0a20 2020 2020 2020 203a 7261  date.        :ra
+000059b0: 6973 653a 204f 7065 7261 7469 6f6e 616c  ise: Operational
+000059c0: 4578 6365 7074 696f 6e20 6966 2073 7461  Exception if sta
+000059d0: 6b65 2d63 7572 7265 6e63 7920 6973 206e  ke-currency is n
+000059e0: 6f74 2061 7661 696c 6162 6c65 2e0a 2020  ot available..  
+000059f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00005a00: 2020 6966 206e 6f74 2073 656c 662e 5f6d    if not self._m
+00005a10: 6172 6b65 7473 3a0a 2020 2020 2020 2020  arkets:.        
+00005a20: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00005a30: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a50: 2743 6f75 6c64 206e 6f74 206c 6f61 6420  'Could not load 
+00005a60: 6d61 726b 6574 732c 2074 6865 7265 666f  markets, therefo
+00005a70: 7265 2063 616e 6e6f 7420 7374 6172 742e  re cannot start.
+00005a80: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00005a90: 2020 2027 506c 6561 7365 2069 6e76 6573     'Please inves
+00005aa0: 7469 6761 7465 2074 6865 2061 626f 7665  tigate the above
+00005ab0: 2065 7272 6f72 2066 6f72 206d 6f72 6520   error for more 
+00005ac0: 6465 7461 696c 732e 270a 2020 2020 2020  details.'.      
+00005ad0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00005ae0: 7175 6f74 655f 6375 7272 656e 6369 6573  quote_currencies
+00005af0: 203d 2073 656c 662e 6765 745f 7175 6f74   = self.get_quot
+00005b00: 655f 6375 7272 656e 6369 6573 2829 0a20  e_currencies(). 
+00005b10: 2020 2020 2020 2069 6620 7374 616b 655f         if stake_
+00005b20: 6375 7272 656e 6379 206e 6f74 2069 6e20  currency not in 
+00005b30: 7175 6f74 655f 6375 7272 656e 6369 6573  quote_currencies
+00005b40: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00005b50: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00005b60: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+00005b70: 2020 2020 2020 2020 2020 6622 7b73 7461            f"{sta
+00005b80: 6b65 5f63 7572 7265 6e63 797d 2069 7320  ke_currency} is 
+00005b90: 6e6f 7420 6176 6169 6c61 626c 6520 6173  not available as
+00005ba0: 2073 7461 6b65 206f 6e20 7b73 656c 662e   stake on {self.
+00005bb0: 6e61 6d65 7d2e 2022 0a20 2020 2020 2020  name}. ".       
+00005bc0: 2020 2020 2020 2020 2066 2241 7661 696c           f"Avail
+00005bd0: 6162 6c65 2063 7572 7265 6e63 6965 7320  able currencies 
+00005be0: 6172 653a 207b 272c 2027 2e6a 6f69 6e28  are: {', '.join(
+00005bf0: 7175 6f74 655f 6375 7272 656e 6369 6573  quote_currencies
+00005c00: 297d 2229 0a0a 2020 2020 6465 6620 7661  )}")..    def va
+00005c10: 6c69 6461 7465 5f70 6169 7273 2873 656c  lidate_pairs(sel
+00005c20: 662c 2070 6169 7273 3a20 4c69 7374 5b73  f, pairs: List[s
+00005c30: 7472 5d29 202d 3e20 4e6f 6e65 3a0a 2020  tr]) -> None:.  
+00005c40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00005c50: 2020 4368 6563 6b73 2069 6620 616c 6c20    Checks if all 
+00005c60: 6769 7665 6e20 7061 6972 7320 6172 6520  given pairs are 
+00005c70: 7472 6164 6162 6c65 206f 6e20 7468 6520  tradable on the 
+00005c80: 6375 7272 656e 7420 6578 6368 616e 6765  current exchange
+00005c90: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00005ca0: 2070 6169 7273 3a20 6c69 7374 206f 6620   pairs: list of 
+00005cb0: 7061 6972 730a 2020 2020 2020 2020 3a72  pairs.        :r
+00005cc0: 6169 7365 3a20 4f70 6572 6174 696f 6e61  aise: Operationa
+00005cd0: 6c45 7863 6570 7469 6f6e 2069 6620 6f6e  lException if on
+00005ce0: 6520 7061 6972 2069 7320 6e6f 7420 6176  e pair is not av
+00005cf0: 6169 6c61 626c 650a 2020 2020 2020 2020  ailable.        
+00005d00: 3a72 6574 7572 6e3a 204e 6f6e 650a 2020  :return: None.  
+00005d10: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00005d20: 2020 2069 6620 6e6f 7420 7365 6c66 2e6d     if not self.m
+00005d30: 6172 6b65 7473 3a0a 2020 2020 2020 2020  arkets:.        
+00005d40: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+00005d50: 6e67 2827 556e 6162 6c65 2074 6f20 7661  ng('Unable to va
+00005d60: 6c69 6461 7465 2070 6169 7273 2028 6173  lidate pairs (as
+00005d70: 7375 6d69 6e67 2074 6865 7920 6172 6520  suming they are 
+00005d80: 636f 7272 6563 7429 2e27 290a 2020 2020  correct).').    
+00005d90: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00005da0: 2020 2020 2020 2065 7874 656e 6465 645f         extended_
+00005db0: 7061 6972 7320 3d20 6578 7061 6e64 5f70  pairs = expand_p
+00005dc0: 6169 726c 6973 7428 7061 6972 732c 206c  airlist(pairs, l
+00005dd0: 6973 7428 7365 6c66 2e6d 6172 6b65 7473  ist(self.markets
+00005de0: 292c 206b 6565 705f 696e 7661 6c69 643d  ), keep_invalid=
+00005df0: 5472 7565 290a 2020 2020 2020 2020 696e  True).        in
+00005e00: 7661 6c69 645f 7061 6972 7320 3d20 5b5d  valid_pairs = []
+00005e10: 0a20 2020 2020 2020 2066 6f72 2070 6169  .        for pai
+00005e20: 7220 696e 2065 7874 656e 6465 645f 7061  r in extended_pa
+00005e30: 6972 733a 0a20 2020 2020 2020 2020 2020  irs:.           
+00005e40: 2023 204e 6f74 653a 2063 6378 7420 6861   # Note: ccxt ha
+00005e50: 7320 4261 7365 4375 7272 656e 6379 2f51  s BaseCurrency/Q
+00005e60: 756f 7465 4375 7272 656e 6379 2066 6f72  uoteCurrency for
+00005e70: 6d61 7420 666f 7220 7061 6972 730a 2020  mat for pairs.  
+00005e80: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00005e90: 662e 6d61 726b 6574 7320 616e 6420 7061  f.markets and pa
+00005ea0: 6972 206e 6f74 2069 6e20 7365 6c66 2e6d  ir not in self.m
+00005eb0: 6172 6b65 7473 3a0a 2020 2020 2020 2020  arkets:.        
+00005ec0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00005ed0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00005ee0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00005ef0: 2020 2020 2020 2020 6627 5061 6972 207b          f'Pair {
+00005f00: 7061 6972 7d20 6973 206e 6f74 2061 7661  pair} is not ava
+00005f10: 696c 6162 6c65 206f 6e20 7b73 656c 662e  ilable on {self.
+00005f20: 6e61 6d65 7d20 7b73 656c 662e 7472 6164  name} {self.trad
+00005f30: 696e 675f 6d6f 6465 2e76 616c 7565 7d2e  ing_mode.value}.
+00005f40: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00005f50: 2020 2020 2020 2066 2750 6c65 6173 6520         f'Please 
+00005f60: 7265 6d6f 7665 207b 7061 6972 7d20 6672  remove {pair} fr
+00005f70: 6f6d 2079 6f75 7220 7768 6974 656c 6973  om your whitelis
+00005f80: 742e 2729 0a0a 2020 2020 2020 2020 2020  t.')..          
+00005f90: 2020 2020 2020 2320 4672 6f6d 2063 6378        # From ccx
+00005fa0: 7420 446f 6375 6d65 6e74 6174 696f 6e3a  t Documentation:
+00005fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005fc0: 2023 206d 6172 6b65 7473 2e69 6e66 6f3a   # markets.info:
+00005fd0: 2041 6e20 6173 736f 6369 6174 6976 6520   An associative 
+00005fe0: 6172 7261 7920 6f66 206e 6f6e 2d63 6f6d  array of non-com
+00005ff0: 6d6f 6e20 6d61 726b 6574 2070 726f 7065  mon market prope
+00006000: 7274 6965 732c 0a20 2020 2020 2020 2020  rties,.         
+00006010: 2020 2020 2020 2023 2069 6e63 6c75 6469         # includi
+00006020: 6e67 2066 6565 732c 2072 6174 6573 2c20  ng fees, rates, 
+00006030: 6c69 6d69 7473 2061 6e64 206f 7468 6572  limits and other
+00006040: 2067 656e 6572 616c 206d 6172 6b65 7420   general market 
+00006050: 696e 666f 726d 6174 696f 6e2e 0a20 2020  information..   
+00006060: 2020 2020 2020 2020 2020 2020 2023 2054               # T
+00006070: 6865 2069 6e74 6572 6e61 6c20 696e 666f  he internal info
+00006080: 2061 7272 6179 2069 7320 6469 6666 6572   array is differ
+00006090: 656e 7420 666f 7220 6561 6368 2070 6172  ent for each par
+000060a0: 7469 6375 6c61 7220 6d61 726b 6574 2c0a  ticular market,.
+000060b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000060c0: 2320 6974 7320 636f 6e74 656e 7473 2064  # its contents d
+000060d0: 6570 656e 6420 6f6e 2074 6865 2065 7863  epend on the exc
+000060e0: 6861 6e67 652e 0a20 2020 2020 2020 2020  hange..         
+000060f0: 2020 2020 2020 2023 2049 7420 6361 6e20         # It can 
+00006100: 616c 736f 2062 6520 6120 7374 7269 6e67  also be a string
+00006110: 206f 7220 7369 6d69 6c61 7220 2e2e 2e20   or similar ... 
+00006120: 736f 2077 6520 6e65 6564 2074 6f20 7665  so we need to ve
+00006130: 7269 6679 2074 6861 7420 6669 7273 742e  rify that first.
+00006140: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00006150: 6620 2869 7369 6e73 7461 6e63 6528 7365  f (isinstance(se
+00006160: 6c66 2e6d 6172 6b65 7473 5b70 6169 725d  lf.markets[pair]
+00006170: 2e67 6574 2827 696e 666f 2729 2c20 6469  .get('info'), di
+00006180: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
+00006190: 2020 2020 2020 616e 6420 7365 6c66 2e6d        and self.m
+000061a0: 6172 6b65 7473 5b70 6169 725d 2e67 6574  arkets[pair].get
+000061b0: 2827 696e 666f 272c 207b 7d29 2e67 6574  ('info', {}).get
+000061c0: 2827 7072 6f68 6962 6974 6564 496e 272c  ('prohibitedIn',
+000061d0: 2046 616c 7365 2929 3a0a 2020 2020 2020   False)):.      
+000061e0: 2020 2020 2020 2020 2020 2320 5761 726e            # Warn
+000061f0: 2075 7365 7273 2061 626f 7574 2072 6573   users about res
+00006200: 7472 6963 7465 6420 7061 6972 7320 696e  tricted pairs in
+00006210: 2077 6869 7465 6c69 7374 2e0a 2020 2020   whitelist..    
+00006220: 2020 2020 2020 2020 2020 2020 2320 5765              # We
+00006230: 2063 616e 6e6f 7420 6465 7465 726d 696e   cannot determin
+00006240: 6520 7265 6c69 6162 6c79 2069 6620 5573  e reliably if Us
+00006250: 6572 7320 6172 6520 6166 6665 6374 6564  ers are affected
+00006260: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006270: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00006280: 2866 2250 6169 7220 7b70 6169 727d 2069  (f"Pair {pair} i
+00006290: 7320 7265 7374 7269 6374 6564 2066 6f72  s restricted for
+000062a0: 2073 6f6d 6520 7573 6572 7320 6f6e 2074   some users on t
+000062b0: 6869 7320 6578 6368 616e 6765 2e22 0a20  his exchange.". 
 000062c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062d0: 2020 2020 6622 506c 6561 7365 2063 6865      f"Please che
-000062e0: 636b 2069 6620 796f 7520 6172 6520 696d  ck if you are im
-000062f0: 7061 6374 6564 2062 7920 7468 6973 2072  pacted by this r
-00006300: 6573 7472 6963 7469 6f6e 2022 0a20 2020  estriction ".   
-00006310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006320: 2020 2020 2020 2020 2020 2020 6622 6f6e              f"on
-00006330: 2074 6865 2065 7863 6861 6e67 6520 616e   the exchange an
-00006340: 6420 6576 656e 7475 616c 6c79 2072 656d  d eventually rem
-00006350: 6f76 6520 7b70 6169 727d 2066 726f 6d20  ove {pair} from 
-00006360: 796f 7572 2077 6869 7465 6c69 7374 2e22  your whitelist."
-00006370: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00006380: 2028 7365 6c66 2e5f 636f 6e66 6967 5b27   (self._config['
-00006390: 7374 616b 655f 6375 7272 656e 6379 275d  stake_currency']
-000063a0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-000063b0: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
-000063c0: 745f 7061 6972 5f71 756f 7465 5f63 7572  t_pair_quote_cur
-000063d0: 7265 6e63 7928 7061 6972 2920 213d 2073  rency(pair) != s
-000063e0: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
-000063f0: 6b65 5f63 7572 7265 6e63 7927 5d29 3a0a  ke_currency']):.
-00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006410: 696e 7661 6c69 645f 7061 6972 732e 6170  invalid_pairs.ap
-00006420: 7065 6e64 2870 6169 7229 0a20 2020 2020  pend(pair).     
-00006430: 2020 2069 6620 696e 7661 6c69 645f 7061     if invalid_pa
-00006440: 6972 733a 0a20 2020 2020 2020 2020 2020  irs:.           
-00006450: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00006460: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
-00006470: 2020 2020 2020 2020 2020 2020 2066 2253               f"S
-00006480: 7461 6b65 2d63 7572 7265 6e63 7920 277b  take-currency '{
-00006490: 7365 6c66 2e5f 636f 6e66 6967 5b27 7374  self._config['st
-000064a0: 616b 655f 6375 7272 656e 6379 275d 7d27  ake_currency']}'
-000064b0: 206e 6f74 2063 6f6d 7061 7469 626c 6520   not compatible 
-000064c0: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
-000064d0: 2020 2020 2020 2066 2270 6169 722d 7768         f"pair-wh
-000064e0: 6974 656c 6973 742e 2050 6c65 6173 6520  itelist. Please 
-000064f0: 7265 6d6f 7665 2074 6865 2066 6f6c 6c6f  remove the follo
-00006500: 7769 6e67 2070 6169 7273 3a20 7b69 6e76  wing pairs: {inv
-00006510: 616c 6964 5f70 6169 7273 7d22 290a 0a20  alid_pairs}").. 
-00006520: 2020 2064 6566 2067 6574 5f76 616c 6964     def get_valid
-00006530: 5f70 6169 725f 636f 6d62 696e 6174 696f  _pair_combinatio
-00006540: 6e28 7365 6c66 2c20 6375 7272 5f31 3a20  n(self, curr_1: 
-00006550: 7374 722c 2063 7572 725f 323a 2073 7472  str, curr_2: str
-00006560: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00006570: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-00006580: 7420 7661 6c69 6420 7061 6972 2063 6f6d  t valid pair com
-00006590: 6269 6e61 7469 6f6e 206f 6620 6375 7272  bination of curr
-000065a0: 5f31 2061 6e64 2063 7572 725f 3220 6279  _1 and curr_2 by
-000065b0: 2074 7279 696e 6720 626f 7468 2063 6f6d   trying both com
-000065c0: 6269 6e61 7469 6f6e 732e 0a20 2020 2020  binations..     
-000065d0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-000065e0: 6f72 2070 6169 7220 696e 205b 6622 7b63  or pair in [f"{c
-000065f0: 7572 725f 317d 2f7b 6375 7272 5f32 7d22  urr_1}/{curr_2}"
-00006600: 2c20 6622 7b63 7572 725f 327d 2f7b 6375  , f"{curr_2}/{cu
-00006610: 7272 5f31 7d22 5d3a 0a20 2020 2020 2020  rr_1}"]:.       
-00006620: 2020 2020 2069 6620 7061 6972 2069 6e20       if pair in 
-00006630: 7365 6c66 2e6d 6172 6b65 7473 2061 6e64  self.markets and
-00006640: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
-00006650: 6972 5d2e 6765 7428 2761 6374 6976 6527  ir].get('active'
-00006660: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00006670: 2020 2072 6574 7572 6e20 7061 6972 0a20     return pair. 
-00006680: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00006690: 6861 6e67 6545 7272 6f72 2866 2243 6f75  hangeError(f"Cou
-000066a0: 6c64 206e 6f74 2063 6f6d 6269 6e65 207b  ld not combine {
-000066b0: 6375 7272 5f31 7d20 616e 6420 7b63 7572  curr_1} and {cur
-000066c0: 725f 327d 2074 6f20 6765 7420 6120 7661  r_2} to get a va
-000066d0: 6c69 6420 7061 6972 2e22 290a 0a20 2020  lid pair.")..   
-000066e0: 2064 6566 2076 616c 6964 6174 655f 7469   def validate_ti
-000066f0: 6d65 6672 616d 6573 2873 656c 662c 2074  meframes(self, t
-00006700: 696d 6566 7261 6d65 3a20 4f70 7469 6f6e  imeframe: Option
-00006710: 616c 5b73 7472 5d29 202d 3e20 4e6f 6e65  al[str]) -> None
-00006720: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00006730: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
-00006740: 696d 6566 7261 6d65 2066 726f 6d20 636f  imeframe from co
-00006750: 6e66 6967 2069 7320 6120 7375 7070 6f72  nfig is a suppor
-00006760: 7465 6420 7469 6d65 6672 616d 6520 6f6e  ted timeframe on
-00006770: 2074 6865 2065 7863 6861 6e67 650a 2020   the exchange.  
-00006780: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00006790: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-000067a0: 2873 656c 662e 5f61 7069 2c20 2274 696d  (self._api, "tim
-000067b0: 6566 7261 6d65 7322 2920 6f72 2073 656c  eframes") or sel
-000067c0: 662e 5f61 7069 2e74 696d 6566 7261 6d65  f._api.timeframe
-000067d0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-000067e0: 2020 2020 2020 2023 2049 6620 7469 6d65         # If time
-000067f0: 6672 616d 6573 2061 7474 7269 6275 7465  frames attribute
-00006800: 2069 7320 6d69 7373 696e 6720 286f 7220   is missing (or 
-00006810: 6973 204e 6f6e 6529 2c20 7468 6520 6578  is None), the ex
-00006820: 6368 616e 6765 2070 726f 6261 626c 790a  change probably.
-00006830: 2020 2020 2020 2020 2020 2020 2320 6861              # ha
-00006840: 7320 6e6f 2066 6574 6368 4f48 4c43 5620  s no fetchOHLCV 
-00006850: 6d65 7468 6f64 2e0a 2020 2020 2020 2020  method..        
-00006860: 2020 2020 2320 5468 6572 6566 6f72 6520      # Therefore 
-00006870: 7765 2061 6c73 6f20 7368 6f77 2074 6861  we also show tha
-00006880: 742e 0a20 2020 2020 2020 2020 2020 2072  t..            r
-00006890: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-000068a0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-000068b0: 2020 2020 2020 2020 2020 2066 2254 6865             f"The
-000068c0: 2063 6378 7420 6c69 6272 6172 7920 646f   ccxt library do
-000068d0: 6573 206e 6f74 2070 726f 7669 6465 2074  es not provide t
-000068e0: 6865 206c 6973 7420 6f66 2074 696d 6566  he list of timef
-000068f0: 7261 6d65 7320 220a 2020 2020 2020 2020  rames ".        
-00006900: 2020 2020 2020 2020 6622 666f 7220 7468          f"for th
-00006910: 6520 6578 6368 616e 6765 207b 7365 6c66  e exchange {self
-00006920: 2e6e 616d 657d 2061 6e64 2074 6869 7320  .name} and this 
-00006930: 6578 6368 616e 6765 2022 0a20 2020 2020  exchange ".     
-00006940: 2020 2020 2020 2020 2020 2066 2269 7320             f"is 
-00006950: 7468 6572 6566 6f72 6520 6e6f 7420 7375  therefore not su
-00006960: 7070 6f72 7465 642e 2063 6378 7420 6665  pported. ccxt fe
-00006970: 7463 684f 484c 4356 3a20 7b73 656c 662e  tchOHLCV: {self.
-00006980: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
-00006990: 7463 684f 484c 4356 2729 7d22 290a 0a20  tchOHLCV')}").. 
-000069a0: 2020 2020 2020 2069 6620 7469 6d65 6672         if timefr
-000069b0: 616d 6520 616e 6420 2874 696d 6566 7261  ame and (timefra
-000069c0: 6d65 206e 6f74 2069 6e20 7365 6c66 2e74  me not in self.t
-000069d0: 696d 6566 7261 6d65 7329 3a0a 2020 2020  imeframes):.    
-000069e0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-000069f0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00006a00: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00006a10: 2020 2020 6622 496e 7661 6c69 6420 7469      f"Invalid ti
-00006a20: 6d65 6672 616d 6520 277b 7469 6d65 6672  meframe '{timefr
-00006a30: 616d 657d 272e 2054 6869 7320 6578 6368  ame}'. This exch
-00006a40: 616e 6765 2073 7570 706f 7274 733a 207b  ange supports: {
-00006a50: 7365 6c66 2e74 696d 6566 7261 6d65 737d  self.timeframes}
-00006a60: 2229 0a0a 2020 2020 2020 2020 6966 2074  ")..        if t
-00006a70: 696d 6566 7261 6d65 2061 6e64 2074 696d  imeframe and tim
-00006a80: 6566 7261 6d65 5f74 6f5f 6d69 6e75 7465  eframe_to_minute
-00006a90: 7328 7469 6d65 6672 616d 6529 203c 2031  s(timeframe) < 1
-00006aa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00006ab0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00006ac0: 7863 6570 7469 6f6e 2822 5469 6d65 6672  xception("Timefr
-00006ad0: 616d 6573 203c 2031 6d20 6172 6520 6375  ames < 1m are cu
-00006ae0: 7272 656e 746c 7920 6e6f 7420 7375 7070  rrently not supp
-00006af0: 6f72 7465 6420 6279 2046 7265 7174 7261  orted by Freqtra
-00006b00: 6465 2e22 290a 0a20 2020 2064 6566 2076  de.")..    def v
-00006b10: 616c 6964 6174 655f 6f72 6465 7274 7970  alidate_ordertyp
-00006b20: 6573 2873 656c 662c 206f 7264 6572 5f74  es(self, order_t
-00006b30: 7970 6573 3a20 4469 6374 2920 2d3e 204e  ypes: Dict) -> N
-00006b40: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00006b50: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-00006b60: 6966 206f 7264 6572 2d74 7970 6573 2063  if order-types c
-00006b70: 6f6e 6669 6775 7265 6420 696e 2073 7472  onfigured in str
-00006b80: 6174 6567 792f 636f 6e66 6967 2061 7265  ategy/config are
-00006b90: 2073 7570 706f 7274 6564 0a20 2020 2020   supported.     
-00006ba0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00006bb0: 6620 616e 7928 7620 3d3d 2027 6d61 726b  f any(v == 'mark
-00006bc0: 6574 2720 666f 7220 6b2c 2076 2069 6e20  et' for k, v in 
-00006bd0: 6f72 6465 725f 7479 7065 732e 6974 656d  order_types.item
-00006be0: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-00006bf0: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
-00006c00: 6368 616e 6765 5f68 6173 2827 6372 6561  change_has('crea
-00006c10: 7465 4d61 726b 6574 4f72 6465 7227 293a  teMarketOrder'):
-00006c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006c30: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00006c40: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
-00006c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c60: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
-00006c70: 662e 6e61 6d65 7d20 646f 6573 206e 6f74  f.name} does not
-00006c80: 2073 7570 706f 7274 206d 6172 6b65 7420   support market 
-00006c90: 6f72 6465 7273 2e27 290a 2020 2020 2020  orders.').      
-00006ca0: 2020 7365 6c66 2e76 616c 6964 6174 655f    self.validate_
-00006cb0: 7374 6f70 5f6f 7264 6572 7479 7065 7328  stop_ordertypes(
-00006cc0: 6f72 6465 725f 7479 7065 7329 0a0a 2020  order_types)..  
-00006cd0: 2020 6465 6620 7661 6c69 6461 7465 5f73    def validate_s
-00006ce0: 746f 705f 6f72 6465 7274 7970 6573 2873  top_ordertypes(s
-00006cf0: 656c 662c 206f 7264 6572 5f74 7970 6573  elf, order_types
-00006d00: 3a20 4469 6374 2920 2d3e 204e 6f6e 653a  : Dict) -> None:
-00006d10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00006d20: 2020 2020 2056 616c 6964 6174 6520 7374       Validate st
-00006d30: 6f70 6c6f 7373 206f 7264 6572 2074 7970  oploss order typ
-00006d40: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-00006d50: 2020 2020 2020 2069 6620 286f 7264 6572         if (order
-00006d60: 5f74 7970 6573 2e67 6574 2822 7374 6f70  _types.get("stop
-00006d70: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
-00006d80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00006d90: 2020 2061 6e64 206e 6f74 2073 656c 662e     and not self.
-00006da0: 5f66 745f 6861 732e 6765 7428 2273 746f  _ft_has.get("sto
-00006db0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
-00006dc0: 6522 2c20 4661 6c73 6529 293a 0a20 2020  e", False)):.   
-00006dd0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00006de0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00006df0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-00006e00: 2020 2020 2066 274f 6e20 6578 6368 616e       f'On exchan
-00006e10: 6765 2073 746f 706c 6f73 7320 6973 206e  ge stoploss is n
-00006e20: 6f74 2073 7570 706f 7274 6564 2066 6f72  ot supported for
-00006e30: 207b 7365 6c66 2e6e 616d 657d 2e27 0a20   {self.name}.'. 
-00006e40: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00006e50: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
-00006e60: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
-00006e70: 6469 6e67 4d6f 6465 2e46 5554 5552 4553  dingMode.FUTURES
-00006e80: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00006e90: 6963 655f 6d61 7070 696e 6720 3d20 7365  ice_mapping = se
-00006ea0: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
-00006eb0: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
-00006ec0: 7661 6c75 655f 6d61 7070 696e 6727 2c20  value_mapping', 
-00006ed0: 7b7d 292e 6b65 7973 2829 0a20 2020 2020  {}).keys().     
-00006ee0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00006ef0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-00006f00: 725f 7479 7065 732e 6765 7428 2273 746f  r_types.get("sto
-00006f10: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
-00006f20: 6522 2c20 4661 6c73 6529 2069 7320 5472  e", False) is Tr
-00006f30: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00006f40: 2020 2061 6e64 2027 7374 6f70 6c6f 7373     and 'stoploss
-00006f50: 5f70 7269 6365 5f74 7970 6527 2069 6e20  _price_type' in 
-00006f60: 6f72 6465 725f 7479 7065 730a 2020 2020  order_types.    
-00006f70: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00006f80: 6f72 6465 725f 7479 7065 735b 2773 746f  order_types['sto
-00006f90: 706c 6f73 735f 7072 6963 655f 7479 7065  ploss_price_type
-00006fa0: 275d 206e 6f74 2069 6e20 7072 6963 655f  '] not in price_
-00006fb0: 6d61 7070 696e 670a 2020 2020 2020 2020  mapping.        
-00006fc0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00006fd0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00006fe0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00006ff0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00007000: 2020 2020 2020 2066 274f 6e20 6578 6368         f'On exch
-00007010: 616e 6765 2073 746f 706c 6f73 7320 7072  ange stoploss pr
-00007020: 6963 6520 7479 7065 2069 7320 6e6f 7420  ice type is not 
-00007030: 7375 7070 6f72 7465 6420 666f 7220 7b73  supported for {s
-00007040: 656c 662e 6e61 6d65 7d2e 270a 2020 2020  elf.name}.'.    
-00007050: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00007060: 2020 2064 6566 2076 616c 6964 6174 655f     def validate_
-00007070: 7072 6963 696e 6728 7365 6c66 2c20 7072  pricing(self, pr
-00007080: 6963 696e 673a 2044 6963 7429 202d 3e20  icing: Dict) -> 
-00007090: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-000070a0: 2070 7269 6369 6e67 2e67 6574 2827 7573   pricing.get('us
-000070b0: 655f 6f72 6465 725f 626f 6f6b 272c 2046  e_order_book', F
-000070c0: 616c 7365 2920 616e 6420 6e6f 7420 7365  alse) and not se
-000070d0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-000070e0: 2766 6574 6368 4c32 4f72 6465 7242 6f6f  'fetchL2OrderBoo
-000070f0: 6b27 293a 0a20 2020 2020 2020 2020 2020  k'):.           
-00007100: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00007110: 616c 4578 6365 7074 696f 6e28 6627 4f72  alException(f'Or
-00007120: 6465 7262 6f6f 6b20 6e6f 7420 6176 6169  derbook not avai
-00007130: 6c61 626c 6520 666f 7220 7b73 656c 662e  lable for {self.
-00007140: 6e61 6d65 7d2e 2729 0a20 2020 2020 2020  name}.').       
-00007150: 2069 6620 286e 6f74 2070 7269 6369 6e67   if (not pricing
-00007160: 2e67 6574 2827 7573 655f 6f72 6465 725f  .get('use_order_
-00007170: 626f 6f6b 272c 2046 616c 7365 2920 616e  book', False) an
-00007180: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
-00007190: 2020 2020 6e6f 7420 7365 6c66 2e65 7863      not self.exc
-000071a0: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
-000071b0: 5469 636b 6572 2729 0a20 2020 2020 2020  Ticker').       
-000071c0: 2020 2020 2020 2020 206f 7220 6e6f 7420           or not 
-000071d0: 7365 6c66 2e5f 6674 5f68 6173 5b27 7469  self._ft_has['ti
-000071e0: 636b 6572 735f 6861 7665 5f70 7269 6365  ckers_have_price
-000071f0: 275d 2929 3a0a 2020 2020 2020 2020 2020  '])):.          
-00007200: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00007210: 6e61 6c45 7863 6570 7469 6f6e 2866 2754  nalException(f'T
-00007220: 6963 6b65 7220 7072 6963 696e 6720 6e6f  icker pricing no
-00007230: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
-00007240: 7b73 656c 662e 6e61 6d65 7d2e 2729 0a0a  {self.name}.')..
-00007250: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
-00007260: 5f6f 7264 6572 5f74 696d 655f 696e 5f66  _order_time_in_f
-00007270: 6f72 6365 2873 656c 662c 206f 7264 6572  orce(self, order
-00007280: 5f74 696d 655f 696e 5f66 6f72 6365 3a20  _time_in_force: 
-00007290: 4469 6374 2920 2d3e 204e 6f6e 653a 0a20  Dict) -> None:. 
-000072a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000072b0: 2020 2043 6865 636b 7320 6966 206f 7264     Checks if ord
-000072c0: 6572 2074 696d 6520 696e 2066 6f72 6365  er time in force
-000072d0: 2063 6f6e 6669 6775 7265 6420 696e 2073   configured in s
-000072e0: 7472 6174 6567 792f 636f 6e66 6967 2061  trategy/config a
-000072f0: 7265 2073 7570 706f 7274 6564 0a20 2020  re supported.   
-00007300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00007310: 2069 6620 616e 7928 762e 7570 7065 7228   if any(v.upper(
-00007320: 2920 6e6f 7420 696e 2073 656c 662e 5f66  ) not in self._f
-00007330: 745f 6861 735b 226f 7264 6572 5f74 696d  t_has["order_tim
-00007340: 655f 696e 5f66 6f72 6365 225d 0a20 2020  e_in_force"].   
-00007350: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00007360: 6b2c 2076 2069 6e20 6f72 6465 725f 7469  k, v in order_ti
-00007370: 6d65 5f69 6e5f 666f 7263 652e 6974 656d  me_in_force.item
-00007380: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-00007390: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-000073a0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-000073b0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-000073c0: 5469 6d65 2069 6e20 666f 7263 6520 706f  Time in force po
-000073d0: 6c69 6369 6573 2061 7265 206e 6f74 2073  licies are not s
-000073e0: 7570 706f 7274 6564 2066 6f72 207b 7365  upported for {se
-000073f0: 6c66 2e6e 616d 657d 2079 6574 2e27 290a  lf.name} yet.').
-00007400: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-00007410: 655f 7265 7175 6972 6564 5f73 7461 7274  e_required_start
-00007420: 7570 5f63 616e 646c 6573 2873 656c 662c  up_candles(self,
-00007430: 2073 7461 7274 7570 5f63 616e 646c 6573   startup_candles
-00007440: 3a20 696e 742c 2074 696d 6566 7261 6d65  : int, timeframe
-00007450: 3a20 7374 7229 202d 3e20 696e 743a 0a20  : str) -> int:. 
-00007460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00007470: 2020 2043 6865 636b 7320 6966 2072 6571     Checks if req
-00007480: 7569 7265 6420 7374 6172 7475 705f 6361  uired startup_ca
-00007490: 6e64 6c65 7320 6973 206d 6f72 6520 7468  ndles is more th
-000074a0: 616e 206f 686c 6376 5f63 616e 646c 655f  an ohlcv_candle_
-000074b0: 6c69 6d69 7428 292e 0a20 2020 2020 2020  limit()..       
-000074c0: 2052 6571 7569 7265 7320 6120 6772 6163   Requires a grac
-000074d0: 652d 7065 7269 6f64 206f 6620 3520 6361  e-period of 5 ca
-000074e0: 6e64 6c65 7320 2d20 736f 2061 2073 7461  ndles - so a sta
-000074f0: 7274 7570 2d70 6572 696f 6420 7570 2074  rtup-period up t
-00007500: 6f20 3439 3420 6973 2061 6c6c 6f77 6564  o 494 is allowed
-00007510: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
-00007520: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00007530: 2020 6361 6e64 6c65 5f6c 696d 6974 203d    candle_limit =
-00007540: 2073 656c 662e 6f68 6c63 765f 6361 6e64   self.ohlcv_cand
-00007550: 6c65 5f6c 696d 6974 280a 2020 2020 2020  le_limit(.      
-00007560: 2020 2020 2020 7469 6d65 6672 616d 652c        timeframe,
-00007570: 2073 656c 662e 5f63 6f6e 6669 675b 2763   self._config['c
-00007580: 616e 646c 655f 7479 7065 5f64 6566 275d  andle_type_def']
-00007590: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
-000075a0: 7428 6461 7465 5f6d 696e 7573 5f63 616e  t(date_minus_can
-000075b0: 646c 6573 2874 696d 6566 7261 6d65 2c20  dles(timeframe, 
-000075c0: 7374 6172 7475 705f 6361 6e64 6c65 7329  startup_candles)
-000075d0: 2e74 696d 6573 7461 6d70 2829 202a 2031  .timestamp() * 1
-000075e0: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
-000075f0: 2069 6620 7469 6d65 6672 616d 6520 656c   if timeframe el
-00007600: 7365 204e 6f6e 6529 0a20 2020 2020 2020  se None).       
-00007610: 2023 2052 6571 7569 7265 206f 6e65 206d   # Require one m
-00007620: 6f72 6520 6361 6e64 6c65 202d 2074 6f20  ore candle - to 
-00007630: 6163 636f 756e 7420 666f 7220 7468 6520  account for the 
-00007640: 7374 696c 6c20 6f70 656e 2063 616e 646c  still open candl
-00007650: 652e 0a20 2020 2020 2020 2063 616e 646c  e..        candl
-00007660: 655f 636f 756e 7420 3d20 7374 6172 7475  e_count = startu
-00007670: 705f 6361 6e64 6c65 7320 2b20 310a 2020  p_candles + 1.  
-00007680: 2020 2020 2020 2320 416c 6c6f 7720 3520        # Allow 5 
-00007690: 6361 6c6c 7320 746f 2074 6865 2065 7863  calls to the exc
-000076a0: 6861 6e67 6520 7065 7220 7061 6972 0a20  hange per pair. 
-000076b0: 2020 2020 2020 2072 6571 7569 7265 645f         required_
-000076c0: 6361 6e64 6c65 5f63 616c 6c5f 636f 756e  candle_call_coun
-000076d0: 7420 3d20 696e 7428 0a20 2020 2020 2020  t = int(.       
-000076e0: 2020 2020 2028 6361 6e64 6c65 5f63 6f75       (candle_cou
-000076f0: 6e74 202f 2063 616e 646c 655f 6c69 6d69  nt / candle_limi
-00007700: 7429 202b 2028 3020 6966 2063 616e 646c  t) + (0 if candl
-00007710: 655f 636f 756e 7420 2520 6361 6e64 6c65  e_count % candle
-00007720: 5f6c 696d 6974 203d 3d20 3020 656c 7365  _limit == 0 else
-00007730: 2031 2929 0a20 2020 2020 2020 2069 6620   1)).        if 
-00007740: 7365 6c66 2e5f 6674 5f68 6173 5b27 6f68  self._ft_has['oh
-00007750: 6c63 765f 6861 735f 6869 7374 6f72 7927  lcv_has_history'
-00007760: 5d3a 0a0a 2020 2020 2020 2020 2020 2020  ]:..            
-00007770: 6966 2072 6571 7569 7265 645f 6361 6e64  if required_cand
-00007780: 6c65 5f63 616c 6c5f 636f 756e 7420 3e20  le_call_count > 
-00007790: 353a 0a20 2020 2020 2020 2020 2020 2020  5:.             
-000077a0: 2020 2023 204f 6e6c 7920 616c 6c6f 7720     # Only allow 
-000077b0: 3520 6361 6c6c 7320 7065 7220 7061 6972  5 calls per pair
-000077c0: 2074 6f20 736f 6d65 7768 6174 206c 696d   to somewhat lim
-000077d0: 6974 2074 6865 2069 6d70 6163 740a 2020  it the impact.  
-000077e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000077f0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00007800: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-00007810: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00007820: 5468 6973 2073 7472 6174 6567 7920 7265  This strategy re
-00007830: 7175 6972 6573 207b 7374 6172 7475 705f  quires {startup_
-00007840: 6361 6e64 6c65 737d 2063 616e 646c 6573  candles} candles
-00007850: 2074 6f20 7374 6172 742c 2022 0a20 2020   to start, ".   
-00007860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007870: 2022 7768 6963 6820 6973 206d 6f72 6520   "which is more 
-00007880: 7468 616e 2035 7820 220a 2020 2020 2020  than 5x ".      
-00007890: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000078a0: 7468 6520 616d 6f75 6e74 206f 6620 6361  the amount of ca
-000078b0: 6e64 6c65 7320 7b73 656c 662e 6e61 6d65  ndles {self.name
-000078c0: 7d20 7072 6f76 6964 6573 2066 6f72 207b  } provides for {
-000078d0: 7469 6d65 6672 616d 657d 2e22 290a 2020  timeframe}.").  
-000078e0: 2020 2020 2020 656c 6966 2072 6571 7569        elif requi
-000078f0: 7265 645f 6361 6e64 6c65 5f63 616c 6c5f  red_candle_call_
-00007900: 636f 756e 7420 3e20 313a 0a20 2020 2020  count > 1:.     
-00007910: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00007920: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00007930: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00007940: 2020 2066 2254 6869 7320 7374 7261 7465     f"This strate
-00007950: 6779 2072 6571 7569 7265 7320 7b73 7461  gy requires {sta
-00007960: 7274 7570 5f63 616e 646c 6573 7d20 6361  rtup_candles} ca
-00007970: 6e64 6c65 7320 746f 2073 7461 7274 2c20  ndles to start, 
-00007980: 7768 6963 6820 6973 206d 6f72 6520 7468  which is more th
-00007990: 616e 2022 0a20 2020 2020 2020 2020 2020  an ".           
-000079a0: 2020 2020 2066 2274 6865 2061 6d6f 756e       f"the amoun
-000079b0: 7420 6f66 2063 616e 646c 6573 207b 7365  t of candles {se
-000079c0: 6c66 2e6e 616d 657d 2070 726f 7669 6465  lf.name} provide
-000079d0: 7320 666f 7220 7b74 696d 6566 7261 6d65  s for {timeframe
-000079e0: 7d2e 2229 0a20 2020 2020 2020 2069 6620  }.").        if 
-000079f0: 7265 7175 6972 6564 5f63 616e 646c 655f  required_candle_
-00007a00: 6361 6c6c 5f63 6f75 6e74 203e 2031 3a0a  call_count > 1:.
-00007a10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00007a20: 6572 2e77 6172 6e69 6e67 2866 2255 7369  er.warning(f"Usi
-00007a30: 6e67 207b 7265 7175 6972 6564 5f63 616e  ng {required_can
-00007a40: 646c 655f 6361 6c6c 5f63 6f75 6e74 7d20  dle_call_count} 
-00007a50: 6361 6c6c 7320 746f 2067 6574 204f 484c  calls to get OHL
-00007a60: 4356 2e20 220a 2020 2020 2020 2020 2020  CV. ".          
+000062d0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000062e0: 506c 6561 7365 2063 6865 636b 2069 6620  Please check if 
+000062f0: 796f 7520 6172 6520 696d 7061 6374 6564  you are impacted
+00006300: 2062 7920 7468 6973 2072 6573 7472 6963   by this restric
+00006310: 7469 6f6e 2022 0a20 2020 2020 2020 2020  tion ".         
+00006320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006330: 2020 2020 2020 6622 6f6e 2074 6865 2065        f"on the e
+00006340: 7863 6861 6e67 6520 616e 6420 6576 656e  xchange and even
+00006350: 7475 616c 6c79 2072 656d 6f76 6520 7b70  tually remove {p
+00006360: 6169 727d 2066 726f 6d20 796f 7572 2077  air} from your w
+00006370: 6869 7465 6c69 7374 2e22 290a 2020 2020  hitelist.").    
+00006380: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+00006390: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
+000063a0: 6375 7272 656e 6379 275d 2061 6e64 0a20  currency'] and. 
+000063b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063c0: 2020 2073 656c 662e 6765 745f 7061 6972     self.get_pair
+000063d0: 5f71 756f 7465 5f63 7572 7265 6e63 7928  _quote_currency(
+000063e0: 7061 6972 2920 213d 2073 656c 662e 5f63  pair) != self._c
+000063f0: 6f6e 6669 675b 2773 7461 6b65 5f63 7572  onfig['stake_cur
+00006400: 7265 6e63 7927 5d29 3a0a 2020 2020 2020  rency']):.      
+00006410: 2020 2020 2020 2020 2020 696e 7661 6c69            invali
+00006420: 645f 7061 6972 732e 6170 7065 6e64 2870  d_pairs.append(p
+00006430: 6169 7229 0a20 2020 2020 2020 2069 6620  air).        if 
+00006440: 696e 7661 6c69 645f 7061 6972 733a 0a20  invalid_pairs:. 
+00006450: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00006460: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00006470: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+00006480: 2020 2020 2020 2066 2253 7461 6b65 2d63         f"Stake-c
+00006490: 7572 7265 6e63 7920 277b 7365 6c66 2e5f  urrency '{self._
+000064a0: 636f 6e66 6967 5b27 7374 616b 655f 6375  config['stake_cu
+000064b0: 7272 656e 6379 275d 7d27 206e 6f74 2063  rrency']}' not c
+000064c0: 6f6d 7061 7469 626c 6520 7769 7468 2022  ompatible with "
+000064d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000064e0: 2066 2270 6169 722d 7768 6974 656c 6973   f"pair-whitelis
+000064f0: 742e 2050 6c65 6173 6520 7265 6d6f 7665  t. Please remove
+00006500: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
+00006510: 6169 7273 3a20 7b69 6e76 616c 6964 5f70  airs: {invalid_p
+00006520: 6169 7273 7d22 290a 0a20 2020 2064 6566  airs}")..    def
+00006530: 2067 6574 5f76 616c 6964 5f70 6169 725f   get_valid_pair_
+00006540: 636f 6d62 696e 6174 696f 6e28 7365 6c66  combination(self
+00006550: 2c20 6375 7272 5f31 3a20 7374 722c 2063  , curr_1: str, c
+00006560: 7572 725f 323a 2073 7472 2920 2d3e 2073  urr_2: str) -> s
+00006570: 7472 3a0a 2020 2020 2020 2020 2222 220a  tr:.        """.
+00006580: 2020 2020 2020 2020 4765 7420 7661 6c69          Get vali
+00006590: 6420 7061 6972 2063 6f6d 6269 6e61 7469  d pair combinati
+000065a0: 6f6e 206f 6620 6375 7272 5f31 2061 6e64  on of curr_1 and
+000065b0: 2063 7572 725f 3220 6279 2074 7279 696e   curr_2 by tryin
+000065c0: 6720 626f 7468 2063 6f6d 6269 6e61 7469  g both combinati
+000065d0: 6f6e 732e 0a20 2020 2020 2020 2022 2222  ons..        """
+000065e0: 0a20 2020 2020 2020 2066 6f72 2070 6169  .        for pai
+000065f0: 7220 696e 205b 6622 7b63 7572 725f 317d  r in [f"{curr_1}
+00006600: 2f7b 6375 7272 5f32 7d22 2c20 6622 7b63  /{curr_2}", f"{c
+00006610: 7572 725f 327d 2f7b 6375 7272 5f31 7d22  urr_2}/{curr_1}"
+00006620: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
+00006630: 6620 7061 6972 2069 6e20 7365 6c66 2e6d  f pair in self.m
+00006640: 6172 6b65 7473 2061 6e64 2073 656c 662e  arkets and self.
+00006650: 6d61 726b 6574 735b 7061 6972 5d2e 6765  markets[pair].ge
+00006660: 7428 2761 6374 6976 6527 293a 0a20 2020  t('active'):.   
+00006670: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00006680: 7572 6e20 7061 6972 0a20 2020 2020 2020  urn pair.       
+00006690: 2072 6169 7365 2045 7863 6861 6e67 6545   raise ExchangeE
+000066a0: 7272 6f72 2866 2243 6f75 6c64 206e 6f74  rror(f"Could not
+000066b0: 2063 6f6d 6269 6e65 207b 6375 7272 5f31   combine {curr_1
+000066c0: 7d20 616e 6420 7b63 7572 725f 327d 2074  } and {curr_2} t
+000066d0: 6f20 6765 7420 6120 7661 6c69 6420 7061  o get a valid pa
+000066e0: 6972 2e22 290a 0a20 2020 2064 6566 2076  ir.")..    def v
+000066f0: 616c 6964 6174 655f 7469 6d65 6672 616d  alidate_timefram
+00006700: 6573 2873 656c 662c 2074 696d 6566 7261  es(self, timefra
+00006710: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
+00006720: 5d29 202d 3e20 4e6f 6e65 3a0a 2020 2020  ]) -> None:.    
+00006730: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00006740: 4368 6563 6b20 6966 2074 696d 6566 7261  Check if timefra
+00006750: 6d65 2066 726f 6d20 636f 6e66 6967 2069  me from config i
+00006760: 7320 6120 7375 7070 6f72 7465 6420 7469  s a supported ti
+00006770: 6d65 6672 616d 6520 6f6e 2074 6865 2065  meframe on the e
+00006780: 7863 6861 6e67 650a 2020 2020 2020 2020  xchange.        
+00006790: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+000067a0: 6f74 2068 6173 6174 7472 2873 656c 662e  ot hasattr(self.
+000067b0: 5f61 7069 2c20 2274 696d 6566 7261 6d65  _api, "timeframe
+000067c0: 7322 2920 6f72 2073 656c 662e 5f61 7069  s") or self._api
+000067d0: 2e74 696d 6566 7261 6d65 7320 6973 204e  .timeframes is N
+000067e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000067f0: 2023 2049 6620 7469 6d65 6672 616d 6573   # If timeframes
+00006800: 2061 7474 7269 6275 7465 2069 7320 6d69   attribute is mi
+00006810: 7373 696e 6720 286f 7220 6973 204e 6f6e  ssing (or is Non
+00006820: 6529 2c20 7468 6520 6578 6368 616e 6765  e), the exchange
+00006830: 2070 726f 6261 626c 790a 2020 2020 2020   probably.      
+00006840: 2020 2020 2020 2320 6861 7320 6e6f 2066        # has no f
+00006850: 6574 6368 4f48 4c43 5620 6d65 7468 6f64  etchOHLCV method
+00006860: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00006870: 5468 6572 6566 6f72 6520 7765 2061 6c73  Therefore we als
+00006880: 6f20 7368 6f77 2074 6861 742e 0a20 2020  o show that..   
+00006890: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+000068a0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+000068b0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+000068c0: 2020 2020 2066 2254 6865 2063 6378 7420       f"The ccxt 
+000068d0: 6c69 6272 6172 7920 646f 6573 206e 6f74  library does not
+000068e0: 2070 726f 7669 6465 2074 6865 206c 6973   provide the lis
+000068f0: 7420 6f66 2074 696d 6566 7261 6d65 7320  t of timeframes 
+00006900: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00006910: 2020 6622 666f 7220 7468 6520 6578 6368    f"for the exch
+00006920: 616e 6765 207b 7365 6c66 2e6e 616d 657d  ange {self.name}
+00006930: 2061 6e64 2074 6869 7320 6578 6368 616e   and this exchan
+00006940: 6765 2022 0a20 2020 2020 2020 2020 2020  ge ".           
+00006950: 2020 2020 2066 2269 7320 7468 6572 6566       f"is theref
+00006960: 6f72 6520 6e6f 7420 7375 7070 6f72 7465  ore not supporte
+00006970: 642e 2063 6378 7420 6665 7463 684f 484c  d. ccxt fetchOHL
+00006980: 4356 3a20 7b73 656c 662e 6578 6368 616e  CV: {self.exchan
+00006990: 6765 5f68 6173 2827 6665 7463 684f 484c  ge_has('fetchOHL
+000069a0: 4356 2729 7d22 290a 0a20 2020 2020 2020  CV')}")..       
+000069b0: 2069 6620 7469 6d65 6672 616d 6520 616e   if timeframe an
+000069c0: 6420 2874 696d 6566 7261 6d65 206e 6f74  d (timeframe not
+000069d0: 2069 6e20 7365 6c66 2e74 696d 6566 7261   in self.timefra
+000069e0: 6d65 7329 3a0a 2020 2020 2020 2020 2020  mes):.          
+000069f0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00006a00: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
+00006a10: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00006a20: 496e 7661 6c69 6420 7469 6d65 6672 616d  Invalid timefram
+00006a30: 6520 277b 7469 6d65 6672 616d 657d 272e  e '{timeframe}'.
+00006a40: 2054 6869 7320 6578 6368 616e 6765 2073   This exchange s
+00006a50: 7570 706f 7274 733a 207b 7365 6c66 2e74  upports: {self.t
+00006a60: 696d 6566 7261 6d65 737d 2229 0a0a 2020  imeframes}")..  
+00006a70: 2020 2020 2020 6966 2074 696d 6566 7261        if timefra
+00006a80: 6d65 2061 6e64 2074 696d 6566 7261 6d65  me and timeframe
+00006a90: 5f74 6f5f 6d69 6e75 7465 7328 7469 6d65  _to_minutes(time
+00006aa0: 6672 616d 6529 203c 2031 3a0a 2020 2020  frame) < 1:.    
+00006ab0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00006ac0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00006ad0: 6f6e 2822 5469 6d65 6672 616d 6573 203c  on("Timeframes <
+00006ae0: 2031 6d20 6172 6520 6375 7272 656e 746c   1m are currentl
+00006af0: 7920 6e6f 7420 7375 7070 6f72 7465 6420  y not supported 
+00006b00: 6279 2046 7265 7174 7261 6465 2e22 290a  by Freqtrade.").
+00006b10: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
+00006b20: 655f 6f72 6465 7274 7970 6573 2873 656c  e_ordertypes(sel
+00006b30: 662c 206f 7264 6572 5f74 7970 6573 3a20  f, order_types: 
+00006b40: 4469 6374 2920 2d3e 204e 6f6e 653a 0a20  Dict) -> None:. 
+00006b50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006b60: 2020 2043 6865 636b 7320 6966 206f 7264     Checks if ord
+00006b70: 6572 2d74 7970 6573 2063 6f6e 6669 6775  er-types configu
+00006b80: 7265 6420 696e 2073 7472 6174 6567 792f  red in strategy/
+00006b90: 636f 6e66 6967 2061 7265 2073 7570 706f  config are suppo
+00006ba0: 7274 6564 0a20 2020 2020 2020 2022 2222  rted.        """
+00006bb0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00006bc0: 7620 3d3d 2027 6d61 726b 6574 2720 666f  v == 'market' fo
+00006bd0: 7220 6b2c 2076 2069 6e20 6f72 6465 725f  r k, v in order_
+00006be0: 7479 7065 732e 6974 656d 7328 2929 3a0a  types.items()):.
+00006bf0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00006c00: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
+00006c10: 5f68 6173 2827 6372 6561 7465 4d61 726b  _has('createMark
+00006c20: 6574 4f72 6465 7227 293a 0a20 2020 2020  etOrder'):.     
+00006c30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00006c40: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00006c50: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+00006c60: 2020 2020 2020 2020 2020 2066 2745 7863             f'Exc
+00006c70: 6861 6e67 6520 7b73 656c 662e 6e61 6d65  hange {self.name
+00006c80: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
+00006c90: 7274 206d 6172 6b65 7420 6f72 6465 7273  rt market orders
+00006ca0: 2e27 290a 2020 2020 2020 2020 7365 6c66  .').        self
+00006cb0: 2e76 616c 6964 6174 655f 7374 6f70 5f6f  .validate_stop_o
+00006cc0: 7264 6572 7479 7065 7328 6f72 6465 725f  rdertypes(order_
+00006cd0: 7479 7065 7329 0a0a 2020 2020 6465 6620  types)..    def 
+00006ce0: 7661 6c69 6461 7465 5f73 746f 705f 6f72  validate_stop_or
+00006cf0: 6465 7274 7970 6573 2873 656c 662c 206f  dertypes(self, o
+00006d00: 7264 6572 5f74 7970 6573 3a20 4469 6374  rder_types: Dict
+00006d10: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00006d20: 2020 2022 2222 0a20 2020 2020 2020 2056     """.        V
+00006d30: 616c 6964 6174 6520 7374 6f70 6c6f 7373  alidate stoploss
+00006d40: 206f 7264 6572 2074 7970 6573 0a20 2020   order types.   
+00006d50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00006d60: 2069 6620 286f 7264 6572 5f74 7970 6573   if (order_types
+00006d70: 2e67 6574 2822 7374 6f70 6c6f 7373 5f6f  .get("stoploss_o
+00006d80: 6e5f 6578 6368 616e 6765 2229 0a20 2020  n_exchange").   
+00006d90: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00006da0: 206e 6f74 2073 656c 662e 5f66 745f 6861   not self._ft_ha
+00006db0: 732e 6765 7428 2273 746f 706c 6f73 735f  s.get("stoploss_
+00006dc0: 6f6e 5f65 7863 6861 6e67 6522 2c20 4661  on_exchange", Fa
+00006dd0: 6c73 6529 293a 0a20 2020 2020 2020 2020  lse)):.         
+00006de0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00006df0: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
+00006e00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006e10: 274f 6e20 6578 6368 616e 6765 2073 746f  'On exchange sto
+00006e20: 706c 6f73 7320 6973 206e 6f74 2073 7570  ploss is not sup
+00006e30: 706f 7274 6564 2066 6f72 207b 7365 6c66  ported for {self
+00006e40: 2e6e 616d 657d 2e27 0a20 2020 2020 2020  .name}.'.       
+00006e50: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00006e60: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
+00006e70: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00006e80: 6465 2e46 5554 5552 4553 3a0a 2020 2020  de.FUTURES:.    
+00006e90: 2020 2020 2020 2020 7072 6963 655f 6d61          price_ma
+00006ea0: 7070 696e 6720 3d20 7365 6c66 2e5f 6674  pping = self._ft
+00006eb0: 5f68 6173 2e67 6574 2827 7374 6f70 5f70  _has.get('stop_p
+00006ec0: 7269 6365 5f74 7970 655f 7661 6c75 655f  rice_type_value_
+00006ed0: 6d61 7070 696e 6727 2c20 7b7d 292e 6b65  mapping', {}).ke
+00006ee0: 7973 2829 0a20 2020 2020 2020 2020 2020  ys().           
+00006ef0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00006f00: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
+00006f10: 732e 6765 7428 2273 746f 706c 6f73 735f  s.get("stoploss_
+00006f20: 6f6e 5f65 7863 6861 6e67 6522 2c20 4661  on_exchange", Fa
+00006f30: 6c73 6529 2069 7320 5472 7565 0a20 2020  lse) is True.   
+00006f40: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00006f50: 2027 7374 6f70 6c6f 7373 5f70 7269 6365   'stoploss_price
+00006f60: 5f74 7970 6527 2069 6e20 6f72 6465 725f  _type' in order_
+00006f70: 7479 7065 730a 2020 2020 2020 2020 2020  types.          
+00006f80: 2020 2020 2020 616e 6420 6f72 6465 725f        and order_
+00006f90: 7479 7065 735b 2773 746f 706c 6f73 735f  types['stoploss_
+00006fa0: 7072 6963 655f 7479 7065 275d 206e 6f74  price_type'] not
+00006fb0: 2069 6e20 7072 6963 655f 6d61 7070 696e   in price_mappin
+00006fc0: 670a 2020 2020 2020 2020 2020 2020 293a  g.            ):
+00006fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fe0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00006ff0: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007010: 2066 274f 6e20 6578 6368 616e 6765 2073   f'On exchange s
+00007020: 746f 706c 6f73 7320 7072 6963 6520 7479  toploss price ty
+00007030: 7065 2069 7320 6e6f 7420 7375 7070 6f72  pe is not suppor
+00007040: 7465 6420 666f 7220 7b73 656c 662e 6e61  ted for {self.na
+00007050: 6d65 7d2e 270a 2020 2020 2020 2020 2020  me}.'.          
+00007060: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00007070: 2076 616c 6964 6174 655f 7072 6963 696e   validate_pricin
+00007080: 6728 7365 6c66 2c20 7072 6963 696e 673a  g(self, pricing:
+00007090: 2044 6963 7429 202d 3e20 4e6f 6e65 3a0a   Dict) -> None:.
+000070a0: 2020 2020 2020 2020 6966 2070 7269 6369          if prici
+000070b0: 6e67 2e67 6574 2827 7573 655f 6f72 6465  ng.get('use_orde
+000070c0: 725f 626f 6f6b 272c 2046 616c 7365 2920  r_book', False) 
+000070d0: 616e 6420 6e6f 7420 7365 6c66 2e65 7863  and not self.exc
+000070e0: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+000070f0: 4c32 4f72 6465 7242 6f6f 6b27 293a 0a20  L2OrderBook'):. 
+00007100: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00007110: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00007120: 7074 696f 6e28 6627 4f72 6465 7262 6f6f  ption(f'Orderboo
+00007130: 6b20 6e6f 7420 6176 6169 6c61 626c 6520  k not available 
+00007140: 666f 7220 7b73 656c 662e 6e61 6d65 7d2e  for {self.name}.
+00007150: 2729 0a20 2020 2020 2020 2069 6620 286e  ').        if (n
+00007160: 6f74 2070 7269 6369 6e67 2e67 6574 2827  ot pricing.get('
+00007170: 7573 655f 6f72 6465 725f 626f 6f6b 272c  use_order_book',
+00007180: 2046 616c 7365 2920 616e 6420 280a 2020   False) and (.  
+00007190: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+000071a0: 7420 7365 6c66 2e65 7863 6861 6e67 655f  t self.exchange_
+000071b0: 6861 7328 2766 6574 6368 5469 636b 6572  has('fetchTicker
+000071c0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000071d0: 2020 206f 7220 6e6f 7420 7365 6c66 2e5f     or not self._
+000071e0: 6674 5f68 6173 5b27 7469 636b 6572 735f  ft_has['tickers_
+000071f0: 6861 7665 5f70 7269 6365 275d 2929 3a0a  have_price'])):.
+00007200: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00007210: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00007220: 6570 7469 6f6e 2866 2754 6963 6b65 7220  eption(f'Ticker 
+00007230: 7072 6963 696e 6720 6e6f 7420 6176 6169  pricing not avai
+00007240: 6c61 626c 6520 666f 7220 7b73 656c 662e  lable for {self.
+00007250: 6e61 6d65 7d2e 2729 0a0a 2020 2020 6465  name}.')..    de
+00007260: 6620 7661 6c69 6461 7465 5f6f 7264 6572  f validate_order
+00007270: 5f74 696d 655f 696e 5f66 6f72 6365 2873  _time_in_force(s
+00007280: 656c 662c 206f 7264 6572 5f74 696d 655f  elf, order_time_
+00007290: 696e 5f66 6f72 6365 3a20 4469 6374 2920  in_force: Dict) 
+000072a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000072b0: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
+000072c0: 636b 7320 6966 206f 7264 6572 2074 696d  cks if order tim
+000072d0: 6520 696e 2066 6f72 6365 2063 6f6e 6669  e in force confi
+000072e0: 6775 7265 6420 696e 2073 7472 6174 6567  gured in strateg
+000072f0: 792f 636f 6e66 6967 2061 7265 2073 7570  y/config are sup
+00007300: 706f 7274 6564 0a20 2020 2020 2020 2022  ported.        "
+00007310: 2222 0a20 2020 2020 2020 2069 6620 616e  "".        if an
+00007320: 7928 762e 7570 7065 7228 2920 6e6f 7420  y(v.upper() not 
+00007330: 696e 2073 656c 662e 5f66 745f 6861 735b  in self._ft_has[
+00007340: 226f 7264 6572 5f74 696d 655f 696e 5f66  "order_time_in_f
+00007350: 6f72 6365 225d 0a20 2020 2020 2020 2020  orce"].         
+00007360: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+00007370: 6e20 6f72 6465 725f 7469 6d65 5f69 6e5f  n order_time_in_
+00007380: 666f 7263 652e 6974 656d 7328 2929 3a0a  force.items()):.
+00007390: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000073a0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+000073b0: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+000073c0: 2020 2020 2020 2020 6627 5469 6d65 2069          f'Time i
+000073d0: 6e20 666f 7263 6520 706f 6c69 6369 6573  n force policies
+000073e0: 2061 7265 206e 6f74 2073 7570 706f 7274   are not support
+000073f0: 6564 2066 6f72 207b 7365 6c66 2e6e 616d  ed for {self.nam
+00007400: 657d 2079 6574 2e27 290a 0a20 2020 2064  e} yet.')..    d
+00007410: 6566 2076 616c 6964 6174 655f 7265 7175  ef validate_requ
+00007420: 6972 6564 5f73 7461 7274 7570 5f63 616e  ired_startup_can
+00007430: 646c 6573 2873 656c 662c 2073 7461 7274  dles(self, start
+00007440: 7570 5f63 616e 646c 6573 3a20 696e 742c  up_candles: int,
+00007450: 2074 696d 6566 7261 6d65 3a20 7374 7229   timeframe: str)
+00007460: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+00007470: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
+00007480: 636b 7320 6966 2072 6571 7569 7265 6420  cks if required 
+00007490: 7374 6172 7475 705f 6361 6e64 6c65 7320  startup_candles 
+000074a0: 6973 206d 6f72 6520 7468 616e 206f 686c  is more than ohl
+000074b0: 6376 5f63 616e 646c 655f 6c69 6d69 7428  cv_candle_limit(
+000074c0: 292e 0a20 2020 2020 2020 2052 6571 7569  )..        Requi
+000074d0: 7265 7320 6120 6772 6163 652d 7065 7269  res a grace-peri
+000074e0: 6f64 206f 6620 3520 6361 6e64 6c65 7320  od of 5 candles 
+000074f0: 2d20 736f 2061 2073 7461 7274 7570 2d70  - so a startup-p
+00007500: 6572 696f 6420 7570 2074 6f20 3439 3420  eriod up to 494 
+00007510: 6973 2061 6c6c 6f77 6564 2062 7920 6465  is allowed by de
+00007520: 6661 756c 742e 0a20 2020 2020 2020 2022  fault..        "
+00007530: 2222 0a0a 2020 2020 2020 2020 6361 6e64  ""..        cand
+00007540: 6c65 5f6c 696d 6974 203d 2073 656c 662e  le_limit = self.
+00007550: 6f68 6c63 765f 6361 6e64 6c65 5f6c 696d  ohlcv_candle_lim
+00007560: 6974 280a 2020 2020 2020 2020 2020 2020  it(.            
+00007570: 7469 6d65 6672 616d 652c 2073 656c 662e  timeframe, self.
+00007580: 5f63 6f6e 6669 675b 2763 616e 646c 655f  _config['candle_
+00007590: 7479 7065 5f64 6566 275d 2c0a 2020 2020  type_def'],.    
+000075a0: 2020 2020 2020 2020 696e 7428 6461 7465          int(date
+000075b0: 5f6d 696e 7573 5f63 616e 646c 6573 2874  _minus_candles(t
+000075c0: 696d 6566 7261 6d65 2c20 7374 6172 7475  imeframe, startu
+000075d0: 705f 6361 6e64 6c65 7329 2e74 696d 6573  p_candles).times
+000075e0: 7461 6d70 2829 202a 2031 3030 3029 0a20  tamp() * 1000). 
+000075f0: 2020 2020 2020 2020 2020 2069 6620 7469             if ti
+00007600: 6d65 6672 616d 6520 656c 7365 204e 6f6e  meframe else Non
+00007610: 6529 0a20 2020 2020 2020 2023 2052 6571  e).        # Req
+00007620: 7569 7265 206f 6e65 206d 6f72 6520 6361  uire one more ca
+00007630: 6e64 6c65 202d 2074 6f20 6163 636f 756e  ndle - to accoun
+00007640: 7420 666f 7220 7468 6520 7374 696c 6c20  t for the still 
+00007650: 6f70 656e 2063 616e 646c 652e 0a20 2020  open candle..   
+00007660: 2020 2020 2063 616e 646c 655f 636f 756e       candle_coun
+00007670: 7420 3d20 7374 6172 7475 705f 6361 6e64  t = startup_cand
+00007680: 6c65 7320 2b20 310a 2020 2020 2020 2020  les + 1.        
+00007690: 2320 416c 6c6f 7720 3520 6361 6c6c 7320  # Allow 5 calls 
+000076a0: 746f 2074 6865 2065 7863 6861 6e67 6520  to the exchange 
+000076b0: 7065 7220 7061 6972 0a20 2020 2020 2020  per pair.       
+000076c0: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
+000076d0: 5f63 616c 6c5f 636f 756e 7420 3d20 696e  _call_count = in
+000076e0: 7428 0a20 2020 2020 2020 2020 2020 2028  t(.            (
+000076f0: 6361 6e64 6c65 5f63 6f75 6e74 202f 2063  candle_count / c
+00007700: 616e 646c 655f 6c69 6d69 7429 202b 2028  andle_limit) + (
+00007710: 3020 6966 2063 616e 646c 655f 636f 756e  0 if candle_coun
+00007720: 7420 2520 6361 6e64 6c65 5f6c 696d 6974  t % candle_limit
+00007730: 203d 3d20 3020 656c 7365 2031 2929 0a20   == 0 else 1)). 
+00007740: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00007750: 6674 5f68 6173 5b27 6f68 6c63 765f 6861  ft_has['ohlcv_ha
+00007760: 735f 6869 7374 6f72 7927 5d3a 0a0a 2020  s_history']:..  
+00007770: 2020 2020 2020 2020 2020 6966 2072 6571            if req
+00007780: 7569 7265 645f 6361 6e64 6c65 5f63 616c  uired_candle_cal
+00007790: 6c5f 636f 756e 7420 3e20 353a 0a20 2020  l_count > 5:.   
+000077a0: 2020 2020 2020 2020 2020 2020 2023 204f               # O
+000077b0: 6e6c 7920 616c 6c6f 7720 3520 6361 6c6c  nly allow 5 call
+000077c0: 7320 7065 7220 7061 6972 2074 6f20 736f  s per pair to so
+000077d0: 6d65 7768 6174 206c 696d 6974 2074 6865  mewhat limit the
+000077e0: 2069 6d70 6163 740a 2020 2020 2020 2020   impact.        
+000077f0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00007800: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00007810: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00007820: 2020 2020 2020 2020 6622 5468 6973 2073          f"This s
+00007830: 7472 6174 6567 7920 7265 7175 6972 6573  trategy requires
+00007840: 207b 7374 6172 7475 705f 6361 6e64 6c65   {startup_candle
+00007850: 737d 2063 616e 646c 6573 2074 6f20 7374  s} candles to st
+00007860: 6172 742c 2022 0a20 2020 2020 2020 2020  art, ".         
+00007870: 2020 2020 2020 2020 2020 2022 7768 6963             "whic
+00007880: 6820 6973 206d 6f72 6520 7468 616e 2035  h is more than 5
+00007890: 7820 220a 2020 2020 2020 2020 2020 2020  x ".            
+000078a0: 2020 2020 2020 2020 6622 7468 6520 616d          f"the am
+000078b0: 6f75 6e74 206f 6620 6361 6e64 6c65 7320  ount of candles 
+000078c0: 7b73 656c 662e 6e61 6d65 7d20 7072 6f76  {self.name} prov
+000078d0: 6964 6573 2066 6f72 207b 7469 6d65 6672  ides for {timefr
+000078e0: 616d 657d 2e22 290a 2020 2020 2020 2020  ame}.").        
+000078f0: 656c 6966 2072 6571 7569 7265 645f 6361  elif required_ca
+00007900: 6e64 6c65 5f63 616c 6c5f 636f 756e 7420  ndle_call_count 
+00007910: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00007920: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00007930: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+00007940: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+00007950: 6869 7320 7374 7261 7465 6779 2072 6571  his strategy req
+00007960: 7569 7265 7320 7b73 7461 7274 7570 5f63  uires {startup_c
+00007970: 616e 646c 6573 7d20 6361 6e64 6c65 7320  andles} candles 
+00007980: 746f 2073 7461 7274 2c20 7768 6963 6820  to start, which 
+00007990: 6973 206d 6f72 6520 7468 616e 2022 0a20  is more than ". 
+000079a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000079b0: 2274 6865 2061 6d6f 756e 7420 6f66 2063  "the amount of c
+000079c0: 616e 646c 6573 207b 7365 6c66 2e6e 616d  andles {self.nam
+000079d0: 657d 2070 726f 7669 6465 7320 666f 7220  e} provides for 
+000079e0: 7b74 696d 6566 7261 6d65 7d2e 2229 0a20  {timeframe}."). 
+000079f0: 2020 2020 2020 2069 6620 7265 7175 6972         if requir
+00007a00: 6564 5f63 616e 646c 655f 6361 6c6c 5f63  ed_candle_call_c
+00007a10: 6f75 6e74 203e 2031 3a0a 2020 2020 2020  ount > 1:.      
+00007a20: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+00007a30: 6e69 6e67 2866 2255 7369 6e67 207b 7265  ning(f"Using {re
+00007a40: 7175 6972 6564 5f63 616e 646c 655f 6361  quired_candle_ca
+00007a50: 6c6c 5f63 6f75 6e74 7d20 6361 6c6c 7320  ll_count} calls 
+00007a60: 746f 2067 6574 204f 484c 4356 2e20 220a  to get OHLCV. ".
 00007a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a80: 2066 2254 6869 7320 6361 6e20 7265 7375   f"This can resu
-00007a90: 6c74 2069 6e20 736c 6f77 6572 206f 7065  lt in slower ope
-00007aa0: 7261 7469 6f6e 7320 666f 7220 7468 6520  rations for the 
-00007ab0: 626f 742e 2050 6c65 6173 6520 6368 6563  bot. Please chec
-00007ac0: 6b20 220a 2020 2020 2020 2020 2020 2020  k ".            
-00007ad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007ae0: 2269 6620 796f 7520 7265 616c 6c79 206e  "if you really n
-00007af0: 6565 6420 7b73 7461 7274 7570 5f63 616e  eed {startup_can
-00007b00: 646c 6573 7d20 6361 6e64 6c65 7320 666f  dles} candles fo
-00007b10: 7220 796f 7572 2073 7472 6174 6567 7922  r your strategy"
-00007b20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00007b30: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
-00007b40: 5f63 616c 6c5f 636f 756e 740a 0a20 2020  _call_count..   
-00007b50: 2064 6566 2076 616c 6964 6174 655f 7472   def validate_tr
-00007b60: 6164 696e 675f 6d6f 6465 5f61 6e64 5f6d  ading_mode_and_m
-00007b70: 6172 6769 6e5f 6d6f 6465 280a 2020 2020  argin_mode(.    
-00007b80: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00007b90: 2020 7472 6164 696e 675f 6d6f 6465 3a20    trading_mode: 
-00007ba0: 5472 6164 696e 674d 6f64 652c 0a20 2020  TradingMode,.   
-00007bb0: 2020 2020 206d 6172 6769 6e5f 6d6f 6465       margin_mode
-00007bc0: 3a20 4f70 7469 6f6e 616c 5b4d 6172 6769  : Optional[Margi
-00007bd0: 6e4d 6f64 655d 2020 2320 4f6e 6c79 204e  nMode]  # Only N
-00007be0: 6f6e 6520 7768 656e 2074 7261 6469 6e67  one when trading
-00007bf0: 5f6d 6f64 6520 3d20 5472 6164 696e 674d  _mode = TradingM
-00007c00: 6f64 652e 5350 4f54 0a20 2020 2029 3a0a  ode.SPOT.    ):.
-00007c10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007c20: 2020 2020 4368 6563 6b73 2069 6620 6672      Checks if fr
-00007c30: 6571 7472 6164 6520 6361 6e20 7065 7266  eqtrade can perf
-00007c40: 6f72 6d20 7472 6164 6573 2075 7369 6e67  orm trades using
-00007c50: 2074 6865 2063 6f6e 6669 6775 7265 640a   the configured.
-00007c60: 2020 2020 2020 2020 7472 6164 696e 6720          trading 
-00007c70: 6d6f 6465 284d 6172 6769 6e2c 2046 7574  mode(Margin, Fut
-00007c80: 7572 6573 2920 616e 6420 4d61 7267 696e  ures) and Margin
-00007c90: 4d6f 6465 2843 726f 7373 2c20 4973 6f6c  Mode(Cross, Isol
-00007ca0: 6174 6564 290a 2020 2020 2020 2020 5468  ated).        Th
-00007cb0: 726f 7773 204f 7065 7261 7469 6f6e 616c  rows Operational
-00007cc0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00007cd0: 2020 2020 2020 2049 6620 7468 6520 7472         If the tr
-00007ce0: 6164 696e 675f 6d6f 6465 2f6d 6172 6769  ading_mode/margi
-00007cf0: 6e5f 6d6f 6465 2074 7970 6520 6172 6520  n_mode type are 
-00007d00: 6e6f 7420 7375 7070 6f72 7465 6420 6279  not supported by
-00007d10: 2066 7265 7174 7261 6465 206f 6e20 7468   freqtrade on th
-00007d20: 6973 2065 7863 6861 6e67 650a 2020 2020  is exchange.    
-00007d30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007d40: 6966 2074 7261 6469 6e67 5f6d 6f64 6520  if trading_mode 
-00007d50: 213d 2054 7261 6469 6e67 4d6f 6465 2e53  != TradingMode.S
-00007d60: 504f 5420 616e 6420 280a 2020 2020 2020  POT and (.      
-00007d70: 2020 2020 2020 2874 7261 6469 6e67 5f6d        (trading_m
-00007d80: 6f64 652c 206d 6172 6769 6e5f 6d6f 6465  ode, margin_mode
-00007d90: 2920 6e6f 7420 696e 2073 656c 662e 5f73  ) not in self._s
-00007da0: 7570 706f 7274 6564 5f74 7261 6469 6e67  upported_trading
-00007db0: 5f6d 6f64 655f 6d61 7267 696e 5f70 6169  _mode_margin_pai
-00007dc0: 7273 0a20 2020 2020 2020 2029 3a0a 2020  rs.        ):.  
-00007dd0: 2020 2020 2020 2020 2020 6d6d 5f76 616c            mm_val
-00007de0: 7565 203d 206d 6172 6769 6e5f 6d6f 6465  ue = margin_mode
-00007df0: 2061 6e64 206d 6172 6769 6e5f 6d6f 6465   and margin_mode
-00007e00: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
-00007e10: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00007e20: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00007e30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007e40: 2246 7265 7174 7261 6465 2064 6f65 7320  "Freqtrade does 
-00007e50: 6e6f 7420 7375 7070 6f72 7420 7b6d 6d5f  not support {mm_
-00007e60: 7661 6c75 657d 207b 7472 6164 696e 675f  value} {trading_
-00007e70: 6d6f 6465 2e76 616c 7565 7d20 6f6e 207b  mode.value} on {
-00007e80: 7365 6c66 2e6e 616d 657d 220a 2020 2020  self.name}".    
-00007e90: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00007ea0: 6566 2067 6574 5f6f 7074 696f 6e28 7365  ef get_option(se
-00007eb0: 6c66 2c20 7061 7261 6d3a 2073 7472 2c20  lf, param: str, 
-00007ec0: 6465 6661 756c 743a 204f 7074 696f 6e61  default: Optiona
-00007ed0: 6c5b 416e 795d 203d 204e 6f6e 6529 202d  l[Any] = None) -
-00007ee0: 3e20 416e 793a 0a20 2020 2020 2020 2022  > Any:.        "
-00007ef0: 2222 0a20 2020 2020 2020 2047 6574 2070  "".        Get p
-00007f00: 6172 616d 6574 6572 2076 616c 7565 2066  arameter value f
-00007f10: 726f 6d20 5f66 745f 6861 730a 2020 2020  rom _ft_has.    
-00007f20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007f30: 7265 7475 726e 2073 656c 662e 5f66 745f  return self._ft_
-00007f40: 6861 732e 6765 7428 7061 7261 6d2c 2064  has.get(param, d
-00007f50: 6566 6175 6c74 290a 0a20 2020 2064 6566  efault)..    def
-00007f60: 2065 7863 6861 6e67 655f 6861 7328 7365   exchange_has(se
-00007f70: 6c66 2c20 656e 6470 6f69 6e74 3a20 7374  lf, endpoint: st
-00007f80: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
-00007f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007fa0: 4368 6563 6b73 2069 6620 6578 6368 616e  Checks if exchan
-00007fb0: 6765 2069 6d70 6c65 6d65 6e74 7320 6120  ge implements a 
-00007fc0: 7370 6563 6966 6963 2041 5049 2065 6e64  specific API end
-00007fd0: 706f 696e 742e 0a20 2020 2020 2020 2057  point..        W
-00007fe0: 7261 7070 6572 2061 726f 756e 6420 6363  rapper around cc
-00007ff0: 7874 2027 6861 7327 2061 7474 7269 6275  xt 'has' attribu
-00008000: 7465 0a20 2020 2020 2020 203a 7061 7261  te.        :para
-00008010: 6d20 656e 6470 6f69 6e74 3a20 4e61 6d65  m endpoint: Name
-00008020: 206f 6620 656e 6470 6f69 6e74 2028 652e   of endpoint (e.
-00008030: 672e 2027 6665 7463 684f 484c 4356 272c  g. 'fetchOHLCV',
-00008040: 2027 6665 7463 6854 6963 6b65 7273 2729   'fetchTickers')
-00008050: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00008060: 3a20 626f 6f6c 0a20 2020 2020 2020 2022  : bool.        "
-00008070: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00008080: 6e20 656e 6470 6f69 6e74 2069 6e20 7365  n endpoint in se
-00008090: 6c66 2e5f 6170 692e 6861 7320 616e 6420  lf._api.has and 
-000080a0: 7365 6c66 2e5f 6170 692e 6861 735b 656e  self._api.has[en
-000080b0: 6470 6f69 6e74 5d0a 0a20 2020 2064 6566  dpoint]..    def
-000080c0: 2067 6574 5f70 7265 6369 7369 6f6e 5f61   get_precision_a
-000080d0: 6d6f 756e 7428 7365 6c66 2c20 7061 6972  mount(self, pair
-000080e0: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
-000080f0: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
-00008100: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00008110: 6574 7572 6e73 2074 6865 2061 6d6f 756e  eturns the amoun
-00008120: 7420 7072 6563 6973 696f 6e20 6f66 2074  t precision of t
-00008130: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
-00008140: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-00008150: 3a20 5061 6972 2074 6f20 6765 7420 7072  : Pair to get pr
-00008160: 6563 6973 696f 6e20 666f 720a 2020 2020  ecision for.    
-00008170: 2020 2020 3a72 6574 7572 6e3a 2070 7265      :return: pre
-00008180: 6369 7369 6f6e 2066 6f72 2061 6d6f 756e  cision for amoun
-00008190: 7420 6f72 204e 6f6e 652e 204d 7573 7420  t or None. Must 
-000081a0: 6265 2075 7365 6420 696e 2063 6f6d 6269  be used in combi
-000081b0: 6e61 7469 6f6e 2077 6974 6820 7072 6563  nation with prec
-000081c0: 6973 696f 6e4d 6f64 650a 2020 2020 2020  isionMode.      
-000081d0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-000081e0: 7475 726e 2073 656c 662e 6d61 726b 6574  turn self.market
-000081f0: 732e 6765 7428 7061 6972 2c20 7b7d 292e  s.get(pair, {}).
-00008200: 6765 7428 2770 7265 6369 7369 6f6e 272c  get('precision',
-00008210: 207b 7d29 2e67 6574 2827 616d 6f75 6e74   {}).get('amount
-00008220: 272c 204e 6f6e 6529 0a0a 2020 2020 6465  ', None)..    de
-00008230: 6620 6765 745f 7072 6563 6973 696f 6e5f  f get_precision_
-00008240: 7072 6963 6528 7365 6c66 2c20 7061 6972  price(self, pair
-00008250: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
-00008260: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
-00008270: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00008280: 6574 7572 6e73 2074 6865 2070 7269 6365  eturns the price
-00008290: 2070 7265 6369 7369 6f6e 206f 6620 7468   precision of th
-000082a0: 6520 6578 6368 616e 6765 2e0a 2020 2020  e exchange..    
-000082b0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-000082c0: 2050 6169 7220 746f 2067 6574 2070 7265   Pair to get pre
-000082d0: 6369 7369 6f6e 2066 6f72 0a20 2020 2020  cision for.     
-000082e0: 2020 203a 7265 7475 726e 3a20 7072 6563     :return: prec
-000082f0: 6973 696f 6e20 666f 7220 7072 6963 6520  ision for price 
-00008300: 6f72 204e 6f6e 652e 204d 7573 7420 6265  or None. Must be
-00008310: 2075 7365 6420 696e 2063 6f6d 6269 6e61   used in combina
-00008320: 7469 6f6e 2077 6974 6820 7072 6563 6973  tion with precis
-00008330: 696f 6e4d 6f64 650a 2020 2020 2020 2020  ionMode.        
-00008340: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00008350: 726e 2073 656c 662e 6d61 726b 6574 732e  rn self.markets.
-00008360: 6765 7428 7061 6972 2c20 7b7d 292e 6765  get(pair, {}).ge
-00008370: 7428 2770 7265 6369 7369 6f6e 272c 207b  t('precision', {
-00008380: 7d29 2e67 6574 2827 7072 6963 6527 2c20  }).get('price', 
-00008390: 4e6f 6e65 290a 0a20 2020 2064 6566 2061  None)..    def a
-000083a0: 6d6f 756e 745f 746f 5f70 7265 6369 7369  mount_to_precisi
-000083b0: 6f6e 2873 656c 662c 2070 6169 723a 2073  on(self, pair: s
-000083c0: 7472 2c20 616d 6f75 6e74 3a20 666c 6f61  tr, amount: floa
-000083d0: 7429 202d 3e20 666c 6f61 743a 0a20 2020  t) -> float:.   
-000083e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000083f0: 2052 6574 7572 6e73 2074 6865 2061 6d6f   Returns the amo
-00008400: 756e 7420 746f 2062 7579 206f 7220 7365  unt to buy or se
-00008410: 6c6c 2074 6f20 6120 7072 6563 6973 696f  ll to a precisio
-00008420: 6e20 7468 6520 4578 6368 616e 6765 2061  n the Exchange a
-00008430: 6363 6570 7473 0a0a 2020 2020 2020 2020  ccepts..        
-00008440: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00008450: 726e 2061 6d6f 756e 745f 746f 5f70 7265  rn amount_to_pre
-00008460: 6369 7369 6f6e 2861 6d6f 756e 742c 2073  cision(amount, s
-00008470: 656c 662e 6765 745f 7072 6563 6973 696f  elf.get_precisio
-00008480: 6e5f 616d 6f75 6e74 2870 6169 7229 2c20  n_amount(pair), 
-00008490: 7365 6c66 2e70 7265 6369 7369 6f6e 4d6f  self.precisionMo
-000084a0: 6465 290a 0a20 2020 2064 6566 2070 7269  de)..    def pri
-000084b0: 6365 5f74 6f5f 7072 6563 6973 696f 6e28  ce_to_precision(
-000084c0: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-000084d0: 2070 7269 6365 3a20 666c 6f61 742c 202a   price: float, *
-000084e0: 2c20 726f 756e 6469 6e67 5f6d 6f64 653a  , rounding_mode:
-000084f0: 2069 6e74 203d 2052 4f55 4e44 2920 2d3e   int = ROUND) ->
-00008500: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-00008510: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-00008520: 726e 7320 7468 6520 7072 6963 6520 726f  rns the price ro
-00008530: 756e 6465 6420 746f 2074 6865 2070 7265  unded to the pre
-00008540: 6369 7369 6f6e 2074 6865 2045 7863 6861  cision the Excha
-00008550: 6e67 6520 6163 6365 7074 732e 0a20 2020  nge accepts..   
-00008560: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
-00008570: 2070 7269 6365 5f72 6f75 6e64 696e 675f   price_rounding_
-00008580: 6d6f 6465 2069 6e20 636f 6e66 2069 7320  mode in conf is 
-00008590: 524f 554e 442e 0a20 2020 2020 2020 2046  ROUND..        F
-000085a0: 6f72 2073 746f 706c 6f73 7320 6361 6c63  or stoploss calc
-000085b0: 756c 6174 696f 6e73 2c20 6d75 7374 2075  ulations, must u
-000085c0: 7365 2052 4f55 4e44 5f55 5020 666f 7220  se ROUND_UP for 
-000085d0: 6c6f 6e67 732c 2061 6e64 2052 4f55 4e44  longs, and ROUND
-000085e0: 5f44 4f57 4e20 666f 7220 7368 6f72 7473  _DOWN for shorts
-000085f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00008600: 2020 2020 2020 7265 7475 726e 2070 7269        return pri
-00008610: 6365 5f74 6f5f 7072 6563 6973 696f 6e28  ce_to_precision(
-00008620: 7072 6963 652c 2073 656c 662e 6765 745f  price, self.get_
-00008630: 7072 6563 6973 696f 6e5f 7072 6963 6528  precision_price(
-00008640: 7061 6972 292c 0a20 2020 2020 2020 2020  pair),.         
-00008650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008660: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00008670: 6563 6973 696f 6e4d 6f64 652c 2072 6f75  ecisionMode, rou
-00008680: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
-00008690: 696e 675f 6d6f 6465 290a 0a20 2020 2064  ing_mode)..    d
-000086a0: 6566 2070 7269 6365 5f67 6574 5f6f 6e65  ef price_get_one
-000086b0: 5f70 6970 2873 656c 662c 2070 6169 723a  _pip(self, pair:
-000086c0: 2073 7472 2c20 7072 6963 653a 2066 6c6f   str, price: flo
-000086d0: 6174 2920 2d3e 2066 6c6f 6174 3a0a 2020  at) -> float:.  
-000086e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000086f0: 2020 4765 7427 7320 7468 6520 2231 2070    Get's the "1 p
-00008700: 6970 2220 7661 6c75 6520 666f 7220 7468  ip" value for th
-00008710: 6973 2070 6169 722e 0a20 2020 2020 2020  is pair..       
-00008720: 2055 7365 6420 696e 2050 7269 6365 4669   Used in PriceFi
-00008730: 6c74 6572 2074 6f20 6361 6c63 756c 6174  lter to calculat
-00008740: 6520 7468 6520 3170 6970 206d 6f76 656d  e the 1pip movem
-00008750: 656e 7473 2e0a 2020 2020 2020 2020 2222  ents..        ""
-00008760: 220a 2020 2020 2020 2020 7072 6563 6973  ".        precis
-00008770: 696f 6e20 3d20 7365 6c66 2e6d 6172 6b65  ion = self.marke
-00008780: 7473 5b70 6169 725d 5b27 7072 6563 6973  ts[pair]['precis
-00008790: 696f 6e27 5d5b 2770 7269 6365 275d 0a20  ion']['price']. 
-000087a0: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
-000087b0: 7265 6369 7369 6f6e 4d6f 6465 203d 3d20  recisionMode == 
-000087c0: 5449 434b 5f53 495a 453a 0a20 2020 2020  TICK_SIZE:.     
-000087d0: 2020 2020 2020 2072 6574 7572 6e20 7072         return pr
-000087e0: 6563 6973 696f 6e0a 2020 2020 2020 2020  ecision.        
-000087f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00008800: 2020 7265 7475 726e 2031 202f 2070 6f77    return 1 / pow
-00008810: 2831 302c 2070 7265 6369 7369 6f6e 290a  (10, precision).
-00008820: 0a20 2020 2064 6566 2067 6574 5f6d 696e  .    def get_min
-00008830: 5f70 6169 725f 7374 616b 655f 616d 6f75  _pair_stake_amou
-00008840: 6e74 280a 2020 2020 2020 2020 7365 6c66  nt(.        self
-00008850: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
-00008860: 7374 722c 0a20 2020 2020 2020 2070 7269  str,.        pri
-00008870: 6365 3a20 666c 6f61 742c 0a20 2020 2020  ce: float,.     
-00008880: 2020 2073 746f 706c 6f73 733a 2066 6c6f     stoploss: flo
-00008890: 6174 2c0a 2020 2020 2020 2020 6c65 7665  at,.        leve
-000088a0: 7261 6765 3a20 4f70 7469 6f6e 616c 5b66  rage: Optional[f
-000088b0: 6c6f 6174 5d20 3d20 312e 300a 2020 2020  loat] = 1.0.    
-000088c0: 2920 2d3e 204f 7074 696f 6e61 6c5b 666c  ) -> Optional[fl
-000088d0: 6f61 745d 3a0a 2020 2020 2020 2020 7265  oat]:.        re
-000088e0: 7475 726e 2073 656c 662e 5f67 6574 5f73  turn self._get_s
-000088f0: 7461 6b65 5f61 6d6f 756e 745f 6c69 6d69  take_amount_limi
-00008900: 7428 7061 6972 2c20 7072 6963 652c 2073  t(pair, price, s
-00008910: 746f 706c 6f73 732c 2027 6d69 6e27 2c20  toploss, 'min', 
-00008920: 6c65 7665 7261 6765 290a 0a20 2020 2064  leverage)..    d
-00008930: 6566 2067 6574 5f6d 6178 5f70 6169 725f  ef get_max_pair_
-00008940: 7374 616b 655f 616d 6f75 6e74 2873 656c  stake_amount(sel
-00008950: 662c 2070 6169 723a 2073 7472 2c20 7072  f, pair: str, pr
-00008960: 6963 653a 2066 6c6f 6174 2c20 6c65 7665  ice: float, leve
-00008970: 7261 6765 3a20 666c 6f61 7420 3d20 312e  rage: float = 1.
-00008980: 3029 202d 3e20 666c 6f61 743a 0a20 2020  0) -> float:.   
-00008990: 2020 2020 206d 6178 5f73 7461 6b65 5f61       max_stake_a
-000089a0: 6d6f 756e 7420 3d20 7365 6c66 2e5f 6765  mount = self._ge
-000089b0: 745f 7374 616b 655f 616d 6f75 6e74 5f6c  t_stake_amount_l
-000089c0: 696d 6974 2870 6169 722c 2070 7269 6365  imit(pair, price
-000089d0: 2c20 302e 302c 2027 6d61 7827 2c20 6c65  , 0.0, 'max', le
-000089e0: 7665 7261 6765 290a 2020 2020 2020 2020  verage).        
-000089f0: 6966 206d 6178 5f73 7461 6b65 5f61 6d6f  if max_stake_amo
-00008a00: 756e 7420 6973 204e 6f6e 653a 0a20 2020  unt is None:.   
-00008a10: 2020 2020 2020 2020 2023 202a 2053 686f           # * Sho
-00008a20: 756c 6420 6e65 7665 7220 6265 2065 7865  uld never be exe
-00008a30: 6375 7465 640a 2020 2020 2020 2020 2020  cuted.          
-00008a40: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00008a50: 6e61 6c45 7863 6570 7469 6f6e 2866 277b  nalException(f'{
-00008a60: 7365 6c66 2e6e 616d 657d 2e67 6574 5f6d  self.name}.get_m
-00008a70: 6178 5f70 6169 725f 7374 616b 655f 616d  ax_pair_stake_am
-00008a80: 6f75 6e74 2073 686f 756c 6427 0a20 2020  ount should'.   
-00008a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a80: 2020 2020 2020 2020 2020 2066 2254 6869             f"Thi
+00007a90: 7320 6361 6e20 7265 7375 6c74 2069 6e20  s can result in 
+00007aa0: 736c 6f77 6572 206f 7065 7261 7469 6f6e  slower operation
+00007ab0: 7320 666f 7220 7468 6520 626f 742e 2050  s for the bot. P
+00007ac0: 6c65 6173 6520 6368 6563 6b20 220a 2020  lease check ".  
+00007ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ae0: 2020 2020 2020 2020 2066 2269 6620 796f           f"if yo
+00007af0: 7520 7265 616c 6c79 206e 6565 6420 7b73  u really need {s
+00007b00: 7461 7274 7570 5f63 616e 646c 6573 7d20  tartup_candles} 
+00007b10: 6361 6e64 6c65 7320 666f 7220 796f 7572  candles for your
+00007b20: 2073 7472 6174 6567 7922 290a 2020 2020   strategy").    
+00007b30: 2020 2020 7265 7475 726e 2072 6571 7569      return requi
+00007b40: 7265 645f 6361 6e64 6c65 5f63 616c 6c5f  red_candle_call_
+00007b50: 636f 756e 740a 0a20 2020 2064 6566 2076  count..    def v
+00007b60: 616c 6964 6174 655f 7472 6164 696e 675f  alidate_trading_
+00007b70: 6d6f 6465 5f61 6e64 5f6d 6172 6769 6e5f  mode_and_margin_
+00007b80: 6d6f 6465 280a 2020 2020 2020 2020 7365  mode(.        se
+00007b90: 6c66 2c0a 2020 2020 2020 2020 7472 6164  lf,.        trad
+00007ba0: 696e 675f 6d6f 6465 3a20 5472 6164 696e  ing_mode: Tradin
+00007bb0: 674d 6f64 652c 0a20 2020 2020 2020 206d  gMode,.        m
+00007bc0: 6172 6769 6e5f 6d6f 6465 3a20 4f70 7469  argin_mode: Opti
+00007bd0: 6f6e 616c 5b4d 6172 6769 6e4d 6f64 655d  onal[MarginMode]
+00007be0: 2020 2320 4f6e 6c79 204e 6f6e 6520 7768    # Only None wh
+00007bf0: 656e 2074 7261 6469 6e67 5f6d 6f64 6520  en trading_mode 
+00007c00: 3d20 5472 6164 696e 674d 6f64 652e 5350  = TradingMode.SP
+00007c10: 4f54 0a20 2020 2029 3a0a 2020 2020 2020  OT.    ):.      
+00007c20: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
+00007c30: 6563 6b73 2069 6620 6672 6571 7472 6164  ecks if freqtrad
+00007c40: 6520 6361 6e20 7065 7266 6f72 6d20 7472  e can perform tr
+00007c50: 6164 6573 2075 7369 6e67 2074 6865 2063  ades using the c
+00007c60: 6f6e 6669 6775 7265 640a 2020 2020 2020  onfigured.      
+00007c70: 2020 7472 6164 696e 6720 6d6f 6465 284d    trading mode(M
+00007c80: 6172 6769 6e2c 2046 7574 7572 6573 2920  argin, Futures) 
+00007c90: 616e 6420 4d61 7267 696e 4d6f 6465 2843  and MarginMode(C
+00007ca0: 726f 7373 2c20 4973 6f6c 6174 6564 290a  ross, Isolated).
+00007cb0: 2020 2020 2020 2020 5468 726f 7773 204f          Throws O
+00007cc0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00007cd0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00007ce0: 2049 6620 7468 6520 7472 6164 696e 675f   If the trading_
+00007cf0: 6d6f 6465 2f6d 6172 6769 6e5f 6d6f 6465  mode/margin_mode
+00007d00: 2074 7970 6520 6172 6520 6e6f 7420 7375   type are not su
+00007d10: 7070 6f72 7465 6420 6279 2066 7265 7174  pported by freqt
+00007d20: 7261 6465 206f 6e20 7468 6973 2065 7863  rade on this exc
+00007d30: 6861 6e67 650a 2020 2020 2020 2020 2222  hange.        ""
+00007d40: 220a 2020 2020 2020 2020 6966 2074 7261  ".        if tra
+00007d50: 6469 6e67 5f6d 6f64 6520 213d 2054 7261  ding_mode != Tra
+00007d60: 6469 6e67 4d6f 6465 2e53 504f 5420 616e  dingMode.SPOT an
+00007d70: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
+00007d80: 2874 7261 6469 6e67 5f6d 6f64 652c 206d  (trading_mode, m
+00007d90: 6172 6769 6e5f 6d6f 6465 2920 6e6f 7420  argin_mode) not 
+00007da0: 696e 2073 656c 662e 5f73 7570 706f 7274  in self._support
+00007db0: 6564 5f74 7261 6469 6e67 5f6d 6f64 655f  ed_trading_mode_
+00007dc0: 6d61 7267 696e 5f70 6169 7273 0a20 2020  margin_pairs.   
+00007dd0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00007de0: 2020 2020 6d6d 5f76 616c 7565 203d 206d      mm_value = m
+00007df0: 6172 6769 6e5f 6d6f 6465 2061 6e64 206d  argin_mode and m
+00007e00: 6172 6769 6e5f 6d6f 6465 2e76 616c 7565  argin_mode.value
+00007e10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00007e20: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00007e30: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+00007e40: 2020 2020 2020 2020 2066 2246 7265 7174           f"Freqt
+00007e50: 7261 6465 2064 6f65 7320 6e6f 7420 7375  rade does not su
+00007e60: 7070 6f72 7420 7b6d 6d5f 7661 6c75 657d  pport {mm_value}
+00007e70: 207b 7472 6164 696e 675f 6d6f 6465 2e76   {trading_mode.v
+00007e80: 616c 7565 7d20 6f6e 207b 7365 6c66 2e6e  alue} on {self.n
+00007e90: 616d 657d 220a 2020 2020 2020 2020 2020  ame}".          
+00007ea0: 2020 290a 0a20 2020 2064 6566 2067 6574    )..    def get
+00007eb0: 5f6f 7074 696f 6e28 7365 6c66 2c20 7061  _option(self, pa
+00007ec0: 7261 6d3a 2073 7472 2c20 6465 6661 756c  ram: str, defaul
+00007ed0: 743a 204f 7074 696f 6e61 6c5b 416e 795d  t: Optional[Any]
+00007ee0: 203d 204e 6f6e 6529 202d 3e20 416e 793a   = None) -> Any:
+00007ef0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007f00: 2020 2020 2047 6574 2070 6172 616d 6574       Get paramet
+00007f10: 6572 2076 616c 7565 2066 726f 6d20 5f66  er value from _f
+00007f20: 745f 6861 730a 2020 2020 2020 2020 2222  t_has.        ""
+00007f30: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00007f40: 2073 656c 662e 5f66 745f 6861 732e 6765   self._ft_has.ge
+00007f50: 7428 7061 7261 6d2c 2064 6566 6175 6c74  t(param, default
+00007f60: 290a 0a20 2020 2064 6566 2065 7863 6861  )..    def excha
+00007f70: 6e67 655f 6861 7328 7365 6c66 2c20 656e  nge_has(self, en
+00007f80: 6470 6f69 6e74 3a20 7374 7229 202d 3e20  dpoint: str) -> 
+00007f90: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+00007fa0: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
+00007fb0: 2069 6620 6578 6368 616e 6765 2069 6d70   if exchange imp
+00007fc0: 6c65 6d65 6e74 7320 6120 7370 6563 6966  lements a specif
+00007fd0: 6963 2041 5049 2065 6e64 706f 696e 742e  ic API endpoint.
+00007fe0: 0a20 2020 2020 2020 2057 7261 7070 6572  .        Wrapper
+00007ff0: 2061 726f 756e 6420 6363 7874 2027 6861   around ccxt 'ha
+00008000: 7327 2061 7474 7269 6275 7465 0a20 2020  s' attribute.   
+00008010: 2020 2020 203a 7061 7261 6d20 656e 6470       :param endp
+00008020: 6f69 6e74 3a20 4e61 6d65 206f 6620 656e  oint: Name of en
+00008030: 6470 6f69 6e74 2028 652e 672e 2027 6665  dpoint (e.g. 'fe
+00008040: 7463 684f 484c 4356 272c 2027 6665 7463  tchOHLCV', 'fetc
+00008050: 6854 6963 6b65 7273 2729 0a20 2020 2020  hTickers').     
+00008060: 2020 203a 7265 7475 726e 3a20 626f 6f6c     :return: bool
+00008070: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00008080: 2020 2020 2072 6574 7572 6e20 656e 6470       return endp
+00008090: 6f69 6e74 2069 6e20 7365 6c66 2e5f 6170  oint in self._ap
+000080a0: 692e 6861 7320 616e 6420 7365 6c66 2e5f  i.has and self._
+000080b0: 6170 692e 6861 735b 656e 6470 6f69 6e74  api.has[endpoint
+000080c0: 5d0a 0a20 2020 2064 6566 2067 6574 5f70  ]..    def get_p
+000080d0: 7265 6369 7369 6f6e 5f61 6d6f 756e 7428  recision_amount(
+000080e0: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
+000080f0: 202d 3e20 4f70 7469 6f6e 616c 5b66 6c6f   -> Optional[flo
+00008100: 6174 5d3a 0a20 2020 2020 2020 2022 2222  at]:.        """
+00008110: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008120: 2074 6865 2061 6d6f 756e 7420 7072 6563   the amount prec
+00008130: 6973 696f 6e20 6f66 2074 6865 2065 7863  ision of the exc
+00008140: 6861 6e67 652e 0a20 2020 2020 2020 203a  hange..        :
+00008150: 7061 7261 6d20 7061 6972 3a20 5061 6972  param pair: Pair
+00008160: 2074 6f20 6765 7420 7072 6563 6973 696f   to get precisio
+00008170: 6e20 666f 720a 2020 2020 2020 2020 3a72  n for.        :r
+00008180: 6574 7572 6e3a 2070 7265 6369 7369 6f6e  eturn: precision
+00008190: 2066 6f72 2061 6d6f 756e 7420 6f72 204e   for amount or N
+000081a0: 6f6e 652e 204d 7573 7420 6265 2075 7365  one. Must be use
+000081b0: 6420 696e 2063 6f6d 6269 6e61 7469 6f6e  d in combination
+000081c0: 2077 6974 6820 7072 6563 6973 696f 6e4d   with precisionM
+000081d0: 6f64 650a 2020 2020 2020 2020 2222 220a  ode.        """.
+000081e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000081f0: 656c 662e 6d61 726b 6574 732e 6765 7428  elf.markets.get(
+00008200: 7061 6972 2c20 7b7d 292e 6765 7428 2770  pair, {}).get('p
+00008210: 7265 6369 7369 6f6e 272c 207b 7d29 2e67  recision', {}).g
+00008220: 6574 2827 616d 6f75 6e74 272c 204e 6f6e  et('amount', Non
+00008230: 6529 0a0a 2020 2020 6465 6620 6765 745f  e)..    def get_
+00008240: 7072 6563 6973 696f 6e5f 7072 6963 6528  precision_price(
+00008250: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
+00008260: 202d 3e20 4f70 7469 6f6e 616c 5b66 6c6f   -> Optional[flo
+00008270: 6174 5d3a 0a20 2020 2020 2020 2022 2222  at]:.        """
+00008280: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008290: 2074 6865 2070 7269 6365 2070 7265 6369   the price preci
+000082a0: 7369 6f6e 206f 6620 7468 6520 6578 6368  sion of the exch
+000082b0: 616e 6765 2e0a 2020 2020 2020 2020 3a70  ange..        :p
+000082c0: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
+000082d0: 746f 2067 6574 2070 7265 6369 7369 6f6e  to get precision
+000082e0: 2066 6f72 0a20 2020 2020 2020 203a 7265   for.        :re
+000082f0: 7475 726e 3a20 7072 6563 6973 696f 6e20  turn: precision 
+00008300: 666f 7220 7072 6963 6520 6f72 204e 6f6e  for price or Non
+00008310: 652e 204d 7573 7420 6265 2075 7365 6420  e. Must be used 
+00008320: 696e 2063 6f6d 6269 6e61 7469 6f6e 2077  in combination w
+00008330: 6974 6820 7072 6563 6973 696f 6e4d 6f64  ith precisionMod
+00008340: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00008350: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00008360: 662e 6d61 726b 6574 732e 6765 7428 7061  f.markets.get(pa
+00008370: 6972 2c20 7b7d 292e 6765 7428 2770 7265  ir, {}).get('pre
+00008380: 6369 7369 6f6e 272c 207b 7d29 2e67 6574  cision', {}).get
+00008390: 2827 7072 6963 6527 2c20 4e6f 6e65 290a  ('price', None).
+000083a0: 0a20 2020 2064 6566 2061 6d6f 756e 745f  .    def amount_
+000083b0: 746f 5f70 7265 6369 7369 6f6e 2873 656c  to_precision(sel
+000083c0: 662c 2070 6169 723a 2073 7472 2c20 616d  f, pair: str, am
+000083d0: 6f75 6e74 3a20 666c 6f61 7429 202d 3e20  ount: float) -> 
+000083e0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
+000083f0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00008400: 6e73 2074 6865 2061 6d6f 756e 7420 746f  ns the amount to
+00008410: 2062 7579 206f 7220 7365 6c6c 2074 6f20   buy or sell to 
+00008420: 6120 7072 6563 6973 696f 6e20 7468 6520  a precision the 
+00008430: 4578 6368 616e 6765 2061 6363 6570 7473  Exchange accepts
+00008440: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00008450: 2020 2020 2020 7265 7475 726e 2061 6d6f        return amo
+00008460: 756e 745f 746f 5f70 7265 6369 7369 6f6e  unt_to_precision
+00008470: 2861 6d6f 756e 742c 2073 656c 662e 6765  (amount, self.ge
+00008480: 745f 7072 6563 6973 696f 6e5f 616d 6f75  t_precision_amou
+00008490: 6e74 2870 6169 7229 2c20 7365 6c66 2e70  nt(pair), self.p
+000084a0: 7265 6369 7369 6f6e 4d6f 6465 290a 0a20  recisionMode).. 
+000084b0: 2020 2064 6566 2070 7269 6365 5f74 6f5f     def price_to_
+000084c0: 7072 6563 6973 696f 6e28 7365 6c66 2c20  precision(self, 
+000084d0: 7061 6972 3a20 7374 722c 2070 7269 6365  pair: str, price
+000084e0: 3a20 666c 6f61 742c 202a 2c20 726f 756e  : float, *, roun
+000084f0: 6469 6e67 5f6d 6f64 653a 2069 6e74 203d  ding_mode: int =
+00008500: 2052 4f55 4e44 2920 2d3e 2066 6c6f 6174   ROUND) -> float
+00008510: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00008520: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
+00008530: 6520 7072 6963 6520 726f 756e 6465 6420  e price rounded 
+00008540: 746f 2074 6865 2070 7265 6369 7369 6f6e  to the precision
+00008550: 2074 6865 2045 7863 6861 6e67 6520 6163   the Exchange ac
+00008560: 6365 7074 732e 0a20 2020 2020 2020 2054  cepts..        T
+00008570: 6865 2064 6566 6175 6c74 2070 7269 6365  he default price
+00008580: 5f72 6f75 6e64 696e 675f 6d6f 6465 2069  _rounding_mode i
+00008590: 6e20 636f 6e66 2069 7320 524f 554e 442e  n conf is ROUND.
+000085a0: 0a20 2020 2020 2020 2046 6f72 2073 746f  .        For sto
+000085b0: 706c 6f73 7320 6361 6c63 756c 6174 696f  ploss calculatio
+000085c0: 6e73 2c20 6d75 7374 2075 7365 2052 4f55  ns, must use ROU
+000085d0: 4e44 5f55 5020 666f 7220 6c6f 6e67 732c  ND_UP for longs,
+000085e0: 2061 6e64 2052 4f55 4e44 5f44 4f57 4e20   and ROUND_DOWN 
+000085f0: 666f 7220 7368 6f72 7473 2e0a 2020 2020  for shorts..    
+00008600: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00008610: 7265 7475 726e 2070 7269 6365 5f74 6f5f  return price_to_
+00008620: 7072 6563 6973 696f 6e28 7072 6963 652c  precision(price,
+00008630: 2073 656c 662e 6765 745f 7072 6563 6973   self.get_precis
+00008640: 696f 6e5f 7072 6963 6528 7061 6972 292c  ion_price(pair),
+00008650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008670: 2020 2073 656c 662e 7072 6563 6973 696f     self.precisio
+00008680: 6e4d 6f64 652c 2072 6f75 6e64 696e 675f  nMode, rounding_
+00008690: 6d6f 6465 3d72 6f75 6e64 696e 675f 6d6f  mode=rounding_mo
+000086a0: 6465 290a 0a20 2020 2064 6566 2070 7269  de)..    def pri
+000086b0: 6365 5f67 6574 5f6f 6e65 5f70 6970 2873  ce_get_one_pip(s
+000086c0: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+000086d0: 7072 6963 653a 2066 6c6f 6174 2920 2d3e  price: float) ->
+000086e0: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+000086f0: 2222 220a 2020 2020 2020 2020 4765 7427  """.        Get'
+00008700: 7320 7468 6520 2231 2070 6970 2220 7661  s the "1 pip" va
+00008710: 6c75 6520 666f 7220 7468 6973 2070 6169  lue for this pai
+00008720: 722e 0a20 2020 2020 2020 2055 7365 6420  r..        Used 
+00008730: 696e 2050 7269 6365 4669 6c74 6572 2074  in PriceFilter t
+00008740: 6f20 6361 6c63 756c 6174 6520 7468 6520  o calculate the 
+00008750: 3170 6970 206d 6f76 656d 656e 7473 2e0a  1pip movements..
+00008760: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008770: 2020 2020 7072 6563 6973 696f 6e20 3d20      precision = 
+00008780: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
+00008790: 725d 5b27 7072 6563 6973 696f 6e27 5d5b  r]['precision'][
+000087a0: 2770 7269 6365 275d 0a20 2020 2020 2020  'price'].       
+000087b0: 2069 6620 7365 6c66 2e70 7265 6369 7369   if self.precisi
+000087c0: 6f6e 4d6f 6465 203d 3d20 5449 434b 5f53  onMode == TICK_S
+000087d0: 495a 453a 0a20 2020 2020 2020 2020 2020  IZE:.           
+000087e0: 2072 6574 7572 6e20 7072 6563 6973 696f   return precisio
+000087f0: 6e0a 2020 2020 2020 2020 656c 7365 3a0a  n.        else:.
+00008800: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00008810: 726e 2031 202f 2070 6f77 2831 302c 2070  rn 1 / pow(10, p
+00008820: 7265 6369 7369 6f6e 290a 0a20 2020 2064  recision)..    d
+00008830: 6566 2067 6574 5f6d 696e 5f70 6169 725f  ef get_min_pair_
+00008840: 7374 616b 655f 616d 6f75 6e74 280a 2020  stake_amount(.  
+00008850: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00008860: 2020 2020 7061 6972 3a20 7374 722c 0a20      pair: str,. 
+00008870: 2020 2020 2020 2070 7269 6365 3a20 666c         price: fl
+00008880: 6f61 742c 0a20 2020 2020 2020 2073 746f  oat,.        sto
+00008890: 706c 6f73 733a 2066 6c6f 6174 2c0a 2020  ploss: float,.  
+000088a0: 2020 2020 2020 6c65 7665 7261 6765 3a20        leverage: 
+000088b0: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d20  Optional[float] 
+000088c0: 3d20 312e 300a 2020 2020 2920 2d3e 204f  = 1.0.    ) -> O
+000088d0: 7074 696f 6e61 6c5b 666c 6f61 745d 3a0a  ptional[float]:.
+000088e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000088f0: 656c 662e 5f67 6574 5f73 7461 6b65 5f61  elf._get_stake_a
+00008900: 6d6f 756e 745f 6c69 6d69 7428 7061 6972  mount_limit(pair
+00008910: 2c20 7072 6963 652c 2073 746f 706c 6f73  , price, stoplos
+00008920: 732c 2027 6d69 6e27 2c20 6c65 7665 7261  s, 'min', levera
+00008930: 6765 290a 0a20 2020 2064 6566 2067 6574  ge)..    def get
+00008940: 5f6d 6178 5f70 6169 725f 7374 616b 655f  _max_pair_stake_
+00008950: 616d 6f75 6e74 2873 656c 662c 2070 6169  amount(self, pai
+00008960: 723a 2073 7472 2c20 7072 6963 653a 2066  r: str, price: f
+00008970: 6c6f 6174 2c20 6c65 7665 7261 6765 3a20  loat, leverage: 
+00008980: 666c 6f61 7420 3d20 312e 3029 202d 3e20  float = 1.0) -> 
+00008990: 666c 6f61 743a 0a20 2020 2020 2020 206d  float:.        m
+000089a0: 6178 5f73 7461 6b65 5f61 6d6f 756e 7420  ax_stake_amount 
+000089b0: 3d20 7365 6c66 2e5f 6765 745f 7374 616b  = self._get_stak
+000089c0: 655f 616d 6f75 6e74 5f6c 696d 6974 2870  e_amount_limit(p
+000089d0: 6169 722c 2070 7269 6365 2c20 302e 302c  air, price, 0.0,
+000089e0: 2027 6d61 7827 2c20 6c65 7665 7261 6765   'max', leverage
+000089f0: 290a 2020 2020 2020 2020 6966 206d 6178  ).        if max
+00008a00: 5f73 7461 6b65 5f61 6d6f 756e 7420 6973  _stake_amount is
+00008a10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00008a20: 2020 2023 202a 2053 686f 756c 6420 6e65     # * Should ne
+00008a30: 7665 7220 6265 2065 7865 6375 7465 640a  ver be executed.
+00008a40: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00008a50: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00008a60: 6570 7469 6f6e 2866 277b 7365 6c66 2e6e  eption(f'{self.n
+00008a70: 616d 657d 2e67 6574 5f6d 6178 5f70 6169  ame}.get_max_pai
+00008a80: 725f 7374 616b 655f 616d 6f75 6e74 2073  r_stake_amount s
+00008a90: 686f 756c 6427 0a20 2020 2020 2020 2020  hould'.         
 00008aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ab0: 2020 2020 276e 6576 6572 2073 6574 206d      'never set m
-00008ac0: 6178 5f73 7461 6b65 5f61 6d6f 756e 7420  ax_stake_amount 
-00008ad0: 746f 204e 6f6e 6527 290a 2020 2020 2020  to None').      
-00008ae0: 2020 7265 7475 726e 206d 6178 5f73 7461    return max_sta
-00008af0: 6b65 5f61 6d6f 756e 740a 0a20 2020 2064  ke_amount..    d
-00008b00: 6566 205f 6765 745f 7374 616b 655f 616d  ef _get_stake_am
-00008b10: 6f75 6e74 5f6c 696d 6974 280a 2020 2020  ount_limit(.    
-00008b20: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00008b30: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
-00008b40: 2020 2020 2070 7269 6365 3a20 666c 6f61       price: floa
-00008b50: 742c 0a20 2020 2020 2020 2073 746f 706c  t,.        stopl
-00008b60: 6f73 733a 2066 6c6f 6174 2c0a 2020 2020  oss: float,.    
-00008b70: 2020 2020 6c69 6d69 743a 204c 6974 6572      limit: Liter
-00008b80: 616c 5b27 6d69 6e27 2c20 276d 6178 275d  al['min', 'max']
-00008b90: 2c0a 2020 2020 2020 2020 6c65 7665 7261  ,.        levera
-00008ba0: 6765 3a20 4f70 7469 6f6e 616c 5b66 6c6f  ge: Optional[flo
-00008bb0: 6174 5d20 3d20 312e 300a 2020 2020 2920  at] = 1.0.    ) 
-00008bc0: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
-00008bd0: 745d 3a0a 0a20 2020 2020 2020 2069 734d  t]:..        isM
-00008be0: 696e 203d 206c 696d 6974 203d 3d20 276d  in = limit == 'm
-00008bf0: 696e 270a 0a20 2020 2020 2020 2074 7279  in'..        try
-00008c00: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00008c10: 726b 6574 203d 2073 656c 662e 6d61 726b  rket = self.mark
-00008c20: 6574 735b 7061 6972 5d0a 2020 2020 2020  ets[pair].      
-00008c30: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00008c40: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
-00008c50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00008c60: 6622 4361 6e27 7420 6765 7420 6d61 726b  f"Can't get mark
-00008c70: 6574 2069 6e66 6f72 6d61 7469 6f6e 2066  et information f
-00008c80: 6f72 2073 796d 626f 6c20 7b70 6169 727d  or symbol {pair}
-00008c90: 2229 0a0a 2020 2020 2020 2020 6966 2069  ")..        if i
-00008ca0: 734d 696e 3a0a 2020 2020 2020 2020 2020  sMin:.          
-00008cb0: 2020 2320 7265 7365 7276 6520 736f 6d65    # reserve some
-00008cc0: 2070 6572 6365 6e74 2064 6566 696e 6564   percent defined
-00008cd0: 2069 6e20 636f 6e66 6967 2028 3525 2064   in config (5% d
-00008ce0: 6566 6175 6c74 2920 2b20 7374 6f70 6c6f  efault) + stoplo
-00008cf0: 7373 0a20 2020 2020 2020 2020 2020 206d  ss.            m
-00008d00: 6172 6769 6e5f 7265 7365 7276 653a 2066  argin_reserve: f
-00008d10: 6c6f 6174 203d 2031 2e30 202b 2073 656c  loat = 1.0 + sel
-00008d20: 662e 5f63 6f6e 6669 672e 6765 7428 2761  f._config.get('a
-00008d30: 6d6f 756e 745f 7265 7365 7276 655f 7065  mount_reserve_pe
-00008d40: 7263 656e 7427 2c0a 2020 2020 2020 2020  rcent',.        
-00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ab0: 2020 2020 2020 2020 2020 2020 2020 276e                'n
+00008ac0: 6576 6572 2073 6574 206d 6178 5f73 7461  ever set max_sta
+00008ad0: 6b65 5f61 6d6f 756e 7420 746f 204e 6f6e  ke_amount to Non
+00008ae0: 6527 290a 2020 2020 2020 2020 7265 7475  e').        retu
+00008af0: 726e 206d 6178 5f73 7461 6b65 5f61 6d6f  rn max_stake_amo
+00008b00: 756e 740a 0a20 2020 2064 6566 205f 6765  unt..    def _ge
+00008b10: 745f 7374 616b 655f 616d 6f75 6e74 5f6c  t_stake_amount_l
+00008b20: 696d 6974 280a 2020 2020 2020 2020 7365  imit(.        se
+00008b30: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
+00008b40: 3a20 7374 722c 0a20 2020 2020 2020 2070  : str,.        p
+00008b50: 7269 6365 3a20 666c 6f61 742c 0a20 2020  rice: float,.   
+00008b60: 2020 2020 2073 746f 706c 6f73 733a 2066       stoploss: f
+00008b70: 6c6f 6174 2c0a 2020 2020 2020 2020 6c69  loat,.        li
+00008b80: 6d69 743a 204c 6974 6572 616c 5b27 6d69  mit: Literal['mi
+00008b90: 6e27 2c20 276d 6178 275d 2c0a 2020 2020  n', 'max'],.    
+00008ba0: 2020 2020 6c65 7665 7261 6765 3a20 4f70      leverage: Op
+00008bb0: 7469 6f6e 616c 5b66 6c6f 6174 5d20 3d20  tional[float] = 
+00008bc0: 312e 300a 2020 2020 2920 2d3e 204f 7074  1.0.    ) -> Opt
+00008bd0: 696f 6e61 6c5b 666c 6f61 745d 3a0a 0a20  ional[float]:.. 
+00008be0: 2020 2020 2020 2069 734d 696e 203d 206c         isMin = l
+00008bf0: 696d 6974 203d 3d20 276d 696e 270a 0a20  imit == 'min'.. 
+00008c00: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00008c10: 2020 2020 2020 2020 6d61 726b 6574 203d          market =
+00008c20: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
+00008c30: 6972 5d0a 2020 2020 2020 2020 6578 6365  ir].        exce
+00008c40: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
+00008c50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00008c60: 616c 7565 4572 726f 7228 6622 4361 6e27  alueError(f"Can'
+00008c70: 7420 6765 7420 6d61 726b 6574 2069 6e66  t get market inf
+00008c80: 6f72 6d61 7469 6f6e 2066 6f72 2073 796d  ormation for sym
+00008c90: 626f 6c20 7b70 6169 727d 2229 0a0a 2020  bol {pair}")..  
+00008ca0: 2020 2020 2020 6966 2069 734d 696e 3a0a        if isMin:.
+00008cb0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+00008cc0: 7365 7276 6520 736f 6d65 2070 6572 6365  serve some perce
+00008cd0: 6e74 2064 6566 696e 6564 2069 6e20 636f  nt defined in co
+00008ce0: 6e66 6967 2028 3525 2064 6566 6175 6c74  nfig (5% default
+00008cf0: 2920 2b20 7374 6f70 6c6f 7373 0a20 2020  ) + stoploss.   
+00008d00: 2020 2020 2020 2020 206d 6172 6769 6e5f           margin_
+00008d10: 7265 7365 7276 653a 2066 6c6f 6174 203d  reserve: float =
+00008d20: 2031 2e30 202b 2073 656c 662e 5f63 6f6e   1.0 + self._con
+00008d30: 6669 672e 6765 7428 2761 6d6f 756e 745f  fig.get('amount_
+00008d40: 7265 7365 7276 655f 7065 7263 656e 7427  reserve_percent'
+00008d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00008d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d80: 2020 2044 4546 4155 4c54 5f41 4d4f 554e     DEFAULT_AMOUN
-00008d90: 545f 5245 5345 5256 455f 5045 5243 454e  T_RESERVE_PERCEN
-00008da0: 5429 0a20 2020 2020 2020 2020 2020 2073  T).            s
-00008db0: 746f 706c 6f73 735f 7265 7365 7276 6520  toploss_reserve 
-00008dc0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00008dd0: 2020 2020 6d61 7267 696e 5f72 6573 6572      margin_reser
-00008de0: 7665 202f 2028 3120 2d20 6162 7328 7374  ve / (1 - abs(st
-00008df0: 6f70 6c6f 7373 2929 2069 6620 6162 7328  oploss)) if abs(
-00008e00: 7374 6f70 6c6f 7373 2920 213d 2031 2065  stoploss) != 1 e
-00008e10: 6c73 6520 312e 350a 2020 2020 2020 2020  lse 1.5.        
-00008e20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00008e30: 2020 2320 6974 2073 686f 756c 6420 6e6f    # it should no
-00008e40: 7420 6265 206d 6f72 6520 7468 616e 2035  t be more than 5
-00008e50: 3025 0a20 2020 2020 2020 2020 2020 2073  0%.            s
-00008e60: 746f 706c 6f73 735f 7265 7365 7276 6520  toploss_reserve 
-00008e70: 3d20 6d61 7828 6d69 6e28 7374 6f70 6c6f  = max(min(stoplo
-00008e80: 7373 5f72 6573 6572 7665 2c20 312e 3529  ss_reserve, 1.5)
-00008e90: 2c20 3129 0a20 2020 2020 2020 2065 6c73  , 1).        els
-00008ea0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-00008eb0: 6172 6769 6e5f 7265 7365 7276 6520 3d20  argin_reserve = 
-00008ec0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
-00008ed0: 7374 6f70 6c6f 7373 5f72 6573 6572 7665  stoploss_reserve
-00008ee0: 203d 2031 2e30 0a0a 2020 2020 2020 2020   = 1.0..        
-00008ef0: 7374 616b 655f 6c69 6d69 7473 203d 205b  stake_limits = [
-00008f00: 5d0a 2020 2020 2020 2020 6c69 6d69 7473  ].        limits
-00008f10: 203d 206d 6172 6b65 745b 276c 696d 6974   = market['limit
-00008f20: 7327 5d0a 2020 2020 2020 2020 6966 2028  s'].        if (
-00008f30: 6c69 6d69 7473 5b27 636f 7374 275d 5b6c  limits['cost'][l
-00008f40: 696d 6974 5d20 6973 206e 6f74 204e 6f6e  imit] is not Non
-00008f50: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00008f60: 7374 616b 655f 6c69 6d69 7473 2e61 7070  stake_limits.app
-00008f70: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-00008f80: 2020 2020 2073 656c 662e 5f63 6f6e 7472       self._contr
-00008f90: 6163 7473 5f74 6f5f 616d 6f75 6e74 2870  acts_to_amount(p
-00008fa0: 6169 722c 206c 696d 6974 735b 2763 6f73  air, limits['cos
-00008fb0: 7427 5d5b 6c69 6d69 745d 2920 2a20 7374  t'][limit]) * st
-00008fc0: 6f70 6c6f 7373 5f72 6573 6572 7665 0a20  oploss_reserve. 
-00008fd0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00008fe0: 2020 2020 2020 6966 2028 6c69 6d69 7473        if (limits
-00008ff0: 5b27 616d 6f75 6e74 275d 5b6c 696d 6974  ['amount'][limit
-00009000: 5d20 6973 206e 6f74 204e 6f6e 6529 3a0a  ] is not None):.
-00009010: 2020 2020 2020 2020 2020 2020 7374 616b              stak
-00009020: 655f 6c69 6d69 7473 2e61 7070 656e 6428  e_limits.append(
-00009030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009040: 2073 656c 662e 5f63 6f6e 7472 6163 7473   self._contracts
-00009050: 5f74 6f5f 616d 6f75 6e74 2870 6169 722c  _to_amount(pair,
-00009060: 206c 696d 6974 735b 2761 6d6f 756e 7427   limits['amount'
-00009070: 5d5b 6c69 6d69 745d 2920 2a20 7072 6963  ][limit]) * pric
-00009080: 6520 2a20 6d61 7267 696e 5f72 6573 6572  e * margin_reser
-00009090: 7665 0a20 2020 2020 2020 2020 2020 2029  ve.            )
-000090a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-000090b0: 2073 7461 6b65 5f6c 696d 6974 733a 0a20   stake_limits:. 
-000090c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000090d0: 6e20 4e6f 6e65 2069 6620 6973 4d69 6e20  n None if isMin 
-000090e0: 656c 7365 2066 6c6f 6174 2827 696e 6627  else float('inf'
-000090f0: 290a 0a20 2020 2020 2020 2023 2054 6865  )..        # The
-00009100: 2076 616c 7565 2072 6574 7572 6e65 6420   value returned 
-00009110: 7368 6f75 6c64 2073 6174 6973 6679 2062  should satisfy b
-00009120: 6f74 6820 6c69 6d69 7473 3a20 666f 7220  oth limits: for 
-00009130: 616d 6f75 6e74 2028 6261 7365 2063 7572  amount (base cur
-00009140: 7265 6e63 7929 2061 6e64 0a20 2020 2020  rency) and.     
-00009150: 2020 2023 2066 6f72 2063 6f73 7420 2871     # for cost (q
-00009160: 756f 7465 2c20 7374 616b 6520 6375 7272  uote, stake curr
-00009170: 656e 6379 292c 2073 6f20 6d61 7828 2920  ency), so max() 
-00009180: 6973 2075 7365 6420 6865 7265 2e0a 2020  is used here..  
-00009190: 2020 2020 2020 2320 5365 6520 616c 736f        # See also
-000091a0: 2023 3235 3735 2061 7420 6769 7468 7562   #2575 at github
-000091b0: 2e0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000091c0: 2073 656c 662e 5f67 6574 5f73 7461 6b65   self._get_stake
-000091d0: 5f61 6d6f 756e 745f 636f 6e73 6964 6572  _amount_consider
-000091e0: 696e 675f 6c65 7665 7261 6765 280a 2020  ing_leverage(.  
-000091f0: 2020 2020 2020 2020 2020 6d61 7828 7374            max(st
-00009200: 616b 655f 6c69 6d69 7473 2920 6966 2069  ake_limits) if i
-00009210: 734d 696e 2065 6c73 6520 6d69 6e28 7374  sMin else min(st
-00009220: 616b 655f 6c69 6d69 7473 292c 0a20 2020  ake_limits),.   
-00009230: 2020 2020 2020 2020 206c 6576 6572 6167           leverag
-00009240: 6520 6f72 2031 2e30 0a20 2020 2020 2020  e or 1.0.       
-00009250: 2029 0a0a 2020 2020 6465 6620 5f67 6574   )..    def _get
-00009260: 5f73 7461 6b65 5f61 6d6f 756e 745f 636f  _stake_amount_co
-00009270: 6e73 6964 6572 696e 675f 6c65 7665 7261  nsidering_levera
-00009280: 6765 2873 656c 662c 2073 7461 6b65 5f61  ge(self, stake_a
-00009290: 6d6f 756e 743a 2066 6c6f 6174 2c20 6c65  mount: float, le
-000092a0: 7665 7261 6765 3a20 666c 6f61 7429 202d  verage: float) -
-000092b0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
-000092c0: 2022 2222 0a20 2020 2020 2020 2054 616b   """.        Tak
-000092d0: 6573 2074 6865 206d 696e 696d 756d 2073  es the minimum s
-000092e0: 7461 6b65 2061 6d6f 756e 7420 666f 7220  take amount for 
-000092f0: 6120 7061 6972 2077 6974 6820 6e6f 206c  a pair with no l
-00009300: 6576 6572 6167 6520 616e 6420 7265 7475  everage and retu
-00009310: 726e 7320 7468 6520 6d69 6e69 6d75 6d0a  rns the minimum.
-00009320: 2020 2020 2020 2020 7374 616b 6520 616d          stake am
-00009330: 6f75 6e74 2077 6865 6e20 6c65 7665 7261  ount when levera
-00009340: 6765 2069 7320 636f 6e73 6964 6572 6564  ge is considered
-00009350: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00009360: 7374 616b 655f 616d 6f75 6e74 3a20 5468  stake_amount: Th
-00009370: 6520 7374 616b 6520 616d 6f75 6e74 2066  e stake amount f
-00009380: 6f72 2061 2070 6169 7220 6265 666f 7265  or a pair before
-00009390: 206c 6576 6572 6167 6520 6973 2063 6f6e   leverage is con
-000093a0: 7369 6465 7265 640a 2020 2020 2020 2020  sidered.        
-000093b0: 3a70 6172 616d 206c 6576 6572 6167 653a  :param leverage:
-000093c0: 2054 6865 2061 6d6f 756e 7420 6f66 206c   The amount of l
-000093d0: 6576 6572 6167 6520 6265 696e 6720 7573  everage being us
-000093e0: 6564 206f 6e20 7468 6520 6375 7272 656e  ed on the curren
-000093f0: 7420 7472 6164 650a 2020 2020 2020 2020  t trade.        
-00009400: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00009410: 726e 2073 7461 6b65 5f61 6d6f 756e 7420  rn stake_amount 
-00009420: 2f20 6c65 7665 7261 6765 0a0a 2020 2020  / leverage..    
-00009430: 2320 4472 792d 7275 6e20 6d65 7468 6f64  # Dry-run method
-00009440: 730a 0a20 2020 2064 6566 2063 7265 6174  s..    def creat
-00009450: 655f 6472 795f 7275 6e5f 6f72 6465 7228  e_dry_run_order(
-00009460: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-00009470: 206f 7264 6572 7479 7065 3a20 7374 722c   ordertype: str,
-00009480: 2073 6964 653a 2073 7472 2c20 616d 6f75   side: str, amou
-00009490: 6e74 3a20 666c 6f61 742c 0a20 2020 2020  nt: float,.     
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2020 2020 2020 2020 7261 7465 3a20 666c          rate: fl
-000094c0: 6f61 742c 206c 6576 6572 6167 653a 2066  oat, leverage: f
-000094d0: 6c6f 6174 2c20 7061 7261 6d73 3a20 4469  loat, params: Di
-000094e0: 6374 203d 207b 7d2c 0a20 2020 2020 2020  ct = {},.       
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 2020 2020 7374 6f70 5f6c 6f73 733a        stop_loss:
-00009510: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
-00009520: 3e20 4469 6374 5b73 7472 2c20 416e 795d  > Dict[str, Any]
-00009530: 3a0a 2020 2020 2020 2020 6e6f 7720 3d20  :.        now = 
-00009540: 6474 5f6e 6f77 2829 0a20 2020 2020 2020  dt_now().       
-00009550: 206f 7264 6572 5f69 6420 3d20 6627 6472   order_id = f'dr
-00009560: 795f 7275 6e5f 7b73 6964 657d 5f7b 6e6f  y_run_{side}_{no
-00009570: 772e 7469 6d65 7374 616d 7028 297d 270a  w.timestamp()}'.
-00009580: 2020 2020 2020 2020 2320 526f 756e 6469          # Roundi
-00009590: 6e67 2068 6572 6520 6d75 7374 2072 6573  ng here must res
-000095a0: 7065 6374 2074 6f20 636f 6e74 7261 6374  pect to contract
-000095b0: 2073 697a 6573 0a20 2020 2020 2020 205f   sizes.        _
-000095c0: 616d 6f75 6e74 203d 2073 656c 662e 5f63  amount = self._c
-000095d0: 6f6e 7472 6163 7473 5f74 6f5f 616d 6f75  ontracts_to_amou
-000095e0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-000095f0: 7061 6972 2c20 7365 6c66 2e61 6d6f 756e  pair, self.amoun
-00009600: 745f 746f 5f70 7265 6369 7369 6f6e 2870  t_to_precision(p
-00009610: 6169 722c 2073 656c 662e 5f61 6d6f 756e  air, self._amoun
-00009620: 745f 746f 5f63 6f6e 7472 6163 7473 2870  t_to_contracts(p
-00009630: 6169 722c 2061 6d6f 756e 7429 2929 0a20  air, amount))). 
-00009640: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
-00009650: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-00009660: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00009670: 2027 6964 273a 206f 7264 6572 5f69 642c   'id': order_id,
-00009680: 0a20 2020 2020 2020 2020 2020 2027 7379  .            'sy
-00009690: 6d62 6f6c 273a 2070 6169 722c 0a20 2020  mbol': pair,.   
-000096a0: 2020 2020 2020 2020 2027 7072 6963 6527           'price'
-000096b0: 3a20 7261 7465 2c0a 2020 2020 2020 2020  : rate,.        
-000096c0: 2020 2020 2761 7665 7261 6765 273a 2072      'average': r
-000096d0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-000096e0: 2027 616d 6f75 6e74 273a 205f 616d 6f75   'amount': _amou
-000096f0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00009700: 2763 6f73 7427 3a20 5f61 6d6f 756e 7420  'cost': _amount 
-00009710: 2a20 7261 7465 2c0a 2020 2020 2020 2020  * rate,.        
-00009720: 2020 2020 2774 7970 6527 3a20 6f72 6465      'type': orde
-00009730: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
-00009740: 2020 2027 7369 6465 273a 2073 6964 652c     'side': side,
-00009750: 0a20 2020 2020 2020 2020 2020 2027 6669  .            'fi
-00009760: 6c6c 6564 273a 2030 2c0a 2020 2020 2020  lled': 0,.      
-00009770: 2020 2020 2020 2772 656d 6169 6e69 6e67        'remaining
-00009780: 273a 205f 616d 6f75 6e74 2c0a 2020 2020  ': _amount,.    
-00009790: 2020 2020 2020 2020 2764 6174 6574 696d          'datetim
-000097a0: 6527 3a20 6e6f 772e 7374 7266 7469 6d65  e': now.strftime
-000097b0: 2827 2559 2d25 6d2d 2564 5425 483a 254d  ('%Y-%m-%dT%H:%M
-000097c0: 3a25 532e 2566 5a27 292c 0a20 2020 2020  :%S.%fZ'),.     
-000097d0: 2020 2020 2020 2027 7469 6d65 7374 616d         'timestam
-000097e0: 7027 3a20 6474 5f74 7328 6e6f 7729 2c0a  p': dt_ts(now),.
-000097f0: 2020 2020 2020 2020 2020 2020 2773 7461              'sta
-00009800: 7475 7327 3a20 226f 7065 6e22 2c0a 2020  tus': "open",.  
-00009810: 2020 2020 2020 2020 2020 2766 6565 273a            'fee':
-00009820: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00009830: 2020 2027 696e 666f 273a 207b 7d2c 0a20     'info': {},. 
-00009840: 2020 2020 2020 2020 2020 2027 6c65 7665             'leve
-00009850: 7261 6765 273a 206c 6576 6572 6167 650a  rage': leverage.
-00009860: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00009870: 2020 6966 2073 746f 705f 6c6f 7373 3a0a    if stop_loss:.
-00009880: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
-00009890: 6f72 6465 725b 2269 6e66 6f22 5d20 3d20  order["info"] = 
-000098a0: 7b22 7374 6f70 5072 6963 6522 3a20 6472  {"stopPrice": dr
-000098b0: 795f 6f72 6465 725b 2270 7269 6365 225d  y_order["price"]
-000098c0: 7d0a 2020 2020 2020 2020 2020 2020 6472  }.            dr
-000098d0: 795f 6f72 6465 725b 7365 6c66 2e5f 6674  y_order[self._ft
-000098e0: 5f68 6173 5b27 7374 6f70 5f70 7269 6365  _has['stop_price
-000098f0: 5f70 6172 616d 275d 5d20 3d20 6472 795f  _param']] = dry_
-00009900: 6f72 6465 725b 2270 7269 6365 225d 0a20  order["price"]. 
-00009910: 2020 2020 2020 2020 2020 2023 2057 6f72             # Wor
-00009920: 6b61 726f 756e 6420 746f 2061 766f 6964  karound to avoid
-00009930: 2066 696c 6c69 6e67 2073 746f 706c 6f73   filling stoplos
-00009940: 7320 6f72 6465 7273 2069 6d6d 6564 6961  s orders immedia
-00009950: 7465 6c79 0a20 2020 2020 2020 2020 2020  tely.           
-00009960: 2064 7279 5f6f 7264 6572 5b22 6674 5f6f   dry_order["ft_o
-00009970: 7264 6572 5f74 7970 6522 5d20 3d20 2273  rder_type"] = "s
-00009980: 746f 706c 6f73 7322 0a20 2020 2020 2020  toploss".       
-00009990: 206f 7264 6572 626f 6f6b 3a20 4f70 7469   orderbook: Opti
-000099a0: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d20  onal[OrderBook] 
-000099b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
-000099c0: 6620 7365 6c66 2e65 7863 6861 6e67 655f  f self.exchange_
-000099d0: 6861 7328 2766 6574 6368 4c32 4f72 6465  has('fetchL2Orde
-000099e0: 7242 6f6f 6b27 293a 0a20 2020 2020 2020  rBook'):.       
-000099f0: 2020 2020 206f 7264 6572 626f 6f6b 203d       orderbook =
-00009a00: 2073 656c 662e 6665 7463 685f 6c32 5f6f   self.fetch_l2_o
-00009a10: 7264 6572 5f62 6f6f 6b28 7061 6972 2c20  rder_book(pair, 
-00009a20: 3230 290a 2020 2020 2020 2020 6966 206f  20).        if o
-00009a30: 7264 6572 7479 7065 203d 3d20 226c 696d  rdertype == "lim
-00009a40: 6974 2220 616e 6420 6f72 6465 7262 6f6f  it" and orderboo
-00009a50: 6b3a 0a20 2020 2020 2020 2020 2020 2023  k:.            #
-00009a60: 2041 6c6c 6f77 2061 2033 2520 7072 6963   Allow a 3% pric
-00009a70: 6520 6469 6666 6572 656e 6365 0a20 2020  e difference.   
-00009a80: 2020 2020 2020 2020 2061 6c6c 6f77 6564           allowed
-00009a90: 5f64 6966 6620 3d20 302e 3033 0a20 2020  _diff = 0.03.   
-00009aa0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00009ab0: 2e5f 6472 795f 6973 5f70 7269 6365 5f63  ._dry_is_price_c
-00009ac0: 726f 7373 6564 2870 6169 722c 2073 6964  rossed(pair, sid
-00009ad0: 652c 2072 6174 652c 206f 7264 6572 626f  e, rate, orderbo
-00009ae0: 6f6b 2c20 616c 6c6f 7765 645f 6469 6666  ok, allowed_diff
-00009af0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00009b00: 2020 206c 6f67 6765 722e 696e 666f 280a     logger.info(.
-00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b20: 2020 2020 6622 436f 6e76 6572 7465 6420      f"Converted 
-00009b30: 6f72 6465 7220 7b70 6169 727d 2074 6f20  order {pair} to 
-00009b40: 6d61 726b 6574 206f 7264 6572 2064 7565  market order due
-00009b50: 2074 6f20 7072 6963 6520 7b72 6174 657d   to price {rate}
-00009b60: 2063 726f 7373 696e 6720 7370 7265 6164   crossing spread
-00009b70: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00009b80: 2020 2020 2020 2066 2262 7920 6d6f 7265         f"by more
-00009b90: 2074 6861 6e20 7b61 6c6c 6f77 6564 5f64   than {allowed_d
-00009ba0: 6966 663a 2e32 257d 2e22 290a 2020 2020  iff:.2%}.").    
-00009bb0: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
-00009bc0: 6f72 6465 725b 2274 7970 6522 5d20 3d20  order["type"] = 
-00009bd0: 226d 6172 6b65 7422 0a0a 2020 2020 2020  "market"..      
-00009be0: 2020 6966 2064 7279 5f6f 7264 6572 5b22    if dry_order["
-00009bf0: 7479 7065 225d 203d 3d20 226d 6172 6b65  type"] == "marke
-00009c00: 7422 2061 6e64 206e 6f74 2064 7279 5f6f  t" and not dry_o
-00009c10: 7264 6572 2e67 6574 2822 6674 5f6f 7264  rder.get("ft_ord
-00009c20: 6572 5f74 7970 6522 293a 0a20 2020 2020  er_type"):.     
-00009c30: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
-00009c40: 6d61 726b 6574 206f 7264 6572 2070 7269  market order pri
-00009c50: 6369 6e67 0a20 2020 2020 2020 2020 2020  cing.           
-00009c60: 2061 7665 7261 6765 203d 2073 656c 662e   average = self.
-00009c70: 6765 745f 6472 795f 6d61 726b 6574 5f66  get_dry_market_f
-00009c80: 696c 6c5f 7072 6963 6528 7061 6972 2c20  ill_price(pair, 
-00009c90: 7369 6465 2c20 616d 6f75 6e74 2c20 7261  side, amount, ra
-00009ca0: 7465 2c20 6f72 6465 7262 6f6f 6b29 0a20  te, orderbook). 
-00009cb0: 2020 2020 2020 2020 2020 2064 7279 5f6f             dry_o
-00009cc0: 7264 6572 2e75 7064 6174 6528 7b0a 2020  rder.update({.  
-00009cd0: 2020 2020 2020 2020 2020 2020 2020 2761                'a
-00009ce0: 7665 7261 6765 273a 2061 7665 7261 6765  verage': average
-00009cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009d00: 2020 2766 696c 6c65 6427 3a20 5f61 6d6f    'filled': _amo
-00009d10: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
-00009d20: 2020 2020 2027 7265 6d61 696e 696e 6727       'remaining'
-00009d30: 3a20 302e 302c 0a20 2020 2020 2020 2020  : 0.0,.         
-00009d40: 2020 2020 2020 2027 7374 6174 7573 273a         'status':
-00009d50: 2022 636c 6f73 6564 222c 0a20 2020 2020   "closed",.     
-00009d60: 2020 2020 2020 2020 2020 2027 636f 7374             'cost
-00009d70: 273a 2028 6472 795f 6f72 6465 725b 2761  ': (dry_order['a
-00009d80: 6d6f 756e 7427 5d20 2a20 6176 6572 6167  mount'] * averag
-00009d90: 6529 0a20 2020 2020 2020 2020 2020 207d  e).            }
-00009da0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00009db0: 6d61 726b 6574 206f 7264 6572 7320 7769  market orders wi
-00009dc0: 6c6c 2061 6c77 6179 7320 696e 6375 7272  ll always incurr
-00009dd0: 2074 616b 6572 2066 6565 730a 2020 2020   taker fees.    
-00009de0: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
-00009df0: 7220 3d20 7365 6c66 2e61 6464 5f64 7279  r = self.add_dry
-00009e00: 5f6f 7264 6572 5f66 6565 2870 6169 722c  _order_fee(pair,
-00009e10: 2064 7279 5f6f 7264 6572 2c20 2774 616b   dry_order, 'tak
-00009e20: 6572 2729 0a0a 2020 2020 2020 2020 6472  er')..        dr
-00009e30: 795f 6f72 6465 7220 3d20 7365 6c66 2e63  y_order = self.c
-00009e40: 6865 636b 5f64 7279 5f6c 696d 6974 5f6f  heck_dry_limit_o
-00009e50: 7264 6572 5f66 696c 6c65 6428 0a20 2020  rder_filled(.   
-00009e60: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
-00009e70: 6572 2c20 696d 6d65 6469 6174 653d 5472  er, immediate=Tr
-00009e80: 7565 2c20 6f72 6465 7262 6f6f 6b3d 6f72  ue, orderbook=or
-00009e90: 6465 7262 6f6f 6b29 0a0a 2020 2020 2020  derbook)..      
-00009ea0: 2020 7365 6c66 2e5f 6472 795f 7275 6e5f    self._dry_run_
-00009eb0: 6f70 656e 5f6f 7264 6572 735b 6472 795f  open_orders[dry_
-00009ec0: 6f72 6465 725b 2269 6422 5d5d 203d 2064  order["id"]] = d
-00009ed0: 7279 5f6f 7264 6572 0a20 2020 2020 2020  ry_order.       
-00009ee0: 2023 2043 6f70 7920 6f72 6465 7220 616e   # Copy order an
-00009ef0: 6420 636c 6f73 6520 6974 202d 2073 6f20  d close it - so 
-00009f00: 7468 6520 7265 7475 726e 6564 206f 7264  the returned ord
-00009f10: 6572 2069 7320 6f70 656e 2075 6e6c 6573  er is open unles
-00009f20: 7320 6974 2773 2061 206d 6172 6b65 7420  s it's a market 
-00009f30: 6f72 6465 720a 2020 2020 2020 2020 7265  order.        re
-00009f40: 7475 726e 2064 7279 5f6f 7264 6572 0a0a  turn dry_order..
-00009f50: 2020 2020 6465 6620 6164 645f 6472 795f      def add_dry_
-00009f60: 6f72 6465 725f 6665 6528 0a20 2020 2020  order_fee(.     
-00009f70: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00009f80: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-00009f90: 2020 2020 6472 795f 6f72 6465 723a 2044      dry_order: D
-00009fa0: 6963 745b 7374 722c 2041 6e79 5d2c 0a20  ict[str, Any],. 
-00009fb0: 2020 2020 2020 2074 616b 6572 5f6f 725f         taker_or_
-00009fc0: 6d61 6b65 723a 204d 616b 6572 5461 6b65  maker: MakerTake
-00009fd0: 722c 0a20 2020 2029 202d 3e20 4469 6374  r,.    ) -> Dict
-00009fe0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
-00009ff0: 2020 2020 6665 6520 3d20 7365 6c66 2e67      fee = self.g
-0000a000: 6574 5f66 6565 2870 6169 722c 2074 616b  et_fee(pair, tak
-0000a010: 6572 5f6f 725f 6d61 6b65 723d 7461 6b65  er_or_maker=take
-0000a020: 725f 6f72 5f6d 616b 6572 290a 2020 2020  r_or_maker).    
-0000a030: 2020 2020 6472 795f 6f72 6465 722e 7570      dry_order.up
-0000a040: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
-0000a050: 2020 2027 6665 6527 3a20 7b0a 2020 2020     'fee': {.    
-0000a060: 2020 2020 2020 2020 2020 2020 2763 7572              'cur
-0000a070: 7265 6e63 7927 3a20 7365 6c66 2e67 6574  rency': self.get
-0000a080: 5f70 6169 725f 7175 6f74 655f 6375 7272  _pair_quote_curr
-0000a090: 656e 6379 2870 6169 7229 2c0a 2020 2020  ency(pair),.    
-0000a0a0: 2020 2020 2020 2020 2020 2020 2763 6f73              'cos
-0000a0b0: 7427 3a20 6472 795f 6f72 6465 725b 2763  t': dry_order['c
-0000a0c0: 6f73 7427 5d20 2a20 6665 652c 0a20 2020  ost'] * fee,.   
-0000a0d0: 2020 2020 2020 2020 2020 2020 2027 7261               'ra
-0000a0e0: 7465 273a 2066 6565 0a20 2020 2020 2020  te': fee.       
-0000a0f0: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
-0000a100: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000a110: 2064 7279 5f6f 7264 6572 0a0a 2020 2020   dry_order..    
-0000a120: 6465 6620 6765 745f 6472 795f 6d61 726b  def get_dry_mark
-0000a130: 6574 5f66 696c 6c5f 7072 6963 6528 7365  et_fill_price(se
-0000a140: 6c66 2c20 7061 6972 3a20 7374 722c 2073  lf, pair: str, s
-0000a150: 6964 653a 2073 7472 2c20 616d 6f75 6e74  ide: str, amount
-0000a160: 3a20 666c 6f61 742c 2072 6174 653a 2066  : float, rate: f
-0000a170: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
+00008d80: 2020 2020 2020 2020 2020 2020 2044 4546               DEF
+00008d90: 4155 4c54 5f41 4d4f 554e 545f 5245 5345  AULT_AMOUNT_RESE
+00008da0: 5256 455f 5045 5243 454e 5429 0a20 2020  RVE_PERCENT).   
+00008db0: 2020 2020 2020 2020 2073 746f 706c 6f73           stoplos
+00008dc0: 735f 7265 7365 7276 6520 3d20 280a 2020  s_reserve = (.  
+00008dd0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00008de0: 7267 696e 5f72 6573 6572 7665 202f 2028  rgin_reserve / (
+00008df0: 3120 2d20 6162 7328 7374 6f70 6c6f 7373  1 - abs(stoploss
+00008e00: 2929 2069 6620 6162 7328 7374 6f70 6c6f  )) if abs(stoplo
+00008e10: 7373 2920 213d 2031 2065 6c73 6520 312e  ss) != 1 else 1.
+00008e20: 350a 2020 2020 2020 2020 2020 2020 290a  5.            ).
+00008e30: 2020 2020 2020 2020 2020 2020 2320 6974              # it
+00008e40: 2073 686f 756c 6420 6e6f 7420 6265 206d   should not be m
+00008e50: 6f72 6520 7468 616e 2035 3025 0a20 2020  ore than 50%.   
+00008e60: 2020 2020 2020 2020 2073 746f 706c 6f73           stoplos
+00008e70: 735f 7265 7365 7276 6520 3d20 6d61 7828  s_reserve = max(
+00008e80: 6d69 6e28 7374 6f70 6c6f 7373 5f72 6573  min(stoploss_res
+00008e90: 6572 7665 2c20 312e 3529 2c20 3129 0a20  erve, 1.5), 1). 
+00008ea0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00008eb0: 2020 2020 2020 2020 206d 6172 6769 6e5f           margin_
+00008ec0: 7265 7365 7276 6520 3d20 312e 300a 2020  reserve = 1.0.  
+00008ed0: 2020 2020 2020 2020 2020 7374 6f70 6c6f            stoplo
+00008ee0: 7373 5f72 6573 6572 7665 203d 2031 2e30  ss_reserve = 1.0
+00008ef0: 0a0a 2020 2020 2020 2020 7374 616b 655f  ..        stake_
+00008f00: 6c69 6d69 7473 203d 205b 5d0a 2020 2020  limits = [].    
+00008f10: 2020 2020 6c69 6d69 7473 203d 206d 6172      limits = mar
+00008f20: 6b65 745b 276c 696d 6974 7327 5d0a 2020  ket['limits'].  
+00008f30: 2020 2020 2020 6966 2028 6c69 6d69 7473        if (limits
+00008f40: 5b27 636f 7374 275d 5b6c 696d 6974 5d20  ['cost'][limit] 
+00008f50: 6973 206e 6f74 204e 6f6e 6529 3a0a 2020  is not None):.  
+00008f60: 2020 2020 2020 2020 2020 7374 616b 655f            stake_
+00008f70: 6c69 6d69 7473 2e61 7070 656e 6428 0a20  limits.append(. 
+00008f80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008f90: 656c 662e 5f63 6f6e 7472 6163 7473 5f74  elf._contracts_t
+00008fa0: 6f5f 616d 6f75 6e74 2870 6169 722c 206c  o_amount(pair, l
+00008fb0: 696d 6974 735b 2763 6f73 7427 5d5b 6c69  imits['cost'][li
+00008fc0: 6d69 745d 2920 2a20 7374 6f70 6c6f 7373  mit]) * stoploss
+00008fd0: 5f72 6573 6572 7665 0a20 2020 2020 2020  _reserve.       
+00008fe0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00008ff0: 6966 2028 6c69 6d69 7473 5b27 616d 6f75  if (limits['amou
+00009000: 6e74 275d 5b6c 696d 6974 5d20 6973 206e  nt'][limit] is n
+00009010: 6f74 204e 6f6e 6529 3a0a 2020 2020 2020  ot None):.      
+00009020: 2020 2020 2020 7374 616b 655f 6c69 6d69        stake_limi
+00009030: 7473 2e61 7070 656e 6428 0a20 2020 2020  ts.append(.     
+00009040: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009050: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
+00009060: 6f75 6e74 2870 6169 722c 206c 696d 6974  ount(pair, limit
+00009070: 735b 2761 6d6f 756e 7427 5d5b 6c69 6d69  s['amount'][limi
+00009080: 745d 2920 2a20 7072 6963 6520 2a20 6d61  t]) * price * ma
+00009090: 7267 696e 5f72 6573 6572 7665 0a20 2020  rgin_reserve.   
+000090a0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000090b0: 2020 2020 6966 206e 6f74 2073 7461 6b65      if not stake
+000090c0: 5f6c 696d 6974 733a 0a20 2020 2020 2020  _limits:.       
+000090d0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+000090e0: 2069 6620 6973 4d69 6e20 656c 7365 2066   if isMin else f
+000090f0: 6c6f 6174 2827 696e 6627 290a 0a20 2020  loat('inf')..   
+00009100: 2020 2020 2023 2054 6865 2076 616c 7565       # The value
+00009110: 2072 6574 7572 6e65 6420 7368 6f75 6c64   returned should
+00009120: 2073 6174 6973 6679 2062 6f74 6820 6c69   satisfy both li
+00009130: 6d69 7473 3a20 666f 7220 616d 6f75 6e74  mits: for amount
+00009140: 2028 6261 7365 2063 7572 7265 6e63 7929   (base currency)
+00009150: 2061 6e64 0a20 2020 2020 2020 2023 2066   and.        # f
+00009160: 6f72 2063 6f73 7420 2871 756f 7465 2c20  or cost (quote, 
+00009170: 7374 616b 6520 6375 7272 656e 6379 292c  stake currency),
+00009180: 2073 6f20 6d61 7828 2920 6973 2075 7365   so max() is use
+00009190: 6420 6865 7265 2e0a 2020 2020 2020 2020  d here..        
+000091a0: 2320 5365 6520 616c 736f 2023 3235 3735  # See also #2575
+000091b0: 2061 7420 6769 7468 7562 2e0a 2020 2020   at github..    
+000091c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000091d0: 5f67 6574 5f73 7461 6b65 5f61 6d6f 756e  _get_stake_amoun
+000091e0: 745f 636f 6e73 6964 6572 696e 675f 6c65  t_considering_le
+000091f0: 7665 7261 6765 280a 2020 2020 2020 2020  verage(.        
+00009200: 2020 2020 6d61 7828 7374 616b 655f 6c69      max(stake_li
+00009210: 6d69 7473 2920 6966 2069 734d 696e 2065  mits) if isMin e
+00009220: 6c73 6520 6d69 6e28 7374 616b 655f 6c69  lse min(stake_li
+00009230: 6d69 7473 292c 0a20 2020 2020 2020 2020  mits),.         
+00009240: 2020 206c 6576 6572 6167 6520 6f72 2031     leverage or 1
+00009250: 2e30 0a20 2020 2020 2020 2029 0a0a 2020  .0.        )..  
+00009260: 2020 6465 6620 5f67 6574 5f73 7461 6b65    def _get_stake
+00009270: 5f61 6d6f 756e 745f 636f 6e73 6964 6572  _amount_consider
+00009280: 696e 675f 6c65 7665 7261 6765 2873 656c  ing_leverage(sel
+00009290: 662c 2073 7461 6b65 5f61 6d6f 756e 743a  f, stake_amount:
+000092a0: 2066 6c6f 6174 2c20 6c65 7665 7261 6765   float, leverage
+000092b0: 3a20 666c 6f61 7429 202d 3e20 666c 6f61  : float) -> floa
+000092c0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+000092d0: 2020 2020 2020 2054 616b 6573 2074 6865         Takes the
+000092e0: 206d 696e 696d 756d 2073 7461 6b65 2061   minimum stake a
+000092f0: 6d6f 756e 7420 666f 7220 6120 7061 6972  mount for a pair
+00009300: 2077 6974 6820 6e6f 206c 6576 6572 6167   with no leverag
+00009310: 6520 616e 6420 7265 7475 726e 7320 7468  e and returns th
+00009320: 6520 6d69 6e69 6d75 6d0a 2020 2020 2020  e minimum.      
+00009330: 2020 7374 616b 6520 616d 6f75 6e74 2077    stake amount w
+00009340: 6865 6e20 6c65 7665 7261 6765 2069 7320  hen leverage is 
+00009350: 636f 6e73 6964 6572 6564 0a20 2020 2020  considered.     
+00009360: 2020 203a 7061 7261 6d20 7374 616b 655f     :param stake_
+00009370: 616d 6f75 6e74 3a20 5468 6520 7374 616b  amount: The stak
+00009380: 6520 616d 6f75 6e74 2066 6f72 2061 2070  e amount for a p
+00009390: 6169 7220 6265 666f 7265 206c 6576 6572  air before lever
+000093a0: 6167 6520 6973 2063 6f6e 7369 6465 7265  age is considere
+000093b0: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
+000093c0: 206c 6576 6572 6167 653a 2054 6865 2061   leverage: The a
+000093d0: 6d6f 756e 7420 6f66 206c 6576 6572 6167  mount of leverag
+000093e0: 6520 6265 696e 6720 7573 6564 206f 6e20  e being used on 
+000093f0: 7468 6520 6375 7272 656e 7420 7472 6164  the current trad
+00009400: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00009410: 2020 2020 2020 7265 7475 726e 2073 7461        return sta
+00009420: 6b65 5f61 6d6f 756e 7420 2f20 6c65 7665  ke_amount / leve
+00009430: 7261 6765 0a0a 2020 2020 2320 4472 792d  rage..    # Dry-
+00009440: 7275 6e20 6d65 7468 6f64 730a 0a20 2020  run methods..   
+00009450: 2064 6566 2063 7265 6174 655f 6472 795f   def create_dry_
+00009460: 7275 6e5f 6f72 6465 7228 7365 6c66 2c20  run_order(self, 
+00009470: 7061 6972 3a20 7374 722c 206f 7264 6572  pair: str, order
+00009480: 7479 7065 3a20 7374 722c 2073 6964 653a  type: str, side:
+00009490: 2073 7472 2c20 616d 6f75 6e74 3a20 666c   str, amount: fl
+000094a0: 6f61 742c 0a20 2020 2020 2020 2020 2020  oat,.           
+000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094c0: 2020 7261 7465 3a20 666c 6f61 742c 206c    rate: float, l
+000094d0: 6576 6572 6167 653a 2066 6c6f 6174 2c20  everage: float, 
+000094e0: 7061 7261 6d73 3a20 4469 6374 203d 207b  params: Dict = {
+000094f0: 7d2c 0a20 2020 2020 2020 2020 2020 2020  },.             
+00009500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009510: 7374 6f70 5f6c 6f73 733a 2062 6f6f 6c20  stop_loss: bool 
+00009520: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
+00009530: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+00009540: 2020 2020 6e6f 7720 3d20 6474 5f6e 6f77      now = dt_now
+00009550: 2829 0a20 2020 2020 2020 206f 7264 6572  ().        order
+00009560: 5f69 6420 3d20 6627 6472 795f 7275 6e5f  _id = f'dry_run_
+00009570: 7b73 6964 657d 5f7b 6e6f 772e 7469 6d65  {side}_{now.time
+00009580: 7374 616d 7028 297d 270a 2020 2020 2020  stamp()}'.      
+00009590: 2020 2320 526f 756e 6469 6e67 2068 6572    # Rounding her
+000095a0: 6520 6d75 7374 2072 6573 7065 6374 2074  e must respect t
+000095b0: 6f20 636f 6e74 7261 6374 2073 697a 6573  o contract sizes
+000095c0: 0a20 2020 2020 2020 205f 616d 6f75 6e74  .        _amount
+000095d0: 203d 2073 656c 662e 5f63 6f6e 7472 6163   = self._contrac
+000095e0: 7473 5f74 6f5f 616d 6f75 6e74 280a 2020  ts_to_amount(.  
+000095f0: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+00009600: 7365 6c66 2e61 6d6f 756e 745f 746f 5f70  self.amount_to_p
+00009610: 7265 6369 7369 6f6e 2870 6169 722c 2073  recision(pair, s
+00009620: 656c 662e 5f61 6d6f 756e 745f 746f 5f63  elf._amount_to_c
+00009630: 6f6e 7472 6163 7473 2870 6169 722c 2061  ontracts(pair, a
+00009640: 6d6f 756e 7429 2929 0a20 2020 2020 2020  mount))).       
+00009650: 2064 7279 5f6f 7264 6572 3a20 4469 6374   dry_order: Dict
+00009660: 5b73 7472 2c20 416e 795d 203d 207b 0a20  [str, Any] = {. 
+00009670: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
+00009680: 206f 7264 6572 5f69 642c 0a20 2020 2020   order_id,.     
+00009690: 2020 2020 2020 2027 7379 6d62 6f6c 273a         'symbol':
+000096a0: 2070 6169 722c 0a20 2020 2020 2020 2020   pair,.         
+000096b0: 2020 2027 7072 6963 6527 3a20 7261 7465     'price': rate
+000096c0: 2c0a 2020 2020 2020 2020 2020 2020 2761  ,.            'a
+000096d0: 7665 7261 6765 273a 2072 6174 652c 0a20  verage': rate,. 
+000096e0: 2020 2020 2020 2020 2020 2027 616d 6f75             'amou
+000096f0: 6e74 273a 205f 616d 6f75 6e74 2c0a 2020  nt': _amount,.  
+00009700: 2020 2020 2020 2020 2020 2763 6f73 7427            'cost'
+00009710: 3a20 5f61 6d6f 756e 7420 2a20 7261 7465  : _amount * rate
+00009720: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
+00009730: 7970 6527 3a20 6f72 6465 7274 7970 652c  ype': ordertype,
+00009740: 0a20 2020 2020 2020 2020 2020 2027 7369  .            'si
+00009750: 6465 273a 2073 6964 652c 0a20 2020 2020  de': side,.     
+00009760: 2020 2020 2020 2027 6669 6c6c 6564 273a         'filled':
+00009770: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
+00009780: 2772 656d 6169 6e69 6e67 273a 205f 616d  'remaining': _am
+00009790: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
+000097a0: 2020 2764 6174 6574 696d 6527 3a20 6e6f    'datetime': no
+000097b0: 772e 7374 7266 7469 6d65 2827 2559 2d25  w.strftime('%Y-%
+000097c0: 6d2d 2564 5425 483a 254d 3a25 532e 2566  m-%dT%H:%M:%S.%f
+000097d0: 5a27 292c 0a20 2020 2020 2020 2020 2020  Z'),.           
+000097e0: 2027 7469 6d65 7374 616d 7027 3a20 6474   'timestamp': dt
+000097f0: 5f74 7328 6e6f 7729 2c0a 2020 2020 2020  _ts(now),.      
+00009800: 2020 2020 2020 2773 7461 7475 7327 3a20        'status': 
+00009810: 226f 7065 6e22 2c0a 2020 2020 2020 2020  "open",.        
+00009820: 2020 2020 2766 6565 273a 204e 6f6e 652c      'fee': None,
+00009830: 0a20 2020 2020 2020 2020 2020 2027 696e  .            'in
+00009840: 666f 273a 207b 7d2c 0a20 2020 2020 2020  fo': {},.       
+00009850: 2020 2020 2027 6c65 7665 7261 6765 273a       'leverage':
+00009860: 206c 6576 6572 6167 650a 2020 2020 2020   leverage.      
+00009870: 2020 7d0a 2020 2020 2020 2020 6966 2073    }.        if s
+00009880: 746f 705f 6c6f 7373 3a0a 2020 2020 2020  top_loss:.      
+00009890: 2020 2020 2020 6472 795f 6f72 6465 725b        dry_order[
+000098a0: 2269 6e66 6f22 5d20 3d20 7b22 7374 6f70  "info"] = {"stop
+000098b0: 5072 6963 6522 3a20 6472 795f 6f72 6465  Price": dry_orde
+000098c0: 725b 2270 7269 6365 225d 7d0a 2020 2020  r["price"]}.    
+000098d0: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
+000098e0: 725b 7365 6c66 2e5f 6674 5f68 6173 5b27  r[self._ft_has['
+000098f0: 7374 6f70 5f70 7269 6365 5f70 6172 616d  stop_price_param
+00009900: 275d 5d20 3d20 6472 795f 6f72 6465 725b  ']] = dry_order[
+00009910: 2270 7269 6365 225d 0a20 2020 2020 2020  "price"].       
+00009920: 2020 2020 2023 2057 6f72 6b61 726f 756e       # Workaroun
+00009930: 6420 746f 2061 766f 6964 2066 696c 6c69  d to avoid filli
+00009940: 6e67 2073 746f 706c 6f73 7320 6f72 6465  ng stoploss orde
+00009950: 7273 2069 6d6d 6564 6961 7465 6c79 0a20  rs immediately. 
+00009960: 2020 2020 2020 2020 2020 2064 7279 5f6f             dry_o
+00009970: 7264 6572 5b22 6674 5f6f 7264 6572 5f74  rder["ft_order_t
+00009980: 7970 6522 5d20 3d20 2273 746f 706c 6f73  ype"] = "stoplos
+00009990: 7322 0a20 2020 2020 2020 206f 7264 6572  s".        order
+000099a0: 626f 6f6b 3a20 4f70 7469 6f6e 616c 5b4f  book: Optional[O
+000099b0: 7264 6572 426f 6f6b 5d20 3d20 4e6f 6e65  rderBook] = None
+000099c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000099d0: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
+000099e0: 6574 6368 4c32 4f72 6465 7242 6f6f 6b27  etchL2OrderBook'
+000099f0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+00009a00: 7264 6572 626f 6f6b 203d 2073 656c 662e  rderbook = self.
+00009a10: 6665 7463 685f 6c32 5f6f 7264 6572 5f62  fetch_l2_order_b
+00009a20: 6f6f 6b28 7061 6972 2c20 3230 290a 2020  ook(pair, 20).  
+00009a30: 2020 2020 2020 6966 206f 7264 6572 7479        if orderty
+00009a40: 7065 203d 3d20 226c 696d 6974 2220 616e  pe == "limit" an
+00009a50: 6420 6f72 6465 7262 6f6f 6b3a 0a20 2020  d orderbook:.   
+00009a60: 2020 2020 2020 2020 2023 2041 6c6c 6f77           # Allow
+00009a70: 2061 2033 2520 7072 6963 6520 6469 6666   a 3% price diff
+00009a80: 6572 656e 6365 0a20 2020 2020 2020 2020  erence.         
+00009a90: 2020 2061 6c6c 6f77 6564 5f64 6966 6620     allowed_diff 
+00009aa0: 3d20 302e 3033 0a20 2020 2020 2020 2020  = 0.03.         
+00009ab0: 2020 2069 6620 7365 6c66 2e5f 6472 795f     if self._dry_
+00009ac0: 6973 5f70 7269 6365 5f63 726f 7373 6564  is_price_crossed
+00009ad0: 2870 6169 722c 2073 6964 652c 2072 6174  (pair, side, rat
+00009ae0: 652c 206f 7264 6572 626f 6f6b 2c20 616c  e, orderbook, al
+00009af0: 6c6f 7765 645f 6469 6666 293a 0a20 2020  lowed_diff):.   
+00009b00: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00009b10: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
+00009b20: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00009b30: 436f 6e76 6572 7465 6420 6f72 6465 7220  Converted order 
+00009b40: 7b70 6169 727d 2074 6f20 6d61 726b 6574  {pair} to market
+00009b50: 206f 7264 6572 2064 7565 2074 6f20 7072   order due to pr
+00009b60: 6963 6520 7b72 6174 657d 2063 726f 7373  ice {rate} cross
+00009b70: 696e 6720 7370 7265 6164 2022 0a20 2020  ing spread ".   
+00009b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b90: 2066 2262 7920 6d6f 7265 2074 6861 6e20   f"by more than 
+00009ba0: 7b61 6c6c 6f77 6564 5f64 6966 663a 2e32  {allowed_diff:.2
+00009bb0: 257d 2e22 290a 2020 2020 2020 2020 2020  %}.").          
+00009bc0: 2020 2020 2020 6472 795f 6f72 6465 725b        dry_order[
+00009bd0: 2274 7970 6522 5d20 3d20 226d 6172 6b65  "type"] = "marke
+00009be0: 7422 0a0a 2020 2020 2020 2020 6966 2064  t"..        if d
+00009bf0: 7279 5f6f 7264 6572 5b22 7479 7065 225d  ry_order["type"]
+00009c00: 203d 3d20 226d 6172 6b65 7422 2061 6e64   == "market" and
+00009c10: 206e 6f74 2064 7279 5f6f 7264 6572 2e67   not dry_order.g
+00009c20: 6574 2822 6674 5f6f 7264 6572 5f74 7970  et("ft_order_typ
+00009c30: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
+00009c40: 2023 2055 7064 6174 6520 6d61 726b 6574   # Update market
+00009c50: 206f 7264 6572 2070 7269 6369 6e67 0a20   order pricing. 
+00009c60: 2020 2020 2020 2020 2020 2061 7665 7261             avera
+00009c70: 6765 203d 2073 656c 662e 6765 745f 6472  ge = self.get_dr
+00009c80: 795f 6d61 726b 6574 5f66 696c 6c5f 7072  y_market_fill_pr
+00009c90: 6963 6528 7061 6972 2c20 7369 6465 2c20  ice(pair, side, 
+00009ca0: 616d 6f75 6e74 2c20 7261 7465 2c20 6f72  amount, rate, or
+00009cb0: 6465 7262 6f6f 6b29 0a20 2020 2020 2020  derbook).       
+00009cc0: 2020 2020 2064 7279 5f6f 7264 6572 2e75       dry_order.u
+00009cd0: 7064 6174 6528 7b0a 2020 2020 2020 2020  pdate({.        
+00009ce0: 2020 2020 2020 2020 2761 7665 7261 6765          'average
+00009cf0: 273a 2061 7665 7261 6765 2c0a 2020 2020  ': average,.    
+00009d00: 2020 2020 2020 2020 2020 2020 2766 696c              'fil
+00009d10: 6c65 6427 3a20 5f61 6d6f 756e 742c 0a20  led': _amount,. 
+00009d20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009d30: 7265 6d61 696e 696e 6727 3a20 302e 302c  remaining': 0.0,
+00009d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009d50: 2027 7374 6174 7573 273a 2022 636c 6f73   'status': "clos
+00009d60: 6564 222c 0a20 2020 2020 2020 2020 2020  ed",.           
+00009d70: 2020 2020 2027 636f 7374 273a 2028 6472       'cost': (dr
+00009d80: 795f 6f72 6465 725b 2761 6d6f 756e 7427  y_order['amount'
+00009d90: 5d20 2a20 6176 6572 6167 6529 0a20 2020  ] * average).   
+00009da0: 2020 2020 2020 2020 207d 290a 2020 2020           }).    
+00009db0: 2020 2020 2020 2020 2320 6d61 726b 6574          # market
+00009dc0: 206f 7264 6572 7320 7769 6c6c 2061 6c77   orders will alw
+00009dd0: 6179 7320 696e 6375 7272 2074 616b 6572  ays incurr taker
+00009de0: 2066 6565 730a 2020 2020 2020 2020 2020   fees.          
+00009df0: 2020 6472 795f 6f72 6465 7220 3d20 7365    dry_order = se
+00009e00: 6c66 2e61 6464 5f64 7279 5f6f 7264 6572  lf.add_dry_order
+00009e10: 5f66 6565 2870 6169 722c 2064 7279 5f6f  _fee(pair, dry_o
+00009e20: 7264 6572 2c20 2774 616b 6572 2729 0a0a  rder, 'taker')..
+00009e30: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
+00009e40: 7220 3d20 7365 6c66 2e63 6865 636b 5f64  r = self.check_d
+00009e50: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
+00009e60: 696c 6c65 6428 0a20 2020 2020 2020 2020  illed(.         
+00009e70: 2020 2064 7279 5f6f 7264 6572 2c20 696d     dry_order, im
+00009e80: 6d65 6469 6174 653d 5472 7565 2c20 6f72  mediate=True, or
+00009e90: 6465 7262 6f6f 6b3d 6f72 6465 7262 6f6f  derbook=orderboo
+00009ea0: 6b29 0a0a 2020 2020 2020 2020 7365 6c66  k)..        self
+00009eb0: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
+00009ec0: 7264 6572 735b 6472 795f 6f72 6465 725b  rders[dry_order[
+00009ed0: 2269 6422 5d5d 203d 2064 7279 5f6f 7264  "id"]] = dry_ord
+00009ee0: 6572 0a20 2020 2020 2020 2023 2043 6f70  er.        # Cop
+00009ef0: 7920 6f72 6465 7220 616e 6420 636c 6f73  y order and clos
+00009f00: 6520 6974 202d 2073 6f20 7468 6520 7265  e it - so the re
+00009f10: 7475 726e 6564 206f 7264 6572 2069 7320  turned order is 
+00009f20: 6f70 656e 2075 6e6c 6573 7320 6974 2773  open unless it's
+00009f30: 2061 206d 6172 6b65 7420 6f72 6465 720a   a market order.
+00009f40: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00009f50: 7279 5f6f 7264 6572 0a0a 2020 2020 6465  ry_order..    de
+00009f60: 6620 6164 645f 6472 795f 6f72 6465 725f  f add_dry_order_
+00009f70: 6665 6528 0a20 2020 2020 2020 2073 656c  fee(.        sel
+00009f80: 662c 0a20 2020 2020 2020 2070 6169 723a  f,.        pair:
+00009f90: 2073 7472 2c0a 2020 2020 2020 2020 6472   str,.        dr
+00009fa0: 795f 6f72 6465 723a 2044 6963 745b 7374  y_order: Dict[st
+00009fb0: 722c 2041 6e79 5d2c 0a20 2020 2020 2020  r, Any],.       
+00009fc0: 2074 616b 6572 5f6f 725f 6d61 6b65 723a   taker_or_maker:
+00009fd0: 204d 616b 6572 5461 6b65 722c 0a20 2020   MakerTaker,.   
+00009fe0: 2029 202d 3e20 4469 6374 5b73 7472 2c20   ) -> Dict[str, 
+00009ff0: 416e 795d 3a0a 2020 2020 2020 2020 6665  Any]:.        fe
+0000a000: 6520 3d20 7365 6c66 2e67 6574 5f66 6565  e = self.get_fee
+0000a010: 2870 6169 722c 2074 616b 6572 5f6f 725f  (pair, taker_or_
+0000a020: 6d61 6b65 723d 7461 6b65 725f 6f72 5f6d  maker=taker_or_m
+0000a030: 616b 6572 290a 2020 2020 2020 2020 6472  aker).        dr
+0000a040: 795f 6f72 6465 722e 7570 6461 7465 287b  y_order.update({
+0000a050: 0a20 2020 2020 2020 2020 2020 2027 6665  .            'fe
+0000a060: 6527 3a20 7b0a 2020 2020 2020 2020 2020  e': {.          
+0000a070: 2020 2020 2020 2763 7572 7265 6e63 7927        'currency'
+0000a080: 3a20 7365 6c66 2e67 6574 5f70 6169 725f  : self.get_pair_
+0000a090: 7175 6f74 655f 6375 7272 656e 6379 2870  quote_currency(p
+0000a0a0: 6169 7229 2c0a 2020 2020 2020 2020 2020  air),.          
+0000a0b0: 2020 2020 2020 2763 6f73 7427 3a20 6472        'cost': dr
+0000a0c0: 795f 6f72 6465 725b 2763 6f73 7427 5d20  y_order['cost'] 
+0000a0d0: 2a20 6665 652c 0a20 2020 2020 2020 2020  * fee,.         
+0000a0e0: 2020 2020 2020 2027 7261 7465 273a 2066         'rate': f
+0000a0f0: 6565 0a20 2020 2020 2020 2020 2020 207d  ee.            }
+0000a100: 0a20 2020 2020 2020 207d 290a 2020 2020  .        }).    
+0000a110: 2020 2020 7265 7475 726e 2064 7279 5f6f      return dry_o
+0000a120: 7264 6572 0a0a 2020 2020 6465 6620 6765  rder..    def ge
+0000a130: 745f 6472 795f 6d61 726b 6574 5f66 696c  t_dry_market_fil
+0000a140: 6c5f 7072 6963 6528 7365 6c66 2c20 7061  l_price(self, pa
+0000a150: 6972 3a20 7374 722c 2073 6964 653a 2073  ir: str, side: s
+0000a160: 7472 2c20 616d 6f75 6e74 3a20 666c 6f61  tr, amount: floa
+0000a170: 742c 2072 6174 653a 2066 6c6f 6174 2c0a  t, rate: float,.
 0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a190: 2020 2020 2020 2020 6f72 6465 7262 6f6f          orderboo
-0000a1a0: 6b3a 204f 7074 696f 6e61 6c5b 4f72 6465  k: Optional[Orde
-0000a1b0: 7242 6f6f 6b5d 2920 2d3e 2066 6c6f 6174  rBook]) -> float
-0000a1c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000a1d0: 2020 2020 2020 4765 7420 7468 6520 6d61        Get the ma
-0000a1e0: 726b 6574 206f 7264 6572 2066 696c 6c20  rket order fill 
-0000a1f0: 7072 6963 6520 6261 7365 6420 6f6e 206f  price based on o
-0000a200: 7264 6572 626f 6f6b 2069 6e74 6572 706f  rderbook interpo
-0000a210: 6c61 7469 6f6e 0a20 2020 2020 2020 2022  lation.        "
-0000a220: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-0000a230: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0000a240: 2766 6574 6368 4c32 4f72 6465 7242 6f6f  'fetchL2OrderBoo
-0000a250: 6b27 293a 0a20 2020 2020 2020 2020 2020  k'):.           
-0000a260: 2069 6620 6e6f 7420 6f72 6465 7262 6f6f   if not orderboo
-0000a270: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
-0000a280: 2020 206f 7264 6572 626f 6f6b 203d 2073     orderbook = s
-0000a290: 656c 662e 6665 7463 685f 6c32 5f6f 7264  elf.fetch_l2_ord
-0000a2a0: 6572 5f62 6f6f 6b28 7061 6972 2c20 3230  er_book(pair, 20
-0000a2b0: 290a 2020 2020 2020 2020 2020 2020 6f62  ).            ob
-0000a2c0: 5f74 7970 653a 204f 424c 6974 6572 616c  _type: OBLiteral
-0000a2d0: 203d 2027 6173 6b73 2720 6966 2073 6964   = 'asks' if sid
-0000a2e0: 6520 3d3d 2027 6275 7927 2065 6c73 6520  e == 'buy' else 
-0000a2f0: 2762 6964 7327 0a20 2020 2020 2020 2020  'bids'.         
-0000a300: 2020 2073 6c69 7070 6167 6520 3d20 302e     slippage = 0.
-0000a310: 3035 0a20 2020 2020 2020 2020 2020 206d  05.            m
-0000a320: 6178 5f73 6c69 7070 6167 655f 7661 6c20  ax_slippage_val 
-0000a330: 3d20 7261 7465 202a 2028 2831 202b 2073  = rate * ((1 + s
-0000a340: 6c69 7070 6167 6529 2069 6620 7369 6465  lippage) if side
-0000a350: 203d 3d20 2762 7579 2720 656c 7365 2028   == 'buy' else (
-0000a360: 3120 2d20 736c 6970 7061 6765 2929 0a0a  1 - slippage))..
-0000a370: 2020 2020 2020 2020 2020 2020 7265 6d61              rema
-0000a380: 696e 696e 675f 616d 6f75 6e74 203d 2061  ining_amount = a
-0000a390: 6d6f 756e 740a 2020 2020 2020 2020 2020  mount.          
-0000a3a0: 2020 6669 6c6c 6564 5f61 6d6f 756e 7420    filled_amount 
-0000a3b0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
-0000a3c0: 2020 626f 6f6b 5f65 6e74 7279 5f70 7269    book_entry_pri
-0000a3d0: 6365 203d 2030 2e30 0a20 2020 2020 2020  ce = 0.0.       
-0000a3e0: 2020 2020 2066 6f72 2062 6f6f 6b5f 656e       for book_en
-0000a3f0: 7472 7920 696e 206f 7264 6572 626f 6f6b  try in orderbook
-0000a400: 5b6f 625f 7479 7065 5d3a 0a20 2020 2020  [ob_type]:.     
-0000a410: 2020 2020 2020 2020 2020 2062 6f6f 6b5f             book_
-0000a420: 656e 7472 795f 7072 6963 6520 3d20 626f  entry_price = bo
-0000a430: 6f6b 5f65 6e74 7279 5b30 5d0a 2020 2020  ok_entry[0].    
-0000a440: 2020 2020 2020 2020 2020 2020 626f 6f6b              book
-0000a450: 5f65 6e74 7279 5f63 6f69 6e5f 766f 6c75  _entry_coin_volu
-0000a460: 6d65 203d 2062 6f6f 6b5f 656e 7472 795b  me = book_entry[
-0000a470: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-0000a480: 2020 2069 6620 7265 6d61 696e 696e 675f     if remaining_
-0000a490: 616d 6f75 6e74 203e 2030 3a0a 2020 2020  amount > 0:.    
-0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4b0: 6966 2072 656d 6169 6e69 6e67 5f61 6d6f  if remaining_amo
-0000a4c0: 756e 7420 3c20 626f 6f6b 5f65 6e74 7279  unt < book_entry
-0000a4d0: 5f63 6f69 6e5f 766f 6c75 6d65 3a0a 2020  _coin_volume:.  
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4f0: 2020 2020 2020 2320 4f72 6465 7262 6f6f        # Orderboo
-0000a500: 6b20 6174 2074 6869 7320 736c 6f74 2062  k at this slot b
-0000a510: 6967 6765 7220 7468 616e 2072 656d 6169  igger than remai
-0000a520: 6e69 6e67 2061 6d6f 756e 740a 2020 2020  ning amount.    
-0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a540: 2020 2020 6669 6c6c 6564 5f61 6d6f 756e      filled_amoun
-0000a550: 7420 2b3d 2072 656d 6169 6e69 6e67 5f61  t += remaining_a
-0000a560: 6d6f 756e 7420 2a20 626f 6f6b 5f65 6e74  mount * book_ent
-0000a570: 7279 5f70 7269 6365 0a20 2020 2020 2020  ry_price.       
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a590: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-0000a5a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000a5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a5c0: 2020 2020 2020 2020 2066 696c 6c65 645f           filled_
-0000a5d0: 616d 6f75 6e74 202b 3d20 626f 6f6b 5f65  amount += book_e
-0000a5e0: 6e74 7279 5f63 6f69 6e5f 766f 6c75 6d65  ntry_coin_volume
-0000a5f0: 202a 2062 6f6f 6b5f 656e 7472 795f 7072   * book_entry_pr
-0000a600: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
-0000a610: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
-0000a620: 675f 616d 6f75 6e74 202d 3d20 626f 6f6b  g_amount -= book
-0000a630: 5f65 6e74 7279 5f63 6f69 6e5f 766f 6c75  _entry_coin_volu
-0000a640: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0000a650: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a660: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0000a670: 616b 0a20 2020 2020 2020 2020 2020 2065  ak.            e
-0000a680: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a690: 2020 2020 2023 2049 6620 7265 6d61 696e       # If remain
-0000a6a0: 696e 675f 616d 6f75 6e74 2077 6173 6e27  ing_amount wasn'
-0000a6b0: 7420 636f 6e73 756d 6564 2063 6f6d 706c  t consumed compl
-0000a6c0: 6574 656c 7920 2862 7265 616b 2077 6173  etely (break was
-0000a6d0: 206e 6f74 2063 616c 6c65 6429 0a20 2020   not called).   
-0000a6e0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000a6f0: 6c65 645f 616d 6f75 6e74 202b 3d20 7265  led_amount += re
-0000a700: 6d61 696e 696e 675f 616d 6f75 6e74 202a  maining_amount *
-0000a710: 2062 6f6f 6b5f 656e 7472 795f 7072 6963   book_entry_pric
-0000a720: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-0000a730: 7265 6361 7374 5f61 7667 5f66 696c 6c65  recast_avg_fille
-0000a740: 645f 7072 6963 6520 3d20 6d61 7828 6669  d_price = max(fi
-0000a750: 6c6c 6564 5f61 6d6f 756e 742c 2030 2920  lled_amount, 0) 
-0000a760: 2f20 616d 6f75 6e74 0a20 2020 2020 2020  / amount.       
-0000a770: 2020 2020 2023 204c 696d 6974 206d 6178       # Limit max
-0000a780: 2e20 736c 6970 7061 6765 2074 6f20 7370  . slippage to sp
-0000a790: 6563 6966 6965 6420 7661 6c75 650a 2020  ecified value.  
-0000a7a0: 2020 2020 2020 2020 2020 6966 2073 6964            if sid
-0000a7b0: 6520 3d3d 2027 6275 7927 3a0a 2020 2020  e == 'buy':.    
-0000a7c0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-0000a7d0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a7e0: 7072 6963 6520 3d20 6d69 6e28 666f 7265  price = min(fore
-0000a7f0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a800: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
-0000a810: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
-0000a820: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a830: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-0000a840: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a850: 7072 6963 6520 3d20 6d61 7828 666f 7265  price = max(fore
-0000a860: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a870: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
-0000a880: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
-0000a890: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a8a0: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
-0000a8b0: 7369 6f6e 2870 6169 722c 2066 6f72 6563  sion(pair, forec
-0000a8c0: 6173 745f 6176 675f 6669 6c6c 6564 5f70  ast_avg_filled_p
-0000a8d0: 7269 6365 290a 0a20 2020 2020 2020 2072  rice)..        r
-0000a8e0: 6574 7572 6e20 7261 7465 0a0a 2020 2020  eturn rate..    
-0000a8f0: 6465 6620 5f64 7279 5f69 735f 7072 6963  def _dry_is_pric
-0000a900: 655f 6372 6f73 7365 6428 7365 6c66 2c20  e_crossed(self, 
-0000a910: 7061 6972 3a20 7374 722c 2073 6964 653a  pair: str, side:
-0000a920: 2073 7472 2c20 6c69 6d69 743a 2066 6c6f   str, limit: flo
-0000a930: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+0000a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1a0: 2020 6f72 6465 7262 6f6f 6b3a 204f 7074    orderbook: Opt
+0000a1b0: 696f 6e61 6c5b 4f72 6465 7242 6f6f 6b5d  ional[OrderBook]
+0000a1c0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+0000a1d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a1e0: 4765 7420 7468 6520 6d61 726b 6574 206f  Get the market o
+0000a1f0: 7264 6572 2066 696c 6c20 7072 6963 6520  rder fill price 
+0000a200: 6261 7365 6420 6f6e 206f 7264 6572 626f  based on orderbo
+0000a210: 6f6b 2069 6e74 6572 706f 6c61 7469 6f6e  ok interpolation
+0000a220: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a230: 2020 2020 2069 6620 7365 6c66 2e65 7863       if self.exc
+0000a240: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+0000a250: 4c32 4f72 6465 7242 6f6f 6b27 293a 0a20  L2OrderBook'):. 
+0000a260: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000a270: 7420 6f72 6465 7262 6f6f 6b3a 0a20 2020  t orderbook:.   
+0000a280: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0000a290: 6572 626f 6f6b 203d 2073 656c 662e 6665  erbook = self.fe
+0000a2a0: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
+0000a2b0: 6b28 7061 6972 2c20 3230 290a 2020 2020  k(pair, 20).    
+0000a2c0: 2020 2020 2020 2020 6f62 5f74 7970 653a          ob_type:
+0000a2d0: 204f 424c 6974 6572 616c 203d 2027 6173   OBLiteral = 'as
+0000a2e0: 6b73 2720 6966 2073 6964 6520 3d3d 2027  ks' if side == '
+0000a2f0: 6275 7927 2065 6c73 6520 2762 6964 7327  buy' else 'bids'
+0000a300: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
+0000a310: 7070 6167 6520 3d20 302e 3035 0a20 2020  ppage = 0.05.   
+0000a320: 2020 2020 2020 2020 206d 6178 5f73 6c69           max_sli
+0000a330: 7070 6167 655f 7661 6c20 3d20 7261 7465  ppage_val = rate
+0000a340: 202a 2028 2831 202b 2073 6c69 7070 6167   * ((1 + slippag
+0000a350: 6529 2069 6620 7369 6465 203d 3d20 2762  e) if side == 'b
+0000a360: 7579 2720 656c 7365 2028 3120 2d20 736c  uy' else (1 - sl
+0000a370: 6970 7061 6765 2929 0a0a 2020 2020 2020  ippage))..      
+0000a380: 2020 2020 2020 7265 6d61 696e 696e 675f        remaining_
+0000a390: 616d 6f75 6e74 203d 2061 6d6f 756e 740a  amount = amount.
+0000a3a0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+0000a3b0: 6564 5f61 6d6f 756e 7420 3d20 302e 300a  ed_amount = 0.0.
+0000a3c0: 2020 2020 2020 2020 2020 2020 626f 6f6b              book
+0000a3d0: 5f65 6e74 7279 5f70 7269 6365 203d 2030  _entry_price = 0
+0000a3e0: 2e30 0a20 2020 2020 2020 2020 2020 2066  .0.            f
+0000a3f0: 6f72 2062 6f6f 6b5f 656e 7472 7920 696e  or book_entry in
+0000a400: 206f 7264 6572 626f 6f6b 5b6f 625f 7479   orderbook[ob_ty
+0000a410: 7065 5d3a 0a20 2020 2020 2020 2020 2020  pe]:.           
+0000a420: 2020 2020 2062 6f6f 6b5f 656e 7472 795f       book_entry_
+0000a430: 7072 6963 6520 3d20 626f 6f6b 5f65 6e74  price = book_ent
+0000a440: 7279 5b30 5d0a 2020 2020 2020 2020 2020  ry[0].          
+0000a450: 2020 2020 2020 626f 6f6b 5f65 6e74 7279        book_entry
+0000a460: 5f63 6f69 6e5f 766f 6c75 6d65 203d 2062  _coin_volume = b
+0000a470: 6f6f 6b5f 656e 7472 795b 315d 0a20 2020  ook_entry[1].   
+0000a480: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a490: 7265 6d61 696e 696e 675f 616d 6f75 6e74  remaining_amount
+0000a4a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0000a4b0: 2020 2020 2020 2020 2020 6966 2072 656d            if rem
+0000a4c0: 6169 6e69 6e67 5f61 6d6f 756e 7420 3c20  aining_amount < 
+0000a4d0: 626f 6f6b 5f65 6e74 7279 5f63 6f69 6e5f  book_entry_coin_
+0000a4e0: 766f 6c75 6d65 3a0a 2020 2020 2020 2020  volume:.        
+0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a500: 2320 4f72 6465 7262 6f6f 6b20 6174 2074  # Orderbook at t
+0000a510: 6869 7320 736c 6f74 2062 6967 6765 7220  his slot bigger 
+0000a520: 7468 616e 2072 656d 6169 6e69 6e67 2061  than remaining a
+0000a530: 6d6f 756e 740a 2020 2020 2020 2020 2020  mount.          
+0000a540: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000a550: 6c6c 6564 5f61 6d6f 756e 7420 2b3d 2072  lled_amount += r
+0000a560: 656d 6169 6e69 6e67 5f61 6d6f 756e 7420  emaining_amount 
+0000a570: 2a20 626f 6f6b 5f65 6e74 7279 5f70 7269  * book_entry_pri
+0000a580: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+0000a590: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0000a5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a5b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5d0: 2020 2066 696c 6c65 645f 616d 6f75 6e74     filled_amount
+0000a5e0: 202b 3d20 626f 6f6b 5f65 6e74 7279 5f63   += book_entry_c
+0000a5f0: 6f69 6e5f 766f 6c75 6d65 202a 2062 6f6f  oin_volume * boo
+0000a600: 6b5f 656e 7472 795f 7072 6963 650a 2020  k_entry_price.  
+0000a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a620: 2020 7265 6d61 696e 696e 675f 616d 6f75    remaining_amou
+0000a630: 6e74 202d 3d20 626f 6f6b 5f65 6e74 7279  nt -= book_entry
+0000a640: 5f63 6f69 6e5f 766f 6c75 6d65 0a20 2020  _coin_volume.   
+0000a650: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000a660: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000a670: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0000a680: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a690: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a6a0: 2049 6620 7265 6d61 696e 696e 675f 616d   If remaining_am
+0000a6b0: 6f75 6e74 2077 6173 6e27 7420 636f 6e73  ount wasn't cons
+0000a6c0: 756d 6564 2063 6f6d 706c 6574 656c 7920  umed completely 
+0000a6d0: 2862 7265 616b 2077 6173 206e 6f74 2063  (break was not c
+0000a6e0: 616c 6c65 6429 0a20 2020 2020 2020 2020  alled).         
+0000a6f0: 2020 2020 2020 2066 696c 6c65 645f 616d         filled_am
+0000a700: 6f75 6e74 202b 3d20 7265 6d61 696e 696e  ount += remainin
+0000a710: 675f 616d 6f75 6e74 202a 2062 6f6f 6b5f  g_amount * book_
+0000a720: 656e 7472 795f 7072 6963 650a 2020 2020  entry_price.    
+0000a730: 2020 2020 2020 2020 666f 7265 6361 7374          forecast
+0000a740: 5f61 7667 5f66 696c 6c65 645f 7072 6963  _avg_filled_pric
+0000a750: 6520 3d20 6d61 7828 6669 6c6c 6564 5f61  e = max(filled_a
+0000a760: 6d6f 756e 742c 2030 2920 2f20 616d 6f75  mount, 0) / amou
+0000a770: 6e74 0a20 2020 2020 2020 2020 2020 2023  nt.            #
+0000a780: 204c 696d 6974 206d 6178 2e20 736c 6970   Limit max. slip
+0000a790: 7061 6765 2074 6f20 7370 6563 6966 6965  page to specifie
+0000a7a0: 6420 7661 6c75 650a 2020 2020 2020 2020  d value.        
+0000a7b0: 2020 2020 6966 2073 6964 6520 3d3d 2027      if side == '
+0000a7c0: 6275 7927 3a0a 2020 2020 2020 2020 2020  buy':.          
+0000a7d0: 2020 2020 2020 666f 7265 6361 7374 5f61        forecast_a
+0000a7e0: 7667 5f66 696c 6c65 645f 7072 6963 6520  vg_filled_price 
+0000a7f0: 3d20 6d69 6e28 666f 7265 6361 7374 5f61  = min(forecast_a
+0000a800: 7667 5f66 696c 6c65 645f 7072 6963 652c  vg_filled_price,
+0000a810: 206d 6178 5f73 6c69 7070 6167 655f 7661   max_slippage_va
+0000a820: 6c29 0a0a 2020 2020 2020 2020 2020 2020  l)..            
+0000a830: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a840: 2020 2020 2020 666f 7265 6361 7374 5f61        forecast_a
+0000a850: 7667 5f66 696c 6c65 645f 7072 6963 6520  vg_filled_price 
+0000a860: 3d20 6d61 7828 666f 7265 6361 7374 5f61  = max(forecast_a
+0000a870: 7667 5f66 696c 6c65 645f 7072 6963 652c  vg_filled_price,
+0000a880: 206d 6178 5f73 6c69 7070 6167 655f 7661   max_slippage_va
+0000a890: 6c29 0a0a 2020 2020 2020 2020 2020 2020  l)..            
+0000a8a0: 7265 7475 726e 2073 656c 662e 7072 6963  return self.pric
+0000a8b0: 655f 746f 5f70 7265 6369 7369 6f6e 2870  e_to_precision(p
+0000a8c0: 6169 722c 2066 6f72 6563 6173 745f 6176  air, forecast_av
+0000a8d0: 675f 6669 6c6c 6564 5f70 7269 6365 290a  g_filled_price).
+0000a8e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000a8f0: 7261 7465 0a0a 2020 2020 6465 6620 5f64  rate..    def _d
+0000a900: 7279 5f69 735f 7072 6963 655f 6372 6f73  ry_is_price_cros
+0000a910: 7365 6428 7365 6c66 2c20 7061 6972 3a20  sed(self, pair: 
+0000a920: 7374 722c 2073 6964 653a 2073 7472 2c20  str, side: str, 
+0000a930: 6c69 6d69 743a 2066 6c6f 6174 2c0a 2020  limit: float,.  
 0000a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a950: 2020 6f72 6465 7262 6f6f 6b3a 204f 7074    orderbook: Opt
-0000a960: 696f 6e61 6c5b 4f72 6465 7242 6f6f 6b5d  ional[OrderBook]
-0000a970: 203d 204e 6f6e 652c 206f 6666 7365 743a   = None, offset:
-0000a980: 2066 6c6f 6174 203d 2030 2e30 2920 2d3e   float = 0.0) ->
-0000a990: 2062 6f6f 6c3a 0a20 2020 2020 2020 2069   bool:.        i
-0000a9a0: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
-0000a9b0: 6e67 655f 6861 7328 2766 6574 6368 4c32  nge_has('fetchL2
-0000a9c0: 4f72 6465 7242 6f6f 6b27 293a 0a20 2020  OrderBook'):.   
-0000a9d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a9e0: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
-0000a9f0: 6e6f 7420 6f72 6465 7262 6f6f 6b3a 0a20  not orderbook:. 
-0000aa00: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000aa10: 626f 6f6b 203d 2073 656c 662e 6665 7463  book = self.fetc
-0000aa20: 685f 6c32 5f6f 7264 6572 5f62 6f6f 6b28  h_l2_order_book(
-0000aa30: 7061 6972 2c20 3129 0a20 2020 2020 2020  pair, 1).       
-0000aa40: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000aa50: 2020 6966 2073 6964 6520 3d3d 2027 6275    if side == 'bu
-0000aa60: 7927 3a0a 2020 2020 2020 2020 2020 2020  y':.            
-0000aa70: 2020 2020 7072 6963 6520 3d20 6f72 6465      price = orde
-0000aa80: 7262 6f6f 6b5b 2761 736b 7327 5d5b 305d  rbook['asks'][0]
-0000aa90: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0000aaa0: 2020 2020 6966 206c 696d 6974 202a 2028      if limit * (
-0000aab0: 3120 2d20 6f66 6673 6574 2920 3e3d 2070  1 - offset) >= p
-0000aac0: 7269 6365 3a0a 2020 2020 2020 2020 2020  rice:.          
-0000aad0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000aae0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0000aaf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ab00: 2020 2020 2020 2020 7072 6963 6520 3d20          price = 
-0000ab10: 6f72 6465 7262 6f6f 6b5b 2762 6964 7327  orderbook['bids'
-0000ab20: 5d5b 305d 5b30 5d0a 2020 2020 2020 2020  ][0][0].        
-0000ab30: 2020 2020 2020 2020 6966 206c 696d 6974          if limit
-0000ab40: 202a 2028 3120 2b20 6f66 6673 6574 2920   * (1 + offset) 
-0000ab50: 3c3d 2070 7269 6365 3a0a 2020 2020 2020  <= price:.      
-0000ab60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ab70: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000ab80: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
-0000ab90: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000aba0: 2023 2049 676e 6f72 6520 656d 7074 7920   # Ignore empty 
-0000abb0: 6f72 6465 7262 6f6f 6b73 2077 6865 6e20  orderbooks when 
-0000abc0: 6669 6c6c 696e 6720 2d20 6361 6e20 6265  filling - can be
-0000abd0: 2066 696c 6c65 6420 7769 7468 2074 6865   filled with the
-0000abe0: 206e 6578 7420 6974 6572 6174 696f 6e2e   next iteration.
-0000abf0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0000ac00: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-0000ac10: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
-0000ac20: 6368 6563 6b5f 6472 795f 6c69 6d69 745f  check_dry_limit_
-0000ac30: 6f72 6465 725f 6669 6c6c 6564 280a 2020  order_filled(.  
-0000ac40: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-0000ac50: 6f72 6465 723a 2044 6963 745b 7374 722c  order: Dict[str,
-0000ac60: 2041 6e79 5d2c 2069 6d6d 6564 6961 7465   Any], immediate
-0000ac70: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-0000ac80: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000ac90: 7262 6f6f 6b3a 204f 7074 696f 6e61 6c5b  rbook: Optional[
-0000aca0: 4f72 6465 7242 6f6f 6b5d 203d 204e 6f6e  OrderBook] = Non
-0000acb0: 6529 202d 3e20 4469 6374 5b73 7472 2c20  e) -> Dict[str, 
-0000acc0: 416e 795d 3a0a 2020 2020 2020 2020 2222  Any]:.        ""
-0000acd0: 220a 2020 2020 2020 2020 4368 6563 6b20  ".        Check 
-0000ace0: 6472 792d 7275 6e20 6c69 6d69 7420 6f72  dry-run limit or
-0000acf0: 6465 7220 6669 6c6c 2061 6e64 2075 7064  der fill and upd
-0000ad00: 6174 6520 6665 6520 2869 6620 6974 2066  ate fee (if it f
-0000ad10: 696c 6c65 6429 2e0a 2020 2020 2020 2020  illed)..        
-0000ad20: 2222 220a 2020 2020 2020 2020 6966 2028  """.        if (
-0000ad30: 6f72 6465 725b 2773 7461 7475 7327 5d20  order['status'] 
-0000ad40: 213d 2022 636c 6f73 6564 220a 2020 2020  != "closed".    
-0000ad50: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000ad60: 6f72 6465 725b 2774 7970 6527 5d20 696e  order['type'] in
-0000ad70: 205b 226c 696d 6974 225d 0a20 2020 2020   ["limit"].     
-0000ad80: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-0000ad90: 6f74 206f 7264 6572 2e67 6574 2827 6674  ot order.get('ft
-0000ada0: 5f6f 7264 6572 5f74 7970 6527 2929 3a0a  _order_type')):.
-0000adb0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0000adc0: 203d 206f 7264 6572 5b27 7379 6d62 6f6c   = order['symbol
-0000add0: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-0000ade0: 6620 7365 6c66 2e5f 6472 795f 6973 5f70  f self._dry_is_p
-0000adf0: 7269 6365 5f63 726f 7373 6564 2870 6169  rice_crossed(pai
-0000ae00: 722c 206f 7264 6572 5b27 7369 6465 275d  r, order['side']
-0000ae10: 2c20 6f72 6465 725b 2770 7269 6365 275d  , order['price']
-0000ae20: 2c20 6f72 6465 7262 6f6f 6b29 3a0a 2020  , orderbook):.  
-0000ae30: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000ae40: 6465 722e 7570 6461 7465 287b 0a20 2020  der.update({.   
-0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae60: 2027 7374 6174 7573 273a 2027 636c 6f73   'status': 'clos
-0000ae70: 6564 272c 0a20 2020 2020 2020 2020 2020  ed',.           
-0000ae80: 2020 2020 2020 2020 2027 6669 6c6c 6564           'filled
-0000ae90: 273a 206f 7264 6572 5b27 616d 6f75 6e74  ': order['amount
-0000aea0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0000aeb0: 2020 2020 2020 2020 2772 656d 6169 6e69          'remaini
-0000aec0: 6e67 273a 2030 2c0a 2020 2020 2020 2020  ng': 0,.        
-0000aed0: 2020 2020 2020 2020 7d29 0a0a 2020 2020          })..    
-0000aee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000aef0: 2e61 6464 5f64 7279 5f6f 7264 6572 5f66  .add_dry_order_f
-0000af00: 6565 280a 2020 2020 2020 2020 2020 2020  ee(.            
-0000af10: 2020 2020 2020 2020 7061 6972 2c0a 2020          pair,.  
-0000af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af30: 2020 6f72 6465 722c 0a20 2020 2020 2020    order,.       
-0000af40: 2020 2020 2020 2020 2020 2020 2027 7461               'ta
-0000af50: 6b65 7227 2069 6620 696d 6d65 6469 6174  ker' if immediat
-0000af60: 6520 656c 7365 2027 6d61 6b65 7227 2c0a  e else 'maker',.
-0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af80: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000af90: 6e20 6f72 6465 720a 0a20 2020 2064 6566  n order..    def
-0000afa0: 2066 6574 6368 5f64 7279 5f72 756e 5f6f   fetch_dry_run_o
-0000afb0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
-0000afc0: 5f69 6429 202d 3e20 4469 6374 5b73 7472  _id) -> Dict[str
-0000afd0: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
-0000afe0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0000aff0: 726e 2064 7279 2d72 756e 206f 7264 6572  rn dry-run order
-0000b000: 0a20 2020 2020 2020 204f 6e6c 7920 6361  .        Only ca
-0000b010: 6c6c 2069 6620 7275 6e6e 696e 6720 696e  ll if running in
-0000b020: 2064 7279 2d72 756e 206d 6f64 652e 0a20   dry-run mode.. 
-0000b030: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000b040: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000b050: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000b060: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
-0000b070: 7264 6572 735b 6f72 6465 725f 6964 5d0a  rders[order_id].
-0000b080: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000b090: 7220 3d20 7365 6c66 2e63 6865 636b 5f64  r = self.check_d
-0000b0a0: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
-0000b0b0: 696c 6c65 6428 6f72 6465 7229 0a20 2020  illed(order).   
-0000b0c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b0d0: 6f72 6465 720a 2020 2020 2020 2020 6578  order.        ex
-0000b0e0: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
-0000b0f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000b100: 6672 6f6d 2066 7265 7174 7261 6465 2e70  from freqtrade.p
-0000b110: 6572 7369 7374 656e 6365 2069 6d70 6f72  ersistence impor
-0000b120: 7420 4f72 6465 720a 2020 2020 2020 2020  t Order.        
-0000b130: 2020 2020 6f72 6465 7220 3d20 4f72 6465      order = Orde
-0000b140: 722e 6f72 6465 725f 6279 5f69 6428 6f72  r.order_by_id(or
-0000b150: 6465 725f 6964 290a 2020 2020 2020 2020  der_id).        
-0000b160: 2020 2020 6966 206f 7264 6572 3a0a 2020      if order:.  
-0000b170: 2020 2020 2020 2020 2020 2020 2020 6363                cc
-0000b180: 7874 5f6f 7264 6572 203d 206f 7264 6572  xt_order = order
-0000b190: 2e74 6f5f 6363 7874 5f6f 626a 6563 7428  .to_ccxt_object(
-0000b1a0: 7365 6c66 2e5f 6674 5f68 6173 5b27 7374  self._ft_has['st
-0000b1b0: 6f70 5f70 7269 6365 5f70 6172 616d 275d  op_price_param']
-0000b1c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b1d0: 2020 7365 6c66 2e5f 6472 795f 7275 6e5f    self._dry_run_
-0000b1e0: 6f70 656e 5f6f 7264 6572 735b 6f72 6465  open_orders[orde
-0000b1f0: 725f 6964 5d20 3d20 6363 7874 5f6f 7264  r_id] = ccxt_ord
-0000b200: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0000b210: 2020 2072 6574 7572 6e20 6363 7874 5f6f     return ccxt_o
-0000b220: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
-0000b230: 2023 2047 7261 6365 6675 6c6c 7920 6861   # Gracefully ha
-0000b240: 6e64 6c65 2065 7272 6f72 7320 7769 7468  ndle errors with
-0000b250: 2064 7279 2d72 756e 206f 7264 6572 732e   dry-run orders.
-0000b260: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000b270: 7365 2049 6e76 616c 6964 4f72 6465 7245  se InvalidOrderE
-0000b280: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-0000b290: 2020 2020 2020 2020 2020 6627 5472 6965            f'Trie
-0000b2a0: 6420 746f 2067 6574 2061 6e20 696e 7661  d to get an inva
-0000b2b0: 6c69 6420 6472 792d 7275 6e2d 6f72 6465  lid dry-run-orde
-0000b2c0: 7220 2869 643a 207b 6f72 6465 725f 6964  r (id: {order_id
-0000b2d0: 7d29 2e20 4d65 7373 6167 653a 207b 657d  }). Message: {e}
-0000b2e0: 2729 2066 726f 6d20 650a 0a20 2020 2023  ') from e..    #
-0000b2f0: 204f 7264 6572 2068 616e 646c 696e 670a   Order handling.
-0000b300: 0a20 2020 2064 6566 205f 6c65 765f 7072  .    def _lev_pr
-0000b310: 6570 2873 656c 662c 2070 6169 723a 2073  ep(self, pair: s
-0000b320: 7472 2c20 6c65 7665 7261 6765 3a20 666c  tr, leverage: fl
-0000b330: 6f61 742c 2073 6964 653a 2042 7579 5365  oat, side: BuySe
-0000b340: 6c6c 2c20 6163 6365 7074 5f66 6169 6c3a  ll, accept_fail:
-0000b350: 2062 6f6f 6c20 3d20 4661 6c73 6529 3a0a   bool = False):.
-0000b360: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000b370: 7472 6164 696e 675f 6d6f 6465 2021 3d20  trading_mode != 
-0000b380: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
-0000b390: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000b3a0: 6c66 2e73 6574 5f6d 6172 6769 6e5f 6d6f  lf.set_margin_mo
-0000b3b0: 6465 2870 6169 722c 2073 656c 662e 6d61  de(pair, self.ma
-0000b3c0: 7267 696e 5f6d 6f64 652c 2061 6363 6570  rgin_mode, accep
-0000b3d0: 745f 6661 696c 290a 2020 2020 2020 2020  t_fail).        
-0000b3e0: 2020 2020 7365 6c66 2e5f 7365 745f 6c65      self._set_le
-0000b3f0: 7665 7261 6765 286c 6576 6572 6167 652c  verage(leverage,
-0000b400: 2070 6169 722c 2061 6363 6570 745f 6661   pair, accept_fa
-0000b410: 696c 290a 0a20 2020 2064 6566 205f 6765  il)..    def _ge
-0000b420: 745f 7061 7261 6d73 280a 2020 2020 2020  t_params(.      
-0000b430: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000b440: 7369 6465 3a20 4275 7953 656c 6c2c 0a20  side: BuySell,. 
-0000b450: 2020 2020 2020 206f 7264 6572 7479 7065         ordertype
-0000b460: 3a20 7374 722c 0a20 2020 2020 2020 206c  : str,.        l
-0000b470: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
-0000b480: 2020 2020 2020 2020 7265 6475 6365 4f6e          reduceOn
-0000b490: 6c79 3a20 626f 6f6c 2c0a 2020 2020 2020  ly: bool,.      
-0000b4a0: 2020 7469 6d65 5f69 6e5f 666f 7263 653a    time_in_force:
-0000b4b0: 2073 7472 203d 2027 4754 4327 2c0a 2020   str = 'GTC',.  
-0000b4c0: 2020 2920 2d3e 2044 6963 743a 0a20 2020    ) -> Dict:.   
-0000b4d0: 2020 2020 2070 6172 616d 7320 3d20 7365       params = se
-0000b4e0: 6c66 2e5f 7061 7261 6d73 2e63 6f70 7928  lf._params.copy(
-0000b4f0: 290a 2020 2020 2020 2020 6966 2074 696d  ).        if tim
-0000b500: 655f 696e 5f66 6f72 6365 2021 3d20 2747  e_in_force != 'G
-0000b510: 5443 2720 616e 6420 6f72 6465 7274 7970  TC' and ordertyp
-0000b520: 6520 213d 2027 6d61 726b 6574 273a 0a20  e != 'market':. 
-0000b530: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000b540: 732e 7570 6461 7465 287b 2774 696d 6549  s.update({'timeI
-0000b550: 6e46 6f72 6365 273a 2074 696d 655f 696e  nForce': time_in
-0000b560: 5f66 6f72 6365 2e75 7070 6572 2829 7d29  _force.upper()})
-0000b570: 0a20 2020 2020 2020 2069 6620 7265 6475  .        if redu
-0000b580: 6365 4f6e 6c79 3a0a 2020 2020 2020 2020  ceOnly:.        
-0000b590: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
-0000b5a0: 6528 7b27 7265 6475 6365 4f6e 6c79 273a  e({'reduceOnly':
-0000b5b0: 2054 7275 657d 290a 2020 2020 2020 2020   True}).        
-0000b5c0: 7265 7475 726e 2070 6172 616d 730a 0a20  return params.. 
-0000b5d0: 2020 2064 6566 205f 6f72 6465 725f 6e65     def _order_ne
-0000b5e0: 6564 735f 7072 6963 6528 7365 6c66 2c20  eds_price(self, 
-0000b5f0: 6f72 6465 7274 7970 653a 2073 7472 2920  ordertype: str) 
-0000b600: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-0000b610: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
-0000b620: 2020 2020 2020 6f72 6465 7274 7970 6520        ordertype 
-0000b630: 213d 2027 6d61 726b 6574 270a 2020 2020  != 'market'.    
-0000b640: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-0000b650: 5f61 7069 2e6f 7074 696f 6e73 2e67 6574  _api.options.get
-0000b660: 2822 6372 6561 7465 4d61 726b 6574 4275  ("createMarketBu
-0000b670: 794f 7264 6572 5265 7175 6972 6573 5072  yOrderRequiresPr
-0000b680: 6963 6522 2c20 4661 6c73 6529 0a20 2020  ice", False).   
-0000b690: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
-0000b6a0: 2e5f 6674 5f68 6173 2e67 6574 2827 6d61  ._ft_has.get('ma
-0000b6b0: 726b 6574 4f72 6465 7252 6571 7569 7265  rketOrderRequire
-0000b6c0: 7350 7269 6365 272c 2046 616c 7365 290a  sPrice', False).
-0000b6d0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0000b6e0: 6566 2063 7265 6174 655f 6f72 6465 7228  ef create_order(
-0000b6f0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000b700: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
-0000b710: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
-0000b720: 2020 2020 206f 7264 6572 7479 7065 3a20       ordertype: 
-0000b730: 7374 722c 0a20 2020 2020 2020 2073 6964  str,.        sid
-0000b740: 653a 2042 7579 5365 6c6c 2c0a 2020 2020  e: BuySell,.    
-0000b750: 2020 2020 616d 6f75 6e74 3a20 666c 6f61      amount: floa
-0000b760: 742c 0a20 2020 2020 2020 2072 6174 653a  t,.        rate:
-0000b770: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
-0000b780: 6c65 7665 7261 6765 3a20 666c 6f61 742c  leverage: float,
-0000b790: 0a20 2020 2020 2020 2072 6564 7563 654f  .        reduceO
-0000b7a0: 6e6c 793a 2062 6f6f 6c20 3d20 4661 6c73  nly: bool = Fals
-0000b7b0: 652c 0a20 2020 2020 2020 2074 696d 655f  e,.        time_
-0000b7c0: 696e 5f66 6f72 6365 3a20 7374 7220 3d20  in_force: str = 
-0000b7d0: 2747 5443 272c 0a20 2020 2029 202d 3e20  'GTC',.    ) -> 
-0000b7e0: 4469 6374 3a0a 2020 2020 2020 2020 6966  Dict:.        if
-0000b7f0: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
-0000b800: 7279 5f72 756e 275d 3a0a 2020 2020 2020  ry_run']:.      
-0000b810: 2020 2020 2020 6472 795f 6f72 6465 7220        dry_order 
-0000b820: 3d20 7365 6c66 2e63 7265 6174 655f 6472  = self.create_dr
-0000b830: 795f 7275 6e5f 6f72 6465 7228 0a20 2020  y_run_order(.   
-0000b840: 2020 2020 2020 2020 2020 2020 2070 6169               pai
-0000b850: 722c 206f 7264 6572 7479 7065 2c20 7369  r, ordertype, si
-0000b860: 6465 2c20 616d 6f75 6e74 2c20 7365 6c66  de, amount, self
-0000b870: 2e70 7269 6365 5f74 6f5f 7072 6563 6973  .price_to_precis
-0000b880: 696f 6e28 7061 6972 2c20 7261 7465 292c  ion(pair, rate),
-0000b890: 206c 6576 6572 6167 6529 0a20 2020 2020   leverage).     
-0000b8a0: 2020 2020 2020 2072 6574 7572 6e20 6472         return dr
-0000b8b0: 795f 6f72 6465 720a 0a20 2020 2020 2020  y_order..       
-0000b8c0: 2070 6172 616d 7320 3d20 7365 6c66 2e5f   params = self._
-0000b8d0: 6765 745f 7061 7261 6d73 2873 6964 652c  get_params(side,
-0000b8e0: 206f 7264 6572 7479 7065 2c20 6c65 7665   ordertype, leve
-0000b8f0: 7261 6765 2c20 7265 6475 6365 4f6e 6c79  rage, reduceOnly
-0000b900: 2c20 7469 6d65 5f69 6e5f 666f 7263 6529  , time_in_force)
-0000b910: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000b920: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
-0000b930: 2074 6865 2070 7265 6369 7369 6f6e 2066   the precision f
-0000b940: 6f72 2061 6d6f 756e 7420 616e 6420 7072  or amount and pr
-0000b950: 6963 6528 7261 7465 2920 6173 2061 6363  ice(rate) as acc
-0000b960: 6570 7465 6420 6279 2074 6865 2065 7863  epted by the exc
-0000b970: 6861 6e67 650a 2020 2020 2020 2020 2020  hange.          
-0000b980: 2020 616d 6f75 6e74 203d 2073 656c 662e    amount = self.
-0000b990: 616d 6f75 6e74 5f74 6f5f 7072 6563 6973  amount_to_precis
-0000b9a0: 696f 6e28 7061 6972 2c20 7365 6c66 2e5f  ion(pair, self._
-0000b9b0: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
-0000b9c0: 6374 7328 7061 6972 2c20 616d 6f75 6e74  cts(pair, amount
-0000b9d0: 2929 0a20 2020 2020 2020 2020 2020 206e  )).            n
-0000b9e0: 6565 6473 5f70 7269 6365 203d 2073 656c  eeds_price = sel
-0000b9f0: 662e 5f6f 7264 6572 5f6e 6565 6473 5f70  f._order_needs_p
-0000ba00: 7269 6365 286f 7264 6572 7479 7065 290a  rice(ordertype).
-0000ba10: 2020 2020 2020 2020 2020 2020 7261 7465              rate
-0000ba20: 5f66 6f72 5f6f 7264 6572 203d 2073 656c  _for_order = sel
-0000ba30: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
-0000ba40: 7369 6f6e 2870 6169 722c 2072 6174 6529  sion(pair, rate)
-0000ba50: 2069 6620 6e65 6564 735f 7072 6963 6520   if needs_price 
-0000ba60: 656c 7365 204e 6f6e 650a 0a20 2020 2020  else None..     
-0000ba70: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-0000ba80: 6475 6365 4f6e 6c79 3a0a 2020 2020 2020  duceOnly:.      
-0000ba90: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000baa0: 6c65 765f 7072 6570 2870 6169 722c 206c  lev_prep(pair, l
-0000bab0: 6576 6572 6167 652c 2073 6964 6529 0a0a  everage, side)..
-0000bac0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000bad0: 7220 3d20 7365 6c66 2e5f 6170 692e 6372  r = self._api.cr
-0000bae0: 6561 7465 5f6f 7264 6572 280a 2020 2020  eate_order(.    
-0000baf0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0000bb00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bb10: 2020 6f72 6465 7274 7970 652c 0a20 2020    ordertype,.   
-0000bb20: 2020 2020 2020 2020 2020 2020 2073 6964               sid
-0000bb30: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000bb40: 2020 2061 6d6f 756e 742c 0a20 2020 2020     amount,.     
-0000bb50: 2020 2020 2020 2020 2020 2072 6174 655f             rate_
-0000bb60: 666f 725f 6f72 6465 722c 0a20 2020 2020  for_order,.     
-0000bb70: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000bb80: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
-0000bb90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000bba0: 662e 5f6c 6f67 5f65 7863 6861 6e67 655f  f._log_exchange_
-0000bbb0: 7265 7370 6f6e 7365 2827 6372 6561 7465  response('create
-0000bbc0: 5f6f 7264 6572 272c 206f 7264 6572 290a  _order', order).
-0000bbd0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000bbe0: 7220 3d20 7365 6c66 2e5f 6f72 6465 725f  r = self._order_
-0000bbf0: 636f 6e74 7261 6374 735f 746f 5f61 6d6f  contracts_to_amo
-0000bc00: 756e 7428 6f72 6465 7229 0a20 2020 2020  unt(order).     
-0000bc10: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-0000bc20: 6465 720a 0a20 2020 2020 2020 2065 7863  der..        exc
-0000bc30: 6570 7420 6363 7874 2e49 6e73 7566 6669  ept ccxt.Insuffi
-0000bc40: 6369 656e 7446 756e 6473 2061 7320 653a  cientFunds as e:
-0000bc50: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000bc60: 7365 2049 6e73 7566 6669 6369 656e 7446  se InsufficientF
-0000bc70: 756e 6473 4572 726f 7228 0a20 2020 2020  undsError(.     
-0000bc80: 2020 2020 2020 2020 2020 2066 2749 6e73             f'Ins
-0000bc90: 7566 6669 6369 656e 7420 6675 6e64 7320  ufficient funds 
-0000bca0: 746f 2063 7265 6174 6520 7b6f 7264 6572  to create {order
-0000bcb0: 7479 7065 7d20 7b73 6964 657d 206f 7264  type} {side} ord
-0000bcc0: 6572 206f 6e20 6d61 726b 6574 207b 7061  er on market {pa
-0000bcd0: 6972 7d2e 2027 0a20 2020 2020 2020 2020  ir}. '.         
-0000bce0: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
-0000bcf0: 6f20 7b73 6964 657d 2061 6d6f 756e 7420  o {side} amount 
-0000bd00: 7b61 6d6f 756e 747d 2061 7420 7261 7465  {amount} at rate
-0000bd10: 207b 7261 7465 7d2e 270a 2020 2020 2020   {rate}.'.      
-0000bd20: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-0000bd30: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0000bd40: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000bd50: 2063 6378 742e 496e 7661 6c69 644f 7264   ccxt.InvalidOrd
-0000bd60: 6572 2061 7320 653a 0a20 2020 2020 2020  er as e:.       
-0000bd70: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
-0000bd80: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
-0000bd90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000bda0: 2020 6627 436f 756c 6420 6e6f 7420 6372    f'Could not cr
-0000bdb0: 6561 7465 207b 6f72 6465 7274 7970 657d  eate {ordertype}
-0000bdc0: 207b 7369 6465 7d20 6f72 6465 7220 6f6e   {side} order on
-0000bdd0: 206d 6172 6b65 7420 7b70 6169 727d 2e20   market {pair}. 
-0000bde0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000bdf0: 2020 6627 5472 6965 6420 746f 207b 7369    f'Tried to {si
-0000be00: 6465 7d20 616d 6f75 6e74 207b 616d 6f75  de} amount {amou
-0000be10: 6e74 7d20 6174 2072 6174 6520 7b72 6174  nt} at rate {rat
-0000be20: 657d 2e20 270a 2020 2020 2020 2020 2020  e}. '.          
-0000be30: 2020 2020 2020 6627 4d65 7373 6167 653a        f'Message:
-0000be40: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000be50: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000be60: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-0000be70: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000be80: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-0000be90: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-0000bea0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000beb0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-0000bec0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-0000bed0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-0000bee0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000bef0: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-0000bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf10: 2066 2743 6f75 6c64 206e 6f74 2070 6c61   f'Could not pla
-0000bf20: 6365 207b 7369 6465 7d20 6f72 6465 7220  ce {side} order 
-0000bf30: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
-0000bf40: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
-0000bf50: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
-0000bf60: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000bf70: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
-0000bf80: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000bf90: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-0000bfa0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-0000bfb0: 6529 2066 726f 6d20 650a 0a20 2020 2064  e) from e..    d
-0000bfc0: 6566 2073 746f 706c 6f73 735f 6164 6a75  ef stoploss_adju
-0000bfd0: 7374 2873 656c 662c 2073 746f 705f 6c6f  st(self, stop_lo
-0000bfe0: 7373 3a20 666c 6f61 742c 206f 7264 6572  ss: float, order
-0000bff0: 3a20 4469 6374 2c20 7369 6465 3a20 7374  : Dict, side: st
-0000c000: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
-0000c010: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c020: 5665 7269 6679 2073 746f 705f 6c6f 7373  Verify stop_loss
-0000c030: 2061 6761 696e 7374 2073 746f 706c 6f73   against stoplos
-0000c040: 732d 6f72 6465 7220 7661 6c75 6520 286c  s-order value (l
-0000c050: 696d 6974 206f 7220 7072 6963 6529 0a20  imit or price). 
-0000c060: 2020 2020 2020 2052 6574 7572 6e73 2054         Returns T
-0000c070: 7275 6520 6966 2061 646a 7573 746d 656e  rue if adjustmen
-0000c080: 7420 6973 206e 6563 6573 7361 7279 2e0a  t is necessary..
-0000c090: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000c0a0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0000c0b0: 5f66 745f 6861 732e 6765 7428 2773 746f  _ft_has.get('sto
-0000c0c0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
-0000c0d0: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
-0000c0e0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-0000c0f0: 616c 4578 6365 7074 696f 6e28 6622 7374  alException(f"st
-0000c100: 6f70 6c6f 7373 2069 7320 6e6f 7420 696d  oploss is not im
-0000c110: 706c 656d 656e 7465 6420 666f 7220 7b73  plemented for {s
-0000c120: 656c 662e 6e61 6d65 7d2e 2229 0a20 2020  elf.name}.").   
-0000c130: 2020 2020 2070 7269 6365 5f70 6172 616d       price_param
-0000c140: 203d 2073 656c 662e 5f66 745f 6861 735b   = self._ft_has[
-0000c150: 2773 746f 705f 7072 6963 655f 7061 7261  'stop_price_para
-0000c160: 6d27 5d0a 2020 2020 2020 2020 7265 7475  m'].        retu
-0000c170: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
-0000c180: 206f 7264 6572 2e67 6574 2870 7269 6365   order.get(price
-0000c190: 5f70 6172 616d 2c20 4e6f 6e65 2920 6973  _param, None) is
-0000c1a0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000c1b0: 2020 6f72 2028 2873 6964 6520 3d3d 2022    or ((side == "
-0000c1c0: 7365 6c6c 2220 616e 6420 7374 6f70 5f6c  sell" and stop_l
-0000c1d0: 6f73 7320 3e20 666c 6f61 7428 6f72 6465  oss > float(orde
-0000c1e0: 725b 7072 6963 655f 7061 7261 6d5d 2929  r[price_param]))
-0000c1f0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0000c200: 2020 2020 2873 6964 6520 3d3d 2022 6275      (side == "bu
-0000c210: 7922 2061 6e64 2073 746f 705f 6c6f 7373  y" and stop_loss
-0000c220: 203c 2066 6c6f 6174 286f 7264 6572 5b70   < float(order[p
-0000c230: 7269 6365 5f70 6172 616d 5d29 2929 0a20  rice_param]))). 
-0000c240: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000c250: 6620 5f67 6574 5f73 746f 705f 6f72 6465  f _get_stop_orde
-0000c260: 725f 7479 7065 2873 656c 662c 2075 7365  r_type(self, use
-0000c270: 725f 6f72 6465 725f 7479 7065 2920 2d3e  r_order_type) ->
-0000c280: 2054 7570 6c65 5b73 7472 2c20 7374 725d   Tuple[str, str]
-0000c290: 3a0a 0a20 2020 2020 2020 2061 7661 696c  :..        avail
-0000c2a0: 6162 6c65 5f6f 7264 6572 5f54 7970 6573  able_order_Types
-0000c2b0: 3a20 4469 6374 5b73 7472 2c20 7374 725d  : Dict[str, str]
-0000c2c0: 203d 2073 656c 662e 5f66 745f 6861 735b   = self._ft_has[
-0000c2d0: 2273 746f 706c 6f73 735f 6f72 6465 725f  "stoploss_order_
-0000c2e0: 7479 7065 7322 5d0a 0a20 2020 2020 2020  types"]..       
-0000c2f0: 2069 6620 7573 6572 5f6f 7264 6572 5f74   if user_order_t
-0000c300: 7970 6520 696e 2061 7661 696c 6162 6c65  ype in available
-0000c310: 5f6f 7264 6572 5f54 7970 6573 2e6b 6579  _order_Types.key
-0000c320: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000c330: 206f 7264 6572 7479 7065 203d 2061 7661   ordertype = ava
-0000c340: 696c 6162 6c65 5f6f 7264 6572 5f54 7970  ilable_order_Typ
-0000c350: 6573 5b75 7365 725f 6f72 6465 725f 7479  es[user_order_ty
-0000c360: 7065 5d0a 2020 2020 2020 2020 656c 7365  pe].        else
-0000c370: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000c380: 4f74 6865 7277 6973 6520 7069 636b 206f  Otherwise pick o
-0000c390: 6e6c 7920 6f6e 6520 6176 6169 6c61 626c  nly one availabl
-0000c3a0: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
-0000c3b0: 6465 7274 7970 6520 3d20 6c69 7374 2861  dertype = list(a
-0000c3c0: 7661 696c 6162 6c65 5f6f 7264 6572 5f54  vailable_order_T
-0000c3d0: 7970 6573 2e76 616c 7565 7328 2929 5b30  ypes.values())[0
-0000c3e0: 5d0a 2020 2020 2020 2020 2020 2020 7573  ].            us
-0000c3f0: 6572 5f6f 7264 6572 5f74 7970 6520 3d20  er_order_type = 
-0000c400: 6c69 7374 2861 7661 696c 6162 6c65 5f6f  list(available_o
-0000c410: 7264 6572 5f54 7970 6573 2e6b 6579 7328  rder_Types.keys(
-0000c420: 2929 5b30 5d0a 2020 2020 2020 2020 7265  ))[0].        re
-0000c430: 7475 726e 206f 7264 6572 7479 7065 2c20  turn ordertype, 
-0000c440: 7573 6572 5f6f 7264 6572 5f74 7970 650a  user_order_type.
-0000c450: 0a20 2020 2064 6566 205f 6765 745f 7374  .    def _get_st
-0000c460: 6f70 5f6c 696d 6974 5f72 6174 6528 7365  op_limit_rate(se
-0000c470: 6c66 2c20 7374 6f70 5f70 7269 6365 3a20  lf, stop_price: 
-0000c480: 666c 6f61 742c 206f 7264 6572 5f74 7970  float, order_typ
-0000c490: 6573 3a20 4469 6374 2c20 7369 6465 3a20  es: Dict, side: 
-0000c4a0: 7374 7229 202d 3e20 666c 6f61 743a 0a20  str) -> float:. 
-0000c4b0: 2020 2020 2020 2023 204c 696d 6974 2070         # Limit p
-0000c4c0: 7269 6365 2074 6872 6573 686f 6c64 3a20  rice threshold: 
-0000c4d0: 4173 206c 696d 6974 2070 7269 6365 2073  As limit price s
-0000c4e0: 686f 756c 6420 616c 7761 7973 2062 6520  hould always be 
-0000c4f0: 6265 6c6f 7720 7374 6f70 2d70 7269 6365  below stop-price
-0000c500: 0a20 2020 2020 2020 206c 696d 6974 5f70  .        limit_p
-0000c510: 7269 6365 5f70 6374 203d 206f 7264 6572  rice_pct = order
-0000c520: 5f74 7970 6573 2e67 6574 2827 7374 6f70  _types.get('stop
-0000c530: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
-0000c540: 5f6c 696d 6974 5f72 6174 696f 272c 2030  _limit_ratio', 0
-0000c550: 2e39 3929 0a20 2020 2020 2020 2069 6620  .99).        if 
-0000c560: 7369 6465 203d 3d20 2273 656c 6c22 3a0a  side == "sell":.
-0000c570: 2020 2020 2020 2020 2020 2020 6c69 6d69              limi
-0000c580: 745f 7261 7465 203d 2073 746f 705f 7072  t_rate = stop_pr
-0000c590: 6963 6520 2a20 6c69 6d69 745f 7072 6963  ice * limit_pric
-0000c5a0: 655f 7063 740a 2020 2020 2020 2020 656c  e_pct.        el
-0000c5b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c5c0: 6c69 6d69 745f 7261 7465 203d 2073 746f  limit_rate = sto
-0000c5d0: 705f 7072 6963 6520 2a20 2832 202d 206c  p_price * (2 - l
-0000c5e0: 696d 6974 5f70 7269 6365 5f70 6374 290a  imit_price_pct).
-0000c5f0: 0a20 2020 2020 2020 2062 6164 5f73 746f  .        bad_sto
-0000c600: 705f 7072 6963 6520 3d20 2828 7374 6f70  p_price = ((stop
-0000c610: 5f70 7269 6365 203c 3d20 6c69 6d69 745f  _price <= limit_
-0000c620: 7261 7465 2920 6966 2073 6964 6520 3d3d  rate) if side ==
-0000c630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c640: 2020 2020 2020 2020 2020 2022 7365 6c6c             "sell
-0000c650: 2220 656c 7365 2028 7374 6f70 5f70 7269  " else (stop_pri
-0000c660: 6365 203e 3d20 6c69 6d69 745f 7261 7465  ce >= limit_rate
-0000c670: 2929 0a20 2020 2020 2020 2023 2045 6e73  )).        # Ens
-0000c680: 7572 6520 7261 7465 2069 7320 6c65 7373  ure rate is less
-0000c690: 2074 6861 6e20 7374 6f70 2070 7269 6365   than stop price
-0000c6a0: 0a20 2020 2020 2020 2069 6620 6261 645f  .        if bad_
-0000c6b0: 7374 6f70 5f70 7269 6365 3a0a 2020 2020  stop_price:.    
-0000c6c0: 2020 2020 2020 2020 2320 5468 6973 2063          # This c
-0000c6d0: 616e 2066 6f72 2065 7861 6d70 6c65 2068  an for example h
-0000c6e0: 6170 7065 6e20 6966 2074 6865 2073 746f  appen if the sto
-0000c6f0: 7020 2f20 6c69 7175 6964 6174 696f 6e20  p / liquidation 
-0000c700: 7072 6963 6520 6973 2073 6574 2074 6f20  price is set to 
-0000c710: 300a 2020 2020 2020 2020 2020 2020 2320  0.            # 
-0000c720: 5768 6963 6820 6973 2070 6f73 7369 626c  Which is possibl
-0000c730: 6520 6966 2061 206d 6172 6b65 742d 6f72  e if a market-or
-0000c740: 6465 7220 636c 6f73 6573 2072 6967 6874  der closes right
-0000c750: 2061 7761 792e 0a20 2020 2020 2020 2020   away..         
-0000c760: 2020 2023 2054 6865 2049 6e76 616c 6964     # The Invalid
-0000c770: 4f72 6465 7245 7863 6570 7469 6f6e 2077  OrderException w
-0000c780: 696c 6c20 6275 6262 6c65 2075 7020 746f  ill bubble up to
-0000c790: 2065 7869 745f 706f 7369 7469 6f6e 732c   exit_positions,
-0000c7a0: 2077 6865 7265 2069 7420 7769 6c6c 2062   where it will b
-0000c7b0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-0000c7c0: 6861 6e64 6c65 6420 6772 6163 6566 756c  handled graceful
-0000c7d0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
-0000c7e0: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
-0000c7f0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
-0000c800: 2020 2020 2020 2020 2020 2020 2022 496e               "In
-0000c810: 2073 746f 706c 6f73 7320 6c69 6d69 7420   stoploss limit 
-0000c820: 6f72 6465 722c 2073 746f 7020 7072 6963  order, stop pric
-0000c830: 6520 7368 6f75 6c64 2062 6520 6d6f 7265  e should be more
-0000c840: 2074 6861 6e20 6c69 6d69 7420 7072 6963   than limit pric
-0000c850: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
-0000c860: 2020 2020 2066 2253 746f 7020 7072 6963       f"Stop pric
-0000c870: 653a 207b 7374 6f70 5f70 7269 6365 7d2c  e: {stop_price},
-0000c880: 204c 696d 6974 2070 7269 6365 3a20 7b6c   Limit price: {l
-0000c890: 696d 6974 5f72 6174 657d 2c20 220a 2020  imit_rate}, ".  
-0000c8a0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000c8b0: 4c69 6d69 7420 5072 6963 6520 7063 743a  Limit Price pct:
-0000c8c0: 207b 6c69 6d69 745f 7072 6963 655f 7063   {limit_price_pc
-0000c8d0: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
-0000c8e0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-0000c8f0: 7475 726e 206c 696d 6974 5f72 6174 650a  turn limit_rate.
-0000c900: 0a20 2020 2064 6566 205f 6765 745f 7374  .    def _get_st
-0000c910: 6f70 5f70 6172 616d 7328 7365 6c66 2c20  op_params(self, 
-0000c920: 7369 6465 3a20 4275 7953 656c 6c2c 206f  side: BuySell, o
-0000c930: 7264 6572 7479 7065 3a20 7374 722c 2073  rdertype: str, s
-0000c940: 746f 705f 7072 6963 653a 2066 6c6f 6174  top_price: float
-0000c950: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-0000c960: 2020 2070 6172 616d 7320 3d20 7365 6c66     params = self
-0000c970: 2e5f 7061 7261 6d73 2e63 6f70 7928 290a  ._params.copy().
-0000c980: 2020 2020 2020 2020 2320 5665 7269 6679          # Verify
-0000c990: 2069 6620 7374 6f70 5072 6963 6520 776f   if stopPrice wo
-0000c9a0: 726b 7320 666f 7220 796f 7572 2065 7863  rks for your exc
-0000c9b0: 6861 6e67 652c 2065 6c73 6520 636f 6e66  hange, else conf
-0000c9c0: 6967 7572 6520 7374 6f70 5f70 7269 6365  igure stop_price
-0000c9d0: 5f70 6172 616d 0a20 2020 2020 2020 2070  _param.        p
-0000c9e0: 6172 616d 732e 7570 6461 7465 287b 7365  arams.update({se
-0000c9f0: 6c66 2e5f 6674 5f68 6173 5b27 7374 6f70  lf._ft_has['stop
-0000ca00: 5f70 7269 6365 5f70 6172 616d 275d 3a20  _price_param']: 
-0000ca10: 7374 6f70 5f70 7269 6365 7d29 0a20 2020  stop_price}).   
-0000ca20: 2020 2020 2072 6574 7572 6e20 7061 7261       return para
-0000ca30: 6d73 0a0a 2020 2020 4072 6574 7269 6572  ms..    @retrier
-0000ca40: 2872 6574 7269 6573 3d30 290a 2020 2020  (retries=0).    
-0000ca50: 6465 6620 6372 6561 7465 5f73 746f 706c  def create_stopl
-0000ca60: 6f73 7328 7365 6c66 2c20 7061 6972 3a20  oss(self, pair: 
-0000ca70: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
-0000ca80: 6174 2c20 7374 6f70 5f70 7269 6365 3a20  at, stop_price: 
-0000ca90: 666c 6f61 742c 206f 7264 6572 5f74 7970  float, order_typ
-0000caa0: 6573 3a20 4469 6374 2c0a 2020 2020 2020  es: Dict,.      
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cac0: 2020 7369 6465 3a20 4275 7953 656c 6c2c    side: BuySell,
-0000cad0: 206c 6576 6572 6167 653a 2066 6c6f 6174   leverage: float
-0000cae0: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-0000caf0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-0000cb00: 7265 6174 6573 2061 2073 746f 706c 6f73  reates a stoplos
-0000cb10: 7320 6f72 6465 722e 0a20 2020 2020 2020  s order..       
-0000cb20: 2072 6571 7569 7265 7320 605f 6674 5f68   requires `_ft_h
-0000cb30: 6173 5b27 7374 6f70 6c6f 7373 5f6f 7264  as['stoploss_ord
-0000cb40: 6572 5f74 7970 6573 275d 6020 746f 2062  er_types']` to b
-0000cb50: 6520 7365 7420 6173 2061 2064 6963 7420  e set as a dict 
-0000cb60: 6d61 7070 696e 6720 6c69 6d69 7420 616e  mapping limit an
-0000cb70: 6420 6d61 726b 6574 0a20 2020 2020 2020  d market.       
-0000cb80: 2020 2020 2074 6f20 7468 6520 636f 7272       to the corr
-0000cb90: 6573 706f 6e64 696e 6720 6578 6368 616e  esponding exchan
-0000cba0: 6765 2074 7970 652e 0a0a 2020 2020 2020  ge type...      
-0000cbb0: 2020 5468 6520 7072 6563 6973 6520 6f72    The precise or
-0000cbc0: 6465 7274 7970 6520 6973 2064 6574 6572  dertype is deter
-0000cbd0: 6d69 6e65 6420 6279 2074 6865 206f 7264  mined by the ord
-0000cbe0: 6572 5f74 7970 6573 2064 6963 7420 6f72  er_types dict or
-0000cbf0: 2065 7863 6861 6e67 6520 6465 6661 756c   exchange defaul
-0000cc00: 742e 0a0a 2020 2020 2020 2020 5468 6520  t...        The 
-0000cc10: 6578 6365 7074 696f 6e20 6265 6c6f 7720  exception below 
-0000cc20: 7368 6f75 6c64 206e 6576 6572 2072 6169  should never rai
-0000cc30: 7365 2c20 7369 6e63 6520 7765 2064 6973  se, since we dis
-0000cc40: 616c 6c6f 770a 2020 2020 2020 2020 7374  allow.        st
-0000cc50: 6172 7469 6e67 2074 6865 2062 6f74 2069  arting the bot i
-0000cc60: 6e20 7661 6c69 6461 7465 5f6f 7264 6572  n validate_order
-0000cc70: 7479 7065 7328 290a 0a20 2020 2020 2020  types()..       
-0000cc80: 2054 6869 7320 6d61 7920 776f 726b 2077   This may work w
-0000cc90: 6974 6820 6120 6c69 6d69 7465 6420 6e75  ith a limited nu
-0000cca0: 6d62 6572 206f 6620 6f74 6865 7220 6578  mber of other ex
-0000ccb0: 6368 616e 6765 732c 2062 7574 2063 6f72  changes, but cor
-0000ccc0: 7265 6374 2077 6f72 6b69 6e67 0a20 2020  rect working.   
-0000ccd0: 2020 2020 2020 2020 206e 6565 6473 2074           needs t
-0000cce0: 6f20 6265 2074 6573 7465 6420 696e 6469  o be tested indi
-0000ccf0: 7669 6475 616c 6c79 2e0a 2020 2020 2020  vidually..      
-0000cd00: 2020 5741 524e 494e 473a 2073 6574 7469    WARNING: setti
-0000cd10: 6e67 2060 7374 6f70 6c6f 7373 5f6f 6e5f  ng `stoploss_on_
-0000cd20: 6578 6368 616e 6765 6020 746f 2054 7275  exchange` to Tru
-0000cd30: 6520 7769 6c6c 204e 4f54 2061 7574 6f2d  e will NOT auto-
-0000cd40: 656e 6162 6c65 2073 746f 706c 6f73 7320  enable stoploss 
-0000cd50: 6f6e 2065 7863 6861 6e67 652e 0a20 2020  on exchange..   
-0000cd60: 2020 2020 2020 2020 2060 7374 6f70 6c6f           `stoplo
-0000cd70: 7373 5f61 646a 7573 7460 206d 7573 7420  ss_adjust` must 
-0000cd80: 7374 696c 6c20 6265 2069 6d70 6c65 6d65  still be impleme
-0000cd90: 6e74 6564 2066 6f72 2074 6869 7320 746f  nted for this to
-0000cda0: 2077 6f72 6b2e 0a20 2020 2020 2020 2022   work..        "
-0000cdb0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-0000cdc0: 7420 7365 6c66 2e5f 6674 5f68 6173 5b27  t self._ft_has['
-0000cdd0: 7374 6f70 6c6f 7373 5f6f 6e5f 6578 6368  stoploss_on_exch
-0000cde0: 616e 6765 275d 3a0a 2020 2020 2020 2020  ange']:.        
-0000cdf0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0000ce00: 696f 6e61 6c45 7863 6570 7469 6f6e 2866  ionalException(f
-0000ce10: 2273 746f 706c 6f73 7320 6973 206e 6f74  "stoploss is not
-0000ce20: 2069 6d70 6c65 6d65 6e74 6564 2066 6f72   implemented for
-0000ce30: 207b 7365 6c66 2e6e 616d 657d 2e22 290a   {self.name}.").
-0000ce40: 0a20 2020 2020 2020 2075 7365 725f 6f72  .        user_or
-0000ce50: 6465 725f 7479 7065 203d 206f 7264 6572  der_type = order
-0000ce60: 5f74 7970 6573 2e67 6574 2827 7374 6f70  _types.get('stop
-0000ce70: 6c6f 7373 272c 2027 6d61 726b 6574 2729  loss', 'market')
-0000ce80: 0a20 2020 2020 2020 206f 7264 6572 7479  .        orderty
-0000ce90: 7065 2c20 7573 6572 5f6f 7264 6572 5f74  pe, user_order_t
-0000cea0: 7970 6520 3d20 7365 6c66 2e5f 6765 745f  ype = self._get_
-0000ceb0: 7374 6f70 5f6f 7264 6572 5f74 7970 6528  stop_order_type(
-0000cec0: 7573 6572 5f6f 7264 6572 5f74 7970 6529  user_order_type)
-0000ced0: 0a20 2020 2020 2020 2072 6f75 6e64 5f6d  .        round_m
-0000cee0: 6f64 6520 3d20 524f 554e 445f 444f 574e  ode = ROUND_DOWN
-0000cef0: 2069 6620 7369 6465 203d 3d20 2762 7579   if side == 'buy
-0000cf00: 2720 656c 7365 2052 4f55 4e44 5f55 500a  ' else ROUND_UP.
-0000cf10: 2020 2020 2020 2020 7374 6f70 5f70 7269          stop_pri
-0000cf20: 6365 5f6e 6f72 6d20 3d20 7365 6c66 2e70  ce_norm = self.p
-0000cf30: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
-0000cf40: 6e28 7061 6972 2c20 7374 6f70 5f70 7269  n(pair, stop_pri
-0000cf50: 6365 2c20 726f 756e 6469 6e67 5f6d 6f64  ce, rounding_mod
-0000cf60: 653d 726f 756e 645f 6d6f 6465 290a 2020  e=round_mode).  
-0000cf70: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
-0000cf80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000cf90: 6966 2075 7365 725f 6f72 6465 725f 7479  if user_order_ty
-0000cfa0: 7065 203d 3d20 276c 696d 6974 273a 0a20  pe == 'limit':. 
-0000cfb0: 2020 2020 2020 2020 2020 206c 696d 6974             limit
-0000cfc0: 5f72 6174 6520 3d20 7365 6c66 2e5f 6765  _rate = self._ge
-0000cfd0: 745f 7374 6f70 5f6c 696d 6974 5f72 6174  t_stop_limit_rat
-0000cfe0: 6528 7374 6f70 5f70 7269 6365 2c20 6f72  e(stop_price, or
-0000cff0: 6465 725f 7479 7065 732c 2073 6964 6529  der_types, side)
-0000d000: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
-0000d010: 6974 5f72 6174 6520 3d20 7365 6c66 2e70  it_rate = self.p
-0000d020: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
-0000d030: 6e28 7061 6972 2c20 6c69 6d69 745f 7261  n(pair, limit_ra
-0000d040: 7465 2c20 726f 756e 6469 6e67 5f6d 6f64  te, rounding_mod
-0000d050: 653d 726f 756e 645f 6d6f 6465 290a 0a20  e=round_mode).. 
-0000d060: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000d070: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-0000d080: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
-0000d090: 7279 5f6f 7264 6572 203d 2073 656c 662e  ry_order = self.
-0000d0a0: 6372 6561 7465 5f64 7279 5f72 756e 5f6f  create_dry_run_o
-0000d0b0: 7264 6572 280a 2020 2020 2020 2020 2020  rder(.          
-0000d0c0: 2020 2020 2020 7061 6972 2c0a 2020 2020        pair,.    
-0000d0d0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000d0e0: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
-0000d0f0: 2020 2020 2020 2073 6964 652c 0a20 2020         side,.   
-0000d100: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
-0000d110: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
-0000d120: 2020 2020 2073 746f 705f 7072 6963 655f       stop_price_
-0000d130: 6e6f 726d 2c0a 2020 2020 2020 2020 2020  norm,.          
-0000d140: 2020 2020 2020 7374 6f70 5f6c 6f73 733d        stop_loss=
-0000d150: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0000d160: 2020 2020 2020 6c65 7665 7261 6765 3d6c        leverage=l
-0000d170: 6576 6572 6167 652c 0a20 2020 2020 2020  everage,.       
-0000d180: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000d190: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
-0000d1a0: 6465 720a 0a20 2020 2020 2020 2074 7279  der..        try
-0000d1b0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0000d1c0: 7261 6d73 203d 2073 656c 662e 5f67 6574  rams = self._get
-0000d1d0: 5f73 746f 705f 7061 7261 6d73 2873 6964  _stop_params(sid
-0000d1e0: 653d 7369 6465 2c20 6f72 6465 7274 7970  e=side, ordertyp
-0000d1f0: 653d 6f72 6465 7274 7970 652c 0a20 2020  e=ordertype,.   
-0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a950: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000a960: 7262 6f6f 6b3a 204f 7074 696f 6e61 6c5b  rbook: Optional[
+0000a970: 4f72 6465 7242 6f6f 6b5d 203d 204e 6f6e  OrderBook] = Non
+0000a980: 652c 206f 6666 7365 743a 2066 6c6f 6174  e, offset: float
+0000a990: 203d 2030 2e30 2920 2d3e 2062 6f6f 6c3a   = 0.0) -> bool:
+0000a9a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000a9b0: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
+0000a9c0: 7328 2766 6574 6368 4c32 4f72 6465 7242  s('fetchL2OrderB
+0000a9d0: 6f6f 6b27 293a 0a20 2020 2020 2020 2020  ook'):.         
+0000a9e0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
+0000a9f0: 2020 2020 2020 2069 6620 6e6f 7420 6f72         if not or
+0000aa00: 6465 7262 6f6f 6b3a 0a20 2020 2020 2020  derbook:.       
+0000aa10: 2020 2020 206f 7264 6572 626f 6f6b 203d       orderbook =
+0000aa20: 2073 656c 662e 6665 7463 685f 6c32 5f6f   self.fetch_l2_o
+0000aa30: 7264 6572 5f62 6f6f 6b28 7061 6972 2c20  rder_book(pair, 
+0000aa40: 3129 0a20 2020 2020 2020 2074 7279 3a0a  1).        try:.
+0000aa50: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000aa60: 6964 6520 3d3d 2027 6275 7927 3a0a 2020  ide == 'buy':.  
+0000aa70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000aa80: 6963 6520 3d20 6f72 6465 7262 6f6f 6b5b  ice = orderbook[
+0000aa90: 2761 736b 7327 5d5b 305d 5b30 5d0a 2020  'asks'][0][0].  
+0000aaa0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000aab0: 206c 696d 6974 202a 2028 3120 2d20 6f66   limit * (1 - of
+0000aac0: 6673 6574 2920 3e3d 2070 7269 6365 3a0a  fset) >= price:.
+0000aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aae0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+0000aaf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000ab00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ab10: 2020 7072 6963 6520 3d20 6f72 6465 7262    price = orderb
+0000ab20: 6f6f 6b5b 2762 6964 7327 5d5b 305d 5b30  ook['bids'][0][0
+0000ab30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000ab40: 2020 6966 206c 696d 6974 202a 2028 3120    if limit * (1 
+0000ab50: 2b20 6f66 6673 6574 2920 3c3d 2070 7269  + offset) <= pri
+0000ab60: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000ab70: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+0000ab80: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
+0000ab90: 7074 2049 6e64 6578 4572 726f 723a 0a20  pt IndexError:. 
+0000aba0: 2020 2020 2020 2020 2020 2023 2049 676e             # Ign
+0000abb0: 6f72 6520 656d 7074 7920 6f72 6465 7262  ore empty orderb
+0000abc0: 6f6f 6b73 2077 6865 6e20 6669 6c6c 696e  ooks when fillin
+0000abd0: 6720 2d20 6361 6e20 6265 2066 696c 6c65  g - can be fille
+0000abe0: 6420 7769 7468 2074 6865 206e 6578 7420  d with the next 
+0000abf0: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
+0000ac00: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000ac10: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000ac20: 0a0a 2020 2020 6465 6620 6368 6563 6b5f  ..    def check_
+0000ac30: 6472 795f 6c69 6d69 745f 6f72 6465 725f  dry_limit_order_
+0000ac40: 6669 6c6c 6564 280a 2020 2020 2020 2020  filled(.        
+0000ac50: 2020 2020 7365 6c66 2c20 6f72 6465 723a      self, order:
+0000ac60: 2044 6963 745b 7374 722c 2041 6e79 5d2c   Dict[str, Any],
+0000ac70: 2069 6d6d 6564 6961 7465 3a20 626f 6f6c   immediate: bool
+0000ac80: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000ac90: 2020 2020 2020 6f72 6465 7262 6f6f 6b3a        orderbook:
+0000aca0: 204f 7074 696f 6e61 6c5b 4f72 6465 7242   Optional[OrderB
+0000acb0: 6f6f 6b5d 203d 204e 6f6e 6529 202d 3e20  ook] = None) -> 
+0000acc0: 4469 6374 5b73 7472 2c20 416e 795d 3a0a  Dict[str, Any]:.
+0000acd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ace0: 2020 2020 4368 6563 6b20 6472 792d 7275      Check dry-ru
+0000acf0: 6e20 6c69 6d69 7420 6f72 6465 7220 6669  n limit order fi
+0000ad00: 6c6c 2061 6e64 2075 7064 6174 6520 6665  ll and update fe
+0000ad10: 6520 2869 6620 6974 2066 696c 6c65 6429  e (if it filled)
+0000ad20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000ad30: 2020 2020 2020 6966 2028 6f72 6465 725b        if (order[
+0000ad40: 2773 7461 7475 7327 5d20 213d 2022 636c  'status'] != "cl
+0000ad50: 6f73 6564 220a 2020 2020 2020 2020 2020  osed".          
+0000ad60: 2020 2020 2020 616e 6420 6f72 6465 725b        and order[
+0000ad70: 2774 7970 6527 5d20 696e 205b 226c 696d  'type'] in ["lim
+0000ad80: 6974 225d 0a20 2020 2020 2020 2020 2020  it"].           
+0000ad90: 2020 2020 2061 6e64 206e 6f74 206f 7264       and not ord
+0000ada0: 6572 2e67 6574 2827 6674 5f6f 7264 6572  er.get('ft_order
+0000adb0: 5f74 7970 6527 2929 3a0a 2020 2020 2020  _type')):.      
+0000adc0: 2020 2020 2020 7061 6972 203d 206f 7264        pair = ord
+0000add0: 6572 5b27 7379 6d62 6f6c 275d 0a20 2020  er['symbol'].   
+0000ade0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000adf0: 2e5f 6472 795f 6973 5f70 7269 6365 5f63  ._dry_is_price_c
+0000ae00: 726f 7373 6564 2870 6169 722c 206f 7264  rossed(pair, ord
+0000ae10: 6572 5b27 7369 6465 275d 2c20 6f72 6465  er['side'], orde
+0000ae20: 725b 2770 7269 6365 275d 2c20 6f72 6465  r['price'], orde
+0000ae30: 7262 6f6f 6b29 3a0a 2020 2020 2020 2020  rbook):.        
+0000ae40: 2020 2020 2020 2020 6f72 6465 722e 7570          order.up
+0000ae50: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
+0000ae60: 2020 2020 2020 2020 2020 2027 7374 6174             'stat
+0000ae70: 7573 273a 2027 636c 6f73 6564 272c 0a20  us': 'closed',. 
+0000ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae90: 2020 2027 6669 6c6c 6564 273a 206f 7264     'filled': ord
+0000aea0: 6572 5b27 616d 6f75 6e74 275d 2c0a 2020  er['amount'],.  
+0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aec0: 2020 2772 656d 6169 6e69 6e67 273a 2030    'remaining': 0
+0000aed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000aee0: 2020 7d29 0a0a 2020 2020 2020 2020 2020    })..          
+0000aef0: 2020 2020 2020 7365 6c66 2e61 6464 5f64        self.add_d
+0000af00: 7279 5f6f 7264 6572 5f66 6565 280a 2020  ry_order_fee(.  
+0000af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af20: 2020 7061 6972 2c0a 2020 2020 2020 2020    pair,.        
+0000af30: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000af40: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000af50: 2020 2020 2020 2027 7461 6b65 7227 2069         'taker' i
+0000af60: 6620 696d 6d65 6469 6174 6520 656c 7365  f immediate else
+0000af70: 2027 6d61 6b65 7227 2c0a 2020 2020 2020   'maker',.      
+0000af80: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+0000af90: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
+0000afa0: 720a 0a20 2020 2064 6566 2066 6574 6368  r..    def fetch
+0000afb0: 5f64 7279 5f72 756e 5f6f 7264 6572 2873  _dry_run_order(s
+0000afc0: 656c 662c 206f 7264 6572 5f69 6429 202d  elf, order_id) -
+0000afd0: 3e20 4469 6374 5b73 7472 2c20 416e 795d  > Dict[str, Any]
+0000afe0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000aff0: 2020 2020 2020 5265 7475 726e 2064 7279        Return dry
+0000b000: 2d72 756e 206f 7264 6572 0a20 2020 2020  -run order.     
+0000b010: 2020 204f 6e6c 7920 6361 6c6c 2069 6620     Only call if 
+0000b020: 7275 6e6e 696e 6720 696e 2064 7279 2d72  running in dry-r
+0000b030: 756e 206d 6f64 652e 0a20 2020 2020 2020  un mode..       
+0000b040: 2022 2222 0a20 2020 2020 2020 2074 7279   """.        try
+0000b050: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+0000b060: 6465 7220 3d20 7365 6c66 2e5f 6472 795f  der = self._dry_
+0000b070: 7275 6e5f 6f70 656e 5f6f 7264 6572 735b  run_open_orders[
+0000b080: 6f72 6465 725f 6964 5d0a 2020 2020 2020  order_id].      
+0000b090: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000b0a0: 6c66 2e63 6865 636b 5f64 7279 5f6c 696d  lf.check_dry_lim
+0000b0b0: 6974 5f6f 7264 6572 5f66 696c 6c65 6428  it_order_filled(
+0000b0c0: 6f72 6465 7229 0a20 2020 2020 2020 2020  order).         
+0000b0d0: 2020 2072 6574 7572 6e20 6f72 6465 720a     return order.
+0000b0e0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+0000b0f0: 6579 4572 726f 7220 6173 2065 3a0a 2020  eyError as e:.  
+0000b100: 2020 2020 2020 2020 2020 6672 6f6d 2066            from f
+0000b110: 7265 7174 7261 6465 2e70 6572 7369 7374  reqtrade.persist
+0000b120: 656e 6365 2069 6d70 6f72 7420 4f72 6465  ence import Orde
+0000b130: 720a 2020 2020 2020 2020 2020 2020 6f72  r.            or
+0000b140: 6465 7220 3d20 4f72 6465 722e 6f72 6465  der = Order.orde
+0000b150: 725f 6279 5f69 6428 6f72 6465 725f 6964  r_by_id(order_id
+0000b160: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000b170: 206f 7264 6572 3a0a 2020 2020 2020 2020   order:.        
+0000b180: 2020 2020 2020 2020 6363 7874 5f6f 7264          ccxt_ord
+0000b190: 6572 203d 206f 7264 6572 2e74 6f5f 6363  er = order.to_cc
+0000b1a0: 7874 5f6f 626a 6563 7428 7365 6c66 2e5f  xt_object(self._
+0000b1b0: 6674 5f68 6173 5b27 7374 6f70 5f70 7269  ft_has['stop_pri
+0000b1c0: 6365 5f70 6172 616d 275d 290a 2020 2020  ce_param']).    
+0000b1d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b1e0: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
+0000b1f0: 7264 6572 735b 6f72 6465 725f 6964 5d20  rders[order_id] 
+0000b200: 3d20 6363 7874 5f6f 7264 6572 0a20 2020  = ccxt_order.   
+0000b210: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000b220: 7572 6e20 6363 7874 5f6f 7264 6572 0a20  urn ccxt_order. 
+0000b230: 2020 2020 2020 2020 2020 2023 2047 7261             # Gra
+0000b240: 6365 6675 6c6c 7920 6861 6e64 6c65 2065  cefully handle e
+0000b250: 7272 6f72 7320 7769 7468 2064 7279 2d72  rrors with dry-r
+0000b260: 756e 206f 7264 6572 732e 0a20 2020 2020  un orders..     
+0000b270: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
+0000b280: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
+0000b290: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000b2a0: 2020 2020 6627 5472 6965 6420 746f 2067      f'Tried to g
+0000b2b0: 6574 2061 6e20 696e 7661 6c69 6420 6472  et an invalid dr
+0000b2c0: 792d 7275 6e2d 6f72 6465 7220 2869 643a  y-run-order (id:
+0000b2d0: 207b 6f72 6465 725f 6964 7d29 2e20 4d65   {order_id}). Me
+0000b2e0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
+0000b2f0: 6d20 650a 0a20 2020 2023 204f 7264 6572  m e..    # Order
+0000b300: 2068 616e 646c 696e 670a 0a20 2020 2064   handling..    d
+0000b310: 6566 205f 6c65 765f 7072 6570 2873 656c  ef _lev_prep(sel
+0000b320: 662c 2070 6169 723a 2073 7472 2c20 6c65  f, pair: str, le
+0000b330: 7665 7261 6765 3a20 666c 6f61 742c 2073  verage: float, s
+0000b340: 6964 653a 2042 7579 5365 6c6c 2c20 6163  ide: BuySell, ac
+0000b350: 6365 7074 5f66 6169 6c3a 2062 6f6f 6c20  cept_fail: bool 
+0000b360: 3d20 4661 6c73 6529 3a0a 2020 2020 2020  = False):.      
+0000b370: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+0000b380: 675f 6d6f 6465 2021 3d20 5472 6164 696e  g_mode != Tradin
+0000b390: 674d 6f64 652e 5350 4f54 3a0a 2020 2020  gMode.SPOT:.    
+0000b3a0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0000b3b0: 5f6d 6172 6769 6e5f 6d6f 6465 2870 6169  _margin_mode(pai
+0000b3c0: 722c 2073 656c 662e 6d61 7267 696e 5f6d  r, self.margin_m
+0000b3d0: 6f64 652c 2061 6363 6570 745f 6661 696c  ode, accept_fail
+0000b3e0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000b3f0: 6c66 2e5f 7365 745f 6c65 7665 7261 6765  lf._set_leverage
+0000b400: 286c 6576 6572 6167 652c 2070 6169 722c  (leverage, pair,
+0000b410: 2061 6363 6570 745f 6661 696c 290a 0a20   accept_fail).. 
+0000b420: 2020 2064 6566 205f 6765 745f 7061 7261     def _get_para
+0000b430: 6d73 280a 2020 2020 2020 2020 7365 6c66  ms(.        self
+0000b440: 2c0a 2020 2020 2020 2020 7369 6465 3a20  ,.        side: 
+0000b450: 4275 7953 656c 6c2c 0a20 2020 2020 2020  BuySell,.       
+0000b460: 206f 7264 6572 7479 7065 3a20 7374 722c   ordertype: str,
+0000b470: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
+0000b480: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
+0000b490: 2020 7265 6475 6365 4f6e 6c79 3a20 626f    reduceOnly: bo
+0000b4a0: 6f6c 2c0a 2020 2020 2020 2020 7469 6d65  ol,.        time
+0000b4b0: 5f69 6e5f 666f 7263 653a 2073 7472 203d  _in_force: str =
+0000b4c0: 2027 4754 4327 2c0a 2020 2020 2920 2d3e   'GTC',.    ) ->
+0000b4d0: 2044 6963 743a 0a20 2020 2020 2020 2070   Dict:.        p
+0000b4e0: 6172 616d 7320 3d20 7365 6c66 2e5f 7061  arams = self._pa
+0000b4f0: 7261 6d73 2e63 6f70 7928 290a 2020 2020  rams.copy().    
+0000b500: 2020 2020 6966 2074 696d 655f 696e 5f66      if time_in_f
+0000b510: 6f72 6365 2021 3d20 2747 5443 2720 616e  orce != 'GTC' an
+0000b520: 6420 6f72 6465 7274 7970 6520 213d 2027  d ordertype != '
+0000b530: 6d61 726b 6574 273a 0a20 2020 2020 2020  market':.       
+0000b540: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
+0000b550: 7465 287b 2774 696d 6549 6e46 6f72 6365  te({'timeInForce
+0000b560: 273a 2074 696d 655f 696e 5f66 6f72 6365  ': time_in_force
+0000b570: 2e75 7070 6572 2829 7d29 0a20 2020 2020  .upper()}).     
+0000b580: 2020 2069 6620 7265 6475 6365 4f6e 6c79     if reduceOnly
+0000b590: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000b5a0: 7261 6d73 2e75 7064 6174 6528 7b27 7265  rams.update({'re
+0000b5b0: 6475 6365 4f6e 6c79 273a 2054 7275 657d  duceOnly': True}
+0000b5c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000b5d0: 2070 6172 616d 730a 0a20 2020 2064 6566   params..    def
+0000b5e0: 205f 6f72 6465 725f 6e65 6564 735f 7072   _order_needs_pr
+0000b5f0: 6963 6528 7365 6c66 2c20 6f72 6465 7274  ice(self, ordert
+0000b600: 7970 653a 2073 7472 2920 2d3e 2062 6f6f  ype: str) -> boo
+0000b610: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+0000b620: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+0000b630: 6f72 6465 7274 7970 6520 213d 2027 6d61  ordertype != 'ma
+0000b640: 726b 6574 270a 2020 2020 2020 2020 2020  rket'.          
+0000b650: 2020 6f72 2073 656c 662e 5f61 7069 2e6f    or self._api.o
+0000b660: 7074 696f 6e73 2e67 6574 2822 6372 6561  ptions.get("crea
+0000b670: 7465 4d61 726b 6574 4275 794f 7264 6572  teMarketBuyOrder
+0000b680: 5265 7175 6972 6573 5072 6963 6522 2c20  RequiresPrice", 
+0000b690: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0000b6a0: 2020 206f 7220 7365 6c66 2e5f 6674 5f68     or self._ft_h
+0000b6b0: 6173 2e67 6574 2827 6d61 726b 6574 4f72  as.get('marketOr
+0000b6c0: 6465 7252 6571 7569 7265 7350 7269 6365  derRequiresPrice
+0000b6d0: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+0000b6e0: 2020 290a 0a20 2020 2064 6566 2063 7265    )..    def cre
+0000b6f0: 6174 655f 6f72 6465 7228 0a20 2020 2020  ate_order(.     
+0000b700: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0000b710: 202a 2c0a 2020 2020 2020 2020 7061 6972   *,.        pair
+0000b720: 3a20 7374 722c 0a20 2020 2020 2020 206f  : str,.        o
+0000b730: 7264 6572 7479 7065 3a20 7374 722c 0a20  rdertype: str,. 
+0000b740: 2020 2020 2020 2073 6964 653a 2042 7579         side: Buy
+0000b750: 5365 6c6c 2c0a 2020 2020 2020 2020 616d  Sell,.        am
+0000b760: 6f75 6e74 3a20 666c 6f61 742c 0a20 2020  ount: float,.   
+0000b770: 2020 2020 2072 6174 653a 2066 6c6f 6174       rate: float
+0000b780: 2c0a 2020 2020 2020 2020 6c65 7665 7261  ,.        levera
+0000b790: 6765 3a20 666c 6f61 742c 0a20 2020 2020  ge: float,.     
+0000b7a0: 2020 2072 6564 7563 654f 6e6c 793a 2062     reduceOnly: b
+0000b7b0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000b7c0: 2020 2020 2074 696d 655f 696e 5f66 6f72       time_in_for
+0000b7d0: 6365 3a20 7374 7220 3d20 2747 5443 272c  ce: str = 'GTC',
+0000b7e0: 0a20 2020 2029 202d 3e20 4469 6374 3a0a  .    ) -> Dict:.
+0000b7f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000b800: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
+0000b810: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+0000b820: 6472 795f 6f72 6465 7220 3d20 7365 6c66  dry_order = self
+0000b830: 2e63 7265 6174 655f 6472 795f 7275 6e5f  .create_dry_run_
+0000b840: 6f72 6465 7228 0a20 2020 2020 2020 2020  order(.         
+0000b850: 2020 2020 2020 2070 6169 722c 206f 7264         pair, ord
+0000b860: 6572 7479 7065 2c20 7369 6465 2c20 616d  ertype, side, am
+0000b870: 6f75 6e74 2c20 7365 6c66 2e70 7269 6365  ount, self.price
+0000b880: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
+0000b890: 6972 2c20 7261 7465 292c 206c 6576 6572  ir, rate), lever
+0000b8a0: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
+0000b8b0: 2072 6574 7572 6e20 6472 795f 6f72 6465   return dry_orde
+0000b8c0: 720a 0a20 2020 2020 2020 2070 6172 616d  r..        param
+0000b8d0: 7320 3d20 7365 6c66 2e5f 6765 745f 7061  s = self._get_pa
+0000b8e0: 7261 6d73 2873 6964 652c 206f 7264 6572  rams(side, order
+0000b8f0: 7479 7065 2c20 6c65 7665 7261 6765 2c20  type, leverage, 
+0000b900: 7265 6475 6365 4f6e 6c79 2c20 7469 6d65  reduceOnly, time
+0000b910: 5f69 6e5f 666f 7263 6529 0a0a 2020 2020  _in_force)..    
+0000b920: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000b930: 2020 2020 2023 2053 6574 2074 6865 2070       # Set the p
+0000b940: 7265 6369 7369 6f6e 2066 6f72 2061 6d6f  recision for amo
+0000b950: 756e 7420 616e 6420 7072 6963 6528 7261  unt and price(ra
+0000b960: 7465 2920 6173 2061 6363 6570 7465 6420  te) as accepted 
+0000b970: 6279 2074 6865 2065 7863 6861 6e67 650a  by the exchange.
+0000b980: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
+0000b990: 6e74 203d 2073 656c 662e 616d 6f75 6e74  nt = self.amount
+0000b9a0: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
+0000b9b0: 6972 2c20 7365 6c66 2e5f 616d 6f75 6e74  ir, self._amount
+0000b9c0: 5f74 6f5f 636f 6e74 7261 6374 7328 7061  _to_contracts(pa
+0000b9d0: 6972 2c20 616d 6f75 6e74 2929 0a20 2020  ir, amount)).   
+0000b9e0: 2020 2020 2020 2020 206e 6565 6473 5f70           needs_p
+0000b9f0: 7269 6365 203d 2073 656c 662e 5f6f 7264  rice = self._ord
+0000ba00: 6572 5f6e 6565 6473 5f70 7269 6365 286f  er_needs_price(o
+0000ba10: 7264 6572 7479 7065 290a 2020 2020 2020  rdertype).      
+0000ba20: 2020 2020 2020 7261 7465 5f66 6f72 5f6f        rate_for_o
+0000ba30: 7264 6572 203d 2073 656c 662e 7072 6963  rder = self.pric
+0000ba40: 655f 746f 5f70 7265 6369 7369 6f6e 2870  e_to_precision(p
+0000ba50: 6169 722c 2072 6174 6529 2069 6620 6e65  air, rate) if ne
+0000ba60: 6564 735f 7072 6963 6520 656c 7365 204e  eds_price else N
+0000ba70: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+0000ba80: 2069 6620 6e6f 7420 7265 6475 6365 4f6e   if not reduceOn
+0000ba90: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000baa0: 2020 2020 7365 6c66 2e5f 6c65 765f 7072      self._lev_pr
+0000bab0: 6570 2870 6169 722c 206c 6576 6572 6167  ep(pair, leverag
+0000bac0: 652c 2073 6964 6529 0a0a 2020 2020 2020  e, side)..      
+0000bad0: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000bae0: 6c66 2e5f 6170 692e 6372 6561 7465 5f6f  lf._api.create_o
+0000baf0: 7264 6572 280a 2020 2020 2020 2020 2020  rder(.          
+0000bb00: 2020 2020 2020 7061 6972 2c0a 2020 2020        pair,.    
+0000bb10: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000bb20: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
+0000bb30: 2020 2020 2020 2073 6964 652c 0a20 2020         side,.   
+0000bb40: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
+0000bb50: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
+0000bb60: 2020 2020 2072 6174 655f 666f 725f 6f72       rate_for_or
+0000bb70: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
+0000bb80: 2020 2020 2070 6172 616d 732c 0a20 2020       params,.   
+0000bb90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000bba0: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+0000bbb0: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
+0000bbc0: 7365 2827 6372 6561 7465 5f6f 7264 6572  se('create_order
+0000bbd0: 272c 206f 7264 6572 290a 2020 2020 2020  ', order).      
+0000bbe0: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000bbf0: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
+0000bc00: 6374 735f 746f 5f61 6d6f 756e 7428 6f72  cts_to_amount(or
+0000bc10: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000bc20: 2072 6574 7572 6e20 6f72 6465 720a 0a20   return order.. 
+0000bc30: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000bc40: 7874 2e49 6e73 7566 6669 6369 656e 7446  xt.InsufficientF
+0000bc50: 756e 6473 2061 7320 653a 0a20 2020 2020  unds as e:.     
+0000bc60: 2020 2020 2020 2072 6169 7365 2049 6e73         raise Ins
+0000bc70: 7566 6669 6369 656e 7446 756e 6473 4572  ufficientFundsEr
+0000bc80: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000bc90: 2020 2020 2066 2749 6e73 7566 6669 6369       f'Insuffici
+0000bca0: 656e 7420 6675 6e64 7320 746f 2063 7265  ent funds to cre
+0000bcb0: 6174 6520 7b6f 7264 6572 7479 7065 7d20  ate {ordertype} 
+0000bcc0: 7b73 6964 657d 206f 7264 6572 206f 6e20  {side} order on 
+0000bcd0: 6d61 726b 6574 207b 7061 6972 7d2e 2027  market {pair}. '
+0000bce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bcf0: 2066 2754 7269 6564 2074 6f20 7b73 6964   f'Tried to {sid
+0000bd00: 657d 2061 6d6f 756e 7420 7b61 6d6f 756e  e} amount {amoun
+0000bd10: 747d 2061 7420 7261 7465 207b 7261 7465  t} at rate {rate
+0000bd20: 7d2e 270a 2020 2020 2020 2020 2020 2020  }.'.            
+0000bd30: 2020 2020 6627 4d65 7373 6167 653a 207b      f'Message: {
+0000bd40: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0000bd50: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000bd60: 496e 7661 6c69 644f 7264 6572 2061 7320  InvalidOrder as 
+0000bd70: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000bd80: 6169 7365 2049 6e76 616c 6964 4f72 6465  aise InvalidOrde
+0000bd90: 7245 7863 6570 7469 6f6e 280a 2020 2020  rException(.    
+0000bda0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0000bdb0: 756c 6420 6e6f 7420 6372 6561 7465 207b  uld not create {
+0000bdc0: 6f72 6465 7274 7970 657d 207b 7369 6465  ordertype} {side
+0000bdd0: 7d20 6f72 6465 7220 6f6e 206d 6172 6b65  } order on marke
+0000bde0: 7420 7b70 6169 727d 2e20 270a 2020 2020  t {pair}. '.    
+0000bdf0: 2020 2020 2020 2020 2020 2020 6627 5472              f'Tr
+0000be00: 6965 6420 746f 207b 7369 6465 7d20 616d  ied to {side} am
+0000be10: 6f75 6e74 207b 616d 6f75 6e74 7d20 6174  ount {amount} at
+0000be20: 2072 6174 6520 7b72 6174 657d 2e20 270a   rate {rate}. '.
+0000be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be40: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
+0000be50: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000be60: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0000be70: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0000be80: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000be90: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0000bea0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0000beb0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0000bec0: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+0000bed0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0000bee0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0000bef0: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0000bf00: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0000bf10: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0000bf20: 6c64 206e 6f74 2070 6c61 6365 207b 7369  ld not place {si
+0000bf30: 6465 7d20 6f72 6465 7220 6475 6520 746f  de} order due to
+0000bf40: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0000bf50: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0000bf60: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000bf70: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000bf80: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+0000bf90: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000bfa0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+0000bfb0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+0000bfc0: 6d20 650a 0a20 2020 2064 6566 2073 746f  m e..    def sto
+0000bfd0: 706c 6f73 735f 6164 6a75 7374 2873 656c  ploss_adjust(sel
+0000bfe0: 662c 2073 746f 705f 6c6f 7373 3a20 666c  f, stop_loss: fl
+0000bff0: 6f61 742c 206f 7264 6572 3a20 4469 6374  oat, order: Dict
+0000c000: 2c20 7369 6465 3a20 7374 7229 202d 3e20  , side: str) -> 
+0000c010: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+0000c020: 220a 2020 2020 2020 2020 5665 7269 6679  ".        Verify
+0000c030: 2073 746f 705f 6c6f 7373 2061 6761 696e   stop_loss again
+0000c040: 7374 2073 746f 706c 6f73 732d 6f72 6465  st stoploss-orde
+0000c050: 7220 7661 6c75 6520 286c 696d 6974 206f  r value (limit o
+0000c060: 7220 7072 6963 6529 0a20 2020 2020 2020  r price).       
+0000c070: 2052 6574 7572 6e73 2054 7275 6520 6966   Returns True if
+0000c080: 2061 646a 7573 746d 656e 7420 6973 206e   adjustment is n
+0000c090: 6563 6573 7361 7279 2e0a 2020 2020 2020  ecessary..      
+0000c0a0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000c0b0: 206e 6f74 2073 656c 662e 5f66 745f 6861   not self._ft_ha
+0000c0c0: 732e 6765 7428 2773 746f 706c 6f73 735f  s.get('stoploss_
+0000c0d0: 6f6e 5f65 7863 6861 6e67 6527 293a 0a20  on_exchange'):. 
+0000c0e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c0f0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0000c100: 7074 696f 6e28 6622 7374 6f70 6c6f 7373  ption(f"stoploss
+0000c110: 2069 7320 6e6f 7420 696d 706c 656d 656e   is not implemen
+0000c120: 7465 6420 666f 7220 7b73 656c 662e 6e61  ted for {self.na
+0000c130: 6d65 7d2e 2229 0a20 2020 2020 2020 2070  me}.").        p
+0000c140: 7269 6365 5f70 6172 616d 203d 2073 656c  rice_param = sel
+0000c150: 662e 5f66 745f 6861 735b 2773 746f 705f  f._ft_has['stop_
+0000c160: 7072 6963 655f 7061 7261 6d27 5d0a 2020  price_param'].  
+0000c170: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+0000c180: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000c190: 2e67 6574 2870 7269 6365 5f70 6172 616d  .get(price_param
+0000c1a0: 2c20 4e6f 6e65 2920 6973 204e 6f6e 650a  , None) is None.
+0000c1b0: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
+0000c1c0: 2873 6964 6520 3d3d 2022 7365 6c6c 2220  (side == "sell" 
+0000c1d0: 616e 6420 7374 6f70 5f6c 6f73 7320 3e20  and stop_loss > 
+0000c1e0: 666c 6f61 7428 6f72 6465 725b 7072 6963  float(order[pric
+0000c1f0: 655f 7061 7261 6d5d 2929 206f 720a 2020  e_param])) or.  
+0000c200: 2020 2020 2020 2020 2020 2020 2020 2873                (s
+0000c210: 6964 6520 3d3d 2022 6275 7922 2061 6e64  ide == "buy" and
+0000c220: 2073 746f 705f 6c6f 7373 203c 2066 6c6f   stop_loss < flo
+0000c230: 6174 286f 7264 6572 5b70 7269 6365 5f70  at(order[price_p
+0000c240: 6172 616d 5d29 2929 0a20 2020 2020 2020  aram]))).       
+0000c250: 2029 0a0a 2020 2020 6465 6620 5f67 6574   )..    def _get
+0000c260: 5f73 746f 705f 6f72 6465 725f 7479 7065  _stop_order_type
+0000c270: 2873 656c 662c 2075 7365 725f 6f72 6465  (self, user_orde
+0000c280: 725f 7479 7065 2920 2d3e 2054 7570 6c65  r_type) -> Tuple
+0000c290: 5b73 7472 2c20 7374 725d 3a0a 0a20 2020  [str, str]:..   
+0000c2a0: 2020 2020 2061 7661 696c 6162 6c65 5f6f       available_o
+0000c2b0: 7264 6572 5f54 7970 6573 3a20 4469 6374  rder_Types: Dict
+0000c2c0: 5b73 7472 2c20 7374 725d 203d 2073 656c  [str, str] = sel
+0000c2d0: 662e 5f66 745f 6861 735b 2273 746f 706c  f._ft_has["stopl
+0000c2e0: 6f73 735f 6f72 6465 725f 7479 7065 7322  oss_order_types"
+0000c2f0: 5d0a 0a20 2020 2020 2020 2069 6620 7573  ]..        if us
+0000c300: 6572 5f6f 7264 6572 5f74 7970 6520 696e  er_order_type in
+0000c310: 2061 7661 696c 6162 6c65 5f6f 7264 6572   available_order
+0000c320: 5f54 7970 6573 2e6b 6579 7328 293a 0a20  _Types.keys():. 
+0000c330: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000c340: 7479 7065 203d 2061 7661 696c 6162 6c65  type = available
+0000c350: 5f6f 7264 6572 5f54 7970 6573 5b75 7365  _order_Types[use
+0000c360: 725f 6f72 6465 725f 7479 7065 5d0a 2020  r_order_type].  
+0000c370: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000c380: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+0000c390: 6973 6520 7069 636b 206f 6e6c 7920 6f6e  ise pick only on
+0000c3a0: 6520 6176 6169 6c61 626c 650a 2020 2020  e available.    
+0000c3b0: 2020 2020 2020 2020 6f72 6465 7274 7970          ordertyp
+0000c3c0: 6520 3d20 6c69 7374 2861 7661 696c 6162  e = list(availab
+0000c3d0: 6c65 5f6f 7264 6572 5f54 7970 6573 2e76  le_order_Types.v
+0000c3e0: 616c 7565 7328 2929 5b30 5d0a 2020 2020  alues())[0].    
+0000c3f0: 2020 2020 2020 2020 7573 6572 5f6f 7264          user_ord
+0000c400: 6572 5f74 7970 6520 3d20 6c69 7374 2861  er_type = list(a
+0000c410: 7661 696c 6162 6c65 5f6f 7264 6572 5f54  vailable_order_T
+0000c420: 7970 6573 2e6b 6579 7328 2929 5b30 5d0a  ypes.keys())[0].
+0000c430: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0000c440: 7264 6572 7479 7065 2c20 7573 6572 5f6f  rdertype, user_o
+0000c450: 7264 6572 5f74 7970 650a 0a20 2020 2064  rder_type..    d
+0000c460: 6566 205f 6765 745f 7374 6f70 5f6c 696d  ef _get_stop_lim
+0000c470: 6974 5f72 6174 6528 7365 6c66 2c20 7374  it_rate(self, st
+0000c480: 6f70 5f70 7269 6365 3a20 666c 6f61 742c  op_price: float,
+0000c490: 206f 7264 6572 5f74 7970 6573 3a20 4469   order_types: Di
+0000c4a0: 6374 2c20 7369 6465 3a20 7374 7229 202d  ct, side: str) -
+0000c4b0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+0000c4c0: 2023 204c 696d 6974 2070 7269 6365 2074   # Limit price t
+0000c4d0: 6872 6573 686f 6c64 3a20 4173 206c 696d  hreshold: As lim
+0000c4e0: 6974 2070 7269 6365 2073 686f 756c 6420  it price should 
+0000c4f0: 616c 7761 7973 2062 6520 6265 6c6f 7720  always be below 
+0000c500: 7374 6f70 2d70 7269 6365 0a20 2020 2020  stop-price.     
+0000c510: 2020 206c 696d 6974 5f70 7269 6365 5f70     limit_price_p
+0000c520: 6374 203d 206f 7264 6572 5f74 7970 6573  ct = order_types
+0000c530: 2e67 6574 2827 7374 6f70 6c6f 7373 5f6f  .get('stoploss_o
+0000c540: 6e5f 6578 6368 616e 6765 5f6c 696d 6974  n_exchange_limit
+0000c550: 5f72 6174 696f 272c 2030 2e39 3929 0a20  _ratio', 0.99). 
+0000c560: 2020 2020 2020 2069 6620 7369 6465 203d         if side =
+0000c570: 3d20 2273 656c 6c22 3a0a 2020 2020 2020  = "sell":.      
+0000c580: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
+0000c590: 203d 2073 746f 705f 7072 6963 6520 2a20   = stop_price * 
+0000c5a0: 6c69 6d69 745f 7072 6963 655f 7063 740a  limit_price_pct.
+0000c5b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000c5c0: 2020 2020 2020 2020 2020 6c69 6d69 745f            limit_
+0000c5d0: 7261 7465 203d 2073 746f 705f 7072 6963  rate = stop_pric
+0000c5e0: 6520 2a20 2832 202d 206c 696d 6974 5f70  e * (2 - limit_p
+0000c5f0: 7269 6365 5f70 6374 290a 0a20 2020 2020  rice_pct)..     
+0000c600: 2020 2062 6164 5f73 746f 705f 7072 6963     bad_stop_pric
+0000c610: 6520 3d20 2828 7374 6f70 5f70 7269 6365  e = ((stop_price
+0000c620: 203c 206c 696d 6974 5f72 6174 6529 2069   < limit_rate) i
+0000c630: 6620 7369 6465 203d 3d0a 2020 2020 2020  f side ==.      
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 2020 2020 2273 656c 6c22 2065 6c73 6520      "sell" else 
+0000c660: 2873 746f 705f 7072 6963 6520 3e20 6c69  (stop_price > li
+0000c670: 6d69 745f 7261 7465 2929 0a20 2020 2020  mit_rate)).     
+0000c680: 2020 2023 2045 6e73 7572 6520 7261 7465     # Ensure rate
+0000c690: 2069 7320 6c65 7373 2074 6861 6e20 7374   is less than st
+0000c6a0: 6f70 2070 7269 6365 0a20 2020 2020 2020  op price.       
+0000c6b0: 2069 6620 6261 645f 7374 6f70 5f70 7269   if bad_stop_pri
+0000c6c0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+0000c6d0: 2320 5468 6973 2063 616e 2066 6f72 2065  # This can for e
+0000c6e0: 7861 6d70 6c65 2068 6170 7065 6e20 6966  xample happen if
+0000c6f0: 2074 6865 2073 746f 7020 2f20 6c69 7175   the stop / liqu
+0000c700: 6964 6174 696f 6e20 7072 6963 6520 6973  idation price is
+0000c710: 2073 6574 2074 6f20 300a 2020 2020 2020   set to 0.      
+0000c720: 2020 2020 2020 2320 5768 6963 6820 6973        # Which is
+0000c730: 2070 6f73 7369 626c 6520 6966 2061 206d   possible if a m
+0000c740: 6172 6b65 742d 6f72 6465 7220 636c 6f73  arket-order clos
+0000c750: 6573 2072 6967 6874 2061 7761 792e 0a20  es right away.. 
+0000c760: 2020 2020 2020 2020 2020 2023 2054 6865             # The
+0000c770: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
+0000c780: 6570 7469 6f6e 2077 696c 6c20 6275 6262  eption will bubb
+0000c790: 6c65 2075 7020 746f 2065 7869 745f 706f  le up to exit_po
+0000c7a0: 7369 7469 6f6e 732c 2077 6865 7265 2069  sitions, where i
+0000c7b0: 7420 7769 6c6c 2062 650a 2020 2020 2020  t will be.      
+0000c7c0: 2020 2020 2020 2320 6861 6e64 6c65 6420        # handled 
+0000c7d0: 6772 6163 6566 756c 6c79 2e0a 2020 2020  gracefully..    
+0000c7e0: 2020 2020 2020 2020 7261 6973 6520 496e          raise In
+0000c7f0: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
+0000c800: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0000c810: 2020 2020 2022 496e 2073 746f 706c 6f73       "In stoplos
+0000c820: 7320 6c69 6d69 7420 6f72 6465 722c 2073  s limit order, s
+0000c830: 746f 7020 7072 6963 6520 7368 6f75 6c64  top price should
+0000c840: 2062 6520 6d6f 7265 2074 6861 6e20 6c69   be more than li
+0000c850: 6d69 7420 7072 6963 652e 2022 0a20 2020  mit price. ".   
+0000c860: 2020 2020 2020 2020 2020 2020 2066 2253               f"S
+0000c870: 746f 7020 7072 6963 653a 207b 7374 6f70  top price: {stop
+0000c880: 5f70 7269 6365 7d2c 204c 696d 6974 2070  _price}, Limit p
+0000c890: 7269 6365 3a20 7b6c 696d 6974 5f72 6174  rice: {limit_rat
+0000c8a0: 657d 2c20 220a 2020 2020 2020 2020 2020  e}, ".          
+0000c8b0: 2020 2020 2020 6622 4c69 6d69 7420 5072        f"Limit Pr
+0000c8c0: 6963 6520 7063 743a 207b 6c69 6d69 745f  ice pct: {limit_
+0000c8d0: 7072 6963 655f 7063 747d 220a 2020 2020  price_pct}".    
+0000c8e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000c8f0: 2020 2020 2020 7265 7475 726e 206c 696d        return lim
+0000c900: 6974 5f72 6174 650a 0a20 2020 2064 6566  it_rate..    def
+0000c910: 205f 6765 745f 7374 6f70 5f70 6172 616d   _get_stop_param
+0000c920: 7328 7365 6c66 2c20 7369 6465 3a20 4275  s(self, side: Bu
+0000c930: 7953 656c 6c2c 206f 7264 6572 7479 7065  ySell, ordertype
+0000c940: 3a20 7374 722c 2073 746f 705f 7072 6963  : str, stop_pric
+0000c950: 653a 2066 6c6f 6174 2920 2d3e 2044 6963  e: float) -> Dic
+0000c960: 743a 0a20 2020 2020 2020 2070 6172 616d  t:.        param
+0000c970: 7320 3d20 7365 6c66 2e5f 7061 7261 6d73  s = self._params
+0000c980: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
+0000c990: 2320 5665 7269 6679 2069 6620 7374 6f70  # Verify if stop
+0000c9a0: 5072 6963 6520 776f 726b 7320 666f 7220  Price works for 
+0000c9b0: 796f 7572 2065 7863 6861 6e67 652c 2065  your exchange, e
+0000c9c0: 6c73 6520 636f 6e66 6967 7572 6520 7374  lse configure st
+0000c9d0: 6f70 5f70 7269 6365 5f70 6172 616d 0a20  op_price_param. 
+0000c9e0: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
+0000c9f0: 6461 7465 287b 7365 6c66 2e5f 6674 5f68  date({self._ft_h
+0000ca00: 6173 5b27 7374 6f70 5f70 7269 6365 5f70  as['stop_price_p
+0000ca10: 6172 616d 275d 3a20 7374 6f70 5f70 7269  aram']: stop_pri
+0000ca20: 6365 7d29 0a20 2020 2020 2020 2072 6574  ce}).        ret
+0000ca30: 7572 6e20 7061 7261 6d73 0a0a 2020 2020  urn params..    
+0000ca40: 4072 6574 7269 6572 2872 6574 7269 6573  @retrier(retries
+0000ca50: 3d30 290a 2020 2020 6465 6620 6372 6561  =0).    def crea
+0000ca60: 7465 5f73 746f 706c 6f73 7328 7365 6c66  te_stoploss(self
+0000ca70: 2c20 7061 6972 3a20 7374 722c 2061 6d6f  , pair: str, amo
+0000ca80: 756e 743a 2066 6c6f 6174 2c20 7374 6f70  unt: float, stop
+0000ca90: 5f70 7269 6365 3a20 666c 6f61 742c 206f  _price: float, o
+0000caa0: 7264 6572 5f74 7970 6573 3a20 4469 6374  rder_types: Dict
+0000cab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000cac0: 2020 2020 2020 2020 2020 7369 6465 3a20            side: 
+0000cad0: 4275 7953 656c 6c2c 206c 6576 6572 6167  BuySell, leverag
+0000cae0: 653a 2066 6c6f 6174 2920 2d3e 2044 6963  e: float) -> Dic
+0000caf0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+0000cb00: 2020 2020 2020 2063 7265 6174 6573 2061         creates a
+0000cb10: 2073 746f 706c 6f73 7320 6f72 6465 722e   stoploss order.
+0000cb20: 0a20 2020 2020 2020 2072 6571 7569 7265  .        require
+0000cb30: 7320 605f 6674 5f68 6173 5b27 7374 6f70  s `_ft_has['stop
+0000cb40: 6c6f 7373 5f6f 7264 6572 5f74 7970 6573  loss_order_types
+0000cb50: 275d 6020 746f 2062 6520 7365 7420 6173  ']` to be set as
+0000cb60: 2061 2064 6963 7420 6d61 7070 696e 6720   a dict mapping 
+0000cb70: 6c69 6d69 7420 616e 6420 6d61 726b 6574  limit and market
+0000cb80: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0000cb90: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+0000cba0: 6720 6578 6368 616e 6765 2074 7970 652e  g exchange type.
+0000cbb0: 0a0a 2020 2020 2020 2020 5468 6520 7072  ..        The pr
+0000cbc0: 6563 6973 6520 6f72 6465 7274 7970 6520  ecise ordertype 
+0000cbd0: 6973 2064 6574 6572 6d69 6e65 6420 6279  is determined by
+0000cbe0: 2074 6865 206f 7264 6572 5f74 7970 6573   the order_types
+0000cbf0: 2064 6963 7420 6f72 2065 7863 6861 6e67   dict or exchang
+0000cc00: 6520 6465 6661 756c 742e 0a0a 2020 2020  e default...    
+0000cc10: 2020 2020 5468 6520 6578 6365 7074 696f      The exceptio
+0000cc20: 6e20 6265 6c6f 7720 7368 6f75 6c64 206e  n below should n
+0000cc30: 6576 6572 2072 6169 7365 2c20 7369 6e63  ever raise, sinc
+0000cc40: 6520 7765 2064 6973 616c 6c6f 770a 2020  e we disallow.  
+0000cc50: 2020 2020 2020 7374 6172 7469 6e67 2074        starting t
+0000cc60: 6865 2062 6f74 2069 6e20 7661 6c69 6461  he bot in valida
+0000cc70: 7465 5f6f 7264 6572 7479 7065 7328 290a  te_ordertypes().
+0000cc80: 0a20 2020 2020 2020 2054 6869 7320 6d61  .        This ma
+0000cc90: 7920 776f 726b 2077 6974 6820 6120 6c69  y work with a li
+0000cca0: 6d69 7465 6420 6e75 6d62 6572 206f 6620  mited number of 
+0000ccb0: 6f74 6865 7220 6578 6368 616e 6765 732c  other exchanges,
+0000ccc0: 2062 7574 2063 6f72 7265 6374 2077 6f72   but correct wor
+0000ccd0: 6b69 6e67 0a20 2020 2020 2020 2020 2020  king.           
+0000cce0: 206e 6565 6473 2074 6f20 6265 2074 6573   needs to be tes
+0000ccf0: 7465 6420 696e 6469 7669 6475 616c 6c79  ted individually
+0000cd00: 2e0a 2020 2020 2020 2020 5741 524e 494e  ..        WARNIN
+0000cd10: 473a 2073 6574 7469 6e67 2060 7374 6f70  G: setting `stop
+0000cd20: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
+0000cd30: 6020 746f 2054 7275 6520 7769 6c6c 204e  ` to True will N
+0000cd40: 4f54 2061 7574 6f2d 656e 6162 6c65 2073  OT auto-enable s
+0000cd50: 746f 706c 6f73 7320 6f6e 2065 7863 6861  toploss on excha
+0000cd60: 6e67 652e 0a20 2020 2020 2020 2020 2020  nge..           
+0000cd70: 2060 7374 6f70 6c6f 7373 5f61 646a 7573   `stoploss_adjus
+0000cd80: 7460 206d 7573 7420 7374 696c 6c20 6265  t` must still be
+0000cd90: 2069 6d70 6c65 6d65 6e74 6564 2066 6f72   implemented for
+0000cda0: 2074 6869 7320 746f 2077 6f72 6b2e 0a20   this to work.. 
+0000cdb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000cdc0: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+0000cdd0: 6674 5f68 6173 5b27 7374 6f70 6c6f 7373  ft_has['stoploss
+0000cde0: 5f6f 6e5f 6578 6368 616e 6765 275d 3a0a  _on_exchange']:.
+0000cdf0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000ce00: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+0000ce10: 6570 7469 6f6e 2866 2273 746f 706c 6f73  eption(f"stoplos
+0000ce20: 7320 6973 206e 6f74 2069 6d70 6c65 6d65  s is not impleme
+0000ce30: 6e74 6564 2066 6f72 207b 7365 6c66 2e6e  nted for {self.n
+0000ce40: 616d 657d 2e22 290a 0a20 2020 2020 2020  ame}.")..       
+0000ce50: 2075 7365 725f 6f72 6465 725f 7479 7065   user_order_type
+0000ce60: 203d 206f 7264 6572 5f74 7970 6573 2e67   = order_types.g
+0000ce70: 6574 2827 7374 6f70 6c6f 7373 272c 2027  et('stoploss', '
+0000ce80: 6d61 726b 6574 2729 0a20 2020 2020 2020  market').       
+0000ce90: 206f 7264 6572 7479 7065 2c20 7573 6572   ordertype, user
+0000cea0: 5f6f 7264 6572 5f74 7970 6520 3d20 7365  _order_type = se
+0000ceb0: 6c66 2e5f 6765 745f 7374 6f70 5f6f 7264  lf._get_stop_ord
+0000cec0: 6572 5f74 7970 6528 7573 6572 5f6f 7264  er_type(user_ord
+0000ced0: 6572 5f74 7970 6529 0a20 2020 2020 2020  er_type).       
+0000cee0: 2072 6f75 6e64 5f6d 6f64 6520 3d20 524f   round_mode = RO
+0000cef0: 554e 445f 444f 574e 2069 6620 7369 6465  UND_DOWN if side
+0000cf00: 203d 3d20 2762 7579 2720 656c 7365 2052   == 'buy' else R
+0000cf10: 4f55 4e44 5f55 500a 2020 2020 2020 2020  OUND_UP.        
+0000cf20: 7374 6f70 5f70 7269 6365 5f6e 6f72 6d20  stop_price_norm 
+0000cf30: 3d20 7365 6c66 2e70 7269 6365 5f74 6f5f  = self.price_to_
+0000cf40: 7072 6563 6973 696f 6e28 7061 6972 2c20  precision(pair, 
+0000cf50: 7374 6f70 5f70 7269 6365 2c20 726f 756e  stop_price, roun
+0000cf60: 6469 6e67 5f6d 6f64 653d 726f 756e 645f  ding_mode=round_
+0000cf70: 6d6f 6465 290a 2020 2020 2020 2020 6c69  mode).        li
+0000cf80: 6d69 745f 7261 7465 203d 204e 6f6e 650a  mit_rate = None.
+0000cf90: 2020 2020 2020 2020 6966 2075 7365 725f          if user_
+0000cfa0: 6f72 6465 725f 7479 7065 203d 3d20 276c  order_type == 'l
+0000cfb0: 696d 6974 273a 0a20 2020 2020 2020 2020  imit':.         
+0000cfc0: 2020 206c 696d 6974 5f72 6174 6520 3d20     limit_rate = 
+0000cfd0: 7365 6c66 2e5f 6765 745f 7374 6f70 5f6c  self._get_stop_l
+0000cfe0: 696d 6974 5f72 6174 6528 7374 6f70 5f70  imit_rate(stop_p
+0000cff0: 7269 6365 2c20 6f72 6465 725f 7479 7065  rice, order_type
+0000d000: 732c 2073 6964 6529 0a20 2020 2020 2020  s, side).       
+0000d010: 2020 2020 206c 696d 6974 5f72 6174 6520       limit_rate 
+0000d020: 3d20 7365 6c66 2e70 7269 6365 5f74 6f5f  = self.price_to_
+0000d030: 7072 6563 6973 696f 6e28 7061 6972 2c20  precision(pair, 
+0000d040: 6c69 6d69 745f 7261 7465 2c20 726f 756e  limit_rate, roun
+0000d050: 6469 6e67 5f6d 6f64 653d 726f 756e 645f  ding_mode=round_
+0000d060: 6d6f 6465 290a 0a20 2020 2020 2020 2069  mode)..        i
+0000d070: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
+0000d080: 6472 795f 7275 6e27 5d3a 0a20 2020 2020  dry_run']:.     
+0000d090: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
+0000d0a0: 203d 2073 656c 662e 6372 6561 7465 5f64   = self.create_d
+0000d0b0: 7279 5f72 756e 5f6f 7264 6572 280a 2020  ry_run_order(.  
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000d0d0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+0000d0e0: 2020 2020 6f72 6465 7274 7970 652c 0a20      ordertype,. 
+0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d100: 6964 652c 0a20 2020 2020 2020 2020 2020  ide,.           
+0000d110: 2020 2020 2061 6d6f 756e 742c 0a20 2020       amount,.   
+0000d120: 2020 2020 2020 2020 2020 2020 2073 746f               sto
+0000d130: 705f 7072 6963 655f 6e6f 726d 2c0a 2020  p_price_norm,.  
+0000d140: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0000d150: 6f70 5f6c 6f73 733d 5472 7565 2c0a 2020  op_loss=True,.  
+0000d160: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+0000d170: 7665 7261 6765 3d6c 6576 6572 6167 652c  verage=leverage,
+0000d180: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d1a0: 6e20 6472 795f 6f72 6465 720a 0a20 2020  n dry_order..   
+0000d1b0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000d1c0: 2020 2020 2020 7061 7261 6d73 203d 2073        params = s
+0000d1d0: 656c 662e 5f67 6574 5f73 746f 705f 7061  elf._get_stop_pa
+0000d1e0: 7261 6d73 2873 6964 653d 7369 6465 2c20  rams(side=side, 
+0000d1f0: 6f72 6465 7274 7970 653d 6f72 6465 7274  ordertype=ordert
+0000d200: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
 0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 2020 2020 2020 2020 7374 6f70 5f70 7269          stop_pri
-0000d230: 6365 3d73 746f 705f 7072 6963 655f 6e6f  ce=stop_price_no
-0000d240: 726d 290a 2020 2020 2020 2020 2020 2020  rm).            
-0000d250: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
-0000d260: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
-0000d270: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
-0000d280: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0000d290: 616d 735b 2772 6564 7563 654f 6e6c 7927  ams['reduceOnly'
-0000d2a0: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-0000d2b0: 2020 2020 2020 2020 2069 6620 2773 746f           if 'sto
-0000d2c0: 706c 6f73 735f 7072 6963 655f 7479 7065  ploss_price_type
-0000d2d0: 2720 696e 206f 7264 6572 5f74 7970 6573  ' in order_types
-0000d2e0: 2061 6e64 2027 7374 6f70 5f70 7269 6365   and 'stop_price
-0000d2f0: 5f74 7970 655f 6669 656c 6427 2069 6e20  _type_field' in 
-0000d300: 7365 6c66 2e5f 6674 5f68 6173 3a0a 2020  self._ft_has:.  
-0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d320: 2020 7072 6963 655f 7479 7065 203d 2073    price_type = s
-0000d330: 656c 662e 5f66 745f 6861 735b 2773 746f  elf._ft_has['sto
-0000d340: 705f 7072 6963 655f 7479 7065 5f76 616c  p_price_type_val
-0000d350: 7565 5f6d 6170 7069 6e67 275d 5b0a 2020  ue_mapping'][.  
-0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d370: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
-0000d380: 732e 6765 7428 2773 746f 706c 6f73 735f  s.get('stoploss_
-0000d390: 7072 6963 655f 7479 7065 272c 2050 7269  price_type', Pri
-0000d3a0: 6365 5479 7065 2e4c 4153 5429 5d0a 2020  ceType.LAST)].  
-0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3c0: 2020 7061 7261 6d73 5b73 656c 662e 5f66    params[self._f
-0000d3d0: 745f 6861 735b 2773 746f 705f 7072 6963  t_has['stop_pric
-0000d3e0: 655f 7479 7065 5f66 6965 6c64 275d 5d20  e_type_field']] 
-0000d3f0: 3d20 7072 6963 655f 7479 7065 0a0a 2020  = price_type..  
-0000d400: 2020 2020 2020 2020 2020 616d 6f75 6e74            amount
-0000d410: 203d 2073 656c 662e 616d 6f75 6e74 5f74   = self.amount_t
-0000d420: 6f5f 7072 6563 6973 696f 6e28 7061 6972  o_precision(pair
-0000d430: 2c20 7365 6c66 2e5f 616d 6f75 6e74 5f74  , self._amount_t
-0000d440: 6f5f 636f 6e74 7261 6374 7328 7061 6972  o_contracts(pair
-0000d450: 2c20 616d 6f75 6e74 2929 0a0a 2020 2020  , amount))..    
-0000d460: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
-0000d470: 765f 7072 6570 2870 6169 722c 206c 6576  v_prep(pair, lev
-0000d480: 6572 6167 652c 2073 6964 652c 2061 6363  erage, side, acc
-0000d490: 6570 745f 6661 696c 3d54 7275 6529 0a20  ept_fail=True). 
-0000d4a0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000d4b0: 203d 2073 656c 662e 5f61 7069 2e63 7265   = self._api.cre
-0000d4c0: 6174 655f 6f72 6465 7228 7379 6d62 6f6c  ate_order(symbol
-0000d4d0: 3d70 6169 722c 2074 7970 653d 6f72 6465  =pair, type=orde
-0000d4e0: 7274 7970 652c 2073 6964 653d 7369 6465  rtype, side=side
-0000d4f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d230: 7374 6f70 5f70 7269 6365 3d73 746f 705f  stop_price=stop_
+0000d240: 7072 6963 655f 6e6f 726d 290a 2020 2020  price_norm).    
+0000d250: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000d260: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
+0000d270: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
+0000d280: 5245 533a 0a20 2020 2020 2020 2020 2020  RES:.           
+0000d290: 2020 2020 2070 6172 616d 735b 2772 6564       params['red
+0000d2a0: 7563 654f 6e6c 7927 5d20 3d20 5472 7565  uceOnly'] = True
+0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d2c0: 2069 6620 2773 746f 706c 6f73 735f 7072   if 'stoploss_pr
+0000d2d0: 6963 655f 7479 7065 2720 696e 206f 7264  ice_type' in ord
+0000d2e0: 6572 5f74 7970 6573 2061 6e64 2027 7374  er_types and 'st
+0000d2f0: 6f70 5f70 7269 6365 5f74 7970 655f 6669  op_price_type_fi
+0000d300: 656c 6427 2069 6e20 7365 6c66 2e5f 6674  eld' in self._ft
+0000d310: 5f68 6173 3a0a 2020 2020 2020 2020 2020  _has:.          
+0000d320: 2020 2020 2020 2020 2020 7072 6963 655f            price_
+0000d330: 7479 7065 203d 2073 656c 662e 5f66 745f  type = self._ft_
+0000d340: 6861 735b 2773 746f 705f 7072 6963 655f  has['stop_price_
+0000d350: 7479 7065 5f76 616c 7565 5f6d 6170 7069  type_value_mappi
+0000d360: 6e67 275d 5b0a 2020 2020 2020 2020 2020  ng'][.          
+0000d370: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0000d380: 6465 725f 7479 7065 732e 6765 7428 2773  der_types.get('s
+0000d390: 746f 706c 6f73 735f 7072 6963 655f 7479  toploss_price_ty
+0000d3a0: 7065 272c 2050 7269 6365 5479 7065 2e4c  pe', PriceType.L
+0000d3b0: 4153 5429 5d0a 2020 2020 2020 2020 2020  AST)].          
+0000d3c0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+0000d3d0: 5b73 656c 662e 5f66 745f 6861 735b 2773  [self._ft_has['s
+0000d3e0: 746f 705f 7072 6963 655f 7479 7065 5f66  top_price_type_f
+0000d3f0: 6965 6c64 275d 5d20 3d20 7072 6963 655f  ield']] = price_
+0000d400: 7479 7065 0a0a 2020 2020 2020 2020 2020  type..          
+0000d410: 2020 616d 6f75 6e74 203d 2073 656c 662e    amount = self.
+0000d420: 616d 6f75 6e74 5f74 6f5f 7072 6563 6973  amount_to_precis
+0000d430: 696f 6e28 7061 6972 2c20 7365 6c66 2e5f  ion(pair, self._
+0000d440: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
+0000d450: 6374 7328 7061 6972 2c20 616d 6f75 6e74  cts(pair, amount
+0000d460: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+0000d470: 7365 6c66 2e5f 6c65 765f 7072 6570 2870  self._lev_prep(p
+0000d480: 6169 722c 206c 6576 6572 6167 652c 2073  air, leverage, s
+0000d490: 6964 652c 2061 6363 6570 745f 6661 696c  ide, accept_fail
+0000d4a0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0000d4b0: 2020 206f 7264 6572 203d 2073 656c 662e     order = self.
+0000d4c0: 5f61 7069 2e63 7265 6174 655f 6f72 6465  _api.create_orde
+0000d4d0: 7228 7379 6d62 6f6c 3d70 6169 722c 2074  r(symbol=pair, t
+0000d4e0: 7970 653d 6f72 6465 7274 7970 652c 2073  ype=ordertype, s
+0000d4f0: 6964 653d 7369 6465 2c0a 2020 2020 2020  ide=side,.      
 0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d510: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
-0000d520: 756e 743d 616d 6f75 6e74 2c20 7072 6963  unt=amount, pric
-0000d530: 653d 6c69 6d69 745f 7261 7465 2c20 7061  e=limit_rate, pa
-0000d540: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
-0000d550: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-0000d560: 6f67 5f65 7863 6861 6e67 655f 7265 7370  og_exchange_resp
-0000d570: 6f6e 7365 2827 6372 6561 7465 5f73 746f  onse('create_sto
-0000d580: 706c 6f73 735f 6f72 6465 7227 2c20 6f72  ploss_order', or
-0000d590: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0000d5a0: 206f 7264 6572 203d 2073 656c 662e 5f6f   order = self._o
-0000d5b0: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
-0000d5c0: 6f5f 616d 6f75 6e74 286f 7264 6572 290a  o_amount(order).
-0000d5d0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000d5e0: 6572 2e69 6e66 6f28 6622 7374 6f70 6c6f  er.info(f"stoplo
-0000d5f0: 7373 207b 7573 6572 5f6f 7264 6572 5f74  ss {user_order_t
-0000d600: 7970 657d 206f 7264 6572 2061 6464 6564  ype} order added
-0000d610: 2066 6f72 207b 7061 6972 7d2e 2022 0a20   for {pair}. ". 
-0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 2020 2020 2020 2066 2273 746f 7020 7072         f"stop pr
-0000d640: 6963 653a 207b 7374 6f70 5f70 7269 6365  ice: {stop_price
-0000d650: 7d2e 206c 696d 6974 3a20 7b6c 696d 6974  }. limit: {limit
-0000d660: 5f72 6174 657d 2229 0a20 2020 2020 2020  _rate}").       
-0000d670: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
-0000d680: 720a 2020 2020 2020 2020 6578 6365 7074  r.        except
-0000d690: 2063 6378 742e 496e 7375 6666 6963 6965   ccxt.Insufficie
-0000d6a0: 6e74 4675 6e64 7320 6173 2065 3a0a 2020  ntFunds as e:.  
-0000d6b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d6c0: 496e 7375 6666 6963 6965 6e74 4675 6e64  InsufficientFund
-0000d6d0: 7345 7272 6f72 280a 2020 2020 2020 2020  sError(.        
-0000d6e0: 2020 2020 2020 2020 6627 496e 7375 6666          f'Insuff
-0000d6f0: 6963 6965 6e74 2066 756e 6473 2074 6f20  icient funds to 
-0000d700: 6372 6561 7465 207b 6f72 6465 7274 7970  create {ordertyp
-0000d710: 657d 2073 656c 6c20 6f72 6465 7220 6f6e  e} sell order on
-0000d720: 206d 6172 6b65 7420 7b70 6169 727d 2e20   market {pair}. 
-0000d730: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000d740: 2020 6627 5472 6965 6420 746f 2073 656c    f'Tried to sel
-0000d750: 6c20 616d 6f75 6e74 207b 616d 6f75 6e74  l amount {amount
-0000d760: 7d20 6174 2072 6174 6520 7b6c 696d 6974  } at rate {limit
-0000d770: 5f72 6174 657d 2e20 270a 2020 2020 2020  _rate}. '.      
-0000d780: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-0000d790: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0000d7a0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000d7b0: 2063 6378 742e 496e 7661 6c69 644f 7264   ccxt.InvalidOrd
-0000d7c0: 6572 2061 7320 653a 0a20 2020 2020 2020  er as e:.       
-0000d7d0: 2020 2020 2023 2045 7272 6f72 733a 0a20       # Errors:. 
-0000d7e0: 2020 2020 2020 2020 2020 2023 2060 4f72             # `Or
-0000d7f0: 6465 7220 776f 756c 6420 7472 6967 6765  der would trigge
-0000d800: 7220 696d 6d65 6469 6174 656c 792e 600a  r immediately.`.
-0000d810: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d820: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
-0000d830: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-0000d840: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
-0000d850: 206e 6f74 2063 7265 6174 6520 7b6f 7264   not create {ord
-0000d860: 6572 7479 7065 7d20 7365 6c6c 206f 7264  ertype} sell ord
-0000d870: 6572 206f 6e20 6d61 726b 6574 207b 7061  er on market {pa
-0000d880: 6972 7d2e 2027 0a20 2020 2020 2020 2020  ir}. '.         
-0000d890: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
-0000d8a0: 6f20 7365 6c6c 2061 6d6f 756e 7420 7b61  o sell amount {a
-0000d8b0: 6d6f 756e 747d 2061 7420 7261 7465 207b  mount} at rate {
-0000d8c0: 6c69 6d69 745f 7261 7465 7d2e 2027 0a20  limit_rate}. '. 
-0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d8e0: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
-0000d8f0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000d900: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-0000d910: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-0000d920: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d930: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-0000d940: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-0000d950: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-0000d960: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-0000d970: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-0000d980: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-0000d990: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-0000d9a0: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
-0000d9b0: 2020 2020 2020 2020 2020 6622 436f 756c            f"Coul
-0000d9c0: 6420 6e6f 7420 706c 6163 6520 7374 6f70  d not place stop
-0000d9d0: 6c6f 7373 206f 7264 6572 2064 7565 2074  loss order due t
-0000d9e0: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0000d9f0: 5f6e 616d 655f 5f7d 2e20 220a 2020 2020  _name__}. ".    
-0000da00: 2020 2020 2020 2020 2020 2020 6622 4d65              f"Me
-0000da10: 7373 6167 653a 207b 657d 2229 2066 726f  ssage: {e}") fro
-0000da20: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000da30: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-0000da40: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0000da50: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0000da60: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-0000da70: 2920 6672 6f6d 2065 0a0a 2020 2020 4072  ) from e..    @r
-0000da80: 6574 7269 6572 2872 6574 7269 6573 3d41  etrier(retries=A
-0000da90: 5049 5f46 4554 4348 5f4f 5244 4552 5f52  PI_FETCH_ORDER_R
-0000daa0: 4554 5259 5f43 4f55 4e54 290a 2020 2020  ETRY_COUNT).    
-0000dab0: 6465 6620 6665 7463 685f 6f72 6465 7228  def fetch_order(
-0000dac0: 7365 6c66 2c20 6f72 6465 725f 6964 3a20  self, order_id: 
-0000dad0: 7374 722c 2070 6169 723a 2073 7472 2c20  str, pair: str, 
-0000dae0: 7061 7261 6d73 3a20 4469 6374 203d 207b  params: Dict = {
-0000daf0: 7d29 202d 3e20 4469 6374 3a0a 2020 2020  }) -> Dict:.    
-0000db00: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
-0000db10: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
-0000db20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000db30: 726e 2073 656c 662e 6665 7463 685f 6472  rn self.fetch_dr
-0000db40: 795f 7275 6e5f 6f72 6465 7228 6f72 6465  y_run_order(orde
-0000db50: 725f 6964 290a 2020 2020 2020 2020 7472  r_id).        tr
-0000db60: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-0000db70: 7264 6572 203d 2073 656c 662e 5f61 7069  rder = self._api
-0000db80: 2e66 6574 6368 5f6f 7264 6572 286f 7264  .fetch_order(ord
-0000db90: 6572 5f69 642c 2070 6169 722c 2070 6172  er_id, pair, par
-0000dba0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-0000dbb0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-0000dbc0: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
-0000dbd0: 6e73 6528 2766 6574 6368 5f6f 7264 6572  nse('fetch_order
-0000dbe0: 272c 206f 7264 6572 290a 2020 2020 2020  ', order).      
-0000dbf0: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
-0000dc00: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
-0000dc10: 6374 735f 746f 5f61 6d6f 756e 7428 6f72  cts_to_amount(or
-0000dc20: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0000dc30: 2072 6574 7572 6e20 6f72 6465 720a 2020   return order.  
-0000dc40: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000dc50: 742e 4f72 6465 724e 6f74 466f 756e 6420  t.OrderNotFound 
-0000dc60: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000dc70: 2020 7261 6973 6520 5265 7472 7961 626c    raise Retryabl
-0000dc80: 654f 7264 6572 4572 726f 7228 0a20 2020  eOrderError(.   
-0000dc90: 2020 2020 2020 2020 2020 2020 2066 274f               f'O
-0000dca0: 7264 6572 206e 6f74 2066 6f75 6e64 2028  rder not found (
-0000dcb0: 7061 6972 3a20 7b70 6169 727d 2069 643a  pair: {pair} id:
-0000dcc0: 207b 6f72 6465 725f 6964 7d29 2e20 4d65   {order_id}). Me
-0000dcd0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0000dce0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000dcf0: 7074 2063 6378 742e 496e 7661 6c69 644f  pt ccxt.InvalidO
-0000dd00: 7264 6572 2061 7320 653a 0a20 2020 2020  rder as e:.     
-0000dd10: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
-0000dd20: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
-0000dd30: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0000dd40: 2020 2020 6627 5472 6965 6420 746f 2067      f'Tried to g
-0000dd50: 6574 2061 6e20 696e 7661 6c69 6420 6f72  et an invalid or
-0000dd60: 6465 7220 2870 6169 723a 207b 7061 6972  der (pair: {pair
-0000dd70: 7d20 6964 3a20 7b6f 7264 6572 5f69 647d  } id: {order_id}
-0000dd80: 292e 204d 6573 7361 6765 3a20 7b65 7d27  ). Message: {e}'
-0000dd90: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000dda0: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-0000ddb0: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-0000ddc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000ddd0: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-0000dde0: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-0000ddf0: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-0000de00: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-0000de10: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-0000de20: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-0000de30: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-0000de40: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-0000de50: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-0000de60: 756c 6420 6e6f 7420 6765 7420 6f72 6465  uld not get orde
-0000de70: 7220 6475 6520 746f 207b 652e 5f5f 636c  r due to {e.__cl
-0000de80: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-0000de90: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-0000dea0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000deb0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-0000dec0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0000ded0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0000dee0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0000def0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-0000df00: 2064 6566 2066 6574 6368 5f73 746f 706c   def fetch_stopl
-0000df10: 6f73 735f 6f72 6465 7228 7365 6c66 2c20  oss_order(self, 
-0000df20: 6f72 6465 725f 6964 3a20 7374 722c 2070  order_id: str, p
-0000df30: 6169 723a 2073 7472 2c20 7061 7261 6d73  air: str, params
-0000df40: 3a20 4469 6374 203d 207b 7d29 202d 3e20  : Dict = {}) -> 
-0000df50: 4469 6374 3a0a 2020 2020 2020 2020 7265  Dict:.        re
-0000df60: 7475 726e 2073 656c 662e 6665 7463 685f  turn self.fetch_
-0000df70: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
-0000df80: 7061 6972 2c20 7061 7261 6d73 290a 0a20  pair, params).. 
-0000df90: 2020 2064 6566 2066 6574 6368 5f6f 7264     def fetch_ord
-0000dfa0: 6572 5f6f 725f 7374 6f70 6c6f 7373 5f6f  er_or_stoploss_o
-0000dfb0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
-0000dfc0: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
-0000dfd0: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 2020 2020 2061 6d6f 756e 743d 616d 6f75       amount=amou
+0000d530: 6e74 2c20 7072 6963 653d 6c69 6d69 745f  nt, price=limit_
+0000d540: 7261 7465 2c20 7061 7261 6d73 3d70 6172  rate, params=par
+0000d550: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0000d560: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
+0000d570: 6e67 655f 7265 7370 6f6e 7365 2827 6372  nge_response('cr
+0000d580: 6561 7465 5f73 746f 706c 6f73 735f 6f72  eate_stoploss_or
+0000d590: 6465 7227 2c20 6f72 6465 7229 0a20 2020  der', order).   
+0000d5a0: 2020 2020 2020 2020 206f 7264 6572 203d           order =
+0000d5b0: 2073 656c 662e 5f6f 7264 6572 5f63 6f6e   self._order_con
+0000d5c0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+0000d5d0: 286f 7264 6572 290a 2020 2020 2020 2020  (order).        
+0000d5e0: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+0000d5f0: 6622 7374 6f70 6c6f 7373 207b 7573 6572  f"stoploss {user
+0000d600: 5f6f 7264 6572 5f74 7970 657d 206f 7264  _order_type} ord
+0000d610: 6572 2061 6464 6564 2066 6f72 207b 7061  er added for {pa
+0000d620: 6972 7d2e 2022 0a20 2020 2020 2020 2020  ir}. ".         
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d640: 2273 746f 7020 7072 6963 653a 207b 7374  "stop price: {st
+0000d650: 6f70 5f70 7269 6365 7d2e 206c 696d 6974  op_price}. limit
+0000d660: 3a20 7b6c 696d 6974 5f72 6174 657d 2229  : {limit_rate}")
+0000d670: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d680: 7572 6e20 6f72 6465 720a 2020 2020 2020  urn order.      
+0000d690: 2020 6578 6365 7074 2063 6378 742e 496e    except ccxt.In
+0000d6a0: 7375 6666 6963 6965 6e74 4675 6e64 7320  sufficientFunds 
+0000d6b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000d6c0: 2020 7261 6973 6520 496e 7375 6666 6963    raise Insuffic
+0000d6d0: 6965 6e74 4675 6e64 7345 7272 6f72 280a  ientFundsError(.
+0000d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6f0: 6627 496e 7375 6666 6963 6965 6e74 2066  f'Insufficient f
+0000d700: 756e 6473 2074 6f20 6372 6561 7465 207b  unds to create {
+0000d710: 6f72 6465 7274 7970 657d 2073 656c 6c20  ordertype} sell 
+0000d720: 6f72 6465 7220 6f6e 206d 6172 6b65 7420  order on market 
+0000d730: 7b70 6169 727d 2e20 270a 2020 2020 2020  {pair}. '.      
+0000d740: 2020 2020 2020 2020 2020 6627 5472 6965            f'Trie
+0000d750: 6420 746f 2073 656c 6c20 616d 6f75 6e74  d to sell amount
+0000d760: 207b 616d 6f75 6e74 7d20 6174 2072 6174   {amount} at rat
+0000d770: 6520 7b6c 696d 6974 5f72 6174 657d 2e20  e {limit_rate}. 
+0000d780: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000d790: 2020 6627 4d65 7373 6167 653a 207b 657d    f'Message: {e}
+0000d7a0: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
+0000d7b0: 2020 6578 6365 7074 2063 6378 742e 496e    except ccxt.In
+0000d7c0: 7661 6c69 644f 7264 6572 2061 7320 653a  validOrder as e:
+0000d7d0: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
+0000d7e0: 7272 6f72 733a 0a20 2020 2020 2020 2020  rrors:.         
+0000d7f0: 2020 2023 2060 4f72 6465 7220 776f 756c     # `Order woul
+0000d800: 6420 7472 6967 6765 7220 696d 6d65 6469  d trigger immedi
+0000d810: 6174 656c 792e 600a 2020 2020 2020 2020  ately.`.        
+0000d820: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
+0000d830: 644f 7264 6572 4578 6365 7074 696f 6e28  dOrderException(
+0000d840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d850: 2066 2743 6f75 6c64 206e 6f74 2063 7265   f'Could not cre
+0000d860: 6174 6520 7b6f 7264 6572 7479 7065 7d20  ate {ordertype} 
+0000d870: 7365 6c6c 206f 7264 6572 206f 6e20 6d61  sell order on ma
+0000d880: 726b 6574 207b 7061 6972 7d2e 2027 0a20  rket {pair}. '. 
+0000d890: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d8a0: 2754 7269 6564 2074 6f20 7365 6c6c 2061  'Tried to sell a
+0000d8b0: 6d6f 756e 7420 7b61 6d6f 756e 747d 2061  mount {amount} a
+0000d8c0: 7420 7261 7465 207b 6c69 6d69 745f 7261  t rate {limit_ra
+0000d8d0: 7465 7d2e 2027 0a20 2020 2020 2020 2020  te}. '.         
+0000d8e0: 2020 2020 2020 2066 274d 6573 7361 6765         f'Message
+0000d8f0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000d900: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000d910: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
+0000d920: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+0000d930: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
+0000d940: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
+0000d950: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+0000d960: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
+0000d970: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
+0000d980: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
+0000d990: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d9a0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
+0000d9b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d9c0: 2020 6622 436f 756c 6420 6e6f 7420 706c    f"Could not pl
+0000d9d0: 6163 6520 7374 6f70 6c6f 7373 206f 7264  ace stoploss ord
+0000d9e0: 6572 2064 7565 2074 6f20 7b65 2e5f 5f63  er due to {e.__c
+0000d9f0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0000da00: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0000da10: 2020 2020 6622 4d65 7373 6167 653a 207b      f"Message: {
+0000da20: 657d 2229 2066 726f 6d20 650a 2020 2020  e}") from e.    
+0000da30: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000da40: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
+0000da50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000da60: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+0000da70: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
+0000da80: 0a0a 2020 2020 4072 6574 7269 6572 2872  ..    @retrier(r
+0000da90: 6574 7269 6573 3d41 5049 5f46 4554 4348  etries=API_FETCH
+0000daa0: 5f4f 5244 4552 5f52 4554 5259 5f43 4f55  _ORDER_RETRY_COU
+0000dab0: 4e54 290a 2020 2020 6465 6620 6665 7463  NT).    def fetc
+0000dac0: 685f 6f72 6465 7228 7365 6c66 2c20 6f72  h_order(self, or
+0000dad0: 6465 725f 6964 3a20 7374 722c 2070 6169  der_id: str, pai
+0000dae0: 723a 2073 7472 2c20 7061 7261 6d73 3a20  r: str, params: 
+0000daf0: 4469 6374 203d 207b 7d29 202d 3e20 4469  Dict = {}) -> Di
+0000db00: 6374 3a0a 2020 2020 2020 2020 6966 2073  ct:.        if s
+0000db10: 656c 662e 5f63 6f6e 6669 675b 2764 7279  elf._config['dry
+0000db20: 5f72 756e 275d 3a0a 2020 2020 2020 2020  _run']:.        
+0000db30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000db40: 6665 7463 685f 6472 795f 7275 6e5f 6f72  fetch_dry_run_or
+0000db50: 6465 7228 6f72 6465 725f 6964 290a 2020  der(order_id).  
+0000db60: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000db70: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
+0000db80: 656c 662e 5f61 7069 2e66 6574 6368 5f6f  elf._api.fetch_o
+0000db90: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000dba0: 6169 722c 2070 6172 616d 733d 7061 7261  air, params=para
+0000dbb0: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+0000dbc0: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
+0000dbd0: 6765 5f72 6573 706f 6e73 6528 2766 6574  ge_response('fet
+0000dbe0: 6368 5f6f 7264 6572 272c 206f 7264 6572  ch_order', order
+0000dbf0: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0000dc00: 6465 7220 3d20 7365 6c66 2e5f 6f72 6465  der = self._orde
+0000dc10: 725f 636f 6e74 7261 6374 735f 746f 5f61  r_contracts_to_a
+0000dc20: 6d6f 756e 7428 6f72 6465 7229 0a20 2020  mount(order).   
+0000dc30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000dc40: 6f72 6465 720a 2020 2020 2020 2020 6578  order.        ex
+0000dc50: 6365 7074 2063 6378 742e 4f72 6465 724e  cept ccxt.OrderN
+0000dc60: 6f74 466f 756e 6420 6173 2065 3a0a 2020  otFound as e:.  
+0000dc70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000dc80: 5265 7472 7961 626c 654f 7264 6572 4572  RetryableOrderEr
+0000dc90: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000dca0: 2020 2020 2066 274f 7264 6572 206e 6f74       f'Order not
+0000dcb0: 2066 6f75 6e64 2028 7061 6972 3a20 7b70   found (pair: {p
+0000dcc0: 6169 727d 2069 643a 207b 6f72 6465 725f  air} id: {order_
+0000dcd0: 6964 7d29 2e20 4d65 7373 6167 653a 207b  id}). Message: {
+0000dce0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0000dcf0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000dd00: 496e 7661 6c69 644f 7264 6572 2061 7320  InvalidOrder as 
+0000dd10: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000dd20: 6169 7365 2049 6e76 616c 6964 4f72 6465  aise InvalidOrde
+0000dd30: 7245 7863 6570 7469 6f6e 280a 2020 2020  rException(.    
+0000dd40: 2020 2020 2020 2020 2020 2020 6627 5472              f'Tr
+0000dd50: 6965 6420 746f 2067 6574 2061 6e20 696e  ied to get an in
+0000dd60: 7661 6c69 6420 6f72 6465 7220 2870 6169  valid order (pai
+0000dd70: 723a 207b 7061 6972 7d20 6964 3a20 7b6f  r: {pair} id: {o
+0000dd80: 7264 6572 5f69 647d 292e 204d 6573 7361  rder_id}). Messa
+0000dd90: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+0000dda0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000ddb0: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+0000ddc0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+0000ddd0: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+0000dde0: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+0000ddf0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+0000de00: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
+0000de10: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
+0000de20: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+0000de30: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000de40: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+0000de50: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000de60: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+0000de70: 6765 7420 6f72 6465 7220 6475 6520 746f  get order due to
+0000de80: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0000de90: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0000dea0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000deb0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000dec0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+0000ded0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000dee0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+0000def0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+0000df00: 6d20 650a 0a20 2020 2064 6566 2066 6574  m e..    def fet
+0000df10: 6368 5f73 746f 706c 6f73 735f 6f72 6465  ch_stoploss_orde
+0000df20: 7228 7365 6c66 2c20 6f72 6465 725f 6964  r(self, order_id
+0000df30: 3a20 7374 722c 2070 6169 723a 2073 7472  : str, pair: str
+0000df40: 2c20 7061 7261 6d73 3a20 4469 6374 203d  , params: Dict =
+0000df50: 207b 7d29 202d 3e20 4469 6374 3a0a 2020   {}) -> Dict:.  
+0000df60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000df70: 662e 6665 7463 685f 6f72 6465 7228 6f72  f.fetch_order(or
+0000df80: 6465 725f 6964 2c20 7061 6972 2c20 7061  der_id, pair, pa
+0000df90: 7261 6d73 290a 0a20 2020 2064 6566 2066  rams)..    def f
+0000dfa0: 6574 6368 5f6f 7264 6572 5f6f 725f 7374  etch_order_or_st
+0000dfb0: 6f70 6c6f 7373 5f6f 7264 6572 2873 656c  oploss_order(sel
+0000dfc0: 662c 206f 7264 6572 5f69 643a 2073 7472  f, order_id: str
+0000dfd0: 2c20 7061 6972 3a20 7374 722c 0a20 2020  , pair: str,.   
 0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2020 2020 2020 2020 2020 2073 746f 706c             stopl
-0000e000: 6f73 735f 6f72 6465 723a 2062 6f6f 6c20  oss_order: bool 
-0000e010: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
-0000e020: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000e030: 2020 2020 2020 5369 6d70 6c65 2077 7261        Simple wra
-0000e040: 7070 6572 2063 616c 6c69 6e67 2065 6974  pper calling eit
-0000e050: 6865 7220 6665 7463 685f 6f72 6465 7220  her fetch_order 
-0000e060: 6f72 2066 6574 6368 5f73 746f 706c 6f73  or fetch_stoplos
-0000e070: 735f 6f72 6465 7220 6465 7065 6e64 696e  s_order dependin
-0000e080: 6720 6f6e 0a20 2020 2020 2020 2074 6865  g on.        the
-0000e090: 2073 746f 706c 6f73 735f 6f72 6465 7220   stoploss_order 
-0000e0a0: 7061 7261 6d65 7465 720a 2020 2020 2020  parameter.      
-0000e0b0: 2020 3a70 6172 616d 206f 7264 6572 5f69    :param order_i
-0000e0c0: 643a 204f 7264 6572 4964 2074 6f20 6665  d: OrderId to fe
-0000e0d0: 7463 6820 6f72 6465 720a 2020 2020 2020  tch order.      
-0000e0e0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
-0000e0f0: 6169 7220 636f 7272 6573 706f 6e64 696e  air correspondin
-0000e100: 6720 746f 206f 7264 6572 5f69 640a 2020  g to order_id.  
-0000e110: 2020 2020 2020 3a70 6172 616d 2073 746f        :param sto
-0000e120: 706c 6f73 735f 6f72 6465 723a 2049 6620  ploss_order: If 
-0000e130: 7472 7565 2c20 7573 6573 2066 6574 6368  true, uses fetch
-0000e140: 5f73 746f 706c 6f73 735f 6f72 6465 722c  _stoploss_order,
-0000e150: 206f 7468 6572 7769 7365 2066 6574 6368   otherwise fetch
-0000e160: 5f6f 7264 6572 2e0a 2020 2020 2020 2020  _order..        
-0000e170: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000e180: 746f 706c 6f73 735f 6f72 6465 723a 0a20  toploss_order:. 
-0000e190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e1a0: 6e20 7365 6c66 2e66 6574 6368 5f73 746f  n self.fetch_sto
-0000e1b0: 706c 6f73 735f 6f72 6465 7228 6f72 6465  ploss_order(orde
-0000e1c0: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
-0000e1d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000e1e0: 6665 7463 685f 6f72 6465 7228 6f72 6465  fetch_order(orde
-0000e1f0: 725f 6964 2c20 7061 6972 290a 0a20 2020  r_id, pair)..   
-0000e200: 2064 6566 2063 6865 636b 5f6f 7264 6572   def check_order
-0000e210: 5f63 616e 6365 6c65 645f 656d 7074 7928  _canceled_empty(
-0000e220: 7365 6c66 2c20 6f72 6465 723a 2044 6963  self, order: Dic
-0000e230: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
-0000e240: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e250: 5665 7269 6679 2069 6620 616e 206f 7264  Verify if an ord
-0000e260: 6572 2068 6173 2062 6565 6e20 6361 6e63  er has been canc
-0000e270: 656c 6c65 6420 7769 7468 6f75 7420 6265  elled without be
-0000e280: 696e 6720 7061 7274 6961 6c6c 7920 6669  ing partially fi
-0000e290: 6c6c 6564 0a20 2020 2020 2020 203a 7061  lled.        :pa
-0000e2a0: 7261 6d20 6f72 6465 723a 204f 7264 6572  ram order: Order
-0000e2b0: 2064 6963 7420 6173 2072 6574 7572 6e65   dict as returne
-0000e2c0: 6420 6672 6f6d 2066 6574 6368 5f6f 7264  d from fetch_ord
-0000e2d0: 6572 2829 0a20 2020 2020 2020 203a 7265  er().        :re
-0000e2e0: 7475 726e 3a20 5472 7565 2069 6620 6f72  turn: True if or
-0000e2f0: 6465 7220 6861 7320 6265 656e 2063 616e  der has been can
-0000e300: 6365 6c6c 6564 2077 6974 686f 7574 2062  celled without b
-0000e310: 6569 6e67 2066 696c 6c65 642c 2046 616c  eing filled, Fal
-0000e320: 7365 206f 7468 6572 7769 7365 2e0a 2020  se otherwise..  
-0000e330: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000e340: 2020 7265 7475 726e 2028 6f72 6465 722e    return (order.
-0000e350: 6765 7428 2773 7461 7475 7327 2920 696e  get('status') in
-0000e360: 204e 4f4e 5f4f 5045 4e5f 4558 4348 414e   NON_OPEN_EXCHAN
-0000e370: 4745 5f53 5441 5445 530a 2020 2020 2020  GE_STATES.      
-0000e380: 2020 2020 2020 2020 2020 616e 6420 6f72            and or
-0000e390: 6465 722e 6765 7428 2766 696c 6c65 6427  der.get('filled'
-0000e3a0: 2920 3d3d 2030 2e30 290a 0a20 2020 2040  ) == 0.0)..    @
-0000e3b0: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
-0000e3c0: 6361 6e63 656c 5f6f 7264 6572 2873 656c  cancel_order(sel
-0000e3d0: 662c 206f 7264 6572 5f69 643a 2073 7472  f, order_id: str
-0000e3e0: 2c20 7061 6972 3a20 7374 722c 2070 6172  , pair: str, par
-0000e3f0: 616d 733a 2044 6963 7420 3d20 7b7d 2920  ams: Dict = {}) 
-0000e400: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-0000e410: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
-0000e420: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
-0000e430: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000e440: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000e450: 6465 7220 3d20 7365 6c66 2e66 6574 6368  der = self.fetch
-0000e460: 5f64 7279 5f72 756e 5f6f 7264 6572 286f  _dry_run_order(o
-0000e470: 7264 6572 5f69 6429 0a0a 2020 2020 2020  rder_id)..      
-0000e480: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
-0000e490: 7570 6461 7465 287b 2773 7461 7475 7327  update({'status'
-0000e4a0: 3a20 2763 616e 6365 6c65 6427 2c20 2766  : 'canceled', 'f
-0000e4b0: 696c 6c65 6427 3a20 302e 302c 2027 7265  illed': 0.0, 're
-0000e4c0: 6d61 696e 696e 6727 3a20 6f72 6465 725b  maining': order[
-0000e4d0: 2761 6d6f 756e 7427 5d7d 290a 2020 2020  'amount']}).    
-0000e4e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e4f0: 726e 206f 7264 6572 0a20 2020 2020 2020  rn order.       
-0000e500: 2020 2020 2065 7863 6570 7420 496e 7661       except Inva
-0000e510: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
-0000e520: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0000e530: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
-0000e540: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000e550: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
-0000e560: 656c 662e 5f61 7069 2e63 616e 6365 6c5f  elf._api.cancel_
-0000e570: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
-0000e580: 7061 6972 2c20 7061 7261 6d73 3d70 6172  pair, params=par
-0000e590: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
-0000e5a0: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
-0000e5b0: 6e67 655f 7265 7370 6f6e 7365 2827 6361  nge_response('ca
-0000e5c0: 6e63 656c 5f6f 7264 6572 272c 206f 7264  ncel_order', ord
-0000e5d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000e5e0: 6f72 6465 7220 3d20 7365 6c66 2e5f 6f72  order = self._or
-0000e5f0: 6465 725f 636f 6e74 7261 6374 735f 746f  der_contracts_to
-0000e600: 5f61 6d6f 756e 7428 6f72 6465 7229 0a20  _amount(order). 
-0000e610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e620: 6e20 6f72 6465 720a 2020 2020 2020 2020  n order.        
-0000e630: 6578 6365 7074 2063 6378 742e 496e 7661  except ccxt.Inva
-0000e640: 6c69 644f 7264 6572 2061 7320 653a 0a20  lidOrder as e:. 
-0000e650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000e660: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
-0000e670: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-0000e680: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-0000e690: 6e6f 7420 6361 6e63 656c 206f 7264 6572  not cancel order
-0000e6a0: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
-0000e6b0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000e6c0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
-0000e6d0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
-0000e6e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000e6f0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
-0000e700: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
-0000e710: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
-0000e720: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
-0000e730: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
-0000e740: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-0000e750: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
-0000e760: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
-0000e770: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
-0000e780: 6c64 206e 6f74 2063 616e 6365 6c20 6f72  ld not cancel or
-0000e790: 6465 7220 6475 6520 746f 207b 652e 5f5f  der due to {e.__
-0000e7a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000e7b0: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
-0000e7c0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000e7d0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-0000e7e0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0000e7f0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0000e800: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0000e810: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
-0000e820: 2020 2064 6566 2063 616e 6365 6c5f 7374     def cancel_st
-0000e830: 6f70 6c6f 7373 5f6f 7264 6572 2873 656c  oploss_order(sel
-0000e840: 662c 206f 7264 6572 5f69 643a 2073 7472  f, order_id: str
-0000e850: 2c20 7061 6972 3a20 7374 722c 2070 6172  , pair: str, par
-0000e860: 616d 733a 2044 6963 7420 3d20 7b7d 2920  ams: Dict = {}) 
-0000e870: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-0000e880: 2072 6574 7572 6e20 7365 6c66 2e63 616e   return self.can
-0000e890: 6365 6c5f 6f72 6465 7228 6f72 6465 725f  cel_order(order_
-0000e8a0: 6964 2c20 7061 6972 2c20 7061 7261 6d73  id, pair, params
-0000e8b0: 290a 0a20 2020 2064 6566 2069 735f 6361  )..    def is_ca
-0000e8c0: 6e63 656c 5f6f 7264 6572 5f72 6573 756c  ncel_order_resul
-0000e8d0: 745f 7375 6974 6162 6c65 2873 656c 662c  t_suitable(self,
-0000e8e0: 2063 6f72 6465 7229 202d 3e20 626f 6f6c   corder) -> bool
-0000e8f0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-0000e900: 2069 7369 6e73 7461 6e63 6528 636f 7264   isinstance(cord
-0000e910: 6572 2c20 6469 6374 293a 0a20 2020 2020  er, dict):.     
-0000e920: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-0000e930: 6c73 650a 0a20 2020 2020 2020 2072 6571  lse..        req
-0000e940: 7569 7265 6420 3d20 2827 6665 6527 2c20  uired = ('fee', 
-0000e950: 2773 7461 7475 7327 2c20 2761 6d6f 756e  'status', 'amoun
-0000e960: 7427 290a 2020 2020 2020 2020 7265 7475  t').        retu
-0000e970: 726e 2061 6c6c 2863 6f72 6465 722e 6765  rn all(corder.ge
-0000e980: 7428 6b2c 204e 6f6e 6529 2069 7320 6e6f  t(k, None) is no
-0000e990: 7420 4e6f 6e65 2066 6f72 206b 2069 6e20  t None for k in 
-0000e9a0: 7265 7175 6972 6564 290a 0a20 2020 2064  required)..    d
-0000e9b0: 6566 2063 616e 6365 6c5f 6f72 6465 725f  ef cancel_order_
-0000e9c0: 7769 7468 5f72 6573 756c 7428 7365 6c66  with_result(self
-0000e9d0: 2c20 6f72 6465 725f 6964 3a20 7374 722c  , order_id: str,
-0000e9e0: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
-0000e9f0: 6e74 3a20 666c 6f61 7429 202d 3e20 4469  nt: float) -> Di
-0000ea00: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
-0000ea10: 2020 2020 2020 2020 4361 6e63 656c 206f          Cancel o
-0000ea20: 7264 6572 2072 6574 7572 6e69 6e67 2061  rder returning a
-0000ea30: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
-0000ea40: 2043 7265 6174 6573 2061 2066 616b 6520   Creates a fake 
-0000ea50: 7265 7375 6c74 2069 6620 6361 6e63 656c  result if cancel
-0000ea60: 206f 7264 6572 2072 6574 7572 6e73 2061   order returns a
-0000ea70: 206e 6f6e 2d75 7361 626c 6520 7265 7375   non-usable resu
-0000ea80: 6c74 0a20 2020 2020 2020 2061 6e64 2066  lt.        and f
-0000ea90: 6574 6368 5f6f 7264 6572 2064 6f65 7320  etch_order does 
-0000eaa0: 6e6f 7420 776f 726b 2028 6365 7274 6169  not work (certai
-0000eab0: 6e20 6578 6368 616e 6765 7320 646f 6e27  n exchanges don'
-0000eac0: 7420 7265 7475 726e 2063 616e 6365 6c6c  t return cancell
-0000ead0: 6564 206f 7264 6572 7329 0a20 2020 2020  ed orders).     
-0000eae0: 2020 203a 7061 7261 6d20 6f72 6465 725f     :param order_
-0000eaf0: 6964 3a20 4f72 6465 7269 6420 746f 2063  id: Orderid to c
-0000eb00: 616e 6365 6c0a 2020 2020 2020 2020 3a70  ancel.        :p
-0000eb10: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-0000eb20: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
-0000eb30: 206f 7264 6572 5f69 640a 2020 2020 2020   order_id.      
-0000eb40: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
-0000eb50: 2041 6d6f 756e 7420 746f 2075 7365 2066   Amount to use f
-0000eb60: 6f72 2066 616b 6520 7265 7370 6f6e 7365  or fake response
-0000eb70: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-0000eb80: 3a20 5265 7375 6c74 2066 726f 6d20 6569  : Result from ei
-0000eb90: 7468 6572 2063 616e 6365 6c5f 6f72 6465  ther cancel_orde
-0000eba0: 7220 6966 2075 7361 626c 652c 206f 7220  r if usable, or 
-0000ebb0: 6665 7463 685f 6f72 6465 720a 2020 2020  fetch_order.    
-0000ebc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ebd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000ebe0: 2063 6f72 6465 7220 3d20 7365 6c66 2e63   corder = self.c
-0000ebf0: 616e 6365 6c5f 6f72 6465 7228 6f72 6465  ancel_order(orde
-0000ec00: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
-0000ec10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000ec20: 6973 5f63 616e 6365 6c5f 6f72 6465 725f  is_cancel_order_
-0000ec30: 7265 7375 6c74 5f73 7569 7461 626c 6528  result_suitable(
-0000ec40: 636f 7264 6572 293a 0a20 2020 2020 2020  corder):.       
-0000ec50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000ec60: 636f 7264 6572 0a20 2020 2020 2020 2065  corder.        e
-0000ec70: 7863 6570 7420 496e 7661 6c69 644f 7264  xcept InvalidOrd
-0000ec80: 6572 4578 6365 7074 696f 6e3a 0a20 2020  erException:.   
-0000ec90: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000eca0: 7761 726e 696e 6728 6622 436f 756c 6420  warning(f"Could 
-0000ecb0: 6e6f 7420 6361 6e63 656c 206f 7264 6572  not cancel order
-0000ecc0: 207b 6f72 6465 725f 6964 7d20 666f 7220   {order_id} for 
-0000ecd0: 7b70 6169 727d 2e22 290a 2020 2020 2020  {pair}.").      
-0000ece0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000ecf0: 2020 206f 7264 6572 203d 2073 656c 662e     order = self.
-0000ed00: 6665 7463 685f 6f72 6465 7228 6f72 6465  fetch_order(orde
-0000ed10: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
-0000ed20: 2020 2020 6578 6365 7074 2049 6e76 616c      except Inval
-0000ed30: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
-0000ed40: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0000ed50: 6767 6572 2e77 6172 6e69 6e67 2866 2243  gger.warning(f"C
-0000ed60: 6f75 6c64 206e 6f74 2066 6574 6368 2063  ould not fetch c
-0000ed70: 616e 6365 6c6c 6564 206f 7264 6572 207b  ancelled order {
-0000ed80: 6f72 6465 725f 6964 7d2e 2229 0a20 2020  order_id}.").   
-0000ed90: 2020 2020 2020 2020 206f 7264 6572 203d           order =
-0000eda0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000edb0: 2020 2027 6964 273a 206f 7264 6572 5f69     'id': order_i
-0000edc0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-0000edd0: 2020 2027 7374 6174 7573 273a 2027 6361     'status': 'ca
-0000ede0: 6e63 656c 6564 272c 0a20 2020 2020 2020  nceled',.       
-0000edf0: 2020 2020 2020 2020 2027 616d 6f75 6e74           'amount
-0000ee00: 273a 2061 6d6f 756e 742c 0a20 2020 2020  ': amount,.     
-0000ee10: 2020 2020 2020 2020 2020 2027 6669 6c6c             'fill
-0000ee20: 6564 273a 2030 2e30 2c0a 2020 2020 2020  ed': 0.0,.      
-0000ee30: 2020 2020 2020 2020 2020 2766 6565 273a            'fee':
-0000ee40: 207b 7d2c 0a20 2020 2020 2020 2020 2020   {},.           
-0000ee50: 2020 2020 2027 696e 666f 273a 207b 7d0a       'info': {}.
-0000ee60: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
-0000ee70: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-0000ee80: 6465 720a 0a20 2020 2064 6566 2063 616e  der..    def can
-0000ee90: 6365 6c5f 7374 6f70 6c6f 7373 5f6f 7264  cel_stoploss_ord
-0000eea0: 6572 5f77 6974 685f 7265 7375 6c74 2873  er_with_result(s
-0000eeb0: 656c 662c 206f 7264 6572 5f69 643a 2073  elf, order_id: s
-0000eec0: 7472 2c20 7061 6972 3a20 7374 722c 2061  tr, pair: str, a
-0000eed0: 6d6f 756e 743a 2066 6c6f 6174 2920 2d3e  mount: float) ->
-0000eee0: 2044 6963 743a 0a20 2020 2020 2020 2022   Dict:.        "
-0000eef0: 2222 0a20 2020 2020 2020 2043 616e 6365  "".        Cance
-0000ef00: 6c20 7374 6f70 6c6f 7373 206f 7264 6572  l stoploss order
-0000ef10: 2072 6574 7572 6e69 6e67 2061 2072 6573   returning a res
-0000ef20: 756c 742e 0a20 2020 2020 2020 2043 7265  ult..        Cre
-0000ef30: 6174 6573 2061 2066 616b 6520 7265 7375  ates a fake resu
-0000ef40: 6c74 2069 6620 6361 6e63 656c 206f 7264  lt if cancel ord
-0000ef50: 6572 2072 6574 7572 6e73 2061 206e 6f6e  er returns a non
-0000ef60: 2d75 7361 626c 6520 7265 7375 6c74 0a20  -usable result. 
-0000ef70: 2020 2020 2020 2061 6e64 2066 6574 6368         and fetch
-0000ef80: 5f6f 7264 6572 2064 6f65 7320 6e6f 7420  _order does not 
-0000ef90: 776f 726b 2028 6365 7274 6169 6e20 6578  work (certain ex
-0000efa0: 6368 616e 6765 7320 646f 6e27 7420 7265  changes don't re
-0000efb0: 7475 726e 2063 616e 6365 6c6c 6564 206f  turn cancelled o
-0000efc0: 7264 6572 7329 0a20 2020 2020 2020 203a  rders).        :
-0000efd0: 7061 7261 6d20 6f72 6465 725f 6964 3a20  param order_id: 
-0000efe0: 7374 6f70 6c6f 7373 2d6f 7264 6572 2d69  stoploss-order-i
-0000eff0: 6420 746f 2063 616e 6365 6c0a 2020 2020  d to cancel.    
-0000f000: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-0000f010: 2050 6169 7220 636f 7272 6573 706f 6e64   Pair correspond
-0000f020: 696e 6720 746f 206f 7264 6572 5f69 640a  ing to order_id.
-0000f030: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0000f040: 6d6f 756e 743a 2041 6d6f 756e 7420 746f  mount: Amount to
-0000f050: 2075 7365 2066 6f72 2066 616b 6520 7265   use for fake re
-0000f060: 7370 6f6e 7365 0a20 2020 2020 2020 203a  sponse.        :
-0000f070: 7265 7475 726e 3a20 5265 7375 6c74 2066  return: Result f
-0000f080: 726f 6d20 6569 7468 6572 2063 616e 6365  rom either cance
-0000f090: 6c5f 6f72 6465 7220 6966 2075 7361 626c  l_order if usabl
-0000f0a0: 652c 206f 7220 6665 7463 685f 6f72 6465  e, or fetch_orde
-0000f0b0: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
-0000f0c0: 2020 2020 2020 636f 7264 6572 203d 2073        corder = s
-0000f0d0: 656c 662e 6361 6e63 656c 5f73 746f 706c  elf.cancel_stopl
-0000f0e0: 6f73 735f 6f72 6465 7228 6f72 6465 725f  oss_order(order_
-0000f0f0: 6964 2c20 7061 6972 290a 2020 2020 2020  id, pair).      
-0000f100: 2020 6966 2073 656c 662e 6973 5f63 616e    if self.is_can
-0000f110: 6365 6c5f 6f72 6465 725f 7265 7375 6c74  cel_order_result
-0000f120: 5f73 7569 7461 626c 6528 636f 7264 6572  _suitable(corder
-0000f130: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000f140: 6574 7572 6e20 636f 7264 6572 0a20 2020  eturn corder.   
-0000f150: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000f160: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
-0000f170: 6c66 2e66 6574 6368 5f73 746f 706c 6f73  lf.fetch_stoplos
-0000f180: 735f 6f72 6465 7228 6f72 6465 725f 6964  s_order(order_id
-0000f190: 2c20 7061 6972 290a 2020 2020 2020 2020  , pair).        
-0000f1a0: 6578 6365 7074 2049 6e76 616c 6964 4f72  except InvalidOr
-0000f1b0: 6465 7245 7863 6570 7469 6f6e 3a0a 2020  derException:.  
-0000f1c0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0000f1d0: 2e77 6172 6e69 6e67 2866 2243 6f75 6c64  .warning(f"Could
-0000f1e0: 206e 6f74 2066 6574 6368 2063 616e 6365   not fetch cance
-0000f1f0: 6c6c 6564 2073 746f 706c 6f73 7320 6f72  lled stoploss or
-0000f200: 6465 7220 7b6f 7264 6572 5f69 647d 2e22  der {order_id}."
-0000f210: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0000f220: 6465 7220 3d20 7b27 6665 6527 3a20 7b7d  der = {'fee': {}
-0000f230: 2c20 2773 7461 7475 7327 3a20 2763 616e  , 'status': 'can
-0000f240: 6365 6c65 6427 2c20 2761 6d6f 756e 7427  celed', 'amount'
-0000f250: 3a20 616d 6f75 6e74 2c20 2769 6e66 6f27  : amount, 'info'
-0000f260: 3a20 7b7d 7d0a 0a20 2020 2020 2020 2072  : {}}..        r
-0000f270: 6574 7572 6e20 6f72 6465 720a 0a20 2020  eturn order..   
-0000f280: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-0000f290: 6620 6765 745f 6261 6c61 6e63 6573 2873  f get_balances(s
-0000f2a0: 656c 6629 202d 3e20 6469 6374 3a0a 0a20  elf) -> dict:.. 
-0000f2b0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000f2c0: 2020 2020 2020 2020 6261 6c61 6e63 6573          balances
-0000f2d0: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
-0000f2e0: 6368 5f62 616c 616e 6365 2829 0a20 2020  ch_balance().   
-0000f2f0: 2020 2020 2020 2020 2023 2052 656d 6f76           # Remov
-0000f300: 6520 6164 6469 7469 6f6e 616c 2069 6e66  e additional inf
-0000f310: 6f20 6672 6f6d 2063 6378 7420 7265 7375  o from ccxt resu
-0000f320: 6c74 730a 2020 2020 2020 2020 2020 2020  lts.            
-0000f330: 6261 6c61 6e63 6573 2e70 6f70 2822 696e  balances.pop("in
-0000f340: 666f 222c 204e 6f6e 6529 0a20 2020 2020  fo", None).     
-0000f350: 2020 2020 2020 2062 616c 616e 6365 732e         balances.
-0000f360: 706f 7028 2266 7265 6522 2c20 4e6f 6e65  pop("free", None
-0000f370: 290a 2020 2020 2020 2020 2020 2020 6261  ).            ba
-0000f380: 6c61 6e63 6573 2e70 6f70 2822 746f 7461  lances.pop("tota
-0000f390: 6c22 2c20 4e6f 6e65 290a 2020 2020 2020  l", None).      
-0000f3a0: 2020 2020 2020 6261 6c61 6e63 6573 2e70        balances.p
-0000f3b0: 6f70 2822 7573 6564 222c 204e 6f6e 6529  op("used", None)
-0000f3c0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0000f3d0: 7475 726e 2062 616c 616e 6365 730a 2020  turn balances.  
-0000f3e0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000f3f0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-0000f400: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000f410: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-0000f420: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-0000f430: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000f440: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-0000f450: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-0000f460: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-0000f470: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000f480: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-0000f490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f4a0: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
-0000f4b0: 2062 616c 616e 6365 2064 7565 2074 6f20   balance due to 
-0000f4c0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-0000f4d0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-0000f4e0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000f4f0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000f500: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0000f510: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000f520: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0000f530: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0000f540: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
-0000f550: 0a20 2020 2064 6566 2066 6574 6368 5f70  .    def fetch_p
-0000f560: 6f73 6974 696f 6e73 2873 656c 662c 2070  ositions(self, p
-0000f570: 6169 723a 204f 7074 696f 6e61 6c5b 7374  air: Optional[st
-0000f580: 725d 203d 204e 6f6e 6529 202d 3e20 4c69  r] = None) -> Li
-0000f590: 7374 5b44 6963 745d 3a0a 2020 2020 2020  st[Dict]:.      
-0000f5a0: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
-0000f5b0: 7463 6820 706f 7369 7469 6f6e 7320 6672  tch positions fr
-0000f5c0: 6f6d 2074 6865 2065 7863 6861 6e67 652e  om the exchange.
-0000f5d0: 0a20 2020 2020 2020 2049 6620 6e6f 2070  .        If no p
-0000f5e0: 6169 7220 6973 2067 6976 656e 2c20 616c  air is given, al
-0000f5f0: 6c20 706f 7369 7469 6f6e 7320 6172 6520  l positions are 
-0000f600: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
-0000f610: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
-0000f620: 6169 7220 666f 7220 7468 6520 7175 6572  air for the quer
-0000f630: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-0000f640: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
-0000f650: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
-0000f660: 206f 7220 7365 6c66 2e74 7261 6469 6e67   or self.trading
-0000f670: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
-0000f680: 4d6f 6465 2e46 5554 5552 4553 3a0a 2020  Mode.FUTURES:.  
-0000f690: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000f6a0: 205b 5d0a 2020 2020 2020 2020 7472 793a   [].        try:
-0000f6b0: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
-0000f6c0: 626f 6c73 203d 205b 5d0a 2020 2020 2020  bols = [].      
-0000f6d0: 2020 2020 2020 6966 2070 6169 723a 0a20        if pair:. 
-0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f6f0: 796d 626f 6c73 2e61 7070 656e 6428 7061  ymbols.append(pa
-0000f700: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-0000f710: 706f 7369 7469 6f6e 733a 204c 6973 745b  positions: List[
-0000f720: 4469 6374 5d20 3d20 7365 6c66 2e5f 6170  Dict] = self._ap
-0000f730: 692e 6665 7463 685f 706f 7369 7469 6f6e  i.fetch_position
-0000f740: 7328 7379 6d62 6f6c 7329 0a20 2020 2020  s(symbols).     
-0000f750: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-0000f760: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
-0000f770: 7365 2827 6665 7463 685f 706f 7369 7469  se('fetch_positi
-0000f780: 6f6e 7327 2c20 706f 7369 7469 6f6e 7329  ons', positions)
-0000f790: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000f7a0: 7572 6e20 706f 7369 7469 6f6e 730a 2020  urn positions.  
-0000f7b0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000f7c0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-0000f7d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000f7e0: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-0000f7f0: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-0000f800: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000f810: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-0000f820: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-0000f830: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-0000f840: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000f850: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-0000f860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f870: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
-0000f880: 2070 6f73 6974 696f 6e73 2064 7565 2074   positions due t
-0000f890: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0000f8a0: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-0000f8b0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000f8c0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000f8d0: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
-0000f8e0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000f8f0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0000f900: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
-0000f910: 6f6d 2065 0a0a 2020 2020 4072 6574 7269  om e..    @retri
-0000f920: 6572 2872 6574 7269 6573 3d30 290a 2020  er(retries=0).  
-0000f930: 2020 6465 6620 6665 7463 685f 6f72 6465    def fetch_orde
-0000f940: 7273 2873 656c 662c 2070 6169 723a 2073  rs(self, pair: s
-0000f950: 7472 2c20 7369 6e63 653a 2064 6174 6574  tr, since: datet
-0000f960: 696d 6529 202d 3e20 4c69 7374 5b44 6963  ime) -> List[Dic
-0000f970: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
-0000f980: 2020 2020 2020 2020 4665 7463 6820 616c          Fetch al
-0000f990: 6c20 6f72 6465 7273 2066 6f72 2061 2070  l orders for a p
-0000f9a0: 6169 7220 2273 696e 6365 220a 2020 2020  air "since".    
-0000f9b0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-0000f9c0: 2050 6169 7220 666f 7220 7468 6520 7175   Pair for the qu
-0000f9d0: 6572 790a 2020 2020 2020 2020 3a70 6172  ery.        :par
-0000f9e0: 616d 2073 696e 6365 3a20 5374 6172 7469  am since: Starti
-0000f9f0: 6e67 2074 696d 6520 666f 7220 7468 6520  ng time for the 
-0000fa00: 7175 6572 790a 2020 2020 2020 2020 2222  query.        ""
-0000fa10: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-0000fa20: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-0000fa30: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
-0000fa40: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
-0000fa50: 2020 2020 2064 6566 2066 6574 6368 5f6f       def fetch_o
-0000fa60: 7264 6572 735f 656d 756c 6174 6528 2920  rders_emulate() 
-0000fa70: 2d3e 204c 6973 745b 4469 6374 5d3a 0a20  -> List[Dict]:. 
-0000fa80: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000fa90: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-0000faa0: 2020 2069 6620 7365 6c66 2e65 7863 6861     if self.excha
-0000fab0: 6e67 655f 6861 7328 2766 6574 6368 436c  nge_has('fetchCl
-0000fac0: 6f73 6564 4f72 6465 7273 2729 3a0a 2020  osedOrders'):.  
-0000fad0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000fae0: 6465 7273 203d 2073 656c 662e 5f61 7069  ders = self._api
-0000faf0: 2e66 6574 6368 5f63 6c6f 7365 645f 6f72  .fetch_closed_or
-0000fb00: 6465 7273 2870 6169 722c 2073 696e 6365  ders(pair, since
-0000fb10: 3d73 696e 6365 5f6d 7329 0a20 2020 2020  =since_ms).     
-0000fb20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000fb30: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0000fb40: 2766 6574 6368 4f70 656e 4f72 6465 7273  'fetchOpenOrders
-0000fb50: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0000fb60: 2020 2020 2020 2020 6f72 6465 7273 5f6f          orders_o
-0000fb70: 7065 6e20 3d20 7365 6c66 2e5f 6170 692e  pen = self._api.
-0000fb80: 6665 7463 685f 6f70 656e 5f6f 7264 6572  fetch_open_order
-0000fb90: 7328 7061 6972 2c20 7369 6e63 653d 7369  s(pair, since=si
-0000fba0: 6e63 655f 6d73 290a 2020 2020 2020 2020  nce_ms).        
-0000fbb0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000fbc0: 7273 2e65 7874 656e 6428 6f72 6465 7273  rs.extend(orders
-0000fbd0: 5f6f 7065 6e29 0a20 2020 2020 2020 2020  _open).         
-0000fbe0: 2020 2072 6574 7572 6e20 6f72 6465 7273     return orders
-0000fbf0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000fc00: 2020 2020 2020 2020 2020 2073 696e 6365             since
-0000fc10: 5f6d 7320 3d20 696e 7428 2873 696e 6365  _ms = int((since
-0000fc20: 2e74 696d 6573 7461 6d70 2829 202d 2031  .timestamp() - 1
-0000fc30: 3029 202a 2031 3030 3029 0a20 2020 2020  0) * 1000).     
-0000fc40: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
-0000fc50: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
-0000fc60: 6368 4f72 6465 7273 2729 3a0a 2020 2020  chOrders'):.    
-0000fc70: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0000fc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc90: 2020 2020 206f 7264 6572 733a 204c 6973       orders: Lis
-0000fca0: 745b 4469 6374 5d20 3d20 7365 6c66 2e5f  t[Dict] = self._
-0000fcb0: 6170 692e 6665 7463 685f 6f72 6465 7273  api.fetch_orders
-0000fcc0: 2870 6169 722c 2073 696e 6365 3d73 696e  (pair, since=sin
-0000fcd0: 6365 5f6d 7329 0a20 2020 2020 2020 2020  ce_ms).         
-0000fce0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0000fcf0: 7874 2e4e 6f74 5375 7070 6f72 7465 643a  xt.NotSupported:
-0000fd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd10: 2020 2020 2023 2053 6f6d 6520 6578 6368       # Some exch
-0000fd20: 616e 6765 7320 646f 6e27 7420 7375 7070  anges don't supp
-0000fd30: 6f72 7420 6665 7463 684f 7264 6572 730a  ort fetchOrders.
-0000fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd50: 2020 2020 2320 6174 7465 6d70 7420 746f      # attempt to
-0000fd60: 2066 6574 6368 206f 7065 6e20 616e 6420   fetch open and 
-0000fd70: 636c 6f73 6564 206f 7264 6572 7320 7365  closed orders se
-0000fd80: 7061 7261 7465 6c79 0a20 2020 2020 2020  parately.       
-0000fd90: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0000fda0: 6572 7320 3d20 6665 7463 685f 6f72 6465  ers = fetch_orde
-0000fdb0: 7273 5f65 6d75 6c61 7465 2829 0a20 2020  rs_emulate().   
-0000fdc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000fdd0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000fde0: 7264 6572 7320 3d20 6665 7463 685f 6f72  rders = fetch_or
-0000fdf0: 6465 7273 5f65 6d75 6c61 7465 2829 0a20  ders_emulate(). 
-0000fe00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000fe10: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
-0000fe20: 7370 6f6e 7365 2827 6665 7463 685f 6f72  sponse('fetch_or
-0000fe30: 6465 7273 272c 206f 7264 6572 7329 0a20  ders', orders). 
-0000fe40: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000fe50: 7320 3d20 5b73 656c 662e 5f6f 7264 6572  s = [self._order
-0000fe60: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
-0000fe70: 6f75 6e74 286f 2920 666f 7220 6f20 696e  ount(o) for o in
-0000fe80: 206f 7264 6572 735d 0a20 2020 2020 2020   orders].       
-0000fe90: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
-0000fea0: 7273 0a20 2020 2020 2020 2065 7863 6570  rs.        excep
-0000feb0: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
-0000fec0: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
-0000fed0: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
-0000fee0: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
-0000fef0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000ff00: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
-0000ff10: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
-0000ff20: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
-0000ff30: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000ff40: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
-0000ff50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000ff60: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
-0000ff70: 7420 6665 7463 6820 706f 7369 7469 6f6e  t fetch position
-0000ff80: 7320 6475 6520 746f 207b 652e 5f5f 636c  s due to {e.__cl
-0000ff90: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-0000ffa0: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-0000ffb0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000ffc0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-0000ffd0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0000ffe0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0000fff0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00010000: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-00010010: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-00010020: 6620 6665 7463 685f 7472 6164 696e 675f  f fetch_trading_
-00010030: 6665 6573 2873 656c 6629 202d 3e20 4469  fees(self) -> Di
-00010040: 6374 5b73 7472 2c20 416e 795d 3a0a 2020  ct[str, Any]:.  
-00010050: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010060: 2020 4665 7463 6820 7573 6572 2061 6363    Fetch user acc
-00010070: 6f75 6e74 2074 7261 6469 6e67 2066 6565  ount trading fee
-00010080: 730a 2020 2020 2020 2020 4361 6e20 6265  s.        Can be
-00010090: 2063 6163 6865 642c 2073 686f 756c 6420   cached, should 
-000100a0: 6e6f 7420 7570 6461 7465 206f 6674 656e  not update often
-000100b0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000100c0: 2020 2020 2020 6966 2028 7365 6c66 2e5f        if (self._
-000100d0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-000100e0: 5d20 6f72 2073 656c 662e 7472 6164 696e  ] or self.tradin
-000100f0: 675f 6d6f 6465 2021 3d20 5472 6164 696e  g_mode != Tradin
-00010100: 674d 6f64 652e 4655 5455 5245 530a 2020  gMode.FUTURES.  
-00010110: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00010120: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
-00010130: 6765 5f68 6173 2827 6665 7463 6854 7261  ge_has('fetchTra
-00010140: 6469 6e67 4665 6573 2729 293a 0a20 2020  dingFees')):.   
-00010150: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010160: 7b7d 0a20 2020 2020 2020 2074 7279 3a0a  {}.        try:.
-00010170: 2020 2020 2020 2020 2020 2020 7472 6164              trad
-00010180: 696e 675f 6665 6573 3a20 4469 6374 5b73  ing_fees: Dict[s
-00010190: 7472 2c20 416e 795d 203d 2073 656c 662e  tr, Any] = self.
-000101a0: 5f61 7069 2e66 6574 6368 5f74 7261 6469  _api.fetch_tradi
-000101b0: 6e67 5f66 6565 7328 290a 2020 2020 2020  ng_fees().      
-000101c0: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-000101d0: 6578 6368 616e 6765 5f72 6573 706f 6e73  exchange_respons
-000101e0: 6528 2766 6574 6368 5f74 7261 6469 6e67  e('fetch_trading
-000101f0: 5f66 6565 7327 2c20 7472 6164 696e 675f  _fees', trading_
-00010200: 6665 6573 290a 2020 2020 2020 2020 2020  fees).          
-00010210: 2020 7265 7475 726e 2074 7261 6469 6e67    return trading
-00010220: 5f66 6565 730a 2020 2020 2020 2020 6578  _fees.        ex
-00010230: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
-00010240: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
-00010250: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010260: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
-00010270: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
-00010280: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
-00010290: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
-000102a0: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
-000102b0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000102c0: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
-000102d0: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
-000102e0: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
-000102f0: 206e 6f74 2066 6574 6368 2074 7261 6469   not fetch tradi
-00010300: 6e67 2066 6565 7320 6475 6520 746f 207b  ng fees due to {
-00010310: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00010320: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00010330: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00010340: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00010350: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00010360: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00010370: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00010380: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00010390: 650a 0a20 2020 2040 7265 7472 6965 720a  e..    @retrier.
-000103a0: 2020 2020 6465 6620 6665 7463 685f 6269      def fetch_bi
-000103b0: 6473 5f61 736b 7328 7365 6c66 2c20 7379  ds_asks(self, sy
-000103c0: 6d62 6f6c 733a 204f 7074 696f 6e61 6c5b  mbols: Optional[
-000103d0: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
-000103e0: 652c 2063 6163 6865 643a 2062 6f6f 6c20  e, cached: bool 
-000103f0: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
-00010400: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00010410: 2020 2020 2020 3a70 6172 616d 2063 6163        :param cac
-00010420: 6865 643a 2041 6c6c 6f77 2063 6163 6865  hed: Allow cache
-00010430: 6420 7265 7375 6c74 0a20 2020 2020 2020  d result.       
-00010440: 203a 7265 7475 726e 3a20 6665 7463 685f   :return: fetch_
-00010450: 7469 636b 6572 7320 7265 7375 6c74 0a20  tickers result. 
-00010460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00010470: 2020 2069 6620 6e6f 7420 7365 6c66 2e65     if not self.e
-00010480: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
-00010490: 6368 4269 6473 4173 6b73 2729 3a0a 2020  chBidsAsks'):.  
-000104a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000104b0: 207b 7d0a 2020 2020 2020 2020 6966 2063   {}.        if c
-000104c0: 6163 6865 643a 0a20 2020 2020 2020 2020  ached:.         
-000104d0: 2020 2077 6974 6820 7365 6c66 2e5f 6361     with self._ca
-000104e0: 6368 655f 6c6f 636b 3a0a 2020 2020 2020  che_lock:.      
-000104f0: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
-00010500: 7320 3d20 7365 6c66 2e5f 6665 7463 685f  s = self._fetch_
-00010510: 7469 636b 6572 735f 6361 6368 652e 6765  tickers_cache.ge
-00010520: 7428 2766 6574 6368 5f62 6964 735f 6173  t('fetch_bids_as
-00010530: 6b73 2729 0a20 2020 2020 2020 2020 2020  ks').           
-00010540: 2069 6620 7469 636b 6572 733a 0a20 2020   if tickers:.   
-00010550: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00010560: 7572 6e20 7469 636b 6572 730a 2020 2020  urn tickers.    
-00010570: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00010580: 2020 2020 2074 6963 6b65 7273 203d 2073       tickers = s
-00010590: 656c 662e 5f61 7069 2e66 6574 6368 5f62  elf._api.fetch_b
-000105a0: 6964 735f 6173 6b73 2873 796d 626f 6c73  ids_asks(symbols
-000105b0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-000105c0: 7468 2073 656c 662e 5f63 6163 6865 5f6c  th self._cache_l
-000105d0: 6f63 6b3a 0a20 2020 2020 2020 2020 2020  ock:.           
-000105e0: 2020 2020 2073 656c 662e 5f66 6574 6368       self._fetch
-000105f0: 5f74 6963 6b65 7273 5f63 6163 6865 5b27  _tickers_cache['
-00010600: 6665 7463 685f 6269 6473 5f61 736b 7327  fetch_bids_asks'
-00010610: 5d20 3d20 7469 636b 6572 730a 2020 2020  ] = tickers.    
-00010620: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00010630: 6963 6b65 7273 0a20 2020 2020 2020 2065  ickers.        e
-00010640: 7863 6570 7420 6363 7874 2e4e 6f74 5375  xcept ccxt.NotSu
-00010650: 7070 6f72 7465 6420 6173 2065 3a0a 2020  pported as e:.  
-00010660: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010670: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00010680: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00010690: 2020 2020 2020 6627 4578 6368 616e 6765        f'Exchange
-000106a0: 207b 7365 6c66 2e5f 6170 692e 6e61 6d65   {self._api.name
-000106b0: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
-000106c0: 7274 2066 6574 6368 696e 6720 6269 6473  rt fetching bids
-000106d0: 2f61 736b 7320 696e 2062 6174 6368 2e20  /asks in batch. 
-000106e0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-000106f0: 2020 6627 4d65 7373 6167 653a 207b 657d    f'Message: {e}
-00010700: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00010710: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
-00010720: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
-00010730: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00010740: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
-00010750: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
-00010760: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
-00010770: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
-00010780: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
-00010790: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
-000107a0: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-000107b0: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
-000107c0: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
-000107d0: 6f75 6c64 206e 6f74 206c 6f61 6420 6269  ould not load bi
-000107e0: 6473 2f61 736b 7320 6475 6520 746f 207b  ds/asks due to {
-000107f0: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00010800: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00010810: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00010820: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00010830: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00010840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00010850: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00010860: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00010870: 650a 0a20 2020 2040 7265 7472 6965 720a  e..    @retrier.
-00010880: 2020 2020 6465 6620 6765 745f 7469 636b      def get_tick
-00010890: 6572 7328 7365 6c66 2c20 7379 6d62 6f6c  ers(self, symbol
-000108a0: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
-000108b0: 5b73 7472 5d5d 203d 204e 6f6e 652c 2063  [str]] = None, c
-000108c0: 6163 6865 643a 2062 6f6f 6c20 3d20 4661  ached: bool = Fa
-000108d0: 6c73 6529 202d 3e20 5469 636b 6572 733a  lse) -> Tickers:
-000108e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000108f0: 2020 2020 203a 7061 7261 6d20 6361 6368       :param cach
-00010900: 6564 3a20 416c 6c6f 7720 6361 6368 6564  ed: Allow cached
-00010910: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00010920: 3a72 6574 7572 6e3a 2066 6574 6368 5f74  :return: fetch_t
-00010930: 6963 6b65 7273 2072 6573 756c 740a 2020  ickers result.  
-00010940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010950: 2020 7469 636b 6572 733a 2054 6963 6b65    tickers: Ticke
-00010960: 7273 0a20 2020 2020 2020 2069 6620 6e6f  rs.        if no
-00010970: 7420 7365 6c66 2e65 7863 6861 6e67 655f  t self.exchange_
-00010980: 6861 7328 2766 6574 6368 5469 636b 6572  has('fetchTicker
-00010990: 7327 293a 0a20 2020 2020 2020 2020 2020  s'):.           
-000109a0: 2072 6574 7572 6e20 7b7d 0a20 2020 2020   return {}.     
-000109b0: 2020 2069 6620 6361 6368 6564 3a0a 2020     if cached:.  
-000109c0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-000109d0: 656c 662e 5f63 6163 6865 5f6c 6f63 6b3a  elf._cache_lock:
-000109e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000109f0: 2074 6963 6b65 7273 203d 2073 656c 662e   tickers = self.
-00010a00: 5f66 6574 6368 5f74 6963 6b65 7273 5f63  _fetch_tickers_c
-00010a10: 6163 6865 2e67 6574 2827 6665 7463 685f  ache.get('fetch_
-00010a20: 7469 636b 6572 7327 2920 2023 2074 7970  tickers')  # typ
-00010a30: 653a 2069 676e 6f72 650a 2020 2020 2020  e: ignore.      
-00010a40: 2020 2020 2020 6966 2074 6963 6b65 7273        if tickers
-00010a50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010a60: 2020 7265 7475 726e 2074 6963 6b65 7273    return tickers
-00010a70: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00010a80: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
-00010a90: 7320 3d20 7365 6c66 2e5f 6170 692e 6665  s = self._api.fe
-00010aa0: 7463 685f 7469 636b 6572 7328 7379 6d62  tch_tickers(symb
-00010ab0: 6f6c 7329 0a20 2020 2020 2020 2020 2020  ols).           
-00010ac0: 2077 6974 6820 7365 6c66 2e5f 6361 6368   with self._cach
-00010ad0: 655f 6c6f 636b 3a0a 2020 2020 2020 2020  e_lock:.        
-00010ae0: 2020 2020 2020 2020 7365 6c66 2e5f 6665          self._fe
-00010af0: 7463 685f 7469 636b 6572 735f 6361 6368  tch_tickers_cach
-00010b00: 655b 2766 6574 6368 5f74 6963 6b65 7273  e['fetch_tickers
-00010b10: 275d 203d 2074 6963 6b65 7273 0a20 2020  '] = tickers.   
-00010b20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010b30: 7469 636b 6572 730a 2020 2020 2020 2020  tickers.        
-00010b40: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
-00010b50: 7570 706f 7274 6564 2061 7320 653a 0a20  upported as e:. 
-00010b60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010b70: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00010b80: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-00010b90: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
-00010ba0: 6520 7b73 656c 662e 5f61 7069 2e6e 616d  e {self._api.nam
-00010bb0: 657d 2064 6f65 7320 6e6f 7420 7375 7070  e} does not supp
-00010bc0: 6f72 7420 6665 7463 6869 6e67 2074 6963  ort fetching tic
-00010bd0: 6b65 7273 2069 6e20 6261 7463 682e 2027  kers in batch. '
-00010be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010bf0: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
-00010c00: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00010c10: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-00010c20: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-00010c30: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00010c40: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-00010c50: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-00010c60: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-00010c70: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-00010c80: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-00010c90: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-00010ca0: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-00010cb0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-00010cc0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-00010cd0: 756c 6420 6e6f 7420 6c6f 6164 2074 6963  uld not load tic
-00010ce0: 6b65 7273 2064 7565 2074 6f20 7b65 2e5f  kers due to {e._
-00010cf0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00010d00: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
-00010d10: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00010d20: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-00010d30: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
-00010d40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010d50: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00010d60: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
-00010d70: 2020 2020 2320 5072 6963 696e 6720 696e      # Pricing in
-00010d80: 666f 0a0a 2020 2020 4072 6574 7269 6572  fo..    @retrier
-00010d90: 0a20 2020 2064 6566 2066 6574 6368 5f74  .    def fetch_t
-00010da0: 6963 6b65 7228 7365 6c66 2c20 7061 6972  icker(self, pair
-00010db0: 3a20 7374 7229 202d 3e20 5469 636b 6572  : str) -> Ticker
-00010dc0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-00010dd0: 2020 2020 2020 2020 2020 2069 6620 2870             if (p
-00010de0: 6169 7220 6e6f 7420 696e 2073 656c 662e  air not in self.
-00010df0: 6d61 726b 6574 7320 6f72 0a20 2020 2020  markets or.     
-00010e00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00010e10: 656c 662e 6d61 726b 6574 735b 7061 6972  elf.markets[pair
-00010e20: 5d2e 6765 7428 2761 6374 6976 6527 2c20  ].get('active', 
-00010e30: 4661 6c73 6529 2069 7320 4661 6c73 6529  False) is False)
-00010e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010e50: 2020 7261 6973 6520 4578 6368 616e 6765    raise Exchange
-00010e60: 4572 726f 7228 6622 5061 6972 207b 7061  Error(f"Pair {pa
-00010e70: 6972 7d20 6e6f 7420 6176 6169 6c61 626c  ir} not availabl
-00010e80: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
-00010e90: 6461 7461 3a20 5469 636b 6572 203d 2073  data: Ticker = s
-00010ea0: 656c 662e 5f61 7069 2e66 6574 6368 5f74  elf._api.fetch_t
-00010eb0: 6963 6b65 7228 7061 6972 290a 2020 2020  icker(pair).    
-00010ec0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00010ed0: 6174 610a 2020 2020 2020 2020 6578 6365  ata.        exce
-00010ee0: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-00010ef0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-00010f00: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-00010f10: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-00010f20: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-00010f30: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-00010f40: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-00010f50: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-00010f60: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00010f70: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-00010f80: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00010f90: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-00010fa0: 6f74 206c 6f61 6420 7469 636b 6572 2064  ot load ticker d
-00010fb0: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-00010fc0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-00010fd0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-00010fe0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-00010ff0: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-00011000: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-00011010: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00011020: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-00011030: 2920 6672 6f6d 2065 0a0a 2020 2020 4073  ) from e..    @s
-00011040: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00011050: 6465 6620 6765 745f 6e65 7874 5f6c 696d  def get_next_lim
-00011060: 6974 5f69 6e5f 6c69 7374 286c 696d 6974  it_in_list(limit
-00011070: 3a20 696e 742c 206c 696d 6974 5f72 616e  : int, limit_ran
-00011080: 6765 3a20 4f70 7469 6f6e 616c 5b4c 6973  ge: Optional[Lis
-00011090: 745b 696e 745d 5d2c 0a20 2020 2020 2020  t[int]],.       
-000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110b0: 2020 2020 2020 2020 7261 6e67 655f 7265          range_re
-000110c0: 7175 6972 6564 3a20 626f 6f6c 203d 2054  quired: bool = T
-000110d0: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-000110e0: 220a 2020 2020 2020 2020 4765 7420 6e65  ".        Get ne
-000110f0: 7874 2067 7265 6174 6572 2076 616c 7565  xt greater value
-00011100: 2069 6e20 7468 6520 6c69 7374 2e0a 2020   in the list..  
-00011110: 2020 2020 2020 5573 6564 2062 7920 6665        Used by fe
-00011120: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
-00011130: 6b20 6966 2074 6865 2061 7069 206f 6e6c  k if the api onl
-00011140: 7920 7375 7070 6f72 7473 2061 206c 696d  y supports a lim
-00011150: 6974 6564 2072 616e 6765 0a20 2020 2020  ited range.     
-00011160: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00011170: 6620 6e6f 7420 6c69 6d69 745f 7261 6e67  f not limit_rang
-00011180: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00011190: 6574 7572 6e20 6c69 6d69 740a 0a20 2020  eturn limit..   
-000111a0: 2020 2020 2072 6573 756c 7420 3d20 6d69       result = mi
-000111b0: 6e28 5b78 2066 6f72 2078 2069 6e20 6c69  n([x for x in li
-000111c0: 6d69 745f 7261 6e67 6520 6966 206c 696d  mit_range if lim
-000111d0: 6974 203c 3d20 785d 202b 205b 6d61 7828  it <= x] + [max(
-000111e0: 6c69 6d69 745f 7261 6e67 6529 5d29 0a20  limit_range)]). 
-000111f0: 2020 2020 2020 2069 6620 6e6f 7420 7261         if not ra
-00011200: 6e67 655f 7265 7175 6972 6564 2061 6e64  nge_required and
-00011210: 206c 696d 6974 203e 2072 6573 756c 743a   limit > result:
-00011220: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
-00011230: 616e 6765 2069 7320 6e6f 7420 7265 7175  ange is not requ
-00011240: 6972 6564 202d 2077 6520 6361 6e20 7573  ired - we can us
-00011250: 6520 4e6f 6e65 2061 7320 7061 7261 6d65  e None as parame
-00011260: 7465 722e 0a20 2020 2020 2020 2020 2020  ter..           
-00011270: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00011280: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00011290: 6c74 0a0a 2020 2020 4072 6574 7269 6572  lt..    @retrier
-000112a0: 0a20 2020 2064 6566 2066 6574 6368 5f6c  .    def fetch_l
-000112b0: 325f 6f72 6465 725f 626f 6f6b 2873 656c  2_order_book(sel
-000112c0: 662c 2070 6169 723a 2073 7472 2c20 6c69  f, pair: str, li
-000112d0: 6d69 743a 2069 6e74 203d 2031 3030 2920  mit: int = 100) 
-000112e0: 2d3e 204f 7264 6572 426f 6f6b 3a0a 2020  -> OrderBook:.  
-000112f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011300: 2020 4765 7420 4c32 206f 7264 6572 2062    Get L2 order b
-00011310: 6f6f 6b20 6672 6f6d 2065 7863 6861 6e67  ook from exchang
-00011320: 652e 0a20 2020 2020 2020 2043 616e 2062  e..        Can b
-00011330: 6520 6c69 6d69 7465 6420 746f 2061 2063  e limited to a c
-00011340: 6572 7461 696e 2061 6d6f 756e 7420 2869  ertain amount (i
-00011350: 6620 7375 7070 6f72 7465 6429 2e0a 2020  f supported)..  
-00011360: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
-00011370: 6469 6374 2069 6e20 7468 6520 666f 726d  dict in the form
-00011380: 6174 0a20 2020 2020 2020 207b 2761 736b  at.        {'ask
-00011390: 7327 3a20 5b70 7269 6365 2c20 766f 6c75  s': [price, volu
-000113a0: 6d65 5d2c 2027 6269 6473 273a 205b 7072  me], 'bids': [pr
-000113b0: 6963 652c 2076 6f6c 756d 655d 7d0a 2020  ice, volume]}.  
-000113c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000113d0: 2020 6c69 6d69 7431 203d 2073 656c 662e    limit1 = self.
-000113e0: 6765 745f 6e65 7874 5f6c 696d 6974 5f69  get_next_limit_i
-000113f0: 6e5f 6c69 7374 286c 696d 6974 2c20 7365  n_list(limit, se
-00011400: 6c66 2e5f 6674 5f68 6173 5b27 6c32 5f6c  lf._ft_has['l2_l
-00011410: 696d 6974 5f72 616e 6765 275d 2c0a 2020  imit_range'],.  
-00011420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e000: 2020 2073 746f 706c 6f73 735f 6f72 6465     stoploss_orde
+0000e010: 723a 2062 6f6f 6c20 3d20 4661 6c73 6529  r: bool = False)
+0000e020: 202d 3e20 4469 6374 3a0a 2020 2020 2020   -> Dict:.      
+0000e030: 2020 2222 220a 2020 2020 2020 2020 5369    """.        Si
+0000e040: 6d70 6c65 2077 7261 7070 6572 2063 616c  mple wrapper cal
+0000e050: 6c69 6e67 2065 6974 6865 7220 6665 7463  ling either fetc
+0000e060: 685f 6f72 6465 7220 6f72 2066 6574 6368  h_order or fetch
+0000e070: 5f73 746f 706c 6f73 735f 6f72 6465 7220  _stoploss_order 
+0000e080: 6465 7065 6e64 696e 6720 6f6e 0a20 2020  depending on.   
+0000e090: 2020 2020 2074 6865 2073 746f 706c 6f73       the stoplos
+0000e0a0: 735f 6f72 6465 7220 7061 7261 6d65 7465  s_order paramete
+0000e0b0: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
+0000e0c0: 206f 7264 6572 5f69 643a 204f 7264 6572   order_id: Order
+0000e0d0: 4964 2074 6f20 6665 7463 6820 6f72 6465  Id to fetch orde
+0000e0e0: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
+0000e0f0: 2070 6169 723a 2050 6169 7220 636f 7272   pair: Pair corr
+0000e100: 6573 706f 6e64 696e 6720 746f 206f 7264  esponding to ord
+0000e110: 6572 5f69 640a 2020 2020 2020 2020 3a70  er_id.        :p
+0000e120: 6172 616d 2073 746f 706c 6f73 735f 6f72  aram stoploss_or
+0000e130: 6465 723a 2049 6620 7472 7565 2c20 7573  der: If true, us
+0000e140: 6573 2066 6574 6368 5f73 746f 706c 6f73  es fetch_stoplos
+0000e150: 735f 6f72 6465 722c 206f 7468 6572 7769  s_order, otherwi
+0000e160: 7365 2066 6574 6368 5f6f 7264 6572 2e0a  se fetch_order..
+0000e170: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e180: 2020 2020 6966 2073 746f 706c 6f73 735f      if stoploss_
+0000e190: 6f72 6465 723a 0a20 2020 2020 2020 2020  order:.         
+0000e1a0: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
+0000e1b0: 6574 6368 5f73 746f 706c 6f73 735f 6f72  etch_stoploss_or
+0000e1c0: 6465 7228 6f72 6465 725f 6964 2c20 7061  der(order_id, pa
+0000e1d0: 6972 290a 2020 2020 2020 2020 7265 7475  ir).        retu
+0000e1e0: 726e 2073 656c 662e 6665 7463 685f 6f72  rn self.fetch_or
+0000e1f0: 6465 7228 6f72 6465 725f 6964 2c20 7061  der(order_id, pa
+0000e200: 6972 290a 0a20 2020 2064 6566 2063 6865  ir)..    def che
+0000e210: 636b 5f6f 7264 6572 5f63 616e 6365 6c65  ck_order_cancele
+0000e220: 645f 656d 7074 7928 7365 6c66 2c20 6f72  d_empty(self, or
+0000e230: 6465 723a 2044 6963 7429 202d 3e20 626f  der: Dict) -> bo
+0000e240: 6f6c 3a0a 2020 2020 2020 2020 2222 220a  ol:.        """.
+0000e250: 2020 2020 2020 2020 5665 7269 6679 2069          Verify i
+0000e260: 6620 616e 206f 7264 6572 2068 6173 2062  f an order has b
+0000e270: 6565 6e20 6361 6e63 656c 6c65 6420 7769  een cancelled wi
+0000e280: 7468 6f75 7420 6265 696e 6720 7061 7274  thout being part
+0000e290: 6961 6c6c 7920 6669 6c6c 6564 0a20 2020  ially filled.   
+0000e2a0: 2020 2020 203a 7061 7261 6d20 6f72 6465       :param orde
+0000e2b0: 723a 204f 7264 6572 2064 6963 7420 6173  r: Order dict as
+0000e2c0: 2072 6574 7572 6e65 6420 6672 6f6d 2066   returned from f
+0000e2d0: 6574 6368 5f6f 7264 6572 2829 0a20 2020  etch_order().   
+0000e2e0: 2020 2020 203a 7265 7475 726e 3a20 5472       :return: Tr
+0000e2f0: 7565 2069 6620 6f72 6465 7220 6861 7320  ue if order has 
+0000e300: 6265 656e 2063 616e 6365 6c6c 6564 2077  been cancelled w
+0000e310: 6974 686f 7574 2062 6569 6e67 2066 696c  ithout being fil
+0000e320: 6c65 642c 2046 616c 7365 206f 7468 6572  led, False other
+0000e330: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
+0000e340: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0000e350: 2028 6f72 6465 722e 6765 7428 2773 7461   (order.get('sta
+0000e360: 7475 7327 2920 696e 204e 4f4e 5f4f 5045  tus') in NON_OPE
+0000e370: 4e5f 4558 4348 414e 4745 5f53 5441 5445  N_EXCHANGE_STATE
+0000e380: 530a 2020 2020 2020 2020 2020 2020 2020  S.              
+0000e390: 2020 616e 6420 6f72 6465 722e 6765 7428    and order.get(
+0000e3a0: 2766 696c 6c65 6427 2920 3d3d 2030 2e30  'filled') == 0.0
+0000e3b0: 290a 0a20 2020 2040 7265 7472 6965 720a  )..    @retrier.
+0000e3c0: 2020 2020 6465 6620 6361 6e63 656c 5f6f      def cancel_o
+0000e3d0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
+0000e3e0: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
+0000e3f0: 7374 722c 2070 6172 616d 733a 2044 6963  str, params: Dic
+0000e400: 7420 3d20 7b7d 2920 2d3e 2044 6963 743a  t = {}) -> Dict:
+0000e410: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000e420: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
+0000e430: 6e27 5d3a 0a20 2020 2020 2020 2020 2020  n']:.           
+0000e440: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000e450: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000e460: 6c66 2e66 6574 6368 5f64 7279 5f72 756e  lf.fetch_dry_run
+0000e470: 5f6f 7264 6572 286f 7264 6572 5f69 6429  _order(order_id)
+0000e480: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e490: 2020 6f72 6465 722e 7570 6461 7465 287b    order.update({
+0000e4a0: 2773 7461 7475 7327 3a20 2763 616e 6365  'status': 'cance
+0000e4b0: 6c65 6427 2c20 2766 696c 6c65 6427 3a20  led', 'filled': 
+0000e4c0: 302e 302c 2027 7265 6d61 696e 696e 6727  0.0, 'remaining'
+0000e4d0: 3a20 6f72 6465 725b 2761 6d6f 756e 7427  : order['amount'
+0000e4e0: 5d7d 290a 2020 2020 2020 2020 2020 2020  ]}).            
+0000e4f0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+0000e500: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000e510: 6570 7420 496e 7661 6c69 644f 7264 6572  ept InvalidOrder
+0000e520: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000e530: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e540: 6e20 7b7d 0a0a 2020 2020 2020 2020 7472  n {}..        tr
+0000e550: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
+0000e560: 7264 6572 203d 2073 656c 662e 5f61 7069  rder = self._api
+0000e570: 2e63 616e 6365 6c5f 6f72 6465 7228 6f72  .cancel_order(or
+0000e580: 6465 725f 6964 2c20 7061 6972 2c20 7061  der_id, pair, pa
+0000e590: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
+0000e5a0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+0000e5b0: 6f67 5f65 7863 6861 6e67 655f 7265 7370  og_exchange_resp
+0000e5c0: 6f6e 7365 2827 6361 6e63 656c 5f6f 7264  onse('cancel_ord
+0000e5d0: 6572 272c 206f 7264 6572 290a 2020 2020  er', order).    
+0000e5e0: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+0000e5f0: 7365 6c66 2e5f 6f72 6465 725f 636f 6e74  self._order_cont
+0000e600: 7261 6374 735f 746f 5f61 6d6f 756e 7428  racts_to_amount(
+0000e610: 6f72 6465 7229 0a20 2020 2020 2020 2020  order).         
+0000e620: 2020 2072 6574 7572 6e20 6f72 6465 720a     return order.
+0000e630: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0000e640: 6378 742e 496e 7661 6c69 644f 7264 6572  cxt.InvalidOrder
+0000e650: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000e660: 2020 2072 6169 7365 2049 6e76 616c 6964     raise Invalid
+0000e670: 4f72 6465 7245 7863 6570 7469 6f6e 280a  OrderException(.
+0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e690: 6627 436f 756c 6420 6e6f 7420 6361 6e63  f'Could not canc
+0000e6a0: 656c 206f 7264 6572 2e20 4d65 7373 6167  el order. Messag
+0000e6b0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+0000e6c0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0000e6d0: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+0000e6e0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0000e6f0: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+0000e700: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+0000e710: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0000e720: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
+0000e730: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
+0000e740: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+0000e750: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000e760: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+0000e770: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000e780: 2020 2066 2743 6f75 6c64 206e 6f74 2063     f'Could not c
+0000e790: 616e 6365 6c20 6f72 6465 7220 6475 6520  ancel order due 
+0000e7a0: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+0000e7b0: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+0000e7c0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+0000e7d0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000e7e0: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+0000e7f0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000e800: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+0000e810: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+0000e820: 726f 6d20 650a 0a20 2020 2064 6566 2063  rom e..    def c
+0000e830: 616e 6365 6c5f 7374 6f70 6c6f 7373 5f6f  ancel_stoploss_o
+0000e840: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
+0000e850: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
+0000e860: 7374 722c 2070 6172 616d 733a 2044 6963  str, params: Dic
+0000e870: 7420 3d20 7b7d 2920 2d3e 2044 6963 743a  t = {}) -> Dict:
+0000e880: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e890: 7365 6c66 2e63 616e 6365 6c5f 6f72 6465  self.cancel_orde
+0000e8a0: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
+0000e8b0: 2c20 7061 7261 6d73 290a 0a20 2020 2064  , params)..    d
+0000e8c0: 6566 2069 735f 6361 6e63 656c 5f6f 7264  ef is_cancel_ord
+0000e8d0: 6572 5f72 6573 756c 745f 7375 6974 6162  er_result_suitab
+0000e8e0: 6c65 2873 656c 662c 2063 6f72 6465 7229  le(self, corder)
+0000e8f0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+0000e900: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0000e910: 6e63 6528 636f 7264 6572 2c20 6469 6374  nce(corder, dict
+0000e920: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000e930: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+0000e940: 2020 2020 2072 6571 7569 7265 6420 3d20       required = 
+0000e950: 2827 6665 6527 2c20 2773 7461 7475 7327  ('fee', 'status'
+0000e960: 2c20 2761 6d6f 756e 7427 290a 2020 2020  , 'amount').    
+0000e970: 2020 2020 7265 7475 726e 2061 6c6c 2863      return all(c
+0000e980: 6f72 6465 722e 6765 7428 6b2c 204e 6f6e  order.get(k, Non
+0000e990: 6529 2069 7320 6e6f 7420 4e6f 6e65 2066  e) is not None f
+0000e9a0: 6f72 206b 2069 6e20 7265 7175 6972 6564  or k in required
+0000e9b0: 290a 0a20 2020 2064 6566 2063 616e 6365  )..    def cance
+0000e9c0: 6c5f 6f72 6465 725f 7769 7468 5f72 6573  l_order_with_res
+0000e9d0: 756c 7428 7365 6c66 2c20 6f72 6465 725f  ult(self, order_
+0000e9e0: 6964 3a20 7374 722c 2070 6169 723a 2073  id: str, pair: s
+0000e9f0: 7472 2c20 616d 6f75 6e74 3a20 666c 6f61  tr, amount: floa
+0000ea00: 7429 202d 3e20 4469 6374 3a0a 2020 2020  t) -> Dict:.    
+0000ea10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ea20: 4361 6e63 656c 206f 7264 6572 2072 6574  Cancel order ret
+0000ea30: 7572 6e69 6e67 2061 2072 6573 756c 742e  urning a result.
+0000ea40: 0a20 2020 2020 2020 2043 7265 6174 6573  .        Creates
+0000ea50: 2061 2066 616b 6520 7265 7375 6c74 2069   a fake result i
+0000ea60: 6620 6361 6e63 656c 206f 7264 6572 2072  f cancel order r
+0000ea70: 6574 7572 6e73 2061 206e 6f6e 2d75 7361  eturns a non-usa
+0000ea80: 626c 6520 7265 7375 6c74 0a20 2020 2020  ble result.     
+0000ea90: 2020 2061 6e64 2066 6574 6368 5f6f 7264     and fetch_ord
+0000eaa0: 6572 2064 6f65 7320 6e6f 7420 776f 726b  er does not work
+0000eab0: 2028 6365 7274 6169 6e20 6578 6368 616e   (certain exchan
+0000eac0: 6765 7320 646f 6e27 7420 7265 7475 726e  ges don't return
+0000ead0: 2063 616e 6365 6c6c 6564 206f 7264 6572   cancelled order
+0000eae0: 7329 0a20 2020 2020 2020 203a 7061 7261  s).        :para
+0000eaf0: 6d20 6f72 6465 725f 6964 3a20 4f72 6465  m order_id: Orde
+0000eb00: 7269 6420 746f 2063 616e 6365 6c0a 2020  rid to cancel.  
+0000eb10: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+0000eb20: 723a 2050 6169 7220 636f 7272 6573 706f  r: Pair correspo
+0000eb30: 6e64 696e 6720 746f 206f 7264 6572 5f69  nding to order_i
+0000eb40: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
+0000eb50: 2061 6d6f 756e 743a 2041 6d6f 756e 7420   amount: Amount 
+0000eb60: 746f 2075 7365 2066 6f72 2066 616b 6520  to use for fake 
+0000eb70: 7265 7370 6f6e 7365 0a20 2020 2020 2020  response.       
+0000eb80: 203a 7265 7475 726e 3a20 5265 7375 6c74   :return: Result
+0000eb90: 2066 726f 6d20 6569 7468 6572 2063 616e   from either can
+0000eba0: 6365 6c5f 6f72 6465 7220 6966 2075 7361  cel_order if usa
+0000ebb0: 626c 652c 206f 7220 6665 7463 685f 6f72  ble, or fetch_or
+0000ebc0: 6465 720a 2020 2020 2020 2020 2222 220a  der.        """.
+0000ebd0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000ebe0: 2020 2020 2020 2020 2063 6f72 6465 7220           corder 
+0000ebf0: 3d20 7365 6c66 2e63 616e 6365 6c5f 6f72  = self.cancel_or
+0000ec00: 6465 7228 6f72 6465 725f 6964 2c20 7061  der(order_id, pa
+0000ec10: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+0000ec20: 6966 2073 656c 662e 6973 5f63 616e 6365  if self.is_cance
+0000ec30: 6c5f 6f72 6465 725f 7265 7375 6c74 5f73  l_order_result_s
+0000ec40: 7569 7461 626c 6528 636f 7264 6572 293a  uitable(corder):
+0000ec50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ec60: 2072 6574 7572 6e20 636f 7264 6572 0a20   return corder. 
+0000ec70: 2020 2020 2020 2065 7863 6570 7420 496e         except In
+0000ec80: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
+0000ec90: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0000eca0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+0000ecb0: 6622 436f 756c 6420 6e6f 7420 6361 6e63  f"Could not canc
+0000ecc0: 656c 206f 7264 6572 207b 6f72 6465 725f  el order {order_
+0000ecd0: 6964 7d20 666f 7220 7b70 6169 727d 2e22  id} for {pair}."
+0000ece0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+0000ecf0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000ed00: 203d 2073 656c 662e 6665 7463 685f 6f72   = self.fetch_or
+0000ed10: 6465 7228 6f72 6465 725f 6964 2c20 7061  der(order_id, pa
+0000ed20: 6972 290a 2020 2020 2020 2020 6578 6365  ir).        exce
+0000ed30: 7074 2049 6e76 616c 6964 4f72 6465 7245  pt InvalidOrderE
+0000ed40: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+0000ed50: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0000ed60: 6e69 6e67 2866 2243 6f75 6c64 206e 6f74  ning(f"Could not
+0000ed70: 2066 6574 6368 2063 616e 6365 6c6c 6564   fetch cancelled
+0000ed80: 206f 7264 6572 207b 6f72 6465 725f 6964   order {order_id
+0000ed90: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
+0000eda0: 206f 7264 6572 203d 207b 0a20 2020 2020   order = {.     
+0000edb0: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
+0000edc0: 206f 7264 6572 5f69 642c 0a20 2020 2020   order_id,.     
+0000edd0: 2020 2020 2020 2020 2020 2027 7374 6174             'stat
+0000ede0: 7573 273a 2027 6361 6e63 656c 6564 272c  us': 'canceled',
+0000edf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee00: 2027 616d 6f75 6e74 273a 2061 6d6f 756e   'amount': amoun
+0000ee10: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0000ee20: 2020 2027 6669 6c6c 6564 273a 2030 2e30     'filled': 0.0
+0000ee30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ee40: 2020 2766 6565 273a 207b 7d2c 0a20 2020    'fee': {},.   
+0000ee50: 2020 2020 2020 2020 2020 2020 2027 696e               'in
+0000ee60: 666f 273a 207b 7d0a 2020 2020 2020 2020  fo': {}.        
+0000ee70: 2020 2020 7d0a 0a20 2020 2020 2020 2072      }..        r
+0000ee80: 6574 7572 6e20 6f72 6465 720a 0a20 2020  eturn order..   
+0000ee90: 2064 6566 2063 616e 6365 6c5f 7374 6f70   def cancel_stop
+0000eea0: 6c6f 7373 5f6f 7264 6572 5f77 6974 685f  loss_order_with_
+0000eeb0: 7265 7375 6c74 2873 656c 662c 206f 7264  result(self, ord
+0000eec0: 6572 5f69 643a 2073 7472 2c20 7061 6972  er_id: str, pair
+0000eed0: 3a20 7374 722c 2061 6d6f 756e 743a 2066  : str, amount: f
+0000eee0: 6c6f 6174 2920 2d3e 2044 6963 743a 0a20  loat) -> Dict:. 
+0000eef0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000ef00: 2020 2043 616e 6365 6c20 7374 6f70 6c6f     Cancel stoplo
+0000ef10: 7373 206f 7264 6572 2072 6574 7572 6e69  ss order returni
+0000ef20: 6e67 2061 2072 6573 756c 742e 0a20 2020  ng a result..   
+0000ef30: 2020 2020 2043 7265 6174 6573 2061 2066       Creates a f
+0000ef40: 616b 6520 7265 7375 6c74 2069 6620 6361  ake result if ca
+0000ef50: 6e63 656c 206f 7264 6572 2072 6574 7572  ncel order retur
+0000ef60: 6e73 2061 206e 6f6e 2d75 7361 626c 6520  ns a non-usable 
+0000ef70: 7265 7375 6c74 0a20 2020 2020 2020 2061  result.        a
+0000ef80: 6e64 2066 6574 6368 5f6f 7264 6572 2064  nd fetch_order d
+0000ef90: 6f65 7320 6e6f 7420 776f 726b 2028 6365  oes not work (ce
+0000efa0: 7274 6169 6e20 6578 6368 616e 6765 7320  rtain exchanges 
+0000efb0: 646f 6e27 7420 7265 7475 726e 2063 616e  don't return can
+0000efc0: 6365 6c6c 6564 206f 7264 6572 7329 0a20  celled orders). 
+0000efd0: 2020 2020 2020 203a 7061 7261 6d20 6f72         :param or
+0000efe0: 6465 725f 6964 3a20 7374 6f70 6c6f 7373  der_id: stoploss
+0000eff0: 2d6f 7264 6572 2d69 6420 746f 2063 616e  -order-id to can
+0000f000: 6365 6c0a 2020 2020 2020 2020 3a70 6172  cel.        :par
+0000f010: 616d 2070 6169 723a 2050 6169 7220 636f  am pair: Pair co
+0000f020: 7272 6573 706f 6e64 696e 6720 746f 206f  rresponding to o
+0000f030: 7264 6572 5f69 640a 2020 2020 2020 2020  rder_id.        
+0000f040: 3a70 6172 616d 2061 6d6f 756e 743a 2041  :param amount: A
+0000f050: 6d6f 756e 7420 746f 2075 7365 2066 6f72  mount to use for
+0000f060: 2066 616b 6520 7265 7370 6f6e 7365 0a20   fake response. 
+0000f070: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0000f080: 5265 7375 6c74 2066 726f 6d20 6569 7468  Result from eith
+0000f090: 6572 2063 616e 6365 6c5f 6f72 6465 7220  er cancel_order 
+0000f0a0: 6966 2075 7361 626c 652c 206f 7220 6665  if usable, or fe
+0000f0b0: 7463 685f 6f72 6465 720a 2020 2020 2020  tch_order.      
+0000f0c0: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
+0000f0d0: 7264 6572 203d 2073 656c 662e 6361 6e63  rder = self.canc
+0000f0e0: 656c 5f73 746f 706c 6f73 735f 6f72 6465  el_stoploss_orde
+0000f0f0: 7228 6f72 6465 725f 6964 2c20 7061 6972  r(order_id, pair
+0000f100: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+0000f110: 662e 6973 5f63 616e 6365 6c5f 6f72 6465  f.is_cancel_orde
+0000f120: 725f 7265 7375 6c74 5f73 7569 7461 626c  r_result_suitabl
+0000f130: 6528 636f 7264 6572 293a 0a20 2020 2020  e(corder):.     
+0000f140: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0000f150: 7264 6572 0a20 2020 2020 2020 2074 7279  rder.        try
+0000f160: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+0000f170: 6465 7220 3d20 7365 6c66 2e66 6574 6368  der = self.fetch
+0000f180: 5f73 746f 706c 6f73 735f 6f72 6465 7228  _stoploss_order(
+0000f190: 6f72 6465 725f 6964 2c20 7061 6972 290a  order_id, pair).
+0000f1a0: 2020 2020 2020 2020 6578 6365 7074 2049          except I
+0000f1b0: 6e76 616c 6964 4f72 6465 7245 7863 6570  nvalidOrderExcep
+0000f1c0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0000f1d0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+0000f1e0: 2866 2243 6f75 6c64 206e 6f74 2066 6574  (f"Could not fet
+0000f1f0: 6368 2063 616e 6365 6c6c 6564 2073 746f  ch cancelled sto
+0000f200: 706c 6f73 7320 6f72 6465 7220 7b6f 7264  ploss order {ord
+0000f210: 6572 5f69 647d 2e22 290a 2020 2020 2020  er_id}.").      
+0000f220: 2020 2020 2020 6f72 6465 7220 3d20 7b27        order = {'
+0000f230: 6665 6527 3a20 7b7d 2c20 2773 7461 7475  fee': {}, 'statu
+0000f240: 7327 3a20 2763 616e 6365 6c65 6427 2c20  s': 'canceled', 
+0000f250: 2761 6d6f 756e 7427 3a20 616d 6f75 6e74  'amount': amount
+0000f260: 2c20 2769 6e66 6f27 3a20 7b7d 7d0a 0a20  , 'info': {}}.. 
+0000f270: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+0000f280: 6465 720a 0a20 2020 2040 7265 7472 6965  der..    @retrie
+0000f290: 720a 2020 2020 6465 6620 6765 745f 6261  r.    def get_ba
+0000f2a0: 6c61 6e63 6573 2873 656c 6629 202d 3e20  lances(self) -> 
+0000f2b0: 6469 6374 3a0a 0a20 2020 2020 2020 2074  dict:..        t
+0000f2c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000f2d0: 6261 6c61 6e63 6573 203d 2073 656c 662e  balances = self.
+0000f2e0: 5f61 7069 2e66 6574 6368 5f62 616c 616e  _api.fetch_balan
+0000f2f0: 6365 2829 0a20 2020 2020 2020 2020 2020  ce().           
+0000f300: 2023 2052 656d 6f76 6520 6164 6469 7469   # Remove additi
+0000f310: 6f6e 616c 2069 6e66 6f20 6672 6f6d 2063  onal info from c
+0000f320: 6378 7420 7265 7375 6c74 730a 2020 2020  cxt results.    
+0000f330: 2020 2020 2020 2020 6261 6c61 6e63 6573          balances
+0000f340: 2e70 6f70 2822 696e 666f 222c 204e 6f6e  .pop("info", Non
+0000f350: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
+0000f360: 616c 616e 6365 732e 706f 7028 2266 7265  alances.pop("fre
+0000f370: 6522 2c20 4e6f 6e65 290a 2020 2020 2020  e", None).      
+0000f380: 2020 2020 2020 6261 6c61 6e63 6573 2e70        balances.p
+0000f390: 6f70 2822 746f 7461 6c22 2c20 4e6f 6e65  op("total", None
+0000f3a0: 290a 2020 2020 2020 2020 2020 2020 6261  ).            ba
+0000f3b0: 6c61 6e63 6573 2e70 6f70 2822 7573 6564  lances.pop("used
+0000f3c0: 222c 204e 6f6e 6529 0a0a 2020 2020 2020  ", None)..      
+0000f3d0: 2020 2020 2020 7265 7475 726e 2062 616c        return bal
+0000f3e0: 616e 6365 730a 2020 2020 2020 2020 6578  ances.        ex
+0000f3f0: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+0000f400: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+0000f410: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f420: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+0000f430: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+0000f440: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
+0000f450: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
+0000f460: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
+0000f470: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000f480: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
+0000f490: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
+0000f4a0: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+0000f4b0: 206e 6f74 2067 6574 2062 616c 616e 6365   not get balance
+0000f4c0: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
+0000f4d0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
+0000f4e0: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
+0000f4f0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+0000f500: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
+0000f510: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+0000f520: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+0000f530: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+0000f540: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
+0000f550: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
+0000f560: 2066 6574 6368 5f70 6f73 6974 696f 6e73   fetch_positions
+0000f570: 2873 656c 662c 2070 6169 723a 204f 7074  (self, pair: Opt
+0000f580: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+0000f590: 6529 202d 3e20 4c69 7374 5b44 6963 745d  e) -> List[Dict]
+0000f5a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000f5b0: 2020 2020 2020 4665 7463 6820 706f 7369        Fetch posi
+0000f5c0: 7469 6f6e 7320 6672 6f6d 2074 6865 2065  tions from the e
+0000f5d0: 7863 6861 6e67 652e 0a20 2020 2020 2020  xchange..       
+0000f5e0: 2049 6620 6e6f 2070 6169 7220 6973 2067   If no pair is g
+0000f5f0: 6976 656e 2c20 616c 6c20 706f 7369 7469  iven, all positi
+0000f600: 6f6e 7320 6172 6520 7265 7475 726e 6564  ons are returned
+0000f610: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000f620: 2070 6169 723a 2050 6169 7220 666f 7220   pair: Pair for 
+0000f630: 7468 6520 7175 6572 790a 2020 2020 2020  the query.      
+0000f640: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000f650: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
+0000f660: 7279 5f72 756e 275d 206f 7220 7365 6c66  ry_run'] or self
+0000f670: 2e74 7261 6469 6e67 5f6d 6f64 6520 213d  .trading_mode !=
+0000f680: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
+0000f690: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
+0000f6a0: 2020 7265 7475 726e 205b 5d0a 2020 2020    return [].    
+0000f6b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000f6c0: 2020 2020 2073 796d 626f 6c73 203d 205b       symbols = [
+0000f6d0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0000f6e0: 2070 6169 723a 0a20 2020 2020 2020 2020   pair:.         
+0000f6f0: 2020 2020 2020 2073 796d 626f 6c73 2e61         symbols.a
+0000f700: 7070 656e 6428 7061 6972 290a 2020 2020  ppend(pair).    
+0000f710: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+0000f720: 733a 204c 6973 745b 4469 6374 5d20 3d20  s: List[Dict] = 
+0000f730: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
+0000f740: 706f 7369 7469 6f6e 7328 7379 6d62 6f6c  positions(symbol
+0000f750: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
+0000f760: 656c 662e 5f6c 6f67 5f65 7863 6861 6e67  elf._log_exchang
+0000f770: 655f 7265 7370 6f6e 7365 2827 6665 7463  e_response('fetc
+0000f780: 685f 706f 7369 7469 6f6e 7327 2c20 706f  h_positions', po
+0000f790: 7369 7469 6f6e 7329 0a20 2020 2020 2020  sitions).       
+0000f7a0: 2020 2020 2072 6574 7572 6e20 706f 7369       return posi
+0000f7b0: 7469 6f6e 730a 2020 2020 2020 2020 6578  tions.        ex
+0000f7c0: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+0000f7d0: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+0000f7e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f7f0: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+0000f800: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+0000f810: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
+0000f820: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
+0000f830: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
+0000f840: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000f850: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
+0000f860: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
+0000f870: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+0000f880: 206e 6f74 2067 6574 2070 6f73 6974 696f   not get positio
+0000f890: 6e73 2064 7565 2074 6f20 7b65 2e5f 5f63  ns due to {e.__c
+0000f8a0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0000f8b0: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+0000f8c0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000f8d0: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
+0000f8e0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000f8f0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0000f900: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0000f910: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
+0000f920: 2020 4072 6574 7269 6572 2872 6574 7269    @retrier(retri
+0000f930: 6573 3d30 290a 2020 2020 6465 6620 6665  es=0).    def fe
+0000f940: 7463 685f 6f72 6465 7273 2873 656c 662c  tch_orders(self,
+0000f950: 2070 6169 723a 2073 7472 2c20 7369 6e63   pair: str, sinc
+0000f960: 653a 2064 6174 6574 696d 6529 202d 3e20  e: datetime) -> 
+0000f970: 4c69 7374 5b44 6963 745d 3a0a 2020 2020  List[Dict]:.    
+0000f980: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000f990: 4665 7463 6820 616c 6c20 6f72 6465 7273  Fetch all orders
+0000f9a0: 2066 6f72 2061 2070 6169 7220 2273 696e   for a pair "sin
+0000f9b0: 6365 220a 2020 2020 2020 2020 3a70 6172  ce".        :par
+0000f9c0: 616d 2070 6169 723a 2050 6169 7220 666f  am pair: Pair fo
+0000f9d0: 7220 7468 6520 7175 6572 790a 2020 2020  r the query.    
+0000f9e0: 2020 2020 3a70 6172 616d 2073 696e 6365      :param since
+0000f9f0: 3a20 5374 6172 7469 6e67 2074 696d 6520  : Starting time 
+0000fa00: 666f 7220 7468 6520 7175 6572 790a 2020  for the query.  
+0000fa10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000fa20: 2020 6966 2073 656c 662e 5f63 6f6e 6669    if self._confi
+0000fa30: 675b 2764 7279 5f72 756e 275d 3a0a 2020  g['dry_run']:.  
+0000fa40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fa50: 205b 5d0a 0a20 2020 2020 2020 2064 6566   []..        def
+0000fa60: 2066 6574 6368 5f6f 7264 6572 735f 656d   fetch_orders_em
+0000fa70: 756c 6174 6528 2920 2d3e 204c 6973 745b  ulate() -> List[
+0000fa80: 4469 6374 5d3a 0a20 2020 2020 2020 2020  Dict]:.         
+0000fa90: 2020 206f 7264 6572 7320 3d20 5b5d 0a20     orders = []. 
+0000faa0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000fab0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+0000fac0: 2766 6574 6368 436c 6f73 6564 4f72 6465  'fetchClosedOrde
+0000fad0: 7273 2729 3a0a 2020 2020 2020 2020 2020  rs'):.          
+0000fae0: 2020 2020 2020 6f72 6465 7273 203d 2073        orders = s
+0000faf0: 656c 662e 5f61 7069 2e66 6574 6368 5f63  elf._api.fetch_c
+0000fb00: 6c6f 7365 645f 6f72 6465 7273 2870 6169  losed_orders(pai
+0000fb10: 722c 2073 696e 6365 3d73 696e 6365 5f6d  r, since=since_m
+0000fb20: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000fb30: 2020 2069 6620 7365 6c66 2e65 7863 6861     if self.excha
+0000fb40: 6e67 655f 6861 7328 2766 6574 6368 4f70  nge_has('fetchOp
+0000fb50: 656e 4f72 6465 7273 2729 3a0a 2020 2020  enOrders'):.    
+0000fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb70: 6f72 6465 7273 5f6f 7065 6e20 3d20 7365  orders_open = se
+0000fb80: 6c66 2e5f 6170 692e 6665 7463 685f 6f70  lf._api.fetch_op
+0000fb90: 656e 5f6f 7264 6572 7328 7061 6972 2c20  en_orders(pair, 
+0000fba0: 7369 6e63 653d 7369 6e63 655f 6d73 290a  since=since_ms).
+0000fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbc0: 2020 2020 6f72 6465 7273 2e65 7874 656e      orders.exten
+0000fbd0: 6428 6f72 6465 7273 5f6f 7065 6e29 0a20  d(orders_open). 
+0000fbe0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000fbf0: 6e20 6f72 6465 7273 0a0a 2020 2020 2020  n orders..      
+0000fc00: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000fc10: 2020 2073 696e 6365 5f6d 7320 3d20 696e     since_ms = in
+0000fc20: 7428 2873 696e 6365 2e74 696d 6573 7461  t((since.timesta
+0000fc30: 6d70 2829 202d 2031 3029 202a 2031 3030  mp() - 10) * 100
+0000fc40: 3029 0a20 2020 2020 2020 2020 2020 2069  0).            i
+0000fc50: 6620 7365 6c66 2e65 7863 6861 6e67 655f  f self.exchange_
+0000fc60: 6861 7328 2766 6574 6368 4f72 6465 7273  has('fetchOrders
+0000fc70: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0000fc80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000fc90: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0000fca0: 6572 733a 204c 6973 745b 4469 6374 5d20  ers: List[Dict] 
+0000fcb0: 3d20 7365 6c66 2e5f 6170 692e 6665 7463  = self._api.fetc
+0000fcc0: 685f 6f72 6465 7273 2870 6169 722c 2073  h_orders(pair, s
+0000fcd0: 696e 6365 3d73 696e 6365 5f6d 7329 0a20  ince=since_ms). 
+0000fce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000fcf0: 7863 6570 7420 6363 7874 2e4e 6f74 5375  xcept ccxt.NotSu
+0000fd00: 7070 6f72 7465 643a 0a20 2020 2020 2020  pported:.       
+0000fd10: 2020 2020 2020 2020 2020 2020 2023 2053               # S
+0000fd20: 6f6d 6520 6578 6368 616e 6765 7320 646f  ome exchanges do
+0000fd30: 6e27 7420 7375 7070 6f72 7420 6665 7463  n't support fetc
+0000fd40: 684f 7264 6572 730a 2020 2020 2020 2020  hOrders.        
+0000fd50: 2020 2020 2020 2020 2020 2020 2320 6174              # at
+0000fd60: 7465 6d70 7420 746f 2066 6574 6368 206f  tempt to fetch o
+0000fd70: 7065 6e20 616e 6420 636c 6f73 6564 206f  pen and closed o
+0000fd80: 7264 6572 7320 7365 7061 7261 7465 6c79  rders separately
+0000fd90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fda0: 2020 2020 206f 7264 6572 7320 3d20 6665       orders = fe
+0000fdb0: 7463 685f 6f72 6465 7273 5f65 6d75 6c61  tch_orders_emula
+0000fdc0: 7465 2829 0a20 2020 2020 2020 2020 2020  te().           
+0000fdd0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000fde0: 2020 2020 2020 206f 7264 6572 7320 3d20         orders = 
+0000fdf0: 6665 7463 685f 6f72 6465 7273 5f65 6d75  fetch_orders_emu
+0000fe00: 6c61 7465 2829 0a20 2020 2020 2020 2020  late().         
+0000fe10: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+0000fe20: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+0000fe30: 6665 7463 685f 6f72 6465 7273 272c 206f  fetch_orders', o
+0000fe40: 7264 6572 7329 0a20 2020 2020 2020 2020  rders).         
+0000fe50: 2020 206f 7264 6572 7320 3d20 5b73 656c     orders = [sel
+0000fe60: 662e 5f6f 7264 6572 5f63 6f6e 7472 6163  f._order_contrac
+0000fe70: 7473 5f74 6f5f 616d 6f75 6e74 286f 2920  ts_to_amount(o) 
+0000fe80: 666f 7220 6f20 696e 206f 7264 6572 735d  for o in orders]
+0000fe90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000fea0: 7572 6e20 6f72 6465 7273 0a20 2020 2020  urn orders.     
+0000feb0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+0000fec0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+0000fed0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000fee0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+0000fef0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+0000ff00: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+0000ff10: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+0000ff20: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0000ff30: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0000ff40: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0000ff50: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0000ff60: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0000ff70: 436f 756c 6420 6e6f 7420 6665 7463 6820  Could not fetch 
+0000ff80: 706f 7369 7469 6f6e 7320 6475 6520 746f  positions due to
+0000ff90: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0000ffa0: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0000ffb0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0000ffc0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000ffd0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+0000ffe0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000fff0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+00010000: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+00010010: 6d20 650a 0a20 2020 2040 7265 7472 6965  m e..    @retrie
+00010020: 720a 2020 2020 6465 6620 6665 7463 685f  r.    def fetch_
+00010030: 7472 6164 696e 675f 6665 6573 2873 656c  trading_fees(sel
+00010040: 6629 202d 3e20 4469 6374 5b73 7472 2c20  f) -> Dict[str, 
+00010050: 416e 795d 3a0a 2020 2020 2020 2020 2222  Any]:.        ""
+00010060: 220a 2020 2020 2020 2020 4665 7463 6820  ".        Fetch 
+00010070: 7573 6572 2061 6363 6f75 6e74 2074 7261  user account tra
+00010080: 6469 6e67 2066 6565 730a 2020 2020 2020  ding fees.      
+00010090: 2020 4361 6e20 6265 2063 6163 6865 642c    Can be cached,
+000100a0: 2073 686f 756c 6420 6e6f 7420 7570 6461   should not upda
+000100b0: 7465 206f 6674 656e 2e0a 2020 2020 2020  te often..      
+000100c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+000100d0: 2028 7365 6c66 2e5f 636f 6e66 6967 5b27   (self._config['
+000100e0: 6472 795f 7275 6e27 5d20 6f72 2073 656c  dry_run'] or sel
+000100f0: 662e 7472 6164 696e 675f 6d6f 6465 2021  f.trading_mode !
+00010100: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
+00010110: 5455 5245 530a 2020 2020 2020 2020 2020  TURES.          
+00010120: 2020 2020 2020 6f72 206e 6f74 2073 656c        or not sel
+00010130: 662e 6578 6368 616e 6765 5f68 6173 2827  f.exchange_has('
+00010140: 6665 7463 6854 7261 6469 6e67 4665 6573  fetchTradingFees
+00010150: 2729 293a 0a20 2020 2020 2020 2020 2020  ')):.           
+00010160: 2072 6574 7572 6e20 7b7d 0a20 2020 2020   return {}.     
+00010170: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00010180: 2020 2020 7472 6164 696e 675f 6665 6573      trading_fees
+00010190: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
+000101a0: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
+000101b0: 6368 5f74 7261 6469 6e67 5f66 6565 7328  ch_trading_fees(
+000101c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000101d0: 6c66 2e5f 6c6f 675f 6578 6368 616e 6765  lf._log_exchange
+000101e0: 5f72 6573 706f 6e73 6528 2766 6574 6368  _response('fetch
+000101f0: 5f74 7261 6469 6e67 5f66 6565 7327 2c20  _trading_fees', 
+00010200: 7472 6164 696e 675f 6665 6573 290a 2020  trading_fees).  
+00010210: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010220: 2074 7261 6469 6e67 5f66 6565 730a 2020   trading_fees.  
+00010230: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+00010240: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+00010250: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00010260: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+00010270: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+00010280: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00010290: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
+000102a0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
+000102b0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+000102c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000102d0: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+000102e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000102f0: 2066 2743 6f75 6c64 206e 6f74 2066 6574   f'Could not fet
+00010300: 6368 2074 7261 6469 6e67 2066 6565 7320  ch trading fees 
+00010310: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
+00010320: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
+00010330: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
+00010340: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00010350: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
+00010360: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00010370: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00010380: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00010390: 6529 2066 726f 6d20 650a 0a20 2020 2040  e) from e..    @
+000103a0: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
+000103b0: 6665 7463 685f 6269 6473 5f61 736b 7328  fetch_bids_asks(
+000103c0: 7365 6c66 2c20 7379 6d62 6f6c 733a 204f  self, symbols: O
+000103d0: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+000103e0: 5d5d 203d 204e 6f6e 652c 2063 6163 6865  ]] = None, cache
+000103f0: 643a 2062 6f6f 6c20 3d20 4661 6c73 6529  d: bool = False)
+00010400: 202d 3e20 4469 6374 3a0a 2020 2020 2020   -> Dict:.      
+00010410: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+00010420: 6172 616d 2063 6163 6865 643a 2041 6c6c  aram cached: All
+00010430: 6f77 2063 6163 6865 6420 7265 7375 6c74  ow cached result
+00010440: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00010450: 3a20 6665 7463 685f 7469 636b 6572 7320  : fetch_tickers 
+00010460: 7265 7375 6c74 0a20 2020 2020 2020 2022  result.        "
+00010470: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00010480: 7420 7365 6c66 2e65 7863 6861 6e67 655f  t self.exchange_
+00010490: 6861 7328 2766 6574 6368 4269 6473 4173  has('fetchBidsAs
+000104a0: 6b73 2729 3a0a 2020 2020 2020 2020 2020  ks'):.          
+000104b0: 2020 7265 7475 726e 207b 7d0a 2020 2020    return {}.    
+000104c0: 2020 2020 6966 2063 6163 6865 643a 0a20      if cached:. 
+000104d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+000104e0: 7365 6c66 2e5f 6361 6368 655f 6c6f 636b  self._cache_lock
+000104f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010500: 2020 7469 636b 6572 7320 3d20 7365 6c66    tickers = self
+00010510: 2e5f 6665 7463 685f 7469 636b 6572 735f  ._fetch_tickers_
+00010520: 6361 6368 652e 6765 7428 2766 6574 6368  cache.get('fetch
+00010530: 5f62 6964 735f 6173 6b73 2729 0a20 2020  _bids_asks').   
+00010540: 2020 2020 2020 2020 2069 6620 7469 636b           if tick
+00010550: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+00010560: 2020 2020 2072 6574 7572 6e20 7469 636b       return tick
+00010570: 6572 730a 2020 2020 2020 2020 7472 793a  ers.        try:
+00010580: 0a20 2020 2020 2020 2020 2020 2074 6963  .            tic
+00010590: 6b65 7273 203d 2073 656c 662e 5f61 7069  kers = self._api
+000105a0: 2e66 6574 6368 5f62 6964 735f 6173 6b73  .fetch_bids_asks
+000105b0: 2873 796d 626f 6c73 290a 2020 2020 2020  (symbols).      
+000105c0: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
+000105d0: 5f63 6163 6865 5f6c 6f63 6b3a 0a20 2020  _cache_lock:.   
+000105e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000105f0: 662e 5f66 6574 6368 5f74 6963 6b65 7273  f._fetch_tickers
+00010600: 5f63 6163 6865 5b27 6665 7463 685f 6269  _cache['fetch_bi
+00010610: 6473 5f61 736b 7327 5d20 3d20 7469 636b  ds_asks'] = tick
+00010620: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
+00010630: 7265 7475 726e 2074 6963 6b65 7273 0a20  return tickers. 
+00010640: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+00010650: 7874 2e4e 6f74 5375 7070 6f72 7465 6420  xt.NotSupported 
+00010660: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00010670: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00010680: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
+00010690: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+000106a0: 4578 6368 616e 6765 207b 7365 6c66 2e5f  Exchange {self._
+000106b0: 6170 692e 6e61 6d65 7d20 646f 6573 206e  api.name} does n
+000106c0: 6f74 2073 7570 706f 7274 2066 6574 6368  ot support fetch
+000106d0: 696e 6720 6269 6473 2f61 736b 7320 696e  ing bids/asks in
+000106e0: 2062 6174 6368 2e20 270a 2020 2020 2020   batch. '.      
+000106f0: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
+00010700: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+00010710: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00010720: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
+00010730: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00010740: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
+00010750: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
+00010760: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+00010770: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
+00010780: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
+00010790: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
+000107a0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000107b0: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
+000107c0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+000107d0: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
+000107e0: 206c 6f61 6420 6269 6473 2f61 736b 7320   load bids/asks 
+000107f0: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
+00010800: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
+00010810: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
+00010820: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00010830: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
+00010840: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+00010850: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00010860: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00010870: 6529 2066 726f 6d20 650a 0a20 2020 2040  e) from e..    @
+00010880: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
+00010890: 6765 745f 7469 636b 6572 7328 7365 6c66  get_tickers(self
+000108a0: 2c20 7379 6d62 6f6c 733a 204f 7074 696f  , symbols: Optio
+000108b0: 6e61 6c5b 4c69 7374 5b73 7472 5d5d 203d  nal[List[str]] =
+000108c0: 204e 6f6e 652c 2063 6163 6865 643a 2062   None, cached: b
+000108d0: 6f6f 6c20 3d20 4661 6c73 6529 202d 3e20  ool = False) -> 
+000108e0: 5469 636b 6572 733a 0a20 2020 2020 2020  Tickers:.       
+000108f0: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+00010900: 7261 6d20 6361 6368 6564 3a20 416c 6c6f  ram cached: Allo
+00010910: 7720 6361 6368 6564 2072 6573 756c 740a  w cached result.
+00010920: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00010930: 2066 6574 6368 5f74 6963 6b65 7273 2072   fetch_tickers r
+00010940: 6573 756c 740a 2020 2020 2020 2020 2222  esult.        ""
+00010950: 220a 2020 2020 2020 2020 7469 636b 6572  ".        ticker
+00010960: 733a 2054 6963 6b65 7273 0a20 2020 2020  s: Tickers.     
+00010970: 2020 2069 6620 6e6f 7420 7365 6c66 2e65     if not self.e
+00010980: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
+00010990: 6368 5469 636b 6572 7327 293a 0a20 2020  chTickers'):.   
+000109a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000109b0: 7b7d 0a20 2020 2020 2020 2069 6620 6361  {}.        if ca
+000109c0: 6368 6564 3a0a 2020 2020 2020 2020 2020  ched:.          
+000109d0: 2020 7769 7468 2073 656c 662e 5f63 6163    with self._cac
+000109e0: 6865 5f6c 6f63 6b3a 0a20 2020 2020 2020  he_lock:.       
+000109f0: 2020 2020 2020 2020 2074 6963 6b65 7273           tickers
+00010a00: 203d 2073 656c 662e 5f66 6574 6368 5f74   = self._fetch_t
+00010a10: 6963 6b65 7273 5f63 6163 6865 2e67 6574  ickers_cache.get
+00010a20: 2827 6665 7463 685f 7469 636b 6572 7327  ('fetch_tickers'
+00010a30: 2920 2023 2074 7970 653a 2069 676e 6f72  )  # type: ignor
+00010a40: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00010a50: 2074 6963 6b65 7273 3a0a 2020 2020 2020   tickers:.      
+00010a60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010a70: 2074 6963 6b65 7273 0a20 2020 2020 2020   tickers.       
+00010a80: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00010a90: 2020 7469 636b 6572 7320 3d20 7365 6c66    tickers = self
+00010aa0: 2e5f 6170 692e 6665 7463 685f 7469 636b  ._api.fetch_tick
+00010ab0: 6572 7328 7379 6d62 6f6c 7329 0a20 2020  ers(symbols).   
+00010ac0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+00010ad0: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
+00010ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010af0: 7365 6c66 2e5f 6665 7463 685f 7469 636b  self._fetch_tick
+00010b00: 6572 735f 6361 6368 655b 2766 6574 6368  ers_cache['fetch
+00010b10: 5f74 6963 6b65 7273 275d 203d 2074 6963  _tickers'] = tic
+00010b20: 6b65 7273 0a20 2020 2020 2020 2020 2020  kers.           
+00010b30: 2072 6574 7572 6e20 7469 636b 6572 730a   return tickers.
+00010b40: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00010b50: 6378 742e 4e6f 7453 7570 706f 7274 6564  cxt.NotSupported
+00010b60: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00010b70: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00010b80: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
+00010b90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010ba0: 2745 7863 6861 6e67 6520 7b73 656c 662e  'Exchange {self.
+00010bb0: 5f61 7069 2e6e 616d 657d 2064 6f65 7320  _api.name} does 
+00010bc0: 6e6f 7420 7375 7070 6f72 7420 6665 7463  not support fetc
+00010bd0: 6869 6e67 2074 6963 6b65 7273 2069 6e20  hing tickers in 
+00010be0: 6261 7463 682e 2027 0a20 2020 2020 2020  batch. '.       
+00010bf0: 2020 2020 2020 2020 2066 274d 6573 7361           f'Messa
+00010c00: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00010c10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00010c20: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+00010c30: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00010c40: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+00010c50: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+00010c60: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00010c70: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
+00010c80: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
+00010c90: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+00010ca0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00010cb0: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+00010cc0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00010cd0: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+00010ce0: 6c6f 6164 2074 6963 6b65 7273 2064 7565  load tickers due
+00010cf0: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
+00010d00: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
+00010d10: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+00010d20: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00010d30: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
+00010d40: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00010d50: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00010d60: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
+00010d70: 6672 6f6d 2065 0a0a 2020 2020 2320 5072  from e..    # Pr
+00010d80: 6963 696e 6720 696e 666f 0a0a 2020 2020  icing info..    
+00010d90: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
+00010da0: 2066 6574 6368 5f74 6963 6b65 7228 7365   fetch_ticker(se
+00010db0: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
+00010dc0: 3e20 5469 636b 6572 3a0a 2020 2020 2020  > Ticker:.      
+00010dd0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00010de0: 2020 2069 6620 2870 6169 7220 6e6f 7420     if (pair not 
+00010df0: 696e 2073 656c 662e 6d61 726b 6574 7320  in self.markets 
+00010e00: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+00010e10: 2020 2020 2020 2073 656c 662e 6d61 726b         self.mark
+00010e20: 6574 735b 7061 6972 5d2e 6765 7428 2761  ets[pair].get('a
+00010e30: 6374 6976 6527 2c20 4661 6c73 6529 2069  ctive', False) i
+00010e40: 7320 4661 6c73 6529 3a0a 2020 2020 2020  s False):.      
+00010e50: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010e60: 4578 6368 616e 6765 4572 726f 7228 6622  ExchangeError(f"
+00010e70: 5061 6972 207b 7061 6972 7d20 6e6f 7420  Pair {pair} not 
+00010e80: 6176 6169 6c61 626c 6522 290a 2020 2020  available").    
+00010e90: 2020 2020 2020 2020 6461 7461 3a20 5469          data: Ti
+00010ea0: 636b 6572 203d 2073 656c 662e 5f61 7069  cker = self._api
+00010eb0: 2e66 6574 6368 5f74 6963 6b65 7228 7061  .fetch_ticker(pa
+00010ec0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+00010ed0: 7265 7475 726e 2064 6174 610a 2020 2020  return data.    
+00010ee0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+00010ef0: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
+00010f00: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00010f10: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
+00010f20: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
+00010f30: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+00010f40: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
+00010f50: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
+00010f60: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+00010f70: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00010f80: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+00010f90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010fa0: 2743 6f75 6c64 206e 6f74 206c 6f61 6420  'Could not load 
+00010fb0: 7469 636b 6572 2064 7565 2074 6f20 7b65  ticker due to {e
+00010fc0: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+00010fd0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
+00010fe0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+00010ff0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+00011000: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
+00011010: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011020: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00011030: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
+00011040: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00011050: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00011060: 6e65 7874 5f6c 696d 6974 5f69 6e5f 6c69  next_limit_in_li
+00011070: 7374 286c 696d 6974 3a20 696e 742c 206c  st(limit: int, l
+00011080: 696d 6974 5f72 616e 6765 3a20 4f70 7469  imit_range: Opti
+00011090: 6f6e 616c 5b4c 6973 745b 696e 745d 5d2c  onal[List[int]],
+000110a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000110b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110c0: 7261 6e67 655f 7265 7175 6972 6564 3a20  range_required: 
+000110d0: 626f 6f6c 203d 2054 7275 6529 3a0a 2020  bool = True):.  
+000110e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000110f0: 2020 4765 7420 6e65 7874 2067 7265 6174    Get next great
+00011100: 6572 2076 616c 7565 2069 6e20 7468 6520  er value in the 
+00011110: 6c69 7374 2e0a 2020 2020 2020 2020 5573  list..        Us
+00011120: 6564 2062 7920 6665 7463 685f 6c32 5f6f  ed by fetch_l2_o
+00011130: 7264 6572 5f62 6f6f 6b20 6966 2074 6865  rder_book if the
+00011140: 2061 7069 206f 6e6c 7920 7375 7070 6f72   api only suppor
+00011150: 7473 2061 206c 696d 6974 6564 2072 616e  ts a limited ran
+00011160: 6765 0a20 2020 2020 2020 2022 2222 0a20  ge.        """. 
+00011170: 2020 2020 2020 2069 6620 6e6f 7420 6c69         if not li
+00011180: 6d69 745f 7261 6e67 653a 0a20 2020 2020  mit_range:.     
+00011190: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
+000111a0: 6d69 740a 0a20 2020 2020 2020 2072 6573  mit..        res
+000111b0: 756c 7420 3d20 6d69 6e28 5b78 2066 6f72  ult = min([x for
+000111c0: 2078 2069 6e20 6c69 6d69 745f 7261 6e67   x in limit_rang
+000111d0: 6520 6966 206c 696d 6974 203c 3d20 785d  e if limit <= x]
+000111e0: 202b 205b 6d61 7828 6c69 6d69 745f 7261   + [max(limit_ra
+000111f0: 6e67 6529 5d29 0a20 2020 2020 2020 2069  nge)]).        i
+00011200: 6620 6e6f 7420 7261 6e67 655f 7265 7175  f not range_requ
+00011210: 6972 6564 2061 6e64 206c 696d 6974 203e  ired and limit >
+00011220: 2072 6573 756c 743a 0a20 2020 2020 2020   result:.       
+00011230: 2020 2020 2023 2052 616e 6765 2069 7320       # Range is 
+00011240: 6e6f 7420 7265 7175 6972 6564 202d 2077  not required - w
+00011250: 6520 6361 6e20 7573 6520 4e6f 6e65 2061  e can use None a
+00011260: 7320 7061 7261 6d65 7465 722e 0a20 2020  s parameter..   
+00011270: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011280: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
+00011290: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
+000112a0: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
+000112b0: 2066 6574 6368 5f6c 325f 6f72 6465 725f   fetch_l2_order_
+000112c0: 626f 6f6b 2873 656c 662c 2070 6169 723a  book(self, pair:
+000112d0: 2073 7472 2c20 6c69 6d69 743a 2069 6e74   str, limit: int
+000112e0: 203d 2031 3030 2920 2d3e 204f 7264 6572   = 100) -> Order
+000112f0: 426f 6f6b 3a0a 2020 2020 2020 2020 2222  Book:.        ""
+00011300: 220a 2020 2020 2020 2020 4765 7420 4c32  ".        Get L2
+00011310: 206f 7264 6572 2062 6f6f 6b20 6672 6f6d   order book from
+00011320: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
+00011330: 2020 2043 616e 2062 6520 6c69 6d69 7465     Can be limite
+00011340: 6420 746f 2061 2063 6572 7461 696e 2061  d to a certain a
+00011350: 6d6f 756e 7420 2869 6620 7375 7070 6f72  mount (if suppor
+00011360: 7465 6429 2e0a 2020 2020 2020 2020 5265  ted)..        Re
+00011370: 7475 726e 7320 6120 6469 6374 2069 6e20  turns a dict in 
+00011380: 7468 6520 666f 726d 6174 0a20 2020 2020  the format.     
+00011390: 2020 207b 2761 736b 7327 3a20 5b70 7269     {'asks': [pri
+000113a0: 6365 2c20 766f 6c75 6d65 5d2c 2027 6269  ce, volume], 'bi
+000113b0: 6473 273a 205b 7072 6963 652c 2076 6f6c  ds': [price, vol
+000113c0: 756d 655d 7d0a 2020 2020 2020 2020 2222  ume]}.        ""
+000113d0: 220a 2020 2020 2020 2020 6c69 6d69 7431  ".        limit1
+000113e0: 203d 2073 656c 662e 6765 745f 6e65 7874   = self.get_next
+000113f0: 5f6c 696d 6974 5f69 6e5f 6c69 7374 286c  _limit_in_list(l
+00011400: 696d 6974 2c20 7365 6c66 2e5f 6674 5f68  imit, self._ft_h
+00011410: 6173 5b27 6c32 5f6c 696d 6974 5f72 616e  as['l2_limit_ran
+00011420: 6765 275d 2c0a 2020 2020 2020 2020 2020  ge'],.          
 00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011450: 5f66 745f 6861 735b 276c 325f 6c69 6d69  _ft_has['l2_limi
-00011460: 745f 7261 6e67 655f 7265 7175 6972 6564  t_range_required
-00011470: 275d 290a 2020 2020 2020 2020 7472 793a  ']).        try:
-00011480: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00011490: 7475 726e 2073 656c 662e 5f61 7069 2e66  turn self._api.f
-000114a0: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
-000114b0: 6f6b 2870 6169 722c 206c 696d 6974 3129  ok(pair, limit1)
-000114c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000114d0: 6363 7874 2e4e 6f74 5375 7070 6f72 7465  ccxt.NotSupporte
-000114e0: 6420 6173 2065 3a0a 2020 2020 2020 2020  d as e:.        
-000114f0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00011500: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011520: 6627 4578 6368 616e 6765 207b 7365 6c66  f'Exchange {self
-00011530: 2e5f 6170 692e 6e61 6d65 7d20 646f 6573  ._api.name} does
-00011540: 206e 6f74 2073 7570 706f 7274 2066 6574   not support fet
-00011550: 6368 696e 6720 6f72 6465 7220 626f 6f6b  ching order book
-00011560: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
-00011570: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
-00011580: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-00011590: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
-000115a0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
-000115b0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000115c0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
-000115d0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
-000115e0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
-000115f0: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
-00011600: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
-00011610: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
-00011620: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
-00011630: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
-00011640: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00011650: 436f 756c 6420 6e6f 7420 6765 7420 6f72  Could not get or
-00011660: 6465 7220 626f 6f6b 2064 7565 2074 6f20  der book due to 
-00011670: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00011680: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-00011690: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-000116a0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-000116b0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-000116c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000116d0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-000116e0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-000116f0: 2065 0a0a 2020 2020 6465 6620 5f67 6574   e..    def _get
-00011700: 5f70 7269 6365 5f73 6964 6528 7365 6c66  _price_side(self
-00011710: 2c20 7369 6465 3a20 7374 722c 2069 735f  , side: str, is_
-00011720: 7368 6f72 743a 2062 6f6f 6c2c 2063 6f6e  short: bool, con
-00011730: 665f 7374 7261 7465 6779 3a20 4469 6374  f_strategy: Dict
-00011740: 2920 2d3e 2042 6964 4173 6b3a 0a20 2020  ) -> BidAsk:.   
-00011750: 2020 2020 2070 7269 6365 5f73 6964 6520       price_side 
-00011760: 3d20 636f 6e66 5f73 7472 6174 6567 795b  = conf_strategy[
-00011770: 2770 7269 6365 5f73 6964 6527 5d0a 0a20  'price_side'].. 
-00011780: 2020 2020 2020 2069 6620 7072 6963 655f         if price_
-00011790: 7369 6465 2069 6e20 2827 7361 6d65 272c  side in ('same',
-000117a0: 2027 6f74 6865 7227 293a 0a20 2020 2020   'other'):.     
-000117b0: 2020 2020 2020 2070 7269 6365 5f6d 6170         price_map
-000117c0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-000117d0: 2020 2020 2028 2765 6e74 7279 272c 2027       ('entry', '
-000117e0: 6c6f 6e67 272c 2027 7361 6d65 2729 3a20  long', 'same'): 
-000117f0: 2762 6964 272c 0a20 2020 2020 2020 2020  'bid',.         
-00011800: 2020 2020 2020 2028 2765 6e74 7279 272c         ('entry',
-00011810: 2027 6c6f 6e67 272c 2027 6f74 6865 7227   'long', 'other'
-00011820: 293a 2027 6173 6b27 2c0a 2020 2020 2020  ): 'ask',.      
-00011830: 2020 2020 2020 2020 2020 2827 656e 7472            ('entr
-00011840: 7927 2c20 2773 686f 7274 272c 2027 7361  y', 'short', 'sa
-00011850: 6d65 2729 3a20 2761 736b 272c 0a20 2020  me'): 'ask',.   
-00011860: 2020 2020 2020 2020 2020 2020 2028 2765               ('e
-00011870: 6e74 7279 272c 2027 7368 6f72 7427 2c20  ntry', 'short', 
-00011880: 276f 7468 6572 2729 3a20 2762 6964 272c  'other'): 'bid',
-00011890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000118a0: 2028 2765 7869 7427 2c20 276c 6f6e 6727   ('exit', 'long'
-000118b0: 2c20 2773 616d 6527 293a 2027 6173 6b27  , 'same'): 'ask'
-000118c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000118d0: 2020 2827 6578 6974 272c 2027 6c6f 6e67    ('exit', 'long
-000118e0: 272c 2027 6f74 6865 7227 293a 2027 6269  ', 'other'): 'bi
-000118f0: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
-00011900: 2020 2020 2827 6578 6974 272c 2027 7368      ('exit', 'sh
-00011910: 6f72 7427 2c20 2773 616d 6527 293a 2027  ort', 'same'): '
-00011920: 6269 6427 2c0a 2020 2020 2020 2020 2020  bid',.          
-00011930: 2020 2020 2020 2827 6578 6974 272c 2027        ('exit', '
-00011940: 7368 6f72 7427 2c20 276f 7468 6572 2729  short', 'other')
-00011950: 3a20 2761 736b 272c 0a20 2020 2020 2020  : 'ask',.       
-00011960: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00011970: 2020 2070 7269 6365 5f73 6964 6520 3d20     price_side = 
-00011980: 7072 6963 655f 6d61 705b 2873 6964 652c  price_map[(side,
-00011990: 2027 7368 6f72 7427 2069 6620 6973 5f73   'short' if is_s
-000119a0: 686f 7274 2065 6c73 6520 276c 6f6e 6727  hort else 'long'
-000119b0: 2c20 7072 6963 655f 7369 6465 295d 0a20  , price_side)]. 
-000119c0: 2020 2020 2020 2072 6574 7572 6e20 7072         return pr
-000119d0: 6963 655f 7369 6465 0a0a 2020 2020 6465  ice_side..    de
-000119e0: 6620 6765 745f 7261 7465 2873 656c 662c  f get_rate(self,
-000119f0: 2070 6169 723a 2073 7472 2c20 7265 6672   pair: str, refr
-00011a00: 6573 683a 2062 6f6f 6c2c 0a20 2020 2020  esh: bool,.     
-00011a10: 2020 2020 2020 2020 2020 2020 7369 6465              side
-00011a20: 3a20 456e 7472 7945 7869 742c 2069 735f  : EntryExit, is_
-00011a30: 7368 6f72 743a 2062 6f6f 6c2c 0a20 2020  short: bool,.   
-00011a40: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00011a50: 6465 725f 626f 6f6b 3a20 4f70 7469 6f6e  der_book: Option
-00011a60: 616c 5b4f 7264 6572 426f 6f6b 5d20 3d20  al[OrderBook] = 
-00011a70: 4e6f 6e65 2c20 7469 636b 6572 3a20 4f70  None, ticker: Op
-00011a80: 7469 6f6e 616c 5b54 6963 6b65 725d 203d  tional[Ticker] =
-00011a90: 204e 6f6e 6529 202d 3e20 666c 6f61 743a   None) -> float:
-00011aa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00011ab0: 2020 2020 2043 616c 6375 6c61 7465 7320       Calculates 
-00011ac0: 6269 642f 6173 6b20 7461 7267 6574 0a20  bid/ask target. 
-00011ad0: 2020 2020 2020 2062 6964 2072 6174 6520         bid rate 
-00011ae0: 2d20 6265 7477 6565 6e20 6375 7272 656e  - between curren
-00011af0: 7420 6173 6b20 7072 6963 6520 616e 6420  t ask price and 
-00011b00: 6c61 7374 2070 7269 6365 0a20 2020 2020  last price.     
-00011b10: 2020 2061 736b 2072 6174 6520 2d20 6569     ask rate - ei
-00011b20: 7468 6572 2075 7369 6e67 2074 6963 6b65  ther using ticke
-00011b30: 7220 6269 6420 6f72 2066 6972 7374 2062  r bid or first b
-00011b40: 6964 2062 6173 6564 206f 6e20 6f72 6465  id based on orde
-00011b50: 7262 6f6f 6b0a 2020 2020 2020 2020 6f72  rbook.        or
-00011b60: 2072 656d 6169 6e20 7374 6174 6963 2069   remain static i
-00011b70: 6e20 616e 7920 6f74 6865 7220 6361 7365  n any other case
-00011b80: 2073 696e 6365 2069 7427 7320 6e6f 7420   since it's not 
-00011b90: 7570 6461 7469 6e67 2e0a 2020 2020 2020  updating..      
-00011ba0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
-00011bb0: 6169 7220 746f 2067 6574 2072 6174 6520  air to get rate 
-00011bc0: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
-00011bd0: 616d 2072 6566 7265 7368 3a20 616c 6c6f  am refresh: allo
-00011be0: 7720 6361 6368 6564 2064 6174 610a 2020  w cached data.  
-00011bf0: 2020 2020 2020 3a70 6172 616d 2073 6964        :param sid
-00011c00: 653a 2022 6275 7922 206f 7220 2273 656c  e: "buy" or "sel
-00011c10: 6c22 0a20 2020 2020 2020 203a 7265 7475  l".        :retu
-00011c20: 726e 3a20 666c 6f61 743a 2050 7269 6365  rn: float: Price
-00011c30: 0a20 2020 2020 2020 203a 7261 6973 6573  .        :raises
-00011c40: 2050 7269 6369 6e67 4572 726f 7220 6966   PricingError if
-00011c50: 206f 7264 6572 626f 6f6b 2070 7269 6365   orderbook price
-00011c60: 2063 6f75 6c64 206e 6f74 2062 6520 6465   could not be de
-00011c70: 7465 726d 696e 6564 2e0a 2020 2020 2020  termined..      
-00011c80: 2020 2222 220a 2020 2020 2020 2020 6e61    """.        na
-00011c90: 6d65 203d 2073 6964 652e 6361 7069 7461  me = side.capita
-00011ca0: 6c69 7a65 2829 0a20 2020 2020 2020 2073  lize().        s
-00011cb0: 7472 6174 5f6e 616d 6520 3d20 2765 6e74  trat_name = 'ent
-00011cc0: 7279 5f70 7269 6369 6e67 2720 6966 2073  ry_pricing' if s
-00011cd0: 6964 6520 3d3d 2022 656e 7472 7922 2065  ide == "entry" e
-00011ce0: 6c73 6520 2765 7869 745f 7072 6963 696e  lse 'exit_pricin
-00011cf0: 6727 0a0a 2020 2020 2020 2020 6361 6368  g'..        cach
-00011d00: 655f 7261 7465 3a20 5454 4c43 6163 6865  e_rate: TTLCache
-00011d10: 203d 2073 656c 662e 5f65 6e74 7279 5f72   = self._entry_r
-00011d20: 6174 655f 6361 6368 6520 6966 2073 6964  ate_cache if sid
-00011d30: 6520 3d3d 2022 656e 7472 7922 2065 6c73  e == "entry" els
-00011d40: 6520 7365 6c66 2e5f 6578 6974 5f72 6174  e self._exit_rat
-00011d50: 655f 6361 6368 650a 2020 2020 2020 2020  e_cache.        
-00011d60: 6966 206e 6f74 2072 6566 7265 7368 3a0a  if not refresh:.
-00011d70: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00011d80: 2073 656c 662e 5f63 6163 6865 5f6c 6f63   self._cache_loc
-00011d90: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
-00011da0: 2020 2072 6174 6520 3d20 6361 6368 655f     rate = cache_
-00011db0: 7261 7465 2e67 6574 2870 6169 7229 0a20  rate.get(pair). 
-00011dc0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-00011dd0: 636b 2069 6620 6361 6368 6520 6861 7320  ck if cache has 
-00011de0: 6265 656e 2069 6e76 616c 6964 6174 6564  been invalidated
-00011df0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00011e00: 7261 7465 3a0a 2020 2020 2020 2020 2020  rate:.          
-00011e10: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-00011e20: 7567 2866 2255 7369 6e67 2063 6163 6865  ug(f"Using cache
-00011e30: 6420 7b73 6964 657d 2072 6174 6520 666f  d {side} rate fo
-00011e40: 7220 7b70 6169 727d 2e22 290a 2020 2020  r {pair}.").    
-00011e50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011e60: 726e 2072 6174 650a 0a20 2020 2020 2020  rn rate..       
-00011e70: 2063 6f6e 665f 7374 7261 7465 6779 203d   conf_strategy =
-00011e80: 2073 656c 662e 5f63 6f6e 6669 672e 6765   self._config.ge
-00011e90: 7428 7374 7261 745f 6e61 6d65 2c20 7b7d  t(strat_name, {}
-00011ea0: 290a 0a20 2020 2020 2020 2070 7269 6365  )..        price
-00011eb0: 5f73 6964 6520 3d20 7365 6c66 2e5f 6765  _side = self._ge
-00011ec0: 745f 7072 6963 655f 7369 6465 2873 6964  t_price_side(sid
-00011ed0: 652c 2069 735f 7368 6f72 742c 2063 6f6e  e, is_short, con
-00011ee0: 665f 7374 7261 7465 6779 290a 0a20 2020  f_strategy)..   
-00011ef0: 2020 2020 2070 7269 6365 5f73 6964 655f       price_side_
-00011f00: 776f 7264 203d 2070 7269 6365 5f73 6964  word = price_sid
-00011f10: 652e 6361 7069 7461 6c69 7a65 2829 0a0a  e.capitalize()..
-00011f20: 2020 2020 2020 2020 6966 2063 6f6e 665f          if conf_
-00011f30: 7374 7261 7465 6779 2e67 6574 2827 7573  strategy.get('us
-00011f40: 655f 6f72 6465 725f 626f 6f6b 272c 2046  e_order_book', F
-00011f50: 616c 7365 293a 0a0a 2020 2020 2020 2020  alse):..        
-00011f60: 2020 2020 6f72 6465 725f 626f 6f6b 5f74      order_book_t
-00011f70: 6f70 203d 2063 6f6e 665f 7374 7261 7465  op = conf_strate
-00011f80: 6779 2e67 6574 2827 6f72 6465 725f 626f  gy.get('order_bo
-00011f90: 6f6b 5f74 6f70 272c 2031 290a 2020 2020  ok_top', 1).    
-00011fa0: 2020 2020 2020 2020 6966 206f 7264 6572          if order
-00011fb0: 5f62 6f6f 6b20 6973 204e 6f6e 653a 0a20  _book is None:. 
-00011fc0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00011fd0: 7264 6572 5f62 6f6f 6b20 3d20 7365 6c66  rder_book = self
-00011fe0: 2e66 6574 6368 5f6c 325f 6f72 6465 725f  .fetch_l2_order_
-00011ff0: 626f 6f6b 2870 6169 722c 206f 7264 6572  book(pair, order
-00012000: 5f62 6f6f 6b5f 746f 7029 0a20 2020 2020  _book_top).     
-00012010: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00012020: 6275 6728 276f 7264 6572 5f62 6f6f 6b20  bug('order_book 
-00012030: 2573 272c 206f 7264 6572 5f62 6f6f 6b29  %s', order_book)
-00012040: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
-00012050: 6f70 2031 203d 2069 6e64 6578 2030 0a20  op 1 = index 0. 
-00012060: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00012070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012080: 6f62 7369 6465 3a20 4f42 4c69 7465 7261  obside: OBLitera
-00012090: 6c20 3d20 2762 6964 7327 2069 6620 7072  l = 'bids' if pr
-000120a0: 6963 655f 7369 6465 203d 3d20 2762 6964  ice_side == 'bid
-000120b0: 2720 656c 7365 2027 6173 6b73 270a 2020  ' else 'asks'.  
-000120c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000120d0: 7465 203d 206f 7264 6572 5f62 6f6f 6b5b  te = order_book[
-000120e0: 6f62 7369 6465 5d5b 6f72 6465 725f 626f  obside][order_bo
-000120f0: 6f6b 5f74 6f70 202d 2031 5d5b 305d 0a20  ok_top - 1][0]. 
-00012100: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00012110: 7420 2849 6e64 6578 4572 726f 722c 204b  t (IndexError, K
-00012120: 6579 4572 726f 7229 2061 7320 653a 0a20  eyError) as e:. 
-00012130: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00012140: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
-00012150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012160: 2020 2066 227b 7061 6972 7d20 2d20 7b6e     f"{pair} - {n
-00012170: 616d 657d 2050 7269 6365 2061 7420 6c6f  ame} Price at lo
-00012180: 6361 7469 6f6e 207b 6f72 6465 725f 626f  cation {order_bo
-00012190: 6f6b 5f74 6f70 7d20 6672 6f6d 206f 7264  ok_top} from ord
-000121a0: 6572 626f 6f6b 2022 0a20 2020 2020 2020  erbook ".       
-000121b0: 2020 2020 2020 2020 2020 2020 2066 2263               f"c
-000121c0: 6f75 6c64 206e 6f74 2062 6520 6465 7465  ould not be dete
-000121d0: 726d 696e 6564 2e20 4f72 6465 7262 6f6f  rmined. Orderboo
-000121e0: 6b3a 207b 6f72 6465 725f 626f 6f6b 7d22  k: {order_book}"
-000121f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012200: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-00012210: 2020 2072 6169 7365 2050 7269 6369 6e67     raise Pricing
-00012220: 4572 726f 7220 6672 6f6d 2065 0a20 2020  Error from e.   
-00012230: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00012240: 6465 6275 6728 6622 7b70 6169 727d 202d  debug(f"{pair} -
-00012250: 207b 6e61 6d65 7d20 7072 6963 6520 6672   {name} price fr
-00012260: 6f6d 206f 7264 6572 626f 6f6b 207b 7072  om orderbook {pr
-00012270: 6963 655f 7369 6465 5f77 6f72 647d 220a  ice_side_word}".
-00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 2020 2020 2020 2020 2066 2273 6964 6520           f"side 
-000122a0: 2d20 746f 7020 7b6f 7264 6572 5f62 6f6f  - top {order_boo
-000122b0: 6b5f 746f 707d 206f 7264 6572 2062 6f6f  k_top} order boo
-000122c0: 6b20 7b73 6964 657d 2072 6174 6520 7b72  k {side} rate {r
-000122d0: 6174 653a 2e38 667d 2229 0a20 2020 2020  ate:.8f}").     
-000122e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000122f0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-00012300: 6728 6622 5573 696e 6720 4c61 7374 207b  g(f"Using Last {
-00012310: 7072 6963 655f 7369 6465 5f77 6f72 647d  price_side_word}
-00012320: 202f 204c 6173 7420 5072 6963 6522 290a   / Last Price").
-00012330: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-00012340: 6963 6b65 7220 6973 204e 6f6e 653a 0a20  icker is None:. 
-00012350: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00012360: 6963 6b65 7220 3d20 7365 6c66 2e66 6574  icker = self.fet
-00012370: 6368 5f74 6963 6b65 7228 7061 6972 290a  ch_ticker(pair).
-00012380: 2020 2020 2020 2020 2020 2020 7469 636b              tick
-00012390: 6572 5f72 6174 6520 3d20 7469 636b 6572  er_rate = ticker
-000123a0: 5b70 7269 6365 5f73 6964 655d 0a20 2020  [price_side].   
-000123b0: 2020 2020 2020 2020 2069 6620 7469 636b           if tick
-000123c0: 6572 5b27 6c61 7374 275d 2061 6e64 2074  er['last'] and t
-000123d0: 6963 6b65 725f 7261 7465 3a0a 2020 2020  icker_rate:.    
-000123e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000123f0: 6964 6520 3d3d 2027 656e 7472 7927 2061  ide == 'entry' a
-00012400: 6e64 2074 6963 6b65 725f 7261 7465 203e  nd ticker_rate >
-00012410: 2074 6963 6b65 725b 276c 6173 7427 5d3a   ticker['last']:
-00012420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012430: 2020 2020 2062 616c 616e 6365 203d 2063       balance = c
-00012440: 6f6e 665f 7374 7261 7465 6779 2e67 6574  onf_strategy.get
-00012450: 2827 7072 6963 655f 6c61 7374 5f62 616c  ('price_last_bal
-00012460: 616e 6365 272c 2030 2e30 290a 2020 2020  ance', 0.0).    
-00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012480: 7469 636b 6572 5f72 6174 6520 3d20 7469  ticker_rate = ti
-00012490: 636b 6572 5f72 6174 6520 2b20 6261 6c61  cker_rate + bala
-000124a0: 6e63 6520 2a20 2874 6963 6b65 725b 276c  nce * (ticker['l
-000124b0: 6173 7427 5d20 2d20 7469 636b 6572 5f72  ast'] - ticker_r
-000124c0: 6174 6529 0a20 2020 2020 2020 2020 2020  ate).           
-000124d0: 2020 2020 2065 6c69 6620 7369 6465 203d       elif side =
-000124e0: 3d20 2765 7869 7427 2061 6e64 2074 6963  = 'exit' and tic
-000124f0: 6b65 725f 7261 7465 203c 2074 6963 6b65  ker_rate < ticke
-00012500: 725b 276c 6173 7427 5d3a 0a20 2020 2020  r['last']:.     
-00012510: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00012520: 616c 616e 6365 203d 2063 6f6e 665f 7374  alance = conf_st
-00012530: 7261 7465 6779 2e67 6574 2827 7072 6963  rategy.get('pric
-00012540: 655f 6c61 7374 5f62 616c 616e 6365 272c  e_last_balance',
-00012550: 2030 2e30 290a 2020 2020 2020 2020 2020   0.0).          
-00012560: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
-00012570: 5f72 6174 6520 3d20 7469 636b 6572 5f72  _rate = ticker_r
-00012580: 6174 6520 2d20 6261 6c61 6e63 6520 2a20  ate - balance * 
-00012590: 2874 6963 6b65 725f 7261 7465 202d 2074  (ticker_rate - t
-000125a0: 6963 6b65 725b 276c 6173 7427 5d29 0a20  icker['last']). 
-000125b0: 2020 2020 2020 2020 2020 2072 6174 6520             rate 
-000125c0: 3d20 7469 636b 6572 5f72 6174 650a 0a20  = ticker_rate.. 
-000125d0: 2020 2020 2020 2069 6620 7261 7465 2069         if rate i
-000125e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000125f0: 2020 2020 7261 6973 6520 5072 6963 696e      raise Pricin
-00012600: 6745 7272 6f72 2866 227b 6e61 6d65 7d2d  gError(f"{name}-
-00012610: 5261 7465 2066 6f72 207b 7061 6972 7d20  Rate for {pair} 
-00012620: 7761 7320 656d 7074 792e 2229 0a20 2020  was empty.").   
-00012630: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-00012640: 6361 6368 655f 6c6f 636b 3a0a 2020 2020  cache_lock:.    
-00012650: 2020 2020 2020 2020 6361 6368 655f 7261          cache_ra
-00012660: 7465 5b70 6169 725d 203d 2072 6174 650a  te[pair] = rate.
-00012670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012680: 7261 7465 0a0a 2020 2020 6465 6620 6765  rate..    def ge
-00012690: 745f 7261 7465 7328 7365 6c66 2c20 7061  t_rates(self, pa
-000126a0: 6972 3a20 7374 722c 2072 6566 7265 7368  ir: str, refresh
-000126b0: 3a20 626f 6f6c 2c20 6973 5f73 686f 7274  : bool, is_short
-000126c0: 3a20 626f 6f6c 2920 2d3e 2054 7570 6c65  : bool) -> Tuple
-000126d0: 5b66 6c6f 6174 2c20 666c 6f61 745d 3a0a  [float, float]:.
-000126e0: 2020 2020 2020 2020 656e 7472 795f 7261          entry_ra
-000126f0: 7465 203d 204e 6f6e 650a 2020 2020 2020  te = None.      
-00012700: 2020 6578 6974 5f72 6174 6520 3d20 4e6f    exit_rate = No
-00012710: 6e65 0a20 2020 2020 2020 2069 6620 6e6f  ne.        if no
-00012720: 7420 7265 6672 6573 683a 0a20 2020 2020  t refresh:.     
-00012730: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-00012740: 2e5f 6361 6368 655f 6c6f 636b 3a0a 2020  ._cache_lock:.  
-00012750: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00012760: 7472 795f 7261 7465 203d 2073 656c 662e  try_rate = self.
-00012770: 5f65 6e74 7279 5f72 6174 655f 6361 6368  _entry_rate_cach
-00012780: 652e 6765 7428 7061 6972 290a 2020 2020  e.get(pair).    
-00012790: 2020 2020 2020 2020 2020 2020 6578 6974              exit
-000127a0: 5f72 6174 6520 3d20 7365 6c66 2e5f 6578  _rate = self._ex
-000127b0: 6974 5f72 6174 655f 6361 6368 652e 6765  it_rate_cache.ge
-000127c0: 7428 7061 6972 290a 2020 2020 2020 2020  t(pair).        
-000127d0: 2020 2020 6966 2065 6e74 7279 5f72 6174      if entry_rat
-000127e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000127f0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-00012800: 6622 5573 696e 6720 6361 6368 6564 2062  f"Using cached b
-00012810: 7579 2072 6174 6520 666f 7220 7b70 6169  uy rate for {pai
-00012820: 727d 2e22 290a 2020 2020 2020 2020 2020  r}.").          
-00012830: 2020 6966 2065 7869 745f 7261 7465 3a0a    if exit_rate:.
-00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012850: 6c6f 6767 6572 2e64 6562 7567 2866 2255  logger.debug(f"U
-00012860: 7369 6e67 2063 6163 6865 6420 7365 6c6c  sing cached sell
-00012870: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
-00012880: 2e22 290a 0a20 2020 2020 2020 2065 6e74  .")..        ent
-00012890: 7279 5f70 7269 6369 6e67 203d 2073 656c  ry_pricing = sel
-000128a0: 662e 5f63 6f6e 6669 672e 6765 7428 2765  f._config.get('e
-000128b0: 6e74 7279 5f70 7269 6369 6e67 272c 207b  ntry_pricing', {
-000128c0: 7d29 0a20 2020 2020 2020 2065 7869 745f  }).        exit_
-000128d0: 7072 6963 696e 6720 3d20 7365 6c66 2e5f  pricing = self._
-000128e0: 636f 6e66 6967 2e67 6574 2827 6578 6974  config.get('exit
-000128f0: 5f70 7269 6369 6e67 272c 207b 7d29 0a20  _pricing', {}). 
-00012900: 2020 2020 2020 206f 7264 6572 5f62 6f6f         order_boo
-00012910: 6b20 3d20 7469 636b 6572 203d 204e 6f6e  k = ticker = Non
-00012920: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00012930: 2065 6e74 7279 5f72 6174 6520 616e 6420   entry_rate and 
-00012940: 656e 7472 795f 7072 6963 696e 672e 6765  entry_pricing.ge
-00012950: 7428 2775 7365 5f6f 7264 6572 5f62 6f6f  t('use_order_boo
-00012960: 6b27 2c20 4661 6c73 6529 3a0a 2020 2020  k', False):.    
-00012970: 2020 2020 2020 2020 6f72 6465 725f 626f          order_bo
-00012980: 6f6b 5f74 6f70 203d 206d 6178 2865 6e74  ok_top = max(ent
-00012990: 7279 5f70 7269 6369 6e67 2e67 6574 2827  ry_pricing.get('
-000129a0: 6f72 6465 725f 626f 6f6b 5f74 6f70 272c  order_book_top',
-000129b0: 2031 292c 0a20 2020 2020 2020 2020 2020   1),.           
-000129c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129d0: 2020 2020 2020 6578 6974 5f70 7269 6369        exit_prici
-000129e0: 6e67 2e67 6574 2827 6f72 6465 725f 626f  ng.get('order_bo
-000129f0: 6f6b 5f74 6f70 272c 2031 2929 0a20 2020  ok_top', 1)).   
-00012a00: 2020 2020 2020 2020 206f 7264 6572 5f62           order_b
-00012a10: 6f6f 6b20 3d20 7365 6c66 2e66 6574 6368  ook = self.fetch
-00012a20: 5f6c 325f 6f72 6465 725f 626f 6f6b 2870  _l2_order_book(p
-00012a30: 6169 722c 206f 7264 6572 5f62 6f6f 6b5f  air, order_book_
-00012a40: 746f 7029 0a20 2020 2020 2020 2020 2020  top).           
-00012a50: 2065 6e74 7279 5f72 6174 6520 3d20 7365   entry_rate = se
-00012a60: 6c66 2e67 6574 5f72 6174 6528 7061 6972  lf.get_rate(pair
-00012a70: 2c20 7265 6672 6573 682c 2027 656e 7472  , refresh, 'entr
-00012a80: 7927 2c20 6973 5f73 686f 7274 2c20 6f72  y', is_short, or
-00012a90: 6465 725f 626f 6f6b 3d6f 7264 6572 5f62  der_book=order_b
-00012aa0: 6f6f 6b29 0a20 2020 2020 2020 2065 6c69  ook).        eli
-00012ab0: 6620 6e6f 7420 656e 7472 795f 7261 7465  f not entry_rate
-00012ac0: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-00012ad0: 636b 6572 203d 2073 656c 662e 6665 7463  cker = self.fetc
-00012ae0: 685f 7469 636b 6572 2870 6169 7229 0a20  h_ticker(pair). 
-00012af0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
-00012b00: 5f72 6174 6520 3d20 7365 6c66 2e67 6574  _rate = self.get
-00012b10: 5f72 6174 6528 7061 6972 2c20 7265 6672  _rate(pair, refr
-00012b20: 6573 682c 2027 656e 7472 7927 2c20 6973  esh, 'entry', is
-00012b30: 5f73 686f 7274 2c20 7469 636b 6572 3d74  _short, ticker=t
-00012b40: 6963 6b65 7229 0a20 2020 2020 2020 2069  icker).        i
-00012b50: 6620 6e6f 7420 6578 6974 5f72 6174 653a  f not exit_rate:
-00012b60: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
-00012b70: 745f 7261 7465 203d 2073 656c 662e 6765  t_rate = self.ge
-00012b80: 745f 7261 7465 2870 6169 722c 2072 6566  t_rate(pair, ref
-00012b90: 7265 7368 2c20 2765 7869 7427 2c0a 2020  resh, 'exit',.  
-00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bc0: 2020 2020 6973 5f73 686f 7274 2c20 6f72      is_short, or
-00012bd0: 6465 725f 626f 6f6b 3d6f 7264 6572 5f62  der_book=order_b
-00012be0: 6f6f 6b2c 2074 6963 6b65 723d 7469 636b  ook, ticker=tick
-00012bf0: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
-00012c00: 726e 2065 6e74 7279 5f72 6174 652c 2065  rn entry_rate, e
-00012c10: 7869 745f 7261 7465 0a0a 2020 2020 2320  xit_rate..    # 
-00012c20: 4665 6520 6861 6e64 6c69 6e67 0a0a 2020  Fee handling..  
-00012c30: 2020 4072 6574 7269 6572 0a20 2020 2064    @retrier.    d
-00012c40: 6566 2067 6574 5f74 7261 6465 735f 666f  ef get_trades_fo
-00012c50: 725f 6f72 6465 7228 7365 6c66 2c20 6f72  r_order(self, or
-00012c60: 6465 725f 6964 3a20 7374 722c 2070 6169  der_id: str, pai
-00012c70: 723a 2073 7472 2c20 7369 6e63 653a 2064  r: str, since: d
-00012c80: 6174 6574 696d 652c 0a20 2020 2020 2020  atetime,.       
-00012c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ca0: 2020 2020 2020 7061 7261 6d73 3a20 4f70        params: Op
-00012cb0: 7469 6f6e 616c 5b44 6963 745d 203d 204e  tional[Dict] = N
-00012cc0: 6f6e 6529 202d 3e20 4c69 7374 3a0a 2020  one) -> List:.  
-00012cd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00012ce0: 2020 4665 7463 6820 4f72 6465 7273 2075    Fetch Orders u
-00012cf0: 7369 6e67 2074 6865 2022 6665 7463 685f  sing the "fetch_
-00012d00: 6d79 5f74 7261 6465 7322 2065 6e64 706f  my_trades" endpo
-00012d10: 696e 7420 616e 6420 6669 6c74 6572 2074  int and filter t
-00012d20: 6865 6d20 6279 206f 7264 6572 2d69 642e  hem by order-id.
-00012d30: 0a20 2020 2020 2020 2054 6865 2022 7369  .        The "si
-00012d40: 6e63 6522 2061 7267 756d 656e 7420 7061  nce" argument pa
-00012d50: 7373 6564 2069 6e20 6973 2063 6f6d 696e  ssed in is comin
-00012d60: 6720 6672 6f6d 2074 6865 2064 6174 6162  g from the datab
-00012d70: 6173 6520 616e 6420 6973 2069 6e20 5554  ase and is in UT
-00012d80: 432c 0a20 2020 2020 2020 2061 7320 7469  C,.        as ti
-00012d90: 6d65 7a6f 6e65 2d6e 6174 6976 6520 6461  mezone-native da
-00012da0: 7465 7469 6d65 206f 626a 6563 742e 0a20  tetime object.. 
-00012db0: 2020 2020 2020 2046 726f 6d20 7468 6520         From the 
-00012dc0: 7079 7468 6f6e 2064 6f63 756d 656e 7461  python documenta
-00012dd0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00012de0: 2020 3e20 4e61 6976 6520 6461 7465 7469    > Naive dateti
-00012df0: 6d65 2069 6e73 7461 6e63 6573 2061 7265  me instances are
-00012e00: 2061 7373 756d 6564 2074 6f20 7265 7072   assumed to repr
-00012e10: 6573 656e 7420 6c6f 6361 6c20 7469 6d65  esent local time
-00012e20: 0a20 2020 2020 2020 2054 6865 7265 666f  .        Therefo
-00012e30: 7265 2c20 6361 6c6c 696e 6720 2273 696e  re, calling "sin
-00012e40: 6365 2e74 696d 6573 7461 6d70 2829 2220  ce.timestamp()" 
-00012e50: 7769 6c6c 2067 6574 2074 6865 2055 5443  will get the UTC
-00012e60: 2074 696d 6573 7461 6d70 2c20 6166 7465   timestamp, afte
-00012e70: 7220 6170 706c 7969 6e67 2074 6865 0a20  r applying the. 
-00012e80: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00012e90: 6174 696f 6e20 6672 6f6d 206c 6f63 616c  ation from local
-00012ea0: 2074 696d 657a 6f6e 6520 746f 2055 5443   timezone to UTC
-00012eb0: 2e0a 2020 2020 2020 2020 5468 6973 2077  ..        This w
-00012ec0: 6f72 6b73 2066 6f72 2074 696d 657a 6f6e  orks for timezon
-00012ed0: 6573 2055 5443 2b20 7369 6e63 6520 7468  es UTC+ since th
-00012ee0: 656e 2074 6865 2072 6573 756c 7420 7769  en the result wi
-00012ef0: 6c6c 2063 6f6e 7461 696e 2074 7261 6465  ll contain trade
-00012f00: 7320 6672 6f6d 2061 2066 6577 2068 6f75  s from a few hou
-00012f10: 7273 0a20 2020 2020 2020 2069 6e73 7465  rs.        inste
-00012f20: 6164 206f 6620 6672 6f6d 2074 6865 206c  ad of from the l
-00012f30: 6173 7420 3520 7365 636f 6e64 732c 2068  ast 5 seconds, h
-00012f40: 6f77 6576 6572 2066 6169 6c73 2066 6f72  owever fails for
-00012f50: 2055 5443 2d20 7469 6d65 7a6f 6e65 732c   UTC- timezones,
-00012f60: 0a20 2020 2020 2020 2073 696e 6365 2077  .        since w
-00012f70: 6527 7265 2074 6865 6e20 6173 6b69 6e67  e're then asking
-00012f80: 2066 6f72 2074 7261 6465 7320 7769 7468   for trades with
-00012f90: 2061 2022 7369 6e63 6522 2061 7267 756d   a "since" argum
-00012fa0: 656e 7420 696e 2074 6865 2066 7574 7572  ent in the futur
-00012fb0: 652e 0a0a 2020 2020 2020 2020 3a70 6172  e...        :par
-00012fc0: 616d 206f 7264 6572 5f69 6420 6f72 6465  am order_id orde
-00012fd0: 725f 6964 3a20 4f72 6465 722d 6964 2061  r_id: Order-id a
-00012fe0: 7320 6769 7665 6e20 7768 656e 2063 7265  s given when cre
-00012ff0: 6174 696e 6720 7468 6520 6f72 6465 720a  ating the order.
-00013000: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00013010: 6169 723a 2050 6169 7220 7468 6520 6f72  air: Pair the or
-00013020: 6465 7220 6973 2066 6f72 0a20 2020 2020  der is for.     
-00013030: 2020 203a 7061 7261 6d20 7369 6e63 653a     :param since:
-00013040: 2064 6174 6574 696d 6520 6f62 6a65 6374   datetime object
-00013050: 206f 6620 7468 6520 6f72 6465 7220 6372   of the order cr
-00013060: 6561 7469 6f6e 2074 696d 652e 2041 7373  eation time. Ass
-00013070: 756d 6573 206f 626a 6563 7420 6973 2069  umes object is i
-00013080: 6e20 5554 432e 0a20 2020 2020 2020 2022  n UTC..        "
-00013090: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-000130a0: 6c66 2e5f 636f 6e66 6967 5b27 6472 795f  lf._config['dry_
-000130b0: 7275 6e27 5d3a 0a20 2020 2020 2020 2020  run']:.         
-000130c0: 2020 2072 6574 7572 6e20 5b5d 0a20 2020     return [].   
-000130d0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000130e0: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
-000130f0: 6574 6368 4d79 5472 6164 6573 2729 3a0a  etchMyTrades'):.
-00013100: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013110: 726e 205b 5d0a 2020 2020 2020 2020 7472  rn [].        tr
-00013120: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
-00013130: 2041 6c6c 6f77 2035 7320 6f66 6673 6574   Allow 5s offset
-00013140: 2074 6f20 6361 7463 6820 736c 6967 6874   to catch slight
-00013150: 2074 696d 6520 6f66 6673 6574 7320 2864   time offsets (d
-00013160: 6973 636f 7665 7265 6420 696e 2023 3131  iscovered in #11
-00013170: 3835 290a 2020 2020 2020 2020 2020 2020  85).            
-00013180: 2320 7369 6e63 6520 6e65 6564 7320 746f  # since needs to
-00013190: 2062 6520 696e 7420 696e 206d 696c 6c69   be int in milli
-000131a0: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
-000131b0: 2020 2020 5f70 6172 616d 7320 3d20 7061      _params = pa
-000131c0: 7261 6d73 2069 6620 7061 7261 6d73 2065  rams if params e
-000131d0: 6c73 6520 7b7d 0a20 2020 2020 2020 2020  lse {}.         
-000131e0: 2020 206d 795f 7472 6164 6573 203d 2073     my_trades = s
-000131f0: 656c 662e 5f61 7069 2e66 6574 6368 5f6d  elf._api.fetch_m
-00013200: 795f 7472 6164 6573 280a 2020 2020 2020  y_trades(.      
-00013210: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
-00013220: 696e 7428 2873 696e 6365 2e72 6570 6c61  int((since.repla
-00013230: 6365 2874 7a69 6e66 6f3d 7469 6d65 7a6f  ce(tzinfo=timezo
-00013240: 6e65 2e75 7463 292e 7469 6d65 7374 616d  ne.utc).timestam
-00013250: 7028 2920 2d20 3529 202a 2031 3030 3029  p() - 5) * 1000)
-00013260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013270: 2020 7061 7261 6d73 3d5f 7061 7261 6d73    params=_params
-00013280: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00013290: 7463 6865 645f 7472 6164 6573 203d 205b  tched_trades = [
-000132a0: 7472 6164 6520 666f 7220 7472 6164 6520  trade for trade 
-000132b0: 696e 206d 795f 7472 6164 6573 2069 6620  in my_trades if 
-000132c0: 7472 6164 655b 276f 7264 6572 275d 203d  trade['order'] =
-000132d0: 3d20 6f72 6465 725f 6964 5d0a 0a20 2020  = order_id]..   
-000132e0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-000132f0: 6f67 5f65 7863 6861 6e67 655f 7265 7370  og_exchange_resp
-00013300: 6f6e 7365 2827 6765 745f 7472 6164 6573  onse('get_trades
-00013310: 5f66 6f72 5f6f 7264 6572 272c 206d 6174  _for_order', mat
-00013320: 6368 6564 5f74 7261 6465 7329 0a0a 2020  ched_trades)..  
-00013330: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-00013340: 645f 7472 6164 6573 203d 2073 656c 662e  d_trades = self.
-00013350: 5f74 7261 6465 735f 636f 6e74 7261 6374  _trades_contract
-00013360: 735f 746f 5f61 6d6f 756e 7428 6d61 7463  s_to_amount(matc
-00013370: 6865 645f 7472 6164 6573 290a 0a20 2020  hed_trades)..   
-00013380: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013390: 6d61 7463 6865 645f 7472 6164 6573 0a20  matched_trades. 
-000133a0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-000133b0: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-000133c0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-000133d0: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-000133e0: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-000133f0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00013400: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-00013410: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-00013420: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-00013430: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00013440: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-00013450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00013460: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
-00013470: 7420 7472 6164 6573 2064 7565 2074 6f20  t trades due to 
-00013480: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00013490: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-000134a0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-000134b0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-000134c0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-000134d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000134e0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-000134f0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-00013500: 2065 0a0a 2020 2020 6465 6620 6765 745f   e..    def get_
-00013510: 6f72 6465 725f 6964 5f63 6f6e 6469 7469  order_id_conditi
-00013520: 6f6e 616c 2873 656c 662c 206f 7264 6572  onal(self, order
-00013530: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-00013540: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
-00013550: 2020 7265 7475 726e 206f 7264 6572 5b27    return order['
-00013560: 6964 275d 0a0a 2020 2020 4072 6574 7269  id']..    @retri
-00013570: 6572 0a20 2020 2064 6566 2067 6574 5f66  er.    def get_f
-00013580: 6565 2873 656c 662c 2073 796d 626f 6c3a  ee(self, symbol:
-00013590: 2073 7472 2c20 7479 7065 3a20 7374 7220   str, type: str 
-000135a0: 3d20 2727 2c20 7369 6465 3a20 7374 7220  = '', side: str 
-000135b0: 3d20 2727 2c20 616d 6f75 6e74 3a20 666c  = '', amount: fl
-000135c0: 6f61 7420 3d20 312c 0a20 2020 2020 2020  oat = 1,.       
-000135d0: 2020 2020 2020 2020 2070 7269 6365 3a20           price: 
-000135e0: 666c 6f61 7420 3d20 312c 2074 616b 6572  float = 1, taker
-000135f0: 5f6f 725f 6d61 6b65 723a 204d 616b 6572  _or_maker: Maker
-00013600: 5461 6b65 7220 3d20 276d 616b 6572 2729  Taker = 'maker')
-00013610: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-00013620: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00013630: 6574 7269 6576 6520 6665 6520 6672 6f6d  etrieve fee from
-00013640: 2065 7863 6861 6e67 650a 2020 2020 2020   exchange.      
-00013650: 2020 3a70 6172 616d 2073 796d 626f 6c3a    :param symbol:
-00013660: 2050 6169 720a 2020 2020 2020 2020 3a70   Pair.        :p
-00013670: 6172 616d 2074 7970 653a 2054 7970 6520  aram type: Type 
-00013680: 6f66 206f 7264 6572 2028 6d61 726b 6574  of order (market
-00013690: 2c20 6c69 6d69 742c 202e 2e2e 290a 2020  , limit, ...).  
-000136a0: 2020 2020 2020 3a70 6172 616d 2073 6964        :param sid
-000136b0: 653a 2053 6964 6520 6f66 206f 7264 6572  e: Side of order
-000136c0: 2028 6275 792c 2073 656c 6c29 0a20 2020   (buy, sell).   
-000136d0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
-000136e0: 6e74 3a20 416d 6f75 6e74 206f 6620 6f72  nt: Amount of or
-000136f0: 6465 720a 2020 2020 2020 2020 3a70 6172  der.        :par
-00013700: 616d 2070 7269 6365 3a20 5072 6963 6520  am price: Price 
-00013710: 6f66 206f 7264 6572 0a20 2020 2020 2020  of order.       
-00013720: 203a 7061 7261 6d20 7461 6b65 725f 6f72   :param taker_or
-00013730: 5f6d 616b 6572 3a20 276d 616b 6572 2720  _maker: 'maker' 
-00013740: 6f72 2027 7461 6b65 7227 2028 6967 6e6f  or 'taker' (igno
-00013750: 7265 6420 6966 2022 7479 7065 2220 6973  red if "type" is
-00013760: 2070 726f 7669 6465 6429 0a20 2020 2020   provided).     
-00013770: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00013780: 6620 7479 7065 2061 6e64 2074 7970 6520  f type and type 
-00013790: 3d3d 2027 6d61 726b 6574 273a 0a20 2020  == 'market':.   
-000137a0: 2020 2020 2020 2020 2074 616b 6572 5f6f           taker_o
-000137b0: 725f 6d61 6b65 7220 3d20 2774 616b 6572  r_maker = 'taker
-000137c0: 270a 2020 2020 2020 2020 7472 793a 0a20  '.        try:. 
-000137d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000137e0: 6c66 2e5f 636f 6e66 6967 5b27 6472 795f  lf._config['dry_
-000137f0: 7275 6e27 5d20 616e 6420 7365 6c66 2e5f  run'] and self._
-00013800: 636f 6e66 6967 2e67 6574 2827 6665 6527  config.get('fee'
-00013810: 2c20 4e6f 6e65 2920 6973 206e 6f74 204e  , None) is not N
-00013820: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00013830: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00013840: 2e5f 636f 6e66 6967 5b27 6665 6527 5d0a  ._config['fee'].
-00013850: 2020 2020 2020 2020 2020 2020 2320 7661              # va
-00013860: 6c69 6461 7465 2074 6861 7420 6d61 726b  lidate that mark
-00013870: 6574 7320 6172 6520 6c6f 6164 6564 2062  ets are loaded b
-00013880: 6566 6f72 6520 7472 7969 6e67 2074 6f20  efore trying to 
-00013890: 6765 7420 6665 650a 2020 2020 2020 2020  get fee.        
-000138a0: 2020 2020 6966 2073 656c 662e 5f61 7069      if self._api
-000138b0: 2e6d 6172 6b65 7473 2069 7320 4e6f 6e65  .markets is None
-000138c0: 206f 7220 6c65 6e28 7365 6c66 2e5f 6170   or len(self._ap
-000138d0: 692e 6d61 726b 6574 7329 203d 3d20 303a  i.markets) == 0:
-000138e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000138f0: 2073 656c 662e 5f61 7069 2e6c 6f61 645f   self._api.load_
-00013900: 6d61 726b 6574 7328 7061 7261 6d73 3d7b  markets(params={
-00013910: 7d29 0a0a 2020 2020 2020 2020 2020 2020  })..            
-00013920: 7265 7475 726e 2073 656c 662e 5f61 7069  return self._api
-00013930: 2e63 616c 6375 6c61 7465 5f66 6565 2873  .calculate_fee(s
-00013940: 796d 626f 6c3d 7379 6d62 6f6c 2c20 7479  ymbol=symbol, ty
-00013950: 7065 3d74 7970 652c 2073 6964 653d 7369  pe=type, side=si
-00013960: 6465 2c20 616d 6f75 6e74 3d61 6d6f 756e  de, amount=amoun
-00013970: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013990: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000139a0: 6963 653d 7072 6963 652c 2074 616b 6572  ice=price, taker
-000139b0: 4f72 4d61 6b65 723d 7461 6b65 725f 6f72  OrMaker=taker_or
-000139c0: 5f6d 616b 6572 295b 2772 6174 6527 5d0a  _maker)['rate'].
-000139d0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-000139e0: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-000139f0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00013a00: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-00013a10: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-00013a20: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-00013a30: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-00013a40: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-00013a50: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-00013a60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00013a70: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-00013a80: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00013a90: 2020 2066 2743 6f75 6c64 206e 6f74 2067     f'Could not g
-00013aa0: 6574 2066 6565 2069 6e66 6f20 6475 6520  et fee info due 
-00013ab0: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
-00013ac0: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
-00013ad0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-00013ae0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00013af0: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
-00013b00: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00013b10: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00013b20: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
-00013b30: 726f 6d20 650a 0a20 2020 2040 7374 6174  rom e..    @stat
-00013b40: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00013b50: 206f 7264 6572 5f68 6173 5f66 6565 286f   order_has_fee(o
-00013b60: 7264 6572 3a20 4469 6374 2920 2d3e 2062  rder: Dict) -> b
-00013b70: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00013b80: 0a20 2020 2020 2020 2056 6572 6966 6965  .        Verifie
-00013b90: 7320 6966 2074 6865 2070 6173 7365 6420  s if the passed 
-00013ba0: 696e 206f 7264 6572 2064 6963 7420 6861  in order dict ha
-00013bb0: 7320 7468 6520 6e65 6564 6564 206b 6579  s the needed key
-00013bc0: 7320 746f 2065 7874 7261 6374 2066 6565  s to extract fee
-00013bd0: 732c 0a20 2020 2020 2020 2061 6e64 2074  s,.        and t
-00013be0: 6861 7420 7468 6573 6520 6b65 7973 2028  hat these keys (
-00013bf0: 6375 7272 656e 6379 2c20 636f 7374 2920  currency, cost) 
-00013c00: 6172 6520 6e6f 7420 656d 7074 792e 0a20  are not empty.. 
-00013c10: 2020 2020 2020 203a 7061 7261 6d20 6f72         :param or
-00013c20: 6465 723a 204f 7264 6572 206f 7220 7472  der: Order or tr
-00013c30: 6164 6520 286f 6e65 2074 7261 6465 2920  ade (one trade) 
-00013c40: 6469 6374 0a20 2020 2020 2020 203a 7265  dict.        :re
-00013c50: 7475 726e 3a20 5472 7565 2069 6620 7468  turn: True if th
-00013c60: 6520 6665 6520 7375 6273 7472 7563 7475  e fee substructu
-00013c70: 7265 2063 6f6e 7461 696e 7320 6375 7272  re contains curr
-00013c80: 656e 6379 2061 6e64 2063 6f73 742c 2066  ency and cost, f
-00013c90: 616c 7365 206f 7468 6572 7769 7365 0a20  alse otherwise. 
-00013ca0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013cb0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-00013cc0: 616e 6365 286f 7264 6572 2c20 6469 6374  ance(order, dict
-00013cd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00013ce0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00013cf0: 2020 2020 7265 7475 726e 2028 2766 6565      return ('fee
-00013d00: 2720 696e 206f 7264 6572 2061 6e64 206f  ' in order and o
-00013d10: 7264 6572 5b27 6665 6527 5d20 6973 206e  rder['fee'] is n
-00013d20: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00013d30: 2020 2020 2020 2020 616e 6420 286f 7264          and (ord
-00013d40: 6572 5b27 6665 6527 5d2e 6b65 7973 2829  er['fee'].keys()
-00013d50: 203e 3d20 7b27 6375 7272 656e 6379 272c   >= {'currency',
-00013d60: 2027 636f 7374 277d 290a 2020 2020 2020   'cost'}).      
-00013d70: 2020 2020 2020 2020 2020 616e 6420 6f72            and or
-00013d80: 6465 725b 2766 6565 275d 5b27 6375 7272  der['fee']['curr
-00013d90: 656e 6379 275d 2069 7320 6e6f 7420 4e6f  ency'] is not No
-00013da0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00013db0: 2020 2061 6e64 206f 7264 6572 5b27 6665     and order['fe
-00013dc0: 6527 5d5b 2763 6f73 7427 5d20 6973 206e  e']['cost'] is n
-00013dd0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-00013de0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00013df0: 6566 2063 616c 6375 6c61 7465 5f66 6565  ef calculate_fee
-00013e00: 5f72 6174 6528 0a20 2020 2020 2020 2020  _rate(.         
-00013e10: 2020 2073 656c 662c 2066 6565 3a20 4469     self, fee: Di
-00013e20: 6374 2c20 7379 6d62 6f6c 3a20 7374 722c  ct, symbol: str,
-00013e30: 2063 6f73 743a 2066 6c6f 6174 2c20 616d   cost: float, am
-00013e40: 6f75 6e74 3a20 666c 6f61 7429 202d 3e20  ount: float) -> 
-00013e50: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
-00013e60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013e70: 2020 2020 2043 616c 6375 6c61 7465 2066       Calculate f
-00013e80: 6565 2072 6174 6520 6966 2069 7427 7320  ee rate if it's 
-00013e90: 6e6f 7420 6769 7665 6e20 6279 2074 6865  not given by the
-00013ea0: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
-00013eb0: 2020 203a 7061 7261 6d20 6665 653a 2063     :param fee: c
-00013ec0: 6378 7420 4665 6520 6469 6374 202d 206d  cxt Fee dict - m
-00013ed0: 7573 7420 636f 6e74 6169 6e20 636f 7374  ust contain cost
-00013ee0: 202f 2063 7572 7265 6e63 7920 2f20 7261   / currency / ra
-00013ef0: 7465 0a20 2020 2020 2020 203a 7061 7261  te.        :para
-00013f00: 6d20 7379 6d62 6f6c 3a20 5379 6d62 6f6c  m symbol: Symbol
-00013f10: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
-00013f20: 2020 2020 2020 3a70 6172 616d 2063 6f73        :param cos
-00013f30: 743a 2054 6f74 616c 2063 6f73 7420 6f66  t: Total cost of
-00013f40: 2074 6865 206f 7264 6572 0a20 2020 2020   the order.     
-00013f50: 2020 203a 7061 7261 6d20 616d 6f75 6e74     :param amount
-00013f60: 3a20 416d 6f75 6e74 206f 6620 7468 6520  : Amount of the 
-00013f70: 6f72 6465 720a 2020 2020 2020 2020 2222  order.        ""
-00013f80: 220a 2020 2020 2020 2020 6966 2066 6565  ".        if fee
-00013f90: 2e67 6574 2827 7261 7465 2729 2069 7320  .get('rate') is 
-00013fa0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00013fb0: 2020 2020 2020 7265 7475 726e 2066 6565        return fee
-00013fc0: 2e67 6574 2827 7261 7465 2729 0a20 2020  .get('rate').   
-00013fd0: 2020 2020 2066 6565 5f63 7572 7220 3d20       fee_curr = 
-00013fe0: 6665 652e 6765 7428 2763 7572 7265 6e63  fee.get('currenc
-00013ff0: 7927 290a 2020 2020 2020 2020 6966 2066  y').        if f
-00014000: 6565 5f63 7572 7220 6973 204e 6f6e 653a  ee_curr is None:
-00014010: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00014020: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-00014030: 2066 6565 5f63 6f73 7420 3d20 666c 6f61   fee_cost = floa
-00014040: 7428 6665 655b 2763 6f73 7427 5d29 0a20  t(fee['cost']). 
-00014050: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00014060: 6674 5f68 6173 5b27 6665 655f 636f 7374  ft_has['fee_cost
-00014070: 5f69 6e5f 636f 6e74 7261 6374 7327 5d3a  _in_contracts']:
-00014080: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-00014090: 6f6e 7665 7274 2063 6f73 7420 7669 6120  onvert cost via 
-000140a0: 2263 6f6e 7472 6163 7473 2220 636f 6e76  "contracts" conv
-000140b0: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
-000140c0: 2020 2066 6565 5f63 6f73 7420 3d20 7365     fee_cost = se
-000140d0: 6c66 2e5f 636f 6e74 7261 6374 735f 746f  lf._contracts_to
-000140e0: 5f61 6d6f 756e 7428 7379 6d62 6f6c 2c20  _amount(symbol, 
-000140f0: 6665 655b 2763 6f73 7427 5d29 0a0a 2020  fee['cost'])..  
-00014100: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
-00014110: 6520 6665 6520 6261 7365 6420 6f6e 206f  e fee based on o
-00014120: 7264 6572 2064 6574 6169 6c73 0a20 2020  rder details.   
-00014130: 2020 2020 2069 6620 6665 655f 6375 7272       if fee_curr
-00014140: 203d 3d20 7365 6c66 2e67 6574 5f70 6169   == self.get_pai
-00014150: 725f 6261 7365 5f63 7572 7265 6e63 7928  r_base_currency(
-00014160: 7379 6d62 6f6c 293a 0a20 2020 2020 2020  symbol):.       
-00014170: 2020 2020 2023 2042 6173 6520 6375 7272       # Base curr
-00014180: 656e 6379 202d 2064 6976 6964 6520 6279  ency - divide by
-00014190: 2061 6d6f 756e 740a 2020 2020 2020 2020   amount.        
-000141a0: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
-000141b0: 2866 6565 5f63 6f73 7420 2f20 616d 6f75  (fee_cost / amou
-000141c0: 6e74 2c20 3829 0a20 2020 2020 2020 2065  nt, 8).        e
-000141d0: 6c69 6620 6665 655f 6375 7272 203d 3d20  lif fee_curr == 
-000141e0: 7365 6c66 2e67 6574 5f70 6169 725f 7175  self.get_pair_qu
-000141f0: 6f74 655f 6375 7272 656e 6379 2873 796d  ote_currency(sym
-00014200: 626f 6c29 3a0a 2020 2020 2020 2020 2020  bol):.          
-00014210: 2020 2320 5175 6f74 6520 6375 7272 656e    # Quote curren
-00014220: 6379 202d 2064 6976 6964 6520 6279 2063  cy - divide by c
-00014230: 6f73 740a 2020 2020 2020 2020 2020 2020  ost.            
-00014240: 7265 7475 726e 2072 6f75 6e64 2866 6565  return round(fee
-00014250: 5f63 6f73 7420 2f20 636f 7374 2c20 3829  _cost / cost, 8)
-00014260: 2069 6620 636f 7374 2065 6c73 6520 4e6f   if cost else No
-00014270: 6e65 0a20 2020 2020 2020 2065 6c73 653a  ne.        else:
-00014280: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00014290: 6620 4665 6520 6375 7272 656e 6379 2069  f Fee currency i
-000142a0: 7320 6120 6469 6666 6572 656e 7420 6375  s a different cu
-000142b0: 7272 656e 6379 0a20 2020 2020 2020 2020  rrency.         
-000142c0: 2020 2069 6620 6e6f 7420 636f 7374 3a0a     if not cost:.
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142e0: 2320 4966 2063 6f73 7420 6973 204e 6f6e  # If cost is Non
-000142f0: 6520 6f72 2030 2e30 202d 3e20 6661 6c73  e or 0.0 -> fals
-00014300: 792c 2072 6574 7572 6e20 4e6f 6e65 0a20  y, return None. 
-00014310: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014320: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-00014330: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00014340: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-00014350: 203d 2073 656c 662e 6765 745f 7661 6c69   = self.get_vali
-00014360: 645f 7061 6972 5f63 6f6d 6269 6e61 7469  d_pair_combinati
-00014370: 6f6e 2866 6565 5f63 7572 722c 2073 656c  on(fee_curr, sel
-00014380: 662e 5f63 6f6e 6669 675b 2773 7461 6b65  f._config['stake
-00014390: 5f63 7572 7265 6e63 7927 5d29 0a20 2020  _currency']).   
-000143a0: 2020 2020 2020 2020 2020 2020 2074 6963               tic
-000143b0: 6b20 3d20 7365 6c66 2e66 6574 6368 5f74  k = self.fetch_t
-000143c0: 6963 6b65 7228 636f 6d62 290a 0a20 2020  icker(comb)..   
-000143d0: 2020 2020 2020 2020 2020 2020 2066 6565               fee
-000143e0: 5f74 6f5f 7175 6f74 655f 7261 7465 203d  _to_quote_rate =
-000143f0: 2073 6166 655f 7661 6c75 655f 6661 6c6c   safe_value_fall
-00014400: 6261 636b 3228 7469 636b 2c20 7469 636b  back2(tick, tick
-00014410: 2c20 276c 6173 7427 2c20 2761 736b 2729  , 'last', 'ask')
-00014420: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00014430: 6570 7420 4578 6368 616e 6765 4572 726f  ept ExchangeErro
-00014440: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00014450: 2020 2066 6565 5f74 6f5f 7175 6f74 655f     fee_to_quote_
-00014460: 7261 7465 203d 2073 656c 662e 5f63 6f6e  rate = self._con
-00014470: 6669 675b 2765 7863 6861 6e67 6527 5d2e  fig['exchange'].
-00014480: 6765 7428 2775 6e6b 6e6f 776e 5f66 6565  get('unknown_fee
-00014490: 5f72 6174 6527 2c20 4e6f 6e65 290a 2020  _rate', None).  
-000144a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000144b0: 206e 6f74 2066 6565 5f74 6f5f 7175 6f74   not fee_to_quot
-000144c0: 655f 7261 7465 3a0a 2020 2020 2020 2020  e_rate:.        
-000144d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000144e0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-000144f0: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
-00014500: 2828 6665 655f 636f 7374 202a 2066 6565  ((fee_cost * fee
-00014510: 5f74 6f5f 7175 6f74 655f 7261 7465 2920  _to_quote_rate) 
-00014520: 2f20 636f 7374 2c20 3829 0a0a 2020 2020  / cost, 8)..    
-00014530: 6465 6620 6578 7472 6163 745f 636f 7374  def extract_cost
-00014540: 5f63 7572 725f 7261 7465 2873 656c 662c  _curr_rate(self,
-00014550: 2066 6565 3a20 4469 6374 2c20 7379 6d62   fee: Dict, symb
-00014560: 6f6c 3a20 7374 722c 2063 6f73 743a 2066  ol: str, cost: f
-00014570: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
-00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014590: 2020 2020 2061 6d6f 756e 743a 2066 6c6f       amount: flo
-000145a0: 6174 2920 2d3e 2054 7570 6c65 5b66 6c6f  at) -> Tuple[flo
-000145b0: 6174 2c20 7374 722c 204f 7074 696f 6e61  at, str, Optiona
-000145c0: 6c5b 666c 6f61 745d 5d3a 0a20 2020 2020  l[float]]:.     
-000145d0: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
-000145e0: 7874 7261 6374 2074 7570 6c65 206f 6620  xtract tuple of 
-000145f0: 636f 7374 2c20 6375 7272 656e 6379 2c20  cost, currency, 
-00014600: 7261 7465 2e0a 2020 2020 2020 2020 5265  rate..        Re
-00014610: 7175 6972 6573 206f 7264 6572 5f68 6173  quires order_has
-00014620: 5f66 6565 2074 6f20 7275 6e20 6669 7273  _fee to run firs
-00014630: 7421 0a20 2020 2020 2020 203a 7061 7261  t!.        :para
-00014640: 6d20 6665 653a 2063 6378 7420 4665 6520  m fee: ccxt Fee 
-00014650: 6469 6374 202d 206d 7573 7420 636f 6e74  dict - must cont
-00014660: 6169 6e20 636f 7374 202f 2063 7572 7265  ain cost / curre
-00014670: 6e63 7920 2f20 7261 7465 0a20 2020 2020  ncy / rate.     
-00014680: 2020 203a 7061 7261 6d20 7379 6d62 6f6c     :param symbol
-00014690: 3a20 5379 6d62 6f6c 206f 6620 7468 6520  : Symbol of the 
-000146a0: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
-000146b0: 6172 616d 2063 6f73 743a 2054 6f74 616c  aram cost: Total
-000146c0: 2063 6f73 7420 6f66 2074 6865 206f 7264   cost of the ord
-000146d0: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
-000146e0: 6d20 616d 6f75 6e74 3a20 416d 6f75 6e74  m amount: Amount
-000146f0: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
-00014700: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
-00014710: 7570 6c65 2077 6974 6820 636f 7374 2c20  uple with cost, 
-00014720: 6375 7272 656e 6379 2c20 7261 7465 206f  currency, rate o
-00014730: 6620 7468 6520 6769 7665 6e20 6665 6520  f the given fee 
-00014740: 6469 6374 0a20 2020 2020 2020 2022 2222  dict.        """
-00014750: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014760: 2866 6c6f 6174 2866 6565 5b27 636f 7374  (float(fee['cost
-00014770: 275d 292c 0a20 2020 2020 2020 2020 2020  ']),.           
-00014780: 2020 2020 2066 6565 5b27 6375 7272 656e       fee['curren
-00014790: 6379 275d 2c0a 2020 2020 2020 2020 2020  cy'],.          
-000147a0: 2020 2020 2020 7365 6c66 2e63 616c 6375        self.calcu
-000147b0: 6c61 7465 5f66 6565 5f72 6174 6528 0a20  late_fee_rate(. 
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147d0: 2020 2066 6565 2c0a 2020 2020 2020 2020     fee,.        
-000147e0: 2020 2020 2020 2020 2020 2020 7379 6d62              symb
-000147f0: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-00014800: 2020 2020 2020 2020 636f 7374 2c0a 2020          cost,.  
-00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014820: 2020 616d 6f75 6e74 0a20 2020 2020 2020    amount.       
-00014830: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00014840: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00014850: 0a0a 2020 2020 2320 4869 7374 6f72 6963  ..    # Historic
-00014860: 2064 6174 610a 0a20 2020 2064 6566 2067   data..    def g
-00014870: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
-00014880: 7628 7365 6c66 2c20 7061 6972 3a20 7374  v(self, pair: st
-00014890: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
-000148a0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-000148b0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-000148c0: 6e63 655f 6d73 3a20 696e 742c 2063 616e  nce_ms: int, can
-000148d0: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
-000148e0: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
-00014910: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014930: 2020 2020 2020 2075 6e74 696c 5f6d 733a         until_ms:
-00014940: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00014950: 204e 6f6e 6529 202d 3e20 4c69 7374 3a0a   None) -> List:.
-00014960: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014970: 2020 2020 4765 7420 6361 6e64 6c65 2068      Get candle h
-00014980: 6973 746f 7279 2075 7369 6e67 2061 7379  istory using asy
-00014990: 6e63 696f 2061 6e64 2072 6574 7572 6e73  ncio and returns
-000149a0: 2074 6865 206c 6973 7420 6f66 2063 616e   the list of can
-000149b0: 646c 6573 2e0a 2020 2020 2020 2020 4861  dles..        Ha
-000149c0: 6e64 6c65 7320 616c 6c20 6173 796e 6320  ndles all async 
-000149d0: 776f 726b 2066 6f72 2074 6869 732e 0a20  work for this.. 
-000149e0: 2020 2020 2020 2041 7379 6e63 206f 7665         Async ove
-000149f0: 7220 6f6e 6520 7061 6972 2c20 6173 7375  r one pair, assu
-00014a00: 6d69 6e67 2077 6520 6765 7420 6073 656c  ming we get `sel
-00014a10: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
-00014a20: 696d 6974 2829 6020 6361 6e64 6c65 7320  imit()` candles 
-00014a30: 7065 7220 6361 6c6c 2e0a 2020 2020 2020  per call..      
-00014a40: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
-00014a50: 6169 7220 746f 2064 6f77 6e6c 6f61 640a  air to download.
-00014a60: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-00014a70: 696d 6566 7261 6d65 3a20 5469 6d65 6672  imeframe: Timefr
-00014a80: 616d 6520 746f 2067 6574 2064 6174 6120  ame to get data 
-00014a90: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
-00014aa0: 616d 2073 696e 6365 5f6d 733a 2054 696d  am since_ms: Tim
-00014ab0: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
-00014ac0: 6563 6f6e 6473 2074 6f20 6765 7420 6869  econds to get hi
-00014ad0: 7374 6f72 7920 6672 6f6d 0a20 2020 2020  story from.     
-00014ae0: 2020 203a 7061 7261 6d20 756e 7469 6c5f     :param until_
-00014af0: 6d73 3a20 5469 6d65 7374 616d 7020 696e  ms: Timestamp in
-00014b00: 206d 696c 6c69 7365 636f 6e64 7320 746f   milliseconds to
-00014b10: 2067 6574 2068 6973 746f 7279 2075 7020   get history up 
-00014b20: 746f 0a20 2020 2020 2020 203a 7061 7261  to.        :para
-00014b30: 6d20 6361 6e64 6c65 5f74 7970 653a 2027  m candle_type: '
-00014b40: 272c 206d 6172 6b2c 2069 6e64 6578 2c20  ', mark, index, 
-00014b50: 7072 656d 6975 6d49 6e64 6578 2c20 6f72  premiumIndex, or
-00014b60: 2066 756e 6469 6e67 5f72 6174 650a 2020   funding_rate.  
-00014b70: 2020 2020 2020 3a72 6574 7572 6e3a 204c        :return: L
-00014b80: 6973 7420 7769 7468 2063 616e 646c 6520  ist with candle 
-00014b90: 284f 484c 4356 2920 6461 7461 0a20 2020  (OHLCV) data.   
-00014ba0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014bb0: 2070 6169 722c 205f 2c20 5f2c 2064 6174   pair, _, _, dat
-00014bc0: 612c 205f 203d 2073 656c 662e 6c6f 6f70  a, _ = self.loop
-00014bd0: 2e72 756e 5f75 6e74 696c 5f63 6f6d 706c  .run_until_compl
-00014be0: 6574 6528 0a20 2020 2020 2020 2020 2020  ete(.           
-00014bf0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
-00014c00: 5f68 6973 746f 7269 635f 6f68 6c63 7628  _historic_ohlcv(
-00014c10: 7061 6972 3d70 6169 722c 2074 696d 6566  pair=pair, timef
-00014c20: 7261 6d65 3d74 696d 6566 7261 6d65 2c0a  rame=timeframe,.
-00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2020 2020 2020 2020 2073 696e 6365             since
-00014c60: 5f6d 733d 7369 6e63 655f 6d73 2c20 756e  _ms=since_ms, un
-00014c70: 7469 6c5f 6d73 3d75 6e74 696c 5f6d 732c  til_ms=until_ms,
-00014c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ca0: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
-00014cb0: 6577 5f70 6169 723d 6973 5f6e 6577 5f70  ew_pair=is_new_p
-00014cc0: 6169 722c 2063 616e 646c 655f 7479 7065  air, candle_type
-00014cd0: 3d63 616e 646c 655f 7479 7065 2929 0a20  =candle_type)). 
-00014ce0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-00014cf0: 666f 2866 2244 6f77 6e6c 6f61 6465 6420  fo(f"Downloaded 
-00014d00: 6461 7461 2066 6f72 207b 7061 6972 7d20  data for {pair} 
-00014d10: 7769 7468 206c 656e 6774 6820 7b6c 656e  with length {len
-00014d20: 2864 6174 6129 7d2e 2229 0a20 2020 2020  (data)}.").     
-00014d30: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
-00014d40: 2020 2020 6173 796e 6320 6465 6620 5f61      async def _a
-00014d50: 7379 6e63 5f67 6574 5f68 6973 746f 7269  sync_get_histori
-00014d60: 635f 6f68 6c63 7628 7365 6c66 2c20 7061  c_ohlcv(self, pa
-00014d70: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
-00014d80: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-00014d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014db0: 2073 696e 6365 5f6d 733a 2069 6e74 2c20   since_ms: int, 
-00014dc0: 6361 6e64 6c65 5f74 7970 653a 2043 616e  candle_type: Can
-00014dd0: 646c 6554 7970 652c 0a20 2020 2020 2020  dleType,.       
-00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e00: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
-00014e10: 6f6c 203d 2046 616c 7365 2c20 7261 6973  ol = False, rais
-00014e20: 655f 3a20 626f 6f6c 203d 2046 616c 7365  e_: bool = False
-00014e30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2020 2020 2020 2020 2020 756e 7469 6c5f            until_
-00014e60: 6d73 3a20 4f70 7469 6f6e 616c 5b69 6e74  ms: Optional[int
-00014e70: 5d20 3d20 4e6f 6e65 0a20 2020 2020 2020  ] = None.       
-00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ea0: 2029 202d 3e20 4f48 4c43 5652 6573 706f   ) -> OHLCVRespo
-00014eb0: 6e73 653a 0a20 2020 2020 2020 2022 2222  nse:.        """
-00014ec0: 0a20 2020 2020 2020 2044 6f77 6e6c 6f61  .        Downloa
-00014ed0: 6420 6869 7374 6f72 6963 206f 686c 6376  d historic ohlcv
-00014ee0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00014ef0: 6973 5f6e 6577 5f70 6169 723a 2075 7365  is_new_pair: use
-00014f00: 6420 6279 2062 696e 616e 6365 2073 7562  d by binance sub
-00014f10: 636c 6173 7320 746f 2061 6c6c 6f77 2022  class to allow "
-00014f20: 6661 7374 2220 6e65 7720 7061 6972 2064  fast" new pair d
-00014f30: 6f77 6e6c 6f61 6469 6e67 0a20 2020 2020  ownloading.     
-00014f40: 2020 203a 7061 7261 6d20 6361 6e64 6c65     :param candle
-00014f50: 5f74 7970 653a 2041 6e79 206f 6620 7468  _type: Any of th
-00014f60: 6520 656e 756d 2043 616e 646c 6554 7970  e enum CandleTyp
-00014f70: 6520 286d 7573 7420 6d61 7463 6820 7472  e (must match tr
-00014f80: 6164 696e 6720 6d6f 6465 2129 0a20 2020  ading mode!).   
-00014f90: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00014fa0: 2020 6f6e 655f 6361 6c6c 203d 2074 696d    one_call = tim
-00014fb0: 6566 7261 6d65 5f74 6f5f 6d73 6563 7328  eframe_to_msecs(
-00014fc0: 7469 6d65 6672 616d 6529 202a 2073 656c  timeframe) * sel
-00014fd0: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
-00014fe0: 696d 6974 280a 2020 2020 2020 2020 2020  imit(.          
-00014ff0: 2020 7469 6d65 6672 616d 652c 2063 616e    timeframe, can
-00015000: 646c 655f 7479 7065 2c20 7369 6e63 655f  dle_type, since_
-00015010: 6d73 290a 2020 2020 2020 2020 6c6f 6767  ms).        logg
-00015020: 6572 2e64 6562 7567 280a 2020 2020 2020  er.debug(.      
-00015030: 2020 2020 2020 226f 6e65 5f63 616c 6c3a        "one_call:
-00015040: 2025 7320 6d73 6563 7320 2825 7329 222c   %s msecs (%s)",
-00015050: 0a20 2020 2020 2020 2020 2020 206f 6e65  .            one
-00015060: 5f63 616c 6c2c 0a20 2020 2020 2020 2020  _call,.         
-00015070: 2020 2064 745f 6875 6d61 6e69 7a65 2864     dt_humanize(d
-00015080: 745f 6e6f 7728 2920 2d20 7469 6d65 6465  t_now() - timede
-00015090: 6c74 6128 6d69 6c6c 6973 6563 6f6e 6473  lta(milliseconds
-000150a0: 3d6f 6e65 5f63 616c 6c29 2c20 6f6e 6c79  =one_call), only
-000150b0: 5f64 6973 7461 6e63 653d 5472 7565 290a  _distance=True).
-000150c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000150d0: 2020 696e 7075 745f 636f 726f 7574 696e    input_coroutin
-000150e0: 6573 203d 205b 7365 6c66 2e5f 6173 796e  es = [self._asyn
-000150f0: 635f 6765 745f 6361 6e64 6c65 5f68 6973  c_get_candle_his
-00015100: 746f 7279 280a 2020 2020 2020 2020 2020  tory(.          
-00015110: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
-00015120: 652c 2063 616e 646c 655f 7479 7065 2c20  e, candle_type, 
-00015130: 7369 6e63 6529 2066 6f72 2073 696e 6365  since) for since
-00015140: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-00015150: 7261 6e67 6528 7369 6e63 655f 6d73 2c20  range(since_ms, 
-00015160: 756e 7469 6c5f 6d73 206f 7220 6474 5f74  until_ms or dt_t
-00015170: 7328 292c 206f 6e65 5f63 616c 6c29 5d0a  s(), one_call)].
-00015180: 0a20 2020 2020 2020 2064 6174 613a 204c  .        data: L
-00015190: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
-000151a0: 2023 2043 6875 6e6b 2072 6571 7565 7374   # Chunk request
-000151b0: 7320 696e 746f 2062 6174 6368 6573 206f  s into batches o
-000151c0: 6620 3130 3020 746f 2061 766f 6964 206f  f 100 to avoid o
-000151d0: 7665 7277 656c 6d69 6e67 2063 6378 7420  verwelming ccxt 
-000151e0: 5468 726f 7474 6c69 6e67 0a20 2020 2020  Throttling.     
-000151f0: 2020 2066 6f72 2069 6e70 7574 5f63 6f72     for input_cor
-00015200: 6f20 696e 2063 6875 6e6b 7328 696e 7075  o in chunks(inpu
-00015210: 745f 636f 726f 7574 696e 6573 2c20 3130  t_coroutines, 10
-00015220: 3029 3a0a 0a20 2020 2020 2020 2020 2020  0):..           
-00015230: 2072 6573 756c 7473 203d 2061 7761 6974   results = await
-00015240: 2061 7379 6e63 696f 2e67 6174 6865 7228   asyncio.gather(
-00015250: 2a69 6e70 7574 5f63 6f72 6f2c 2072 6574  *input_coro, ret
-00015260: 7572 6e5f 6578 6365 7074 696f 6e73 3d54  urn_exceptions=T
-00015270: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00015280: 2066 6f72 2072 6573 2069 6e20 7265 7375   for res in resu
-00015290: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
-000152a0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000152b0: 6365 2872 6573 2c20 4578 6365 7074 696f  ce(res, Exceptio
-000152c0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-000152d0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-000152e0: 6172 6e69 6e67 2866 2241 7379 6e63 2063  arning(f"Async c
-000152f0: 6f64 6520 7261 6973 6564 2061 6e20 6578  ode raised an ex
-00015300: 6365 7074 696f 6e3a 207b 7265 7072 2872  ception: {repr(r
-00015310: 6573 297d 2229 0a20 2020 2020 2020 2020  es)}").         
-00015320: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
-00015330: 6973 655f 3a0a 2020 2020 2020 2020 2020  ise_:.          
-00015340: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00015350: 6973 650a 2020 2020 2020 2020 2020 2020  ise.            
-00015360: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00015370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015380: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015390: 2020 2020 2020 2020 2020 2023 2044 6563             # Dec
-000153a0: 6f6e 7374 7275 6374 2074 7570 6c65 2069  onstruct tuple i
-000153b0: 6620 6974 2773 206e 6f74 2061 6e20 6578  f it's not an ex
-000153c0: 6365 7074 696f 6e0a 2020 2020 2020 2020  ception.        
-000153d0: 2020 2020 2020 2020 2020 2020 702c 205f              p, _
-000153e0: 2c20 632c 206e 6577 5f64 6174 612c 205f  , c, new_data, _
-000153f0: 203d 2072 6573 0a20 2020 2020 2020 2020   = res.         
-00015400: 2020 2020 2020 2020 2020 2069 6620 7020             if p 
-00015410: 3d3d 2070 6169 7220 616e 6420 6320 3d3d  == pair and c ==
-00015420: 2063 616e 646c 655f 7479 7065 3a0a 2020   candle_type:.  
-00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015440: 2020 2020 2020 6461 7461 2e65 7874 656e        data.exten
-00015450: 6428 6e65 775f 6461 7461 290a 2020 2020  d(new_data).    
-00015460: 2020 2020 2320 536f 7274 2064 6174 6120      # Sort data 
-00015470: 6167 6169 6e20 6166 7465 7220 6578 7465  again after exte
-00015480: 6e64 696e 6720 7468 6520 7265 7375 6c74  nding the result
-00015490: 202d 2061 626f 7665 2063 616c 6c73 2072   - above calls r
-000154a0: 6574 7572 6e20 696e 2022 6173 796e 6320  eturn in "async 
-000154b0: 6f72 6465 7222 0a20 2020 2020 2020 2064  order".        d
-000154c0: 6174 6120 3d20 736f 7274 6564 2864 6174  ata = sorted(dat
-000154d0: 612c 206b 6579 3d6c 616d 6264 6120 783a  a, key=lambda x:
-000154e0: 2078 5b30 5d29 0a20 2020 2020 2020 2072   x[0]).        r
-000154f0: 6574 7572 6e20 7061 6972 2c20 7469 6d65  eturn pair, time
-00015500: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00015510: 7065 2c20 6461 7461 2c20 7365 6c66 2e5f  pe, data, self._
-00015520: 6f68 6c63 765f 7061 7274 6961 6c5f 6361  ohlcv_partial_ca
-00015530: 6e64 6c65 0a0a 2020 2020 6465 6620 5f62  ndle..    def _b
-00015540: 7569 6c64 5f63 6f72 6f75 7469 6e65 280a  uild_coroutine(.
-00015550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015560: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
-00015570: 6566 7261 6d65 3a20 7374 722c 2063 616e  eframe: str, can
-00015580: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
-00015590: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
-000155a0: 2020 7369 6e63 655f 6d73 3a20 4f70 7469    since_ms: Opti
-000155b0: 6f6e 616c 5b69 6e74 5d2c 2063 6163 6865  onal[int], cache
-000155c0: 3a20 626f 6f6c 2920 2d3e 2043 6f72 6f75  : bool) -> Corou
-000155d0: 7469 6e65 5b41 6e79 2c20 416e 792c 204f  tine[Any, Any, O
-000155e0: 484c 4356 5265 7370 6f6e 7365 5d3a 0a20  HLCVResponse]:. 
-000155f0: 2020 2020 2020 206e 6f74 5f61 6c6c 5f64         not_all_d
-00015600: 6174 6120 3d20 6361 6368 6520 616e 6420  ata = cache and 
-00015610: 7365 6c66 2e72 6571 7569 7265 645f 6361  self.required_ca
-00015620: 6e64 6c65 5f63 616c 6c5f 636f 756e 7420  ndle_call_count 
-00015630: 3e20 310a 2020 2020 2020 2020 6966 2063  > 1.        if c
-00015640: 6163 6865 2061 6e64 2028 7061 6972 2c20  ache and (pair, 
-00015650: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-00015660: 655f 7479 7065 2920 696e 2073 656c 662e  e_type) in self.
-00015670: 5f6b 6c69 6e65 733a 0a20 2020 2020 2020  _klines:.       
-00015680: 2020 2020 2063 616e 646c 655f 6c69 6d69       candle_limi
-00015690: 7420 3d20 7365 6c66 2e6f 686c 6376 5f63  t = self.ohlcv_c
-000156a0: 616e 646c 655f 6c69 6d69 7428 7469 6d65  andle_limit(time
-000156b0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-000156c0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-000156d0: 6d69 6e5f 6461 7465 203d 2064 6174 655f  min_date = date_
-000156e0: 6d69 6e75 735f 6361 6e64 6c65 7328 7469  minus_candles(ti
-000156f0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-00015700: 6c69 6d69 7420 2d20 3529 2e74 696d 6573  limit - 5).times
-00015710: 7461 6d70 2829 0a20 2020 2020 2020 2020  tamp().         
-00015720: 2020 2023 2043 6865 636b 2069 6620 3120     # Check if 1 
-00015730: 6361 6c6c 2063 616e 2067 6574 2075 7320  call can get us 
-00015740: 7570 6461 7465 6420 6361 6e64 6c65 7320  updated candles 
-00015750: 7769 7468 6f75 7420 686f 6c65 2069 6e20  without hole in 
-00015760: 7468 6520 6461 7461 2e0a 2020 2020 2020  the data..      
-00015770: 2020 2020 2020 6966 206d 696e 5f64 6174        if min_dat
-00015780: 6520 3c20 7365 6c66 2e5f 7061 6972 735f  e < self._pairs_
-00015790: 6c61 7374 5f72 6566 7265 7368 5f74 696d  last_refresh_tim
-000157a0: 652e 6765 7428 2870 6169 722c 2074 696d  e.get((pair, tim
-000157b0: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
-000157c0: 7970 6529 2c20 3029 3a0a 2020 2020 2020  ype), 0):.      
-000157d0: 2020 2020 2020 2020 2020 2320 4361 6368            # Cach
-000157e0: 6520 6361 6e20 6265 2075 7365 6420 2d20  e can be used - 
-000157f0: 646f 206f 6e65 2d6f 6666 2063 616c 6c2e  do one-off call.
-00015800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015810: 206e 6f74 5f61 6c6c 5f64 6174 6120 3d20   not_all_data = 
-00015820: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00015830: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015840: 2020 2020 2020 2020 2320 5469 6d65 206a          # Time j
-00015850: 756d 7020 6465 7465 6374 6564 2c20 6576  ump detected, ev
-00015860: 6963 7420 6361 6368 650a 2020 2020 2020  ict cache.      
-00015870: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00015880: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
-00015890: 2020 2020 2020 2020 2020 2066 2254 696d             f"Tim
-000158a0: 6520 6a75 6d70 2064 6574 6563 7465 642e  e jump detected.
-000158b0: 2045 7669 6374 696e 6720 6361 6368 6520   Evicting cache 
-000158c0: 666f 7220 7b70 6169 727d 2c20 7b74 696d  for {pair}, {tim
-000158d0: 6566 7261 6d65 7d2c 207b 6361 6e64 6c65  eframe}, {candle
-000158e0: 5f74 7970 657d 2229 0a20 2020 2020 2020  _type}").       
-000158f0: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
-00015900: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
-00015910: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-00015920: 6c65 5f74 7970 6529 5d0a 0a20 2020 2020  le_type)]..     
-00015930: 2020 2069 6620 286e 6f74 2073 696e 6365     if (not since
-00015940: 5f6d 7320 616e 6420 2873 656c 662e 5f66  _ms and (self._f
-00015950: 745f 6861 735b 226f 686c 6376 5f72 6571  t_has["ohlcv_req
-00015960: 7569 7265 5f73 696e 6365 225d 206f 7220  uire_since"] or 
-00015970: 6e6f 745f 616c 6c5f 6461 7461 2929 3a0a  not_all_data)):.
-00015980: 2020 2020 2020 2020 2020 2020 2320 4d75              # Mu
-00015990: 6c74 6970 6c65 2063 616c 6c73 2066 6f72  ltiple calls for
-000159a0: 206f 6e65 2070 6169 7220 2d20 746f 2067   one pair - to g
-000159b0: 6574 206d 6f72 6520 6869 7374 6f72 790a  et more history.
-000159c0: 2020 2020 2020 2020 2020 2020 6f6e 655f              one_
-000159d0: 6361 6c6c 203d 2074 696d 6566 7261 6d65  call = timeframe
-000159e0: 5f74 6f5f 6d73 6563 7328 7469 6d65 6672  _to_msecs(timefr
-000159f0: 616d 6529 202a 2073 656c 662e 6f68 6c63  ame) * self.ohlc
-00015a00: 765f 6361 6e64 6c65 5f6c 696d 6974 280a  v_candle_limit(.
-00015a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a20: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-00015a30: 655f 7479 7065 2c20 7369 6e63 655f 6d73  e_type, since_ms
-00015a40: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
-00015a50: 7665 5f74 6f20 3d20 6f6e 655f 6361 6c6c  ve_to = one_call
-00015a60: 202a 2073 656c 662e 7265 7175 6972 6564   * self.required
-00015a70: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
-00015a80: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
-00015a90: 6f77 203d 2074 696d 6566 7261 6d65 5f74  ow = timeframe_t
-00015aa0: 6f5f 6e65 7874 5f64 6174 6528 7469 6d65  o_next_date(time
-00015ab0: 6672 616d 6529 0a20 2020 2020 2020 2020  frame).         
-00015ac0: 2020 2073 696e 6365 5f6d 7320 3d20 696e     since_ms = in
-00015ad0: 7428 286e 6f77 202d 2074 696d 6564 656c  t((now - timedel
-00015ae0: 7461 2873 6563 6f6e 6473 3d6d 6f76 655f  ta(seconds=move_
-00015af0: 746f 202f 2f20 3130 3030 2929 2e74 696d  to // 1000)).tim
-00015b00: 6573 7461 6d70 2829 202a 2031 3030 3029  estamp() * 1000)
-00015b10: 0a0a 2020 2020 2020 2020 6966 2073 696e  ..        if sin
-00015b20: 6365 5f6d 733a 0a20 2020 2020 2020 2020  ce_ms:.         
-00015b30: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00015b40: 6173 796e 635f 6765 745f 6869 7374 6f72  async_get_histor
-00015b50: 6963 5f6f 686c 6376 280a 2020 2020 2020  ic_ohlcv(.      
-00015b60: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
-00015b70: 7469 6d65 6672 616d 652c 2073 696e 6365  timeframe, since
-00015b80: 5f6d 733d 7369 6e63 655f 6d73 2c20 7261  _ms=since_ms, ra
-00015b90: 6973 655f 3d54 7275 652c 2063 616e 646c  ise_=True, candl
-00015ba0: 655f 7479 7065 3d63 616e 646c 655f 7479  e_type=candle_ty
-00015bb0: 7065 290a 2020 2020 2020 2020 656c 7365  pe).        else
-00015bc0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00015bd0: 4f6e 6520 6361 6c6c 202e 2e2e 2022 7265  One call ... "re
-00015be0: 6775 6c61 7222 2072 6566 7265 7368 0a20  gular" refresh. 
-00015bf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00015c00: 6e20 7365 6c66 2e5f 6173 796e 635f 6765  n self._async_ge
-00015c10: 745f 6361 6e64 6c65 5f68 6973 746f 7279  t_candle_history
-00015c20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00015c30: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
-00015c40: 652c 2073 696e 6365 5f6d 733d 7369 6e63  e, since_ms=sinc
-00015c50: 655f 6d73 2c20 6361 6e64 6c65 5f74 7970  e_ms, candle_typ
-00015c60: 653d 6361 6e64 6c65 5f74 7970 6529 0a0a  e=candle_type)..
-00015c70: 2020 2020 6465 6620 5f62 7569 6c64 5f6f      def _build_o
-00015c80: 686c 6376 5f64 6c5f 6a6f 6273 280a 2020  hlcv_dl_jobs(.  
-00015c90: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-00015ca0: 7061 6972 5f6c 6973 743a 204c 6973 7450  pair_list: ListP
-00015cb0: 6169 7273 5769 7468 5469 6d65 6672 616d  airsWithTimefram
-00015cc0: 6573 2c20 7369 6e63 655f 6d73 3a20 4f70  es, since_ms: Op
-00015cd0: 7469 6f6e 616c 5b69 6e74 5d2c 0a20 2020  tional[int],.   
-00015ce0: 2020 2020 2020 2020 2063 6163 6865 3a20           cache: 
-00015cf0: 626f 6f6c 2920 2d3e 2054 7570 6c65 5b4c  bool) -> Tuple[L
-00015d00: 6973 745b 436f 726f 7574 696e 655d 2c20  ist[Coroutine], 
-00015d10: 4c69 7374 5b54 7570 6c65 5b73 7472 2c20  List[Tuple[str, 
-00015d20: 7374 722c 2043 616e 646c 6554 7970 655d  str, CandleType]
-00015d30: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
-00015d40: 2020 2020 2020 2020 4275 696c 6420 436f          Build Co
-00015d50: 726f 7574 696e 6573 2074 6f20 6578 6563  routines to exec
-00015d60: 7574 6520 6173 2070 6172 7420 6f66 2072  ute as part of r
-00015d70: 6566 7265 7368 5f6c 6174 6573 745f 6f68  efresh_latest_oh
-00015d80: 6c63 760a 2020 2020 2020 2020 2222 220a  lcv.        """.
-00015d90: 2020 2020 2020 2020 696e 7075 745f 636f          input_co
-00015da0: 726f 7574 696e 6573 3a20 4c69 7374 5b43  routines: List[C
-00015db0: 6f72 6f75 7469 6e65 5b41 6e79 2c20 416e  oroutine[Any, An
-00015dc0: 792c 204f 484c 4356 5265 7370 6f6e 7365  y, OHLCVResponse
-00015dd0: 5d5d 203d 205b 5d0a 2020 2020 2020 2020  ]] = [].        
-00015de0: 6361 6368 6564 5f70 6169 7273 203d 205b  cached_pairs = [
-00015df0: 5d0a 2020 2020 2020 2020 666f 7220 7061  ].        for pa
-00015e00: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
-00015e10: 616e 646c 655f 7479 7065 2069 6e20 7365  andle_type in se
-00015e20: 7428 7061 6972 5f6c 6973 7429 3a0a 2020  t(pair_list):.  
-00015e30: 2020 2020 2020 2020 2020 6966 2028 7469            if (ti
-00015e40: 6d65 6672 616d 6520 6e6f 7420 696e 2073  meframe not in s
-00015e50: 656c 662e 7469 6d65 6672 616d 6573 0a20  elf.timeframes. 
-00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e70: 2020 2061 6e64 2063 616e 646c 655f 7479     and candle_ty
-00015e80: 7065 2069 6e20 2843 616e 646c 6554 7970  pe in (CandleTyp
-00015e90: 652e 5350 4f54 2c20 4361 6e64 6c65 5479  e.SPOT, CandleTy
-00015ea0: 7065 2e46 5554 5552 4553 2929 3a0a 2020  pe.FUTURES)):.  
-00015eb0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00015ec0: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
-00015ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ee0: 2020 6622 4361 6e6e 6f74 2064 6f77 6e6c    f"Cannot downl
-00015ef0: 6f61 6420 287b 7061 6972 7d2c 207b 7469  oad ({pair}, {ti
-00015f00: 6d65 6672 616d 657d 2920 636f 6d62 696e  meframe}) combin
-00015f10: 6174 696f 6e20 6173 2074 6869 7320 7469  ation as this ti
-00015f20: 6d65 6672 616d 6520 6973 2022 0a20 2020  meframe is ".   
-00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f40: 2066 226e 6f74 2061 7661 696c 6162 6c65   f"not available
-00015f50: 206f 6e20 7b73 656c 662e 6e61 6d65 7d2e   on {self.name}.
-00015f60: 2041 7661 696c 6162 6c65 2074 696d 6566   Available timef
-00015f70: 7261 6d65 7320 6172 6520 220a 2020 2020  rames are ".    
-00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f90: 6622 7b27 2c20 272e 6a6f 696e 2873 656c  f"{', '.join(sel
-00015fa0: 662e 7469 6d65 6672 616d 6573 297d 2e22  f.timeframes)}."
-00015fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015fc0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
-00015fd0: 2020 2020 2020 2020 6966 2028 2870 6169          if ((pai
-00015fe0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
-00015ff0: 6e64 6c65 5f74 7970 6529 206e 6f74 2069  ndle_type) not i
-00016000: 6e20 7365 6c66 2e5f 6b6c 696e 6573 206f  n self._klines o
-00016010: 7220 6e6f 7420 6361 6368 650a 2020 2020  r not cache.    
-00016020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016030: 6f72 2073 656c 662e 5f6e 6f77 5f69 735f  or self._now_is_
-00016040: 7469 6d65 5f74 6f5f 7265 6672 6573 6828  time_to_refresh(
-00016050: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-00016060: 2063 616e 646c 655f 7479 7065 2929 3a0a   candle_type)):.
-00016070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016080: 2069 6e70 7574 5f63 6f72 6f75 7469 6e65   input_coroutine
-00016090: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
-000160a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000160b0: 6c66 2e5f 6275 696c 645f 636f 726f 7574  lf._build_corout
-000160c0: 696e 6528 7061 6972 2c20 7469 6d65 6672  ine(pair, timefr
-000160d0: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
-000160e0: 2c20 7369 6e63 655f 6d73 2c20 6361 6368  , since_ms, cach
-000160f0: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
-00016100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016110: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00016120: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
-00016130: 2020 2020 2020 2020 2066 2255 7369 6e67           f"Using
-00016140: 2063 6163 6865 6420 6361 6e64 6c65 2028   cached candle (
-00016150: 4f48 4c43 5629 2064 6174 6120 666f 7220  OHLCV) data for 
-00016160: 7b70 6169 727d 2c20 7b74 696d 6566 7261  {pair}, {timefra
-00016170: 6d65 7d2c 207b 6361 6e64 6c65 5f74 7970  me}, {candle_typ
-00016180: 657d 202e 2e2e 220a 2020 2020 2020 2020  e} ...".        
-00016190: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000161a0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
-000161b0: 5f70 6169 7273 2e61 7070 656e 6428 2870  _pairs.append((p
-000161c0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-000161d0: 6361 6e64 6c65 5f74 7970 6529 290a 0a20  candle_type)).. 
-000161e0: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
-000161f0: 7075 745f 636f 726f 7574 696e 6573 2c20  put_coroutines, 
-00016200: 6361 6368 6564 5f70 6169 7273 0a0a 2020  cached_pairs..  
-00016210: 2020 6465 6620 5f70 726f 6365 7373 5f6f    def _process_o
-00016220: 686c 6376 5f64 6628 7365 6c66 2c20 7061  hlcv_df(self, pa
-00016230: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
-00016240: 6d65 3a20 7374 722c 2063 5f74 7970 653a  me: str, c_type:
-00016250: 2043 616e 646c 6554 7970 652c 2074 6963   CandleType, tic
-00016260: 6b73 3a20 4c69 7374 5b4c 6973 745d 2c0a  ks: List[List],.
-00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016280: 2020 2020 2020 2020 2020 6361 6368 653a            cache:
-00016290: 2062 6f6f 6c2c 2064 726f 705f 696e 636f   bool, drop_inco
-000162a0: 6d70 6c65 7465 3a20 626f 6f6c 2920 2d3e  mplete: bool) ->
-000162b0: 2044 6174 6146 7261 6d65 3a0a 2020 2020   DataFrame:.    
-000162c0: 2020 2020 2320 6b65 6570 696e 6720 6c61      # keeping la
-000162d0: 7374 2063 616e 646c 6520 7469 6d65 2061  st candle time a
-000162e0: 7320 6c61 7374 2072 6566 7265 7368 6564  s last refreshed
-000162f0: 2074 696d 6520 6f66 2074 6865 2070 6169   time of the pai
-00016300: 720a 2020 2020 2020 2020 6966 2074 6963  r.        if tic
-00016310: 6b73 2061 6e64 2063 6163 6865 3a0a 2020  ks and cache:.  
-00016320: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-00016330: 2d32 2069 6620 6472 6f70 5f69 6e63 6f6d  -2 if drop_incom
-00016340: 706c 6574 6520 616e 6420 6c65 6e28 7469  plete and len(ti
-00016350: 636b 7329 203e 2031 2065 6c73 6520 2d31  cks) > 1 else -1
-00016360: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016370: 662e 5f70 6169 7273 5f6c 6173 745f 7265  f._pairs_last_re
-00016380: 6672 6573 685f 7469 6d65 5b28 7061 6972  fresh_time[(pair
-00016390: 2c20 7469 6d65 6672 616d 652c 2063 5f74  , timeframe, c_t
-000163a0: 7970 6529 5d20 3d20 7469 636b 735b 6964  ype)] = ticks[id
-000163b0: 785d 5b30 5d20 2f2f 2031 3030 300a 2020  x][0] // 1000.  
-000163c0: 2020 2020 2020 2320 6b65 6570 696e 6720        # keeping 
-000163d0: 7061 7273 6564 2064 6174 6166 7261 6d65  parsed dataframe
-000163e0: 2069 6e20 6361 6368 650a 2020 2020 2020   in cache.      
-000163f0: 2020 6f68 6c63 765f 6466 203d 206f 686c    ohlcv_df = ohl
-00016400: 6376 5f74 6f5f 6461 7461 6672 616d 6528  cv_to_dataframe(
-00016410: 7469 636b 732c 2074 696d 6566 7261 6d65  ticks, timeframe
-00016420: 2c20 7061 6972 3d70 6169 722c 2066 696c  , pair=pair, fil
-00016430: 6c5f 6d69 7373 696e 673d 5472 7565 2c0a  l_missing=True,.
-00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016460: 2020 2020 2020 6472 6f70 5f69 6e63 6f6d        drop_incom
-00016470: 706c 6574 653d 6472 6f70 5f69 6e63 6f6d  plete=drop_incom
-00016480: 706c 6574 6529 0a20 2020 2020 2020 2069  plete).        i
-00016490: 6620 6361 6368 653a 0a20 2020 2020 2020  f cache:.       
-000164a0: 2020 2020 2069 6620 2870 6169 722c 2074       if (pair, t
-000164b0: 696d 6566 7261 6d65 2c20 635f 7479 7065  imeframe, c_type
-000164c0: 2920 696e 2073 656c 662e 5f6b 6c69 6e65  ) in self._kline
-000164d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000164e0: 2020 206f 6c64 203d 2073 656c 662e 5f6b     old = self._k
-000164f0: 6c69 6e65 735b 2870 6169 722c 2074 696d  lines[(pair, tim
-00016500: 6566 7261 6d65 2c20 635f 7479 7065 295d  eframe, c_type)]
-00016510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016520: 2023 2052 6561 7373 6967 6e20 736f 2077   # Reassign so w
-00016530: 6520 7265 7475 726e 2074 6865 2075 7064  e return the upd
-00016540: 6174 6564 2c20 636f 6d62 696e 6564 2064  ated, combined d
-00016550: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-00016560: 2020 6f68 6c63 765f 6466 203d 2063 6c65    ohlcv_df = cle
-00016570: 616e 5f6f 686c 6376 5f64 6174 6166 7261  an_ohlcv_datafra
-00016580: 6d65 2863 6f6e 6361 7428 5b6f 6c64 2c20  me(concat([old, 
-00016590: 6f68 6c63 765f 6466 5d2c 2061 7869 733d  ohlcv_df], axis=
-000165a0: 3029 2c20 7469 6d65 6672 616d 652c 2070  0), timeframe, p
-000165b0: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
-000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165e0: 2020 2020 2020 6669 6c6c 5f6d 6973 7369        fill_missi
-000165f0: 6e67 3d54 7275 652c 2064 726f 705f 696e  ng=True, drop_in
-00016600: 636f 6d70 6c65 7465 3d46 616c 7365 290a  complete=False).
-00016610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016620: 6361 6e64 6c65 5f6c 696d 6974 203d 2073  candle_limit = s
-00016630: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
-00016640: 5f6c 696d 6974 2874 696d 6566 7261 6d65  _limit(timeframe
-00016650: 2c20 7365 6c66 2e5f 636f 6e66 6967 5b27  , self._config['
-00016660: 6361 6e64 6c65 5f74 7970 655f 6465 6627  candle_type_def'
-00016670: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00016680: 2020 2023 2041 6765 206f 7574 206f 6c64     # Age out old
-00016690: 2063 616e 646c 6573 0a20 2020 2020 2020   candles.       
-000166a0: 2020 2020 2020 2020 206f 686c 6376 5f64           ohlcv_d
-000166b0: 6620 3d20 6f68 6c63 765f 6466 2e74 6169  f = ohlcv_df.tai
-000166c0: 6c28 6361 6e64 6c65 5f6c 696d 6974 202b  l(candle_limit +
-000166d0: 2073 656c 662e 5f73 7461 7274 7570 5f63   self._startup_c
-000166e0: 616e 646c 655f 636f 756e 7429 0a20 2020  andle_count).   
-000166f0: 2020 2020 2020 2020 2020 2020 206f 686c               ohl
-00016700: 6376 5f64 6620 3d20 6f68 6c63 765f 6466  cv_df = ohlcv_df
-00016710: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
-00016720: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
-00016730: 2020 2020 2020 2020 7365 6c66 2e5f 6b6c          self._kl
-00016740: 696e 6573 5b28 7061 6972 2c20 7469 6d65  ines[(pair, time
-00016750: 6672 616d 652c 2063 5f74 7970 6529 5d20  frame, c_type)] 
-00016760: 3d20 6f68 6c63 765f 6466 0a20 2020 2020  = ohlcv_df.     
-00016770: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00016780: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016790: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
-000167a0: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
-000167b0: 7065 295d 203d 206f 686c 6376 5f64 660a  pe)] = ohlcv_df.
-000167c0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-000167d0: 686c 6376 5f64 660a 0a20 2020 2064 6566  hlcv_df..    def
-000167e0: 2072 6566 7265 7368 5f6c 6174 6573 745f   refresh_latest_
-000167f0: 6f68 6c63 7628 7365 6c66 2c20 7061 6972  ohlcv(self, pair
-00016800: 5f6c 6973 743a 204c 6973 7450 6169 7273  _list: ListPairs
-00016810: 5769 7468 5469 6d65 6672 616d 6573 2c20  WithTimeframes, 
-00016820: 2a2c 0a20 2020 2020 2020 2020 2020 2020  *,.             
-00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016840: 7369 6e63 655f 6d73 3a20 4f70 7469 6f6e  since_ms: Option
-00016850: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c20  al[int] = None, 
-00016860: 6361 6368 653a 2062 6f6f 6c20 3d20 5472  cache: bool = Tr
-00016870: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011450: 2020 2073 656c 662e 5f66 745f 6861 735b     self._ft_has[
+00011460: 276c 325f 6c69 6d69 745f 7261 6e67 655f  'l2_limit_range_
+00011470: 7265 7175 6972 6564 275d 290a 2020 2020  required']).    
+00011480: 2020 2020 7472 793a 0a0a 2020 2020 2020      try:..      
+00011490: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000114a0: 662e 5f61 7069 2e66 6574 6368 5f6c 325f  f._api.fetch_l2_
+000114b0: 6f72 6465 725f 626f 6f6b 2870 6169 722c  order_book(pair,
+000114c0: 206c 696d 6974 3129 0a20 2020 2020 2020   limit1).       
+000114d0: 2065 7863 6570 7420 6363 7874 2e4e 6f74   except ccxt.Not
+000114e0: 5375 7070 6f72 7465 6420 6173 2065 3a0a  Supported as e:.
+000114f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011500: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00011510: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00011520: 2020 2020 2020 2020 6627 4578 6368 616e          f'Exchan
+00011530: 6765 207b 7365 6c66 2e5f 6170 692e 6e61  ge {self._api.na
+00011540: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
+00011550: 706f 7274 2066 6574 6368 696e 6720 6f72  port fetching or
+00011560: 6465 7220 626f 6f6b 2e27 0a20 2020 2020  der book.'.     
+00011570: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
+00011580: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+00011590: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+000115a0: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
+000115b0: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
+000115c0: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
+000115d0: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
+000115e0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+000115f0: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
+00011600: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
+00011610: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
+00011620: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00011630: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
+00011640: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00011650: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
+00011660: 7420 6765 7420 6f72 6465 7220 626f 6f6b  t get order book
+00011670: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
+00011680: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
+00011690: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
+000116a0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+000116b0: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
+000116c0: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+000116d0: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+000116e0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000116f0: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
+00011700: 6465 6620 5f67 6574 5f70 7269 6365 5f73  def _get_price_s
+00011710: 6964 6528 7365 6c66 2c20 7369 6465 3a20  ide(self, side: 
+00011720: 7374 722c 2069 735f 7368 6f72 743a 2062  str, is_short: b
+00011730: 6f6f 6c2c 2063 6f6e 665f 7374 7261 7465  ool, conf_strate
+00011740: 6779 3a20 4469 6374 2920 2d3e 2042 6964  gy: Dict) -> Bid
+00011750: 4173 6b3a 0a20 2020 2020 2020 2070 7269  Ask:.        pri
+00011760: 6365 5f73 6964 6520 3d20 636f 6e66 5f73  ce_side = conf_s
+00011770: 7472 6174 6567 795b 2770 7269 6365 5f73  trategy['price_s
+00011780: 6964 6527 5d0a 0a20 2020 2020 2020 2069  ide']..        i
+00011790: 6620 7072 6963 655f 7369 6465 2069 6e20  f price_side in 
+000117a0: 2827 7361 6d65 272c 2027 6f74 6865 7227  ('same', 'other'
+000117b0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+000117c0: 7269 6365 5f6d 6170 203d 207b 0a20 2020  rice_map = {.   
+000117d0: 2020 2020 2020 2020 2020 2020 2028 2765               ('e
+000117e0: 6e74 7279 272c 2027 6c6f 6e67 272c 2027  ntry', 'long', '
+000117f0: 7361 6d65 2729 3a20 2762 6964 272c 0a20  same'): 'bid',. 
+00011800: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00011810: 2765 6e74 7279 272c 2027 6c6f 6e67 272c  'entry', 'long',
+00011820: 2027 6f74 6865 7227 293a 2027 6173 6b27   'other'): 'ask'
+00011830: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011840: 2020 2827 656e 7472 7927 2c20 2773 686f    ('entry', 'sho
+00011850: 7274 272c 2027 7361 6d65 2729 3a20 2761  rt', 'same'): 'a
+00011860: 736b 272c 0a20 2020 2020 2020 2020 2020  sk',.           
+00011870: 2020 2020 2028 2765 6e74 7279 272c 2027       ('entry', '
+00011880: 7368 6f72 7427 2c20 276f 7468 6572 2729  short', 'other')
+00011890: 3a20 2762 6964 272c 0a20 2020 2020 2020  : 'bid',.       
+000118a0: 2020 2020 2020 2020 2028 2765 7869 7427           ('exit'
+000118b0: 2c20 276c 6f6e 6727 2c20 2773 616d 6527  , 'long', 'same'
+000118c0: 293a 2027 6173 6b27 2c0a 2020 2020 2020  ): 'ask',.      
+000118d0: 2020 2020 2020 2020 2020 2827 6578 6974            ('exit
+000118e0: 272c 2027 6c6f 6e67 272c 2027 6f74 6865  ', 'long', 'othe
+000118f0: 7227 293a 2027 6269 6427 2c0a 2020 2020  r'): 'bid',.    
+00011900: 2020 2020 2020 2020 2020 2020 2827 6578              ('ex
+00011910: 6974 272c 2027 7368 6f72 7427 2c20 2773  it', 'short', 's
+00011920: 616d 6527 293a 2027 6269 6427 2c0a 2020  ame'): 'bid',.  
+00011930: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+00011940: 6578 6974 272c 2027 7368 6f72 7427 2c20  exit', 'short', 
+00011950: 276f 7468 6572 2729 3a20 2761 736b 272c  'other'): 'ask',
+00011960: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+00011970: 2020 2020 2020 2020 2020 2070 7269 6365             price
+00011980: 5f73 6964 6520 3d20 7072 6963 655f 6d61  _side = price_ma
+00011990: 705b 2873 6964 652c 2027 7368 6f72 7427  p[(side, 'short'
+000119a0: 2069 6620 6973 5f73 686f 7274 2065 6c73   if is_short els
+000119b0: 6520 276c 6f6e 6727 2c20 7072 6963 655f  e 'long', price_
+000119c0: 7369 6465 295d 0a20 2020 2020 2020 2072  side)].        r
+000119d0: 6574 7572 6e20 7072 6963 655f 7369 6465  eturn price_side
+000119e0: 0a0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
+000119f0: 7465 2873 656c 662c 2070 6169 723a 2073  te(self, pair: s
+00011a00: 7472 2c20 7265 6672 6573 683a 2062 6f6f  tr, refresh: boo
+00011a10: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+00011a20: 2020 2020 7369 6465 3a20 456e 7472 7945      side: EntryE
+00011a30: 7869 742c 2069 735f 7368 6f72 743a 2062  xit, is_short: b
+00011a40: 6f6f 6c2c 0a20 2020 2020 2020 2020 2020  ool,.           
+00011a50: 2020 2020 2020 6f72 6465 725f 626f 6f6b        order_book
+00011a60: 3a20 4f70 7469 6f6e 616c 5b4f 7264 6572  : Optional[Order
+00011a70: 426f 6f6b 5d20 3d20 4e6f 6e65 2c20 7469  Book] = None, ti
+00011a80: 636b 6572 3a20 4f70 7469 6f6e 616c 5b54  cker: Optional[T
+00011a90: 6963 6b65 725d 203d 204e 6f6e 6529 202d  icker] = None) -
+00011aa0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+00011ab0: 2022 2222 0a20 2020 2020 2020 2043 616c   """.        Cal
+00011ac0: 6375 6c61 7465 7320 6269 642f 6173 6b20  culates bid/ask 
+00011ad0: 7461 7267 6574 0a20 2020 2020 2020 2062  target.        b
+00011ae0: 6964 2072 6174 6520 2d20 6265 7477 6565  id rate - betwee
+00011af0: 6e20 6375 7272 656e 7420 6173 6b20 7072  n current ask pr
+00011b00: 6963 6520 616e 6420 6c61 7374 2070 7269  ice and last pri
+00011b10: 6365 0a20 2020 2020 2020 2061 736b 2072  ce.        ask r
+00011b20: 6174 6520 2d20 6569 7468 6572 2075 7369  ate - either usi
+00011b30: 6e67 2074 6963 6b65 7220 6269 6420 6f72  ng ticker bid or
+00011b40: 2066 6972 7374 2062 6964 2062 6173 6564   first bid based
+00011b50: 206f 6e20 6f72 6465 7262 6f6f 6b0a 2020   on orderbook.  
+00011b60: 2020 2020 2020 6f72 2072 656d 6169 6e20        or remain 
+00011b70: 7374 6174 6963 2069 6e20 616e 7920 6f74  static in any ot
+00011b80: 6865 7220 6361 7365 2073 696e 6365 2069  her case since i
+00011b90: 7427 7320 6e6f 7420 7570 6461 7469 6e67  t's not updating
+00011ba0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00011bb0: 2070 6169 723a 2050 6169 7220 746f 2067   pair: Pair to g
+00011bc0: 6574 2072 6174 6520 666f 720a 2020 2020  et rate for.    
+00011bd0: 2020 2020 3a70 6172 616d 2072 6566 7265      :param refre
+00011be0: 7368 3a20 616c 6c6f 7720 6361 6368 6564  sh: allow cached
+00011bf0: 2064 6174 610a 2020 2020 2020 2020 3a70   data.        :p
+00011c00: 6172 616d 2073 6964 653a 2022 6275 7922  aram side: "buy"
+00011c10: 206f 7220 2273 656c 6c22 0a20 2020 2020   or "sell".     
+00011c20: 2020 203a 7265 7475 726e 3a20 666c 6f61     :return: floa
+00011c30: 743a 2050 7269 6365 0a20 2020 2020 2020  t: Price.       
+00011c40: 203a 7261 6973 6573 2050 7269 6369 6e67   :raises Pricing
+00011c50: 4572 726f 7220 6966 206f 7264 6572 626f  Error if orderbo
+00011c60: 6f6b 2070 7269 6365 2063 6f75 6c64 206e  ok price could n
+00011c70: 6f74 2062 6520 6465 7465 726d 696e 6564  ot be determined
+00011c80: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00011c90: 2020 2020 2020 6e61 6d65 203d 2073 6964        name = sid
+00011ca0: 652e 6361 7069 7461 6c69 7a65 2829 0a20  e.capitalize(). 
+00011cb0: 2020 2020 2020 2073 7472 6174 5f6e 616d         strat_nam
+00011cc0: 6520 3d20 2765 6e74 7279 5f70 7269 6369  e = 'entry_prici
+00011cd0: 6e67 2720 6966 2073 6964 6520 3d3d 2022  ng' if side == "
+00011ce0: 656e 7472 7922 2065 6c73 6520 2765 7869  entry" else 'exi
+00011cf0: 745f 7072 6963 696e 6727 0a0a 2020 2020  t_pricing'..    
+00011d00: 2020 2020 6361 6368 655f 7261 7465 3a20      cache_rate: 
+00011d10: 5454 4c43 6163 6865 203d 2073 656c 662e  TTLCache = self.
+00011d20: 5f65 6e74 7279 5f72 6174 655f 6361 6368  _entry_rate_cach
+00011d30: 6520 6966 2073 6964 6520 3d3d 2022 656e  e if side == "en
+00011d40: 7472 7922 2065 6c73 6520 7365 6c66 2e5f  try" else self._
+00011d50: 6578 6974 5f72 6174 655f 6361 6368 650a  exit_rate_cache.
+00011d60: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00011d70: 6566 7265 7368 3a0a 2020 2020 2020 2020  efresh:.        
+00011d80: 2020 2020 7769 7468 2073 656c 662e 5f63      with self._c
+00011d90: 6163 6865 5f6c 6f63 6b3a 0a20 2020 2020  ache_lock:.     
+00011da0: 2020 2020 2020 2020 2020 2072 6174 6520             rate 
+00011db0: 3d20 6361 6368 655f 7261 7465 2e67 6574  = cache_rate.get
+00011dc0: 2870 6169 7229 0a20 2020 2020 2020 2020  (pair).         
+00011dd0: 2020 2023 2043 6865 636b 2069 6620 6361     # Check if ca
+00011de0: 6368 6520 6861 7320 6265 656e 2069 6e76  che has been inv
+00011df0: 616c 6964 6174 6564 0a20 2020 2020 2020  alidated.       
+00011e00: 2020 2020 2069 6620 7261 7465 3a0a 2020       if rate:.  
+00011e10: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00011e20: 6767 6572 2e64 6562 7567 2866 2255 7369  gger.debug(f"Usi
+00011e30: 6e67 2063 6163 6865 6420 7b73 6964 657d  ng cached {side}
+00011e40: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
+00011e50: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00011e60: 2020 2020 7265 7475 726e 2072 6174 650a      return rate.
+00011e70: 0a20 2020 2020 2020 2063 6f6e 665f 7374  .        conf_st
+00011e80: 7261 7465 6779 203d 2073 656c 662e 5f63  rategy = self._c
+00011e90: 6f6e 6669 672e 6765 7428 7374 7261 745f  onfig.get(strat_
+00011ea0: 6e61 6d65 2c20 7b7d 290a 0a20 2020 2020  name, {})..     
+00011eb0: 2020 2070 7269 6365 5f73 6964 6520 3d20     price_side = 
+00011ec0: 7365 6c66 2e5f 6765 745f 7072 6963 655f  self._get_price_
+00011ed0: 7369 6465 2873 6964 652c 2069 735f 7368  side(side, is_sh
+00011ee0: 6f72 742c 2063 6f6e 665f 7374 7261 7465  ort, conf_strate
+00011ef0: 6779 290a 0a20 2020 2020 2020 2069 6620  gy)..        if 
+00011f00: 636f 6e66 5f73 7472 6174 6567 792e 6765  conf_strategy.ge
+00011f10: 7428 2775 7365 5f6f 7264 6572 5f62 6f6f  t('use_order_boo
+00011f20: 6b27 2c20 4661 6c73 6529 3a0a 0a20 2020  k', False):..   
+00011f30: 2020 2020 2020 2020 206f 7264 6572 5f62           order_b
+00011f40: 6f6f 6b5f 746f 7020 3d20 636f 6e66 5f73  ook_top = conf_s
+00011f50: 7472 6174 6567 792e 6765 7428 276f 7264  trategy.get('ord
+00011f60: 6572 5f62 6f6f 6b5f 746f 7027 2c20 3129  er_book_top', 1)
+00011f70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011f80: 6f72 6465 725f 626f 6f6b 2069 7320 4e6f  order_book is No
+00011f90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00011fa0: 2020 2020 6f72 6465 725f 626f 6f6b 203d      order_book =
+00011fb0: 2073 656c 662e 6665 7463 685f 6c32 5f6f   self.fetch_l2_o
+00011fc0: 7264 6572 5f62 6f6f 6b28 7061 6972 2c20  rder_book(pair, 
+00011fd0: 6f72 6465 725f 626f 6f6b 5f74 6f70 290a  order_book_top).
+00011fe0: 2020 2020 2020 2020 2020 2020 7261 7465              rate
+00011ff0: 203d 2073 656c 662e 5f67 6574 5f72 6174   = self._get_rat
+00012000: 655f 6672 6f6d 5f6f 6228 7061 6972 2c20  e_from_ob(pair, 
+00012010: 7369 6465 2c20 6f72 6465 725f 626f 6f6b  side, order_book
+00012020: 2c20 6e61 6d65 2c20 7072 6963 655f 7369  , name, price_si
+00012030: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012050: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00012060: 6465 725f 626f 6f6b 5f74 6f70 290a 2020  der_book_top).  
+00012070: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012080: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+00012090: 6562 7567 2866 2255 7369 6e67 204c 6173  ebug(f"Using Las
+000120a0: 7420 7b70 7269 6365 5f73 6964 652e 6361  t {price_side.ca
+000120b0: 7069 7461 6c69 7a65 2829 7d20 2f20 4c61  pitalize()} / La
+000120c0: 7374 2050 7269 6365 2229 0a20 2020 2020  st Price").     
+000120d0: 2020 2020 2020 2069 6620 7469 636b 6572         if ticker
+000120e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000120f0: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
+00012100: 203d 2073 656c 662e 6665 7463 685f 7469   = self.fetch_ti
+00012110: 636b 6572 2870 6169 7229 0a20 2020 2020  cker(pair).     
+00012120: 2020 2020 2020 2072 6174 6520 3d20 7365         rate = se
+00012130: 6c66 2e5f 6765 745f 7261 7465 5f66 726f  lf._get_rate_fro
+00012140: 6d5f 7469 636b 6572 2873 6964 652c 2074  m_ticker(side, t
+00012150: 6963 6b65 722c 2063 6f6e 665f 7374 7261  icker, conf_stra
+00012160: 7465 6779 2c20 7072 6963 655f 7369 6465  tegy, price_side
+00012170: 290a 0a20 2020 2020 2020 2069 6620 7261  )..        if ra
+00012180: 7465 2069 7320 4e6f 6e65 3a0a 2020 2020  te is None:.    
+00012190: 2020 2020 2020 2020 7261 6973 6520 5072          raise Pr
+000121a0: 6963 696e 6745 7272 6f72 2866 227b 6e61  icingError(f"{na
+000121b0: 6d65 7d2d 5261 7465 2066 6f72 207b 7061  me}-Rate for {pa
+000121c0: 6972 7d20 7761 7320 656d 7074 792e 2229  ir} was empty.")
+000121d0: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+000121e0: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
+000121f0: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00012200: 655f 7261 7465 5b70 6169 725d 203d 2072  e_rate[pair] = r
+00012210: 6174 650a 0a20 2020 2020 2020 2072 6574  ate..        ret
+00012220: 7572 6e20 7261 7465 0a0a 2020 2020 6465  urn rate..    de
+00012230: 6620 5f67 6574 5f72 6174 655f 6672 6f6d  f _get_rate_from
+00012240: 5f74 6963 6b65 7228 7365 6c66 2c20 7369  _ticker(self, si
+00012250: 6465 3a20 456e 7472 7945 7869 742c 2074  de: EntryExit, t
+00012260: 6963 6b65 723a 2054 6963 6b65 722c 2063  icker: Ticker, c
+00012270: 6f6e 665f 7374 7261 7465 6779 3a20 4469  onf_strategy: Di
+00012280: 6374 5b73 7472 2c20 416e 795d 2c0a 2020  ct[str, Any],.  
+00012290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122a0: 2020 2020 2020 2020 2020 2020 7072 6963              pric
+000122b0: 655f 7369 6465 3a20 4269 6441 736b 2920  e_side: BidAsk) 
+000122c0: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
+000122d0: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+000122e0: 2020 2020 2020 2020 4765 7420 7261 7465          Get rate
+000122f0: 2066 726f 6d20 7469 636b 6572 2e0a 2020   from ticker..  
+00012300: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012310: 2020 7469 636b 6572 5f72 6174 6520 3d20    ticker_rate = 
+00012320: 7469 636b 6572 5b70 7269 6365 5f73 6964  ticker[price_sid
+00012330: 655d 0a20 2020 2020 2020 2069 6620 7469  e].        if ti
+00012340: 636b 6572 5b27 6c61 7374 275d 2061 6e64  cker['last'] and
+00012350: 2074 6963 6b65 725f 7261 7465 3a0a 2020   ticker_rate:.  
+00012360: 2020 2020 2020 2020 2020 6966 2073 6964            if sid
+00012370: 6520 3d3d 2027 656e 7472 7927 2061 6e64  e == 'entry' and
+00012380: 2074 6963 6b65 725f 7261 7465 203e 2074   ticker_rate > t
+00012390: 6963 6b65 725b 276c 6173 7427 5d3a 0a20  icker['last']:. 
+000123a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000123b0: 616c 616e 6365 203d 2063 6f6e 665f 7374  alance = conf_st
+000123c0: 7261 7465 6779 2e67 6574 2827 7072 6963  rategy.get('pric
+000123d0: 655f 6c61 7374 5f62 616c 616e 6365 272c  e_last_balance',
+000123e0: 2030 2e30 290a 2020 2020 2020 2020 2020   0.0).          
+000123f0: 2020 2020 2020 7469 636b 6572 5f72 6174        ticker_rat
+00012400: 6520 3d20 7469 636b 6572 5f72 6174 6520  e = ticker_rate 
+00012410: 2b20 6261 6c61 6e63 6520 2a20 2874 6963  + balance * (tic
+00012420: 6b65 725b 276c 6173 7427 5d20 2d20 7469  ker['last'] - ti
+00012430: 636b 6572 5f72 6174 6529 0a20 2020 2020  cker_rate).     
+00012440: 2020 2020 2020 2065 6c69 6620 7369 6465         elif side
+00012450: 203d 3d20 2765 7869 7427 2061 6e64 2074   == 'exit' and t
+00012460: 6963 6b65 725f 7261 7465 203c 2074 6963  icker_rate < tic
+00012470: 6b65 725b 276c 6173 7427 5d3a 0a20 2020  ker['last']:.   
+00012480: 2020 2020 2020 2020 2020 2020 2062 616c               bal
+00012490: 616e 6365 203d 2063 6f6e 665f 7374 7261  ance = conf_stra
+000124a0: 7465 6779 2e67 6574 2827 7072 6963 655f  tegy.get('price_
+000124b0: 6c61 7374 5f62 616c 616e 6365 272c 2030  last_balance', 0
+000124c0: 2e30 290a 2020 2020 2020 2020 2020 2020  .0).            
+000124d0: 2020 2020 7469 636b 6572 5f72 6174 6520      ticker_rate 
+000124e0: 3d20 7469 636b 6572 5f72 6174 6520 2d20  = ticker_rate - 
+000124f0: 6261 6c61 6e63 6520 2a20 2874 6963 6b65  balance * (ticke
+00012500: 725f 7261 7465 202d 2074 6963 6b65 725b  r_rate - ticker[
+00012510: 276c 6173 7427 5d29 0a20 2020 2020 2020  'last']).       
+00012520: 2072 6174 6520 3d20 7469 636b 6572 5f72   rate = ticker_r
+00012530: 6174 650a 2020 2020 2020 2020 7265 7475  ate.        retu
+00012540: 726e 2072 6174 650a 0a20 2020 2064 6566  rn rate..    def
+00012550: 205f 6765 745f 7261 7465 5f66 726f 6d5f   _get_rate_from_
+00012560: 6f62 2873 656c 662c 2070 6169 723a 2073  ob(self, pair: s
+00012570: 7472 2c20 7369 6465 3a20 456e 7472 7945  tr, side: EntryE
+00012580: 7869 742c 206f 7264 6572 5f62 6f6f 6b3a  xit, order_book:
+00012590: 204f 7264 6572 426f 6f6b 2c20 6e61 6d65   OrderBook, name
+000125a0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+000125b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125c0: 2070 7269 6365 5f73 6964 653a 2042 6964   price_side: Bid
+000125d0: 4173 6b2c 206f 7264 6572 5f62 6f6f 6b5f  Ask, order_book_
+000125e0: 746f 703a 2069 6e74 2920 2d3e 2066 6c6f  top: int) -> flo
+000125f0: 6174 3a0a 2020 2020 2020 2020 2222 220a  at:.        """.
+00012600: 2020 2020 2020 2020 4765 7420 7261 7465          Get rate
+00012610: 2066 726f 6d20 6f72 6465 7262 6f6f 6b0a   from orderbook.
+00012620: 2020 2020 2020 2020 3a72 6169 7365 733a          :raises:
+00012630: 2050 7269 6369 6e67 4572 726f 7220 6966   PricingError if
+00012640: 2072 6174 6520 636f 756c 6420 6e6f 7420   rate could not 
+00012650: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
+00012660: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00012670: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00012680: 276f 7264 6572 5f62 6f6f 6b20 2573 272c  'order_book %s',
+00012690: 206f 7264 6572 5f62 6f6f 6b29 0a20 2020   order_book).   
+000126a0: 2020 2020 2023 2074 6f70 2031 203d 2069       # top 1 = i
+000126b0: 6e64 6578 2030 0a20 2020 2020 2020 2074  ndex 0.        t
+000126c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000126d0: 6f62 7369 6465 3a20 4f42 4c69 7465 7261  obside: OBLitera
+000126e0: 6c20 3d20 2762 6964 7327 2069 6620 7072  l = 'bids' if pr
+000126f0: 6963 655f 7369 6465 203d 3d20 2762 6964  ice_side == 'bid
+00012700: 2720 656c 7365 2027 6173 6b73 270a 2020  ' else 'asks'.  
+00012710: 2020 2020 2020 2020 2020 7261 7465 203d            rate =
+00012720: 206f 7264 6572 5f62 6f6f 6b5b 6f62 7369   order_book[obsi
+00012730: 6465 5d5b 6f72 6465 725f 626f 6f6b 5f74  de][order_book_t
+00012740: 6f70 202d 2031 5d5b 305d 0a20 2020 2020  op - 1][0].     
+00012750: 2020 2065 7863 6570 7420 2849 6e64 6578     except (Index
+00012760: 4572 726f 722c 204b 6579 4572 726f 7229  Error, KeyError)
+00012770: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00012780: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+00012790: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+000127a0: 2020 2020 2020 2066 227b 7061 6972 7d20         f"{pair} 
+000127b0: 2d20 7b6e 616d 657d 2050 7269 6365 2061  - {name} Price a
+000127c0: 7420 6c6f 6361 7469 6f6e 207b 6f72 6465  t location {orde
+000127d0: 725f 626f 6f6b 5f74 6f70 7d20 6672 6f6d  r_book_top} from
+000127e0: 206f 7264 6572 626f 6f6b 2022 0a20 2020   orderbook ".   
+000127f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012800: 2066 2263 6f75 6c64 206e 6f74 2062 6520   f"could not be 
+00012810: 6465 7465 726d 696e 6564 2e20 4f72 6465  determined. Orde
+00012820: 7262 6f6f 6b3a 207b 6f72 6465 725f 626f  rbook: {order_bo
+00012830: 6f6b 7d22 0a20 2020 2020 2020 2020 2020  ok}".           
+00012840: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00012850: 2020 2072 6169 7365 2050 7269 6369 6e67     raise Pricing
+00012860: 4572 726f 7220 6672 6f6d 2065 0a20 2020  Error from e.   
+00012870: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00012880: 6728 6622 7b70 6169 727d 202d 207b 6e61  g(f"{pair} - {na
+00012890: 6d65 7d20 7072 6963 6520 6672 6f6d 206f  me} price from o
+000128a0: 7264 6572 626f 6f6b 207b 7072 6963 655f  rderbook {price_
+000128b0: 7369 6465 2e63 6170 6974 616c 697a 6528  side.capitalize(
+000128c0: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
+000128d0: 2020 2020 2020 2020 2066 2273 6964 6520           f"side 
+000128e0: 2d20 746f 7020 7b6f 7264 6572 5f62 6f6f  - top {order_boo
+000128f0: 6b5f 746f 707d 206f 7264 6572 2062 6f6f  k_top} order boo
+00012900: 6b20 7b73 6964 657d 2072 6174 6520 7b72  k {side} rate {r
+00012910: 6174 653a 2e38 667d 2229 0a20 2020 2020  ate:.8f}").     
+00012920: 2020 2072 6574 7572 6e20 7261 7465 0a0a     return rate..
+00012930: 2020 2020 6465 6620 6765 745f 7261 7465      def get_rate
+00012940: 7328 7365 6c66 2c20 7061 6972 3a20 7374  s(self, pair: st
+00012950: 722c 2072 6566 7265 7368 3a20 626f 6f6c  r, refresh: bool
+00012960: 2c20 6973 5f73 686f 7274 3a20 626f 6f6c  , is_short: bool
+00012970: 2920 2d3e 2054 7570 6c65 5b66 6c6f 6174  ) -> Tuple[float
+00012980: 2c20 666c 6f61 745d 3a0a 2020 2020 2020  , float]:.      
+00012990: 2020 656e 7472 795f 7261 7465 203d 204e    entry_rate = N
+000129a0: 6f6e 650a 2020 2020 2020 2020 6578 6974  one.        exit
+000129b0: 5f72 6174 6520 3d20 4e6f 6e65 0a20 2020  _rate = None.   
+000129c0: 2020 2020 2069 6620 6e6f 7420 7265 6672       if not refr
+000129d0: 6573 683a 0a20 2020 2020 2020 2020 2020  esh:.           
+000129e0: 2077 6974 6820 7365 6c66 2e5f 6361 6368   with self._cach
+000129f0: 655f 6c6f 636b 3a0a 2020 2020 2020 2020  e_lock:.        
+00012a00: 2020 2020 2020 2020 656e 7472 795f 7261          entry_ra
+00012a10: 7465 203d 2073 656c 662e 5f65 6e74 7279  te = self._entry
+00012a20: 5f72 6174 655f 6361 6368 652e 6765 7428  _rate_cache.get(
+00012a30: 7061 6972 290a 2020 2020 2020 2020 2020  pair).          
+00012a40: 2020 2020 2020 6578 6974 5f72 6174 6520        exit_rate 
+00012a50: 3d20 7365 6c66 2e5f 6578 6974 5f72 6174  = self._exit_rat
+00012a60: 655f 6361 6368 652e 6765 7428 7061 6972  e_cache.get(pair
+00012a70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00012a80: 2065 6e74 7279 5f72 6174 653a 0a20 2020   entry_rate:.   
+00012a90: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00012aa0: 6765 722e 6465 6275 6728 6622 5573 696e  ger.debug(f"Usin
+00012ab0: 6720 6361 6368 6564 2062 7579 2072 6174  g cached buy rat
+00012ac0: 6520 666f 7220 7b70 6169 727d 2e22 290a  e for {pair}.").
+00012ad0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00012ae0: 7869 745f 7261 7465 3a0a 2020 2020 2020  xit_rate:.      
+00012af0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00012b00: 2e64 6562 7567 2866 2255 7369 6e67 2063  .debug(f"Using c
+00012b10: 6163 6865 6420 7365 6c6c 2072 6174 6520  ached sell rate 
+00012b20: 666f 7220 7b70 6169 727d 2e22 290a 0a20  for {pair}.").. 
+00012b30: 2020 2020 2020 2065 6e74 7279 5f70 7269         entry_pri
+00012b40: 6369 6e67 203d 2073 656c 662e 5f63 6f6e  cing = self._con
+00012b50: 6669 672e 6765 7428 2765 6e74 7279 5f70  fig.get('entry_p
+00012b60: 7269 6369 6e67 272c 207b 7d29 0a20 2020  ricing', {}).   
+00012b70: 2020 2020 2065 7869 745f 7072 6963 696e       exit_pricin
+00012b80: 6720 3d20 7365 6c66 2e5f 636f 6e66 6967  g = self._config
+00012b90: 2e67 6574 2827 6578 6974 5f70 7269 6369  .get('exit_prici
+00012ba0: 6e67 272c 207b 7d29 0a20 2020 2020 2020  ng', {}).       
+00012bb0: 206f 7264 6572 5f62 6f6f 6b20 3d20 7469   order_book = ti
+00012bc0: 636b 6572 203d 204e 6f6e 650a 2020 2020  cker = None.    
+00012bd0: 2020 2020 6966 206e 6f74 2065 6e74 7279      if not entry
+00012be0: 5f72 6174 6520 616e 6420 656e 7472 795f  _rate and entry_
+00012bf0: 7072 6963 696e 672e 6765 7428 2775 7365  pricing.get('use
+00012c00: 5f6f 7264 6572 5f62 6f6f 6b27 2c20 4661  _order_book', Fa
+00012c10: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+00012c20: 2020 6f72 6465 725f 626f 6f6b 5f74 6f70    order_book_top
+00012c30: 203d 206d 6178 2865 6e74 7279 5f70 7269   = max(entry_pri
+00012c40: 6369 6e67 2e67 6574 2827 6f72 6465 725f  cing.get('order_
+00012c50: 626f 6f6b 5f74 6f70 272c 2031 292c 0a20  book_top', 1),. 
+00012c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c80: 6578 6974 5f70 7269 6369 6e67 2e67 6574  exit_pricing.get
+00012c90: 2827 6f72 6465 725f 626f 6f6b 5f74 6f70  ('order_book_top
+00012ca0: 272c 2031 2929 0a20 2020 2020 2020 2020  ', 1)).         
+00012cb0: 2020 206f 7264 6572 5f62 6f6f 6b20 3d20     order_book = 
+00012cc0: 7365 6c66 2e66 6574 6368 5f6c 325f 6f72  self.fetch_l2_or
+00012cd0: 6465 725f 626f 6f6b 2870 6169 722c 206f  der_book(pair, o
+00012ce0: 7264 6572 5f62 6f6f 6b5f 746f 7029 0a20  rder_book_top). 
+00012cf0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00012d00: 5f72 6174 6520 3d20 7365 6c66 2e67 6574  _rate = self.get
+00012d10: 5f72 6174 6528 7061 6972 2c20 7265 6672  _rate(pair, refr
+00012d20: 6573 682c 2027 656e 7472 7927 2c20 6973  esh, 'entry', is
+00012d30: 5f73 686f 7274 2c20 6f72 6465 725f 626f  _short, order_bo
+00012d40: 6f6b 3d6f 7264 6572 5f62 6f6f 6b29 0a20  ok=order_book). 
+00012d50: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00012d60: 656e 7472 795f 7261 7465 3a0a 2020 2020  entry_rate:.    
+00012d70: 2020 2020 2020 2020 7469 636b 6572 203d          ticker =
+00012d80: 2073 656c 662e 6665 7463 685f 7469 636b   self.fetch_tick
+00012d90: 6572 2870 6169 7229 0a20 2020 2020 2020  er(pair).       
+00012da0: 2020 2020 2065 6e74 7279 5f72 6174 6520       entry_rate 
+00012db0: 3d20 7365 6c66 2e67 6574 5f72 6174 6528  = self.get_rate(
+00012dc0: 7061 6972 2c20 7265 6672 6573 682c 2027  pair, refresh, '
+00012dd0: 656e 7472 7927 2c20 6973 5f73 686f 7274  entry', is_short
+00012de0: 2c20 7469 636b 6572 3d74 6963 6b65 7229  , ticker=ticker)
+00012df0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00012e00: 6578 6974 5f72 6174 653a 0a20 2020 2020  exit_rate:.     
+00012e10: 2020 2020 2020 2065 7869 745f 7261 7465         exit_rate
+00012e20: 203d 2073 656c 662e 6765 745f 7261 7465   = self.get_rate
+00012e30: 2870 6169 722c 2072 6566 7265 7368 2c20  (pair, refresh, 
+00012e40: 2765 7869 7427 2c0a 2020 2020 2020 2020  'exit',.        
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00012e70: 5f73 686f 7274 2c20 6f72 6465 725f 626f  _short, order_bo
+00012e80: 6f6b 3d6f 7264 6572 5f62 6f6f 6b2c 2074  ok=order_book, t
+00012e90: 6963 6b65 723d 7469 636b 6572 290a 2020  icker=ticker).  
+00012ea0: 2020 2020 2020 7265 7475 726e 2065 6e74        return ent
+00012eb0: 7279 5f72 6174 652c 2065 7869 745f 7261  ry_rate, exit_ra
+00012ec0: 7465 0a0a 2020 2020 2320 4665 6520 6861  te..    # Fee ha
+00012ed0: 6e64 6c69 6e67 0a0a 2020 2020 4072 6574  ndling..    @ret
+00012ee0: 7269 6572 0a20 2020 2064 6566 2067 6574  rier.    def get
+00012ef0: 5f74 7261 6465 735f 666f 725f 6f72 6465  _trades_for_orde
+00012f00: 7228 7365 6c66 2c20 6f72 6465 725f 6964  r(self, order_id
+00012f10: 3a20 7374 722c 2070 6169 723a 2073 7472  : str, pair: str
+00012f20: 2c20 7369 6e63 653a 2064 6174 6574 696d  , since: datetim
+00012f30: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00012f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f50: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
+00012f60: 5b44 6963 745d 203d 204e 6f6e 6529 202d  [Dict] = None) -
+00012f70: 3e20 4c69 7374 3a0a 2020 2020 2020 2020  > List:.        
+00012f80: 2222 220a 2020 2020 2020 2020 4665 7463  """.        Fetc
+00012f90: 6820 4f72 6465 7273 2075 7369 6e67 2074  h Orders using t
+00012fa0: 6865 2022 6665 7463 685f 6d79 5f74 7261  he "fetch_my_tra
+00012fb0: 6465 7322 2065 6e64 706f 696e 7420 616e  des" endpoint an
+00012fc0: 6420 6669 6c74 6572 2074 6865 6d20 6279  d filter them by
+00012fd0: 206f 7264 6572 2d69 642e 0a20 2020 2020   order-id..     
+00012fe0: 2020 2054 6865 2022 7369 6e63 6522 2061     The "since" a
+00012ff0: 7267 756d 656e 7420 7061 7373 6564 2069  rgument passed i
+00013000: 6e20 6973 2063 6f6d 696e 6720 6672 6f6d  n is coming from
+00013010: 2074 6865 2064 6174 6162 6173 6520 616e   the database an
+00013020: 6420 6973 2069 6e20 5554 432c 0a20 2020  d is in UTC,.   
+00013030: 2020 2020 2061 7320 7469 6d65 7a6f 6e65       as timezone
+00013040: 2d6e 6174 6976 6520 6461 7465 7469 6d65  -native datetime
+00013050: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+00013060: 2046 726f 6d20 7468 6520 7079 7468 6f6e   From the python
+00013070: 2064 6f63 756d 656e 7461 7469 6f6e 3a0a   documentation:.
+00013080: 2020 2020 2020 2020 2020 2020 3e20 4e61              > Na
+00013090: 6976 6520 6461 7465 7469 6d65 2069 6e73  ive datetime ins
+000130a0: 7461 6e63 6573 2061 7265 2061 7373 756d  tances are assum
+000130b0: 6564 2074 6f20 7265 7072 6573 656e 7420  ed to represent 
+000130c0: 6c6f 6361 6c20 7469 6d65 0a20 2020 2020  local time.     
+000130d0: 2020 2054 6865 7265 666f 7265 2c20 6361     Therefore, ca
+000130e0: 6c6c 696e 6720 2273 696e 6365 2e74 696d  lling "since.tim
+000130f0: 6573 7461 6d70 2829 2220 7769 6c6c 2067  estamp()" will g
+00013100: 6574 2074 6865 2055 5443 2074 696d 6573  et the UTC times
+00013110: 7461 6d70 2c20 6166 7465 7220 6170 706c  tamp, after appl
+00013120: 7969 6e67 2074 6865 0a20 2020 2020 2020  ying the.       
+00013130: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+00013140: 6672 6f6d 206c 6f63 616c 2074 696d 657a  from local timez
+00013150: 6f6e 6520 746f 2055 5443 2e0a 2020 2020  one to UTC..    
+00013160: 2020 2020 5468 6973 2077 6f72 6b73 2066      This works f
+00013170: 6f72 2074 696d 657a 6f6e 6573 2055 5443  or timezones UTC
+00013180: 2b20 7369 6e63 6520 7468 656e 2074 6865  + since then the
+00013190: 2072 6573 756c 7420 7769 6c6c 2063 6f6e   result will con
+000131a0: 7461 696e 2074 7261 6465 7320 6672 6f6d  tain trades from
+000131b0: 2061 2066 6577 2068 6f75 7273 0a20 2020   a few hours.   
+000131c0: 2020 2020 2069 6e73 7465 6164 206f 6620       instead of 
+000131d0: 6672 6f6d 2074 6865 206c 6173 7420 3520  from the last 5 
+000131e0: 7365 636f 6e64 732c 2068 6f77 6576 6572  seconds, however
+000131f0: 2066 6169 6c73 2066 6f72 2055 5443 2d20   fails for UTC- 
+00013200: 7469 6d65 7a6f 6e65 732c 0a20 2020 2020  timezones,.     
+00013210: 2020 2073 696e 6365 2077 6527 7265 2074     since we're t
+00013220: 6865 6e20 6173 6b69 6e67 2066 6f72 2074  hen asking for t
+00013230: 7261 6465 7320 7769 7468 2061 2022 7369  rades with a "si
+00013240: 6e63 6522 2061 7267 756d 656e 7420 696e  nce" argument in
+00013250: 2074 6865 2066 7574 7572 652e 0a0a 2020   the future...  
+00013260: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
+00013270: 6572 5f69 6420 6f72 6465 725f 6964 3a20  er_id order_id: 
+00013280: 4f72 6465 722d 6964 2061 7320 6769 7665  Order-id as give
+00013290: 6e20 7768 656e 2063 7265 6174 696e 6720  n when creating 
+000132a0: 7468 6520 6f72 6465 720a 2020 2020 2020  the order.      
+000132b0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+000132c0: 6169 7220 7468 6520 6f72 6465 7220 6973  air the order is
+000132d0: 2066 6f72 0a20 2020 2020 2020 203a 7061   for.        :pa
+000132e0: 7261 6d20 7369 6e63 653a 2064 6174 6574  ram since: datet
+000132f0: 696d 6520 6f62 6a65 6374 206f 6620 7468  ime object of th
+00013300: 6520 6f72 6465 7220 6372 6561 7469 6f6e  e order creation
+00013310: 2074 696d 652e 2041 7373 756d 6573 206f   time. Assumes o
+00013320: 626a 6563 7420 6973 2069 6e20 5554 432e  bject is in UTC.
+00013330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013340: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
+00013350: 6e66 6967 5b27 6472 795f 7275 6e27 5d3a  nfig['dry_run']:
+00013360: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00013370: 7572 6e20 5b5d 0a20 2020 2020 2020 2069  urn [].        i
+00013380: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
+00013390: 6e67 655f 6861 7328 2766 6574 6368 4d79  nge_has('fetchMy
+000133a0: 5472 6164 6573 2729 3a0a 2020 2020 2020  Trades'):.      
+000133b0: 2020 2020 2020 7265 7475 726e 205b 5d0a        return [].
+000133c0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000133d0: 2020 2020 2020 2020 2023 2041 6c6c 6f77           # Allow
+000133e0: 2035 7320 6f66 6673 6574 2074 6f20 6361   5s offset to ca
+000133f0: 7463 6820 736c 6967 6874 2074 696d 6520  tch slight time 
+00013400: 6f66 6673 6574 7320 2864 6973 636f 7665  offsets (discove
+00013410: 7265 6420 696e 2023 3131 3835 290a 2020  red in #1185).  
+00013420: 2020 2020 2020 2020 2020 2320 7369 6e63            # sinc
+00013430: 6520 6e65 6564 7320 746f 2062 6520 696e  e needs to be in
+00013440: 7420 696e 206d 696c 6c69 7365 636f 6e64  t in millisecond
+00013450: 730a 2020 2020 2020 2020 2020 2020 5f70  s.            _p
+00013460: 6172 616d 7320 3d20 7061 7261 6d73 2069  arams = params i
+00013470: 6620 7061 7261 6d73 2065 6c73 6520 7b7d  f params else {}
+00013480: 0a20 2020 2020 2020 2020 2020 206d 795f  .            my_
+00013490: 7472 6164 6573 203d 2073 656c 662e 5f61  trades = self._a
+000134a0: 7069 2e66 6574 6368 5f6d 795f 7472 6164  pi.fetch_my_trad
+000134b0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+000134c0: 2020 2020 7061 6972 2c20 696e 7428 2873      pair, int((s
+000134d0: 696e 6365 2e72 6570 6c61 6365 2874 7a69  ince.replace(tzi
+000134e0: 6e66 6f3d 7469 6d65 7a6f 6e65 2e75 7463  nfo=timezone.utc
+000134f0: 292e 7469 6d65 7374 616d 7028 2920 2d20  ).timestamp() - 
+00013500: 3529 202a 2031 3030 3029 2c0a 2020 2020  5) * 1000),.    
+00013510: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00013520: 6d73 3d5f 7061 7261 6d73 290a 2020 2020  ms=_params).    
+00013530: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
+00013540: 7472 6164 6573 203d 205b 7472 6164 6520  trades = [trade 
+00013550: 666f 7220 7472 6164 6520 696e 206d 795f  for trade in my_
+00013560: 7472 6164 6573 2069 6620 7472 6164 655b  trades if trade[
+00013570: 276f 7264 6572 275d 203d 3d20 6f72 6465  'order'] == orde
+00013580: 725f 6964 5d0a 0a20 2020 2020 2020 2020  r_id]..         
+00013590: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+000135a0: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+000135b0: 6765 745f 7472 6164 6573 5f66 6f72 5f6f  get_trades_for_o
+000135c0: 7264 6572 272c 206d 6174 6368 6564 5f74  rder', matched_t
+000135d0: 7261 6465 7329 0a0a 2020 2020 2020 2020  rades)..        
+000135e0: 2020 2020 6d61 7463 6865 645f 7472 6164      matched_trad
+000135f0: 6573 203d 2073 656c 662e 5f74 7261 6465  es = self._trade
+00013600: 735f 636f 6e74 7261 6374 735f 746f 5f61  s_contracts_to_a
+00013610: 6d6f 756e 7428 6d61 7463 6865 645f 7472  mount(matched_tr
+00013620: 6164 6573 290a 0a20 2020 2020 2020 2020  ades)..         
+00013630: 2020 2072 6574 7572 6e20 6d61 7463 6865     return matche
+00013640: 645f 7472 6164 6573 0a20 2020 2020 2020  d_trades.       
+00013650: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+00013660: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+00013670: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00013680: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+00013690: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+000136a0: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+000136b0: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
+000136c0: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+000136d0: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+000136e0: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+000136f0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+00013700: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+00013710: 756c 6420 6e6f 7420 6765 7420 7472 6164  uld not get trad
+00013720: 6573 2064 7565 2074 6f20 7b65 2e5f 5f63  es due to {e.__c
+00013730: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00013740: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+00013750: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+00013760: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
+00013770: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+00013780: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+00013790: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+000137a0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
+000137b0: 2020 6465 6620 6765 745f 6f72 6465 725f    def get_order_
+000137c0: 6964 5f63 6f6e 6469 7469 6f6e 616c 2873  id_conditional(s
+000137d0: 656c 662c 206f 7264 6572 3a20 4469 6374  elf, order: Dict
+000137e0: 5b73 7472 2c20 416e 795d 2920 2d3e 2073  [str, Any]) -> s
+000137f0: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
+00013800: 726e 206f 7264 6572 5b27 6964 275d 0a0a  rn order['id']..
+00013810: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
+00013820: 2064 6566 2067 6574 5f66 6565 2873 656c   def get_fee(sel
+00013830: 662c 2073 796d 626f 6c3a 2073 7472 2c20  f, symbol: str, 
+00013840: 7479 7065 3a20 7374 7220 3d20 2727 2c20  type: str = '', 
+00013850: 7369 6465 3a20 7374 7220 3d20 2727 2c20  side: str = '', 
+00013860: 616d 6f75 6e74 3a20 666c 6f61 7420 3d20  amount: float = 
+00013870: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+00013880: 2020 2070 7269 6365 3a20 666c 6f61 7420     price: float 
+00013890: 3d20 312c 2074 616b 6572 5f6f 725f 6d61  = 1, taker_or_ma
+000138a0: 6b65 723a 204d 616b 6572 5461 6b65 7220  ker: MakerTaker 
+000138b0: 3d20 276d 616b 6572 2729 202d 3e20 666c  = 'maker') -> fl
+000138c0: 6f61 743a 0a20 2020 2020 2020 2022 2222  oat:.        """
+000138d0: 0a20 2020 2020 2020 2052 6574 7269 6576  .        Retriev
+000138e0: 6520 6665 6520 6672 6f6d 2065 7863 6861  e fee from excha
+000138f0: 6e67 650a 2020 2020 2020 2020 3a70 6172  nge.        :par
+00013900: 616d 2073 796d 626f 6c3a 2050 6169 720a  am symbol: Pair.
+00013910: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+00013920: 7970 653a 2054 7970 6520 6f66 206f 7264  ype: Type of ord
+00013930: 6572 2028 6d61 726b 6574 2c20 6c69 6d69  er (market, limi
+00013940: 742c 202e 2e2e 290a 2020 2020 2020 2020  t, ...).        
+00013950: 3a70 6172 616d 2073 6964 653a 2053 6964  :param side: Sid
+00013960: 6520 6f66 206f 7264 6572 2028 6275 792c  e of order (buy,
+00013970: 2073 656c 6c29 0a20 2020 2020 2020 203a   sell).        :
+00013980: 7061 7261 6d20 616d 6f75 6e74 3a20 416d  param amount: Am
+00013990: 6f75 6e74 206f 6620 6f72 6465 720a 2020  ount of order.  
+000139a0: 2020 2020 2020 3a70 6172 616d 2070 7269        :param pri
+000139b0: 6365 3a20 5072 6963 6520 6f66 206f 7264  ce: Price of ord
+000139c0: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
+000139d0: 6d20 7461 6b65 725f 6f72 5f6d 616b 6572  m taker_or_maker
+000139e0: 3a20 276d 616b 6572 2720 6f72 2027 7461  : 'maker' or 'ta
+000139f0: 6b65 7227 2028 6967 6e6f 7265 6420 6966  ker' (ignored if
+00013a00: 2022 7479 7065 2220 6973 2070 726f 7669   "type" is provi
+00013a10: 6465 6429 0a20 2020 2020 2020 2022 2222  ded).        """
+00013a20: 0a20 2020 2020 2020 2069 6620 7479 7065  .        if type
+00013a30: 2061 6e64 2074 7970 6520 3d3d 2027 6d61   and type == 'ma
+00013a40: 726b 6574 273a 0a20 2020 2020 2020 2020  rket':.         
+00013a50: 2020 2074 616b 6572 5f6f 725f 6d61 6b65     taker_or_make
+00013a60: 7220 3d20 2774 616b 6572 270a 2020 2020  r = 'taker'.    
+00013a70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00013a80: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
+00013a90: 6e66 6967 5b27 6472 795f 7275 6e27 5d20  nfig['dry_run'] 
+00013aa0: 616e 6420 7365 6c66 2e5f 636f 6e66 6967  and self._config
+00013ab0: 2e67 6574 2827 6665 6527 2c20 4e6f 6e65  .get('fee', None
+00013ac0: 2920 6973 206e 6f74 204e 6f6e 653a 0a20  ) is not None:. 
+00013ad0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00013ae0: 6574 7572 6e20 7365 6c66 2e5f 636f 6e66  eturn self._conf
+00013af0: 6967 5b27 6665 6527 5d0a 2020 2020 2020  ig['fee'].      
+00013b00: 2020 2020 2020 2320 7661 6c69 6461 7465        # validate
+00013b10: 2074 6861 7420 6d61 726b 6574 7320 6172   that markets ar
+00013b20: 6520 6c6f 6164 6564 2062 6566 6f72 6520  e loaded before 
+00013b30: 7472 7969 6e67 2074 6f20 6765 7420 6665  trying to get fe
+00013b40: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00013b50: 2073 656c 662e 5f61 7069 2e6d 6172 6b65   self._api.marke
+00013b60: 7473 2069 7320 4e6f 6e65 206f 7220 6c65  ts is None or le
+00013b70: 6e28 7365 6c66 2e5f 6170 692e 6d61 726b  n(self._api.mark
+00013b80: 6574 7329 203d 3d20 303a 0a20 2020 2020  ets) == 0:.     
+00013b90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013ba0: 5f61 7069 2e6c 6f61 645f 6d61 726b 6574  _api.load_market
+00013bb0: 7328 7061 7261 6d73 3d7b 7d29 0a0a 2020  s(params={})..  
+00013bc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00013bd0: 2073 656c 662e 5f61 7069 2e63 616c 6375   self._api.calcu
+00013be0: 6c61 7465 5f66 6565 2873 796d 626f 6c3d  late_fee(symbol=
+00013bf0: 7379 6d62 6f6c 2c20 7479 7065 3d74 7970  symbol, type=typ
+00013c00: 652c 2073 6964 653d 7369 6465 2c20 616d  e, side=side, am
+00013c10: 6f75 6e74 3d61 6d6f 756e 742c 0a20 2020  ount=amount,.   
+00013c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c40: 2020 2020 2020 2020 7072 6963 653d 7072          price=pr
+00013c50: 6963 652c 2074 616b 6572 4f72 4d61 6b65  ice, takerOrMake
+00013c60: 723d 7461 6b65 725f 6f72 5f6d 616b 6572  r=taker_or_maker
+00013c70: 295b 2772 6174 6527 5d0a 2020 2020 2020  )['rate'].      
+00013c80: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
+00013c90: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
+00013ca0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00013cb0: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
+00013cc0: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
+00013cd0: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
+00013ce0: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
+00013cf0: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
+00013d00: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
+00013d10: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
+00013d20: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
+00013d30: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
+00013d40: 6f75 6c64 206e 6f74 2067 6574 2066 6565  ould not get fee
+00013d50: 2069 6e66 6f20 6475 6520 746f 207b 652e   info due to {e.
+00013d60: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00013d70: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+00013d80: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00013d90: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+00013da0: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+00013db0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00013dc0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00013dd0: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+00013de0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00013df0: 6f64 0a20 2020 2064 6566 206f 7264 6572  od.    def order
+00013e00: 5f68 6173 5f66 6565 286f 7264 6572 3a20  _has_fee(order: 
+00013e10: 4469 6374 2920 2d3e 2062 6f6f 6c3a 0a20  Dict) -> bool:. 
+00013e20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013e30: 2020 2056 6572 6966 6965 7320 6966 2074     Verifies if t
+00013e40: 6865 2070 6173 7365 6420 696e 206f 7264  he passed in ord
+00013e50: 6572 2064 6963 7420 6861 7320 7468 6520  er dict has the 
+00013e60: 6e65 6564 6564 206b 6579 7320 746f 2065  needed keys to e
+00013e70: 7874 7261 6374 2066 6565 732c 0a20 2020  xtract fees,.   
+00013e80: 2020 2020 2061 6e64 2074 6861 7420 7468       and that th
+00013e90: 6573 6520 6b65 7973 2028 6375 7272 656e  ese keys (curren
+00013ea0: 6379 2c20 636f 7374 2920 6172 6520 6e6f  cy, cost) are no
+00013eb0: 7420 656d 7074 792e 0a20 2020 2020 2020  t empty..       
+00013ec0: 203a 7061 7261 6d20 6f72 6465 723a 204f   :param order: O
+00013ed0: 7264 6572 206f 7220 7472 6164 6520 286f  rder or trade (o
+00013ee0: 6e65 2074 7261 6465 2920 6469 6374 0a20  ne trade) dict. 
+00013ef0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00013f00: 5472 7565 2069 6620 7468 6520 6665 6520  True if the fee 
+00013f10: 7375 6273 7472 7563 7475 7265 2063 6f6e  substructure con
+00013f20: 7461 696e 7320 6375 7272 656e 6379 2061  tains currency a
+00013f30: 6e64 2063 6f73 742c 2066 616c 7365 206f  nd cost, false o
+00013f40: 7468 6572 7769 7365 0a20 2020 2020 2020  therwise.       
+00013f50: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00013f60: 6e6f 7420 6973 696e 7374 616e 6365 286f  not isinstance(o
+00013f70: 7264 6572 2c20 6469 6374 293a 0a20 2020  rder, dict):.   
+00013f80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013f90: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00013fa0: 7475 726e 2028 2766 6565 2720 696e 206f  turn ('fee' in o
+00013fb0: 7264 6572 2061 6e64 206f 7264 6572 5b27  rder and order['
+00013fc0: 6665 6527 5d20 6973 206e 6f74 204e 6f6e  fee'] is not Non
+00013fd0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00013fe0: 2020 616e 6420 286f 7264 6572 5b27 6665    and (order['fe
+00013ff0: 6527 5d2e 6b65 7973 2829 203e 3d20 7b27  e'].keys() >= {'
+00014000: 6375 7272 656e 6379 272c 2027 636f 7374  currency', 'cost
+00014010: 277d 290a 2020 2020 2020 2020 2020 2020  '}).            
+00014020: 2020 2020 616e 6420 6f72 6465 725b 2766      and order['f
+00014030: 6565 275d 5b27 6375 7272 656e 6379 275d  ee']['currency']
+00014040: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
+00014050: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00014060: 206f 7264 6572 5b27 6665 6527 5d5b 2763   order['fee']['c
+00014070: 6f73 7427 5d20 6973 206e 6f74 204e 6f6e  ost'] is not Non
+00014080: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00014090: 2020 290a 0a20 2020 2064 6566 2063 616c    )..    def cal
+000140a0: 6375 6c61 7465 5f66 6565 5f72 6174 6528  culate_fee_rate(
+000140b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000140c0: 662c 2066 6565 3a20 4469 6374 2c20 7379  f, fee: Dict, sy
+000140d0: 6d62 6f6c 3a20 7374 722c 2063 6f73 743a  mbol: str, cost:
+000140e0: 2066 6c6f 6174 2c20 616d 6f75 6e74 3a20   float, amount: 
+000140f0: 666c 6f61 7429 202d 3e20 4f70 7469 6f6e  float) -> Option
+00014100: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
+00014110: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
+00014120: 616c 6375 6c61 7465 2066 6565 2072 6174  alculate fee rat
+00014130: 6520 6966 2069 7427 7320 6e6f 7420 6769  e if it's not gi
+00014140: 7665 6e20 6279 2074 6865 2065 7863 6861  ven by the excha
+00014150: 6e67 652e 0a20 2020 2020 2020 203a 7061  nge..        :pa
+00014160: 7261 6d20 6665 653a 2063 6378 7420 4665  ram fee: ccxt Fe
+00014170: 6520 6469 6374 202d 206d 7573 7420 636f  e dict - must co
+00014180: 6e74 6169 6e20 636f 7374 202f 2063 7572  ntain cost / cur
+00014190: 7265 6e63 7920 2f20 7261 7465 0a20 2020  rency / rate.   
+000141a0: 2020 2020 203a 7061 7261 6d20 7379 6d62       :param symb
+000141b0: 6f6c 3a20 5379 6d62 6f6c 206f 6620 7468  ol: Symbol of th
+000141c0: 6520 6f72 6465 720a 2020 2020 2020 2020  e order.        
+000141d0: 3a70 6172 616d 2063 6f73 743a 2054 6f74  :param cost: Tot
+000141e0: 616c 2063 6f73 7420 6f66 2074 6865 206f  al cost of the o
+000141f0: 7264 6572 0a20 2020 2020 2020 203a 7061  rder.        :pa
+00014200: 7261 6d20 616d 6f75 6e74 3a20 416d 6f75  ram amount: Amou
+00014210: 6e74 206f 6620 7468 6520 6f72 6465 720a  nt of the order.
+00014220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014230: 2020 2020 6966 2066 6565 2e67 6574 2827      if fee.get('
+00014240: 7261 7465 2729 2069 7320 6e6f 7420 4e6f  rate') is not No
+00014250: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00014260: 7265 7475 726e 2066 6565 2e67 6574 2827  return fee.get('
+00014270: 7261 7465 2729 0a20 2020 2020 2020 2066  rate').        f
+00014280: 6565 5f63 7572 7220 3d20 6665 652e 6765  ee_curr = fee.ge
+00014290: 7428 2763 7572 7265 6e63 7927 290a 2020  t('currency').  
+000142a0: 2020 2020 2020 6966 2066 6565 5f63 7572        if fee_cur
+000142b0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+000142c0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+000142d0: 6e65 0a20 2020 2020 2020 2066 6565 5f63  ne.        fee_c
+000142e0: 6f73 7420 3d20 666c 6f61 7428 6665 655b  ost = float(fee[
+000142f0: 2763 6f73 7427 5d29 0a20 2020 2020 2020  'cost']).       
+00014300: 2069 6620 7365 6c66 2e5f 6674 5f68 6173   if self._ft_has
+00014310: 5b27 6665 655f 636f 7374 5f69 6e5f 636f  ['fee_cost_in_co
+00014320: 6e74 7261 6374 7327 5d3a 0a20 2020 2020  ntracts']:.     
+00014330: 2020 2020 2020 2023 2043 6f6e 7665 7274         # Convert
+00014340: 2063 6f73 7420 7669 6120 2263 6f6e 7472   cost via "contr
+00014350: 6163 7473 2220 636f 6e76 6572 7369 6f6e  acts" conversion
+00014360: 0a20 2020 2020 2020 2020 2020 2066 6565  .            fee
+00014370: 5f63 6f73 7420 3d20 7365 6c66 2e5f 636f  _cost = self._co
+00014380: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
+00014390: 7428 7379 6d62 6f6c 2c20 6665 655b 2763  t(symbol, fee['c
+000143a0: 6f73 7427 5d29 0a0a 2020 2020 2020 2020  ost'])..        
+000143b0: 2320 4361 6c63 756c 6174 6520 6665 6520  # Calculate fee 
+000143c0: 6261 7365 6420 6f6e 206f 7264 6572 2064  based on order d
+000143d0: 6574 6169 6c73 0a20 2020 2020 2020 2069  etails.        i
+000143e0: 6620 6665 655f 6375 7272 203d 3d20 7365  f fee_curr == se
+000143f0: 6c66 2e67 6574 5f70 6169 725f 6261 7365  lf.get_pair_base
+00014400: 5f63 7572 7265 6e63 7928 7379 6d62 6f6c  _currency(symbol
+00014410: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+00014420: 2042 6173 6520 6375 7272 656e 6379 202d   Base currency -
+00014430: 2064 6976 6964 6520 6279 2061 6d6f 756e   divide by amoun
+00014440: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
+00014450: 7475 726e 2072 6f75 6e64 2866 6565 5f63  turn round(fee_c
+00014460: 6f73 7420 2f20 616d 6f75 6e74 2c20 3829  ost / amount, 8)
+00014470: 0a20 2020 2020 2020 2065 6c69 6620 6665  .        elif fe
+00014480: 655f 6375 7272 203d 3d20 7365 6c66 2e67  e_curr == self.g
+00014490: 6574 5f70 6169 725f 7175 6f74 655f 6375  et_pair_quote_cu
+000144a0: 7272 656e 6379 2873 796d 626f 6c29 3a0a  rrency(symbol):.
+000144b0: 2020 2020 2020 2020 2020 2020 2320 5175              # Qu
+000144c0: 6f74 6520 6375 7272 656e 6379 202d 2064  ote currency - d
+000144d0: 6976 6964 6520 6279 2063 6f73 740a 2020  ivide by cost.  
+000144e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000144f0: 2072 6f75 6e64 2866 6565 5f63 6f73 7420   round(fee_cost 
+00014500: 2f20 636f 7374 2c20 3829 2069 6620 636f  / cost, 8) if co
+00014510: 7374 2065 6c73 6520 4e6f 6e65 0a20 2020  st else None.   
+00014520: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00014530: 2020 2020 2020 2023 2049 6620 4665 6520         # If Fee 
+00014540: 6375 7272 656e 6379 2069 7320 6120 6469  currency is a di
+00014550: 6666 6572 656e 7420 6375 7272 656e 6379  fferent currency
+00014560: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014570: 6e6f 7420 636f 7374 3a0a 2020 2020 2020  not cost:.      
+00014580: 2020 2020 2020 2020 2020 2320 4966 2063            # If c
+00014590: 6f73 7420 6973 204e 6f6e 6520 6f72 2030  ost is None or 0
+000145a0: 2e30 202d 3e20 6661 6c73 792c 2072 6574  .0 -> falsy, ret
+000145b0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+000145c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000145d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000145e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000145f0: 2020 2020 2020 636f 6d62 203d 2073 656c        comb = sel
+00014600: 662e 6765 745f 7661 6c69 645f 7061 6972  f.get_valid_pair
+00014610: 5f63 6f6d 6269 6e61 7469 6f6e 2866 6565  _combination(fee
+00014620: 5f63 7572 722c 2073 656c 662e 5f63 6f6e  _curr, self._con
+00014630: 6669 675b 2773 7461 6b65 5f63 7572 7265  fig['stake_curre
+00014640: 6e63 7927 5d29 0a20 2020 2020 2020 2020  ncy']).         
+00014650: 2020 2020 2020 2074 6963 6b20 3d20 7365         tick = se
+00014660: 6c66 2e66 6574 6368 5f74 6963 6b65 7228  lf.fetch_ticker(
+00014670: 636f 6d62 290a 0a20 2020 2020 2020 2020  comb)..         
+00014680: 2020 2020 2020 2066 6565 5f74 6f5f 7175         fee_to_qu
+00014690: 6f74 655f 7261 7465 203d 2073 6166 655f  ote_rate = safe_
+000146a0: 7661 6c75 655f 6661 6c6c 6261 636b 3228  value_fallback2(
+000146b0: 7469 636b 2c20 7469 636b 2c20 276c 6173  tick, tick, 'las
+000146c0: 7427 2c20 2761 736b 2729 0a20 2020 2020  t', 'ask').     
+000146d0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+000146e0: 6368 616e 6765 4572 726f 723a 0a20 2020  changeError:.   
+000146f0: 2020 2020 2020 2020 2020 2020 2066 6565               fee
+00014700: 5f74 6f5f 7175 6f74 655f 7261 7465 203d  _to_quote_rate =
+00014710: 2073 656c 662e 5f63 6f6e 6669 675b 2765   self._config['e
+00014720: 7863 6861 6e67 6527 5d2e 6765 7428 2775  xchange'].get('u
+00014730: 6e6b 6e6f 776e 5f66 6565 5f72 6174 6527  nknown_fee_rate'
+00014740: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+00014750: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00014760: 6565 5f74 6f5f 7175 6f74 655f 7261 7465  ee_to_quote_rate
+00014770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014780: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00014790: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+000147a0: 7475 726e 2072 6f75 6e64 2828 6665 655f  turn round((fee_
+000147b0: 636f 7374 202a 2066 6565 5f74 6f5f 7175  cost * fee_to_qu
+000147c0: 6f74 655f 7261 7465 2920 2f20 636f 7374  ote_rate) / cost
+000147d0: 2c20 3829 0a0a 2020 2020 6465 6620 6578  , 8)..    def ex
+000147e0: 7472 6163 745f 636f 7374 5f63 7572 725f  tract_cost_curr_
+000147f0: 7261 7465 2873 656c 662c 2066 6565 3a20  rate(self, fee: 
+00014800: 4469 6374 2c20 7379 6d62 6f6c 3a20 7374  Dict, symbol: st
+00014810: 722c 2063 6f73 743a 2066 6c6f 6174 2c0a  r, cost: float,.
+00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014830: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00014840: 6d6f 756e 743a 2066 6c6f 6174 2920 2d3e  mount: float) ->
+00014850: 2054 7570 6c65 5b66 6c6f 6174 2c20 7374   Tuple[float, st
+00014860: 722c 204f 7074 696f 6e61 6c5b 666c 6f61  r, Optional[floa
+00014870: 745d 5d3a 0a20 2020 2020 2020 2022 2222  t]]:.        """
+00014880: 0a20 2020 2020 2020 2045 7874 7261 6374  .        Extract
+00014890: 2074 7570 6c65 206f 6620 636f 7374 2c20   tuple of cost, 
+000148a0: 6375 7272 656e 6379 2c20 7261 7465 2e0a  currency, rate..
+000148b0: 2020 2020 2020 2020 5265 7175 6972 6573          Requires
+000148c0: 206f 7264 6572 5f68 6173 5f66 6565 2074   order_has_fee t
+000148d0: 6f20 7275 6e20 6669 7273 7421 0a20 2020  o run first!.   
+000148e0: 2020 2020 203a 7061 7261 6d20 6665 653a       :param fee:
+000148f0: 2063 6378 7420 4665 6520 6469 6374 202d   ccxt Fee dict -
+00014900: 206d 7573 7420 636f 6e74 6169 6e20 636f   must contain co
+00014910: 7374 202f 2063 7572 7265 6e63 7920 2f20  st / currency / 
+00014920: 7261 7465 0a20 2020 2020 2020 203a 7061  rate.        :pa
+00014930: 7261 6d20 7379 6d62 6f6c 3a20 5379 6d62  ram symbol: Symb
+00014940: 6f6c 206f 6620 7468 6520 6f72 6465 720a  ol of the order.
+00014950: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+00014960: 6f73 743a 2054 6f74 616c 2063 6f73 7420  ost: Total cost 
+00014970: 6f66 2074 6865 206f 7264 6572 0a20 2020  of the order.   
+00014980: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+00014990: 6e74 3a20 416d 6f75 6e74 206f 6620 7468  nt: Amount of th
+000149a0: 6520 6f72 6465 720a 2020 2020 2020 2020  e order.        
+000149b0: 3a72 6574 7572 6e3a 2054 7570 6c65 2077  :return: Tuple w
+000149c0: 6974 6820 636f 7374 2c20 6375 7272 656e  ith cost, curren
+000149d0: 6379 2c20 7261 7465 206f 6620 7468 6520  cy, rate of the 
+000149e0: 6769 7665 6e20 6665 6520 6469 6374 0a20  given fee dict. 
+000149f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014a00: 2020 2072 6574 7572 6e20 2866 6c6f 6174     return (float
+00014a10: 2866 6565 5b27 636f 7374 275d 292c 0a20  (fee['cost']),. 
+00014a20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014a30: 6565 5b27 6375 7272 656e 6379 275d 2c0a  ee['currency'],.
+00014a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a50: 7365 6c66 2e63 616c 6375 6c61 7465 5f66  self.calculate_f
+00014a60: 6565 5f72 6174 6528 0a20 2020 2020 2020  ee_rate(.       
+00014a70: 2020 2020 2020 2020 2020 2020 2066 6565               fee
+00014a80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014a90: 2020 2020 2020 7379 6d62 6f6c 2c0a 2020        symbol,.  
+00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ab0: 2020 636f 7374 2c0a 2020 2020 2020 2020    cost,.        
+00014ac0: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
+00014ad0: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
+00014ae0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00014af0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00014b00: 2320 4869 7374 6f72 6963 2064 6174 610a  # Historic data.
+00014b10: 0a20 2020 2064 6566 2067 6574 5f68 6973  .    def get_his
+00014b20: 746f 7269 635f 6f68 6c63 7628 7365 6c66  toric_ohlcv(self
+00014b30: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
+00014b40: 6566 7261 6d65 3a20 7374 722c 0a20 2020  eframe: str,.   
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 2020 2020 2020 2020 7369 6e63 655f 6d73          since_ms
+00014b70: 3a20 696e 742c 2063 616e 646c 655f 7479  : int, candle_ty
+00014b80: 7065 3a20 4361 6e64 6c65 5479 7065 2c0a  pe: CandleType,.
+00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ba0: 2020 2020 2020 2020 2020 2069 735f 6e65             is_ne
+00014bb0: 775f 7061 6972 3a20 626f 6f6c 203d 2046  w_pair: bool = F
+00014bc0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014be0: 2075 6e74 696c 5f6d 733a 204f 7074 696f   until_ms: Optio
+00014bf0: 6e61 6c5b 696e 745d 203d 204e 6f6e 6529  nal[int] = None)
+00014c00: 202d 3e20 4c69 7374 3a0a 2020 2020 2020   -> List:.      
+00014c10: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+00014c20: 7420 6361 6e64 6c65 2068 6973 746f 7279  t candle history
+00014c30: 2075 7369 6e67 2061 7379 6e63 696f 2061   using asyncio a
+00014c40: 6e64 2072 6574 7572 6e73 2074 6865 206c  nd returns the l
+00014c50: 6973 7420 6f66 2063 616e 646c 6573 2e0a  ist of candles..
+00014c60: 2020 2020 2020 2020 4861 6e64 6c65 7320          Handles 
+00014c70: 616c 6c20 6173 796e 6320 776f 726b 2066  all async work f
+00014c80: 6f72 2074 6869 732e 0a20 2020 2020 2020  or this..       
+00014c90: 2041 7379 6e63 206f 7665 7220 6f6e 6520   Async over one 
+00014ca0: 7061 6972 2c20 6173 7375 6d69 6e67 2077  pair, assuming w
+00014cb0: 6520 6765 7420 6073 656c 662e 6f68 6c63  e get `self.ohlc
+00014cc0: 765f 6361 6e64 6c65 5f6c 696d 6974 2829  v_candle_limit()
+00014cd0: 6020 6361 6e64 6c65 7320 7065 7220 6361  ` candles per ca
+00014ce0: 6c6c 2e0a 2020 2020 2020 2020 3a70 6172  ll..        :par
+00014cf0: 616d 2070 6169 723a 2050 6169 7220 746f  am pair: Pair to
+00014d00: 2064 6f77 6e6c 6f61 640a 2020 2020 2020   download.      
+00014d10: 2020 3a70 6172 616d 2074 696d 6566 7261    :param timefra
+00014d20: 6d65 3a20 5469 6d65 6672 616d 6520 746f  me: Timeframe to
+00014d30: 2067 6574 2064 6174 6120 666f 720a 2020   get data for.  
+00014d40: 2020 2020 2020 3a70 6172 616d 2073 696e        :param sin
+00014d50: 6365 5f6d 733a 2054 696d 6573 7461 6d70  ce_ms: Timestamp
+00014d60: 2069 6e20 6d69 6c6c 6973 6563 6f6e 6473   in milliseconds
+00014d70: 2074 6f20 6765 7420 6869 7374 6f72 7920   to get history 
+00014d80: 6672 6f6d 0a20 2020 2020 2020 203a 7061  from.        :pa
+00014d90: 7261 6d20 756e 7469 6c5f 6d73 3a20 5469  ram until_ms: Ti
+00014da0: 6d65 7374 616d 7020 696e 206d 696c 6c69  mestamp in milli
+00014db0: 7365 636f 6e64 7320 746f 2067 6574 2068  seconds to get h
+00014dc0: 6973 746f 7279 2075 7020 746f 0a20 2020  istory up to.   
+00014dd0: 2020 2020 203a 7061 7261 6d20 6361 6e64       :param cand
+00014de0: 6c65 5f74 7970 653a 2027 272c 206d 6172  le_type: '', mar
+00014df0: 6b2c 2069 6e64 6578 2c20 7072 656d 6975  k, index, premiu
+00014e00: 6d49 6e64 6578 2c20 6f72 2066 756e 6469  mIndex, or fundi
+00014e10: 6e67 5f72 6174 650a 2020 2020 2020 2020  ng_rate.        
+00014e20: 3a72 6574 7572 6e3a 204c 6973 7420 7769  :return: List wi
+00014e30: 7468 2063 616e 646c 6520 284f 484c 4356  th candle (OHLCV
+00014e40: 2920 6461 7461 0a20 2020 2020 2020 2022  ) data.        "
+00014e50: 2222 0a20 2020 2020 2020 2070 6169 722c  "".        pair,
+00014e60: 205f 2c20 5f2c 2064 6174 612c 205f 203d   _, _, data, _ =
+00014e70: 2073 656c 662e 6c6f 6f70 2e72 756e 5f75   self.loop.run_u
+00014e80: 6e74 696c 5f63 6f6d 706c 6574 6528 0a20  ntil_complete(. 
+00014e90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014ea0: 5f61 7379 6e63 5f67 6574 5f68 6973 746f  _async_get_histo
+00014eb0: 7269 635f 6f68 6c63 7628 7061 6972 3d70  ric_ohlcv(pair=p
+00014ec0: 6169 722c 2074 696d 6566 7261 6d65 3d74  air, timeframe=t
+00014ed0: 696d 6566 7261 6d65 2c0a 2020 2020 2020  imeframe,.      
+00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f00: 2020 2020 2073 696e 6365 5f6d 733d 7369       since_ms=si
+00014f10: 6e63 655f 6d73 2c20 756e 7469 6c5f 6d73  nce_ms, until_ms
+00014f20: 3d75 6e74 696c 5f6d 732c 0a20 2020 2020  =until_ms,.     
+00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f50: 2020 2020 2020 6973 5f6e 6577 5f70 6169        is_new_pai
+00014f60: 723d 6973 5f6e 6577 5f70 6169 722c 2063  r=is_new_pair, c
+00014f70: 616e 646c 655f 7479 7065 3d63 616e 646c  andle_type=candl
+00014f80: 655f 7479 7065 2929 0a20 2020 2020 2020  e_type)).       
+00014f90: 206c 6f67 6765 722e 696e 666f 2866 2244   logger.info(f"D
+00014fa0: 6f77 6e6c 6f61 6465 6420 6461 7461 2066  ownloaded data f
+00014fb0: 6f72 207b 7061 6972 7d20 7769 7468 206c  or {pair} with l
+00014fc0: 656e 6774 6820 7b6c 656e 2864 6174 6129  ength {len(data)
+00014fd0: 7d2e 2229 0a20 2020 2020 2020 2072 6574  }.").        ret
+00014fe0: 7572 6e20 6461 7461 0a0a 2020 2020 6173  urn data..    as
+00014ff0: 796e 6320 6465 6620 5f61 7379 6e63 5f67  ync def _async_g
+00015000: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
+00015010: 7628 7365 6c66 2c20 7061 6972 3a20 7374  v(self, pair: st
+00015020: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
+00015030: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00015040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015050: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00015060: 5f6d 733a 2069 6e74 2c20 6361 6e64 6c65  _ms: int, candle
+00015070: 5f74 7970 653a 2043 616e 646c 6554 7970  _type: CandleTyp
+00015080: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150a0: 2020 2020 2020 2020 2020 2069 735f 6e65             is_ne
+000150b0: 775f 7061 6972 3a20 626f 6f6c 203d 2046  w_pair: bool = F
+000150c0: 616c 7365 2c20 7261 6973 655f 3a20 626f  alse, raise_: bo
+000150d0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015100: 2020 2020 756e 7469 6c5f 6d73 3a20 4f70      until_ms: Op
+00015110: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+00015120: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015140: 2020 2020 2020 2020 2020 2029 202d 3e20             ) -> 
+00015150: 4f48 4c43 5652 6573 706f 6e73 653a 0a20  OHLCVResponse:. 
+00015160: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015170: 2020 2044 6f77 6e6c 6f61 6420 6869 7374     Download hist
+00015180: 6f72 6963 206f 686c 6376 0a20 2020 2020  oric ohlcv.     
+00015190: 2020 203a 7061 7261 6d20 6973 5f6e 6577     :param is_new
+000151a0: 5f70 6169 723a 2075 7365 6420 6279 2062  _pair: used by b
+000151b0: 696e 616e 6365 2073 7562 636c 6173 7320  inance subclass 
+000151c0: 746f 2061 6c6c 6f77 2022 6661 7374 2220  to allow "fast" 
+000151d0: 6e65 7720 7061 6972 2064 6f77 6e6c 6f61  new pair downloa
+000151e0: 6469 6e67 0a20 2020 2020 2020 203a 7061  ding.        :pa
+000151f0: 7261 6d20 6361 6e64 6c65 5f74 7970 653a  ram candle_type:
+00015200: 2041 6e79 206f 6620 7468 6520 656e 756d   Any of the enum
+00015210: 2043 616e 646c 6554 7970 6520 286d 7573   CandleType (mus
+00015220: 7420 6d61 7463 6820 7472 6164 696e 6720  t match trading 
+00015230: 6d6f 6465 2129 0a20 2020 2020 2020 2022  mode!).        "
+00015240: 2222 0a0a 2020 2020 2020 2020 6f6e 655f  ""..        one_
+00015250: 6361 6c6c 203d 2074 696d 6566 7261 6d65  call = timeframe
+00015260: 5f74 6f5f 6d73 6563 7328 7469 6d65 6672  _to_msecs(timefr
+00015270: 616d 6529 202a 2073 656c 662e 6f68 6c63  ame) * self.ohlc
+00015280: 765f 6361 6e64 6c65 5f6c 696d 6974 280a  v_candle_limit(.
+00015290: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+000152a0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
+000152b0: 7065 2c20 7369 6e63 655f 6d73 290a 2020  pe, since_ms).  
+000152c0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+000152d0: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
+000152e0: 226f 6e65 5f63 616c 6c3a 2025 7320 6d73  "one_call: %s ms
+000152f0: 6563 7320 2825 7329 222c 0a20 2020 2020  ecs (%s)",.     
+00015300: 2020 2020 2020 206f 6e65 5f63 616c 6c2c         one_call,
+00015310: 0a20 2020 2020 2020 2020 2020 2064 745f  .            dt_
+00015320: 6875 6d61 6e69 7a65 2864 745f 6e6f 7728  humanize(dt_now(
+00015330: 2920 2d20 7469 6d65 6465 6c74 6128 6d69  ) - timedelta(mi
+00015340: 6c6c 6973 6563 6f6e 6473 3d6f 6e65 5f63  lliseconds=one_c
+00015350: 616c 6c29 2c20 6f6e 6c79 5f64 6973 7461  all), only_dista
+00015360: 6e63 653d 5472 7565 290a 2020 2020 2020  nce=True).      
+00015370: 2020 290a 2020 2020 2020 2020 696e 7075    ).        inpu
+00015380: 745f 636f 726f 7574 696e 6573 203d 205b  t_coroutines = [
+00015390: 7365 6c66 2e5f 6173 796e 635f 6765 745f  self._async_get_
+000153a0: 6361 6e64 6c65 5f68 6973 746f 7279 280a  candle_history(.
+000153b0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+000153c0: 2c20 7469 6d65 6672 616d 652c 2063 616e  , timeframe, can
+000153d0: 646c 655f 7479 7065 2c20 7369 6e63 6529  dle_type, since)
+000153e0: 2066 6f72 2073 696e 6365 2069 6e0a 2020   for since in.  
+000153f0: 2020 2020 2020 2020 2020 7261 6e67 6528            range(
+00015400: 7369 6e63 655f 6d73 2c20 756e 7469 6c5f  since_ms, until_
+00015410: 6d73 206f 7220 6474 5f74 7328 292c 206f  ms or dt_ts(), o
+00015420: 6e65 5f63 616c 6c29 5d0a 0a20 2020 2020  ne_call)]..     
+00015430: 2020 2064 6174 613a 204c 6973 7420 3d20     data: List = 
+00015440: 5b5d 0a20 2020 2020 2020 2023 2043 6875  [].        # Chu
+00015450: 6e6b 2072 6571 7565 7374 7320 696e 746f  nk requests into
+00015460: 2062 6174 6368 6573 206f 6620 3130 3020   batches of 100 
+00015470: 746f 2061 766f 6964 206f 7665 7277 656c  to avoid overwel
+00015480: 6d69 6e67 2063 6378 7420 5468 726f 7474  ming ccxt Thrott
+00015490: 6c69 6e67 0a20 2020 2020 2020 2066 6f72  ling.        for
+000154a0: 2069 6e70 7574 5f63 6f72 6f20 696e 2063   input_coro in c
+000154b0: 6875 6e6b 7328 696e 7075 745f 636f 726f  hunks(input_coro
+000154c0: 7574 696e 6573 2c20 3130 3029 3a0a 0a20  utines, 100):.. 
+000154d0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+000154e0: 7473 203d 2061 7761 6974 2061 7379 6e63  ts = await async
+000154f0: 696f 2e67 6174 6865 7228 2a69 6e70 7574  io.gather(*input
+00015500: 5f63 6f72 6f2c 2072 6574 7572 6e5f 6578  _coro, return_ex
+00015510: 6365 7074 696f 6e73 3d54 7275 6529 0a20  ceptions=True). 
+00015520: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00015530: 6573 2069 6e20 7265 7375 6c74 733a 0a20  es in results:. 
+00015540: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015550: 6620 6973 696e 7374 616e 6365 2872 6573  f isinstance(res
+00015560: 2c20 4578 6365 7074 696f 6e29 3a0a 2020  , Exception):.  
+00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015580: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00015590: 2866 2241 7379 6e63 2063 6f64 6520 7261  (f"Async code ra
+000155a0: 6973 6564 2061 6e20 6578 6365 7074 696f  ised an exceptio
+000155b0: 6e3a 207b 7265 7072 2872 6573 297d 2229  n: {repr(res)}")
+000155c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000155d0: 2020 2020 2069 6620 7261 6973 655f 3a0a       if raise_:.
+000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155f0: 2020 2020 2020 2020 7261 6973 650a 2020          raise.  
+00015600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015610: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00015620: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00015630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015640: 2020 2020 2023 2044 6563 6f6e 7374 7275       # Deconstru
+00015650: 6374 2074 7570 6c65 2069 6620 6974 2773  ct tuple if it's
+00015660: 206e 6f74 2061 6e20 6578 6365 7074 696f   not an exceptio
+00015670: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00015680: 2020 2020 2020 702c 205f 2c20 632c 206e        p, _, c, n
+00015690: 6577 5f64 6174 612c 205f 203d 2072 6573  ew_data, _ = res
+000156a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000156b0: 2020 2020 2069 6620 7020 3d3d 2070 6169       if p == pai
+000156c0: 7220 616e 6420 6320 3d3d 2063 616e 646c  r and c == candl
+000156d0: 655f 7479 7065 3a0a 2020 2020 2020 2020  e_type:.        
+000156e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156f0: 6461 7461 2e65 7874 656e 6428 6e65 775f  data.extend(new_
+00015700: 6461 7461 290a 2020 2020 2020 2020 2320  data).        # 
+00015710: 536f 7274 2064 6174 6120 6167 6169 6e20  Sort data again 
+00015720: 6166 7465 7220 6578 7465 6e64 696e 6720  after extending 
+00015730: 7468 6520 7265 7375 6c74 202d 2061 626f  the result - abo
+00015740: 7665 2063 616c 6c73 2072 6574 7572 6e20  ve calls return 
+00015750: 696e 2022 6173 796e 6320 6f72 6465 7222  in "async order"
+00015760: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00015770: 736f 7274 6564 2864 6174 612c 206b 6579  sorted(data, key
+00015780: 3d6c 616d 6264 6120 783a 2078 5b30 5d29  =lambda x: x[0])
+00015790: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000157a0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+000157b0: 2063 616e 646c 655f 7479 7065 2c20 6461   candle_type, da
+000157c0: 7461 2c20 7365 6c66 2e5f 6f68 6c63 765f  ta, self._ohlcv_
+000157d0: 7061 7274 6961 6c5f 6361 6e64 6c65 0a0a  partial_candle..
+000157e0: 2020 2020 6465 6620 5f62 7569 6c64 5f63      def _build_c
+000157f0: 6f72 6f75 7469 6e65 280a 2020 2020 2020  oroutine(.      
+00015800: 2020 2020 2020 7365 6c66 2c20 7061 6972        self, pair
+00015810: 3a20 7374 722c 2074 696d 6566 7261 6d65  : str, timeframe
+00015820: 3a20 7374 722c 2063 616e 646c 655f 7479  : str, candle_ty
+00015830: 7065 3a20 4361 6e64 6c65 5479 7065 2c0a  pe: CandleType,.
+00015840: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+00015850: 655f 6d73 3a20 4f70 7469 6f6e 616c 5b69  e_ms: Optional[i
+00015860: 6e74 5d2c 2063 6163 6865 3a20 626f 6f6c  nt], cache: bool
+00015870: 2920 2d3e 2043 6f72 6f75 7469 6e65 5b41  ) -> Coroutine[A
+00015880: 6e79 2c20 416e 792c 204f 484c 4356 5265  ny, Any, OHLCVRe
+00015890: 7370 6f6e 7365 5d3a 0a20 2020 2020 2020  sponse]:.       
+000158a0: 206e 6f74 5f61 6c6c 5f64 6174 6120 3d20   not_all_data = 
+000158b0: 6361 6368 6520 616e 6420 7365 6c66 2e72  cache and self.r
+000158c0: 6571 7569 7265 645f 6361 6e64 6c65 5f63  equired_candle_c
+000158d0: 616c 6c5f 636f 756e 7420 3e20 310a 2020  all_count > 1.  
+000158e0: 2020 2020 2020 6966 2063 6163 6865 2061        if cache a
+000158f0: 6e64 2028 7061 6972 2c20 7469 6d65 6672  nd (pair, timefr
+00015900: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00015910: 2920 696e 2073 656c 662e 5f6b 6c69 6e65  ) in self._kline
+00015920: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+00015930: 616e 646c 655f 6c69 6d69 7420 3d20 7365  andle_limit = se
+00015940: 6c66 2e6f 686c 6376 5f63 616e 646c 655f  lf.ohlcv_candle_
+00015950: 6c69 6d69 7428 7469 6d65 6672 616d 652c  limit(timeframe,
+00015960: 2063 616e 646c 655f 7479 7065 290a 2020   candle_type).  
+00015970: 2020 2020 2020 2020 2020 6d69 6e5f 6461            min_da
+00015980: 7465 203d 2064 6174 655f 6d69 6e75 735f  te = date_minus_
+00015990: 6361 6e64 6c65 7328 7469 6d65 6672 616d  candles(timefram
+000159a0: 652c 2063 616e 646c 655f 6c69 6d69 7420  e, candle_limit 
+000159b0: 2d20 3529 2e74 696d 6573 7461 6d70 2829  - 5).timestamp()
+000159c0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+000159d0: 6865 636b 2069 6620 3120 6361 6c6c 2063  heck if 1 call c
+000159e0: 616e 2067 6574 2075 7320 7570 6461 7465  an get us update
+000159f0: 6420 6361 6e64 6c65 7320 7769 7468 6f75  d candles withou
+00015a00: 7420 686f 6c65 2069 6e20 7468 6520 6461  t hole in the da
+00015a10: 7461 2e0a 2020 2020 2020 2020 2020 2020  ta..            
+00015a20: 6966 206d 696e 5f64 6174 6520 3c20 7365  if min_date < se
+00015a30: 6c66 2e5f 7061 6972 735f 6c61 7374 5f72  lf._pairs_last_r
+00015a40: 6566 7265 7368 5f74 696d 652e 6765 7428  efresh_time.get(
+00015a50: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+00015a60: 2c20 6361 6e64 6c65 5f74 7970 6529 2c20  , candle_type), 
+00015a70: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+00015a80: 2020 2020 2320 4361 6368 6520 6361 6e20      # Cache can 
+00015a90: 6265 2075 7365 6420 2d20 646f 206f 6e65  be used - do one
+00015aa0: 2d6f 6666 2063 616c 6c2e 0a20 2020 2020  -off call..     
+00015ab0: 2020 2020 2020 2020 2020 206e 6f74 5f61             not_a
+00015ac0: 6c6c 5f64 6174 6120 3d20 4661 6c73 650a  ll_data = False.
+00015ad0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00015ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015af0: 2020 2320 5469 6d65 206a 756d 7020 6465    # Time jump de
+00015b00: 7465 6374 6564 2c20 6576 6963 7420 6361  tected, evict ca
+00015b10: 6368 650a 2020 2020 2020 2020 2020 2020  che.            
+00015b20: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00015b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015b40: 2020 2020 2066 2254 696d 6520 6a75 6d70       f"Time jump
+00015b50: 2064 6574 6563 7465 642e 2045 7669 6374   detected. Evict
+00015b60: 696e 6720 6361 6368 6520 666f 7220 7b70  ing cache for {p
+00015b70: 6169 727d 2c20 7b74 696d 6566 7261 6d65  air}, {timeframe
+00015b80: 7d2c 207b 6361 6e64 6c65 5f74 7970 657d  }, {candle_type}
+00015b90: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00015ba0: 2020 2064 656c 2073 656c 662e 5f6b 6c69     del self._kli
+00015bb0: 6e65 735b 2870 6169 722c 2074 696d 6566  nes[(pair, timef
+00015bc0: 7261 6d65 2c20 6361 6e64 6c65 5f74 7970  rame, candle_typ
+00015bd0: 6529 5d0a 0a20 2020 2020 2020 2069 6620  e)]..        if 
+00015be0: 286e 6f74 2073 696e 6365 5f6d 7320 616e  (not since_ms an
+00015bf0: 6420 2873 656c 662e 5f66 745f 6861 735b  d (self._ft_has[
+00015c00: 226f 686c 6376 5f72 6571 7569 7265 5f73  "ohlcv_require_s
+00015c10: 696e 6365 225d 206f 7220 6e6f 745f 616c  ince"] or not_al
+00015c20: 6c5f 6461 7461 2929 3a0a 2020 2020 2020  l_data)):.      
+00015c30: 2020 2020 2020 2320 4d75 6c74 6970 6c65        # Multiple
+00015c40: 2063 616c 6c73 2066 6f72 206f 6e65 2070   calls for one p
+00015c50: 6169 7220 2d20 746f 2067 6574 206d 6f72  air - to get mor
+00015c60: 6520 6869 7374 6f72 790a 2020 2020 2020  e history.      
+00015c70: 2020 2020 2020 6f6e 655f 6361 6c6c 203d        one_call =
+00015c80: 2074 696d 6566 7261 6d65 5f74 6f5f 6d73   timeframe_to_ms
+00015c90: 6563 7328 7469 6d65 6672 616d 6529 202a  ecs(timeframe) *
+00015ca0: 2073 656c 662e 6f68 6c63 765f 6361 6e64   self.ohlcv_cand
+00015cb0: 6c65 5f6c 696d 6974 280a 2020 2020 2020  le_limit(.      
+00015cc0: 2020 2020 2020 2020 2020 7469 6d65 6672            timefr
+00015cd0: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00015ce0: 2c20 7369 6e63 655f 6d73 290a 2020 2020  , since_ms).    
+00015cf0: 2020 2020 2020 2020 6d6f 7665 5f74 6f20          move_to 
+00015d00: 3d20 6f6e 655f 6361 6c6c 202a 2073 656c  = one_call * sel
+00015d10: 662e 7265 7175 6972 6564 5f63 616e 646c  f.required_candl
+00015d20: 655f 6361 6c6c 5f63 6f75 6e74 0a20 2020  e_call_count.   
+00015d30: 2020 2020 2020 2020 206e 6f77 203d 2074           now = t
+00015d40: 696d 6566 7261 6d65 5f74 6f5f 6e65 7874  imeframe_to_next
+00015d50: 5f64 6174 6528 7469 6d65 6672 616d 6529  _date(timeframe)
+00015d60: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00015d70: 6365 5f6d 7320 3d20 696e 7428 286e 6f77  ce_ms = int((now
+00015d80: 202d 2074 696d 6564 656c 7461 2873 6563   - timedelta(sec
+00015d90: 6f6e 6473 3d6d 6f76 655f 746f 202f 2f20  onds=move_to // 
+00015da0: 3130 3030 2929 2e74 696d 6573 7461 6d70  1000)).timestamp
+00015db0: 2829 202a 2031 3030 3029 0a0a 2020 2020  () * 1000)..    
+00015dc0: 2020 2020 6966 2073 696e 6365 5f6d 733a      if since_ms:
+00015dd0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015de0: 7572 6e20 7365 6c66 2e5f 6173 796e 635f  urn self._async_
+00015df0: 6765 745f 6869 7374 6f72 6963 5f6f 686c  get_historic_ohl
+00015e00: 6376 280a 2020 2020 2020 2020 2020 2020  cv(.            
+00015e10: 2020 2020 7061 6972 2c20 7469 6d65 6672      pair, timefr
+00015e20: 616d 652c 2073 696e 6365 5f6d 733d 7369  ame, since_ms=si
+00015e30: 6e63 655f 6d73 2c20 7261 6973 655f 3d54  nce_ms, raise_=T
+00015e40: 7275 652c 2063 616e 646c 655f 7479 7065  rue, candle_type
+00015e50: 3d63 616e 646c 655f 7479 7065 290a 2020  =candle_type).  
+00015e60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015e70: 2020 2020 2020 2020 2320 4f6e 6520 6361          # One ca
+00015e80: 6c6c 202e 2e2e 2022 7265 6775 6c61 7222  ll ... "regular"
+00015e90: 2072 6566 7265 7368 0a20 2020 2020 2020   refresh.       
+00015ea0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00015eb0: 2e5f 6173 796e 635f 6765 745f 6361 6e64  ._async_get_cand
+00015ec0: 6c65 5f68 6973 746f 7279 280a 2020 2020  le_history(.    
+00015ed0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+00015ee0: 2c20 7469 6d65 6672 616d 652c 2073 696e  , timeframe, sin
+00015ef0: 6365 5f6d 733d 7369 6e63 655f 6d73 2c20  ce_ms=since_ms, 
+00015f00: 6361 6e64 6c65 5f74 7970 653d 6361 6e64  candle_type=cand
+00015f10: 6c65 5f74 7970 6529 0a0a 2020 2020 6465  le_type)..    de
+00015f20: 6620 5f62 7569 6c64 5f6f 686c 6376 5f64  f _build_ohlcv_d
+00015f30: 6c5f 6a6f 6273 280a 2020 2020 2020 2020  l_jobs(.        
+00015f40: 2020 2020 7365 6c66 2c20 7061 6972 5f6c      self, pair_l
+00015f50: 6973 743a 204c 6973 7450 6169 7273 5769  ist: ListPairsWi
+00015f60: 7468 5469 6d65 6672 616d 6573 2c20 7369  thTimeframes, si
+00015f70: 6e63 655f 6d73 3a20 4f70 7469 6f6e 616c  nce_ms: Optional
+00015f80: 5b69 6e74 5d2c 0a20 2020 2020 2020 2020  [int],.         
+00015f90: 2020 2063 6163 6865 3a20 626f 6f6c 2920     cache: bool) 
+00015fa0: 2d3e 2054 7570 6c65 5b4c 6973 745b 436f  -> Tuple[List[Co
+00015fb0: 726f 7574 696e 655d 2c20 4c69 7374 5b54  routine], List[T
+00015fc0: 7570 6c65 5b73 7472 2c20 7374 722c 2043  uple[str, str, C
+00015fd0: 616e 646c 6554 7970 655d 5d5d 3a0a 2020  andleType]]]:.  
+00015fe0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00015ff0: 2020 4275 696c 6420 436f 726f 7574 696e    Build Coroutin
+00016000: 6573 2074 6f20 6578 6563 7574 6520 6173  es to execute as
+00016010: 2070 6172 7420 6f66 2072 6566 7265 7368   part of refresh
+00016020: 5f6c 6174 6573 745f 6f68 6c63 760a 2020  _latest_ohlcv.  
+00016030: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016040: 2020 696e 7075 745f 636f 726f 7574 696e    input_coroutin
+00016050: 6573 3a20 4c69 7374 5b43 6f72 6f75 7469  es: List[Corouti
+00016060: 6e65 5b41 6e79 2c20 416e 792c 204f 484c  ne[Any, Any, OHL
+00016070: 4356 5265 7370 6f6e 7365 5d5d 203d 205b  CVResponse]] = [
+00016080: 5d0a 2020 2020 2020 2020 6361 6368 6564  ].        cached
+00016090: 5f70 6169 7273 203d 205b 5d0a 2020 2020  _pairs = [].    
+000160a0: 2020 2020 666f 7220 7061 6972 2c20 7469      for pair, ti
+000160b0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
+000160c0: 7479 7065 2069 6e20 7365 7428 7061 6972  type in set(pair
+000160d0: 5f6c 6973 7429 3a0a 2020 2020 2020 2020  _list):.        
+000160e0: 2020 2020 6966 2028 7469 6d65 6672 616d      if (timefram
+000160f0: 6520 6e6f 7420 696e 2073 656c 662e 7469  e not in self.ti
+00016100: 6d65 6672 616d 6573 0a20 2020 2020 2020  meframes.       
+00016110: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+00016120: 2063 616e 646c 655f 7479 7065 2069 6e20   candle_type in 
+00016130: 2843 616e 646c 6554 7970 652e 5350 4f54  (CandleType.SPOT
+00016140: 2c20 4361 6e64 6c65 5479 7065 2e46 5554  , CandleType.FUT
+00016150: 5552 4553 2929 3a0a 2020 2020 2020 2020  URES)):.        
+00016160: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+00016170: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
+00016180: 2020 2020 2020 2020 2020 2020 6622 4361              f"Ca
+00016190: 6e6e 6f74 2064 6f77 6e6c 6f61 6420 287b  nnot download ({
+000161a0: 7061 6972 7d2c 207b 7469 6d65 6672 616d  pair}, {timefram
+000161b0: 657d 2920 636f 6d62 696e 6174 696f 6e20  e}) combination 
+000161c0: 6173 2074 6869 7320 7469 6d65 6672 616d  as this timefram
+000161d0: 6520 6973 2022 0a20 2020 2020 2020 2020  e is ".         
+000161e0: 2020 2020 2020 2020 2020 2066 226e 6f74             f"not
+000161f0: 2061 7661 696c 6162 6c65 206f 6e20 7b73   available on {s
+00016200: 656c 662e 6e61 6d65 7d2e 2041 7661 696c  elf.name}. Avail
+00016210: 6162 6c65 2074 696d 6566 7261 6d65 7320  able timeframes 
+00016220: 6172 6520 220a 2020 2020 2020 2020 2020  are ".          
+00016230: 2020 2020 2020 2020 2020 6622 7b27 2c20            f"{', 
+00016240: 272e 6a6f 696e 2873 656c 662e 7469 6d65  '.join(self.time
+00016250: 6672 616d 6573 297d 2e22 290a 2020 2020  frames)}.").    
+00016260: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00016270: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
+00016280: 2020 6966 2028 2870 6169 722c 2074 696d    if ((pair, tim
+00016290: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
+000162a0: 7970 6529 206e 6f74 2069 6e20 7365 6c66  ype) not in self
+000162b0: 2e5f 6b6c 696e 6573 206f 7220 6e6f 7420  ._klines or not 
+000162c0: 6361 6368 650a 2020 2020 2020 2020 2020  cache.          
+000162d0: 2020 2020 2020 2020 2020 6f72 2073 656c            or sel
+000162e0: 662e 5f6e 6f77 5f69 735f 7469 6d65 5f74  f._now_is_time_t
+000162f0: 6f5f 7265 6672 6573 6828 7061 6972 2c20  o_refresh(pair, 
+00016300: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
+00016310: 655f 7479 7065 2929 3a0a 0a20 2020 2020  e_type)):..     
+00016320: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00016330: 5f63 6f72 6f75 7469 6e65 732e 6170 7065  _coroutines.appe
+00016340: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00016350: 2020 2020 2020 2020 7365 6c66 2e5f 6275          self._bu
+00016360: 696c 645f 636f 726f 7574 696e 6528 7061  ild_coroutine(pa
+00016370: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+00016380: 616e 646c 655f 7479 7065 2c20 7369 6e63  andle_type, sinc
+00016390: 655f 6d73 2c20 6361 6368 6529 290a 0a20  e_ms, cache)).. 
+000163a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000163b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000163c0: 206c 6f67 6765 722e 6465 6275 6728 0a20   logger.debug(. 
+000163d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163e0: 2020 2066 2255 7369 6e67 2063 6163 6865     f"Using cache
+000163f0: 6420 6361 6e64 6c65 2028 4f48 4c43 5629  d candle (OHLCV)
+00016400: 2064 6174 6120 666f 7220 7b70 6169 727d   data for {pair}
+00016410: 2c20 7b74 696d 6566 7261 6d65 7d2c 207b  , {timeframe}, {
+00016420: 6361 6e64 6c65 5f74 7970 657d 202e 2e2e  candle_type} ...
+00016430: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00016440: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00016450: 2020 2020 6361 6368 6564 5f70 6169 7273      cached_pairs
+00016460: 2e61 7070 656e 6428 2870 6169 722c 2074  .append((pair, t
+00016470: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
+00016480: 5f74 7970 6529 290a 0a20 2020 2020 2020  _type))..       
+00016490: 2072 6574 7572 6e20 696e 7075 745f 636f   return input_co
+000164a0: 726f 7574 696e 6573 2c20 6361 6368 6564  routines, cached
+000164b0: 5f70 6169 7273 0a0a 2020 2020 6465 6620  _pairs..    def 
+000164c0: 5f70 726f 6365 7373 5f6f 686c 6376 5f64  _process_ohlcv_d
+000164d0: 6628 7365 6c66 2c20 7061 6972 3a20 7374  f(self, pair: st
+000164e0: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
+000164f0: 722c 2063 5f74 7970 653a 2043 616e 646c  r, c_type: Candl
+00016500: 6554 7970 652c 2074 6963 6b73 3a20 4c69  eType, ticks: Li
+00016510: 7374 5b4c 6973 745d 2c0a 2020 2020 2020  st[List],.      
+00016520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016530: 2020 2020 6361 6368 653a 2062 6f6f 6c2c      cache: bool,
+00016540: 2064 726f 705f 696e 636f 6d70 6c65 7465   drop_incomplete
+00016550: 3a20 626f 6f6c 2920 2d3e 2044 6174 6146  : bool) -> DataF
+00016560: 7261 6d65 3a0a 2020 2020 2020 2020 2320  rame:.        # 
+00016570: 6b65 6570 696e 6720 6c61 7374 2063 616e  keeping last can
+00016580: 646c 6520 7469 6d65 2061 7320 6c61 7374  dle time as last
+00016590: 2072 6566 7265 7368 6564 2074 696d 6520   refreshed time 
+000165a0: 6f66 2074 6865 2070 6169 720a 2020 2020  of the pair.    
+000165b0: 2020 2020 6966 2074 6963 6b73 2061 6e64      if ticks and
+000165c0: 2063 6163 6865 3a0a 2020 2020 2020 2020   cache:.        
+000165d0: 2020 2020 6964 7820 3d20 2d32 2069 6620      idx = -2 if 
+000165e0: 6472 6f70 5f69 6e63 6f6d 706c 6574 6520  drop_incomplete 
+000165f0: 616e 6420 6c65 6e28 7469 636b 7329 203e  and len(ticks) >
+00016600: 2031 2065 6c73 6520 2d31 0a20 2020 2020   1 else -1.     
+00016610: 2020 2020 2020 2073 656c 662e 5f70 6169         self._pai
+00016620: 7273 5f6c 6173 745f 7265 6672 6573 685f  rs_last_refresh_
+00016630: 7469 6d65 5b28 7061 6972 2c20 7469 6d65  time[(pair, time
+00016640: 6672 616d 652c 2063 5f74 7970 6529 5d20  frame, c_type)] 
+00016650: 3d20 7469 636b 735b 6964 785d 5b30 5d20  = ticks[idx][0] 
+00016660: 2f2f 2031 3030 300a 2020 2020 2020 2020  // 1000.        
+00016670: 2320 6b65 6570 696e 6720 7061 7273 6564  # keeping parsed
+00016680: 2064 6174 6166 7261 6d65 2069 6e20 6361   dataframe in ca
+00016690: 6368 650a 2020 2020 2020 2020 6f68 6c63  che.        ohlc
+000166a0: 765f 6466 203d 206f 686c 6376 5f74 6f5f  v_df = ohlcv_to_
+000166b0: 6461 7461 6672 616d 6528 7469 636b 732c  dataframe(ticks,
+000166c0: 2074 696d 6566 7261 6d65 2c20 7061 6972   timeframe, pair
+000166d0: 3d70 6169 722c 2066 696c 6c5f 6d69 7373  =pair, fill_miss
+000166e0: 696e 673d 5472 7565 2c0a 2020 2020 2020  ing=True,.      
+000166f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016710: 6472 6f70 5f69 6e63 6f6d 706c 6574 653d  drop_incomplete=
+00016720: 6472 6f70 5f69 6e63 6f6d 706c 6574 6529  drop_incomplete)
+00016730: 0a20 2020 2020 2020 2069 6620 6361 6368  .        if cach
+00016740: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00016750: 6620 2870 6169 722c 2074 696d 6566 7261  f (pair, timefra
+00016760: 6d65 2c20 635f 7479 7065 2920 696e 2073  me, c_type) in s
+00016770: 656c 662e 5f6b 6c69 6e65 733a 0a20 2020  elf._klines:.   
+00016780: 2020 2020 2020 2020 2020 2020 206f 6c64               old
+00016790: 203d 2073 656c 662e 5f6b 6c69 6e65 735b   = self._klines[
+000167a0: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+000167b0: 2c20 635f 7479 7065 295d 0a20 2020 2020  , c_type)].     
+000167c0: 2020 2020 2020 2020 2020 2023 2052 6561             # Rea
+000167d0: 7373 6967 6e20 736f 2077 6520 7265 7475  ssign so we retu
+000167e0: 726e 2074 6865 2075 7064 6174 6564 2c20  rn the updated, 
+000167f0: 636f 6d62 696e 6564 2064 660a 2020 2020  combined df.    
+00016800: 2020 2020 2020 2020 2020 2020 6f68 6c63              ohlc
+00016810: 765f 6466 203d 2063 6c65 616e 5f6f 686c  v_df = clean_ohl
+00016820: 6376 5f64 6174 6166 7261 6d65 2863 6f6e  cv_dataframe(con
+00016830: 6361 7428 5b6f 6c64 2c20 6f68 6c63 765f  cat([old, ohlcv_
+00016840: 6466 5d2c 2061 7869 733d 3029 2c20 7469  df], axis=0), ti
+00016850: 6d65 6672 616d 652c 2070 6169 722c 0a20  meframe, pair,. 
+00016860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016870: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016890: 2064 726f 705f 696e 636f 6d70 6c65 7465   drop_incomplete
-000168a0: 3a20 4f70 7469 6f6e 616c 5b62 6f6f 6c5d  : Optional[bool]
-000168b0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000168d0: 2020 2020 2029 202d 3e20 4469 6374 5b50       ) -> Dict[P
-000168e0: 6169 7257 6974 6854 696d 6566 7261 6d65  airWithTimeframe
-000168f0: 2c20 4461 7461 4672 616d 655d 3a0a 2020  , DataFrame]:.  
-00016900: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016910: 2020 5265 6672 6573 6820 696e 2d6d 656d    Refresh in-mem
-00016920: 6f72 7920 4f48 4c43 5620 6173 796e 6368  ory OHLCV asynch
-00016930: 726f 6e6f 7573 6c79 2061 6e64 2073 6574  ronously and set
-00016940: 2060 5f6b 6c69 6e65 7360 2077 6974 6820   `_klines` with 
-00016950: 7468 6520 7265 7375 6c74 0a20 2020 2020  the result.     
-00016960: 2020 204c 6f6f 7073 2061 7379 6e63 6872     Loops asynchr
-00016970: 6f6e 6f75 736c 7920 6f76 6572 2070 6169  onously over pai
-00016980: 725f 6c69 7374 2061 6e64 2064 6f77 6e6c  r_list and downl
-00016990: 6f61 6473 2061 6c6c 2070 6169 7273 2061  oads all pairs a
-000169a0: 7379 6e63 2028 7365 6d69 2d70 6172 616c  sync (semi-paral
-000169b0: 6c65 6c29 2e0a 2020 2020 2020 2020 4f6e  lel)..        On
-000169c0: 6c79 2075 7365 6420 696e 2074 6865 2064  ly used in the d
-000169d0: 6174 6170 726f 7669 6465 722e 7265 6672  ataprovider.refr
-000169e0: 6573 6828 2920 6d65 7468 6f64 2e0a 2020  esh() method..  
-000169f0: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
-00016a00: 725f 6c69 7374 3a20 4c69 7374 206f 6620  r_list: List of 
-00016a10: 3220 656c 656d 656e 7420 7475 706c 6573  2 element tuples
-00016a20: 2063 6f6e 7461 696e 696e 6720 7061 6972   containing pair
-00016a30: 2c20 696e 7465 7276 616c 2074 6f20 7265  , interval to re
-00016a40: 6672 6573 680a 2020 2020 2020 2020 3a70  fresh.        :p
-00016a50: 6172 616d 2073 696e 6365 5f6d 733a 2074  aram since_ms: t
-00016a60: 696d 6520 7369 6e63 6520 7768 656e 2074  ime since when t
-00016a70: 6f20 646f 776e 6c6f 6164 2c20 696e 206d  o download, in m
-00016a80: 696c 6c69 7365 636f 6e64 730a 2020 2020  illiseconds.    
-00016a90: 2020 2020 3a70 6172 616d 2063 6163 6865      :param cache
-00016aa0: 3a20 4173 7369 676e 2072 6573 756c 7420  : Assign result 
-00016ab0: 746f 205f 6b6c 696e 6573 2e20 5573 6566  to _klines. Usef
-00016ac0: 756c 6c20 666f 7220 6f6e 652d 6f66 6620  ull for one-off 
-00016ad0: 646f 776e 6c6f 6164 7320 6c69 6b65 2066  downloads like f
-00016ae0: 6f72 2070 6169 726c 6973 7473 0a20 2020  or pairlists.   
-00016af0: 2020 2020 203a 7061 7261 6d20 6472 6f70       :param drop
-00016b00: 5f69 6e63 6f6d 706c 6574 653a 2043 6f6e  _incomplete: Con
-00016b10: 7472 6f6c 2063 616e 646c 6520 6472 6f70  trol candle drop
-00016b20: 7069 6e67 2e0a 2020 2020 2020 2020 2020  ping..          
-00016b30: 2020 5370 6563 6966 7969 6e67 204e 6f6e    Specifying Non
-00016b40: 6520 6465 6661 756c 7473 2074 6f20 5f6f  e defaults to _o
-00016b50: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
-00016b60: 646c 650a 2020 2020 2020 2020 3a72 6574  dle.        :ret
-00016b70: 7572 6e3a 2044 6963 7420 6f66 205b 7b28  urn: Dict of [{(
-00016b80: 7061 6972 2c20 7469 6d65 6672 616d 6529  pair, timeframe)
-00016b90: 3a20 4461 7461 6672 616d 657d 5d0a 2020  : Dataframe}].  
-00016ba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016bb0: 2020 6c6f 6767 6572 2e64 6562 7567 2822    logger.debug("
-00016bc0: 5265 6672 6573 6869 6e67 2063 616e 646c  Refreshing candl
-00016bd0: 6520 284f 484c 4356 2920 6461 7461 2066  e (OHLCV) data f
-00016be0: 6f72 2025 6420 7061 6972 7322 2c20 6c65  or %d pairs", le
-00016bf0: 6e28 7061 6972 5f6c 6973 7429 290a 0a20  n(pair_list)).. 
-00016c00: 2020 2020 2020 2023 2047 6174 6865 7220         # Gather 
-00016c10: 636f 726f 7574 696e 6573 2074 6f20 7275  coroutines to ru
-00016c20: 6e0a 2020 2020 2020 2020 696e 7075 745f  n.        input_
-00016c30: 636f 726f 7574 696e 6573 2c20 6361 6368  coroutines, cach
-00016c40: 6564 5f70 6169 7273 203d 2073 656c 662e  ed_pairs = self.
-00016c50: 5f62 7569 6c64 5f6f 686c 6376 5f64 6c5f  _build_ohlcv_dl_
-00016c60: 6a6f 6273 2870 6169 725f 6c69 7374 2c20  jobs(pair_list, 
-00016c70: 7369 6e63 655f 6d73 2c20 6361 6368 6529  since_ms, cache)
-00016c80: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00016c90: 735f 6466 203d 207b 7d0a 2020 2020 2020  s_df = {}.      
-00016ca0: 2020 2320 4368 756e 6b20 7265 7175 6573    # Chunk reques
-00016cb0: 7473 2069 6e74 6f20 6261 7463 6865 7320  ts into batches 
-00016cc0: 6f66 2031 3030 2074 6f20 6176 6f69 6420  of 100 to avoid 
-00016cd0: 6f76 6572 7765 6c6d 696e 6720 6363 7874  overwelming ccxt
-00016ce0: 2054 6872 6f74 746c 696e 670a 2020 2020   Throttling.    
-00016cf0: 2020 2020 666f 7220 696e 7075 745f 636f      for input_co
-00016d00: 726f 2069 6e20 6368 756e 6b73 2869 6e70  ro in chunks(inp
-00016d10: 7574 5f63 6f72 6f75 7469 6e65 732c 2031  ut_coroutines, 1
-00016d20: 3030 293a 0a20 2020 2020 2020 2020 2020  00):.           
-00016d30: 2061 7379 6e63 2064 6566 2067 6174 6865   async def gathe
-00016d40: 725f 7374 7566 6628 293a 0a20 2020 2020  r_stuff():.     
-00016d50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00016d60: 6e20 6177 6169 7420 6173 796e 6369 6f2e  n await asyncio.
-00016d70: 6761 7468 6572 282a 696e 7075 745f 636f  gather(*input_co
-00016d80: 726f 2c20 7265 7475 726e 5f65 7863 6570  ro, return_excep
-00016d90: 7469 6f6e 733d 5472 7565 290a 0a20 2020  tions=True)..   
-00016da0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-00016db0: 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a 0a20  lf._loop_lock:. 
-00016dc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016dd0: 6573 756c 7473 203d 2073 656c 662e 6c6f  esults = self.lo
-00016de0: 6f70 2e72 756e 5f75 6e74 696c 5f63 6f6d  op.run_until_com
-00016df0: 706c 6574 6528 6761 7468 6572 5f73 7475  plete(gather_stu
-00016e00: 6666 2829 290a 0a20 2020 2020 2020 2020  ff())..         
-00016e10: 2020 2066 6f72 2072 6573 2069 6e20 7265     for res in re
-00016e20: 7375 6c74 733a 0a20 2020 2020 2020 2020  sults:.         
-00016e30: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00016e40: 616e 6365 2872 6573 2c20 4578 6365 7074  ance(res, Except
-00016e50: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
-00016e60: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00016e70: 2e77 6172 6e69 6e67 2866 2241 7379 6e63  .warning(f"Async
-00016e80: 2063 6f64 6520 7261 6973 6564 2061 6e20   code raised an 
-00016e90: 6578 6365 7074 696f 6e3a 207b 7265 7072  exception: {repr
-00016ea0: 2872 6573 297d 2229 0a20 2020 2020 2020  (res)}").       
-00016eb0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00016ec0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00016ed0: 2020 2020 2020 2320 4465 636f 6e73 7472        # Deconstr
-00016ee0: 7563 7420 7475 706c 6520 2868 6173 2035  uct tuple (has 5
-00016ef0: 2065 6c65 6d65 6e74 7329 0a20 2020 2020   elements).     
-00016f00: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-00016f10: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
-00016f20: 7065 2c20 7469 636b 732c 2064 726f 705f  pe, ticks, drop_
-00016f30: 6869 6e74 203d 2072 6573 0a20 2020 2020  hint = res.     
-00016f40: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
-00016f50: 696e 636f 6d70 6c65 7465 5f20 3d20 6472  incomplete_ = dr
-00016f60: 6f70 5f68 696e 7420 6966 2064 726f 705f  op_hint if drop_
-00016f70: 696e 636f 6d70 6c65 7465 2069 7320 4e6f  incomplete is No
-00016f80: 6e65 2065 6c73 6520 6472 6f70 5f69 6e63  ne else drop_inc
-00016f90: 6f6d 706c 6574 650a 2020 2020 2020 2020  omplete.        
-00016fa0: 2020 2020 2020 2020 6f68 6c63 765f 6466          ohlcv_df
-00016fb0: 203d 2073 656c 662e 5f70 726f 6365 7373   = self._process
-00016fc0: 5f6f 686c 6376 5f64 6628 0a20 2020 2020  _ohlcv_df(.     
-00016fd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00016fe0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-00016ff0: 635f 7479 7065 2c20 7469 636b 732c 2063  c_type, ticks, c
-00017000: 6163 6865 2c20 6472 6f70 5f69 6e63 6f6d  ache, drop_incom
-00017010: 706c 6574 655f 290a 0a20 2020 2020 2020  plete_)..       
-00017020: 2020 2020 2020 2020 2072 6573 756c 7473           results
-00017030: 5f64 665b 2870 6169 722c 2074 696d 6566  _df[(pair, timef
-00017040: 7261 6d65 2c20 635f 7479 7065 295d 203d  rame, c_type)] =
-00017050: 206f 686c 6376 5f64 660a 0a20 2020 2020   ohlcv_df..     
-00017060: 2020 2023 2052 6574 7572 6e20 6361 6368     # Return cach
-00017070: 6564 206b 6c69 6e65 730a 2020 2020 2020  ed klines.      
-00017080: 2020 666f 7220 7061 6972 2c20 7469 6d65    for pair, time
-00017090: 6672 616d 652c 2063 5f74 7970 6520 696e  frame, c_type in
-000170a0: 2063 6163 6865 645f 7061 6972 733a 0a20   cached_pairs:. 
-000170b0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-000170c0: 7473 5f64 665b 2870 6169 722c 2074 696d  ts_df[(pair, tim
-000170d0: 6566 7261 6d65 2c20 635f 7479 7065 295d  eframe, c_type)]
-000170e0: 203d 2073 656c 662e 6b6c 696e 6573 280a   = self.klines(.
-000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
-00017110: 2c20 635f 7479 7065 292c 0a20 2020 2020  , c_type),.     
-00017120: 2020 2020 2020 2020 2020 2063 6f70 793d             copy=
-00017130: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00017140: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
-00017150: 7572 6e20 7265 7375 6c74 735f 6466 0a0a  urn results_df..
-00017160: 2020 2020 6465 6620 5f6e 6f77 5f69 735f      def _now_is_
-00017170: 7469 6d65 5f74 6f5f 7265 6672 6573 6828  time_to_refresh(
-00017180: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-00017190: 2074 696d 6566 7261 6d65 3a20 7374 722c   timeframe: str,
-000171a0: 2063 616e 646c 655f 7479 7065 3a20 4361   candle_type: Ca
-000171b0: 6e64 6c65 5479 7065 2920 2d3e 2062 6f6f  ndleType) -> boo
-000171c0: 6c3a 0a20 2020 2020 2020 2023 2054 696d  l:.        # Tim
-000171d0: 6566 7261 6d65 2069 6e20 7365 636f 6e64  eframe in second
-000171e0: 730a 2020 2020 2020 2020 696e 7465 7276  s.        interv
-000171f0: 616c 5f69 6e5f 7365 6320 3d20 7469 6d65  al_in_sec = time
-00017200: 6672 616d 655f 746f 5f73 6563 6f6e 6473  frame_to_seconds
-00017210: 2874 696d 6566 7261 6d65 290a 2020 2020  (timeframe).    
-00017220: 2020 2020 706c 7220 3d20 7365 6c66 2e5f      plr = self._
-00017230: 7061 6972 735f 6c61 7374 5f72 6566 7265  pairs_last_refre
-00017240: 7368 5f74 696d 652e 6765 7428 2870 6169  sh_time.get((pai
-00017250: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
-00017260: 6e64 6c65 5f74 7970 6529 2c20 3029 202b  ndle_type), 0) +
-00017270: 2069 6e74 6572 7661 6c5f 696e 5f73 6563   interval_in_sec
-00017280: 0a20 2020 2020 2020 2023 2063 7572 7265  .        # curre
-00017290: 6e74 2c61 6374 6976 6520 6361 6e64 6c65  nt,active candle
-000172a0: 206f 7065 6e20 6461 7465 0a20 2020 2020   open date.     
-000172b0: 2020 206e 6f77 203d 2069 6e74 2874 696d     now = int(tim
-000172c0: 6566 7261 6d65 5f74 6f5f 7072 6576 5f64  eframe_to_prev_d
-000172d0: 6174 6528 7469 6d65 6672 616d 6529 2e74  ate(timeframe).t
-000172e0: 696d 6573 7461 6d70 2829 290a 2020 2020  imestamp()).    
-000172f0: 2020 2020 7265 7475 726e 2070 6c72 203c      return plr <
-00017300: 206e 6f77 0a0a 2020 2020 4072 6574 7269   now..    @retri
-00017310: 6572 5f61 7379 6e63 0a20 2020 2061 7379  er_async.    asy
-00017320: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
-00017330: 745f 6361 6e64 6c65 5f68 6973 746f 7279  t_candle_history
-00017340: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00017350: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
-00017360: 722c 0a20 2020 2020 2020 2074 696d 6566  r,.        timef
-00017370: 7261 6d65 3a20 7374 722c 0a20 2020 2020  rame: str,.     
-00017380: 2020 2063 616e 646c 655f 7479 7065 3a20     candle_type: 
-00017390: 4361 6e64 6c65 5479 7065 2c0a 2020 2020  CandleType,.    
-000173a0: 2020 2020 7369 6e63 655f 6d73 3a20 4f70      since_ms: Op
-000173b0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
-000173c0: 6e65 2c0a 2020 2020 2920 2d3e 204f 484c  ne,.    ) -> OHL
-000173d0: 4356 5265 7370 6f6e 7365 3a0a 2020 2020  CVResponse:.    
-000173e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000173f0: 4173 796e 6368 726f 6e6f 7573 6c79 2067  Asynchronously g
-00017400: 6574 2063 616e 646c 6520 6869 7374 6f72  et candle histor
-00017410: 7920 6461 7461 2075 7369 6e67 2066 6574  y data using fet
-00017420: 6368 5f6f 686c 6376 0a20 2020 2020 2020  ch_ohlcv.       
-00017430: 203a 7061 7261 6d20 6361 6e64 6c65 5f74   :param candle_t
-00017440: 7970 653a 2027 272c 206d 6172 6b2c 2069  ype: '', mark, i
-00017450: 6e64 6578 2c20 7072 656d 6975 6d49 6e64  ndex, premiumInd
-00017460: 6578 2c20 6f72 2066 756e 6469 6e67 5f72  ex, or funding_r
-00017470: 6174 650a 2020 2020 2020 2020 7265 7475  ate.        retu
-00017480: 726e 7320 7475 706c 653a 2028 7061 6972  rns tuple: (pair
-00017490: 2c20 7469 6d65 6672 616d 652c 206f 686c  , timeframe, ohl
-000174a0: 6376 5f6c 6973 7429 0a20 2020 2020 2020  cv_list).       
-000174b0: 2022 2222 0a20 2020 2020 2020 2074 7279   """.        try
-000174c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-000174d0: 4665 7463 6820 4f48 4c43 5620 6173 796e  Fetch OHLCV asyn
-000174e0: 6368 726f 6e6f 7573 6c79 0a20 2020 2020  chronously.     
-000174f0: 2020 2020 2020 2073 203d 2027 2827 202b         s = '(' +
-00017500: 2064 745f 6672 6f6d 5f74 7328 7369 6e63   dt_from_ts(sinc
-00017510: 655f 6d73 292e 6973 6f66 6f72 6d61 7428  e_ms).isoformat(
-00017520: 2920 2b20 2729 2027 2069 6620 7369 6e63  ) + ') ' if sinc
-00017530: 655f 6d73 2069 7320 6e6f 7420 4e6f 6e65  e_ms is not None
-00017540: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
-00017550: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-00017560: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-00017570: 2020 2022 4665 7463 6869 6e67 2070 6169     "Fetching pai
-00017580: 7220 2573 2c20 2573 2c20 696e 7465 7276  r %s, %s, interv
-00017590: 616c 2025 732c 2073 696e 6365 2025 7320  al %s, since %s 
-000175a0: 2573 2e2e 2e22 2c0a 2020 2020 2020 2020  %s...",.        
-000175b0: 2020 2020 2020 2020 7061 6972 2c20 6361          pair, ca
-000175c0: 6e64 6c65 5f74 7970 652c 2074 696d 6566  ndle_type, timef
-000175d0: 7261 6d65 2c20 7369 6e63 655f 6d73 2c20  rame, since_ms, 
-000175e0: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
-000175f0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00017600: 6d73 203d 2064 6565 7063 6f70 7928 7365  ms = deepcopy(se
-00017610: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
-00017620: 6f68 6c63 765f 7061 7261 6d73 272c 207b  ohlcv_params', {
-00017630: 7d29 290a 2020 2020 2020 2020 2020 2020  })).            
-00017640: 6361 6e64 6c65 5f6c 696d 6974 203d 2073  candle_limit = s
-00017650: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
-00017660: 5f6c 696d 6974 280a 2020 2020 2020 2020  _limit(.        
-00017670: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
-00017680: 652c 2063 616e 646c 655f 7479 7065 3d63  e, candle_type=c
-00017690: 616e 646c 655f 7479 7065 2c20 7369 6e63  andle_type, sinc
-000176a0: 655f 6d73 3d73 696e 6365 5f6d 7329 0a0a  e_ms=since_ms)..
-000176b0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000176c0: 616e 646c 655f 7479 7065 2061 6e64 2063  andle_type and c
-000176d0: 616e 646c 655f 7479 7065 2021 3d20 4361  andle_type != Ca
-000176e0: 6e64 6c65 5479 7065 2e53 504f 543a 0a20  ndleType.SPOT:. 
-000176f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017700: 6172 616d 732e 7570 6461 7465 287b 2770  arams.update({'p
-00017710: 7269 6365 273a 2063 616e 646c 655f 7479  rice': candle_ty
-00017720: 7065 2e76 616c 7565 7d29 0a20 2020 2020  pe.value}).     
-00017730: 2020 2020 2020 2069 6620 6361 6e64 6c65         if candle
-00017740: 5f74 7970 6520 213d 2043 616e 646c 6554  _type != CandleT
-00017750: 7970 652e 4655 4e44 494e 475f 5241 5445  ype.FUNDING_RATE
-00017760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017770: 2020 6461 7461 203d 2061 7761 6974 2073    data = await s
-00017780: 656c 662e 5f61 7069 5f61 7379 6e63 2e66  elf._api_async.f
-00017790: 6574 6368 5f6f 686c 6376 280a 2020 2020  etch_ohlcv(.    
-000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177b0: 7061 6972 2c20 7469 6d65 6672 616d 653d  pair, timeframe=
-000177c0: 7469 6d65 6672 616d 652c 2073 696e 6365  timeframe, since
-000177d0: 3d73 696e 6365 5f6d 732c 0a20 2020 2020  =since_ms,.     
-000177e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000177f0: 696d 6974 3d63 616e 646c 655f 6c69 6d69  imit=candle_limi
-00017800: 742c 2070 6172 616d 733d 7061 7261 6d73  t, params=params
-00017810: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00017820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017830: 2020 2020 2320 4675 6e64 696e 6720 7261      # Funding ra
-00017840: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
-00017850: 2020 2064 6174 6120 3d20 6177 6169 7420     data = await 
-00017860: 7365 6c66 2e5f 6665 7463 685f 6675 6e64  self._fetch_fund
-00017870: 696e 675f 7261 7465 5f68 6973 746f 7279  ing_rate_history
-00017880: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00017890: 2020 2020 2020 7061 6972 3d70 6169 722c        pair=pair,
-000178a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000178b0: 2020 2020 2074 696d 6566 7261 6d65 3d74       timeframe=t
-000178c0: 696d 6566 7261 6d65 2c0a 2020 2020 2020  imeframe,.      
-000178d0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-000178e0: 6d69 743d 6361 6e64 6c65 5f6c 696d 6974  mit=candle_limit
-000178f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017900: 2020 2020 2020 7369 6e63 655f 6d73 3d73        since_ms=s
-00017910: 696e 6365 5f6d 732c 0a20 2020 2020 2020  ince_ms,.       
-00017920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00017930: 2020 2020 2020 2023 2053 6f6d 6520 6578         # Some ex
-00017940: 6368 616e 6765 7320 736f 7274 204f 484c  changes sort OHL
-00017950: 4356 2069 6e20 4153 4320 6f72 6465 7220  CV in ASC order 
-00017960: 616e 6420 6f74 6865 7273 2069 6e20 4445  and others in DE
-00017970: 5343 2e0a 2020 2020 2020 2020 2020 2020  SC..            
-00017980: 2320 4578 3a20 4269 7474 7265 7820 7265  # Ex: Bittrex re
-00017990: 7475 726e 7320 7468 6520 6c69 7374 206f  turns the list o
-000179a0: 6620 4f48 4c43 5620 696e 2041 5343 206f  f OHLCV in ASC o
-000179b0: 7264 6572 2028 6f6c 6465 7374 2066 6972  rder (oldest fir
-000179c0: 7374 2c20 6e65 7765 7374 206c 6173 7429  st, newest last)
-000179d0: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
-000179e0: 6869 6c65 2047 4441 5820 7265 7475 726e  hile GDAX return
-000179f0: 7320 7468 6520 6c69 7374 206f 6620 4f48  s the list of OH
-00017a00: 4c43 5620 696e 2044 4553 4320 6f72 6465  LCV in DESC orde
-00017a10: 7220 286e 6577 6573 7420 6669 7273 742c  r (newest first,
-00017a20: 206f 6c64 6573 7420 6c61 7374 290a 2020   oldest last).  
-00017a30: 2020 2020 2020 2020 2020 2320 4f6e 6c79            # Only
-00017a40: 2073 6f72 7420 6966 206e 6563 6573 7361   sort if necessa
-00017a50: 7279 2074 6f20 7361 7665 2063 6f6d 7075  ry to save compu
-00017a60: 7469 6e67 2074 696d 650a 2020 2020 2020  ting time.      
-00017a70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00017a80: 2020 2020 2020 2020 2020 2069 6620 6461             if da
-00017a90: 7461 2061 6e64 2064 6174 615b 305d 5b30  ta and data[0][0
-00017aa0: 5d20 3e20 6461 7461 5b2d 315d 5b30 5d3a  ] > data[-1][0]:
-00017ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ac0: 2020 2020 2064 6174 6120 3d20 736f 7274       data = sort
-00017ad0: 6564 2864 6174 612c 206b 6579 3d6c 616d  ed(data, key=lam
-00017ae0: 6264 6120 783a 2078 5b30 5d29 0a20 2020  bda x: x[0]).   
-00017af0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00017b00: 496e 6465 7845 7272 6f72 3a0a 2020 2020  IndexError:.    
-00017b10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00017b20: 6572 2e65 7863 6570 7469 6f6e 2822 4572  er.exception("Er
-00017b30: 726f 7220 6c6f 6164 696e 6720 2573 2e20  ror loading %s. 
-00017b40: 5265 7375 6c74 2077 6173 2025 732e 222c  Result was %s.",
-00017b50: 2070 6169 722c 2064 6174 6129 0a20 2020   pair, data).   
-00017b60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00017b70: 7572 6e20 7061 6972 2c20 7469 6d65 6672  urn pair, timefr
-00017b80: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
-00017b90: 2c20 5b5d 2c20 7365 6c66 2e5f 6f68 6c63  , [], self._ohlc
-00017ba0: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
-00017bb0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00017bc0: 6765 722e 6465 6275 6728 2244 6f6e 6520  ger.debug("Done 
-00017bd0: 6665 7463 6869 6e67 2070 6169 7220 2573  fetching pair %s
-00017be0: 2c20 696e 7465 7276 616c 2025 7320 2e2e  , interval %s ..
-00017bf0: 2e22 2c20 7061 6972 2c20 7469 6d65 6672  .", pair, timefr
-00017c00: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00017c10: 2072 6574 7572 6e20 7061 6972 2c20 7469   return pair, ti
-00017c20: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-00017c30: 7479 7065 2c20 6461 7461 2c20 7365 6c66  type, data, self
-00017c40: 2e5f 6f68 6c63 765f 7061 7274 6961 6c5f  ._ohlcv_partial_
-00017c50: 6361 6e64 6c65 0a0a 2020 2020 2020 2020  candle..        
-00017c60: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
-00017c70: 7570 706f 7274 6564 2061 7320 653a 0a20  upported as e:. 
-00017c80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00017c90: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00017ca0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-00017cb0: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
-00017cc0: 6520 7b73 656c 662e 5f61 7069 2e6e 616d  e {self._api.nam
-00017cd0: 657d 2064 6f65 7320 6e6f 7420 7375 7070  e} does not supp
-00017ce0: 6f72 7420 6665 7463 6869 6e67 2068 6973  ort fetching his
-00017cf0: 746f 7269 6361 6c20 270a 2020 2020 2020  torical '.      
-00017d00: 2020 2020 2020 2020 2020 6627 6361 6e64            f'cand
-00017d10: 6c65 2028 4f48 4c43 5629 2064 6174 612e  le (OHLCV) data.
-00017d20: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-00017d30: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00017d40: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-00017d50: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-00017d60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00017d70: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-00017d80: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-00017d90: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-00017da0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-00017db0: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-00017dc0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00017dd0: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-00017de0: 6172 7945 7272 6f72 2866 2743 6f75 6c64  aryError(f'Could
-00017df0: 206e 6f74 2066 6574 6368 2068 6973 746f   not fetch histo
-00017e00: 7269 6361 6c20 6361 6e64 6c65 2028 4f48  rical candle (OH
-00017e10: 4c43 5629 2064 6174 6120 270a 2020 2020  LCV) data '.    
-00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e30: 2020 2020 2020 2020 2020 2020 2066 2766               f'f
-00017e40: 6f72 2070 6169 7220 7b70 6169 727d 2064  or pair {pair} d
-00017e50: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-00017e60: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 270a  __.__name__}. '.
-00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e90: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
-00017ea0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00017eb0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-00017ec0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-00017ed0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00017ee0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00017ef0: 696f 6e28 6627 436f 756c 6420 6e6f 7420  ion(f'Could not 
-00017f00: 6665 7463 6820 6869 7374 6f72 6963 616c  fetch historical
-00017f10: 2063 616e 646c 6520 284f 484c 4356 2920   candle (OHLCV) 
-00017f20: 6461 7461 2027 0a20 2020 2020 2020 2020  data '.         
-00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f40: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00017f50: 666f 7220 7061 6972 207b 7061 6972 7d2e  for pair {pair}.
-00017f60: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-00017f70: 6672 6f6d 2065 0a0a 2020 2020 6173 796e  from e..    asyn
-00017f80: 6320 6465 6620 5f66 6574 6368 5f66 756e  c def _fetch_fun
-00017f90: 6469 6e67 5f72 6174 655f 6869 7374 6f72  ding_rate_histor
-00017fa0: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
-00017fb0: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
-00017fc0: 7472 2c0a 2020 2020 2020 2020 7469 6d65  tr,.        time
-00017fd0: 6672 616d 653a 2073 7472 2c0a 2020 2020  frame: str,.    
-00017fe0: 2020 2020 6c69 6d69 743a 2069 6e74 2c0a      limit: int,.
-00017ff0: 2020 2020 2020 2020 7369 6e63 655f 6d73          since_ms
-00018000: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-00018010: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-00018020: 204c 6973 745b 4c69 7374 5d3a 0a20 2020   List[List]:.   
-00018030: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00018040: 2046 6574 6368 2066 756e 6469 6e67 2072   Fetch funding r
-00018050: 6174 6520 6869 7374 6f72 7920 2d20 7573  ate history - us
-00018060: 6564 2074 6f20 7365 6c65 6374 6976 656c  ed to selectivel
-00018070: 7920 6f76 6572 7269 6465 2074 6869 7320  y override this 
-00018080: 6279 2073 7562 636c 6173 7365 732e 0a20  by subclasses.. 
-00018090: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000180a0: 2020 2023 2046 756e 6469 6e67 2072 6174     # Funding rat
-000180b0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
-000180c0: 2061 7761 6974 2073 656c 662e 5f61 7069   await self._api
-000180d0: 5f61 7379 6e63 2e66 6574 6368 5f66 756e  _async.fetch_fun
-000180e0: 6469 6e67 5f72 6174 655f 6869 7374 6f72  ding_rate_histor
-000180f0: 7928 0a20 2020 2020 2020 2020 2020 2070  y(.            p
-00018100: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
-00018110: 5f6d 732c 0a20 2020 2020 2020 2020 2020  _ms,.           
-00018120: 206c 696d 6974 3d6c 696d 6974 290a 2020   limit=limit).  
-00018130: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-00018140: 6675 6e64 696e 6720 7261 7465 2074 6f20  funding rate to 
-00018150: 6361 6e64 6c65 2070 6174 7465 726e 0a20  candle pattern. 
-00018160: 2020 2020 2020 2064 6174 6120 3d20 5b5b         data = [[
-00018170: 785b 2774 696d 6573 7461 6d70 275d 2c20  x['timestamp'], 
-00018180: 785b 2766 756e 6469 6e67 5261 7465 275d  x['fundingRate']
-00018190: 2c20 302c 2030 2c20 302c 2030 5d20 666f  , 0, 0, 0, 0] fo
-000181a0: 7220 7820 696e 2064 6174 615d 0a20 2020  r x in data].   
-000181b0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
-000181c0: 0a0a 2020 2020 2320 4665 7463 6820 6869  ..    # Fetch hi
-000181d0: 7374 6f72 6963 2074 7261 6465 730a 0a20  storic trades.. 
-000181e0: 2020 2040 7265 7472 6965 725f 6173 796e     @retrier_asyn
-000181f0: 630a 2020 2020 6173 796e 6320 6465 6620  c.    async def 
-00018200: 5f61 7379 6e63 5f66 6574 6368 5f74 7261  _async_fetch_tra
-00018210: 6465 7328 7365 6c66 2c20 7061 6972 3a20  des(self, pair: 
-00018220: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
-00018230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018240: 2020 2020 2020 2073 696e 6365 3a20 4f70         since: Op
-00018250: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
-00018260: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018280: 2020 2020 2020 7061 7261 6d73 3a20 4f70        params: Op
-00018290: 7469 6f6e 616c 5b64 6963 745d 203d 204e  tional[dict] = N
-000182a0: 6f6e 6529 202d 3e20 4c69 7374 5b4c 6973  one) -> List[Lis
-000182b0: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
-000182c0: 2020 2020 2020 2020 4173 796e 6372 6f6e          Asyncron
-000182d0: 6f75 736c 7920 6765 7473 2074 7261 6465  ously gets trade
-000182e0: 2068 6973 746f 7279 2075 7369 6e67 2066   history using f
-000182f0: 6574 6368 5f74 7261 6465 732e 0a20 2020  etch_trades..   
-00018300: 2020 2020 2048 616e 646c 6573 2065 7863       Handles exc
-00018310: 6861 6e67 6520 6572 726f 7273 2c20 646f  hange errors, do
-00018320: 6573 206f 6e65 2063 616c 6c20 746f 2074  es one call to t
-00018330: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
-00018340: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-00018350: 3a20 5061 6972 2074 6f20 6665 7463 6820  : Pair to fetch 
-00018360: 7472 6164 6520 6461 7461 2066 6f72 0a20  trade data for. 
-00018370: 2020 2020 2020 203a 7061 7261 6d20 7369         :param si
-00018380: 6e63 653a 2053 696e 6365 2061 7320 696e  nce: Since as in
-00018390: 7465 6765 7220 7469 6d65 7374 616d 7020  teger timestamp 
-000183a0: 696e 206d 696c 6c69 7365 636f 6e64 730a  in milliseconds.
-000183b0: 2020 2020 2020 2020 7265 7475 726e 733a          returns:
-000183c0: 204c 6973 7420 6f66 2064 6963 7473 2063   List of dicts c
-000183d0: 6f6e 7461 696e 696e 6720 7472 6164 6573  ontaining trades
-000183e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000183f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00018400: 2020 2020 2020 2320 6665 7463 6820 7472        # fetch tr
-00018410: 6164 6573 2061 7379 6e63 6872 6f6e 6f75  ades asynchronou
-00018420: 736c 790a 2020 2020 2020 2020 2020 2020  sly.            
-00018430: 6966 2070 6172 616d 733a 0a20 2020 2020  if params:.     
-00018440: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00018450: 722e 6465 6275 6728 2246 6574 6368 696e  r.debug("Fetchin
-00018460: 6720 7472 6164 6573 2066 6f72 2070 6169  g trades for pai
-00018470: 7220 2573 2c20 7061 7261 6d73 3a20 2573  r %s, params: %s
-00018480: 2022 2c20 7061 6972 2c20 7061 7261 6d73   ", pair, params
-00018490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000184a0: 2020 7472 6164 6573 203d 2061 7761 6974    trades = await
-000184b0: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
-000184c0: 2e66 6574 6368 5f74 7261 6465 7328 7061  .fetch_trades(pa
-000184d0: 6972 2c20 7061 7261 6d73 3d70 6172 616d  ir, params=param
-000184e0: 732c 206c 696d 6974 3d31 3030 3029 0a20  s, limit=1000). 
-000184f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00018500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018510: 206c 6f67 6765 722e 6465 6275 6728 0a20   logger.debug(. 
+00016890: 6669 6c6c 5f6d 6973 7369 6e67 3d54 7275  fill_missing=Tru
+000168a0: 652c 2064 726f 705f 696e 636f 6d70 6c65  e, drop_incomple
+000168b0: 7465 3d46 616c 7365 290a 2020 2020 2020  te=False).      
+000168c0: 2020 2020 2020 2020 2020 6361 6e64 6c65            candle
+000168d0: 5f6c 696d 6974 203d 2073 656c 662e 6f68  _limit = self.oh
+000168e0: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
+000168f0: 2874 696d 6566 7261 6d65 2c20 7365 6c66  (timeframe, self
+00016900: 2e5f 636f 6e66 6967 5b27 6361 6e64 6c65  ._config['candle
+00016910: 5f74 7970 655f 6465 6627 5d29 0a20 2020  _type_def']).   
+00016920: 2020 2020 2020 2020 2020 2020 2023 2041               # A
+00016930: 6765 206f 7574 206f 6c64 2063 616e 646c  ge out old candl
+00016940: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00016950: 2020 206f 686c 6376 5f64 6620 3d20 6f68     ohlcv_df = oh
+00016960: 6c63 765f 6466 2e74 6169 6c28 6361 6e64  lcv_df.tail(cand
+00016970: 6c65 5f6c 696d 6974 202b 2073 656c 662e  le_limit + self.
+00016980: 5f73 7461 7274 7570 5f63 616e 646c 655f  _startup_candle_
+00016990: 636f 756e 7429 0a20 2020 2020 2020 2020  count).         
+000169a0: 2020 2020 2020 206f 686c 6376 5f64 6620         ohlcv_df 
+000169b0: 3d20 6f68 6c63 765f 6466 2e72 6573 6574  = ohlcv_df.reset
+000169c0: 5f69 6e64 6578 2864 726f 703d 5472 7565  _index(drop=True
+000169d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000169e0: 2020 7365 6c66 2e5f 6b6c 696e 6573 5b28    self._klines[(
+000169f0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+00016a00: 2063 5f74 7970 6529 5d20 3d20 6f68 6c63   c_type)] = ohlc
+00016a10: 765f 6466 0a20 2020 2020 2020 2020 2020  v_df.           
+00016a20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016a30: 2020 2020 2020 2073 656c 662e 5f6b 6c69         self._kli
+00016a40: 6e65 735b 2870 6169 722c 2074 696d 6566  nes[(pair, timef
+00016a50: 7261 6d65 2c20 635f 7479 7065 295d 203d  rame, c_type)] =
+00016a60: 206f 686c 6376 5f64 660a 2020 2020 2020   ohlcv_df.      
+00016a70: 2020 7265 7475 726e 206f 686c 6376 5f64    return ohlcv_d
+00016a80: 660a 0a20 2020 2064 6566 2072 6566 7265  f..    def refre
+00016a90: 7368 5f6c 6174 6573 745f 6f68 6c63 7628  sh_latest_ohlcv(
+00016aa0: 7365 6c66 2c20 7061 6972 5f6c 6973 743a  self, pair_list:
+00016ab0: 204c 6973 7450 6169 7273 5769 7468 5469   ListPairsWithTi
+00016ac0: 6d65 6672 616d 6573 2c20 2a2c 0a20 2020  meframes, *,.   
+00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ae0: 2020 2020 2020 2020 2020 7369 6e63 655f            since_
+00016af0: 6d73 3a20 4f70 7469 6f6e 616c 5b69 6e74  ms: Optional[int
+00016b00: 5d20 3d20 4e6f 6e65 2c20 6361 6368 653a  ] = None, cache:
+00016b10: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b30: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
+00016b40: 696e 636f 6d70 6c65 7465 3a20 4f70 7469  incomplete: Opti
+00016b50: 6f6e 616c 5b62 6f6f 6c5d 203d 204e 6f6e  onal[bool] = Non
+00016b60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00016b70: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00016b80: 202d 3e20 4469 6374 5b50 6169 7257 6974   -> Dict[PairWit
+00016b90: 6854 696d 6566 7261 6d65 2c20 4461 7461  hTimeframe, Data
+00016ba0: 4672 616d 655d 3a0a 2020 2020 2020 2020  Frame]:.        
+00016bb0: 2222 220a 2020 2020 2020 2020 5265 6672  """.        Refr
+00016bc0: 6573 6820 696e 2d6d 656d 6f72 7920 4f48  esh in-memory OH
+00016bd0: 4c43 5620 6173 796e 6368 726f 6e6f 7573  LCV asynchronous
+00016be0: 6c79 2061 6e64 2073 6574 2060 5f6b 6c69  ly and set `_kli
+00016bf0: 6e65 7360 2077 6974 6820 7468 6520 7265  nes` with the re
+00016c00: 7375 6c74 0a20 2020 2020 2020 204c 6f6f  sult.        Loo
+00016c10: 7073 2061 7379 6e63 6872 6f6e 6f75 736c  ps asynchronousl
+00016c20: 7920 6f76 6572 2070 6169 725f 6c69 7374  y over pair_list
+00016c30: 2061 6e64 2064 6f77 6e6c 6f61 6473 2061   and downloads a
+00016c40: 6c6c 2070 6169 7273 2061 7379 6e63 2028  ll pairs async (
+00016c50: 7365 6d69 2d70 6172 616c 6c65 6c29 2e0a  semi-parallel)..
+00016c60: 2020 2020 2020 2020 4f6e 6c79 2075 7365          Only use
+00016c70: 6420 696e 2074 6865 2064 6174 6170 726f  d in the datapro
+00016c80: 7669 6465 722e 7265 6672 6573 6828 2920  vider.refresh() 
+00016c90: 6d65 7468 6f64 2e0a 2020 2020 2020 2020  method..        
+00016ca0: 3a70 6172 616d 2070 6169 725f 6c69 7374  :param pair_list
+00016cb0: 3a20 4c69 7374 206f 6620 3220 656c 656d  : List of 2 elem
+00016cc0: 656e 7420 7475 706c 6573 2063 6f6e 7461  ent tuples conta
+00016cd0: 696e 696e 6720 7061 6972 2c20 696e 7465  ining pair, inte
+00016ce0: 7276 616c 2074 6f20 7265 6672 6573 680a  rval to refresh.
+00016cf0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00016d00: 696e 6365 5f6d 733a 2074 696d 6520 7369  ince_ms: time si
+00016d10: 6e63 6520 7768 656e 2074 6f20 646f 776e  nce when to down
+00016d20: 6c6f 6164 2c20 696e 206d 696c 6c69 7365  load, in millise
+00016d30: 636f 6e64 730a 2020 2020 2020 2020 3a70  conds.        :p
+00016d40: 6172 616d 2063 6163 6865 3a20 4173 7369  aram cache: Assi
+00016d50: 676e 2072 6573 756c 7420 746f 205f 6b6c  gn result to _kl
+00016d60: 696e 6573 2e20 5573 6566 756c 6c20 666f  ines. Usefull fo
+00016d70: 7220 6f6e 652d 6f66 6620 646f 776e 6c6f  r one-off downlo
+00016d80: 6164 7320 6c69 6b65 2066 6f72 2070 6169  ads like for pai
+00016d90: 726c 6973 7473 0a20 2020 2020 2020 203a  rlists.        :
+00016da0: 7061 7261 6d20 6472 6f70 5f69 6e63 6f6d  param drop_incom
+00016db0: 706c 6574 653a 2043 6f6e 7472 6f6c 2063  plete: Control c
+00016dc0: 616e 646c 6520 6472 6f70 7069 6e67 2e0a  andle dropping..
+00016dd0: 2020 2020 2020 2020 2020 2020 5370 6563              Spec
+00016de0: 6966 7969 6e67 204e 6f6e 6520 6465 6661  ifying None defa
+00016df0: 756c 7473 2074 6f20 5f6f 686c 6376 5f70  ults to _ohlcv_p
+00016e00: 6172 7469 616c 5f63 616e 646c 650a 2020  artial_candle.  
+00016e10: 2020 2020 2020 3a72 6574 7572 6e3a 2044        :return: D
+00016e20: 6963 7420 6f66 205b 7b28 7061 6972 2c20  ict of [{(pair, 
+00016e30: 7469 6d65 6672 616d 6529 3a20 4461 7461  timeframe): Data
+00016e40: 6672 616d 657d 5d0a 2020 2020 2020 2020  frame}].        
+00016e50: 2222 220a 2020 2020 2020 2020 6c6f 6767  """.        logg
+00016e60: 6572 2e64 6562 7567 2822 5265 6672 6573  er.debug("Refres
+00016e70: 6869 6e67 2063 616e 646c 6520 284f 484c  hing candle (OHL
+00016e80: 4356 2920 6461 7461 2066 6f72 2025 6420  CV) data for %d 
+00016e90: 7061 6972 7322 2c20 6c65 6e28 7061 6972  pairs", len(pair
+00016ea0: 5f6c 6973 7429 290a 0a20 2020 2020 2020  _list))..       
+00016eb0: 2023 2047 6174 6865 7220 636f 726f 7574   # Gather corout
+00016ec0: 696e 6573 2074 6f20 7275 6e0a 2020 2020  ines to run.    
+00016ed0: 2020 2020 696e 7075 745f 636f 726f 7574      input_corout
+00016ee0: 696e 6573 2c20 6361 6368 6564 5f70 6169  ines, cached_pai
+00016ef0: 7273 203d 2073 656c 662e 5f62 7569 6c64  rs = self._build
+00016f00: 5f6f 686c 6376 5f64 6c5f 6a6f 6273 2870  _ohlcv_dl_jobs(p
+00016f10: 6169 725f 6c69 7374 2c20 7369 6e63 655f  air_list, since_
+00016f20: 6d73 2c20 6361 6368 6529 0a0a 2020 2020  ms, cache)..    
+00016f30: 2020 2020 7265 7375 6c74 735f 6466 203d      results_df =
+00016f40: 207b 7d0a 2020 2020 2020 2020 2320 4368   {}.        # Ch
+00016f50: 756e 6b20 7265 7175 6573 7473 2069 6e74  unk requests int
+00016f60: 6f20 6261 7463 6865 7320 6f66 2031 3030  o batches of 100
+00016f70: 2074 6f20 6176 6f69 6420 6f76 6572 7765   to avoid overwe
+00016f80: 6c6d 696e 6720 6363 7874 2054 6872 6f74  lming ccxt Throt
+00016f90: 746c 696e 670a 2020 2020 2020 2020 666f  tling.        fo
+00016fa0: 7220 696e 7075 745f 636f 726f 2069 6e20  r input_coro in 
+00016fb0: 6368 756e 6b73 2869 6e70 7574 5f63 6f72  chunks(input_cor
+00016fc0: 6f75 7469 6e65 732c 2031 3030 293a 0a20  outines, 100):. 
+00016fd0: 2020 2020 2020 2020 2020 2061 7379 6e63             async
+00016fe0: 2064 6566 2067 6174 6865 725f 7374 7566   def gather_stuf
+00016ff0: 6628 293a 0a20 2020 2020 2020 2020 2020  f():.           
+00017000: 2020 2020 2072 6574 7572 6e20 6177 6169       return awai
+00017010: 7420 6173 796e 6369 6f2e 6761 7468 6572  t asyncio.gather
+00017020: 282a 696e 7075 745f 636f 726f 2c20 7265  (*input_coro, re
+00017030: 7475 726e 5f65 7863 6570 7469 6f6e 733d  turn_exceptions=
+00017040: 5472 7565 290a 0a20 2020 2020 2020 2020  True)..         
+00017050: 2020 2077 6974 6820 7365 6c66 2e5f 6c6f     with self._lo
+00017060: 6f70 5f6c 6f63 6b3a 0a20 2020 2020 2020  op_lock:.       
+00017070: 2020 2020 2020 2020 2072 6573 756c 7473           results
+00017080: 203d 2073 656c 662e 6c6f 6f70 2e72 756e   = self.loop.run
+00017090: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
+000170a0: 6761 7468 6572 5f73 7475 6666 2829 290a  gather_stuff()).
+000170b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000170c0: 2072 6573 2069 6e20 7265 7375 6c74 733a   res in results:
+000170d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000170e0: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
+000170f0: 6573 2c20 4578 6365 7074 696f 6e29 3a0a  es, Exception):.
+00017100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017110: 2020 2020 6c6f 6767 6572 2e77 6172 6e69      logger.warni
+00017120: 6e67 2866 2241 7379 6e63 2063 6f64 6520  ng(f"Async code 
+00017130: 7261 6973 6564 2061 6e20 6578 6365 7074  raised an except
+00017140: 696f 6e3a 207b 7265 7072 2872 6573 297d  ion: {repr(res)}
+00017150: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00017160: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017180: 2320 4465 636f 6e73 7472 7563 7420 7475  # Deconstruct tu
+00017190: 706c 6520 2868 6173 2035 2065 6c65 6d65  ple (has 5 eleme
+000171a0: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
+000171b0: 2020 2020 2070 6169 722c 2074 696d 6566       pair, timef
+000171c0: 7261 6d65 2c20 635f 7479 7065 2c20 7469  rame, c_type, ti
+000171d0: 636b 732c 2064 726f 705f 6869 6e74 203d  cks, drop_hint =
+000171e0: 2072 6573 0a20 2020 2020 2020 2020 2020   res.           
+000171f0: 2020 2020 2064 726f 705f 696e 636f 6d70       drop_incomp
+00017200: 6c65 7465 5f20 3d20 6472 6f70 5f68 696e  lete_ = drop_hin
+00017210: 7420 6966 2064 726f 705f 696e 636f 6d70  t if drop_incomp
+00017220: 6c65 7465 2069 7320 4e6f 6e65 2065 6c73  lete is None els
+00017230: 6520 6472 6f70 5f69 6e63 6f6d 706c 6574  e drop_incomplet
+00017240: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00017250: 2020 6f68 6c63 765f 6466 203d 2073 656c    ohlcv_df = sel
+00017260: 662e 5f70 726f 6365 7373 5f6f 686c 6376  f._process_ohlcv
+00017270: 5f64 6628 0a20 2020 2020 2020 2020 2020  _df(.           
+00017280: 2020 2020 2020 2020 2070 6169 722c 2074           pair, t
+00017290: 696d 6566 7261 6d65 2c20 635f 7479 7065  imeframe, c_type
+000172a0: 2c20 7469 636b 732c 2063 6163 6865 2c20  , ticks, cache, 
+000172b0: 6472 6f70 5f69 6e63 6f6d 706c 6574 655f  drop_incomplete_
+000172c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000172d0: 2020 2072 6573 756c 7473 5f64 665b 2870     results_df[(p
+000172e0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+000172f0: 635f 7479 7065 295d 203d 206f 686c 6376  c_type)] = ohlcv
+00017300: 5f64 660a 0a20 2020 2020 2020 2023 2052  _df..        # R
+00017310: 6574 7572 6e20 6361 6368 6564 206b 6c69  eturn cached kli
+00017320: 6e65 730a 2020 2020 2020 2020 666f 7220  nes.        for 
+00017330: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+00017340: 2063 5f74 7970 6520 696e 2063 6163 6865   c_type in cache
+00017350: 645f 7061 6972 733a 0a20 2020 2020 2020  d_pairs:.       
+00017360: 2020 2020 2072 6573 756c 7473 5f64 665b       results_df[
+00017370: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+00017380: 2c20 635f 7479 7065 295d 203d 2073 656c  , c_type)] = sel
+00017390: 662e 6b6c 696e 6573 280a 2020 2020 2020  f.klines(.      
+000173a0: 2020 2020 2020 2020 2020 2870 6169 722c            (pair,
+000173b0: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+000173c0: 7065 292c 0a20 2020 2020 2020 2020 2020  pe),.           
+000173d0: 2020 2020 2063 6f70 793d 4661 6c73 650a       copy=False.
+000173e0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000173f0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00017400: 7375 6c74 735f 6466 0a0a 2020 2020 6465  sults_df..    de
+00017410: 6620 5f6e 6f77 5f69 735f 7469 6d65 5f74  f _now_is_time_t
+00017420: 6f5f 7265 6672 6573 6828 7365 6c66 2c20  o_refresh(self, 
+00017430: 7061 6972 3a20 7374 722c 2074 696d 6566  pair: str, timef
+00017440: 7261 6d65 3a20 7374 722c 2063 616e 646c  rame: str, candl
+00017450: 655f 7479 7065 3a20 4361 6e64 6c65 5479  e_type: CandleTy
+00017460: 7065 2920 2d3e 2062 6f6f 6c3a 0a20 2020  pe) -> bool:.   
+00017470: 2020 2020 2023 2054 696d 6566 7261 6d65       # Timeframe
+00017480: 2069 6e20 7365 636f 6e64 730a 2020 2020   in seconds.    
+00017490: 2020 2020 696e 7465 7276 616c 5f69 6e5f      interval_in_
+000174a0: 7365 6320 3d20 7469 6d65 6672 616d 655f  sec = timeframe_
+000174b0: 746f 5f73 6563 6f6e 6473 2874 696d 6566  to_seconds(timef
+000174c0: 7261 6d65 290a 2020 2020 2020 2020 706c  rame).        pl
+000174d0: 7220 3d20 7365 6c66 2e5f 7061 6972 735f  r = self._pairs_
+000174e0: 6c61 7374 5f72 6566 7265 7368 5f74 696d  last_refresh_tim
+000174f0: 652e 6765 7428 2870 6169 722c 2074 696d  e.get((pair, tim
+00017500: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
+00017510: 7970 6529 2c20 3029 202b 2069 6e74 6572  ype), 0) + inter
+00017520: 7661 6c5f 696e 5f73 6563 0a20 2020 2020  val_in_sec.     
+00017530: 2020 2023 2063 7572 7265 6e74 2c61 6374     # current,act
+00017540: 6976 6520 6361 6e64 6c65 206f 7065 6e20  ive candle open 
+00017550: 6461 7465 0a20 2020 2020 2020 206e 6f77  date.        now
+00017560: 203d 2069 6e74 2874 696d 6566 7261 6d65   = int(timeframe
+00017570: 5f74 6f5f 7072 6576 5f64 6174 6528 7469  _to_prev_date(ti
+00017580: 6d65 6672 616d 6529 2e74 696d 6573 7461  meframe).timesta
+00017590: 6d70 2829 290a 2020 2020 2020 2020 7265  mp()).        re
+000175a0: 7475 726e 2070 6c72 203c 206e 6f77 0a0a  turn plr < now..
+000175b0: 2020 2020 4072 6574 7269 6572 5f61 7379      @retrier_asy
+000175c0: 6e63 0a20 2020 2061 7379 6e63 2064 6566  nc.    async def
+000175d0: 205f 6173 796e 635f 6765 745f 6361 6e64   _async_get_cand
+000175e0: 6c65 5f68 6973 746f 7279 280a 2020 2020  le_history(.    
+000175f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00017600: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
+00017610: 2020 2020 2074 696d 6566 7261 6d65 3a20       timeframe: 
+00017620: 7374 722c 0a20 2020 2020 2020 2063 616e  str,.        can
+00017630: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
+00017640: 5479 7065 2c0a 2020 2020 2020 2020 7369  Type,.        si
+00017650: 6e63 655f 6d73 3a20 4f70 7469 6f6e 616c  nce_ms: Optional
+00017660: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+00017670: 2020 2920 2d3e 204f 484c 4356 5265 7370    ) -> OHLCVResp
+00017680: 6f6e 7365 3a0a 2020 2020 2020 2020 2222  onse:.        ""
+00017690: 220a 2020 2020 2020 2020 4173 796e 6368  ".        Asynch
+000176a0: 726f 6e6f 7573 6c79 2067 6574 2063 616e  ronously get can
+000176b0: 646c 6520 6869 7374 6f72 7920 6461 7461  dle history data
+000176c0: 2075 7369 6e67 2066 6574 6368 5f6f 686c   using fetch_ohl
+000176d0: 6376 0a20 2020 2020 2020 203a 7061 7261  cv.        :para
+000176e0: 6d20 6361 6e64 6c65 5f74 7970 653a 2027  m candle_type: '
+000176f0: 272c 206d 6172 6b2c 2069 6e64 6578 2c20  ', mark, index, 
+00017700: 7072 656d 6975 6d49 6e64 6578 2c20 6f72  premiumIndex, or
+00017710: 2066 756e 6469 6e67 5f72 6174 650a 2020   funding_rate.  
+00017720: 2020 2020 2020 7265 7475 726e 7320 7475        returns tu
+00017730: 706c 653a 2028 7061 6972 2c20 7469 6d65  ple: (pair, time
+00017740: 6672 616d 652c 206f 686c 6376 5f6c 6973  frame, ohlcv_lis
+00017750: 7429 0a20 2020 2020 2020 2022 2222 0a20  t).        """. 
+00017760: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00017770: 2020 2020 2020 2020 2320 4665 7463 6820          # Fetch 
+00017780: 4f48 4c43 5620 6173 796e 6368 726f 6e6f  OHLCV asynchrono
+00017790: 7573 6c79 0a20 2020 2020 2020 2020 2020  usly.           
+000177a0: 2073 203d 2027 2827 202b 2064 745f 6672   s = '(' + dt_fr
+000177b0: 6f6d 5f74 7328 7369 6e63 655f 6d73 292e  om_ts(since_ms).
+000177c0: 6973 6f66 6f72 6d61 7428 2920 2b20 2729  isoformat() + ')
+000177d0: 2027 2069 6620 7369 6e63 655f 6d73 2069   ' if since_ms i
+000177e0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+000177f0: 2727 0a20 2020 2020 2020 2020 2020 206c  ''.            l
+00017800: 6f67 6765 722e 6465 6275 6728 0a20 2020  ogger.debug(.   
+00017810: 2020 2020 2020 2020 2020 2020 2022 4665               "Fe
+00017820: 7463 6869 6e67 2070 6169 7220 2573 2c20  tching pair %s, 
+00017830: 2573 2c20 696e 7465 7276 616c 2025 732c  %s, interval %s,
+00017840: 2073 696e 6365 2025 7320 2573 2e2e 2e22   since %s %s..."
+00017850: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017860: 2020 7061 6972 2c20 6361 6e64 6c65 5f74    pair, candle_t
+00017870: 7970 652c 2074 696d 6566 7261 6d65 2c20  ype, timeframe, 
+00017880: 7369 6e63 655f 6d73 2c20 730a 2020 2020  since_ms, s.    
+00017890: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000178a0: 2020 2020 2020 7061 7261 6d73 203d 2064        params = d
+000178b0: 6565 7063 6f70 7928 7365 6c66 2e5f 6674  eepcopy(self._ft
+000178c0: 5f68 6173 2e67 6574 2827 6f68 6c63 765f  _has.get('ohlcv_
+000178d0: 7061 7261 6d73 272c 207b 7d29 290a 2020  params', {})).  
+000178e0: 2020 2020 2020 2020 2020 6361 6e64 6c65            candle
+000178f0: 5f6c 696d 6974 203d 2073 656c 662e 6f68  _limit = self.oh
+00017900: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
+00017910: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017920: 2020 7469 6d65 6672 616d 652c 2063 616e    timeframe, can
+00017930: 646c 655f 7479 7065 3d63 616e 646c 655f  dle_type=candle_
+00017940: 7479 7065 2c20 7369 6e63 655f 6d73 3d73  type, since_ms=s
+00017950: 696e 6365 5f6d 7329 0a0a 2020 2020 2020  ince_ms)..      
+00017960: 2020 2020 2020 6966 2063 616e 646c 655f        if candle_
+00017970: 7479 7065 2061 6e64 2063 616e 646c 655f  type and candle_
+00017980: 7479 7065 2021 3d20 4361 6e64 6c65 5479  type != CandleTy
+00017990: 7065 2e53 504f 543a 0a20 2020 2020 2020  pe.SPOT:.       
+000179a0: 2020 2020 2020 2020 2070 6172 616d 732e           params.
+000179b0: 7570 6461 7465 287b 2770 7269 6365 273a  update({'price':
+000179c0: 2063 616e 646c 655f 7479 7065 2e76 616c   candle_type.val
+000179d0: 7565 7d29 0a20 2020 2020 2020 2020 2020  ue}).           
+000179e0: 2069 6620 6361 6e64 6c65 5f74 7970 6520   if candle_type 
+000179f0: 213d 2043 616e 646c 6554 7970 652e 4655  != CandleType.FU
+00017a00: 4e44 494e 475f 5241 5445 3a0a 2020 2020  NDING_RATE:.    
+00017a10: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00017a20: 203d 2061 7761 6974 2073 656c 662e 5f61   = await self._a
+00017a30: 7069 5f61 7379 6e63 2e66 6574 6368 5f6f  pi_async.fetch_o
+00017a40: 686c 6376 280a 2020 2020 2020 2020 2020  hlcv(.          
+00017a50: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+00017a60: 7469 6d65 6672 616d 653d 7469 6d65 6672  timeframe=timefr
+00017a70: 616d 652c 2073 696e 6365 3d73 696e 6365  ame, since=since
+00017a80: 5f6d 732c 0a20 2020 2020 2020 2020 2020  _ms,.           
+00017a90: 2020 2020 2020 2020 206c 696d 6974 3d63           limit=c
+00017aa0: 616e 646c 655f 6c69 6d69 742c 2070 6172  andle_limit, par
+00017ab0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00017ac0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00017ad0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00017ae0: 4675 6e64 696e 6720 7261 7465 0a20 2020  Funding rate.   
+00017af0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00017b00: 6120 3d20 6177 6169 7420 7365 6c66 2e5f  a = await self._
+00017b10: 6665 7463 685f 6675 6e64 696e 675f 7261  fetch_funding_ra
+00017b20: 7465 5f68 6973 746f 7279 280a 2020 2020  te_history(.    
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b40: 7061 6972 3d70 6169 722c 0a20 2020 2020  pair=pair,.     
+00017b50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00017b60: 696d 6566 7261 6d65 3d74 696d 6566 7261  imeframe=timefra
+00017b70: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00017b80: 2020 2020 2020 2020 6c69 6d69 743d 6361          limit=ca
+00017b90: 6e64 6c65 5f6c 696d 6974 2c0a 2020 2020  ndle_limit,.    
+00017ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017bb0: 7369 6e63 655f 6d73 3d73 696e 6365 5f6d  since_ms=since_m
+00017bc0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00017bd0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00017be0: 2023 2053 6f6d 6520 6578 6368 616e 6765   # Some exchange
+00017bf0: 7320 736f 7274 204f 484c 4356 2069 6e20  s sort OHLCV in 
+00017c00: 4153 4320 6f72 6465 7220 616e 6420 6f74  ASC order and ot
+00017c10: 6865 7273 2069 6e20 4445 5343 2e0a 2020  hers in DESC..  
+00017c20: 2020 2020 2020 2020 2020 2320 4578 3a20            # Ex: 
+00017c30: 4269 7474 7265 7820 7265 7475 726e 7320  Bittrex returns 
+00017c40: 7468 6520 6c69 7374 206f 6620 4f48 4c43  the list of OHLC
+00017c50: 5620 696e 2041 5343 206f 7264 6572 2028  V in ASC order (
+00017c60: 6f6c 6465 7374 2066 6972 7374 2c20 6e65  oldest first, ne
+00017c70: 7765 7374 206c 6173 7429 0a20 2020 2020  west last).     
+00017c80: 2020 2020 2020 2023 2077 6869 6c65 2047         # while G
+00017c90: 4441 5820 7265 7475 726e 7320 7468 6520  DAX returns the 
+00017ca0: 6c69 7374 206f 6620 4f48 4c43 5620 696e  list of OHLCV in
+00017cb0: 2044 4553 4320 6f72 6465 7220 286e 6577   DESC order (new
+00017cc0: 6573 7420 6669 7273 742c 206f 6c64 6573  est first, oldes
+00017cd0: 7420 6c61 7374 290a 2020 2020 2020 2020  t last).        
+00017ce0: 2020 2020 2320 4f6e 6c79 2073 6f72 7420      # Only sort 
+00017cf0: 6966 206e 6563 6573 7361 7279 2074 6f20  if necessary to 
+00017d00: 7361 7665 2063 6f6d 7075 7469 6e67 2074  save computing t
+00017d10: 696d 650a 2020 2020 2020 2020 2020 2020  ime.            
+00017d20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00017d30: 2020 2020 2069 6620 6461 7461 2061 6e64       if data and
+00017d40: 2064 6174 615b 305d 5b30 5d20 3e20 6461   data[0][0] > da
+00017d50: 7461 5b2d 315d 5b30 5d3a 0a20 2020 2020  ta[-1][0]:.     
+00017d60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00017d70: 6174 6120 3d20 736f 7274 6564 2864 6174  ata = sorted(dat
+00017d80: 612c 206b 6579 3d6c 616d 6264 6120 783a  a, key=lambda x:
+00017d90: 2078 5b30 5d29 0a20 2020 2020 2020 2020   x[0]).         
+00017da0: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
+00017db0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00017dc0: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
+00017dd0: 6570 7469 6f6e 2822 4572 726f 7220 6c6f  eption("Error lo
+00017de0: 6164 696e 6720 2573 2e20 5265 7375 6c74  ading %s. Result
+00017df0: 2077 6173 2025 732e 222c 2070 6169 722c   was %s.", pair,
+00017e00: 2064 6174 6129 0a20 2020 2020 2020 2020   data).         
+00017e10: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00017e20: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+00017e30: 616e 646c 655f 7479 7065 2c20 5b5d 2c20  andle_type, [], 
+00017e40: 7365 6c66 2e5f 6f68 6c63 765f 7061 7274  self._ohlcv_part
+00017e50: 6961 6c5f 6361 6e64 6c65 0a20 2020 2020  ial_candle.     
+00017e60: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00017e70: 6275 6728 2244 6f6e 6520 6665 7463 6869  bug("Done fetchi
+00017e80: 6e67 2070 6169 7220 2573 2c20 696e 7465  ng pair %s, inte
+00017e90: 7276 616c 2025 7320 2e2e 2e22 2c20 7061  rval %s ...", pa
+00017ea0: 6972 2c20 7469 6d65 6672 616d 6529 0a20  ir, timeframe). 
+00017eb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017ec0: 6e20 7061 6972 2c20 7469 6d65 6672 616d  n pair, timefram
+00017ed0: 652c 2063 616e 646c 655f 7479 7065 2c20  e, candle_type, 
+00017ee0: 6461 7461 2c20 7365 6c66 2e5f 6f68 6c63  data, self._ohlc
+00017ef0: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
+00017f00: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+00017f10: 2063 6378 742e 4e6f 7453 7570 706f 7274   ccxt.NotSupport
+00017f20: 6564 2061 7320 653a 0a20 2020 2020 2020  ed as e:.       
+00017f30: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00017f40: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00017f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017f60: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
+00017f70: 662e 5f61 7069 2e6e 616d 657d 2064 6f65  f._api.name} doe
+00017f80: 7320 6e6f 7420 7375 7070 6f72 7420 6665  s not support fe
+00017f90: 7463 6869 6e67 2068 6973 746f 7269 6361  tching historica
+00017fa0: 6c20 270a 2020 2020 2020 2020 2020 2020  l '.            
+00017fb0: 2020 2020 6627 6361 6e64 6c65 2028 4f48      f'candle (OH
+00017fc0: 4c43 5629 2064 6174 612e 204d 6573 7361  LCV) data. Messa
+00017fd0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00017fe0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00017ff0: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+00018000: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00018010: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+00018020: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+00018030: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00018040: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
+00018050: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
+00018060: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+00018070: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00018080: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+00018090: 6f72 2866 2743 6f75 6c64 206e 6f74 2066  or(f'Could not f
+000180a0: 6574 6368 2068 6973 746f 7269 6361 6c20  etch historical 
+000180b0: 6361 6e64 6c65 2028 4f48 4c43 5629 2064  candle (OHLCV) d
+000180c0: 6174 6120 270a 2020 2020 2020 2020 2020  ata '.          
+000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180e0: 2020 2020 2020 2066 2766 6f72 2070 6169         f'for pai
+000180f0: 7220 7b70 6169 727d 2064 7565 2074 6f20  r {pair} due to 
+00018100: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+00018110: 616d 655f 5f7d 2e20 270a 2020 2020 2020  ame__}. '.      
+00018120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018130: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
+00018140: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+00018150: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+00018160: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
+00018170: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00018180: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00018190: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
+000181a0: 436f 756c 6420 6e6f 7420 6665 7463 6820  Could not fetch 
+000181b0: 6869 7374 6f72 6963 616c 2063 616e 646c  historical candl
+000181c0: 6520 284f 484c 4356 2920 6461 7461 2027  e (OHLCV) data '
+000181d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2020 2020 2020 2020 6627 666f 7220 7061          f'for pa
+00018200: 6972 207b 7061 6972 7d2e 204d 6573 7361  ir {pair}. Messa
+00018210: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00018220: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
+00018230: 5f66 6574 6368 5f66 756e 6469 6e67 5f72  _fetch_funding_r
+00018240: 6174 655f 6869 7374 6f72 7928 0a20 2020  ate_history(.   
+00018250: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00018260: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
+00018270: 2020 2020 2020 7469 6d65 6672 616d 653a        timeframe:
+00018280: 2073 7472 2c0a 2020 2020 2020 2020 6c69   str,.        li
+00018290: 6d69 743a 2069 6e74 2c0a 2020 2020 2020  mit: int,.      
+000182a0: 2020 7369 6e63 655f 6d73 3a20 4f70 7469    since_ms: Opti
+000182b0: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+000182c0: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
+000182d0: 4c69 7374 5d3a 0a20 2020 2020 2020 2022  List]:.        "
+000182e0: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
+000182f0: 2066 756e 6469 6e67 2072 6174 6520 6869   funding rate hi
+00018300: 7374 6f72 7920 2d20 7573 6564 2074 6f20  story - used to 
+00018310: 7365 6c65 6374 6976 656c 7920 6f76 6572  selectively over
+00018320: 7269 6465 2074 6869 7320 6279 2073 7562  ride this by sub
+00018330: 636c 6173 7365 732e 0a20 2020 2020 2020  classes..       
+00018340: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
+00018350: 756e 6469 6e67 2072 6174 650a 2020 2020  unding rate.    
+00018360: 2020 2020 6461 7461 203d 2061 7761 6974      data = await
+00018370: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
+00018380: 2e66 6574 6368 5f66 756e 6469 6e67 5f72  .fetch_funding_r
+00018390: 6174 655f 6869 7374 6f72 7928 0a20 2020  ate_history(.   
+000183a0: 2020 2020 2020 2020 2070 6169 722c 2073           pair, s
+000183b0: 696e 6365 3d73 696e 6365 5f6d 732c 0a20  ince=since_ms,. 
+000183c0: 2020 2020 2020 2020 2020 206c 696d 6974             limit
+000183d0: 3d6c 696d 6974 290a 2020 2020 2020 2020  =limit).        
+000183e0: 2320 436f 6e76 6572 7420 6675 6e64 696e  # Convert fundin
+000183f0: 6720 7261 7465 2074 6f20 6361 6e64 6c65  g rate to candle
+00018400: 2070 6174 7465 726e 0a20 2020 2020 2020   pattern.       
+00018410: 2064 6174 6120 3d20 5b5b 785b 2774 696d   data = [[x['tim
+00018420: 6573 7461 6d70 275d 2c20 785b 2766 756e  estamp'], x['fun
+00018430: 6469 6e67 5261 7465 275d 2c20 302c 2030  dingRate'], 0, 0
+00018440: 2c20 302c 2030 5d20 666f 7220 7820 696e  , 0, 0] for x in
+00018450: 2064 6174 615d 0a20 2020 2020 2020 2072   data].        r
+00018460: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
+00018470: 2320 4665 7463 6820 6869 7374 6f72 6963  # Fetch historic
+00018480: 2074 7261 6465 730a 0a20 2020 2040 7265   trades..    @re
+00018490: 7472 6965 725f 6173 796e 630a 2020 2020  trier_async.    
+000184a0: 6173 796e 6320 6465 6620 5f61 7379 6e63  async def _async
+000184b0: 5f66 6574 6368 5f74 7261 6465 7328 7365  _fetch_trades(se
+000184c0: 6c66 2c20 7061 6972 3a20 7374 722c 0a20  lf, pair: str,. 
+000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184f0: 2073 696e 6365 3a20 4f70 7469 6f6e 616c   since: Optional
+00018500: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+00018510: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018530: 2020 2022 4665 7463 6869 6e67 2074 7261     "Fetching tra
-00018540: 6465 7320 666f 7220 7061 6972 2025 732c  des for pair %s,
-00018550: 2073 696e 6365 2025 7320 2573 2e2e 2e22   since %s %s..."
-00018560: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00018570: 2020 2020 2020 7061 6972 2c20 7369 6e63        pair, sinc
-00018580: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00018590: 2020 2020 2020 2027 2827 202b 2064 745f         '(' + dt_
-000185a0: 6672 6f6d 5f74 7328 7369 6e63 6529 2e69  from_ts(since).i
-000185b0: 736f 666f 726d 6174 2829 202b 2027 2920  soformat() + ') 
-000185c0: 2720 6966 2073 696e 6365 2069 7320 6e6f  ' if since is no
-000185d0: 7420 4e6f 6e65 2065 6c73 6520 2727 0a20  t None else ''. 
-000185e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000185f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018600: 2074 7261 6465 7320 3d20 6177 6169 7420   trades = await 
-00018610: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
-00018620: 6665 7463 685f 7472 6164 6573 2870 6169  fetch_trades(pai
-00018630: 722c 2073 696e 6365 3d73 696e 6365 2c20  r, since=since, 
-00018640: 6c69 6d69 743d 3130 3030 290a 2020 2020  limit=1000).    
-00018650: 2020 2020 2020 2020 7472 6164 6573 203d          trades =
-00018660: 2073 656c 662e 5f74 7261 6465 735f 636f   self._trades_co
-00018670: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
-00018680: 7428 7472 6164 6573 290a 2020 2020 2020  t(trades).      
-00018690: 2020 2020 2020 7265 7475 726e 2074 7261        return tra
-000186a0: 6465 735f 6469 6374 5f74 6f5f 6c69 7374  des_dict_to_list
-000186b0: 2874 7261 6465 7329 0a20 2020 2020 2020  (trades).       
-000186c0: 2065 7863 6570 7420 6363 7874 2e4e 6f74   except ccxt.Not
-000186d0: 5375 7070 6f72 7465 6420 6173 2065 3a0a  Supported as e:.
-000186e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000186f0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-00018700: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-00018710: 2020 2020 2020 2020 6627 4578 6368 616e          f'Exchan
-00018720: 6765 207b 7365 6c66 2e5f 6170 692e 6e61  ge {self._api.na
-00018730: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
-00018740: 706f 7274 2066 6574 6368 696e 6720 6869  port fetching hi
-00018750: 7374 6f72 6963 616c 2074 7261 6465 2064  storical trade d
-00018760: 6174 612e 270a 2020 2020 2020 2020 2020  ata.'.          
-00018770: 2020 2020 2020 6627 4d65 7373 6167 653a        f'Message:
-00018780: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-00018790: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-000187a0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-000187b0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000187c0: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-000187d0: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-000187e0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-000187f0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-00018800: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-00018810: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-00018820: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00018830: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-00018840: 6627 436f 756c 6420 6e6f 7420 6c6f 6164  f'Could not load
-00018850: 2074 7261 6465 2068 6973 746f 7279 2064   trade history d
-00018860: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-00018870: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 270a  __.__name__}. '.
-00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188a0: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
-000188b0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-000188c0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-000188d0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-000188e0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-000188f0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00018900: 696f 6e28 6627 436f 756c 6420 6e6f 7420  ion(f'Could not 
-00018910: 6665 7463 6820 7472 6164 6520 6461 7461  fetch trade data
-00018920: 2e20 4d73 673a 207b 657d 2729 2066 726f  . Msg: {e}') fro
-00018930: 6d20 650a 0a20 2020 2061 7379 6e63 2064  m e..    async d
-00018940: 6566 205f 6173 796e 635f 6765 745f 7472  ef _async_get_tr
-00018950: 6164 655f 6869 7374 6f72 795f 6964 2873  ade_history_id(s
-00018960: 656c 662c 2070 6169 723a 2073 7472 2c0a  elf, pair: str,.
-00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2020 2020 2020 2020 2020 756e 7469 6c3a            until:
-000189a0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-000189b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189d0: 7369 6e63 653a 204f 7074 696f 6e61 6c5b  since: Optional[
-000189e0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a10: 2020 2020 2020 2066 726f 6d5f 6964 3a20         from_id: 
-00018a20: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00018a30: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b73  None) -> Tuple[s
-00018a40: 7472 2c20 4c69 7374 5b4c 6973 745d 5d3a  tr, List[List]]:
-00018a50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00018a60: 2020 2020 2041 7379 6e63 726f 6e6f 7573       Asyncronous
-00018a70: 6c79 2067 6574 7320 7472 6164 6520 6869  ly gets trade hi
-00018a80: 7374 6f72 7920 7573 696e 6720 6665 7463  story using fetc
-00018a90: 685f 7472 6164 6573 0a20 2020 2020 2020  h_trades.       
-00018aa0: 2075 7365 2074 6869 7320 7768 656e 2065   use this when e
-00018ab0: 7863 6861 6e67 6520 7573 6573 2069 642d  xchange uses id-
-00018ac0: 6261 7365 6420 6974 6572 6174 696f 6e20  based iteration 
-00018ad0: 2863 6865 636b 2060 7365 6c66 2e5f 7472  (check `self._tr
-00018ae0: 6164 6573 5f70 6167 696e 6174 696f 6e60  ades_pagination`
-00018af0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-00018b00: 2070 6169 723a 2050 6169 7220 746f 2066   pair: Pair to f
-00018b10: 6574 6368 2074 7261 6465 2064 6174 6120  etch trade data 
-00018b20: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
-00018b30: 616d 2073 696e 6365 3a20 5369 6e63 6520  am since: Since 
-00018b40: 6173 2069 6e74 6567 6572 2074 696d 6573  as integer times
-00018b50: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
-00018b60: 6f6e 6473 0a20 2020 2020 2020 203a 7061  onds.        :pa
-00018b70: 7261 6d20 756e 7469 6c3a 2055 6e74 696c  ram until: Until
-00018b80: 2061 7320 696e 7465 6765 7220 7469 6d65   as integer time
-00018b90: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-00018ba0: 636f 6e64 730a 2020 2020 2020 2020 3a70  conds.        :p
-00018bb0: 6172 616d 2066 726f 6d5f 6964 3a20 446f  aram from_id: Do
-00018bc0: 776e 6c6f 6164 2064 6174 6120 7374 6172  wnload data star
-00018bd0: 7469 6e67 2077 6974 6820 4944 2028 6966  ting with ID (if
-00018be0: 2069 6420 6973 206b 6e6f 776e 292e 2049   id is known). I
-00018bf0: 676e 6f72 6573 2022 7369 6e63 6522 2069  gnores "since" i
-00018c00: 6620 7365 742e 0a20 2020 2020 2020 2072  f set..        r
-00018c10: 6574 7572 6e73 2074 7570 6c65 3a20 2870  eturns tuple: (p
-00018c20: 6169 722c 2074 7261 6465 732d 6c69 7374  air, trades-list
-00018c30: 290a 2020 2020 2020 2020 2222 220a 0a20  ).        """.. 
-00018c40: 2020 2020 2020 2074 7261 6465 733a 204c         trades: L
-00018c50: 6973 745b 4c69 7374 5d20 3d20 5b5d 0a0a  ist[List] = []..
-00018c60: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
-00018c70: 726f 6d5f 6964 3a0a 2020 2020 2020 2020  rom_id:.        
-00018c80: 2020 2020 2320 4665 7463 6820 6669 7273      # Fetch firs
-00018c90: 7420 656c 656d 656e 7473 2075 7369 6e67  t elements using
-00018ca0: 2074 696d 6562 6173 6564 206d 6574 686f   timebased metho
-00018cb0: 6420 746f 2067 6574 2061 6e20 4944 2074  d to get an ID t
-00018cc0: 6f20 7061 6769 6e61 7465 206f 6e0a 2020  o paginate on.  
-00018cd0: 2020 2020 2020 2020 2020 2320 4465 7065            # Depe
-00018ce0: 6e64 696e 6720 6f6e 2074 6865 2045 7863  nding on the Exc
-00018cf0: 6861 6e67 652c 2074 6869 7320 6361 6e20  hange, this can 
-00018d00: 696e 7472 6f64 7563 6520 6120 6472 6966  introduce a drif
-00018d10: 7420 6174 2074 6865 2073 7461 7274 206f  t at the start o
-00018d20: 6620 7468 6520 696e 7465 7276 616c 0a20  f the interval. 
-00018d30: 2020 2020 2020 2020 2020 2023 206f 6620             # of 
-00018d40: 7570 2074 6f20 616e 2068 6f75 722e 0a20  up to an hour.. 
-00018d50: 2020 2020 2020 2020 2020 2023 2065 2e67             # e.g
-00018d60: 2e20 4269 6e61 6e63 6520 7265 7475 726e  . Binance return
-00018d70: 7320 7468 6520 226c 6173 7420 3130 3030  s the "last 1000
-00018d80: 2220 6361 6e64 6c65 7320 7769 7468 696e  " candles within
-00018d90: 2061 2031 6820 7469 6d65 2069 6e74 6572   a 1h time inter
-00018da0: 7661 6c0a 2020 2020 2020 2020 2020 2020  val.            
-00018db0: 2320 2d20 736f 2077 6520 7769 6c6c 206d  # - so we will m
-00018dc0: 6973 7320 7468 6520 6669 7273 7420 7472  iss the first tr
-00018dd0: 6164 6573 2e0a 2020 2020 2020 2020 2020  ades..          
-00018de0: 2020 7420 3d20 6177 6169 7420 7365 6c66    t = await self
-00018df0: 2e5f 6173 796e 635f 6665 7463 685f 7472  ._async_fetch_tr
-00018e00: 6164 6573 2870 6169 722c 2073 696e 6365  ades(pair, since
-00018e10: 3d73 696e 6365 290a 2020 2020 2020 2020  =since).        
-00018e20: 2020 2020 2320 4445 4641 554c 545f 5452      # DEFAULT_TR
-00018e30: 4144 4553 5f43 4f4c 554d 4e53 3a20 3020  ADES_COLUMNS: 0 
-00018e40: 2d3e 2074 696d 6573 7461 6d70 0a20 2020  -> timestamp.   
-00018e50: 2020 2020 2020 2020 2023 2044 4546 4155           # DEFAU
-00018e60: 4c54 5f54 5241 4445 535f 434f 4c55 4d4e  LT_TRADES_COLUMN
-00018e70: 533a 2031 202d 3e20 6964 0a20 2020 2020  S: 1 -> id.     
-00018e80: 2020 2020 2020 2066 726f 6d5f 6964 203d         from_id =
-00018e90: 2074 5b2d 315d 5b31 5d0a 2020 2020 2020   t[-1][1].      
-00018ea0: 2020 2020 2020 7472 6164 6573 2e65 7874        trades.ext
-00018eb0: 656e 6428 745b 3a2d 315d 290a 2020 2020  end(t[:-1]).    
-00018ec0: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
-00018ed0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-00018ee0: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
-00018ef0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
-00018f00: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f30: 2020 2020 7061 7261 6d73 3d7b 7365 6c66      params={self
-00018f40: 2e5f 7472 6164 6573 5f70 6167 696e 6174  ._trades_paginat
-00018f50: 696f 6e5f 6172 673a 2066 726f 6d5f 6964  ion_arg: from_id
-00018f60: 7d29 0a20 2020 2020 2020 2020 2020 2069  }).            i
-00018f70: 6620 743a 0a20 2020 2020 2020 2020 2020  f t:.           
-00018f80: 2020 2020 2023 2053 6b69 7020 6c61 7374       # Skip last
-00018f90: 2069 6420 7369 6e63 6520 6974 7320 7468   id since its th
-00018fa0: 6520 6b65 7920 666f 7220 7468 6520 6e65  e key for the ne
-00018fb0: 7874 2063 616c 6c0a 2020 2020 2020 2020  xt call.        
-00018fc0: 2020 2020 2020 2020 7472 6164 6573 2e65          trades.e
-00018fd0: 7874 656e 6428 745b 3a2d 315d 290a 2020  xtend(t[:-1]).  
-00018fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00018ff0: 2066 726f 6d5f 6964 203d 3d20 745b 2d31   from_id == t[-1
-00019000: 5d5b 315d 206f 7220 745b 2d31 5d5b 305d  ][1] or t[-1][0]
-00019010: 203e 2075 6e74 696c 3a0a 2020 2020 2020   > until:.      
-00019020: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00019030: 6767 6572 2e64 6562 7567 2866 2253 746f  gger.debug(f"Sto
-00019040: 7070 696e 6720 6265 6361 7573 6520 6672  pping because fr
-00019050: 6f6d 5f69 6420 6469 6420 6e6f 7420 6368  om_id did not ch
-00019060: 616e 6765 2e20 220a 2020 2020 2020 2020  ange. ".        
-00019070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019080: 2020 2020 2020 2020 2066 2252 6561 6368           f"Reach
-00019090: 6564 207b 745b 2d31 5d5b 305d 7d20 3e20  ed {t[-1][0]} > 
-000190a0: 7b75 6e74 696c 7d22 290a 2020 2020 2020  {until}").      
-000190b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000190c0: 5265 6163 6865 6420 7468 6520 656e 6420  Reached the end 
-000190d0: 6f66 2074 6865 2064 6566 696e 6564 2d64  of the defined-d
-000190e0: 6f77 6e6c 6f61 6420 7065 7269 6f64 202d  ownload period -
-000190f0: 2061 6464 206c 6173 7420 7472 6164 6520   add last trade 
-00019100: 6173 2077 656c 6c2e 0a20 2020 2020 2020  as well..       
-00019110: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-00019120: 6465 732e 6578 7465 6e64 2874 5b2d 313a  des.extend(t[-1:
-00019130: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00019140: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-00019150: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-00019160: 6f6d 5f69 6420 3d20 745b 2d31 5d5b 315d  om_id = t[-1][1]
-00019170: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00019180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00019190: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
-000191a0: 2020 7265 7475 726e 2028 7061 6972 2c20    return (pair, 
-000191b0: 7472 6164 6573 290a 0a20 2020 2061 7379  trades)..    asy
-000191c0: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
-000191d0: 745f 7472 6164 655f 6869 7374 6f72 795f  t_trade_history_
-000191e0: 7469 6d65 2873 656c 662c 2070 6169 723a  time(self, pair:
-000191f0: 2073 7472 2c20 756e 7469 6c3a 2069 6e74   str, until: int
-00019200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00019230: 6e63 653a 204f 7074 696f 6e61 6c5b 696e  nce: Optional[in
-00019240: 745d 203d 204e 6f6e 6529 202d 3e20 5475  t] = None) -> Tu
-00019250: 706c 655b 7374 722c 204c 6973 745b 4c69  ple[str, List[Li
-00019260: 7374 5d5d 3a0a 2020 2020 2020 2020 2222  st]]:.        ""
-00019270: 220a 2020 2020 2020 2020 4173 796e 6372  ".        Asyncr
-00019280: 6f6e 6f75 736c 7920 6765 7473 2074 7261  onously gets tra
-00019290: 6465 2068 6973 746f 7279 2075 7369 6e67  de history using
-000192a0: 2066 6574 6368 5f74 7261 6465 732c 0a20   fetch_trades,. 
-000192b0: 2020 2020 2020 2077 6865 6e20 7468 6520         when the 
-000192c0: 6578 6368 616e 6765 2075 7365 7320 7469  exchange uses ti
-000192d0: 6d65 2d62 6173 6564 2069 7465 7261 7469  me-based iterati
-000192e0: 6f6e 2028 6368 6563 6b20 6073 656c 662e  on (check `self.
-000192f0: 5f74 7261 6465 735f 7061 6769 6e61 7469  _trades_paginati
-00019300: 6f6e 6029 0a20 2020 2020 2020 203a 7061  on`).        :pa
-00019310: 7261 6d20 7061 6972 3a20 5061 6972 2074  ram pair: Pair t
-00019320: 6f20 6665 7463 6820 7472 6164 6520 6461  o fetch trade da
-00019330: 7461 2066 6f72 0a20 2020 2020 2020 203a  ta for.        :
-00019340: 7061 7261 6d20 7369 6e63 653a 2053 696e  param since: Sin
-00019350: 6365 2061 7320 696e 7465 6765 7220 7469  ce as integer ti
-00019360: 6d65 7374 616d 7020 696e 206d 696c 6c69  mestamp in milli
-00019370: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
-00019380: 3a70 6172 616d 2075 6e74 696c 3a20 556e  :param until: Un
-00019390: 7469 6c20 6173 2069 6e74 6567 6572 2074  til as integer t
-000193a0: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
-000193b0: 6973 6563 6f6e 6473 0a20 2020 2020 2020  iseconds.       
-000193c0: 2072 6574 7572 6e73 2074 7570 6c65 3a20   returns tuple: 
-000193d0: 2870 6169 722c 2074 7261 6465 732d 6c69  (pair, trades-li
-000193e0: 7374 290a 2020 2020 2020 2020 2222 220a  st).        """.
-000193f0: 0a20 2020 2020 2020 2074 7261 6465 733a  .        trades:
-00019400: 204c 6973 745b 4c69 7374 5d20 3d20 5b5d   List[List] = []
-00019410: 0a20 2020 2020 2020 2023 2044 4546 4155  .        # DEFAU
-00019420: 4c54 5f54 5241 4445 535f 434f 4c55 4d4e  LT_TRADES_COLUMN
-00019430: 533a 2030 202d 3e20 7469 6d65 7374 616d  S: 0 -> timestam
-00019440: 700a 2020 2020 2020 2020 2320 4445 4641  p.        # DEFA
-00019450: 554c 545f 5452 4144 4553 5f43 4f4c 554d  ULT_TRADES_COLUM
-00019460: 4e53 3a20 3120 2d3e 2069 640a 2020 2020  NS: 1 -> id.    
-00019470: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
-00019480: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
-00019490: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
-000194a0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
-000194b0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
-000194c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000194d0: 2074 3a0a 2020 2020 2020 2020 2020 2020   t:.            
-000194e0: 2020 2020 7369 6e63 6520 3d20 745b 2d31      since = t[-1
-000194f0: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
-00019500: 2020 2020 2074 7261 6465 732e 6578 7465       trades.exte
-00019510: 6e64 2874 290a 2020 2020 2020 2020 2020  nd(t).          
-00019520: 2020 2020 2020 2320 5265 6163 6865 6420        # Reached 
-00019530: 7468 6520 656e 6420 6f66 2074 6865 2064  the end of the d
-00019540: 6566 696e 6564 2d64 6f77 6e6c 6f61 6420  efined-download 
-00019550: 7065 7269 6f64 0a20 2020 2020 2020 2020  period.         
-00019560: 2020 2020 2020 2069 6620 756e 7469 6c20         if until 
-00019570: 616e 6420 745b 2d31 5d5b 305d 203e 2075  and t[-1][0] > u
-00019580: 6e74 696c 3a0a 2020 2020 2020 2020 2020  ntil:.          
-00019590: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-000195a0: 2e64 6562 7567 280a 2020 2020 2020 2020  .debug(.        
-000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195c0: 6622 5374 6f70 7069 6e67 2062 6563 6175  f"Stopping becau
-000195d0: 7365 2075 6e74 696c 2077 6173 2072 6561  se until was rea
-000195e0: 6368 6564 2e20 7b74 5b2d 315d 5b30 5d7d  ched. {t[-1][0]}
-000195f0: 203e 207b 756e 7469 6c7d 2229 0a20 2020   > {until}").   
-00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019610: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00019620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00019630: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
-00019640: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00019650: 7061 6972 2c20 7472 6164 6573 290a 0a20  pair, trades).. 
-00019660: 2020 2061 7379 6e63 2064 6566 205f 6173     async def _as
-00019670: 796e 635f 6765 745f 7472 6164 655f 6869  ync_get_trade_hi
-00019680: 7374 6f72 7928 7365 6c66 2c20 7061 6972  story(self, pair
-00019690: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
-000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196b0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-000196c0: 6e63 653a 204f 7074 696f 6e61 6c5b 696e  nce: Optional[in
-000196d0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019700: 2020 756e 7469 6c3a 204f 7074 696f 6e61    until: Optiona
-00019710: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00019720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019740: 2020 2020 2020 6672 6f6d 5f69 643a 204f        from_id: O
-00019750: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-00019760: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
-00019770: 722c 204c 6973 745b 4c69 7374 5d5d 3a0a  r, List[List]]:.
-00019780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00019790: 2020 2020 4173 796e 6320 7772 6170 7065      Async wrappe
-000197a0: 7220 6861 6e64 6c69 6e67 2064 6f77 6e6c  r handling downl
-000197b0: 6f61 6469 6e67 2074 7261 6465 7320 7573  oading trades us
-000197c0: 696e 6720 6569 7468 6572 2074 696d 6520  ing either time 
-000197d0: 6f72 2069 6420 6261 7365 6420 6d65 7468  or id based meth
-000197e0: 6f64 732e 0a20 2020 2020 2020 2022 2222  ods..        """
-000197f0: 0a0a 2020 2020 2020 2020 6c6f 6767 6572  ..        logger
-00019800: 2e64 6562 7567 2866 225f 6173 796e 635f  .debug(f"_async_
-00019810: 6765 745f 7472 6164 655f 6869 7374 6f72  get_trade_histor
-00019820: 7928 292c 2070 6169 723a 207b 7061 6972  y(), pair: {pair
-00019830: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
-00019840: 2020 2020 2020 2020 2020 6622 7369 6e63            f"sinc
-00019850: 653a 207b 7369 6e63 657d 2c20 756e 7469  e: {since}, unti
-00019860: 6c3a 207b 756e 7469 6c7d 2c20 6672 6f6d  l: {until}, from
-00019870: 5f69 643a 207b 6672 6f6d 5f69 647d 2229  _id: {from_id}")
-00019880: 0a0a 2020 2020 2020 2020 6966 2075 6e74  ..        if unt
-00019890: 696c 2069 7320 4e6f 6e65 3a0a 2020 2020  il is None:.    
-000198a0: 2020 2020 2020 2020 756e 7469 6c20 3d20          until = 
-000198b0: 6363 7874 2e45 7863 6861 6e67 652e 6d69  ccxt.Exchange.mi
-000198c0: 6c6c 6973 6563 6f6e 6473 2829 0a20 2020  lliseconds().   
-000198d0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-000198e0: 6465 6275 6728 6622 4578 6368 616e 6765  debug(f"Exchange
-000198f0: 206d 696c 6c69 7365 636f 6e64 733a 207b   milliseconds: {
-00019900: 756e 7469 6c7d 2229 0a0a 2020 2020 2020  until}")..      
-00019910: 2020 6966 2073 656c 662e 5f74 7261 6465    if self._trade
-00019920: 735f 7061 6769 6e61 7469 6f6e 203d 3d20  s_pagination == 
-00019930: 2774 696d 6527 3a0a 2020 2020 2020 2020  'time':.        
-00019940: 2020 2020 7265 7475 726e 2061 7761 6974      return await
-00019950: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
-00019960: 5f74 7261 6465 5f68 6973 746f 7279 5f74  _trade_history_t
-00019970: 696d 6528 0a20 2020 2020 2020 2020 2020  ime(.           
-00019980: 2020 2020 2070 6169 723d 7061 6972 2c20       pair=pair, 
-00019990: 7369 6e63 653d 7369 6e63 652c 2075 6e74  since=since, unt
-000199a0: 696c 3d75 6e74 696c 290a 2020 2020 2020  il=until).      
-000199b0: 2020 656c 6966 2073 656c 662e 5f74 7261    elif self._tra
-000199c0: 6465 735f 7061 6769 6e61 7469 6f6e 203d  des_pagination =
-000199d0: 3d20 2769 6427 3a0a 2020 2020 2020 2020  = 'id':.        
-000199e0: 2020 2020 7265 7475 726e 2061 7761 6974      return await
-000199f0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
-00019a00: 5f74 7261 6465 5f68 6973 746f 7279 5f69  _trade_history_i
-00019a10: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-00019a20: 2020 2070 6169 723d 7061 6972 2c20 7369     pair=pair, si
-00019a30: 6e63 653d 7369 6e63 652c 2075 6e74 696c  nce=since, until
-00019a40: 3d75 6e74 696c 2c20 6672 6f6d 5f69 643d  =until, from_id=
-00019a50: 6672 6f6d 5f69 640a 2020 2020 2020 2020  from_id.        
-00019a60: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-00019a70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019a80: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-00019a90: 6c45 7863 6570 7469 6f6e 2866 2245 7863  lException(f"Exc
-00019aa0: 6861 6e67 6520 7b73 656c 662e 6e61 6d65  hange {self.name
-00019ab0: 7d20 646f 6573 2075 7365 206e 6569 7468  } does use neith
-00019ac0: 6572 2074 696d 652c 2022 0a20 2020 2020  er time, ".     
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018530: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
+00018540: 5b64 6963 745d 203d 204e 6f6e 6529 202d  [dict] = None) -
+00018550: 3e20 4c69 7374 5b4c 6973 745d 3a0a 2020  > List[List]:.  
+00018560: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018570: 2020 4173 796e 6372 6f6e 6f75 736c 7920    Asyncronously 
+00018580: 6765 7473 2074 7261 6465 2068 6973 746f  gets trade histo
+00018590: 7279 2075 7369 6e67 2066 6574 6368 5f74  ry using fetch_t
+000185a0: 7261 6465 732e 0a20 2020 2020 2020 2048  rades..        H
+000185b0: 616e 646c 6573 2065 7863 6861 6e67 6520  andles exchange 
+000185c0: 6572 726f 7273 2c20 646f 6573 206f 6e65  errors, does one
+000185d0: 2063 616c 6c20 746f 2074 6865 2065 7863   call to the exc
+000185e0: 6861 6e67 652e 0a20 2020 2020 2020 203a  hange..        :
+000185f0: 7061 7261 6d20 7061 6972 3a20 5061 6972  param pair: Pair
+00018600: 2074 6f20 6665 7463 6820 7472 6164 6520   to fetch trade 
+00018610: 6461 7461 2066 6f72 0a20 2020 2020 2020  data for.       
+00018620: 203a 7061 7261 6d20 7369 6e63 653a 2053   :param since: S
+00018630: 696e 6365 2061 7320 696e 7465 6765 7220  ince as integer 
+00018640: 7469 6d65 7374 616d 7020 696e 206d 696c  timestamp in mil
+00018650: 6c69 7365 636f 6e64 730a 2020 2020 2020  liseconds.      
+00018660: 2020 7265 7475 726e 733a 204c 6973 7420    returns: List 
+00018670: 6f66 2064 6963 7473 2063 6f6e 7461 696e  of dicts contain
+00018680: 696e 6720 7472 6164 6573 0a20 2020 2020  ing trades.     
+00018690: 2020 2022 2222 0a20 2020 2020 2020 2074     """.        t
+000186a0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000186b0: 2320 6665 7463 6820 7472 6164 6573 2061  # fetch trades a
+000186c0: 7379 6e63 6872 6f6e 6f75 736c 790a 2020  synchronously.  
+000186d0: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+000186e0: 616d 733a 0a20 2020 2020 2020 2020 2020  ams:.           
+000186f0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00018700: 6728 2246 6574 6368 696e 6720 7472 6164  g("Fetching trad
+00018710: 6573 2066 6f72 2070 6169 7220 2573 2c20  es for pair %s, 
+00018720: 7061 7261 6d73 3a20 2573 2022 2c20 7061  params: %s ", pa
+00018730: 6972 2c20 7061 7261 6d73 290a 2020 2020  ir, params).    
+00018740: 2020 2020 2020 2020 2020 2020 7472 6164              trad
+00018750: 6573 203d 2061 7761 6974 2073 656c 662e  es = await self.
+00018760: 5f61 7069 5f61 7379 6e63 2e66 6574 6368  _api_async.fetch
+00018770: 5f74 7261 6465 7328 7061 6972 2c20 7061  _trades(pair, pa
+00018780: 7261 6d73 3d70 6172 616d 732c 206c 696d  rams=params, lim
+00018790: 6974 3d31 3030 3029 0a20 2020 2020 2020  it=1000).       
+000187a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000187b0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+000187c0: 722e 6465 6275 6728 0a20 2020 2020 2020  r.debug(.       
+000187d0: 2020 2020 2020 2020 2020 2020 2022 4665               "Fe
+000187e0: 7463 6869 6e67 2074 7261 6465 7320 666f  tching trades fo
+000187f0: 7220 7061 6972 2025 732c 2073 696e 6365  r pair %s, since
+00018800: 2025 7320 2573 2e2e 2e22 2c0a 2020 2020   %s %s...",.    
+00018810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018820: 7061 6972 2c20 7369 6e63 652c 0a20 2020  pair, since,.   
+00018830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018840: 2027 2827 202b 2064 745f 6672 6f6d 5f74   '(' + dt_from_t
+00018850: 7328 7369 6e63 6529 2e69 736f 666f 726d  s(since).isoform
+00018860: 6174 2829 202b 2027 2920 2720 6966 2073  at() + ') ' if s
+00018870: 696e 6365 2069 7320 6e6f 7420 4e6f 6e65  ince is not None
+00018880: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
+00018890: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000188a0: 2020 2020 2020 2020 2020 2074 7261 6465             trade
+000188b0: 7320 3d20 6177 6169 7420 7365 6c66 2e5f  s = await self._
+000188c0: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
+000188d0: 7472 6164 6573 2870 6169 722c 2073 696e  trades(pair, sin
+000188e0: 6365 3d73 696e 6365 2c20 6c69 6d69 743d  ce=since, limit=
+000188f0: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
+00018900: 2020 7472 6164 6573 203d 2073 656c 662e    trades = self.
+00018910: 5f74 7261 6465 735f 636f 6e74 7261 6374  _trades_contract
+00018920: 735f 746f 5f61 6d6f 756e 7428 7472 6164  s_to_amount(trad
+00018930: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00018940: 7265 7475 726e 2074 7261 6465 735f 6469  return trades_di
+00018950: 6374 5f74 6f5f 6c69 7374 2874 7261 6465  ct_to_list(trade
+00018960: 7329 0a20 2020 2020 2020 2065 7863 6570  s).        excep
+00018970: 7420 6363 7874 2e4e 6f74 5375 7070 6f72  t ccxt.NotSuppor
+00018980: 7465 6420 6173 2065 3a0a 2020 2020 2020  ted as e:.      
+00018990: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+000189a0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+000189b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000189c0: 2020 6627 4578 6368 616e 6765 207b 7365    f'Exchange {se
+000189d0: 6c66 2e5f 6170 692e 6e61 6d65 7d20 646f  lf._api.name} do
+000189e0: 6573 206e 6f74 2073 7570 706f 7274 2066  es not support f
+000189f0: 6574 6368 696e 6720 6869 7374 6f72 6963  etching historic
+00018a00: 616c 2074 7261 6465 2064 6174 612e 270a  al trade data.'.
+00018a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a20: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
+00018a30: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+00018a40: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+00018a50: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+00018a60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00018a70: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+00018a80: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+00018a90: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+00018aa0: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+00018ab0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+00018ac0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+00018ad0: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+00018ae0: 7261 7279 4572 726f 7228 6627 436f 756c  raryError(f'Coul
+00018af0: 6420 6e6f 7420 6c6f 6164 2074 7261 6465  d not load trade
+00018b00: 2068 6973 746f 7279 2064 7565 2074 6f20   history due to 
+00018b10: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+00018b20: 616d 655f 5f7d 2e20 270a 2020 2020 2020  ame__}. '.      
+00018b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b40: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
+00018b50: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+00018b60: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+00018b70: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
+00018b80: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00018b90: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00018ba0: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
+00018bb0: 436f 756c 6420 6e6f 7420 6665 7463 6820  Could not fetch 
+00018bc0: 7472 6164 6520 6461 7461 2e20 4d73 673a  trade data. Msg:
+00018bd0: 207b 657d 2729 2066 726f 6d20 650a 0a20   {e}') from e.. 
+00018be0: 2020 2061 7379 6e63 2064 6566 205f 6173     async def _as
+00018bf0: 796e 635f 6765 745f 7472 6164 655f 6869  ync_get_trade_hi
+00018c00: 7374 6f72 795f 6964 2873 656c 662c 2070  story_id(self, p
+00018c10: 6169 723a 2073 7472 2c0a 2020 2020 2020  air: str,.      
+00018c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c40: 2020 2020 756e 7469 6c3a 2069 6e74 2c0a      until: int,.
+00018c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c70: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
+00018c80: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00018c90: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cc0: 2066 726f 6d5f 6964 3a20 4f70 7469 6f6e   from_id: Option
+00018cd0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2920  al[str] = None) 
+00018ce0: 2d3e 2054 7570 6c65 5b73 7472 2c20 4c69  -> Tuple[str, Li
+00018cf0: 7374 5b4c 6973 745d 5d3a 0a20 2020 2020  st[List]]:.     
+00018d00: 2020 2022 2222 0a20 2020 2020 2020 2041     """.        A
+00018d10: 7379 6e63 726f 6e6f 7573 6c79 2067 6574  syncronously get
+00018d20: 7320 7472 6164 6520 6869 7374 6f72 7920  s trade history 
+00018d30: 7573 696e 6720 6665 7463 685f 7472 6164  using fetch_trad
+00018d40: 6573 0a20 2020 2020 2020 2075 7365 2074  es.        use t
+00018d50: 6869 7320 7768 656e 2065 7863 6861 6e67  his when exchang
+00018d60: 6520 7573 6573 2069 642d 6261 7365 6420  e uses id-based 
+00018d70: 6974 6572 6174 696f 6e20 2863 6865 636b  iteration (check
+00018d80: 2060 7365 6c66 2e5f 7472 6164 6573 5f70   `self._trades_p
+00018d90: 6167 696e 6174 696f 6e60 290a 2020 2020  agination`).    
+00018da0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+00018db0: 2050 6169 7220 746f 2066 6574 6368 2074   Pair to fetch t
+00018dc0: 7261 6465 2064 6174 6120 666f 720a 2020  rade data for.  
+00018dd0: 2020 2020 2020 3a70 6172 616d 2073 696e        :param sin
+00018de0: 6365 3a20 5369 6e63 6520 6173 2069 6e74  ce: Since as int
+00018df0: 6567 6572 2074 696d 6573 7461 6d70 2069  eger timestamp i
+00018e00: 6e20 6d69 6c6c 6973 6563 6f6e 6473 0a20  n milliseconds. 
+00018e10: 2020 2020 2020 203a 7061 7261 6d20 756e         :param un
+00018e20: 7469 6c3a 2055 6e74 696c 2061 7320 696e  til: Until as in
+00018e30: 7465 6765 7220 7469 6d65 7374 616d 7020  teger timestamp 
+00018e40: 696e 206d 696c 6c69 7365 636f 6e64 730a  in milliseconds.
+00018e50: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+00018e60: 726f 6d5f 6964 3a20 446f 776e 6c6f 6164  rom_id: Download
+00018e70: 2064 6174 6120 7374 6172 7469 6e67 2077   data starting w
+00018e80: 6974 6820 4944 2028 6966 2069 6420 6973  ith ID (if id is
+00018e90: 206b 6e6f 776e 292e 2049 676e 6f72 6573   known). Ignores
+00018ea0: 2022 7369 6e63 6522 2069 6620 7365 742e   "since" if set.
+00018eb0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
+00018ec0: 2074 7570 6c65 3a20 2870 6169 722c 2074   tuple: (pair, t
+00018ed0: 7261 6465 732d 6c69 7374 290a 2020 2020  rades-list).    
+00018ee0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00018ef0: 2074 7261 6465 733a 204c 6973 745b 4c69   trades: List[Li
+00018f00: 7374 5d20 3d20 5b5d 0a0a 2020 2020 2020  st] = []..      
+00018f10: 2020 6966 206e 6f74 2066 726f 6d5f 6964    if not from_id
+00018f20: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00018f30: 4665 7463 6820 6669 7273 7420 656c 656d  Fetch first elem
+00018f40: 656e 7473 2075 7369 6e67 2074 696d 6562  ents using timeb
+00018f50: 6173 6564 206d 6574 686f 6420 746f 2067  ased method to g
+00018f60: 6574 2061 6e20 4944 2074 6f20 7061 6769  et an ID to pagi
+00018f70: 6e61 7465 206f 6e0a 2020 2020 2020 2020  nate on.        
+00018f80: 2020 2020 2320 4465 7065 6e64 696e 6720      # Depending 
+00018f90: 6f6e 2074 6865 2045 7863 6861 6e67 652c  on the Exchange,
+00018fa0: 2074 6869 7320 6361 6e20 696e 7472 6f64   this can introd
+00018fb0: 7563 6520 6120 6472 6966 7420 6174 2074  uce a drift at t
+00018fc0: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
+00018fd0: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
+00018fe0: 2020 2020 2023 206f 6620 7570 2074 6f20       # of up to 
+00018ff0: 616e 2068 6f75 722e 0a20 2020 2020 2020  an hour..       
+00019000: 2020 2020 2023 2065 2e67 2e20 4269 6e61       # e.g. Bina
+00019010: 6e63 6520 7265 7475 726e 7320 7468 6520  nce returns the 
+00019020: 226c 6173 7420 3130 3030 2220 6361 6e64  "last 1000" cand
+00019030: 6c65 7320 7769 7468 696e 2061 2031 6820  les within a 1h 
+00019040: 7469 6d65 2069 6e74 6572 7661 6c0a 2020  time interval.  
+00019050: 2020 2020 2020 2020 2020 2320 2d20 736f            # - so
+00019060: 2077 6520 7769 6c6c 206d 6973 7320 7468   we will miss th
+00019070: 6520 6669 7273 7420 7472 6164 6573 2e0a  e first trades..
+00019080: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+00019090: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
+000190a0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
+000190b0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
+000190c0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+000190d0: 4445 4641 554c 545f 5452 4144 4553 5f43  DEFAULT_TRADES_C
+000190e0: 4f4c 554d 4e53 3a20 3020 2d3e 2074 696d  OLUMNS: 0 -> tim
+000190f0: 6573 7461 6d70 0a20 2020 2020 2020 2020  estamp.         
+00019100: 2020 2023 2044 4546 4155 4c54 5f54 5241     # DEFAULT_TRA
+00019110: 4445 535f 434f 4c55 4d4e 533a 2031 202d  DES_COLUMNS: 1 -
+00019120: 3e20 6964 0a20 2020 2020 2020 2020 2020  > id.           
+00019130: 2066 726f 6d5f 6964 203d 2074 5b2d 315d   from_id = t[-1]
+00019140: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+00019150: 7472 6164 6573 2e65 7874 656e 6428 745b  trades.extend(t[
+00019160: 3a2d 315d 290a 2020 2020 2020 2020 7768  :-1]).        wh
+00019170: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
+00019180: 2020 2020 2020 7420 3d20 6177 6169 7420        t = await 
+00019190: 7365 6c66 2e5f 6173 796e 635f 6665 7463  self._async_fetc
+000191a0: 685f 7472 6164 6573 2870 6169 722c 0a20  h_trades(pair,. 
+000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000191e0: 7261 6d73 3d7b 7365 6c66 2e5f 7472 6164  rams={self._trad
+000191f0: 6573 5f70 6167 696e 6174 696f 6e5f 6172  es_pagination_ar
+00019200: 673a 2066 726f 6d5f 6964 7d29 0a20 2020  g: from_id}).   
+00019210: 2020 2020 2020 2020 2069 6620 743a 0a20           if t:. 
+00019220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00019230: 2053 6b69 7020 6c61 7374 2069 6420 7369   Skip last id si
+00019240: 6e63 6520 6974 7320 7468 6520 6b65 7920  nce its the key 
+00019250: 666f 7220 7468 6520 6e65 7874 2063 616c  for the next cal
+00019260: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
+00019270: 2020 7472 6164 6573 2e65 7874 656e 6428    trades.extend(
+00019280: 745b 3a2d 315d 290a 2020 2020 2020 2020  t[:-1]).        
+00019290: 2020 2020 2020 2020 6966 2066 726f 6d5f          if from_
+000192a0: 6964 203d 3d20 745b 2d31 5d5b 315d 206f  id == t[-1][1] o
+000192b0: 7220 745b 2d31 5d5b 305d 203e 2075 6e74  r t[-1][0] > unt
+000192c0: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
+000192d0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+000192e0: 6562 7567 2866 2253 746f 7070 696e 6720  ebug(f"Stopping 
+000192f0: 6265 6361 7573 6520 6672 6f6d 5f69 6420  because from_id 
+00019300: 6469 6420 6e6f 7420 6368 616e 6765 2e20  did not change. 
+00019310: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019330: 2020 2066 2252 6561 6368 6564 207b 745b     f"Reached {t[
+00019340: 2d31 5d5b 305d 7d20 3e20 7b75 6e74 696c  -1][0]} > {until
+00019350: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00019360: 2020 2020 2020 2020 2320 5265 6163 6865          # Reache
+00019370: 6420 7468 6520 656e 6420 6f66 2074 6865  d the end of the
+00019380: 2064 6566 696e 6564 2d64 6f77 6e6c 6f61   defined-downloa
+00019390: 6420 7065 7269 6f64 202d 2061 6464 206c  d period - add l
+000193a0: 6173 7420 7472 6164 6520 6173 2077 656c  ast trade as wel
+000193b0: 6c2e 0a20 2020 2020 2020 2020 2020 2020  l..             
+000193c0: 2020 2020 2020 2074 7261 6465 732e 6578         trades.ex
+000193d0: 7465 6e64 2874 5b2d 313a 5d29 0a20 2020  tend(t[-1:]).   
+000193e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193f0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+00019400: 2020 2020 2020 2020 6672 6f6d 5f69 6420          from_id 
+00019410: 3d20 745b 2d31 5d5b 315d 0a20 2020 2020  = t[-1][1].     
+00019420: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00019430: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00019440: 616b 0a0a 2020 2020 2020 2020 7265 7475  ak..        retu
+00019450: 726e 2028 7061 6972 2c20 7472 6164 6573  rn (pair, trades
+00019460: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
+00019470: 205f 6173 796e 635f 6765 745f 7472 6164   _async_get_trad
+00019480: 655f 6869 7374 6f72 795f 7469 6d65 2873  e_history_time(s
+00019490: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+000194a0: 756e 7469 6c3a 2069 6e74 2c0a 2020 2020  until: int,.    
+000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194d0: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
+000194e0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+000194f0: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
+00019500: 722c 204c 6973 745b 4c69 7374 5d5d 3a0a  r, List[List]]:.
+00019510: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00019520: 2020 2020 4173 796e 6372 6f6e 6f75 736c      Asyncronousl
+00019530: 7920 6765 7473 2074 7261 6465 2068 6973  y gets trade his
+00019540: 746f 7279 2075 7369 6e67 2066 6574 6368  tory using fetch
+00019550: 5f74 7261 6465 732c 0a20 2020 2020 2020  _trades,.       
+00019560: 2077 6865 6e20 7468 6520 6578 6368 616e   when the exchan
+00019570: 6765 2075 7365 7320 7469 6d65 2d62 6173  ge uses time-bas
+00019580: 6564 2069 7465 7261 7469 6f6e 2028 6368  ed iteration (ch
+00019590: 6563 6b20 6073 656c 662e 5f74 7261 6465  eck `self._trade
+000195a0: 735f 7061 6769 6e61 7469 6f6e 6029 0a20  s_pagination`). 
+000195b0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+000195c0: 6972 3a20 5061 6972 2074 6f20 6665 7463  ir: Pair to fetc
+000195d0: 6820 7472 6164 6520 6461 7461 2066 6f72  h trade data for
+000195e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000195f0: 7369 6e63 653a 2053 696e 6365 2061 7320  since: Since as 
+00019600: 696e 7465 6765 7220 7469 6d65 7374 616d  integer timestam
+00019610: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
+00019620: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+00019630: 2075 6e74 696c 3a20 556e 7469 6c20 6173   until: Until as
+00019640: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
+00019650: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
+00019660: 6473 0a20 2020 2020 2020 2072 6574 7572  ds.        retur
+00019670: 6e73 2074 7570 6c65 3a20 2870 6169 722c  ns tuple: (pair,
+00019680: 2074 7261 6465 732d 6c69 7374 290a 2020   trades-list).  
+00019690: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+000196a0: 2020 2074 7261 6465 733a 204c 6973 745b     trades: List[
+000196b0: 4c69 7374 5d20 3d20 5b5d 0a20 2020 2020  List] = [].     
+000196c0: 2020 2023 2044 4546 4155 4c54 5f54 5241     # DEFAULT_TRA
+000196d0: 4445 535f 434f 4c55 4d4e 533a 2030 202d  DES_COLUMNS: 0 -
+000196e0: 3e20 7469 6d65 7374 616d 700a 2020 2020  > timestamp.    
+000196f0: 2020 2020 2320 4445 4641 554c 545f 5452      # DEFAULT_TR
+00019700: 4144 4553 5f43 4f4c 554d 4e53 3a20 3120  ADES_COLUMNS: 1 
+00019710: 2d3e 2069 640a 2020 2020 2020 2020 7768  -> id.        wh
+00019720: 696c 6520 5472 7565 3a0a 2020 2020 2020  ile True:.      
+00019730: 2020 2020 2020 7420 3d20 6177 6169 7420        t = await 
+00019740: 7365 6c66 2e5f 6173 796e 635f 6665 7463  self._async_fetc
+00019750: 685f 7472 6164 6573 2870 6169 722c 2073  h_trades(pair, s
+00019760: 696e 6365 3d73 696e 6365 290a 2020 2020  ince=since).    
+00019770: 2020 2020 2020 2020 6966 2074 3a0a 2020          if t:.  
+00019780: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00019790: 6e63 6520 3d20 745b 2d31 5d5b 305d 0a20  nce = t[-1][0]. 
+000197a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000197b0: 7261 6465 732e 6578 7465 6e64 2874 290a  rades.extend(t).
+000197c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197d0: 2320 5265 6163 6865 6420 7468 6520 656e  # Reached the en
+000197e0: 6420 6f66 2074 6865 2064 6566 696e 6564  d of the defined
+000197f0: 2d64 6f77 6e6c 6f61 6420 7065 7269 6f64  -download period
+00019800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019810: 2069 6620 756e 7469 6c20 616e 6420 745b   if until and t[
+00019820: 2d31 5d5b 305d 203e 2075 6e74 696c 3a0a  -1][0] > until:.
+00019830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019840: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+00019850: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019860: 2020 2020 2020 2020 2020 6622 5374 6f70            f"Stop
+00019870: 7069 6e67 2062 6563 6175 7365 2075 6e74  ping because unt
+00019880: 696c 2077 6173 2072 6561 6368 6564 2e20  il was reached. 
+00019890: 7b74 5b2d 315d 5b30 5d7d 203e 207b 756e  {t[-1][0]} > {un
+000198a0: 7469 6c7d 2229 0a20 2020 2020 2020 2020  til}").         
+000198b0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000198c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000198d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000198e0: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+000198f0: 2020 7265 7475 726e 2028 7061 6972 2c20    return (pair, 
+00019900: 7472 6164 6573 290a 0a20 2020 2061 7379  trades)..    asy
+00019910: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
+00019920: 745f 7472 6164 655f 6869 7374 6f72 7928  t_trade_history(
+00019930: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+00019940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019960: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
+00019970: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+00019980: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00019990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199a0: 2020 2020 2020 2020 2020 2020 756e 7469              unti
+000199b0: 6c3a 204f 7074 696f 6e61 6c5b 696e 745d  l: Optional[int]
+000199c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000199d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000199f0: 6672 6f6d 5f69 643a 204f 7074 696f 6e61  from_id: Optiona
+00019a00: 6c5b 7374 725d 203d 204e 6f6e 6529 202d  l[str] = None) -
+00019a10: 3e20 5475 706c 655b 7374 722c 204c 6973  > Tuple[str, Lis
+00019a20: 745b 4c69 7374 5d5d 3a0a 2020 2020 2020  t[List]]:.      
+00019a30: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
+00019a40: 796e 6320 7772 6170 7065 7220 6861 6e64  ync wrapper hand
+00019a50: 6c69 6e67 2064 6f77 6e6c 6f61 6469 6e67  ling downloading
+00019a60: 2074 7261 6465 7320 7573 696e 6720 6569   trades using ei
+00019a70: 7468 6572 2074 696d 6520 6f72 2069 6420  ther time or id 
+00019a80: 6261 7365 6420 6d65 7468 6f64 732e 0a20  based methods.. 
+00019a90: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00019aa0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+00019ab0: 2866 225f 6173 796e 635f 6765 745f 7472  (f"_async_get_tr
+00019ac0: 6164 655f 6869 7374 6f72 7928 292c 2070  ade_history(), p
+00019ad0: 6169 723a 207b 7061 6972 7d2c 2022 0a20  air: {pair}, ". 
 00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019af0: 2020 6622 6e6f 7220 6964 2062 6173 6564    f"nor id based
-00019b00: 2070 6167 696e 6174 696f 6e22 290a 0a20   pagination").. 
-00019b10: 2020 2064 6566 2067 6574 5f68 6973 746f     def get_histo
-00019b20: 7269 635f 7472 6164 6573 2873 656c 662c  ric_trades(self,
-00019b30: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b50: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
-00019b60: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-00019b70: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00019b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b90: 2075 6e74 696c 3a20 4f70 7469 6f6e 616c   until: Optional
-00019ba0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00019bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bc0: 2020 2020 2020 2020 2020 6672 6f6d 5f69            from_i
-00019bd0: 643a 204f 7074 696f 6e61 6c5b 7374 725d  d: Optional[str]
-00019be0: 203d 204e 6f6e 6529 202d 3e20 5475 706c   = None) -> Tupl
-00019bf0: 655b 7374 722c 204c 6973 745d 3a0a 2020  e[str, List]:.  
-00019c00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00019c10: 2020 4765 7420 7472 6164 6520 6869 7374    Get trade hist
-00019c20: 6f72 7920 6461 7461 2075 7369 6e67 2061  ory data using a
-00019c30: 7379 6e63 696f 2e0a 2020 2020 2020 2020  syncio..        
-00019c40: 4861 6e64 6c65 7320 616c 6c20 6173 796e  Handles all asyn
-00019c50: 6320 776f 726b 2061 6e64 2072 6574 7572  c work and retur
-00019c60: 6e73 2074 6865 206c 6973 7420 6f66 2063  ns the list of c
-00019c70: 616e 646c 6573 2e0a 2020 2020 2020 2020  andles..        
-00019c80: 4173 796e 6320 6f76 6572 206f 6e65 2070  Async over one p
-00019c90: 6169 722c 2061 7373 756d 696e 6720 7765  air, assuming we
-00019ca0: 2067 6574 2060 7365 6c66 2e6f 686c 6376   get `self.ohlcv
-00019cb0: 5f63 616e 646c 655f 6c69 6d69 7428 2960  _candle_limit()`
-00019cc0: 2063 616e 646c 6573 2070 6572 2063 616c   candles per cal
-00019cd0: 6c2e 0a20 2020 2020 2020 203a 7061 7261  l..        :para
-00019ce0: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
-00019cf0: 646f 776e 6c6f 6164 0a20 2020 2020 2020  download.       
-00019d00: 203a 7061 7261 6d20 7369 6e63 653a 2054   :param since: T
-00019d10: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
-00019d20: 6973 6563 6f6e 6473 2074 6f20 6765 7420  iseconds to get 
-00019d30: 6869 7374 6f72 7920 6672 6f6d 0a20 2020  history from.   
-00019d40: 2020 2020 203a 7061 7261 6d20 756e 7469       :param unti
-00019d50: 6c3a 2054 696d 6573 7461 6d70 2069 6e20  l: Timestamp in 
-00019d60: 6d69 6c6c 6973 6563 6f6e 6473 2e20 4465  milliseconds. De
-00019d70: 6661 756c 7473 2074 6f20 6375 7272 656e  faults to curren
-00019d80: 7420 7469 6d65 7374 616d 7020 6966 206e  t timestamp if n
-00019d90: 6f74 2064 6566 696e 6564 2e0a 2020 2020  ot defined..    
-00019da0: 2020 2020 3a70 6172 616d 2066 726f 6d5f      :param from_
-00019db0: 6964 3a20 446f 776e 6c6f 6164 2064 6174  id: Download dat
-00019dc0: 6120 7374 6172 7469 6e67 2077 6974 6820  a starting with 
-00019dd0: 4944 2028 6966 2069 6420 6973 206b 6e6f  ID (if id is kno
-00019de0: 776e 290a 2020 2020 2020 2020 3a72 6574  wn).        :ret
-00019df0: 7572 6e73 204c 6973 7420 6f66 2074 7261  urns List of tra
-00019e00: 6465 2064 6174 610a 2020 2020 2020 2020  de data.        
-00019e10: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00019e20: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-00019e30: 5f68 6173 2822 6665 7463 6854 7261 6465  _has("fetchTrade
-00019e40: 7322 293a 0a20 2020 2020 2020 2020 2020  s"):.           
-00019e50: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00019e60: 616c 4578 6365 7074 696f 6e28 2254 6869  alException("Thi
-00019e70: 7320 6578 6368 616e 6765 2064 6f65 7320  s exchange does 
-00019e80: 6e6f 7420 7375 7070 6f72 7420 646f 776e  not support down
-00019e90: 6c6f 6164 696e 6720 5472 6164 6573 2e22  loading Trades."
-00019ea0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
-00019eb0: 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a  self._loop_lock:
-00019ec0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019ed0: 7572 6e20 7365 6c66 2e6c 6f6f 702e 7275  urn self.loop.ru
-00019ee0: 6e5f 756e 7469 6c5f 636f 6d70 6c65 7465  n_until_complete
-00019ef0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00019f00: 2020 7365 6c66 2e5f 6173 796e 635f 6765    self._async_ge
-00019f10: 745f 7472 6164 655f 6869 7374 6f72 7928  t_trade_history(
-00019f20: 7061 6972 3d70 6169 722c 2073 696e 6365  pair=pair, since
-00019f30: 3d73 696e 6365 2c0a 2020 2020 2020 2020  =since,.        
-00019f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f60: 2020 2020 2020 756e 7469 6c3d 756e 7469        until=unti
-00019f70: 6c2c 2066 726f 6d5f 6964 3d66 726f 6d5f  l, from_id=from_
-00019f80: 6964 2929 0a0a 2020 2020 4072 6574 7269  id))..    @retri
-00019f90: 6572 0a20 2020 2064 6566 205f 6765 745f  er.    def _get_
-00019fa0: 6675 6e64 696e 675f 6665 6573 5f66 726f  funding_fees_fro
-00019fb0: 6d5f 6578 6368 616e 6765 2873 656c 662c  m_exchange(self,
-00019fc0: 2070 6169 723a 2073 7472 2c20 7369 6e63   pair: str, sinc
-00019fd0: 653a 2055 6e69 6f6e 5b64 6174 6574 696d  e: Union[datetim
-00019fe0: 652c 2069 6e74 5d29 202d 3e20 666c 6f61  e, int]) -> floa
-00019ff0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0001a000: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
-0001a010: 6865 2073 756d 206f 6620 616c 6c20 6675  he sum of all fu
-0001a020: 6e64 696e 6720 6665 6573 2074 6861 7420  nding fees that 
-0001a030: 7765 7265 2065 7863 6861 6e67 6564 2066  were exchanged f
-0001a040: 6f72 2061 2070 6169 7220 7769 7468 696e  or a pair within
-0001a050: 2061 2074 696d 6566 7261 6d65 0a20 2020   a timeframe.   
-0001a060: 2020 2020 2044 7279 2d72 756e 2068 616e       Dry-run han
-0001a070: 646c 696e 6720 6861 7070 656e 7320 6173  dling happens as
-0001a080: 2070 6172 7420 6f66 205f 6361 6c63 756c   part of _calcul
-0001a090: 6174 655f 6675 6e64 696e 675f 6665 6573  ate_funding_fees
-0001a0a0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001a0b0: 2070 6169 723a 2028 652e 672e 2041 4441   pair: (e.g. ADA
-0001a0c0: 2f55 5344 5429 0a20 2020 2020 2020 203a  /USDT).        :
-0001a0d0: 7061 7261 6d20 7369 6e63 653a 2054 6865  param since: The
-0001a0e0: 2065 6172 6c69 6573 7420 7469 6d65 206f   earliest time o
-0001a0f0: 6620 636f 6e73 6964 6572 6174 696f 6e20  f consideration 
-0001a100: 666f 7220 6361 6c63 756c 6174 696e 6720  for calculating 
-0001a110: 6675 6e64 696e 6720 6665 6573 2c0a 2020  funding fees,.  
-0001a120: 2020 2020 2020 2020 2020 696e 2075 6e69            in uni
-0001a130: 7820 7469 6d65 206f 7220 6173 2061 2064  x time or as a d
-0001a140: 6174 6574 696d 650a 2020 2020 2020 2020  atetime.        
-0001a150: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-0001a160: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-0001a170: 5f68 6173 2822 6665 7463 6846 756e 6469  _has("fetchFundi
-0001a180: 6e67 4869 7374 6f72 7922 293a 0a20 2020  ngHistory"):.   
-0001a190: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0001a1a0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0001a1b0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001a1c0: 2020 2020 2066 2266 6574 6368 5f66 756e       f"fetch_fun
-0001a1d0: 6469 6e67 5f68 6973 746f 7279 2829 2069  ding_history() i
-0001a1e0: 7320 6e6f 7420 6176 6169 6c61 626c 6520  s not available 
-0001a1f0: 7573 696e 6720 7b73 656c 662e 6e61 6d65  using {self.name
-0001a200: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
-0001a210: 0a0a 2020 2020 2020 2020 6966 2074 7970  ..        if typ
-0001a220: 6528 7369 6e63 6529 2069 7320 6461 7465  e(since) is date
-0001a230: 7469 6d65 3a0a 2020 2020 2020 2020 2020  time:.          
-0001a240: 2020 7369 6e63 6520 3d20 696e 7428 7369    since = int(si
-0001a250: 6e63 652e 7469 6d65 7374 616d 7028 2929  nce.timestamp())
-0001a260: 202a 2031 3030 3020 2020 2320 2a20 3130   * 1000   # * 10
-0001a270: 3030 2066 6f72 206d 730a 0a20 2020 2020  00 for ms..     
-0001a280: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001a290: 2020 2020 6675 6e64 696e 675f 6869 7374      funding_hist
-0001a2a0: 6f72 7920 3d20 7365 6c66 2e5f 6170 692e  ory = self._api.
-0001a2b0: 6665 7463 685f 6675 6e64 696e 675f 6869  fetch_funding_hi
-0001a2c0: 7374 6f72 7928 0a20 2020 2020 2020 2020  story(.         
-0001a2d0: 2020 2020 2020 2073 796d 626f 6c3d 7061         symbol=pa
-0001a2e0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
-0001a2f0: 2020 2020 7369 6e63 653d 7369 6e63 650a      since=since.
-0001a300: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001a310: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001a320: 2073 756d 2866 6565 5b27 616d 6f75 6e74   sum(fee['amount
-0001a330: 275d 2066 6f72 2066 6565 2069 6e20 6675  '] for fee in fu
-0001a340: 6e64 696e 675f 6869 7374 6f72 7929 0a20  nding_history). 
-0001a350: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0001a360: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-0001a370: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0001a380: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-0001a390: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-0001a3a0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-0001a3b0: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-0001a3c0: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-0001a3d0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-0001a3e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001a3f0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-0001a400: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001a410: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
-0001a420: 7420 6675 6e64 696e 6720 6665 6573 2064  t funding fees d
-0001a430: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0001a440: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0001a450: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0001a460: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0001a470: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-0001a480: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0001a490: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0001a4a0: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-0001a4b0: 2920 6672 6f6d 2065 0a0a 2020 2020 4072  ) from e..    @r
-0001a4c0: 6574 7269 6572 0a20 2020 2064 6566 2067  etrier.    def g
-0001a4d0: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
-0001a4e0: 7328 7365 6c66 2920 2d3e 2044 6963 745b  s(self) -> Dict[
-0001a4f0: 7374 722c 204c 6973 745b 4469 6374 5d5d  str, List[Dict]]
-0001a500: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-0001a510: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a520: 6e20 7365 6c66 2e5f 6170 692e 6665 7463  n self._api.fetc
-0001a530: 685f 6c65 7665 7261 6765 5f74 6965 7273  h_leverage_tiers
-0001a540: 2829 0a20 2020 2020 2020 2065 7863 6570  ().        excep
-0001a550: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
-0001a560: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
-0001a570: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
-0001a580: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
-0001a590: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0001a5a0: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
-0001a5b0: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
-0001a5c0: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
-0001a5d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001a5e0: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
-0001a5f0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0001a600: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
-0001a610: 7420 6c6f 6164 206c 6576 6572 6167 6520  t load leverage 
-0001a620: 7469 6572 7320 6475 6520 746f 207b 652e  tiers due to {e.
-0001a630: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001a640: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
-0001a650: 7d27 0a20 2020 2020 2020 2020 2020 2029  }'.            )
-0001a660: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001a670: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
-0001a680: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0001a690: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-0001a6a0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-0001a6b0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
-0001a6c0: 2020 4072 6574 7269 6572 5f61 7379 6e63    @retrier_async
-0001a6d0: 0a20 2020 2061 7379 6e63 2064 6566 2067  .    async def g
-0001a6e0: 6574 5f6d 6172 6b65 745f 6c65 7665 7261  et_market_levera
-0001a6f0: 6765 5f74 6965 7273 2873 656c 662c 2073  ge_tiers(self, s
-0001a700: 796d 626f 6c3a 2073 7472 2920 2d3e 2054  ymbol: str) -> T
-0001a710: 7570 6c65 5b73 7472 2c20 4c69 7374 5b44  uple[str, List[D
-0001a720: 6963 745d 5d3a 0a20 2020 2020 2020 2022  ict]]:.        "
-0001a730: 2222 204c 6576 6572 6167 6520 7469 6572  "" Leverage tier
-0001a740: 7320 7065 7220 7379 6d62 6f6c 2022 2222  s per symbol """
-0001a750: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0001a760: 2020 2020 2020 2020 2020 7469 6572 203d            tier =
-0001a770: 2061 7761 6974 2073 656c 662e 5f61 7069   await self._api
-0001a780: 5f61 7379 6e63 2e66 6574 6368 5f6d 6172  _async.fetch_mar
-0001a790: 6b65 745f 6c65 7665 7261 6765 5f74 6965  ket_leverage_tie
-0001a7a0: 7273 2873 796d 626f 6c29 0a20 2020 2020  rs(symbol).     
-0001a7b0: 2020 2020 2020 2072 6574 7572 6e20 7379         return sy
-0001a7c0: 6d62 6f6c 2c20 7469 6572 0a20 2020 2020  mbol, tier.     
-0001a7d0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
-0001a7e0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
-0001a7f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001a800: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
-0001a810: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
-0001a820: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
-0001a830: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
-0001a840: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
-0001a850: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
-0001a860: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
-0001a870: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
-0001a880: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0001a890: 436f 756c 6420 6e6f 7420 6c6f 6164 206c  Could not load l
-0001a8a0: 6576 6572 6167 6520 7469 6572 7320 666f  everage tiers fo
-0001a8b0: 7220 7b73 796d 626f 6c7d 270a 2020 2020  r {symbol}'.    
-0001a8c0: 2020 2020 2020 2020 2020 2020 6627 2064              f' d
-0001a8d0: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0001a8e0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0001a8f0: 7373 6167 653a 207b 657d 270a 2020 2020  ssage: {e}'.    
-0001a900: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
-0001a910: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001a920: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
-0001a930: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001a940: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-0001a950: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
-0001a960: 726f 6d20 650a 0a20 2020 2064 6566 206c  rom e..    def l
-0001a970: 6f61 645f 6c65 7665 7261 6765 5f74 6965  oad_leverage_tie
-0001a980: 7273 2873 656c 6629 202d 3e20 4469 6374  rs(self) -> Dict
-0001a990: 5b73 7472 2c20 4c69 7374 5b44 6963 745d  [str, List[Dict]
-0001a9a0: 5d3a 0a20 2020 2020 2020 2069 6620 7365  ]:.        if se
-0001a9b0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-0001a9c0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
-0001a9d0: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
-0001a9e0: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
-0001a9f0: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
-0001aa00: 6576 6572 6167 6554 6965 7273 2729 3a0a  everageTiers'):.
-0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa20: 2320 4665 7463 6820 616c 6c20 6c65 7665  # Fetch all leve
-0001aa30: 7261 6765 2074 6965 7273 2061 7420 6f6e  rage tiers at on
-0001aa40: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
-0001aa50: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-0001aa60: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
-0001aa70: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0001aa80: 656c 6966 2073 656c 662e 6578 6368 616e  elif self.exchan
-0001aa90: 6765 5f68 6173 2827 6665 7463 684d 6172  ge_has('fetchMar
-0001aaa0: 6b65 744c 6576 6572 6167 6554 6965 7273  ketLeverageTiers
-0001aab0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0001aac0: 2020 2020 2320 4d75 7374 2066 6574 6368      # Must fetch
-0001aad0: 2074 6865 206c 6576 6572 6167 6520 7469   the leverage ti
-0001aae0: 6572 7320 666f 7220 6561 6368 206d 6172  ers for each mar
-0001aaf0: 6b65 7420 7365 7061 7261 7465 6c79 0a20  ket separately. 
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001ab10: 202a 2054 6869 7320 6973 2073 6c6f 7728   * This is slow(
-0001ab20: 7e34 3573 2920 6f6e 204f 6b78 2c20 6d61  ~45s) on Okx, ma
-0001ab30: 6b65 7320 7e39 3020 6170 6920 6361 6c6c  kes ~90 api call
-0001ab40: 7320 746f 206c 6f61 6420 616c 6c20 6c69  s to load all li
-0001ab50: 6e65 6172 2073 7761 7020 6d61 726b 6574  near swap market
-0001ab60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-0001ab70: 2020 6d61 726b 6574 7320 3d20 7365 6c66    markets = self
-0001ab80: 2e6d 6172 6b65 7473 0a0a 2020 2020 2020  .markets..      
-0001ab90: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
-0001aba0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-0001abb0: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
-0001abc0: 2066 6f72 2073 796d 626f 6c2c 206d 6172   for symbol, mar
-0001abd0: 6b65 7420 696e 206d 6172 6b65 7473 2e69  ket in markets.i
-0001abe0: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
-0001abf0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
-0001ac00: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
-0001ac10: 7475 7265 286d 6172 6b65 7429 0a20 2020  ture(market).   
-0001ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac30: 2020 2020 2061 6e64 206d 6172 6b65 745b       and market[
-0001ac40: 2771 756f 7465 275d 203d 3d20 7365 6c66  'quote'] == self
-0001ac50: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
-0001ac60: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
-0001ac70: 2020 2020 2020 2020 2020 2020 5d0a 0a20              ].. 
-0001ac80: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001ac90: 6965 7273 3a20 4469 6374 5b73 7472 2c20  iers: Dict[str, 
-0001aca0: 4c69 7374 5b44 6963 745d 5d20 3d20 7b7d  List[Dict]] = {}
-0001acb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001acc0: 2020 7469 6572 735f 6361 6368 6564 203d    tiers_cached =
-0001acd0: 2073 656c 662e 6c6f 6164 5f63 6163 6865   self.load_cache
-0001ace0: 645f 6c65 7665 7261 6765 5f74 6965 7273  d_leverage_tiers
-0001acf0: 2873 656c 662e 5f63 6f6e 6669 675b 2773  (self._config['s
-0001ad00: 7461 6b65 5f63 7572 7265 6e63 7927 5d29  take_currency'])
-0001ad10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad20: 2069 6620 7469 6572 735f 6361 6368 6564   if tiers_cached
-0001ad30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001ad40: 2020 2020 2020 7469 6572 7320 3d20 7469        tiers = ti
-0001ad50: 6572 735f 6361 6368 6564 0a0a 2020 2020  ers_cached..    
-0001ad60: 2020 2020 2020 2020 2020 2020 636f 726f              coro
-0001ad70: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-0001ad80: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-0001ad90: 6574 5f6d 6172 6b65 745f 6c65 7665 7261  et_market_levera
-0001ada0: 6765 5f74 6965 7273 2873 796d 626f 6c29  ge_tiers(symbol)
-0001adb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001adc0: 2020 2020 2066 6f72 2073 796d 626f 6c20       for symbol 
-0001add0: 696e 2073 6f72 7465 6428 7379 6d62 6f6c  in sorted(symbol
-0001ade0: 7329 2069 6620 7379 6d62 6f6c 206e 6f74  s) if symbol not
-0001adf0: 2069 6e20 7469 6572 735d 0a0a 2020 2020   in tiers]..    
-0001ae00: 2020 2020 2020 2020 2020 2020 2320 4265              # Be
-0001ae10: 2076 6572 626f 7365 2068 6572 652c 2061   verbose here, a
-0001ae20: 7320 7468 6973 2064 656c 6179 7320 7374  s this delays st
-0001ae30: 6172 7475 7020 6279 207e 3120 6d69 6e75  artup by ~1 minu
-0001ae40: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
-0001ae50: 2020 2020 6966 2063 6f72 6f73 3a0a 2020      if coros:.  
-0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae70: 2020 6c6f 6767 6572 2e69 6e66 6f28 0a20    logger.info(. 
-0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 2020 2020 2020 2066 2249 6e69 7469 616c         f"Initial
-0001aea0: 697a 696e 6720 6c65 7665 7261 6765 5f74  izing leverage_t
-0001aeb0: 6965 7273 2066 6f72 207b 6c65 6e28 7379  iers for {len(sy
-0001aec0: 6d62 6f6c 7329 7d20 6d61 726b 6574 732e  mbols)} markets.
-0001aed0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001aee0: 2020 2020 2020 2020 2020 2022 5468 6973             "This
-0001aef0: 2077 696c 6c20 7461 6b65 2061 626f 7574   will take about
-0001af00: 2061 206d 696e 7574 652e 2229 0a20 2020   a minute.").   
-0001af10: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001af20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001af30: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-0001af40: 666f 2822 5573 696e 6720 6361 6368 6564  fo("Using cached
-0001af50: 206c 6576 6572 6167 655f 7469 6572 732e   leverage_tiers.
-0001af60: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0001af70: 2020 2020 6173 796e 6320 6465 6620 6761      async def ga
-0001af80: 7468 6572 5f72 6573 756c 7473 2869 6e70  ther_results(inp
-0001af90: 7574 5f63 6f72 6f29 3a0a 2020 2020 2020  ut_coro):.      
-0001afa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001afb0: 7475 726e 2061 7761 6974 2061 7379 6e63  turn await async
-0001afc0: 696f 2e67 6174 6865 7228 2a69 6e70 7574  io.gather(*input
-0001afd0: 5f63 6f72 6f2c 2072 6574 7572 6e5f 6578  _coro, return_ex
-0001afe0: 6365 7074 696f 6e73 3d54 7275 6529 0a0a  ceptions=True)..
-0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b000: 666f 7220 696e 7075 745f 636f 726f 2069  for input_coro i
-0001b010: 6e20 6368 756e 6b73 2863 6f72 6f73 2c20  n chunks(coros, 
-0001b020: 3130 3029 3a0a 0a20 2020 2020 2020 2020  100):..         
-0001b030: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0001b040: 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a  self._loop_lock:
-0001b050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b060: 2020 2020 2020 2020 2072 6573 756c 7473           results
-0001b070: 203d 2073 656c 662e 6c6f 6f70 2e72 756e   = self.loop.run
-0001b080: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
-0001b090: 6761 7468 6572 5f72 6573 756c 7473 2869  gather_results(i
-0001b0a0: 6e70 7574 5f63 6f72 6f29 290a 0a20 2020  nput_coro))..   
-0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0c0: 2066 6f72 2072 6573 2069 6e20 7265 7375   for res in resu
-0001b0d0: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
-0001b0e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b0f0: 6973 696e 7374 616e 6365 2872 6573 2c20  isinstance(res, 
-0001b100: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
-0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b120: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-0001b130: 6172 6e69 6e67 2866 224c 6576 6572 6167  arning(f"Leverag
-0001b140: 6520 7469 6572 2065 7863 6570 7469 6f6e  e tier exception
-0001b150: 3a20 7b72 6570 7228 7265 7329 7d22 290a  : {repr(res)}").
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001b180: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001b190: 2020 2020 2020 2020 2020 2020 2073 796d               sym
-0001b1a0: 626f 6c2c 2074 6965 7220 3d20 7265 730a  bol, tier = res.
-0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 2020 2020 2020 2020 7469 6572 735b 7379          tiers[sy
-0001b1d0: 6d62 6f6c 5d20 3d20 7469 6572 0a20 2020  mbol] = tier.   
-0001b1e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b1f0: 6c65 6e28 636f 726f 7329 203e 2030 3a0a  len(coros) > 0:.
-0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b210: 2020 2020 7365 6c66 2e63 6163 6865 5f6c      self.cache_l
-0001b220: 6576 6572 6167 655f 7469 6572 7328 7469  everage_tiers(ti
-0001b230: 6572 732c 2073 656c 662e 5f63 6f6e 6669  ers, self._confi
-0001b240: 675b 2773 7461 6b65 5f63 7572 7265 6e63  g['stake_currenc
-0001b250: 7927 5d29 0a20 2020 2020 2020 2020 2020  y']).           
-0001b260: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-0001b270: 2866 2244 6f6e 6520 696e 6974 6961 6c69  (f"Done initiali
-0001b280: 7a69 6e67 207b 6c65 6e28 7379 6d62 6f6c  zing {len(symbol
-0001b290: 7329 7d20 6d61 726b 6574 732e 2229 0a0a  s)} markets.")..
-0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2b0: 7265 7475 726e 2074 6965 7273 0a20 2020  return tiers.   
-0001b2c0: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
-0001b2d0: 2020 2020 6465 6620 6361 6368 655f 6c65      def cache_le
-0001b2e0: 7665 7261 6765 5f74 6965 7273 2873 656c  verage_tiers(sel
-0001b2f0: 662c 2074 6965 7273 3a20 4469 6374 5b73  f, tiers: Dict[s
-0001b300: 7472 2c20 4c69 7374 5b44 6963 745d 5d2c  tr, List[Dict]],
-0001b310: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
-0001b320: 2073 7472 2920 2d3e 204e 6f6e 653a 0a0a   str) -> None:..
-0001b330: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
-0001b340: 203d 2073 656c 662e 5f63 6f6e 6669 675b   = self._config[
-0001b350: 2764 6174 6164 6972 275d 202f 2022 6675  'datadir'] / "fu
-0001b360: 7475 7265 7322 202f 2066 226c 6576 6572  tures" / f"lever
-0001b370: 6167 655f 7469 6572 735f 7b73 7461 6b65  age_tiers_{stake
-0001b380: 5f63 7572 7265 6e63 797d 2e6a 736f 6e22  _currency}.json"
-0001b390: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001b3a0: 6669 6c65 6e61 6d65 2e70 6172 656e 742e  filename.parent.
-0001b3b0: 6973 5f64 6972 2829 3a0a 2020 2020 2020  is_dir():.      
-0001b3c0: 2020 2020 2020 6669 6c65 6e61 6d65 2e70        filename.p
-0001b3d0: 6172 656e 742e 6d6b 6469 7228 7061 7265  arent.mkdir(pare
-0001b3e0: 6e74 733d 5472 7565 290a 2020 2020 2020  nts=True).      
-0001b3f0: 2020 6461 7461 203d 207b 0a20 2020 2020    data = {.     
-0001b400: 2020 2020 2020 2022 7570 6461 7465 6422         "updated"
-0001b410: 3a20 6461 7465 7469 6d65 2e6e 6f77 2874  : datetime.now(t
-0001b420: 696d 657a 6f6e 652e 7574 6329 2c0a 2020  imezone.utc),.  
-0001b430: 2020 2020 2020 2020 2020 2264 6174 6122            "data"
-0001b440: 3a20 7469 6572 732c 0a20 2020 2020 2020  : tiers,.       
-0001b450: 207d 0a20 2020 2020 2020 2066 696c 655f   }.        file_
-0001b460: 6475 6d70 5f6a 736f 6e28 6669 6c65 6e61  dump_json(filena
-0001b470: 6d65 2c20 6461 7461 290a 0a20 2020 2064  me, data)..    d
-0001b480: 6566 206c 6f61 645f 6361 6368 6564 5f6c  ef load_cached_l
-0001b490: 6576 6572 6167 655f 7469 6572 7328 7365  everage_tiers(se
-0001b4a0: 6c66 2c20 7374 616b 655f 6375 7272 656e  lf, stake_curren
-0001b4b0: 6379 3a20 7374 7229 202d 3e20 4f70 7469  cy: str) -> Opti
-0001b4c0: 6f6e 616c 5b44 6963 745b 7374 722c 204c  onal[Dict[str, L
-0001b4d0: 6973 745b 4469 6374 5d5d 5d3a 0a20 2020  ist[Dict]]]:.   
-0001b4e0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
-0001b4f0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6461  self._config['da
-0001b500: 7461 6469 7227 5d20 2f20 2266 7574 7572  tadir'] / "futur
-0001b510: 6573 2220 2f20 6622 6c65 7665 7261 6765  es" / f"leverage
-0001b520: 5f74 6965 7273 5f7b 7374 616b 655f 6375  _tiers_{stake_cu
-0001b530: 7272 656e 6379 7d2e 6a73 6f6e 220a 2020  rrency}.json".  
-0001b540: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
-0001b550: 652e 6973 5f66 696c 6528 293a 0a20 2020  e.is_file():.   
-0001b560: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0001b570: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0001b580: 6572 7320 3d20 6669 6c65 5f6c 6f61 645f  ers = file_load_
-0001b590: 6a73 6f6e 2866 696c 656e 616d 6529 0a20  json(filename). 
-0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001b5b0: 7064 6174 6564 203d 2074 6965 7273 2e67  pdated = tiers.g
-0001b5c0: 6574 2827 7570 6461 7465 6427 290a 2020  et('updated').  
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b5e0: 2075 7064 6174 6564 3a0a 2020 2020 2020   updated:.      
-0001b5f0: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0001b600: 6461 7465 645f 6474 203d 2070 6172 7365  dated_dt = parse
-0001b610: 722e 7061 7273 6528 7570 6461 7465 6429  r.parse(updated)
-0001b620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b630: 2020 2020 2069 6620 7570 6461 7465 645f       if updated_
-0001b640: 6474 203c 2064 6174 6574 696d 652e 6e6f  dt < datetime.no
-0001b650: 7728 7469 6d65 7a6f 6e65 2e75 7463 2920  w(timezone.utc) 
-0001b660: 2d20 7469 6d65 6465 6c74 6128 7765 656b  - timedelta(week
-0001b670: 733d 3429 3a0a 2020 2020 2020 2020 2020  s=4):.          
-0001b680: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001b690: 6767 6572 2e69 6e66 6f28 2243 6163 6865  gger.info("Cache
-0001b6a0: 6420 6c65 7665 7261 6765 2074 6965 7273  d leverage tiers
-0001b6b0: 2061 7265 206f 7574 6461 7465 642e 2057   are outdated. W
-0001b6c0: 696c 6c20 7570 6461 7465 2e22 290a 2020  ill update.").  
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001b6f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001b700: 2020 7265 7475 726e 2074 6965 7273 5b27    return tiers['
-0001b710: 6461 7461 275d 0a20 2020 2020 2020 2020  data'].         
-0001b720: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001b730: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-0001b740: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
-0001b750: 7074 696f 6e28 2245 7272 6f72 206c 6f61  ption("Error loa
-0001b760: 6469 6e67 2063 6163 6865 6420 6c65 7665  ding cached leve
-0001b770: 7261 6765 2074 6965 7273 2e20 5265 6672  rage tiers. Refr
-0001b780: 6573 6869 6e67 2e22 290a 2020 2020 2020  eshing.").      
-0001b790: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-0001b7a0: 2020 2064 6566 2066 696c 6c5f 6c65 7665     def fill_leve
-0001b7b0: 7261 6765 5f74 6965 7273 2873 656c 6629  rage_tiers(self)
-0001b7c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0001b7d0: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
-0001b7e0: 7369 676e 7320 7072 6f70 6572 7479 205f  signs property _
-0001b7f0: 6c65 7665 7261 6765 5f74 6965 7273 2074  leverage_tiers t
-0001b800: 6f20 6120 6469 6374 696f 6e61 7279 206f  o a dictionary o
-0001b810: 6620 696e 666f 726d 6174 696f 6e20 6162  f information ab
-0001b820: 6f75 7420 7468 6520 6c65 7665 7261 6765  out the leverage
-0001b830: 0a20 2020 2020 2020 2061 6c6c 6f77 6564  .        allowed
-0001b840: 206f 6e20 6561 6368 2070 6169 720a 2020   on each pair.  
-0001b850: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001b860: 2020 6c65 7665 7261 6765 5f74 6965 7273    leverage_tiers
-0001b870: 203d 2073 656c 662e 6c6f 6164 5f6c 6576   = self.load_lev
-0001b880: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
-0001b890: 2020 2020 2020 666f 7220 7061 6972 2c20        for pair, 
-0001b8a0: 7469 6572 7320 696e 206c 6576 6572 6167  tiers in leverag
-0001b8b0: 655f 7469 6572 732e 6974 656d 7328 293a  e_tiers.items():
-0001b8c0: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
-0001b8d0: 725f 7469 6572 7320 3d20 5b5d 0a20 2020  r_tiers = [].   
-0001b8e0: 2020 2020 2020 2020 2066 6f72 2074 6965           for tie
-0001b8f0: 7220 696e 2074 6965 7273 3a0a 2020 2020  r in tiers:.    
-0001b900: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0001b910: 5f74 6965 7273 2e61 7070 656e 6428 7365  _tiers.append(se
-0001b920: 6c66 2e70 6172 7365 5f6c 6576 6572 6167  lf.parse_leverag
-0001b930: 655f 7469 6572 2874 6965 7229 290a 2020  e_tier(tier)).  
-0001b940: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0001b950: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
-0001b960: 6169 725d 203d 2070 6169 725f 7469 6572  air] = pair_tier
-0001b970: 730a 0a20 2020 2064 6566 2070 6172 7365  s..    def parse
-0001b980: 5f6c 6576 6572 6167 655f 7469 6572 2873  _leverage_tier(s
-0001b990: 656c 662c 2074 6965 7229 202d 3e20 4469  elf, tier) -> Di
-0001b9a0: 6374 3a0a 2020 2020 2020 2020 696e 666f  ct:.        info
-0001b9b0: 203d 2074 6965 722e 6765 7428 2769 6e66   = tier.get('inf
-0001b9c0: 6f27 2c20 7b7d 290a 2020 2020 2020 2020  o', {}).        
-0001b9d0: 7265 7475 726e 207b 0a20 2020 2020 2020  return {.       
-0001b9e0: 2020 2020 2027 6d69 6e4e 6f74 696f 6e61       'minNotiona
-0001b9f0: 6c27 3a20 7469 6572 5b27 6d69 6e4e 6f74  l': tier['minNot
-0001ba00: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
-0001ba10: 2020 2020 2027 6d61 784e 6f74 696f 6e61       'maxNotiona
-0001ba20: 6c27 3a20 7469 6572 5b27 6d61 784e 6f74  l': tier['maxNot
-0001ba30: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
-0001ba40: 2020 2020 2027 6d61 696e 7465 6e61 6e63       'maintenanc
-0001ba50: 654d 6172 6769 6e52 6174 6527 3a20 7469  eMarginRate': ti
-0001ba60: 6572 5b27 6d61 696e 7465 6e61 6e63 654d  er['maintenanceM
-0001ba70: 6172 6769 6e52 6174 6527 5d2c 0a20 2020  arginRate'],.   
-0001ba80: 2020 2020 2020 2020 2027 6d61 784c 6576           'maxLev
-0001ba90: 6572 6167 6527 3a20 7469 6572 5b27 6d61  erage': tier['ma
-0001baa0: 784c 6576 6572 6167 6527 5d2c 0a20 2020  xLeverage'],.   
-0001bab0: 2020 2020 2020 2020 2027 6d61 696e 7441           'maintA
-0001bac0: 6d74 273a 2066 6c6f 6174 2869 6e66 6f5b  mt': float(info[
-0001bad0: 2763 756d 275d 2920 6966 2027 6375 6d27  'cum']) if 'cum'
-0001bae0: 2069 6e20 696e 666f 2065 6c73 6520 4e6f   in info else No
-0001baf0: 6e65 2c0a 2020 2020 2020 2020 7d0a 0a20  ne,.        }.. 
-0001bb00: 2020 2064 6566 2067 6574 5f6d 6178 5f6c     def get_max_l
-0001bb10: 6576 6572 6167 6528 7365 6c66 2c20 7061  everage(self, pa
-0001bb20: 6972 3a20 7374 722c 2073 7461 6b65 5f61  ir: str, stake_a
-0001bb30: 6d6f 756e 743a 204f 7074 696f 6e61 6c5b  mount: Optional[
-0001bb40: 666c 6f61 745d 2920 2d3e 2066 6c6f 6174  float]) -> float
-0001bb50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001bb60: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
-0001bb70: 6520 6d61 7869 6d75 6d20 6c65 7665 7261  e maximum levera
-0001bb80: 6765 2074 6861 7420 6120 7061 6972 2063  ge that a pair c
-0001bb90: 616e 2062 6520 7472 6164 6564 2061 740a  an be traded at.
-0001bba0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0001bbb0: 6169 723a 2054 6865 2062 6173 652f 7175  air: The base/qu
-0001bbc0: 6f74 6520 6375 7272 656e 6379 2070 6169  ote currency pai
-0001bbd0: 7220 6265 696e 6720 7472 6164 6564 0a20  r being traded. 
-0001bbe0: 2020 2020 2020 203a 7374 616b 655f 616d         :stake_am
-0001bbf0: 6f75 6e74 3a20 5468 6520 746f 7461 6c20  ount: The total 
-0001bc00: 7661 6c75 6520 6f66 2074 6865 2074 7261  value of the tra
-0001bc10: 6465 7273 206d 6172 6769 6e5f 6d6f 6465  ders margin_mode
-0001bc20: 2069 6e20 7175 6f74 6520 6375 7272 656e   in quote curren
-0001bc30: 6379 0a20 2020 2020 2020 2022 2222 0a0a  cy.        """..
-0001bc40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001bc50: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
-0001bc60: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
-0001bc70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001bc80: 7475 726e 2031 2e30 0a0a 2020 2020 2020  turn 1.0..      
-0001bc90: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
-0001bca0: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
-0001bcb0: 674d 6f64 652e 4655 5455 5245 533a 0a0a  gMode.FUTURES:..
-0001bcc0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0001bcd0: 6563 6b73 2061 6e64 2065 6467 6520 6361  ecks and edge ca
-0001bce0: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
-0001bcf0: 6966 2073 7461 6b65 5f61 6d6f 756e 7420  if stake_amount 
-0001bd00: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001bd10: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0001bd20: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0001bd30: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001bd40: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
-0001bd50: 2e6e 616d 657d 2e67 6574 5f6d 6178 5f6c  .name}.get_max_l
-0001bd60: 6576 6572 6167 6520 7265 7175 6972 6573  everage requires
-0001bd70: 2061 7267 756d 656e 7420 7374 616b 655f   argument stake_
-0001bd80: 616d 6f75 6e74 270a 2020 2020 2020 2020  amount'.        
-0001bd90: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001bda0: 2020 2020 2020 2069 6620 7061 6972 206e         if pair n
-0001bdb0: 6f74 2069 6e20 7365 6c66 2e5f 6c65 7665  ot in self._leve
-0001bdc0: 7261 6765 5f74 6965 7273 3a0a 2020 2020  rage_tiers:.    
-0001bdd0: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
-0001bde0: 7962 6520 7261 6973 6520 6578 6365 7074  ybe raise except
-0001bdf0: 696f 6e20 6265 6361 7573 6520 6974 2063  ion because it c
-0001be00: 616e 2774 2062 6520 7472 6164 6564 206f  an't be traded o
-0001be10: 6e20 6675 7475 7265 733f 0a20 2020 2020  n futures?.     
-0001be20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001be30: 6e20 312e 300a 0a20 2020 2020 2020 2020  n 1.0..         
-0001be40: 2020 2070 6169 725f 7469 6572 7320 3d20     pair_tiers = 
-0001be50: 7365 6c66 2e5f 6c65 7665 7261 6765 5f74  self._leverage_t
-0001be60: 6965 7273 5b70 6169 725d 0a0a 2020 2020  iers[pair]..    
-0001be70: 2020 2020 2020 2020 6966 2073 7461 6b65          if stake
-0001be80: 5f61 6d6f 756e 7420 3d3d 2030 3a0a 2020  _amount == 0:.  
-0001be90: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001bea0: 7475 726e 2073 656c 662e 5f6c 6576 6572  turn self._lever
-0001beb0: 6167 655f 7469 6572 735b 7061 6972 5d5b  age_tiers[pair][
-0001bec0: 305d 5b27 6d61 784c 6576 6572 6167 6527  0]['maxLeverage'
-0001bed0: 5d20 2023 204d 6178 206c 6576 2066 6f72  ]  # Max lev for
-0001bee0: 206c 6f77 6573 7420 616d 6f75 6e74 0a0a   lowest amount..
-0001bef0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001bf00: 7469 6572 5f69 6e64 6578 2069 6e20 7261  tier_index in ra
-0001bf10: 6e67 6528 6c65 6e28 7061 6972 5f74 6965  nge(len(pair_tie
-0001bf20: 7273 2929 3a0a 0a20 2020 2020 2020 2020  rs)):..         
-0001bf30: 2020 2020 2020 2074 6965 7220 3d20 7061         tier = pa
-0001bf40: 6972 5f74 6965 7273 5b74 6965 725f 696e  ir_tiers[tier_in
-0001bf50: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
-0001bf60: 2020 2020 206c 6576 203d 2074 6965 725b       lev = tier[
-0001bf70: 276d 6178 4c65 7665 7261 6765 275d 0a0a  'maxLeverage']..
-0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf90: 6966 2074 6965 725f 696e 6465 7820 3c20  if tier_index < 
-0001bfa0: 6c65 6e28 7061 6972 5f74 6965 7273 2920  len(pair_tiers) 
-0001bfb0: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
-0001bfc0: 2020 2020 2020 2020 206e 6578 745f 7469           next_ti
-0001bfd0: 6572 203d 2070 6169 725f 7469 6572 735b  er = pair_tiers[
-0001bfe0: 7469 6572 5f69 6e64 6578 202b 2031 5d0a  tier_index + 1].
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 6e65 7874 5f66 6c6f 6f72 203d      next_floor =
-0001c010: 206e 6578 745f 7469 6572 5b27 6d69 6e4e   next_tier['minN
-0001c020: 6f74 696f 6e61 6c27 5d20 2f20 6e65 7874  otional'] / next
-0001c030: 5f74 6965 725b 276d 6178 4c65 7665 7261  _tier['maxLevera
-0001c040: 6765 275d 0a20 2020 2020 2020 2020 2020  ge'].           
-0001c050: 2020 2020 2020 2020 2069 6620 6e65 7874           if next
-0001c060: 5f66 6c6f 6f72 203e 2073 7461 6b65 5f61  _floor > stake_a
-0001c070: 6d6f 756e 743a 2020 2320 4e65 7874 2074  mount:  # Next t
-0001c080: 6965 7220 6d69 6e20 746f 6f20 6869 6768  ier min too high
-0001c090: 2066 6f72 2073 7461 6b65 2061 6d6f 756e   for stake amoun
-0001c0a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001c0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001c0c0: 206d 696e 2828 7469 6572 5b27 6d61 784e   min((tier['maxN
-0001c0d0: 6f74 696f 6e61 6c27 5d20 2f20 7374 616b  otional'] / stak
-0001c0e0: 655f 616d 6f75 6e74 292c 206c 6576 290a  e_amount), lev).
-0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c100: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
-0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c120: 2020 2320 5769 7468 2074 6865 2074 776f    # With the two
-0001c130: 206c 6576 6572 6167 6520 7469 6572 7320   leverage tiers 
-0001c140: 6265 6c6f 772c 0a20 2020 2020 2020 2020  below,.         
-0001c150: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001c160: 202d 2061 2073 7461 6b65 2061 6d6f 756e   - a stake amoun
-0001c170: 7420 6f66 2031 3530 2077 6f75 6c64 206d  t of 150 would m
-0001c180: 6561 6e20 6120 6d61 7820 6c65 7665 7261  ean a max levera
-0001c190: 6765 206f 6620 2831 3030 3030 202f 2031  ge of (10000 / 1
-0001c1a0: 3530 2920 3d20 3636 2e36 360a 2020 2020  50) = 66.66.    
-0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
-0001c1d0: 656c 6f77 2031 3333 2e33 3320 3d20 6d61  elow 133.33 = ma
-0001c1e0: 785f 6c65 7620 6f66 2037 350a 2020 2020  x_lev of 75.    
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
-0001c210: 6574 7765 656e 2031 3333 2e33 332d 3230  etween 133.33-20
-0001c220: 3020 3d20 6d61 785f 6c65 7620 6f66 2031  0 = max_lev of 1
-0001c230: 3030 3030 2f73 7461 6b65 203d 2035 302e  0000/stake = 50.
-0001c240: 3031 2d37 342e 3939 0a20 2020 2020 2020  01-74.99.       
-0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 2023 202d 2073 7461 6b65 7320 6672 6f6d   # - stakes from
-0001c270: 2032 3030 202b 2031 3030 3020 3d20 6d61   200 + 1000 = ma
-0001c280: 785f 6c65 7620 6f66 2035 300a 2020 2020  x_lev of 50.    
-0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2a0: 2020 2020 230a 2020 2020 2020 2020 2020      #.          
-0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001c2c0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001c2d0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001c2e0: 226d 696e 223a 2030 2c20 2020 2020 2023  "min": 0,      #
-0001c2f0: 2073 7461 6b65 203d 2030 2e30 0a20 2020   stake = 0.0.   
-0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c310: 2020 2020 2023 2020 2020 2022 6d61 7822       #     "max"
-0001c320: 3a20 3130 3030 302c 2020 2320 6d61 785f  : 10000,  # max_
-0001c330: 7374 616b 6540 3735 203d 2031 3030 3030  stake@75 = 10000
-0001c340: 2f37 3520 3d20 3133 332e 3333 3333 3333  /75 = 133.333333
-0001c350: 3333 3333 3333 3334 0a20 2020 2020 2020  33333334.       
-0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c370: 2023 2020 2020 2022 6c65 7622 3a20 3735   #     "lev": 75
-0001c380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001c390: 2020 2020 2020 2020 2020 2320 7d2c 0a20            # },. 
+00019af0: 2020 2020 6622 7369 6e63 653a 207b 7369      f"since: {si
+00019b00: 6e63 657d 2c20 756e 7469 6c3a 207b 756e  nce}, until: {un
+00019b10: 7469 6c7d 2c20 6672 6f6d 5f69 643a 207b  til}, from_id: {
+00019b20: 6672 6f6d 5f69 647d 2229 0a0a 2020 2020  from_id}")..    
+00019b30: 2020 2020 6966 2075 6e74 696c 2069 7320      if until is 
+00019b40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00019b50: 2020 756e 7469 6c20 3d20 6363 7874 2e45    until = ccxt.E
+00019b60: 7863 6861 6e67 652e 6d69 6c6c 6973 6563  xchange.millisec
+00019b70: 6f6e 6473 2829 0a20 2020 2020 2020 2020  onds().         
+00019b80: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00019b90: 6622 4578 6368 616e 6765 206d 696c 6c69  f"Exchange milli
+00019ba0: 7365 636f 6e64 733a 207b 756e 7469 6c7d  seconds: {until}
+00019bb0: 2229 0a0a 2020 2020 2020 2020 6966 2073  ")..        if s
+00019bc0: 656c 662e 5f74 7261 6465 735f 7061 6769  elf._trades_pagi
+00019bd0: 6e61 7469 6f6e 203d 3d20 2774 696d 6527  nation == 'time'
+00019be0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00019bf0: 7475 726e 2061 7761 6974 2073 656c 662e  turn await self.
+00019c00: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
+00019c10: 5f68 6973 746f 7279 5f74 696d 6528 0a20  _history_time(. 
+00019c20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019c30: 6169 723d 7061 6972 2c20 7369 6e63 653d  air=pair, since=
+00019c40: 7369 6e63 652c 2075 6e74 696c 3d75 6e74  since, until=unt
+00019c50: 696c 290a 2020 2020 2020 2020 656c 6966  il).        elif
+00019c60: 2073 656c 662e 5f74 7261 6465 735f 7061   self._trades_pa
+00019c70: 6769 6e61 7469 6f6e 203d 3d20 2769 6427  gination == 'id'
+00019c80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00019c90: 7475 726e 2061 7761 6974 2073 656c 662e  turn await self.
+00019ca0: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
+00019cb0: 5f68 6973 746f 7279 5f69 6428 0a20 2020  _history_id(.   
+00019cc0: 2020 2020 2020 2020 2020 2020 2070 6169               pai
+00019cd0: 723d 7061 6972 2c20 7369 6e63 653d 7369  r=pair, since=si
+00019ce0: 6e63 652c 2075 6e74 696c 3d75 6e74 696c  nce, until=until
+00019cf0: 2c20 6672 6f6d 5f69 643d 6672 6f6d 5f69  , from_id=from_i
+00019d00: 640a 2020 2020 2020 2020 2020 2020 290a  d.            ).
+00019d10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00019d20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00019d30: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00019d40: 7469 6f6e 2866 2245 7863 6861 6e67 6520  tion(f"Exchange 
+00019d50: 7b73 656c 662e 6e61 6d65 7d20 646f 6573  {self.name} does
+00019d60: 2075 7365 206e 6569 7468 6572 2074 696d   use neither tim
+00019d70: 652c 2022 0a20 2020 2020 2020 2020 2020  e, ".           
+00019d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d90: 2020 2020 2020 2020 2020 2020 6622 6e6f              f"no
+00019da0: 7220 6964 2062 6173 6564 2070 6167 696e  r id based pagin
+00019db0: 6174 696f 6e22 290a 0a20 2020 2064 6566  ation")..    def
+00019dc0: 2067 6574 5f68 6973 746f 7269 635f 7472   get_historic_tr
+00019dd0: 6164 6573 2873 656c 662c 2070 6169 723a  ades(self, pair:
+00019de0: 2073 7472 2c0a 2020 2020 2020 2020 2020   str,.          
+00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e00: 2020 7369 6e63 653a 204f 7074 696f 6e61    since: Optiona
+00019e10: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
+00019e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e30: 2020 2020 2020 2020 2020 2075 6e74 696c             until
+00019e40: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00019e50: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00019e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e70: 2020 2020 6672 6f6d 5f69 643a 204f 7074      from_id: Opt
+00019e80: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+00019e90: 6529 202d 3e20 5475 706c 655b 7374 722c  e) -> Tuple[str,
+00019ea0: 204c 6973 745d 3a0a 2020 2020 2020 2020   List]:.        
+00019eb0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+00019ec0: 7472 6164 6520 6869 7374 6f72 7920 6461  trade history da
+00019ed0: 7461 2075 7369 6e67 2061 7379 6e63 696f  ta using asyncio
+00019ee0: 2e0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
+00019ef0: 7320 616c 6c20 6173 796e 6320 776f 726b  s all async work
+00019f00: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
+00019f10: 206c 6973 7420 6f66 2063 616e 646c 6573   list of candles
+00019f20: 2e0a 2020 2020 2020 2020 4173 796e 6320  ..        Async 
+00019f30: 6f76 6572 206f 6e65 2070 6169 722c 2061  over one pair, a
+00019f40: 7373 756d 696e 6720 7765 2067 6574 2060  ssuming we get `
+00019f50: 7365 6c66 2e6f 686c 6376 5f63 616e 646c  self.ohlcv_candl
+00019f60: 655f 6c69 6d69 7428 2960 2063 616e 646c  e_limit()` candl
+00019f70: 6573 2070 6572 2063 616c 6c2e 0a20 2020  es per call..   
+00019f80: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
+00019f90: 3a20 5061 6972 2074 6f20 646f 776e 6c6f  : Pair to downlo
+00019fa0: 6164 0a20 2020 2020 2020 203a 7061 7261  ad.        :para
+00019fb0: 6d20 7369 6e63 653a 2054 696d 6573 7461  m since: Timesta
+00019fc0: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
+00019fd0: 6473 2074 6f20 6765 7420 6869 7374 6f72  ds to get histor
+00019fe0: 7920 6672 6f6d 0a20 2020 2020 2020 203a  y from.        :
+00019ff0: 7061 7261 6d20 756e 7469 6c3a 2054 696d  param until: Tim
+0001a000: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
+0001a010: 6563 6f6e 6473 2e20 4465 6661 756c 7473  econds. Defaults
+0001a020: 2074 6f20 6375 7272 656e 7420 7469 6d65   to current time
+0001a030: 7374 616d 7020 6966 206e 6f74 2064 6566  stamp if not def
+0001a040: 696e 6564 2e0a 2020 2020 2020 2020 3a70  ined..        :p
+0001a050: 6172 616d 2066 726f 6d5f 6964 3a20 446f  aram from_id: Do
+0001a060: 776e 6c6f 6164 2064 6174 6120 7374 6172  wnload data star
+0001a070: 7469 6e67 2077 6974 6820 4944 2028 6966  ting with ID (if
+0001a080: 2069 6420 6973 206b 6e6f 776e 290a 2020   id is known).  
+0001a090: 2020 2020 2020 3a72 6574 7572 6e73 204c        :returns L
+0001a0a0: 6973 7420 6f66 2074 7261 6465 2064 6174  ist of trade dat
+0001a0b0: 610a 2020 2020 2020 2020 2222 220a 2020  a.        """.  
+0001a0c0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0001a0d0: 662e 6578 6368 616e 6765 5f68 6173 2822  f.exchange_has("
+0001a0e0: 6665 7463 6854 7261 6465 7322 293a 0a20  fetchTrades"):. 
+0001a0f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001a100: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0001a110: 7074 696f 6e28 2254 6869 7320 6578 6368  ption("This exch
+0001a120: 616e 6765 2064 6f65 7320 6e6f 7420 7375  ange does not su
+0001a130: 7070 6f72 7420 646f 776e 6c6f 6164 696e  pport downloadin
+0001a140: 6720 5472 6164 6573 2e22 290a 0a20 2020  g Trades.")..   
+0001a150: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+0001a160: 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020 2020  loop_lock:.     
+0001a170: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001a180: 6c66 2e6c 6f6f 702e 7275 6e5f 756e 7469  lf.loop.run_unti
+0001a190: 6c5f 636f 6d70 6c65 7465 280a 2020 2020  l_complete(.    
+0001a1a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001a1b0: 2e5f 6173 796e 635f 6765 745f 7472 6164  ._async_get_trad
+0001a1c0: 655f 6869 7374 6f72 7928 7061 6972 3d70  e_history(pair=p
+0001a1d0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
+0001a1e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a210: 756e 7469 6c3d 756e 7469 6c2c 2066 726f  until=until, fro
+0001a220: 6d5f 6964 3d66 726f 6d5f 6964 2929 0a0a  m_id=from_id))..
+0001a230: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
+0001a240: 2064 6566 205f 6765 745f 6675 6e64 696e   def _get_fundin
+0001a250: 675f 6665 6573 5f66 726f 6d5f 6578 6368  g_fees_from_exch
+0001a260: 616e 6765 2873 656c 662c 2070 6169 723a  ange(self, pair:
+0001a270: 2073 7472 2c20 7369 6e63 653a 2055 6e69   str, since: Uni
+0001a280: 6f6e 5b64 6174 6574 696d 652c 2069 6e74  on[datetime, int
+0001a290: 5d29 202d 3e20 666c 6f61 743a 0a20 2020  ]) -> float:.   
+0001a2a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001a2b0: 2052 6574 7572 6e73 2074 6865 2073 756d   Returns the sum
+0001a2c0: 206f 6620 616c 6c20 6675 6e64 696e 6720   of all funding 
+0001a2d0: 6665 6573 2074 6861 7420 7765 7265 2065  fees that were e
+0001a2e0: 7863 6861 6e67 6564 2066 6f72 2061 2070  xchanged for a p
+0001a2f0: 6169 7220 7769 7468 696e 2061 2074 696d  air within a tim
+0001a300: 6566 7261 6d65 0a20 2020 2020 2020 2044  eframe.        D
+0001a310: 7279 2d72 756e 2068 616e 646c 696e 6720  ry-run handling 
+0001a320: 6861 7070 656e 7320 6173 2070 6172 7420  happens as part 
+0001a330: 6f66 205f 6361 6c63 756c 6174 655f 6675  of _calculate_fu
+0001a340: 6e64 696e 675f 6665 6573 2e0a 2020 2020  nding_fees..    
+0001a350: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+0001a360: 2028 652e 672e 2041 4441 2f55 5344 5429   (e.g. ADA/USDT)
+0001a370: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001a380: 7369 6e63 653a 2054 6865 2065 6172 6c69  since: The earli
+0001a390: 6573 7420 7469 6d65 206f 6620 636f 6e73  est time of cons
+0001a3a0: 6964 6572 6174 696f 6e20 666f 7220 6361  ideration for ca
+0001a3b0: 6c63 756c 6174 696e 6720 6675 6e64 696e  lculating fundin
+0001a3c0: 6720 6665 6573 2c0a 2020 2020 2020 2020  g fees,.        
+0001a3d0: 2020 2020 696e 2075 6e69 7820 7469 6d65      in unix time
+0001a3e0: 206f 7220 6173 2061 2064 6174 6574 696d   or as a datetim
+0001a3f0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+0001a400: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0001a410: 662e 6578 6368 616e 6765 5f68 6173 2822  f.exchange_has("
+0001a420: 6665 7463 6846 756e 6469 6e67 4869 7374  fetchFundingHist
+0001a430: 6f72 7922 293a 0a20 2020 2020 2020 2020  ory"):.         
+0001a440: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+0001a450: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001a470: 2266 6574 6368 5f66 756e 6469 6e67 5f68  "fetch_funding_h
+0001a480: 6973 746f 7279 2829 2069 7320 6e6f 7420  istory() is not 
+0001a490: 6176 6169 6c61 626c 6520 7573 696e 6720  available using 
+0001a4a0: 7b73 656c 662e 6e61 6d65 7d22 0a20 2020  {self.name}".   
+0001a4b0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001a4c0: 2020 2020 6966 2074 7970 6528 7369 6e63      if type(sinc
+0001a4d0: 6529 2069 7320 6461 7465 7469 6d65 3a0a  e) is datetime:.
+0001a4e0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+0001a4f0: 6520 3d20 696e 7428 7369 6e63 652e 7469  e = int(since.ti
+0001a500: 6d65 7374 616d 7028 2929 202a 2031 3030  mestamp()) * 100
+0001a510: 3020 2020 2320 2a20 3130 3030 2066 6f72  0   # * 1000 for
+0001a520: 206d 730a 0a20 2020 2020 2020 2074 7279   ms..        try
+0001a530: 3a0a 2020 2020 2020 2020 2020 2020 6675  :.            fu
+0001a540: 6e64 696e 675f 6869 7374 6f72 7920 3d20  nding_history = 
+0001a550: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
+0001a560: 6675 6e64 696e 675f 6869 7374 6f72 7928  funding_history(
+0001a570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a580: 2073 796d 626f 6c3d 7061 6972 2c0a 2020   symbol=pair,.  
+0001a590: 2020 2020 2020 2020 2020 2020 2020 7369                si
+0001a5a0: 6e63 653d 7369 6e63 650a 2020 2020 2020  nce=since.      
+0001a5b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001a5c0: 2020 2020 7265 7475 726e 2073 756d 2866      return sum(f
+0001a5d0: 6565 5b27 616d 6f75 6e74 275d 2066 6f72  ee['amount'] for
+0001a5e0: 2066 6565 2069 6e20 6675 6e64 696e 675f   fee in funding_
+0001a5f0: 6869 7374 6f72 7929 0a20 2020 2020 2020  history).       
+0001a600: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+0001a610: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+0001a620: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001a630: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+0001a640: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+0001a650: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+0001a660: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
+0001a670: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+0001a680: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+0001a690: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+0001a6a0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+0001a6b0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0001a6c0: 756c 6420 6e6f 7420 6765 7420 6675 6e64  uld not get fund
+0001a6d0: 696e 6720 6665 6573 2064 7565 2074 6f20  ing fees due to 
+0001a6e0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0001a6f0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0001a700: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0001a710: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0001a720: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0001a730: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001a740: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001a750: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0001a760: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
+0001a770: 0a20 2020 2064 6566 2067 6574 5f6c 6576  .    def get_lev
+0001a780: 6572 6167 655f 7469 6572 7328 7365 6c66  erage_tiers(self
+0001a790: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
+0001a7a0: 6973 745b 4469 6374 5d5d 3a0a 2020 2020  ist[Dict]]:.    
+0001a7b0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001a7c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001a7d0: 2e5f 6170 692e 6665 7463 685f 6c65 7665  ._api.fetch_leve
+0001a7e0: 7261 6765 5f74 6965 7273 2829 0a20 2020  rage_tiers().   
+0001a7f0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0001a800: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
+0001a810: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001a820: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
+0001a830: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
+0001a840: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001a850: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
+0001a860: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
+0001a870: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
+0001a880: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001a890: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8b0: 6627 436f 756c 6420 6e6f 7420 6c6f 6164  f'Could not load
+0001a8c0: 206c 6576 6572 6167 6520 7469 6572 7320   leverage tiers 
+0001a8d0: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
+0001a8e0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
+0001a8f0: 6573 7361 6765 3a20 7b65 7d27 0a20 2020  essage: {e}'.   
+0001a900: 2020 2020 2020 2020 2029 2066 726f 6d20           ) from 
+0001a910: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0001a920: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
+0001a930: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001a940: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+0001a950: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
+0001a960: 6672 6f6d 2065 0a0a 2020 2020 4072 6574  from e..    @ret
+0001a970: 7269 6572 5f61 7379 6e63 0a20 2020 2061  rier_async.    a
+0001a980: 7379 6e63 2064 6566 2067 6574 5f6d 6172  sync def get_mar
+0001a990: 6b65 745f 6c65 7665 7261 6765 5f74 6965  ket_leverage_tie
+0001a9a0: 7273 2873 656c 662c 2073 796d 626f 6c3a  rs(self, symbol:
+0001a9b0: 2073 7472 2920 2d3e 2054 7570 6c65 5b73   str) -> Tuple[s
+0001a9c0: 7472 2c20 4c69 7374 5b44 6963 745d 5d3a  tr, List[Dict]]:
+0001a9d0: 0a20 2020 2020 2020 2022 2222 204c 6576  .        """ Lev
+0001a9e0: 6572 6167 6520 7469 6572 7320 7065 7220  erage tiers per 
+0001a9f0: 7379 6d62 6f6c 2022 2222 0a20 2020 2020  symbol """.     
+0001aa00: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001aa10: 2020 2020 7469 6572 203d 2061 7761 6974      tier = await
+0001aa20: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
+0001aa30: 2e66 6574 6368 5f6d 6172 6b65 745f 6c65  .fetch_market_le
+0001aa40: 7665 7261 6765 5f74 6965 7273 2873 796d  verage_tiers(sym
+0001aa50: 626f 6c29 0a20 2020 2020 2020 2020 2020  bol).           
+0001aa60: 2072 6574 7572 6e20 7379 6d62 6f6c 2c20   return symbol, 
+0001aa70: 7469 6572 0a20 2020 2020 2020 2065 7863  tier.        exc
+0001aa80: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
+0001aa90: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
+0001aaa0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001aab0: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
+0001aac0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001aad0: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
+0001aae0: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
+0001aaf0: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
+0001ab00: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001ab10: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
+0001ab20: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
+0001ab30: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
+0001ab40: 6e6f 7420 6c6f 6164 206c 6576 6572 6167  not load leverag
+0001ab50: 6520 7469 6572 7320 666f 7220 7b73 796d  e tiers for {sym
+0001ab60: 626f 6c7d 270a 2020 2020 2020 2020 2020  bol}'.          
+0001ab70: 2020 2020 2020 6627 2064 7565 2074 6f20        f' due to 
+0001ab80: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0001ab90: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0001aba0: 207b 657d 270a 2020 2020 2020 2020 2020   {e}'.          
+0001abb0: 2020 2920 6672 6f6d 2065 0a20 2020 2020    ) from e.     
+0001abc0: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+0001abd0: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+0001abe0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001abf0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0001ac00: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+0001ac10: 0a20 2020 2064 6566 206c 6f61 645f 6c65  .    def load_le
+0001ac20: 7665 7261 6765 5f74 6965 7273 2873 656c  verage_tiers(sel
+0001ac30: 6629 202d 3e20 4469 6374 5b73 7472 2c20  f) -> Dict[str, 
+0001ac40: 4c69 7374 5b44 6963 745d 5d3a 0a20 2020  List[Dict]]:.   
+0001ac50: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+0001ac60: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
+0001ac70: 6469 6e67 4d6f 6465 2e46 5554 5552 4553  dingMode.FUTURES
+0001ac80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001ac90: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
+0001aca0: 6173 2827 6665 7463 684c 6576 6572 6167  as('fetchLeverag
+0001acb0: 6554 6965 7273 2729 3a0a 2020 2020 2020  eTiers'):.      
+0001acc0: 2020 2020 2020 2020 2020 2320 4665 7463            # Fetc
+0001acd0: 6820 616c 6c20 6c65 7665 7261 6765 2074  h all leverage t
+0001ace0: 6965 7273 2061 7420 6f6e 6365 0a20 2020  iers at once.   
+0001acf0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001ad00: 7572 6e20 7365 6c66 2e67 6574 5f6c 6576  urn self.get_lev
+0001ad10: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
+0001ad20: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+0001ad30: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
+0001ad40: 2827 6665 7463 684d 6172 6b65 744c 6576  ('fetchMarketLev
+0001ad50: 6572 6167 6554 6965 7273 2729 3a0a 2020  erageTiers'):.  
+0001ad60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001ad70: 4d75 7374 2066 6574 6368 2074 6865 206c  Must fetch the l
+0001ad80: 6576 6572 6167 6520 7469 6572 7320 666f  everage tiers fo
+0001ad90: 7220 6561 6368 206d 6172 6b65 7420 7365  r each market se
+0001ada0: 7061 7261 7465 6c79 0a20 2020 2020 2020  parately.       
+0001adb0: 2020 2020 2020 2020 2023 202a 2054 6869           # * Thi
+0001adc0: 7320 6973 2073 6c6f 7728 7e34 3573 2920  s is slow(~45s) 
+0001add0: 6f6e 204f 6b78 2c20 6d61 6b65 7320 7e39  on Okx, makes ~9
+0001ade0: 3020 6170 6920 6361 6c6c 7320 746f 206c  0 api calls to l
+0001adf0: 6f61 6420 616c 6c20 6c69 6e65 6172 2073  oad all linear s
+0001ae00: 7761 7020 6d61 726b 6574 730a 2020 2020  wap markets.    
+0001ae10: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
+0001ae20: 6574 7320 3d20 7365 6c66 2e6d 6172 6b65  ets = self.marke
+0001ae30: 7473 0a0a 2020 2020 2020 2020 2020 2020  ts..            
+0001ae40: 2020 2020 7379 6d62 6f6c 7320 3d20 5b0a      symbols = [.
+0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae60: 2020 2020 7379 6d62 6f6c 2066 6f72 2073      symbol for s
+0001ae70: 796d 626f 6c2c 206d 6172 6b65 7420 696e  ymbol, market in
+0001ae80: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
+0001ae90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aea0: 2020 2020 2069 6620 2873 656c 662e 6d61       if (self.ma
+0001aeb0: 726b 6574 5f69 735f 6675 7475 7265 286d  rket_is_future(m
+0001aec0: 6172 6b65 7429 0a20 2020 2020 2020 2020  arket).         
+0001aed0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001aee0: 6e64 206d 6172 6b65 745b 2771 756f 7465  nd market['quote
+0001aef0: 275d 203d 3d20 7365 6c66 2e5f 636f 6e66  '] == self._conf
+0001af00: 6967 5b27 7374 616b 655f 6375 7272 656e  ig['stake_curren
+0001af10: 6379 275d 290a 2020 2020 2020 2020 2020  cy']).          
+0001af20: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+0001af30: 2020 2020 2020 2020 2074 6965 7273 3a20           tiers: 
+0001af40: 4469 6374 5b73 7472 2c20 4c69 7374 5b44  Dict[str, List[D
+0001af50: 6963 745d 5d20 3d20 7b7d 0a0a 2020 2020  ict]] = {}..    
+0001af60: 2020 2020 2020 2020 2020 2020 7469 6572              tier
+0001af70: 735f 6361 6368 6564 203d 2073 656c 662e  s_cached = self.
+0001af80: 6c6f 6164 5f63 6163 6865 645f 6c65 7665  load_cached_leve
+0001af90: 7261 6765 5f74 6965 7273 2873 656c 662e  rage_tiers(self.
+0001afa0: 5f63 6f6e 6669 675b 2773 7461 6b65 5f63  _config['stake_c
+0001afb0: 7572 7265 6e63 7927 5d29 0a20 2020 2020  urrency']).     
+0001afc0: 2020 2020 2020 2020 2020 2069 6620 7469             if ti
+0001afd0: 6572 735f 6361 6368 6564 3a0a 2020 2020  ers_cached:.    
+0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aff0: 7469 6572 7320 3d20 7469 6572 735f 6361  tiers = tiers_ca
+0001b000: 6368 6564 0a0a 2020 2020 2020 2020 2020  ched..          
+0001b010: 2020 2020 2020 636f 726f 7320 3d20 5b0a        coros = [.
+0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b030: 2020 2020 7365 6c66 2e67 6574 5f6d 6172      self.get_mar
+0001b040: 6b65 745f 6c65 7665 7261 6765 5f74 6965  ket_leverage_tie
+0001b050: 7273 2873 796d 626f 6c29 0a20 2020 2020  rs(symbol).     
+0001b060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001b070: 6f72 2073 796d 626f 6c20 696e 2073 6f72  or symbol in sor
+0001b080: 7465 6428 7379 6d62 6f6c 7329 2069 6620  ted(symbols) if 
+0001b090: 7379 6d62 6f6c 206e 6f74 2069 6e20 7469  symbol not in ti
+0001b0a0: 6572 735d 0a0a 2020 2020 2020 2020 2020  ers]..          
+0001b0b0: 2020 2020 2020 2320 4265 2076 6572 626f        # Be verbo
+0001b0c0: 7365 2068 6572 652c 2061 7320 7468 6973  se here, as this
+0001b0d0: 2064 656c 6179 7320 7374 6172 7475 7020   delays startup 
+0001b0e0: 6279 207e 3120 6d69 6e75 7465 2e0a 2020  by ~1 minute..  
+0001b0f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001b100: 2063 6f72 6f73 3a0a 2020 2020 2020 2020   coros:.        
+0001b110: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0001b120: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2066 2249 6e69 7469 616c 697a 696e 6720   f"Initializing 
+0001b150: 6c65 7665 7261 6765 5f74 6965 7273 2066  leverage_tiers f
+0001b160: 6f72 207b 6c65 6e28 7379 6d62 6f6c 7329  or {len(symbols)
+0001b170: 7d20 6d61 726b 6574 732e 2022 0a20 2020  } markets. ".   
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2020 2022 5468 6973 2077 696c 6c20       "This will 
+0001b1a0: 7461 6b65 2061 626f 7574 2061 206d 696e  take about a min
+0001b1b0: 7574 652e 2229 0a20 2020 2020 2020 2020  ute.").         
+0001b1c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1e0: 206c 6f67 6765 722e 696e 666f 2822 5573   logger.info("Us
+0001b1f0: 696e 6720 6361 6368 6564 206c 6576 6572  ing cached lever
+0001b200: 6167 655f 7469 6572 732e 2229 0a0a 2020  age_tiers.")..  
+0001b210: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0001b220: 796e 6320 6465 6620 6761 7468 6572 5f72  ync def gather_r
+0001b230: 6573 756c 7473 2869 6e70 7574 5f63 6f72  esults(input_cor
+0001b240: 6f29 3a0a 2020 2020 2020 2020 2020 2020  o):.            
+0001b250: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+0001b260: 7761 6974 2061 7379 6e63 696f 2e67 6174  wait asyncio.gat
+0001b270: 6865 7228 2a69 6e70 7574 5f63 6f72 6f2c  her(*input_coro,
+0001b280: 2072 6574 7572 6e5f 6578 6365 7074 696f   return_exceptio
+0001b290: 6e73 3d54 7275 6529 0a0a 2020 2020 2020  ns=True)..      
+0001b2a0: 2020 2020 2020 2020 2020 666f 7220 696e            for in
+0001b2b0: 7075 745f 636f 726f 2069 6e20 6368 756e  put_coro in chun
+0001b2c0: 6b73 2863 6f72 6f73 2c20 3130 3029 3a0a  ks(coros, 100):.
+0001b2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b2e0: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+0001b2f0: 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020 2020  loop_lock:.     
+0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b310: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+0001b320: 662e 6c6f 6f70 2e72 756e 5f75 6e74 696c  f.loop.run_until
+0001b330: 5f63 6f6d 706c 6574 6528 6761 7468 6572  _complete(gather
+0001b340: 5f72 6573 756c 7473 2869 6e70 7574 5f63  _results(input_c
+0001b350: 6f72 6f29 290a 0a20 2020 2020 2020 2020  oro))..         
+0001b360: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+0001b370: 6573 2069 6e20 7265 7375 6c74 733a 0a20  es in results:. 
+0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b390: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0001b3a0: 616e 6365 2872 6573 2c20 4578 6365 7074  ance(res, Except
+0001b3b0: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
+0001b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3d0: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+0001b3e0: 2866 224c 6576 6572 6167 6520 7469 6572  (f"Leverage tier
+0001b3f0: 2065 7863 6570 7469 6f6e 3a20 7b72 6570   exception: {rep
+0001b400: 7228 7265 7329 7d22 290a 2020 2020 2020  r(res)}").      
+0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b420: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001b430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b440: 2020 2020 2020 2073 796d 626f 6c2c 2074         symbol, t
+0001b450: 6965 7220 3d20 7265 730a 2020 2020 2020  ier = res.      
+0001b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b470: 2020 7469 6572 735b 7379 6d62 6f6c 5d20    tiers[symbol] 
+0001b480: 3d20 7469 6572 0a20 2020 2020 2020 2020  = tier.         
+0001b490: 2020 2020 2020 2069 6620 6c65 6e28 636f         if len(co
+0001b4a0: 726f 7329 203e 2030 3a0a 2020 2020 2020  ros) > 0:.      
+0001b4b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001b4c0: 6c66 2e63 6163 6865 5f6c 6576 6572 6167  lf.cache_leverag
+0001b4d0: 655f 7469 6572 7328 7469 6572 732c 2073  e_tiers(tiers, s
+0001b4e0: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
+0001b4f0: 6b65 5f63 7572 7265 6e63 7927 5d29 0a20  ke_currency']). 
+0001b500: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b510: 6f67 6765 722e 696e 666f 2866 2244 6f6e  ogger.info(f"Don
+0001b520: 6520 696e 6974 6961 6c69 7a69 6e67 207b  e initializing {
+0001b530: 6c65 6e28 7379 6d62 6f6c 7329 7d20 6d61  len(symbols)} ma
+0001b540: 726b 6574 732e 2229 0a0a 2020 2020 2020  rkets.")..      
+0001b550: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b560: 2074 6965 7273 0a20 2020 2020 2020 2072   tiers.        r
+0001b570: 6574 7572 6e20 7b7d 0a0a 2020 2020 6465  eturn {}..    de
+0001b580: 6620 6361 6368 655f 6c65 7665 7261 6765  f cache_leverage
+0001b590: 5f74 6965 7273 2873 656c 662c 2074 6965  _tiers(self, tie
+0001b5a0: 7273 3a20 4469 6374 5b73 7472 2c20 4c69  rs: Dict[str, Li
+0001b5b0: 7374 5b44 6963 745d 5d2c 2073 7461 6b65  st[Dict]], stake
+0001b5c0: 5f63 7572 7265 6e63 793a 2073 7472 2920  _currency: str) 
+0001b5d0: 2d3e 204e 6f6e 653a 0a0a 2020 2020 2020  -> None:..      
+0001b5e0: 2020 6669 6c65 6e61 6d65 203d 2073 656c    filename = sel
+0001b5f0: 662e 5f63 6f6e 6669 675b 2764 6174 6164  f._config['datad
+0001b600: 6972 275d 202f 2022 6675 7475 7265 7322  ir'] / "futures"
+0001b610: 202f 2066 226c 6576 6572 6167 655f 7469   / f"leverage_ti
+0001b620: 6572 735f 7b73 7461 6b65 5f63 7572 7265  ers_{stake_curre
+0001b630: 6e63 797d 2e6a 736f 6e22 0a20 2020 2020  ncy}.json".     
+0001b640: 2020 2069 6620 6e6f 7420 6669 6c65 6e61     if not filena
+0001b650: 6d65 2e70 6172 656e 742e 6973 5f64 6972  me.parent.is_dir
+0001b660: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0001b670: 6669 6c65 6e61 6d65 2e70 6172 656e 742e  filename.parent.
+0001b680: 6d6b 6469 7228 7061 7265 6e74 733d 5472  mkdir(parents=Tr
+0001b690: 7565 290a 2020 2020 2020 2020 6461 7461  ue).        data
+0001b6a0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+0001b6b0: 2022 7570 6461 7465 6422 3a20 6461 7465   "updated": date
+0001b6c0: 7469 6d65 2e6e 6f77 2874 696d 657a 6f6e  time.now(timezon
+0001b6d0: 652e 7574 6329 2c0a 2020 2020 2020 2020  e.utc),.        
+0001b6e0: 2020 2020 2264 6174 6122 3a20 7469 6572      "data": tier
+0001b6f0: 732c 0a20 2020 2020 2020 207d 0a20 2020  s,.        }.   
+0001b700: 2020 2020 2066 696c 655f 6475 6d70 5f6a       file_dump_j
+0001b710: 736f 6e28 6669 6c65 6e61 6d65 2c20 6461  son(filename, da
+0001b720: 7461 290a 0a20 2020 2064 6566 206c 6f61  ta)..    def loa
+0001b730: 645f 6361 6368 6564 5f6c 6576 6572 6167  d_cached_leverag
+0001b740: 655f 7469 6572 7328 7365 6c66 2c20 7374  e_tiers(self, st
+0001b750: 616b 655f 6375 7272 656e 6379 3a20 7374  ake_currency: st
+0001b760: 7229 202d 3e20 4f70 7469 6f6e 616c 5b44  r) -> Optional[D
+0001b770: 6963 745b 7374 722c 204c 6973 745b 4469  ict[str, List[Di
+0001b780: 6374 5d5d 5d3a 0a20 2020 2020 2020 2066  ct]]]:.        f
+0001b790: 696c 656e 616d 6520 3d20 7365 6c66 2e5f  ilename = self._
+0001b7a0: 636f 6e66 6967 5b27 6461 7461 6469 7227  config['datadir'
+0001b7b0: 5d20 2f20 2266 7574 7572 6573 2220 2f20  ] / "futures" / 
+0001b7c0: 6622 6c65 7665 7261 6765 5f74 6965 7273  f"leverage_tiers
+0001b7d0: 5f7b 7374 616b 655f 6375 7272 656e 6379  _{stake_currency
+0001b7e0: 7d2e 6a73 6f6e 220a 2020 2020 2020 2020  }.json".        
+0001b7f0: 6966 2066 696c 656e 616d 652e 6973 5f66  if filename.is_f
+0001b800: 696c 6528 293a 0a20 2020 2020 2020 2020  ile():.         
+0001b810: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001b820: 2020 2020 2020 2020 7469 6572 7320 3d20          tiers = 
+0001b830: 6669 6c65 5f6c 6f61 645f 6a73 6f6e 2866  file_load_json(f
+0001b840: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+0001b850: 2020 2020 2020 2020 2075 7064 6174 6564           updated
+0001b860: 203d 2074 6965 7273 2e67 6574 2827 7570   = tiers.get('up
+0001b870: 6461 7465 6427 290a 2020 2020 2020 2020  dated').        
+0001b880: 2020 2020 2020 2020 6966 2075 7064 6174          if updat
+0001b890: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0001b8a0: 2020 2020 2020 2020 7570 6461 7465 645f          updated_
+0001b8b0: 6474 203d 2070 6172 7365 722e 7061 7273  dt = parser.pars
+0001b8c0: 6528 7570 6461 7465 6429 0a20 2020 2020  e(updated).     
+0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b8e0: 6620 7570 6461 7465 645f 6474 203c 2064  f updated_dt < d
+0001b8f0: 6174 6574 696d 652e 6e6f 7728 7469 6d65  atetime.now(time
+0001b900: 7a6f 6e65 2e75 7463 2920 2d20 7469 6d65  zone.utc) - time
+0001b910: 6465 6c74 6128 7765 656b 733d 3429 3a0a  delta(weeks=4):.
+0001b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b930: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+0001b940: 6e66 6f28 2243 6163 6865 6420 6c65 7665  nfo("Cached leve
+0001b950: 7261 6765 2074 6965 7273 2061 7265 206f  rage tiers are o
+0001b960: 7574 6461 7465 642e 2057 696c 6c20 7570  utdated. Will up
+0001b970: 6461 7465 2e22 290a 2020 2020 2020 2020  date.").        
+0001b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b990: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+0001b9a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001b9b0: 726e 2074 6965 7273 5b27 6461 7461 275d  rn tiers['data']
+0001b9c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0001b9d0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0001b9e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b9f0: 6f67 6765 722e 6578 6365 7074 696f 6e28  ogger.exception(
+0001ba00: 2245 7272 6f72 206c 6f61 6469 6e67 2063  "Error loading c
+0001ba10: 6163 6865 6420 6c65 7665 7261 6765 2074  ached leverage t
+0001ba20: 6965 7273 2e20 5265 6672 6573 6869 6e67  iers. Refreshing
+0001ba30: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
+0001ba40: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
+0001ba50: 2066 696c 6c5f 6c65 7665 7261 6765 5f74   fill_leverage_t
+0001ba60: 6965 7273 2873 656c 6629 202d 3e20 4e6f  iers(self) -> No
+0001ba70: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+0001ba80: 2020 2020 2020 2020 4173 7369 676e 7320          Assigns 
+0001ba90: 7072 6f70 6572 7479 205f 6c65 7665 7261  property _levera
+0001baa0: 6765 5f74 6965 7273 2074 6f20 6120 6469  ge_tiers to a di
+0001bab0: 6374 696f 6e61 7279 206f 6620 696e 666f  ctionary of info
+0001bac0: 726d 6174 696f 6e20 6162 6f75 7420 7468  rmation about th
+0001bad0: 6520 6c65 7665 7261 6765 0a20 2020 2020  e leverage.     
+0001bae0: 2020 2061 6c6c 6f77 6564 206f 6e20 6561     allowed on ea
+0001baf0: 6368 2070 6169 720a 2020 2020 2020 2020  ch pair.        
+0001bb00: 2222 220a 2020 2020 2020 2020 6c65 7665  """.        leve
+0001bb10: 7261 6765 5f74 6965 7273 203d 2073 656c  rage_tiers = sel
+0001bb20: 662e 6c6f 6164 5f6c 6576 6572 6167 655f  f.load_leverage_
+0001bb30: 7469 6572 7328 290a 2020 2020 2020 2020  tiers().        
+0001bb40: 666f 7220 7061 6972 2c20 7469 6572 7320  for pair, tiers 
+0001bb50: 696e 206c 6576 6572 6167 655f 7469 6572  in leverage_tier
+0001bb60: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+0001bb70: 2020 2020 2020 2070 6169 725f 7469 6572         pair_tier
+0001bb80: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+0001bb90: 2020 2066 6f72 2074 6965 7220 696e 2074     for tier in t
+0001bba0: 6965 7273 3a0a 2020 2020 2020 2020 2020  iers:.          
+0001bbb0: 2020 2020 2020 7061 6972 5f74 6965 7273        pair_tiers
+0001bbc0: 2e61 7070 656e 6428 7365 6c66 2e70 6172  .append(self.par
+0001bbd0: 7365 5f6c 6576 6572 6167 655f 7469 6572  se_leverage_tier
+0001bbe0: 2874 6965 7229 290a 2020 2020 2020 2020  (tier)).        
+0001bbf0: 2020 2020 7365 6c66 2e5f 6c65 7665 7261      self._levera
+0001bc00: 6765 5f74 6965 7273 5b70 6169 725d 203d  ge_tiers[pair] =
+0001bc10: 2070 6169 725f 7469 6572 730a 0a20 2020   pair_tiers..   
+0001bc20: 2064 6566 2070 6172 7365 5f6c 6576 6572   def parse_lever
+0001bc30: 6167 655f 7469 6572 2873 656c 662c 2074  age_tier(self, t
+0001bc40: 6965 7229 202d 3e20 4469 6374 3a0a 2020  ier) -> Dict:.  
+0001bc50: 2020 2020 2020 696e 666f 203d 2074 6965        info = tie
+0001bc60: 722e 6765 7428 2769 6e66 6f27 2c20 7b7d  r.get('info', {}
+0001bc70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001bc80: 207b 0a20 2020 2020 2020 2020 2020 2027   {.            '
+0001bc90: 6d69 6e4e 6f74 696f 6e61 6c27 3a20 7469  minNotional': ti
+0001bca0: 6572 5b27 6d69 6e4e 6f74 696f 6e61 6c27  er['minNotional'
+0001bcb0: 5d2c 0a20 2020 2020 2020 2020 2020 2027  ],.            '
+0001bcc0: 6d61 784e 6f74 696f 6e61 6c27 3a20 7469  maxNotional': ti
+0001bcd0: 6572 5b27 6d61 784e 6f74 696f 6e61 6c27  er['maxNotional'
+0001bce0: 5d2c 0a20 2020 2020 2020 2020 2020 2027  ],.            '
+0001bcf0: 6d61 696e 7465 6e61 6e63 654d 6172 6769  maintenanceMargi
+0001bd00: 6e52 6174 6527 3a20 7469 6572 5b27 6d61  nRate': tier['ma
+0001bd10: 696e 7465 6e61 6e63 654d 6172 6769 6e52  intenanceMarginR
+0001bd20: 6174 6527 5d2c 0a20 2020 2020 2020 2020  ate'],.         
+0001bd30: 2020 2027 6d61 784c 6576 6572 6167 6527     'maxLeverage'
+0001bd40: 3a20 7469 6572 5b27 6d61 784c 6576 6572  : tier['maxLever
+0001bd50: 6167 6527 5d2c 0a20 2020 2020 2020 2020  age'],.         
+0001bd60: 2020 2027 6d61 696e 7441 6d74 273a 2066     'maintAmt': f
+0001bd70: 6c6f 6174 2869 6e66 6f5b 2763 756d 275d  loat(info['cum']
+0001bd80: 2920 6966 2027 6375 6d27 2069 6e20 696e  ) if 'cum' in in
+0001bd90: 666f 2065 6c73 6520 4e6f 6e65 2c0a 2020  fo else None,.  
+0001bda0: 2020 2020 2020 7d0a 0a20 2020 2064 6566        }..    def
+0001bdb0: 2067 6574 5f6d 6178 5f6c 6576 6572 6167   get_max_leverag
+0001bdc0: 6528 7365 6c66 2c20 7061 6972 3a20 7374  e(self, pair: st
+0001bdd0: 722c 2073 7461 6b65 5f61 6d6f 756e 743a  r, stake_amount:
+0001bde0: 204f 7074 696f 6e61 6c5b 666c 6f61 745d   Optional[float]
+0001bdf0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+0001be00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001be10: 5265 7475 726e 7320 7468 6520 6d61 7869  Returns the maxi
+0001be20: 6d75 6d20 6c65 7665 7261 6765 2074 6861  mum leverage tha
+0001be30: 7420 6120 7061 6972 2063 616e 2062 6520  t a pair can be 
+0001be40: 7472 6164 6564 2061 740a 2020 2020 2020  traded at.      
+0001be50: 2020 3a70 6172 616d 2070 6169 723a 2054    :param pair: T
+0001be60: 6865 2062 6173 652f 7175 6f74 6520 6375  he base/quote cu
+0001be70: 7272 656e 6379 2070 6169 7220 6265 696e  rrency pair bein
+0001be80: 6720 7472 6164 6564 0a20 2020 2020 2020  g traded.       
+0001be90: 203a 7374 616b 655f 616d 6f75 6e74 3a20   :stake_amount: 
+0001bea0: 5468 6520 746f 7461 6c20 7661 6c75 6520  The total value 
+0001beb0: 6f66 2074 6865 2074 7261 6465 7273 206d  of the traders m
+0001bec0: 6172 6769 6e5f 6d6f 6465 2069 6e20 7175  argin_mode in qu
+0001bed0: 6f74 6520 6375 7272 656e 6379 0a20 2020  ote currency.   
+0001bee0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0001bef0: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+0001bf00: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+0001bf10: 674d 6f64 652e 5350 4f54 3a0a 2020 2020  gMode.SPOT:.    
+0001bf20: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+0001bf30: 2e30 0a0a 2020 2020 2020 2020 6966 2073  .0..        if s
+0001bf40: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
+0001bf50: 203d 3d20 5472 6164 696e 674d 6f64 652e   == TradingMode.
+0001bf60: 4655 5455 5245 533a 0a0a 2020 2020 2020  FUTURES:..      
+0001bf70: 2020 2020 2020 2320 4368 6563 6b73 2061        # Checks a
+0001bf80: 6e64 2065 6467 6520 6361 7365 730a 2020  nd edge cases.  
+0001bf90: 2020 2020 2020 2020 2020 6966 2073 7461            if sta
+0001bfa0: 6b65 5f61 6d6f 756e 7420 6973 204e 6f6e  ke_amount is Non
+0001bfb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001bfc0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+0001bfd0: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bff0: 2020 2066 277b 7365 6c66 2e6e 616d 657d     f'{self.name}
+0001c000: 2e67 6574 5f6d 6178 5f6c 6576 6572 6167  .get_max_leverag
+0001c010: 6520 7265 7175 6972 6573 2061 7267 756d  e requires argum
+0001c020: 656e 7420 7374 616b 655f 616d 6f75 6e74  ent stake_amount
+0001c030: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0001c040: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0001c050: 2069 6620 7061 6972 206e 6f74 2069 6e20   if pair not in 
+0001c060: 7365 6c66 2e5f 6c65 7665 7261 6765 5f74  self._leverage_t
+0001c070: 6965 7273 3a0a 2020 2020 2020 2020 2020  iers:.          
+0001c080: 2020 2020 2020 2320 4d61 7962 6520 7261        # Maybe ra
+0001c090: 6973 6520 6578 6365 7074 696f 6e20 6265  ise exception be
+0001c0a0: 6361 7573 6520 6974 2063 616e 2774 2062  cause it can't b
+0001c0b0: 6520 7472 6164 6564 206f 6e20 6675 7475  e traded on futu
+0001c0c0: 7265 733f 0a20 2020 2020 2020 2020 2020  res?.           
+0001c0d0: 2020 2020 2072 6574 7572 6e20 312e 300a       return 1.0.
+0001c0e0: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
+0001c0f0: 725f 7469 6572 7320 3d20 7365 6c66 2e5f  r_tiers = self._
+0001c100: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
+0001c110: 6169 725d 0a0a 2020 2020 2020 2020 2020  air]..          
+0001c120: 2020 6966 2073 7461 6b65 5f61 6d6f 756e    if stake_amoun
+0001c130: 7420 3d3d 2030 3a0a 2020 2020 2020 2020  t == 0:.        
+0001c140: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001c150: 656c 662e 5f6c 6576 6572 6167 655f 7469  elf._leverage_ti
+0001c160: 6572 735b 7061 6972 5d5b 305d 5b27 6d61  ers[pair][0]['ma
+0001c170: 784c 6576 6572 6167 6527 5d20 2023 204d  xLeverage']  # M
+0001c180: 6178 206c 6576 2066 6f72 206c 6f77 6573  ax lev for lowes
+0001c190: 7420 616d 6f75 6e74 0a0a 2020 2020 2020  t amount..      
+0001c1a0: 2020 2020 2020 666f 7220 7469 6572 5f69        for tier_i
+0001c1b0: 6e64 6578 2069 6e20 7261 6e67 6528 6c65  ndex in range(le
+0001c1c0: 6e28 7061 6972 5f74 6965 7273 2929 3a0a  n(pair_tiers)):.
+0001c1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c1e0: 2074 6965 7220 3d20 7061 6972 5f74 6965   tier = pair_tie
+0001c1f0: 7273 5b74 6965 725f 696e 6465 785d 0a20  rs[tier_index]. 
+0001c200: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001c210: 6576 203d 2074 6965 725b 276d 6178 4c65  ev = tier['maxLe
+0001c220: 7665 7261 6765 275d 0a0a 2020 2020 2020  verage']..      
+0001c230: 2020 2020 2020 2020 2020 6966 2074 6965            if tie
+0001c240: 725f 696e 6465 7820 3c20 6c65 6e28 7061  r_index < len(pa
+0001c250: 6972 5f74 6965 7273 2920 2d20 313a 0a20  ir_tiers) - 1:. 
+0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c270: 2020 206e 6578 745f 7469 6572 203d 2070     next_tier = p
+0001c280: 6169 725f 7469 6572 735b 7469 6572 5f69  air_tiers[tier_i
+0001c290: 6e64 6578 202b 2031 5d0a 2020 2020 2020  ndex + 1].      
+0001c2a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001c2b0: 7874 5f66 6c6f 6f72 203d 206e 6578 745f  xt_floor = next_
+0001c2c0: 7469 6572 5b27 6d69 6e4e 6f74 696f 6e61  tier['minNotiona
+0001c2d0: 6c27 5d20 2f20 6e65 7874 5f74 6965 725b  l'] / next_tier[
+0001c2e0: 276d 6178 4c65 7665 7261 6765 275d 0a20  'maxLeverage']. 
+0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c300: 2020 2069 6620 6e65 7874 5f66 6c6f 6f72     if next_floor
+0001c310: 203e 2073 7461 6b65 5f61 6d6f 756e 743a   > stake_amount:
+0001c320: 2020 2320 4e65 7874 2074 6965 7220 6d69    # Next tier mi
+0001c330: 6e20 746f 6f20 6869 6768 2066 6f72 2073  n too high for s
+0001c340: 7461 6b65 2061 6d6f 756e 740a 2020 2020  take amount.    
+0001c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c360: 2020 2020 7265 7475 726e 206d 696e 2828      return min((
+0001c370: 7469 6572 5b27 6d61 784e 6f74 696f 6e61  tier['maxNotiona
+0001c380: 6c27 5d20 2f20 7374 616b 655f 616d 6f75  l'] / stake_amou
+0001c390: 6e74 292c 206c 6576 290a 2020 2020 2020  nt), lev).      
 0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3b0: 2020 2020 2020 2023 207b 0a20 2020 2020         # {.     
-0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3d0: 2020 2023 2020 2020 2022 6d69 6e22 3a20     #     "min": 
-0001c3e0: 3130 3030 302c 2020 2320 7374 616b 6520  10000,  # stake 
-0001c3f0: 3d20 3230 302e 300a 2020 2020 2020 2020  = 200.0.        
-0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c410: 2320 2020 2020 226d 6178 223a 2035 3030  #     "max": 500
-0001c420: 3030 2c20 2023 206d 6178 5f73 7461 6b65  00,  # max_stake
-0001c430: 4035 3020 3d20 3530 3030 302f 3530 203d  @50 = 50000/50 =
-0001c440: 2031 3030 302e 300a 2020 2020 2020 2020   1000.0.        
-0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c460: 2320 2020 2020 226c 6576 223a 2035 302c  #     "lev": 50,
-0001c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c480: 2020 2020 2020 2020 2023 207d 0a20 2020           # }.   
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 2020 2020 2023 0a0a 2020 2020 2020 2020       #..        
-0001c4b0: 2020 2020 2020 2020 656c 7365 3a20 2023          else:  #
-0001c4c0: 2069 6620 6f6e 2074 6865 206c 6173 7420   if on the last 
-0001c4d0: 7469 6572 0a20 2020 2020 2020 2020 2020  tier.           
-0001c4e0: 2020 2020 2020 2020 2069 6620 7374 616b           if stak
-0001c4f0: 655f 616d 6f75 6e74 203e 2074 6965 725b  e_amount > tier[
-0001c500: 276d 6178 4e6f 7469 6f6e 616c 275d 3a0a  'maxNotional']:.
-0001c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c520: 2020 2020 2020 2020 2320 4966 2073 7461          # If sta
-0001c530: 6b65 2069 7320 3e20 7468 616e 206d 6178  ke is > than max
-0001c540: 2074 7261 6465 6162 6c65 2061 6d6f 756e   tradeable amoun
-0001c550: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001c560: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001c570: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
-0001c580: 7074 696f 6e28 6627 416d 6f75 6e74 207b  ption(f'Amount {
-0001c590: 7374 616b 655f 616d 6f75 6e74 7d20 746f  stake_amount} to
-0001c5a0: 6f20 6869 6768 2066 6f72 207b 7061 6972  o high for {pair
-0001c5b0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
-0001c5c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5e0: 2020 2020 2020 7265 7475 726e 2074 6965        return tie
-0001c5f0: 725b 276d 6178 4c65 7665 7261 6765 275d  r['maxLeverage']
-0001c600: 0a0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0001c610: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0001c620: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-0001c630: 2020 2020 2020 2020 2020 274c 6f6f 7065            'Loope
-0001c640: 6420 7468 726f 7567 6820 616c 6c20 7469  d through all ti
-0001c650: 6572 7320 7769 7468 6f75 7420 6669 6e64  ers without find
-0001c660: 696e 6720 6120 6d61 7820 6c65 7665 7261  ing a max levera
-0001c670: 6765 2e20 5368 6f75 6c64 206e 6576 6572  ge. Should never
-0001c680: 2062 6520 7265 6163 6865 6427 0a20 2020   be reached'.   
-0001c690: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001c6a0: 2020 2020 656c 6966 2073 656c 662e 7472      elif self.tr
-0001c6b0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-0001c6c0: 6164 696e 674d 6f64 652e 4d41 5247 494e  adingMode.MARGIN
-0001c6d0: 3a20 2023 2053 6561 7263 6820 6d61 726b  :  # Search mark
-0001c6e0: 6574 732e 6c69 6d69 7473 2066 6f72 206d  ets.limits for m
-0001c6f0: 6178 206c 6576 0a20 2020 2020 2020 2020  ax lev.         
-0001c700: 2020 206d 6172 6b65 7420 3d20 7365 6c66     market = self
-0001c710: 2e6d 6172 6b65 7473 5b70 6169 725d 0a20  .markets[pair]. 
-0001c720: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-0001c730: 726b 6574 5b27 6c69 6d69 7473 275d 5b27  rket['limits']['
-0001c740: 6c65 7665 7261 6765 275d 5b27 6d61 7827  leverage']['max'
-0001c750: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
-0001c760: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001c770: 6574 7572 6e20 6d61 726b 6574 5b27 6c69  eturn market['li
-0001c780: 6d69 7473 275d 5b27 6c65 7665 7261 6765  mits']['leverage
-0001c790: 275d 5b27 6d61 7827 5d0a 2020 2020 2020  ']['max'].      
-0001c7a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001c7b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001c7c0: 726e 2031 2e30 2020 2320 4465 6661 756c  rn 1.0  # Defaul
-0001c7d0: 7420 6966 206d 6178 206c 6576 6572 6167  t if max leverag
-0001c7e0: 6520 6361 6e6e 6f74 2062 6520 666f 756e  e cannot be foun
-0001c7f0: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
-0001c800: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001c810: 726e 2031 2e30 0a0a 2020 2020 4072 6574  rn 1.0..    @ret
-0001c820: 7269 6572 0a20 2020 2064 6566 205f 7365  rier.    def _se
-0001c830: 745f 6c65 7665 7261 6765 280a 2020 2020  t_leverage(.    
-0001c840: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0001c850: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
-0001c860: 742c 0a20 2020 2020 2020 2070 6169 723a  t,.        pair:
-0001c870: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0001c880: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
-0001c890: 6363 6570 745f 6661 696c 3a20 626f 6f6c  ccept_fail: bool
-0001c8a0: 203d 2046 616c 7365 2c0a 2020 2020 293a   = False,.    ):
-0001c8b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001c8c0: 2020 2020 2053 6574 2773 2074 6865 206c       Set's the l
-0001c8d0: 6576 6572 6167 6520 6265 666f 7265 206d  everage before m
-0001c8e0: 616b 696e 6720 6120 7472 6164 652c 2069  aking a trade, i
-0001c8f0: 6e20 6f72 6465 7220 746f 206e 6f74 0a20  n order to not. 
-0001c900: 2020 2020 2020 2068 6176 6520 7468 6520         have the 
-0001c910: 7361 6d65 206c 6576 6572 6167 6520 6f6e  same leverage on
-0001c920: 2065 7665 7279 2074 7261 6465 0a20 2020   every trade.   
-0001c930: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c940: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
-0001c950: 5b27 6472 795f 7275 6e27 5d20 6f72 206e  ['dry_run'] or n
-0001c960: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-0001c970: 5f68 6173 2822 7365 744c 6576 6572 6167  _has("setLeverag
-0001c980: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
-0001c990: 2023 2053 6f6d 6520 6578 6368 616e 6765   # Some exchange
-0001c9a0: 7320 6f6e 6c79 2073 7570 706f 7274 206f  s only support o
-0001c9b0: 6e65 206d 6172 6769 6e5f 6d6f 6465 2074  ne margin_mode t
-0001c9c0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-0001c9d0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
-0001c9e0: 6620 7365 6c66 2e5f 6674 5f68 6173 2e67  f self._ft_has.g
-0001c9f0: 6574 2827 666c 6f6f 725f 6c65 7665 7261  et('floor_levera
-0001ca00: 6765 272c 2046 616c 7365 2920 6973 2054  ge', False) is T
-0001ca10: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
-0001ca20: 2023 2052 6f75 6e64 696e 6720 666f 7220   # Rounding for 
-0001ca30: 6269 6e61 6e63 6520 2e2e 2e0a 2020 2020  binance ....    
-0001ca40: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
-0001ca50: 203d 2066 6c6f 6f72 286c 6576 6572 6167   = floor(leverag
-0001ca60: 6529 0a20 2020 2020 2020 2074 7279 3a0a  e).        try:.
-0001ca70: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0001ca80: 3d20 7365 6c66 2e5f 6170 692e 7365 745f  = self._api.set_
-0001ca90: 6c65 7665 7261 6765 2873 796d 626f 6c3d  leverage(symbol=
-0001caa0: 7061 6972 2c20 6c65 7665 7261 6765 3d6c  pair, leverage=l
-0001cab0: 6576 6572 6167 6529 0a20 2020 2020 2020  everage).       
-0001cac0: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
-0001cad0: 7863 6861 6e67 655f 7265 7370 6f6e 7365  xchange_response
-0001cae0: 2827 7365 745f 6c65 7665 7261 6765 272c  ('set_leverage',
-0001caf0: 2072 6573 290a 2020 2020 2020 2020 6578   res).        ex
-0001cb00: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
-0001cb10: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
-0001cb20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001cb30: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
-0001cb40: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
-0001cb50: 2020 6578 6365 7074 2028 6363 7874 2e42    except (ccxt.B
-0001cb60: 6164 5265 7175 6573 742c 2063 6378 742e  adRequest, ccxt.
-0001cb70: 496e 7375 6666 6963 6965 6e74 4675 6e64  InsufficientFund
-0001cb80: 7329 2061 7320 653a 0a20 2020 2020 2020  s) as e:.       
-0001cb90: 2020 2020 2069 6620 6e6f 7420 6163 6365       if not acce
-0001cba0: 7074 5f66 6169 6c3a 0a20 2020 2020 2020  pt_fail:.       
-0001cbb0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-0001cbc0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbe0: 2020 2066 2743 6f75 6c64 206e 6f74 2073     f'Could not s
-0001cbf0: 6574 206c 6576 6572 6167 6520 6475 6520  et leverage due 
-0001cc00: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
-0001cc10: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
-0001cc20: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-0001cc30: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001cc40: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
-0001cc50: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
-0001cc60: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
-0001cc70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001cc80: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
-0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cca0: 6627 436f 756c 6420 6e6f 7420 7365 7420  f'Could not set 
-0001ccb0: 6c65 7665 7261 6765 2064 7565 2074 6f20  leverage due to 
-0001ccc0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-0001ccd0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-0001cce0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0001ccf0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0001cd00: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0001cd10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001cd20: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0001cd30: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0001cd40: 2065 0a0a 2020 2020 6465 6620 6765 745f   e..    def get_
-0001cd50: 696e 7465 7265 7374 5f72 6174 6528 7365  interest_rate(se
-0001cd60: 6c66 2920 2d3e 2066 6c6f 6174 3a0a 2020  lf) -> float:.  
-0001cd70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001cd80: 2020 5265 7472 6965 7665 2069 6e74 6572    Retrieve inter
-0001cd90: 6573 7420 7261 7465 202d 206e 6563 6573  est rate - neces
-0001cda0: 7361 7279 2066 6f72 204d 6172 6769 6e20  sary for Margin 
-0001cdb0: 7472 6164 696e 672e 0a20 2020 2020 2020  trading..       
-0001cdc0: 2053 686f 756c 6420 6e6f 7420 6361 6c6c   Should not call
-0001cdd0: 2074 6865 2065 7863 6861 6e67 6520 6469   the exchange di
-0001cde0: 7265 6374 6c79 2077 6865 6e20 7573 6564  rectly when used
-0001cdf0: 2066 726f 6d20 6261 636b 7465 7374 696e   from backtestin
-0001ce00: 672e 0a20 2020 2020 2020 2022 2222 0a20  g..        """. 
-0001ce10: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
-0001ce20: 300a 0a20 2020 2064 6566 2066 756e 6469  0..    def fundi
-0001ce30: 6e67 5f66 6565 5f63 7574 6f66 6628 7365  ng_fee_cutoff(se
-0001ce40: 6c66 2c20 6f70 656e 5f64 6174 653a 2064  lf, open_date: d
-0001ce50: 6174 6574 696d 6529 3a0a 2020 2020 2020  atetime):.      
-0001ce60: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0001ce70: 6172 616d 206f 7065 6e5f 6461 7465 3a20  aram open_date: 
-0001ce80: 5468 6520 6f70 656e 2064 6174 6520 666f  The open date fo
-0001ce90: 7220 6120 7472 6164 650a 2020 2020 2020  r a trade.      
-0001cea0: 2020 3a72 6574 7572 6e3a 2054 6865 2063    :return: The c
-0001ceb0: 7574 6f66 6620 6f70 656e 2074 696d 6520  utoff open time 
-0001cec0: 666f 7220 7768 656e 2061 2066 756e 6469  for when a fundi
-0001ced0: 6e67 2066 6565 2069 7320 6368 6172 6765  ng fee is charge
-0001cee0: 640a 2020 2020 2020 2020 2222 220a 2020  d.        """.  
-0001cef0: 2020 2020 2020 7265 7475 726e 206f 7065        return ope
-0001cf00: 6e5f 6461 7465 2e6d 696e 7574 6520 3e20  n_date.minute > 
-0001cf10: 3020 6f72 206f 7065 6e5f 6461 7465 2e73  0 or open_date.s
-0001cf20: 6563 6f6e 6420 3e20 300a 0a20 2020 2040  econd > 0..    @
-0001cf30: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
-0001cf40: 7365 745f 6d61 7267 696e 5f6d 6f64 6528  set_margin_mode(
-0001cf50: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-0001cf60: 206d 6172 6769 6e5f 6d6f 6465 3a20 4d61   margin_mode: Ma
-0001cf70: 7267 696e 4d6f 6465 2c20 6163 6365 7074  rginMode, accept
-0001cf80: 5f66 6169 6c3a 2062 6f6f 6c20 3d20 4661  _fail: bool = Fa
-0001cf90: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0001cfa0: 2020 2020 2020 2020 2020 2020 2070 6172               par
-0001cfb0: 616d 733a 2064 6963 7420 3d20 7b7d 293a  ams: dict = {}):
-0001cfc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001cfd0: 2020 2020 2053 6574 2773 2074 6865 206d       Set's the m
-0001cfe0: 6172 6769 6e20 6d6f 6465 206f 6e20 7468  argin mode on th
-0001cff0: 6520 6578 6368 616e 6765 2074 6f20 6372  e exchange to cr
-0001d000: 6f73 7320 6f72 2069 736f 6c61 7465 6420  oss or isolated 
-0001d010: 666f 7220 6120 7370 6563 6966 6963 2070  for a specific p
-0001d020: 6169 720a 2020 2020 2020 2020 3a70 6172  air.        :par
-0001d030: 616d 2070 6169 723a 2062 6173 652f 7175  am pair: base/qu
-0001d040: 6f74 6520 6375 7272 656e 6379 2070 6169  ote currency pai
-0001d050: 7220 2865 2e67 2e20 2241 4441 2f55 5344  r (e.g. "ADA/USD
-0001d060: 5422 290a 2020 2020 2020 2020 2222 220a  T").        """.
-0001d070: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001d080: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
-0001d090: 275d 206f 7220 6e6f 7420 7365 6c66 2e65  '] or not self.e
-0001d0a0: 7863 6861 6e67 655f 6861 7328 2273 6574  xchange_has("set
-0001d0b0: 4d61 7267 696e 4d6f 6465 2229 3a0a 2020  MarginMode"):.  
-0001d0c0: 2020 2020 2020 2020 2020 2320 536f 6d65            # Some
-0001d0d0: 2065 7863 6861 6e67 6573 206f 6e6c 7920   exchanges only 
-0001d0e0: 7375 7070 6f72 7420 6f6e 6520 6d61 7267  support one marg
-0001d0f0: 696e 5f6d 6f64 6520 7479 7065 0a20 2020  in_mode type.   
-0001d100: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0001d110: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0001d120: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-0001d130: 7365 6c66 2e5f 6170 692e 7365 745f 6d61  self._api.set_ma
-0001d140: 7267 696e 5f6d 6f64 6528 6d61 7267 696e  rgin_mode(margin
-0001d150: 5f6d 6f64 652e 7661 6c75 652c 2070 6169  _mode.value, pai
-0001d160: 722c 2070 6172 616d 7329 0a20 2020 2020  r, params).     
-0001d170: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-0001d180: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
-0001d190: 7365 2827 7365 745f 6d61 7267 696e 5f6d  se('set_margin_m
-0001d1a0: 6f64 6527 2c20 7265 7329 0a20 2020 2020  ode', res).     
-0001d1b0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
-0001d1c0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
-0001d1d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001d1e0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
-0001d1f0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
-0001d200: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0001d210: 7874 2e42 6164 5265 7175 6573 7420 6173  xt.BadRequest as
-0001d220: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0001d230: 6966 206e 6f74 2061 6363 6570 745f 6661  if not accept_fa
-0001d240: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
-0001d250: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-0001d260: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
-0001d270: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0001d280: 436f 756c 6420 6e6f 7420 7365 7420 6d61  Could not set ma
-0001d290: 7267 696e 206d 6f64 6520 6475 6520 746f  rgin mode due to
-0001d2a0: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
-0001d2b0: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
-0001d2c0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
-0001d2d0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
-0001d2e0: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
-0001d2f0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
-0001d300: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
-0001d310: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
-0001d320: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
-0001d330: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-0001d340: 436f 756c 6420 6e6f 7420 7365 7420 6d61  Could not set ma
-0001d350: 7267 696e 206d 6f64 6520 6475 6520 746f  rgin mode due to
-0001d360: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
-0001d370: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
-0001d380: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
-0001d390: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0001d3a0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
-0001d3b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001d3c0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-0001d3d0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
-0001d3e0: 6d20 650a 0a20 2020 2064 6566 205f 6665  m e..    def _fe
-0001d3f0: 7463 685f 616e 645f 6361 6c63 756c 6174  tch_and_calculat
-0001d400: 655f 6675 6e64 696e 675f 6665 6573 280a  e_funding_fees(.
-0001d410: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001d420: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
-0001d430: 0a20 2020 2020 2020 2061 6d6f 756e 743a  .        amount:
-0001d440: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
-0001d450: 6973 5f73 686f 7274 3a20 626f 6f6c 2c0a  is_short: bool,.
-0001d460: 2020 2020 2020 2020 6f70 656e 5f64 6174          open_dat
-0001d470: 653a 2064 6174 6574 696d 652c 0a20 2020  e: datetime,.   
-0001d480: 2020 2020 2063 6c6f 7365 5f64 6174 653a       close_date:
-0001d490: 204f 7074 696f 6e61 6c5b 6461 7465 7469   Optional[dateti
-0001d4a0: 6d65 5d20 3d20 4e6f 6e65 0a20 2020 2029  me] = None.    )
-0001d4b0: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-0001d4c0: 2020 2022 2222 0a20 2020 2020 2020 2046     """.        F
-0001d4d0: 6574 6368 6573 2061 6e64 2063 616c 6375  etches and calcu
-0001d4e0: 6c61 7465 7320 7468 6520 7375 6d20 6f66  lates the sum of
-0001d4f0: 2061 6c6c 2066 756e 6469 6e67 2066 6565   all funding fee
-0001d500: 7320 7468 6174 206f 6363 7572 7265 6420  s that occurred 
-0001d510: 666f 7220 6120 7061 6972 0a20 2020 2020  for a pair.     
-0001d520: 2020 2064 7572 696e 6720 6120 6675 7475     during a futu
-0001d530: 7265 7320 7472 6164 652e 0a20 2020 2020  res trade..     
-0001d540: 2020 204f 6e6c 7920 7573 6564 2064 7572     Only used dur
-0001d550: 696e 6720 6472 792d 7275 6e20 6f72 2069  ing dry-run or i
-0001d560: 6620 7468 6520 6578 6368 616e 6765 2064  f the exchange d
-0001d570: 6f65 7320 6e6f 7420 7072 6f76 6964 6520  oes not provide 
-0001d580: 6120 6675 6e64 696e 675f 7261 7465 7320  a funding_rates 
-0001d590: 656e 6470 6f69 6e74 2e0a 2020 2020 2020  endpoint..      
-0001d5a0: 2020 3a70 6172 616d 2070 6169 723a 2054    :param pair: T
-0001d5b0: 6865 2071 756f 7465 2f62 6173 6520 7061  he quote/base pa
-0001d5c0: 6972 206f 6620 7468 6520 7472 6164 650a  ir of the trade.
-0001d5d0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0001d5e0: 6d6f 756e 743a 2054 6865 2071 7561 6e74  mount: The quant
-0001d5f0: 6974 7920 6f66 2074 6865 2074 7261 6465  ity of the trade
-0001d600: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001d610: 6973 5f73 686f 7274 3a20 7472 6164 6520  is_short: trade 
-0001d620: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
-0001d630: 2020 3a70 6172 616d 206f 7065 6e5f 6461    :param open_da
-0001d640: 7465 3a20 5468 6520 6461 7465 2061 6e64  te: The date and
-0001d650: 2074 696d 6520 7468 6174 2074 6865 2074   time that the t
-0001d660: 7261 6465 2073 7461 7274 6564 0a20 2020  rade started.   
-0001d670: 2020 2020 203a 7061 7261 6d20 636c 6f73       :param clos
-0001d680: 655f 6461 7465 3a20 5468 6520 6461 7465  e_date: The date
-0001d690: 2061 6e64 2074 696d 6520 7468 6174 2074   and time that t
-0001d6a0: 6865 2074 7261 6465 2065 6e64 6564 0a20  he trade ended. 
-0001d6b0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001d6c0: 2020 2020 6966 2073 656c 662e 6675 6e64      if self.fund
-0001d6d0: 696e 675f 6665 655f 6375 746f 6666 286f  ing_fee_cutoff(o
-0001d6e0: 7065 6e5f 6461 7465 293a 0a20 2020 2020  pen_date):.     
-0001d6f0: 2020 2020 2020 206f 7065 6e5f 6461 7465         open_date
-0001d700: 202b 3d20 7469 6d65 6465 6c74 6128 686f   += timedelta(ho
-0001d710: 7572 733d 3129 0a20 2020 2020 2020 2074  urs=1).        t
-0001d720: 696d 6566 7261 6d65 203d 2073 656c 662e  imeframe = self.
-0001d730: 5f66 745f 6861 735b 276d 6172 6b5f 6f68  _ft_has['mark_oh
-0001d740: 6c63 765f 7469 6d65 6672 616d 6527 5d0a  lcv_timeframe'].
-0001d750: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
-0001d760: 655f 6666 203d 2073 656c 662e 5f66 745f  e_ff = self._ft_
-0001d770: 6861 732e 6765 7428 2766 756e 6469 6e67  has.get('funding
-0001d780: 5f66 6565 5f74 696d 6566 7261 6d65 272c  _fee_timeframe',
-0001d790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-0001d7c0: 745f 6861 735b 276d 6172 6b5f 6f68 6c63  t_has['mark_ohlc
-0001d7d0: 765f 7469 6d65 6672 616d 6527 5d29 0a0a  v_timeframe'])..
-0001d7e0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-0001d7f0: 6c6f 7365 5f64 6174 653a 0a20 2020 2020  lose_date:.     
-0001d800: 2020 2020 2020 2063 6c6f 7365 5f64 6174         close_dat
-0001d810: 6520 3d20 6461 7465 7469 6d65 2e6e 6f77  e = datetime.now
-0001d820: 2874 696d 657a 6f6e 652e 7574 6329 0a20  (timezone.utc). 
-0001d830: 2020 2020 2020 206f 7065 6e5f 7469 6d65         open_time
-0001d840: 7374 616d 7020 3d20 696e 7428 7469 6d65  stamp = int(time
-0001d850: 6672 616d 655f 746f 5f70 7265 765f 6461  frame_to_prev_da
-0001d860: 7465 2874 696d 6566 7261 6d65 2c20 6f70  te(timeframe, op
-0001d870: 656e 5f64 6174 6529 2e74 696d 6573 7461  en_date).timesta
-0001d880: 6d70 2829 2920 2a20 3130 3030 0a20 2020  mp()) * 1000.   
-0001d890: 2020 2020 2023 2063 6c6f 7365 5f74 696d       # close_tim
-0001d8a0: 6573 7461 6d70 203d 2069 6e74 2863 6c6f  estamp = int(clo
-0001d8b0: 7365 5f64 6174 652e 7469 6d65 7374 616d  se_date.timestam
-0001d8c0: 7028 2929 202a 2031 3030 300a 0a20 2020  p()) * 1000..   
-0001d8d0: 2020 2020 206d 6172 6b5f 636f 6d62 3a20       mark_comb: 
-0001d8e0: 5061 6972 5769 7468 5469 6d65 6672 616d  PairWithTimefram
-0001d8f0: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
-0001d900: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
-0001d910: 652c 2043 616e 646c 6554 7970 652e 6672  e, CandleType.fr
-0001d920: 6f6d 5f73 7472 696e 6728 7365 6c66 2e5f  om_string(self._
-0001d930: 6674 5f68 6173 5b22 6d61 726b 5f6f 686c  ft_has["mark_ohl
-0001d940: 6376 5f70 7269 6365 225d 2929 0a0a 2020  cv_price"]))..  
-0001d950: 2020 2020 2020 6675 6e64 696e 675f 636f        funding_co
-0001d960: 6d62 3a20 5061 6972 5769 7468 5469 6d65  mb: PairWithTime
-0001d970: 6672 616d 6520 3d20 2870 6169 722c 2074  frame = (pair, t
-0001d980: 696d 6566 7261 6d65 5f66 662c 2043 616e  imeframe_ff, Can
-0001d990: 646c 6554 7970 652e 4655 4e44 494e 475f  dleType.FUNDING_
-0001d9a0: 5241 5445 290a 2020 2020 2020 2020 6361  RATE).        ca
-0001d9b0: 6e64 6c65 5f68 6973 746f 7269 6573 203d  ndle_histories =
-0001d9c0: 2073 656c 662e 7265 6672 6573 685f 6c61   self.refresh_la
-0001d9d0: 7465 7374 5f6f 686c 6376 280a 2020 2020  test_ohlcv(.    
-0001d9e0: 2020 2020 2020 2020 5b6d 6172 6b5f 636f          [mark_co
-0001d9f0: 6d62 2c20 6675 6e64 696e 675f 636f 6d62  mb, funding_comb
-0001da00: 5d2c 0a20 2020 2020 2020 2020 2020 2073  ],.            s
-0001da10: 696e 6365 5f6d 733d 6f70 656e 5f74 696d  ince_ms=open_tim
-0001da20: 6573 7461 6d70 2c0a 2020 2020 2020 2020  estamp,.        
-0001da30: 2020 2020 6361 6368 653d 4661 6c73 652c      cache=False,
-0001da40: 0a20 2020 2020 2020 2020 2020 2064 726f  .            dro
-0001da50: 705f 696e 636f 6d70 6c65 7465 3d46 616c  p_incomplete=Fal
-0001da60: 7365 2c0a 2020 2020 2020 2020 290a 2020  se,.        ).  
-0001da70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001da80: 2020 2020 2020 2023 2077 6520 6361 6e27         # we can'
-0001da90: 7420 6173 7375 6d65 2077 6520 616c 7761  t assume we alwa
-0001daa0: 7973 2067 6574 2068 6973 746f 7269 6573  ys get histories
-0001dab0: 202d 2066 6f72 2065 7861 6d70 6c65 2064   - for example d
-0001dac0: 7572 696e 6720 6578 6368 616e 6765 2064  uring exchange d
-0001dad0: 6f77 6e74 696d 6573 0a20 2020 2020 2020  owntimes.       
-0001dae0: 2020 2020 2066 756e 6469 6e67 5f72 6174       funding_rat
-0001daf0: 6573 203d 2063 616e 646c 655f 6869 7374  es = candle_hist
-0001db00: 6f72 6965 735b 6675 6e64 696e 675f 636f  ories[funding_co
-0001db10: 6d62 5d0a 2020 2020 2020 2020 2020 2020  mb].            
-0001db20: 6d61 726b 5f72 6174 6573 203d 2063 616e  mark_rates = can
-0001db30: 646c 655f 6869 7374 6f72 6965 735b 6d61  dle_histories[ma
-0001db40: 726b 5f63 6f6d 625d 0a20 2020 2020 2020  rk_comb].       
-0001db50: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-0001db60: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001db70: 6973 6520 4578 6368 616e 6765 4572 726f  ise ExchangeErro
-0001db80: 7228 2243 6f75 6c64 206e 6f74 2066 696e  r("Could not fin
-0001db90: 6420 6675 6e64 696e 6720 7261 7465 732e  d funding rates.
-0001dba0: 2229 2066 726f 6d20 4e6f 6e65 0a0a 2020  ") from None..  
-0001dbb0: 2020 2020 2020 6675 6e64 696e 675f 6d61        funding_ma
-0001dbc0: 726b 5f72 6174 6573 203d 2073 656c 662e  rk_rates = self.
-0001dbd0: 636f 6d62 696e 655f 6675 6e64 696e 675f  combine_funding_
-0001dbe0: 616e 645f 6d61 726b 280a 2020 2020 2020  and_mark(.      
-0001dbf0: 2020 2020 2020 6675 6e64 696e 675f 7261        funding_ra
-0001dc00: 7465 733d 6675 6e64 696e 675f 7261 7465  tes=funding_rate
-0001dc10: 732c 206d 6172 6b5f 7261 7465 733d 6d61  s, mark_rates=ma
-0001dc20: 726b 5f72 6174 6573 290a 0a20 2020 2020  rk_rates)..     
-0001dc30: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
-0001dc40: 616c 6375 6c61 7465 5f66 756e 6469 6e67  alculate_funding
-0001dc50: 5f66 6565 7328 0a20 2020 2020 2020 2020  _fees(.         
-0001dc60: 2020 2066 756e 6469 6e67 5f6d 6172 6b5f     funding_mark_
-0001dc70: 7261 7465 732c 0a20 2020 2020 2020 2020  rates,.         
-0001dc80: 2020 2061 6d6f 756e 743d 616d 6f75 6e74     amount=amount
-0001dc90: 2c0a 2020 2020 2020 2020 2020 2020 6973  ,.            is
-0001dca0: 5f73 686f 7274 3d69 735f 7368 6f72 742c  _short=is_short,
-0001dcb0: 0a20 2020 2020 2020 2020 2020 206f 7065  .            ope
-0001dcc0: 6e5f 6461 7465 3d6f 7065 6e5f 6461 7465  n_date=open_date
-0001dcd0: 2c0a 2020 2020 2020 2020 2020 2020 636c  ,.            cl
-0001dce0: 6f73 655f 6461 7465 3d63 6c6f 7365 5f64  ose_date=close_d
-0001dcf0: 6174 650a 2020 2020 2020 2020 290a 0a20  ate.        ).. 
-0001dd00: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-0001dd10: 0a20 2020 2064 6566 2063 6f6d 6269 6e65  .    def combine
-0001dd20: 5f66 756e 6469 6e67 5f61 6e64 5f6d 6172  _funding_and_mar
-0001dd30: 6b28 6675 6e64 696e 675f 7261 7465 733a  k(funding_rates:
-0001dd40: 2044 6174 6146 7261 6d65 2c20 6d61 726b   DataFrame, mark
-0001dd50: 5f72 6174 6573 3a20 4461 7461 4672 616d  _rates: DataFram
-0001dd60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd80: 2020 2020 6675 7475 7265 735f 6675 6e64      futures_fund
-0001dd90: 696e 675f 7261 7465 3a20 4f70 7469 6f6e  ing_rate: Option
-0001dda0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2920  al[int] = None) 
-0001ddb0: 2d3e 2044 6174 6146 7261 6d65 3a0a 2020  -> DataFrame:.  
-0001ddc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001ddd0: 2020 436f 6d62 696e 6520 6675 6e64 696e    Combine fundin
-0001dde0: 672d 7261 7465 7320 616e 6420 6d61 726b  g-rates and mark
-0001ddf0: 2d72 6174 6573 2064 6174 6166 7261 6d65  -rates dataframe
-0001de00: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-0001de10: 2066 756e 6469 6e67 5f72 6174 6573 3a20   funding_rates: 
-0001de20: 4461 7461 6672 616d 6520 636f 6e74 6169  Dataframe contai
-0001de30: 6e69 6e67 2046 756e 6469 6e67 2072 6174  ning Funding rat
-0001de40: 6573 2028 5479 7065 2046 554e 4449 4e47  es (Type FUNDING
-0001de50: 5f52 4154 4529 0a20 2020 2020 2020 203a  _RATE).        :
-0001de60: 7061 7261 6d20 6d61 726b 5f72 6174 6573  param mark_rates
-0001de70: 3a20 4461 7461 6672 616d 6520 636f 6e74  : Dataframe cont
-0001de80: 6169 6e69 6e67 204d 6172 6b20 7261 7465  aining Mark rate
-0001de90: 7320 2854 7970 6520 6d61 726b 5f6f 686c  s (Type mark_ohl
-0001dea0: 6376 5f70 7269 6365 290a 2020 2020 2020  cv_price).      
-0001deb0: 2020 3a70 6172 616d 2066 7574 7572 6573    :param futures
-0001dec0: 5f66 756e 6469 6e67 5f72 6174 653a 2046  _funding_rate: F
-0001ded0: 616b 6520 6675 6e64 696e 6720 7261 7465  ake funding rate
-0001dee0: 2074 6f20 7573 6520 6966 2066 756e 6469   to use if fundi
-0001def0: 6e67 5f72 6174 6573 2061 7265 206e 6f74  ng_rates are not
-0001df00: 2061 7661 696c 6162 6c65 0a20 2020 2020   available.     
-0001df10: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001df20: 6620 6675 7475 7265 735f 6675 6e64 696e  f futures_fundin
-0001df30: 675f 7261 7465 2069 7320 4e6f 6e65 3a0a  g_rate is None:.
-0001df40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001df50: 726e 206d 6172 6b5f 7261 7465 732e 6d65  rn mark_rates.me
-0001df60: 7267 6528 0a20 2020 2020 2020 2020 2020  rge(.           
-0001df70: 2020 2020 2066 756e 6469 6e67 5f72 6174       funding_rat
-0001df80: 6573 2c20 6f6e 3d27 6461 7465 272c 2068  es, on='date', h
-0001df90: 6f77 3d22 696e 6e65 7222 2c20 7375 6666  ow="inner", suff
-0001dfa0: 6978 6573 3d5b 225f 6d61 726b 222c 2022  ixes=["_mark", "
-0001dfb0: 5f66 756e 6422 5d29 0a20 2020 2020 2020  _fund"]).       
-0001dfc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001dfd0: 2020 2069 6620 6c65 6e28 6675 6e64 696e     if len(fundin
-0001dfe0: 675f 7261 7465 7329 203d 3d20 303a 0a20  g_rates) == 0:. 
-0001dff0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001e000: 204e 6f20 6675 6e64 696e 6720 7261 7465   No funding rate
-0001e010: 2063 616e 646c 6573 202d 2066 756c 6c20   candles - full 
-0001e020: 6669 6c6c 7570 2077 6974 6820 6661 6c6c  fillup with fall
-0001e030: 6261 636b 2076 6172 6961 626c 650a 2020  back variable.  
-0001e040: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0001e050: 726b 5f72 6174 6573 5b27 6f70 656e 5f66  rk_rates['open_f
-0001e060: 756e 6427 5d20 3d20 6675 7475 7265 735f  und'] = futures_
-0001e070: 6675 6e64 696e 675f 7261 7465 0a20 2020  funding_rate.   
-0001e080: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001e090: 7572 6e20 6d61 726b 5f72 6174 6573 2e72  urn mark_rates.r
-0001e0a0: 656e 616d 6528 0a20 2020 2020 2020 2020  ename(.         
-0001e0b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001e0c0: 6f6c 756d 6e73 3d7b 276f 7065 6e27 3a20  olumns={'open': 
-0001e0d0: 276f 7065 6e5f 6d61 726b 272c 0a20 2020  'open_mark',.   
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0001e100: 6c6f 7365 273a 2027 636c 6f73 655f 6d61  lose': 'close_ma
-0001e110: 726b 272c 0a20 2020 2020 2020 2020 2020  rk',.           
-0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e130: 2020 2020 2020 2768 6967 6827 3a20 2768        'high': 'h
-0001e140: 6967 685f 6d61 726b 272c 0a20 2020 2020  igh_mark',.     
-0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2020 2020 2020 2020 276c 6f77              'low
-0001e170: 273a 2027 6c6f 775f 6d61 726b 272c 0a20  ': 'low_mark',. 
-0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1a0: 2776 6f6c 756d 6527 3a20 2776 6f6c 756d  'volume': 'volum
-0001e1b0: 655f 6d61 726b 277d 290a 0a20 2020 2020  e_mark'})..     
-0001e1c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001e1d0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
-0001e1e0: 696c 6c20 7570 206d 6973 7369 6e67 2066  ill up missing f
-0001e1f0: 756e 6469 6e67 5f72 6174 6520 6361 6e64  unding_rate cand
-0001e200: 6c65 7320 7769 7468 2066 616c 6c62 6163  les with fallbac
-0001e210: 6b20 7661 6c75 650a 2020 2020 2020 2020  k value.        
-0001e220: 2020 2020 2020 2020 636f 6d62 696e 6564          combined
-0001e230: 203d 206d 6172 6b5f 7261 7465 732e 6d65   = mark_rates.me
-0001e240: 7267 6528 0a20 2020 2020 2020 2020 2020  rge(.           
-0001e250: 2020 2020 2020 2020 2066 756e 6469 6e67           funding
-0001e260: 5f72 6174 6573 2c20 6f6e 3d27 6461 7465  _rates, on='date
-0001e270: 272c 2068 6f77 3d22 6f75 7465 7222 2c20  ', how="outer", 
-0001e280: 7375 6666 6978 6573 3d5b 225f 6d61 726b  suffixes=["_mark
-0001e290: 222c 2022 5f66 756e 6422 5d0a 2020 2020  ", "_fund"].    
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e2c0: 2020 636f 6d62 696e 6564 5b27 6f70 656e    combined['open
-0001e2d0: 5f66 756e 6427 5d20 3d20 636f 6d62 696e  _fund'] = combin
-0001e2e0: 6564 5b27 6f70 656e 5f66 756e 6427 5d2e  ed['open_fund'].
-0001e2f0: 6669 6c6c 6e61 2866 7574 7572 6573 5f66  fillna(futures_f
-0001e300: 756e 6469 6e67 5f72 6174 6529 0a20 2020  unding_rate).   
-0001e310: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001e320: 7572 6e20 636f 6d62 696e 6564 0a0a 2020  urn combined..  
-0001e330: 2020 6465 6620 6361 6c63 756c 6174 655f    def calculate_
-0001e340: 6675 6e64 696e 675f 6665 6573 280a 2020  funding_fees(.  
-0001e350: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001e360: 2020 2020 6466 3a20 4461 7461 4672 616d      df: DataFram
-0001e370: 652c 0a20 2020 2020 2020 2061 6d6f 756e  e,.        amoun
-0001e380: 743a 2066 6c6f 6174 2c0a 2020 2020 2020  t: float,.      
-0001e390: 2020 6973 5f73 686f 7274 3a20 626f 6f6c    is_short: bool
-0001e3a0: 2c0a 2020 2020 2020 2020 6f70 656e 5f64  ,.        open_d
-0001e3b0: 6174 653a 2064 6174 6574 696d 652c 0a20  ate: datetime,. 
-0001e3c0: 2020 2020 2020 2063 6c6f 7365 5f64 6174         close_dat
-0001e3d0: 653a 204f 7074 696f 6e61 6c5b 6461 7465  e: Optional[date
-0001e3e0: 7469 6d65 5d20 3d20 4e6f 6e65 2c0a 2020  time] = None,.  
-0001e3f0: 2020 2020 2020 7469 6d65 5f69 6e5f 7261        time_in_ra
-0001e400: 7469 6f3a 204f 7074 696f 6e61 6c5b 666c  tio: Optional[fl
-0001e410: 6f61 745d 203d 204e 6f6e 650a 2020 2020  oat] = None.    
-0001e420: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-0001e430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001e440: 6361 6c63 756c 6174 6573 2074 6865 2073  calculates the s
-0001e450: 756d 206f 6620 616c 6c20 6675 6e64 696e  um of all fundin
-0001e460: 6720 6665 6573 2074 6861 7420 6f63 6375  g fees that occu
-0001e470: 7272 6564 2066 6f72 2061 2070 6169 7220  rred for a pair 
-0001e480: 6475 7269 6e67 2061 2066 7574 7572 6573  during a futures
-0001e490: 2074 7261 6465 0a20 2020 2020 2020 203a   trade.        :
-0001e4a0: 7061 7261 6d20 6466 3a20 4461 7461 6672  param df: Datafr
-0001e4b0: 616d 6520 636f 6e74 6169 6e69 6e67 2063  ame containing c
-0001e4c0: 6f6d 6269 6e65 6420 6675 6e64 696e 6720  ombined funding 
-0001e4d0: 616e 6420 6d61 726b 2072 6174 6573 0a20  and mark rates. 
-0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4f0: 2020 6173 2060 6f70 656e 5f66 756e 6460    as `open_fund`
-0001e500: 2061 6e64 2060 6f70 656e 5f6d 6172 6b60   and `open_mark`
-0001e510: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001e520: 2061 6d6f 756e 743a 2054 6865 2071 7561   amount: The qua
-0001e530: 6e74 6974 7920 6f66 2074 6865 2074 7261  ntity of the tra
-0001e540: 6465 0a20 2020 2020 2020 203a 7061 7261  de.        :para
-0001e550: 6d20 6973 5f73 686f 7274 3a20 7472 6164  m is_short: trad
-0001e560: 6520 6469 7265 6374 696f 6e0a 2020 2020  e direction.    
-0001e570: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
-0001e580: 6461 7465 3a20 5468 6520 6461 7465 2061  date: The date a
-0001e590: 6e64 2074 696d 6520 7468 6174 2074 6865  nd time that the
-0001e5a0: 2074 7261 6465 2073 7461 7274 6564 0a20   trade started. 
-0001e5b0: 2020 2020 2020 203a 7061 7261 6d20 636c         :param cl
-0001e5c0: 6f73 655f 6461 7465 3a20 5468 6520 6461  ose_date: The da
-0001e5d0: 7465 2061 6e64 2074 696d 6520 7468 6174  te and time that
-0001e5e0: 2074 6865 2074 7261 6465 2065 6e64 6564   the trade ended
-0001e5f0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001e600: 7469 6d65 5f69 6e5f 7261 7469 6f3a 204e  time_in_ratio: N
-0001e610: 6f74 2075 7365 6420 6279 206d 6f73 7420  ot used by most 
-0001e620: 6578 6368 616e 6765 2063 6c61 7373 6573  exchange classes
-0001e630: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001e640: 2020 2020 2066 6565 733a 2066 6c6f 6174       fees: float
-0001e650: 203d 2030 0a0a 2020 2020 2020 2020 6966   = 0..        if
-0001e660: 206e 6f74 2064 662e 656d 7074 793a 0a20   not df.empty:. 
-0001e670: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
-0001e680: 6466 5b28 6466 5b27 6461 7465 275d 203e  df[(df['date'] >
-0001e690: 3d20 6f70 656e 5f64 6174 6529 2026 2028  = open_date) & (
-0001e6a0: 6466 5b27 6461 7465 275d 203c 3d20 636c  df['date'] <= cl
-0001e6b0: 6f73 655f 6461 7465 295d 0a20 2020 2020  ose_date)].     
-0001e6c0: 2020 2020 2020 2066 6565 7320 3d20 7375         fees = su
-0001e6d0: 6d28 6466 5b27 6f70 656e 5f66 756e 6427  m(df['open_fund'
-0001e6e0: 5d20 2a20 6466 5b27 6f70 656e 5f6d 6172  ] * df['open_mar
-0001e6f0: 6b27 5d20 2a20 616d 6f75 6e74 290a 0a20  k'] * amount).. 
-0001e700: 2020 2020 2020 2023 204e 6567 6174 6520         # Negate 
-0001e710: 6665 6573 2066 6f72 206c 6f6e 6773 2061  fees for longs a
-0001e720: 7320 6675 6e64 696e 675f 6665 6573 2065  s funding_fees e
-0001e730: 7870 6563 7473 2069 7420 7468 6973 2077  xpects it this w
-0001e740: 6179 2062 6173 6564 206f 6e20 6c69 7665  ay based on live
-0001e750: 2065 6e64 706f 696e 7473 2e0a 2020 2020   endpoints..    
-0001e760: 2020 2020 7265 7475 726e 2066 6565 7320      return fees 
-0001e770: 6966 2069 735f 7368 6f72 7420 656c 7365  if is_short else
-0001e780: 202d 6665 6573 0a0a 2020 2020 6465 6620   -fees..    def 
-0001e790: 6765 745f 6675 6e64 696e 675f 6665 6573  get_funding_fees
-0001e7a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0001e7b0: 6c66 2c20 7061 6972 3a20 7374 722c 2061  lf, pair: str, a
-0001e7c0: 6d6f 756e 743a 2066 6c6f 6174 2c20 6973  mount: float, is
-0001e7d0: 5f73 686f 7274 3a20 626f 6f6c 2c20 6f70  _short: bool, op
-0001e7e0: 656e 5f64 6174 653a 2064 6174 6574 696d  en_date: datetim
-0001e7f0: 6529 202d 3e20 666c 6f61 743a 0a20 2020  e) -> float:.   
-0001e800: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001e810: 2046 6574 6368 2066 756e 6469 6e67 2066   Fetch funding f
-0001e820: 6565 732c 2065 6974 6865 7220 6672 6f6d  ees, either from
-0001e830: 2074 6865 2065 7863 6861 6e67 6520 286c   the exchange (l
-0001e840: 6976 6529 206f 7220 6361 6c63 756c 6174  ive) or calculat
-0001e850: 6573 2074 6865 6d0a 2020 2020 2020 2020  es them.        
-0001e860: 6261 7365 6420 6f6e 2066 756e 6469 6e67  based on funding
-0001e870: 2072 6174 652f 6d61 726b 2070 7269 6365   rate/mark price
-0001e880: 2068 6973 746f 7279 0a20 2020 2020 2020   history.       
-0001e890: 203a 7061 7261 6d20 7061 6972 3a20 5468   :param pair: Th
-0001e8a0: 6520 7175 6f74 652f 6261 7365 2070 6169  e quote/base pai
-0001e8b0: 7220 6f66 2074 6865 2074 7261 6465 0a20  r of the trade. 
-0001e8c0: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
-0001e8d0: 5f73 686f 7274 3a20 7472 6164 6520 6469  _short: trade di
-0001e8e0: 7265 6374 696f 6e0a 2020 2020 2020 2020  rection.        
-0001e8f0: 3a70 6172 616d 2061 6d6f 756e 743a 2054  :param amount: T
-0001e900: 7261 6465 2061 6d6f 756e 740a 2020 2020  rade amount.    
-0001e910: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
-0001e920: 6461 7465 3a20 4f70 656e 2064 6174 6520  date: Open date 
-0001e930: 6f66 2074 6865 2074 7261 6465 0a20 2020  of the trade.   
-0001e940: 2020 2020 203a 7265 7475 726e 3a20 6675       :return: fu
-0001e950: 6e64 696e 6720 6665 6520 7369 6e63 6520  nding fee since 
-0001e960: 6f70 656e 5f64 6174 650a 2020 2020 2020  open_date.      
-0001e970: 2020 3a72 6169 7365 733a 2045 7863 6861    :raises: Excha
-0001e980: 6e67 6545 7272 6f72 2069 6620 736f 6d65  ngeError if some
-0001e990: 7468 696e 6720 676f 6573 2077 726f 6e67  thing goes wrong
-0001e9a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001e9b0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
-0001e9c0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-0001e9d0: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-0001e9e0: 533a 0a20 2020 2020 2020 2020 2020 2069  S:.            i
-0001e9f0: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
-0001ea00: 6472 795f 7275 6e27 5d3a 0a20 2020 2020  dry_run']:.     
-0001ea10: 2020 2020 2020 2020 2020 2066 756e 6469             fundi
-0001ea20: 6e67 5f66 6565 7320 3d20 7365 6c66 2e5f  ng_fees = self._
-0001ea30: 6665 7463 685f 616e 645f 6361 6c63 756c  fetch_and_calcul
-0001ea40: 6174 655f 6675 6e64 696e 675f 6665 6573  ate_funding_fees
-0001ea50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001ea60: 2020 2020 2020 7061 6972 2c20 616d 6f75        pair, amou
-0001ea70: 6e74 2c20 6973 5f73 686f 7274 2c20 6f70  nt, is_short, op
-0001ea80: 656e 5f64 6174 6529 0a20 2020 2020 2020  en_date).       
-0001ea90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001eaa0: 2020 2020 2020 2020 2020 2066 756e 6469             fundi
-0001eab0: 6e67 5f66 6565 7320 3d20 7365 6c66 2e5f  ng_fees = self._
-0001eac0: 6765 745f 6675 6e64 696e 675f 6665 6573  get_funding_fees
-0001ead0: 5f66 726f 6d5f 6578 6368 616e 6765 2870  _from_exchange(p
-0001eae0: 6169 722c 206f 7065 6e5f 6461 7465 290a  air, open_date).
-0001eaf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001eb00: 726e 2066 756e 6469 6e67 5f66 6565 730a  rn funding_fees.
-0001eb10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001eb20: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001eb30: 2030 2e30 0a0a 2020 2020 6465 6620 6765   0.0..    def ge
-0001eb40: 745f 6c69 7175 6964 6174 696f 6e5f 7072  t_liquidation_pr
-0001eb50: 6963 6528 0a20 2020 2020 2020 2073 656c  ice(.        sel
-0001eb60: 662c 0a20 2020 2020 2020 2070 6169 723a  f,.        pair:
-0001eb70: 2073 7472 2c0a 2020 2020 2020 2020 2320   str,.        # 
-0001eb80: 4472 792d 7275 6e0a 2020 2020 2020 2020  Dry-run.        
-0001eb90: 6f70 656e 5f72 6174 653a 2066 6c6f 6174  open_rate: float
-0001eba0: 2c20 2020 2320 456e 7472 7920 7072 6963  ,   # Entry pric
-0001ebb0: 6520 6f66 2070 6f73 6974 696f 6e0a 2020  e of position.  
-0001ebc0: 2020 2020 2020 6973 5f73 686f 7274 3a20        is_short: 
-0001ebd0: 626f 6f6c 2c0a 2020 2020 2020 2020 616d  bool,.        am
-0001ebe0: 6f75 6e74 3a20 666c 6f61 742c 2020 2320  ount: float,  # 
-0001ebf0: 4162 736f 6c75 7465 2076 616c 7565 206f  Absolute value o
-0001ec00: 6620 706f 7369 7469 6f6e 2073 697a 650a  f position size.
-0001ec10: 2020 2020 2020 2020 7374 616b 655f 616d          stake_am
-0001ec20: 6f75 6e74 3a20 666c 6f61 742c 0a20 2020  ount: float,.   
-0001ec30: 2020 2020 206c 6576 6572 6167 653a 2066       leverage: f
-0001ec40: 6c6f 6174 2c0a 2020 2020 2020 2020 7761  loat,.        wa
-0001ec50: 6c6c 6574 5f62 616c 616e 6365 3a20 666c  llet_balance: fl
-0001ec60: 6f61 742c 0a20 2020 2020 2020 206d 6d5f  oat,.        mm_
-0001ec70: 6578 5f31 3a20 666c 6f61 7420 3d20 302e  ex_1: float = 0.
-0001ec80: 302c 2020 2320 2842 696e 616e 6365 2920  0,  # (Binance) 
-0001ec90: 4372 6f73 7320 6f6e 6c79 0a20 2020 2020  Cross only.     
-0001eca0: 2020 2075 706e 6c5f 6578 5f31 3a20 666c     upnl_ex_1: fl
-0001ecb0: 6f61 7420 3d20 302e 302c 2020 2320 2842  oat = 0.0,  # (B
-0001ecc0: 696e 616e 6365 2920 4372 6f73 7320 6f6e  inance) Cross on
-0001ecd0: 6c79 0a20 2020 2029 202d 3e20 4f70 7469  ly.    ) -> Opti
-0001ece0: 6f6e 616c 5b66 6c6f 6174 5d3a 0a20 2020  onal[float]:.   
-0001ecf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001ed00: 2053 6574 2773 2074 6865 206d 6172 6769   Set's the margi
-0001ed10: 6e20 6d6f 6465 206f 6e20 7468 6520 6578  n mode on the ex
-0001ed20: 6368 616e 6765 2074 6f20 6372 6f73 7320  change to cross 
-0001ed30: 6f72 2069 736f 6c61 7465 6420 666f 7220  or isolated for 
-0001ed40: 6120 7370 6563 6966 6963 2070 6169 720a  a specific pair.
-0001ed50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ed60: 2020 2020 6966 2073 656c 662e 7472 6164      if self.trad
-0001ed70: 696e 675f 6d6f 6465 203d 3d20 5472 6164  ing_mode == Trad
-0001ed80: 696e 674d 6f64 652e 5350 4f54 3a0a 2020  ingMode.SPOT:.  
-0001ed90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001eda0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-0001edb0: 6966 2028 7365 6c66 2e74 7261 6469 6e67  if (self.trading
-0001edc0: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
-0001edd0: 4d6f 6465 2e46 5554 5552 4553 293a 0a20  Mode.FUTURES):. 
-0001ede0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001edf0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-0001ee00: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-0001ee10: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
-0001ee20: 616d 657d 2064 6f65 7320 6e6f 7420 7375  ame} does not su
-0001ee30: 7070 6f72 7420 7b73 656c 662e 6d61 7267  pport {self.marg
-0001ee40: 696e 5f6d 6f64 657d 207b 7365 6c66 2e74  in_mode} {self.t
-0001ee50: 7261 6469 6e67 5f6d 6f64 657d 2229 0a0a  rading_mode}")..
-0001ee60: 2020 2020 2020 2020 6c69 7175 6964 6174          liquidat
-0001ee70: 696f 6e5f 7072 6963 6520 3d20 4e6f 6e65  ion_price = None
-0001ee80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001ee90: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
-0001eea0: 6e27 5d20 6f72 206e 6f74 2073 656c 662e  n'] or not self.
-0001eeb0: 6578 6368 616e 6765 5f68 6173 2822 6665  exchange_has("fe
-0001eec0: 7463 6850 6f73 6974 696f 6e73 2229 3a0a  tchPositions"):.
-0001eed0: 0a20 2020 2020 2020 2020 2020 206c 6971  .            liq
-0001eee0: 7569 6461 7469 6f6e 5f70 7269 6365 203d  uidation_price =
-0001eef0: 2073 656c 662e 6472 795f 7275 6e5f 6c69   self.dry_run_li
-0001ef00: 7175 6964 6174 696f 6e5f 7072 6963 6528  quidation_price(
-0001ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef20: 2070 6169 723d 7061 6972 2c0a 2020 2020   pair=pair,.    
-0001ef30: 2020 2020 2020 2020 2020 2020 6f70 656e              open
-0001ef40: 5f72 6174 653d 6f70 656e 5f72 6174 652c  _rate=open_rate,
-0001ef50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ef60: 2069 735f 7368 6f72 743d 6973 5f73 686f   is_short=is_sho
-0001ef70: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
-0001ef80: 2020 2020 616d 6f75 6e74 3d61 6d6f 756e      amount=amoun
-0001ef90: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0001efa0: 2020 206c 6576 6572 6167 653d 6c65 7665     leverage=leve
-0001efb0: 7261 6765 2c0a 2020 2020 2020 2020 2020  rage,.          
-0001efc0: 2020 2020 2020 7374 616b 655f 616d 6f75        stake_amou
-0001efd0: 6e74 3d73 7461 6b65 5f61 6d6f 756e 742c  nt=stake_amount,
-0001efe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eff0: 2077 616c 6c65 745f 6261 6c61 6e63 653d   wallet_balance=
-0001f000: 7761 6c6c 6574 5f62 616c 616e 6365 2c0a  wallet_balance,.
-0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f020: 6d6d 5f65 785f 313d 6d6d 5f65 785f 312c  mm_ex_1=mm_ex_1,
-0001f030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f040: 2075 706e 6c5f 6578 5f31 3d75 706e 6c5f   upnl_ex_1=upnl_
-0001f050: 6578 5f31 0a20 2020 2020 2020 2020 2020  ex_1.           
-0001f060: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-0001f070: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
-0001f080: 6974 696f 6e73 203d 2073 656c 662e 6665  itions = self.fe
-0001f090: 7463 685f 706f 7369 7469 6f6e 7328 7061  tch_positions(pa
-0001f0a0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-0001f0b0: 6966 206c 656e 2870 6f73 6974 696f 6e73  if len(positions
-0001f0c0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-0001f0d0: 2020 2020 2020 2070 6f73 203d 2070 6f73         pos = pos
-0001f0e0: 6974 696f 6e73 5b30 5d0a 2020 2020 2020  itions[0].      
-0001f0f0: 2020 2020 2020 2020 2020 6c69 7175 6964            liquid
-0001f100: 6174 696f 6e5f 7072 6963 6520 3d20 706f  ation_price = po
-0001f110: 735b 276c 6971 7569 6461 7469 6f6e 5072  s['liquidationPr
-0001f120: 6963 6527 5d0a 0a20 2020 2020 2020 2069  ice']..        i
-0001f130: 6620 6c69 7175 6964 6174 696f 6e5f 7072  f liquidation_pr
-0001f140: 6963 6520 6973 206e 6f74 204e 6f6e 653a  ice is not None:
-0001f150: 0a20 2020 2020 2020 2020 2020 2062 7566  .            buf
-0001f160: 6665 725f 616d 6f75 6e74 203d 2061 6273  fer_amount = abs
-0001f170: 286f 7065 6e5f 7261 7465 202d 206c 6971  (open_rate - liq
-0001f180: 7569 6461 7469 6f6e 5f70 7269 6365 2920  uidation_price) 
-0001f190: 2a20 7365 6c66 2e6c 6971 7569 6461 7469  * self.liquidati
-0001f1a0: 6f6e 5f62 7566 6665 720a 2020 2020 2020  on_buffer.      
-0001f1b0: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
-0001f1c0: 6e5f 7072 6963 655f 6275 6666 6572 203d  n_price_buffer =
-0001f1d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0001f1e0: 2020 206c 6971 7569 6461 7469 6f6e 5f70     liquidation_p
-0001f1f0: 7269 6365 202d 2062 7566 6665 725f 616d  rice - buffer_am
-0001f200: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
-0001f210: 2020 2020 2069 6620 6973 5f73 686f 7274       if is_short
-0001f220: 2065 6c73 650a 2020 2020 2020 2020 2020   else.          
-0001f230: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
-0001f240: 6e5f 7072 6963 6520 2b20 6275 6666 6572  n_price + buffer
-0001f250: 5f61 6d6f 756e 740a 2020 2020 2020 2020  _amount.        
-0001f260: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0001f270: 2020 7265 7475 726e 206d 6178 286c 6971    return max(liq
-0001f280: 7569 6461 7469 6f6e 5f70 7269 6365 5f62  uidation_price_b
-0001f290: 7566 6665 722c 2030 2e30 290a 2020 2020  uffer, 0.0).    
-0001f2a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f2b0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0001f2c0: 650a 0a20 2020 2064 6566 2064 7279 5f72  e..    def dry_r
-0001f2d0: 756e 5f6c 6971 7569 6461 7469 6f6e 5f70  un_liquidation_p
-0001f2e0: 7269 6365 280a 2020 2020 2020 2020 7365  rice(.        se
-0001f2f0: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
-0001f300: 3a20 7374 722c 0a20 2020 2020 2020 206f  : str,.        o
-0001f310: 7065 6e5f 7261 7465 3a20 666c 6f61 742c  pen_rate: float,
-0001f320: 2020 2023 2045 6e74 7279 2070 7269 6365     # Entry price
-0001f330: 206f 6620 706f 7369 7469 6f6e 0a20 2020   of position.   
-0001f340: 2020 2020 2069 735f 7368 6f72 743a 2062       is_short: b
-0001f350: 6f6f 6c2c 0a20 2020 2020 2020 2061 6d6f  ool,.        amo
-0001f360: 756e 743a 2066 6c6f 6174 2c0a 2020 2020  unt: float,.    
-0001f370: 2020 2020 7374 616b 655f 616d 6f75 6e74      stake_amount
-0001f380: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
-0001f390: 206c 6576 6572 6167 653a 2066 6c6f 6174   leverage: float
-0001f3a0: 2c0a 2020 2020 2020 2020 7761 6c6c 6574  ,.        wallet
-0001f3b0: 5f62 616c 616e 6365 3a20 666c 6f61 742c  _balance: float,
-0001f3c0: 2020 2320 4f72 206d 6172 6769 6e20 6261    # Or margin ba
-0001f3d0: 6c61 6e63 650a 2020 2020 2020 2020 6d6d  lance.        mm
-0001f3e0: 5f65 785f 313a 2066 6c6f 6174 203d 2030  _ex_1: float = 0
-0001f3f0: 2e30 2c20 2023 2028 4269 6e61 6e63 6529  .0,  # (Binance)
-0001f400: 2043 726f 7373 206f 6e6c 790a 2020 2020   Cross only.    
-0001f410: 2020 2020 7570 6e6c 5f65 785f 313a 2066      upnl_ex_1: f
-0001f420: 6c6f 6174 203d 2030 2e30 2c20 2023 2028  loat = 0.0,  # (
-0001f430: 4269 6e61 6e63 6529 2043 726f 7373 206f  Binance) Cross o
-0001f440: 6e6c 790a 2020 2020 2920 2d3e 204f 7074  nly.    ) -> Opt
-0001f450: 696f 6e61 6c5b 666c 6f61 745d 3a0a 2020  ional[float]:.  
-0001f460: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001f470: 2020 496d 706f 7274 616e 743a 204d 7573    Important: Mus
-0001f480: 7420 6265 2066 6574 6368 696e 6720 6461  t be fetching da
-0001f490: 7461 2066 726f 6d20 6361 6368 6564 2076  ta from cached v
-0001f4a0: 616c 7565 7320 6173 2074 6869 7320 6973  alues as this is
-0001f4b0: 2075 7365 6420 6279 2062 6163 6b74 6573   used by backtes
-0001f4c0: 7469 6e67 210a 2020 2020 2020 2020 5045  ting!.        PE
-0001f4d0: 5250 4554 5541 4c3a 0a20 2020 2020 2020  RPETUAL:.       
-0001f4e0: 2020 6761 7465 3a20 6874 7470 733a 2f2f    gate: https://
-0001f4f0: 7777 772e 6761 7465 2e69 6f2f 6865 6c70  www.gate.io/help
-0001f500: 2f66 7574 7572 6573 2f66 7574 7572 6573  /futures/futures
-0001f510: 2f32 3737 3234 2f6c 6971 7569 6461 7469  /27724/liquidati
-0001f520: 6f6e 2d70 7269 6365 2d62 616e 6b72 7570  on-price-bankrup
-0001f530: 7463 792d 7072 6963 650a 2020 2020 2020  tcy-price.      
-0001f540: 2020 203e 204c 6971 7569 6461 7469 6f6e     > Liquidation
-0001f550: 2050 7269 6365 203d 2028 456e 7472 7920   Price = (Entry 
-0001f560: 5072 6963 6520 c2b1 204d 6172 6769 6e20  Price .. Margin 
-0001f570: 2f20 436f 6e74 7261 6374 204d 756c 7469  / Contract Multi
-0001f580: 706c 6965 7220 2f20 5369 7a65 2920 2f0a  plier / Size) /.
-0001f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5b0: 5b20 3120 c2b1 2028 4d61 696e 7465 6e61  [ 1 .. (Maintena
-0001f5c0: 6e63 6520 4d61 7267 696e 2052 6174 696f  nce Margin Ratio
-0001f5d0: 202b 2054 616b 6572 2052 6174 6529 5d0a   + Taker Rate)].
-0001f5e0: 2020 2020 2020 2020 2020 2020 5768 6572              Wher
-0001f5f0: 6569 6e2c 2022 2b22 206f 7220 222d 2220  ein, "+" or "-" 
-0001f600: 6465 7065 6e64 7320 6f6e 2077 6865 7468  depends on wheth
-0001f610: 6572 2074 6865 2063 6f6e 7472 6163 7420  er the contract 
-0001f620: 676f 6573 206c 6f6e 6720 6f72 2073 686f  goes long or sho
-0001f630: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-0001f640: 222d 2220 666f 7220 6c6f 6e67 2c20 616e  "-" for long, an
-0001f650: 6420 222b 2220 666f 7220 7368 6f72 742e  d "+" for short.
-0001f660: 0a0a 2020 2020 2020 2020 206f 6b65 783a  ..         okex:
-0001f670: 2068 7474 7073 3a2f 2f77 7777 2e6f 6b65   https://www.oke
-0001f680: 782e 636f 6d2f 7375 7070 6f72 742f 6863  x.com/support/hc
-0001f690: 2f65 6e2d 7573 2f61 7274 6963 6c65 732f  /en-us/articles/
-0001f6a0: 0a20 2020 2020 2020 2020 2020 2033 3630  .            360
-0001f6b0: 3035 3339 3039 3539 322d 5649 2d49 6e74  053909592-VI-Int
-0001f6c0: 726f 6475 6374 696f 6e2d 746f 2d74 6865  roduction-to-the
-0001f6d0: 2d69 736f 6c61 7465 642d 6d6f 6465 2d6f  -isolated-mode-o
-0001f6e0: 662d 5369 6e67 6c65 2d4d 756c 7469 2d63  f-Single-Multi-c
-0001f6f0: 7572 7265 6e63 792d 506f 7274 666f 6c69  urrency-Portfoli
-0001f700: 6f2d 6d61 7267 696e 0a0a 2020 2020 2020  o-margin..      
-0001f710: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
-0001f720: 6169 7220 746f 2063 616c 6375 6c61 7465  air to calculate
-0001f730: 206c 6971 7569 6461 7469 6f6e 2070 7269   liquidation pri
-0001f740: 6365 2066 6f72 0a20 2020 2020 2020 203a  ce for.        :
-0001f750: 7061 7261 6d20 6f70 656e 5f72 6174 653a  param open_rate:
-0001f760: 2045 6e74 7279 2070 7269 6365 206f 6620   Entry price of 
-0001f770: 706f 7369 7469 6f6e 0a20 2020 2020 2020  position.       
-0001f780: 203a 7061 7261 6d20 6973 5f73 686f 7274   :param is_short
-0001f790: 3a20 5472 7565 2069 6620 7468 6520 7472  : True if the tr
-0001f7a0: 6164 6520 6973 2061 2073 686f 7274 2c20  ade is a short, 
-0001f7b0: 6661 6c73 6520 6f74 6865 7277 6973 650a  false otherwise.
-0001f7c0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0001f7d0: 6d6f 756e 743a 2041 6273 6f6c 7574 6520  mount: Absolute 
-0001f7e0: 7661 6c75 6520 6f66 2070 6f73 6974 696f  value of positio
-0001f7f0: 6e20 7369 7a65 2069 6e63 6c2e 206c 6576  n size incl. lev
-0001f800: 6572 6167 6520 2869 6e20 6261 7365 2063  erage (in base c
-0001f810: 7572 7265 6e63 7929 0a20 2020 2020 2020  urrency).       
-0001f820: 203a 7061 7261 6d20 7374 616b 655f 616d   :param stake_am
-0001f830: 6f75 6e74 3a20 5374 616b 6520 616d 6f75  ount: Stake amou
-0001f840: 6e74 202d 2043 6f6c 6c61 7465 7261 6c20  nt - Collateral 
-0001f850: 696e 2073 6574 746c 6520 6375 7272 656e  in settle curren
-0001f860: 6379 2e0a 2020 2020 2020 2020 3a70 6172  cy..        :par
-0001f870: 616d 206c 6576 6572 6167 653a 204c 6576  am leverage: Lev
-0001f880: 6572 6167 6520 7573 6564 2066 6f72 2074  erage used for t
-0001f890: 6869 7320 706f 7369 7469 6f6e 2e0a 2020  his position..  
-0001f8a0: 2020 2020 2020 3a70 6172 616d 2074 7261        :param tra
-0001f8b0: 6469 6e67 5f6d 6f64 653a 2053 504f 542c  ding_mode: SPOT,
-0001f8c0: 204d 4152 4749 4e2c 2046 5554 5552 4553   MARGIN, FUTURES
-0001f8d0: 2c20 6574 632e 0a20 2020 2020 2020 203a  , etc..        :
-0001f8e0: 7061 7261 6d20 6d61 7267 696e 5f6d 6f64  param margin_mod
-0001f8f0: 653a 2045 6974 6865 7220 4953 4f4c 4154  e: Either ISOLAT
-0001f900: 4544 206f 7220 4352 4f53 530a 2020 2020  ED or CROSS.    
-0001f910: 2020 2020 3a70 6172 616d 2077 616c 6c65      :param walle
-0001f920: 745f 6261 6c61 6e63 653a 2041 6d6f 756e  t_balance: Amoun
-0001f930: 7420 6f66 206d 6172 6769 6e5f 6d6f 6465  t of margin_mode
-0001f940: 2069 6e20 7468 6520 7761 6c6c 6574 2062   in the wallet b
-0001f950: 6569 6e67 2075 7365 6420 746f 2074 7261  eing used to tra
-0001f960: 6465 0a20 2020 2020 2020 2020 2020 2043  de.            C
-0001f970: 726f 7373 2d4d 6172 6769 6e20 4d6f 6465  ross-Margin Mode
-0001f980: 3a20 6372 6f73 7357 616c 6c65 7442 616c  : crossWalletBal
-0001f990: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
-0001f9a0: 2049 736f 6c61 7465 642d 4d61 7267 696e   Isolated-Margin
-0001f9b0: 204d 6f64 653a 2069 736f 6c61 7465 6457   Mode: isolatedW
-0001f9c0: 616c 6c65 7442 616c 616e 6365 0a0a 2020  alletBalance..  
-0001f9d0: 2020 2020 2020 2320 2a20 4e6f 7420 7265        # * Not re
-0001f9e0: 7175 6972 6564 2062 7920 4761 7465 206f  quired by Gate o
-0001f9f0: 7220 4f4b 580a 2020 2020 2020 2020 3a70  r OKX.        :p
-0001fa00: 6172 616d 206d 6d5f 6578 5f31 3a0a 2020  aram mm_ex_1:.  
-0001fa10: 2020 2020 2020 3a70 6172 616d 2075 706e        :param upn
-0001fa20: 6c5f 6578 5f31 3a0a 2020 2020 2020 2020  l_ex_1:.        
-0001fa30: 2222 220a 0a20 2020 2020 2020 206d 6172  """..        mar
-0001fa40: 6b65 7420 3d20 7365 6c66 2e6d 6172 6b65  ket = self.marke
-0001fa50: 7473 5b70 6169 725d 0a20 2020 2020 2020  ts[pair].       
-0001fa60: 2074 616b 6572 5f66 6565 5f72 6174 6520   taker_fee_rate 
-0001fa70: 3d20 6d61 726b 6574 5b27 7461 6b65 7227  = market['taker'
-0001fa80: 5d0a 2020 2020 2020 2020 6d6d 5f72 6174  ].        mm_rat
-0001fa90: 696f 2c20 5f20 3d20 7365 6c66 2e67 6574  io, _ = self.get
-0001faa0: 5f6d 6169 6e74 656e 616e 6365 5f72 6174  _maintenance_rat
-0001fab0: 696f 5f61 6e64 5f61 6d74 2870 6169 722c  io_and_amt(pair,
-0001fac0: 2073 7461 6b65 5f61 6d6f 756e 7429 0a0a   stake_amount)..
-0001fad0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001fae0: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
-0001faf0: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
-0001fb00: 5245 5320 616e 6420 7365 6c66 2e6d 6172  RES and self.mar
-0001fb10: 6769 6e5f 6d6f 6465 203d 3d20 4d61 7267  gin_mode == Marg
-0001fb20: 696e 4d6f 6465 2e49 534f 4c41 5445 443a  inMode.ISOLATED:
-0001fb30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001fb40: 206d 6172 6b65 745b 2769 6e76 6572 7365   market['inverse
-0001fb50: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0001fb60: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0001fb70: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb90: 2020 2020 2246 7265 7174 7261 6465 2064      "Freqtrade d
-0001fba0: 6f65 7320 6e6f 7420 7965 7420 7375 7070  oes not yet supp
-0001fbb0: 6f72 7420 696e 7665 7273 6520 636f 6e74  ort inverse cont
-0001fbc0: 7261 6374 7322 290a 0a20 2020 2020 2020  racts")..       
-0001fbd0: 2020 2020 2076 616c 7565 203d 2077 616c       value = wal
-0001fbe0: 6c65 745f 6261 6c61 6e63 6520 2f20 616d  let_balance / am
-0001fbf0: 6f75 6e74 0a0a 2020 2020 2020 2020 2020  ount..          
-0001fc00: 2020 6d6d 5f72 6174 696f 5f74 616b 6572    mm_ratio_taker
-0001fc10: 203d 2028 6d6d 5f72 6174 696f 202b 2074   = (mm_ratio + t
-0001fc20: 616b 6572 5f66 6565 5f72 6174 6529 0a20  aker_fee_rate). 
-0001fc30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0001fc40: 5f73 686f 7274 3a0a 2020 2020 2020 2020  _short:.        
-0001fc50: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0001fc60: 6f70 656e 5f72 6174 6520 2b20 7661 6c75  open_rate + valu
-0001fc70: 6529 202f 2028 3120 2b20 6d6d 5f72 6174  e) / (1 + mm_rat
-0001fc80: 696f 5f74 616b 6572 290a 2020 2020 2020  io_taker).      
-0001fc90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001fca0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001fcb0: 726e 2028 6f70 656e 5f72 6174 6520 2d20  rn (open_rate - 
-0001fcc0: 7661 6c75 6529 202f 2028 3120 2d20 6d6d  value) / (1 - mm
-0001fcd0: 5f72 6174 696f 5f74 616b 6572 290a 2020  _ratio_taker).  
-0001fce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001fcf0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-0001fd00: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-0001fd10: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-0001fd20: 2020 2020 2246 7265 7174 7261 6465 206f      "Freqtrade o
-0001fd30: 6e6c 7920 7375 7070 6f72 7473 2069 736f  nly supports iso
-0001fd40: 6c61 7465 6420 6675 7475 7265 7320 666f  lated futures fo
-0001fd50: 7220 6c65 7665 7261 6765 2074 7261 6469  r leverage tradi
-0001fd60: 6e67 2229 0a0a 2020 2020 6465 6620 6765  ng")..    def ge
-0001fd70: 745f 6d61 696e 7465 6e61 6e63 655f 7261  t_maintenance_ra
-0001fd80: 7469 6f5f 616e 645f 616d 7428 0a20 2020  tio_and_amt(.   
-0001fd90: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0001fda0: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
-0001fdb0: 2020 2020 2020 6e6f 6d69 6e61 6c5f 7661        nominal_va
-0001fdc0: 6c75 653a 2066 6c6f 6174 2c0a 2020 2020  lue: float,.    
-0001fdd0: 2920 2d3e 2054 7570 6c65 5b66 6c6f 6174  ) -> Tuple[float
-0001fde0: 2c20 4f70 7469 6f6e 616c 5b66 6c6f 6174  , Optional[float
-0001fdf0: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
-0001fe00: 2020 2020 2020 2020 496d 706f 7274 616e          Importan
-0001fe10: 743a 204d 7573 7420 6265 2066 6574 6368  t: Must be fetch
-0001fe20: 696e 6720 6461 7461 2066 726f 6d20 6361  ing data from ca
-0001fe30: 6368 6564 2076 616c 7565 7320 6173 2074  ched values as t
-0001fe40: 6869 7320 6973 2075 7365 6420 6279 2062  his is used by b
-0001fe50: 6163 6b74 6573 7469 6e67 210a 2020 2020  acktesting!.    
-0001fe60: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-0001fe70: 204d 6172 6b65 7420 7379 6d62 6f6c 0a20   Market symbol. 
-0001fe80: 2020 2020 2020 203a 7061 7261 6d20 6e6f         :param no
-0001fe90: 6d69 6e61 6c5f 7661 6c75 653a 2054 6865  minal_value: The
-0001fea0: 2074 6f74 616c 2074 7261 6465 2061 6d6f   total trade amo
-0001feb0: 756e 7420 696e 2071 756f 7465 2063 7572  unt in quote cur
-0001fec0: 7265 6e63 7920 696e 636c 7564 696e 6720  rency including 
-0001fed0: 6c65 7665 7261 6765 0a20 2020 2020 2020  leverage.       
-0001fee0: 206d 6169 6e74 656e 616e 6365 2061 6d6f   maintenance amo
-0001fef0: 756e 7420 6f6e 6c79 206f 6e20 4269 6e61  unt only on Bina
-0001ff00: 6e63 650a 2020 2020 2020 2020 3a72 6574  nce.        :ret
-0001ff10: 7572 6e3a 2028 6d61 696e 7465 6e61 6e63  urn: (maintenanc
-0001ff20: 6520 6d61 7267 696e 2072 6174 696f 2c20  e margin ratio, 
-0001ff30: 6d61 696e 7465 6e61 6e63 6520 616d 6f75  maintenance amou
-0001ff40: 6e74 290a 2020 2020 2020 2020 2222 220a  nt).        """.
-0001ff50: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
-0001ff60: 662e 5f63 6f6e 6669 672e 6765 7428 2772  f._config.get('r
-0001ff70: 756e 6d6f 6465 2729 2069 6e20 4f50 5449  unmode') in OPTI
-0001ff80: 4d49 5a45 5f4d 4f44 4553 0a20 2020 2020  MIZE_MODES.     
-0001ff90: 2020 2020 2020 2020 2020 206f 7220 7365             or se
-0001ffa0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0001ffb0: 2766 6574 6368 4c65 7665 7261 6765 5469  'fetchLeverageTi
-0001ffc0: 6572 7327 290a 2020 2020 2020 2020 2020  ers').          
-0001ffd0: 2020 2020 2020 6f72 2073 656c 662e 6578        or self.ex
-0001ffe0: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-0001fff0: 684d 6172 6b65 744c 6576 6572 6167 6554  hMarketLeverageT
-00020000: 6965 7273 2729 293a 0a0a 2020 2020 2020  iers')):..      
-00020010: 2020 2020 2020 6966 2070 6169 7220 6e6f        if pair no
-00020020: 7420 696e 2073 656c 662e 5f6c 6576 6572  t in self._lever
-00020030: 6167 655f 7469 6572 733a 0a20 2020 2020  age_tiers:.     
-00020040: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00020050: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
-00020060: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-00020070: 2020 2020 2020 2020 2020 2020 6622 4d61              f"Ma
-00020080: 696e 7465 6e61 6e63 6520 6d61 7267 696e  intenance margin
-00020090: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
-000200a0: 2069 7320 756e 6176 6169 6c61 626c 6520   is unavailable 
-000200b0: 666f 7220 7b73 656c 662e 6e61 6d65 7d22  for {self.name}"
-000200c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000200d0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-000200e0: 7061 6972 5f74 6965 7273 203d 2073 656c  pair_tiers = sel
-000200f0: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
-00020100: 735b 7061 6972 5d0a 0a20 2020 2020 2020  s[pair]..       
-00020110: 2020 2020 2066 6f72 2074 6965 7220 696e       for tier in
-00020120: 2072 6576 6572 7365 6428 7061 6972 5f74   reversed(pair_t
-00020130: 6965 7273 293a 0a20 2020 2020 2020 2020  iers):.         
-00020140: 2020 2020 2020 2069 6620 6e6f 6d69 6e61         if nomina
-00020150: 6c5f 7661 6c75 6520 3e3d 2074 6965 725b  l_value >= tier[
-00020160: 276d 696e 4e6f 7469 6f6e 616c 275d 3a0a  'minNotional']:.
-00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020180: 2020 2020 7265 7475 726e 2028 7469 6572      return (tier
-00020190: 5b27 6d61 696e 7465 6e61 6e63 654d 6172  ['maintenanceMar
-000201a0: 6769 6e52 6174 6527 5d2c 2074 6965 725b  ginRate'], tier[
-000201b0: 276d 6169 6e74 416d 7427 5d29 0a0a 2020  'maintAmt'])..  
-000201c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000201d0: 4578 6368 616e 6765 4572 726f 7228 226e  ExchangeError("n
-000201e0: 6f6d 696e 616c 2076 616c 7565 2063 616e  ominal value can
-000201f0: 206e 6f74 2062 6520 6c6f 7765 7220 7468   not be lower th
-00020200: 616e 2030 2229 0a20 2020 2020 2020 2020  an 0").         
-00020210: 2020 2023 2054 6865 206c 6f77 6573 7420     # The lowest 
-00020220: 6e6f 7469 6f6e 616c 5f66 6c6f 6f72 2066  notional_floor f
-00020230: 6f72 2061 6e79 2070 6169 7220 696e 2066  or any pair in f
-00020240: 6574 6368 5f6c 6576 6572 6167 655f 7469  etch_leverage_ti
-00020250: 6572 7320 6973 2061 6c77 6179 7320 3020  ers is always 0 
-00020260: 6265 6361 7573 6520 6974 0a20 2020 2020  because it.     
-00020270: 2020 2020 2020 2023 2064 6573 6372 6962         # describ
-00020280: 6573 2074 6865 206d 696e 2061 6d74 2066  es the min amt f
-00020290: 6f72 2061 2074 6965 722c 2061 6e64 2074  or a tier, and t
-000202a0: 6865 206c 6f77 6573 7420 7469 6572 2077  he lowest tier w
-000202b0: 696c 6c20 616c 7761 7973 2067 6f20 646f  ill always go do
-000202c0: 776e 2074 6f20 300a 2020 2020 2020 2020  wn to 0.        
-000202d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000202e0: 2020 7261 6973 6520 4578 6368 616e 6765    raise Exchange
-000202f0: 4572 726f 7228 6622 4361 6e6e 6f74 2067  Error(f"Cannot g
-00020300: 6574 206d 6169 6e74 656e 616e 6365 2072  et maintenance r
-00020310: 6174 696f 2075 7369 6e67 207b 7365 6c66  atio using {self
-00020320: 2e6e 616d 657d 2229 0a                   .name}").
+0001c3b0: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
+0001c3c0: 2020 2020 2020 2020 2020 2020 2320 5769              # Wi
+0001c3d0: 7468 2074 6865 2074 776f 206c 6576 6572  th the two lever
+0001c3e0: 6167 6520 7469 6572 7320 6265 6c6f 772c  age tiers below,
+0001c3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c400: 2020 2020 2020 2020 2023 202d 2061 2073           # - a s
+0001c410: 7461 6b65 2061 6d6f 756e 7420 6f66 2031  take amount of 1
+0001c420: 3530 2077 6f75 6c64 206d 6561 6e20 6120  50 would mean a 
+0001c430: 6d61 7820 6c65 7665 7261 6765 206f 6620  max leverage of 
+0001c440: 2831 3030 3030 202f 2031 3530 2920 3d20  (10000 / 150) = 
+0001c450: 3636 2e36 360a 2020 2020 2020 2020 2020  66.66.          
+0001c460: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c470: 2d20 7374 616b 6573 2062 656c 6f77 2031  - stakes below 1
+0001c480: 3333 2e33 3320 3d20 6d61 785f 6c65 7620  33.33 = max_lev 
+0001c490: 6f66 2037 350a 2020 2020 2020 2020 2020  of 75.          
+0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c4b0: 2d20 7374 616b 6573 2062 6574 7765 656e  - stakes between
+0001c4c0: 2031 3333 2e33 332d 3230 3020 3d20 6d61   133.33-200 = ma
+0001c4d0: 785f 6c65 7620 6f66 2031 3030 3030 2f73  x_lev of 10000/s
+0001c4e0: 7461 6b65 203d 2035 302e 3031 2d37 342e  take = 50.01-74.
+0001c4f0: 3939 0a20 2020 2020 2020 2020 2020 2020  99.             
+0001c500: 2020 2020 2020 2020 2020 2023 202d 2073             # - s
+0001c510: 7461 6b65 7320 6672 6f6d 2032 3030 202b  takes from 200 +
+0001c520: 2031 3030 3020 3d20 6d61 785f 6c65 7620   1000 = max_lev 
+0001c530: 6f66 2035 300a 2020 2020 2020 2020 2020  of 50.          
+0001c540: 2020 2020 2020 2020 2020 2020 2020 230a                #.
+0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c560: 2020 2020 2020 2020 2320 7b0a 2020 2020          # {.    
+0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c580: 2020 2020 2320 2020 2020 226d 696e 223a      #     "min":
+0001c590: 2030 2c20 2020 2020 2023 2073 7461 6b65   0,      # stake
+0001c5a0: 203d 2030 2e30 0a20 2020 2020 2020 2020   = 0.0.         
+0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c5c0: 2020 2020 2022 6d61 7822 3a20 3130 3030       "max": 1000
+0001c5d0: 302c 2020 2320 6d61 785f 7374 616b 6540  0,  # max_stake@
+0001c5e0: 3735 203d 2031 3030 3030 2f37 3520 3d20  75 = 10000/75 = 
+0001c5f0: 3133 332e 3333 3333 3333 3333 3333 3333  133.333333333333
+0001c600: 3334 0a20 2020 2020 2020 2020 2020 2020  34.             
+0001c610: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0001c620: 2022 6c65 7622 3a20 3735 2c0a 2020 2020   "lev": 75,.    
+0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c640: 2020 2020 2320 7d2c 0a20 2020 2020 2020      # },.       
+0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c660: 2023 207b 0a20 2020 2020 2020 2020 2020   # {.           
+0001c670: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+0001c680: 2020 2022 6d69 6e22 3a20 3130 3030 302c     "min": 10000,
+0001c690: 2020 2320 7374 616b 6520 3d20 3230 302e    # stake = 200.
+0001c6a0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+0001c6b0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0001c6c0: 226d 6178 223a 2035 3030 3030 2c20 2023  "max": 50000,  #
+0001c6d0: 206d 6178 5f73 7461 6b65 4035 3020 3d20   max_stake@50 = 
+0001c6e0: 3530 3030 302f 3530 203d 2031 3030 302e  50000/50 = 1000.
+0001c6f0: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+0001c700: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0001c710: 226c 6576 223a 2035 302c 0a20 2020 2020  "lev": 50,.     
+0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c730: 2020 2023 207d 0a20 2020 2020 2020 2020     # }.         
+0001c740: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c750: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c760: 2020 656c 7365 3a20 2023 2069 6620 6f6e    else:  # if on
+0001c770: 2074 6865 206c 6173 7420 7469 6572 0a20   the last tier. 
+0001c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c790: 2020 2069 6620 7374 616b 655f 616d 6f75     if stake_amou
+0001c7a0: 6e74 203e 2074 6965 725b 276d 6178 4e6f  nt > tier['maxNo
+0001c7b0: 7469 6f6e 616c 275d 3a0a 2020 2020 2020  tional']:.      
+0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7d0: 2020 2320 4966 2073 7461 6b65 2069 7320    # If stake is 
+0001c7e0: 3e20 7468 616e 206d 6178 2074 7261 6465  > than max trade
+0001c7f0: 6162 6c65 2061 6d6f 756e 740a 2020 2020  able amount.    
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
+0001c820: 644f 7264 6572 4578 6365 7074 696f 6e28  dOrderException(
+0001c830: 6627 416d 6f75 6e74 207b 7374 616b 655f  f'Amount {stake_
+0001c840: 616d 6f75 6e74 7d20 746f 6f20 6869 6768  amount} too high
+0001c850: 2066 6f72 207b 7061 6972 7d27 290a 2020   for {pair}').  
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c890: 7265 7475 726e 2074 6965 725b 276d 6178  return tier['max
+0001c8a0: 4c65 7665 7261 6765 275d 0a0a 2020 2020  Leverage']..    
+0001c8b0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0001c8c0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0001c8d0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0001c8e0: 2020 2020 274c 6f6f 7065 6420 7468 726f      'Looped thro
+0001c8f0: 7567 6820 616c 6c20 7469 6572 7320 7769  ugh all tiers wi
+0001c900: 7468 6f75 7420 6669 6e64 696e 6720 6120  thout finding a 
+0001c910: 6d61 7820 6c65 7665 7261 6765 2e20 5368  max leverage. Sh
+0001c920: 6f75 6c64 206e 6576 6572 2062 6520 7265  ould never be re
+0001c930: 6163 6865 6427 0a20 2020 2020 2020 2020  ached'.         
+0001c940: 2020 2029 0a0a 2020 2020 2020 2020 656c     )..        el
+0001c950: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
+0001c960: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
+0001c970: 6f64 652e 4d41 5247 494e 3a20 2023 2053  ode.MARGIN:  # S
+0001c980: 6561 7263 6820 6d61 726b 6574 732e 6c69  earch markets.li
+0001c990: 6d69 7473 2066 6f72 206d 6178 206c 6576  mits for max lev
+0001c9a0: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+0001c9b0: 6b65 7420 3d20 7365 6c66 2e6d 6172 6b65  ket = self.marke
+0001c9c0: 7473 5b70 6169 725d 0a20 2020 2020 2020  ts[pair].       
+0001c9d0: 2020 2020 2069 6620 6d61 726b 6574 5b27       if market['
+0001c9e0: 6c69 6d69 7473 275d 5b27 6c65 7665 7261  limits']['levera
+0001c9f0: 6765 275d 5b27 6d61 7827 5d20 6973 206e  ge']['max'] is n
+0001ca00: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001ca10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001ca20: 6d61 726b 6574 5b27 6c69 6d69 7473 275d  market['limits']
+0001ca30: 5b27 6c65 7665 7261 6765 275d 5b27 6d61  ['leverage']['ma
+0001ca40: 7827 5d0a 2020 2020 2020 2020 2020 2020  x'].            
+0001ca50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001ca60: 2020 2020 2020 7265 7475 726e 2031 2e30        return 1.0
+0001ca70: 2020 2320 4465 6661 756c 7420 6966 206d    # Default if m
+0001ca80: 6178 206c 6576 6572 6167 6520 6361 6e6e  ax leverage cann
+0001ca90: 6f74 2062 6520 666f 756e 640a 2020 2020  ot be found.    
+0001caa0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001cab0: 2020 2020 2020 7265 7475 726e 2031 2e30        return 1.0
+0001cac0: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
+0001cad0: 2020 2064 6566 205f 7365 745f 6c65 7665     def _set_leve
+0001cae0: 7261 6765 280a 2020 2020 2020 2020 7365  rage(.        se
+0001caf0: 6c66 2c0a 2020 2020 2020 2020 6c65 7665  lf,.        leve
+0001cb00: 7261 6765 3a20 666c 6f61 742c 0a20 2020  rage: float,.   
+0001cb10: 2020 2020 2070 6169 723a 204f 7074 696f       pair: Optio
+0001cb20: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+0001cb30: 0a20 2020 2020 2020 2061 6363 6570 745f  .        accept_
+0001cb40: 6661 696c 3a20 626f 6f6c 203d 2046 616c  fail: bool = Fal
+0001cb50: 7365 2c0a 2020 2020 293a 0a20 2020 2020  se,.    ):.     
+0001cb60: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+0001cb70: 6574 2773 2074 6865 206c 6576 6572 6167  et's the leverag
+0001cb80: 6520 6265 666f 7265 206d 616b 696e 6720  e before making 
+0001cb90: 6120 7472 6164 652c 2069 6e20 6f72 6465  a trade, in orde
+0001cba0: 7220 746f 206e 6f74 0a20 2020 2020 2020  r to not.       
+0001cbb0: 2068 6176 6520 7468 6520 7361 6d65 206c   have the same l
+0001cbc0: 6576 6572 6167 6520 6f6e 2065 7665 7279  everage on every
+0001cbd0: 2074 7261 6465 0a20 2020 2020 2020 2022   trade.        "
+0001cbe0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0001cbf0: 6c66 2e5f 636f 6e66 6967 5b27 6472 795f  lf._config['dry_
+0001cc00: 7275 6e27 5d20 6f72 206e 6f74 2073 656c  run'] or not sel
+0001cc10: 662e 6578 6368 616e 6765 5f68 6173 2822  f.exchange_has("
+0001cc20: 7365 744c 6576 6572 6167 6522 293a 0a20  setLeverage"):. 
+0001cc30: 2020 2020 2020 2020 2020 2023 2053 6f6d             # Som
+0001cc40: 6520 6578 6368 616e 6765 7320 6f6e 6c79  e exchanges only
+0001cc50: 2073 7570 706f 7274 206f 6e65 206d 6172   support one mar
+0001cc60: 6769 6e5f 6d6f 6465 2074 7970 650a 2020  gin_mode type.  
+0001cc70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001cc80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001cc90: 2e5f 6674 5f68 6173 2e67 6574 2827 666c  ._ft_has.get('fl
+0001cca0: 6f6f 725f 6c65 7665 7261 6765 272c 2046  oor_leverage', F
+0001ccb0: 616c 7365 2920 6973 2054 7275 653a 0a20  alse) is True:. 
+0001ccc0: 2020 2020 2020 2020 2020 2023 2052 6f75             # Rou
+0001ccd0: 6e64 696e 6720 666f 7220 6269 6e61 6e63  nding for binanc
+0001cce0: 6520 2e2e 2e0a 2020 2020 2020 2020 2020  e ....          
+0001ccf0: 2020 6c65 7665 7261 6765 203d 2066 6c6f    leverage = flo
+0001cd00: 6f72 286c 6576 6572 6167 6529 0a20 2020  or(leverage).   
+0001cd10: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001cd20: 2020 2020 2020 7265 7320 3d20 7365 6c66        res = self
+0001cd30: 2e5f 6170 692e 7365 745f 6c65 7665 7261  ._api.set_levera
+0001cd40: 6765 2873 796d 626f 6c3d 7061 6972 2c20  ge(symbol=pair, 
+0001cd50: 6c65 7665 7261 6765 3d6c 6576 6572 6167  leverage=leverag
+0001cd60: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+0001cd70: 656c 662e 5f6c 6f67 5f65 7863 6861 6e67  elf._log_exchang
+0001cd80: 655f 7265 7370 6f6e 7365 2827 7365 745f  e_response('set_
+0001cd90: 6c65 7665 7261 6765 272c 2072 6573 290a  leverage', res).
+0001cda0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0001cdb0: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+0001cdc0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0001cdd0: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+0001cde0: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+0001cdf0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0001ce00: 7074 2028 6363 7874 2e42 6164 5265 7175  pt (ccxt.BadRequ
+0001ce10: 6573 742c 2063 6378 742e 496e 7375 6666  est, ccxt.Insuff
+0001ce20: 6963 6965 6e74 4675 6e64 7329 2061 7320  icientFunds) as 
+0001ce30: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0001ce40: 6620 6e6f 7420 6163 6365 7074 5f66 6169  f not accept_fai
+0001ce50: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+0001ce60: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
+0001ce70: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
+0001ce80: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
+0001ce90: 6f75 6c64 206e 6f74 2073 6574 206c 6576  ould not set lev
+0001cea0: 6572 6167 6520 6475 6520 746f 207b 652e  erage due to {e.
+0001ceb0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001cec0: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+0001ced0: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+0001cee0: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+0001cef0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+0001cf00: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+0001cf10: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+0001cf20: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0001cf30: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0001cf40: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
+0001cf50: 6420 6e6f 7420 7365 7420 6c65 7665 7261  d not set levera
+0001cf60: 6765 2064 7565 2074 6f20 7b65 2e5f 5f63  ge due to {e.__c
+0001cf70: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0001cf80: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+0001cf90: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0001cfa0: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
+0001cfb0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0001cfc0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0001cfd0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0001cfe0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
+0001cff0: 2020 6465 6620 6765 745f 696e 7465 7265    def get_intere
+0001d000: 7374 5f72 6174 6528 7365 6c66 2920 2d3e  st_rate(self) ->
+0001d010: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+0001d020: 2222 220a 2020 2020 2020 2020 5265 7472  """.        Retr
+0001d030: 6965 7665 2069 6e74 6572 6573 7420 7261  ieve interest ra
+0001d040: 7465 202d 206e 6563 6573 7361 7279 2066  te - necessary f
+0001d050: 6f72 204d 6172 6769 6e20 7472 6164 696e  or Margin tradin
+0001d060: 672e 0a20 2020 2020 2020 2053 686f 756c  g..        Shoul
+0001d070: 6420 6e6f 7420 6361 6c6c 2074 6865 2065  d not call the e
+0001d080: 7863 6861 6e67 6520 6469 7265 6374 6c79  xchange directly
+0001d090: 2077 6865 6e20 7573 6564 2066 726f 6d20   when used from 
+0001d0a0: 6261 636b 7465 7374 696e 672e 0a20 2020  backtesting..   
+0001d0b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001d0c0: 2072 6574 7572 6e20 302e 300a 0a20 2020   return 0.0..   
+0001d0d0: 2064 6566 2066 756e 6469 6e67 5f66 6565   def funding_fee
+0001d0e0: 5f63 7574 6f66 6628 7365 6c66 2c20 6f70  _cutoff(self, op
+0001d0f0: 656e 5f64 6174 653a 2064 6174 6574 696d  en_date: datetim
+0001d100: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+0001d110: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+0001d120: 7065 6e5f 6461 7465 3a20 5468 6520 6f70  pen_date: The op
+0001d130: 656e 2064 6174 6520 666f 7220 6120 7472  en date for a tr
+0001d140: 6164 650a 2020 2020 2020 2020 3a72 6574  ade.        :ret
+0001d150: 7572 6e3a 2054 6865 2063 7574 6f66 6620  urn: The cutoff 
+0001d160: 6f70 656e 2074 696d 6520 666f 7220 7768  open time for wh
+0001d170: 656e 2061 2066 756e 6469 6e67 2066 6565  en a funding fee
+0001d180: 2069 7320 6368 6172 6765 640a 2020 2020   is charged.    
+0001d190: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001d1a0: 7265 7475 726e 206f 7065 6e5f 6461 7465  return open_date
+0001d1b0: 2e6d 696e 7574 6520 3e20 3020 6f72 206f  .minute > 0 or o
+0001d1c0: 7065 6e5f 6461 7465 2e73 6563 6f6e 6420  pen_date.second 
+0001d1d0: 3e20 300a 0a20 2020 2040 7265 7472 6965  > 0..    @retrie
+0001d1e0: 720a 2020 2020 6465 6620 7365 745f 6d61  r.    def set_ma
+0001d1f0: 7267 696e 5f6d 6f64 6528 7365 6c66 2c20  rgin_mode(self, 
+0001d200: 7061 6972 3a20 7374 722c 206d 6172 6769  pair: str, margi
+0001d210: 6e5f 6d6f 6465 3a20 4d61 7267 696e 4d6f  n_mode: MarginMo
+0001d220: 6465 2c20 6163 6365 7074 5f66 6169 6c3a  de, accept_fail:
+0001d230: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d250: 2020 2020 2020 2070 6172 616d 733a 2064         params: d
+0001d260: 6963 7420 3d20 7b7d 293a 0a20 2020 2020  ict = {}):.     
+0001d270: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
+0001d280: 6574 2773 2074 6865 206d 6172 6769 6e20  et's the margin 
+0001d290: 6d6f 6465 206f 6e20 7468 6520 6578 6368  mode on the exch
+0001d2a0: 616e 6765 2074 6f20 6372 6f73 7320 6f72  ange to cross or
+0001d2b0: 2069 736f 6c61 7465 6420 666f 7220 6120   isolated for a 
+0001d2c0: 7370 6563 6966 6963 2070 6169 720a 2020  specific pair.  
+0001d2d0: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+0001d2e0: 723a 2062 6173 652f 7175 6f74 6520 6375  r: base/quote cu
+0001d2f0: 7272 656e 6379 2070 6169 7220 2865 2e67  rrency pair (e.g
+0001d300: 2e20 2241 4441 2f55 5344 5422 290a 2020  . "ADA/USDT").  
+0001d310: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d320: 2020 6966 2073 656c 662e 5f63 6f6e 6669    if self._confi
+0001d330: 675b 2764 7279 5f72 756e 275d 206f 7220  g['dry_run'] or 
+0001d340: 6e6f 7420 7365 6c66 2e65 7863 6861 6e67  not self.exchang
+0001d350: 655f 6861 7328 2273 6574 4d61 7267 696e  e_has("setMargin
+0001d360: 4d6f 6465 2229 3a0a 2020 2020 2020 2020  Mode"):.        
+0001d370: 2020 2020 2320 536f 6d65 2065 7863 6861      # Some excha
+0001d380: 6e67 6573 206f 6e6c 7920 7375 7070 6f72  nges only suppor
+0001d390: 7420 6f6e 6520 6d61 7267 696e 5f6d 6f64  t one margin_mod
+0001d3a0: 6520 7479 7065 0a20 2020 2020 2020 2020  e type.         
+0001d3b0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+0001d3c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001d3d0: 2020 2020 7265 7320 3d20 7365 6c66 2e5f      res = self._
+0001d3e0: 6170 692e 7365 745f 6d61 7267 696e 5f6d  api.set_margin_m
+0001d3f0: 6f64 6528 6d61 7267 696e 5f6d 6f64 652e  ode(margin_mode.
+0001d400: 7661 6c75 652c 2070 6169 722c 2070 6172  value, pair, par
+0001d410: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0001d420: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
+0001d430: 6e67 655f 7265 7370 6f6e 7365 2827 7365  nge_response('se
+0001d440: 745f 6d61 7267 696e 5f6d 6f64 6527 2c20  t_margin_mode', 
+0001d450: 7265 7329 0a20 2020 2020 2020 2065 7863  res).        exc
+0001d460: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
+0001d470: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
+0001d480: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001d490: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
+0001d4a0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001d4b0: 2065 7863 6570 7420 6363 7874 2e42 6164   except ccxt.Bad
+0001d4c0: 5265 7175 6573 7420 6173 2065 3a0a 2020  Request as e:.  
+0001d4d0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001d4e0: 2061 6363 6570 745f 6661 696c 3a0a 2020   accept_fail:.  
+0001d4f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001d500: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+0001d510: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0001d520: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
+0001d530: 6e6f 7420 7365 7420 6d61 7267 696e 206d  not set margin m
+0001d540: 6f64 6520 6475 6520 746f 207b 652e 5f5f  ode due to {e.__
+0001d550: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001d560: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0001d570: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001d580: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
+0001d590: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
+0001d5a0: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
+0001d5b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001d5c0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
+0001d5d0: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
+0001d5e0: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
+0001d5f0: 6e6f 7420 7365 7420 6d61 7267 696e 206d  not set margin m
+0001d600: 6f64 6520 6475 6520 746f 207b 652e 5f5f  ode due to {e.__
+0001d610: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001d620: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0001d630: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001d640: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+0001d650: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0001d660: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0001d670: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0001d680: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
+0001d690: 2020 2064 6566 205f 6665 7463 685f 616e     def _fetch_an
+0001d6a0: 645f 6361 6c63 756c 6174 655f 6675 6e64  d_calculate_fund
+0001d6b0: 696e 675f 6665 6573 280a 2020 2020 2020  ing_fees(.      
+0001d6c0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0001d6d0: 7061 6972 3a20 7374 722c 0a20 2020 2020  pair: str,.     
+0001d6e0: 2020 2061 6d6f 756e 743a 2066 6c6f 6174     amount: float
+0001d6f0: 2c0a 2020 2020 2020 2020 6973 5f73 686f  ,.        is_sho
+0001d700: 7274 3a20 626f 6f6c 2c0a 2020 2020 2020  rt: bool,.      
+0001d710: 2020 6f70 656e 5f64 6174 653a 2064 6174    open_date: dat
+0001d720: 6574 696d 652c 0a20 2020 2020 2020 2063  etime,.        c
+0001d730: 6c6f 7365 5f64 6174 653a 204f 7074 696f  lose_date: Optio
+0001d740: 6e61 6c5b 6461 7465 7469 6d65 5d20 3d20  nal[datetime] = 
+0001d750: 4e6f 6e65 0a20 2020 2029 202d 3e20 666c  None.    ) -> fl
+0001d760: 6f61 743a 0a20 2020 2020 2020 2022 2222  oat:.        """
+0001d770: 0a20 2020 2020 2020 2046 6574 6368 6573  .        Fetches
+0001d780: 2061 6e64 2063 616c 6375 6c61 7465 7320   and calculates 
+0001d790: 7468 6520 7375 6d20 6f66 2061 6c6c 2066  the sum of all f
+0001d7a0: 756e 6469 6e67 2066 6565 7320 7468 6174  unding fees that
+0001d7b0: 206f 6363 7572 7265 6420 666f 7220 6120   occurred for a 
+0001d7c0: 7061 6972 0a20 2020 2020 2020 2064 7572  pair.        dur
+0001d7d0: 696e 6720 6120 6675 7475 7265 7320 7472  ing a futures tr
+0001d7e0: 6164 652e 0a20 2020 2020 2020 204f 6e6c  ade..        Onl
+0001d7f0: 7920 7573 6564 2064 7572 696e 6720 6472  y used during dr
+0001d800: 792d 7275 6e20 6f72 2069 6620 7468 6520  y-run or if the 
+0001d810: 6578 6368 616e 6765 2064 6f65 7320 6e6f  exchange does no
+0001d820: 7420 7072 6f76 6964 6520 6120 6675 6e64  t provide a fund
+0001d830: 696e 675f 7261 7465 7320 656e 6470 6f69  ing_rates endpoi
+0001d840: 6e74 2e0a 2020 2020 2020 2020 3a70 6172  nt..        :par
+0001d850: 616d 2070 6169 723a 2054 6865 2071 756f  am pair: The quo
+0001d860: 7465 2f62 6173 6520 7061 6972 206f 6620  te/base pair of 
+0001d870: 7468 6520 7472 6164 650a 2020 2020 2020  the trade.      
+0001d880: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
+0001d890: 2054 6865 2071 7561 6e74 6974 7920 6f66   The quantity of
+0001d8a0: 2074 6865 2074 7261 6465 0a20 2020 2020   the trade.     
+0001d8b0: 2020 203a 7061 7261 6d20 6973 5f73 686f     :param is_sho
+0001d8c0: 7274 3a20 7472 6164 6520 6469 7265 6374  rt: trade direct
+0001d8d0: 696f 6e0a 2020 2020 2020 2020 3a70 6172  ion.        :par
+0001d8e0: 616d 206f 7065 6e5f 6461 7465 3a20 5468  am open_date: Th
+0001d8f0: 6520 6461 7465 2061 6e64 2074 696d 6520  e date and time 
+0001d900: 7468 6174 2074 6865 2074 7261 6465 2073  that the trade s
+0001d910: 7461 7274 6564 0a20 2020 2020 2020 203a  tarted.        :
+0001d920: 7061 7261 6d20 636c 6f73 655f 6461 7465  param close_date
+0001d930: 3a20 5468 6520 6461 7465 2061 6e64 2074  : The date and t
+0001d940: 696d 6520 7468 6174 2074 6865 2074 7261  ime that the tra
+0001d950: 6465 2065 6e64 6564 0a20 2020 2020 2020  de ended.       
+0001d960: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+0001d970: 2073 656c 662e 6675 6e64 696e 675f 6665   self.funding_fe
+0001d980: 655f 6375 746f 6666 286f 7065 6e5f 6461  e_cutoff(open_da
+0001d990: 7465 293a 0a20 2020 2020 2020 2020 2020  te):.           
+0001d9a0: 206f 7065 6e5f 6461 7465 202b 3d20 7469   open_date += ti
+0001d9b0: 6d65 6465 6c74 6128 686f 7572 733d 3129  medelta(hours=1)
+0001d9c0: 0a20 2020 2020 2020 2074 696d 6566 7261  .        timefra
+0001d9d0: 6d65 203d 2073 656c 662e 5f66 745f 6861  me = self._ft_ha
+0001d9e0: 735b 276d 6172 6b5f 6f68 6c63 765f 7469  s['mark_ohlcv_ti
+0001d9f0: 6d65 6672 616d 6527 5d0a 2020 2020 2020  meframe'].      
+0001da00: 2020 7469 6d65 6672 616d 655f 6666 203d    timeframe_ff =
+0001da10: 2073 656c 662e 5f66 745f 6861 732e 6765   self._ft_has.ge
+0001da20: 7428 2766 756e 6469 6e67 5f66 6565 5f74  t('funding_fee_t
+0001da30: 696d 6566 7261 6d65 272c 0a20 2020 2020  imeframe',.     
+0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da60: 2020 2073 656c 662e 5f66 745f 6861 735b     self._ft_has[
+0001da70: 276d 6172 6b5f 6f68 6c63 765f 7469 6d65  'mark_ohlcv_time
+0001da80: 6672 616d 6527 5d29 0a0a 2020 2020 2020  frame'])..      
+0001da90: 2020 6966 206e 6f74 2063 6c6f 7365 5f64    if not close_d
+0001daa0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
+0001dab0: 2063 6c6f 7365 5f64 6174 6520 3d20 6461   close_date = da
+0001dac0: 7465 7469 6d65 2e6e 6f77 2874 696d 657a  tetime.now(timez
+0001dad0: 6f6e 652e 7574 6329 0a20 2020 2020 2020  one.utc).       
+0001dae0: 206f 7065 6e5f 7469 6d65 7374 616d 7020   open_timestamp 
+0001daf0: 3d20 696e 7428 7469 6d65 6672 616d 655f  = int(timeframe_
+0001db00: 746f 5f70 7265 765f 6461 7465 2874 696d  to_prev_date(tim
+0001db10: 6566 7261 6d65 2c20 6f70 656e 5f64 6174  eframe, open_dat
+0001db20: 6529 2e74 696d 6573 7461 6d70 2829 2920  e).timestamp()) 
+0001db30: 2a20 3130 3030 0a20 2020 2020 2020 2023  * 1000.        #
+0001db40: 2063 6c6f 7365 5f74 696d 6573 7461 6d70   close_timestamp
+0001db50: 203d 2069 6e74 2863 6c6f 7365 5f64 6174   = int(close_dat
+0001db60: 652e 7469 6d65 7374 616d 7028 2929 202a  e.timestamp()) *
+0001db70: 2031 3030 300a 0a20 2020 2020 2020 206d   1000..        m
+0001db80: 6172 6b5f 636f 6d62 3a20 5061 6972 5769  ark_comb: PairWi
+0001db90: 7468 5469 6d65 6672 616d 6520 3d20 280a  thTimeframe = (.
+0001dba0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0001dbb0: 2c20 7469 6d65 6672 616d 652c 2043 616e  , timeframe, Can
+0001dbc0: 646c 6554 7970 652e 6672 6f6d 5f73 7472  dleType.from_str
+0001dbd0: 696e 6728 7365 6c66 2e5f 6674 5f68 6173  ing(self._ft_has
+0001dbe0: 5b22 6d61 726b 5f6f 686c 6376 5f70 7269  ["mark_ohlcv_pri
+0001dbf0: 6365 225d 2929 0a0a 2020 2020 2020 2020  ce"]))..        
+0001dc00: 6675 6e64 696e 675f 636f 6d62 3a20 5061  funding_comb: Pa
+0001dc10: 6972 5769 7468 5469 6d65 6672 616d 6520  irWithTimeframe 
+0001dc20: 3d20 2870 6169 722c 2074 696d 6566 7261  = (pair, timefra
+0001dc30: 6d65 5f66 662c 2043 616e 646c 6554 7970  me_ff, CandleTyp
+0001dc40: 652e 4655 4e44 494e 475f 5241 5445 290a  e.FUNDING_RATE).
+0001dc50: 2020 2020 2020 2020 6361 6e64 6c65 5f68          candle_h
+0001dc60: 6973 746f 7269 6573 203d 2073 656c 662e  istories = self.
+0001dc70: 7265 6672 6573 685f 6c61 7465 7374 5f6f  refresh_latest_o
+0001dc80: 686c 6376 280a 2020 2020 2020 2020 2020  hlcv(.          
+0001dc90: 2020 5b6d 6172 6b5f 636f 6d62 2c20 6675    [mark_comb, fu
+0001dca0: 6e64 696e 675f 636f 6d62 5d2c 0a20 2020  nding_comb],.   
+0001dcb0: 2020 2020 2020 2020 2073 696e 6365 5f6d           since_m
+0001dcc0: 733d 6f70 656e 5f74 696d 6573 7461 6d70  s=open_timestamp
+0001dcd0: 2c0a 2020 2020 2020 2020 2020 2020 6361  ,.            ca
+0001dce0: 6368 653d 4661 6c73 652c 0a20 2020 2020  che=False,.     
+0001dcf0: 2020 2020 2020 2064 726f 705f 696e 636f         drop_inco
+0001dd00: 6d70 6c65 7465 3d46 616c 7365 2c0a 2020  mplete=False,.  
+0001dd10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001dd20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001dd30: 2023 2077 6520 6361 6e27 7420 6173 7375   # we can't assu
+0001dd40: 6d65 2077 6520 616c 7761 7973 2067 6574  me we always get
+0001dd50: 2068 6973 746f 7269 6573 202d 2066 6f72   histories - for
+0001dd60: 2065 7861 6d70 6c65 2064 7572 696e 6720   example during 
+0001dd70: 6578 6368 616e 6765 2064 6f77 6e74 696d  exchange downtim
+0001dd80: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
+0001dd90: 756e 6469 6e67 5f72 6174 6573 203d 2063  unding_rates = c
+0001dda0: 616e 646c 655f 6869 7374 6f72 6965 735b  andle_histories[
+0001ddb0: 6675 6e64 696e 675f 636f 6d62 5d0a 2020  funding_comb].  
+0001ddc0: 2020 2020 2020 2020 2020 6d61 726b 5f72            mark_r
+0001ddd0: 6174 6573 203d 2063 616e 646c 655f 6869  ates = candle_hi
+0001dde0: 7374 6f72 6965 735b 6d61 726b 5f63 6f6d  stories[mark_com
+0001ddf0: 625d 0a20 2020 2020 2020 2065 7863 6570  b].        excep
+0001de00: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+0001de10: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001de20: 6368 616e 6765 4572 726f 7228 2243 6f75  changeError("Cou
+0001de30: 6c64 206e 6f74 2066 696e 6420 6675 6e64  ld not find fund
+0001de40: 696e 6720 7261 7465 732e 2229 2066 726f  ing rates.") fro
+0001de50: 6d20 4e6f 6e65 0a0a 2020 2020 2020 2020  m None..        
+0001de60: 6675 6e64 696e 675f 6d61 726b 5f72 6174  funding_mark_rat
+0001de70: 6573 203d 2073 656c 662e 636f 6d62 696e  es = self.combin
+0001de80: 655f 6675 6e64 696e 675f 616e 645f 6d61  e_funding_and_ma
+0001de90: 726b 280a 2020 2020 2020 2020 2020 2020  rk(.            
+0001dea0: 6675 6e64 696e 675f 7261 7465 733d 6675  funding_rates=fu
+0001deb0: 6e64 696e 675f 7261 7465 732c 206d 6172  nding_rates, mar
+0001dec0: 6b5f 7261 7465 733d 6d61 726b 5f72 6174  k_rates=mark_rat
+0001ded0: 6573 290a 0a20 2020 2020 2020 2072 6574  es)..        ret
+0001dee0: 7572 6e20 7365 6c66 2e63 616c 6375 6c61  urn self.calcula
+0001def0: 7465 5f66 756e 6469 6e67 5f66 6565 7328  te_funding_fees(
+0001df00: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+0001df10: 6469 6e67 5f6d 6172 6b5f 7261 7465 732c  ding_mark_rates,
+0001df20: 0a20 2020 2020 2020 2020 2020 2061 6d6f  .            amo
+0001df30: 756e 743d 616d 6f75 6e74 2c0a 2020 2020  unt=amount,.    
+0001df40: 2020 2020 2020 2020 6973 5f73 686f 7274          is_short
+0001df50: 3d69 735f 7368 6f72 742c 0a20 2020 2020  =is_short,.     
+0001df60: 2020 2020 2020 206f 7065 6e5f 6461 7465         open_date
+0001df70: 3d6f 7065 6e5f 6461 7465 2c0a 2020 2020  =open_date,.    
+0001df80: 2020 2020 2020 2020 636c 6f73 655f 6461          close_da
+0001df90: 7465 3d63 6c6f 7365 5f64 6174 650a 2020  te=close_date.  
+0001dfa0: 2020 2020 2020 290a 0a20 2020 2040 7374        )..    @st
+0001dfb0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+0001dfc0: 6566 2063 6f6d 6269 6e65 5f66 756e 6469  ef combine_fundi
+0001dfd0: 6e67 5f61 6e64 5f6d 6172 6b28 6675 6e64  ng_and_mark(fund
+0001dfe0: 696e 675f 7261 7465 733a 2044 6174 6146  ing_rates: DataF
+0001dff0: 7261 6d65 2c20 6d61 726b 5f72 6174 6573  rame, mark_rates
+0001e000: 3a20 4461 7461 4672 616d 652c 0a20 2020  : DataFrame,.   
+0001e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e020: 2020 2020 2020 2020 2020 2020 2020 6675                fu
+0001e030: 7475 7265 735f 6675 6e64 696e 675f 7261  tures_funding_ra
+0001e040: 7465 3a20 4f70 7469 6f6e 616c 5b69 6e74  te: Optional[int
+0001e050: 5d20 3d20 4e6f 6e65 2920 2d3e 2044 6174  ] = None) -> Dat
+0001e060: 6146 7261 6d65 3a0a 2020 2020 2020 2020  aFrame:.        
+0001e070: 2222 220a 2020 2020 2020 2020 436f 6d62  """.        Comb
+0001e080: 696e 6520 6675 6e64 696e 672d 7261 7465  ine funding-rate
+0001e090: 7320 616e 6420 6d61 726b 2d72 6174 6573  s and mark-rates
+0001e0a0: 2064 6174 6166 7261 6d65 730a 2020 2020   dataframes.    
+0001e0b0: 2020 2020 3a70 6172 616d 2066 756e 6469      :param fundi
+0001e0c0: 6e67 5f72 6174 6573 3a20 4461 7461 6672  ng_rates: Datafr
+0001e0d0: 616d 6520 636f 6e74 6169 6e69 6e67 2046  ame containing F
+0001e0e0: 756e 6469 6e67 2072 6174 6573 2028 5479  unding rates (Ty
+0001e0f0: 7065 2046 554e 4449 4e47 5f52 4154 4529  pe FUNDING_RATE)
+0001e100: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001e110: 6d61 726b 5f72 6174 6573 3a20 4461 7461  mark_rates: Data
+0001e120: 6672 616d 6520 636f 6e74 6169 6e69 6e67  frame containing
+0001e130: 204d 6172 6b20 7261 7465 7320 2854 7970   Mark rates (Typ
+0001e140: 6520 6d61 726b 5f6f 686c 6376 5f70 7269  e mark_ohlcv_pri
+0001e150: 6365 290a 2020 2020 2020 2020 3a70 6172  ce).        :par
+0001e160: 616d 2066 7574 7572 6573 5f66 756e 6469  am futures_fundi
+0001e170: 6e67 5f72 6174 653a 2046 616b 6520 6675  ng_rate: Fake fu
+0001e180: 6e64 696e 6720 7261 7465 2074 6f20 7573  nding rate to us
+0001e190: 6520 6966 2066 756e 6469 6e67 5f72 6174  e if funding_rat
+0001e1a0: 6573 2061 7265 206e 6f74 2061 7661 696c  es are not avail
+0001e1b0: 6162 6c65 0a20 2020 2020 2020 2022 2222  able.        """
+0001e1c0: 0a20 2020 2020 2020 2069 6620 6675 7475  .        if futu
+0001e1d0: 7265 735f 6675 6e64 696e 675f 7261 7465  res_funding_rate
+0001e1e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001e1f0: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
+0001e200: 6b5f 7261 7465 732e 6d65 7267 6528 0a20  k_rates.merge(. 
+0001e210: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001e220: 756e 6469 6e67 5f72 6174 6573 2c20 6f6e  unding_rates, on
+0001e230: 3d27 6461 7465 272c 2068 6f77 3d22 696e  ='date', how="in
+0001e240: 6e65 7222 2c20 7375 6666 6978 6573 3d5b  ner", suffixes=[
+0001e250: 225f 6d61 726b 222c 2022 5f66 756e 6422  "_mark", "_fund"
+0001e260: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
+0001e270: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e280: 6c65 6e28 6675 6e64 696e 675f 7261 7465  len(funding_rate
+0001e290: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+0001e2a0: 2020 2020 2020 2020 2023 204e 6f20 6675           # No fu
+0001e2b0: 6e64 696e 6720 7261 7465 2063 616e 646c  nding rate candl
+0001e2c0: 6573 202d 2066 756c 6c20 6669 6c6c 7570  es - full fillup
+0001e2d0: 2077 6974 6820 6661 6c6c 6261 636b 2076   with fallback v
+0001e2e0: 6172 6961 626c 650a 2020 2020 2020 2020  ariable.        
+0001e2f0: 2020 2020 2020 2020 6d61 726b 5f72 6174          mark_rat
+0001e300: 6573 5b27 6f70 656e 5f66 756e 6427 5d20  es['open_fund'] 
+0001e310: 3d20 6675 7475 7265 735f 6675 6e64 696e  = futures_fundin
+0001e320: 675f 7261 7465 0a20 2020 2020 2020 2020  g_rate.         
+0001e330: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
+0001e340: 726b 5f72 6174 6573 2e72 656e 616d 6528  rk_rates.rename(
+0001e350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e360: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+0001e370: 3d7b 276f 7065 6e27 3a20 276f 7065 6e5f  ={'open': 'open_
+0001e380: 6d61 726b 272c 0a20 2020 2020 2020 2020  mark',.         
+0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3a0: 2020 2020 2020 2020 2763 6c6f 7365 273a          'close':
+0001e3b0: 2027 636c 6f73 655f 6d61 726b 272c 0a20   'close_mark',. 
+0001e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3e0: 2768 6967 6827 3a20 2768 6967 685f 6d61  'high': 'high_ma
+0001e3f0: 726b 272c 0a20 2020 2020 2020 2020 2020  rk',.           
+0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e410: 2020 2020 2020 276c 6f77 273a 2027 6c6f        'low': 'lo
+0001e420: 775f 6d61 726b 272c 0a20 2020 2020 2020  w_mark',.       
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 2020 2020 2020 2020 2776 6f6c 756d            'volum
+0001e450: 6527 3a20 2776 6f6c 756d 655f 6d61 726b  e': 'volume_mark
+0001e460: 277d 290a 0a20 2020 2020 2020 2020 2020  '})..           
+0001e470: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001e480: 2020 2020 2020 2023 2046 696c 6c20 7570         # Fill up
+0001e490: 206d 6973 7369 6e67 2066 756e 6469 6e67   missing funding
+0001e4a0: 5f72 6174 6520 6361 6e64 6c65 7320 7769  _rate candles wi
+0001e4b0: 7468 2066 616c 6c62 6163 6b20 7661 6c75  th fallback valu
+0001e4c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001e4d0: 2020 636f 6d62 696e 6564 203d 206d 6172    combined = mar
+0001e4e0: 6b5f 7261 7465 732e 6d65 7267 6528 0a20  k_rates.merge(. 
+0001e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e500: 2020 2066 756e 6469 6e67 5f72 6174 6573     funding_rates
+0001e510: 2c20 6f6e 3d27 6461 7465 272c 2068 6f77  , on='date', how
+0001e520: 3d22 6f75 7465 7222 2c20 7375 6666 6978  ="outer", suffix
+0001e530: 6573 3d5b 225f 6d61 726b 222c 2022 5f66  es=["_mark", "_f
+0001e540: 756e 6422 5d0a 2020 2020 2020 2020 2020  und"].          
+0001e550: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0001e560: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+0001e570: 696e 6564 5b27 6f70 656e 5f66 756e 6427  ined['open_fund'
+0001e580: 5d20 3d20 636f 6d62 696e 6564 5b27 6f70  ] = combined['op
+0001e590: 656e 5f66 756e 6427 5d2e 6669 6c6c 6e61  en_fund'].fillna
+0001e5a0: 2866 7574 7572 6573 5f66 756e 6469 6e67  (futures_funding
+0001e5b0: 5f72 6174 6529 0a20 2020 2020 2020 2020  _rate).         
+0001e5c0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+0001e5d0: 6d62 696e 6564 0a0a 2020 2020 6465 6620  mbined..    def 
+0001e5e0: 6361 6c63 756c 6174 655f 6675 6e64 696e  calculate_fundin
+0001e5f0: 675f 6665 6573 280a 2020 2020 2020 2020  g_fees(.        
+0001e600: 7365 6c66 2c0a 2020 2020 2020 2020 6466  self,.        df
+0001e610: 3a20 4461 7461 4672 616d 652c 0a20 2020  : DataFrame,.   
+0001e620: 2020 2020 2061 6d6f 756e 743a 2066 6c6f       amount: flo
+0001e630: 6174 2c0a 2020 2020 2020 2020 6973 5f73  at,.        is_s
+0001e640: 686f 7274 3a20 626f 6f6c 2c0a 2020 2020  hort: bool,.    
+0001e650: 2020 2020 6f70 656e 5f64 6174 653a 2064      open_date: d
+0001e660: 6174 6574 696d 652c 0a20 2020 2020 2020  atetime,.       
+0001e670: 2063 6c6f 7365 5f64 6174 653a 204f 7074   close_date: Opt
+0001e680: 696f 6e61 6c5b 6461 7465 7469 6d65 5d20  ional[datetime] 
+0001e690: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0001e6a0: 7469 6d65 5f69 6e5f 7261 7469 6f3a 204f  time_in_ratio: O
+0001e6b0: 7074 696f 6e61 6c5b 666c 6f61 745d 203d  ptional[float] =
+0001e6c0: 204e 6f6e 650a 2020 2020 2920 2d3e 2066   None.    ) -> f
+0001e6d0: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
+0001e6e0: 220a 2020 2020 2020 2020 6361 6c63 756c  ".        calcul
+0001e6f0: 6174 6573 2074 6865 2073 756d 206f 6620  ates the sum of 
+0001e700: 616c 6c20 6675 6e64 696e 6720 6665 6573  all funding fees
+0001e710: 2074 6861 7420 6f63 6375 7272 6564 2066   that occurred f
+0001e720: 6f72 2061 2070 6169 7220 6475 7269 6e67  or a pair during
+0001e730: 2061 2066 7574 7572 6573 2074 7261 6465   a futures trade
+0001e740: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001e750: 6466 3a20 4461 7461 6672 616d 6520 636f  df: Dataframe co
+0001e760: 6e74 6169 6e69 6e67 2063 6f6d 6269 6e65  ntaining combine
+0001e770: 6420 6675 6e64 696e 6720 616e 6420 6d61  d funding and ma
+0001e780: 726b 2072 6174 6573 0a20 2020 2020 2020  rk rates.       
+0001e790: 2020 2020 2020 2020 2020 2020 6173 2060              as `
+0001e7a0: 6f70 656e 5f66 756e 6460 2061 6e64 2060  open_fund` and `
+0001e7b0: 6f70 656e 5f6d 6172 6b60 2e0a 2020 2020  open_mark`..    
+0001e7c0: 2020 2020 3a70 6172 616d 2061 6d6f 756e      :param amoun
+0001e7d0: 743a 2054 6865 2071 7561 6e74 6974 7920  t: The quantity 
+0001e7e0: 6f66 2074 6865 2074 7261 6465 0a20 2020  of the trade.   
+0001e7f0: 2020 2020 203a 7061 7261 6d20 6973 5f73       :param is_s
+0001e800: 686f 7274 3a20 7472 6164 6520 6469 7265  hort: trade dire
+0001e810: 6374 696f 6e0a 2020 2020 2020 2020 3a70  ction.        :p
+0001e820: 6172 616d 206f 7065 6e5f 6461 7465 3a20  aram open_date: 
+0001e830: 5468 6520 6461 7465 2061 6e64 2074 696d  The date and tim
+0001e840: 6520 7468 6174 2074 6865 2074 7261 6465  e that the trade
+0001e850: 2073 7461 7274 6564 0a20 2020 2020 2020   started.       
+0001e860: 203a 7061 7261 6d20 636c 6f73 655f 6461   :param close_da
+0001e870: 7465 3a20 5468 6520 6461 7465 2061 6e64  te: The date and
+0001e880: 2074 696d 6520 7468 6174 2074 6865 2074   time that the t
+0001e890: 7261 6465 2065 6e64 6564 0a20 2020 2020  rade ended.     
+0001e8a0: 2020 203a 7061 7261 6d20 7469 6d65 5f69     :param time_i
+0001e8b0: 6e5f 7261 7469 6f3a 204e 6f74 2075 7365  n_ratio: Not use
+0001e8c0: 6420 6279 206d 6f73 7420 6578 6368 616e  d by most exchan
+0001e8d0: 6765 2063 6c61 7373 6573 0a20 2020 2020  ge classes.     
+0001e8e0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+0001e8f0: 6565 733a 2066 6c6f 6174 203d 2030 0a0a  ees: float = 0..
+0001e900: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+0001e910: 662e 656d 7074 793a 0a20 2020 2020 2020  f.empty:.       
+0001e920: 2020 2020 2064 6620 3d20 6466 5b28 6466       df = df[(df
+0001e930: 5b27 6461 7465 275d 203e 3d20 6f70 656e  ['date'] >= open
+0001e940: 5f64 6174 6529 2026 2028 6466 5b27 6461  _date) & (df['da
+0001e950: 7465 275d 203c 3d20 636c 6f73 655f 6461  te'] <= close_da
+0001e960: 7465 295d 0a20 2020 2020 2020 2020 2020  te)].           
+0001e970: 2066 6565 7320 3d20 7375 6d28 6466 5b27   fees = sum(df['
+0001e980: 6f70 656e 5f66 756e 6427 5d20 2a20 6466  open_fund'] * df
+0001e990: 5b27 6f70 656e 5f6d 6172 6b27 5d20 2a20  ['open_mark'] * 
+0001e9a0: 616d 6f75 6e74 290a 0a20 2020 2020 2020  amount)..       
+0001e9b0: 2023 204e 6567 6174 6520 6665 6573 2066   # Negate fees f
+0001e9c0: 6f72 206c 6f6e 6773 2061 7320 6675 6e64  or longs as fund
+0001e9d0: 696e 675f 6665 6573 2065 7870 6563 7473  ing_fees expects
+0001e9e0: 2069 7420 7468 6973 2077 6179 2062 6173   it this way bas
+0001e9f0: 6564 206f 6e20 6c69 7665 2065 6e64 706f  ed on live endpo
+0001ea00: 696e 7473 2e0a 2020 2020 2020 2020 7265  ints..        re
+0001ea10: 7475 726e 2066 6565 7320 6966 2069 735f  turn fees if is_
+0001ea20: 7368 6f72 7420 656c 7365 202d 6665 6573  short else -fees
+0001ea30: 0a0a 2020 2020 6465 6620 6765 745f 6675  ..    def get_fu
+0001ea40: 6e64 696e 675f 6665 6573 280a 2020 2020  nding_fees(.    
+0001ea50: 2020 2020 2020 2020 7365 6c66 2c20 7061          self, pa
+0001ea60: 6972 3a20 7374 722c 2061 6d6f 756e 743a  ir: str, amount:
+0001ea70: 2066 6c6f 6174 2c20 6973 5f73 686f 7274   float, is_short
+0001ea80: 3a20 626f 6f6c 2c20 6f70 656e 5f64 6174  : bool, open_dat
+0001ea90: 653a 2064 6174 6574 696d 6529 202d 3e20  e: datetime) -> 
+0001eaa0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
+0001eab0: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
+0001eac0: 2066 756e 6469 6e67 2066 6565 732c 2065   funding fees, e
+0001ead0: 6974 6865 7220 6672 6f6d 2074 6865 2065  ither from the e
+0001eae0: 7863 6861 6e67 6520 286c 6976 6529 206f  xchange (live) o
+0001eaf0: 7220 6361 6c63 756c 6174 6573 2074 6865  r calculates the
+0001eb00: 6d0a 2020 2020 2020 2020 6261 7365 6420  m.        based 
+0001eb10: 6f6e 2066 756e 6469 6e67 2072 6174 652f  on funding rate/
+0001eb20: 6d61 726b 2070 7269 6365 2068 6973 746f  mark price histo
+0001eb30: 7279 0a20 2020 2020 2020 203a 7061 7261  ry.        :para
+0001eb40: 6d20 7061 6972 3a20 5468 6520 7175 6f74  m pair: The quot
+0001eb50: 652f 6261 7365 2070 6169 7220 6f66 2074  e/base pair of t
+0001eb60: 6865 2074 7261 6465 0a20 2020 2020 2020  he trade.       
+0001eb70: 203a 7061 7261 6d20 6973 5f73 686f 7274   :param is_short
+0001eb80: 3a20 7472 6164 6520 6469 7265 6374 696f  : trade directio
+0001eb90: 6e0a 2020 2020 2020 2020 3a70 6172 616d  n.        :param
+0001eba0: 2061 6d6f 756e 743a 2054 7261 6465 2061   amount: Trade a
+0001ebb0: 6d6f 756e 740a 2020 2020 2020 2020 3a70  mount.        :p
+0001ebc0: 6172 616d 206f 7065 6e5f 6461 7465 3a20  aram open_date: 
+0001ebd0: 4f70 656e 2064 6174 6520 6f66 2074 6865  Open date of the
+0001ebe0: 2074 7261 6465 0a20 2020 2020 2020 203a   trade.        :
+0001ebf0: 7265 7475 726e 3a20 6675 6e64 696e 6720  return: funding 
+0001ec00: 6665 6520 7369 6e63 6520 6f70 656e 5f64  fee since open_d
+0001ec10: 6174 650a 2020 2020 2020 2020 3a72 6169  ate.        :rai
+0001ec20: 7365 733a 2045 7863 6861 6e67 6545 7272  ses: ExchangeErr
+0001ec30: 6f72 2069 6620 736f 6d65 7468 696e 6720  or if something 
+0001ec40: 676f 6573 2077 726f 6e67 2e0a 2020 2020  goes wrong..    
+0001ec50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001ec60: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
+0001ec70: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
+0001ec80: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
+0001ec90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001eca0: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
+0001ecb0: 6e27 5d3a 0a20 2020 2020 2020 2020 2020  n']:.           
+0001ecc0: 2020 2020 2066 756e 6469 6e67 5f66 6565       funding_fee
+0001ecd0: 7320 3d20 7365 6c66 2e5f 6665 7463 685f  s = self._fetch_
+0001ece0: 616e 645f 6361 6c63 756c 6174 655f 6675  and_calculate_fu
+0001ecf0: 6e64 696e 675f 6665 6573 280a 2020 2020  nding_fees(.    
+0001ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed10: 7061 6972 2c20 616d 6f75 6e74 2c20 6973  pair, amount, is
+0001ed20: 5f73 686f 7274 2c20 6f70 656e 5f64 6174  _short, open_dat
+0001ed30: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0001ed40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001ed50: 2020 2020 2066 756e 6469 6e67 5f66 6565       funding_fee
+0001ed60: 7320 3d20 7365 6c66 2e5f 6765 745f 6675  s = self._get_fu
+0001ed70: 6e64 696e 675f 6665 6573 5f66 726f 6d5f  nding_fees_from_
+0001ed80: 6578 6368 616e 6765 2870 6169 722c 206f  exchange(pair, o
+0001ed90: 7065 6e5f 6461 7465 290a 2020 2020 2020  pen_date).      
+0001eda0: 2020 2020 2020 7265 7475 726e 2066 756e        return fun
+0001edb0: 6469 6e67 5f66 6565 730a 2020 2020 2020  ding_fees.      
+0001edc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001edd0: 2020 2020 7265 7475 726e 2030 2e30 0a0a      return 0.0..
+0001ede0: 2020 2020 6465 6620 6765 745f 6c69 7175      def get_liqu
+0001edf0: 6964 6174 696f 6e5f 7072 6963 6528 0a20  idation_price(. 
+0001ee00: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0001ee10: 2020 2020 2070 6169 723a 2073 7472 2c0a       pair: str,.
+0001ee20: 2020 2020 2020 2020 2320 4472 792d 7275          # Dry-ru
+0001ee30: 6e0a 2020 2020 2020 2020 6f70 656e 5f72  n.        open_r
+0001ee40: 6174 653a 2066 6c6f 6174 2c20 2020 2320  ate: float,   # 
+0001ee50: 456e 7472 7920 7072 6963 6520 6f66 2070  Entry price of p
+0001ee60: 6f73 6974 696f 6e0a 2020 2020 2020 2020  osition.        
+0001ee70: 6973 5f73 686f 7274 3a20 626f 6f6c 2c0a  is_short: bool,.
+0001ee80: 2020 2020 2020 2020 616d 6f75 6e74 3a20          amount: 
+0001ee90: 666c 6f61 742c 2020 2320 4162 736f 6c75  float,  # Absolu
+0001eea0: 7465 2076 616c 7565 206f 6620 706f 7369  te value of posi
+0001eeb0: 7469 6f6e 2073 697a 650a 2020 2020 2020  tion size.      
+0001eec0: 2020 7374 616b 655f 616d 6f75 6e74 3a20    stake_amount: 
+0001eed0: 666c 6f61 742c 0a20 2020 2020 2020 206c  float,.        l
+0001eee0: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
+0001eef0: 2020 2020 2020 2020 7761 6c6c 6574 5f62          wallet_b
+0001ef00: 616c 616e 6365 3a20 666c 6f61 742c 0a20  alance: float,. 
+0001ef10: 2020 2020 2020 206d 6d5f 6578 5f31 3a20         mm_ex_1: 
+0001ef20: 666c 6f61 7420 3d20 302e 302c 2020 2320  float = 0.0,  # 
+0001ef30: 2842 696e 616e 6365 2920 4372 6f73 7320  (Binance) Cross 
+0001ef40: 6f6e 6c79 0a20 2020 2020 2020 2075 706e  only.        upn
+0001ef50: 6c5f 6578 5f31 3a20 666c 6f61 7420 3d20  l_ex_1: float = 
+0001ef60: 302e 302c 2020 2320 2842 696e 616e 6365  0.0,  # (Binance
+0001ef70: 2920 4372 6f73 7320 6f6e 6c79 0a20 2020  ) Cross only.   
+0001ef80: 2029 202d 3e20 4f70 7469 6f6e 616c 5b66   ) -> Optional[f
+0001ef90: 6c6f 6174 5d3a 0a20 2020 2020 2020 2022  loat]:.        "
+0001efa0: 2222 0a20 2020 2020 2020 2053 6574 2773  "".        Set's
+0001efb0: 2074 6865 206d 6172 6769 6e20 6d6f 6465   the margin mode
+0001efc0: 206f 6e20 7468 6520 6578 6368 616e 6765   on the exchange
+0001efd0: 2074 6f20 6372 6f73 7320 6f72 2069 736f   to cross or iso
+0001efe0: 6c61 7465 6420 666f 7220 6120 7370 6563  lated for a spec
+0001eff0: 6966 6963 2070 6169 720a 2020 2020 2020  ific pair.      
+0001f000: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0001f010: 2073 656c 662e 7472 6164 696e 675f 6d6f   self.trading_mo
+0001f020: 6465 203d 3d20 5472 6164 696e 674d 6f64  de == TradingMod
+0001f030: 652e 5350 4f54 3a0a 2020 2020 2020 2020  e.SPOT:.        
+0001f040: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0001f050: 2020 2020 2020 2020 656c 6966 2028 7365          elif (se
+0001f060: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+0001f070: 213d 2054 7261 6469 6e67 4d6f 6465 2e46  != TradingMode.F
+0001f080: 5554 5552 4553 293a 0a20 2020 2020 2020  UTURES):.       
+0001f090: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+0001f0a0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+0001f0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f0c0: 2066 227b 7365 6c66 2e6e 616d 657d 2064   f"{self.name} d
+0001f0d0: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
+0001f0e0: 7b73 656c 662e 6d61 7267 696e 5f6d 6f64  {self.margin_mod
+0001f0f0: 657d 207b 7365 6c66 2e74 7261 6469 6e67  e} {self.trading
+0001f100: 5f6d 6f64 657d 2229 0a0a 2020 2020 2020  _mode}")..      
+0001f110: 2020 6c69 7175 6964 6174 696f 6e5f 7072    liquidation_pr
+0001f120: 6963 6520 3d20 4e6f 6e65 0a20 2020 2020  ice = None.     
+0001f130: 2020 2069 6620 7365 6c66 2e5f 636f 6e66     if self._conf
+0001f140: 6967 5b27 6472 795f 7275 6e27 5d20 6f72  ig['dry_run'] or
+0001f150: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
+0001f160: 6765 5f68 6173 2822 6665 7463 6850 6f73  ge_has("fetchPos
+0001f170: 6974 696f 6e73 2229 3a0a 0a20 2020 2020  itions"):..     
+0001f180: 2020 2020 2020 206c 6971 7569 6461 7469         liquidati
+0001f190: 6f6e 5f70 7269 6365 203d 2073 656c 662e  on_price = self.
+0001f1a0: 6472 795f 7275 6e5f 6c69 7175 6964 6174  dry_run_liquidat
+0001f1b0: 696f 6e5f 7072 6963 6528 0a20 2020 2020  ion_price(.     
+0001f1c0: 2020 2020 2020 2020 2020 2070 6169 723d             pair=
+0001f1d0: 7061 6972 2c0a 2020 2020 2020 2020 2020  pair,.          
+0001f1e0: 2020 2020 2020 6f70 656e 5f72 6174 653d        open_rate=
+0001f1f0: 6f70 656e 5f72 6174 652c 0a20 2020 2020  open_rate,.     
+0001f200: 2020 2020 2020 2020 2020 2069 735f 7368             is_sh
+0001f210: 6f72 743d 6973 5f73 686f 7274 2c0a 2020  ort=is_short,.  
+0001f220: 2020 2020 2020 2020 2020 2020 2020 616d                am
+0001f230: 6f75 6e74 3d61 6d6f 756e 742c 0a20 2020  ount=amount,.   
+0001f240: 2020 2020 2020 2020 2020 2020 206c 6576               lev
+0001f250: 6572 6167 653d 6c65 7665 7261 6765 2c0a  erage=leverage,.
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 7374 616b 655f 616d 6f75 6e74 3d73 7461  stake_amount=sta
+0001f280: 6b65 5f61 6d6f 756e 742c 0a20 2020 2020  ke_amount,.     
+0001f290: 2020 2020 2020 2020 2020 2077 616c 6c65             walle
+0001f2a0: 745f 6261 6c61 6e63 653d 7761 6c6c 6574  t_balance=wallet
+0001f2b0: 5f62 616c 616e 6365 2c0a 2020 2020 2020  _balance,.      
+0001f2c0: 2020 2020 2020 2020 2020 6d6d 5f65 785f            mm_ex_
+0001f2d0: 313d 6d6d 5f65 785f 312c 0a20 2020 2020  1=mm_ex_1,.     
+0001f2e0: 2020 2020 2020 2020 2020 2075 706e 6c5f             upnl_
+0001f2f0: 6578 5f31 3d75 706e 6c5f 6578 5f31 0a20  ex_1=upnl_ex_1. 
+0001f300: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001f310: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001f320: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+0001f330: 203d 2073 656c 662e 6665 7463 685f 706f   = self.fetch_po
+0001f340: 7369 7469 6f6e 7328 7061 6972 290a 2020  sitions(pair).  
+0001f350: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001f360: 2870 6f73 6974 696f 6e73 2920 3e20 303a  (positions) > 0:
+0001f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f380: 2070 6f73 203d 2070 6f73 6974 696f 6e73   pos = positions
+0001f390: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001f3a0: 2020 2020 6c69 7175 6964 6174 696f 6e5f      liquidation_
+0001f3b0: 7072 6963 6520 3d20 706f 735b 276c 6971  price = pos['liq
+0001f3c0: 7569 6461 7469 6f6e 5072 6963 6527 5d0a  uidationPrice'].
+0001f3d0: 0a20 2020 2020 2020 2069 6620 6c69 7175  .        if liqu
+0001f3e0: 6964 6174 696f 6e5f 7072 6963 6520 6973  idation_price is
+0001f3f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001f400: 2020 2020 2020 2062 7566 6665 725f 616d         buffer_am
+0001f410: 6f75 6e74 203d 2061 6273 286f 7065 6e5f  ount = abs(open_
+0001f420: 7261 7465 202d 206c 6971 7569 6461 7469  rate - liquidati
+0001f430: 6f6e 5f70 7269 6365 2920 2a20 7365 6c66  on_price) * self
+0001f440: 2e6c 6971 7569 6461 7469 6f6e 5f62 7566  .liquidation_buf
+0001f450: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
+0001f460: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+0001f470: 655f 6275 6666 6572 203d 2028 0a20 2020  e_buffer = (.   
+0001f480: 2020 2020 2020 2020 2020 2020 206c 6971               liq
+0001f490: 7569 6461 7469 6f6e 5f70 7269 6365 202d  uidation_price -
+0001f4a0: 2062 7566 6665 725f 616d 6f75 6e74 0a20   buffer_amount. 
+0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001f4c0: 6620 6973 5f73 686f 7274 2065 6c73 650a  f is_short else.
+0001f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4e0: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+0001f4f0: 6520 2b20 6275 6666 6572 5f61 6d6f 756e  e + buffer_amoun
+0001f500: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+0001f510: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f520: 726e 206d 6178 286c 6971 7569 6461 7469  rn max(liquidati
+0001f530: 6f6e 5f70 7269 6365 5f62 7566 6665 722c  on_price_buffer,
+0001f540: 2030 2e30 290a 2020 2020 2020 2020 656c   0.0).        el
+0001f550: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001f560: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+0001f570: 2064 6566 2064 7279 5f72 756e 5f6c 6971   def dry_run_liq
+0001f580: 7569 6461 7469 6f6e 5f70 7269 6365 280a  uidation_price(.
+0001f590: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001f5a0: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
+0001f5b0: 0a20 2020 2020 2020 206f 7065 6e5f 7261  .        open_ra
+0001f5c0: 7465 3a20 666c 6f61 742c 2020 2023 2045  te: float,   # E
+0001f5d0: 6e74 7279 2070 7269 6365 206f 6620 706f  ntry price of po
+0001f5e0: 7369 7469 6f6e 0a20 2020 2020 2020 2069  sition.        i
+0001f5f0: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
+0001f600: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
+0001f610: 6c6f 6174 2c0a 2020 2020 2020 2020 7374  loat,.        st
+0001f620: 616b 655f 616d 6f75 6e74 3a20 666c 6f61  ake_amount: floa
+0001f630: 742c 0a20 2020 2020 2020 206c 6576 6572  t,.        lever
+0001f640: 6167 653a 2066 6c6f 6174 2c0a 2020 2020  age: float,.    
+0001f650: 2020 2020 7761 6c6c 6574 5f62 616c 616e      wallet_balan
+0001f660: 6365 3a20 666c 6f61 742c 2020 2320 4f72  ce: float,  # Or
+0001f670: 206d 6172 6769 6e20 6261 6c61 6e63 650a   margin balance.
+0001f680: 2020 2020 2020 2020 6d6d 5f65 785f 313a          mm_ex_1:
+0001f690: 2066 6c6f 6174 203d 2030 2e30 2c20 2023   float = 0.0,  #
+0001f6a0: 2028 4269 6e61 6e63 6529 2043 726f 7373   (Binance) Cross
+0001f6b0: 206f 6e6c 790a 2020 2020 2020 2020 7570   only.        up
+0001f6c0: 6e6c 5f65 785f 313a 2066 6c6f 6174 203d  nl_ex_1: float =
+0001f6d0: 2030 2e30 2c20 2023 2028 4269 6e61 6e63   0.0,  # (Binanc
+0001f6e0: 6529 2043 726f 7373 206f 6e6c 790a 2020  e) Cross only.  
+0001f6f0: 2020 2920 2d3e 204f 7074 696f 6e61 6c5b    ) -> Optional[
+0001f700: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
+0001f710: 2222 220a 2020 2020 2020 2020 496d 706f  """.        Impo
+0001f720: 7274 616e 743a 204d 7573 7420 6265 2066  rtant: Must be f
+0001f730: 6574 6368 696e 6720 6461 7461 2066 726f  etching data fro
+0001f740: 6d20 6361 6368 6564 2076 616c 7565 7320  m cached values 
+0001f750: 6173 2074 6869 7320 6973 2075 7365 6420  as this is used 
+0001f760: 6279 2062 6163 6b74 6573 7469 6e67 210a  by backtesting!.
+0001f770: 2020 2020 2020 2020 5045 5250 4554 5541          PERPETUA
+0001f780: 4c3a 0a20 2020 2020 2020 2020 6761 7465  L:.         gate
+0001f790: 3a20 6874 7470 733a 2f2f 7777 772e 6761  : https://www.ga
+0001f7a0: 7465 2e69 6f2f 6865 6c70 2f66 7574 7572  te.io/help/futur
+0001f7b0: 6573 2f66 7574 7572 6573 2f32 3737 3234  es/futures/27724
+0001f7c0: 2f6c 6971 7569 6461 7469 6f6e 2d70 7269  /liquidation-pri
+0001f7d0: 6365 2d62 616e 6b72 7570 7463 792d 7072  ce-bankruptcy-pr
+0001f7e0: 6963 650a 2020 2020 2020 2020 203e 204c  ice.         > L
+0001f7f0: 6971 7569 6461 7469 6f6e 2050 7269 6365  iquidation Price
+0001f800: 203d 2028 456e 7472 7920 5072 6963 6520   = (Entry Price 
+0001f810: c2b1 204d 6172 6769 6e20 2f20 436f 6e74  .. Margin / Cont
+0001f820: 7261 6374 204d 756c 7469 706c 6965 7220  ract Multiplier 
+0001f830: 2f20 5369 7a65 2920 2f0a 2020 2020 2020  / Size) /.      
+0001f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f850: 2020 2020 2020 2020 2020 5b20 3120 c2b1            [ 1 ..
+0001f860: 2028 4d61 696e 7465 6e61 6e63 6520 4d61   (Maintenance Ma
+0001f870: 7267 696e 2052 6174 696f 202b 2054 616b  rgin Ratio + Tak
+0001f880: 6572 2052 6174 6529 5d0a 2020 2020 2020  er Rate)].      
+0001f890: 2020 2020 2020 5768 6572 6569 6e2c 2022        Wherein, "
+0001f8a0: 2b22 206f 7220 222d 2220 6465 7065 6e64  +" or "-" depend
+0001f8b0: 7320 6f6e 2077 6865 7468 6572 2074 6865  s on whether the
+0001f8c0: 2063 6f6e 7472 6163 7420 676f 6573 206c   contract goes l
+0001f8d0: 6f6e 6720 6f72 2073 686f 7274 3a0a 2020  ong or short:.  
+0001f8e0: 2020 2020 2020 2020 2020 222d 2220 666f            "-" fo
+0001f8f0: 7220 6c6f 6e67 2c20 616e 6420 222b 2220  r long, and "+" 
+0001f900: 666f 7220 7368 6f72 742e 0a0a 2020 2020  for short...    
+0001f910: 2020 2020 206f 6b65 783a 2068 7474 7073       okex: https
+0001f920: 3a2f 2f77 7777 2e6f 6b65 782e 636f 6d2f  ://www.okex.com/
+0001f930: 7375 7070 6f72 742f 6863 2f65 6e2d 7573  support/hc/en-us
+0001f940: 2f61 7274 6963 6c65 732f 0a20 2020 2020  /articles/.     
+0001f950: 2020 2020 2020 2033 3630 3035 3339 3039         360053909
+0001f960: 3539 322d 5649 2d49 6e74 726f 6475 6374  592-VI-Introduct
+0001f970: 696f 6e2d 746f 2d74 6865 2d69 736f 6c61  ion-to-the-isola
+0001f980: 7465 642d 6d6f 6465 2d6f 662d 5369 6e67  ted-mode-of-Sing
+0001f990: 6c65 2d4d 756c 7469 2d63 7572 7265 6e63  le-Multi-currenc
+0001f9a0: 792d 506f 7274 666f 6c69 6f2d 6d61 7267  y-Portfolio-marg
+0001f9b0: 696e 0a0a 2020 2020 2020 2020 3a70 6172  in..        :par
+0001f9c0: 616d 2070 6169 723a 2050 6169 7220 746f  am pair: Pair to
+0001f9d0: 2063 616c 6375 6c61 7465 206c 6971 7569   calculate liqui
+0001f9e0: 6461 7469 6f6e 2070 7269 6365 2066 6f72  dation price for
+0001f9f0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001fa00: 6f70 656e 5f72 6174 653a 2045 6e74 7279  open_rate: Entry
+0001fa10: 2070 7269 6365 206f 6620 706f 7369 7469   price of positi
+0001fa20: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
+0001fa30: 6d20 6973 5f73 686f 7274 3a20 5472 7565  m is_short: True
+0001fa40: 2069 6620 7468 6520 7472 6164 6520 6973   if the trade is
+0001fa50: 2061 2073 686f 7274 2c20 6661 6c73 6520   a short, false 
+0001fa60: 6f74 6865 7277 6973 650a 2020 2020 2020  otherwise.      
+0001fa70: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
+0001fa80: 2041 6273 6f6c 7574 6520 7661 6c75 6520   Absolute value 
+0001fa90: 6f66 2070 6f73 6974 696f 6e20 7369 7a65  of position size
+0001faa0: 2069 6e63 6c2e 206c 6576 6572 6167 6520   incl. leverage 
+0001fab0: 2869 6e20 6261 7365 2063 7572 7265 6e63  (in base currenc
+0001fac0: 7929 0a20 2020 2020 2020 203a 7061 7261  y).        :para
+0001fad0: 6d20 7374 616b 655f 616d 6f75 6e74 3a20  m stake_amount: 
+0001fae0: 5374 616b 6520 616d 6f75 6e74 202d 2043  Stake amount - C
+0001faf0: 6f6c 6c61 7465 7261 6c20 696e 2073 6574  ollateral in set
+0001fb00: 746c 6520 6375 7272 656e 6379 2e0a 2020  tle currency..  
+0001fb10: 2020 2020 2020 3a70 6172 616d 206c 6576        :param lev
+0001fb20: 6572 6167 653a 204c 6576 6572 6167 6520  erage: Leverage 
+0001fb30: 7573 6564 2066 6f72 2074 6869 7320 706f  used for this po
+0001fb40: 7369 7469 6f6e 2e0a 2020 2020 2020 2020  sition..        
+0001fb50: 3a70 6172 616d 2074 7261 6469 6e67 5f6d  :param trading_m
+0001fb60: 6f64 653a 2053 504f 542c 204d 4152 4749  ode: SPOT, MARGI
+0001fb70: 4e2c 2046 5554 5552 4553 2c20 6574 632e  N, FUTURES, etc.
+0001fb80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001fb90: 6d61 7267 696e 5f6d 6f64 653a 2045 6974  margin_mode: Eit
+0001fba0: 6865 7220 4953 4f4c 4154 4544 206f 7220  her ISOLATED or 
+0001fbb0: 4352 4f53 530a 2020 2020 2020 2020 3a70  CROSS.        :p
+0001fbc0: 6172 616d 2077 616c 6c65 745f 6261 6c61  aram wallet_bala
+0001fbd0: 6e63 653a 2041 6d6f 756e 7420 6f66 206d  nce: Amount of m
+0001fbe0: 6172 6769 6e5f 6d6f 6465 2069 6e20 7468  argin_mode in th
+0001fbf0: 6520 7761 6c6c 6574 2062 6569 6e67 2075  e wallet being u
+0001fc00: 7365 6420 746f 2074 7261 6465 0a20 2020  sed to trade.   
+0001fc10: 2020 2020 2020 2020 2043 726f 7373 2d4d           Cross-M
+0001fc20: 6172 6769 6e20 4d6f 6465 3a20 6372 6f73  argin Mode: cros
+0001fc30: 7357 616c 6c65 7442 616c 616e 6365 0a20  sWalletBalance. 
+0001fc40: 2020 2020 2020 2020 2020 2049 736f 6c61             Isola
+0001fc50: 7465 642d 4d61 7267 696e 204d 6f64 653a  ted-Margin Mode:
+0001fc60: 2069 736f 6c61 7465 6457 616c 6c65 7442   isolatedWalletB
+0001fc70: 616c 616e 6365 0a0a 2020 2020 2020 2020  alance..        
+0001fc80: 2320 2a20 4e6f 7420 7265 7175 6972 6564  # * Not required
+0001fc90: 2062 7920 4761 7465 206f 7220 4f4b 580a   by Gate or OKX.
+0001fca0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+0001fcb0: 6d5f 6578 5f31 3a0a 2020 2020 2020 2020  m_ex_1:.        
+0001fcc0: 3a70 6172 616d 2075 706e 6c5f 6578 5f31  :param upnl_ex_1
+0001fcd0: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
+0001fce0: 2020 2020 2020 206d 6172 6b65 7420 3d20         market = 
+0001fcf0: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
+0001fd00: 725d 0a20 2020 2020 2020 2074 616b 6572  r].        taker
+0001fd10: 5f66 6565 5f72 6174 6520 3d20 6d61 726b  _fee_rate = mark
+0001fd20: 6574 5b27 7461 6b65 7227 5d0a 2020 2020  et['taker'].    
+0001fd30: 2020 2020 6d6d 5f72 6174 696f 2c20 5f20      mm_ratio, _ 
+0001fd40: 3d20 7365 6c66 2e67 6574 5f6d 6169 6e74  = self.get_maint
+0001fd50: 656e 616e 6365 5f72 6174 696f 5f61 6e64  enance_ratio_and
+0001fd60: 5f61 6d74 2870 6169 722c 2073 7461 6b65  _amt(pair, stake
+0001fd70: 5f61 6d6f 756e 7429 0a0a 2020 2020 2020  _amount)..      
+0001fd80: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+0001fd90: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+0001fda0: 674d 6f64 652e 4655 5455 5245 5320 616e  gMode.FUTURES an
+0001fdb0: 6420 7365 6c66 2e6d 6172 6769 6e5f 6d6f  d self.margin_mo
+0001fdc0: 6465 203d 3d20 4d61 7267 696e 4d6f 6465  de == MarginMode
+0001fdd0: 2e49 534f 4c41 5445 443a 0a0a 2020 2020  .ISOLATED:..    
+0001fde0: 2020 2020 2020 2020 6966 206d 6172 6b65          if marke
+0001fdf0: 745b 2769 6e76 6572 7365 275d 3a0a 2020  t['inverse']:.  
+0001fe00: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001fe10: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001fe20: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+0001fe30: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+0001fe40: 7265 7174 7261 6465 2064 6f65 7320 6e6f  reqtrade does no
+0001fe50: 7420 7965 7420 7375 7070 6f72 7420 696e  t yet support in
+0001fe60: 7665 7273 6520 636f 6e74 7261 6374 7322  verse contracts"
+0001fe70: 290a 0a20 2020 2020 2020 2020 2020 2076  )..            v
+0001fe80: 616c 7565 203d 2077 616c 6c65 745f 6261  alue = wallet_ba
+0001fe90: 6c61 6e63 6520 2f20 616d 6f75 6e74 0a0a  lance / amount..
+0001fea0: 2020 2020 2020 2020 2020 2020 6d6d 5f72              mm_r
+0001feb0: 6174 696f 5f74 616b 6572 203d 2028 6d6d  atio_taker = (mm
+0001fec0: 5f72 6174 696f 202b 2074 616b 6572 5f66  _ratio + taker_f
+0001fed0: 6565 5f72 6174 6529 0a20 2020 2020 2020  ee_rate).       
+0001fee0: 2020 2020 2069 6620 6973 5f73 686f 7274       if is_short
+0001fef0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ff00: 2020 7265 7475 726e 2028 6f70 656e 5f72    return (open_r
+0001ff10: 6174 6520 2b20 7661 6c75 6529 202f 2028  ate + value) / (
+0001ff20: 3120 2b20 6d6d 5f72 6174 696f 5f74 616b  1 + mm_ratio_tak
+0001ff30: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0001ff40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001ff50: 2020 2020 2020 7265 7475 726e 2028 6f70        return (op
+0001ff60: 656e 5f72 6174 6520 2d20 7661 6c75 6529  en_rate - value)
+0001ff70: 202f 2028 3120 2d20 6d6d 5f72 6174 696f   / (1 - mm_ratio
+0001ff80: 5f74 616b 6572 290a 2020 2020 2020 2020  _taker).        
+0001ff90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001ffa0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+0001ffb0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
+0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+0001ffd0: 7265 7174 7261 6465 206f 6e6c 7920 7375  reqtrade only su
+0001ffe0: 7070 6f72 7473 2069 736f 6c61 7465 6420  pports isolated 
+0001fff0: 6675 7475 7265 7320 666f 7220 6c65 7665  futures for leve
+00020000: 7261 6765 2074 7261 6469 6e67 2229 0a0a  rage trading")..
+00020010: 2020 2020 6465 6620 6765 745f 6d61 696e      def get_main
+00020020: 7465 6e61 6e63 655f 7261 7469 6f5f 616e  tenance_ratio_an
+00020030: 645f 616d 7428 0a20 2020 2020 2020 2073  d_amt(.        s
+00020040: 656c 662c 0a20 2020 2020 2020 2070 6169  elf,.        pai
+00020050: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
+00020060: 6e6f 6d69 6e61 6c5f 7661 6c75 653a 2066  nominal_value: f
+00020070: 6c6f 6174 2c0a 2020 2020 2920 2d3e 2054  loat,.    ) -> T
+00020080: 7570 6c65 5b66 6c6f 6174 2c20 4f70 7469  uple[float, Opti
+00020090: 6f6e 616c 5b66 6c6f 6174 5d5d 3a0a 2020  onal[float]]:.  
+000200a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000200b0: 2020 496d 706f 7274 616e 743a 204d 7573    Important: Mus
+000200c0: 7420 6265 2066 6574 6368 696e 6720 6461  t be fetching da
+000200d0: 7461 2066 726f 6d20 6361 6368 6564 2076  ta from cached v
+000200e0: 616c 7565 7320 6173 2074 6869 7320 6973  alues as this is
+000200f0: 2075 7365 6420 6279 2062 6163 6b74 6573   used by backtes
+00020100: 7469 6e67 210a 2020 2020 2020 2020 3a70  ting!.        :p
+00020110: 6172 616d 2070 6169 723a 204d 6172 6b65  aram pair: Marke
+00020120: 7420 7379 6d62 6f6c 0a20 2020 2020 2020  t symbol.       
+00020130: 203a 7061 7261 6d20 6e6f 6d69 6e61 6c5f   :param nominal_
+00020140: 7661 6c75 653a 2054 6865 2074 6f74 616c  value: The total
+00020150: 2074 7261 6465 2061 6d6f 756e 7420 696e   trade amount in
+00020160: 2071 756f 7465 2063 7572 7265 6e63 7920   quote currency 
+00020170: 696e 636c 7564 696e 6720 6c65 7665 7261  including levera
+00020180: 6765 0a20 2020 2020 2020 206d 6169 6e74  ge.        maint
+00020190: 656e 616e 6365 2061 6d6f 756e 7420 6f6e  enance amount on
+000201a0: 6c79 206f 6e20 4269 6e61 6e63 650a 2020  ly on Binance.  
+000201b0: 2020 2020 2020 3a72 6574 7572 6e3a 2028        :return: (
+000201c0: 6d61 696e 7465 6e61 6e63 6520 6d61 7267  maintenance marg
+000201d0: 696e 2072 6174 696f 2c20 6d61 696e 7465  in ratio, mainte
+000201e0: 6e61 6e63 6520 616d 6f75 6e74 290a 2020  nance amount).  
+000201f0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00020200: 2020 2069 6620 2873 656c 662e 5f63 6f6e     if (self._con
+00020210: 6669 672e 6765 7428 2772 756e 6d6f 6465  fig.get('runmode
+00020220: 2729 2069 6e20 4f50 5449 4d49 5a45 5f4d  ') in OPTIMIZE_M
+00020230: 4f44 4553 0a20 2020 2020 2020 2020 2020  ODES.           
+00020240: 2020 2020 206f 7220 7365 6c66 2e65 7863       or self.exc
+00020250: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+00020260: 4c65 7665 7261 6765 5469 6572 7327 290a  LeverageTiers').
+00020270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020280: 6f72 2073 656c 662e 6578 6368 616e 6765  or self.exchange
+00020290: 5f68 6173 2827 6665 7463 684d 6172 6b65  _has('fetchMarke
+000202a0: 744c 6576 6572 6167 6554 6965 7273 2729  tLeverageTiers')
+000202b0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+000202c0: 6966 2070 6169 7220 6e6f 7420 696e 2073  if pair not in s
+000202d0: 656c 662e 5f6c 6576 6572 6167 655f 7469  elf._leverage_ti
+000202e0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+000202f0: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
+00020300: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
+00020310: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00020320: 2020 2020 2020 6622 4d61 696e 7465 6e61        f"Maintena
+00020330: 6e63 6520 6d61 7267 696e 2072 6174 6520  nce margin rate 
+00020340: 666f 7220 7b70 6169 727d 2069 7320 756e  for {pair} is un
+00020350: 6176 6169 6c61 626c 6520 666f 7220 7b73  available for {s
+00020360: 656c 662e 6e61 6d65 7d22 0a20 2020 2020  elf.name}".     
+00020370: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00020380: 2020 2020 2020 2020 2020 7061 6972 5f74            pair_t
+00020390: 6965 7273 203d 2073 656c 662e 5f6c 6576  iers = self._lev
+000203a0: 6572 6167 655f 7469 6572 735b 7061 6972  erage_tiers[pair
+000203b0: 5d0a 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+000203c0: 6f72 2074 6965 7220 696e 2072 6576 6572  or tier in rever
+000203d0: 7365 6428 7061 6972 5f74 6965 7273 293a  sed(pair_tiers):
+000203e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000203f0: 2069 6620 6e6f 6d69 6e61 6c5f 7661 6c75   if nominal_valu
+00020400: 6520 3e3d 2074 6965 725b 276d 696e 4e6f  e >= tier['minNo
+00020410: 7469 6f6e 616c 275d 3a0a 2020 2020 2020  tional']:.      
+00020420: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00020430: 7475 726e 2028 7469 6572 5b27 6d61 696e  turn (tier['main
+00020440: 7465 6e61 6e63 654d 6172 6769 6e52 6174  tenanceMarginRat
+00020450: 6527 5d2c 2074 6965 725b 276d 6169 6e74  e'], tier['maint
+00020460: 416d 7427 5d29 0a0a 2020 2020 2020 2020  Amt'])..        
+00020470: 2020 2020 7261 6973 6520 4578 6368 616e      raise Exchan
+00020480: 6765 4572 726f 7228 226e 6f6d 696e 616c  geError("nominal
+00020490: 2076 616c 7565 2063 616e 206e 6f74 2062   value can not b
+000204a0: 6520 6c6f 7765 7220 7468 616e 2030 2229  e lower than 0")
+000204b0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+000204c0: 6865 206c 6f77 6573 7420 6e6f 7469 6f6e  he lowest notion
+000204d0: 616c 5f66 6c6f 6f72 2066 6f72 2061 6e79  al_floor for any
+000204e0: 2070 6169 7220 696e 2066 6574 6368 5f6c   pair in fetch_l
+000204f0: 6576 6572 6167 655f 7469 6572 7320 6973  everage_tiers is
+00020500: 2061 6c77 6179 7320 3020 6265 6361 7573   always 0 becaus
+00020510: 6520 6974 0a20 2020 2020 2020 2020 2020  e it.           
+00020520: 2023 2064 6573 6372 6962 6573 2074 6865   # describes the
+00020530: 206d 696e 2061 6d74 2066 6f72 2061 2074   min amt for a t
+00020540: 6965 722c 2061 6e64 2074 6865 206c 6f77  ier, and the low
+00020550: 6573 7420 7469 6572 2077 696c 6c20 616c  est tier will al
+00020560: 7761 7973 2067 6f20 646f 776e 2074 6f20  ways go down to 
+00020570: 300a 2020 2020 2020 2020 656c 7365 3a0a  0.        else:.
+00020580: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00020590: 6520 4578 6368 616e 6765 4572 726f 7228  e ExchangeError(
+000205a0: 6622 4361 6e6e 6f74 2067 6574 206d 6169  f"Cannot get mai
+000205b0: 6e74 656e 616e 6365 2072 6174 696f 2075  ntenance ratio u
+000205c0: 7369 6e67 207b 7365 6c66 2e6e 616d 657d  sing {self.name}
+000205d0: 2229 0a                                  ").
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/exchange_utils.py` & `freqtrade-2023.6/freqtrade/exchange/exchange_utils.py`

 * *Files 21% similar despite different names*

```diff
@@ -5,15 +5,17 @@
 from math import ceil, floor
 from typing import Any, Dict, List, Optional, Tuple
 
 import ccxt
 from ccxt import (DECIMAL_PLACES, ROUND, ROUND_DOWN, ROUND_UP, SIGNIFICANT_DIGITS, TICK_SIZE,
                   TRUNCATE, decimal_to_precision)
 
-from freqtrade.exchange.common import BAD_EXCHANGES, EXCHANGE_HAS_OPTIONAL, EXCHANGE_HAS_REQUIRED
+from freqtrade.exchange.common import (BAD_EXCHANGES, EXCHANGE_HAS_OPTIONAL, EXCHANGE_HAS_REQUIRED,
+                                       SUPPORTED_EXCHANGES)
+from freqtrade.types import ValidExchangesType
 from freqtrade.util import FtPrecise
 from freqtrade.util.datetime_helpers import dt_from_ts, dt_ts
 
 
 CcxtModuleType = Any
 
 
@@ -51,22 +53,49 @@
         return False, BAD_EXCHANGES.get(exchange.lower(), '')
     if missing_opt:
         return True, f"missing opt: {', '.join(missing_opt)}"
 
     return True, ''
 
 
-def validate_exchanges(all_exchanges: bool) -> List[Tuple[str, bool, str]]:
+def _build_exchange_list_entry(
+        exchange_name: str, exchangeClasses: Dict[str, Any]) -> ValidExchangesType:
+    valid, comment = validate_exchange(exchange_name)
+    result: ValidExchangesType = {
+        'name': exchange_name,
+        'valid': valid,
+        'supported': exchange_name.lower() in SUPPORTED_EXCHANGES,
+        'comment': comment,
+        'trade_modes': [{'trading_mode': 'spot', 'margin_mode': ''}],
+    }
+    if resolved := exchangeClasses.get(exchange_name.lower()):
+        supported_modes = [{'trading_mode': 'spot', 'margin_mode': ''}] + [
+            {'trading_mode': tm.value, 'margin_mode': mm.value}
+            for tm, mm in resolved['class']._supported_trading_mode_margin_pairs
+        ]
+        result.update({
+            'trade_modes': supported_modes,
+        })
+
+    return result
+
+
+def list_available_exchanges(all_exchanges: bool) -> List[ValidExchangesType]:
     """
     :return: List of tuples with exchangename, valid, reason.
     """
     exchanges = ccxt_exchanges() if all_exchanges else available_exchanges()
-    exchanges_valid = [
-        (e, *validate_exchange(e)) for e in exchanges
+    from freqtrade.resolvers.exchange_resolver import ExchangeResolver
+
+    subclassed = {e['name'].lower(): e for e in ExchangeResolver.search_all_objects({}, False)}
+
+    exchanges_valid: List[ValidExchangesType] = [
+        _build_exchange_list_entry(e, subclassed) for e in exchanges
     ]
+
     return exchanges_valid
 
 
 def timeframe_to_seconds(timeframe: str) -> int:
     """
     Translates the timeframe interval value written in the human readable
     form ('1m', '5m', '1h', '1d', '1w', etc.) to the number
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/gate.py` & `freqtrade-2023.6/freqtrade/exchange/gate.py`

 * *Files 4% similar despite different names*

```diff
@@ -29,15 +29,14 @@
         "stoploss_on_exchange": True,
         "marketOrderRequiresPrice": True,
     }
 
     _ft_has_futures: Dict = {
         "needs_trading_fees": True,
         "marketOrderRequiresPrice": False,
-        "tickers_have_bid_ask": False,
         "fee_cost_in_contracts": False,  # Set explicitly to false for clarity
         "order_props_in_contracts": ['amount', 'filled', 'remaining'],
         "stop_price_type_field": "price_type",
         "stop_price_type_value_mapping": {
             PriceType.LAST: 0,
             PriceType.MARK: 1,
             PriceType.INDEX: 2,
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/hitbtc.py` & `freqtrade-2023.6/freqtrade/exchange/hitbtc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/huobi.py` & `freqtrade-2023.6/freqtrade/exchange/huobi.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/kraken.py` & `freqtrade-2023.6/freqtrade/exchange/kraken.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/kucoin.py` & `freqtrade-2023.6/freqtrade/exchange/kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/okx.py` & `freqtrade-2023.6/freqtrade/exchange/okx.py`

 * *Files 3% similar despite different names*

```diff
@@ -121,14 +121,28 @@
             time_in_force=time_in_force,
         )
         if self.trading_mode == TradingMode.FUTURES and self.margin_mode:
             params['tdMode'] = self.margin_mode.value
             params['posSide'] = self._get_posSide(side, reduceOnly)
         return params
 
+    def __fetch_leverage_already_set(self, pair: str, leverage: float, side: BuySell) -> bool:
+        try:
+            res_lev = self._api.fetch_leverage(symbol=pair, params={
+                    "mgnMode": self.margin_mode.value,
+                    "posSide": self._get_posSide(side, False),
+                })
+            self._log_exchange_response('get_leverage', res_lev)
+            already_set = all(float(x['lever']) == leverage for x in res_lev['data'])
+            return already_set
+
+        except ccxt.BaseError:
+            # Assume all errors as "not set yet"
+            return False
+
     @retrier
     def _lev_prep(self, pair: str, leverage: float, side: BuySell, accept_fail: bool = False):
         if self.trading_mode != TradingMode.SPOT and self.margin_mode is not None:
             try:
                 res = self._api.set_leverage(
                     leverage=leverage,
                     symbol=pair,
@@ -137,16 +151,19 @@
                         "posSide": self._get_posSide(side, False),
                     })
                 self._log_exchange_response('set_leverage', res)
 
             except ccxt.DDoSProtection as e:
                 raise DDosProtection(e) from e
             except (ccxt.NetworkError, ccxt.ExchangeError) as e:
-                raise TemporaryError(
-                    f'Could not set leverage due to {e.__class__.__name__}. Message: {e}') from e
+                already_set = self.__fetch_leverage_already_set(pair, leverage, side)
+                if not already_set:
+                    raise TemporaryError(
+                        f'Could not set leverage due to {e.__class__.__name__}. Message: {e}'
+                        ) from e
             except ccxt.BaseError as e:
                 raise OperationalException(e) from e
 
     def get_max_pair_stake_amount(
         self,
         pair: str,
         price: float,
@@ -178,14 +195,15 @@
             order_reg = self.fetch_order(real_order_id, pair)
             self._log_exchange_response('fetch_stoploss_order1', order_reg)
             order_reg['id_stop'] = order_reg['id']
             order_reg['id'] = order_id
             order_reg['type'] = 'stoploss'
             order_reg['status_stop'] = 'triggered'
             return order_reg
+        order = self._order_contracts_to_amount(order)
         order['type'] = 'stoploss'
         return order
 
     def fetch_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
         if self._config['dry_run']:
             return self.fetch_dry_run_order(order_id)
```

### Comparing `freqtrade-2023.5.1/freqtrade/exchange/types.py` & `freqtrade-2023.6/freqtrade/exchange/types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/RL/Base3ActionRLEnv.py` & `freqtrade-2023.6/freqtrade/freqai/RL/Base3ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/RL/Base4ActionRLEnv.py` & `freqtrade-2023.6/freqtrade/freqai/RL/Base4ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/RL/Base5ActionRLEnv.py` & `freqtrade-2023.6/freqtrade/freqai/RL/Base5ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/RL/BaseEnvironment.py` & `freqtrade-2023.6/freqtrade/freqai/RL/BaseEnvironment.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 import logging
 import random
 from abc import abstractmethod
 from enum import Enum
-from typing import Optional, Type, Union
+from typing import List, Optional, Type, Union
 
 import gymnasium as gym
 import numpy as np
 import pandas as pd
 from gymnasium import spaces
 from gymnasium.utils import seeding
 from pandas import DataFrame
@@ -137,14 +137,17 @@
 
     @abstractmethod
     def set_action_space(self):
         """
         Unique to the environment action count. Must be inherited.
         """
 
+    def action_masks(self) -> List[bool]:
+        return [self._is_valid(action.value) for action in self.actions]
+
     def seed(self, seed: int = 1):
         self.np_random, seed = seeding.np_random(seed)
         return [seed]
 
     def tensorboard_log(self, metric: str, value: Optional[Union[int, float]] = None,
                         inc: Optional[bool] = None, category: str = "custom"):
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/RL/BaseReinforcementLearningModel.py` & `freqtrade-2023.6/freqtrade/freqai/RL/BaseReinforcementLearningModel.py`

 * *Files 4% similar despite different names*

```diff
@@ -9,15 +9,16 @@
 import gymnasium as gym
 import numpy as np
 import numpy.typing as npt
 import pandas as pd
 import torch as th
 import torch.multiprocessing
 from pandas import DataFrame
-from stable_baselines3.common.callbacks import EvalCallback
+from sb3_contrib.common.maskable.callbacks import MaskableEvalCallback
+from sb3_contrib.common.maskable.utils import is_masking_supported
 from stable_baselines3.common.monitor import Monitor
 from stable_baselines3.common.utils import set_random_seed
 from stable_baselines3.common.vec_env import SubprocVecEnv, VecMonitor
 
 from freqtrade.exceptions import OperationalException
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 from freqtrade.freqai.freqai_interface import IFreqaiModel
@@ -44,15 +45,15 @@
         super().__init__(config=kwargs['config'])
         self.max_threads = min(self.freqai_info['rl_config'].get(
             'cpu_count', 1), max(int(self.max_system_threads / 2), 1))
         th.set_num_threads(self.max_threads)
         self.reward_params = self.freqai_info['rl_config']['model_reward_parameters']
         self.train_env: Union[VecMonitor, SubprocVecEnv, gym.Env] = gym.Env()
         self.eval_env: Union[VecMonitor, SubprocVecEnv, gym.Env] = gym.Env()
-        self.eval_callback: Optional[EvalCallback] = None
+        self.eval_callback: Optional[MaskableEvalCallback] = None
         self.model_type = self.freqai_info['rl_config']['model_type']
         self.rl_config = self.freqai_info['rl_config']
         self.df_raw: DataFrame = DataFrame()
         self.continual_learning = self.freqai_info.get('continual_learning', False)
         if self.model_type in SB3_MODELS:
             import_str = 'stable_baselines3'
         elif self.model_type in SB3_CONTRIB_MODELS:
@@ -78,14 +79,17 @@
         """
         if self.ft_params.get('use_SVM_to_remove_outliers', False):
             self.ft_params.update({'use_SVM_to_remove_outliers': False})
             logger.warning('User tried to use SVM with RL. Deactivating SVM.')
         if self.ft_params.get('use_DBSCAN_to_remove_outliers', False):
             self.ft_params.update({'use_DBSCAN_to_remove_outliers': False})
             logger.warning('User tried to use DBSCAN with RL. Deactivating DBSCAN.')
+        if self.ft_params.get('DI_threshold', False):
+            self.ft_params.update({'DI_threshold': False})
+            logger.warning('User tried to use DI_threshold with RL. Deactivating DI_threshold.')
         if self.freqai_info['data_split_parameters'].get('shuffle', False):
             self.freqai_info['data_split_parameters'].update({'shuffle': False})
             logger.warning('User tried to shuffle training data. Setting shuffle to False')
 
     def train(
         self, unfiltered_df: DataFrame, pair: str, dk: FreqaiDataKitchen, **kwargs
     ) -> Any:
@@ -103,35 +107,45 @@
         features_filtered, labels_filtered = dk.filter_features(
             unfiltered_df,
             dk.training_features_list,
             dk.label_list,
             training_filter=True,
         )
 
-        data_dictionary: Dict[str, Any] = dk.make_train_test_datasets(
+        dd: Dict[str, Any] = dk.make_train_test_datasets(
             features_filtered, labels_filtered)
-        self.df_raw = copy.deepcopy(data_dictionary["train_features"])
+        self.df_raw = copy.deepcopy(dd["train_features"])
         dk.fit_labels()  # FIXME useless for now, but just satiating append methods
 
         # normalize all data based on train_dataset only
         prices_train, prices_test = self.build_ohlc_price_dataframes(dk.data_dictionary, pair, dk)
 
-        data_dictionary = dk.normalize_data(data_dictionary)
+        dk.feature_pipeline = self.define_data_pipeline(threads=dk.thread_count)
 
-        # data cleaning/analysis
-        self.data_cleaning_train(dk)
+        (dd["train_features"],
+         dd["train_labels"],
+         dd["train_weights"]) = dk.feature_pipeline.fit_transform(dd["train_features"],
+                                                                  dd["train_labels"],
+                                                                  dd["train_weights"])
+
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
+            (dd["test_features"],
+             dd["test_labels"],
+             dd["test_weights"]) = dk.feature_pipeline.transform(dd["test_features"],
+                                                                 dd["test_labels"],
+                                                                 dd["test_weights"])
 
         logger.info(
             f'Training model on {len(dk.data_dictionary["train_features"].columns)}'
-            f' features and {len(data_dictionary["train_features"])} data points'
+            f' features and {len(dd["train_features"])} data points'
         )
 
-        self.set_train_and_eval_environments(data_dictionary, prices_train, prices_test, dk)
+        self.set_train_and_eval_environments(dd, prices_train, prices_test, dk)
 
-        model = self.fit(data_dictionary, dk)
+        model = self.fit(dd, dk)
 
         logger.info(f"--------------------done training {pair}--------------------")
 
         return model
 
     def set_train_and_eval_environments(self, data_dictionary: Dict[str, DataFrame],
                                         prices_train: DataFrame, prices_test: DataFrame,
@@ -147,17 +161,19 @@
         train_df = data_dictionary["train_features"]
         test_df = data_dictionary["test_features"]
 
         env_info = self.pack_env_dict(dk.pair)
 
         self.train_env = self.MyRLEnv(df=train_df, prices=prices_train, **env_info)
         self.eval_env = Monitor(self.MyRLEnv(df=test_df, prices=prices_test, **env_info))
-        self.eval_callback = EvalCallback(self.eval_env, deterministic=True,
-                                          render=False, eval_freq=len(train_df),
-                                          best_model_save_path=str(dk.data_path))
+        self.eval_callback = MaskableEvalCallback(self.eval_env, deterministic=True,
+                                                  render=False, eval_freq=len(train_df),
+                                                  best_model_save_path=str(dk.data_path),
+                                                  use_masking=(self.model_type == 'MaskablePPO' and
+                                                               is_masking_supported(self.eval_env)))
 
         actions = self.train_env.get_actions()
         self.tensorboard_callback = TensorboardCallback(verbose=1, actions=actions)
 
     def pack_env_dict(self, pair: str) -> Dict[str, Any]:
         """
         Create dictionary of environment arguments
@@ -232,21 +248,18 @@
         """
 
         dk.find_features(unfiltered_df)
         filtered_dataframe, _ = dk.filter_features(
             unfiltered_df, dk.training_features_list, training_filter=False
         )
 
-        filtered_dataframe = self.drop_ohlc_from_df(filtered_dataframe, dk)
+        dk.data_dictionary["prediction_features"] = self.drop_ohlc_from_df(filtered_dataframe, dk)
 
-        filtered_dataframe = dk.normalize_data_from_metadata(filtered_dataframe)
-        dk.data_dictionary["prediction_features"] = filtered_dataframe
-
-        # optional additional data cleaning/analysis
-        self.data_cleaning_predict(dk)
+        dk.data_dictionary["prediction_features"], _, _ = dk.feature_pipeline.transform(
+            dk.data_dictionary["prediction_features"], outlier_check=True)
 
         pred_df = self.rl_model_predict(
             dk.data_dictionary["prediction_features"], dk, self.model)
         pred_df.fillna(0, inplace=True)
 
         return (pred_df, dk.do_predict)
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseClassifierModel.py` & `freqtrade-2023.6/freqtrade/freqai/base_models/BaseClassifierModel.py`

 * *Files 18% similar despite different names*

```diff
@@ -13,16 +13,16 @@
 
 logger = logging.getLogger(__name__)
 
 
 class BaseClassifierModel(IFreqaiModel):
     """
     Base class for regression type models (e.g. Catboost, LightGBM, XGboost etc.).
-    User *must* inherit from this class and set fit() and predict(). See example scripts
-    such as prediction_models/CatboostPredictionModel.py for guidance.
+    User *must* inherit from this class and set fit(). See example scripts
+    such as prediction_models/CatboostClassifier.py for guidance.
     """
 
     def train(
         self, unfiltered_df: DataFrame, pair: str, dk: FreqaiDataKitchen, **kwargs
     ) -> Any:
         """
         Filter the training data and train a model to it. Train makes heavy use of the datakitchen
@@ -46,29 +46,38 @@
         )
 
         start_date = unfiltered_df["date"].iloc[0].strftime("%Y-%m-%d")
         end_date = unfiltered_df["date"].iloc[-1].strftime("%Y-%m-%d")
         logger.info(f"-------------------- Training on data from {start_date} to "
                     f"{end_date} --------------------")
         # split data into train/test data.
-        data_dictionary = dk.make_train_test_datasets(features_filtered, labels_filtered)
+        dd = dk.make_train_test_datasets(features_filtered, labels_filtered)
         if not self.freqai_info.get("fit_live_predictions_candles", 0) or not self.live:
             dk.fit_labels()
-        # normalize all data based on train_dataset only
-        data_dictionary = dk.normalize_data(data_dictionary)
+        dk.feature_pipeline = self.define_data_pipeline(threads=dk.thread_count)
 
-        # optional additional data cleaning/analysis
-        self.data_cleaning_train(dk)
+        (dd["train_features"],
+         dd["train_labels"],
+         dd["train_weights"]) = dk.feature_pipeline.fit_transform(dd["train_features"],
+                                                                  dd["train_labels"],
+                                                                  dd["train_weights"])
+
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
+            (dd["test_features"],
+             dd["test_labels"],
+             dd["test_weights"]) = dk.feature_pipeline.transform(dd["test_features"],
+                                                                 dd["test_labels"],
+                                                                 dd["test_weights"])
 
         logger.info(
             f"Training model on {len(dk.data_dictionary['train_features'].columns)} features"
         )
-        logger.info(f"Training model on {len(data_dictionary['train_features'])} data points")
+        logger.info(f"Training model on {len(dd['train_features'])} data points")
 
-        model = self.fit(data_dictionary, dk)
+        model = self.fit(dd, dk)
 
         end_time = time()
 
         logger.info(f"-------------------- Done training {pair} "
                     f"({end_time - start_time:.2f} secs) --------------------")
 
         return model
@@ -85,26 +94,33 @@
         data (NaNs) or felt uncertain about data (PCA and DI index)
         """
 
         dk.find_features(unfiltered_df)
         filtered_df, _ = dk.filter_features(
             unfiltered_df, dk.training_features_list, training_filter=False
         )
-        filtered_df = dk.normalize_data_from_metadata(filtered_df)
+
         dk.data_dictionary["prediction_features"] = filtered_df
 
-        self.data_cleaning_predict(dk)
+        dk.data_dictionary["prediction_features"], outliers, _ = dk.feature_pipeline.transform(
+            dk.data_dictionary["prediction_features"], outlier_check=True)
 
         predictions = self.model.predict(dk.data_dictionary["prediction_features"])
         if self.CONV_WIDTH == 1:
             predictions = np.reshape(predictions, (-1, len(dk.label_list)))
 
         pred_df = DataFrame(predictions, columns=dk.label_list)
 
         predictions_prob = self.model.predict_proba(dk.data_dictionary["prediction_features"])
         if self.CONV_WIDTH == 1:
             predictions_prob = np.reshape(predictions_prob, (-1, len(self.model.classes_)))
         pred_df_prob = DataFrame(predictions_prob, columns=self.model.classes_)
 
         pred_df = pd.concat([pred_df, pred_df_prob], axis=1)
 
+        if dk.feature_pipeline["di"]:
+            dk.DI_values = dk.feature_pipeline["di"].di_values
+        else:
+            dk.DI_values = np.zeros(outliers.shape[0])
+        dk.do_predict = outliers
+
         return (pred_df, dk.do_predict)
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseRegressionModel.py` & `freqtrade-2023.6/freqtrade/freqai/base_models/BaseRegressionModel.py`

 * *Files 17% similar despite different names*

```diff
@@ -12,16 +12,16 @@
 
 logger = logging.getLogger(__name__)
 
 
 class BaseRegressionModel(IFreqaiModel):
     """
     Base class for regression type models (e.g. Catboost, LightGBM, XGboost etc.).
-    User *must* inherit from this class and set fit() and predict(). See example scripts
-    such as prediction_models/CatboostPredictionModel.py for guidance.
+    User *must* inherit from this class and set fit(). See example scripts
+    such as prediction_models/CatboostRegressor.py for guidance.
     """
 
     def train(
         self, unfiltered_df: DataFrame, pair: str, dk: FreqaiDataKitchen, **kwargs
     ) -> Any:
         """
         Filter the training data and train a model to it. Train makes heavy use of the datakitchen
@@ -45,29 +45,41 @@
         )
 
         start_date = unfiltered_df["date"].iloc[0].strftime("%Y-%m-%d")
         end_date = unfiltered_df["date"].iloc[-1].strftime("%Y-%m-%d")
         logger.info(f"-------------------- Training on data from {start_date} to "
                     f"{end_date} --------------------")
         # split data into train/test data.
-        data_dictionary = dk.make_train_test_datasets(features_filtered, labels_filtered)
+        dd = dk.make_train_test_datasets(features_filtered, labels_filtered)
         if not self.freqai_info.get("fit_live_predictions_candles", 0) or not self.live:
             dk.fit_labels()
-        # normalize all data based on train_dataset only
-        data_dictionary = dk.normalize_data(data_dictionary)
+        dk.feature_pipeline = self.define_data_pipeline(threads=dk.thread_count)
+        dk.label_pipeline = self.define_label_pipeline(threads=dk.thread_count)
 
-        # optional additional data cleaning/analysis
-        self.data_cleaning_train(dk)
+        (dd["train_features"],
+         dd["train_labels"],
+         dd["train_weights"]) = dk.feature_pipeline.fit_transform(dd["train_features"],
+                                                                  dd["train_labels"],
+                                                                  dd["train_weights"])
+        dd["train_labels"], _, _ = dk.label_pipeline.fit_transform(dd["train_labels"])
+
+        if self.freqai_info.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
+            (dd["test_features"],
+             dd["test_labels"],
+             dd["test_weights"]) = dk.feature_pipeline.transform(dd["test_features"],
+                                                                 dd["test_labels"],
+                                                                 dd["test_weights"])
+            dd["test_labels"], _, _ = dk.label_pipeline.transform(dd["test_labels"])
 
         logger.info(
             f"Training model on {len(dk.data_dictionary['train_features'].columns)} features"
         )
-        logger.info(f"Training model on {len(data_dictionary['train_features'])} data points")
+        logger.info(f"Training model on {len(dd['train_features'])} data points")
 
-        model = self.fit(data_dictionary, dk)
+        model = self.fit(dd, dk)
 
         end_time = time()
 
         logger.info(f"-------------------- Done training {pair} "
                     f"({end_time - start_time:.2f} secs) --------------------")
 
         return model
@@ -81,25 +93,28 @@
         :return:
         :pred_df: dataframe containing the predictions
         :do_predict: np.array of 1s and 0s to indicate places where freqai needed to remove
         data (NaNs) or felt uncertain about data (PCA and DI index)
         """
 
         dk.find_features(unfiltered_df)
-        filtered_df, _ = dk.filter_features(
+        dk.data_dictionary["prediction_features"], _ = dk.filter_features(
             unfiltered_df, dk.training_features_list, training_filter=False
         )
-        filtered_df = dk.normalize_data_from_metadata(filtered_df)
-        dk.data_dictionary["prediction_features"] = filtered_df
 
-        # optional additional data cleaning/analysis
-        self.data_cleaning_predict(dk)
+        dk.data_dictionary["prediction_features"], outliers, _ = dk.feature_pipeline.transform(
+            dk.data_dictionary["prediction_features"], outlier_check=True)
 
         predictions = self.model.predict(dk.data_dictionary["prediction_features"])
         if self.CONV_WIDTH == 1:
             predictions = np.reshape(predictions, (-1, len(dk.label_list)))
 
         pred_df = DataFrame(predictions, columns=dk.label_list)
 
-        pred_df = dk.denormalize_labels_from_metadata(pred_df)
+        pred_df, _, _ = dk.label_pipeline.inverse_transform(pred_df)
+        if dk.feature_pipeline["di"]:
+            dk.DI_values = dk.feature_pipeline["di"].di_values
+        else:
+            dk.DI_values = np.zeros(outliers.shape[0])
+        dk.do_predict = outliers
 
         return (pred_df, dk.do_predict)
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/data_drawer.py` & `freqtrade-2023.6/freqtrade/freqai/data_drawer.py`

 * *Files 3% similar despite different names*

```diff
@@ -16,21 +16,27 @@
 from joblib.externals import cloudpickle
 from numpy.typing import NDArray
 from pandas import DataFrame
 
 from freqtrade.configuration import TimeRange
 from freqtrade.constants import Config
 from freqtrade.data.history import load_pair_history
+from freqtrade.enums import CandleType
 from freqtrade.exceptions import OperationalException
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 from freqtrade.strategy.interface import IStrategy
 
 
 logger = logging.getLogger(__name__)
 
+FEATURE_PIPELINE = "feature_pipeline"
+LABEL_PIPELINE = "label_pipeline"
+TRAINDF = "trained_df"
+METADATA = "metadata"
+
 
 class pair_info(TypedDict):
     model_filename: str
     trained_timestamp: int
     data_path: str
     extras: dict
 
@@ -420,15 +426,15 @@
         save_path = Path(dk.data_path)
 
         dk.data["data_path"] = str(dk.data_path)
         dk.data["model_filename"] = str(dk.model_filename)
         dk.data["training_features_list"] = list(dk.data_dictionary["train_features"].columns)
         dk.data["label_list"] = dk.label_list
 
-        with (save_path / f"{dk.model_filename}_metadata.json").open("w") as fp:
+        with (save_path / f"{dk.model_filename}_{METADATA}.json").open("w") as fp:
             rapidjson.dump(dk.data, fp, default=self.np_encoder, number_mode=rapidjson.NM_NATIVE)
 
         return
 
     def save_data(self, model: Any, coin: str, dk: FreqaiDataKitchen) -> None:
         """
         Saves all data associated with a model for a single sub-train time range
@@ -445,57 +451,57 @@
         if self.model_type == 'joblib':
             dump(model, save_path / f"{dk.model_filename}_model.joblib")
         elif self.model_type == 'keras':
             model.save(save_path / f"{dk.model_filename}_model.h5")
         elif self.model_type in ["stable_baselines3", "sb3_contrib", "pytorch"]:
             model.save(save_path / f"{dk.model_filename}_model.zip")
 
-        if dk.svm_model is not None:
-            dump(dk.svm_model, save_path / f"{dk.model_filename}_svm_model.joblib")
-
         dk.data["data_path"] = str(dk.data_path)
         dk.data["model_filename"] = str(dk.model_filename)
         dk.data["training_features_list"] = dk.training_features_list
         dk.data["label_list"] = dk.label_list
         # store the metadata
-        with (save_path / f"{dk.model_filename}_metadata.json").open("w") as fp:
+        with (save_path / f"{dk.model_filename}_{METADATA}.json").open("w") as fp:
             rapidjson.dump(dk.data, fp, default=self.np_encoder, number_mode=rapidjson.NM_NATIVE)
 
-        # save the train data to file so we can check preds for area of applicability later
+        # save the pipelines to pickle files
+        with (save_path / f"{dk.model_filename}_{FEATURE_PIPELINE}.pkl").open("wb") as fp:
+            cloudpickle.dump(dk.feature_pipeline, fp)
+
+        with (save_path / f"{dk.model_filename}_{LABEL_PIPELINE}.pkl").open("wb") as fp:
+            cloudpickle.dump(dk.label_pipeline, fp)
+
+        # save the train data to file for post processing if desired
         dk.data_dictionary["train_features"].to_pickle(
-            save_path / f"{dk.model_filename}_trained_df.pkl"
+            save_path / f"{dk.model_filename}_{TRAINDF}.pkl"
         )
 
         dk.data_dictionary["train_dates"].to_pickle(
             save_path / f"{dk.model_filename}_trained_dates_df.pkl"
         )
 
-        if self.freqai_info["feature_parameters"].get("principal_component_analysis"):
-            cloudpickle.dump(
-                dk.pca, (dk.data_path / f"{dk.model_filename}_pca_object.pkl").open("wb")
-            )
-
         self.model_dictionary[coin] = model
         self.pair_dict[coin]["model_filename"] = dk.model_filename
         self.pair_dict[coin]["data_path"] = str(dk.data_path)
 
         if coin not in self.meta_data_dictionary:
             self.meta_data_dictionary[coin] = {}
-        self.meta_data_dictionary[coin]["train_df"] = dk.data_dictionary["train_features"]
-        self.meta_data_dictionary[coin]["meta_data"] = dk.data
+        self.meta_data_dictionary[coin][METADATA] = dk.data
+        self.meta_data_dictionary[coin][FEATURE_PIPELINE] = dk.feature_pipeline
+        self.meta_data_dictionary[coin][LABEL_PIPELINE] = dk.label_pipeline
         self.save_drawer_to_disk()
 
         return
 
     def load_metadata(self, dk: FreqaiDataKitchen) -> None:
         """
         Load only metadata into datakitchen to increase performance during
         presaved backtesting (prediction file loading).
         """
-        with (dk.data_path / f"{dk.model_filename}_metadata.json").open("r") as fp:
+        with (dk.data_path / f"{dk.model_filename}_{METADATA}.json").open("r") as fp:
             dk.data = rapidjson.load(fp, number_mode=rapidjson.NM_NATIVE)
             dk.training_features_list = dk.data["training_features_list"]
             dk.label_list = dk.data["label_list"]
 
     def load_data(self, coin: str, dk: FreqaiDataKitchen) -> Any:  # noqa: C901
         """
         loads all data required to make a prediction on a sub-train time range
@@ -507,63 +513,54 @@
             return None
 
         if dk.live:
             dk.model_filename = self.pair_dict[coin]["model_filename"]
             dk.data_path = Path(self.pair_dict[coin]["data_path"])
 
         if coin in self.meta_data_dictionary:
-            dk.data = self.meta_data_dictionary[coin]["meta_data"]
-            dk.data_dictionary["train_features"] = self.meta_data_dictionary[coin]["train_df"]
+            dk.data = self.meta_data_dictionary[coin][METADATA]
+            dk.feature_pipeline = self.meta_data_dictionary[coin][FEATURE_PIPELINE]
+            dk.label_pipeline = self.meta_data_dictionary[coin][LABEL_PIPELINE]
         else:
-            with (dk.data_path / f"{dk.model_filename}_metadata.json").open("r") as fp:
+            with (dk.data_path / f"{dk.model_filename}_{METADATA}.json").open("r") as fp:
                 dk.data = rapidjson.load(fp, number_mode=rapidjson.NM_NATIVE)
 
-            dk.data_dictionary["train_features"] = pd.read_pickle(
-                dk.data_path / f"{dk.model_filename}_trained_df.pkl"
-            )
+            with (dk.data_path / f"{dk.model_filename}_{FEATURE_PIPELINE}.pkl").open("rb") as fp:
+                dk.feature_pipeline = cloudpickle.load(fp)
+            with (dk.data_path / f"{dk.model_filename}_{LABEL_PIPELINE}.pkl").open("rb") as fp:
+                dk.label_pipeline = cloudpickle.load(fp)
 
         dk.training_features_list = dk.data["training_features_list"]
         dk.label_list = dk.data["label_list"]
 
         # try to access model in memory instead of loading object from disk to save time
         if dk.live and coin in self.model_dictionary:
             model = self.model_dictionary[coin]
         elif self.model_type == 'joblib':
             model = load(dk.data_path / f"{dk.model_filename}_model.joblib")
-        elif self.model_type == 'keras':
-            from tensorflow import keras
-            model = keras.models.load_model(dk.data_path / f"{dk.model_filename}_model.h5")
         elif 'stable_baselines' in self.model_type or 'sb3_contrib' == self.model_type:
             mod = importlib.import_module(
                 self.model_type, self.freqai_info['rl_config']['model_type'])
             MODELCLASS = getattr(mod, self.freqai_info['rl_config']['model_type'])
             model = MODELCLASS.load(dk.data_path / f"{dk.model_filename}_model")
         elif self.model_type == 'pytorch':
             import torch
             zip = torch.load(dk.data_path / f"{dk.model_filename}_model.zip")
             model = zip["pytrainer"]
             model = model.load_from_checkpoint(zip)
 
-        if Path(dk.data_path / f"{dk.model_filename}_svm_model.joblib").is_file():
-            dk.svm_model = load(dk.data_path / f"{dk.model_filename}_svm_model.joblib")
-
         if not model:
             raise OperationalException(
                 f"Unable to load model, ensure model exists at " f"{dk.data_path} "
             )
 
         # load it into ram if it was loaded from disk
         if coin not in self.model_dictionary:
             self.model_dictionary[coin] = model
 
-        if self.config["freqai"]["feature_parameters"]["principal_component_analysis"]:
-            dk.pca = cloudpickle.load(
-                (dk.data_path / f"{dk.model_filename}_pca_object.pkl").open("rb")
-            )
-
         return model
 
     def update_historic_data(self, strategy: IStrategy, dk: FreqaiDataKitchen) -> None:
         """
         Append new candles to our stores historic data (in memory) so that
         we do not need to load candle history from disk and we dont need to
         pinging exchange multiple times for the same candle.
@@ -635,15 +632,15 @@
             for tf in self.freqai_info["feature_parameters"].get("include_timeframes"):
                 history_data[pair][tf] = load_pair_history(
                     datadir=self.config["datadir"],
                     timeframe=tf,
                     pair=pair,
                     timerange=timerange,
                     data_format=self.config.get("dataformat_ohlcv", "json"),
-                    candle_type=self.config.get("trading_mode", "spot"),
+                    candle_type=self.config.get("candle_type_def", CandleType.SPOT),
                 )
 
     def get_base_and_corr_dataframes(
         self, timerange: TimeRange, pair: str, dk: FreqaiDataKitchen
     ) -> Tuple[Dict[Any, Any], Dict[Any, Any]]:
         """
         Searches through our historic_data in memory and returns the dataframes relevant
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/data_kitchen.py` & `freqtrade-2023.6/freqtrade/freqai/data_kitchen.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,31 +1,26 @@
 import copy
 import inspect
 import logging
 import random
 import shutil
 from datetime import datetime, timezone
-from math import cos, sin
 from pathlib import Path
 from typing import Any, Dict, List, Optional, Tuple
 
 import numpy as np
 import numpy.typing as npt
 import pandas as pd
 import psutil
+from datasieve.pipeline import Pipeline
 from pandas import DataFrame
-from scipy import stats
-from sklearn import linear_model
-from sklearn.cluster import DBSCAN
-from sklearn.metrics.pairwise import pairwise_distances
 from sklearn.model_selection import train_test_split
-from sklearn.neighbors import NearestNeighbors
 
 from freqtrade.configuration import TimeRange
-from freqtrade.constants import Config
+from freqtrade.constants import DOCS_LINK, Config
 from freqtrade.data.converter import reduce_dataframe_footprint
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import timeframe_to_seconds
 from freqtrade.strategy import merge_informative_pair
 from freqtrade.strategy.interface import IStrategy
 
 
@@ -77,19 +72,20 @@
         self.label_list: List = []
         self.training_features_list: List = []
         self.model_filename: str = ""
         self.backtesting_results_path = Path()
         self.backtest_predictions_folder: str = "backtesting_predictions"
         self.live = live
         self.pair = pair
-
-        self.svm_model: linear_model.SGDOneClassSVM = None
         self.keras: bool = self.freqai_config.get("keras", False)
         self.set_all_pairs()
         self.backtest_live_models = config.get("freqai_backtest_live_models", False)
+        self.feature_pipeline = Pipeline()
+        self.label_pipeline = Pipeline()
+        self.DI_values: npt.NDArray = np.array([])
 
         if not self.live:
             self.full_path = self.get_full_models_path(self.config)
 
             if not self.backtest_live_models:
                 self.full_timerange = self.create_fulltimerange(
                     self.config["timerange"], self.freqai_config.get("train_period_days", 0)
@@ -223,21 +219,15 @@
         """
         filtered_df = unfiltered_df.filter(training_feature_list, axis=1)
         filtered_df = filtered_df.replace([np.inf, -np.inf], np.nan)
 
         drop_index = pd.isnull(filtered_df).any(axis=1)  # get the rows that have NaNs,
         drop_index = drop_index.replace(True, 1).replace(False, 0)  # pep8 requirement.
         if (training_filter):
-            const_cols = list((filtered_df.nunique() == 1).loc[lambda x: x].index)
-            if const_cols:
-                filtered_df = filtered_df.filter(filtered_df.columns.difference(const_cols))
-                self.data['constant_features_list'] = const_cols
-                logger.warning(f"Removed features {const_cols} with constant values.")
-            else:
-                self.data['constant_features_list'] = []
+
             # we don't care about total row number (total no. datapoints) in training, we only care
             # about removing any row with NaNs
             # if labels has multiple columns (user wants to train multiple modelEs), we detect here
             labels = unfiltered_df.filter(label_list, axis=1)
             drop_index_labels = pd.isnull(labels).any(axis=1)
             drop_index_labels = drop_index_labels.replace(True, 1).replace(False, 0)
             dates = unfiltered_df['date']
@@ -260,16 +250,15 @@
                     f" {(1 - len(filtered_df)/len(unfiltered_df)) * 100:.0f} percent "
                     " of training data dropped due to NaNs, model may perform inconsistent "
                     f"with expectations. Verify {worst_indicator}"
                 )
             self.data["filter_drop_index_training"] = drop_index
 
         else:
-            if 'constant_features_list' in self.data and len(self.data['constant_features_list']):
-                filtered_df = self.check_pred_labels(filtered_df)
+
             # we are backtesting so we need to preserve row number to send back to strategy,
             # so now we use do_predict to avoid any prediction based on a NaN
             drop_index = pd.isnull(filtered_df).any(axis=1)
             self.data["filter_drop_index_prediction"] = drop_index
             filtered_df.fillna(0, inplace=True)
             # replacing all NaNs with zeros to avoid issues in 'prediction', but any prediction
             # that was based on a single NaN is ultimately protected from buys with do_predict
@@ -303,115 +292,14 @@
             "train_weights": train_weights,
             "test_weights": test_weights,
             "train_dates": self.train_dates
         }
 
         return self.data_dictionary
 
-    def normalize_data(self, data_dictionary: Dict) -> Dict[Any, Any]:
-        """
-        Normalize all data in the data_dictionary according to the training dataset
-        :param data_dictionary: dictionary containing the cleaned and
-                                split training/test data/labels
-        :returns:
-        :data_dictionary: updated dictionary with standardized values.
-        """
-
-        # standardize the data by training stats
-        train_max = data_dictionary["train_features"].max()
-        train_min = data_dictionary["train_features"].min()
-        data_dictionary["train_features"] = (
-            2 * (data_dictionary["train_features"] - train_min) / (train_max - train_min) - 1
-        )
-        data_dictionary["test_features"] = (
-            2 * (data_dictionary["test_features"] - train_min) / (train_max - train_min) - 1
-        )
-
-        for item in train_max.keys():
-            self.data[item + "_max"] = train_max[item]
-            self.data[item + "_min"] = train_min[item]
-
-        for item in data_dictionary["train_labels"].keys():
-            if data_dictionary["train_labels"][item].dtype == object:
-                continue
-            train_labels_max = data_dictionary["train_labels"][item].max()
-            train_labels_min = data_dictionary["train_labels"][item].min()
-            data_dictionary["train_labels"][item] = (
-                2
-                * (data_dictionary["train_labels"][item] - train_labels_min)
-                / (train_labels_max - train_labels_min)
-                - 1
-            )
-            if self.freqai_config.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
-                data_dictionary["test_labels"][item] = (
-                    2
-                    * (data_dictionary["test_labels"][item] - train_labels_min)
-                    / (train_labels_max - train_labels_min)
-                    - 1
-                )
-
-            self.data[f"{item}_max"] = train_labels_max
-            self.data[f"{item}_min"] = train_labels_min
-        return data_dictionary
-
-    def normalize_single_dataframe(self, df: DataFrame) -> DataFrame:
-
-        train_max = df.max()
-        train_min = df.min()
-        df = (
-            2 * (df - train_min) / (train_max - train_min) - 1
-        )
-
-        for item in train_max.keys():
-            self.data[item + "_max"] = train_max[item]
-            self.data[item + "_min"] = train_min[item]
-
-        return df
-
-    def normalize_data_from_metadata(self, df: DataFrame) -> DataFrame:
-        """
-        Normalize a set of data using the mean and standard deviation from
-        the associated training data.
-        :param df: Dataframe to be standardized
-        """
-
-        train_max = [None] * len(df.keys())
-        train_min = [None] * len(df.keys())
-
-        for i, item in enumerate(df.keys()):
-            train_max[i] = self.data[f"{item}_max"]
-            train_min[i] = self.data[f"{item}_min"]
-
-        train_max_series = pd.Series(train_max, index=df.keys())
-        train_min_series = pd.Series(train_min, index=df.keys())
-
-        df = (
-            2 * (df - train_min_series) / (train_max_series - train_min_series) - 1
-        )
-
-        return df
-
-    def denormalize_labels_from_metadata(self, df: DataFrame) -> DataFrame:
-        """
-        Denormalize a set of data using the mean and standard deviation from
-        the associated training data.
-        :param df: Dataframe of predictions to be denormalized
-        """
-
-        for label in df.columns:
-            if df[label].dtype == object or label in self.unique_class_list:
-                continue
-            df[label] = (
-                (df[label] + 1)
-                * (self.data[f"{label}_max"] - self.data[f"{label}_min"])
-                / 2
-            ) + self.data[f"{label}_min"]
-
-        return df
-
     def split_timerange(
         self, tr: str, train_split: int = 28, bt_split: float = 7
     ) -> Tuple[list, list]:
         """
         Function which takes a single time range (tr) and splits it
         into sub timeranges to train and backtest on based on user input
         tr: str, full timerange to train on
@@ -448,17 +336,15 @@
             timerange_train.stopts = timerange_train.startts + train_period_days
 
             first = False
             tr_training_list.append(timerange_train.timerange_str)
             tr_training_list_timerange.append(copy.deepcopy(timerange_train))
 
             # associated backtest period
-
             timerange_backtest.startts = timerange_train.stopts
-
             timerange_backtest.stopts = timerange_backtest.startts + int(bt_period)
 
             if timerange_backtest.stopts > config_timerange.stopts:
                 timerange_backtest.stopts = config_timerange.stopts
 
             tr_backtesting_list.append(timerange_backtest.timerange_str)
             tr_backtesting_list_timerange.append(copy.deepcopy(timerange_backtest))
@@ -481,434 +367,14 @@
         if not self.live:
             df = df.loc[(df["date"] >= timerange.startdt) & (df["date"] < timerange.stopdt), :]
         else:
             df = df.loc[df["date"] >= timerange.startdt, :]
 
         return df
 
-    def check_pred_labels(self, df_predictions: DataFrame) -> DataFrame:
-        """
-        Check that prediction feature labels match training feature labels.
-        :param df_predictions: incoming predictions
-        """
-        constant_labels = self.data['constant_features_list']
-        df_predictions = df_predictions.filter(
-            df_predictions.columns.difference(constant_labels)
-        )
-        logger.warning(
-            f"Removed {len(constant_labels)} features from prediction features, "
-            f"these were considered constant values during most recent training."
-        )
-
-        return df_predictions
-
-    def principal_component_analysis(self) -> None:
-        """
-        Performs Principal Component Analysis on the data for dimensionality reduction
-        and outlier detection (see self.remove_outliers())
-        No parameters or returns, it acts on the data_dictionary held by the DataHandler.
-        """
-
-        from sklearn.decomposition import PCA  # avoid importing if we dont need it
-
-        pca = PCA(0.999)
-        pca = pca.fit(self.data_dictionary["train_features"])
-        n_keep_components = pca.n_components_
-        self.data["n_kept_components"] = n_keep_components
-        n_components = self.data_dictionary["train_features"].shape[1]
-        logger.info("reduced feature dimension by %s", n_components - n_keep_components)
-        logger.info("explained variance %f", np.sum(pca.explained_variance_ratio_))
-
-        train_components = pca.transform(self.data_dictionary["train_features"])
-        self.data_dictionary["train_features"] = pd.DataFrame(
-            data=train_components,
-            columns=["PC" + str(i) for i in range(0, n_keep_components)],
-            index=self.data_dictionary["train_features"].index,
-        )
-        # normalsing transformed training features
-        self.data_dictionary["train_features"] = self.normalize_single_dataframe(
-            self.data_dictionary["train_features"])
-
-        # keeping a copy of the non-transformed features so we can check for errors during
-        # model load from disk
-        self.data["training_features_list_raw"] = copy.deepcopy(self.training_features_list)
-        self.training_features_list = self.data_dictionary["train_features"].columns
-
-        if self.freqai_config.get('data_split_parameters', {}).get('test_size', 0.1) != 0:
-            test_components = pca.transform(self.data_dictionary["test_features"])
-            self.data_dictionary["test_features"] = pd.DataFrame(
-                data=test_components,
-                columns=["PC" + str(i) for i in range(0, n_keep_components)],
-                index=self.data_dictionary["test_features"].index,
-            )
-            # normalise transformed test feature to transformed training features
-            self.data_dictionary["test_features"] = self.normalize_data_from_metadata(
-                self.data_dictionary["test_features"])
-
-        self.data["n_kept_components"] = n_keep_components
-        self.pca = pca
-
-        logger.info(f"PCA reduced total features from  {n_components} to {n_keep_components}")
-
-        if not self.data_path.is_dir():
-            self.data_path.mkdir(parents=True, exist_ok=True)
-
-        return None
-
-    def pca_transform(self, filtered_dataframe: DataFrame) -> None:
-        """
-        Use an existing pca transform to transform data into components
-        :param filtered_dataframe: DataFrame = the cleaned dataframe
-        """
-        pca_components = self.pca.transform(filtered_dataframe)
-        self.data_dictionary["prediction_features"] = pd.DataFrame(
-            data=pca_components,
-            columns=["PC" + str(i) for i in range(0, self.data["n_kept_components"])],
-            index=filtered_dataframe.index,
-        )
-        # normalise transformed predictions to transformed training features
-        self.data_dictionary["prediction_features"] = self.normalize_data_from_metadata(
-            self.data_dictionary["prediction_features"])
-
-    def compute_distances(self) -> float:
-        """
-        Compute distances between each training point and every other training
-        point. This metric defines the neighborhood of trained data and is used
-        for prediction confidence in the Dissimilarity Index
-        """
-        # logger.info("computing average mean distance for all training points")
-        pairwise = pairwise_distances(
-            self.data_dictionary["train_features"], n_jobs=self.thread_count)
-        # remove the diagonal distances which are itself distances ~0
-        np.fill_diagonal(pairwise, np.NaN)
-        pairwise = pairwise.reshape(-1, 1)
-        avg_mean_dist = pairwise[~np.isnan(pairwise)].mean()
-
-        return avg_mean_dist
-
-    def get_outlier_percentage(self, dropped_pts: npt.NDArray) -> float:
-        """
-        Check if more than X% of points werer dropped during outlier detection.
-        """
-        outlier_protection_pct = self.freqai_config["feature_parameters"].get(
-            "outlier_protection_percentage", 30)
-        outlier_pct = (dropped_pts.sum() / len(dropped_pts)) * 100
-        if outlier_pct >= outlier_protection_pct:
-            return outlier_pct
-        else:
-            return 0.0
-
-    def use_SVM_to_remove_outliers(self, predict: bool) -> None:
-        """
-        Build/inference a Support Vector Machine to detect outliers
-        in training data and prediction
-        :param predict: bool = If true, inference an existing SVM model, else construct one
-        """
-
-        if self.keras:
-            logger.warning(
-                "SVM outlier removal not currently supported for Keras based models. "
-                "Skipping user requested function."
-            )
-            if predict:
-                self.do_predict = np.ones(len(self.data_dictionary["prediction_features"]))
-            return
-
-        if predict:
-            if not self.svm_model:
-                logger.warning("No svm model available for outlier removal")
-                return
-            y_pred = self.svm_model.predict(self.data_dictionary["prediction_features"])
-            do_predict = np.where(y_pred == -1, 0, y_pred)
-
-            if (len(do_predict) - do_predict.sum()) > 0:
-                logger.info(f"SVM tossed {len(do_predict) - do_predict.sum()} predictions.")
-            self.do_predict += do_predict
-            self.do_predict -= 1
-
-        else:
-            # use SGDOneClassSVM to increase speed?
-            svm_params = self.freqai_config["feature_parameters"].get(
-                "svm_params", {"shuffle": False, "nu": 0.1})
-            self.svm_model = linear_model.SGDOneClassSVM(**svm_params).fit(
-                self.data_dictionary["train_features"]
-            )
-            y_pred = self.svm_model.predict(self.data_dictionary["train_features"])
-            kept_points = np.where(y_pred == -1, 0, y_pred)
-            # keep_index = np.where(y_pred == 1)
-            outlier_pct = self.get_outlier_percentage(1 - kept_points)
-            if outlier_pct:
-                logger.warning(
-                        f"SVM detected {outlier_pct:.2f}% of the points as outliers. "
-                        f"Keeping original dataset."
-                )
-                self.svm_model = None
-                return
-
-            self.data_dictionary["train_features"] = self.data_dictionary["train_features"][
-                (y_pred == 1)
-            ]
-            self.data_dictionary["train_labels"] = self.data_dictionary["train_labels"][
-                (y_pred == 1)
-            ]
-            self.data_dictionary["train_weights"] = self.data_dictionary["train_weights"][
-                (y_pred == 1)
-            ]
-
-            logger.info(
-                f"SVM tossed {len(y_pred) - kept_points.sum()}"
-                f" train points from {len(y_pred)} total points."
-            )
-
-            # same for test data
-            # TODO: This (and the part above) could be refactored into a separate function
-            # to reduce code duplication
-            if self.freqai_config['data_split_parameters'].get('test_size', 0.1) != 0:
-                y_pred = self.svm_model.predict(self.data_dictionary["test_features"])
-                kept_points = np.where(y_pred == -1, 0, y_pred)
-                self.data_dictionary["test_features"] = self.data_dictionary["test_features"][
-                    (y_pred == 1)
-                ]
-                self.data_dictionary["test_labels"] = self.data_dictionary["test_labels"][(
-                    y_pred == 1)]
-                self.data_dictionary["test_weights"] = self.data_dictionary["test_weights"][
-                    (y_pred == 1)
-                ]
-
-            logger.info(
-                f"{self.pair}: SVM tossed {len(y_pred) - kept_points.sum()}"
-                f" test points from {len(y_pred)} total points."
-            )
-
-        return
-
-    def use_DBSCAN_to_remove_outliers(self, predict: bool, eps=None) -> None:
-        """
-        Use DBSCAN to cluster training data and remove "noisy" data (read outliers).
-        User controls this via the config param `DBSCAN_outlier_pct` which indicates the
-        pct of training data that they want to be considered outliers.
-        :param predict: bool = If False (training), iterate to find the best hyper parameters
-                        to match user requested outlier percent target.
-                        If True (prediction), use the parameters determined from
-                        the previous training to estimate if the current prediction point
-                        is an outlier.
-        """
-
-        if predict:
-            if not self.data['DBSCAN_eps']:
-                return
-            train_ft_df = self.data_dictionary['train_features']
-            pred_ft_df = self.data_dictionary['prediction_features']
-            num_preds = len(pred_ft_df)
-            df = pd.concat([train_ft_df, pred_ft_df], axis=0, ignore_index=True)
-            clustering = DBSCAN(eps=self.data['DBSCAN_eps'],
-                                min_samples=self.data['DBSCAN_min_samples'],
-                                n_jobs=self.thread_count
-                                ).fit(df)
-            do_predict = np.where(clustering.labels_[-num_preds:] == -1, 0, 1)
-
-            if (len(do_predict) - do_predict.sum()) > 0:
-                logger.info(f"DBSCAN tossed {len(do_predict) - do_predict.sum()} predictions")
-            self.do_predict += do_predict
-            self.do_predict -= 1
-
-        else:
-
-            def normalise_distances(distances):
-                normalised_distances = (distances - distances.min()) / \
-                                        (distances.max() - distances.min())
-                return normalised_distances
-
-            def rotate_point(origin, point, angle):
-                # rotate a point counterclockwise by a given angle (in radians)
-                # around a given origin
-                x = origin[0] + cos(angle) * (point[0] - origin[0]) - \
-                                    sin(angle) * (point[1] - origin[1])
-                y = origin[1] + sin(angle) * (point[0] - origin[0]) + \
-                    cos(angle) * (point[1] - origin[1])
-                return (x, y)
-
-            MinPts = int(len(self.data_dictionary['train_features'].index) * 0.25)
-            # measure pairwise distances to nearest neighbours
-            neighbors = NearestNeighbors(
-                n_neighbors=MinPts, n_jobs=self.thread_count)
-            neighbors_fit = neighbors.fit(self.data_dictionary['train_features'])
-            distances, _ = neighbors_fit.kneighbors(self.data_dictionary['train_features'])
-            distances = np.sort(distances, axis=0).mean(axis=1)
-
-            normalised_distances = normalise_distances(distances)
-            x_range = np.linspace(0, 1, len(distances))
-            line = np.linspace(normalised_distances[0],
-                               normalised_distances[-1], len(normalised_distances))
-            deflection = np.abs(normalised_distances - line)
-            max_deflection_loc = np.where(deflection == deflection.max())[0][0]
-            origin = x_range[max_deflection_loc], line[max_deflection_loc]
-            point = x_range[max_deflection_loc], normalised_distances[max_deflection_loc]
-            rot_angle = np.pi / 4
-            elbow_loc = rotate_point(origin, point, rot_angle)
-
-            epsilon = elbow_loc[1] * (distances[-1] - distances[0]) + distances[0]
-
-            clustering = DBSCAN(eps=epsilon, min_samples=MinPts,
-                                n_jobs=int(self.thread_count)).fit(
-                                                    self.data_dictionary['train_features']
-                                                )
-
-            logger.info(f'DBSCAN found eps of {epsilon:.2f}.')
-
-            self.data['DBSCAN_eps'] = epsilon
-            self.data['DBSCAN_min_samples'] = MinPts
-            dropped_points = np.where(clustering.labels_ == -1, 1, 0)
-
-            outlier_pct = self.get_outlier_percentage(dropped_points)
-            if outlier_pct:
-                logger.warning(
-                        f"DBSCAN detected {outlier_pct:.2f}% of the points as outliers. "
-                        f"Keeping original dataset."
-                )
-                self.data['DBSCAN_eps'] = 0
-                return
-
-            self.data_dictionary['train_features'] = self.data_dictionary['train_features'][
-                (clustering.labels_ != -1)
-            ]
-            self.data_dictionary["train_labels"] = self.data_dictionary["train_labels"][
-                (clustering.labels_ != -1)
-            ]
-            self.data_dictionary["train_weights"] = self.data_dictionary["train_weights"][
-                (clustering.labels_ != -1)
-            ]
-
-            logger.info(
-                f"DBSCAN tossed {dropped_points.sum()}"
-                f" train points from {len(clustering.labels_)}"
-            )
-
-        return
-
-    def compute_inlier_metric(self, set_='train') -> None:
-        """
-        Compute inlier metric from backwards distance distributions.
-        This metric defines how well features from a timepoint fit
-        into previous timepoints.
-        """
-
-        def normalise(dataframe: DataFrame, key: str) -> DataFrame:
-            if set_ == 'train':
-                min_value = dataframe.min()
-                max_value = dataframe.max()
-                self.data[f'{key}_min'] = min_value
-                self.data[f'{key}_max'] = max_value
-            else:
-                min_value = self.data[f'{key}_min']
-                max_value = self.data[f'{key}_max']
-            return (dataframe - min_value) / (max_value - min_value)
-
-        no_prev_pts = self.freqai_config["feature_parameters"]["inlier_metric_window"]
-
-        if set_ == 'train':
-            compute_df = copy.deepcopy(self.data_dictionary['train_features'])
-        elif set_ == 'test':
-            compute_df = copy.deepcopy(self.data_dictionary['test_features'])
-        else:
-            compute_df = copy.deepcopy(self.data_dictionary['prediction_features'])
-
-        compute_df_reindexed = compute_df.reindex(
-            index=np.flip(compute_df.index)
-        )
-
-        pairwise = pd.DataFrame(
-            np.triu(
-                pairwise_distances(compute_df_reindexed, n_jobs=self.thread_count)
-            ),
-            columns=compute_df_reindexed.index,
-            index=compute_df_reindexed.index
-        )
-        pairwise = pairwise.round(5)
-
-        column_labels = [
-            '{}{}'.format('d', i) for i in range(1, no_prev_pts + 1)
-        ]
-        distances = pd.DataFrame(
-            columns=column_labels, index=compute_df.index
-        )
-
-        for index in compute_df.index[no_prev_pts:]:
-            current_row = pairwise.loc[[index]]
-            current_row_no_zeros = current_row.loc[
-                :, (current_row != 0).any(axis=0)
-            ]
-            distances.loc[[index]] = current_row_no_zeros.iloc[
-                :, :no_prev_pts
-            ]
-        distances = distances.replace([np.inf, -np.inf], np.nan)
-        drop_index = pd.isnull(distances).any(axis=1)
-        distances = distances[drop_index == 0]
-
-        inliers = pd.DataFrame(index=distances.index)
-        for key in distances.keys():
-            current_distances = distances[key].dropna()
-            current_distances = normalise(current_distances, key)
-            if set_ == 'train':
-                fit_params = stats.weibull_min.fit(current_distances)
-                self.data[f'{key}_fit_params'] = fit_params
-            else:
-                fit_params = self.data[f'{key}_fit_params']
-            quantiles = stats.weibull_min.cdf(current_distances, *fit_params)
-
-            df_inlier = pd.DataFrame(
-                {key: quantiles}, index=distances.index
-            )
-            inliers = pd.concat(
-                [inliers, df_inlier], axis=1
-            )
-
-        inlier_metric = pd.DataFrame(
-            data=inliers.sum(axis=1) / no_prev_pts,
-            columns=['%-inlier_metric'],
-            index=compute_df.index
-        )
-
-        inlier_metric = (2 * (inlier_metric - inlier_metric.min()) /
-                         (inlier_metric.max() - inlier_metric.min()) - 1)
-
-        if set_ in ('train', 'test'):
-            inlier_metric = inlier_metric.iloc[no_prev_pts:]
-            compute_df = compute_df.iloc[no_prev_pts:]
-            self.remove_beginning_points_from_data_dict(set_, no_prev_pts)
-            self.data_dictionary[f'{set_}_features'] = pd.concat(
-                [compute_df, inlier_metric], axis=1)
-        else:
-            self.data_dictionary['prediction_features'] = pd.concat(
-                [compute_df, inlier_metric], axis=1)
-            self.data_dictionary['prediction_features'].fillna(0, inplace=True)
-
-        logger.info('Inlier metric computed and added to features.')
-
-        return None
-
-    def remove_beginning_points_from_data_dict(self, set_='train', no_prev_pts: int = 10):
-        features = self.data_dictionary[f'{set_}_features']
-        weights = self.data_dictionary[f'{set_}_weights']
-        labels = self.data_dictionary[f'{set_}_labels']
-        self.data_dictionary[f'{set_}_weights'] = weights[no_prev_pts:]
-        self.data_dictionary[f'{set_}_features'] = features.iloc[no_prev_pts:]
-        self.data_dictionary[f'{set_}_labels'] = labels.iloc[no_prev_pts:]
-
-    def add_noise_to_training_features(self) -> None:
-        """
-        Add noise to train features to reduce the risk of overfitting.
-        """
-        mu = 0  # no shift
-        sigma = self.freqai_config["feature_parameters"]["noise_standard_deviation"]
-        compute_df = self.data_dictionary['train_features']
-        noise = np.random.normal(mu, sigma, [compute_df.shape[0], compute_df.shape[1]])
-        self.data_dictionary['train_features'] += noise
-        return
-
     def find_features(self, dataframe: DataFrame) -> None:
         """
         Find features in the strategy provided dataframe
         :param dataframe: DataFrame = strategy provided dataframe
         :return:
         features: list = the features to be used for training/prediction
         """
@@ -921,45 +387,14 @@
         self.training_features_list = features
 
     def find_labels(self, dataframe: DataFrame) -> None:
         column_names = dataframe.columns
         labels = [c for c in column_names if "&" in c]
         self.label_list = labels
 
-    def check_if_pred_in_training_spaces(self) -> None:
-        """
-        Compares the distance from each prediction point to each training data
-        point. It uses this information to estimate a Dissimilarity Index (DI)
-        and avoid making predictions on any points that are too far away
-        from the training data set.
-        """
-
-        distance = pairwise_distances(
-            self.data_dictionary["train_features"],
-            self.data_dictionary["prediction_features"],
-            n_jobs=self.thread_count,
-        )
-
-        self.DI_values = distance.min(axis=0) / self.data["avg_mean_dist"]
-
-        do_predict = np.where(
-            self.DI_values < self.freqai_config["feature_parameters"]["DI_threshold"],
-            1,
-            0,
-        )
-
-        if (len(do_predict) - do_predict.sum()) > 0:
-            logger.info(
-                f"{self.pair}: DI tossed {len(do_predict) - do_predict.sum()} predictions for "
-                "being too far from training data."
-            )
-
-        self.do_predict += do_predict
-        self.do_predict -= 1
-
     def set_weights_higher_recent(self, num_weights: int) -> npt.ArrayLike:
         """
         Set weights so that recent data is more heavily weighted during
         training than older data.
         """
         wfactor = self.config["freqai"]["feature_parameters"]["weight_factor"]
         weights = np.exp(-np.arange(num_weights) / (wfactor * num_weights))[::-1]
@@ -1321,17 +756,17 @@
 
         if not new_version:
             raise OperationalException(
                 "You are using the `populate_any_indicators()` function"
                 " which was deprecated on March 1, 2023. Please refer "
                 "to the strategy migration guide to use the new "
                 "feature_engineering_* methods: \n"
-                "https://www.freqtrade.io/en/stable/strategy_migration/#freqai-strategy \n"
+                f"{DOCS_LINK}/strategy_migration/#freqai-strategy \n"
                 "And the feature_engineering_* documentation: \n"
-                "https://www.freqtrade.io/en/latest/freqai-feature-engineering/"
+                f"{DOCS_LINK}/freqai-feature-engineering/"
                 )
 
         tfs: List[str] = self.freqai_config["feature_parameters"].get("include_timeframes")
         pairs: List[str] = self.freqai_config["feature_parameters"].get(
             "include_corr_pairlist", [])
 
         for tf in tfs:
@@ -1511,7 +946,36 @@
         """
         buffer = self.freqai_config["feature_parameters"]["buffer_train_data_candles"]
         if buffer:
             timerange.stopts -= buffer * timeframe_to_seconds(self.config["timeframe"])
             timerange.startts += buffer * timeframe_to_seconds(self.config["timeframe"])
 
         return timerange
+
+    # deprecated functions
+    def normalize_data(self, data_dictionary: Dict) -> Dict[Any, Any]:
+        """
+        Deprecation warning, migration assistance
+        """
+        logger.warning(f"Your custom IFreqaiModel relies on the deprecated"
+                       " data pipeline. Please update your model to use the new data pipeline."
+                       " This can be achieved by following the migration guide at "
+                       f"{DOCS_LINK}/strategy_migration/#freqai-new-data-pipeline "
+                       "We added a basic pipeline for you, but this will be removed "
+                       "in a future version.")
+
+        return data_dictionary
+
+    def denormalize_labels_from_metadata(self, df: DataFrame) -> DataFrame:
+        """
+        Deprecation warning, migration assistance
+        """
+        logger.warning(f"Your custom IFreqaiModel relies on the deprecated"
+                       " data pipeline. Please update your model to use the new data pipeline."
+                       " This can be achieved by following the migration guide at "
+                       f"{DOCS_LINK}/strategy_migration/#freqai-new-data-pipeline "
+                       "We added a basic pipeline for you, but this will be removed "
+                       "in a future version.")
+
+        pred_df, _, _ = self.label_pipeline.inverse_transform(df)
+
+        return pred_df
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/freqai_interface.py` & `freqtrade-2023.6/freqtrade/freqai/freqai_interface.py`

 * *Files 3% similar despite different names*

```diff
@@ -3,22 +3,26 @@
 import time
 from abc import ABC, abstractmethod
 from collections import deque
 from datetime import datetime, timezone
 from pathlib import Path
 from typing import Any, Dict, List, Literal, Optional, Tuple
 
+import datasieve.transforms as ds
 import numpy as np
 import pandas as pd
 import psutil
+from datasieve.pipeline import Pipeline
+from datasieve.transforms import SKLearnWrapper
 from numpy.typing import NDArray
 from pandas import DataFrame
+from sklearn.preprocessing import MinMaxScaler
 
 from freqtrade.configuration import TimeRange
-from freqtrade.constants import Config
+from freqtrade.constants import DOCS_LINK, Config
 from freqtrade.data.dataprovider import DataProvider
 from freqtrade.enums import RunMode
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import timeframe_to_seconds
 from freqtrade.freqai.data_drawer import FreqaiDataDrawer
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 from freqtrade.freqai.utils import get_tb_logger, plot_feature_importance, record_params
@@ -499,89 +503,62 @@
                 "Change `identifier` to train from scratch, or ensure the "
                 "strategy is furnishing the same features as the pretrained "
                 "model. In case of --strategy-list, please be aware that FreqAI "
                 "requires all strategies to maintain identical "
                 "feature_engineering_* functions"
             )
 
-    def data_cleaning_train(self, dk: FreqaiDataKitchen) -> None:
-        """
-        Base data cleaning method for train.
-        Functions here improve/modify the input data by identifying outliers,
-        computing additional metrics, adding noise, reducing dimensionality etc.
-        """
-
+    def define_data_pipeline(self, threads=-1) -> Pipeline:
         ft_params = self.freqai_info["feature_parameters"]
+        pipe_steps = [
+            ('const', ds.VarianceThreshold(threshold=0)),
+            ('scaler', SKLearnWrapper(MinMaxScaler(feature_range=(-1, 1))))
+            ]
 
-        if ft_params.get('inlier_metric_window', 0):
-            dk.compute_inlier_metric(set_='train')
-            if self.freqai_info["data_split_parameters"]["test_size"] > 0:
-                dk.compute_inlier_metric(set_='test')
-
-        if ft_params.get(
-            "principal_component_analysis", False
-        ):
-            dk.principal_component_analysis()
+        if ft_params.get("principal_component_analysis", False):
+            pipe_steps.append(('pca', ds.PCA(n_components=0.999)))
+            pipe_steps.append(('post-pca-scaler',
+                               SKLearnWrapper(MinMaxScaler(feature_range=(-1, 1)))))
 
         if ft_params.get("use_SVM_to_remove_outliers", False):
-            dk.use_SVM_to_remove_outliers(predict=False)
-
-        if ft_params.get("DI_threshold", 0):
-            dk.data["avg_mean_dist"] = dk.compute_distances()
+            svm_params = ft_params.get(
+                "svm_params", {"shuffle": False, "nu": 0.01})
+            pipe_steps.append(('svm', ds.SVMOutlierExtractor(**svm_params)))
+
+        di = ft_params.get("DI_threshold", 0)
+        if di:
+            pipe_steps.append(('di', ds.DissimilarityIndex(di_threshold=di, n_jobs=threads)))
 
         if ft_params.get("use_DBSCAN_to_remove_outliers", False):
-            if dk.pair in self.dd.old_DBSCAN_eps:
-                eps = self.dd.old_DBSCAN_eps[dk.pair]
-            else:
-                eps = None
-            dk.use_DBSCAN_to_remove_outliers(predict=False, eps=eps)
-            self.dd.old_DBSCAN_eps[dk.pair] = dk.data['DBSCAN_eps']
+            pipe_steps.append(('dbscan', ds.DBSCAN(n_jobs=threads)))
 
-        if self.freqai_info["feature_parameters"].get('noise_standard_deviation', 0):
-            dk.add_noise_to_training_features()
+        sigma = self.freqai_info["feature_parameters"].get('noise_standard_deviation', 0)
+        if sigma:
+            pipe_steps.append(('noise', ds.Noise(sigma=sigma)))
 
-    def data_cleaning_predict(self, dk: FreqaiDataKitchen) -> None:
-        """
-        Base data cleaning method for predict.
-        Functions here are complementary to the functions of data_cleaning_train.
-        """
-        ft_params = self.freqai_info["feature_parameters"]
-
-        # ensure user is feeding the correct indicators to the model
-        self.check_if_feature_list_matches_strategy(dk)
+        return Pipeline(pipe_steps)
 
-        if ft_params.get('inlier_metric_window', 0):
-            dk.compute_inlier_metric(set_='predict')
+    def define_label_pipeline(self, threads=-1) -> Pipeline:
 
-        if ft_params.get(
-            "principal_component_analysis", False
-        ):
-            dk.pca_transform(dk.data_dictionary['prediction_features'])
+        label_pipeline = Pipeline([
+            ('scaler', SKLearnWrapper(MinMaxScaler(feature_range=(-1, 1))))
+            ])
 
-        if ft_params.get("use_SVM_to_remove_outliers", False):
-            dk.use_SVM_to_remove_outliers(predict=True)
-
-        if ft_params.get("DI_threshold", 0):
-            dk.check_if_pred_in_training_spaces()
-
-        if ft_params.get("use_DBSCAN_to_remove_outliers", False):
-            dk.use_DBSCAN_to_remove_outliers(predict=True)
+        return label_pipeline
 
     def model_exists(self, dk: FreqaiDataKitchen) -> bool:
         """
         Given a pair and path, check if a model already exists
         :param pair: pair e.g. BTC/USD
         :param path: path to model
         :return:
         :boolean: whether the model file exists or not.
         """
         if self.dd.model_type == 'joblib':
             file_type = ".joblib"
-        elif self.dd.model_type == 'keras':
-            file_type = ".h5"
         elif self.dd.model_type in ["stable_baselines3", "sb3_contrib", "pytorch"]:
             file_type = ".zip"
 
         path_to_modelfile = Path(dk.data_path / f"{dk.model_filename}_model{file_type}")
         file_exists = path_to_modelfile.is_file()
         if file_exists:
             logger.info("Found model at %s", dk.data_path / dk.model_filename)
@@ -697,15 +674,15 @@
             hist_preds_df[return_str] = dk.data['extra_returns_per_train'][return_str]
 
         hist_preds_df['close_price'] = strat_df['close']
         hist_preds_df['date_pred'] = strat_df['date']
 
         # # for keras type models, the conv_window needs to be prepended so
         # # viewing is correct in frequi
-        if self.freqai_info.get('keras', False) or self.ft_params.get('inlier_metric_window', 0):
+        if self.ft_params.get('inlier_metric_window', 0):
             n_lost_points = self.freqai_info.get('conv_width', 2)
             zeros_df = DataFrame(np.zeros((n_lost_points, len(hist_preds_df.columns))),
                                  columns=hist_preds_df.columns)
             self.dd.historic_predictions[pair] = pd.concat(
                 [zeros_df, hist_preds_df], axis=0, ignore_index=True)
 
     def fit_live_predictions(self, dk: FreqaiDataKitchen, pair: str) -> None:
@@ -987,7 +964,54 @@
         :param dk: FreqaiDataKitchen = Data management/analysis tool associated to present pair only
         :param first: boolean = whether this is the first prediction or not.
         :return:
         :predictions: np.array of predictions
         :do_predict: np.array of 1s and 0s to indicate places where freqai needed to remove
         data (NaNs) or felt uncertain about data (i.e. SVM and/or DI index)
         """
+
+    # deprecated functions
+    def data_cleaning_train(self, dk: FreqaiDataKitchen, pair: str):
+        """
+        throw deprecation warning if this function is called
+        """
+        logger.warning(f"Your model {self.__class__.__name__} relies on the deprecated"
+                       " data pipeline. Please update your model to use the new data pipeline."
+                       " This can be achieved by following the migration guide at "
+                       f"{DOCS_LINK}/strategy_migration/#freqai-new-data-pipeline")
+        dk.feature_pipeline = self.define_data_pipeline(threads=dk.thread_count)
+        dd = dk.data_dictionary
+        (dd["train_features"],
+         dd["train_labels"],
+         dd["train_weights"]) = dk.feature_pipeline.fit_transform(dd["train_features"],
+                                                                  dd["train_labels"],
+                                                                  dd["train_weights"])
+
+        (dd["test_features"],
+         dd["test_labels"],
+         dd["test_weights"]) = dk.feature_pipeline.transform(dd["test_features"],
+                                                             dd["test_labels"],
+                                                             dd["test_weights"])
+
+        dk.label_pipeline = self.define_label_pipeline(threads=dk.thread_count)
+
+        dd["train_labels"], _, _ = dk.label_pipeline.fit_transform(dd["train_labels"])
+        dd["test_labels"], _, _ = dk.label_pipeline.transform(dd["test_labels"])
+        return
+
+    def data_cleaning_predict(self, dk: FreqaiDataKitchen, pair: str):
+        """
+        throw deprecation warning if this function is called
+        """
+        logger.warning(f"Your model {self.__class__.__name__} relies on the deprecated"
+                       " data pipeline. Please update your model to use the new data pipeline."
+                       " This can be achieved by following the migration guide at "
+                       f"{DOCS_LINK}/strategy_migration/#freqai-new-data-pipeline")
+        dd = dk.data_dictionary
+        dd["predict_features"], outliers, _ = dk.feature_pipeline.transform(
+            dd["predict_features"], outlier_check=True)
+        if self.freqai_info.get("DI_threshold", 0) > 0:
+            dk.DI_values = dk.feature_pipeline["di"].di_values
+        else:
+            dk.DI_values = np.zeros(outliers.shape[0])
+        dk.do_predict = outliers
+        return
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py`

 * *Files 7% similar despite different names*

```diff
@@ -99,21 +99,21 @@
         :return:
         :pred_df: dataframe containing the predictions
         :do_predict: np.array of 1s and 0s to indicate places where freqai needed to remove
         data (NaNs) or felt uncertain about data (PCA and DI index)
         """
 
         dk.find_features(unfiltered_df)
-        filtered_df, _ = dk.filter_features(
+        dk.data_dictionary["prediction_features"], _ = dk.filter_features(
             unfiltered_df, dk.training_features_list, training_filter=False
         )
-        filtered_df = dk.normalize_data_from_metadata(filtered_df)
-        dk.data_dictionary["prediction_features"] = filtered_df
 
-        self.data_cleaning_predict(dk)
+        dk.data_dictionary["prediction_features"], outliers, _ = dk.feature_pipeline.transform(
+            dk.data_dictionary["prediction_features"], outlier_check=True)
+
         x = self.data_convertor.convert_x(
             dk.data_dictionary["prediction_features"],
             device=self.device
         )
         # if user is asking for multiple predictions, slide the window
         # along the tensor
         x = x.unsqueeze(0)
@@ -127,14 +127,20 @@
                 y = self.model.model(xb)
                 yb = torch.cat((yb, y), dim=0)
         else:
             yb = self.model.model(x)
 
         yb = yb.cpu().squeeze()
         pred_df = pd.DataFrame(yb.detach().numpy(), columns=dk.label_list)
-        pred_df = dk.denormalize_labels_from_metadata(pred_df)
+        pred_df, _, _ = dk.label_pipeline.inverse_transform(pred_df)
+
+        if self.freqai_info.get("DI_threshold", 0) > 0:
+            dk.DI_values = dk.feature_pipeline["di"].di_values
+        else:
+            dk.DI_values = np.zeros(outliers.shape[0])
+        dk.do_predict = outliers
 
         if x.shape[1] > 1:
             zeros_df = pd.DataFrame(np.zeros((x.shape[1] - len(pred_df), len(pred_df.columns))),
                                     columns=pred_df.columns)
             pred_df = pd.concat([zeros_df, pred_df], axis=0, ignore_index=True)
         return (pred_df, dk.do_predict)
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/ReinforcementLearner.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 import logging
 from typing import Any, Dict
 
 from pandas import DataFrame
-from stable_baselines3.common.callbacks import EvalCallback
+from sb3_contrib.common.maskable.callbacks import MaskableEvalCallback
+from sb3_contrib.common.maskable.utils import is_masking_supported
 from stable_baselines3.common.vec_env import SubprocVecEnv, VecMonitor
 
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
 from freqtrade.freqai.prediction_models.ReinforcementLearner import ReinforcementLearner
 from freqtrade.freqai.RL.BaseReinforcementLearningModel import make_env
 from freqtrade.freqai.tensorboard.TensorboardCallback import TensorboardCallback
 
@@ -51,15 +52,17 @@
 
         eval_env_id = 'eval_env'
         self.eval_env = VecMonitor(SubprocVecEnv([make_env(self.MyRLEnv, eval_env_id, i, 1,
                                                            test_df, prices_test,
                                                            env_info=env_info) for i
                                                   in range(self.max_threads)]))
 
-        self.eval_callback = EvalCallback(self.eval_env, deterministic=True,
-                                          render=False, eval_freq=eval_freq,
-                                          best_model_save_path=str(dk.data_path))
+        self.eval_callback = MaskableEvalCallback(self.eval_env, deterministic=True,
+                                                  render=False, eval_freq=eval_freq,
+                                                  best_model_save_path=str(dk.data_path),
+                                                  use_masking=(self.model_type == 'MaskablePPO' and
+                                                               is_masking_supported(self.eval_env)))
 
         # TENSORBOARD CALLBACK DOES NOT RECOMMENDED TO USE WITH MULTIPLE ENVS,
         # IT WILL RETURN FALSE INFORMATIONS, NEVERTHLESS NOT THREAD SAFE WITH SB3!!!
         actions = self.train_env.env_method("get_actions")[0]
         self.tensorboard_callback = TensorboardCallback(verbose=1, actions=actions)
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,14 +1,15 @@
 import logging
 from typing import Any, Dict
 
 from xgboost import XGBRFRegressor
 
 from freqtrade.freqai.base_models.BaseRegressionModel import BaseRegressionModel
 from freqtrade.freqai.data_kitchen import FreqaiDataKitchen
+from freqtrade.freqai.tensorboard import TBCallback
 
 
 logger = logging.getLogger(__name__)
 
 
 class XGBoostRFRegressor(BaseRegressionModel):
     """
@@ -40,11 +41,14 @@
 
         sample_weight = data_dictionary["train_weights"]
 
         xgb_model = self.get_init_model(dk.pair)
 
         model = XGBRFRegressor(**self.model_training_parameters)
 
+        model.set_params(callbacks=[TBCallback(dk.data_path)], activate=self.activate_tensorboard)
         model.fit(X=X, y=y, sample_weight=sample_weight, eval_set=eval_set,
                   sample_weight_eval_set=eval_weights, xgb_model=xgb_model)
+        # set the callbacks to empty so that we can serialize to disk later
+        model.set_params(callbacks=[])
 
         return model
```

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressor.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py` & `freqtrade-2023.6/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/TensorboardCallback.py` & `freqtrade-2023.6/freqtrade/freqai/tensorboard/TensorboardCallback.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/__init__.py` & `freqtrade-2023.6/freqtrade/freqai/tensorboard/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/base_tensorboard.py` & `freqtrade-2023.6/freqtrade/freqai/tensorboard/base_tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/tensorboard.py` & `freqtrade-2023.6/freqtrade/freqai/tensorboard/tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchDataConvertor.py` & `freqtrade-2023.6/freqtrade/freqai/torch/PyTorchDataConvertor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchMLPModel.py` & `freqtrade-2023.6/freqtrade/freqai/torch/PyTorchMLPModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchModelTrainer.py` & `freqtrade-2023.6/freqtrade/freqai/torch/PyTorchModelTrainer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTrainerInterface.py` & `freqtrade-2023.6/freqtrade/freqai/torch/PyTorchTrainerInterface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTransformerModel.py` & `freqtrade-2023.6/freqtrade/freqai/torch/PyTorchTransformerModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/torch/datasets.py` & `freqtrade-2023.6/freqtrade/freqai/torch/datasets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqai/utils.py` & `freqtrade-2023.6/freqtrade/freqai/utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/freqtradebot.py` & `freqtrade-2023.6/freqtrade/freqtradebot.py`

 * *Files 1% similar despite different names*

```diff
@@ -1298,14 +1298,18 @@
             upd_req = datetime.now(timezone.utc) - timedelta(seconds=update_beat)
             if trade.stoploss_last_update_utc and upd_req >= trade.stoploss_last_update_utc:
                 # cancelling the current stoploss on exchange first
                 logger.info(f"Cancelling current stoploss on exchange for pair {trade.pair} "
                             f"(orderid:{order['id']}) in order to add another one ...")
 
                 self.cancel_stoploss_on_exchange(trade)
+                if not trade.is_open:
+                    logger.warning(
+                        f"Trade {trade} is closed, not creating trailing stoploss order.")
+                    return
 
                 # Create new stoploss order
                 if not self.create_stoploss_order(trade=trade, stop_price=stoploss_norm):
                     logger.warning(f"Could not create trailing stoploss order "
                                    f"for pair {trade.pair}.")
 
     def manage_open_orders(self) -> None:
```

### Comparing `freqtrade-2023.5.1/freqtrade/leverage/interest.py` & `freqtrade-2023.6/freqtrade/leverage/interest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/loggers/__init__.py` & `freqtrade-2023.6/freqtrade/loggers/__init__.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,48 +1,26 @@
 import logging
 from logging import Formatter
 from logging.handlers import RotatingFileHandler, SysLogHandler
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
 from freqtrade.loggers.buffering_handler import FTBufferingHandler
+from freqtrade.loggers.set_log_levels import set_loggers
 from freqtrade.loggers.std_err_stream_handler import FTStdErrStreamHandler
 
 
 logger = logging.getLogger(__name__)
 LOGFORMAT = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
 
 # Initialize bufferhandler - will be used for /log endpoints
 bufferHandler = FTBufferingHandler(1000)
 bufferHandler.setFormatter(Formatter(LOGFORMAT))
 
 
-def _set_loggers(verbosity: int = 0, api_verbosity: str = 'info') -> None:
-    """
-    Set the logging level for third party libraries
-    :return: None
-    """
-
-    logging.getLogger('requests').setLevel(
-        logging.INFO if verbosity <= 1 else logging.DEBUG
-    )
-    logging.getLogger("urllib3").setLevel(
-        logging.INFO if verbosity <= 1 else logging.DEBUG
-    )
-    logging.getLogger('ccxt.base.exchange').setLevel(
-        logging.INFO if verbosity <= 2 else logging.DEBUG
-    )
-    logging.getLogger('telegram').setLevel(logging.INFO)
-    logging.getLogger('httpx').setLevel(logging.INFO)
-
-    logging.getLogger('werkzeug').setLevel(
-        logging.ERROR if api_verbosity == 'error' else logging.INFO
-    )
-
-
 def get_existing_handlers(handlertype):
     """
     Returns Existing handler or None (if the handler has not yet been added to the root handlers).
     """
     return next((h for h in logging.root.handlers if isinstance(h, handlertype)), None)
 
 
@@ -111,10 +89,10 @@
             handler_rf = RotatingFileHandler(logfile,
                                              maxBytes=1024 * 1024 * 10,  # 10Mb
                                              backupCount=10)
             handler_rf.setFormatter(Formatter(LOGFORMAT))
             logging.root.addHandler(handler_rf)
 
     logging.root.setLevel(logging.INFO if verbosity < 1 else logging.DEBUG)
-    _set_loggers(verbosity, config.get('api_server', {}).get('verbosity', 'info'))
+    set_loggers(verbosity, config.get('api_server', {}).get('verbosity', 'info'))
 
     logger.info('Verbosity set to %s', verbosity)
```

### Comparing `freqtrade-2023.5.1/freqtrade/loggers/std_err_stream_handler.py` & `freqtrade-2023.6/freqtrade/loggers/std_err_stream_handler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/main.py` & `freqtrade-2023.6/freqtrade/main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/misc.py` & `freqtrade-2023.6/freqtrade/misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/mixins/logging_mixin.py` & `freqtrade-2023.6/freqtrade/mixins/logging_mixin.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 from typing import Callable
 
 from cachetools import TTLCache, cached
 
 
-class LoggingMixin():
+class LoggingMixin:
     """
     Logging Mixin
     Shows similar messages only once every `refresh_period`.
     """
     # Disable output completely
     show_output = True
```

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/backtest_caching.py` & `freqtrade-2023.6/freqtrade/optimize/backtest_caching.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/backtesting.py` & `freqtrade-2023.6/freqtrade/optimize/backtesting.py`

 * *Files 0% similar despite different names*

```diff
@@ -20,14 +20,15 @@
 from freqtrade.data.converter import trim_dataframe, trim_dataframes
 from freqtrade.data.dataprovider import DataProvider
 from freqtrade.enums import (BacktestState, CandleType, ExitCheckTuple, ExitType, RunMode,
                              TradingMode)
 from freqtrade.exceptions import DependencyException, OperationalException
 from freqtrade.exchange import (amount_to_contract_precision, price_to_precision,
                                 timeframe_to_minutes, timeframe_to_seconds)
+from freqtrade.exchange.exchange import Exchange
 from freqtrade.mixins import LoggingMixin
 from freqtrade.optimize.backtest_caching import get_strategy_run_id
 from freqtrade.optimize.bt_progress import BTProgress
 from freqtrade.optimize.optimize_reports import (generate_backtest_stats, generate_rejected_signals,
                                                  generate_trade_signal_candles,
                                                  show_backtest_results,
                                                  store_backtest_analysis_results,
@@ -68,15 +69,15 @@
     Backtesting class, this class contains all the logic to run a backtest
 
     To run a backtest:
     backtesting = Backtesting(config)
     backtesting.start()
     """
 
-    def __init__(self, config: Config) -> None:
+    def __init__(self, config: Config, exchange: Optional[Exchange] = None) -> None:
 
         LoggingMixin.show_output = False
         self.config = config
         self.results: Dict[str, Any] = {}
         self.trade_id_counter: int = 0
         self.order_id_counter: int = 0
 
@@ -85,15 +86,18 @@
         self.strategylist: List[IStrategy] = []
         self.all_results: Dict[str, Dict] = {}
         self.processed_dfs: Dict[str, Dict] = {}
         self.rejected_dict: Dict[str, List] = {}
         self.rejected_df: Dict[str, Dict] = {}
 
         self._exchange_name = self.config['exchange']['name']
-        self.exchange = ExchangeResolver.load_exchange(self.config, load_leverage_tiers=True)
+        if not exchange:
+            exchange = ExchangeResolver.load_exchange(self.config, load_leverage_tiers=True)
+        self.exchange = exchange
+
         self.dataprovider = DataProvider(self.config, self.exchange)
 
         if self.config.get('strategy_list'):
             if self.config.get('freqai', {}).get('enabled', False):
                 logger.warning("Using --strategy-list with FreqAI REQUIRES all strategies "
                                "to have identical feature_engineering_* functions.")
             for strat in list(self.config['strategy_list']):
@@ -110,24 +114,15 @@
         if "timeframe" not in self.config:
             raise OperationalException("Timeframe needs to be set in either "
                                        "configuration or as cli argument `--timeframe 5m`")
         self.timeframe = str(self.config.get('timeframe'))
         self.timeframe_min = timeframe_to_minutes(self.timeframe)
         self.init_backtest_detail()
         self.pairlists = PairListManager(self.exchange, self.config, self.dataprovider)
-        if 'VolumePairList' in self.pairlists.name_list:
-            raise OperationalException("VolumePairList not allowed for backtesting. "
-                                       "Please use StaticPairList instead.")
-        if 'PerformanceFilter' in self.pairlists.name_list:
-            raise OperationalException("PerformanceFilter not allowed for backtesting.")
-
-        if len(self.strategylist) > 1 and 'PrecisionFilter' in self.pairlists.name_list:
-            raise OperationalException(
-                "PrecisionFilter not allowed for backtesting multiple strategies."
-            )
+        self._validate_pairlists_for_backtesting()
 
         self.dataprovider.add_pairlisthandler(self.pairlists)
         self.pairlists.refresh_pairlist()
 
         if len(self.pairlists.whitelist) == 0:
             raise OperationalException("No pair in whitelist.")
 
@@ -160,14 +155,26 @@
         self._can_short = self.trading_mode != TradingMode.SPOT
         self._position_stacking: bool = self.config.get('position_stacking', False)
         self.enable_protections: bool = self.config.get('enable_protections', False)
         migrate_binance_futures_data(config)
 
         self.init_backtest()
 
+    def _validate_pairlists_for_backtesting(self):
+        if 'VolumePairList' in self.pairlists.name_list:
+            raise OperationalException("VolumePairList not allowed for backtesting. "
+                                       "Please use StaticPairList instead.")
+        if 'PerformanceFilter' in self.pairlists.name_list:
+            raise OperationalException("PerformanceFilter not allowed for backtesting.")
+
+        if len(self.strategylist) > 1 and 'PrecisionFilter' in self.pairlists.name_list:
+            raise OperationalException(
+                "PrecisionFilter not allowed for backtesting multiple strategies."
+            )
+
     @staticmethod
     def cleanup():
         LoggingMixin.show_output = True
         PairLocks.use_db = True
         Trade.use_db = True
 
     def init_backtest_detail(self) -> None:
```

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/bt_progress.py` & `freqtrade-2023.6/freqtrade/optimize/bt_progress.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/edge_cli.py` & `freqtrade-2023.6/freqtrade/optimize/edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_auto.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_auto.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_epoch_filters.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_epoch_filters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_interface.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss_interface.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_loss_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_tools.py` & `freqtrade-2023.6/freqtrade/optimize/hyperopt_tools.py`

 * *Files 0% similar despite different names*

```diff
@@ -31,24 +31,24 @@
         return int(x)
     if isinstance(x, np.bool_):
         return bool(x)
 
     return str(x)
 
 
-class HyperoptStateContainer():
+class HyperoptStateContainer:
     """ Singleton class to track state of hyperopt"""
     state: HyperoptState = HyperoptState.OPTIMIZE
 
     @classmethod
     def set_state(cls, value: HyperoptState):
         cls.state = value
 
 
-class HyperoptTools():
+class HyperoptTools:
 
     @staticmethod
     def get_strategy_filename(config: Config, strategy_name: str) -> Optional[Path]:
         """
         Get Strategy-location (filename) from strategy_name
         """
         from freqtrade.resolvers.strategy_resolver import StrategyResolver
```

### Comparing `freqtrade-2023.5.1/freqtrade/optimize/space/decimalspace.py` & `freqtrade-2023.6/freqtrade/optimize/space/decimalspace.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/key_value_store.py` & `freqtrade-2023.6/freqtrade/persistence/key_value_store.py`

 * *Files 2% similar despite different names*

```diff
@@ -38,15 +38,15 @@
 
     string_value: Mapped[Optional[str]] = mapped_column(String(255), nullable=True)
     datetime_value: Mapped[Optional[datetime]]
     float_value: Mapped[Optional[float]]
     int_value: Mapped[Optional[int]]
 
 
-class KeyValueStore():
+class KeyValueStore:
     """
     Generic bot-wide, persistent key-value store
     Can be used to store generic values, e.g. very first bot startup time.
     Supports the types str, datetime, float and int.
     """
 
     @staticmethod
```

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/migrations.py` & `freqtrade-2023.6/freqtrade/persistence/migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/models.py` & `freqtrade-2023.6/freqtrade/persistence/models.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/pairlock.py` & `freqtrade-2023.6/freqtrade/persistence/pairlock.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/pairlock_middleware.py` & `freqtrade-2023.6/freqtrade/persistence/pairlock_middleware.py`

 * *Files 0% similar despite different names*

```diff
@@ -7,15 +7,15 @@
 from freqtrade.exchange import timeframe_to_next_date
 from freqtrade.persistence.models import PairLock
 
 
 logger = logging.getLogger(__name__)
 
 
-class PairLocks():
+class PairLocks:
     """
     Pairlocks middleware class
     Abstracts the database layer away so it becomes optional - which will be necessary to support
     backtesting and hyperopt in the future.
     """
 
     use_db = True
```

### Comparing `freqtrade-2023.5.1/freqtrade/persistence/trade_model.py` & `freqtrade-2023.6/freqtrade/persistence/trade_model.py`

 * *Files 0% similar despite different names*

```diff
@@ -6,14 +6,15 @@
 from datetime import datetime, timedelta, timezone
 from math import isclose
 from typing import Any, ClassVar, Dict, List, Optional, Sequence, cast
 
 from sqlalchemy import (Enum, Float, ForeignKey, Integer, ScalarResult, Select, String,
                         UniqueConstraint, desc, func, select)
 from sqlalchemy.orm import Mapped, lazyload, mapped_column, relationship, validates
+from typing_extensions import Self
 
 from freqtrade.constants import (CUSTOM_TAG_MAX_LENGTH, DATETIME_PRINT_FORMAT, MATH_CLOSE_PREC,
                                  NON_OPEN_EXCHANGE_STATES, BuySell, LongShort)
 from freqtrade.enums import ExitType, TradingMode
 from freqtrade.exceptions import DependencyException, OperationalException
 from freqtrade.exchange import (ROUND_DOWN, ROUND_UP, amount_to_contract_precision,
                                 price_to_precision)
@@ -93,15 +94,15 @@
 
     @property
     def safe_price(self) -> float:
         return self.average or self.price or self.stop_price or self.ft_price
 
     @property
     def safe_filled(self) -> float:
-        return self.filled if self.filled is not None else self.amount or 0.0
+        return self.filled if self.filled is not None else 0.0
 
     @property
     def safe_cost(self) -> float:
         return self.cost or 0.0
 
     @property
     def safe_remaining(self) -> float:
@@ -242,23 +243,23 @@
         if filtered_orders:
             oobj = filtered_orders[0]
             oobj.update_from_ccxt_object(order)
             Trade.commit()
         else:
             logger.warning(f"Did not find order for {order}.")
 
-    @staticmethod
+    @classmethod
     def parse_from_ccxt_object(
-            order: Dict[str, Any], pair: str, side: str,
-            amount: Optional[float] = None, price: Optional[float] = None) -> 'Order':
+            cls, order: Dict[str, Any], pair: str, side: str,
+            amount: Optional[float] = None, price: Optional[float] = None) -> Self:
         """
         Parse an order from a ccxt object and return a new order Object.
         Optional support for overriding amount and price is only used for test simplification.
         """
-        o = Order(
+        o = cls(
             order_id=str(order['id']),
             ft_order_side=side,
             ft_pair=pair,
             ft_amount=amount if amount else order['amount'],
             ft_price=price if price else order['price'],
             )
 
@@ -278,15 +279,15 @@
         """
         Retrieve order based on order_id
         :return: Order or None
         """
         return Order.session.scalars(select(Order).filter(Order.order_id == order_id)).first()
 
 
-class LocalTrade():
+class LocalTrade:
     """
     Trade database model.
     Used in backtesting - must be aligned to Trade model!
 
     """
     use_db: bool = False
     # Trades container for backtesting
@@ -699,15 +700,15 @@
                 logger.warning(
                     f'Got different open_order_id {self.open_order_id} != {order.order_id}')
 
         elif order.ft_order_side == 'stoploss' and order.status not in ('open', ):
             self.stoploss_order_id = None
             self.close_rate_requested = self.stop_loss
             self.exit_reason = ExitType.STOPLOSS_ON_EXCHANGE.value
-            if self.is_open:
+            if self.is_open and order.safe_filled > 0:
                 logger.info(f'{order.order_type.upper()} is hit for {self}.')
         else:
             raise ValueError(f'Unknown order type: {order.order_type}')
 
         if order.ft_order_side != self.entry_side:
             amount_tr = amount_to_contract_precision(self.amount, self.amount_precision,
                                                      self.precision_mode, self.contract_size)
@@ -1387,15 +1388,18 @@
         NOTE: Not supported in Backtesting.
         :param trade_filter: Optional filter to apply to trades
                              Can be either a Filter object, or a List of filters
                              e.g. `(trade_filter=[Trade.id == trade_id, Trade.is_open.is_(True),])`
                              e.g. `(trade_filter=Trade.id == trade_id)`
         :return: unsorted query object
         """
-        return Trade.session.scalars(Trade.get_trades_query(trade_filter, include_orders))
+        query = Trade.get_trades_query(trade_filter, include_orders)
+        # this sholud remain split. if use_db is False, session is not available and the above will
+        # raise an exception.
+        return Trade.session.scalars(query)
 
     @staticmethod
     def get_open_order_trades() -> List['Trade']:
         """
         Returns all open trades
         NOTE: Not supported in Backtesting.
         """
@@ -1634,26 +1638,26 @@
                 func.sum(Order.cost).label('volume')
             ).filter(
                 Order.order_filled_date >= start_date,
                 Order.status == 'closed'
             )).scalar_one()
         return trading_volume
 
-    @staticmethod
-    def from_json(json_str: str) -> 'Trade':
+    @classmethod
+    def from_json(cls, json_str: str) -> Self:
         """
         Create a Trade instance from a json string.
 
         Used for debugging purposes - please keep.
         :param json_str: json string to parse
         :return: Trade instance
         """
         import rapidjson
         data = rapidjson.loads(json_str)
-        trade = Trade(
+        trade = cls(
             id=data["trade_id"],
             pair=data["pair"],
             base_currency=data["base_currency"],
             stake_currency=data["quote_currency"],
             is_open=data["is_open"],
             exchange=data["exchange"],
             amount=data["amount"],
```

### Comparing `freqtrade-2023.5.1/freqtrade/plot/plotting.py` & `freqtrade-2023.6/freqtrade/plot/plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/AgeFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/AgeFilter.py`

 * *Files 5% similar despite different names*

```diff
@@ -8,15 +8,15 @@
 
 from pandas import DataFrame
 
 from freqtrade.constants import Config, ListPairsWithTimeframes
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Tickers
 from freqtrade.misc import plural
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 from freqtrade.util import PeriodicCache, dt_floor_day, dt_now, dt_ts
 
 
 logger = logging.getLogger(__name__)
 
 
 class AgeFilter(IPairList):
@@ -64,14 +64,35 @@
             f"{self.name} - Filtering pairs with age less than "
             f"{self._min_days_listed} {plural(self._min_days_listed, 'day')}"
         ) + ((
             " or more than "
             f"{self._max_days_listed} {plural(self._max_days_listed, 'day')}"
         ) if self._max_days_listed else '')
 
+    @staticmethod
+    def description() -> str:
+        return "Filter pairs by age (days listed)."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "min_days_listed": {
+                "type": "number",
+                "default": 10,
+                "description": "Minimum Days Listed",
+                "help": "Minimum number of days a pair must have been listed on the exchange.",
+            },
+            "max_days_listed": {
+                "type": "number",
+                "default": None,
+                "description": "Maximum Days Listed",
+                "help": "Maximum number of days a pair must have been listed on the exchange.",
+            },
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new allowlist
         """
         needed_pairs: ListPairsWithTimeframes = [
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/IPairList.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/IPairList.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,27 +1,63 @@
 """
 PairList Handler base class
 """
 import logging
 from abc import ABC, abstractmethod, abstractproperty
 from copy import deepcopy
-from typing import Any, Dict, List, Optional
+from typing import Any, Dict, List, Literal, Optional, TypedDict, Union
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import Exchange, market_is_active
 from freqtrade.exchange.types import Ticker, Tickers
 from freqtrade.mixins import LoggingMixin
 
 
 logger = logging.getLogger(__name__)
 
 
+class __PairlistParameterBase(TypedDict):
+    description: str
+    help: str
+
+
+class __NumberPairlistParameter(__PairlistParameterBase):
+    type: Literal["number"]
+    default: Union[int, float, None]
+
+
+class __StringPairlistParameter(__PairlistParameterBase):
+    type: Literal["string"]
+    default: Union[str, None]
+
+
+class __OptionPairlistParameter(__PairlistParameterBase):
+    type: Literal["option"]
+    default: Union[str, None]
+    options: List[str]
+
+
+class __BoolPairlistParameter(__PairlistParameterBase):
+    type: Literal["boolean"]
+    default: Union[bool, None]
+
+
+PairlistParameter = Union[
+    __NumberPairlistParameter,
+    __StringPairlistParameter,
+    __OptionPairlistParameter,
+    __BoolPairlistParameter
+    ]
+
+
 class IPairList(LoggingMixin, ABC):
 
+    is_pairlist_generator = False
+
     def __init__(self, exchange: Exchange, pairlistmanager,
                  config: Config, pairlistconfig: Dict[str, Any],
                  pairlist_pos: int) -> None:
         """
         :param exchange: Exchange instance
         :param pairlistmanager: Instantiated Pairlist manager
         :param config: Global bot configuration
@@ -49,14 +85,45 @@
     @abstractproperty
     def needstickers(self) -> bool:
         """
         Boolean property defining if tickers are necessary.
         If no Pairlist requires tickers, an empty Dict is passed
         as tickers argument to filter_pairlist
         """
+        return False
+
+    @staticmethod
+    @abstractmethod
+    def description() -> str:
+        """
+        Return description of this Pairlist Handler
+        -> Please overwrite in subclasses
+        """
+        return ""
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        """
+        Return parameters used by this Pairlist Handler, and their type
+        contains a dictionary with the parameter name as key, and a dictionary
+        with the type and default value.
+        -> Please overwrite in subclasses
+        """
+        return {}
+
+    @staticmethod
+    def refresh_period_parameter() -> Dict[str, PairlistParameter]:
+        return {
+            "refresh_period": {
+                "type": "number",
+                "default": 1800,
+                "description": "Refresh period",
+                "help": "Refresh period in seconds",
+            }
+        }
 
     @abstractmethod
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         -> Please overwrite in subclasses
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/OffsetFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/OffsetFilter.py`

 * *Files 13% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 """
 import logging
 from typing import Any, Dict, List
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Tickers
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 
 
 logger = logging.getLogger(__name__)
 
 
 class OffsetFilter(IPairList):
 
@@ -39,14 +39,35 @@
         """
         Short whitelist method description - used for startup-messages
         """
         if self._number_pairs:
             return f"{self.name} - Taking {self._number_pairs} Pairs, starting from {self._offset}."
         return f"{self.name} - Offsetting pairs by {self._offset}."
 
+    @staticmethod
+    def description() -> str:
+        return "Offset pair list filter."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "offset": {
+                "type": "number",
+                "default": 0,
+                "description": "Offset",
+                "help": "Offset of the pairlist.",
+            },
+            "number_assets": {
+                "type": "number",
+                "default": 0,
+                "description": "Number of assets",
+                "help": "Number of assets to use from the pairlist, starting from offset.",
+            },
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Filters and sorts pairlist and returns the whitelist again.
         Called on each bot iteration - please use internal caching if necessary
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new whitelist
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PerformanceFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/PerformanceFilter.py`

 * *Files 15% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 from typing import Any, Dict, List
 
 import pandas as pd
 
 from freqtrade.constants import Config
 from freqtrade.exchange.types import Tickers
 from freqtrade.persistence import Trade
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 
 
 logger = logging.getLogger(__name__)
 
 
 class PerformanceFilter(IPairList):
 
@@ -36,14 +36,35 @@
 
     def short_desc(self) -> str:
         """
         Short allowlist method description - used for startup-messages
         """
         return f"{self.name} - Sorting pairs by performance."
 
+    @staticmethod
+    def description() -> str:
+        return "Filter pairs by performance."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "minutes": {
+                "type": "number",
+                "default": 0,
+                "description": "Minutes",
+                "help": "Consider trades from the last X minutes. 0 means all trades.",
+            },
+            "min_profit": {
+                "type": "number",
+                "default": None,
+                "description": "Minimum profit",
+                "help": "Minimum profit in percent. Pairs with less profit are removed.",
+            },
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Filters and sorts pairlist and returns the allowlist again.
         Called on each bot iteration - please use internal caching if necessary
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new allowlist
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PrecisionFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/PrecisionFilter.py`

 * *Files 6% similar despite different names*

```diff
@@ -42,14 +42,18 @@
 
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         """
         return f"{self.name} - Filtering untradable pairs."
 
+    @staticmethod
+    def description() -> str:
+        return "Filters low-value coins which would not allow setting stoplosses."
+
     def _validate_pair(self, pair: str, ticker: Optional[Ticker]) -> bool:
         """
         Check if pair has enough room to add a stoploss to avoid "unsellable" buys of very
         low value pairs.
         :param pair: Pair that's currently validated
         :param ticker: ticker dict as returned from ccxt.fetch_ticker
         :return: True if the pair can stay, false if it should be removed
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PriceFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/PriceFilter.py`

 * *Files 25% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 """
 import logging
 from typing import Any, Dict, Optional
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Ticker
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 
 
 logger = logging.getLogger(__name__)
 
 
 class PriceFilter(IPairList):
 
@@ -61,14 +61,48 @@
             active_price_filters.append(f"Value above {self._max_value:.8f}")
 
         if len(active_price_filters):
             return f"{self.name} - Filtering pairs priced {' or '.join(active_price_filters)}."
 
         return f"{self.name} - No price filters configured."
 
+    @staticmethod
+    def description() -> str:
+        return "Filter pairs by price."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "low_price_ratio": {
+                "type": "number",
+                "default": 0,
+                "description": "Low price ratio",
+                "help": ("Remove pairs where a price move of 1 price unit (pip) "
+                         "is above this ratio."),
+            },
+            "min_price": {
+                "type": "number",
+                "default": 0,
+                "description": "Minimum price",
+                "help": "Remove pairs with a price below this value.",
+            },
+            "max_price": {
+                "type": "number",
+                "default": 0,
+                "description": "Maximum price",
+                "help": "Remove pairs with a price above this value.",
+            },
+            "max_value": {
+                "type": "number",
+                "default": 0,
+                "description": "Maximum value",
+                "help": "Remove pairs with a value (price * amount) above this value.",
+            },
+        }
+
     def _validate_pair(self, pair: str, ticker: Optional[Ticker]) -> bool:
         """
         Check if if one price-step (pip) is > than a certain barrier.
         :param pair: Pair that's currently validated
         :param ticker: ticker dict as returned from ccxt.fetch_ticker
         :return: True if the pair can stay, false if it should be removed
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/ProducerPairList.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/StaticPairList.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,48 +1,34 @@
 """
-External Pair List provider
+Static Pair List provider
 
-Provides pair list from Leader data
+Provides pair white list as it configured in config
 """
 import logging
-from typing import Any, Dict, List, Optional
+from copy import deepcopy
+from typing import Any, Dict, List
 
-from freqtrade.exceptions import OperationalException
+from freqtrade.constants import Config
 from freqtrade.exchange.types import Tickers
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 
 
 logger = logging.getLogger(__name__)
 
 
-class ProducerPairList(IPairList):
-    """
-    PairList plugin for use with external_message_consumer.
-    Will use pairs given from leader data.
-
-    Usage:
-        "pairlists": [
-            {
-                "method": "ProducerPairList",
-                "number_assets": 5,
-                "producer_name": "default",
-            }
-        ],
-    """
+class StaticPairList(IPairList):
+
+    is_pairlist_generator = True
 
     def __init__(self, exchange, pairlistmanager,
-                 config: Dict[str, Any], pairlistconfig: Dict[str, Any],
+                 config: Config, pairlistconfig: Dict[str, Any],
                  pairlist_pos: int) -> None:
         super().__init__(exchange, pairlistmanager, config, pairlistconfig, pairlist_pos)
 
-        self._num_assets: int = self._pairlistconfig.get('number_assets', 0)
-        self._producer_name = self._pairlistconfig.get('producer_name', 'default')
-        if not config.get('external_message_consumer', {}).get('enabled'):
-            raise OperationalException(
-                "ProducerPairList requires external_message_consumer to be enabled.")
+        self._allow_inactive = self._pairlistconfig.get('allow_inactive', False)
 
     @property
     def needstickers(self) -> bool:
         """
         Boolean property defining if tickers are necessary.
         If no Pairlist requires tickers, an empty Dict is passed
         as tickers argument to filter_pairlist
@@ -50,42 +36,51 @@
         return False
 
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         -> Please overwrite in subclasses
         """
-        return f"{self.name} - {self._producer_name}"
-
-    def _filter_pairlist(self, pairlist: Optional[List[str]]):
-        upstream_pairlist = self._pairlistmanager._dataprovider.get_producer_pairs(
-            self._producer_name)
-
-        if pairlist is None:
-            pairlist = self._pairlistmanager._dataprovider.get_producer_pairs(self._producer_name)
-
-        pairs = list(dict.fromkeys(pairlist + upstream_pairlist))
-        if self._num_assets:
-            pairs = pairs[:self._num_assets]
+        return f"{self.name}"
 
-        return pairs
+    @staticmethod
+    def description() -> str:
+        return "Use pairlist as configured in config."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "allow_inactive": {
+                "type": "boolean",
+                "default": False,
+                "description": "Allow inactive pairs",
+                "help": "Allow inactive pairs to be in the whitelist.",
+            },
+        }
 
     def gen_pairlist(self, tickers: Tickers) -> List[str]:
         """
         Generate the pairlist
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: List of pairs
         """
-        pairs = self._filter_pairlist(None)
-        self.log_once(f"Received pairs: {pairs}", logger.debug)
-        pairs = self._whitelist_for_active_markets(self.verify_whitelist(pairs, logger.info))
-        return pairs
+        if self._allow_inactive:
+            return self.verify_whitelist(
+                self._config['exchange']['pair_whitelist'], logger.info, keep_invalid=True
+            )
+        else:
+            return self._whitelist_for_active_markets(
+                self.verify_whitelist(self._config['exchange']['pair_whitelist'], logger.info))
 
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Filters and sorts pairlist and returns the whitelist again.
         Called on each bot iteration - please use internal caching if necessary
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new whitelist
         """
-        return self._filter_pairlist(pairlist)
+        pairlist_ = deepcopy(pairlist)
+        for pair in self._config['exchange']['pair_whitelist']:
+            if pair not in pairlist_:
+                pairlist_.append(pair)
+        return pairlist_
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/ShuffleFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/ShuffleFilter.py`

 * *Files 20% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 import random
 from typing import Any, Dict, List, Literal
 
 from freqtrade.constants import Config
 from freqtrade.enums import RunMode
 from freqtrade.exchange import timeframe_to_seconds
 from freqtrade.exchange.types import Tickers
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 from freqtrade.util.periodic_cache import PeriodicCache
 
 
 logger = logging.getLogger(__name__)
 
 ShuffleValues = Literal['candle', 'iteration']
 
@@ -51,14 +51,36 @@
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         """
         return (f"{self.name} - Shuffling pairs every {self._shuffle_freq}" +
                 (f", seed = {self._seed}." if self._seed is not None else "."))
 
+    @staticmethod
+    def description() -> str:
+        return "Randomize pairlist order."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "shuffle_frequency": {
+                "type": "option",
+                "default": "candle",
+                "options": ["candle", "iteration"],
+                "description": "Shuffle frequency",
+                "help": "Shuffle frequency. Can be either 'candle' or 'iteration'.",
+            },
+            "seed": {
+                "type": "number",
+                "default": None,
+                "description": "Random Seed",
+                "help": "Seed for random number generator. Not used in live mode.",
+            },
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Filters and sorts pairlist and returns the whitelist again.
         Called on each bot iteration - please use internal caching if necessary
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new whitelist
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/SpreadFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/SpreadFilter.py`

 * *Files 11% similar despite different names*

```diff
@@ -3,15 +3,15 @@
 """
 import logging
 from typing import Any, Dict, Optional
 
 from freqtrade.constants import Config
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Ticker
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 
 
 logger = logging.getLogger(__name__)
 
 
 class SpreadFilter(IPairList):
 
@@ -41,14 +41,29 @@
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         """
         return (f"{self.name} - Filtering pairs with ask/bid diff above "
                 f"{self._max_spread_ratio:.2%}.")
 
+    @staticmethod
+    def description() -> str:
+        return "Filter by bid/ask difference."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "max_spread_ratio": {
+                "type": "number",
+                "default": 0.005,
+                "description": "Max spread ratio",
+                "help": "Max spread ratio for a pair to be considered.",
+            },
+        }
+
     def _validate_pair(self, pair: str, ticker: Optional[Ticker]) -> bool:
         """
         Validate spread for the ticker
         :param pair: Pair that's currently validated
         :param ticker: ticker dict as returned from ccxt.fetch_ticker
         :return: True if the pair can stay, false if it should be removed
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolatilityFilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/VolatilityFilter.py`

 * *Files 20% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 from cachetools import TTLCache
 from pandas import DataFrame
 
 from freqtrade.constants import Config, ListPairsWithTimeframes
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Tickers
 from freqtrade.misc import plural
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 from freqtrade.util import dt_floor_day, dt_now, dt_ts
 
 
 logger = logging.getLogger(__name__)
 
 
 class VolatilityFilter(IPairList):
@@ -60,14 +60,42 @@
         """
         Short whitelist method description - used for startup-messages
         """
         return (f"{self.name} - Filtering pairs with volatility range "
                 f"{self._min_volatility}-{self._max_volatility} "
                 f" the last {self._days} {plural(self._days, 'day')}.")
 
+    @staticmethod
+    def description() -> str:
+        return "Filter pairs by their recent volatility."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "lookback_days": {
+                "type": "number",
+                "default": 10,
+                "description": "Lookback Days",
+                "help": "Number of days to look back at.",
+            },
+            "min_volatility": {
+                "type": "number",
+                "default": 0,
+                "description": "Minimum Volatility",
+                "help": "Minimum volatility a pair must have to be considered.",
+            },
+            "max_volatility": {
+                "type": "number",
+                "default": None,
+                "description": "Maximum Volatility",
+                "help": "Maximum volatility a pair must have to be considered.",
+            },
+            **IPairList.refresh_period_parameter()
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Validate trading range
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new allowlist
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolumePairList.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/VolumePairList.py`

 * *Files 7% similar despite different names*

```diff
@@ -10,26 +10,28 @@
 from cachetools import TTLCache
 
 from freqtrade.constants import Config, ListPairsWithTimeframes
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import timeframe_to_minutes, timeframe_to_prev_date
 from freqtrade.exchange.types import Tickers
 from freqtrade.misc import format_ms_time
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 from freqtrade.util import dt_now
 
 
 logger = logging.getLogger(__name__)
 
 
 SORT_VALUES = ['quoteVolume']
 
 
 class VolumePairList(IPairList):
 
+    is_pairlist_generator = True
+
     def __init__(self, exchange, pairlistmanager,
                  config: Config, pairlistconfig: Dict[str, Any],
                  pairlist_pos: int) -> None:
         super().__init__(exchange, pairlistmanager, config, pairlistconfig, pairlist_pos)
 
         if 'number_assets' not in self._pairlistconfig:
             raise OperationalException(
@@ -108,14 +110,61 @@
 
     def short_desc(self) -> str:
         """
         Short whitelist method description - used for startup-messages
         """
         return f"{self.name} - top {self._pairlistconfig['number_assets']} volume pairs."
 
+    @staticmethod
+    def description() -> str:
+        return "Provides dynamic pair list based on trade volumes."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "number_assets": {
+                "type": "number",
+                "default": 30,
+                "description": "Number of assets",
+                "help": "Number of assets to use from the pairlist",
+            },
+            "sort_key": {
+                "type": "option",
+                "default": "quoteVolume",
+                "options": SORT_VALUES,
+                "description": "Sort key",
+                "help": "Sort key to use for sorting the pairlist.",
+            },
+            "min_value": {
+                "type": "number",
+                "default": 0,
+                "description": "Minimum value",
+                "help": "Minimum value to use for filtering the pairlist.",
+            },
+            **IPairList.refresh_period_parameter(),
+            "lookback_days": {
+                "type": "number",
+                "default": 0,
+                "description": "Lookback Days",
+                "help": "Number of days to look back at.",
+            },
+            "lookback_timeframe": {
+                "type": "string",
+                "default": "",
+                "description": "Lookback Timeframe",
+                "help": "Timeframe to use for lookback.",
+            },
+            "lookback_period": {
+                "type": "number",
+                "default": 0,
+                "description": "Lookback Period",
+                "help": "Number of periods to look back at.",
+            },
+        }
+
     def gen_pairlist(self, tickers: Tickers) -> List[str]:
         """
         Generate the pairlist
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: List of pairs
         """
         # Generate dynamic whitelist
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/pairlist_helpers.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/pairlist_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlist/rangestabilityfilter.py` & `freqtrade-2023.6/freqtrade/plugins/pairlist/rangestabilityfilter.py`

 * *Files 24% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 from cachetools import TTLCache
 from pandas import DataFrame
 
 from freqtrade.constants import Config, ListPairsWithTimeframes
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange.types import Tickers
 from freqtrade.misc import plural
-from freqtrade.plugins.pairlist.IPairList import IPairList
+from freqtrade.plugins.pairlist.IPairList import IPairList, PairlistParameter
 from freqtrade.util import dt_floor_day, dt_now, dt_ts
 
 
 logger = logging.getLogger(__name__)
 
 
 class RangeStabilityFilter(IPairList):
@@ -58,14 +58,42 @@
         max_rate_desc = ""
         if self._max_rate_of_change:
             max_rate_desc = (f" and above {self._max_rate_of_change}")
         return (f"{self.name} - Filtering pairs with rate of change below "
                 f"{self._min_rate_of_change}{max_rate_desc} over the "
                 f"last {plural(self._days, 'day')}.")
 
+    @staticmethod
+    def description() -> str:
+        return "Filters pairs by their rate of change."
+
+    @staticmethod
+    def available_parameters() -> Dict[str, PairlistParameter]:
+        return {
+            "lookback_days": {
+                "type": "number",
+                "default": 10,
+                "description": "Lookback Days",
+                "help": "Number of days to look back at.",
+            },
+            "min_rate_of_change": {
+                "type": "number",
+                "default": 0.01,
+                "description": "Minimum Rate of Change",
+                "help": "Minimum rate of change to filter pairs.",
+            },
+            "max_rate_of_change": {
+                "type": "number",
+                "default": None,
+                "description": "Maximum Rate of Change",
+                "help": "Maximum rate of change to filter pairs.",
+            },
+            **IPairList.refresh_period_parameter()
+        }
+
     def filter_pairlist(self, pairlist: List[str], tickers: Tickers) -> List[str]:
         """
         Validate trading range
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new allowlist
         """
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/pairlistmanager.py` & `freqtrade-2023.6/freqtrade/plugins/pairlistmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protectionmanager.py` & `freqtrade-2023.6/freqtrade/plugins/protectionmanager.py`

 * *Files 0% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 from freqtrade.plugins.protections import IProtection
 from freqtrade.resolvers import ProtectionResolver
 
 
 logger = logging.getLogger(__name__)
 
 
-class ProtectionManager():
+class ProtectionManager:
 
     def __init__(self, config: Config, protections: List) -> None:
         self._config = config
 
         self._protection_handlers: List[IProtection] = []
         for protection_handler_config in protections:
             protection_handler = ProtectionResolver.load_protection(
```

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protections/cooldown_period.py` & `freqtrade-2023.6/freqtrade/plugins/protections/cooldown_period.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protections/iprotection.py` & `freqtrade-2023.6/freqtrade/plugins/protections/iprotection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protections/low_profit_pairs.py` & `freqtrade-2023.6/freqtrade/plugins/protections/low_profit_pairs.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protections/max_drawdown_protection.py` & `freqtrade-2023.6/freqtrade/plugins/protections/max_drawdown_protection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/plugins/protections/stoploss_guard.py` & `freqtrade-2023.6/freqtrade/plugins/protections/stoploss_guard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/__init__.py` & `freqtrade-2023.6/freqtrade/resolvers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/exchange_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/exchange_resolver.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 """
 This module loads custom exchanges
 """
 import logging
-from typing import Optional
+from inspect import isclass
+from typing import Any, Dict, List, Optional
 
 import freqtrade.exchange as exchanges
 from freqtrade.constants import Config, ExchangeConfig
 from freqtrade.exchange import MAP_EXCHANGE_CHILDCLASS, Exchange
 from freqtrade.resolvers import IResolver
 
 
@@ -68,7 +69,30 @@
             # Pass and raise ImportError instead
             pass
 
         raise ImportError(
             f"Impossible to load Exchange '{exchange_name}'. This class does not exist "
             "or contains Python code errors."
         )
+
+    @classmethod
+    def search_all_objects(cls, config: Config, enum_failed: bool,
+                           recursive: bool = False) -> List[Dict[str, Any]]:
+        """
+        Searches for valid objects
+        :param config: Config object
+        :param enum_failed: If True, will return None for modules which fail.
+            Otherwise, failing modules are skipped.
+        :param recursive: Recursively walk directory tree searching for strategies
+        :return: List of dicts containing 'name', 'class' and 'location' entries
+        """
+        result = []
+        for exchange_name in dir(exchanges):
+            exchange = getattr(exchanges, exchange_name)
+            if isclass(exchange) and issubclass(exchange, Exchange):
+                result.append({
+                    'name': exchange_name,
+                    'class': exchange,
+                    'location': exchange.__module__,
+                    'location_rel: ': exchange.__module__.replace('freqtrade.', ''),
+                })
+        return result
```

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/freqaimodel_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/freqaimodel_resolver.py`

 * *Files 5% similar despite different names*

```diff
@@ -30,15 +30,15 @@
 
     @staticmethod
     def load_freqaimodel(config: Config) -> IFreqaiModel:
         """
         Load the custom class from config parameter
         :param config: configuration dictionary
         """
-        disallowed_models = ["BaseRegressionModel", "BaseTensorFlowModel"]
+        disallowed_models = ["BaseRegressionModel"]
 
         freqaimodel_name = config.get("freqaimodel")
         if not freqaimodel_name:
             raise OperationalException(
                 "No freqaimodel set. Please use `--freqaimodel` to "
                 "specify the FreqaiModel class to use.\n"
             )
```

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/hyperopt_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/hyperopt_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/iresolver.py` & `freqtrade-2023.6/freqtrade/resolvers/iresolver.py`

 * *Files 0% similar despite different names*

```diff
@@ -37,15 +37,15 @@
     """
     This class contains all the logic to load custom classes
     """
     # Childclasses need to override this
     object_type: Type[Any]
     object_type_str: str
     user_subdir: Optional[str] = None
-    initial_search_path: Optional[Path]
+    initial_search_path: Optional[Path] = None
     # Optional config setting containing a path (strategy_path, freqaimodel_path)
     extra_path: Optional[str] = None
 
     @classmethod
     def build_search_paths(cls, config: Config, user_subdir: Optional[str] = None,
                            extra_dirs: List[str] = []) -> List[Path]:
```

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/pairlist_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/pairlist_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/protection_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/protection_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/resolvers/strategy_resolver.py` & `freqtrade-2023.6/freqtrade/resolvers/strategy_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_auth.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/api_auth.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_backtest.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/api_backtest.py`

 * *Files 8% similar despite different names*

```diff
@@ -12,22 +12,22 @@
 from freqtrade.data.btanalysis import get_backtest_resultlist, load_and_merge_backtest_result
 from freqtrade.enums import BacktestState
 from freqtrade.exceptions import DependencyException, OperationalException
 from freqtrade.exchange.common import remove_exchange_credentials
 from freqtrade.misc import deep_merge_dicts
 from freqtrade.rpc.api_server.api_schemas import (BacktestHistoryEntry, BacktestRequest,
                                                   BacktestResponse)
-from freqtrade.rpc.api_server.deps import get_config, is_webserver_mode
+from freqtrade.rpc.api_server.deps import get_config
 from freqtrade.rpc.api_server.webserver_bgwork import ApiBG
 from freqtrade.rpc.rpc import RPCException
 
 
 logger = logging.getLogger(__name__)
 
-# Private API, protected by authentication
+# Private API, protected by authentication and webserver_mode dependency
 router = APIRouter()
 
 
 def __run_backtest_bg(btconfig: Config):
     from freqtrade.optimize.optimize_reports import generate_backtest_stats, store_backtest_stats
     from freqtrade.resolvers import StrategyResolver
     asyncio.set_event_loop(asyncio.new_event_loop())
@@ -98,15 +98,15 @@
     finally:
         ApiBG.bgtask_running = False
 
 
 @router.post('/backtest', response_model=BacktestResponse, tags=['webserver', 'backtest'])
 async def api_start_backtest(
         bt_settings: BacktestRequest, background_tasks: BackgroundTasks,
-        config=Depends(get_config), ws_mode=Depends(is_webserver_mode)):
+        config=Depends(get_config)):
     ApiBG.bt['bt_error'] = None
     """Start backtesting if not done so already"""
     if ApiBG.bgtask_running:
         raise RPCException('Bot Background task already running')
 
     if ':' in bt_settings.strategy:
         raise HTTPException(status_code=500, detail="base64 encoded strategies are not allowed.")
@@ -139,15 +139,15 @@
         "progress": 0,
         "step": str(BacktestState.STARTUP),
         "status_msg": "Backtest started",
     }
 
 
 @router.get('/backtest', response_model=BacktestResponse, tags=['webserver', 'backtest'])
-def api_get_backtest(ws_mode=Depends(is_webserver_mode)):
+def api_get_backtest():
     """
     Get backtesting result.
     Returns Result after backtesting has been ran.
     """
     from freqtrade.persistence import LocalTrade
     if ApiBG.bgtask_running:
         return {
@@ -184,15 +184,15 @@
         "step": "finished",
         "progress": 1,
         "backtest_result": ApiBG.bt['bt'].results,
     }
 
 
 @router.delete('/backtest', response_model=BacktestResponse, tags=['webserver', 'backtest'])
-def api_delete_backtest(ws_mode=Depends(is_webserver_mode)):
+def api_delete_backtest():
     """Reset backtesting"""
     if ApiBG.bgtask_running:
         return {
             "status": "running",
             "running": True,
             "step": "",
             "progress": 0,
@@ -211,15 +211,15 @@
         "step": "",
         "progress": 0,
         "status_msg": "Backtest reset",
     }
 
 
 @router.get('/backtest/abort', response_model=BacktestResponse, tags=['webserver', 'backtest'])
-def api_backtest_abort(ws_mode=Depends(is_webserver_mode)):
+def api_backtest_abort():
     if not ApiBG.bgtask_running:
         return {
             "status": "not_running",
             "running": False,
             "step": "",
             "progress": 0,
             "status_msg": "Backtest ended",
@@ -232,23 +232,22 @@
         "progress": 0,
         "status_msg": "Backtest ended",
     }
 
 
 @router.get('/backtest/history', response_model=List[BacktestHistoryEntry],
             tags=['webserver', 'backtest'])
-def api_backtest_history(config=Depends(get_config), ws_mode=Depends(is_webserver_mode)):
+def api_backtest_history(config=Depends(get_config)):
     # Get backtest result history, read from metadata files
     return get_backtest_resultlist(config['user_data_dir'] / 'backtest_results')
 
 
 @router.get('/backtest/history/result', response_model=BacktestResponse,
             tags=['webserver', 'backtest'])
-def api_backtest_history_result(filename: str, strategy: str, config=Depends(get_config),
-                                ws_mode=Depends(is_webserver_mode)):
+def api_backtest_history_result(filename: str, strategy: str, config=Depends(get_config)):
     # Get backtest result history, read from metadata files
     fn = config['user_data_dir'] / 'backtest_results' / filename
     results: Dict[str, Any] = {
         'metadata': {},
         'strategy': {},
         'strategy_comparison': [],
     }
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_schemas.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/api_schemas.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,14 +1,21 @@
 from datetime import date, datetime
 from typing import Any, Dict, List, Optional, Union
 
 from pydantic import BaseModel
 
 from freqtrade.constants import DATETIME_PRINT_FORMAT, IntOrInf
-from freqtrade.enums import OrderTypeValues, SignalDirection, TradingMode
+from freqtrade.enums import MarginMode, OrderTypeValues, SignalDirection, TradingMode
+from freqtrade.types import ValidExchangesType
+
+
+class ExchangeModePayloadMixin(BaseModel):
+    trading_mode: Optional[TradingMode]
+    margin_mode: Optional[MarginMode]
+    exchange: Optional[str]
 
 
 class Ping(BaseModel):
     status: str
 
 
 class AccessToken(BaseModel):
@@ -23,14 +30,31 @@
     version: str
 
 
 class StatusMsg(BaseModel):
     status: str
 
 
+class BgJobStarted(StatusMsg):
+    job_id: str
+
+
+class BackgroundTaskStatus(BaseModel):
+    job_id: str
+    job_category: str
+    status: str
+    running: bool
+    progress: Optional[float]
+
+
+class BackgroundTaskResult(BaseModel):
+    error: Optional[str]
+    status: str
+
+
 class ResultMsg(BaseModel):
     result: str
 
 
 class Balance(BaseModel):
     currency: str
     free: float
@@ -372,14 +396,18 @@
 
 class WhitelistResponse(BaseModel):
     whitelist: List[str]
     length: int
     method: List[str]
 
 
+class WhitelistEvaluateResponse(BackgroundTaskResult):
+    result: Optional[WhitelistResponse]
+
+
 class DeleteTrade(BaseModel):
     cancel_order_count: int
     result: str
     result_msg: str
     trade_id: int
 
 
@@ -392,14 +420,35 @@
     __root__: Union[PlotConfig_, Dict]
 
 
 class StrategyListResponse(BaseModel):
     strategies: List[str]
 
 
+class ExchangeListResponse(BaseModel):
+    exchanges: List[ValidExchangesType]
+
+
+class PairListResponse(BaseModel):
+    name: str
+    description: str
+    is_pairlist_generator: bool
+    params: Dict[str, Any]
+
+
+class PairListsResponse(BaseModel):
+    pairlists: List[PairListResponse]
+
+
+class PairListsPayload(ExchangeModePayloadMixin, BaseModel):
+    pairlists: List[Dict[str, Any]]
+    blacklist: List[str]
+    stake_currency: str
+
+
 class FreqAIModelListResponse(BaseModel):
     freqaimodels: List[str]
 
 
 class StrategyResponse(BaseModel):
     strategy: str
     code: str
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_v1.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/api_v1.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,16 @@
 from freqtrade import __version__
 from freqtrade.data.history import get_datahandler
 from freqtrade.enums import CandleType, TradingMode
 from freqtrade.exceptions import OperationalException
 from freqtrade.rpc import RPC
 from freqtrade.rpc.api_server.api_schemas import (AvailablePairs, Balances, BlacklistPayload,
                                                   BlacklistResponse, Count, Daily,
-                                                  DeleteLockRequest, DeleteTrade, ForceEnterPayload,
+                                                  DeleteLockRequest, DeleteTrade,
+                                                  ExchangeListResponse, ForceEnterPayload,
                                                   ForceEnterResponse, ForceExitPayload,
                                                   FreqAIModelListResponse, Health, Locks, Logs,
                                                   OpenTradeSchema, PairHistory, PerformanceEntry,
                                                   Ping, PlotConfig, Profit, ResultMsg, ShowConfig,
                                                   Stats, StatusMsg, StrategyListResponse,
                                                   StrategyResponse, SysInfo, Version,
                                                   WhitelistResponse)
@@ -42,15 +43,17 @@
 # 2.22: Add FreqAI to backtesting
 # 2.23: Allow plot config request in webserver mode
 # 2.24: Add cancel_open_order endpoint
 # 2.25: Add several profit values to /status endpoint
 # 2.26: increase /balance output
 # 2.27: Add /trades/<id>/reload endpoint
 # 2.28: Switch reload endpoint to Post
-API_VERSION = 2.28
+# 2.29: Add /exchanges endpoint
+# 2.30: new /pairlists endpoint
+API_VERSION = 2.30
 
 # Public API, requires no auth.
 router_public = APIRouter()
 # Private API, protected by authentication
 router = APIRouter()
 
 
@@ -308,14 +311,23 @@
 
     return {
         'strategy': strategy_obj.get_strategy_name(),
         'code': strategy_obj.__source__,
     }
 
 
+@router.get('/exchanges', response_model=ExchangeListResponse, tags=[])
+def list_exchanges(config=Depends(get_config)):
+    from freqtrade.exchange import list_available_exchanges
+    exchanges = list_available_exchanges(config)
+    return {
+        'exchanges': exchanges,
+    }
+
+
 @router.get('/freqaimodels', response_model=FreqAIModelListResponse, tags=['freqai'])
 def list_freqaimodels(config=Depends(get_config)):
     from freqtrade.resolvers.freqaimodel_resolver import FreqaiModelResolver
     models = FreqaiModelResolver.search_all_objects(
         config, False)
     models = sorted(models, key=lambda x: x['name'])
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_ws.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/api_ws.py`

 * *Files 6% similar despite different names*

```diff
@@ -3,35 +3,43 @@
 from typing import Any, Dict
 
 from fastapi import APIRouter, Depends
 from fastapi.websockets import WebSocket
 from pydantic import ValidationError
 
 from freqtrade.enums import RPCMessageType, RPCRequestType
+from freqtrade.exceptions import FreqtradeException
 from freqtrade.rpc.api_server.api_auth import validate_ws_token
 from freqtrade.rpc.api_server.deps import get_message_stream, get_rpc
 from freqtrade.rpc.api_server.ws.channel import WebSocketChannel, create_channel
 from freqtrade.rpc.api_server.ws.message_stream import MessageStream
-from freqtrade.rpc.api_server.ws_schemas import (WSAnalyzedDFMessage, WSMessageSchema,
-                                                 WSRequestSchema, WSWhitelistMessage)
+from freqtrade.rpc.api_server.ws_schemas import (WSAnalyzedDFMessage, WSErrorMessage,
+                                                 WSMessageSchema, WSRequestSchema,
+                                                 WSWhitelistMessage)
 from freqtrade.rpc.rpc import RPC
 
 
 logger = logging.getLogger(__name__)
 
 # Private router, protected by API Key authentication
 router = APIRouter()
 
 
 async def channel_reader(channel: WebSocketChannel, rpc: RPC):
     """
     Iterate over the messages from the channel and process the request
     """
     async for message in channel:
-        await _process_consumer_request(message, channel, rpc)
+        try:
+            await _process_consumer_request(message, channel, rpc)
+        except FreqtradeException:
+            logger.exception(f"Error processing request from {channel}")
+            response = WSErrorMessage(data='Error processing request')
+
+            await channel.send(response.dict(exclude_none=True))
 
 
 async def channel_broadcaster(channel: WebSocketChannel, message_stream: MessageStream):
     """
     Iterate over messages in the message stream and send them
     """
     async for message, ts in message_stream:
@@ -58,41 +66,41 @@
     # Validate the request, makes sure it matches the schema
     try:
         websocket_request = WSRequestSchema.parse_obj(request)
     except ValidationError as e:
         logger.error(f"Invalid request from {channel}: {e}")
         return
 
-    type, data = websocket_request.type, websocket_request.data
+    type_, data = websocket_request.type, websocket_request.data
     response: WSMessageSchema
 
-    logger.debug(f"Request of type {type} from {channel}")
+    logger.debug(f"Request of type {type_} from {channel}")
 
     # If we have a request of type SUBSCRIBE, set the topics in this channel
-    if type == RPCRequestType.SUBSCRIBE:
+    if type_ == RPCRequestType.SUBSCRIBE:
         # If the request is empty, do nothing
         if not data:
             return
 
         # If all topics passed are a valid RPCMessageType, set subscriptions on channel
         if all([any(x.value == topic for x in RPCMessageType) for topic in data]):
             channel.set_subscriptions(data)
 
         # We don't send a response for subscriptions
         return
 
-    elif type == RPCRequestType.WHITELIST:
+    elif type_ == RPCRequestType.WHITELIST:
         # Get whitelist
         whitelist = rpc._ws_request_whitelist()
 
         # Format response
         response = WSWhitelistMessage(data=whitelist)
         await channel.send(response.dict(exclude_none=True))
 
-    elif type == RPCRequestType.ANALYZED_DF:
+    elif type_ == RPCRequestType.ANALYZED_DF:
         # Limit the amount of candles per dataframe to 'limit' or 1500
         limit = int(min(data.get('limit', 1500), 1500)) if data else None
         pair = data.get('pair', None) if data else None
 
         # For every pair in the generator, send a separate message
         for message in rpc._ws_request_analyzed_df(limit, pair):
             # Format response
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/deps.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/deps.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 from typing import Any, AsyncIterator, Dict, Optional
 from uuid import uuid4
 
-from fastapi import Depends
+from fastapi import Depends, HTTPException
 
+from freqtrade.constants import Config
 from freqtrade.enums import RunMode
 from freqtrade.persistence import Trade
 from freqtrade.persistence.models import _request_id_ctx_var
 from freqtrade.rpc.api_server.webserver_bgwork import ApiBG
 from freqtrade.rpc.rpc import RPC, RPCException
 
 from .webserver import ApiServer
@@ -39,23 +40,33 @@
     return ApiServer._config
 
 
 def get_api_config() -> Dict[str, Any]:
     return ApiServer._config['api_server']
 
 
+def _generate_exchange_key(config: Config) -> str:
+    """
+    Exchange key - used for caching the exchange object.
+    """
+    return f"{config['exchange']['name']}_{config.get('trading_mode', 'spot')}"
+
+
 def get_exchange(config=Depends(get_config)):
-    if not ApiBG.exchange:
+    exchange_key = _generate_exchange_key(config)
+    if not (exchange := ApiBG.exchanges.get(exchange_key)):
         from freqtrade.resolvers import ExchangeResolver
-        ApiBG.exchange = ExchangeResolver.load_exchange(
+        exchange = ExchangeResolver.load_exchange(
             config, load_leverage_tiers=False)
-    return ApiBG.exchange
+        ApiBG.exchanges[exchange_key] = exchange
+    return exchange
 
 
 def get_message_stream():
     return ApiServer._message_stream
 
 
 def is_webserver_mode(config=Depends(get_config)):
     if config['runmode'] != RunMode.WEBSERVER:
-        raise RPCException('Bot is not in the correct state')
+        raise HTTPException(status_code=503,
+                            detail='Bot is not in the correct state.')
     return None
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/fallback_file.html` & `freqtrade-2023.6/freqtrade/rpc/api_server/ui/fallback_file.html`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/favicon.ico` & `freqtrade-2023.6/freqtrade/rpc/api_server/ui/favicon.ico`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/uvicorn_threaded.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/uvicorn_threaded.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/web_ui.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/web_ui.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/webserver.py`

 * *Files 4% similar despite different names*

```diff
@@ -110,27 +110,34 @@
         return JSONResponse(
             status_code=502,
             content={'error': f"Error querying {request.url.path}: {exc.message}"}
         )
 
     def configure_app(self, app: FastAPI, config):
         from freqtrade.rpc.api_server.api_auth import http_basic_or_jwt_token, router_login
+        from freqtrade.rpc.api_server.api_background_tasks import router as api_bg_tasks
         from freqtrade.rpc.api_server.api_backtest import router as api_backtest
         from freqtrade.rpc.api_server.api_v1 import router as api_v1
         from freqtrade.rpc.api_server.api_v1 import router_public as api_v1_public
         from freqtrade.rpc.api_server.api_ws import router as ws_router
+        from freqtrade.rpc.api_server.deps import is_webserver_mode
         from freqtrade.rpc.api_server.web_ui import router_ui
 
         app.include_router(api_v1_public, prefix="/api/v1")
 
         app.include_router(api_v1, prefix="/api/v1",
                            dependencies=[Depends(http_basic_or_jwt_token)],
                            )
         app.include_router(api_backtest, prefix="/api/v1",
-                           dependencies=[Depends(http_basic_or_jwt_token)],
+                           dependencies=[Depends(http_basic_or_jwt_token),
+                                         Depends(is_webserver_mode)],
+                           )
+        app.include_router(api_bg_tasks, prefix="/api/v1",
+                           dependencies=[Depends(http_basic_or_jwt_token),
+                                         Depends(is_webserver_mode)],
                            )
         app.include_router(ws_router, prefix="/api/v1")
         app.include_router(router_login, prefix="/api/v1", tags=["auth"])
         # UI Router MUST be last!
         app.include_router(router_ui, prefix='')
 
         app.add_middleware(
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/channel.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/ws/channel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/message_stream.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/ws/message_stream.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/proxy.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/ws/proxy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/serializer.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/ws/serializer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws_schemas.py` & `freqtrade-2023.6/freqtrade/rpc/api_server/ws_schemas.py`

 * *Files 9% similar despite different names*

```diff
@@ -62,8 +62,13 @@
         key: PairWithTimeframe
         df: DataFrame
         la: datetime
 
     type: RPCMessageType = RPCMessageType.ANALYZED_DF
     data: AnalyzedDFData
 
+
+class WSErrorMessage(WSMessageSchema):
+    type: RPCMessageType = RPCMessageType.EXCEPTION
+    data: str
+
 # --------------------------------------------------------------------------
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/discord.py` & `freqtrade-2023.6/freqtrade/rpc/discord.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/external_message_consumer.py` & `freqtrade-2023.6/freqtrade/rpc/external_message_consumer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/fiat_convert.py` & `freqtrade-2023.6/freqtrade/rpc/fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/rpc.py` & `freqtrade-2023.6/freqtrade/rpc/rpc.py`

 * *Files 0% similar despite different names*

```diff
@@ -751,29 +751,32 @@
         if not trade:
             raise RPCException(f"Could not find trade with id {trade_id}.")
 
         self._freqtrade.handle_onexchange_order(trade)
         return {'status': 'Reloaded from orders from exchange'}
 
     def __exec_force_exit(self, trade: Trade, ordertype: Optional[str],
-                          amount: Optional[float] = None) -> None:
+                          amount: Optional[float] = None) -> bool:
         # Check if there is there is an open order
         fully_canceled = False
         if trade.open_order_id:
             order = self._freqtrade.exchange.fetch_order(trade.open_order_id, trade.pair)
 
             if order['side'] == trade.entry_side:
                 fully_canceled = self._freqtrade.handle_cancel_enter(
                     trade, order, CANCEL_REASON['FORCE_EXIT'])
 
             if order['side'] == trade.exit_side:
                 # Cancel order - so it is placed anew with a fresh price.
                 self._freqtrade.handle_cancel_exit(trade, order, CANCEL_REASON['FORCE_EXIT'])
 
         if not fully_canceled:
+            if trade.open_order_id is not None:
+                # Order cancellation failed, so we can't exit.
+                return False
             # Get current rate and execute sell
             current_rate = self._freqtrade.exchange.get_rate(
                 trade.pair, side='exit', is_short=trade.is_short, refresh=True)
             exit_check = ExitCheckTuple(exit_type=ExitType.FORCE_EXIT)
             order_type = ordertype or self._freqtrade.strategy.order_types.get(
                 "force_exit", self._freqtrade.strategy.order_types["exit"])
             sub_amount: Optional[float] = None
@@ -786,45 +789,50 @@
                     raise RPCException(f'Remaining amount of {remaining} would be too small.')
                 sub_amount = amount
 
             self._freqtrade.execute_trade_exit(
                 trade, current_rate, exit_check, ordertype=order_type,
                 sub_trade_amt=sub_amount)
 
+            return True
+        return False
+
     def _rpc_force_exit(self, trade_id: str, ordertype: Optional[str] = None, *,
                         amount: Optional[float] = None) -> Dict[str, str]:
         """
         Handler for forceexit <id>.
         Sells the given trade at current price
         """
 
         if self._freqtrade.state != State.RUNNING:
             raise RPCException('trader is not running')
 
         with self._freqtrade._exit_lock:
             if trade_id == 'all':
-                # Execute sell for all open orders
+                # Execute exit for all open orders
                 for trade in Trade.get_open_trades():
                     self.__exec_force_exit(trade, ordertype)
                 Trade.commit()
                 self._freqtrade.wallets.update()
-                return {'result': 'Created sell orders for all open trades.'}
+                return {'result': 'Created exit orders for all open trades.'}
 
             # Query for trade
             trade = Trade.get_trades(
                 trade_filter=[Trade.id == trade_id, Trade.is_open.is_(True), ]
             ).first()
             if not trade:
                 logger.warning('force_exit: Invalid argument received')
                 raise RPCException('invalid argument')
 
-            self.__exec_force_exit(trade, ordertype, amount)
+            result = self.__exec_force_exit(trade, ordertype, amount)
             Trade.commit()
             self._freqtrade.wallets.update()
-            return {'result': f'Created sell order for trade {trade_id}.'}
+            if not result:
+                raise RPCException('Failed to exit trade.')
+            return {'result': f'Created exit order for trade {trade_id}.'}
 
     def _force_entry_validations(self, pair: str, order_side: SignalDirection):
         if not self._freqtrade.config.get('force_entry_enable', False):
             raise RPCException('Force_entry not enabled.')
 
         if self._freqtrade.state != State.RUNNING:
             raise RPCException('trader is not running')
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/rpc_manager.py` & `freqtrade-2023.6/freqtrade/rpc/rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/rpc_types.py` & `freqtrade-2023.6/freqtrade/rpc/rpc_types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/telegram.py` & `freqtrade-2023.6/freqtrade/rpc/telegram.py`

 * *Files 1% similar despite different names*

```diff
@@ -530,18 +530,18 @@
 
             cur_entry_amount = order["filled"] or order["amount"]
             cur_entry_average = order["safe_price"]
             lines.append("  ")
             if order_nr == 1:
                 lines.append(f"*{wording} #{order_nr}:*")
                 lines.append(
-                    f"*Amount:* {cur_entry_amount} "
+                    f"*Amount:* {cur_entry_amount:.8g} "
                     f"({round_coin_value(order['cost'], quote_currency)})"
                 )
-                lines.append(f"*Average Price:* {cur_entry_average}")
+                lines.append(f"*Average Price:* {cur_entry_average:.8g}")
             else:
                 sum_stake = 0
                 sum_amount = 0
                 for y in range(order_nr):
                     loc_order = filled_orders[y]
                     if loc_order['is_open'] is True:
                         # Skip open orders (e.g. stop orders)
@@ -556,17 +556,17 @@
                 if prev_avg_price:
                     minus_on_entry = (cur_entry_average - prev_avg_price) / prev_avg_price
 
                 lines.append(f"*{wording} #{order_nr}:* at {minus_on_entry:.2%} avg Profit")
                 if is_open:
                     lines.append("({})".format(dt_humanize(order["order_filled_date"],
                                                            granularity=["day", "hour", "minute"])))
-                lines.append(f"*Amount:* {cur_entry_amount} "
+                lines.append(f"*Amount:* {cur_entry_amount:.8g} "
                              f"({round_coin_value(order['cost'], quote_currency)})")
-                lines.append(f"*Average {wording} Price:* {cur_entry_average} "
+                lines.append(f"*Average {wording} Price:* {cur_entry_average:.8g} "
                              f"({price_to_1st_entry:.2%} from 1st entry Rate)")
                 lines.append(f"*Order filled:* {order['order_filled_date']}")
 
             lines_detail.append("\n".join(lines))
 
         return lines_detail
 
@@ -629,19 +629,19 @@
                 max_buy_str = (f"/{max_entries + 1}" if (max_entries > 0) else "")
                 lines.extend([
                     "*Number of Entries:* `{num_entries}" + max_buy_str + "`",
                     "*Number of Exits:* `{num_exits}`"
                 ])
 
             lines.extend([
-                "*Open Rate:* `{open_rate:.8f}`",
-                "*Close Rate:* `{close_rate:.8f}`" if r['close_rate'] else "",
+                "*Open Rate:* `{open_rate:.8g}`",
+                "*Close Rate:* `{close_rate:.8g}`" if r['close_rate'] else "",
                 "*Open Date:* `{open_date}`",
                 "*Close Date:* `{close_date}`" if r['close_date'] else "",
-                " \n*Current Rate:* `{current_rate:.8f}`" if r['is_open'] else "",
+                " \n*Current Rate:* `{current_rate:.8g}`" if r['is_open'] else "",
                 ("*Unrealized Profit:* " if r['is_open'] else "*Close Profit: *")
                 + "`{profit_ratio:.2%}` `({profit_abs_r})`",
             ])
 
             if r['is_open']:
                 if r.get('realized_profit'):
                     lines.extend([
@@ -654,17 +654,17 @@
                 if (r['stop_loss_abs'] != r['initial_stop_loss_abs']
                         and r['initial_stop_loss_ratio'] is not None):
                     # Adding initial stoploss only if it is different from stoploss
                     lines.append("*Initial Stoploss:* `{initial_stop_loss_abs:.8f}` "
                                  "`({initial_stop_loss_ratio:.2%})`")
 
                 # Adding stoploss and stoploss percentage only if it is not None
-                lines.append("*Stoploss:* `{stop_loss_abs:.8f}` " +
+                lines.append("*Stoploss:* `{stop_loss_abs:.8g}` " +
                              ("`({stop_loss_ratio:.2%})`" if r['stop_loss_ratio'] else ""))
-                lines.append("*Stoploss distance:* `{stoploss_current_dist:.8f}` "
+                lines.append("*Stoploss distance:* `{stoploss_current_dist:.8g}` "
                              "`({stoploss_current_dist_ratio:.2%})`")
                 if r['open_order']:
                     lines.append(
                         "*Open Order:* `{open_order}`"
                         + "- `{exit_order_status}`" if r['exit_order_status'] else "")
 
             lines_detail = self._prepare_order_details(
@@ -1110,15 +1110,17 @@
             buttons_aligned.append([InlineKeyboardButton(
                 text='Cancel', callback_data='force_exit__cancel')])
             await self._send_msg(msg="Which trade?", keyboard=buttons_aligned)
 
     async def _force_exit_action(self, trade_id):
         if trade_id != 'cancel':
             try:
-                self._rpc._rpc_force_exit(trade_id)
+                loop = asyncio.get_running_loop()
+                # Workaround to avoid nested loops
+                await loop.run_in_executor(None, self._rpc._rpc_force_exit, trade_id)
             except RPCException as e:
                 await self._send_msg(str(e))
 
     async def _force_exit_inline(self, update: Update, _: CallbackContext) -> None:
         if update.callback_query:
             query = update.callback_query
             if query.data and '__' in query.data:
@@ -1136,15 +1138,19 @@
                     await self._force_exit_action(trade_id)
                 else:
                     await query.edit_message_text(text=f"Trade {trade_id} not found.")
 
     async def _force_enter_action(self, pair, price: Optional[float], order_side: SignalDirection):
         if pair != 'cancel':
             try:
-                self._rpc._rpc_force_entry(pair, price, order_side=order_side)
+                def _force_enter():
+                    self._rpc._rpc_force_entry(pair, price, order_side=order_side)
+                loop = asyncio.get_running_loop()
+                # Workaround to avoid nested loops
+                await loop.run_in_executor(None, _force_enter)
             except RPCException as e:
                 logger.exception("Forcebuy error!")
                 await self._send_msg(str(e), ParseMode.HTML)
 
     async def _force_enter_inline(self, update: Update, _: CallbackContext) -> None:
         if update.callback_query:
             query = update.callback_query
```

### Comparing `freqtrade-2023.5.1/freqtrade/rpc/webhook.py` & `freqtrade-2023.6/freqtrade/rpc/webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/__init__.py` & `freqtrade-2023.6/freqtrade/strategy/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/hyper.py` & `freqtrade-2023.6/freqtrade/strategy/hyper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/informative_decorator.py` & `freqtrade-2023.6/freqtrade/strategy/informative_decorator.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/interface.py` & `freqtrade-2023.6/freqtrade/strategy/interface.py`

 * *Files 0% similar despite different names*

```diff
@@ -44,15 +44,15 @@
     # Version 1 is the initial interface without metadata dict - deprecated and no longer supported.
     # Version 2 populate_* include metadata dict
     # Version 3 - First version with short and leverage support
     INTERFACE_VERSION: int = 3
 
     _ft_params_from_file: Dict
     # associated minimal roi
-    minimal_roi: Dict = {"0": 10.0}
+    minimal_roi: Dict = {}
 
     # associated stoploss
     stoploss: float
 
     # max open trades for the strategy
     max_open_trades:  IntOrInf
 
@@ -164,15 +164,15 @@
                     "Downloading all training data for all pairs in whitelist and "
                     "corr_pairlist, this may take a while if the data is not "
                     "already on disk."
                 )
                 download_all_data_for_training(self.dp, self.config)
         else:
             # Gracious failures if freqAI is disabled but "start" is called.
-            class DummyClass():
+            class DummyClass:
                 def start(self, *args, **kwargs):
                     raise OperationalException(
                         'freqAI is not enabled. '
                         'Please enable it in your config to use this strategy.')
 
                 def shutdown(self, *args, **kwargs):
                     pass
@@ -1081,36 +1081,34 @@
         :param high: Only used during backtesting, to simulate (short)stoploss/(long)ROI
         :param force_stoploss: Externally provided stoploss
         :return: List of exit reasons - or empty list.
         """
         exits: List[ExitCheckTuple] = []
         current_rate = rate
         current_profit = trade.calc_profit_ratio(current_rate)
+        current_profit_best = current_profit
+        if low is not None or high is not None:
+            # Set current rate to high for backtesting ROI exits
+            current_rate_best = (low if trade.is_short else high) or rate
+            current_profit_best = trade.calc_profit_ratio(current_rate_best)
 
         trade.adjust_min_max_rates(high or current_rate, low or current_rate)
 
         stoplossflag = self.ft_stoploss_reached(current_rate=current_rate, trade=trade,
                                                 current_time=current_time,
                                                 current_profit=current_profit,
                                                 force_stoploss=force_stoploss, low=low, high=high)
 
-        # Set current rate to high for backtesting exits
-        current_rate = (low if trade.is_short else high) or rate
-        current_profit = trade.calc_profit_ratio(current_rate)
-
         # if enter signal and ignore_roi is set, we don't need to evaluate min_roi.
         roi_reached = (not (enter and self.ignore_roi_if_entry_signal)
-                       and self.min_roi_reached(trade=trade, current_profit=current_profit,
+                       and self.min_roi_reached(trade=trade, current_profit=current_profit_best,
                                                 current_time=current_time))
 
         exit_signal = ExitType.NONE
         custom_reason = ''
-        # use provided rate in backtesting, not high/low.
-        current_rate = rate
-        current_profit = trade.calc_profit_ratio(current_rate)
 
         if self.use_exit_signal:
             if exit_ and not enter:
                 exit_signal = ExitType.EXIT_SIGNAL
             else:
                 reason_cust = strategy_safe_wrapper(self.custom_exit, default_retval=False)(
                     pair=trade.pair, trade=trade, current_time=current_time,
@@ -1261,15 +1259,15 @@
     def min_roi_reached_entry(self, trade_dur: int) -> Tuple[Optional[int], Optional[float]]:
         """
         Based on trade duration defines the ROI entry that may have been reached.
         :param trade_dur: trade duration in minutes
         :return: minimal ROI entry value or None if none proper ROI entry was found.
         """
         # Get highest entry in ROI dict where key <= trade-duration
-        roi_list = list(filter(lambda x: x <= trade_dur, self.minimal_roi.keys()))
+        roi_list = [x for x in self.minimal_roi.keys() if x <= trade_dur]
         if not roi_list:
             return None, None
         roi_entry = max(roi_list)
         return roi_entry, self.minimal_roi[roi_entry]
 
     def min_roi_reached(self, trade: Trade, current_profit: float, current_time: datetime) -> bool:
         """
@@ -1298,15 +1296,15 @@
         if timeout is not None:
             timeout_unit = self.config.get('unfilledtimeout', {}).get('unit', 'minutes')
             timeout_kwargs = {timeout_unit: -timeout}
             timeout_threshold = current_time + timedelta(**timeout_kwargs)
             timedout = (order.status == 'open' and order.order_date_utc < timeout_threshold)
             if timedout:
                 return True
-        time_method = (self.check_exit_timeout if order.side == trade.exit_side
+        time_method = (self.check_exit_timeout if order.ft_order_side == trade.exit_side
                        else self.check_entry_timeout)
 
         return strategy_safe_wrapper(time_method,
                                      default_retval=False)(
                                         pair=trade.pair, trade=trade, order=order,
                                         current_time=current_time)
```

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/parameters.py` & `freqtrade-2023.6/freqtrade/strategy/parameters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/strategy_helper.py` & `freqtrade-2023.6/freqtrade/strategy/strategy_helper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/strategy_wrapper.py` & `freqtrade-2023.6/freqtrade/strategy/strategy_wrapper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/strategy/strategyupdater.py` & `freqtrade-2023.6/freqtrade/strategy/strategyupdater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleHybridStrategy.py` & `freqtrade-2023.6/freqtrade/templates/FreqaiExampleHybridStrategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleStrategy.py` & `freqtrade-2023.6/freqtrade/templates/FreqaiExampleStrategy.py`

 * *Files 1% similar despite different names*

```diff
@@ -228,15 +228,15 @@
 
         return dataframe
 
     def populate_indicators(self, dataframe: DataFrame, metadata: dict) -> DataFrame:
 
         # All indicators must be populated by feature_engineering_*() functions
 
-        # the model will return all labels created by user in `feature_engineering_*`
+        # the model will return all labels created by user in `set_freqai_targets()`
         # (& appended targets), an indication of whether or not the prediction should be accepted,
         # the target mean/std values for each of the labels created by user in
         # `set_freqai_targets()` for each training period.
 
         dataframe = self.freqai.start(dataframe, metadata, self)
 
         for val in self.std_dev_multiplier_buy.range:
```

### Comparing `freqtrade-2023.5.1/freqtrade/templates/base_config.json.j2` & `freqtrade-2023.6/freqtrade/templates/base_config.json.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/base_strategy.py.j2` & `freqtrade-2023.6/freqtrade/templates/base_strategy.py.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/sample_hyperopt_loss.py` & `freqtrade-2023.6/freqtrade/templates/sample_hyperopt_loss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/sample_strategy.py` & `freqtrade-2023.6/freqtrade/templates/sample_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/strategy_analysis_example.ipynb` & `freqtrade-2023.6/freqtrade/templates/strategy_analysis_example.ipynb`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_full.j2` & `freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/indicators_full.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2` & `freqtrade-2023.6/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/util/binance_mig.py` & `freqtrade-2023.6/freqtrade/util/binance_mig.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 import logging
 
 from packaging import version
 from sqlalchemy import select
 
-from freqtrade.constants import Config
+from freqtrade.constants import DOCS_LINK, Config
 from freqtrade.enums.tradingmode import TradingMode
 from freqtrade.exceptions import OperationalException
 from freqtrade.persistence.pairlock import PairLock
 from freqtrade.persistence.trade_model import Trade
 
 
 logger = logging.getLogger(__name__)
@@ -21,15 +21,15 @@
     ):
         # only act on new futures
         return
     import ccxt
     if version.parse("2.6.26") > version.parse(ccxt.__version__):
         raise OperationalException(
             "Please follow the update instructions in the docs "
-            "(https://www.freqtrade.io/en/latest/updating/) to install a compatible ccxt version.")
+            f"({DOCS_LINK}/updating/) to install a compatible ccxt version.")
     _migrate_binance_futures_db(config)
     migrate_binance_futures_data(config)
 
 
 def _migrate_binance_futures_db(config: Config):
     logger.warning('Migrating binance futures pairs in database.')
     trades = Trade.get_trades([Trade.exchange == 'binance', Trade.trading_mode == 'FUTURES']).all()
```

### Comparing `freqtrade-2023.5.1/freqtrade/util/datetime_helpers.py` & `freqtrade-2023.6/freqtrade/util/datetime_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/util/periodic_cache.py` & `freqtrade-2023.6/freqtrade/util/periodic_cache.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/vendor/qtpylib/indicators.py` & `freqtrade-2023.6/freqtrade/vendor/qtpylib/indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/wallets.py` & `freqtrade-2023.6/freqtrade/wallets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade/worker.py` & `freqtrade-2023.6/freqtrade/worker.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/freqtrade.egg-info/PKG-INFO` & `freqtrade-2023.6/freqtrade.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.5.1
+Version: 2023.6
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
```

### Comparing `freqtrade-2023.5.1/freqtrade.egg-info/SOURCES.txt` & `freqtrade-2023.6/freqtrade.egg-info/SOURCES.txt`

 * *Files 4% similar despite different names*

```diff
@@ -106,15 +106,14 @@
 freqtrade/freqai/RL/BaseReinforcementLearningModel.py
 freqtrade/freqai/RL/__init__.py
 freqtrade/freqai/base_models/BaseClassifierModel.py
 freqtrade/freqai/base_models/BasePyTorchClassifier.py
 freqtrade/freqai/base_models/BasePyTorchModel.py
 freqtrade/freqai/base_models/BasePyTorchRegressor.py
 freqtrade/freqai/base_models/BaseRegressionModel.py
-freqtrade/freqai/base_models/BaseTensorFlowModel.py
 freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
 freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
 freqtrade/freqai/prediction_models/CatboostClassifier.py
 freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
 freqtrade/freqai/prediction_models/CatboostRegressor.py
 freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
 freqtrade/freqai/prediction_models/LightGBMClassifier.py
@@ -143,39 +142,45 @@
 freqtrade/freqai/torch/PyTorchTransformerModel.py
 freqtrade/freqai/torch/__init__.py
 freqtrade/freqai/torch/datasets.py
 freqtrade/leverage/__init__.py
 freqtrade/leverage/interest.py
 freqtrade/loggers/__init__.py
 freqtrade/loggers/buffering_handler.py
+freqtrade/loggers/set_log_levels.py
 freqtrade/loggers/std_err_stream_handler.py
 freqtrade/mixins/__init__.py
 freqtrade/mixins/logging_mixin.py
 freqtrade/optimize/__init__.py
 freqtrade/optimize/backtest_caching.py
 freqtrade/optimize/backtesting.py
 freqtrade/optimize/bt_progress.py
 freqtrade/optimize/edge_cli.py
 freqtrade/optimize/hyperopt.py
 freqtrade/optimize/hyperopt_auto.py
 freqtrade/optimize/hyperopt_epoch_filters.py
 freqtrade/optimize/hyperopt_interface.py
 freqtrade/optimize/hyperopt_loss_interface.py
 freqtrade/optimize/hyperopt_tools.py
-freqtrade/optimize/optimize_reports.py
+freqtrade/optimize/lookahead_analysis.py
+freqtrade/optimize/lookahead_analysis_helpers.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
 freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
+freqtrade/optimize/optimize_reports/__init__.py
+freqtrade/optimize/optimize_reports/bt_output.py
+freqtrade/optimize/optimize_reports/bt_storage.py
+freqtrade/optimize/optimize_reports/optimize_reports.py
 freqtrade/optimize/space/__init__.py
 freqtrade/optimize/space/decimalspace.py
 freqtrade/persistence/__init__.py
 freqtrade/persistence/base.py
 freqtrade/persistence/key_value_store.py
 freqtrade/persistence/migrations.py
 freqtrade/persistence/models.py
@@ -224,14 +229,15 @@
 freqtrade/rpc/rpc.py
 freqtrade/rpc/rpc_manager.py
 freqtrade/rpc/rpc_types.py
 freqtrade/rpc/telegram.py
 freqtrade/rpc/webhook.py
 freqtrade/rpc/api_server/__init__.py
 freqtrade/rpc/api_server/api_auth.py
+freqtrade/rpc/api_server/api_background_tasks.py
 freqtrade/rpc/api_server/api_backtest.py
 freqtrade/rpc/api_server/api_schemas.py
 freqtrade/rpc/api_server/api_v1.py
 freqtrade/rpc/api_server/api_ws.py
 freqtrade/rpc/api_server/deps.py
 freqtrade/rpc/api_server/uvicorn_threaded.py
 freqtrade/rpc/api_server/web_ui.py
@@ -275,14 +281,16 @@
 freqtrade/templates/subtemplates/exchange_bittrex.j2
 freqtrade/templates/subtemplates/exchange_gateio.j2
 freqtrade/templates/subtemplates/exchange_generic.j2
 freqtrade/templates/subtemplates/exchange_huobi.j2
 freqtrade/templates/subtemplates/exchange_kraken.j2
 freqtrade/templates/subtemplates/exchange_kucoin.j2
 freqtrade/templates/subtemplates/exchange_okex.j2
+freqtrade/types/__init__.py
+freqtrade/types/valid_exchanges_type.py
 freqtrade/util/__init__.py
 freqtrade/util/binance_mig.py
 freqtrade/util/datetime_helpers.py
 freqtrade/util/ft_precise.py
 freqtrade/util/gc_setup.py
 freqtrade/util/periodic_cache.py
 freqtrade/vendor/__init__.py
@@ -295,14 +303,15 @@
 tests/test_arguments.py
 tests/test_binance_mig.py
 tests/test_configuration.py
 tests/test_directory_operations.py
 tests/test_freqtradebot.py
 tests/test_indicators.py
 tests/test_integration.py
+tests/test_log_setup.py
 tests/test_main.py
 tests/test_misc.py
 tests/test_plotting.py
 tests/test_strategy_updater.py
 tests/test_talib.py
 tests/test_timerange.py
 tests/test_wallets.py
@@ -311,14 +320,15 @@
 tests/commands/test_build_config.py
 tests/commands/test_commands.py
 tests/data/__init__.py
 tests/data/test_btanalysis.py
 tests/data/test_converter.py
 tests/data/test_datahandler.py
 tests/data/test_dataprovider.py
+tests/data/test_download_data.py
 tests/data/test_entryexitanalysis.py
 tests/data/test_history.py
 tests/edge/__init__.py
 tests/edge/test_edge.py
 tests/exchange/__init__.py
 tests/exchange/test_binance.py
 tests/exchange/test_bitpanda.py
@@ -336,14 +346,15 @@
 tests/optimize/test_backtest_detail.py
 tests/optimize/test_backtesting.py
 tests/optimize/test_backtesting_adjust_position.py
 tests/optimize/test_edge_cli.py
 tests/optimize/test_hyperopt.py
 tests/optimize/test_hyperopt_tools.py
 tests/optimize/test_hyperoptloss.py
+tests/optimize/test_lookahead_analysis.py
 tests/optimize/test_optimize_reports.py
 tests/persistence/__init__.py
 tests/persistence/test_key_value_store.py
 tests/persistence/test_migrations.py
 tests/persistence/test_persistence.py
 tests/persistence/test_trade_fromjson.py
 tests/plugins/__init__.py
```

### Comparing `freqtrade-2023.5.1/freqtrade.egg-info/requires.txt` & `freqtrade-2023.6/freqtrade.egg-info/requires.txt`

 * *Files 13% similar despite different names*

```diff
@@ -31,15 +31,15 @@
 aiofiles
 schedule
 websockets
 janus
 ast-comments
 aiohttp
 cryptography
-httpx
+httpx>=0.24.1
 python-dateutil
 packaging
 
 [:platform_machine != "armv7l"]
 pyarrow
 
 [all]
@@ -61,23 +61,25 @@
 types-tabulate
 types-python-dateutil
 jupyter
 nbstripout
 ipykernel
 nbconvert
 scipy
-scikit-learn
+scikit-learn<=1.1.3
 scikit-optimize>=0.7.0
 filelock
 tables
 blosc
+scikit-learn
 joblib
 lightgbm
 xgboost
 tensorboard
+datasieve>=0.1.5
 torch
 gymnasium
 stable-baselines3
 sb3-contrib
 tqdm
 
 [all:platform_machine != "aarch64"]
@@ -102,23 +104,25 @@
 types-tabulate
 types-python-dateutil
 jupyter
 nbstripout
 ipykernel
 nbconvert
 scipy
-scikit-learn
+scikit-learn<=1.1.3
 scikit-optimize>=0.7.0
 filelock
 tables
 blosc
+scikit-learn
 joblib
 lightgbm
 xgboost
 tensorboard
+datasieve>=0.1.5
 torch
 gymnasium
 stable-baselines3
 sb3-contrib
 tqdm
 
 [dev:platform_machine != "aarch64"]
@@ -126,14 +130,15 @@
 
 [freqai]
 scikit-learn
 joblib
 lightgbm
 xgboost
 tensorboard
+datasieve>=0.1.5
 
 [freqai:platform_machine != "aarch64"]
 catboost
 
 [freqai_rl]
 torch
 gymnasium
@@ -143,15 +148,15 @@
 
 [hdf5]
 tables
 blosc
 
 [hyperopt]
 scipy
-scikit-learn
+scikit-learn<=1.1.3
 scikit-optimize>=0.7.0
 filelock
 
 [jupyter]
 jupyter
 nbstripout
 ipykernel
```

### Comparing `freqtrade-2023.5.1/pyproject.toml` & `freqtrade-2023.6/pyproject.toml`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/setup.cfg` & `freqtrade-2023.6/setup.cfg`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/setup.py` & `freqtrade-2023.6/setup.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,26 +1,27 @@
 from setuptools import setup
 
 
 # Requirements used for submodules
 plot = ['plotly>=4.0']
 hyperopt = [
     'scipy',
-    'scikit-learn',
+    'scikit-learn<=1.1.3',
     'scikit-optimize>=0.7.0',
     'filelock',
 ]
 
 freqai = [
     'scikit-learn',
     'joblib',
     'catboost; platform_machine != "aarch64"',
     'lightgbm',
     'xgboost',
-    'tensorboard'
+    'tensorboard',
+    'datasieve>=0.1.5'
 ]
 
 freqai_rl = [
     'torch',
     'gymnasium',
     'stable-baselines3',
     'sb3-contrib',
@@ -103,15 +104,15 @@
         'aiofiles',
         'schedule',
         'websockets',
         'janus',
         'ast-comments',
         'aiohttp',
         'cryptography',
-        'httpx',
+        'httpx>=0.24.1',
         'python-dateutil',
         'packaging',
     ],
     extras_require={
         'dev': all_extra,
         'plot': plot,
         'jupyter': jupyter,
```

### Comparing `freqtrade-2023.5.1/tests/commands/test_build_config.py` & `freqtrade-2023.6/tests/commands/test_build_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/commands/test_commands.py` & `freqtrade-2023.6/tests/commands/test_commands.py`

 * *Files 1% similar despite different names*

```diff
@@ -637,15 +637,15 @@
     assert x == 'http://download1.zip'
 
     with pytest.raises(ValueError, match="UI-Version not found."):
         x, last_version = get_ui_download_url('0.0.3')
 
 
 def test_download_data_keyboardInterrupt(mocker, markets):
-    dl_mock = mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+    dl_mock = mocker.patch('freqtrade.commands.data_commands.download_data_main',
                            MagicMock(side_effect=KeyboardInterrupt))
     patch_exchange(mocker)
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
     args = [
         "download-data",
         "--exchange", "binance",
         "--pairs", "ETH/BTC", "XRP/BTC",
@@ -656,15 +656,15 @@
 
         start_download_data(pargs)
 
     assert dl_mock.call_count == 1
 
 
 def test_download_data_timerange(mocker, markets):
-    dl_mock = mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+    dl_mock = mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_ohlcv_data',
                            MagicMock(return_value=["ETH/BTC", "XRP/BTC"]))
     patch_exchange(mocker)
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
     args = [
         "download-data",
         "--exchange", "binance",
         "--pairs", "ETH/BTC", "XRP/BTC",
@@ -704,47 +704,47 @@
     start_download_data(pargs)
     assert dl_mock.call_count == 1
 
     assert dl_mock.call_args_list[0][1]['timerange'].startts == int(dt_utc(2020, 1, 1).timestamp())
 
 
 def test_download_data_no_markets(mocker, caplog):
-    dl_mock = mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+    dl_mock = mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_ohlcv_data',
                            MagicMock(return_value=["ETH/BTC", "XRP/BTC"]))
     patch_exchange(mocker, id='binance')
-    mocker.patch(f'{EXMS}.markets', PropertyMock(return_value={}))
+    mocker.patch(f'{EXMS}.get_markets', return_value={})
     args = [
         "download-data",
         "--exchange", "binance",
         "--pairs", "ETH/BTC", "XRP/BTC",
         "--days", "20"
     ]
     start_download_data(get_args(args))
     assert dl_mock.call_args[1]['timerange'].starttype == "date"
     assert log_has("Pairs [ETH/BTC,XRP/BTC] not available on exchange Binance.", caplog)
 
 
-def test_download_data_no_exchange(mocker, caplog):
-    mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+def test_download_data_no_exchange(mocker):
+    mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_ohlcv_data',
                  MagicMock(return_value=["ETH/BTC", "XRP/BTC"]))
     patch_exchange(mocker)
-    mocker.patch(f'{EXMS}.markets', PropertyMock(return_value={}))
+    mocker.patch(f'{EXMS}.get_markets', return_value={})
     args = [
         "download-data",
     ]
     pargs = get_args(args)
     pargs['config'] = None
     with pytest.raises(OperationalException,
                        match=r"This command requires a configured exchange.*"):
         start_download_data(pargs)
 
 
 def test_download_data_no_pairs(mocker):
 
-    mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+    mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_ohlcv_data',
                  MagicMock(return_value=["ETH/BTC", "XRP/BTC"]))
     patch_exchange(mocker)
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value={}))
     args = [
         "download-data",
         "--exchange",
         "binance",
@@ -754,15 +754,15 @@
     with pytest.raises(OperationalException,
                        match=r"Downloading data requires a list of pairs\..*"):
         start_download_data(pargs)
 
 
 def test_download_data_all_pairs(mocker, markets):
 
-    dl_mock = mocker.patch('freqtrade.commands.data_commands.refresh_backtest_ohlcv_data',
+    dl_mock = mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_ohlcv_data',
                            MagicMock(return_value=["ETH/BTC", "XRP/BTC"]))
     patch_exchange(mocker)
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
     args = [
         "download-data",
         "--exchange",
         "binance",
@@ -788,21 +788,21 @@
     pargs = get_args(args)
     pargs['config'] = None
     start_download_data(pargs)
     expected = set(['ETH/USDT', 'LTC/USDT', 'XRP/USDT', 'NEO/USDT', 'TKN/USDT'])
     assert set(dl_mock.call_args_list[0][1]['pairs']) == expected
 
 
-def test_download_data_trades(mocker, caplog):
-    dl_mock = mocker.patch('freqtrade.commands.data_commands.refresh_backtest_trades_data',
+def test_download_data_trades(mocker):
+    dl_mock = mocker.patch('freqtrade.data.history.history_utils.refresh_backtest_trades_data',
                            MagicMock(return_value=[]))
-    convert_mock = mocker.patch('freqtrade.commands.data_commands.convert_trades_to_ohlcv',
+    convert_mock = mocker.patch('freqtrade.data.history.history_utils.convert_trades_to_ohlcv',
                                 MagicMock(return_value=[]))
     patch_exchange(mocker)
-    mocker.patch(f'{EXMS}.markets', PropertyMock(return_value={}))
+    mocker.patch(f'{EXMS}.get_markets', return_value={})
     args = [
         "download-data",
         "--exchange", "kraken",
         "--pairs", "ETH/BTC", "XRP/BTC",
         "--days", "20",
         "--dl-trades"
     ]
@@ -825,15 +825,15 @@
         pargs = get_args(args)
         pargs['config'] = None
         start_download_data(pargs)
 
 
 def test_download_data_data_invalid(mocker):
     patch_exchange(mocker, id="kraken")
-    mocker.patch(f'{EXMS}.markets', PropertyMock(return_value={}))
+    mocker.patch(f'{EXMS}.get_markets', return_value={})
     args = [
         "download-data",
         "--exchange", "kraken",
         "--pairs", "ETH/BTC", "XRP/BTC",
         "--days", "20",
     ]
     pargs = get_args(args)
```

### Comparing `freqtrade-2023.5.1/tests/conftest.py` & `freqtrade-2023.6/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/conftest_trades.py` & `freqtrade-2023.6/tests/conftest_trades.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/conftest_trades_usdt.py` & `freqtrade-2023.6/tests/conftest_trades_usdt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_btanalysis.py` & `freqtrade-2023.6/tests/data/test_btanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_converter.py` & `freqtrade-2023.6/tests/data/test_converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_datahandler.py` & `freqtrade-2023.6/tests/data/test_datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_dataprovider.py` & `freqtrade-2023.6/tests/data/test_dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_entryexitanalysis.py` & `freqtrade-2023.6/tests/data/test_entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/data/test_history.py` & `freqtrade-2023.6/tests/data/test_history.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,11 @@
 # pragma pylint: disable=missing-docstring, protected-access, C0103
 
 import json
+import logging
 import uuid
 from pathlib import Path
 from shutil import copyfile
 from unittest.mock import MagicMock, PropertyMock
 
 import pytest
 from pandas import DataFrame
@@ -499,32 +500,33 @@
 @pytest.mark.parametrize('trademode,callcount', [
     ('spot', 4),
     ('margin', 4),
     ('futures', 8),  # Called 8 times - 4 normal, 2 funding and 2 mark/index calls
 ])
 def test_refresh_backtest_ohlcv_data(
         mocker, default_conf, markets, caplog, testdatadir, trademode, callcount):
-    dl_mock = mocker.patch('freqtrade.data.history.history_utils._download_pair_history',
-                           MagicMock())
+    caplog.set_level(logging.DEBUG)
+    dl_mock = mocker.patch('freqtrade.data.history.history_utils._download_pair_history')
     mocker.patch(f'{EXMS}.markets', PropertyMock(return_value=markets))
+
     mocker.patch.object(Path, "exists", MagicMock(return_value=True))
     mocker.patch.object(Path, "unlink", MagicMock())
 
     ex = get_patched_exchange(mocker, default_conf)
     timerange = TimeRange.parse_timerange("20190101-20190102")
     refresh_backtest_ohlcv_data(exchange=ex, pairs=["ETH/BTC", "XRP/BTC"],
                                 timeframes=["1m", "5m"], datadir=testdatadir,
                                 timerange=timerange, erase=True,
                                 trading_mode=trademode
                                 )
 
     assert dl_mock.call_count == callcount
     assert dl_mock.call_args[1]['timerange'].starttype == 'date'
 
-    assert log_has("Downloading pair ETH/BTC, interval 1m.", caplog)
+    assert log_has_re(r"Downloading pair ETH/BTC, .* interval 1m\.", caplog)
 
 
 def test_download_data_no_markets(mocker, default_conf, caplog, testdatadir):
     dl_mock = mocker.patch('freqtrade.data.history.history_utils._download_pair_history',
                            MagicMock())
 
     ex = get_patched_exchange(mocker, default_conf)
```

### Comparing `freqtrade-2023.5.1/tests/edge/test_edge.py` & `freqtrade-2023.6/tests/edge/test_edge.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_binance.py` & `freqtrade-2023.6/tests/exchange/test_binance.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_bitpanda.py` & `freqtrade-2023.6/tests/exchange/test_bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_bybit.py` & `freqtrade-2023.6/tests/exchange/test_bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_ccxt_compat.py` & `freqtrade-2023.6/tests/exchange/test_ccxt_compat.py`

 * *Files 0% similar despite different names*

```diff
@@ -338,15 +338,15 @@
         exchange = ExchangeResolver.load_exchange(
             exchange_conf, validate=True, load_leverage_tiers=True)
 
         yield exchange, request.param
 
 
 @pytest.mark.longrun
-class TestCCXTExchange():
+class TestCCXTExchange:
 
     def test_load_markets(self, exchange: EXCHANGE_FIXTURE_TYPE):
         exch, exchangename = exchange
         pair = EXCHANGES[exchangename]['pair']
         markets = exch.markets
         assert pair in markets
         assert isinstance(markets[pair], dict)
```

### Comparing `freqtrade-2023.5.1/tests/exchange/test_exchange.py` & `freqtrade-2023.6/tests/exchange/test_exchange.py`

 * *Files 0% similar despite different names*

```diff
@@ -3485,14 +3485,35 @@
             leverage=1.0
         )
 
     with pytest.raises(OperationalException, match=r"stoploss is not implemented .*"):
         exchange.stoploss_adjust(1, {}, side="sell")
 
 
+@pytest.mark.parametrize('side,ratio,expected', [
+    ('sell', 0.99, 99.0),  # Default
+    ('sell', 0.999, 99.9),
+    ('sell', 1, 100),
+    ('sell', 1.1, InvalidOrderException),
+    ('buy', 0.99, 101.0),  # Default
+    ('buy', 0.999, 100.1),
+    ('buy', 1, 100),
+    ('buy', 1.1, InvalidOrderException),
+    ])
+def test__get_stop_limit_rate(default_conf_usdt, mocker, side, ratio, expected):
+    exchange = get_patched_exchange(mocker, default_conf_usdt, id='binance')
+
+    order_types = {'stoploss_on_exchange_limit_ratio': ratio}
+    if isinstance(expected, type) and issubclass(expected, Exception):
+        with pytest.raises(expected):
+            exchange._get_stop_limit_rate(100, order_types, side)
+    else:
+        assert exchange._get_stop_limit_rate(100, order_types, side) == expected
+
+
 def test_merge_ft_has_dict(default_conf, mocker):
     mocker.patch.multiple(EXMS,
                           _init_ccxt=MagicMock(return_value=MagicMock()),
                           _load_async_markets=MagicMock(),
                           validate_pairs=MagicMock(),
                           validate_timeframes=MagicMock(),
                           validate_stakecurrency=MagicMock(),
```

### Comparing `freqtrade-2023.5.1/tests/exchange/test_exchange_utils.py` & `freqtrade-2023.6/tests/exchange/test_exchange_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_gate.py` & `freqtrade-2023.6/tests/exchange/test_gate.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_huobi.py` & `freqtrade-2023.6/tests/exchange/test_huobi.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_kraken.py` & `freqtrade-2023.6/tests/exchange/test_kraken.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_kucoin.py` & `freqtrade-2023.6/tests/exchange/test_kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/exchange/test_okx.py` & `freqtrade-2023.6/tests/exchange/test_okx.py`

 * *Files 2% similar despite different names*

```diff
@@ -495,15 +495,19 @@
     assert api_mock.set_leverage.call_count == 1
     # Leverage is rounded to 3.
     assert api_mock.set_leverage.call_args_list[0][1]['leverage'] == 3.2
     assert api_mock.set_leverage.call_args_list[0][1]['symbol'] == 'BTC/USDT:USDT'
     assert api_mock.set_leverage.call_args_list[0][1]['params'] == {
         'mgnMode': 'isolated',
         'posSide': 'net'}
+    api_mock.set_leverage = MagicMock(side_effect=ccxt.NetworkError())
+    exchange._lev_prep('BTC/USDT:USDT', 3.2, 'buy')
+    api_mock.fetch_leverage.call_count == 1
 
+    api_mock.fetch_leverage = MagicMock(side_effect=ccxt.NetworkError())
     ccxt_exceptionhandlers(
         mocker,
         default_conf,
         api_mock,
         "okx",
         "_lev_prep",
         "set_leverage",
@@ -588,7 +592,29 @@
     order = {
         'type': 'stoploss',
         'price': 1500,
         'stopLossPrice': 1500,
     }
     assert exchange.stoploss_adjust(sl1, order, side=side)
     assert not exchange.stoploss_adjust(sl2, order, side=side)
+
+
+def test_stoploss_cancel_okx(mocker, default_conf):
+    exchange = get_patched_exchange(mocker, default_conf, id='okx')
+
+    exchange.cancel_order = MagicMock()
+
+    exchange.cancel_stoploss_order('1234', 'ETH/USDT')
+    assert exchange.cancel_order.call_count == 1
+    assert exchange.cancel_order.call_args_list[0][1]['order_id'] == '1234'
+    assert exchange.cancel_order.call_args_list[0][1]['pair'] == 'ETH/USDT'
+    assert exchange.cancel_order.call_args_list[0][1]['params'] == {'stop': True}
+
+
+def test__get_stop_params_okx(mocker, default_conf):
+    default_conf['trading_mode'] = 'futures'
+    default_conf['margin_mode'] = 'isolated'
+    exchange = get_patched_exchange(mocker, default_conf, id='okx')
+    params = exchange._get_stop_params('ETH/USDT:USDT', 1500, 'sell')
+
+    assert params['tdMode'] == 'isolated'
+    assert params['posSide'] == 'net'
```

### Comparing `freqtrade-2023.5.1/tests/optimize/__init__.py` & `freqtrade-2023.6/tests/optimize/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/conftest.py` & `freqtrade-2023.6/tests/optimize/conftest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_backtest_detail.py` & `freqtrade-2023.6/tests/optimize/test_backtest_detail.py`

 * *Files 0% similar despite different names*

```diff
@@ -816,15 +816,15 @@
 tc52 = BTContainer(data=[
     # D   O     H     L     C    V    EL XL ES Xs  BT
     [0, 5000, 5050, 4950, 5000, 6172, 1, 0],
     [1, 5000, 5500, 4951, 5000, 6172, 0, 0],  # enter trade (signal on last candle)
     [2, 4900, 5250, 4500, 5100, 6172, 0, 0],  # Order readjust
     [3, 5100, 5100, 4650, 4750, 6172, 0, 0],  # stoploss hit?
     [4, 4750, 4950, 4350, 4750, 6172, 0, 0]],
-    stop_loss=-0.03, roi={"0": 0.10}, profit_perc=-0.03,
+    stop_loss=-0.03, roi={}, profit_perc=-0.03,
     use_exit_signal=True, timeout=1000,
     custom_entry_price=4200, adjust_entry_price=5200,
     trades=[BTrade(exit_reason=ExitType.STOP_LOSS, open_tick=1, close_tick=2, is_short=False)]
 )
 
 
 # Test 53: Custom-entry-price short above all candles - readjust order - stoploss
```

### Comparing `freqtrade-2023.5.1/tests/optimize/test_backtesting.py` & `freqtrade-2023.6/tests/optimize/test_backtesting.py`

 * *Files 0% similar despite different names*

```diff
@@ -1433,17 +1433,19 @@
                  PropertyMock(return_value=['UNITTEST/BTC']))
     mocker.patch('freqtrade.optimize.backtesting.Backtesting.backtest', backtestmock)
     text_table_mock = MagicMock()
     sell_reason_mock = MagicMock()
     strattable_mock = MagicMock()
     strat_summary = MagicMock()
 
-    mocker.patch.multiple('freqtrade.optimize.optimize_reports',
+    mocker.patch.multiple('freqtrade.optimize.optimize_reports.bt_output',
                           text_table_bt_results=text_table_mock,
                           text_table_strategy=strattable_mock,
+                          )
+    mocker.patch.multiple('freqtrade.optimize.optimize_reports.optimize_reports',
                           generate_pair_metrics=MagicMock(),
                           generate_exit_reason_stats=sell_reason_mock,
                           generate_strategy_comparison=strat_summary,
                           generate_daily_stats=MagicMock(),
                           )
     patched_configuration_load_config_file(mocker, default_conf)
```

### Comparing `freqtrade-2023.5.1/tests/optimize/test_backtesting_adjust_position.py` & `freqtrade-2023.6/tests/optimize/test_backtesting_adjust_position.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_edge_cli.py` & `freqtrade-2023.6/tests/optimize/test_edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_hyperopt.py` & `freqtrade-2023.6/tests/optimize/test_hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_hyperopt_tools.py` & `freqtrade-2023.6/tests/optimize/test_hyperopt_tools.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_hyperoptloss.py` & `freqtrade-2023.6/tests/optimize/test_hyperoptloss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/optimize/test_optimize_reports.py` & `freqtrade-2023.6/tests/optimize/test_optimize_reports.py`

 * *Files 0% similar despite different names*

```diff
@@ -10,23 +10,24 @@
 from freqtrade.configuration import TimeRange
 from freqtrade.constants import BACKTEST_BREAKDOWNS, DATETIME_PRINT_FORMAT, LAST_BT_RESULT_FN
 from freqtrade.data import history
 from freqtrade.data.btanalysis import (get_latest_backtest_filename, load_backtest_data,
                                        load_backtest_stats)
 from freqtrade.edge import PairInfo
 from freqtrade.enums import ExitType
-from freqtrade.optimize.optimize_reports import (_get_resample_from_period, generate_backtest_stats,
-                                                 generate_daily_stats, generate_edge_table,
-                                                 generate_exit_reason_stats, generate_pair_metrics,
+from freqtrade.optimize.optimize_reports import (generate_backtest_stats, generate_daily_stats,
+                                                 generate_edge_table, generate_exit_reason_stats,
+                                                 generate_pair_metrics,
                                                  generate_periodic_breakdown_stats,
                                                  generate_strategy_comparison,
                                                  generate_trading_stats, show_sorted_pairlist,
                                                  store_backtest_analysis_results,
                                                  store_backtest_stats, text_table_bt_results,
                                                  text_table_exit_reason, text_table_strategy)
+from freqtrade.optimize.optimize_reports.optimize_reports import _get_resample_from_period
 from freqtrade.resolvers.strategy_resolver import StrategyResolver
 from freqtrade.util import dt_ts
 from freqtrade.util.datetime_helpers import dt_from_ts, dt_utc
 from tests.conftest import CURRENT_TEST_STRATEGY
 from tests.data.test_history import _clean_test_file
 
 
@@ -205,15 +206,15 @@
 
     _clean_test_file(filename_last)
     filename1.unlink()
 
 
 def test_store_backtest_stats(testdatadir, mocker):
 
-    dump_mock = mocker.patch('freqtrade.optimize.optimize_reports.file_dump_json')
+    dump_mock = mocker.patch('freqtrade.optimize.optimize_reports.bt_storage.file_dump_json')
 
     store_backtest_stats(testdatadir, {'metadata': {}}, '2022_01_01_15_05_13')
 
     assert dump_mock.call_count == 3
     assert isinstance(dump_mock.call_args_list[0][0][0], Path)
     assert str(dump_mock.call_args_list[0][0][0]).startswith(str(testdatadir / 'backtest-result'))
 
@@ -224,15 +225,16 @@
     assert isinstance(dump_mock.call_args_list[0][0][0], Path)
     # result will be testdatadir / testresult-<timestamp>.json
     assert str(dump_mock.call_args_list[0][0][0]).startswith(str(testdatadir / 'testresult'))
 
 
 def test_store_backtest_candles(testdatadir, mocker):
 
-    dump_mock = mocker.patch('freqtrade.optimize.optimize_reports.file_dump_joblib')
+    dump_mock = mocker.patch(
+        'freqtrade.optimize.optimize_reports.bt_storage.file_dump_joblib')
 
     candle_dict = {'DefStrat': {'UNITTEST/BTC': pd.DataFrame()}}
 
     # mock directory exporting
     store_backtest_analysis_results(testdatadir, candle_dict, {}, '2022_01_01_15_05_13')
 
     assert dump_mock.call_count == 2
```

### Comparing `freqtrade-2023.5.1/tests/persistence/test_key_value_store.py` & `freqtrade-2023.6/tests/persistence/test_key_value_store.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/persistence/test_migrations.py` & `freqtrade-2023.6/tests/persistence/test_migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/persistence/test_persistence.py` & `freqtrade-2023.6/tests/persistence/test_persistence.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/persistence/test_trade_fromjson.py` & `freqtrade-2023.6/tests/persistence/test_trade_fromjson.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/plugins/test_pairlist.py` & `freqtrade-2023.6/tests/plugins/test_pairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/plugins/test_pairlocks.py` & `freqtrade-2023.6/tests/plugins/test_pairlocks.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/plugins/test_protections.py` & `freqtrade-2023.6/tests/plugins/test_protections.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/plugins/test_remotepairlist.py` & `freqtrade-2023.6/tests/plugins/test_remotepairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/rpc/test_fiat_convert.py` & `freqtrade-2023.6/tests/rpc/test_fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc.py` & `freqtrade-2023.6/tests/rpc/test_rpc.py`

 * *Files 3% similar despite different names*

```diff
@@ -699,23 +699,23 @@
         rpc._rpc_force_exit(None)
 
     freqtradebot.state = State.RUNNING
     with pytest.raises(RPCException, match=r'.*invalid argument*'):
         rpc._rpc_force_exit(None)
 
     msg = rpc._rpc_force_exit('all')
-    assert msg == {'result': 'Created sell orders for all open trades.'}
+    assert msg == {'result': 'Created exit orders for all open trades.'}
 
     freqtradebot.enter_positions()
     msg = rpc._rpc_force_exit('all')
-    assert msg == {'result': 'Created sell orders for all open trades.'}
+    assert msg == {'result': 'Created exit orders for all open trades.'}
 
     freqtradebot.enter_positions()
     msg = rpc._rpc_force_exit('2')
-    assert msg == {'result': 'Created sell order for trade 2.'}
+    assert msg == {'result': 'Created exit order for trade 2.'}
 
     freqtradebot.state = State.STOPPED
     with pytest.raises(RPCException, match=r'.*trader is not running*'):
         rpc._rpc_force_exit(None)
 
     with pytest.raises(RPCException, match=r'.*trader is not running*'):
         rpc._rpc_force_exit('all')
@@ -757,51 +757,79 @@
             'type': 'limit',
             'side': 'buy',
             'filled': filled_amount
         })
 
     freqtradebot.config['max_open_trades'] = 3
     freqtradebot.enter_positions()
-    trade = Trade.session.scalars(select(Trade).filter(Trade.id == '2')).first()
+
+    cancel_order_mock.reset_mock()
+    trade = Trade.session.scalars(select(Trade).filter(Trade.id == '3')).first()
     amount = trade.amount
-    # make an limit-buy open trade, if there is no 'filled', don't sell it
+    # make an limit-sell open order trade
     mocker.patch(
         f'{EXMS}.fetch_order',
         return_value={
             'status': 'open',
             'type': 'limit',
-            'side': 'buy',
-            'filled': None
+            'side': 'sell',
+            'amount': amount,
+            'remaining': amount,
+            'filled': 0.0,
+            'id': trade.orders[0].order_id,
         }
     )
-    # check that the trade is called, which is done by ensuring exchange.cancel_order is called
-    msg = rpc._rpc_force_exit('4')
-    assert msg == {'result': 'Created sell order for trade 4.'}
-    assert cancel_order_mock.call_count == 2
-    assert trade.amount == amount
-
-    trade = Trade.session.scalars(select(Trade).filter(Trade.id == '3')).first()
-
-    # make an limit-sell open trade
-    mocker.patch(
-        f'{EXMS}.fetch_order',
+    cancel_order_3 = mocker.patch(
+        f'{EXMS}.cancel_order_with_result',
         return_value={
-            'status': 'open',
+            'status': 'canceled',
             'type': 'limit',
             'side': 'sell',
             'amount': amount,
             'remaining': amount,
             'filled': 0.0,
             'id': trade.orders[0].order_id,
         }
     )
     msg = rpc._rpc_force_exit('3')
-    assert msg == {'result': 'Created sell order for trade 3.'}
+    assert msg == {'result': 'Created exit order for trade 3.'}
     # status quo, no exchange calls
-    assert cancel_order_mock.call_count == 3
+    assert cancel_order_3.call_count == 1
+    assert cancel_order_mock.call_count == 0
+
+    trade = Trade.session.scalars(select(Trade).filter(Trade.id == '2')).first()
+    amount = trade.amount
+    # make an limit-buy open trade, if there is no 'filled', don't sell it
+    mocker.patch(
+        f'{EXMS}.fetch_order',
+        return_value={
+            'status': 'open',
+            'type': 'limit',
+            'side': 'buy',
+            'filled': None
+        }
+    )
+    cancel_order_4 = mocker.patch(
+            f'{EXMS}.cancel_order_with_result',
+            return_value={
+                'status': 'canceled',
+                'type': 'limit',
+                'side': 'sell',
+                'amount': amount,
+                'remaining': 0.0,
+                'filled': amount,
+                'id': trade.orders[0].order_id,
+                }
+            )
+    # check that the trade is called, which is done by ensuring exchange.cancel_order is called
+    msg = rpc._rpc_force_exit('4')
+    assert msg == {'result': 'Created exit order for trade 4.'}
+    assert cancel_order_4.call_count == 1
+    assert cancel_order_mock.call_count == 0
+    assert trade.amount == amount
 
 
 def test_performance_handle(default_conf_usdt, ticker, fee, mocker) -> None:
     mocker.patch('freqtrade.rpc.telegram.Telegram', MagicMock())
     mocker.patch.multiple(
         EXMS,
         get_balances=MagicMock(return_value=ticker),
```

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc_apiserver.py` & `freqtrade-2023.6/tests/rpc/test_rpc_apiserver.py`

 * *Files 2% similar despite different names*

```diff
@@ -1329,25 +1329,25 @@
 
     create_mock_trades(fee)
     trade = Trade.get_trades([Trade.id == 5]).first()
     assert pytest.approx(trade.amount) == 123
     rc = client_post(client, f"{BASE_URI}/forceexit",
                      data={"tradeid": "5", "ordertype": "market", "amount": 23})
     assert_response(rc)
-    assert rc.json() == {'result': 'Created sell order for trade 5.'}
+    assert rc.json() == {'result': 'Created exit order for trade 5.'}
     Trade.rollback()
 
     trade = Trade.get_trades([Trade.id == 5]).first()
     assert pytest.approx(trade.amount) == 100
     assert trade.is_open is True
 
     rc = client_post(client, f"{BASE_URI}/forceexit",
                      data={"tradeid": "5"})
     assert_response(rc)
-    assert rc.json() == {'result': 'Created sell order for trade 5.'}
+    assert rc.json() == {'result': 'Created exit order for trade 5.'}
     Trade.rollback()
 
     trade = Trade.get_trades([Trade.id == 5]).first()
     assert trade.is_open is False
 
 
 def test_api_pair_candles(botclient, ohlcv_history):
@@ -1574,14 +1574,55 @@
     assert_response(rc, 404)
 
     # Disallow base64 strategies
     rc = client_get(client, f"{BASE_URI}/strategy/xx:cHJpbnQoImhlbGxvIHdvcmxkIik=")
     assert_response(rc, 500)
 
 
+def test_api_exchanges(botclient):
+    ftbot, client = botclient
+
+    rc = client_get(client, f"{BASE_URI}/exchanges")
+    assert_response(rc)
+    response = rc.json()
+    assert isinstance(response['exchanges'], list)
+    assert len(response['exchanges']) > 20
+    okx = [x for x in response['exchanges'] if x['name'] == 'okx'][0]
+    assert okx == {
+        "name": "okx",
+        "valid": True,
+        "supported": True,
+        "comment": "",
+        "trade_modes": [
+            {
+                "trading_mode": "spot",
+                "margin_mode": ""
+            },
+            {
+                "trading_mode": "futures",
+                "margin_mode": "isolated"
+            }
+        ]
+    }
+
+    mexc = [x for x in response['exchanges'] if x['name'] == 'mexc'][0]
+    assert mexc == {
+        "name": "mexc",
+        "valid": True,
+        "supported": False,
+        "comment": "",
+        "trade_modes": [
+                {
+                    "trading_mode": "spot",
+                    "margin_mode": ""
+                }
+            ]
+    }
+
+
 def test_api_freqaimodels(botclient, tmpdir, mocker):
     ftbot, client = botclient
     ftbot.config['user_data_dir'] = Path(tmpdir)
     mocker.patch(
         "freqtrade.resolvers.freqaimodel_resolver.FreqaiModelResolver.search_all_objects",
         return_value=[
             {'name': 'LightGBMClassifier'},
@@ -1612,14 +1653,130 @@
         'XGBoostRFClassifier',
         'XGBoostRFRegressor',
         'XGBoostRegressor',
         'XGBoostRegressorMultiTarget'
     ]}
 
 
+def test_api_pairlists_available(botclient, tmpdir):
+    ftbot, client = botclient
+    ftbot.config['user_data_dir'] = Path(tmpdir)
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/available")
+
+    assert_response(rc, 503)
+    assert rc.json()['detail'] == 'Bot is not in the correct state.'
+
+    ftbot.config['runmode'] = RunMode.WEBSERVER
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/available")
+    assert_response(rc)
+    response = rc.json()
+    assert isinstance(response['pairlists'], list)
+    assert len(response['pairlists']) > 0
+
+    assert len([r for r in response['pairlists'] if r['name'] == 'AgeFilter']) == 1
+    assert len([r for r in response['pairlists'] if r['name'] == 'VolumePairList']) == 1
+    assert len([r for r in response['pairlists'] if r['name'] == 'StaticPairList']) == 1
+
+    volumepl = [r for r in response['pairlists'] if r['name'] == 'VolumePairList'][0]
+    assert volumepl['is_pairlist_generator'] is True
+    assert len(volumepl['params']) > 1
+    age_pl = [r for r in response['pairlists'] if r['name'] == 'AgeFilter'][0]
+    assert age_pl['is_pairlist_generator'] is False
+    assert len(volumepl['params']) > 2
+
+
+def test_api_pairlists_evaluate(botclient, tmpdir, mocker):
+    ftbot, client = botclient
+    ftbot.config['user_data_dir'] = Path(tmpdir)
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/evaluate/randomJob")
+
+    assert_response(rc, 503)
+    assert rc.json()['detail'] == 'Bot is not in the correct state.'
+
+    ftbot.config['runmode'] = RunMode.WEBSERVER
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/evaluate/randomJob")
+    assert_response(rc, 404)
+    assert rc.json()['detail'] == 'Job not found.'
+
+    body = {
+        "pairlists": [
+            {"method": "StaticPairList", },
+        ],
+        "blacklist": [
+        ],
+        "stake_currency": "BTC"
+    }
+    # Fail, already running
+    ApiBG.pairlist_running = True
+    rc = client_post(client, f"{BASE_URI}/pairlists/evaluate", body)
+    assert_response(rc, 400)
+    assert rc.json()['detail'] == 'Pairlist evaluation is already running.'
+
+    # should start the run
+    ApiBG.pairlist_running = False
+    rc = client_post(client, f"{BASE_URI}/pairlists/evaluate", body)
+    assert_response(rc)
+    assert rc.json()['status'] == 'Pairlist evaluation started in background.'
+    job_id = rc.json()['job_id']
+
+    rc = client_get(client, f"{BASE_URI}/background/RandomJob")
+    assert_response(rc, 404)
+    assert rc.json()['detail'] == 'Job not found.'
+
+    rc = client_get(client, f"{BASE_URI}/background/{job_id}")
+    assert_response(rc)
+    response = rc.json()
+    assert response['job_id'] == job_id
+    assert response['job_category'] == 'pairlist'
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/evaluate/{job_id}")
+    assert_response(rc)
+    response = rc.json()
+    assert response['result']['whitelist'] == ['ETH/BTC', 'LTC/BTC', 'XRP/BTC', 'NEO/BTC',]
+    assert response['result']['length'] == 4
+
+    # Restart with additional filter, reducing the list to 2
+    body['pairlists'].append({"method": "OffsetFilter", "number_assets": 2})
+    rc = client_post(client, f"{BASE_URI}/pairlists/evaluate", body)
+    assert_response(rc)
+    assert rc.json()['status'] == 'Pairlist evaluation started in background.'
+    job_id = rc.json()['job_id']
+
+    rc = client_get(client, f"{BASE_URI}/pairlists/evaluate/{job_id}")
+    assert_response(rc)
+    response = rc.json()
+    assert response['result']['whitelist'] == ['ETH/BTC', 'LTC/BTC', ]
+    assert response['result']['length'] == 2
+    # Patch __run_pairlists
+    plm = mocker.patch('freqtrade.rpc.api_server.api_background_tasks.__run_pairlist',
+                       return_value=None)
+    body = {
+        "pairlists": [
+            {"method": "StaticPairList", },
+        ],
+        "blacklist": [
+        ],
+        "stake_currency": "BTC",
+        "exchange": "randomExchange",
+        "trading_mode": "futures",
+        "margin_mode": "isolated",
+    }
+    rc = client_post(client, f"{BASE_URI}/pairlists/evaluate", body)
+    assert_response(rc)
+    assert plm.call_count == 1
+    call_config = plm.call_args_list[0][0][1]
+    assert call_config['exchange']['name'] == 'randomExchange'
+    assert call_config['trading_mode'] == 'futures'
+    assert call_config['margin_mode'] == 'isolated'
+
+
 def test_list_available_pairs(botclient):
     ftbot, client = botclient
 
     rc = client_get(client, f"{BASE_URI}/available_pairs")
 
     assert_response(rc)
     assert rc.json()['length'] == 13
@@ -1669,15 +1826,16 @@
 def test_api_backtesting(botclient, mocker, fee, caplog, tmpdir):
     try:
         ftbot, client = botclient
         mocker.patch(f'{EXMS}.get_fee', fee)
 
         rc = client_get(client, f"{BASE_URI}/backtest")
         # Backtest prevented in default mode
-        assert_response(rc, 502)
+        assert_response(rc, 503)
+        assert rc.json()['detail'] == 'Bot is not in the correct state.'
 
         ftbot.config['runmode'] = RunMode.WEBSERVER
         # Backtesting not started yet
         rc = client_get(client, f"{BASE_URI}/backtest")
         assert_response(rc)
 
         result = rc.json()
@@ -1808,15 +1966,17 @@
     mocker.patch('freqtrade.data.btanalysis._get_backtest_files',
                  return_value=[
                      testdatadir / 'backtest_results/backtest-result_multistrat.json',
                      testdatadir / 'backtest_results/backtest-result.json'
                      ])
 
     rc = client_get(client, f"{BASE_URI}/backtest/history")
-    assert_response(rc, 502)
+    assert_response(rc, 503)
+    assert rc.json()['detail'] == 'Bot is not in the correct state.'
+
     ftbot.config['user_data_dir'] = testdatadir
     ftbot.config['runmode'] = RunMode.WEBSERVER
 
     rc = client_get(client, f"{BASE_URI}/backtest/history")
     assert_response(rc)
     result = rc.json()
     assert len(result) == 3
@@ -1926,7 +2086,8 @@
 
             second_waiter = apiserver._message_stream._waiter
             apiserver.send_msg(test_message)
             assert first_waiter != second_waiter
 
     finally:
         ApiServer.shutdown()
+        ApiServer.shutdown()
```

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc_emc.py` & `freqtrade-2023.6/tests/rpc/test_rpc_emc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc_manager.py` & `freqtrade-2023.6/tests/rpc/test_rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc_telegram.py` & `freqtrade-2023.6/tests/rpc/test_rpc_telegram.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/rpc/test_rpc_webhook.py` & `freqtrade-2023.6/tests/rpc/test_rpc_webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/strategy/test_default_strategy.py` & `freqtrade-2023.6/tests/strategy/test_default_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/strategy/test_interface.py` & `freqtrade-2023.6/tests/strategy/test_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/strategy/test_strategy_helpers.py` & `freqtrade-2023.6/tests/strategy/test_strategy_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/strategy/test_strategy_loading.py` & `freqtrade-2023.6/tests/strategy/test_strategy_loading.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_arguments.py` & `freqtrade-2023.6/tests/test_arguments.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_binance_mig.py` & `freqtrade-2023.6/tests/test_binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_configuration.py` & `freqtrade-2023.6/tests/test_configuration.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,11 +1,9 @@
 # pragma pylint: disable=missing-docstring, protected-access, invalid-name
 import json
-import logging
-import sys
 import warnings
 from copy import deepcopy
 from pathlib import Path
 from unittest.mock import MagicMock
 
 import pytest
 from jsonschema import ValidationError
@@ -19,16 +17,14 @@
                                                          process_temporary_deprecated_settings)
 from freqtrade.configuration.environment_vars import flat_vars_to_nested_dict
 from freqtrade.configuration.load_config import (load_config_file, load_file, load_from_files,
                                                  log_config_error_range)
 from freqtrade.constants import DEFAULT_DB_DRYRUN_URL, DEFAULT_DB_PROD_URL, ENV_VAR_PREFIX
 from freqtrade.enums import RunMode
 from freqtrade.exceptions import OperationalException
-from freqtrade.loggers import (FTBufferingHandler, FTStdErrStreamHandler, _set_loggers,
-                               setup_logging, setup_logging_pre)
 from tests.conftest import (CURRENT_TEST_STRATEGY, log_has, log_has_re,
                             patched_configuration_load_config_file)
 
 
 @pytest.fixture(scope="function")
 def all_conf():
     config_file = Path(__file__).parents[1] / "config_examples/config_full.example.json"
@@ -590,146 +586,25 @@
     assert config['runmode'] == RunMode.HYPEROPT
 
 
 def test_cli_verbose_with_params(default_conf, mocker, caplog) -> None:
     patched_configuration_load_config_file(mocker, default_conf)
 
     # Prevent setting loggers
-    mocker.patch('freqtrade.loggers._set_loggers', MagicMock)
+    mocker.patch('freqtrade.loggers.set_loggers', MagicMock)
     arglist = ['trade', '-vvv']
     args = Arguments(arglist).get_parsed_arg()
 
     configuration = Configuration(args)
     validated_conf = configuration.load_config()
 
     assert validated_conf.get('verbosity') == 3
     assert log_has('Verbosity set to 3', caplog)
 
 
-def test_set_loggers() -> None:
-    # Reset Logging to Debug, otherwise this fails randomly as it's set globally
-    logging.getLogger('requests').setLevel(logging.DEBUG)
-    logging.getLogger("urllib3").setLevel(logging.DEBUG)
-    logging.getLogger('ccxt.base.exchange').setLevel(logging.DEBUG)
-    logging.getLogger('telegram').setLevel(logging.DEBUG)
-
-    previous_value1 = logging.getLogger('requests').level
-    previous_value2 = logging.getLogger('ccxt.base.exchange').level
-    previous_value3 = logging.getLogger('telegram').level
-
-    _set_loggers()
-
-    value1 = logging.getLogger('requests').level
-    assert previous_value1 is not value1
-    assert value1 is logging.INFO
-
-    value2 = logging.getLogger('ccxt.base.exchange').level
-    assert previous_value2 is not value2
-    assert value2 is logging.INFO
-
-    value3 = logging.getLogger('telegram').level
-    assert previous_value3 is not value3
-    assert value3 is logging.INFO
-
-    _set_loggers(verbosity=2)
-
-    assert logging.getLogger('requests').level is logging.DEBUG
-    assert logging.getLogger('ccxt.base.exchange').level is logging.INFO
-    assert logging.getLogger('telegram').level is logging.INFO
-    assert logging.getLogger('werkzeug').level is logging.INFO
-
-    _set_loggers(verbosity=3, api_verbosity='error')
-
-    assert logging.getLogger('requests').level is logging.DEBUG
-    assert logging.getLogger('ccxt.base.exchange').level is logging.DEBUG
-    assert logging.getLogger('telegram').level is logging.INFO
-    assert logging.getLogger('werkzeug').level is logging.ERROR
-
-
-@pytest.mark.skipif(sys.platform == "win32", reason="does not run on windows")
-def test_set_loggers_syslog():
-    logger = logging.getLogger()
-    orig_handlers = logger.handlers
-    logger.handlers = []
-
-    config = {'verbosity': 2,
-              'logfile': 'syslog:/dev/log',
-              }
-
-    setup_logging_pre()
-    setup_logging(config)
-    assert len(logger.handlers) == 3
-    assert [x for x in logger.handlers if type(x) == logging.handlers.SysLogHandler]
-    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
-    assert [x for x in logger.handlers if type(x) == FTBufferingHandler]
-    # setting up logging again should NOT cause the loggers to be added a second time.
-    setup_logging(config)
-    assert len(logger.handlers) == 3
-    # reset handlers to not break pytest
-    logger.handlers = orig_handlers
-
-
-@pytest.mark.skipif(sys.platform == "win32", reason="does not run on windows")
-def test_set_loggers_Filehandler(tmpdir):
-    logger = logging.getLogger()
-    orig_handlers = logger.handlers
-    logger.handlers = []
-    logfile = Path(tmpdir) / 'ft_logfile.log'
-    config = {'verbosity': 2,
-              'logfile': str(logfile),
-              }
-
-    setup_logging_pre()
-    setup_logging(config)
-    assert len(logger.handlers) == 3
-    assert [x for x in logger.handlers if type(x) == logging.handlers.RotatingFileHandler]
-    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
-    assert [x for x in logger.handlers if type(x) == FTBufferingHandler]
-    # setting up logging again should NOT cause the loggers to be added a second time.
-    setup_logging(config)
-    assert len(logger.handlers) == 3
-    # reset handlers to not break pytest
-    if logfile.exists:
-        logfile.unlink()
-    logger.handlers = orig_handlers
-
-
-@pytest.mark.skip(reason="systemd is not installed on every system, so we're not testing this.")
-def test_set_loggers_journald(mocker):
-    logger = logging.getLogger()
-    orig_handlers = logger.handlers
-    logger.handlers = []
-
-    config = {'verbosity': 2,
-              'logfile': 'journald',
-              }
-
-    setup_logging_pre()
-    setup_logging(config)
-    assert len(logger.handlers) == 3
-    assert [x for x in logger.handlers if type(x).__name__ == "JournaldLogHandler"]
-    assert [x for x in logger.handlers if type(x) == FTStdErrStreamHandler]
-    # reset handlers to not break pytest
-    logger.handlers = orig_handlers
-
-
-def test_set_loggers_journald_importerror(import_fails):
-    logger = logging.getLogger()
-    orig_handlers = logger.handlers
-    logger.handlers = []
-
-    config = {'verbosity': 2,
-              'logfile': 'journald',
-              }
-    with pytest.raises(OperationalException,
-                       match=r'You need the cysystemd python package.*'):
-        setup_logging(config)
-    logger.handlers = orig_handlers
-
-
 def test_set_logfile(default_conf, mocker, tmpdir):
     patched_configuration_load_config_file(mocker, default_conf)
     f = Path(tmpdir / "test_file.log")
     assert not f.is_file()
     arglist = [
         'trade', '--logfile', str(f),
     ]
```

### Comparing `freqtrade-2023.5.1/tests/test_directory_operations.py` & `freqtrade-2023.6/tests/test_directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_freqtradebot.py` & `freqtrade-2023.6/tests/test_freqtradebot.py`

 * *Files 0% similar despite different names*

```diff
@@ -1237,14 +1237,16 @@
 
     stoploss_order_hit = MagicMock(return_value={
         'id': "104",
         'status': 'closed',
         'type': 'stop_loss_limit',
         'price': 3,
         'average': 2,
+        'filled': enter_order['amount'],
+        'remaining': 0,
         'amount': enter_order['amount'],
     })
     mocker.patch(f'{EXMS}.fetch_stoploss_order', stoploss_order_hit)
     assert freqtrade.handle_stoploss_on_exchange(trade) is True
     assert log_has_re(r'STOP_LOSS_LIMIT is hit for Trade\(id=1, .*\)\.', caplog)
     assert trade.stoploss_order_id is None
     assert trade.is_open is False
@@ -1599,37 +1601,37 @@
     trade.stoploss_order_id = 'stoploss_orderid'
     freqtrade.create_stoploss_order(trade, 200)
     # No change to stoploss-orderid
     assert trade.stoploss_order_id == 'stoploss_orderid'
     assert mock_insuf.call_count == 1
 
 
-@pytest.mark.parametrize("is_short,bid,ask,stop_price,amt,hang_price", [
-    (False, [4.38, 4.16], [4.4, 4.17], ['2.0805', 4.4 * 0.95], 27.39726027, 3),
-    (True, [1.09, 1.21], [1.1, 1.22], ['2.321', 1.09 * 1.05], 27.27272727, 1.5),
+@pytest.mark.parametrize("is_short,bid,ask,stop_price,hang_price", [
+    (False, [4.38, 4.16], [4.4, 4.17], ['2.0805', 4.4 * 0.95], 3),
+    (True, [1.09, 1.21], [1.1, 1.22], ['2.321', 1.09 * 1.05], 1.5),
 ])
 @pytest.mark.usefixtures("init_persistence")
 def test_handle_stoploss_on_exchange_trailing(
-    mocker, default_conf_usdt, fee, is_short, bid, ask, limit_order, stop_price, amt, hang_price
+    mocker, default_conf_usdt, fee, is_short, bid, ask, limit_order, stop_price, hang_price
 ) -> None:
     # When trailing stoploss is set
     enter_order = limit_order[entry_side(is_short)]
     exit_order = limit_order[exit_side(is_short)]
     stoploss = MagicMock(return_value={'id': 13434334, 'status': 'open'})
     patch_RPCManager(mocker)
     mocker.patch.multiple(
         EXMS,
         fetch_ticker=MagicMock(return_value={
             'bid': 2.19,
             'ask': 2.2,
             'last': 2.19,
         }),
         create_order=MagicMock(side_effect=[
-            {'id': enter_order['id']},
-            {'id': exit_order['id']},
+            enter_order,
+            exit_order,
         ]),
         get_fee=fee,
     )
     mocker.patch.multiple(
         EXMS,
         create_stoploss=stoploss,
         stoploss_adjust=MagicMock(return_value=True),
@@ -1717,15 +1719,15 @@
     # setting stoploss_on_exchange_interval to 0 seconds
     freqtrade.strategy.order_types['stoploss_on_exchange_interval'] = 0
 
     assert freqtrade.handle_stoploss_on_exchange(trade) is False
 
     cancel_order_mock.assert_called_once_with('100', 'ETH/USDT')
     stoploss_order_mock.assert_called_once_with(
-        amount=pytest.approx(amt),
+        amount=30,
         pair='ETH/USDT',
         order_types=freqtrade.strategy.order_types,
         stop_price=stop_price[1],
         side=exit_side(is_short),
         leverage=1.0
     )
 
@@ -1986,15 +1988,15 @@
     assert freqtrade.handle_trade(trade) is True
 
 
 def test_tsl_on_exchange_compatible_with_edge(mocker, edge_conf, fee, limit_order) -> None:
 
     enter_order = limit_order['buy']
     exit_order = limit_order['sell']
-
+    enter_order['average'] = 2.19
     # When trailing stoploss is set
     stoploss = MagicMock(return_value={'id': '13434334', 'status': 'open'})
     patch_RPCManager(mocker)
     patch_exchange(mocker)
     patch_edge(mocker)
     edge_conf['max_open_trades'] = float('inf')
     edge_conf['dry_run_wallet'] = 999.9
@@ -2003,16 +2005,16 @@
         EXMS,
         fetch_ticker=MagicMock(return_value={
             'bid': 2.19,
             'ask': 2.2,
             'last': 2.19
         }),
         create_order=MagicMock(side_effect=[
-            {'id': enter_order['id']},
-            {'id': exit_order['id']},
+            enter_order,
+            exit_order,
         ]),
         get_fee=fee,
         create_stoploss=stoploss,
     )
 
     # enabling TSL
     edge_conf['trailing_stop'] = True
@@ -2100,15 +2102,15 @@
     assert freqtrade.handle_trade(trade) is False
     assert freqtrade.handle_stoploss_on_exchange(trade) is False
 
     # stoploss should be set to 1% as trailing is on
     assert trade.stop_loss == 4.4 * 0.99
     cancel_order_mock.assert_called_once_with('100', 'NEO/BTC')
     stoploss_order_mock.assert_called_once_with(
-        amount=pytest.approx(11.41438356),
+        amount=30,
         pair='NEO/BTC',
         order_types=freqtrade.strategy.order_types,
         stop_price=4.4 * 0.99,
         side='sell',
         leverage=1.0
     )
 
@@ -2970,19 +2972,20 @@
 @pytest.mark.parametrize("is_short", [False, True])
 def test_manage_open_orders_exit_usercustom(
     default_conf_usdt, ticker_usdt, limit_sell_order_old, mocker,
     is_short, open_trade_usdt, caplog
 ) -> None:
     default_conf_usdt["unfilledtimeout"] = {"entry": 1440, "exit": 1440, "exit_timeout_count": 1}
     open_trade_usdt.open_order_id = limit_sell_order_old['id']
-    order = Order.parse_from_ccxt_object(limit_sell_order_old, 'mocked', 'sell')
-    open_trade_usdt.orders[0] = order
     if is_short:
         limit_sell_order_old['side'] = 'buy'
         open_trade_usdt.is_short = is_short
+    open_exit_order = Order.parse_from_ccxt_object(limit_sell_order_old, 'mocked',
+                                                   'buy' if is_short else 'sell')
+    open_trade_usdt.orders[-1] = open_exit_order
 
     rpc_mock = patch_RPCManager(mocker)
     cancel_order_mock = MagicMock()
     patch_exchange(mocker)
     mocker.patch(f'{EXMS}.get_min_pair_stake_amount', return_value=0.0)
     et_mock = mocker.patch('freqtrade.freqtradebot.FreqtradeBot.execute_trade_exit')
     mocker.patch.multiple(
```

### Comparing `freqtrade-2023.5.1/tests/test_indicators.py` & `freqtrade-2023.6/tests/test_indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_integration.py` & `freqtrade-2023.6/tests/test_integration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_main.py` & `freqtrade-2023.6/tests/test_main.py`

 * *Files 2% similar despite different names*

```diff
@@ -114,29 +114,29 @@
     assert log_has('Using config: config_examples/config_bittrex.example.json ...', caplog)
     assert log_has('Oh snap!', caplog)
 
 
 def test_main_operational_exception1(mocker, default_conf, caplog) -> None:
     patch_exchange(mocker)
     mocker.patch(
-        'freqtrade.commands.list_commands.validate_exchanges',
+        'freqtrade.commands.list_commands.list_available_exchanges',
         MagicMock(side_effect=ValueError('Oh snap!'))
     )
     patched_configuration_load_config_file(mocker, default_conf)
 
     args = ['list-exchanges']
 
     # Test Main + the KeyboardInterrupt exception
     with pytest.raises(SystemExit):
         main(args)
 
     assert log_has('Fatal exception!', caplog)
     assert not log_has_re(r'SIGINT.*', caplog)
     mocker.patch(
-        'freqtrade.commands.list_commands.validate_exchanges',
+        'freqtrade.commands.list_commands.list_available_exchanges',
         MagicMock(side_effect=KeyboardInterrupt)
     )
     with pytest.raises(SystemExit):
         main(args)
 
     assert log_has_re(r'SIGINT.*', caplog)
```

### Comparing `freqtrade-2023.5.1/tests/test_misc.py` & `freqtrade-2023.6/tests/test_misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_plotting.py` & `freqtrade-2023.6/tests/test_plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_strategy_updater.py` & `freqtrade-2023.6/tests/test_strategy_updater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_timerange.py` & `freqtrade-2023.6/tests/test_timerange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_wallets.py` & `freqtrade-2023.6/tests/test_wallets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5.1/tests/test_worker.py` & `freqtrade-2023.6/tests/test_worker.py`

 * *Files identical despite different names*

